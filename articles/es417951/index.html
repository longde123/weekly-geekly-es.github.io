<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÑ üé∑ üå®Ô∏è Escribir c√≥digo Kotlin amigable con Java ü§¢ ü§¶ üìµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Desde el exterior, puede parecer que Kotlin ha simplificado el desarrollo de Android sin introducir nuevas dificultades: el lenguaje es compatible con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escribir c√≥digo Kotlin amigable con Java</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/417951/">  Desde el exterior, puede parecer que Kotlin ha simplificado el desarrollo de Android sin introducir nuevas dificultades: el lenguaje es compatible con Java, por lo que incluso un gran proyecto de Java puede traducirse gradualmente sin molestar a nadie, ¬øverdad?  Pero si miras m√°s profundamente, en cada caja hay un doble fondo, y en el tocador hay una puerta secreta.  Los lenguajes de programaci√≥n son proyectos demasiado complejos para combinarse sin matices complicados. <br><br>  Por supuesto, esto no significa "todo est√° mal y no necesita usar Kotlin con Java", sino que debe conocer los matices y tenerlos en cuenta.  En nuestra conferencia de <b>Mobius</b> , Sergei Ryabov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habl√≥ sobre</a> c√≥mo escribir c√≥digo en Kotlin al que se podr√≠a acceder c√≥modamente desde Java.  Y al p√∫blico le gust√≥ tanto el informe que no solo decidimos publicar un video, sino que tambi√©n hicimos una versi√≥n de texto para Habr: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1L0q5VKx_-s" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  He estado escribiendo Kotlin durante m√°s de tres a√±os, ahora solo en √©l, pero al principio arrastr√© a Kotlin a proyectos Java existentes.  Por lo tanto, la pregunta "c√≥mo unir Java y Kotlin" en mi forma surgi√≥ con bastante frecuencia. <br><br>  A menudo, cuando agrega Kotlin a un proyecto, puede ver c√≥mo esto ... <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">compile</span></span> <span class="hljs-string"><span class="hljs-string">'rxbinding:xyx'</span></span> compile <span class="hljs-string"><span class="hljs-string">'rxbinding-appcompat-v7:xyx'</span></span> compile <span class="hljs-string"><span class="hljs-string">'rxbinding-design:xyx'</span></span> compile <span class="hljs-string"><span class="hljs-string">'autodispose:xyz'</span></span> compile <span class="hljs-string"><span class="hljs-string">'autodispose-android:xyz'</span></span> compile <span class="hljs-string"><span class="hljs-string">'autodispose-android-archcomponents:xyz'</span></span></code> </pre> <br>  ... se convierte en esto: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">compile</span></span> <span class="hljs-string"><span class="hljs-string">'rxbinding:xyx'</span></span> compile <span class="hljs-string"><span class="hljs-string">'rxbinding-kotlin:xyx'</span></span> compile <span class="hljs-string"><span class="hljs-string">'rxbinding-appcompat-v7:xyx'</span></span> compile <span class="hljs-string"><span class="hljs-string">'rxbinding-appcompat-v7-kotlin:xyx'</span></span> compile <span class="hljs-string"><span class="hljs-string">'rxbinding-design:xyx'</span></span> compile <span class="hljs-string"><span class="hljs-string">'rxbinding-design-kotlin:xyx'</span></span> compile <span class="hljs-string"><span class="hljs-string">'autodispose:xyz'</span></span> compile <span class="hljs-string"><span class="hljs-string">'autodispose-kotlin:xyz'</span></span> compile <span class="hljs-string"><span class="hljs-string">'autodispose-android:xyz'</span></span> compile <span class="hljs-string"><span class="hljs-string">'autodispose-android-kotlin:xyz'</span></span> compile <span class="hljs-string"><span class="hljs-string">'autodispose-android-archcomponents:xyz'</span></span> compile <span class="hljs-string"><span class="hljs-string">'autodispose-android-archcomponents-kotlin:xyz'</span></span></code> </pre><br>  Los detalles de los √∫ltimos a√±os: las bibliotecas m√°s populares adquieren envoltorios para que puedan ser utilizados desde Kotlin de manera m√°s idiom√°tica. <br><br>  Si escribi√≥ en Kotlin, entonces sabe que hay funciones de extensi√≥n interesantes, funciones en l√≠nea, expresiones lambda que est√°n disponibles en Java 6. Y esto es genial, nos atrae a Kotlin, pero surge la pregunta.  Una de las caracter√≠sticas m√°s grandes y publicitadas del lenguaje es la interoperabilidad con Java.  Si tiene en cuenta todas las caracter√≠sticas enumeradas, ¬øpor qu√© no simplemente escribir bibliotecas en Kotlin?  Todos funcionar√°n perfectamente con Java, y no necesitar√° admitir todos estos contenedores, todos estar√°n contentos y contentos. <br><br>  Pero, por supuesto, en la pr√°ctica, no todo es tan color de rosa como en los folletos, siempre hay un "peque√±o atributo de fuente", hay bordes afilados en la uni√≥n de Kotlin y Java, y hoy hablaremos un poco sobre esto. <br><br><h2>  Bordes afilados </h2><br>  Comencemos con las diferencias.  Por ejemplo, ¬øsabe que en Kotlin no hay palabras clave vol√°tiles, sincronizadas, estrictas, transitorias?  Se reemplazan por anotaciones del mismo nombre ubicadas en el paquete kotlin.jvm.  Por lo tanto, la mayor parte de la conversaci√≥n tratar√° sobre el contenido de este paquete. <br><br>  Existe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Timber</a> , una abstracci√≥n de la biblioteca sobre los madereros del famoso <abbr title="Jake Wharton">Zheka Vartanov</abbr> .  Le permite usarlo en todas partes en su aplicaci√≥n, y todo lo que desee enviar registros (a logcat, o a su servidor para an√°lisis, o informes de fallos, etc.) se convierte en complementos. <br><br>  Imaginemos, por ejemplo, que queremos escribir una biblioteca similar, solo para an√°lisis.  Tambi√©n desconectarse. <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Analytics { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Event</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPlugins</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(plugs: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Plugin</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPlugins</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Plugin&gt; {} } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plugin</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Event</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> context: Map&lt;String, Any&gt; = emptyMap() )</code> </pre><br>  Tomamos el mismo patr√≥n de construcci√≥n, tenemos un punto de entrada: esto es Analytics.  Podemos enviar eventos all√≠, agregar complementos y ver lo que ya hemos agregado all√≠. <br><br>  Plugin es una interfaz de plugin que abstrae una API anal√≠tica espec√≠fica. <br><br>  Y, de hecho, la clase de evento que contiene la clave y nuestros atributos que enviamos.  Aqu√≠ el informe no trata sobre si vale la pena usar singletones, as√≠ que no criemos un holivar, sino que veremos c√≥mo peinar todo esto. <br><br>  Ahora una peque√±a inmersi√≥n.  Aqu√≠ hay un ejemplo del uso de nuestra biblioteca en Kotlin: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useAnalytics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { Analytics.send(Event(<span class="hljs-string"><span class="hljs-string">"only_name_event"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> props = mapOf( USER_ID to <span class="hljs-number"><span class="hljs-number">1235</span></span>, <span class="hljs-string"><span class="hljs-string">"my_custom_attr"</span></span> to <span class="hljs-literal"><span class="hljs-literal">true</span></span> ) Analytics.send(Event(<span class="hljs-string"><span class="hljs-string">"custom_event"</span></span>, props)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hasPlugins = Analytics.hasPlugins Analytics.addPlugin(EMPTY_PLUGIN) <span class="hljs-comment"><span class="hljs-comment">// dry-run Analytics.addPlugins(listOf(LoggerPlugin("ALog"), SegmentPlugin))) val plugins = Analytics.getPlugins() // ... }</span></span></code> </pre><br>  En principio, se ve como se esperaba.  Un punto de entrada, los m√©todos se llaman est√°ticos.  Evento sin par√°metros, evento con atributos.  Verificamos si tenemos complementos, colocamos un complemento vac√≠o all√≠ para hacer alg√∫n tipo de ejecuci√≥n de "ejecuci√≥n en seco".  O agregue algunos otros complementos, mu√©strelos, etc.  En general, casos de usuarios est√°ndar, espero que todo est√© claro hasta ahora. <br><br>  Ahora veamos qu√© sucede en Java cuando hacemos lo mismo: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useAnalytics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Analytics.INSTANCE.send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-string"><span class="hljs-string">"only_name_event"</span></span>, Collections.emptyMap())); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;String, Object&gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); props.put(USER_ID, <span class="hljs-number"><span class="hljs-number">1235</span></span>); props.put(<span class="hljs-string"><span class="hljs-string">"my_custom_attr"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); Analytics.INSTANCE.send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-string"><span class="hljs-string">"custom_event"</span></span>, props)); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> hasPlugins = Analytics.INSTANCE.getHasPlugins(); Analytics.INSTANCE.addPlugin(Analytics.INSTANCE.getEMPTY_PLUGIN()); <span class="hljs-comment"><span class="hljs-comment">// dry-run final List&lt;EmptyPlugin&gt; pluginsToSet = Arrays.asList(new LoggerPlugin("ALog"), new SegmentPlugin()); // ... }</span></span></code> </pre><br>  El alboroto con INSTANCE se apresura de inmediato en mis ojos, que se extiende, la presencia de valores expl√≠citos para el par√°metro predeterminado con atributos, algunos captadores con nombres tontos.  Dado que, en general, nos hemos reunido aqu√≠ para convertir esto en algo similar al archivo anterior con Kotlin, entonces veamos cada momento que no nos gusta e intentemos adaptarlo de alguna manera. <br><br>  Comencemos con el evento.  Eliminamos el par√°metro Colletions.emptyMap () de la segunda l√≠nea y aparece un error del compilador.  ¬øCu√°l es la raz√≥n de esto? <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Event</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Map</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Any</span></span></span><span class="hljs-class">&gt; = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">emptyMap</span></span></span><span class="hljs-class">() )</span></span></code> </pre><br>  Nuestro constructor tiene un par√°metro predeterminado al que le pasamos el valor.  Venimos de Java a Kotlin, es l√≥gico suponer que la presencia de un par√°metro predeterminado genera dos constructores: uno completo con dos par√°metros y otro parcial, para el cual solo se puede especificar el nombre.  Obviamente, el compilador no lo cree as√≠.  Veamos por qu√© piensa que estamos equivocados. <br><br>  Nuestra herramienta principal para analizar todos los giros y vueltas de c√≥mo Kotlin se convierte en un bytecode JVM - Kotlin Bytecode Viewer.  En Android Studio e IntelliJ IDEA, se encuentra en el men√∫ Herramientas - Kotlin - Mostrar c√≥digo de bytes Kotlin.  Simplemente puede presionar Cmd + Shift + A y escribir Kotlin Bytecode en la barra de b√∫squeda. <br><br><img src="https://habrastorage.org/webt/3d/9i/kg/3d9ikgrehu0zgr50qyftivtoahi.png"><br><br>  Aqu√≠, sorprendentemente, vemos un bytecode de en lo que se est√° convirtiendo nuestra clase de Kotlin.  No espero que tenga un excelente conocimiento del c√≥digo de bytes, y lo m√°s importante, los desarrolladores de IDE tampoco lo esperan.  Por lo tanto, hicieron un bot√≥n Descompilar. <br><br>  Despu√©s de hacer clic en √©l, vemos un c√≥digo Java tan bueno: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String name; <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map context; <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name; } <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> Map </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Event</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull String name, @NotNull Map context)</span></span></span><span class="hljs-function"> </span></span>{ Intrinsics.checkParameterIsNotNull(name, <span class="hljs-string"><span class="hljs-string">"name"</span></span>); Intrinsics.checkParameterIsNotNull(context, <span class="hljs-string"><span class="hljs-string">"context"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context = context; } <span class="hljs-comment"><span class="hljs-comment">// $FF: Synthetic method public Event(String var1, Map var2, int var3, DefaultConstructorMarker var4) { if ((var3 &amp; 2) != 0) { var2 = MapsKt.emptyMap(); } // ... }</span></span></code> </pre><br>  Vemos nuestros campos, captadores, el constructor esperado con dos par√°metros nombre y contexto, todo sucede bien.  Y a continuaci√≥n vemos el segundo constructor, y aqu√≠ est√° con una firma inesperada: no con un par√°metro, sino por alguna raz√≥n con cuatro. <br><br>  Aqu√≠ puedes sentirte avergonzado, pero puedes escalar un poco m√°s y hurgar.  Comenzando a entender, entenderemos que DefaultConstructorMarker es una clase privada de la biblioteca est√°ndar de Kotlin, agregada aqu√≠ para que no haya conflictos con nuestros constructores escritos, ya que no podemos establecer un par√°metro de tipo DefaultConstructorMarker con nuestras manos.  Y lo interesante de int var3 es la m√°scara de bits de los valores predeterminados que debemos usar.  En este caso, si la m√°scara de bits coincide con las dos, sabemos que var2 no est√° establecida, nuestros atributos no est√°n establecidos y usamos el valor predeterminado. <br><br>  ¬øC√≥mo podemos solucionar la situaci√≥n?  Para hacer esto, hay una anotaci√≥n milagrosa @JvmOverloads del paquete del que ya habl√©.  Tenemos que colgarlo en el constructor. <br><br><pre> <code class="hljs delphi">data <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Event @JvmOverloads <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( val </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">name</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, val context: Map&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any&gt; = emptyMap()</span></span></span><span class="hljs-function"> )</span></span></code> </pre><br>  ¬øY qu√© har√° ella?  Pasemos a la misma herramienta.  Ahora vemos nuestro constructor completo, y el constructor con DefaultConstructorMarker, y, he aqu√≠, un constructor con un par√°metro, que ahora est√° disponible desde Java: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@JvmOverloads</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Event</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, (Map)<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, (DefaultConstructorMarker)<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); }</code> </pre><br>  Y, como puede ver, delega todo el trabajo con par√°metros predeterminados a nuestro constructor con m√°scaras de bits.  Por lo tanto, no producimos informaci√≥n sobre el valor predeterminado que necesitamos poner all√≠, simplemente delegamos todo en un constructor.  Agradable  Verificamos lo que obtenemos del lado de Java: el compilador est√° contento y no indignado. <br><br>  Veamos lo que no nos gusta a continuaci√≥n.  No nos gusta este INSTANCE, que en IDEA es un insensible de color morado.  No me gusta el color morado :) <br><br><img src="https://habrastorage.org/webt/ys/rq/er/ysrqerlelunfipzn0xat3yek9da.png"><br><br>  Vamos a comprobar, debido a lo que resulta.  Miremos el bytecode nuevamente. <br><br>  Por ejemplo, destacamos la funci√≥n init y nos aseguramos de que init se genere, no est√°tico. <br><br><img src="https://habrastorage.org/webt/ek/5h/m2/ek5hm21brrzzf5yfu5mahq4x5eq.png"><br><br>  Es decir, digamos lo que uno pueda decir, necesitamos trabajar con una instancia de esta clase y llamar a estos m√©todos sobre ella.  Pero podemos obligar a la generaci√≥n de todos estos m√©todos a ser est√°ticos.  Hay una maravillosa anotaci√≥n @JvmStatic para esto.  A√±√°dalo al init y env√≠e funciones y verifiquemos qu√© piensa el compilador al respecto ahora. <br><br>  Vemos que la palabra clave est√°tica se ha agregado a public final init (), y nos hemos ahorrado de trabajar con INSTANCE.  Verificaremos esto en el c√≥digo Java. <br><br>  El compilador ahora nos dice que estamos invocando el m√©todo est√°tico desde el contexto INSTANCE.  Esto se puede corregir: presione Alt + Intro, seleccione "C√≥digo de limpieza" y listo, INSTANCE desaparece, todo se ve casi igual que en Kotlin: <br><br><pre> <code class="java hljs"> Analytics.send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-string"><span class="hljs-string">"only_name_event"</span></span>));</code> </pre><br>  Ahora tenemos un esquema para trabajar con m√©todos est√°ticos.  Agregue esta anotaci√≥n donde sea que nos importe: <br><br><img src="https://habrastorage.org/webt/0o/m4/ky/0om4kydc_nj_fnmjd6jnfsfqfao.png"><br><br>  Y el comentario: si los m√©todos que tenemos son obviamente los m√©todos de instancia, entonces, por ejemplo, con propiedades, no todo es tan obvio.  Los campos en s√≠ (por ejemplo, complementos) se generan como est√°ticos.  Pero getters y setters funcionan como m√©todos de instancia.  Por lo tanto, para las propiedades, tambi√©n debe agregar esta anotaci√≥n para que los establecedores y captadores sean est√°ticos.  Por ejemplo, vemos la variable isInited, le agregamos la anotaci√≥n @JvmStatic y ahora vemos en Kotlin Bytecode Viewer que el m√©todo isInited () se ha vuelto est√°tico, todo est√° bien. <br><br>  Ahora vamos al c√≥digo de Java, "para limpiarlo", y todo se parece a Kotlin, excepto los puntos y comas y la palabra nuevo, bueno, no los eliminar√°. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useAnalytics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Analytics.send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-string"><span class="hljs-string">"only_name_event"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;String, Object&gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); props.put(USER_ID, <span class="hljs-number"><span class="hljs-number">1235</span></span>); props.put(<span class="hljs-string"><span class="hljs-string">"my_custom_attr"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); Analytics.send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-string"><span class="hljs-string">"custom_event"</span></span>, props)); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> hasPlugins = Analytics.getHasPlugins(); Analytics.addPlugin(Analytics.INSTANCE.getEMPTY_PLUGIN()); <span class="hljs-comment"><span class="hljs-comment">// dry-run // ... }</span></span></code> </pre><br>  Siguiente paso: vemos este getHasPlugins tontamente llamado getter con dos prefijos a la vez.  Por supuesto, no soy un gran conocedor del idioma ingl√©s, pero me parece que hay algo m√°s impl√≠cito aqu√≠.  ¬øPor qu√© est√° pasando esto? <br><br>  Como sab√≠an de cerca con Kotlin, los nombres de propiedad para captadores y definidores se generan de acuerdo con las reglas de JavaBeans.  Esto significa que los getters generalmente estar√°n con prefijos get, setters con prefijos establecidos.  Pero hay una excepci√≥n: si tiene un campo booleano y su nombre tiene el prefijo is, entonces el getter tendr√° como prefijo is.  Esto se puede ver en el ejemplo del campo isInited anterior. <br><br>  Desafortunadamente, lejos de siempre, los campos booleanos deben llamarse a trav√©s de is.  isPlugins no satisfar√≠a lo que queremos mostrar sem√°nticamente por nombre.  Como seamos <br><br>  Y no es dif√≠cil para nosotros, para esto tenemos nuestra propia anotaci√≥n (como ya entendiste, a menudo repetir√© esto hoy).  La anotaci√≥n @JvmName le permite especificar cualquier nombre que queramos (naturalmente soportado por Java).  A√±√°delo: <br><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@JvmStatic</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hasPlugins <span class="hljs-meta"><span class="hljs-meta">@JvmName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hasPlugin"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = plugins.isNotEmpty()</code> </pre><br>  Veamos qu√© obtuvimos en Java: el m√©todo getHasPlugins ya no est√° all√≠, pero hasPlugins es algo por s√≠ mismo.  Esto resolvi√≥ nuestro problema, nuevamente, con una anotaci√≥n.  ¬°Ahora resolvemos todas las anotaciones! <br><br>  Como puede ver, aqu√≠ ponemos la anotaci√≥n directamente en el captador.  ¬øCu√°l es la raz√≥n de esto?  Con el hecho de que debajo de la propiedad hay mucho de todo, y no est√° claro a qu√© se aplica @JvmName.  Si transfiere la anotaci√≥n a val hasPlugins, el compilador no entender√° a qu√© aplicarla. <br><br>  Sin embargo, Kotlin tambi√©n tiene la capacidad de especificar d√≥nde se usan las anotaciones directamente en √©l.  Puede especificar el getter de destino, el archivo completo, el par√°metro, el delegado, el campo, las propiedades, las funciones de extensi√≥n del receptor, el setter y el par√°metro setter.  En nuestro caso, getter es interesante.  Y si te gusta esto, tendr√° el mismo efecto que cuando colgamos la anotaci√≥n en get: <br><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@get:JvmName</span></span>(<span class="hljs-string"><span class="hljs-string">"hasPlugins"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@JvmStatic</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hasPlugins <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = plugins.isNotEmpty()</code> </pre><br>  En consecuencia, si no tiene un captador personalizado, puede adjuntarlo directamente a su propiedad, y todo estar√° bien. <br><br>  El siguiente punto que nos confunde un poco es "Analytics.INSTANCE.getEMPTY_PLUGIN ()".  Aqu√≠ el asunto ya no es ni siquiera en ingl√©s, sino simplemente: ¬øPOR QU√â?  La respuesta es casi la misma, pero primero una peque√±a introducci√≥n. <br><br>  Para hacer un campo constante, tiene dos formas.  Si define una constante como un tipo primitivo o como una Cadena, y tambi√©n dentro del objeto, entonces puede usar la palabra clave const, y luego no se generar√°n getter-setters y otras cosas.  Ser√° una constante ordinaria, est√°tica final privada, y estar√° en l√≠nea, es decir, una cosa Java absolutamente ordinaria. <br><br>  Pero si desea hacer una constante de un objeto que sea diferente de la cadena, entonces no podr√° usar la palabra const para esto.  Aqu√≠ tenemos val EMPTY_PLUGIN = EmptyPlugin (), de acuerdo con eso, obviamente se gener√≥ ese captador terrible.  Podemos renombrar @JvmName con una anotaci√≥n, eliminar este prefijo get, pero a√∫n as√≠ sigue siendo un m√©todo, entre par√©ntesis.  Entonces, las soluciones antiguas no funcionar√°n, estamos buscando nuevas. <br><br>  Y aqu√≠ para esto la anotaci√≥n @JvmField, que dice: "No quiero getters aqu√≠, no quiero setters, hazme un campo".  P√≥ngalo delante de val EMPTY_PLUGIN y verifique que todo sea cierto. <br><br><img src="https://habrastorage.org/webt/7e/ei/0i/7eei0iwsgrd3pvkg_6lljoylhzm.png"><br><br>  Kotlin Bytecode Viewer muestra la pieza resaltada en la que se encuentra actualmente en el archivo.  Ahora estamos parados en EMPTY_PLUGIN, y ve que aqu√≠ se escribe alg√∫n tipo de inicializaci√≥n en el constructor.  El hecho es que el captador ya no est√° all√≠ y el acceso a √©l es solo para grabar.  Y si hace clic en descompilar, vemos que ha aparecido "public static final EmptyPlugin EMPTY_PLUGIN", esto es exactamente lo que hemos logrado.  Agradable  Verificamos que todo complace a todos, en particular al compilador.  Lo m√°s importante que necesita para apaciguar es el compilador. <br><br><h2>  Gen√©ricos </h2><br>  Tomemos un descanso del c√≥digo y veamos los gen√©ricos.  Este es un tema muy candente.  O resbaladizo, a quien ya no le gusta eso.  Java tiene sus propias complejidades, pero Kotlin es diferente.  En primer lugar, nos preocupa la variaci√≥n.  Que es esto <br><br>  La variabilidad es una forma de transferir informaci√≥n sobre una jerarqu√≠a de tipos de tipos b√°sicos a derivados, por ejemplo, a contenedores o gen√©ricos.  Aqu√≠ tenemos las clases de animales y perros con una conexi√≥n muy obvia: el perro es un subtipo, el animal es un subtipo, la flecha proviene del subtipo. <br><br><img src="https://habrastorage.org/webt/rz/-b/uz/rz-buzyeywt0xgwewjvauwmf0lc.png"><br><br>  ¬øY qu√© conexi√≥n tendr√°n sus derivados?  Veamos algunos casos. <br><br>  El primero es Iterator.  Para determinar qu√© es un subtipo y qu√© es un subtipo, nos guiaremos por la regla de sustituci√≥n Barbara Liskov.  Se puede formular de la siguiente manera: "el subtipo no deber√≠a requerir m√°s y no proporcionar menos". <br><br>  En nuestra situaci√≥n, lo √∫nico que hace Iterator es darnos objetos mecanografiados, por ejemplo, Animal.  Si aceptamos Iterator en alg√∫n lugar, podemos poner a Iterator all√≠ y obtener Animal del siguiente m√©todo (), porque el perro tambi√©n es Animal.  Proporcionamos no menos, sino m√°s, porque un perro es un subtipo. <br><br><img src="https://habrastorage.org/webt/bz/4e/ra/bz4eracdjm_ep_qnzk0mbkr5q7w.png"><br><br>  Repito: solo estamos leyendo de este tipo, por lo tanto, la relaci√≥n entre el tipo y el subtipo se conserva aqu√≠.  Y estos tipos se llaman covariantes. <br><br>  Otro caso: acci√≥n.  Action es una funci√≥n que no devuelve nada, toma un par√°metro y solo escribimos en Action, es decir, nos quita un perro o un animal. <br><br><img src="https://habrastorage.org/webt/h5/hg/74/h5hg74k6id9rwtzfq1j2g1qsjyk.png"><br><br>  Por lo tanto, aqu√≠ ya no proporcionamos, sino que exigimos, y no debemos exigir m√°s.  Esto significa que nuestra dependencia est√° cambiando.  "No m√°s" tenemos Animal (Animal menos que un perro).  Y tales tipos se llaman contravariantes. <br><br>  Hay un tercer caso, por ejemplo, ArrayList, del cual leemos y escribimos.  Por lo tanto, en este caso, violamos una de las reglas, requerimos m√°s para un registro (un perro, no un animal).  Tales tipos no est√°n relacionados de ninguna manera, y se llaman invariantes. <br><br><img src="https://habrastorage.org/webt/gj/5o/gp/gj5ogpkqy1ifvtmxghqszew7fgk.png"><br><br>  Entonces, en Java, cuando se dise√±√≥ antes de la versi√≥n 1.5 (donde aparec√≠an los gen√©ricos), por defecto hicieron que las matrices fueran covariantes.  Esto significa que puede asignar una matriz de cadenas a la matriz de objetos, luego pasarla en alg√∫n lugar al m√©todo donde se necesita la matriz de objetos e intentar empujar el objeto all√≠, aunque esta es una matriz de cadenas.  Todo te caer√° a ti. <br><br>  Habiendo aprendido por amarga experiencia que esto no se puede hacer, al dise√±ar gen√©ricos, decidieron "haremos que las colecciones sean invariables, no haremos nada con ellas". <br><br>  Y al final resulta que en una cosa tan aparentemente obvia todo deber√≠a estar bien, pero en realidad no est√° bien: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Java List&lt;Dog&gt; dogs = new ArrayList&lt;&gt;(); List&lt;Animal&gt; animals = dogs;</span></span></code> </pre><br>  Pero necesitamos determinar de alguna manera qu√©, despu√©s de todo, podemos: si solo estamos leyendo esta hoja, ¬øpor qu√© no hacer posible transferir la lista de perros aqu√≠?  Por lo tanto, es posible caracterizar con comod√≠n qu√© tipo de variaci√≥n tendr√° este tipo: <br><br><pre> <code class="java hljs">List&lt;Dog&gt; dogs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); List&lt;? extends Animal&gt; animals = dogs;</code> </pre><br>  Como puede ver, esta variaci√≥n se indica en el lugar de uso, donde asignamos los perros.  Por lo tanto, esto se llama variaci√≥n de sitio de uso. <br><br>  ¬øCu√°les son las desventajas de esto?  El lado negativo es que debe especificar estos comodines de miedo donde sea que use su API, y todo esto es muy fruct√≠fero en el c√≥digo.  Pero en Kotlin por alguna raz√≥n, tal cosa funciona de forma inmediata, y no necesita especificar nada: <br><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dogs: <span class="hljs-type"><span class="hljs-type">List</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Dog</span></span>&gt; = <span class="hljs-type"><span class="hljs-type">ArrayList</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> animals: <span class="hljs-type"><span class="hljs-type">List</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Animal</span></span>&gt; = dogs</code> </pre><br>  ¬øCu√°l es la raz√≥n de esto?  Con el hecho de que las s√°banas son realmente diferentes.  Lista en Java significa escritura, mientras que en Kotlin es de solo lectura, no implica.  Por lo tanto, en principio, podemos decir de inmediato que solo estamos leyendo desde aqu√≠, por lo tanto, podemos ser covariantes.  Y esto se establece precisamente en la declaraci√≥n de tipo con la palabra clave out reemplazando el comod√≠n: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">List</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">out E</span></span></span><span class="hljs-class">&gt; : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Collection</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">E</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br>  Esto se llama varianza del sitio de declaraci√≥n.  Por lo tanto, indicamos todo en un solo lugar, y donde lo usamos, ya no tocamos este tema.  Y esto es nishtyak. <br><br><h2>  Volver al c√≥digo </h2><br>  Volvamos a nuestras profundidades.  Aqu√≠ tenemos el m√©todo addPlugins, se necesita una Lista: <br><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@JvmStatic</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPlugins</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(plugs: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Plugin</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { plugs.forEach { addPlugin(it) } }    ,  , List&lt;EmptyPlugin&gt;, ,     : &lt;source lang=<span class="hljs-string"><span class="hljs-string">"java"</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> List&lt;EmptyPlugin&gt; pluginsToSet = Arrays.asList(new LoggerPlugin(<span class="hljs-string"><span class="hljs-string">"Alog"</span></span>), new SegmentPlugin());</code> </pre><br>  Debido al hecho de que List en Kotlin es covariante, podemos pasar f√°cilmente la lista de herederos de plugins aqu√≠.  Todo funcionar√°, al compilador no le importa.  Pero debido al hecho de que tenemos una variaci√≥n del sitio de declaraci√≥n donde especificamos todo, no podemos controlar la conexi√≥n con Java en la etapa de uso.  Pero, ¬øqu√© sucede si realmente queremos una hoja de complementos all√≠, no queremos herederos all√≠?  No hay modificadores para esto, pero ¬øqu√©?  As√≠ es, hay una anotaci√≥n.  Y la anotaci√≥n se llama @JvmSuppressWildcards, es decir, por defecto creemos que aqu√≠ hay un tipo con comod√≠n, el tipo es covariante. <br><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@JvmStatic</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPlugins</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(plugs: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;@</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">JvmSuppressWildcards</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Plugin</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { plugs.forEach { addPlugin(it) } }</code> </pre><br>  Hablando SuppressWildcards, suprimimos todas estas preguntas, y nuestra firma realmente cambia.  Incluso m√°s que eso, te mostrar√© c√≥mo se ve todo en bytecode: <br><br><img src="https://habrastorage.org/webt/rn/xp/ft/rnxpft1zqpioojczpiiyn1g3veo.png"><br><br>  Eliminar√© la anotaci√≥n del c√≥digo por ahora.  Aqu√≠ est√° nuestro m√©todo.  Probablemente sepa que existe ese tipo de borrado.  Y en su c√≥digo de bytes no hay informaci√≥n sobre qu√© tipo de preguntas hubo, bueno, gen√©ricos en general.  Pero el compilador sigue esto y lo firma en los comentarios al c√≥digo de bytes: y este es el tipo con la pregunta. <br><br><img src="https://habrastorage.org/webt/u4/5e/mm/u45emmdne71zx9e9whz7uu8law0.png"><br><br>  Ahora volvemos a insertar la anotaci√≥n y vemos que este es nuestro tipo sin cuestionarnos. <br><br><img src="https://habrastorage.org/webt/cu/if/wm/cuifwmem7zn636x3ky7n_41vuly.png"><br><br>  Ahora nuestro c√≥digo anterior dejar√° de compilarse precisamente porque cortamos los comodines.  Puedes verlo por ti mismo. <br><br>  Identificamos tipos covariantes.  Ahora lo contrario es cierto. <br><br>  Creemos que List tiene una pregunta.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es obvio suponer que cuando esta hoja regrese de getPlugins, tambi√©n ser√° con una pregunta. ¬øQu√© significa esto? Esto significa que no podremos escribir en √©l, porque el tipo es covariante y no contravariante. Echemos un vistazo a lo que est√° sucediendo en Java.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> List&lt;Plugin&gt; plugins = Analytics.getPlugins(); displayPlugins(plugins); Analytics.getPlugins().add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmptyPlugin());</code> </pre><br>   ,      - ,   ,  -   .    ,      .     ,   -  . <br><br>     . Kotlin  ,   , ,    ,  ,    wildcards  Java. ,       ,     .   ,    List,         Plugin.   ,   , ,     :    Plugin,     . <br><br>       .    ,        ,      usecase,      - ,     . <br><br>      ,      ,     ,     - .     ,       Java.  Kotlin  List ‚Äî  read only-,       ,       Java      ‚Äî   ?    ,     List  wildcard.      , .   @JvmWildcard  :     ,   .  ,    Java   . Java  ¬´  ?¬ª: <br><br><img src="https://habrastorage.org/webt/su/v_/1r/suv_1rnnuub7bsqlod-oglgra74.png"><br><br>         List&lt;? extends Plugin&gt;,      ¬´  ?¬ª ,  ,      .   script kiddie,   ¬´   ,   ,  ,   ArrayList,    ¬ª.   ,     ArrayList   ,    . <br><br><pre> <code class="java hljs">((ArrayList&lt;Plugin&gt;) Analytics.getPlugins()).add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmptyPlugin());</code> </pre><br> , ,   ,      defensive-,  - . ,   ,   ,  script kiddies   . <br><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@JvmStatic</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPlugins</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;<span class="hljs-meta"><span class="hljs-meta">@JvmWildcard</span></span> Plugin&gt; = plugin.toImmutableList()</code> </pre><br>  ,   @JvmSuppressWildcard     ,       ,    ,     ,     . <br><br>    ,     .    ,     : . <br><br>       Java.   ,    : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull Event event)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException</span></span></code> </pre><br>    : <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plugin</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> IOException if sending failed */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Event</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br>  Kotlin   checked exception.     :   .    , , .  Java   -. : ¬´  Throws -   , ¬ª: <br><br><img src="https://habrastorage.org/webt/g-/v8/go/g-v8gog8gwfa-on0anv0bkwktsk.png"><br><br>    -,   Kotlin? ,   ‚Ä¶ <br><br>   @Throws,     .   throws-   .  ,     IOExeption: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmptyPlugin</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Plugin { @Throws</span></span></span></span>(IOException::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">override</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">send</span></span></span></span>(event: Event) {} <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br>        : <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plugin</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> IOException if sending failed */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Throws(IOException::class)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Event</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br>   ?   ,   Java,       exception,  .  , .  ,     - ,      ,   @JvmName.  . <br><br>       ,   Java  .   ‚Ä¶ <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> util <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> List</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;Int&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printReversedSum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { println(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.foldRight(<span class="hljs-number"><span class="hljs-number">0</span></span>) { it, acc -&gt; it + acc }) } <span class="hljs-meta"><span class="hljs-meta">@JvmName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"printReversedConcatenation"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> List</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;String&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printReversedSum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { println(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.foldRight(StringBuilder()) { it, acc -&gt; acc.append(it) }) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supongamos que en Java no nos importa aqu√≠, elimine la anotaci√≥n. Errores, ahora el IDE muestra un error en ambas funciones. ¬øCu√°l crees que es la raz√≥n de esto? S√≠, sin anotaciones, se generan con el mismo nombre, pero aqu√≠ est√° escrito que uno est√° en la Lista, el otro en la Lista. Derecha, tipo borrado. Incluso podemos verificar este caso:</font></font><br><br><img src="https://habrastorage.org/webt/qk/oq/jr/qkoqjrub5xc4mdn-twq-s_jehl4.png"><br><br>    ,   ,   top-level     c.         printReversedSum  List,       List.   Kotlin-   ,  Java-  .    ,     kotlin.jvm    ,   Java    ,   ,   Kotlin .    ‚Äî    ,   concatenation ‚Äî    ,   . <br><br>   .     .    extension- reverse. <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> String.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reverse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = StringBuilder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).reverse().toString() <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-type"><span class="hljs-keyword">reified</span></span></span></span><span class="hljs-function"><span class="hljs-type"> T&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reversedClassName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = T::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">simpleName</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reverse</span></span></span></span>() <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> Iterable</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forEachReversed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (element <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.reversed()) action(element) }</code> </pre><br>  reverse     ,   ReverserKt. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useUtils</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(ReverserKt.reverse(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>)); SumsKt.printReversedSum(asList(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)); SumsKt.printReversedConcatenation(asList(<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-string"><span class="hljs-string">"5"</span></span>)); }</code> </pre><br> ,  ,    .   ,  ,     Java,   - .              .     ?   ,  @JvmName,     ,    . <br><br>      ,  ,  ,   ,       ,     . <br><br><pre> <code class="hljs ruby">@file<span class="hljs-symbol"><span class="hljs-symbol">:Suppress</span></span>(<span class="hljs-string"><span class="hljs-string">"NOTHING_TO_INLINE"</span></span>) @file<span class="hljs-symbol"><span class="hljs-symbol">:JvmName</span></span>(<span class="hljs-string"><span class="hljs-string">"ReverserUtils"</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora al compilador de Java no le gusta ReverserKt, pero se espera que lo reemplacemos con ReverserUtils y todos est√©n contentos. Y este "caso de usuario 2.1" es un caso frecuente cuando desea recopilar varios de sus m√©todos de archivos de nivel superior en una clase, en una fachada. Por ejemplo, sobre usted, no desea que los m√©todos de los sums.kt anteriores se invoquen desde SumsKt, pero desea que esto se trate de revertir y contraer desde ReverserUtils. Luego agregamos esta maravillosa anotaci√≥n @JvmName all√≠, escriba "ReverserUtils", en principio, todo est√° bien, incluso puede intentar compilar esto, pero no.</font></font><br><br>     ,      ,  ¬´          , -¬ª.   ?       @JvmMultifileClass, ,         ,        . <br><br>     "@file:JvmMultifileClass",    SumsKt  ReverserUtils,   ‚Äî  .   ! <br><br>       ,   .  ,     ,    .   ,  , , @JvmName     Kotlin. <br><br><h2> Kotlin- </h2><br> ,     ,     .   ,    Kotlin- . <br><br> , inline-.   Kotlin  ,  ,        Java  ? , ,   ,      Java.    , , Kotlin-only ,        dex count limit.    Kotlin   ,     . <br><br>    Reified type parameters.     Kotlin,     -     ,   Java   .    Kotlin-only ,     Kotlin,   Java       reified,  . <br><br> java.lang.Class.     ,      Java,     .   .     ¬´ Retrofit¬ª,     (   ,     ): <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Retrofit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> baseUrl: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> client: Client ) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T : Any&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(service: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>: T {...} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T : Any&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(service: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KClass</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> create(service.java) } }</code> </pre><br>  ,     Java,  ,     KClass,       ,    extension-,   KClass  Class,  Class  KClass (  Kotlin,   ). <br><br>    ,    .  Kotlin-    KClass,     Reified-,       : <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-type"><span class="hljs-keyword">reified</span></span></span></span><span class="hljs-function"><span class="hljs-type"> T : Any&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> create(T::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  .    Kotlin  ,    .  <i>val api = retrofit.create(Api::class)</i>   <i>val api = retrofit.create&lt;Api&gt;()</i> ,   ::class  .    Reified-,    -. <br><br> Unit.     Unit,      ,   void  Java,  .      .       ,       .  -   Scala,   Scala      ,   - ,       ,    ,    void. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero en Kotlin esto no es. </font><font style="vertical-align: inherit;">Kotlin tiene solo 22 interfaces que aceptan un conjunto diferente de par√°metros y devuelven algo. </font><font style="vertical-align: inherit;">Por lo tanto, la lambda que devuelve Unidad no devolver√° nada, sino Unidad. </font><font style="vertical-align: inherit;">Y esto impone sus limitaciones. </font><font style="vertical-align: inherit;">¬øC√≥mo se ve la lambda que devuelve la Unidad? </font><font style="vertical-align: inherit;">Ahora, m√≠rala en este fragmento de c√≥digo. </font><font style="vertical-align: inherit;">Llegar a conocerse.</font></font><br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> Iterable</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forEachReversed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (element <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.reversed()) action(element) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Utiliz√°ndolo desde Kotlin: todo est√° bien, incluso utilizamos una referencia de m√©todo, si podemos, y se lee perfectamente, nuestros ojos no son insensibles. </font></font><br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useMisc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { listOf(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>).forEachReversed(::println) println(reversedClassName&lt;String&gt;()) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© est√° pasando en Java? </font><font style="vertical-align: inherit;">En Java, sucede la siguiente canoa:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useMisc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> List&lt;Integer&gt; list = asList(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>); ReverserUtils.forEachReversed(list, integer -&gt; { System.out.println(integer); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Unit.INSTANCE; });</code> </pre><br> - ,     - .   Void   ,         .       ,   void,  .  , ,   ,          .  ,     Unit .  null,      .  ,     . <br><br>  : Typealiases ‚Äî     ,     ,     Kotlin,   Java,  ,    ,    .      ,  -  . Java-    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora para la parte interesante: visibilidad. O m√°s bien, visibilidad interna. Probablemente sepa que en Kotlin no hay paquete privado, si escribe sin modificadores, ser√° p√∫blico. Pero hay interna. Lo interno es algo tan complicado que incluso lo veremos ahora. En Retrofit, tenemos un m√©todo de validaci√≥n interno.</font></font><br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Retrofit { println(<span class="hljs-string"><span class="hljs-string">"!!!!!! internal fun validate() was called !!!!!!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> }</code> </pre><br>       Kotlin,   .    Java?     validate? ,    ,  internal   public.     ,  Kotlin bytecode viewer. <br><br><img src="https://habrastorage.org/webt/cc/mr/ts/ccmrtst8oqwmbdvgn4onk8jlrus.png"><br><br>   public,     ,   ,  , ,     ,    API    .   -   80  ,          . <br><br>  Java    : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Api api = retrofit .validate$production_sources_for_module_library_main() .create(Api.class); api.sendMessage(<span class="hljs-string"><span class="hljs-string">"Hello from Java"</span></span>); }</code> </pre><br>     . ,   ,   ,  .      ,  let me explain this to you. ,     ? <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Api api = retrofit .validate$library() .create(Api.class); api.sendMessage(<span class="hljs-string"><span class="hljs-string">"Hello from Java"</span></span>); }</code> </pre><br>  .    ¬´ ?¬ª    ‚Ä¶ MAGIC! <br><br>   ,    -   internal,  ,        API.   script kiddie   Kotlin Bytecode Viewer,   .         internal visibility. <br><br>      ,    .         ,     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> ,   ,     SkillsMatter.  . <br><br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>        ,     Kotlin-.    , -  ,     .    Kotlin bytecode viewer   . <br><br>  Gracias <br><br><blockquote>   ,  : 8-9      <b>Mobius</b> ,      .      ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> ,      . <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es417951/">https://habr.com/ru/post/es417951/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es417941/index.html">¬øD√≥nde desaparece el agua en la tetera?</a></li>
<li><a href="../es417943/index.html">Sin servidor y React 2: juego de manos y sin fraude</a></li>
<li><a href="../es417945/index.html">¬øQu√© herramientas tiene la sonda solar Parker?</a></li>
<li><a href="../es417947/index.html">Visualizaci√≥n de datos para su proyecto web.</a></li>
<li><a href="../es417949/index.html">¬øC√≥mo escrib√≠ la biblioteca est√°ndar de C ++ 11 o por qu√© boost es tan aterrador? Cap√≠tulo 4.2</a></li>
<li><a href="../es417953/index.html">Tendencias en el dise√±o de FPGA. Traducci√≥n</a></li>
<li><a href="../es417955/index.html">C√≥mo convertirse en un dise√±ador de interfaces. Habilidades necesarias y herramientas poderosas de las que no se nos informa</a></li>
<li><a href="../es417957/index.html">Webinar abierto Mecanismos de contenedorizaci√≥n de Linux</a></li>
<li><a href="../es417959/index.html">10 consejos de dise√±o de interfaz</a></li>
<li><a href="../es417963/index.html">Viento, langosta y fecha l√≠mite: c√≥mo construimos la subestaci√≥n el√©ctrica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>