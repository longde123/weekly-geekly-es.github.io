<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèæ üÜñ üï¥Ô∏è Wof√ºr sollen wir ein CDN bauen? üëßüèª üöë üçë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! In diesem Artikel werden wir unser eigenes CDN erstellen. Warum nicht vorgefertigte L√∂sungen verwenden? Da die Website des Autors vollst√§n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wof√ºr sollen wir ein CDN bauen?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/466447/"> Hallo Habr!  In diesem Artikel werden wir unser eigenes CDN erstellen.  Warum nicht vorgefertigte L√∂sungen verwenden?  Da die Website des Autors vollst√§ndig statisch ist und auf Jekyll erstellt wurde, mit gro√üen Bildern, die so schnell wie m√∂glich bereitgestellt werden m√ºssen.  Der Server sollte nicht zwischengespeichert werden, er sollte die gesamte Site speichern, HTTP / 2 und Brotli unterst√ºtzen und auf allen Servern sollte dasselbe Zertifikat installiert sein. <br><br>  Wir werden alles auch auf IIS ausf√ºhren, das unter Windows Server 2019 Core ausgef√ºhrt wird. <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/jd/-8/bh/jd-8bhr2bkenojiyts1op3nxdr0.jpeg"></a> </div><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Kurz zur Umsetzung</font> </h2><br>  An den Endknoten werden wir die in das Betriebssystem eingebauten Mittel verwalten, die wir ben√∂tigen: <br><br><ol><li>  Active Directory </li><li>  Dfs </li><li>  IIS </li><li>  Winacme </li><li>  RSAT </li></ol><br>  Optional, aber empfohlen: <br><br><ol><li>  Windows Admin Center </li></ol><br>  Auf Sites mit Sites werden nur IIS und DFS ben√∂tigt, Active Directory ist erforderlich, es ist f√ºr DFS erforderlich, das den Inhalt der Site zwischen Servern synchronisiert.  RSAT wird zum Verwalten von Komponenten ben√∂tigt, und Windows Admin Center wird zum Bearbeiten der Registrierung ben√∂tigt.  Dies kann auch durch Powershell geschehen, auf das ich auch eingehen werde. <br><br>  Die Domain des Autors hei√üt ***. ***. Wtf (bitte keine Angst), und die Server sind nach Rechenzentren benannt und haben Namen der Form cache-zur1, cahe-ru usw.  AD wird bereitgestellt und Server sind damit verbunden.  Jetzt in Ordnung. <br><br><h2>  <font color="#3AC1EF">Punktauswahl</font> </h2><br>  RUVDS verf√ºgt √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">8 Rechenzentren</a> - 3 in Europa und 5 in Russland.  Meine Wahl fiel auf Rucloud in Moskau und LD8 (die in London).  Rucloud, weil es sich fast nicht von der M9 unterscheidet, und durch London gibt es ein transkontinentales Kabel in die USA, also ist es in Europa ein Muss.  F√ºr eine engere Verteilung in Europa k√∂nnen Sie die Schweiz oder Deutschland w√§hlen - dies k√∂nnen Sie im Allgemeinen stoppen. <br><br><h2>  <font color="#3AC1EF">Ausw√§hlen eines DNS-GeoIP</font> </h2><br>  Wenn der Client an die Site klopft, wie kann man dann verstehen, welcher Server die Daten an ihn √ºbertragen soll?  Nat√ºrlich mit DNS.  Das hei√üt, abh√§ngig von der IP-Adresse desjenigen, der das DNS adressiert hat, wird eine relevante Antwort gegeben. <br><br>  Wir k√∂nnen unser eigenes DNS (BIND mit einem Plugin f√ºr Maxmind) oder eine schl√ºsselfertige L√∂sung (Route53) verwenden.  Ein Abonnement f√ºr Maxmind GeoIP-Datenbanken kostet 25 USD pro Monat und Route53 kostet 0,50 USD pro Domainzone plus einen Cent, wenn Sie eine Million Anfragen stellen.  Dar√ºber hinaus ist es das Letzte, einen weiteren Punkt zur Verst√§rkung von DDoS-Angriffen zu schaffen. Daher fiel meine Wahl auf Route53. <br><br>  Dieser Artikel handelt von CDN f√ºr Europa;  Wenn Sie ein CDN f√ºr Russland ben√∂tigen, liegt die Wahl f√ºr Ihr eigenes DNS auf der Hand, da Route53 das Routing nach Land und nicht nach Stadt erm√∂glicht. <br>  Microsoft verf√ºgt √ºber √§hnliche Dienste (Azure Traffic Manager). <br><br><h2>  <font color="#3AC1EF">1. Installieren Sie IIS</font> </h2><br>  <b>1.1.</b>  <b>IIS-Installation</b> <br><br>  Wir installieren die Basiskomponenten von IIS, die Komponente f√ºr die Unterst√ºtzung zentraler Zertifikate, und auf dem Hauptserver zus√§tzliche Unterst√ºtzung f√ºr die Remoteverwaltung.  Diese Komponente wird nur f√ºr einen Server ben√∂tigt. Sie k√∂nnen andere Server nicht verwalten, wenn Sie gemeinsam genutzte Konfigurationen aktivieren, selbst wenn die Remoteverwaltung konfiguriert wurde. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f09/d98/c66/f09d98c6665d1e5106436c0fd9fc258d.png"><br><br>  √úber Powershell: <br><br><pre><code class="plaintext hljs">Install-WindowsFeature Web-Server, Web-CertProvider</code> </pre> <br>  Auf dem Hauptserver m√ºssen Sie zus√§tzlich installieren: <br><br><pre> <code class="plaintext hljs">Install-WindowsFeature Web-Mgmt-Service</code> </pre> <br>  <b>1.1.1 Fernbedienung einschalten</b> <br><br>  Damit wir den IIS-Server remote verwalten k√∂nnen, m√ºssen wir den IIS-Remoteverwaltungsdienst erh√∂hen.  Starten Sie auf dem Hauptserver den Dienst: <br><br><pre> <code class="plaintext hljs">start-service WMSVC set-service -Name WMSVC -StartupType Automatic</code> </pre> <br>  Und jetzt bieten wir die M√∂glichkeit, als solche √ºber die Registrierung zu verwalten. <br><br><pre> <code class="plaintext hljs">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WebManagement\Server</code> </pre> <br>  Der einfachste Weg, die Registrierung zu verwalten, ist nat√ºrlich das Windows Admin Center. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fd/9cb/7b1/8fd9cb7b19b7523283885d61564eb920.png"><br><br>  Dies kann aber auch √ºber Powershell erfolgen: <br><br><pre> <code class="plaintext hljs">Set-Itemproperty -path "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WebManagement\Server" -Name "EnableRemoteManagement" -value "1"</code> </pre> <br>  In Windows Server 2012 und 2016 steigt die Firewall-Regel nicht von selbst an. Sie m√ºssen die Firewall bearbeiten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c7/13e/d35/8c713ed356d5418549cdc602c62e3161.png"><br><br><pre> <code class="plaintext hljs">Set-NetFirewallRule -Name IIS-WebServerRole-WMSVC-In-TCP -Enabled True</code> </pre> <br>  √úberpr√ºfen Sie, ob es gestiegen ist: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/929/121/aa3/929121aa33cdffa49494d791b583da7f.png"><br><br><pre> <code class="plaintext hljs">Test-NetConnection 8.8.8.8 -port 8172</code> </pre> <br>  Drei √Ñnderungen an drei verschiedenen Stellen, und jetzt k√∂nnen wir √ºber den IIS-Manager eine Verbindung zu unserem Server herstellen, indem wir einen anderen Server mit einem Desktop verwenden.  Dies diente nur der Bequemlichkeit der nachfolgenden Verwaltung. <br><br>  <b>1.2 Wir haben die Zentralisierung von Konfigurationen abgeschnitten</b> <br><br>  In IIS Manager gibt es keine Schaltfl√§chen zum Installieren zentraler Konfigurationen und Zertifikate. Sie befinden sich nur im lokalen Server-Manager. F√ºr Server Core m√ºssen Sie also alles √ºber Powershell erledigen. <br><br>  Die Zentralisierung von Konfigurationen und Zertifikaten erfolgt √ºber KMU.  Aus diesem Grund habe ich zwei entrechtete Benutzer (getrennt f√ºr Konfigurationen und getrennt f√ºr Zertifikate) erstellt, die nur Lesezugriff auf ihren Ordner haben, und sie certadmin und configadmin genannt. <br><br>  Es ist ratsam, dass Benutzer lokal auf dem Hauptserver sind. Wenn Ihr Dom√§nencontroller stirbt, sterben Anwendungen, die im Namen des Dom√§nenbenutzers √ºber SMB an der Konfiguration und den Zertifikaten festhalten.  Die Verwendung lokaler Benutzer beseitigt diese Situation. <br><br>  <b>1.2.1 Erstellen eines freigegebenen Ordners</b> <br><br>  Auf einem der Server sollten zwei √∂ffentliche Ordner gespeichert werden, von denen wir die Konfiguration und die Zertifikate erhalten.  Als Pfad zum freigegebenen Ordner verwenden wir den Standardpfad zu den IIS-Konfigurationen: <br><br><pre> <code class="plaintext hljs">New-SmbShare -ReadAccess configadmin@**.**wtf -Path C:\windows\System32\Inetsrv\Config -Name sharedconfigs</code> </pre> <br>  Und f√ºr Zertifikate k√∂nnen wir jedes ausw√§hlen.  Ich habe sie in einem Ordner mit IIS abgelegt. <br><br><pre> <code class="plaintext hljs">New-SmbShare -Path C:\inetpub\centralizedcerts -Name sharedconfigs -ReadAccess configadmin</code> </pre> <br>  <b>1.2.2 Wir verbinden Knoten mit Konfigurationen</b> <br><br>  Die Einstellungen m√ºssen nur f√ºr die Server vorgenommen werden, die diese Konfiguration lesen.  Mein Hauptserver unter dem Namen cache-ru wird der Kopf sein, also habe ich auf den anderen beiden konfiguriert. <br>  Geben Sie das Passwort des Benutzers ein, der Zugriff auf den Ordner hat: <br><br><pre> <code class="plaintext hljs">$pass = Read-Host -AsSecureString Enable-IISSharedConfig -PhysicalPath \\cache-ru.**.**wtf\SharedConfig -UserName configadmin@**.**wtf -Password $pass -DontCopyRemoteKeys</code> </pre> <br>  Unmittelbar nach dem Eintritt sollte eine neue Sitzung ge√∂ffnet werden.  Um zu √ºberpr√ºfen, ob alles funktioniert hat, k√∂nnen Sie RSAT ‚Üí Computerverwaltung ‚Üí Freigegebene Ordner ‚Üí Sitzungen √∂ffnen.  Wir sehen Benutzersitzungen und die IP-Adresse des Servers, der unter diesem Benutzer den freigegebenen Ordner liest.  Auf der Client-Seite wird dies vom Cmdlet √ºberpr√ºft: <br><br><pre> <code class="plaintext hljs">Get-IISSharedConfig</code> </pre> <br>  So sah es f√ºr mich aus: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/459/bc9/857/459bc9857540abe84a63229992b7d3dd.png"><br><br>  <b>1.2.2 Knoten mit Zertifikaten verbinden</b> <br><br>  Die n√§chste Zeile kann nur direkt eingegeben werden, da eine direkte Verbindung zum Desktop mit Server mit einer grafischen Benutzeroberfl√§che besteht. Sie funktioniert nicht auf Server Core. <br><br><pre> <code class="plaintext hljs">$pass = Read-Host -AsSecureString Enable-IISCentralCertProvider -CertStoreLocation \\cache-ru.**.**wtf\centralizedcerts -UserName certadmin@**.**wtf -Password $pass</code> </pre> <br>  Wenn Sie versuchen, es √ºber Winrm einzugeben, wird die folgende Ausgabe angezeigt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85f/e1b/c76/85fe1bc7691f4a7c4765560e4d62a2f8.png"><br><br>  Um dies remote zu tun, m√ºssen Sie die Registrierung bearbeiten.  Wie bequem!  Wir fliegen ein: <br><br><pre> <code class="plaintext hljs">HKLM:\SOFTWARE\Microsoft\IIS\CentralCertProvider\</code> </pre> <br>  Erstellen Sie ein 32-Bit-DWORD "Aktiviert" mit dem Parameter "1": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/06c/ba1/e1e/06cba1e1e6dd5af05cc7f9d0279e138f.png"><br><br><pre> <code class="plaintext hljs">Set-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\IIS\CentralCertProvider\ -Name Enabled -Value 1</code> </pre> <br>  Dann erstellen wir den String-Wert CertStoreLocation mit dem Parameter \\ cache-ru. **. ** wtf \ centralizedcerts: <br><br><pre> <code class="plaintext hljs">Set-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\IIS\CentralCertProvider\ -Name CertStoreLocation -Value &lt;a href="about:blank"&gt;\\cache-ru.**.**wtf\centralizedcerts&lt;/a&gt;</code> </pre> <br>  Um zu √ºberpr√ºfen, ob alles in Ordnung ist, verwenden wir: <br><br><pre> <code class="plaintext hljs">Get-IISCentralCertProvider</code> </pre> <br>  Die Ausgabe sollte folgenderma√üen aussehen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c8b/dd6/48d/c8bdd648d8d5f147c8bd28d1bad9cfc0.png"><br><br>  Und erst danach treten wir ein: <br><br><pre> <code class="plaintext hljs">$pass = Read-Host -AsSecureString Set-IISCentralCertProvider -UserName certadmin@**.**wtf -Password $pass</code> </pre> <br>  √úberpr√ºfen Sie erneut: <br><br><pre> <code class="plaintext hljs">Get-IISCentralCertProvider</code> </pre> <br>  Alles aus der Box hei√üt.  Im Gegensatz zu herk√∂mmlichen Konfigurationen erstellen zentralisierte Zertifikate keine aktive SMB-Sitzung. <br><br>  <b>1.2.3 Brotli</b> <br><br>  Laden Sie auf jedem Server die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IIS-Komprimierungsdatei</a> herunter und f√ºhren Sie sie aus <br><br><pre> <code class="plaintext hljs">Start-Process .\iiscompression_amd64.msi -ArgumentList /quiet</code> </pre> <br>  Wir haben die Konfigurationen bereits freigegeben, daher m√ºssen Sie etwas nur an einer Stelle konfigurieren.  Mit IIS Manager rufen wir den Konfigurationseditor auf dem Hauptserver auf. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/489/874/4db/4898744dbe1eea52b6bfe3c92ea5a1ad.png"><br><br><pre> <code class="plaintext hljs">system.webServer/httpCompression</code> </pre> <br>  Und setzen Sie StaticCompressionLevel f√ºr Brotli auf 11 und f√ºr Gzip auf 9, dies ist das Maximum, das sie tun k√∂nnen. <br><br>  <b>1.2.4 MIME und Header</b> <br><br>  Standardm√§√üig √ºbertr√§gt IIS den Codierungsheader nicht, weshalb das kyrillische Alphabet zu Runen wird.  Auch in MIME muss kein Eintrag im Webp-Format hinzugef√ºgt werden. <br><br>  <b>1.</b> Gehen Sie zum Dispatcher ‚Üí MIME.  Suchen Sie nach .HTML und √§ndern Sie den Typ in: text / html;  Zeichensatz = utf-8 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4c/bef/017/e4cbef017ae044d8720535ff9bdea63a.png"><br><br>  <b>2.</b> Vergessen Sie Webp nicht - Sie m√ºssen dieses MIME manuell hinzuf√ºgen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07a/b62/aec/07ab62aecf03ee9b4a32ecd4044d7a42.png"><br><br><h2>  <font color="#3AC1EF">2. Wir stellen ein Zertifikat aus</font> </h2><br>  Verwenden von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Winacme</a> .  Zun√§chst m√ºssen Sie die Dom√§nen an die Site binden. Dies kann √ºber den IIS-Manager erfolgen.  W√§hlen Sie beim Erstellen eines CDN nicht die Host√ºberpr√ºfung als aus  Probleme beginnen sofort mit der Best√§tigung des Domainbesitzes. Unsere Wahl ist die √úberpr√ºfung durch TXT-Datensatz.  Sie m√ºssen den Pfad zum Ordner mit den Zertifikaten manuell steuern und den Datensatz manuell von der Herausforderung kopieren.  Holen Sie sich jetzt Luft in Ihre Brust. <br><br>  Um nicht alles manuell zu drucken, aktivieren Sie RDP auf Server Core mit dem folgenden Befehl: <br><br><pre> <code class="plaintext hljs">cscript C:\Windows\System32\Scregedit.wsf /ar 0</code> </pre> <br>  So sieht RDP auf Server Core aus: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/856/2ea/478/8562ea478872a08964c125a8b997eae6.png"><br><br>  Nach der Herausforderung fallen die Zertifikate in den in Winacme angegebenen Ordner.  Winacme stellt die Aufgabe in den Scheduler, um das Zertifikat zu erneuern.  Installiert und vergessen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f20/8e3/d33/f208e3d33f61e407a19e1ff53e14ecde.png"><br><br>  Nun, als wir fertig sind, k√∂nnen wir RDP ausschalten - wir haben Server Core aus gutem Grund installiert und so viele Nuancen entdeckt. <br><br><pre> <code class="plaintext hljs">cscript C:\Windows\System32\Scregedit.wsf /ar 1</code> </pre> <br><h2>  <font color="#3AC1EF">3. Binden Sie das Zertifikat an die Knoten</font> </h2><br>  Jetzt m√ºssen Sie zwei weitere Knoten konfigurieren, damit HTTPS endlich funktioniert.  Zu diesem Zeitpunkt wird HTTPS auf dem Server, auf dem die Zertifikate gespeichert sind, bereits ausgef√ºhrt.  Damit der Rest anf√§ngt, an HTTPS zu arbeiten, geschieht dies im Allgemeinen √ºber netsh. <br><br>  Wie gewohnt stellen wir √ºber RDP eine Verbindung zu Windows Server Core her, um dieses Snap-In auszuf√ºhren.  Schauen Sie sich die Website von Microsoft nicht an, insbesondere nicht in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem</a> Handbuch.  Die darin enthaltenen Schritte sind falsch beschrieben. <br><br>  Wenn Sie netsh http show sslcert verwenden, m√ºssen Sie auf dem Masterknoten die Appid abrufen, die wir wie unten beschrieben eingeben: <br><br><pre> <code class="plaintext hljs">netsh http add sslcert ccs=443 appid= '{4dc3e181-e14b-4a21-b022-59fc669b0914}'</code> </pre> <br>  Der Appid-Wert muss in Anf√ºhrungszeichen gesetzt werden, sonst funktioniert er nicht. <br><br><h2>  <font color="#3AC1EF">4. Installieren Sie DFS</font> </h2><br>  Synchronisieren Sie Zertifikate und Konfigurationen nicht √ºber DFS. Spezielle Tools wurden aus einem bestimmten Grund erfunden.  Ich habe es versucht und es stellte sich aus unklaren Gr√ºnden als schlecht heraus, dass die Konfigurationen auf den Servern, auf denen die Konfiguration ausgef√ºhrt wurde, die √Ñnderungen nicht mehr lasen, obwohl zum ersten Mal alles funktionierte.  Ich habe die Ursache des Fehlers nicht herausgefunden und beschlossen, es anders zu machen. <br><br>  Die weitere Konfiguration erfolgt ausschlie√ülich √ºber RSAT. Die in der Dokumentation angegebenen Cmdlets funktionieren nur unter Windows Server mit einer grafischen Benutzeroberfl√§che.  Die ausschlie√üliche Bereitstellung der DFS-Replikation mit Server Core ist nicht m√∂glich.  Sie ben√∂tigen entweder einen anderen Server mit einer grafischen Benutzeroberfl√§che oder einen Computer unter Windows 10 Pro mit installiertem RSAT, der der Dom√§ne beigetreten ist. <br><br>  <b>2.1.</b>  <b>Installieren</b> <br><br>  Auf jedem Server m√ºssen Sie die DFS-Replikation installieren: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ebf/999/b17/ebf999b179089dd87a346406bfe6a09d.png"><br><br><pre> <code class="plaintext hljs">Install-WindowsFeature FS-DFS-Replication, FS-DFS-Namespace</code> </pre> <br>  <b>2.2.</b>  <b>Erstellen einer neuen Replikationsgruppe</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/53b/3e2/9d6/53b3e29d6aee1c0e9f9a6b4e8f5ea06e.png"><br><br>  Zuerst m√ºssen Sie unsere Replikationsgruppe anrufen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14d/7ce/a23/14d7cea23a3bd08b1aec745ed40c0fb3.png"><br><br>  W√§hlen Sie die Topologie nach Ihrem Geschmack.  Pers√∂nlich ist es f√ºr mich bequemer, Inhalte an einem Ort hinzuzuf√ºgen, also w√§hle ich einen Stern. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2fb/a17/e99/2fba17e99d83b3bec4940c5517c2a690.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a2/6e4/508/7a26e4508dfe041bc25c5cf008120ec2.png"><br><br>  Einer der Server sollte der Hauptserver sein. Von dort aus beginnt die Replikation.  Wenn Sie Dateien zu Listenern hochladen, wird die hochgeladene Datei nicht repliziert. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d36/298/12a/d3629812afb96964a66db8a1c7682513.png"><br><br>  Als Ordner f√ºr die Replikation habe ich den Standardordner mit Sites ausgew√§hlt: <br><br><pre> <code class="plaintext hljs">C:\inetpub\wwwroot</code> </pre> <br>  Dieser Ordner ist der Pfad zum Verzeichnis dieses bestimmten ersten Servers.  Sie k√∂nnen den Inhalt dieses Ordners unabh√§ngig vom Pfad √ºberall replizieren. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d10/e94/f5e/d10e94f5e3e48d88ddcc3a5cb97ff5a4.png"><br><br>  Innerhalb einer Gruppe k√∂nnen wir mehrere Ordner replizieren und in Zukunft deren Liste bei Bedarf erweitern. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ccc/ae9/649/cccae9649e5b0145fb38a6cd59d73490.png"><br><br>  Fertig. <br><br><h2>  <font color="#3AC1EF">5. Leistung testen</font> </h2><br>  Um zu verstehen, wie viele Besucher der Website wirklich gewonnen haben, m√ºssen Sie Messungen vornehmen.  Sie werden von zwei Punkten aus durchgef√ºhrt.  Autoren-PC in Moskau und virtueller Server in Frankfurt.  Alle drei Punkte werden separat gepr√ºft.  Hier ist eine Zusammenfassung. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d26/12c/04a/d2612c04abedc5d8eb796cbeeaaf31f7.png"><br><br>  Wir gehen in Devtools und beobachten den Wasserfall.  In einem Krankenhaus reduziert ein CDN im Durchschnitt etwa 200 Millisekunden, bevor ein Standort vollst√§ndig ausgelastet ist.  Das Bild, das gr√∂√üte Objekt auf der Seite, wird geladen, sobald es in das Ansichtsfenster gelangt. Achten Sie daher auf die blaue vertikale Linie.  CDN beschleunigte reine HTML + -Stile und -Skripte um 10-15 Millisekunden, und das Bild wurde 220 Millisekunden schneller geladen. Dies ist ein sehr bedeutender Unterschied. <br><br><div class="spoiler">  <b class="spoiler_title">Moskau - Moskau:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/12b/5e5/8a9/12b5e58a9665f6901f073c0eba3f2678.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">London - Moskau:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/03e/435/b93/03e435b93de7b098fbd98afdacc0c8f4.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Z√ºrich - Moskau:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/1f2/474/cfb/1f2474cfba94d72d5482cb9a0ba0c679.png"></div></div><br>  Ich habe auch die Geschwindigkeit von Jekyll auf einem lokalen Host gemessen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/514/976/285/514976285849bbf746909644173302ba.png"><br><br>  Wir wenden uns dem Leuchtturm zu und sehen seltsame Ergebnisse: <br><br><div class="spoiler">  <b class="spoiler_title">Moskau - Moskau:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f2b/516/abb/f2b516abbaeb5ea7ec29c39585719d38.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">London - Moskau:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9ab/9d8/38c/9ab9d838cd9c67792381c0741ef81a27.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Z√ºrich - Moskau:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/12e/500/00b/12e50000b52c228beb3f08367fbbf00d.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Localhost - Jekyll:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/3eb/449/599/3eb449599c0eee7698301470b48ea67b.png"></div></div><br>  In dieser Synthetik umgeht ein Server, der entfernte L√§nder hat, den lokalen Host.  Aber warum? <br>  Lassen Sie uns zum Spa√ü Google Fonts loswerden und auf unsere Server √ºbertragen. <br><br><div class="spoiler">  <b class="spoiler_title">Moskau - Moskau:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/457/082/7cb/4570827cb685795120f645da992ebcf8.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">London - Moskau:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f90/fbd/2ad/f90fbd2ad39d80e6b246faf348fee577.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Z√ºrich - Moskau:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d45/2f0/530/d452f0530f2d1d914aba53649cff763d.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Localhost - Jekyll:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/bc2/6a1/f27/bc26a1f275f6d3626de02d96b436c186.png"></div></div><br>  Ergebnisse zwischen Rechenzentren ausgerichtet.  Aber es erkl√§rt immer noch nichts.  Ich habe die Tests mehrmals √ºberarbeitet, die Ergebnisse sind absolut eisern und jederzeit reproduzierbar. <br><br>  Jetzt verwenden wir einen VPS mit zwei Kernen und 4 Gigabyte RAM in Frankfurt und sehen, was darin steht.  Wasserf√§lle: <br><br><div class="spoiler">  <b class="spoiler_title">Moskau - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/025/d40/dd7/025d40dd7962e7e312a6978cff91cabd.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">London - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/961/e9f/acf/961e9facf3d0a4654654f3541c7093a6.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Z√ºrich - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d5a/81e/399/d5a81e399de00ca9f3a451d09379f6cd.png"></div></div><br>  Mit dem richtigen Punkt betrug die Zeitersparnis nur bei Stilen und HTML 200 Millisekunden.  Das hei√üt, bei einem Kunden aus Frankfurt ist die Site einfach um 200 Millisekunden schneller.  Dies spiegelt sich auch im Leuchtturm wider.  In solchen F√§llen beschleunigt CDN nicht nur den Online-Shop, sondern auch ein einfaches Blog. <br><br><div class="spoiler">  <b class="spoiler_title">Moskau - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e4d/e88/785/e4de88785e56ed3102cef5ade05f8462.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">London - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/042/b1c/071/042b1c0716f7e44b2f2dfc0b3955a68f.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Z√ºrich - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/db1/ae1/de5/db1ae1de5ebfd5be8c3af5e6822a4376.png"></div></div><br>  Schalten Sie jetzt Google Fonts ein und sehen Sie sich den Leuchtturm erneut an. <br><br><div class="spoiler">  <b class="spoiler_title">Moskau - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/87d/ae6/281/87dae6281e2510fa35ee4aecd45079f0.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">London - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/025/ec2/d7d/025ec2d7d6982b39261551f927167ad2.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Z√ºrich - Frankfurt:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/802/f0c/073/802f0c073e6fa0f445dda60d7823da00.png"></div></div><br>  Leider habe ich keine Punkte mehr, an denen ich Tests durchf√ºhren kann, also werde ich fertig sein. <br><br><h2>  <font color="#3AC1EF">Schlussfolgerungen</font> </h2><br><ul><li>  CDN f√ºr die Ausgabe aller statischen Daten ist erforderlich, insbesondere bei umfangreichen Bildern oder langen Skripten. </li><li>  Die Verwendung von Google Fonts ist m√∂glich und erforderlich. In schweren Szenarien wird die Website dadurch erheblich beschleunigt. </li><li>  Wenn Sie sich f√ºr den Hauptserver unter Windows entscheiden, empfiehlt es sich, eine grafische Benutzeroberfl√§che zu haben. </li><li>  Die Benutzer, die die Konfigurationen vom Hauptserver √ºbernehmen, werden am besten lokalisiert. Bei einem Ausfall des Dom√§nencontrollers verlieren die Knoten m√∂glicherweise die Verbindung zu den Konfigurationen und Zertifikaten, und der Anwendungspool wird gestoppt, weil  kann keine Konfiguration lesen. </li></ul><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de466447/">https://habr.com/ru/post/de466447/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de466437/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 43. Routing-Protokolle Distanzvektor und Verbindungsstatus</a></li>
<li><a href="../de466439/index.html">√úberpr√ºfen Sie selbst: Wie viele Fragen k√∂nnen Sie ChGK beantworten?</a></li>
<li><a href="../de466441/index.html">Python-Buggy-Code: 10 h√§ufigste Fehler, die Entwickler machen</a></li>
<li><a href="../de466443/index.html">ShIoTiny und die Welt: Analoge Sensoren oder ADCs f√ºr die Kleinsten</a></li>
<li><a href="../de466445/index.html">Angriffe zwischen Vertrauensstellungen zwischen Dom√§nen</a></li>
<li><a href="../de466449/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 44. Einf√ºhrung in OSPF</a></li>
<li><a href="../de466451/index.html">Read_You kann nicht werfen</a></li>
<li><a href="../de466453/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 45. Konfigurieren von OSPF</a></li>
<li><a href="../de466455/index.html">Services, Microservices und Batch-orientierte Programmierung</a></li>
<li><a href="../de466457/index.html">Landwirtschaft und Sonnenkollektoren - Win-Win-Strategie f√ºr Energieingenieure und Landwirte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>