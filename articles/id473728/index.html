<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌱 👨🏽‍⚖️ 👩‍👩‍👦‍👦 Implementasi pemantauan yang khas. Nikolay Sivko 💏 🤟🏾 👩‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Decoding dari laporan "Implementasi khas pemantauan" oleh Nikolay Sivko. 


 Nama saya Nikolai Sivko. Saya juga melakukan pemantauan. Okmeter adalah 5...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementasi pemantauan yang khas. Nikolay Sivko</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473728/"><p>  Decoding dari laporan "Implementasi khas pemantauan" oleh Nikolay Sivko. </p><br><p>  Nama saya Nikolai Sivko.  Saya juga melakukan pemantauan.  Okmeter adalah 5 pemantauan yang saya lakukan.  Saya memutuskan bahwa saya akan menyelamatkan semua orang dari neraka pengawasan dan kami akan menyelamatkan seseorang dari penderitaan ini.  Saya selalu berusaha untuk tidak mengiklankan okmeter dalam presentasi saya.  Secara alami, gambar akan berasal dari sana.  Tetapi ide dari apa yang ingin saya sampaikan adalah bahwa kami melakukan pemantauan pendekatan yang sedikit berbeda dari yang biasanya dilakukan semua orang.  Kami banyak berbicara tentang ini.  Ketika kami mencoba meyakinkan setiap orang dalam hal ini, pada akhirnya ia menjadi yakin.  Saya ingin berbicara tentang pendekatan kami secara tepat sehingga jika Anda melakukan pemantauan sendiri, sehingga Anda menghindari menyapu kami. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/btKYOueAAzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/za/jq/fi/zajqfi-zfkopot4qxgmw79zgnp8.png"></p><br><p>  Singkatnya tentang Okmeter.  Kami melakukan hal yang sama seperti Anda, tetapi ada semua jenis keripik.  Keripik: </p><br><ul><li>  merinci; </li><li>  sejumlah besar pemicu pra-konfigurasi yang didasarkan pada masalah pelanggan kami; </li><li>  Konfigurasi otomatis </li></ul><br><p><img src="https://habrastorage.org/webt/nj/n0/vs/njn0vsnh6hfcyvjuejxy7qtopek.png"></p><br><p>  Pelanggan tipikal mendatangi kami.  Dia memiliki dua tugas: </p><br><p>  1) untuk memahami bahwa semuanya rusak karena pemantauan, ketika tidak ada sama sekali. </p><br><p>  2) cepat memperbaikinya. </p><br><p>  Dia datang untuk memantau jawaban dari apa yang terjadi padanya. </p><br><p><img src="https://habrastorage.org/webt/ig/ff/fl/igffflnnpqwybqqxxw1yd0nb9tw.png"></p><br><p>  Hal pertama yang dilakukan orang yang tidak melakukan apa pun adalah memasang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.pingdom.com/</a> dan layanan lainnya untuk verifikasi.  Keuntungan dari solusi ini adalah dapat dilakukan dalam 5 menit.  Anda tidak akan lagi belajar tentang masalah dari panggilan pelanggan.  Ada masalah dengan akurasi sehingga mereka melewatkan masalah.  Tetapi untuk situs sederhana, ini sudah cukup. </p><br><p><img src="https://habrastorage.org/webt/cz/hb/td/czhbtddbrnh7n0msqxzrqxn8_wq.png"></p><br><p>  Hal kedua yang kami anjurkan adalah menghitung dengan log sesuai dengan statistik pengguna nyata.  Itu adalah berapa banyak pengguna tertentu mendapat kesalahan 5xx.  Berapa waktu respons oleh pengguna.  Ada kerugian, tetapi secara umum, hal seperti itu berhasil. </p><br><p><img src="https://habrastorage.org/webt/4g/ka/bk/4gkabkle1j9w96av-pkspnlwtis.png"></p><br><p>  Tentang nginx: kami membuatnya sehingga setiap klien yang datang segera menempatkan agen di frontend dan semuanya diambil secara otomatis olehnya, itu mulai parsing, kesalahan mulai muncul, dan sebagainya.  Dia hampir tidak memiliki apa pun untuk dikonfigurasikan. </p><br><p><img src="https://habrastorage.org/webt/cf/ef/5p/cfef5pftq8hwwmmb1zqfwiqyf7m.png"></p><br><p>  Tetapi kebanyakan klien tidak memiliki pengatur waktu dalam log nginx standar.  Ini 90 persen pelanggan tidak ingin tahu waktu respons situs mereka.  Kita dihadapkan dengan ini sepanjang waktu.  Perlu untuk memperluas log nginx.  Kemudian di luar kotak kita secara otomatis mulai menunjukkan histogram di luar kotak.  Ini mungkin merupakan aspek penting dari fakta bahwa waktu harus diukur. </p><br><p><img src="https://habrastorage.org/webt/qv/yx/_x/qvyx_xrqm7dg8vqcxkonum__aws.png"></p><br><p>  Apa yang kita tarik dari sana?  Dalam praktiknya, kami mengambil metrik dalam dimensi seperti itu.  Ini bukan metrik datar.  Metrik disebut index.request.rate - jumlah kueri per detik.  Itu dirinci oleh: </p><br><ul><li>  host tempat Anda menghapus log; </li><li>  log dari mana data ini diambil; </li><li>  http dengan metode; </li><li>  status http; </li><li>  status cache. </li></ul><br><p>  Ini BUKAN setiap URL spesifik dengan semua argumen.  Kami tidak ingin menghapus 100.000 metrik dari log. </p><br><p><img src="https://habrastorage.org/webt/u6/ah/0r/u6ah0rgp43jp3mnzdrqjpet5sza.png"></p><br><p>  Kami ingin mengambil 1.000 metrik.  Karena itu, kami mencoba untuk menormalkan URL, jika memungkinkan.  Ambil URL teratas.  Dan untuk URL yang bermakna, kami menampilkan grafik batang terpisah, secara terpisah 5xx. </p><br><p><img src="https://habrastorage.org/webt/ij/dr/ir/ijdrirnx6vwpo9jfteyepp3ax_e.png"></p><br><p>  Berikut adalah contoh bagaimana metrik sederhana ini berubah menjadi grafik yang dapat digunakan.  Ini adalah DSL kami di atas.  Saya mencoba DSL ini untuk menjelaskan perkiraan logika.  Kami mengambil semua permintaan nginx per detik dan meletakkannya di semua mesin yang kami miliki.  Dapatkan pengetahuan tentang bagaimana kami menyeimbangkannya, seberapa banyak kami memiliki RPS total (permintaan per detik, permintaan per detik). </p><br><p><img src="https://habrastorage.org/webt/mc/hv/sv/mchvsvendei8dswx2umciwkg8qu.png"></p><br><p>  Di sisi lain, kita dapat memfilter metrik ini dan hanya menampilkan 4xx.  Pada grafik 4xx, mereka dapat ditata sesuai dengan status yang nyata.  Saya ingatkan Anda bahwa ini adalah metrik yang sama. </p><br><p><img src="https://habrastorage.org/webt/uk/14/vc/uk14vcumvrmenkg4mubhonkv5gu.png"></p><br><p>  Pada grafik, Anda dapat menampilkan 4xx dengan URL.  Ini adalah metrik yang sama. </p><br><p><img src="https://habrastorage.org/webt/1l/n4/g8/1ln4g8sgwvteebpsdsbg_xmtly8.png"></p><br><p>  Kami juga memotret histogram dari log.  Histogram adalah metrik response_time.histrogram, yang sebenarnya adalah RPS dengan parameter level tambahan.  Ini hanya batas waktu untuk menerima permintaan. </p><br><p><img src="https://habrastorage.org/webt/cb/3b/nh/cb3bnh0wosk9il_ntyywe3z1kiq.png"></p><br><p>  Kami menarik permintaan: merangkum seluruh histogram dan mengurutkannya ke dalam level: </p><br><ul><li>  Permintaan lambat </li><li>  permintaan cepat; </li><li>  permintaan rata-rata; </li></ul><br><p>  Kami memiliki gambar yang telah disimpulkan oleh server.  Metriknya sama.  Makna fisiknya bisa dimengerti.  Tapi kami memanfaatkannya dengan cara yang sangat berbeda. </p><br><p><img src="https://habrastorage.org/webt/og/_q/0a/og_q0acmw4ianhc6n5sc3z4aokq.png"></p><br><p>  Pada bagan, Anda dapat menampilkan histogram hanya dengan URL dimulai dengan "/ api".  Jadi kita melihat histogram secara terpisah.  Kami melihat seberapa banyak saat ini.  Kami melihat berapa banyak RPS yang ada di URL "/ api".  Metrik yang sama, tetapi aplikasi yang berbeda. </p><br><p><img src="https://habrastorage.org/webt/lt/jw/46/ltjw46topobrcyeyyhkkigncknm.png"></p><br><p>  Beberapa kata tentang timing di nginx.  Ada request_time, yang mencakup waktu dari awal permintaan hingga transfer byte terakhir ke soket ke klien.  Dan ada upstream_response_time.  Mereka perlu diukur keduanya.  Jika kami hanya menghapus request_time, maka di sana Anda akan melihat penundaan karena masalah konektivitas klien dengan server Anda, Anda akan melihat penundaan di sana jika kami memiliki permintaan batas c dikonfigurasi dan klien dalam kamar mandi.  Anda tidak akan mengerti apakah Anda perlu memperbaiki server atau menelepon hoster.  Karenanya, kami menghapus keduanya dan kira-kira jelas apa yang terjadi. </p><br><p><img src="https://habrastorage.org/webt/uy/xy/a9/uyxya9gyu-fr0ccab75sa7fjt3q.png"></p><br><p>  Dengan tugas memahami apakah situs tersebut berfungsi atau tidak, saya percaya bahwa kami memiliki lebih atau kurang mengatasinya.  Ada kesalahan.  Ada ketidakakuratan.  Prinsip-prinsip umum adalah sebagai berikut. </p><br><p>  Sekarang tentang pemantauan arsitektur multi-tier.  Karena bahkan toko online paling sederhana memiliki paling tidak sebuah frontend, diikuti oleh bitrix dan base.  Ini sudah banyak tautan.  Poin umumnya adalah Anda perlu memotret beberapa indikator dari setiap level.  Artinya, pengguna berpikir tentang frontend.  Frontend sedang memikirkan backend.  Backend berpikir tentang backend tetangga.  Dan mereka semua berpikir tentang markas.  Jadi, demi lapisan, oleh ketergantungan, kita pergi.  Kami mencakup semuanya dengan semacam metrik.  Kami mendapatkan sesuatu di pintu keluar. </p><br><p><img src="https://habrastorage.org/webt/nq/ov/rx/nqovrxw3la9pl8bkrufpklydrii.png"></p><br><p>  Kenapa tidak dibatasi satu lapisan saja?  Biasanya, antara lapisan adalah jaringan.  Jaringan besar di bawah beban adalah zat yang sangat tidak stabil.  Karena itu, semuanya terjadi di sana.  Plus, pengukuran-pengukuran yang Anda buat pada lapisan mana yang bisa diletakkan.  Jika Anda melakukan pengukuran pada layer "A" dan layer "B", dan jika mereka berinteraksi satu sama lain melalui jaringan, maka Anda dapat membandingkan bacaannya, temukan beberapa anomali dan inkonsistensi. </p><br><p><img src="https://habrastorage.org/webt/7a/kq/ov/7akqovksuz3bhdmaxez5vcibepk.png"></p><br><p>  Tentang backend.  Kami ingin memahami cara memonitor backend.  Apa yang harus dilakukan untuk memahami dengan cepat apa yang terjadi.  Saya mengingatkan Anda bahwa kami telah beralih ke tugas meminimalkan waktu henti.  Dan tentang backend, kami menyarankan pemahaman secara standar: </p><br><ul><li>  Berapa banyak sumber daya ini dimakan? </li><li>  Apakah kita terbentur dalam batasan apa pun? </li><li>  Apa yang terjadi dengan runtime?  Misalnya, platform runtime JVM, runtime Golang, dan runtime lainnya. </li><li>  Ketika kita sudah membahas semua ini, menarik bagi kita untuk lebih dekat dengan kode kita.  Kita dapat menggunakan intrumetri otomatis (statsd, * -metric), yang akan menunjukkan kepada kita semua ini.  Atau instruksikan diri Anda dengan mengatur penghitung waktu, penghitung, dll. </li></ul><br><p><img src="https://habrastorage.org/webt/wk/xq/6p/wkxq6ptxbigdvp3evm4t2mqh3lq.png"></p><br><p>  Tentang sumber daya.  Agen standar kami menghapus konsumsi sumber daya oleh semua proses.  Oleh karena itu, untuk backend, kita tidak perlu secara terpisah mengambil data.  Kami mengambil dan melihat berapa banyak CPU mengkonsumsi proses, misalnya Python di server bertopeng.  Kami menunjukkan semua server di gugus pada grafik yang sama, karena kami ingin memahami jika kami memiliki ketidakseimbangan dan jika ada sesuatu yang meledak pada mesin yang sama.  Kami melihat total konsumsi dari kemarin hingga hari ini. </p><br><p><img src="https://habrastorage.org/webt/t0/fl/oe/t0floe26e2hgev70o5fs18yf4ua.png"></p><br><p>  Hal yang sama berlaku untuk memori.  Ketika kita menggambar seperti ini.  Kami memilih Python RSS (RSS adalah ukuran halaman memori yang dialokasikan untuk proses oleh sistem operasi dan saat ini terletak di RAM).  Jumlahkan oleh tuan rumah.  Kami tidak melihat ke mana pun ingatan mengalir.  Di mana-mana memori didistribusikan secara merata.  Pada prinsipnya, kami menerima jawaban untuk pertanyaan kami. </p><br><p><img src="https://habrastorage.org/webt/zl/cu/yz/zlcuyz_bgzybypkgcndsotzdcsk.png"></p><br><p>  Contoh runtime.  Agen kami ditulis dalam Golang.  Agen Golang mengirimkan sendiri metrik runtime-nya.  Ini khususnya jumlah detik yang dihabiskan oleh pengumpul sampah Golang untuk pengumpulan sampah per detik.  Kami melihat di sini bahwa beberapa server memiliki metrik yang berbeda dari server lain.  Kami melihat anomali.  Kami mencoba menjelaskan ini. </p><br><p><img src="https://habrastorage.org/webt/oj/ir/pu/ojirpuokww_ym6e1hg1yrwz_8ao.png"></p><br><p>  Ada lagi metrik runtime.  Berapa banyak memori yang dialokasikan per unit waktu.  Kami melihat bahwa agen dengan tipe yang ada di atas mengalokasikan lebih banyak memori daripada agen yang lebih rendah.  Di bawah ini adalah agen dengan Pengumpul Sampah yang kurang agresif.  Ini logis.  Semakin banyak memori yang melewati Anda, dialokasikan, dibebaskan, semakin besar beban Kolektor Sampah.  Selanjutnya, menurut metrik internal kami, kami memahami mengapa kami ingin begitu banyak memori pada mesin-mesin itu dan lebih sedikit pada mesin-mesin ini. </p><br><p><img src="https://habrastorage.org/webt/8h/4s/yq/8h4syq_g35fjhfdztsheuybzyrc.png"></p><br><p>  Ketika kita berbicara tentang instrumentasi, segala macam alat seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://pinba.org/</a> untuk php datang.  Pinba adalah ekstensi untuk php dari Badoo, yang Anda pasang dan sambungkan ke php.  Ini memungkinkan Anda untuk segera menghapus dan mengirim protobuf melalui UDP.  Mereka memiliki server pinba.  Tapi kami membuat server Pinba tertanam di agen.  PHP mengirimkan kepada dirinya sendiri berapa banyak menghabiskan CPU dan memori untuk skrip tersebut, berapa banyak lalu lintas yang diberikan oleh skrip tersebut, dan sebagainya.  Berikut ini adalah contoh dengan Pinba.  Kami menampilkan 5 skrip teratas tentang konsumsi CPU.  Kami melihat outlier violet yang merupakan titik tercoreng dari PHP.  Kami akan memperbaiki titik lebur PHP atau untuk memahami mengapa itu memakan CPU.  Kami telah mempersempit ruang lingkup masalah sehingga kami memahami langkah-langkah berikut.  Kami pergi untuk melihat kode dan memperbaikinya. </p><br><p><img src="https://habrastorage.org/webt/kx/el/vv/kxelvvi9xxzv4bfefhf4m0xbhay.png"></p><br><p>  Hal yang sama berlaku untuk lalu lintas.  Kami melihat 5 skrip lalu lintas teratas.  Jika ini penting bagi kami, maka kami pergi dan mengerti. </p><br><p><img src="https://habrastorage.org/webt/nz/io/zs/nziozsp_7pzn3ej88j8t3bdpenk.png"></p><br><p>  Ini adalah bagan tentang alat internal kami.  Ketika kami mengatur timer melalui statsd dan mengukur metrik.  Kami membuatnya sehingga jumlah total waktu yang dihabiskan dalam CPU atau untuk mengantisipasi beberapa sumber daya disusun sesuai dengan handler yang kami proses saat ini, dan menurut tahapan penting dari kode Anda: menunggu cassander, menunggu elasticsearch.  Bagan menunjukkan 5 tahapan teratas untuk penangan / metric / query.  Pada grafik, Anda dapat menampilkan 5 penangan teratas untuk konsumsi CPU, jadi apa yang terjadi di dalamnya.  Sudah jelas apa yang harus diperbaiki. </p><br><p>  Tentang backend Anda bisa masuk lebih dalam.  Ada hal-hal yang dilakukan penelusuran.  Artinya, Anda dapat melihat permintaan pengguna khusus ini dengan cookie begitu-dan-begitu dan IP begitu-dan-begitu menghasilkan begitu banyak permintaan ke database, mereka menunggu begitu lama.  Kami tidak dapat melacak.  Kami tidak melacak.  Kami masih percaya bahwa kami tidak melakukan aplikasi dan pemantauan kinerja. </p><br><p><img src="https://habrastorage.org/webt/pr/zy/yf/przyyfqriaulwy_fe4swdvq2bco.png"></p><br><p>  Tentang database.  Hal yang sama.  Database adalah proses yang sama.  Dia mengkonsumsi sumber daya.  Jika pangkalan sangat sensitif terhadap latensi, maka ada fitur yang sedikit berbeda.  Kami menyarankan untuk memeriksa bahwa tidak ada sumber daya yang lebih sedikit, tidak ada degradasi dalam sumber daya.  Sangat ideal untuk memahami bahwa jika basis mulai mengkonsumsi lebih banyak daripada yang dikonsumsi, maka pahami apa yang sebenarnya telah berubah dalam kode Anda. </p><br><p><img src="https://habrastorage.org/webt/az/zc/lj/azzcljm0hkvcfxc1lgeqeukrdgq.png"></p><br><p>  Tentang sumber daya.  Dengan cara yang sama, kita melihat seberapa banyak proses MySQL dihasilkan pada disk kita.  Kita melihat bahwa rata-rata ada begitu banyak, tetapi beberapa puncak terjadi.  Misalnya, banyak sisipan masuk dan mulai menulis ke disk pada pukul 15.15, 16.15, 17.15. </p><br><p><img src="https://habrastorage.org/webt/u8/vb/rc/u8vbrcgbovxfcalnkk7sph4rw2i.png"></p><br><p>  Tentang degradasi sumber daya.  Misalnya, baterai RAID telah masuk ke mode pemeliharaan.  Dia berhenti menjadi pengontrol seperti baterai hidup.  Pada titik ini, cache tulis terputus, laten disk tulis meningkat.  Pada titik ini, jika basis data mulai tumpul sambil menunggu disk, dan Anda tahu secara kasar bahwa Anda memiliki latensi berbeda untuk menulis ke disk, kemudian periksa baterai dalam RAID. </p><br><p><img src="https://habrastorage.org/webt/j_/ap/qb/j_apqbgrlnp5zkiopa794hq0v4y.png"></p><br><p>  Sumberdaya Sesuai Permintaan.  Tidak sesederhana itu di sini.  Tergantung pada pangkalan.  Pangkalan tersebut harus dapat memberi tahu tentang dirinya sendiri: permintaan apa yang dihabiskan sumber daya, dll.  Pemimpin dalam hal ini adalah PostgreSQL.  Dia memiliki pg_stat_statements.  Anda dapat memahami jenis permintaan apa yang Anda miliki menggunakan banyak CPU, baca dan tulis disk, dan lalu lintas. </p><br><p>  Di MySQL, sejujurnya, semuanya jauh lebih buruk.  Ini memiliki performance_schema.  Entah bagaimana itu bekerja dari versi 5.7.  Tidak seperti tampilan tunggal di PostgreSQL, performance_schema adalah tabel tampilan sistem 27 atau 23 di MySQL.  Terkadang, jika Anda membuat kueri di tabel yang salah (pada tampilan yang salah), Anda bisa menghambur-hamburkan MySQL. </p><br><p>  Redis memiliki statistik tim.  Anda melihat bahwa perintah tertentu menggunakan banyak CPU, dll. </p><br><p>  Cassandra memiliki waktu untuk menanyakan tabel tertentu.  Tetapi karena cassandra dirancang sehingga satu jenis kueri dibuat ke tabel, ini sudah cukup untuk pemantauan. </p><br><p><img src="https://habrastorage.org/webt/qx/gt/wo/qxgtwoplv8i3wnce0ncygyipfgw.png"></p><br><p>  Ini Redis.  Kami melihat bahwa ungu menggunakan banyak CPU.  Violet adalah setex.  Setex - catatan kunci dengan instalasi TTL.  Jika ini penting bagi kami, mari kita hadapi itu.  Jika ini tidak penting bagi kami, kami hanya tahu kemana semua sumber daya pergi. </p><br><p><img src="https://habrastorage.org/webt/78/x_/ng/78x_nghhya3bc-3zd2xtgd2kyxy.png"></p><br><p>  Cassandra.  Kami melihat 5 tabel teratas untuk permintaan baca dengan total waktu tanggapan.  Kami melihat gelombang ini.  Ini adalah kueri ke tabel, dan kami secara kasar memahami bahwa kueri ke tabel ini menghasilkan satu potong kode.  Cassandra bukan database SQL yang dapat digunakan untuk membuat kueri yang berbeda pada tabel.  Cassandra menjadi semakin celaka. </p><br><p><img src="https://habrastorage.org/webt/z3/ho/s3/z3hos3wz7mgt5yvh3jbw9sgodxi.png"></p><br><p>  Beberapa kata tentang alur kerja berfungsi dengan insiden.  Seperti yang saya lihat. </p><br><p>  Tentang waspada.  Pandangan kami tentang alur kerja kejadian berbeda dari apa yang secara umum diterima. </p><br><p><img src="https://habrastorage.org/webt/px/zd/n4/pxzdn4r9vdjznfd6hrr2x63nmxi.png"></p><br><p>  Sangat kritis.  Kami memberi tahu Anda melalui SMS dan semua saluran komunikasi real-time. </p><br><p>  Severy Info adalah bola lampu yang dapat membantu Anda dengan sesuatu ketika bekerja dengan insiden.  Info tidak diberitahukan di mana pun.  Info hanya hang dan memberitahu Anda bahwa ada sesuatu yang terjadi. </p><br><p>  Severy Warning adalah sesuatu yang bisa diberitahukan, mungkin juga tidak. </p><br><p><img src="https://habrastorage.org/webt/op/hd/az/ophdazu-e1tchrtymsdxetidpq8.png"></p><br><p>  Contoh kritis. </p><br><p>  Situs tidak berfungsi sama sekali.  Misalnya, 5xx 100% atau waktu respons meningkat dan pengguna mulai pergi. </p><br><p>  Kesalahan logika bisnis.  Apa yang kritis.  Penting untuk mengukur uang per detik.  Uang per detik adalah sumber data yang bagus untuk Critical.  Misalnya jumlah pesanan, promosi iklan dan lainnya. </p><br><p><img src="https://habrastorage.org/webt/it/n3/em/itn3emdzqhe7lapptysa1nvlwjy.png"></p><br><p>  Alur kerja dengan Critical sedemikian sehingga insiden ini tidak dapat ditunda.  Anda tidak dapat mengklik OK dan pulang.  Jika Critical datang kepada Anda dan Anda naik kereta bawah tanah, maka Anda harus keluar dari kereta bawah tanah, pergi keluar, mengambil bangku dan mulai memperbaiki.  Kalau tidak, itu tidak kritis.  Dari pertimbangan ini, kami membangun keparahan yang tersisa untuk atribut residual. </p><br><p><img src="https://habrastorage.org/webt/pq/ct/ww/pqctww-7nkjkjjdvmujjl9ntjrm.png"></p><br><p>  Peringatan.  Contoh peringatan. </p><br><ul><li>  Ruang disk habis. </li><li>  Layanan internal berfungsi untuk waktu yang lama, tetapi jika Anda tidak memiliki Kritis, berarti Anda tetap bersyarat. </li><li>  Banyak kesalahan pada antarmuka jaringan. </li><li>  Yang paling kontroversial adalah server tidak tersedia.  Bahkan, jika Anda memiliki lebih dari satu server dan server tidak tersedia, ini adalah Peringatan.  Jika Anda tidak memiliki 1 backend dari 100, maka itu bodoh untuk bangun dari SMS dan Anda akan mendapatkan admin gugup. </li></ul><br><p>  Semua Severy lainnya dirancang untuk membantu Anda menangani Critical. </p><br><p><img src="https://habrastorage.org/webt/ze/rv/je/zervjevqnr3gnnaqugze3h1jf-g.png"></p><br><p>  Peringatan.  Kami menganjurkan pendekatan ini untuk bekerja dengan Peringatan.  Lebih disukai Peringatan tutup pada siang hari.  Sebagian besar pelanggan kami telah menonaktifkan Pemberitahuan peringatan.  Dengan demikian, mereka tidak memiliki apa yang disebut pemantauan kebutaan.  Ini berarti melipat surat dalam surat tanpa membaca direktori terpisah.  Klien telah menonaktifkan peringatan peringatan. </p><br><p>  (Seperti yang saya pahami, pemantauan murni adalah peringatan dan pemicu yang tidak perlu ditambahkan ke pengecualian - perhatikan oleh penulis pos) </p><br><p>  Jika Anda menggunakan teknik pemantauan murni, jika Anda memiliki 5 Peringatan baru, maka Anda dapat memperbaikinya dalam mode senyap.  Mereka tidak punya waktu untuk memperbaikinya hari ini, mereka menunda sampai besok, jika tidak kritis.  Jika Peringatan menyala dan padam sendiri, maka ini harus diputar dalam pemantauan sehingga sekali lagi Anda tidak repot.  Maka Anda akan lebih toleran terhadap mereka dan, dengan demikian, hidup akan meningkat. </p><br><p><img src="https://habrastorage.org/webt/xp/92/lv/xp92lvui1q6xbawczc9ltl0osys.png"></p><br><p>  Contoh info.  Dapat diperdebatkan bahwa banyak Kritis memiliki pemanfaatan CPU yang tinggi.  Bahkan, jika tidak ada yang mempengaruhi, maka Anda dapat mengabaikan notifikasi ini. </p><br><p><img src="https://habrastorage.org/webt/xb/nn/p1/xbnnp13tktiqtspilpycu2oaxba.png"></p><br><p>  Peringatan (mungkin saya melihat Info - catatan oleh penulis posting) ini adalah lampu yang menyala ketika Anda datang untuk memperbaiki Critical.  Anda melihat dua tanda Peringatan berdampingan (mungkin ada tautan Info - catatan oleh penulis posting).  Mereka dapat membantu Anda dalam menyelesaikan insiden dengan Critical.  Mengapa tidak jelas tentang tingginya penggunaan CPU secara terpisah dalam SMS atau surat. </p><br><p>  Info tidak berguna juga buruk.  Jika Anda mengkonfigurasinya sebagai pengecualian, maka Anda akan sangat menyukai Info. </p><br><p><img src="https://habrastorage.org/webt/ra/rc/uc/rarcucyuedf9vp6v6keycnnjbz4.png"></p><br><p>  Prinsip umum untuk desain peringatan.  Peringatan harus menunjukkan alasannya.  Ini sempurna.  Tetapi ini sulit dicapai.  Di sini kami bekerja penuh waktu untuk tugas itu dan ternyata ada beberapa keberhasilan. </p><br><p>  Semua orang berbicara tentang perlunya kecanduan, sihir otomatis.  Bahkan, jika Anda tidak menerima pemberitahuan untuk sesuatu yang tidak Anda minati, maka tidak akan ada terlalu banyak.  Dalam praktik saya, statistik menunjukkan bahwa seseorang akan melihat saat kejadian kritis dengan mata mereka sekitar seratus umbi secara diagonal.  Dia akan menemukan yang tepat di sana dan tidak akan berpikir bahwa ketergantungan telah menyembunyikan bola lampu yang akan membantu saya sekarang.  Dalam praktiknya, ini berhasil.  Yang perlu Anda lakukan adalah membersihkan peringatan yang tidak perlu. </p><br><p><img src="https://habrastorage.org/webt/wq/i8/mm/wqi8mmyravgx7yllannlhsgdvg8.png"></p><br><p>  (Di sini video dilewati - catatan oleh penulis pos) </p><br><p><img src="https://habrastorage.org/webt/ys/t_/0d/yst_0dqqfwqnra1yz0krnccw7ae.png"></p><br><p>  Akan bagus untuk mengklasifikasikan downtime ini sehingga Anda dapat bekerja dengannya nanti.  Misalnya, buat kesimpulan organisasi.  Anda perlu memahami mengapa Anda berbohong.  Kami mengusulkan untuk mengklasifikasikan / membagi ke dalam kelas-kelas berikut: </p><br><ul><li>  buatan manusia </li><li>  pengaturan hoster </li><li>  datang bot </li></ul><br><p>  Jika Anda mengklasifikasikannya, maka semua orang akan senang. </p><br><p><img src="https://habrastorage.org/webt/_c/kz/ll/_ckzllbldi_jkamyonco194favy.png"></p><br><p>  SMS telah tiba.  Apa yang kita lakukan  Pertama kita jalankan untuk memperbaiki semuanya.  Sejauh ini, tidak ada yang penting bagi kami, kecuali downtime berakhir.  Karena kita termotivasi untuk tidak berbohong.  Kemudian, ketika insiden ditutup, itu harus ditutup ke sistem pemantauan.  Kami percaya bahwa insiden tersebut harus diperiksa dengan pemantauan.  Jika pemantauan Anda tidak dikonfigurasi, cukup untuk memastikan bahwa masalahnya selesai.  Ini harus diputar.  Setelah kejadian ditutup, sebenarnya tidak ditutup.  Dia menunggu saat Anda sampai ke dasar alasannya.  Pemimpin mana pun, pada kenyataannya, pertama-tama perlu memastikan bahwa masalahnya tidak terulang kembali.  Agar masalah tidak terulang, Anda harus sampai ke dasar alasannya.  Setelah kami sampai di dasar alasan, kami memiliki data untuk mengklasifikasikannya.  Kami menganalisis alasannya.  Kemudian, ketika kita sampai pada dasar alasannya, kita perlu melakukannya di masa depan agar kejadian itu tidak terulang: </p><br><ul><li>  dibutuhkan dua orang seperempat untuk menulis logika ini dan itu ke backend. </li><li>  perlu menempatkan lebih banyak replika. </li></ul><br><p>  Penting untuk memastikan bahwa kejadian yang sama tidak terjadi.  Ketika Anda bekerja dalam alur kerja seperti itu melalui N iterasi, kebahagiaan menanti Anda, waktu yang baik. </p><br><p>  Mengapa kami mengklasifikasikannya?  Kami dapat mengambil statistik untuk kuartal ini dan memahami apa yang paling memberi Anda waktu henti.  Kemudian kerjakan ke arah ini.  Anda dapat bekerja di semua bidang tidak akan sangat efektif, terutama jika Anda memiliki sedikit sumber daya di sana. </p><br><p><img src="https://habrastorage.org/webt/b9/os/oh/b9osohrb-qilf4mcb7ddcqjckju.png"></p><br><p>  Kami menghitung di sana kami berbaring begitu lama, misalnya 90% karena hoster.  Kami menagih kami mengubah hoster ini.  Jika orang mengacaukan kami, kami mengirim mereka ke kursus.   ,      - —  .   .     ,     .    ,    . </p><br><p><img src="https://habrastorage.org/webt/js/gl/wp/jsglwpchvythu9tvkjnbruwtcr8.png"></p><br><p>  .      : </p><br><ul><li>  . </li><li>  . </li></ul><br><p>     ,    ,    .      ,    ,  . </p><br><p><img src="https://habrastorage.org/webt/nn/rb/fl/nnrbflbnglbwbwggjdxuipfuxss.png"></p><br><p> :    ,  .     : ,  ,    .   False Positive ( ),   ,    .       ? </p><br><p> :      .    10- frontend ,      .    9 frontend     nginx,   10-  ,     warning alert  .            .     ,     .          .    . </p><br><p> :       . ,      ,   load avarage 4  , -   load avarage 20  . </p><br><p> :        load avarage.      100       .   CPU usage   Hadoop  .          .       .    .     ,       ,     .      PostgreSQL    autovacuum,  worker autovacuum      .          99  . Warning     .  Critical     .    Critical 10 5  ,     Critical. </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertanyaan: Pada titik apa dan bagaimana ambang ditentukan? </font><font style="vertical-align: inherit;">Siapa yang melakukan ini?</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jawab: Anda datang kepada kami dan berkata: kami ingin bertanya beberapa Kritis dari proyek kami. </font><font style="vertical-align: inherit;">Jika Anda menempatkan 10 5xx per detik sekarang, maka berapa banyak pemberitahuan yang akan Anda terima seminggu yang lalu.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pertanyaan: Apa beban dari pemantauan yang baik ini? </font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jawab: Rata-rata, umumnya tidak terlihat. </font><font style="vertical-align: inherit;">Tetapi jika Anda mem-parsing 50.000 RPS itu akan dari 1% hingga 10% dari satu CPU. </font><font style="vertical-align: inherit;">Karena kami hanya memantau, kami mengoptimalkan agen kami. </font><font style="vertical-align: inherit;">Kami mengukur kinerja agen. </font><font style="vertical-align: inherit;">Jika Anda tidak memiliki sumber daya untuk dipantau di server, maka Anda melakukan sesuatu yang salah. </font><font style="vertical-align: inherit;">Harus selalu ada sumber daya untuk dipantau. </font><font style="vertical-align: inherit;">Jika tidak, maka Anda akan sama buta dengan sentuhan untuk mengelola proyek Anda.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id473728/">https://habr.com/ru/post/id473728/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id473716/index.html">Widget yang digerakkan mouse. Seret dan letakkan di dalam jendela</a></li>
<li><a href="../id473718/index.html">Cara menambahkan cek ke NoVerify tanpa menulis satu baris kode Go</a></li>
<li><a href="../id473720/index.html">Dua cara untuk membuat unit test yang andal</a></li>
<li><a href="../id473722/index.html">Isolasi jarak jauh, kecemasan dan depresi</a></li>
<li><a href="../id473726/index.html">Tidak cukup hanya tahu apa itu Mutex, Semaphore, dan async / tunggu. Anda perlu tahu segalanya dari kuanta</a></li>
<li><a href="../id473732/index.html">Sejarah penipuan dalam pembangunan jaringan kabel di bawah Kutub Utara sebesar $ 1 miliar</a></li>
<li><a href="../id473740/index.html">BuatRemoteThread untuk Linux</a></li>
<li><a href="../id473742/index.html">Printer rekayasa Epson untuk CAD dan GIS dan beberapa kata tentang "desain yang kuat"</a></li>
<li><a href="../id473748/index.html">Kurva Bezier dalam pelayanan ekonom tenaga kerja</a></li>
<li><a href="../id473750/index.html">Stereopi + WebRTC = telepresense di rumah</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>