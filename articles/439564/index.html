<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õîÔ∏è ü§ñ üàµ Aplicaci√≥n pr√°ctica de la transformaci√≥n del √°rbol AST utilizando Putout como ejemplo üë©üèø‚Äçüéì üë∑ üßôüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 


 Todos los d√≠as, cuando se trabaja en el c√≥digo, en la forma de implementar una funci√≥n √∫til para el usuario, se hacen cambios forzado...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aplicaci√≥n pr√°ctica de la transformaci√≥n del √°rbol AST utilizando Putout como ejemplo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439564/"><h2 id="vvedenie">  Introduccion </h2><br><p>  Todos los d√≠as, cuando se trabaja en el c√≥digo, en la forma de implementar una funci√≥n √∫til para el usuario, se hacen cambios forzados (inevitables o simplemente deseables) en el c√≥digo.  Esto puede ser refactorizar, actualizar una biblioteca o marco a una nueva versi√≥n principal, actualizar la sintaxis de JavaScript (que no es raro recientemente).  Incluso si la biblioteca es parte de un proyecto en funcionamiento, el cambio es inevitable.  La mayor√≠a de estos cambios son rutinarios.  No hay nada interesante para el desarrollador en ellos, por un lado, por otro, no aporta nada al negocio y, por otro, durante el proceso de actualizaci√≥n, debe tener mucho cuidado de no romper la le√±a y no romper la funcionalidad.  Por lo tanto, llegamos a la conclusi√≥n de que es mejor cambiar esa rutina sobre los hombros de los programas para que hagan todo por s√≠ mismos, y la persona, a su vez, controle si todo se hizo correctamente.  Esto es lo que se discutir√° en el art√≠culo de hoy. </p><a name="habracut"></a><br><h2 id="ast">  AST </h2><br><p> Para el procesamiento del c√≥digo del programa, es necesario traducirlo en una representaci√≥n especial, con la cual ser√≠a conveniente que los programas funcionen.  Tal representaci√≥n existe, se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">√Årbol de sintaxis abstracta</a> (AST). <br>  Para obtenerlo, use analizadores.  El AST resultante se puede transformar a su gusto, y luego para guardar el resultado necesita un generador de c√≥digo.  Consideremos con m√°s detalle cada uno de los pasos.  Comencemos con el analizador. </p><br><h3 id="parser">  Analizador </h3><br><p>  Y entonces tenemos el c√≥digo: </p><br><pre><code class="javascript hljs">a + b</code> </pre> <br><p>  Los analizadores generalmente se dividen en dos partes: </p><br><ul><li>  An√°lisis l√©xico </li></ul><br><p>  Rompe el c√≥digo en tokens, cada uno de los cuales describe una parte del c√≥digo: </p><br><pre> <code class="json hljs">[{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Punctuator"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> }]</code> </pre> <br><ul><li>  Analizando </li></ul><br><p>  Crea un √°rbol de sintaxis a partir de tokens: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"BinaryExpression"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"left"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"right"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } }</code> </pre> <br><p>  Y ahora ya tenemos esa idea, con la que puede trabajar mediante programaci√≥n.  Vale la pena aclarar que hay una gran cantidad de analizadores <code>JavaScript</code> , estos son algunos de ellos: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">babel-parser</a> : un analizador sint√°ctico que usa <code>babel</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">espree</a> : un analizador sint√°ctico que usa <code>eslint</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bellota</a> : el analizador en el que se basan los dos anteriores; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esprima</a> : un analizador popular que admite JavaScript hasta EcmaScript 2017; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cherow</a> es un nuevo jugador entre los analizadores de JavaScript que dice ser el m√°s r√°pido; </li></ul><br><p>  Hay un analizador de JavaScript est√°ndar, se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ESTree</a> y define qu√© nodos deben analizarse. <br>  Para un an√°lisis m√°s detallado del proceso de implementaci√≥n del analizador (as√≠ como el transformador y el generador), puede leer el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">compilador s√∫per peque√±o</a> . </p><br><h3 id="transformator">  Transformador </h3><br><p>  Para transformar el √°rbol AST, puede usar el patr√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Visitor</a> , por ejemplo, usando la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@ babel / traverse</a> .  El siguiente c√≥digo generar√° los nombres de todos los identificadores de c√≥digo JavaScript de la variable de <code>code</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parser <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@babel/parser"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> traverse <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@babel/traverse"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> code = <span class="hljs-string"><span class="hljs-string">`function square(n) { return n * n; }`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ast = parser.parse(code); traverse(ast, { Identifier(path) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(path.node.name); } });</code> </pre> <br><h3 id="generator">  Generador </h3><br><p>  Puede generar c√≥digo, por ejemplo, usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@ babel / generator</a> , de esta manera: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {parse} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@babel/parser'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> generate <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@babel/generator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> code = <span class="hljs-string"><span class="hljs-string">'class Example {}'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ast = parse(code); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> output = generate(ast, code);</code> </pre> <br><p>  Y as√≠, en esta etapa, el lector deber√≠a haber tenido una idea b√°sica de lo que se necesita para transformar el c√≥digo JavaScript y con qu√© herramientas se implementa. </p><br><p>  Tambi√©n vale la pena agregar una herramienta en l√≠nea como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">astexplorer</a> , que combina una gran cantidad de analizadores, transformadores y generadores. </p><br><h2 id="putout">  Putout </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Putout</a> es un transformador de c√≥digo habilitado para complementos.  De hecho, es un cruce entre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">eslint</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">babel</a> , que combina las ventajas de ambas herramientas. </p><br><p>  C√≥mo <code>eslint</code> <code>putout</code> muestra √°reas problem√°ticas en el c√≥digo, pero a diferencia de <code>eslint</code> <code>putout</code> cambia el comportamiento del c√≥digo, es decir, es capaz de corregir todos los errores que puede encontrar. </p><br><p>  Al igual que <code>babel</code> <code>putout</code> convierte el c√≥digo, pero trata de cambiarlo m√≠nimamente, por lo que puede usarse para trabajar con c√≥digo almacenado en el repositorio. </p><br><p>  Tambi√©n vale la pena mencionar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Prettier</a> , es una herramienta de formateo y difiere radicalmente. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jscodeshift</a> se encuentra no muy lejos de la <code>putout</code> , pero no admite complementos, no muestra mensajes de error y tambi√©n utiliza <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ast-types en</a> lugar de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@ babel / types</a> . </p><br><h3 id="istoriya-poyavleniya">  Historia de la apariencia </h3><br><p>  En el proceso, <code>eslint</code> me ayuda mucho con mis consejos.  Pero a veces quiero m√°s de √©l.  Por ejemplo, para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">eliminar el depurador</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">arregle test.only</a> y tambi√©n elimine las variables no utilizadas.  El √∫ltimo punto form√≥ la base de la <code>putout</code> , durante el proceso de desarrollo, qued√≥ claro que no es f√°cil y muchas otras transformaciones son mucho m√°s f√°ciles de implementar.  Por lo tanto, la <code>putout</code> creci√≥ sin problemas de una funci√≥n al sistema de complementos.  Eliminar las variables no utilizadas es ahora el proceso m√°s dif√≠cil, pero esto no nos impide desarrollar y soportar muchas otras transformaciones igualmente √∫tiles. </p><br><h3 id="kak-putout-ustroen-iznutri">  C√≥mo funciona Putout adentro </h3><br><p>  <code>putout</code> trabajo de <code>putout</code> se puede dividir en dos partes: motor y complementos.  Esta arquitectura le permite no distraerse con las transformaciones cuando trabaje con el motor, y cuando trabaje en complementos, se centrar√° lo m√°s posible en su prop√≥sito. </p><br><h4 id="vstroennye-plaginy">  Complementos incorporados </h4><br><p>  <code>putout</code> se basa en un sistema de complemento.  Cada complemento representa una regla.  Usando las reglas integradas, puede hacer lo siguiente: </p><br><ul><li><p>  Encuentra y elimina: </p><br><ul><li>  variables no utilizadas </li><li> <code>debugger</code> </li> <li>  llamada <code>test.only</code> </li><li>  llamada <code>test.skip</code> </li><li>  llame a <code>console.log</code> </li><li>  <code>process.exit</code> llamada <code>process.exit</code> </li><li>  bloques vac√≠os </li><li>  patrones vac√≠os </li></ul><br></li><li><p>  Encontrar y dividir declaraci√≥n de variable: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var one, two; //  var one; var two;</span></span></code> </pre> <br></li><li><p>  Convierte <code>commonjs</code> a <code>commonjs</code> : </p><br></li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//  import one from 'one'; //  const one = require('one');</span></span></code> </pre> <br><ul><li>  Aplicar desestructuraci√≥n: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const name = user.name; //  const {name} = user;</span></span></code> </pre> <br><ol><li>  Combina propiedades de desestructuraci√≥n: </li></ol><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const {name} = user; const {password} = user; //  const { name, password } = user;</span></span></code> </pre> <br><p>  Cada complemento se construye de acuerdo con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">filosof√≠a de Unix</a> , es decir, son lo m√°s simples posible, cada uno realiza una acci√≥n, lo que los hace f√°ciles de combinar, ya que son, en esencia, filtros. </p><br><p>  Por ejemplo, tener el siguiente c√≥digo: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = user.name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = user.password;</code> </pre> <br><p>  Primero se convierte utilizando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">apply-destructuring</a> para: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {name} = user; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {password} = user;</code> </pre> <br><p>  Luego, usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">merge-destructuring-properties, se</a> convierte a: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { name, password } = user;</code> </pre> <br><p>  Por lo tanto, los complementos pueden funcionar tanto por separado como juntos.  Al crear sus propios complementos, se recomienda cumplir con esta regla e implementar un complemento con una funcionalidad m√≠nima, haciendo solo lo que necesita, y los complementos integrados y personalizados se encargar√°n del resto. </p><br><h4 id="primer-ispolzovaniya">  Ejemplo de uso </h4><br><p>  Despu√©s de familiarizarnos con las reglas integradas, podemos considerar un ejemplo usando <code>putout</code> . <br>  Cree un archivo <code>example.js</code> con los siguientes contenidos: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span>, y = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = user.name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = user.password; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(name, password);</code> </pre> <br><p>  Ahora ejecute <code>putout</code> pasando <code>example.js</code> como argumento: </p><br><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout example.js /home/coderaiser/example/example.js 1:6 error "x" is defined but never used remove-unused-variables 1:13 error "y" is defined but never used remove-unused-variables 6:0 error Unexpected "console" call remove-console 1:0 error variables should be declared separately split-variable-declarations 3:6 error Object destructuring should be used apply-destructuring 4:6 error Object destructuring should be used apply-destructuring 6 errors in 1 files fixable with the `--fix` option</code> </pre> <br><p>  Recibiremos informaci√≥n que contiene 6 errores, considerados con m√°s detalle anteriormente, ahora los corregiremos y veremos qu√© sucedi√≥: </p><br><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout example.js --fix coderaiser@cloudcmd:~/example$ cat example.js const { name, password } = user;</code> </pre> <br><p>  Como resultado de la correcci√≥n, se eliminaron las variables no utilizadas y las llamadas de <code>console.log</code> , y tambi√©n se aplic√≥ la desestructuraci√≥n. </p><br><h4 id="nastroyki">  Configuraciones </h4><br><p>  La configuraci√≥n predeterminada puede no siempre y no para todos, por lo que <code>putout</code> admite el archivo de configuraci√≥n <code>.putout.json</code> , consta de las siguientes secciones: </p><br><ul><li>  Reglas </li><li>  Ignorar </li><li>  Partido </li><li>  Complementos </li></ul><br><h5 id="rules">  Reglas </h5><br><p>  La secci√≥n de <code>rules</code> contiene un sistema de reglas.  Las reglas, por defecto, se establecen de la siguiente manera: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-unused-variables"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-debugger"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-only"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-skip"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-console"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"split-variable-declarations"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-empty"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-empty-pattern"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"convert-esm-to-commonjs"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"apply-destructuring"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"merge-destructuring-properties"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Para habilitar <code>remove-process-exit</code> simplemente <code>.putout.json</code> <code>true</code> en el archivo <code>.putout.json</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Esto ser√° suficiente para informar todas las llamadas a <code>process.exit</code> encontradas en el c√≥digo y eliminarlas si se <code>--fix</code> opci√≥n <code>--fix</code> . </p><br><h5 id="ignore">  Ignorar </h5><br><p>  Si necesita agregar algunas carpetas a la lista de excepciones, simplemente agregue la secci√≥n de <code>ignore</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"ignore"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"test/fixture"</span></span> ] }</code> </pre> <br><h5 id="match">  Partido </h5><br><p>  Si necesita un sistema ramificado de reglas, por ejemplo, habilite <code>process.exit</code> para el directorio <code>bin</code> , solo use la secci√≥n de <code>match</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"match"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"bin"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } } }</code> </pre> <br><h5 id="plugins">  Complementos </h5><br><p>  Si utiliza complementos que no est√°n integrados y tienen el prefijo <code>putout-plugin-</code> , debe incluirlos en la secci√≥n de <code>plugins</code> antes de activarlos en la secci√≥n de <code>rules</code> .  Por ejemplo, para conectar el <code>putout-plugin-add-hello-world</code> y habilitar la regla <code>add-hello-world</code> , solo especifique: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"add-hello-world"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"add-hello-world"</span></span> ] }</code> </pre> <br><h4 id="dvizhok-putout">  Motor de apagado </h4><br><p>  El motor de <code>putout</code> es una herramienta de l√≠nea de comandos que lee configuraciones, analiza archivos, carga y ejecuta complementos, y luego escribe el resultado de los complementos. </p><br><p>  Utiliza la biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">refundici√≥n</a> , que ayuda a llevar a cabo una tarea muy importante: despu√©s de analizar y transformar, recopilar el c√≥digo en un estado lo m√°s similar posible al anterior. </p><br><p>  Para el an√°lisis, se <code>ESTree</code> un analizador compatible con <code>ESTree</code> ( <code>babel</code> est√° actualmente con el complemento <code>estree</code> , pero los cambios son posibles en el futuro), y las herramientas de <code>babel</code> se utilizan para la transformaci√≥n.  ¬øPor qu√© exactamente <code>babel</code> ?  Todo es simple  El hecho es que este es un producto muy popular, mucho m√°s popular que otras herramientas similares, y se est√° desarrollando mucho m√°s r√°pido.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cada nueva propuesta en el est√°ndar EcmaScript no est√° completa sin un complemento de babel</a> .  <a href="">Babel tambi√©n</a> tiene un libro, <a href="">Babel Handbook</a> , que describe muy bien todas las caracter√≠sticas y herramientas para atravesar y transformar un √°rbol AST. </p><br><h4 id="svoy-plagin-dlya-putout">  Complemento personalizado para Putout </h4><br><p>  El sistema de complementos de <code>putout</code> es bastante simple y muy similar a los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complementos de Eslint</a> , as√≠ como a los <a href="">complementos de Babel</a> .  Es cierto que en lugar de una funci√≥n, <code>putout</code> plugin deber√≠a exportar 3. Esto se hace para aumentar la reutilizaci√≥n del c√≥digo, ya que duplicar la funcionalidad en 3 funciones no es muy conveniente, es mucho m√°s f√°cil ponerlo en funciones separadas y simplemente llamarlo en los lugares correctos. </p><br><h5 id="struktura-plagina">  Estructura del complemento </h5><br><p>  Por lo <code>Putout</code> complemento <code>Putout</code> consta de 3 funciones: </p><br><ul><li>  <code>report</code> : devuelve un mensaje; </li><li>  <code>find</code> : busca lugares con errores y los devuelve; </li><li>  <code>fix</code> - arregla estos lugares; </li></ul><br><p>  El punto principal a recordar al crear un complemento para <code>putout</code> es su nombre, debe comenzar con <code>putout-plugin-</code> .  El siguiente puede ser el nombre de la operaci√≥n que realiza el complemento, por ejemplo, el complemento <code>remove-wrong</code> deber√≠a llamarse as√≠: <code>putout-plugin-remove-wrong</code> . </p><br><p>  Tambi√©n debe agregar las palabras: <code>putout</code> y <code>putout-plugin</code> a la secci√≥n <code>package.json</code> en la secci√≥n de <code>keywords</code> y especificar <code>"putout": "&gt;=3.10"</code> en <code>peerDependencies</code> <code>"putout": "&gt;=3.10"</code> , o la versi√≥n que ser√° la √∫ltima en el momento de escribir el complemento. </p><br><h5 id="primer-plagina-dlya-putout">  Plugin de muestra para Putout </h5><br><p>  Escribamos un complemento de ejemplo que eliminar√° la palabra <code>debugger</code> del c√≥digo.  Tal complemento ya existe, es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@ putout / plugin-remove-debugger</a> y es lo suficientemente simple como para considerarlo ahora. </p><br><p>  Se ve as√≠: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//        module.exports.report = () =&gt; 'Unexpected "debugger" statement'; //     ,  debugger    Visitor module.exports.find = (ast, {traverse}) =&gt; { const places = []; traverse(ast, { DebuggerStatement(path) { places.push(path); } }); return places; }; //  ,     module.exports.fix = (path) =&gt; { path.remove(); };</span></span></code> </pre> <br><p>  Si la regla <code>remove-debugger</code> est√° incluida en <code>.putout.json</code> , se <code>.putout.json</code> el <code>@putout/plugin-remove-debugger</code> .  Primero, se llama a la funci√≥n de <code>find</code> que, utilizando la funci√≥n <code>traverse</code> , omitir√° los nodos del √°rbol AST y guardar√° todos los lugares necesarios. </p><br><p>  El siguiente paso se convertir√° en <code>report</code> para obtener el mensaje deseado. </p><br><p>  Si se <code>--fix</code> indicador <code>--fix</code> , se <code>--fix</code> la funci√≥n de <code>fix</code> del complemento y se realizar√° la transformaci√≥n, en este caso, se eliminar√° el nodo. </p><br><h5 id="primer-testa-plagina">  Ejemplo de prueba de complemento </h5><br><p>  Para simplificar la prueba de complementos, se escribi√≥ la herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@ putout / test</a> .  En esencia, no es m√°s que una envoltura sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cinta</a> , con varios m√©todos para la conveniencia y simplificaci√≥n de las pruebas. </p><br><p>  La prueba para el complemento <code>remove-debugger</code> podr√≠a verse as√≠: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> removeDebugger = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'..'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> test = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@putout/test'</span></span>)(__dirname, { <span class="hljs-string"><span class="hljs-string">'remove-debugger'</span></span>: removeDebugger, }); <span class="hljs-comment"><span class="hljs-comment">//        test('remove debugger: report', (t) =&gt; { t.reportCode('debugger', 'Unexpected "debugger" statement'); t.end(); }); //    test('remove debugger: transformCode', (t) =&gt; { t.transformCode('debugger', ''); t.end(); });</span></span></code> </pre> <br><h5 id="codemods">  Codemods </h5><br><p>  No todas las transformaciones deben usarse todos los d√≠as, para las transformaciones de una sola vez es suficiente hacer lo mismo, pero en lugar de publicar en <code>npm</code> col√≥quelo en la <code>~/.putout</code> .  Al inicio, el aspecto se ver√° en esta carpeta, se iniciar√° la transformaci√≥n. </p><br><p>  Aqu√≠ hay un ejemplo de transformaci√≥n que reemplaza la <code>tape</code> y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conexi√≥n de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">prueba a cinta</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">con una</a> llamada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">supertape</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">convert-tape-to-supertape</a> . </p><br><h3 id="eslint-plugin-putout">  eslint-plugin-putout </h3><br><p>  Al final, vale la pena agregar un punto: <code>putout</code> intenta cambiar el c√≥digo m√≠nimamente, pero si le sucede a un amigo que se rompen algunas reglas de formato, eslint --fix siempre est√° listo para <code>eslint --fix</code> , y para este prop√≥sito hay un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complemento</a> especial de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">eslint-plugin-putout</a> .  Puede aclarar muchos errores de formato y, por supuesto, se puede personalizar de acuerdo con las preferencias de los desarrolladores en un proyecto espec√≠fico.  Conectarlo es f√°cil: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:putout/recommended"</span></span>, ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"putout"</span></span> ] }</code> </pre> <br><p>  Hasta ahora, solo hay una regla: <code>one-line-destructuring</code> , hace lo siguiente: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const { one } = hello; //  const {one} = hello;</span></span></code> </pre> <br><p>  Hay muchas m√°s reglas de inclusi√≥n incluidas con las que puede familiarizarse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">con m√°s detalle</a> . </p><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>  Quiero agradecer al lector por la atenci√≥n prestada a este texto.  Espero sinceramente que el tema de las transformaciones de AST se vuelva m√°s popular, y que los art√≠culos sobre este fascinante proceso aparezcan con mayor frecuencia.  Estar√≠a muy agradecido por cualquier comentario y sugerencia relacionada con el desarrollo posterior de la <code>putout</code> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cree un problema</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">env√≠e un grupo de solicitudes</a> , pruebe, escriba qu√© reglas le gustar√≠a ver y c√≥mo programar su c√≥digo mediante programaci√≥n, trabajaremos juntos para mejorar la herramienta de transformaci√≥n AST. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439564/">https://habr.com/ru/post/439564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439552/index.html">Extensiones maliciosas de Chrome</a></li>
<li><a href="../439556/index.html">TDMS Fairway. Metodolog√≠as PMBOK y organizaciones de dise√±o rusas.</a></li>
<li><a href="../439558/index.html">Nuevo tel√©fono viejo. Reinventar el tel√©fono PSTN</a></li>
<li><a href="../439560/index.html">Adaptador Ethereum blockchain para la plataforma de datos InterSystems IRIS</a></li>
<li><a href="../439562/index.html">Configure el cl√∫ster Kubernetes HA en metal desnudo con kubeadm. Parte 1/3</a></li>
<li><a href="../439566/index.html">Por qu√© es importante la documentaci√≥n de SRE. Parte 3</a></li>
<li><a href="../439568/index.html">SSD basados ‚Äã‚Äãen QLC: ¬øun asesino del disco duro? No realmente</a></li>
<li><a href="../439570/index.html">Magia de IPython para editar etiquetas de celda de Jupyter</a></li>
<li><a href="../439572/index.html">Dise√±o asistido por computadora de equipos electr√≥nicos.</a></li>
<li><a href="../439574/index.html">Protocolo SmartCard I2C. Intercambie comandos APDU a trav√©s de la interfaz I2C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>