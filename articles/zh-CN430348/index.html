<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‡ ğŸ§œ ğŸ§“ğŸ» OpenSceneGraphï¼šå°è£…OpenGLçŠ¶æ€æœº ğŸ§” ğŸ”® ğŸ’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 é€šå¸¸ï¼Œåœ¨ä½¿ç”¨æ¸²æŸ“å‚æ•°æ—¶ï¼ŒOpenGLå……å½“çŠ¶æ€æœºã€‚ æ¸²æŸ“çŠ¶æ€æ˜¯çŠ¶æ€å±æ€§çš„é›†åˆï¼Œä¾‹å¦‚é€šè¿‡glEnableï¼ˆï¼‰å’ŒglDisableï¼ˆï¼‰å‡½æ•°æ‰“å¼€å’Œå…³é—­çš„å…‰æºï¼Œæè´¨ï¼Œçº¹ç†å’Œæ˜¾ç¤ºæ¨¡å¼ã€‚ è®¾ç½®ç‰¹å®šçŠ¶æ€åï¼Œè¯¥çŠ¶æ€å°†ä¸€ç›´æœ‰æ•ˆï¼Œç›´åˆ°å…¶ä»–åŠŸèƒ½å¯¹å…¶è¿›è¡Œæ›´æ”¹ä¸ºæ­¢ã€‚ OpenGLç®¡é“æ”¯æŒçŠ¶æ€å †æ ˆï¼Œç”¨äºåœ¨ä»»ä½•ç»™å®šæ—¶é—´ä¿...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OpenSceneGraphï¼šå°è£…OpenGLçŠ¶æ€æœº</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430348/"><img src="https://habrastorage.org/webt/py/ks/3w/pyks3wlvjf_zfef-sqocutbnimk.jpeg" alt="å›¾ç‰‡"><br><h1> å¼•è¨€ </h1><br> é€šå¸¸ï¼Œåœ¨ä½¿ç”¨æ¸²æŸ“å‚æ•°æ—¶ï¼ŒOpenGLå……å½“çŠ¶æ€æœºã€‚ æ¸²æŸ“çŠ¶æ€æ˜¯çŠ¶æ€å±æ€§çš„é›†åˆï¼Œä¾‹å¦‚é€šè¿‡glEnableï¼ˆï¼‰å’ŒglDisableï¼ˆï¼‰å‡½æ•°æ‰“å¼€å’Œå…³é—­çš„å…‰æºï¼Œæè´¨ï¼Œçº¹ç†å’Œæ˜¾ç¤ºæ¨¡å¼ã€‚ è®¾ç½®ç‰¹å®šçŠ¶æ€åï¼Œè¯¥çŠ¶æ€å°†ä¸€ç›´æœ‰æ•ˆï¼Œç›´åˆ°å…¶ä»–åŠŸèƒ½å¯¹å…¶è¿›è¡Œæ›´æ”¹ä¸ºæ­¢ã€‚  OpenGLç®¡é“æ”¯æŒçŠ¶æ€å †æ ˆï¼Œç”¨äºåœ¨ä»»ä½•ç»™å®šæ—¶é—´ä¿å­˜å’Œè¿˜åŸçŠ¶æ€ã€‚ çŠ¶æ€æœºä½¿å¼€å‘äººå‘˜å¯ä»¥å®Œå…¨æ§åˆ¶å †æ ˆä¸Šçš„å½“å‰å’Œä¿å­˜çš„æ¸²æŸ“çŠ¶æ€ã€‚ <br><br> ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•åœ¨ä½¿ç”¨OSGæ—¶å¾ˆä¸æ–¹ä¾¿ã€‚ å› æ­¤ï¼ŒOpenGLçŠ¶æ€æœºç”±osg :: StateSetç±»å°è£…ï¼Œè¯¥ç±»è´Ÿè´£å¤„ç†çŠ¶æ€å †æ ˆå¹¶åœ¨éå†åœºæ™¯å›¾æ—¶å¯¹å…¶è¿›è¡Œè®¾ç½®ã€‚ <br><a name="habracut"></a><br>  osg :: StateSetç±»çš„å®ä¾‹åŒ…å«å„ç§æ¸²æŸ“çŠ¶æ€çš„å­é›†ï¼Œå¹¶å¯ä»¥ä½¿ç”¨setStateSetï¼ˆï¼‰æ–¹æ³•å°†å…¶åº”ç”¨äºosg :: Nodeåœºæ™¯èŠ‚ç‚¹å’Œosg :: Drawableå‡ ä½•å¯¹è±¡ <br><br><pre><code class="cpp hljs">osg::StateSet *stateset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::StateSet; node-&gt;setStateSet(stateset);</code> </pre> <br> ä¸€ç§æ›´å®‰å…¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨getOrCreateStateSetï¼ˆï¼‰æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¿è¯è¿”å›æ­£ç¡®çš„çŠ¶æ€åŠå…¶å¯¹èŠ‚ç‚¹æˆ–å¯ç»˜åˆ¶å¯¹è±¡çš„é™„åŠ  <br><br><pre> <code class="cpp hljs">osg::StateSet *stateset = node-&gt;getOrCreateStateSet();</code> </pre><br>  osg :: Nodeå’Œosg :: Drawableç±»é€šè¿‡æ™ºèƒ½æŒ‡é’ˆosg :: ref_ptr &lt;&gt;æ§åˆ¶æˆå‘˜å˜é‡osg :: StateSetã€‚ è¿™æ„å‘³ç€å¯ä»¥åœ¨åœºæ™¯ä¸­çš„å¤šä¸ªå¯¹è±¡ä¹‹é—´åˆ’åˆ†ä¸€ç»„çŠ¶æ€ï¼Œå¹¶ä¸”åªæœ‰åœ¨æ‰€æœ‰è¿™äº›å¯¹è±¡éƒ½è¢«é”€æ¯æ—¶æ‰ä¼šè¢«é”€æ¯ã€‚ <br><br><h1>  1.å±æ€§å’Œæ¨¡å¼ </h1><br>  OSGå®šä¹‰äº†osg :: StateAttributeç±»ï¼Œç”¨äºå­˜å‚¨æ¸²æŸ“å±æ€§ã€‚ è¿™æ˜¯ä¸€ä¸ªè™šæ‹ŸåŸºç±»ï¼Œå®ƒç”±å„ç§æ¸²æŸ“å±æ€§ï¼ˆä¾‹å¦‚ç¯å…‰ï¼Œæè´¨å’Œé›¾ï¼‰ç»§æ‰¿ã€‚ <br><br> æ¸²æŸ“æ¨¡å¼å°±åƒå¯ä»¥æ‰“å¼€å’Œå…³é—­çš„å¼€å…³ä¸€æ ·å·¥ä½œã€‚ æ­¤å¤–ï¼Œå®ƒä»¬ä¸æšä¸¾å™¨å…³è”ï¼Œè¯¥æšä¸¾å™¨ç”¨äºæŒ‡ç¤ºOpenGLæ¨¡å¼çš„ç±»å‹ã€‚ æœ‰æ—¶ï¼Œæ¸²æŸ“æ¨¡å¼ä¸å±æ€§ç›¸å…³è”ï¼Œä¾‹å¦‚ï¼ŒGL_LIGHTINGæ¨¡å¼åŒ…å«ç”¨äºå…‰æºçš„å˜é‡ï¼Œè¿™äº›å˜é‡åœ¨æ‰“å¼€æ—¶å°†å‘é€åˆ°OpenGLç®¡é“ï¼Œå¦åˆ™å°†å…³é—­ç…§æ˜ã€‚ <br><br>  osg :: StateSetç±»å°†å±æ€§å’Œæ¨¡å¼åˆ†ä¸ºä¸¤ç»„ï¼šçº¹ç†å’Œéçº¹ç†ã€‚ å®ƒå…·æœ‰å‡ ç§ç”¨äºå°†éçº¹ç†å±æ€§å’Œæ¨¡å¼æ·»åŠ åˆ°ä¸€ç»„çŠ¶æ€çš„å…¬å…±æ–¹æ³•ï¼š <br><br><ol><li>  setAttributeï¼ˆï¼‰-å°†ç±»å‹ä¸ºosg :: StateAttributeçš„å¯¹è±¡æ·»åŠ åˆ°çŠ¶æ€é›†ä¸­ã€‚ ç›¸åŒç±»å‹çš„å±æ€§ä¸èƒ½åœ¨åŒä¸€çŠ¶æ€é›†ä¸­å…±å­˜ã€‚ å…ˆå‰çš„è®¾å®šç‚¹å°†è¢«æ–°çš„è®¾å®šç‚¹è¦†ç›–ã€‚ <br></li><li>  setModeï¼ˆï¼‰-å°†æ¨¡å¼æšä¸¾å™¨é™„åŠ åˆ°ä¸€ç»„çŠ¶æ€ï¼Œå¹¶å°†å…¶å€¼è®¾ç½®ä¸ºosg :: StateAttribute :: :: ONæˆ–osg :: StateAttribute :: OFFï¼Œè¿™æ„å‘³ç€å¯ç”¨æˆ–ç¦ç”¨è¯¥æ¨¡å¼ã€‚ <br></li><li>  setAttributeAndModesï¼ˆï¼‰-é™„åŠ æ¸²æŸ“å±æ€§åŠå…¶å…³è”æ¨¡å¼ï¼Œå¹¶è®¾ç½®å¼€å…³çš„å€¼ï¼ˆé»˜è®¤ä¸ºONï¼‰ã€‚ åº”è¯¥è®°ä½çš„æ˜¯ï¼Œå¹¶éæ¯ä¸ªå±æ€§éƒ½æœ‰å¯¹åº”çš„æ¨¡å¼ï¼Œä½†æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚ <br></li></ol><br> è¦è®¾ç½®å±æ€§åŠå…¶å…³è”æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç  <br><br><pre> <code class="cpp hljs">stateset-&gt;setAttributeAndModes(attr, osg::StateAttribute::ON);</code> </pre><br> è¦è®¾ç½®çº¹ç†å±æ€§ï¼Œå¿…é¡»ä¼ é€’ä¸€ä¸ªé™„åŠ å‚æ•°æ¥æŒ‡ç¤ºåº”å°†å…¶åº”ç”¨åˆ°çš„çº¹ç†ã€‚  Osg :: StateSetä¸ºæ­¤æä¾›äº†å…¶ä»–ä¸€äº›å…¬å…±æ–¹æ³•ï¼Œä¾‹å¦‚setTextureAttributeï¼ˆï¼‰ï¼ŒsetTextureModeï¼ˆï¼‰å’ŒsetTextureAttributeAndModesï¼ˆï¼‰ <br><br><pre> <code class="cpp hljs">stateset-&gt;setTextureAttributeAndModes(<span class="hljs-number"><span class="hljs-number">0</span></span>, textattr, osg::StateAttribute::ON);</code> </pre><br> å°†textattrå±æ€§åº”ç”¨äºæ ‡è¯†ç¬¦ä¸º0çš„çº¹ç†ã€‚ <br><br><h1>  2.è®¾ç½®åœºæ™¯èŠ‚ç‚¹çš„å¤šè¾¹å½¢æ˜¾ç¤ºæ¨¡å¼ </h1><br> æˆ‘ä»¬ä»¥ä¸€ä¸ªå®é™…ç¤ºä¾‹è¯´æ˜ä¸Šè¿°ç†è®º-ä½¿ç”¨osg :: PolygonModeç±»æ›´æ”¹OpenGLå¤šè¾¹å½¢çš„æ …æ ¼åŒ–æ¨¡å¼ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªosg :: StateAttributeã€‚ æ­¤ç±»å°è£…äº†glPolygonModeï¼ˆï¼‰å‡½æ•°ï¼Œå¹¶æä¾›äº†ç”¨äºè®¾ç½®ç‰¹å®šåœºæ™¯èŠ‚ç‚¹çš„å¤šè¾¹å½¢æ˜¾ç¤ºæ¨¡å¼çš„æ¥å£ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¤šè¾¹å½¢æ¨¡å¼ç¤ºä¾‹</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/PolygonMode&gt; #include &lt;osg/MatrixTransform&gt; #include &lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg::Node&gt; model = osgDB::readNodeFile("../data/cessna.osg"); osg::ref_ptr&lt;osg::MatrixTransform&gt; transform1 = new osg::MatrixTransform; transform1-&gt;setMatrix(osg::Matrix::translate(-25.0f, 0.0f, 0.0f)); transform1-&gt;addChild(model.get()); osg::ref_ptr&lt;osg::MatrixTransform&gt; transform2 = new osg::MatrixTransform; transform2-&gt;setMatrix(osg::Matrix::translate(25.0f, 0.0f, 0.0f)); transform2-&gt;addChild(model.get()); osg::ref_ptr&lt;osg::PolygonMode&gt; pm = new osg::PolygonMode; pm-&gt;setMode(osg::PolygonMode::FRONT_AND_BACK, osg::PolygonMode::LINE); transform1-&gt;getOrCreateStateSet()-&gt;setAttribute(pm.get()); osg::ref_ptr&lt;osg::Group&gt; root = new osg::Group; root-&gt;addChild(transform1.get()); root-&gt;addChild(transform2.get()); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸Šä¼ äº†æˆ‘ä»¬æœ€çˆ±çš„å¡æ–¯çº³çš„æ¨¡å‹ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†è½¬æ¢ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¯¥æ¨¡å‹çš„ä¸¤ä¸ªå®ä¾‹ã€‚ å¯¹äºå…¶ä¸­ä¸€ä¸ªï¼Œåœ¨å·¦ä¾§ï¼Œæˆ‘ä»¬åº”ç”¨ä¸€ä¸ªå±æ€§ï¼Œè¯¥å±æ€§è®¾ç½®å¤šè¾¹å½¢çš„çº¿æ¡†æ˜¾ç¤ºæ¨¡å¼ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::PolygonMode&gt; pm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::PolygonMode; pm-&gt;setMode(osg::PolygonMode::FRONT_AND_BACK, osg::PolygonMode::LINE); transform1-&gt;getOrCreateStateSet()-&gt;setAttribute(pm.get());</code> </pre><br><img src="https://habrastorage.org/webt/pg/v5/ew/pgv5ewaulc_tfjztw5h8gyyap1i.png"><br><br> å¦‚æœæˆ‘ä»¬è½¬å‘OpenGLè§„èŒƒï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æƒ³è±¡åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ä½¿ç”¨setModeï¼ˆï¼‰æ—¶å¯ä»¥ä½¿ç”¨å“ªäº›å¤šè¾¹å½¢æ˜¾ç¤ºé€‰é¡¹ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨å€¼osg :: PolygonMode :: FRONTï¼ŒBACKå’ŒFRONT_AND_BACKï¼Œä¸OpenGLæšä¸¾å™¨GL_FRONTï¼ŒGL_BACKï¼ŒGL_FRONT_AND_BACKå¯¹åº”ã€‚ ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨å€¼osg :: PolygonMode :: POINTï¼ŒLINEå’ŒFILLï¼Œå®ƒä»¬å¯¹åº”äºGL_POINTï¼ŒGL_LINEå’ŒGL_FILLã€‚ è¿™é‡Œä¸éœ€è¦å…¶ä»–æŠ€å·§ï¼Œè€Œåœ¨çº¯OpenGLä¸Šå¼€å‘æ—¶é€šå¸¸ä¸éœ€è¦è¿™ç§æŠ€å·§-OSGè´Ÿè´£å¤§éƒ¨åˆ†å·¥ä½œã€‚ å¤šè¾¹å½¢æ˜¾ç¤ºæ¨¡å¼æ²¡æœ‰å…³è”çš„æ¨¡å¼ï¼Œä¸éœ€è¦è°ƒç”¨glEnableï¼ˆï¼‰/ glDisableï¼ˆï¼‰å¯¹ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒsetAttributeAndModesï¼ˆï¼‰æ–¹æ³•ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯å…¶ç¬¬ä¸‰ä¸ªå‚æ•°çš„å€¼å°†æ— ç”¨ã€‚ <br><br><h1>  3.æ¸²æŸ“çŠ¶æ€çš„ç»§æ‰¿ã€‚ åº”ç”¨å±æ€§å’Œæ¨¡å¼ </h1><br> èŠ‚ç‚¹çŠ¶æ€é›†ä¼šå½±å“å½“å‰èŠ‚ç‚¹åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹ã€‚ ä¾‹å¦‚ï¼Œä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­ä¸ºtransform1è®¾ç½®çš„osg :: PolygonModeå±æ€§å°†åº”ç”¨äºè¯¥èŠ‚ç‚¹çš„æ‰€æœ‰å­çº§ã€‚ ä½†æ˜¯ï¼Œå­èŠ‚ç‚¹å¯ä»¥è¦†ç›–çˆ¶å±æ€§ï¼Œå³ï¼Œå¦‚æœå­èŠ‚ç‚¹ä¸æ›´æ”¹è¡Œä¸ºï¼Œåˆ™æ¸²æŸ“çŠ¶æ€å°†ä»çˆ¶èŠ‚ç‚¹ç»§æ‰¿ã€‚ <br><br> æœ‰æ—¶æ‚¨éœ€è¦æ ¹æ®å±æ€§ä½¿ç”¨æƒ…å†µé‡æ–°å®šä¹‰èŠ‚ç‚¹çš„è¡Œä¸ºã€‚ ä¾‹å¦‚ï¼Œåœ¨å¤§å¤šæ•°3Dç¼–è¾‘å™¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªæ¨¡å‹å¹¶åŒæ—¶æ›´æ”¹æ‰€æœ‰å·²åŠ è½½æ¨¡å‹çš„æ˜¾ç¤ºæ¨¡å¼ï¼Œè€Œä¸ç®¡å®ƒä»¬ä¹‹å‰çš„æ˜¾ç¤ºæ–¹å¼å¦‚ä½•ã€‚ æ¢å¥è¯è¯´ï¼Œç¼–è¾‘å™¨ä¸­çš„æ‰€æœ‰æ¨¡å‹éƒ½å¿…é¡»ç»§æ‰¿ä¸€ä¸ªå±æ€§ï¼Œè€Œä¸ç®¡å…ˆå‰ä¸ºæ¯ä¸ªæ¨¡å‹å¦‚ä½•è®¾ç½®å®ƒä»¬ã€‚ åœ¨OSGä¸­ï¼Œè¿™å¯ä»¥ä½¿ç”¨osg :: StateAttribute :: :: OVERRIDEæ ‡å¿—å®ç°ã€‚ <br><br><pre> <code class="cpp hljs">stateset-&gt;StateAttribute(attr, osg::StateAttribute::OVERRIDE);</code> </pre><br> åœ¨è®¾ç½®æ¨¡å¼å’Œå…·æœ‰å±æ€§çš„æ¨¡å¼æ—¶ï¼Œä½¿ç”¨æŒ‰ä½æˆ–è¿ç®—ç¬¦ <br><br><pre> <code class="cpp hljs">stateset-&gt;StateAttributeAndModes(attr, osg::StateAttribute::ON | osg::StateAttribute::OVERRIDE);</code> </pre><br> æ­¤å¤–ï¼Œè¿˜å¯ä»¥é˜²æ­¢è¦†ç›–å±æ€§-ä¸ºæ­¤ï¼Œå¿…é¡»ä½¿ç”¨osg :: StateAttribute :: PROTECTEDæ ‡å¿—å¯¹å…¶è¿›è¡Œæ ‡è®°ã€‚ <br><br> ç¬¬ä¸‰ä¸ªæ ‡å¿—osg :: StateAttribute :: INHERITï¼Œç”¨äºæŒ‡ç¤ºè¯¥å±æ€§åº”ä»çˆ¶èŠ‚ç‚¹çš„çŠ¶æ€é›†ç»§æ‰¿ã€‚ <br><br> è¿™æ˜¯ä½¿ç”¨OVERRIDEå’ŒPROTECTEDæ ‡å¿—çš„ç®€çŸ­ç¤ºä¾‹ã€‚ æ ¹èŠ‚ç‚¹å°†è®¾ç½®ä¸ºOVERRIDEï¼Œä»¥å¼ºåˆ¶æ‰€æœ‰å­èŠ‚ç‚¹ç»§æ‰¿å…¶å±æ€§å’Œæ¨¡å¼ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå­èŠ‚ç‚¹å°†å°è¯•åœ¨æœ‰æˆ–æ²¡æœ‰PROTECTEDæ ‡å¿—çš„å¸®åŠ©ä¸‹æ›´æ”¹å…¶çŠ¶æ€ï¼Œè¿™å°†å¯¼è‡´ä¸åŒçš„ç»“æœã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç»§æ‰¿ç¤ºä¾‹æ–‡æœ¬</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/PolygonMode&gt; #include &lt;osg/MatrixTransform&gt; #include &lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg::Node&gt; model = osgDB::readNodeFile("../data/glider.osg"); osg::ref_ptr&lt;osg::MatrixTransform&gt; transform1 = new osg::MatrixTransform; transform1-&gt;setMatrix(osg::Matrix::translate(-0.5f, 0.0f, 0.0f)); transform1-&gt;addChild(model.get()); osg::ref_ptr&lt;osg::MatrixTransform&gt; transform2 = new osg::MatrixTransform; transform2-&gt;setMatrix(osg::Matrix::translate(0.5f, 0.0f, 0.0f)); transform2-&gt;addChild(model.get()); osg::ref_ptr&lt;osg::Group&gt; root = new osg::Group; root-&gt;addChild(transform1.get()); root-&gt;addChild(transform2.get()); transform1-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHTING, osg::StateAttribute::OFF); transform2-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHTING, osg::StateAttribute::OFF | osg::StateAttribute::PROTECTED); root-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHTING, osg::StateAttribute::ON | osg::StateAttribute::OVERRIDE); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/lf/8h/u4/lf8hu4n3ii1bor6lgsktbischd0.png"><br><br> è¦äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæ‚¨éœ€è¦ä¸‹è½½å…¨æ—¶OSG osgviewerï¼Œä»¥æŸ¥çœ‹å¸¸äº®çš„æ‚¬æŒ‚å¼æ»‘ç¿”æœºçš„å¤–è§‚ <br><br><pre> <code class="bash hljs">$ osgviewer glider.osg</code> </pre><br> åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾é€šè¿‡å®Œå…¨å…³é—­ç…§æ˜æ¥æ›´æ”¹transform1å’Œtransform2èŠ‚ç‚¹çš„ç…§æ˜æ¨¡å¼ã€‚ <br><br><pre> <code class="cpp hljs">transform1-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHTING, osg::StateAttribute::OFF); transform2-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHTING, osg::StateAttribute::OFF | osg::StateAttribute::PROTECTED);</code> </pre><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ºæ ¹èŠ‚ç‚¹æ‰“å¼€ç…§æ˜æ¨¡å¼ï¼Œå¹¶ä¸ºå…¶æ‰€æœ‰å­èŠ‚ç‚¹ä½¿ç”¨OVERRIDEæ ‡å¿—ï¼Œä»¥ä¾¿å®ƒä»¬ç»§æ‰¿æ ¹èŠ‚ç‚¹çš„çŠ¶æ€ã€‚ ä½†æ˜¯ï¼Œtrnsform2ä½¿ç”¨PROTECTEDæ ‡å¿—æ¥é˜²æ­¢å½±å“æ ¹èŠ‚ç‚¹è®¾ç½®ã€‚ <br><br><pre> <code class="cpp hljs">transform2-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHTING, osg::StateAttribute::OFF | osg::StateAttribute::PROTECTED);</code> </pre><br> ç»“æœï¼Œå°½ç®¡äº‹å®ä¸Šæˆ‘ä»¬å·²å…³é—­äº†transform1èŠ‚ç‚¹å¤„çš„ç…§æ˜ï¼Œä½†ç”±äºåœºæ™¯æ ¹çš„è®¾ç½®é˜»æ­¢äº†æˆ‘ä»¬ä¸ºå…¶å°è¯•å…³é—­ç…§æ˜çš„å°è¯•ï¼Œå› æ­¤å·¦ä¾§æ‚¬æŒ‚å¼æ»‘ç¿”æœºä»ç„¶ç‚¹äº®ã€‚ å³ä¾§æ‚¬æŒ‚å¼æ»‘ç¿”æœºåœ¨æ²¡æœ‰ç…§æ˜çš„æƒ…å†µä¸‹æ˜¾ç¤ºï¼ˆå®ƒçœ‹èµ·æ¥æ›´äº®ï¼Œä»…æ˜¯å› ä¸ºå®ƒè¢«ç®€å•çš„é¢œè‰²æ·¹æ²¡è€Œæ²¡æœ‰æ¸²æŸ“ç…§æ˜ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºä¿æŠ¤äº†transform2ä¸ä¼šç»§æ‰¿æ ¹èŠ‚ç‚¹çš„å±æ€§ã€‚ <br><br><h1>  4. OpenSceneGraphæ”¯æŒçš„OpenGLå±æ€§åˆ—è¡¨ </h1><br>  OSGé€šè¿‡ä»osg :: StateAttributeæ´¾ç”Ÿçš„ç±»æ”¯æŒOpenGLæ”¯æŒçš„å‡ ä¹æ‰€æœ‰å±æ€§å’Œæ¸²æŸ“æ¨¡å¼ã€‚ è¯¥è¡¨æ˜¾ç¤ºäº†å¯ä»å¼•æ“è·å¾—çš„OpenGLçŠ¶æ€æœºçš„æ‰€æœ‰å‚æ•°ã€‚ <br><table><thead><tr><th> å±æ€§ç±»å‹ID </th><th> ç±»å </th><th> å…³è”æ¨¡å¼ </th><th> ç­‰æ•ˆçš„OpenGLåŠŸèƒ½ </th></tr></thead><tbody><tr><td> é˜¿å°”æ³•èŠ¬ </td><td>  osg :: AlphaFunc </td><td>  GL_ALPHA_TEST </td><td>  glAlphaFuncï¼ˆï¼‰ </td></tr><tr><td> æ··åˆåŠŸèƒ½ </td><td>  osg :: BlendFunc </td><td>  GL_BLEND </td><td>  glBlendFuncï¼ˆï¼‰å’ŒglBlendFuncSeparateï¼ˆï¼‰ </td></tr><tr><td> å‰ªè¾‘å¹³é¢ </td><td>  osg :: ClipPlane </td><td>  GL_CLIP_PLANEiï¼ˆiä»1åˆ°5ï¼‰ </td><td>  glClipPlaneï¼ˆï¼‰ </td></tr><tr><td> è‰²æ¿ </td><td>  osg ::è‰²å½©é®ç½© </td><td>  -- </td><td>  glColorMaskï¼ˆï¼‰ </td></tr><tr><td> é¬¼è„¸ </td><td>  osg :: CullFace </td><td>  GL_CULLFACE </td><td>  glCullFaceï¼ˆï¼‰ </td></tr><tr><td> æ·±åº¦ </td><td>  osg ::æ·±åº¦ </td><td>  GL_DEPTH_TEST </td><td>  glDepthFuncï¼ˆï¼‰ï¼ŒglDepthRangeï¼ˆï¼‰å’ŒglDepthMaskï¼ˆï¼‰ </td></tr><tr><td> é›¾æ°” </td><td>  osg ::é›¾ </td><td>  GL_FOG </td><td>  glFogï¼ˆï¼‰ </td></tr><tr><td> å‰è„¸ </td><td>  osg :: FrontFace </td><td>  -- </td><td>  glFrontFaceï¼ˆï¼‰ </td></tr><tr><td> è½»ä¾¿ </td><td>  osg ::è½» </td><td>  GL_LIGHTiï¼ˆiä»1åˆ°7ï¼‰ </td><td>  glLightï¼ˆï¼‰ </td></tr><tr><td> ç¯å…‰æ¨¡å‹ </td><td>  osg :: LightModel </td><td>  -- </td><td>  glLightModelï¼ˆï¼‰ </td></tr><tr><td> çº¿å¸¦ </td><td>  osg :: LineStripple </td><td>  GL_LINE_STRIPPLE </td><td>  glLineStrippleï¼ˆï¼‰ </td></tr><tr><td> çº¿å®½ </td><td>  osg ::çº¿å®½ </td><td>  -- </td><td>  glLineWidhtï¼ˆï¼‰ </td></tr><tr><td> ç½—å‰ </td><td>  osg ::é€»è¾‘è¿ç®— </td><td>  GL_COLOR_LOGIC_OP </td><td>  glLogicOpï¼ˆï¼‰ </td></tr><tr><td> æè´¨ </td><td>  osg ::ææ–™ </td><td>  -- </td><td>  glMaterialï¼ˆï¼‰å’ŒglColorMaterialï¼ˆï¼‰ </td></tr><tr><td> è¦ç‚¹ </td><td>  osg ::ç‚¹ </td><td>  GL_POINT_SMOOTH </td><td>  glPointParameterï¼ˆï¼‰ </td></tr><tr><td> ç‚¹èµ </td><td>  osg :: PointSprite </td><td>  GL_POINT_SPRITE_ARB </td><td> ç”¨äºOpenGLç²¾çµçš„å‡½æ•° </td></tr><tr><td> å¤šè¾¹å½¢æ¨¡å¼ </td><td>  osg :: PolygonMode </td><td>  -- </td><td>  glPolygonModeï¼ˆï¼‰ </td></tr><tr><td> å¤šè¾¹å½¢åç§» </td><td>  osg :: PolygonOffset </td><td>  GL_POLYGON_OFFSET_POINT </td><td>  glPolygonOffsetï¼ˆï¼‰ </td></tr><tr><td> å¤šå¸¦ </td><td>  osg ::å¤šè¾¹å½¢æ¡çº¹ </td><td>  GL_POLYGON_STRIPPLE </td><td>  glPolygonStrippleï¼ˆï¼‰ </td></tr><tr><td> å‰ªåˆ€ </td><td>  osg ::å‰ªåˆ€ </td><td>  GL_SCISSOR_TEST </td><td>  glScissorï¼ˆï¼‰ </td></tr><tr><td> é˜´å½±æ¨¡å‹ </td><td>  osg :: ShadeModel </td><td>  -- </td><td>  glShadeModelï¼ˆï¼‰ </td></tr><tr><td> æ–¯è’‚å°¼å°” </td><td>  osg ::æ¨¡å…· </td><td>  GL_STENCIL_TEST </td><td>  glStencilFuncï¼ˆï¼‰ï¼ŒglStencilOpï¼ˆï¼‰å’ŒglStencilMaskï¼ˆï¼‰ </td></tr><tr><td> ç‰¹æ£®å¤« </td><td>  osg :: TexEnv </td><td>  -- </td><td>  glTexEnvï¼ˆï¼‰ </td></tr><tr><td> ç‰¹å…‹æ–¯æ ¹ </td><td>  osg :: TexGen </td><td>  GL_TEXTURE_GEN_S </td><td>  glTexGenï¼ˆï¼‰ </td></tr></tbody></table><br> å±æ€§ç±»å‹IDåˆ—æŒ‡ç¤ºç‰¹å®šçš„OSGæ ‡è¯†ç¬¦ï¼Œè¯¥æ ‡è¯†ç¬¦åœ¨osg :: StateAttributeç±»çš„æšä¸¾æ•°ä¸­æ ‡è¯†æ­¤å±æ€§ã€‚ å¯ä»¥åœ¨getAttributeæ–¹æ³•ä¸­ä½¿ç”¨å®ƒæ¥è·å–ç‰¹å®šå±æ€§çš„å€¼ã€‚ <br><br><pre> <code class="cpp hljs">osg::PolygonMode *pm = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;osg::PolygonMode *&gt;(stateset-&gt;getAttribute(osg::StateAttribute::POLYGONMODE));</code> </pre><br> æœ‰æ•ˆçš„æŒ‡é’ˆè¡¨ç¤ºè¯¥å±æ€§å…ˆå‰å·²è®¾ç½®ã€‚ å¦åˆ™ï¼Œè¯¥æ–¹æ³•å°†ä¸ºNULLã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨è°ƒç”¨è·å–å½“å‰æ¨¡å¼çš„å€¼ <br><br><pre> <code class="cpp hljs">osg::StateAttribute::GLModeValue value = stateset-&gt;getMode(GL_LIGHTING);</code> </pre><br> æ­¤å¤„GL_LIGHTINGæšä¸¾å™¨ç”¨äºå¯ç”¨/ç¦ç”¨æ•´ä¸ªåœºæ™¯ä¸­çš„ç…§æ˜ã€‚ <br><br><h1>  5.å°†é›¾åº”ç”¨äºåœºæ™¯ä¸­çš„æ¨¡å‹ </h1><br> è®©æˆ‘ä»¬ä»¥é›¾åŒ–æ•ˆæœä½œä¸ºå±•ç¤ºå¦‚ä½•ä½¿ç”¨å„ç§å±æ€§å’Œæ¸²æŸ“æ¨¡å¼çš„ç†æƒ³æ–¹æ³•ã€‚  OpenGLä½¿ç”¨ä¸€ä¸ªæè¿°é›¾æ¨¡å‹çš„çº¿æ€§æ–¹ç¨‹å’Œä¸¤ä¸ªæŒ‡æ•°æ–¹ç¨‹ï¼Œç”±osg :: Fogç±»æ”¯æŒã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æ–‡å­—é›¾ç¤ºä¾‹</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/Fog&gt; #include &lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg::Fog&gt; fog = new osg::Fog; fog-&gt;setMode(osg::Fog::LINEAR); fog-&gt;setStart(500.0f); fog-&gt;setEnd(2500.0f); fog-&gt;setColor(osg::Vec4(1.0f, 1.0f, 0.0f, 1.0f)); osg::ref_ptr&lt;osg::Node&gt; model = osgDB::readNodeFile("../data/lz.osg"); model-&gt;getOrCreateStateSet()-&gt;setAttributeAndModes(fog.get()); osgViewer::Viewer viewer; viewer.setSceneData(model.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> é¦–å…ˆï¼Œåˆ›å»ºfogå±æ€§ã€‚ æˆ‘ä»¬ä½¿ç”¨çº¿æ€§æ¨¡å‹ï¼Œé€šè¿‡ä¸æ¨¡å‹çš„è·ç¦»æ¥è°ƒæ•´é›¾æ˜¾ç¤ºçš„èŒƒå›´ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Fog&gt; fog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Fog; fog-&gt;setMode(osg::Fog::LINEAR); fog-&gt;setStart(<span class="hljs-number"><span class="hljs-number">500.0f</span></span>); fog-&gt;setEnd(<span class="hljs-number"><span class="hljs-number">2500.0f</span></span>); fog-&gt;setColor(osg::Vec4(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>));</code> </pre><br> æˆ‘ä»¬åŠ è½½æ™¯è§‚æ ·æœ¬lz.osgå¹¶å°†å…¶åº”ç”¨äºæ­¤å±æ€§ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Node&gt; model = osgDB::readNodeFile(<span class="hljs-string"><span class="hljs-string">"../data/lz.osg"</span></span>); model-&gt;getOrCreateStateSet()-&gt;setAttributeAndModes(fog.get());</code> </pre><br> åœ¨æŸ¥çœ‹å™¨çª—å£ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æ¨¡ç³Šçš„é£æ™¯ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°é›¾çš„å¯†åº¦å¦‚ä½•æ ¹æ®ä¸æ¨¡å‹çš„è·ç¦»è€Œå˜åŒ– <br><br><img src="https://habrastorage.org/webt/gq/8f/fu/gq8ffuswpsbsl1-xxqzprwvprle.png"><br><br><img src="https://habrastorage.org/webt/3z/st/f6/3zstf6mlxlvenapqhvj3zsxyh2i.png"><br><br><img src="https://habrastorage.org/webt/k-/mc/cj/k-mccjrssmakzwwrht-b5azkzg4.png"><br><br><h1>  6.ä½¿ç”¨å…‰æºå’Œç…§æ˜ </h1><br> ä¸OpenGLä¸€æ ·ï¼ŒOSGæœ€å¤šæ”¯æŒå…«ä¸ªå…‰æºä»¥ç›´æ¥é‡åˆ°åœºæ™¯å¯¹è±¡ã€‚ ä¸OpenGLç±»ä¼¼ï¼ŒOSGä¸ä¼šè‡ªåŠ¨è®¡ç®—é˜´å½±ã€‚ å…‰çº¿æ¥è‡ªç›´çº¿æºï¼Œè¢«ç‰©ä½“åå°„å¹¶è¢«å®ƒä»¬æ•£å°„ï¼Œç„¶åè¢«è§‚çœ‹è€…çš„çœ¼ç›å¯Ÿè§‰ã€‚ ä¸ºäº†è¿›è¡Œé«˜è´¨é‡çš„ç…§æ˜å¤„ç†ï¼Œå¿…é¡»è®¾ç½®ææ–™å±æ€§ï¼Œå¯¹è±¡çš„æ³•çº¿å‡ ä½•å½¢çŠ¶ç­‰ã€‚ <br><br>  osg :: Lightç±»æä¾›äº†æ§åˆ¶å…‰æºçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼šsetLightNumï¼ˆï¼‰å’ŒgetLightNumï¼ˆï¼‰-ç”¨äºå¤„ç†å¤šä¸ªå…‰æºï¼›  setAmbientï¼ˆï¼‰å’ŒgetAmbientï¼ˆï¼‰æ§åˆ¶å‘¨å›´çš„ç»„ä»¶ï¼›  setDiffuseï¼ˆï¼‰å’ŒgetDiffuseï¼ˆï¼‰-ç”¨äºå¤„ç†åˆ†æ•£çš„ç»„ä»¶ç­‰ã€‚ <br><br>  OSGè¿˜æè¿°äº†osg :: LightSourceç±»ï¼Œç”¨äºå°†å…‰æºæ·»åŠ åˆ°åœºæ™¯ä¸­ã€‚ å®ƒæä¾›setLightï¼ˆï¼‰æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯å…·æœ‰å•ä¸ªå±æ€§çš„åœºæ™¯å›¾çš„å¶èŠ‚ç‚¹ã€‚ å¦‚æœè®¾ç½®äº†GL_LIGHTiçš„ç›¸åº”æ¨¡å¼ï¼Œåˆ™åœºæ™¯å›¾çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹éƒ½ä¼šå—åˆ°å…‰æºçš„å½±å“ã€‚ ä¾‹å¦‚ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   1 osg::ref_ptr&lt;osg::Light&gt; light = new osg::Light; light-&gt;setLightNum( 1 ); ... //       osg::ref_ptr&lt;osg::LightSource&gt; lightSource = new osg::LightSource; lightSource-&gt;setLight( light.get() ); ... //             root-&gt;addChild( lightSource.get() ); root-&gt;getOrCreateStateSet()-&gt;setMode( GL_LIGHT1, osg::StateAttribute::ON );</span></span></code> </pre><br> å¦ä¸€ä¸ªæ›´æ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆæ˜¯setStateSetModesï¼ˆï¼‰æ–¹æ³•ï¼Œé€šè¿‡è¯¥æ–¹æ³•ï¼Œå…·æœ‰æ‰€éœ€ç¼–å·çš„å…‰æºä¼šè‡ªåŠ¨é™„åŠ åˆ°æ ¹èŠ‚ç‚¹ <br><br><pre> <code class="cpp hljs">root-&gt;addChild( lightSource.get() ); lightSource-&gt;setStateSetModes( root-&gt;getOrCreateStateSet(), osg::StateAttribute::ON );</code> </pre><br> æ‚¨å¯ä»¥å°†å­èŠ‚ç‚¹æ·»åŠ åˆ°å…‰æºï¼Œä½†è¿™ä¸€ç‚¹ä¹Ÿä¸æ„å‘³ç€ï¼Œæ‚¨å°†ä»¥æŸç§ç‰¹æ®Šæ–¹å¼ç…§äº®ä¸ä¹‹å…³è”çš„å­å›¾ã€‚ å®ƒå°†è¢«å¤„ç†ä¸ºå‡ ä½•ä½“ï¼Œç”±å…‰æºçš„ç‰©ç†å½¢å¼è¡¨ç¤ºã€‚ <br><br>  osg :: LightSourceèŠ‚ç‚¹å¯ä»¥é™„åŠ åˆ°è½¬æ¢èŠ‚ç‚¹ï¼Œä¾‹å¦‚ï¼Œç‚¹å…‰æºå¯ä»¥åœ¨ç©ºé—´ä¸­ç§»åŠ¨ã€‚ å¯ä»¥é€šè¿‡è®¾ç½®å…‰æºçš„ç»å¯¹åæ ‡ç³»æ¥ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ <br><br><pre> <code class="cpp hljs">lightSource-&gt;setReferenceFrame( osg::LightSource::ABSOLUTE_RF );</code> </pre><br><h1>  7.åœ¨åœºæ™¯ä¸­åˆ›å»ºå…‰æº </h1><br> é»˜è®¤æƒ…å†µä¸‹ï¼ŒOSGä¼šè‡ªåŠ¨å°†å…‰æºè®¾ç½®ä¸ºæ•°å­—0ï¼Œä»è€Œå‘åœºæ™¯å‘å°„å‡åŒ€çš„å®šå‘å…‰ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥éšæ—¶æ·»åŠ å‡ ä¸ªå…¶ä»–å…‰æºï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨åæ ‡å˜æ¢èŠ‚ç‚¹è¿›è¡Œæ§åˆ¶ã€‚ åªèƒ½ç§»åŠ¨ä½ç½®æºï¼ˆç‚¹æºï¼‰ã€‚ å®šå‘å…‰ä»…å…·æœ‰æ–¹å‘ï¼ˆæ¥è‡ªæ— é™è¿œçš„å¹³è¡Œå…‰çº¿æµï¼‰ï¼Œå¹¶ä¸”ä¸ç»‘å®šåˆ°èˆå°ä¸Šçš„ç‰¹å®šä½ç½®ã€‚  OpenGLå’ŒOSGä½¿ç”¨positionå‚æ•°çš„ç¬¬å››éƒ¨åˆ†æ¥æŒ‡å®šå…‰æºçš„ç±»å‹ã€‚ å¦‚æœä¸º0ï¼Œåˆ™è®¤ä¸ºç¯å…‰æ˜¯å®šå‘çš„ï¼›å¦åˆ™ä¸º0ã€‚ å€¼ä¸º1-ä½ç½®ã€‚ <br><br> è€ƒè™‘ä¸€ä¸ªä½¿ç”¨ç…§æ˜çš„å°ä¾‹å­ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æ‰°æµæ¿æ–¹å‘</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/MatrixTransform&gt; #include &lt;osg/LightSource&gt; #include &lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ osg::Node *createLightSource(int num, const osg::Vec3 &amp;trans, const osg::Vec4 &amp;color) { osg::ref_ptr&lt;osg::Light&gt; light = new osg::Light; light-&gt;setLightNum(num); light-&gt;setDiffuse(color); light-&gt;setPosition(osg::Vec4(0.0f, 0.0f, 0.0f, 1.0f)); osg::ref_ptr&lt;osg::LightSource&gt; lightSource = new osg::LightSource; lightSource-&gt;setLight(light); osg::ref_ptr&lt;osg::MatrixTransform&gt; sourceTrans = new osg::MatrixTransform; sourceTrans-&gt;setMatrix(osg::Matrix::translate(trans)); sourceTrans-&gt;addChild(lightSource.get()); return sourceTrans.release(); } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr&lt;osg::Node&gt; model = osgDB::readNodeFile("../data/cessna.osg"); osg::ref_ptr&lt;osg::Group&gt; root = new osg::Group; root-&gt;addChild(model.get()); osg::Node *light0 = createLightSource(0, osg::Vec3(-20.0f, 0.0f, 0.0f), osg::Vec4(1.0f, 1.0f, 0.0f, 1.0f)); osg::Node *light1 = createLightSource(1, osg::Vec3(0.0f, -20.0f, 0.0f), osg::Vec4(0.0f, 1.0f, 1.0f, 1.0f)); root-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHT0, osg::StateAttribute::ON); root-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHT1, osg::StateAttribute::ON); root-&gt;addChild(light0); root-&gt;addChild(light1); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> è¦åˆ›å»ºå…‰æºï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå•ç‹¬çš„åŠŸèƒ½ <br><br><pre> <code class="cpp hljs">osg::<span class="hljs-function"><span class="hljs-function">Node *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createLightSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> num, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osg::Vec3 &amp;trans, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osg::Vec4 &amp;color)</span></span></span><span class="hljs-function"> </span></span>{ osg::ref_ptr&lt;osg::Light&gt; light = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Light; light-&gt;setLightNum(num); light-&gt;setDiffuse(color); light-&gt;setPosition(osg::Vec4(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); osg::ref_ptr&lt;osg::LightSource&gt; lightSource = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::LightSource; lightSource-&gt;setLight(light); osg::ref_ptr&lt;osg::MatrixTransform&gt; sourceTrans = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::MatrixTransform; sourceTrans-&gt;setMatrix(osg::Matrix::translate(trans)); sourceTrans-&gt;addChild(lightSource.get()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sourceTrans.release(); }</code> </pre><br> åœ¨æ­¤åŠŸèƒ½ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç¡®å®šå…‰æºæä¾›çš„ç…§æ˜å‚æ•°ï¼Œä»è€Œåˆ›å»ºGL_LIGHTiå±æ€§ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Light&gt; light = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Light; <span class="hljs-comment"><span class="hljs-comment">//    light-&gt;setLightNum(num); //   light-&gt;setDiffuse(color); //  .     ,    light-&gt;setPosition(osg::Vec4(0.0f, 0.0f, 0.0f, 1.0f));</span></span></code> </pre><br> ä¹‹åï¼Œåˆ›å»ºä¸€ä¸ªä¸ºå…¶åˆ†é…äº†æ­¤å±æ€§çš„å…‰æºã€‚ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::LightSource&gt; lightSource = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::LightSource; lightSource-&gt;setLight(light);</code> </pre><br> æˆ‘ä»¬åˆ›å»ºå¹¶é…ç½®è½¬æ¢èŠ‚ç‚¹ï¼Œå°†æˆ‘ä»¬çš„å…‰æºä½œä¸ºå­èŠ‚ç‚¹ä¼ é€’ç»™å®ƒ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::MatrixTransform&gt; sourceTrans = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::MatrixTransform; sourceTrans-&gt;setMatrix(osg::Matrix::translate(trans)); sourceTrans-&gt;addChild(lightSource.get());</code> </pre><br> è¿”å›æŒ‡å‘è½¬æ¢èŠ‚ç‚¹çš„æŒ‡é’ˆ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sourceTrans.release();</code> </pre><br> åœ¨ä¸»ç¨‹åºçš„ä¸»ä½“ä¸­ï¼Œæˆ‘ä»¬åŠ è½½ä¸€ä¸ªä¸‰ç»´æ¨¡å‹ï¼ˆåŒæ ·ï¼Œæˆ‘ä»¬æœ€å–œæ¬¢çš„å¡æ–¯çº³ï¼‰ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Node&gt; model = osgDB::readNodeFile(<span class="hljs-string"><span class="hljs-string">"../data/cessna.osg"</span></span>); osg::ref_ptr&lt;osg::Group&gt; root = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Group; root-&gt;addChild(model.get());</code> </pre><br> æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªæ•°å­—åˆ†åˆ«ä¸º0å’Œ1çš„å…‰æºã€‚ç¬¬ä¸€ä¸ªå°†å‘å‡ºé»„è‰²ï¼Œç¬¬äºŒä¸ªå°†å‘å‡ºè“ç»¿è‰²ã€‚ <br><br><pre> <code class="cpp hljs">osg::Node *light0 = createLightSource(<span class="hljs-number"><span class="hljs-number">0</span></span>, osg::Vec3(<span class="hljs-number"><span class="hljs-number">-20.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), osg::Vec4(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); osg::Node *light1 = createLightSource(<span class="hljs-number"><span class="hljs-number">1</span></span>, osg::Vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-20.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), osg::Vec4(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>));</code> </pre><br> æˆ‘ä»¬é€šçŸ¥OpenGLçŠ¶æ€æœºï¼Œæœ‰å¿…è¦æ‰“å¼€0å’Œ1å…‰æºå¹¶å°†æˆ‘ä»¬åˆ›å»ºçš„å…‰æºæ·»åŠ åˆ°åœºæ™¯ä¸­ <br><br><pre> <code class="cpp hljs">root-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHT0, osg::StateAttribute::ON); root-&gt;getOrCreateStateSet()-&gt;setMode(GL_LIGHT1, osg::StateAttribute::ON); root-&gt;addChild(light0); root-&gt;addChild(light1);</code> </pre><br> åˆå§‹åŒ–å¹¶å¯åŠ¨æŸ¥çœ‹å™¨åï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€å¼ å›¾ç‰‡ <br><br><img src="https://habrastorage.org/webt/0s/or/ph/0sorphad56jc2zc8iwfb591qcxk.png"><br><br><h1> ç»“è®º </h1><br> æ„Ÿå…´è¶£çš„äººä»¬å¯¹è¿™ä¸ªå‘¨æœŸçš„å…³æ³¨éå¸¸æ„ŸåŠ¨ã€‚ è¿™ä¸ªåŠ¨ä½œèµ·æ­¥ä¸æ˜¯å¾ˆå……åˆ†ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ç¤¾åŒºéœ€è¦æ–‡ç« ã€‚ æ„Ÿè°¢æ‚¨çš„å„ç§ç§¯æåé¦ˆã€‚ <br><br> ä»Šå¤©ï¼Œæˆ‘å†æ¬¡å°è¯•è€ƒè™‘OSGå¼•æ“çš„åŸºæœ¬çŸ¥è¯†ã€‚ ä¸çŸ¥é“æœ‰ä»€ä¹ˆå¥½ç©çš„ã€‚ ä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘åªæ˜¯æŒ‰ç…§æˆ‘è‡ªå·±ç†è§£å®ƒä»¬çš„æ–¹å¼æ¥åˆ—å‡ºåŸå§‹äº‹ç‰©ã€‚ æˆ‘äº²è‡ªæ£€æŸ¥äº†æ‰€æœ‰ç¤ºä¾‹ï¼Œå¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>æ‰¾åˆ°æˆ‘çš„å­˜å‚¨åº“ã€‚ è°¢è°¢äº²çˆ±çš„åŒäº‹ä»¬ï¼Œæˆ‘å°†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»§ç»­</a>ä¿æŒè¿™ä¸ªæ•…äº‹... </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN430348/">https://habr.com/ru/post/zh-CN430348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN430336/index.html">ä½œä¸ºç¨‹åºå‘˜ï¼Œä»–ä¹°äº†ä¸€å°æ–°æœºå™¨</a></li>
<li><a href="../zh-CN430340/index.html">æˆ‘ä»¬æ­£åœ¨ç­‰å¾…è‹¹æœçš„è€³æœºï¼šAirPods 2019å’Œå…¨å°ºå¯¸ç¬¬ä¸€èƒçš„é¢„æµ‹</a></li>
<li><a href="../zh-CN430342/index.html">Goldrattå’ŒåŠ æ²¹</a></li>
<li><a href="../zh-CN430344/index.html">Dell XPS 15 9575ï¼šåŠŸèƒ½å¼ºå¤§çš„ä¾¿æºå¼å¯æŠ˜å ç¬”è®°æœ¬ç”µè„‘ï¼Œå¯è½»æ¾å®Œæˆå·¥ä½œ</a></li>
<li><a href="../zh-CN430346/index.html">Scrumå’ŒAgileä¸ä¼šä½¿æ‚¨çš„é¡¹ç›®å…äºå¤±è´¥</a></li>
<li><a href="../zh-CN430352/index.html">é¦–ä¸ªä½¿ç”¨è¥¿é‡Œå°”å­—ç¬¦çš„SSLè¯ä¹¦</a></li>
<li><a href="../zh-CN430354/index.html">ä¸­å›½é¢†å…ˆäºå…¶ä»–å›½å®¶ï¼Ÿ</a></li>
<li><a href="../zh-CN430356/index.html">11æœˆ19æ—¥è‡³25æ—¥åœ¨è«æ–¯ç§‘ä¸¾è¡Œçš„æ•°å­—æ´»åŠ¨</a></li>
<li><a href="../zh-CN430358/index.html">å…¬å¼€è¯¾â€œæŠ€æœ¯æ´»åŠ¨çš„åˆç†åŒ–â€</a></li>
<li><a href="../zh-CN430360/index.html">ä¸ºä»€ä¹ˆæœºå™¨ç¿»è¯‘é€‚åˆè°ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>