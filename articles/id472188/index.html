<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„ÄΩÔ∏è üì¶ üë©üèæ‚Äçüç≥ Yang Perlu Anda Ketahui tentang Verifikasi Pemeriksaan Toko Aplikasi (tanda terima App Store) ü¶î üëßüèø üë©‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="StackOverflow masih memiliki banyak pertanyaan tentang memvalidasi cek App Store, jadi kami memutuskan untuk menulis artikel tentang topik ini dalam f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Yang Perlu Anda Ketahui tentang Verifikasi Pemeriksaan Toko Aplikasi (tanda terima App Store)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/472188/"><p>  StackOverflow masih memiliki banyak pertanyaan tentang memvalidasi cek App Store, jadi kami memutuskan untuk menulis artikel tentang topik ini dalam format pertanyaan dan jawaban. </p><br><p><img src="https://habrastorage.org/webt/du/gc/nf/dugcnfujdubx2v3zojf-cj0xc84.png" alt="gambar"><a name="habracut"></a></p><br><h2 id="chto-predstavlyaet-soboy-app-store-chek">  Apa itu cek App Store? </h2><br><p> Ini adalah file terenkripsi dalam format PKCS # 7, yang berisi informasi tentang semua pembelian dalam aplikasi.  Itu terletak di bundel aplikasi dan dapat dengan mudah diperoleh dengan memanggil: <code>Bundle.main.appStoreReceiptURL</code> . </p><br><h2 id="vsegda-li-est-etot-fayl">  Apakah selalu ada file ini? </h2><br><p>  Jika aplikasi diunduh dari App Store, maka ya, selalu.  Dan jika itu diinstal melalui Xcode atau Testflight, maka pada awalnya aplikasi tidak memiliki cek kotak pasir sampai pembelian pertama atau pemulihan cek. </p><br><h2 id="chto-znachit-provalidirovat-chek">  Apa artinya "memvalidasi cek"? </h2><br><p>  Ini berarti mendekripsi file, menerima tanggal JSON, dan memverifikasi pembelian yang dilakukan oleh pengguna.  Anda dapat melakukan ini secara lokal atau dengan mengirim permintaan ke Apple. </p><br><h2 id="v-kakih-sluchayah-razrabotchiku-trebuetsya-validaciya-cheka">  Dalam kasus apa pengembang memerlukan validasi cek? </h2><br><p>  <strong>Untuk memvalidasi pembelian yang baru saja selesai.</strong> <br>  Ketika banyak yang melakukan jailbreak, itu relevan: ada utilitas untuk memalsukan cek.  Sekarang masalah ini telah berhenti menjadi akut, karena jailbreak telah menjadi langka. </p><br><p>  <strong>Saat mengembalikan pembelian.</strong> <br>  Jika pengguna menginstal ulang aplikasi Anda atau meluncurkan dari perangkat lain, Anda harus memberinya akses ke fungsionalitas yang telah dibayarnya.  Setelah mendekripsi App Store, Anda dapat mengetahui apakah pembelian dalam aplikasi dibeli. </p><br><p>  <strong>Saat membeli langganan yang dapat diperbarui secara otomatis.</strong> <br>  Untuk menentukan status langganan saat ini dan tanggal kedaluwarsa. </p><br><h2 id="kakie-pokupki-mozhno-vosstanovit-pri-validacii">  Pembelian apa yang dapat dikembalikan selama validasi? </h2><br><p>  Ada 4 jenis pembelian dalam aplikasi: </p><br><ul><li>  pembelian barang habis pakai </li><li>  pembelian non-konsumsi </li><li>  langganan yang tidak diperpanjang </li><li>  Berlangganan yang dapat diperpanjang secara otomatis <br>  Anda dapat mengembalikan semuanya kecuali pembelian yang dihabiskan.  Ini termasuk, misalnya, koin dalam aplikasi Anda - sesuatu yang dapat Anda beli sebanyak yang Anda suka.  Anda harus menyimpan jumlah koin saat ini di pengguna di server Anda. </li></ul><br><h2 id="kakie-sposoby-validacii-suschestvuyut">  Apa metode validasi yang ada? </h2><br><p>  Ada tiga di antaranya: </p><br><ul><li>  validasi lokal menggunakan OpenSSL, </li><li>  Validasi atas permintaan oleh Apple langsung dari perangkat iOS, </li><li>  Validasi berdasarkan permintaan oleh Apple menggunakan server Anda. </li></ul><br><h2 id="kakoy-sposob-validacii-luchshe">  Metode validasi mana yang lebih baik? </h2><br><p>  Validasi lokal sangat kompleks dan membutuhkan banyak waktu dan upaya untuk mengimplementasikannya.  Anda juga perlu menambahkan pustaka OpenSSL ke proyek Anda.  Dalam beberapa kasus, Anda harus memperbarui cek. </p><br><p>  Apple tidak merekomendasikan memeriksa cek pada perangkat iOS itu sendiri.  Ini tidak aman: permintaan dapat dicegat dengan serangan man-in-the-middle. </p><br><p>  Cara terbaik untuk memvalidasi cek di server.  Selain itu, Apple sesekali menambahkan bidang baru di sana, misalnya, <code>grace_period_expires_date</code> dan <code>subscription_group_identifier</code> .  Di server kami, kami dapat dengan cepat melakukan perubahan tanpa memperbarui aplikasi.  Dan dua metode validasi sebelumnya dapat dengan mudah dibodohi dengan hanya mengubah waktu sistem pada perangkat iOS. </p><br><h2 id="dlya-chego-nuzhen-shared-secret">  Untuk Apa Rahasia Bersama? </h2><br><p>  Ini adalah garis kunci khusus yang diperlukan untuk mendekripsi cek dengan pembelian yang dapat diperbarui secara otomatis.  Apple menggunakan rahasia Bersama sebagai parameter dalam permintaan HTTPS ke Apple. </p><br><h2 id="gde-vzyat-shared-secret">  Di mana mendapatkan Rahasia Bersama? </h2><br><p>  Buka App Store Connect, buka aplikasi, buka tab <em>Fitur</em> , di bagian <em>Pembelian</em> bawaan Anda akan melihat <em>kunci Dibagikan untuk</em> tombol <em>aplikasi</em> .  Hasilkan kunci baru, jika belum. </p><br><h2 id="primer-koda-dlya-validacii-cheka">  Kode sampel untuk memvalidasi cek </h2><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateReceipt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-type"><span class="hljs-type">DEBUG</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> urlString = <span class="hljs-string"><span class="hljs-string">"https://sandbox.itunes.apple.com/verifyReceipt"</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> urlString = <span class="hljs-string"><span class="hljs-string">"https://buy.itunes.apple.com/verifyReceipt"</span></span> #endif <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> receiptURL = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.appStoreReceiptURL, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> receiptString = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">Data</span></span>(contentsOf: receiptURL).base64EncodedString() , <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = <span class="hljs-type"><span class="hljs-type">URL</span></span>(string: urlString) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> requestData : [<span class="hljs-type"><span class="hljs-type">String</span></span> : <span class="hljs-type"><span class="hljs-type">Any</span></span>] = [<span class="hljs-string"><span class="hljs-string">"receipt-data"</span></span> : receiptString, <span class="hljs-string"><span class="hljs-string">"password"</span></span> : <span class="hljs-string"><span class="hljs-string">"YOUR_SHARED_SECRET"</span></span>, <span class="hljs-string"><span class="hljs-string">"exclude-old-transactions"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> httpBody = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">JSONSerialization</span></span>.data(withJSONObject: requestData, options: []) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = <span class="hljs-type"><span class="hljs-type">URLRequest</span></span>(url: url) request.httpMethod = <span class="hljs-string"><span class="hljs-string">"POST"</span></span> request.setValue(<span class="hljs-string"><span class="hljs-string">"Application/json"</span></span>, forHTTPHeaderField: <span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>) request.httpBody = httpBody <span class="hljs-type"><span class="hljs-type">URLSession</span></span>.shared.dataTask(with: request) { (data, response, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-comment"><span class="hljs-comment">// convert data to Dictionary and view purchases }.resume() }</span></span></code> </pre> <br><p>  Ini adalah contoh memvalidasi cek di iOS.  Ingatlah untuk mengganti nilai <code>YOUR_SHARED_SECRET</code> dengan <em>rahasia</em> Anda <em>bersama</em> . </p><br><p>  Setelah menerima <code>data</code> , konversikan ke <code>Dictionary</code> : </p><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.async { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = data, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonData = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">JSONSerialization</span></span>.jsonObject(with: data, options: .allowFragments){ <span class="hljs-comment"><span class="hljs-comment">// your non-consumable and non-renewing subscription receipts are in `in_app` array // your auto-renewable subscription receipts are in `latest_receipt_info` array } }</span></span></code> </pre> <br><h2 id="primer-rasshifrovannogo-app-store-cheka">  Contoh tanda terima App Store yang didekripsi </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Di sini</a> Anda dapat melihat contoh cek dengan dua transaksi dalam aplikasi dengan langganan yang dapat diperpanjang secara otomatis. </p><br><h2 id="v-chem-otlichiya-mezhdu-in_app-i-latest_receipt_info">  Apa perbedaan antara <code>in_app</code> dan <code>latest_receipt_info</code> ? </h2><br><ul><li><p>  <code>latest_receipt_info</code> berisi semua transaksi, termasuk pembaruan pembelian yang dapat diperbarui secara otomatis.  Anda harus menggunakan hanya array ini. </p><br></li><li><p>  <code>in_app</code> berisi transaksi pembelian yang tidak <code>in_app</code> dan langganan yang tidak dapat diperbarui.  Transaksi <em>pertama</em> langganan Anda yang dapat diperpanjang secara otomatis juga digandakan di sini.  Pembelian yang dapat <code>in_app</code> juga akan muncul di array <code>in_app</code> , tetapi kemudian menghilang ketika pengembang menyelesaikan transaksi. </p><br></li></ul><br><h2 id="zaklyuchenie">  Kesimpulan </h2><br><p>  Kami di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apphud</a> menerapkan validasi pemeriksaan App Store untuk aplikasi dengan langganan yang dapat diperbarui secara otomatis di SDK sumber terbuka yang nyaman.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apphud juga</a> membantu Anda melacak status berlangganan, menganalisis metrik kunci, secara otomatis menawarkan diskon kepada pengguna yang tidak berlangganan, dan banyak lagi.  Jika Anda mengalami sakit saat bekerja dengan langganan, cobalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">solusi kami</a> secara gratis. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id472188/">https://habr.com/ru/post/id472188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id472176/index.html">Museum Pushkin Virtual</a></li>
<li><a href="../id472178/index.html">Holivar. Sejarah Runet. Bagian 7. YouTube: pelawak, cicit, dan Lembah Silikon</a></li>
<li><a href="../id472182/index.html">Mengumumkan .NET Core 3.1 Pratinjau 1</a></li>
<li><a href="../id472184/index.html">Remote SSH: Tip dan Trik</a></li>
<li><a href="../id472186/index.html">Prinsip terbuka-tertutup</a></li>
<li><a href="../id472190/index.html">Jalankan skrip PHP melalui php-fpm tanpa server web. Atau klien FastCGI Anda (di bawah tenda)</a></li>
<li><a href="../id472196/index.html">"Gula" buatan rumah untuk proyek Android atau "Bagaimana tidak melakukannya"</a></li>
<li><a href="../id472198/index.html">Lokalisasi pesan push dalam aplikasi seluler</a></li>
<li><a href="../id472200/index.html">Modernisasi kelas ilmu komputer di sekolah Rusia dengan raspberry: murah dan ceria</a></li>
<li><a href="../id472202/index.html">Windows 10 + Python = VS Code + WSL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>