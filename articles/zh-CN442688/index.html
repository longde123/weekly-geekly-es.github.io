<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤™ğŸ½ ğŸ¥• ğŸ”« Scalaæ•°æ®åˆ†æ-è¿«åˆ‡éœ€è¦è¿˜æ˜¯ä»¤äººæ„‰å¿«çš„æœºä¼šï¼Ÿ ğŸŒ“ ğŸ› ğŸ‘¨ğŸ½â€ğŸ«</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ•°æ®ç§‘å­¦é¢†åŸŸçš„ä¼ ç»Ÿå·¥å…·æ˜¯Rå’ŒPythonä¹‹ç±»çš„è¯­è¨€-å®½æ¾çš„è¯­æ³•ä»¥åŠå¤§é‡ç”¨äºæœºå™¨å­¦ä¹ å’Œæ•°æ®å¤„ç†çš„åº“ï¼Œå¯è®©æ‚¨å¿«é€Ÿè·å¾—ä¸€äº›å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™äº›å·¥å…·çš„å±€é™æ€§æˆä¸ºä¸€ä¸ªé‡å¤§éšœç¢-é¦–å…ˆï¼Œå¦‚æœæ‚¨éœ€è¦åœ¨å¤„ç†é€Ÿåº¦å’Œ/æˆ–ä½¿ç”¨éå¸¸å¤§çš„æ•°æ®é›†æ–¹é¢å®ç°é«˜æ€§èƒ½ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸“å®¶å¿…é¡»æ— å¥ˆåœ°æ±‚åŠ©äºâ€œé˜´æš—é¢â€...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Scalaæ•°æ®åˆ†æ-è¿«åˆ‡éœ€è¦è¿˜æ˜¯ä»¤äººæ„‰å¿«çš„æœºä¼šï¼Ÿ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/442688/"><p><img src="https://habrastorage.org/webt/5q/1e/fr/5q1efrbkxbuk_ndqoensinfl80a.jpeg"></p><br><p> æ•°æ®ç§‘å­¦é¢†åŸŸçš„ä¼ ç»Ÿå·¥å…·æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">R</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pythonä¹‹</a>ç±»çš„è¯­è¨€-å®½æ¾çš„è¯­æ³•ä»¥åŠå¤§é‡ç”¨äºæœºå™¨å­¦ä¹ å’Œæ•°æ®å¤„ç†çš„åº“ï¼Œå¯è®©æ‚¨å¿«é€Ÿè·å¾—ä¸€äº›å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™äº›å·¥å…·çš„å±€é™æ€§æˆä¸ºä¸€ä¸ªé‡å¤§éšœç¢-é¦–å…ˆï¼Œå¦‚æœæ‚¨éœ€è¦åœ¨å¤„ç†é€Ÿåº¦å’Œ/æˆ–ä½¿ç”¨éå¸¸å¤§çš„æ•°æ®é›†æ–¹é¢å®ç°é«˜æ€§èƒ½ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸“å®¶å¿…é¡»æ— å¥ˆåœ°æ±‚åŠ©äºâ€œé˜´æš—é¢â€çš„å¸®åŠ©ï¼Œå¹¶ä»¥â€œå·¥ä¸šâ€ç¼–ç¨‹è¯­è¨€ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Scala</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Java</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">C ++ï¼‰</a>è¿æ¥å·¥å…·ã€‚ </p><br><p>ä½†æ˜¯è¿™é¢é‚£ä¹ˆé»‘å—ï¼Ÿ ç»è¿‡å¤šå¹´çš„å‘å±•ï¼Œâ€œå·¥ä¸šâ€æ•°æ®ç§‘å­¦çš„å·¥å…·å·²ç»èµ°äº†å¾ˆé•¿ä¸€æ®µè·¯ï¼Œä»Šå¤©ï¼Œå®ƒä»¬ä¸2-3å¹´å‰çš„ç‰ˆæœ¬å¤§ä¸ç›¸åŒã€‚ è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SNA Hackathon 2019</a>ä»»åŠ¡çš„ç¤ºä¾‹æ¥å¼„æ¸…æ¥šScala + Sparkç”Ÿæ€ç³»ç»Ÿå¯ä»¥å¯¹åº”Python Data Scienceå¤šå°‘ã€‚ </p><a name="habracut"></a><br><p> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SNA Hackathon 2019</a>çš„æ¡†æ¶å†…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼Œ</a>å‚ä¸è€…è§£å†³äº†ä»¥ä¸‹ä¸‰ç§â€œå­¦ç§‘â€ä¹‹ä¸€ä¸­å¯¹ç¤¾äº¤ç½‘ç»œç”¨æˆ·çš„æ–°é—»æè¦è¿›è¡Œæ’åºçš„é—®é¢˜ï¼šä½¿ç”¨æ–‡æœ¬ï¼Œå›¾åƒæˆ–åŠŸèƒ½æ—¥å¿—ä¸­çš„æ•°æ®ã€‚ åœ¨æœ¬å‡ºç‰ˆç‰©ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶åœ¨Sparkä¸­å¦‚ä½•ä½¿ç”¨ç»å…¸çš„æœºå™¨å­¦ä¹ å·¥å…·åŸºäºç¬¦å·å¯¹æ•°æ¥è§£å†³é—®é¢˜ã€‚ </p><br><p> åœ¨è§£å†³é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å°†éµå¾ªä»»ä½•æ•°æ®åˆ†æä¸“å®¶åœ¨å¼€å‘æ¨¡å‹æ—¶æ‰€éµå¾ªçš„æ ‡å‡†è·¯å¾„ï¼š </p><br><ul><li> æˆ‘ä»¬å°†è¿›è¡Œç ”ç©¶æ•°æ®åˆ†æï¼Œç»˜åˆ¶å›¾è¡¨ã€‚ </li><li> æˆ‘ä»¬åˆ†ææ•°æ®ä¸­ç¬¦å·çš„ç»Ÿè®¡ç‰¹æ€§ï¼ŒæŸ¥çœ‹å®ƒä»¬åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¹‹é—´çš„å·®å¼‚ã€‚ </li><li> æˆ‘ä»¬å°†æ ¹æ®ç»Ÿè®¡å±æ€§å¯¹ç‰¹å¾è¿›è¡Œåˆæ­¥é€‰æ‹©ã€‚ </li><li> æˆ‘ä»¬è®¡ç®—ç¬¦å·ä¸ç›®æ ‡å˜é‡ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œä»¥åŠç¬¦å·ä¹‹é—´çš„äº’ç›¸å…³æ€§ã€‚ </li><li> æˆ‘ä»¬å°†å½¢æˆæœ€åä¸€ç»„åŠŸèƒ½ï¼Œè®­ç»ƒæ¨¡å‹å¹¶æ£€æŸ¥å…¶è´¨é‡ã€‚ </li><li> è®©æˆ‘ä»¬åˆ†ææ¨¡å‹çš„å†…éƒ¨ç»“æ„ä»¥è¯†åˆ«å¢é•¿ç‚¹ã€‚ </li></ul><br><p> åœ¨æˆ‘ä»¬çš„â€œæ—…é€”â€ä¸­ï¼Œæˆ‘ä»¬å°†ç†Ÿæ‚‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Zeppelin</a>äº¤äº’å¼ç¬”è®°æœ¬ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Spark ML</a>æœºå™¨å­¦ä¹ åº“åŠå…¶æ‰©å±•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaML</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GraphX</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å›¾å½¢</a>åŒ…ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Vegas</a>å¯è§†åŒ–åº“ï¼Œå½“ç„¶è¿˜æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Apache Sparkç­‰</a>æ‰€æœ‰å·¥å…·ï¼š ï¼‰ æ‰€æœ‰ä»£ç å’Œå®éªŒç»“æœéƒ½å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Zepl</a>åä½œç¬”è®°æœ¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¹³å°ä¸Šè·å¾—</a> ã€‚ </p><br><h1 id="zagruzka-dannyh"> èµ„æ–™è½½å…¥ </h1><br><p> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SNA Hackathon 2019</a>ä¸Šå±•ç¤ºçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ•°æ®</a>çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºå¯ä»¥ä½¿ç”¨Pythonç›´æ¥å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯è¿™å¾ˆå›°éš¾ï¼šç”±äºApache Parquetåˆ—æ ¼å¼çš„åŠŸèƒ½ï¼ŒåŸå§‹æ•°æ®å¾—åˆ°äº†éå¸¸æœ‰æ•ˆçš„æ‰“åŒ…ï¼Œå¹¶ä¸”å½“``æŒ‰é¢å¤´''è¯»å…¥å†…å­˜æ—¶ï¼Œå®ƒè¢«è§£å‹ç¼©ä¸ºæ•°åGBã€‚ ä½¿ç”¨Apache Sparkæ—¶ï¼Œä¸éœ€è¦å°†æ•°æ®å®Œå…¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒSparkä½“ç³»ç»“æ„æ—¨åœ¨å¤„ç†åˆ†æ®µæ•°æ®ï¼Œå¹¶æ ¹æ®éœ€è¦ä»ç£ç›˜åŠ è½½ã€‚ </p><br><p> å› æ­¤ï¼Œç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨ç›’è£…å·¥å…·è½»æ¾æ‰§è¡ŒæŒ‰å¤©æ£€æŸ¥æ•°æ®åˆ†å¸ƒçš„æ“ä½œï¼š </p><br><pre><code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> train = sqlContext.read.parquet(<span class="hljs-string"><span class="hljs-string">"/events/hackatons/SNAHackathon/2019/collabTrain"</span></span>) z.show(train.groupBy($<span class="hljs-string"><span class="hljs-string">"date"</span></span>).agg( functions.count($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"count"</span></span>), functions.countDistinct($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"users"</span></span>), functions.countDistinct($<span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"objects"</span></span>), functions.countDistinct($<span class="hljs-string"><span class="hljs-string">"metadata_ownerId"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"owners"</span></span>)) .orderBy(<span class="hljs-string"><span class="hljs-string">"date"</span></span>))</code> </pre> <br><p> ç›¸åº”çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å›¾å½¢å°†</a>åœ¨Zeppelinä¸­æ˜¾ç¤ºä»€ä¹ˆï¼š </p><br><p><img src="https://habrastorage.org/webt/jp/lh/pw/jplhpwwz4tfgdtrs1u_u-tqsvzi.png"></p><br><p> æˆ‘å¿…é¡»è¯´Scalaè¯­æ³•éå¸¸çµæ´»ï¼Œä¾‹å¦‚ï¼Œç›¸åŒçš„ä»£ç å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> train = sqlContext.read.parquet(<span class="hljs-string"><span class="hljs-string">"/events/hackatons/SNAHackathon/2019/collabTrain"</span></span>) z.show( train groupBy $<span class="hljs-string"><span class="hljs-string">"date"</span></span> agg( count($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>) as <span class="hljs-string"><span class="hljs-string">"count"</span></span>, countDistinct($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>) as <span class="hljs-string"><span class="hljs-string">"users"</span></span>, countDistinct($<span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>) as <span class="hljs-string"><span class="hljs-string">"objects"</span></span>, countDistinct($<span class="hljs-string"><span class="hljs-string">"metadata_ownerId"</span></span>) as <span class="hljs-string"><span class="hljs-string">"owners"</span></span>) orderBy <span class="hljs-string"><span class="hljs-string">"date"</span></span> )</code> </pre> <br><p> è¿™é‡Œåº”è¯¥å‘å‡ºä¸€ä¸ªé‡è¦çš„è­¦å‘Šï¼šå½“åœ¨ä¸€ä¸ªå¤§å‹å›¢é˜Ÿä¸­å·¥ä½œæ—¶ï¼Œæ¯ä¸ªäººéƒ½ä»è‡ªå·±çš„å“å‘³è§’åº¦ç€æ‰‹ç¼–å†™Scalaä»£ç ï¼Œè€Œäº¤æµåˆ™è¦å›°éš¾å¾—å¤šã€‚ å› æ­¤ï¼Œæœ€å¥½å¼€å‘å‡ºç»Ÿä¸€çš„ä»£ç é£æ ¼æ¦‚å¿µã€‚ </p><br><p> ä½†æ˜¯å›åˆ°æˆ‘ä»¬çš„ä»»åŠ¡ã€‚ æ¯å¤©è¿›è¡Œçš„ç®€å•åˆ†ææ˜¾ç¤ºï¼Œåœ¨2æœˆ17æ—¥å’Œ18æ—¥å‡ºç°äº†å¼‚å¸¸ç‚¹ï¼› å¯èƒ½è¿™å‡ å¤©æ”¶é›†çš„æ•°æ®ä¸å®Œæ•´ï¼Œæ€§çŠ¶çš„åˆ†å¸ƒå¯èƒ½æœ‰åå·®ã€‚ åœ¨è¿›ä¸€æ­¥åˆ†æä¸­åº”è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚ æ­¤å¤–ï¼Œä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå”¯ä¸€èº«ä»½ç”¨æˆ·æ•°ä¸å¯¹è±¡æ•°éå¸¸æ¥è¿‘ï¼Œå› æ­¤ç ”ç©¶å…·æœ‰ä¸åŒå¯¹è±¡æ•°çš„ç”¨æˆ·åˆ†å¸ƒæ˜¯æœ‰æ„ä¹‰çš„ï¼š </p><br><pre> <code class="scala hljs">z.show(filteredTrain .groupBy($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>).count .groupBy(<span class="hljs-string"><span class="hljs-string">"count"</span></span>).agg(functions.log(functions.count(<span class="hljs-string"><span class="hljs-string">"count"</span></span>)).as(<span class="hljs-string"><span class="hljs-string">"withCount"</span></span>)) .orderBy($<span class="hljs-string"><span class="hljs-string">"withCount"</span></span>.desc) .limit(<span class="hljs-number"><span class="hljs-number">100</span></span>) .orderBy($<span class="hljs-string"><span class="hljs-string">"count"</span></span>))</code> </pre> <br><p><img src="https://habrastorage.org/webt/dh/i-/pp/dhi-ppdka19zurhimccpq7tij5w.png"></p><br><p> é¢„è®¡å°†çœ‹åˆ°æ¥è¿‘æŒ‡æ•°åˆ†å¸ƒï¼Œå°¾å·´å¾ˆé•¿ã€‚ é€šå¸¸ï¼Œåœ¨æ­¤ç±»ä»»åŠ¡ä¸­ï¼Œå¯ä»¥é€šè¿‡ç»†åˆ†å…·æœ‰ä¸åŒæ´»åŠ¨çº§åˆ«çš„ç”¨æˆ·çš„æ¨¡å‹æ¥æé«˜å·¥ä½œè´¨é‡ã€‚ ä¸ºäº†æ£€æŸ¥æ˜¯å¦å€¼å¾—è¿™æ ·åšï¼Œè¯·æ¯”è¾ƒç”¨æˆ·åœ¨æµ‹è¯•é›†ä¸­çš„å¯¹è±¡æ•°é‡åˆ†å¸ƒï¼š </p><br><p><img src="https://habrastorage.org/webt/du/sy/xt/dusyxten5shm24an736n7akolnm.png"></p><br><p> ä¸æµ‹è¯•çš„æ¯”è¾ƒè¡¨æ˜ï¼Œæµ‹è¯•ç”¨æˆ·çš„æ—¥å¿—ä¸­è‡³å°‘æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼ˆç”±äºåœ¨é»‘å®¢é©¬æ‹‰æ¾ä¸Šè§£å†³äº†æ’åé—®é¢˜ï¼Œè¿™æ˜¯è¯„ä¼°è´¨é‡çš„å¿…è¦æ¡ä»¶ï¼‰ã€‚ å°†æ¥ï¼Œæˆ‘å»ºè®®æ‚¨ä»”ç»†æŸ¥çœ‹åŸ¹è®­é›†ä¸­çš„ç”¨æˆ·ï¼Œä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨è¿‡æ»¤å™¨å£°æ˜â€œç”¨æˆ·å®šä¹‰çš„å‡½æ•°â€ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,     "",   , //     val testSimilar = sc.broadcast(filteredTrain.groupBy($"instanceId_userId") .agg( functions.count("feedback").as("count"), functions.sum(functions.expr("IF(array_contains(feedback, 'Liked'), 1.0, 0.0)")).as("sum") ) .where("count &gt; sum AND sum &gt; 0") .select("instanceId_userId").rdd.map(_.getInt(0)).collect.sorted) //           // User Defined Function val isTestSimilar = sqlContext.udf.register("isTestSimilar", (x: Int) =&gt; java.util.Arrays.binarySearch(testSimilar.value, x) &gt;= 0)</span></span></code> </pre> <br><p> åœ¨è¿™é‡Œè¿˜åº”è¯¥æŒ‡å‡ºä¸€ä¸ªé‡è¦çš„è§‚ç‚¹ï¼šä»å®šä¹‰UDFçš„è§’åº¦æ¥çœ‹ï¼ŒScala / Javaå’ŒPythonä¸‹å¯¹Sparkçš„ä½¿ç”¨æˆªç„¶ä¸åŒã€‚ è™½ç„¶PySparkä»£ç ä½¿ç”¨åŸºæœ¬åŠŸèƒ½ï¼Œä½†ä¸€åˆ‡å·¥ä½œå‡ ä¹éƒ½ä¸€æ ·å¿«ï¼Œä½†æ˜¯å½“å‡ºç°è¢«è¦†ç›–çš„åŠŸèƒ½æ—¶ï¼ŒPySparkçš„æ€§èƒ½å°†é™ä½ä¸€ä¸ªæ•°é‡çº§ã€‚ </p><br><h1 id="pervyy-ml-konveyer"> ç¬¬ä¸€æ¡MLç®¡é“ </h1><br><p> åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•è®¡ç®—æœ‰å…³æ“ä½œå’Œå±æ€§çš„åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ã€‚ ä½†æ˜¯ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦SparkMLçš„åŠŸèƒ½ï¼Œå› æ­¤é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…¶ä¸€èˆ¬æ¶æ„ï¼š </p><br><p><img src="https://habrastorage.org/webt/j7/ev/en/j7evenhyzzfvzouqfkbfq1j9hvu.png"></p><br><p>  SparkMLæ˜¯åŸºäºä»¥ä¸‹æ¦‚å¿µæ„å»ºçš„ï¼š </p><br><ul><li> å˜å‹å™¨-å°†æ•°æ®é›†ä½œä¸ºè¾“å…¥å¹¶è¿”å›ä¿®æ”¹åçš„é›†ï¼ˆå˜æ¢ï¼‰ã€‚ é€šå¸¸ï¼Œå®ƒç”¨äºå®ç°é¢„å¤„ç†å’Œåå¤„ç†ç®—æ³•ï¼Œç‰¹å¾æå–ï¼Œè¿˜å¯ä»¥è¡¨ç¤ºç”Ÿæˆçš„MLæ¨¡å‹ã€‚ </li><li> ä¼°è®¡å™¨-å°†æ•°æ®é›†ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›Transformerï¼ˆæ‹Ÿåˆï¼‰ã€‚ è‡ªç„¶ï¼Œä¼°è®¡å™¨å¯ä»¥è¡¨ç¤ºMLç®—æ³•ã€‚ </li><li> ç®¡é“æ˜¯ä¼°ç®—å™¨çš„ä¸€ç§ç‰¹ä¾‹ï¼Œå®ƒç”±ä¸€ç³»åˆ—å˜å‹å™¨å’Œä¼°ç®—å™¨ç»„æˆã€‚ è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œfité€šè¿‡é“¾ï¼Œå¦‚æœå®ƒçœ‹åˆ°ä¸€ä¸ªè½¬æ¢å™¨ï¼Œåˆ™å°†å…¶åº”ç”¨äºæ•°æ®ï¼Œå¦‚æœå®ƒçœ‹åˆ°ä¸€ä¸ªä¼°è®¡å™¨ï¼Œåˆ™å¯¹å…¶è¿›è¡Œè®­ç»ƒï¼Œå°†å…¶åº”ç”¨äºæ•°æ®ï¼Œç„¶åç»§ç»­ã€‚ </li><li>  PipelineModel-Pipelineçš„ç»“æœåœ¨å†…éƒ¨ä¹ŸåŒ…å«ä¸€ä¸ªé“¾ï¼Œä½†ä»…ç”±å˜å‹å™¨ç»„æˆã€‚ å› æ­¤ï¼ŒPipelineModelæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè½¬æ¢å™¨ã€‚ </li></ul><br><p> è¿™ç§å½¢æˆMLç®—æ³•çš„æ–¹æ³•æœ‰åŠ©äºå®ç°æ¸…æ™°çš„æ¨¡å—åŒ–ç»“æ„å’Œè‰¯å¥½çš„å¯é‡å¤æ€§-å¯ä»¥èŠ‚çœæ¨¡å‹å’Œç®¡çº¿ã€‚ </p><br><p> é¦–å…ˆï¼Œæˆ‘ä»¬å°†å»ºç«‹ä¸€ä¸ªç®€å•çš„ç®¡é“ï¼Œé€šè¿‡è¯¥ç®¡é“æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºè®­ç»ƒé›†ä¸­ç”¨æˆ·çš„åŠ¨ä½œåˆ†å¸ƒï¼ˆåé¦ˆå­—æ®µï¼‰çš„ç»Ÿè®¡ä¿¡æ¯ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> feedbackAggregator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-comment"><span class="hljs-comment">//         (feedback)  one-hot  new MultinominalExtractor().setInputCol("feedback").setOutputCol("feedback"), //       new VectorStatCollector() .setGroupByColumns("date").setInputCol("feedback") .setPercentiles(Array(0.1,0.5,0.9)), //        new VectorExplode().setValueCol("feedback") )).fit(train) z.show(feedbackAggregator .transform(filteredTrain) .orderBy($"date", $"feedback"))</span></span></code> </pre> <br><p> åœ¨æ­¤ç®¡é“ä¸­ï¼Œå°†ç§¯æä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaML</a>çš„åŠŸèƒ½-å…·æœ‰æ‰©å±•çš„SparkMLæœ‰ç”¨å—çš„åº“ï¼Œå³ï¼š </p><br><ul><li>  MultinominalExtractorç”¨äºæ ¹æ®â€œä¸€é”®é€šâ€åŸç†å°†â€œå­—ç¬¦ä¸²æ•°ç»„â€ç±»å‹çš„å­—ç¬¦ç¼–ç ä¸ºçŸ¢é‡ã€‚ è¿™æ˜¯ç®¡é“ä¸­çš„å”¯ä¸€ä¼°ç®—å™¨ï¼ˆè¦æ„å»ºç¼–ç ï¼Œå¿…é¡»ä»æ•°æ®é›†ä¸­æ”¶é›†å”¯ä¸€çš„è¡Œï¼‰ã€‚ </li><li>  VectorStatCollectorç”¨äºè®¡ç®—å‘é‡ç»Ÿè®¡ä¿¡æ¯ã€‚ </li><li>  VectorExplodeç”¨äºå°†ç»“æœè½¬æ¢ä¸ºä¾¿äºå¯è§†åŒ–çš„æ ¼å¼ã€‚ </li></ul><br><p> å·¥ä½œçš„ç»“æœå°†æ˜¯ä¸€å¼ å›¾è¡¨ï¼Œæ˜¾ç¤ºæ•°æ®é›†ä¸­çš„ç±»ä¸å¹³è¡¡ï¼Œä½†æ˜¯ç›®æ ‡Likedç±»çš„ä¸å¹³è¡¡ä¸æ˜¯æç«¯çš„ï¼š </p><br><p><img src="https://habrastorage.org/webt/aa/db/x4/aadbx4el5s5lhuyput_cj4ns9zo.png"></p><br><p> å¯¹ä¸æµ‹è¯•ç”¨æˆ·ç›¸ä¼¼çš„ç”¨æˆ·ä¹‹é—´ç›¸ä¼¼åˆ†å¸ƒçš„åˆ†æï¼ˆæ—¥å¿—ä¸­åŒæ—¶å…·æœ‰â€œæ­£â€å’Œâ€œè´Ÿâ€ï¼‰è¡¨æ˜ï¼Œå®ƒåå‘æ­£ç±»åˆ«ï¼š </p><br><p><img src="https://habrastorage.org/webt/x5/lu/px/x5lupxmayvvodo7lsb3meob1dou.png"></p><br><h1 id="statisticheskiy-analiz-priznakov"> æ ‡å¿—çš„ç»Ÿè®¡åˆ†æ </h1><br><p> åœ¨ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å°†å¯¹å±æ€§çš„ç»Ÿè®¡å±æ€§è¿›è¡Œè¯¦ç»†åˆ†æã€‚ è¿™æ¬¡æˆ‘ä»¬éœ€è¦æ›´å¤§çš„è¾“é€æœºï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> statsAggregator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">NullToDefaultReplacer</span></span>(), <span class="hljs-comment"><span class="hljs-comment">//          new AutoAssembler() .setColumnsToExclude( (Seq("date", "feedback") ++ train.schema.fieldNames.filter(_.endsWith("Id")) : _*)) .setOutputCol("features"), new VectorStatCollector() .setGroupByColumns("date").setInputCol("features") .setPercentiles(Array(0.1,0.5,0.9)), new VectorExplode().setValueCol("features") ))</span></span></code> </pre> <br><p> ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨å•ç‹¬çš„å­—æ®µï¼Œè€Œæ˜¯è¦åŒæ—¶å¤„ç†æ‰€æœ‰å±æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªæ›´æœ‰ç”¨çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaML</a>å®ç”¨ç¨‹åºï¼š </p><br><ul><li>  NullToDefaultReplacerå…è®¸æ‚¨å°†æ•°æ®ä¸­ç¼ºå°‘çš„å…ƒç´ æ›¿æ¢ä¸ºå…¶é»˜è®¤å€¼ï¼ˆ0è¡¨ç¤ºæ•°å­—ï¼Œfalseè¡¨ç¤ºé€»è¾‘å˜é‡ï¼Œç­‰ç­‰ï¼‰ã€‚ å¦‚æœä¸æ‰§è¡Œæ­¤è½¬æ¢ï¼Œåˆ™NaNå€¼å°†å‡ºç°åœ¨ç»“æœå‘é‡ä¸­ï¼Œè¿™å¯¹è®¸å¤šç®—æ³•æ¥è¯´éƒ½æ˜¯è‡´å‘½çš„ï¼ˆå°½ç®¡ä¾‹å¦‚XGBoostå¯ä»¥å¹¸å…äºæ­¤ï¼‰ã€‚  NaNToMeanReplacerEstimatorä¸­å®ç°äº†ç”¨é›¶æ›¿ä»£çš„æ›¿ä»£æ–¹æ³•æ˜¯ç”¨å¹³å‡å€¼æ›¿ä»£ã€‚ </li><li>  AutoAssembleræ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å®ç”¨ç¨‹åºï¼Œå¯ä»¥åˆ†æè¡¨å¸ƒå±€ï¼Œå¹¶ä¸ºæ¯åˆ—é€‰æ‹©ä¸åˆ—ç±»å‹åŒ¹é…çš„çŸ¢é‡åŒ–æ–¹æ¡ˆã€‚ </li></ul><br><p> ä½¿ç”¨ç”Ÿæˆçš„ç®¡é“ï¼Œæˆ‘ä»¬è®¡ç®—ä¸‰ç»„ç»Ÿè®¡ä¿¡æ¯ï¼ˆåŸ¹è®­ï¼Œç”¨æˆ·è¿‡æ»¤å™¨åŸ¹è®­å’Œæµ‹è¯•ï¼‰å¹¶å°†å…¶ä¿å­˜åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//   (   AutoAssembler  ) val trained = statsAggregator.fit(filteredTrain) //       - ,     . trained .transform(filteredTrain .withColumn("date", //  ,      ,     , //        All   functions.explode(functions.array(functions.lit("All"), $"date")))) .coalesce(7).write.mode("overwrite").parquet("sna2019/featuresStat") trained .transform(filteredTrain .where(isTestSimilar($"instanceId_userId")) .withColumn("date", functions.explode(functions.array(functions.lit("All"), $"date")))) .coalesce(7).write.mode("overwrite").parquet("sna2019/filteredFeaturesStat") trained .transform(filteredTest.withColumn("date", functions.explode(functions.array(functions.lit("All"), $"date")))) .coalesce(3).write.mode("overwrite").parquet("sna2019/testFeaturesStat")</span></span></code> </pre> <br><p> æ¥æ”¶äº†ä¸‰ä¸ªå…·æœ‰å±æ€§ç»Ÿè®¡ä¿¡æ¯çš„æ•°æ®é›†åï¼Œæˆ‘ä»¬åˆ†æäº†ä»¥ä¸‹å†…å®¹ï¼š </p><br><ul><li> æˆ‘ä»¬æ˜¯å¦æœ‰æ’æ”¾é‡å¤§çš„æ ‡å¿—ï¼Ÿ <br>  -åº”è¯¥é™åˆ¶è¿™ç§è¿¹è±¡ï¼Œæˆ–è€…åº”è¯¥è¿‡æ»¤æ‰å¼‚å¸¸è®°å½•ã€‚ </li><li> ç›¸å¯¹äºä¸­ä½æ•°ï¼Œæˆ‘ä»¬çš„å¹³å‡åå·®æ˜¯å¦å¤§ï¼Ÿ <br>  -è¿™ç§åç§»é€šå¸¸å‘ç”Ÿåœ¨é…ç”µçš„æƒ…å†µä¸‹ï¼Œå¯¹æ•°è¿™äº›ç¬¦å·æ˜¯åˆç†çš„ã€‚ </li><li> è®­ç»ƒå’Œæµ‹è¯•é›†ä¹‹é—´çš„å¹³å‡åˆ†å¸ƒæ˜¯å¦æœ‰å˜åŒ–ã€‚ </li><li> å¦‚ä½•ç´§å¯†å¡«å……æˆ‘ä»¬çš„ç‰¹å¾çŸ©é˜µã€‚ </li></ul><br><p> ä¸ºäº†æ¾„æ¸…è¿™äº›æ–¹é¢ï¼Œè¿™æ ·çš„è¯·æ±‚å°†å¸®åŠ©æˆ‘ä»¬ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compareWithTest</span></span></span></span>(data: <span class="hljs-type"><span class="hljs-type">DataFrame</span></span>) : <span class="hljs-type"><span class="hljs-type">DataFrame</span></span> = { data.where(<span class="hljs-string"><span class="hljs-string">"date = 'All'"</span></span>) .select( $<span class="hljs-string"><span class="hljs-string">"features"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//         // ( ) functions.log($"features_mean" / $"features_p50").as("skewenes"), //    90-      //    90-  â€”    functions.log( ($"features_max" - $"features_p90") / ($"features_p90" - $"features_p50")).as("outlieres"), //       ,  //    ($"features_nonZeros" / $"features_count").as("train_fill"), $"features_mean".as("train_mean")) .join(testStat.where("date = 'All'") .select($"features", $"features_mean".as("test_mean"), ($"features_nonZeros" / $"features_count").as("test_fill")), Seq("features")) //          .withColumn("meanDrift", (($"train_mean" - $"test_mean" ) / ($"train_mean" + $"test_mean"))) //      .withColumn("fillDrift", ($"train_fill" - $"test_fill") / ($"train_fill" + $"test_fill")) } //         val comparison = compareWithTest(trainStat).withColumn("mode", functions.lit("raw")) .unionByName(compareWithTest(filteredStat).withColumn("mode", functions.lit("filtered")))</span></span></code> </pre> <br><p> åœ¨æ­¤é˜¶æ®µï¼Œå¯è§†åŒ–é—®é¢˜è¿«åœ¨çœ‰ç«ï¼šä½¿ç”¨å¸¸è§„çš„Zeppelinå·¥å…·å¾ˆéš¾ç«‹å³æ˜¾ç¤ºæ‰€æœ‰æ–¹é¢ï¼Œå¹¶ä¸”ç”±äºDOMè†¨èƒ€ï¼Œå¸¦æœ‰å¤§é‡å›¾å½¢çš„ç¬”è®°æœ¬å¼€å§‹æ˜¾ç€æ”¾æ…¢é€Ÿåº¦ã€‚  Scalaä¸Šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Vegas</a> -DSLåº“ç”¨äºæ„å»º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">vega-lite</a>è§„èŒƒå¯ä»¥è§£å†³æ­¤é—®é¢˜ã€‚  Vegasä¸ä»…æä¾›äº†æ›´ä¸°å¯Œçš„å¯è§†åŒ–åŠŸèƒ½ï¼ˆä¸matplotlibç›¸å½“ï¼‰ï¼Œè€Œä¸”è¿˜å¯ä»¥åœ¨Canvasä¸Šç»˜åˆ¶å®ƒä»¬è€Œä¸ä¼šè†¨èƒ€DOM :)ã€‚ </p><br><p> æˆ‘ä»¬æ„Ÿå…´è¶£çš„å›¾è¡¨è§„æ ¼å°†å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="scala hljs">vegas.<span class="hljs-type"><span class="hljs-type">Vegas</span></span>(width = <span class="hljs-number"><span class="hljs-number">1024</span></span>, height = <span class="hljs-number"><span class="hljs-number">648</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   .withDataFrame(comparison.na.fill(0.0)) //           .encodeX("meanDrift", Quant, scale = Scale(domainValues = List(-1.0, 1.0), clamp = true)) //   -       .encodeY("train_fill", Quant) //       .encodeColor("outlieres", Quant, scale=Scale( rangeNominals=List("#00FF00", "#FF0000"), domainValues = List(0.0, 5), clamp = true)) //       .encodeSize("skewenes", Quant) //   -   (   ) .encodeShape("mode", Nom) .mark(vegas.Point) .show</span></span></code> </pre> <br><p> ä¸‹å›¾åº”å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><ul><li>  Xè½´æ˜¾ç¤ºæµ‹è¯•å’Œè®­ç»ƒé›†ä¹‹é—´åˆ†å¸ƒä¸­å¿ƒçš„ç§»åŠ¨ï¼ˆè¶Šæ¥è¿‘0ï¼Œç¬¦å·è¶Šç¨³å®šï¼‰ã€‚ </li><li> æ²¿Yè½´ç»˜åˆ¶éé›¶å…ƒç´ çš„ç™¾åˆ†æ¯”ï¼ˆæ•°å€¼è¶Šé«˜ï¼Œè¡¨ç¤ºå±æ€§çš„ç‚¹æ•°è¶Šå¤šï¼Œæ•°æ®è¶Šå¤šï¼‰ã€‚ </li><li> å¤§å°æ˜¾ç¤ºå¹³å‡å€¼ç›¸å¯¹äºä¸­ä½æ•°çš„ä½ç§»ï¼ˆç‚¹è¶Šå¤§ï¼Œå¹‚å®šå¾‹åˆ†å¸ƒçš„å¯èƒ½æ€§è¶Šå¤§ï¼‰ã€‚ </li><li> é¢œè‰²è¡¨ç¤ºæ’æ”¾ï¼ˆè¶Šçº¢ï¼Œæ’æ”¾è¶Šå¤šï¼‰ã€‚ </li><li> å¥½å§ï¼Œè¿™ç§å½¢å¼çš„åŒºåˆ«åœ¨äºæ¯”è¾ƒæ¨¡å¼ï¼šè®­ç»ƒé›†ä¸­æœ‰ç”¨æˆ·è¿‡æ»¤å™¨æˆ–æ²¡æœ‰è¿‡æ»¤å™¨ã€‚ </li></ul><br><p><img src="https://habrastorage.org/webt/op/hb/6g/ophb6gi3wa_uvsld9rre6ujzquu.png"></p><br><p> å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š </p><br><ul><li> æœ‰äº›æ ‡å¿—éœ€è¦å‘å°„è¿‡æ»¤å™¨-æˆ‘ä»¬å°†é™åˆ¶90ï¼…çš„æœ€å¤§å€¼ã€‚ </li><li> ä¸€äº›è¿¹è±¡è¡¨æ˜åˆ†å¸ƒæ¥è¿‘æŒ‡æ•°-æˆ‘ä»¬å°†é‡‡ç”¨å¯¹æ•°ã€‚ </li><li> æµ‹è¯•ä¸­æœªæä¾›æŸäº›åŠŸèƒ½-æˆ‘ä»¬å°†å…¶æ’é™¤åœ¨åŸ¹è®­èŒƒå›´ä¹‹å¤–ã€‚ </li></ul><br><h1 id="korrelyacionnyy-analiz"> ç›¸å…³åˆ†æ </h1><br><p> åœ¨å¤§è‡´äº†è§£å±æ€§å¦‚ä½•åˆ†å¸ƒä»¥åŠå®ƒä»¬åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¹‹é—´çš„å…³ç³»ä¹‹åï¼Œè®©æˆ‘ä»¬å°è¯•åˆ†æç›¸å…³æ€§ã€‚ ä¸ºæ­¤ï¼Œè¯·æ ¹æ®ä»¥å‰çš„è§‚å¯Ÿç»“æœé…ç½®ç‰¹å¾æå–å™¨ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//             val expressions = filteredTrain.schema.fieldNames //          .filterNot(x =&gt; x == "date" || x == "audit_experiment" || idsColumns(x) || x.contains("vd_")) .map(x =&gt; if(skewedFeautres(x)) { //      s"log($x) AS $x" } else { //     cappedFeatures.get(x).map(capping =&gt; s"IF($x &lt; $capping, $x, $capping) AS $x").getOrElse(x) }) val rawFeaturesExtractor = new Pipeline().setStages(Array( new SQLTransformer().setStatement(s"SELECT ${expressions.mkString(", ")} FROM __THIS__"), new NullToDefaultReplacer(), new AutoAssembler().setOutputCol("features") )) //       val raw = rawFeaturesExtractor.fit(filteredTrain).transform( filteredTrain.where(isTestSimilar($"instanceId_userId")))</span></span></code> </pre> <br><p> åœ¨æ­¤ç®¡é“ä¸­çš„æ–°æœºå™¨ä¸­ï¼ŒSQLTransformerå®ç”¨ç¨‹åºå¼•èµ·äº†äººä»¬çš„æ³¨æ„ï¼Œå®ƒå…è®¸å¯¹è¾“å…¥è¡¨è¿›è¡Œä»»æ„SQLè½¬æ¢ã€‚ </p><br><p> åœ¨åˆ†æç›¸å…³æ€§æ—¶ï¼Œé‡è¦çš„æ˜¯è¦æ»¤é™¤ç”±ä¸€ä¸ªçƒ­ç‚¹ç‰¹å¾çš„è‡ªç„¶ç›¸å…³æ€§äº§ç”Ÿçš„å™ªå£°ã€‚ ä¸ºæ­¤ï¼Œæˆ‘æƒ³äº†è§£å‘é‡çš„å“ªäº›å…ƒç´ å¯¹åº”äºå“ªäº›æºåˆ—ã€‚  Sparkä¸­çš„æ­¤ä»»åŠ¡ä½¿ç”¨åˆ—å…ƒæ•°æ®ï¼ˆä¸æ•°æ®ä¸€èµ·å­˜å‚¨ï¼‰å’Œå±æ€§ç»„å®Œæˆã€‚ ä»¥ä¸‹ä»£ç å—ç”¨äºè¿‡æ»¤æ¥è‡ªåŒä¸€å­—ç¬¦ä¸²ç±»å‹çš„åŒä¸€åˆ—çš„å±æ€§åç§°å¯¹ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> attributes = <span class="hljs-type"><span class="hljs-type">AttributeGroup</span></span>.fromStructField(raw.schema(<span class="hljs-string"><span class="hljs-string">"features"</span></span>)).attributes.get <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> originMap = filteredTrain .schema.filter(_.dataType == <span class="hljs-type"><span class="hljs-type">StringType</span></span>) .flatMap(x =&gt; attributes.map(_.name.get).filter(_.startsWith(x.name + <span class="hljs-string"><span class="hljs-string">"_"</span></span>)).map(_ -&gt; x.name)) .toMap <span class="hljs-comment"><span class="hljs-comment">//   ,          val isNonTrivialCorrelation = sqlContext.udf.register("isNonTrivialCorrelation", (x: String, y : String) =&gt; //    Scala-quiz   Option originMap.get(x).map(_ != originMap.getOrElse(y, "")).getOrElse(true))</span></span></code> </pre> <br><p> æ‹¥æœ‰ä¸€ä¸ªå¸¦æœ‰å‘é‡åˆ—çš„æ•°æ®é›†ï¼Œä½¿ç”¨Sparkè®¡ç®—äº’ç›¸å…³éå¸¸ç®€å•ï¼Œä½†æ˜¯ç»“æœæ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œè¦éƒ¨ç½²è¯¥çŸ©é˜µï¼Œæ‚¨å°†éœ€è¦ä¸€ç‚¹ç‚¹æˆå¯¹åœ°è¿›è¡Œæ“ä½œï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pearsonCorrelation = <span class="hljs-comment"><span class="hljs-comment">//    Pearson  Spearman Correlation.corr(raw, "features", "pearson").rdd.flatMap( //           _.getAs[Matrix](0).rowIter.zipWithIndex.flatMap(x =&gt; { //   ,   (  , //  ) val name = attributes(x._2).name.get //    ,     x._1.toArray.zip(attributes).map(y =&gt; (name, y._2.name.get, y._1)) } //     DataFrame )).toDF("feature1", "feature2", "corr") .na.drop //   .where(isNonTrivialCorrelation($"feature1", $"feature2")) //    . pearsonCorrelation.coalesce(1).write.mode("overwrite") .parquet("sna2019/pearsonCorrelation")</span></span></code> </pre> <br><p> å½“ç„¶ï¼Œè¿˜æœ‰å¯è§†åŒ–ï¼šæˆ‘ä»¬å°†å†æ¬¡éœ€è¦Vegasçš„å¸®åŠ©æ¥ç»˜åˆ¶çƒ­å›¾ï¼š </p><br><pre> <code class="scala hljs">vegas.<span class="hljs-type"><span class="hljs-type">Vegas</span></span>(<span class="hljs-string"><span class="hljs-string">"Pearson correlation heatmap"</span></span>) .withDataFrame(pearsonCorrelation .withColumn(<span class="hljs-string"><span class="hljs-string">"isPositive"</span></span>, $<span class="hljs-string"><span class="hljs-string">"corr"</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .withColumn(<span class="hljs-string"><span class="hljs-string">"abs_corr"</span></span>, functions.abs($<span class="hljs-string"><span class="hljs-string">"corr"</span></span>)) .where(<span class="hljs-string"><span class="hljs-string">"feature1 &lt; feature2 AND abs_corr &gt; 0.05"</span></span>) .orderBy(<span class="hljs-string"><span class="hljs-string">"feature1"</span></span>, <span class="hljs-string"><span class="hljs-string">"feature2"</span></span>)) .encodeX(<span class="hljs-string"><span class="hljs-string">"feature1"</span></span>, <span class="hljs-type"><span class="hljs-type">Nom</span></span>) .encodeY(<span class="hljs-string"><span class="hljs-string">"feature2"</span></span>, <span class="hljs-type"><span class="hljs-type">Nom</span></span>) .encodeColor(<span class="hljs-string"><span class="hljs-string">"abs_corr"</span></span>, <span class="hljs-type"><span class="hljs-type">Quant</span></span>, scale=<span class="hljs-type"><span class="hljs-type">Scale</span></span>(rangeNominals=<span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-string"><span class="hljs-string">"#FFFFFF"</span></span>, <span class="hljs-string"><span class="hljs-string">"#FF0000"</span></span>))) .encodeShape(<span class="hljs-string"><span class="hljs-string">"isPositive"</span></span>, <span class="hljs-type"><span class="hljs-type">Nom</span></span>) .mark(vegas.<span class="hljs-type"><span class="hljs-type">Point</span></span>) .show</code> </pre> <br><p> ç»“æœæœ€å¥½åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Zepl-eä¸­</a>æŸ¥çœ‹ã€‚ å¤§è‡´äº†è§£ï¼š </p><br><p><img src="https://habrastorage.org/webt/nm/d9/bm/nmd9bmrion4goaov9_vgx5vbjoy.png"></p><br><p> çƒ­å›¾æ˜¾ç¤ºä¸€äº›ç›¸å…³æ€§æ˜¾ç„¶å­˜åœ¨ã€‚ è®©æˆ‘ä»¬å°è¯•é€‰æ‹©å…·æœ‰æœ€å¼ºç›¸å…³æ€§çš„åŠŸèƒ½å—ï¼Œä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GraphX</a>åº“ï¼šå°†ç›¸å…³æ€§çŸ©é˜µè½¬æ¢ä¸ºå›¾å½¢ï¼ŒæŒ‰æƒé‡è¿‡æ»¤è¾¹ç¼˜ï¼Œç„¶åæ‰¾åˆ°è¿æ¥çš„ç»„ä»¶å¹¶ä»…ä¿ç•™æœªé€€åŒ–çš„ç»„ä»¶ï¼ˆæ¥è‡ªå¤šä¸ªå…ƒç´ ï¼‰ã€‚ è¿™æ ·çš„è¿‡ç¨‹æœ¬è´¨ä¸Šç±»ä¼¼äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DBSCAN</a>ç®—æ³•çš„åº”ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//   (GrpahX   ID) val featureIndexMap = spearmanCorrelation.select("feature1").distinct.rdd.map( _.getString(0)).collect.zipWithIndex.toMap val featureIndex = sqlContext.udf.register("featureIndex", (x: String) =&gt; featureIndexMap(x)) //    val vertices = sc.parallelize(featureIndexMap.map(x =&gt; x._2.toLong -&gt; x._1).toSeq, 1) //    val edges = spearmanCorrelation.select(featureIndex($"feature1"), featureIndex($"feature2"), $"corr") //     .where("ABS(corr) &gt; 0.7") .rdd.map(r =&gt; Edge(r.getInt(0), r.getInt(1), r.getDouble(2))) //       val components = Graph(vertices, edges).connectedComponents() val reversedMap = featureIndexMap.map(_.swap) //    ,    ,   //   val clusters = components .vertices.map(x =&gt; reversedMap(x._2.toInt) -&gt; reversedMap(x._1.toInt)) .groupByKey().map(x =&gt; x._2.toSeq) .filter(_.size &gt; 1) .sortBy(-_.size) .collect</span></span></code> </pre> <br><p> ç»“æœä»¥è¡¨æ ¼å½¢å¼æ˜¾ç¤ºï¼š </p><br><p><img src="https://habrastorage.org/webt/4b/t2/bl/4bt2blcjzmxbzucnm7zynpvpj-q.png"></p><br><p> æ ¹æ®èšç±»çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œæœ€ç›¸å…³çš„ç»„å›´ç»•ä¸è¯¥ç»„ä¸­çš„ç”¨æˆ·æˆå‘˜èº«ä»½ç›¸å…³çš„ç¬¦å·ï¼ˆmembership_status_Aï¼‰ä»¥åŠå¯¹è±¡ç±»å‹ï¼ˆinstanceId_objectTypeï¼‰å½¢æˆã€‚ ä¸ºäº†å¯¹ç¬¦å·äº¤äº’è¿›è¡Œæœ€ä½³å»ºæ¨¡ï¼Œæœ‰å¿…è¦åº”ç”¨æ¨¡å‹ç»†åˆ†-ä¸ºä¸åŒç±»å‹çš„å¯¹è±¡è®­ç»ƒä¸åŒçš„æ¨¡å‹ï¼Œåˆ†åˆ«é’ˆå¯¹ç”¨æˆ·æ‰€åœ¨æˆ–ä¸åœ¨çš„ç»„è¿›è¡Œè®­ç»ƒã€‚ </p><br><h1 id="mashinnoe-obuchenie"> æœºå™¨å­¦ä¹  </h1><br><p> æˆ‘ä»¬é‡‡ç”¨æœ€æœ‰è¶£çš„æ–¹æ³•-æœºå™¨å­¦ä¹ ã€‚ ä½¿ç”¨SparkMLå’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaML</a>æ‰©å±•æ¥è®­ç»ƒæœ€ç®€å•çš„æ¨¡å‹ï¼ˆé€»è¾‘å›å½’ï¼‰çš„ç®¡é“å¦‚ä¸‹ï¼š </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SQLTransformer</span></span>().setStatement( <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"SELECT *, IF(array_contains(feedback, 'Liked'), 1.0, 0.0) AS label FROM __THIS__"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">NullToDefaultReplacer</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">AutoAssembler</span></span>() .setColumnsToExclude(<span class="hljs-string"><span class="hljs-string">"date"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>, <span class="hljs-string"><span class="hljs-string">"feedback"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"features"</span></span>), <span class="hljs-type"><span class="hljs-type">Scaler</span></span>.scale(<span class="hljs-type"><span class="hljs-type">Interceptor</span></span>.intercept(<span class="hljs-type"><span class="hljs-type">UnwrappedStage</span></span>.repartition( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">LogisticRegressionLBFSG</span></span>(), numPartitions = <span class="hljs-number"><span class="hljs-number">127</span></span>)))</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ä»…çœ‹åˆ°è®¸å¤šç†Ÿæ‚‰çš„å…ƒç´ ï¼Œè€Œä¸”è¿˜çœ‹åˆ°äº†å‡ ä¸ªæ–°å…ƒç´ ï¼š </p><br><ul><li>  LogisticRegressionLBFSGæ˜¯å¯¹Logisticå›å½’è¿›è¡Œåˆ†å¸ƒå¼è®­ç»ƒçš„ä¼°è®¡å™¨ã€‚ </li><li> ä¸ºäº†ä»åˆ†å¸ƒå¼MLç®—æ³•ä¸­è·å¾—æœ€å¤§æ€§èƒ½ã€‚ æ•°æ®åº”æœ€ä½³åœ°åˆ†å¸ƒåœ¨åˆ†åŒºä¹‹é—´ã€‚  UnwrappedStage.repartitionå®ç”¨ç¨‹åºå°†å¯¹æ­¤æœ‰æ‰€å¸®åŠ©ï¼Œå°†é‡æ–°åˆ†åŒºæ“ä½œæ·»åŠ åˆ°ç®¡é“ä¸­ï¼Œä½¿å…¶ä»…åœ¨è®­ç»ƒé˜¶æ®µä½¿ç”¨ï¼ˆæ¯•ç«Ÿï¼Œåœ¨æ„å»ºé¢„æµ‹æ—¶ï¼Œä¸å†éœ€è¦ï¼‰ã€‚ </li><li> è¿™æ ·çº¿æ€§æ¨¡å‹å¯ä»¥ç»™å‡ºå¾ˆå¥½çš„ç»“æœã€‚ å¿…é¡»ç¼©æ”¾æ•°æ®ï¼Œç”±Scaler.scaleå®ç”¨ç¨‹åºè´Ÿè´£ã€‚ ä½†æ˜¯ï¼Œä¸¤ä¸ªè¿ç»­çš„çº¿æ€§å˜æ¢ï¼ˆæŒ‰æ¯”ä¾‹ç¼©æ”¾å’Œä¹˜ä»¥å›å½’æƒé‡ï¼‰çš„å­˜åœ¨ä¼šå¯¼è‡´ä¸å¿…è¦çš„å¼€é”€ï¼Œå¹¶ä¸”å¸Œæœ›æŠ˜å è¿™äº›è¿ç®—ã€‚ ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaMLæ—¶ï¼Œ</a>è¾“å‡ºå°†æ˜¯å¸¦æœ‰ä¸€ä¸ªè½¬æ¢çš„çº¯å‡€æ¨¡å‹:)ã€‚ </li><li> å¥½å§ï¼Œå½“ç„¶ï¼Œå¯¹äºæ­¤ç±»æ¨¡å‹ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªå…è´¹æˆå‘˜ï¼Œæˆ‘ä»¬ä½¿ç”¨Interceptor.interceptæ“ä½œå°†å…¶æ·»åŠ ã€‚ </li></ul><br><p> åº”ç”¨äºæ‰€æœ‰æ•°æ®çš„ç»“æœç®¡é“å°†ä¸ºæ¯ä¸ªç”¨æˆ·æä¾›AUC 0.6889ï¼ˆéªŒè¯ä»£ç å¯åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Zepl</a>ä¸Š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è·å¾—</a> ï¼‰ã€‚ ç°åœ¨ä»ç„¶å¯ä»¥åº”ç”¨æˆ‘ä»¬çš„æ‰€æœ‰ç ”ç©¶ï¼šè¿‡æ»¤æ•°æ®ï¼Œå˜æ¢ç‰¹å¾å’Œåˆ†æ®µæ¨¡å‹ã€‚ æœ€ç»ˆçš„ç®¡é“å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SQLTransformer</span></span>().setStatement(<span class="hljs-string"><span class="hljs-string">s"SELECT instanceId_userId, instanceId_objectId, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${expressions.mkString(", ")}</span></span></span><span class="hljs-string"> FROM __THIS__"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SQLTransformer</span></span>().setStatement(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"SELECT *, IF(array_contains(feedback, 'Liked'), 1.0, 0.0) AS label, concat(IF(membership_status = 'A', 'OwnGroup_', 'NonUser_'), instanceId_objectType) AS type FROM __THIS__"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">NullToDefaultReplacer</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">AutoAssembler</span></span>() .setColumnsToExclude(<span class="hljs-string"><span class="hljs-string">"date"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>, <span class="hljs-string"><span class="hljs-string">"feedback"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>,<span class="hljs-string"><span class="hljs-string">"instanceId_objectType"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"features"</span></span>), <span class="hljs-type"><span class="hljs-type">CombinedModel</span></span>.perType( <span class="hljs-type"><span class="hljs-type">Scaler</span></span>.scale(<span class="hljs-type"><span class="hljs-type">Interceptor</span></span>.intercept(<span class="hljs-type"><span class="hljs-type">UnwrappedStage</span></span>.repartition( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">LogisticRegressionLBFSG</span></span>(), numPartitions = <span class="hljs-number"><span class="hljs-number">127</span></span>))), numThreads = <span class="hljs-number"><span class="hljs-number">6</span></span>) ))</code> </pre> <br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaML</a> â€”    CombinedModel.perType.       ,     numThreads = 6.             . </p><br><p> ,   ,  per-user AUC 0.7004.    ?  ,   " "    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">XGBoost</a> : </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SQLTransformer</span></span>().setStatement(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"SELECT *, IF(array_contains(feedback, 'Liked'), 1.0, 0.0) AS label FROM __THIS__"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">NullToDefaultReplacer</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">AutoAssembler</span></span>() .setColumnsToExclude(<span class="hljs-string"><span class="hljs-string">"date"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>, <span class="hljs-string"><span class="hljs-string">"feedback"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"features"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">XGBoostRegressor</span></span>() .setNumRounds(<span class="hljs-number"><span class="hljs-number">100</span></span>) .setMaxDepth(<span class="hljs-number"><span class="hljs-number">15</span></span>) .setObjective(<span class="hljs-string"><span class="hljs-string">"reg:logistic"</span></span>) .setNumWorkers(<span class="hljs-number"><span class="hljs-number">17</span></span>) .setNthread(<span class="hljs-number"><span class="hljs-number">4</span></span>) .setTrackerConf(<span class="hljs-number"><span class="hljs-number">600000</span></span>L, <span class="hljs-string"><span class="hljs-string">"scala"</span></span>) ))</code> </pre> <br><p> ,     â€” XGBoost  Spark !         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DLMC</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaML</a> ,       (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> ).  XGboost " "   10     per-user AUC 0.6981. </p><br><h1 id="analiz-rezultatov">   </h1><br><p> ,     ,  ,       .    SparkML     ,      .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaML</a>  :      Parquet            Spark: </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//     val perTypeWeights = sqlContext.read.parquet("sna2019/perType/stages/*/weights") //     20    ( //  ) val topFeatures = new TopKTransformer[Double]() .setGroupByColumns("type") .setColumnToOrderGroupsBy("abs_weight") .setTopK(20) .transform(perTypeWeights.withColumn("abs_weight", functions.abs($"unscaled_weight"))) .orderBy("type", "unscaled_weight")</span></span></code> </pre> <br><p>     Parquet,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaML</a> â€” TopKTransformer,           . </p><br><p>      Vegas (   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Zepl</a> ): </p><br><p><img src="https://habrastorage.org/webt/q7/_n/fn/q7_nfnto-hw-9nbdgjf3chhm0oc.png"></p><br><p> ,    -   .      XGBoost? </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> significance = sqlContext.read.parquet( <span class="hljs-string"><span class="hljs-string">"sna2019/xgBoost15_100_raw/stages/*/featuresSignificance"</span></span> vegas.<span class="hljs-type"><span class="hljs-type">Vegas</span></span>() .withDataFrame(significance.na.drop.orderBy($<span class="hljs-string"><span class="hljs-string">"significance"</span></span>.desc).limit(<span class="hljs-number"><span class="hljs-number">40</span></span>)) .encodeX(<span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-type"><span class="hljs-type">Nom</span></span>, sortField = <span class="hljs-type"><span class="hljs-type">Sort</span></span>(<span class="hljs-string"><span class="hljs-string">"significance"</span></span>, <span class="hljs-type"><span class="hljs-type">AggOps</span></span>.<span class="hljs-type"><span class="hljs-type">Mean</span></span>)) .encodeY(<span class="hljs-string"><span class="hljs-string">"significance"</span></span>, <span class="hljs-type"><span class="hljs-type">Quant</span></span>) .mark(vegas.<span class="hljs-type"><span class="hljs-type">Bar</span></span>) .show</code> </pre> <br><p><img src="https://habrastorage.org/webt/i2/oy/zb/i2oyzbrjlo15x7u1uwadmeswocq.png"></p><br><p>  ,   ,   XGBoost,         ,    .           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> .   ,  XGBoost     ,    ,   . </p><br><h1 id="vyvody"> ç»“è®º </h1><br><p>  ,       :).     : </p><br><ol><li>    ,     Scala  Spark    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> . </li><li>    Scala  Spark        Python:    ETL  ML,    ,      ,     . </li><li>  ,   ,   ,    (,  )    ,     ,      . </li><li> ,     ,       .          ,      ,     , -, . </li></ol><br><p> ,       ,    ,        ,    -.        , ,  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   Scala</a> "  Newprolab. </p><br><p> ,  ,      â€”   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SNA Hackathon 2019</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN442688/">https://habr.com/ru/post/zh-CN442688/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN442678/index.html">ç«‹ä½“å…‰åˆ»ä¸­æœ€å¤§çš„é¡¹ç›®ï¼šåœ¨3Dæ‰“å°æœºä¸Šæ‰“å°çš„åºç„¶å¤§ç‰©éª¨æ¶</a></li>
<li><a href="../zh-CN442680/index.html">æ„Ÿå®˜æ›¿ä»£æŠ€æœ¯å°†ä½¿æ‚¨å€ŸåŠ©å£°éŸ³çœ‹åˆ°ä¸–ç•Œï¼šäººè„‘çš„ç¥ç»å¯å¡‘æ€§å¦‚ä½•è¿ä½œ</a></li>
<li><a href="../zh-CN442682/index.html">è¾“å…¥ä»€ä¹ˆä»¥åŠå¦‚ä½•ç»„è£…C ++é¡¹ç›®</a></li>
<li><a href="../zh-CN442684/index.html">å¹³è¡¡ç½‘ç«™æ€§èƒ½ã€‚ ç¬¬3éƒ¨åˆ†ï¼šå†…å®¹</a></li>
<li><a href="../zh-CN442686/index.html">DataPoweræ•™ç¨‹</a></li>
<li><a href="../zh-CN442690/index.html">æœˆçƒä»»åŠ¡â€œ Bereshitâ€-åœ°çƒèƒŒæ™¯ä¸‹çš„è‡ªæ‹ç…§</a></li>
<li><a href="../zh-CN442692/index.html">æ²¡æœ‰ä¸­ä»‹çš„åŒºå—é“¾ï¼šæˆ‘ä»¬å¦‚ä½•å°†è¯åˆ¸å‘é€åˆ°åˆ†å¸ƒå¼æ³¨å†Œè¡¨</a></li>
<li><a href="../zh-CN442694/index.html">å…¶ä¸­ä¸€å®¶æµåª’ä½“å·¨å¤´åœ¨å°åº¦æ¨å‡ºï¼Œä¸€å‘¨å¸å¼•äº†100ä¸‡ç”¨æˆ·</a></li>
<li><a href="../zh-CN442696/index.html">S for Securityï¼šInoThings ++ 2019çš„ç‰©è”ç½‘å®‰å…¨å’ŒæŠ¥å‘Š</a></li>
<li><a href="../zh-CN442698/index.html">Windows Storeçš„Moscow Metroåº”ç”¨ç¨‹åº</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>