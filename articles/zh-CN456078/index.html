<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈹 ✊🏼 🤰 公司对网络连接的冲突的预测 😲 🛌🏽 ㊗️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="由于Mail.RU Group向Vimpelcom网络的用户发送SMS的成本增加，在06/10/2019发生了公司冲突。 作为回应，Mail.RU集团停止了对直接俄罗斯IP通道到Vimpelcom网络的“服务”。 

 下面是从网络工程师的角度对情况进行的简要分析。 

 更新 ：06/14/201...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>公司对网络连接的冲突的预测</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456078/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/cp/8x/ty/cp8xty7ejmoaj8gl7q7uhikmku0.png" alt="图片"></div><br> 由于Mail.RU Group向Vimpelcom网络的用户发送SMS的成本增加，在06/10/2019发生了公司冲突。 作为回应，Mail.RU集团停止了对直接俄罗斯IP通道到Vimpelcom网络的“服务”。 <br><br> 下面是从网络工程师的角度对情况进行的简要分析。 <br><br>  <b>更新</b> ：06/14/2019 18:45-强调俄罗斯通往VimpelCom网络的路线，调整了结论，并补充了<b>谢尔盖·库巴索夫（CIO Vkontakte）</b>的解释。 <br>  <b>更新</b> ：06/14/2019 19:48-添加了通过Rostelecom，MTS，RETN.NET限制沿“短”俄罗斯路线分布的方法的说明.. <br>  <b>更新</b> ：06/15/2019 09:39-Mail.ru阻止了其镜子。 <br>  <b>更新</b> ：06/18/2019 10:10-Depyning已经结束。  VimpelCom和Mail.RU集团提出了直接BGP会话。 <br><br><a name="habracut"></a><br> 简介： <br>  VimpelCom拥有一个自治系统AS3216，其余所有（8402-家庭Internet，16345-移动Internet）都位于3216。 <br><br>  Mail.RU组-自治系统AS47541，AS47542和AS47764。 主要内容生成器是47542，所谓的  CDN VKONTAKTE（电影，音乐）。 所有自治系统彼此独立（与外部自治系统的位置无关）。 <br><br> 首先，让我们看看Vimpelcom网络的情况。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">外观镜Vimpelcom</a>将为此提供帮助。 <br><br> 我们来看第一个自治系统-AS47541。 <br><br><pre><code class="perl hljs"><span class="hljs-number"><span class="hljs-number">2914</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span> <span class="hljs-number"><span class="hljs-number">79.104</span></span>.<span class="hljs-number"><span class="hljs-number">32.251</span></span> (metric <span class="hljs-number"><span class="hljs-number">10500</span></span>) (<span class="hljs-number"><span class="hljs-number">79.104</span></span>.<span class="hljs-number"><span class="hljs-number">32.251</span></span>) Origin IGP, metric <span class="hljs-number"><span class="hljs-number">30</span></span>, localpref <span class="hljs-number"><span class="hljs-number">87</span></span>, valid, internal, best, group-best, import-candidate, import suspect Received Path ID <span class="hljs-number"><span class="hljs-number">0</span></span>, Local Path ID <span class="hljs-number"><span class="hljs-number">1</span></span>, version <span class="hljs-number"><span class="hljs-number">2865394342</span></span> Community: <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">410</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">1214</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">2213</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">3200</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3103</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">40000</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">50078</span></span></code> </pre> <br>  AS-PATH包含两个自治系统-2914（NTT）和47541（VKONTAKTE-SPB-AS）。 <br>  localpref度量设置为87，如RIPE DB中针对AS3216对象所述，它对应于国际对等。 <br><blockquote>  ... <br> 备注：国际对等方的路由在 <br> 备注：范围为81-89。 <br>  ... </blockquote>  3216：3000和3216：3103社区（来源<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-RIPE DB for AS3216</a> ）也确认了相同的信息： <br><blockquote>  ... <br> 备注：3216：3000从国际上行链路或对等方接收，具体是： <br>  ... <br> 备注：3216：3103 AMS-IX <br>  ... </blockquote> 也就是说，Vimpelcom看到了通过欧洲交界处通往VKontakte的路线。 <br><br> 让我们看看另一个VKontakte自治-47542（VKONTAKTE-MSK-CDN-AS）。 <br><br><div class="spoiler">  <b class="spoiler_title">一切都相似。</b> <div class="spoiler_text"><pre> <code class="perl hljs"> <span class="hljs-number"><span class="hljs-number">2914</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span> <span class="hljs-number"><span class="hljs-number">79.104</span></span>.<span class="hljs-number"><span class="hljs-number">32.251</span></span> (metric <span class="hljs-number"><span class="hljs-number">10500</span></span>) (<span class="hljs-number"><span class="hljs-number">79.104</span></span>.<span class="hljs-number"><span class="hljs-number">32.251</span></span>) Origin IGP, metric <span class="hljs-number"><span class="hljs-number">30</span></span>, localpref <span class="hljs-number"><span class="hljs-number">87</span></span>, valid, internal, best, group-best, import-candidate, import suspect Received Path ID <span class="hljs-number"><span class="hljs-number">0</span></span>, Local Path ID <span class="hljs-number"><span class="hljs-number">1</span></span>, version <span class="hljs-number"><span class="hljs-number">2865394338</span></span> Community: <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">410</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">1214</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">2213</span></span> <span class="hljs-number"><span class="hljs-number">2914</span></span>:<span class="hljs-number"><span class="hljs-number">3200</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3103</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">40000</span></span> <span class="hljs-number"><span class="hljs-number">47541</span></span>:<span class="hljs-number"><span class="hljs-number">50078</span></span></code> </pre> <br></div></div><br> 那么Mail.ru本身呢？ 让我们看一下AS47764（mailru-as）。 <br><br><pre> <code class="perl hljs"> <span class="hljs-number"><span class="hljs-number">3356</span></span> <span class="hljs-number"><span class="hljs-number">47764</span></span> <span class="hljs-number"><span class="hljs-number">194.67</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">215</span></span> (metric <span class="hljs-number"><span class="hljs-number">10501</span></span>) (<span class="hljs-number"><span class="hljs-number">194.67</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">215</span></span>) Origin IGP, metric <span class="hljs-number"><span class="hljs-number">0</span></span>, localpref <span class="hljs-number"><span class="hljs-number">77</span></span>, valid, internal, best, group-best, import-candidate Received Path ID <span class="hljs-number"><span class="hljs-number">0</span></span>, Local Path ID <span class="hljs-number"><span class="hljs-number">1</span></span>, version <span class="hljs-number"><span class="hljs-number">2867605667</span></span> Community: <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">3216</span></span>:<span class="hljs-number"><span class="hljs-number">3007</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">123</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">519</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span>:<span class="hljs-number"><span class="hljs-number">2094</span></span> <span class="hljs-number"><span class="hljs-number">47764</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">47764</span></span>:<span class="hljs-number"><span class="hljs-number">40000</span></span> <span class="hljs-number"><span class="hljs-number">47764</span></span>:<span class="hljs-number"><span class="hljs-number">50077</span></span></code> </pre> <br>  VimpelCom通过as3356（上行链路Level3，Tier1运算符）查看Mail.ru。 此信息由localpref 77确认： <br><blockquote>  ... <br> 备注：上行路由的本地优先级为71-79。 <br> 备注：最近更新：2012年2月... </blockquote> 和社区（3216：3000和3216：3007）： <br><blockquote>  ... <br> 备注：3216：3000从国际上行链路或对等方接收，具体是： <br>  ... <br> 备注：3216：3007 3级通讯 <br>  ... </blockquote><br> 从收到的信息可以看出，VKontakte和MailRu上来自Vimpelcom网络的流量是根据BGP协议收到的路由通过欧洲连接分配的。 在Looking Glass中，没有其他通过俄罗斯的路线。 没有发现可以通过已知更差的路线人为地重定向流量的措施。 <br><br>  Mail.ru组如何看到VimpelCom网络？ <br> 我们将使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mail的Looking Glass</a> 。  <b>更新</b> ：截至06/15/2019上午，Looking Glass不起作用，当发出第500个错误请求时： <img src="https://habrastorage.org/getpro/habr/post_images/515/c79/93c/515c7993ccd0f3d6bd9a5a20d3078ee9.png" alt="图片"><br><br> 从AS47764（mailru-as）的路由器中： <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#6: Received by speaker 0 Advertised to peers (in unique update groups): 188.93.60.188 1299 1299 1273 3216 3216 217.20.147.250 (metric 100) from 217.20.147.250 (217.20.147.253) Origin IGP, metric 500, localpref 200, valid, internal, best, group-best Received Path ID 0, Local Path ID 0, version 1172721494 Community: 1299:20000 47764:701 47764:41100 47764:41108 47764:50077</span></span></code> </pre> <br><br>  AS-PATH包含AS1299（Telia，Tier1运营商，上行Mail.RU）和as1273（Vodafon，Tier1运营商，Vimpelcom上行）。 <br><br>  LocalPreference 200是外部Mail.ru接口（https://net.mail.ru/bgp.html）的标准，而MED 500对应于不是从直接接口，不是从IX-s，不是从对等接口接收到的所有内容。 <br><br> 但是，为什么没有通过俄罗斯电信运营商的本地路由？ <br> 是的，但是他们的优先级是“非标准”！ <br> 这是通过Rostelecom（as12389）的路线： <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#1: Received by speaker 0 Not advertised to any peer 12389 3216 46.61.178.149 from 46.61.178.149 (213.59.207.79) Origin IGP, metric 500, localpref 199, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 3216:2001 3216:2999 3216:4100 12389:5 12389:6 12389:1100 12389:1105 12389:1277 47764:701 47764:41100 47764:41104 47764:50077 Origin-AS validity: not-found</span></span></code> </pre> <br> 这是通过扩音器（as31133）： <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#2: Received by speaker 0 Not advertised to any peer 31133 3216 78.25.77.41 from 78.25.77.41 (10.222.253.97) Origin IGP, metric 500, localpref 199, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 3216:2001 3216:2999 3216:4100 31133:300 31133:46170 47764:701 47764:41100 47764:41105 47764:50077 Origin-AS validity: not-found</span></span></code> </pre> <br> 这是通过RET.NO： <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#3: Received by speaker 0 Not advertised to any peer 9002 9002 3216 87.245.253.24 from 87.245.253.24 (87.245.225.1) Origin IGP, metric 500, localpref 199, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 9002:9002 9002:64667 47764:701 47764:41100 47764:41101 47764:50077 Origin-AS validity: not-found</span></span></code> </pre> <br> 甚至通过MTS！ <pre> <code class="perl hljs"> Path <span class="hljs-comment"><span class="hljs-comment">#5: Received by speaker 0 Not advertised to any peer 8359 3216 212.188.61.105 from 212.188.61.105 (195.34.52.77) Origin IGP, metric 500, localpref 199, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 8359:200 8359:609 8359:5012 47764:701 47764:41100 47764:41103 47764:50077 Origin-AS validity: not-found</span></span></code> </pre> <br> 这些俄罗斯航线的localpref指标被低估了，也就是说，与国外航线相比，这些航线的质量下降了！ <br><br> 此外， <b>Mail.Ru集团禁止</b>通过俄罗斯运营商将其前缀分发给VimpelCom！ <br><br>  RET.NO（http://lg.retn.net/）： <br>  Mail.RU Group的公告包括3216社区：65535。 <br><div class="spoiler">  <b class="spoiler_title">LG RET.NO的结论</b> <div class="spoiler_text">  inet.0：762737个目的地，1734826条路线（762708有效，222780抑制值，277隐藏） <br>  94.100.176.0/20（1个条目，1个宣布） <br>  * BGP优先级：170 / -201 <br>  ... <br>  ... <br>  AS路径：47764 I <br>  AS路径：已记录 <br> 社区：3216：65535 9002：64667 9002：65530 <br>  ... <br></div></div><br>  Vimpelcom不接受其网络上此类社区标记的路由。 摘自RIPE DB的AS3216： <br><blockquote>  ... <br> 备注：内部社区仅在内部分配。 <br> 备注：它们的范围是3216：0000-3216：4999和3216：6000-3216：65535 <br> 备注：并且总是从边界的传入更新中删除 <br> 备注：路由器。 <br>  ... </blockquote><br> 走向Rostelecom（http://lg.ip.rt.ru）Mail.RU组向社区提供了类似的路由12389：8350。 <br><div class="spoiler">  <b class="spoiler_title">LG Rostelecom的结论</b> <div class="spoiler_text">  94.100.176.0/20通过eth0.9上的217.107.65.1 [sr2 2019-06-13] *（100 /？）[AS47764i] <br> 类型：BGP单播univ <br>  BGP.origin：IGP <br>  BGP.as_path：47764 <br>  BGP.next_hop：213.59.207.78 <br>  BGP.med:0 <br>  BGP.local_pref：850 <br>  BGP.community：（12389.1）（12389.1100）（12389.1105）（12389.1277）（12389.8350）（12389.8380）（47764.1）（47764,40000）（47764,50077） <br>  BGP.originator_id：213.59.207.78 <br>  BGP.cluster_list：95.167.88.79 95.167.88.49 95.167.88.17 <br></div></div><br> 根据RIPE DB中as12389对象的条目，此社区的意思是“不要在as3216网络上宣告”： <blockquote>  ... <br> 备注：  12389：835y在向GoldenTelecom（AS3216）投放广告时| <br>  ... <br> 备注：  ... y = 0-不做广告| <br>  ... </blockquote><br> 同样，对于MTS（http://lg.mtu.ru）： <div class="spoiler">  <b class="spoiler_title">LG MTS的结论</b> <div class="spoiler_text">  94.100.176.0/20版本161717219的BGP路由表条目 <br> 路径：（2个可用，最佳＃1，表默认） <br> 多路径：eBGP <br> 广告发布到更新组： <br>  6 <br>  47764，（接收和使用） <br>  195.34.52.181（195.34.52.181）中的195.34.52.77（公制16） <br> 来源IGP，指标0，localpref 140，有效，内部，最佳 <br> 社区：8359：2120 8359：2150 8359：5500 8359：55277 <br> 发起者：195.34.52.77，群集列表：83.59.83.59 <br>  47764，（接收和使用） <br>  195.34.52.182（195.34.52.182）中的195.34.52.77（公制16） <br> 来源IGP，指标0，localpref 140，有效，内部 <br> 社区：8359：2120 8359：2150 8359：5500 8359：55277 <br> 发起者：195.34.52.77，群集列表：83.59.2.77 <br></div></div><br> 社区8359：2120表示： <blockquote>  ... <br> 备注：8359：向Sovam宣告时（212倍）的212x <br>  ... <br> 备注：x = 0-不宣告 <br>  ... </blockquote><br> 您无法查看Mail.RU集团对Megafon的公告-后者没有Looking Glass。 <br><br> 让我们来看看AS47541（VKONTAKTE-SPB-AS）。 <br><br><div class="spoiler">  <b class="spoiler_title">结论太大了。</b> <div class="spoiler_text"><pre> <code class="perl hljs"> Router: a9922-e-<span class="hljs-number"><span class="hljs-number">5</span></span> Command: show ip bgp <span class="hljs-number"><span class="hljs-number">81.211</span></span>.<span class="hljs-number"><span class="hljs-number">56.202</span></span> Last switch-over Thu Apr <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>:09 <span class="hljs-number"><span class="hljs-number">2018</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> year, <span class="hljs-number"><span class="hljs-number">10</span></span> weeks, <span class="hljs-number"><span class="hljs-number">6</span></span> hours, <span class="hljs-number"><span class="hljs-number">9</span></span> minutes ago Fri Jun <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>:<span class="hljs-number"><span class="hljs-number">20.791</span></span> MSK BGP routing table entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">81.211</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">17</span></span> Versions: Process bRIB/RIB SendTblVer Speaker <span class="hljs-number"><span class="hljs-number">913059757</span></span> <span class="hljs-number"><span class="hljs-number">913059757</span></span> Last Modified: May <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">38.536</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>y03w Paths: (<span class="hljs-number"><span class="hljs-number">6</span></span> available, best <span class="hljs-comment"><span class="hljs-comment">#4) Advertised to update-groups (with more than one peer): 0.2 Advertised to peers (in unique update groups): 188.93.60.188 Path #1: Received by speaker 0 Not advertised to any peer 1299 1273 3216 3216 87.240.191.235 (metric 31) from 87.240.191.235 (87.240.191.235) Origin IGP, metric 5000, localpref 150, valid, internal Received Path ID 0, Local Path ID 0, version 0 Community: 1273:12752 1299:431 1299:4000 1299:20000 1299:20002 1299:20200 3216:2001 3216:2999 3216:4100 47541:701 47541:41100 47541:41111 47541:50078 Path #2: Received by speaker 0 Not advertised to any peer 1299 1273 3216 3216 87.240.191.248 (metric 31) from 87.240.191.248 (87.240.191.248) Origin IGP, metric 5000, localpref 150, valid, internal Received Path ID 0, Local Path ID 0, version 0 Community: 1273:12752 1299:431 1299:4000 1299:20000 1299:20002 1299:20200 3216:2001 3216:2999 3216:4100 47541:701 47541:41100 47541:41111 47541:50078 Path #3: Received by speaker 0 Not advertised to any peer 174 6762 3216 3216 87.240.191.249 (metric 31) from 87.240.191.249 (87.240.191.249) Origin IGP, metric 5000, localpref 150, valid, internal Received Path ID 0, Local Path ID 0, version 0 Community: 174:21100 174:22005 47541:701 47541:41100 47541:41108 47541:50078 Path #4: Received by speaker 0 Advertised to update-groups (with more than one peer): 0.2 Advertised to peers (in unique update groups): 188.93.60.188 174 6762 3216 3216 149.6.169.113 from 149.6.169.113 (38.28.1.236) Origin IGP, metric 5000, localpref 150, valid, external, best, group-best Received Path ID 0, Local Path ID 0, version 913059757 Community: 174:21100 174:22005 47541:701 47541:41100 47541:41108 47541:50078 Origin-AS validity: not-found Path #5: Received by speaker 0 Not advertised to any peer 1273 1273 3216 3216 195.89.114.197 from 195.89.114.197 (195.2.1.107) Origin IGP, metric 5005, localpref 150, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 1273:12752 3216:2001 3216:2999 3216:4100 47541:701 47541:41100 47541:41110 47541:50078 Origin-AS validity: not-found Path #6: Received by speaker 0 Not advertised to any peer 3356 3356 3216 3216 3216 213.242.69.69 from 213.242.69.69 (4.69.177.130) Origin IGP, metric 5000, localpref 150, valid, external Received Path ID 0, Local Path ID 0, version 0 Community: 3216:2001 3216:2999 3216:4100 3356:2 3356:22 3356:100 3356:123 3356:503 3356:2067 47541:701 47541:41100 47541:41107 47541:50078 Origin-AS validity: not-found</span></span></code> </pre> </div></div><br>  AS-PATH指向AS174-Cogent（上行Mail.RU，Tier1），然后指向AS6762-Telecom Italia（上行Vimpelcom）。 地方优先权到处为150，无论外部<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">书面政策</a>如何，所有外部联合点均如此。 <br><br> 让我们看看AS47542（VKONTAKTE-MSK-CDN-AS）。 <br><pre> <code class="perl hljs"> Router: mx96<span class="hljs-number"><span class="hljs-number">0</span></span>-m9-<span class="hljs-number"><span class="hljs-number">0</span></span> Command: op lg-sh-bgp prefix <span class="hljs-number"><span class="hljs-number">81.211</span></span>.<span class="hljs-number"><span class="hljs-number">56.202</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> LP:<span class="hljs-number"><span class="hljs-number">151</span></span> MED: NH:<span class="hljs-number"><span class="hljs-number">87.240</span></span>.<span class="hljs-number"><span class="hljs-number">191.222</span></span> AS path: <span class="hljs-number"><span class="hljs-number">47541</span></span> I Communities: Accepted Best <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> LP:<span class="hljs-number"><span class="hljs-number">151</span></span> MED: NH:<span class="hljs-number"><span class="hljs-number">95.142</span></span>.<span class="hljs-number"><span class="hljs-number">204.251</span></span> AS path: <span class="hljs-number"><span class="hljs-number">47541</span></span> I Communities: Accepted Inactive-reason: Interior &gt; Exterior &gt; Exterior via Interior</code> </pre> <br> 从第二个路由器： <pre> <code class="perl hljs"> Router: mx96<span class="hljs-number"><span class="hljs-number">0</span></span>-m9-<span class="hljs-number"><span class="hljs-number">1</span></span> Command: op lg-sh-bgp prefix <span class="hljs-number"><span class="hljs-number">81.211</span></span>.<span class="hljs-number"><span class="hljs-number">56.202</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> LP:<span class="hljs-number"><span class="hljs-number">151</span></span> MED: NH:<span class="hljs-number"><span class="hljs-number">87.240</span></span>.<span class="hljs-number"><span class="hljs-number">191.224</span></span> AS path: <span class="hljs-number"><span class="hljs-number">47541</span></span> I Communities: Accepted Best <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> LP:<span class="hljs-number"><span class="hljs-number">151</span></span> MED: NH:<span class="hljs-number"><span class="hljs-number">95.142</span></span>.<span class="hljs-number"><span class="hljs-number">204.250</span></span> AS path: <span class="hljs-number"><span class="hljs-number">47541</span></span> I Communities: Accepted Inactive-reason: Interior &gt; Exterior &gt; Exterior via Interior</code> </pre> <br> 仅默认路由（0.0.0.0/0）。  Mail.RU Group的一位<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">贪婪</a>的员工解释了这种情况，他对此表示感谢。 简而言之：VKontakte网络的莫斯科部分正在缓存（而不是生成），其任务是优化流行的需求内容的下载速度。 关心用户，是的。 <br><br> 如果没有到任何网络的路由，则缓存服务器不会为该网络服务。 因此，无法优化下载速度，并且会给用户带来痛苦。 但在此需要强调的是-用户不仅是自己的用户，而且还是VimpelCom。 <br><br>  <b>结论：</b> <br><br><ol><li> 来自Vimpelcom的Mail.RU Group流量自然分布。 未检测到通过本地首选项操作的人为重定向 </li><li>  <b>在Mail.RU组中，有一些使用Vimpelcom前缀的操作</b> 。 与通过外国Tier1运营商的路由相比，在通过俄罗斯运营商通往Vimpelcom网络的现有路由中，优先级被低估了。 </li><li>  BGP社区的管理员已添加到从Mail.RU组转移到俄罗斯运营商（MTS，Rostelecom，RETN.NET）的路由中，以限制将其分发给Vimpelcom </li></ol><br> 为什么Mail.RU Group优先考虑通过欧洲的路线？ 为什么Mail.RU Group禁止与Vimpelcom建立简短的国内联系？ <br><br> 对他们来说便宜吗？ 通过国外渠道吸引流量，并向蒂尔文支付货币？ <br> 还是有一种驱赶交通以免交通不便的愿望，是吗？ <br> 这对于网络工程师来说是未知的... <br><br>  <b>去pyring结果：</b> <br>  2019年6月17日，Vimpelcom和Mail.RU Group之间的BGP会话被提出： <br>  AS47764（Mail.RU）： <br><img src="https://habrastorage.org/webt/8s/pl/gk/8splgktg26dnwc_4ihehoprx8-k.png" alt="图片"><br><br>  AS47541（Vk）： <br><img src="https://habrastorage.org/getpro/habr/post_images/867/0b4/829/8670b482948ddb6df8d498e43d9dbd73.png" alt="图片"><br><br>  AS47542（Vk CDN）： <br><img src="https://habrastorage.org/webt/vm/fc/8z/vmfc8zpjdbimpe1eox2qi7ojndi.png" alt="图片"><br><br> 谁发起取消会议是未知的。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN456078/">https://habr.com/ru/post/zh-CN456078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN456064/index.html">十月 革命性的安全方法</a></li>
<li><a href="../zh-CN456068/index.html">初学者领先的5个错误</a></li>
<li><a href="../zh-CN456070/index.html">如何吸引用户使用自助服务门户</a></li>
<li><a href="../zh-CN456072/index.html">Dav1d-默认情况下，Firefox中最快的AV1解码器</a></li>
<li><a href="../zh-CN456076/index.html">PyDaCon在Mail.ru集团的聚会：6月22日</a></li>
<li><a href="../zh-CN456082/index.html">我们如何制定个性化产品推荐</a></li>
<li><a href="../zh-CN456084/index.html">Kubernetes 1.15：亮点概述</a></li>
<li><a href="../zh-CN456086/index.html">iOS故事板：优缺点分析，最佳做法</a></li>
<li><a href="../zh-CN456088/index.html">大数据分析问题</a></li>
<li><a href="../zh-CN456090/index.html">Unity中的单元测试简介</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>