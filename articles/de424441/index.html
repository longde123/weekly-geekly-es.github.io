<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöñ üßúüèæ ü§ú Was ist neu im ersten CTP von SQL Server 2019? ü§üüèΩ üêî üòè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die erste Ausgabe der CTP-Version von SQL Server 2019 wurde am 24. September vorgestellt. Ich m√∂chte sagen, dass sie alle m√∂glichen Verbesserungen und...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Was ist neu im ersten CTP von SQL Server 2019?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424441/">  Die erste Ausgabe der CTP-Version von SQL Server 2019 wurde am 24. September vorgestellt. Ich m√∂chte sagen, dass sie alle m√∂glichen Verbesserungen und neuen Funktionen enth√§lt (von denen viele im Vorschau-Formular in der Azure SQL-Datenbank enthalten sind).  Ich hatte die au√üergew√∂hnliche Gelegenheit, dies etwas fr√ºher kennenzulernen, wodurch ich mein Verst√§ndnis der Ver√§nderungen auch oberfl√§chlich erweitern konnte.  Sie k√∂nnen auch die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neuesten Ver√∂ffentlichungen des SQL Server-Teams</a> und die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aktualisierte Dokumentation</a> lesen. <br><br>  Ohne auf Details einzugehen, werde ich die folgenden neuen Kernelfunktionen diskutieren: Leistung, Fehlerbehebung, Sicherheit, Verf√ºgbarkeit und Entwicklung.  Im Moment habe ich etwas mehr Details als andere, und einige von ihnen sind bereits f√ºr die Ver√∂ffentlichung vorbereitet.  Ich werde auf diesen Abschnitt sowie auf viele andere Artikel und Dokumentationen zur√ºckkommen und sie ver√∂ffentlichen.  Ich m√∂chte Sie schnell dar√ºber informieren, dass dies keine umfassende √úberpr√ºfung ist, sondern nur ein Teil der Funktionalit√§t, die ich bis CTP 2.0 ‚Äûber√ºhren‚Äú konnte.  Es gibt noch viel zu erz√§hlen. <br><a name="habracut"></a><br><h2>  Leistung </h2><br><h4>  Tabellenvariablen: Verz√∂gerte Planerstellung </h4><br>  Die Tabellenvariablen haben vor allem im Bereich der Kostensch√§tzung einen nicht sehr guten Ruf.  Standardm√§√üig geht SQL Server davon aus, dass eine Tabellenvariable nur eine Zeile enthalten kann, was manchmal zu einer unzureichenden Auswahl des Plans f√ºhrt, wenn die Variable ein Vielfaches mehr Zeilen enth√§lt.  OPTION (RECOMPILE) wird normalerweise als Problemumgehung verwendet. Dies erfordert jedoch Code√§nderungen und ist in Bezug auf Ressourcen verschwenderisch, um jedes Mal eine Neuerstellung durchzuf√ºhren, w√§hrend die Anzahl der Zeilen meistens gleich ist.  Um die Neuerstellung zu emulieren, wurde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das Ablaufverfolgungsflag 2453</a> eingef√ºhrt, es erfordert jedoch auch einen Start mit dem Flag und funktioniert nur, wenn eine signifikante √Ñnderung in den Zeilen auftritt. <br><br>  Auf Kompatibilit√§tsstufe 150 wird eine verz√∂gerte Konstruktion durchgef√ºhrt, wenn Tabellenvariablen vorhanden sind und der Abfrageplan erst erstellt wird, wenn die Tabellenvariable einmal ausgef√ºllt wird.  Die Kosten werden basierend auf den Ergebnissen der ersten Verwendung der Tabellenvariablen ohne weitere Neuerstellung gesch√§tzt.  Dies ist ein Kompromiss zwischen der st√§ndigen Neuerstellung, um die genauen Kosten zu erhalten, und dem v√∂lligen Fehlen einer Neuerstellung mit konstanten Kosten 1. Wenn die Anzahl der Zeilen relativ konstant bleibt, ist dies ein guter Indikator (und noch besser, wenn die Anzahl 1 √ºberschreitet), kann aber weniger rentabel sein, wenn Die Anzahl der Zeilen ist sehr unterschiedlich. <br><br>  Ich habe eine ausf√ºhrlichere Analyse in einem k√ºrzlich erschienenen Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tabellarische Variablen vorgestellt: Verz√∂gerte Erstellung in SQL Server</a> , und Brent Ozar hat dar√ºber auch in dem Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schnelle tabellarische Variablen (und neue Probleme bei der Parameteranalyse) gesprochen</a> . <br><br><h4>  Speicherzuweisungs-Feedback im String-Modus </h4><br>  SQL Server 2017 verf√ºgt √ºber ein Feedback zur Stapelspeicherzuweisung, das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> ausf√ºhrlich beschrieben wird.  Im Wesentlichen wertet SQL Server f√ºr jede Speicherzuweisung, die einem Abfrageplan zugeordnet ist, der Stapelmodusanweisungen enth√§lt, den von der Abfrage verwendeten Speicher aus und vergleicht ihn mit dem angeforderten Speicher.  Wenn der angeforderte Speicher zu klein oder zu gro√ü ist, was zu einer √úberlastung der Tempdb oder einer Verschwendung von Speicher f√ºhrt, wird beim n√§chsten Start der zugewiesene Speicher f√ºr den entsprechenden Abfrageplan angepasst.  Durch dieses Verhalten wird entweder das zugewiesene Volume reduziert und die Parallelit√§t erweitert oder erh√∂ht, um die Leistung zu verbessern. <br><br>  Jetzt erhalten wir das gleiche Verhalten f√ºr Abfragen im Zeichenfolgenmodus unter Kompatibilit√§tsstufe 150. Wenn die Abfrage gezwungen wurde, Daten auf der Festplatte zusammenzuf√ºhren, wird der zugewiesene Speicher f√ºr nachfolgende Starts erh√∂ht.  Wenn nach Abschluss der Anforderung die H√§lfte des Speichers ben√∂tigt wurde, als zugewiesen wurde, wird er f√ºr nachfolgende Anforderungen nach unten angepasst.  Bretn Ozar beschreibt dies ausf√ºhrlicher in seinem Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Conditional Memory Allocation</a> . <br><br><h4>  Stapelmodus f√ºr die zeilenweise Speicherung </h4><br>  Ab SQL Server 2012 hat das Abfragen von Tabellen mit Spaltenindizes von einer verbesserten Leistung im Stapelmodus profitiert.  Leistungsverbesserungen sind auf einen Abfrageprozessor zur√ºckzuf√ºhren, der eher eine Stapelverarbeitung als eine zeilenweise Verarbeitung durchf√ºhrt.  Zeilen werden auch vom Speicherkern in Paketen verarbeitet, wodurch Parallelit√§tsaustauschanweisungen vermieden werden.  Paul White ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@SQL_Kiwi</a> ) erinnerte mich daran, dass, wenn Sie eine leere Tabelle mit Spaltenspeicher verwenden, um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stapelmodusoperationen zu</a> erm√∂glichen, die verarbeiteten Zeilen durch eine unsichtbare Anweisung in Paketen gesammelt werden.  Diese Kr√ºcke kann jedoch Verbesserungen aus der Stapelverarbeitung zunichte machen.  Einige Informationen hierzu finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Antwort auf Stack Exchange</a> . <br><br>  Auf Kompatibilit√§tsstufe 150 w√§hlt SQL Server 2019 in bestimmten F√§llen automatisch den Stapelmodus als Mittelweg aus, selbst wenn keine Spaltenindizes vorhanden sind.  Sie k√∂nnten denken, warum nicht einfach einen Spaltenindex und einen Hut erstellen?  Oder weiterhin die oben genannte Kr√ºcke benutzen?  Dieser Ansatz wurde auf herk√∂mmliche Objekte mit zeilenbasiertem Speicher ausgedehnt, da Spaltenindizes aus mehreren Gr√ºnden nicht immer m√∂glich sind, einschlie√ülich Funktionseinschr√§nkungen (z. B. Trigger), Overhead bei hoch geladenen Aktualisierungs- oder L√∂schvorg√§ngen und mangelnder Unterst√ºtzung durch Dritthersteller.  Und von dieser Kr√ºcke ist nichts Gutes zu erwarten. <br>  Ich habe eine sehr einfache Tabelle mit 10 Millionen Zeilen und einem Clustered-Index f√ºr eine Ganzzahlspalte erstellt und diese Abfrage ausgef√ºhrt: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sa5, sa2, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1), <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2), <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.FactTable <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> i1 &gt; <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> sa5, sa2 <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> sa5, sa2;</code> </pre> <br>  Der Plan zeigt deutlich die Suche nach geclusterten Indizes und die Parallelit√§t, jedoch kein Wort zum Spaltenindex (wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SentryOne Plan Explorer</a> zeigt): <br><br><img src="https://habrastorage.org/webt/se/cp/6u/secp6uhnmrnslv_estaiqavexbm.png"><br><br>  Wenn Sie jedoch etwas tiefer graben, k√∂nnen Sie sehen, dass fast alle Operatoren im Batch-Modus ausgef√ºhrt wurden, sogar Sortier- und Skalarberechnungen: <br><br><img src="https://habrastorage.org/webt/0t/uu/lf/0tuulfjwod55k5fufwksdyvauae.png"><br><br>  Sie k√∂nnen diese Funktion deaktivieren, indem Sie auf einer niedrigeren Kompatibilit√§tsstufe bleiben, indem Sie die Datenbankkonfiguration √§ndern oder die Eingabeaufforderung DISALLOW_BATCH_MODE in der Abfrage verwenden: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">OPTION</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> HINT (<span class="hljs-string"><span class="hljs-string">'DISALLOW_BATCH_MODE'</span></span>));</code> </pre> <br>  In diesem Fall wird ein zus√§tzlicher Austauschoperator angezeigt, alle Operatoren werden zeilenweise ausgef√ºhrt und die Ausf√ºhrungszeit f√ºr Abfragen wird fast verdreifacht. <br><br><img src="https://habrastorage.org/webt/0n/v9/k9/0nv9k9ihqq1_jprzfth_o3wwrqs.png"><br><br>  Ab einer bestimmten Ebene k√∂nnen Sie dies im Diagramm sehen, aber im Detailbaum des Plans k√∂nnen Sie auch den Einfluss einer Auswahlbedingung sehen, die Zeilen erst nach dem Sortieren ausschlie√üen kann: <br><br><img src="https://habrastorage.org/webt/ek/p6/6c/ekp66cg3v8b1nfezgsyspmxgkbc.png"><br><br>  Die Wahl des Batch-Modus ist nicht immer ein guter Schritt - die im Entscheidungsalgorithmus enthaltene Heuristik ber√ºcksichtigt die Anzahl der Zeilen, die Arten der vorgeschlagenen Operatoren und die erwarteten Vorteile des Batch-Modus. <br><br><h4>  <font color="#004d71">APPROX_COUNT_DISTINCT</font> </h4><br>  Diese neue Aggregatfunktion ist f√ºr Data Warehousing-Szenarien vorgesehen und entspricht COUNT (DISTINCT ()).  Anstatt jedoch kostspielige Sortierungen durchzuf√ºhren, um die tats√§chliche Menge zu bestimmen, st√ºtzt sich die neue Funktion auf Statistiken, um relativ genaue Daten zu erhalten.  Sie m√ºssen verstehen, dass der Fehler innerhalb von 2% des genauen Betrags liegt. In 97% der F√§lle, die f√ºr Analysen auf hoher Ebene √ºblich sind, werden diese Werte auf Indikatoren angezeigt oder f√ºr schnelle Bewertungen verwendet. <br><br>  Auf meinem System habe ich eine Tabelle mit ganzzahligen Spalten erstellt, die eindeutige Werte im Bereich von 100 bis 1.000.000 und Zeilenspalten mit eindeutigen Werten im Bereich von 100 bis 100.000 enthalten. Sie enthielt keine Indizes au√üer dem gruppierten Prim√§rschl√ºssel im ersten Ganzzahlspalte.  Hier sind die Ergebnisse der Ausf√ºhrung von COUNT (DISTINCT ()) und APPROX_COUNT_DISTINCT () f√ºr diese Spalten, anhand derer Sie geringf√ºgige Abweichungen feststellen k√∂nnen (jedoch immer innerhalb von 2%): <br><br><img src="https://habrastorage.org/webt/ou/a5/1x/oua51xwiabvnyltf75s-pjtqdn0.png"><br><br>  Der Gewinn ist enorm, wenn es Speicherbeschr√§nkungen gibt, die f√ºr die meisten von uns gelten.  Wenn Sie sich die Abfragepl√§ne ansehen, k√∂nnen Sie in diesem speziellen Fall einen gro√üen Unterschied im Speicherverbrauch des Hash-Match-Operators feststellen: <br><br><img src="https://habrastorage.org/webt/xk/tl/sn/xktlsnekpwpu--xaebgb_ndkcn8.png"><br><br>  Beachten Sie, dass Sie in der Regel nur dann signifikante Leistungsverbesserungen feststellen, wenn Sie bereits speichergebunden sind.  Auf meinem System dauerte die Ausf√ºhrung aufgrund der hohen CPU-Auslastung der neuen Funktion etwas l√§nger: <br><br><img src="https://habrastorage.org/webt/d9/nl/n8/d9nln84mrqh-kfmumdca_u8tt8u.png"><br><br>  Vielleicht w√§re der Unterschied bedeutender, wenn ich gr√∂√üere Tabellen, weniger Speicher f√ºr SQL Server, eine h√∂here Parallelit√§t oder eine Kombination der oben genannten h√§tte. <br><br><h4>  <font color="#004d71">Tipps zur Verwendung der Kompatibilit√§tsstufe innerhalb einer Abfrage</font> </h4><br>  Haben Sie eine spezielle Abfrage, die unter einer bestimmten Kompatibilit√§tsstufe besser funktioniert als die aktuelle Datenbank?  Dies ist jetzt dank neuer Abfragehinweise m√∂glich, die sechs verschiedene Kompatibilit√§tsstufen und f√ºnf verschiedene Modelle zur Sch√§tzung der Anzahl der Elemente unterst√ºtzen.  Im Folgenden sind die verf√ºgbaren Kompatibilit√§tsstufen, eine Beispielsyntax und ein jeweils verwendetes Kompatibilit√§tsstufenmodell aufgef√ºhrt.  Sehen Sie, wie sich dies auf Bewertungen auswirkt, auch f√ºr Systemansichten: <br><br><img src="https://habrastorage.org/webt/gn/0n/g1/gn0ng1ar9z_cxpi7mt8_kaiqkmu.png"><br><br>  Kurz gesagt: Sie m√ºssen sich nicht mehr an die Ablaufverfolgungsflags erinnern oder sich fragen, ob Sie sich Gedanken dar√ºber machen m√ºssen, ob der TF 4199-Patch f√ºr das Abfrageoptimierungsprogramm verteilt wurde oder von einem anderen Service Pack abgebrochen wurde.  Beachten Sie, dass diese zus√§tzlichen Hinweise k√ºrzlich auch f√ºr SQL Server 2017 im kumulativen Update Nr. 10 hinzugef√ºgt wurden (Einzelheiten finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Blog von Pedro Lopez</a> ).  Sie k√∂nnen alle verf√ºgbaren Hinweise mit dem folgenden Befehl anzeigen: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.dm_exec_valid_use_hints;</code> </pre> <br>  Vergessen Sie jedoch nicht, dass Hinweise eine au√üergew√∂hnliche Ma√ünahme sind. Sie eignen sich h√§ufig, um aus einer schwierigen Situation herauszukommen, sollten jedoch nicht f√ºr die langfristige Verwendung geplant werden, da sich ihr Verhalten bei nachfolgenden Aktualisierungen √§ndern kann. <br><br><h2>  <font color="#c30">Fehlerbehebung</font> </h2><br><h4>  <font color="#004d71">Vereinfachte Standardprofilerstellung</font> </h4><br>  Um diese Verbesserung zu verstehen, m√ºssen einige Punkte beachtet werden.  In SQL Server 2014 wurde die Ansicht DMV sys.dm_exec_query_profiles eingef√ºhrt, mit der der Benutzer, der die Abfrage ausf√ºhrt, Diagnoseinformationen zu allen Anweisungen in allen Teilen der Abfrage erfassen kann.  Die gesammelten Informationen werden nach Abschluss der Abfrage verf√ºgbar und erm√∂glichen es Ihnen zu bestimmen, welche Bediener die Hauptressourcen tats√§chlich ausgegeben haben und warum.  Jeder Benutzer, der eine bestimmte Anforderung nicht erf√ºllt hat, kann diese Daten f√ºr jede Sitzung empfangen, in der die Anweisung STATISTICS XML oder STATISTICS PROFILE enthalten war, oder f√ºr alle Sitzungen, die das erweiterte Ereignis query_post_execution_showplan verwenden, obwohl dieses Ereignis insbesondere die Gesamtleistung beeintr√§chtigen kann. <br><br>  In Management Studio 2016 wurde eine Funktion hinzugef√ºgt, mit der Sie Datenstr√∂me, die den Abfrageplan durchlaufen, in Echtzeit basierend auf den von DMV gesammelten Informationen anzeigen k√∂nnen, wodurch die Fehlerbehebung noch leistungsf√§higer wird.  Der Plan Explorer bietet auch die M√∂glichkeit, Daten, die die Abfrage durchlaufen, sowohl in Echtzeit als auch im Wiedergabemodus zu visualisieren. <br><br>  Ab SQL Server 2016 Service Pack 1 (SP1) k√∂nnen Sie auch eine einfache Version der Datenerfassung f√ºr alle Sitzungen mithilfe des Ablaufverfolgungsflags 7412 oder der erweiterten Eigenschaft query_thread_profile aktivieren, mit der Sie sofort aktuelle Informationen zu jeder Sitzung abrufen k√∂nnen, ohne dass etwas erforderlich ist Nehmen Sie dies ausdr√ºcklich auf (insbesondere Dinge, die die Leistung beeintr√§chtigen).  Dies wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Blog von Pedro Lopez</a> ausf√ºhrlicher beschrieben. <br><br>  In SQL Server 2019 ist diese Funktion standardm√§√üig aktiviert, sodass Sie in keiner Abfrage Sitzungen mit erweiterten Ereignissen ausf√ºhren oder Ablaufverfolgungsflags und STATISTICS-Anweisungen verwenden m√ºssen.  Schauen Sie sich jederzeit die Daten der DMV f√ºr alle gleichzeitigen Sitzungen an.  Es ist jedoch m√∂glich, diesen Modus mit LIGHTWEIGHT_QUERY_PROFILING zu deaktivieren. Diese Syntax funktioniert jedoch nicht in CTP 2.0 und wird in zuk√ºnftigen Editionen behoben. <br><br><h4>  <font color="#004d71">Statistiken zu gruppierten Spaltenindizes sind jetzt in geklonten Datenbanken verf√ºgbar</font> </h4><br>  In aktuellen Versionen von SQL Server werden beim Klonen einer Datenbank nur die urspr√ºnglichen Objektstatistiken aus gruppierten Spaltenindizes verwendet, ausgenommen Aktualisierungen, die nach ihrer Erstellung an der Tabelle vorgenommen wurden.  Wenn Sie einen Klon verwenden, um Abfragen und andere Leistungstests zu konfigurieren, die auf Nennleistungen basieren, funktionieren diese Beispiele m√∂glicherweise nicht.  Parikshit Savyani beschrieb die Einschr√§nkungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in dieser Ver√∂ffentlichung</a> und stellte eine tempor√§re L√∂sung bereit. Bevor Sie den Klon erstellen, m√ºssen Sie ein Skript erstellen, das DBCC SHOW_STATISTICS ... WITH STATS_STREAM f√ºr jedes Objekt ausf√ºhrt.  Es ist teuer und nat√ºrlich leicht zu vergessen. <br><br>  In SQL Server 2019 sind diese aktualisierten Statistiken automatisch im Klon verf√ºgbar, sodass Sie verschiedene Abfrageszenarien testen und objektive Pl√§ne basierend auf realen Statistiken abrufen k√∂nnen, ohne STATS_STREAM f√ºr alle Tabellen manuell ausf√ºhren zu m√ºssen. <br><br><h4>  <font color="#004d71">Komprimierungsprognose f√ºr die Spaltenspeicherung</font> </h4><br>  In aktuellen Versionen wird die Prozedur sys.sp_estimate_data_compression_savings wie folgt √ºberpr√ºft: <br><br><pre> <code class="sql hljs">if (@data_compression not in ('NONE', 'ROW', 'PAGE'))</code> </pre> <br>  Dies bedeutet, dass Sie die Komprimierung einer Zeile oder Seite √ºberpr√ºfen k√∂nnen (oder das Ergebnis des L√∂schens der aktuellen Komprimierung sehen k√∂nnen).  In SQL Server 2019 sieht diese Pr√ºfung jetzt folgenderma√üen aus: <br><br><pre> <code class="sql hljs">if (@data_compression not in ('NONE', 'ROW', 'PAGE', 'COLUMNSTORE', 'COLUMNSTORE_ARCHIVE'))</code> </pre> <br>  Dies ist eine gute Nachricht, da Sie damit die Auswirkungen des Hinzuf√ºgens eines Spaltenindex zu einer Tabelle ohne diese Tabelle grob vorhersagen oder Tabellen oder Partitionen in ein noch komprimierteres Spaltenspeicherformat konvertieren k√∂nnen, ohne die Tabelle auf einem anderen System wiederherstellen zu m√ºssen.  Ich hatte eine Tabelle mit 10 Millionen Zeilen, f√ºr die ich eine gespeicherte Prozedur mit jedem der f√ºnf Parameter durchgef√ºhrt habe: <br><br><pre> <code class="sql hljs">EXEC sys.sp_estimate_data_compression_savings @schema_name = N'dbo', @object_name = N'FactTable', @index_id = NULL, @partition_number = NULL, @data_compression = N'NONE'; <span class="hljs-comment"><span class="hljs-comment">-- repeat for ROW, PAGE, COLUMNSTORE, COLUMNSTORE_ARCHIVE</span></span></code> </pre> <br>  Ergebnisse: <br><br><img src="https://habrastorage.org/webt/d6/xu/uy/d6xuuythndwrwogn22ljt83w8y4.png"><br><br>  Wie bei anderen Komprimierungsarten h√§ngt die Genauigkeit vollst√§ndig von den verf√ºgbaren Zeilen und der Repr√§sentativit√§t der √ºbrigen Daten ab.  Dies ist jedoch eine ziemlich leistungsstarke Methode, um ohne gro√üe Schwierigkeiten vorhersehbare Ergebnisse zu erzielen. <br><br><h4>  <font color="#004d71">Neue Funktion zum Abrufen von Seiteninformationen</font> </h4><br>  DBCC PAGE und DBCC IND wurden lange Zeit verwendet, um Informationen √ºber Seiten zu sammeln, die einen Abschnitt, einen Index oder eine Tabelle enthalten.  Sie sind jedoch nicht dokumentiert und werden nicht unterst√ºtzt. Es kann m√ºhsam sein, die L√∂sung von Aufgaben zu automatisieren, die mit mehreren Indizes oder Seiten verbunden sind. <br><br>  Sp√§ter wurde eine dynamische Verwaltungsfunktion (DMF) sys.dm_db_database_page_allocations angezeigt, die einen Satz zur√ºckgibt, der alle Seiten im angegebenen Objekt darstellt.  Immer noch undokumentiert und mit Fehlern, die bei gro√üen Tabellen zu einem echten Problem werden k√∂nnen: Selbst um Informationen √ºber eine Seite zu erhalten, muss die gesamte Struktur gelesen werden, was sehr teuer sein kann. <br><br>  In SQL Server 2019 wurde ein weiteres DMF angezeigt - sys.dm_db_page_info.  Grunds√§tzlich werden alle Seiteninformationen ohne den Aufwand der DMF-Verteilung zur√ºckgegeben.  Um die Funktion in aktuellen Builds verwenden zu k√∂nnen, m√ºssen Sie die Nummer der gesuchten Seite im Voraus kennen.  Vielleicht wurde dieser Schritt absichtlich gemacht, weil  Nur so kann die Leistung sichergestellt werden.  Wenn Sie also versuchen, alle Seiten in einem Index oder einer Tabelle zu identifizieren, m√ºssen Sie weiterhin die DMF-Verteilung verwenden.  Im n√§chsten Artikel werde ich diese Frage genauer beschreiben. <br><br><h2>  <font color="#c30">Sicherheit</font> </h2><br><h4>  <font color="#004d71">Permanente Verschl√ºsselung in einer sicheren Umgebung (Enklave)</font> </h4><br>  Derzeit sch√ºtzt die permanente Verschl√ºsselung vertrauliche Daten w√§hrend der √úbertragung und im Speicher durch Ver- / Entschl√ºsselung an jedem Ende des Prozesses.  Leider f√ºhrt dies h√§ufig zu schwerwiegenden Einschr√§nkungen bei der Arbeit mit Daten, z. B. der Unf√§higkeit, Berechnungen und Filter durchzuf√ºhren. Daher m√ºssen Sie den gesamten Datensatz auf die Clientseite √ºbertragen, um beispielsweise eine Bereichssuche durchzuf√ºhren. <br><br>  Eine sichere Umgebung (Enklave) ist ein gesch√ºtzter Speicherbereich, in dem solche Berechnungen und Filter delegiert werden k√∂nnen (Windows verwendet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">virtualisierungsbasierte Sicherheit</a> ). Die Daten bleiben im Kernel verschl√ºsselt, k√∂nnen jedoch in einer sicheren Umgebung sicher entschl√ºsselt oder verschl√ºsselt werden.  Sie m√ºssen lediglich den Parameter ENCLAVE_COMPUTATIONS mithilfe von SSMS zum Prim√§rschl√ºssel hinzuf√ºgen, indem Sie beispielsweise das Kontrollk√§stchen "Berechnungen in einer sicheren Umgebung zulassen" aktivieren: <br><br><img src="https://habrastorage.org/webt/do/ia/tp/doiatpb0ne_kpxgb5pbdep8ua5m.png"><br><br>  Jetzt k√∂nnen Sie Daten im Vergleich zur alten Methode (bei der der Assistent, das Cmdlet Set-SqlColumnEncyption oder Ihre Anwendung den gesamten Satz vollst√§ndig aus der Datenbank abrufen, verschl√ºsseln und zur√ºcksenden m√ºssten) fast sofort verschl√ºsseln: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.Patients <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> SSN <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- currently not encrypted! ENCRYPTED WITH ( COLUMN_ENCRYPTION_KEY = ColumnEncryptionKeyName, ENCRYPTION_TYPE = Randomized, ALGORITHM = 'AEAD_AES_256_CBC_HMAC_SHA_256' ) NOT NULL;</span></span></code> </pre> <br>  Ich denke, dass f√ºr viele Unternehmen diese Verbesserung die Hauptnachricht sein wird, aber im aktuellen CTP werden einige dieser Subsysteme noch verbessert, daher sind sie standardm√§√üig deaktiviert, aber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier k√∂nnen</a> Sie sehen, wie sie aktiviert werden. <br><br><h4>  <font color="#004d71">Zertifikatverwaltung in Configuration Manager</font> </h4><br>  Das Verwalten von SSL- und TLS-Zertifikaten war schon immer ein Problem, und viele Menschen waren gezwungen, m√ºhsam eigene Skripts zu erstellen, um ihre Unternehmenszertifikate bereitzustellen und zu verwalten.  Mit dem aktualisierten Configuration Manager f√ºr SQL Server 2019 k√∂nnen Sie schnell Zertifikate einer Instanz anzeigen und √ºberpr√ºfen, bald ablaufende Zertifikate finden und Zertifikatbereitstellungen f√ºr alle Replikationen in der Verf√ºgbarkeitsgruppe oder alle Knoten in der Failoverclusterinstanz synchronisieren. <br><br>  Ich habe nicht alle diese Vorg√§nge ausprobiert, aber sie sollten f√ºr fr√ºhere Versionen von SQL Server funktionieren, wenn die Verwaltung von SQL Server 2019 Configuration Manager stammt. <br><br><h4>  <font color="#004d71">Integrierte Datenklassifizierung und -pr√ºfung</font> </h4><br>  Das SQL Server-Entwicklungsteam hat die M√∂glichkeit hinzugef√ºgt, Daten in SSMS 17.5 zu klassifizieren. Auf diese Weise k√∂nnen Sie alle Spalten identifizieren, die vertrauliche Informationen enthalten oder verschiedenen Standards widersprechen (nat√ºrlich HIPAA, SOX, PCI und GDPR).  Der Assistent verwendet einen Algorithmus, der Spalten anbietet, die Probleme verursachen sollen. Sie k√∂nnen jedoch entweder den Satz anpassen, indem Sie diese Spalten aus der Liste entfernen, oder eigene hinzuf√ºgen.  Zum Speichern der Klassifizierung werden erweiterte Eigenschaften verwendet.  Der integrierte SSMS-Bericht verwendet dieselben Informationen, um seine Daten anzuzeigen.  Au√üerhalb des Berichts sind diese Eigenschaften nicht so offensichtlich. <br><br>  SQL Server 2019 hat eine neue Anweisung f√ºr diese Metadaten eingef√ºhrt, die bereits in der Azure SQL-Datenbank verf√ºgbar ist und den Namen ADD SENSITIVITY CLASSIFICATION tr√§gt.  Sie k√∂nnen das Gleiche wie der Assistent in SSMS tun, die Informationen werden jedoch nicht mehr in der erweiterten Eigenschaft gespeichert, und der Zugriff auf diese Daten wird im Audit automatisch als neue XML-Spalte data_sensitivity_information angezeigt.  Es enth√§lt alle Arten von Informationen, die w√§hrend des Audits betroffen waren. <br><br>  Angenommen, ich habe eine Tabelle f√ºr externe Auftragnehmer: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.Contractors ( FirstName sysname, LastName sysname, SSN <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>), HourlyRate <span class="hljs-built_in"><span class="hljs-built_in">decimal</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) );</code> </pre> <br>  Bei Betrachtung einer solchen Struktur wird deutlich, dass alle vier Spalten entweder potenziell anf√§llig f√ºr Leckagen sind oder nur einem begrenzten Personenkreis zug√§nglich sein sollten.  Hier k√∂nnen Sie mit Berechtigungen auskommen, aber zumindest m√ºssen Sie sich auf diese konzentrieren.  Daher k√∂nnen wir diese Spalten auf verschiedene Arten klassifizieren: <br><br><pre> <code class="sql hljs">ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.FirstName, dbo.Contractors.LastName <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Confidential √¢‚Ç¨‚Äú GDPR'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'Personal Info'</span></span>); ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.SSN <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Highly Confidential'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'National ID'</span></span>); ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.HourlyRate <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Highly Confidential'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'Financial'</span></span>);</code> </pre> <br>  Anstatt sich sys.extended_properties anzusehen, k√∂nnen Sie sie jetzt in sys.sensitivity_classifications sehen: <br><br><img src="https://habrastorage.org/webt/xs/4u/bx/xs4ubxognfau0yxlbl_g8caqujm.png"><br><br>  Und wenn wir f√ºr diese Tabelle Audit Sampling (oder DML) durchf√ºhren, m√ºssen wir nichts speziell √§ndern.  Nach dem Erstellen der Klassifizierung zeichnet <code>SELECT *</code> im √úberwachungsprotokoll einen Datensatz dieser Art von Informationen in einer neuen Spalte data_sensitivity_information auf: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attributes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Confidential - GDPR"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Personal Info"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Highly Confidential"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"National ID"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Highly Confidential"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Financial"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attributes</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Dies l√∂st nat√ºrlich nicht alle Probleme der Einhaltung von Standards, kann aber einen echten Vorteil bringen.  Die Verwendung des Assistenten zum automatischen Identifizieren von Spalten und zum √úbersetzen von sp_addextendedproperty-Aufrufen in ADD SENSITIVITY CLASSIFICATION-Befehle kann die Einhaltung von Standards erheblich vereinfachen.  Sp√§ter werde ich einen separaten Artikel dar√ºber schreiben. <br><br>  Sie k√∂nnen auch die Erstellung (oder Aktualisierung) von Berechtigungen basierend auf der Bezeichnung in den Metadaten automatisieren - die Erstellung eines dynamischen SQL-Skripts, das den Zugriff auf alle vertraulichen (GDPR) Spalten verbietet, mit denen Sie Benutzer, Gruppen oder Rollen verwalten k√∂nnen.  Ich werde in Zukunft an diesem Thema arbeiten. <br><br><h2>  <font color="#c30">Verf√ºgbarkeit</font> </h2><br><h4>  <font color="#004d71">Erstellung eines erneuerbaren Index in Echtzeit</font> </h4><br>  In SQL Server 2017 wurde es m√∂glich, die Neuerstellung des Index in Echtzeit anzuhalten und fortzusetzen. Dies kann sehr n√ºtzlich sein, wenn Sie die Anzahl der verwendeten Prozessoren √§ndern, ab dem Zeitpunkt der Unterbrechung nach einem Fehler fortfahren oder einfach die L√ºcke zwischen den Servicefenstern schlie√üen m√ºssen.  Ich habe in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fr√ºheren Artikel</a> √ºber diese Funktion gesprochen. <br><br>  In SQL Server 2019 k√∂nnen Sie dieselbe Syntax verwenden, um Echtzeitindizes zu erstellen, anzuhalten und fortzufahren sowie die Ausf√ºhrungszeit zu begrenzen (Festlegen der Pausenzeit): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar(blat) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">RESUMABLE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, MAX_DURATION = <span class="hljs-number"><span class="hljs-number">10</span></span> MINUTES);</code> </pre> <br>  Wenn diese Abfrage zu lange funktioniert, k√∂nnen Sie zum Anhalten ALTER INDEX in einer anderen Sitzung ausf√ºhren (auch wenn der Index physisch noch nicht vorhanden ist): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar PAUSE;</code> </pre> <br>  In aktuellen Builds kann der Grad der Parallelit√§t w√§hrend der Erneuerung nicht verringert werden, wie dies beim Wiederaufbau der Fall ist.  Beim Versuch, DOP zu reduzieren: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar <span class="hljs-keyword"><span class="hljs-keyword">RESUME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (MAXDOP = <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre> <br>  Wir bekommen folgendes: <br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">10666</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-type"><span class="hljs-type">Line</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> Cannot resume <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> build <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> required DOP <span class="hljs-number"><span class="hljs-number">4</span></span> (DOP operation was started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> available. Please ensure sufficient DOP <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> available <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span> existing <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> operation <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> try again. The <span class="hljs-keyword"><span class="hljs-keyword">statement</span></span> has been terminated.</code> </pre> <br>  Wenn Sie dies versuchen und dann den Befehl ohne zus√§tzliche Parameter ausf√ºhren, wird derselbe Fehler angezeigt, zumindest bei den aktuellen Builds.  Ich denke, dass der Erneuerungsversuch irgendwo aufgezeichnet wurde und das System ihn wieder verwenden wollte.  Um fortzufahren, m√ºssen Sie den richtigen (oder h√∂heren) DOP-Wert angeben: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar <span class="hljs-keyword"><span class="hljs-keyword">RESUME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (MAXDOP = <span class="hljs-number"><span class="hljs-number">4</span></span>);</code> </pre> <br>  Um es klar zu machen: Sie k√∂nnen den DOP erh√∂hen, wenn Sie eine angehaltene Indexerstellung fortsetzen, aber nicht senken. <br><br>  Ein zus√§tzlicher Vorteil davon ist, dass Sie die Erstellung und / oder Erneuerung von Indizes in Echtzeit als Standardmodus konfigurieren k√∂nnen, indem Sie die Klauseln ELEVATE_ONLINE und ELEVATE_RESUMABLE f√ºr die neue Datenbank verwenden. <br><br><h4>  <font color="#004d71">Echtzeiterstellung / Neuerstellung von gruppierten Spaltenindizes</font> </h4><br>  Neben der Erstellung erneuerbarer Indizes haben wir auch die M√∂glichkeit, Clustered-Column-Indizes in Echtzeit zu erstellen oder neu zu erstellen.  Dies ist eine wesentliche √Ñnderung, die es Ihnen erm√∂glicht, die Zeit der Servicefenster nicht mehr f√ºr die Pflege solcher Indizes zu verwenden oder (zur gr√∂√üeren Sicherheit) Indizes von zeilenweise in spaltenweise umzuwandeln: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> CLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CLUSTERED COLUMNSTORE <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (DROP_EXISTING = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Warnung: Wenn ein vorhandener traditioneller Clustered-Index in Echtzeit erstellt wurde, ist seine Konvertierung in einen Clustered-Spaltenindex auch nur in diesem Modus m√∂glich. </font><font style="vertical-align: inherit;">Wenn es Teil des Prim√§rschl√ºssels ist, eingebaut oder nicht ...</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Splunge PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> CLUSTERED (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); GO <span class="hljs-comment"><span class="hljs-comment">-- or after the fact -- ALTER TABLE dbo.splunge ADD CONSTRAINT PK_Splunge PRIMARY KEY CLUSTERED(id);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir erhalten folgenden Fehler: </font></font><br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">1907</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> Cannot recreate <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-string"><span class="hljs-string">'PK_Splunge'</span></span>. The <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> definition does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> match the <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> being enforced <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> the existing <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie m√ºssen zuerst die Einschr√§nkung entfernen, um sie in einen gruppierten Spaltenindex zu konvertieren. Beide Vorg√§nge k√∂nnen jedoch in Echtzeit ausgef√ºhrt werden: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CLUSTERED COLUMNSTORE <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies funktioniert, aber gro√üe Tabellen dauern wahrscheinlich l√§nger als wenn der Prim√§rschl√ºssel als eindeutiger Clustered-Index implementiert w√ºrde. </font><font style="vertical-align: inherit;">Ich kann nicht sicher sagen, ob dies eine absichtliche Einschr√§nkung oder nur eine Einschr√§nkung des aktuellen CTP ist.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umleiten einer Replikationsverbindung von einem sekund√§ren Server zu einem prim√§ren </font></font><br></font> </h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit dieser Funktion k√∂nnen Sie die Umleitung konfigurieren, ohne zu lauschen, sodass Sie die Verbindung zum Prim√§rserver wechseln k√∂nnen, auch wenn der Sekund√§rserver direkt in der Verbindungszeichenfolge angegeben ist. </font><font style="vertical-align: inherit;">Diese Funktion kann verwendet werden, wenn die Clustering-Technologie das Abh√∂ren nicht unterst√ºtzt, wenn AGs ohne Cluster verwendet werden oder wenn in einem Szenario mit mehreren Subnetzen ein komplexes Umleitungsschema vorhanden ist. </font><font style="vertical-align: inherit;">Dadurch wird verhindert, dass die Verbindung beispielsweise Schreibvorg√§nge f√ºr die schreibgesch√ºtzte Replikation (bzw. Fehler) versucht.</font></font><br><br><h2>  <font color="#c30">Entwicklung</font> </h2><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zus√§tzliche Funktionen des Diagramms</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrammbeziehungen unterst√ºtzen jetzt die MERGE-Anweisung f√ºr einen Knoten oder Grenztabellen unter Verwendung von MERGE-Pr√§dikaten. </font><font style="vertical-align: inherit;">Jetzt kann ein Bediener eine vorhandene Kante aktualisieren oder eine neue einf√ºgen. </font><font style="vertical-align: inherit;">Mit der neuen Kantenbeschr√§nkung k√∂nnen Sie bestimmen, welche Knoten die Kante verbinden kann.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utf-8</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server 2012 hat die Unterst√ºtzung f√ºr UTF-16 und zus√§tzliche Zeichen hinzugef√ºgt, indem die Sortierung durch Angabe eines Namens mit dem Suffix _SC festgelegt wurde, z. B. Latin1_General_100_CI_AI_SC, um Unicode-Spalten (nchar / nvarchar) zu verwenden. In SQL Server 2017 k√∂nnen Sie UTF-8-Daten mit Tools wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BULK INSERT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus und in diese Spalten importieren und exportieren </font><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In SQL Server 2019 gibt es neue Sortieroptionen, um die erzwungene Aufbewahrung von UTF-8-Daten in ihrer urspr√ºnglichen Form zu unterst√ºtzen. </font><font style="vertical-align: inherit;">Mit der neuen Sortierung mit dem Suffix _SC_UTF8 wie Latin1_General_100_CI_AI_SC_UTF8 k√∂nnen Sie auf einfache Weise Zeichen- oder Varchar-Spalten erstellen und UTF-8-Daten korrekt speichern. </font><font style="vertical-align: inherit;">Dies kann dazu beitragen, die Kompatibilit√§t mit externen Anwendungen und DBMS zu verbessern, ohne die Kosten f√ºr die Verarbeitung und Speicherung von nvarchar zu verursachen.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Osterei habe ich gefunden</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Soweit ich mich erinnere, beschweren sich SQL Server-Benutzer √ºber diese vage Fehlermeldung: </font></font><br><br><pre> <code class="hljs vbscript">Msg <span class="hljs-number"><span class="hljs-number">8152</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> binary data would be truncated.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In den CTP-Builds, mit denen ich experimentiert habe, wurde eine interessante Fehlermeldung festgestellt, die vorher nicht vorhanden war: </font></font><br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">2628</span></span> String <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> binary data would be truncated <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span>. Truncated <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich denke, hier wird nichts anderes ben√∂tigt. Dies ist eine gro√üe (wenn auch sehr sp√§te) Verbesserung und verspricht, viele gl√ºcklich zu machen. Diese Funktionalit√§t ist in CTP 2.0 jedoch nicht verf√ºgbar. Ich gebe Ihnen nur die Gelegenheit, ein wenig nach vorne zu schauen. Brent Ozar listete alle neuen Nachrichten auf, die er im aktuellen CTP gefunden hatte, und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w√ºrzte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sie mit einigen hilfreichen Kommentaren in seinem Artikel </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">sys.messages: Entdecken zus√§tzlicher Funktionen</font></a><font style="vertical-align: inherit;"> .</font></font><br><br><h2>  <font color="#c30">Fazit</font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server 2019 bietet gute zus√§tzliche Funktionen, mit denen Sie die Arbeit mit Ihrer bevorzugten relationalen Datenbankplattform verbessern k√∂nnen, und es gibt eine Reihe von √Ñnderungen, √ºber die ich nicht gesprochen habe. Energieeffizienter Speicher, Clustering f√ºr maschinelle Lerndienste, Replikation und verteilte Transaktionen unter Linux, Kubernetes, Konnektoren f√ºr Oracle / Teradata / MongoDB, synchrone AG-Replikationen sind gestiegen, um Java (eine Implementierung √§hnlich wie Python / R) und ebenso wichtig einen neuen Sprung zu unterst√ºtzen. mit dem Titel Big Data Cluster. Um einige dieser Funktionen nutzen zu k√∂nnen, m√ºssen Sie sich mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesem EAP-Formular</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> registrieren </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bob Wards bevorstehendes Buch </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pro SQL Server unter Linux - einschlie√ülich containergest√ºtzter Bereitstellung mit Docker und Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann einige Hinweise auf eine Reihe anderer Dinge geben, die bald kommen. </font><font style="vertical-align: inherit;">Und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diese Ver√∂ffentlichung von</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Brent Ozar spricht √ºber eine m√∂gliche bevorstehende Korrektur f√ºr eine skalare benutzerdefinierte Funktion. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber selbst in dieser ersten √∂ffentlichen CTP ist f√ºr fast jeden etwas Bedeutendes, und ich fordere Sie auf, es selbst zu versuchen!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424441/">https://habr.com/ru/post/de424441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424429/index.html">Wissenschaft Kunst und Klang: 4 beeindruckende Projekte</a></li>
<li><a href="../de424431/index.html">Valve enth√ºllt Steam Game Controller-Ranglisten</a></li>
<li><a href="../de424433/index.html">Warum Hacker Mikrotik und wie ich 100.000 RouterOS vor einem Botnetz versteckt habe</a></li>
<li><a href="../de424435/index.html">√ñlbohrzoo: Ordnung schaffen</a></li>
<li><a href="../de424437/index.html">Ulme. Bequem und umst√§ndlich. Json.Encoder und Json.Decoder</a></li>
<li><a href="../de424443/index.html">Vivaldi 2.0 zu unseren Gunsten</a></li>
<li><a href="../de424445/index.html">Neil Fords √úbersetzung von Microservices als evolution√§re Architektur</a></li>
<li><a href="../de424447/index.html">Lisp mit Pascal oder der Programmiersprache 8501. gew√ºrzt</a></li>
<li><a href="../de424453/index.html">Lerne OpenGL. Lektion 6.2 - Physikalisches Rendern. Analytische Lichtquellen</a></li>
<li><a href="../de424455/index.html">Intel Optane - Jetzt 1,5 Terabyte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>