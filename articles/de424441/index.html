<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚖 🧜🏾 🤜 Was ist neu im ersten CTP von SQL Server 2019? 🤟🏽 🐔 😏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die erste Ausgabe der CTP-Version von SQL Server 2019 wurde am 24. September vorgestellt. Ich möchte sagen, dass sie alle möglichen Verbesserungen und...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Was ist neu im ersten CTP von SQL Server 2019?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424441/">  Die erste Ausgabe der CTP-Version von SQL Server 2019 wurde am 24. September vorgestellt. Ich möchte sagen, dass sie alle möglichen Verbesserungen und neuen Funktionen enthält (von denen viele im Vorschau-Formular in der Azure SQL-Datenbank enthalten sind).  Ich hatte die außergewöhnliche Gelegenheit, dies etwas früher kennenzulernen, wodurch ich mein Verständnis der Veränderungen auch oberflächlich erweitern konnte.  Sie können auch die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neuesten Veröffentlichungen des SQL Server-Teams</a> und die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aktualisierte Dokumentation</a> lesen. <br><br>  Ohne auf Details einzugehen, werde ich die folgenden neuen Kernelfunktionen diskutieren: Leistung, Fehlerbehebung, Sicherheit, Verfügbarkeit und Entwicklung.  Im Moment habe ich etwas mehr Details als andere, und einige von ihnen sind bereits für die Veröffentlichung vorbereitet.  Ich werde auf diesen Abschnitt sowie auf viele andere Artikel und Dokumentationen zurückkommen und sie veröffentlichen.  Ich möchte Sie schnell darüber informieren, dass dies keine umfassende Überprüfung ist, sondern nur ein Teil der Funktionalität, die ich bis CTP 2.0 „berühren“ konnte.  Es gibt noch viel zu erzählen. <br><a name="habracut"></a><br><h2>  Leistung </h2><br><h4>  Tabellenvariablen: Verzögerte Planerstellung </h4><br>  Die Tabellenvariablen haben vor allem im Bereich der Kostenschätzung einen nicht sehr guten Ruf.  Standardmäßig geht SQL Server davon aus, dass eine Tabellenvariable nur eine Zeile enthalten kann, was manchmal zu einer unzureichenden Auswahl des Plans führt, wenn die Variable ein Vielfaches mehr Zeilen enthält.  OPTION (RECOMPILE) wird normalerweise als Problemumgehung verwendet. Dies erfordert jedoch Codeänderungen und ist in Bezug auf Ressourcen verschwenderisch, um jedes Mal eine Neuerstellung durchzuführen, während die Anzahl der Zeilen meistens gleich ist.  Um die Neuerstellung zu emulieren, wurde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das Ablaufverfolgungsflag 2453</a> eingeführt, es erfordert jedoch auch einen Start mit dem Flag und funktioniert nur, wenn eine signifikante Änderung in den Zeilen auftritt. <br><br>  Auf Kompatibilitätsstufe 150 wird eine verzögerte Konstruktion durchgeführt, wenn Tabellenvariablen vorhanden sind und der Abfrageplan erst erstellt wird, wenn die Tabellenvariable einmal ausgefüllt wird.  Die Kosten werden basierend auf den Ergebnissen der ersten Verwendung der Tabellenvariablen ohne weitere Neuerstellung geschätzt.  Dies ist ein Kompromiss zwischen der ständigen Neuerstellung, um die genauen Kosten zu erhalten, und dem völligen Fehlen einer Neuerstellung mit konstanten Kosten 1. Wenn die Anzahl der Zeilen relativ konstant bleibt, ist dies ein guter Indikator (und noch besser, wenn die Anzahl 1 überschreitet), kann aber weniger rentabel sein, wenn Die Anzahl der Zeilen ist sehr unterschiedlich. <br><br>  Ich habe eine ausführlichere Analyse in einem kürzlich erschienenen Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tabellarische Variablen vorgestellt: Verzögerte Erstellung in SQL Server</a> , und Brent Ozar hat darüber auch in dem Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schnelle tabellarische Variablen (und neue Probleme bei der Parameteranalyse) gesprochen</a> . <br><br><h4>  Speicherzuweisungs-Feedback im String-Modus </h4><br>  SQL Server 2017 verfügt über ein Feedback zur Stapelspeicherzuweisung, das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> ausführlich beschrieben wird.  Im Wesentlichen wertet SQL Server für jede Speicherzuweisung, die einem Abfrageplan zugeordnet ist, der Stapelmodusanweisungen enthält, den von der Abfrage verwendeten Speicher aus und vergleicht ihn mit dem angeforderten Speicher.  Wenn der angeforderte Speicher zu klein oder zu groß ist, was zu einer Überlastung der Tempdb oder einer Verschwendung von Speicher führt, wird beim nächsten Start der zugewiesene Speicher für den entsprechenden Abfrageplan angepasst.  Durch dieses Verhalten wird entweder das zugewiesene Volume reduziert und die Parallelität erweitert oder erhöht, um die Leistung zu verbessern. <br><br>  Jetzt erhalten wir das gleiche Verhalten für Abfragen im Zeichenfolgenmodus unter Kompatibilitätsstufe 150. Wenn die Abfrage gezwungen wurde, Daten auf der Festplatte zusammenzuführen, wird der zugewiesene Speicher für nachfolgende Starts erhöht.  Wenn nach Abschluss der Anforderung die Hälfte des Speichers benötigt wurde, als zugewiesen wurde, wird er für nachfolgende Anforderungen nach unten angepasst.  Bretn Ozar beschreibt dies ausführlicher in seinem Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Conditional Memory Allocation</a> . <br><br><h4>  Stapelmodus für die zeilenweise Speicherung </h4><br>  Ab SQL Server 2012 hat das Abfragen von Tabellen mit Spaltenindizes von einer verbesserten Leistung im Stapelmodus profitiert.  Leistungsverbesserungen sind auf einen Abfrageprozessor zurückzuführen, der eher eine Stapelverarbeitung als eine zeilenweise Verarbeitung durchführt.  Zeilen werden auch vom Speicherkern in Paketen verarbeitet, wodurch Parallelitätsaustauschanweisungen vermieden werden.  Paul White ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@SQL_Kiwi</a> ) erinnerte mich daran, dass, wenn Sie eine leere Tabelle mit Spaltenspeicher verwenden, um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stapelmodusoperationen zu</a> ermöglichen, die verarbeiteten Zeilen durch eine unsichtbare Anweisung in Paketen gesammelt werden.  Diese Krücke kann jedoch Verbesserungen aus der Stapelverarbeitung zunichte machen.  Einige Informationen hierzu finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Antwort auf Stack Exchange</a> . <br><br>  Auf Kompatibilitätsstufe 150 wählt SQL Server 2019 in bestimmten Fällen automatisch den Stapelmodus als Mittelweg aus, selbst wenn keine Spaltenindizes vorhanden sind.  Sie könnten denken, warum nicht einfach einen Spaltenindex und einen Hut erstellen?  Oder weiterhin die oben genannte Krücke benutzen?  Dieser Ansatz wurde auf herkömmliche Objekte mit zeilenbasiertem Speicher ausgedehnt, da Spaltenindizes aus mehreren Gründen nicht immer möglich sind, einschließlich Funktionseinschränkungen (z. B. Trigger), Overhead bei hoch geladenen Aktualisierungs- oder Löschvorgängen und mangelnder Unterstützung durch Dritthersteller.  Und von dieser Krücke ist nichts Gutes zu erwarten. <br>  Ich habe eine sehr einfache Tabelle mit 10 Millionen Zeilen und einem Clustered-Index für eine Ganzzahlspalte erstellt und diese Abfrage ausgeführt: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sa5, sa2, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1), <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2), <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.FactTable <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> i1 &gt; <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> sa5, sa2 <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> sa5, sa2;</code> </pre> <br>  Der Plan zeigt deutlich die Suche nach geclusterten Indizes und die Parallelität, jedoch kein Wort zum Spaltenindex (wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SentryOne Plan Explorer</a> zeigt): <br><br><img src="https://habrastorage.org/webt/se/cp/6u/secp6uhnmrnslv_estaiqavexbm.png"><br><br>  Wenn Sie jedoch etwas tiefer graben, können Sie sehen, dass fast alle Operatoren im Batch-Modus ausgeführt wurden, sogar Sortier- und Skalarberechnungen: <br><br><img src="https://habrastorage.org/webt/0t/uu/lf/0tuulfjwod55k5fufwksdyvauae.png"><br><br>  Sie können diese Funktion deaktivieren, indem Sie auf einer niedrigeren Kompatibilitätsstufe bleiben, indem Sie die Datenbankkonfiguration ändern oder die Eingabeaufforderung DISALLOW_BATCH_MODE in der Abfrage verwenden: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> … <span class="hljs-keyword"><span class="hljs-keyword">OPTION</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> HINT (<span class="hljs-string"><span class="hljs-string">'DISALLOW_BATCH_MODE'</span></span>));</code> </pre> <br>  In diesem Fall wird ein zusätzlicher Austauschoperator angezeigt, alle Operatoren werden zeilenweise ausgeführt und die Ausführungszeit für Abfragen wird fast verdreifacht. <br><br><img src="https://habrastorage.org/webt/0n/v9/k9/0nv9k9ihqq1_jprzfth_o3wwrqs.png"><br><br>  Ab einer bestimmten Ebene können Sie dies im Diagramm sehen, aber im Detailbaum des Plans können Sie auch den Einfluss einer Auswahlbedingung sehen, die Zeilen erst nach dem Sortieren ausschließen kann: <br><br><img src="https://habrastorage.org/webt/ek/p6/6c/ekp66cg3v8b1nfezgsyspmxgkbc.png"><br><br>  Die Wahl des Batch-Modus ist nicht immer ein guter Schritt - die im Entscheidungsalgorithmus enthaltene Heuristik berücksichtigt die Anzahl der Zeilen, die Arten der vorgeschlagenen Operatoren und die erwarteten Vorteile des Batch-Modus. <br><br><h4>  <font color="#004d71">APPROX_COUNT_DISTINCT</font> </h4><br>  Diese neue Aggregatfunktion ist für Data Warehousing-Szenarien vorgesehen und entspricht COUNT (DISTINCT ()).  Anstatt jedoch kostspielige Sortierungen durchzuführen, um die tatsächliche Menge zu bestimmen, stützt sich die neue Funktion auf Statistiken, um relativ genaue Daten zu erhalten.  Sie müssen verstehen, dass der Fehler innerhalb von 2% des genauen Betrags liegt. In 97% der Fälle, die für Analysen auf hoher Ebene üblich sind, werden diese Werte auf Indikatoren angezeigt oder für schnelle Bewertungen verwendet. <br><br>  Auf meinem System habe ich eine Tabelle mit ganzzahligen Spalten erstellt, die eindeutige Werte im Bereich von 100 bis 1.000.000 und Zeilenspalten mit eindeutigen Werten im Bereich von 100 bis 100.000 enthalten. Sie enthielt keine Indizes außer dem gruppierten Primärschlüssel im ersten Ganzzahlspalte.  Hier sind die Ergebnisse der Ausführung von COUNT (DISTINCT ()) und APPROX_COUNT_DISTINCT () für diese Spalten, anhand derer Sie geringfügige Abweichungen feststellen können (jedoch immer innerhalb von 2%): <br><br><img src="https://habrastorage.org/webt/ou/a5/1x/oua51xwiabvnyltf75s-pjtqdn0.png"><br><br>  Der Gewinn ist enorm, wenn es Speicherbeschränkungen gibt, die für die meisten von uns gelten.  Wenn Sie sich die Abfragepläne ansehen, können Sie in diesem speziellen Fall einen großen Unterschied im Speicherverbrauch des Hash-Match-Operators feststellen: <br><br><img src="https://habrastorage.org/webt/xk/tl/sn/xktlsnekpwpu--xaebgb_ndkcn8.png"><br><br>  Beachten Sie, dass Sie in der Regel nur dann signifikante Leistungsverbesserungen feststellen, wenn Sie bereits speichergebunden sind.  Auf meinem System dauerte die Ausführung aufgrund der hohen CPU-Auslastung der neuen Funktion etwas länger: <br><br><img src="https://habrastorage.org/webt/d9/nl/n8/d9nln84mrqh-kfmumdca_u8tt8u.png"><br><br>  Vielleicht wäre der Unterschied bedeutender, wenn ich größere Tabellen, weniger Speicher für SQL Server, eine höhere Parallelität oder eine Kombination der oben genannten hätte. <br><br><h4>  <font color="#004d71">Tipps zur Verwendung der Kompatibilitätsstufe innerhalb einer Abfrage</font> </h4><br>  Haben Sie eine spezielle Abfrage, die unter einer bestimmten Kompatibilitätsstufe besser funktioniert als die aktuelle Datenbank?  Dies ist jetzt dank neuer Abfragehinweise möglich, die sechs verschiedene Kompatibilitätsstufen und fünf verschiedene Modelle zur Schätzung der Anzahl der Elemente unterstützen.  Im Folgenden sind die verfügbaren Kompatibilitätsstufen, eine Beispielsyntax und ein jeweils verwendetes Kompatibilitätsstufenmodell aufgeführt.  Sehen Sie, wie sich dies auf Bewertungen auswirkt, auch für Systemansichten: <br><br><img src="https://habrastorage.org/webt/gn/0n/g1/gn0ng1ar9z_cxpi7mt8_kaiqkmu.png"><br><br>  Kurz gesagt: Sie müssen sich nicht mehr an die Ablaufverfolgungsflags erinnern oder sich fragen, ob Sie sich Gedanken darüber machen müssen, ob der TF 4199-Patch für das Abfrageoptimierungsprogramm verteilt wurde oder von einem anderen Service Pack abgebrochen wurde.  Beachten Sie, dass diese zusätzlichen Hinweise kürzlich auch für SQL Server 2017 im kumulativen Update Nr. 10 hinzugefügt wurden (Einzelheiten finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Blog von Pedro Lopez</a> ).  Sie können alle verfügbaren Hinweise mit dem folgenden Befehl anzeigen: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.dm_exec_valid_use_hints;</code> </pre> <br>  Vergessen Sie jedoch nicht, dass Hinweise eine außergewöhnliche Maßnahme sind. Sie eignen sich häufig, um aus einer schwierigen Situation herauszukommen, sollten jedoch nicht für die langfristige Verwendung geplant werden, da sich ihr Verhalten bei nachfolgenden Aktualisierungen ändern kann. <br><br><h2>  <font color="#c30">Fehlerbehebung</font> </h2><br><h4>  <font color="#004d71">Vereinfachte Standardprofilerstellung</font> </h4><br>  Um diese Verbesserung zu verstehen, müssen einige Punkte beachtet werden.  In SQL Server 2014 wurde die Ansicht DMV sys.dm_exec_query_profiles eingeführt, mit der der Benutzer, der die Abfrage ausführt, Diagnoseinformationen zu allen Anweisungen in allen Teilen der Abfrage erfassen kann.  Die gesammelten Informationen werden nach Abschluss der Abfrage verfügbar und ermöglichen es Ihnen zu bestimmen, welche Bediener die Hauptressourcen tatsächlich ausgegeben haben und warum.  Jeder Benutzer, der eine bestimmte Anforderung nicht erfüllt hat, kann diese Daten für jede Sitzung empfangen, in der die Anweisung STATISTICS XML oder STATISTICS PROFILE enthalten war, oder für alle Sitzungen, die das erweiterte Ereignis query_post_execution_showplan verwenden, obwohl dieses Ereignis insbesondere die Gesamtleistung beeinträchtigen kann. <br><br>  In Management Studio 2016 wurde eine Funktion hinzugefügt, mit der Sie Datenströme, die den Abfrageplan durchlaufen, in Echtzeit basierend auf den von DMV gesammelten Informationen anzeigen können, wodurch die Fehlerbehebung noch leistungsfähiger wird.  Der Plan Explorer bietet auch die Möglichkeit, Daten, die die Abfrage durchlaufen, sowohl in Echtzeit als auch im Wiedergabemodus zu visualisieren. <br><br>  Ab SQL Server 2016 Service Pack 1 (SP1) können Sie auch eine einfache Version der Datenerfassung für alle Sitzungen mithilfe des Ablaufverfolgungsflags 7412 oder der erweiterten Eigenschaft query_thread_profile aktivieren, mit der Sie sofort aktuelle Informationen zu jeder Sitzung abrufen können, ohne dass etwas erforderlich ist Nehmen Sie dies ausdrücklich auf (insbesondere Dinge, die die Leistung beeinträchtigen).  Dies wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Blog von Pedro Lopez</a> ausführlicher beschrieben. <br><br>  In SQL Server 2019 ist diese Funktion standardmäßig aktiviert, sodass Sie in keiner Abfrage Sitzungen mit erweiterten Ereignissen ausführen oder Ablaufverfolgungsflags und STATISTICS-Anweisungen verwenden müssen.  Schauen Sie sich jederzeit die Daten der DMV für alle gleichzeitigen Sitzungen an.  Es ist jedoch möglich, diesen Modus mit LIGHTWEIGHT_QUERY_PROFILING zu deaktivieren. Diese Syntax funktioniert jedoch nicht in CTP 2.0 und wird in zukünftigen Editionen behoben. <br><br><h4>  <font color="#004d71">Statistiken zu gruppierten Spaltenindizes sind jetzt in geklonten Datenbanken verfügbar</font> </h4><br>  In aktuellen Versionen von SQL Server werden beim Klonen einer Datenbank nur die ursprünglichen Objektstatistiken aus gruppierten Spaltenindizes verwendet, ausgenommen Aktualisierungen, die nach ihrer Erstellung an der Tabelle vorgenommen wurden.  Wenn Sie einen Klon verwenden, um Abfragen und andere Leistungstests zu konfigurieren, die auf Nennleistungen basieren, funktionieren diese Beispiele möglicherweise nicht.  Parikshit Savyani beschrieb die Einschränkungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in dieser Veröffentlichung</a> und stellte eine temporäre Lösung bereit. Bevor Sie den Klon erstellen, müssen Sie ein Skript erstellen, das DBCC SHOW_STATISTICS ... WITH STATS_STREAM für jedes Objekt ausführt.  Es ist teuer und natürlich leicht zu vergessen. <br><br>  In SQL Server 2019 sind diese aktualisierten Statistiken automatisch im Klon verfügbar, sodass Sie verschiedene Abfrageszenarien testen und objektive Pläne basierend auf realen Statistiken abrufen können, ohne STATS_STREAM für alle Tabellen manuell ausführen zu müssen. <br><br><h4>  <font color="#004d71">Komprimierungsprognose für die Spaltenspeicherung</font> </h4><br>  In aktuellen Versionen wird die Prozedur sys.sp_estimate_data_compression_savings wie folgt überprüft: <br><br><pre> <code class="sql hljs">if (@data_compression not in ('NONE', 'ROW', 'PAGE'))</code> </pre> <br>  Dies bedeutet, dass Sie die Komprimierung einer Zeile oder Seite überprüfen können (oder das Ergebnis des Löschens der aktuellen Komprimierung sehen können).  In SQL Server 2019 sieht diese Prüfung jetzt folgendermaßen aus: <br><br><pre> <code class="sql hljs">if (@data_compression not in ('NONE', 'ROW', 'PAGE', 'COLUMNSTORE', 'COLUMNSTORE_ARCHIVE'))</code> </pre> <br>  Dies ist eine gute Nachricht, da Sie damit die Auswirkungen des Hinzufügens eines Spaltenindex zu einer Tabelle ohne diese Tabelle grob vorhersagen oder Tabellen oder Partitionen in ein noch komprimierteres Spaltenspeicherformat konvertieren können, ohne die Tabelle auf einem anderen System wiederherstellen zu müssen.  Ich hatte eine Tabelle mit 10 Millionen Zeilen, für die ich eine gespeicherte Prozedur mit jedem der fünf Parameter durchgeführt habe: <br><br><pre> <code class="sql hljs">EXEC sys.sp_estimate_data_compression_savings @schema_name = N'dbo', @object_name = N'FactTable', @index_id = NULL, @partition_number = NULL, @data_compression = N'NONE'; <span class="hljs-comment"><span class="hljs-comment">-- repeat for ROW, PAGE, COLUMNSTORE, COLUMNSTORE_ARCHIVE</span></span></code> </pre> <br>  Ergebnisse: <br><br><img src="https://habrastorage.org/webt/d6/xu/uy/d6xuuythndwrwogn22ljt83w8y4.png"><br><br>  Wie bei anderen Komprimierungsarten hängt die Genauigkeit vollständig von den verfügbaren Zeilen und der Repräsentativität der übrigen Daten ab.  Dies ist jedoch eine ziemlich leistungsstarke Methode, um ohne große Schwierigkeiten vorhersehbare Ergebnisse zu erzielen. <br><br><h4>  <font color="#004d71">Neue Funktion zum Abrufen von Seiteninformationen</font> </h4><br>  DBCC PAGE und DBCC IND wurden lange Zeit verwendet, um Informationen über Seiten zu sammeln, die einen Abschnitt, einen Index oder eine Tabelle enthalten.  Sie sind jedoch nicht dokumentiert und werden nicht unterstützt. Es kann mühsam sein, die Lösung von Aufgaben zu automatisieren, die mit mehreren Indizes oder Seiten verbunden sind. <br><br>  Später wurde eine dynamische Verwaltungsfunktion (DMF) sys.dm_db_database_page_allocations angezeigt, die einen Satz zurückgibt, der alle Seiten im angegebenen Objekt darstellt.  Immer noch undokumentiert und mit Fehlern, die bei großen Tabellen zu einem echten Problem werden können: Selbst um Informationen über eine Seite zu erhalten, muss die gesamte Struktur gelesen werden, was sehr teuer sein kann. <br><br>  In SQL Server 2019 wurde ein weiteres DMF angezeigt - sys.dm_db_page_info.  Grundsätzlich werden alle Seiteninformationen ohne den Aufwand der DMF-Verteilung zurückgegeben.  Um die Funktion in aktuellen Builds verwenden zu können, müssen Sie die Nummer der gesuchten Seite im Voraus kennen.  Vielleicht wurde dieser Schritt absichtlich gemacht, weil  Nur so kann die Leistung sichergestellt werden.  Wenn Sie also versuchen, alle Seiten in einem Index oder einer Tabelle zu identifizieren, müssen Sie weiterhin die DMF-Verteilung verwenden.  Im nächsten Artikel werde ich diese Frage genauer beschreiben. <br><br><h2>  <font color="#c30">Sicherheit</font> </h2><br><h4>  <font color="#004d71">Permanente Verschlüsselung in einer sicheren Umgebung (Enklave)</font> </h4><br>  Derzeit schützt die permanente Verschlüsselung vertrauliche Daten während der Übertragung und im Speicher durch Ver- / Entschlüsselung an jedem Ende des Prozesses.  Leider führt dies häufig zu schwerwiegenden Einschränkungen bei der Arbeit mit Daten, z. B. der Unfähigkeit, Berechnungen und Filter durchzuführen. Daher müssen Sie den gesamten Datensatz auf die Clientseite übertragen, um beispielsweise eine Bereichssuche durchzuführen. <br><br>  Eine sichere Umgebung (Enklave) ist ein geschützter Speicherbereich, in dem solche Berechnungen und Filter delegiert werden können (Windows verwendet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">virtualisierungsbasierte Sicherheit</a> ). Die Daten bleiben im Kernel verschlüsselt, können jedoch in einer sicheren Umgebung sicher entschlüsselt oder verschlüsselt werden.  Sie müssen lediglich den Parameter ENCLAVE_COMPUTATIONS mithilfe von SSMS zum Primärschlüssel hinzufügen, indem Sie beispielsweise das Kontrollkästchen "Berechnungen in einer sicheren Umgebung zulassen" aktivieren: <br><br><img src="https://habrastorage.org/webt/do/ia/tp/doiatpb0ne_kpxgb5pbdep8ua5m.png"><br><br>  Jetzt können Sie Daten im Vergleich zur alten Methode (bei der der Assistent, das Cmdlet Set-SqlColumnEncyption oder Ihre Anwendung den gesamten Satz vollständig aus der Datenbank abrufen, verschlüsseln und zurücksenden müssten) fast sofort verschlüsseln: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.Patients <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> SSN <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- currently not encrypted! ENCRYPTED WITH ( COLUMN_ENCRYPTION_KEY = ColumnEncryptionKeyName, ENCRYPTION_TYPE = Randomized, ALGORITHM = 'AEAD_AES_256_CBC_HMAC_SHA_256' ) NOT NULL;</span></span></code> </pre> <br>  Ich denke, dass für viele Unternehmen diese Verbesserung die Hauptnachricht sein wird, aber im aktuellen CTP werden einige dieser Subsysteme noch verbessert, daher sind sie standardmäßig deaktiviert, aber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier können</a> Sie sehen, wie sie aktiviert werden. <br><br><h4>  <font color="#004d71">Zertifikatverwaltung in Configuration Manager</font> </h4><br>  Das Verwalten von SSL- und TLS-Zertifikaten war schon immer ein Problem, und viele Menschen waren gezwungen, mühsam eigene Skripts zu erstellen, um ihre Unternehmenszertifikate bereitzustellen und zu verwalten.  Mit dem aktualisierten Configuration Manager für SQL Server 2019 können Sie schnell Zertifikate einer Instanz anzeigen und überprüfen, bald ablaufende Zertifikate finden und Zertifikatbereitstellungen für alle Replikationen in der Verfügbarkeitsgruppe oder alle Knoten in der Failoverclusterinstanz synchronisieren. <br><br>  Ich habe nicht alle diese Vorgänge ausprobiert, aber sie sollten für frühere Versionen von SQL Server funktionieren, wenn die Verwaltung von SQL Server 2019 Configuration Manager stammt. <br><br><h4>  <font color="#004d71">Integrierte Datenklassifizierung und -prüfung</font> </h4><br>  Das SQL Server-Entwicklungsteam hat die Möglichkeit hinzugefügt, Daten in SSMS 17.5 zu klassifizieren. Auf diese Weise können Sie alle Spalten identifizieren, die vertrauliche Informationen enthalten oder verschiedenen Standards widersprechen (natürlich HIPAA, SOX, PCI und GDPR).  Der Assistent verwendet einen Algorithmus, der Spalten anbietet, die Probleme verursachen sollen. Sie können jedoch entweder den Satz anpassen, indem Sie diese Spalten aus der Liste entfernen, oder eigene hinzufügen.  Zum Speichern der Klassifizierung werden erweiterte Eigenschaften verwendet.  Der integrierte SSMS-Bericht verwendet dieselben Informationen, um seine Daten anzuzeigen.  Außerhalb des Berichts sind diese Eigenschaften nicht so offensichtlich. <br><br>  SQL Server 2019 hat eine neue Anweisung für diese Metadaten eingeführt, die bereits in der Azure SQL-Datenbank verfügbar ist und den Namen ADD SENSITIVITY CLASSIFICATION trägt.  Sie können das Gleiche wie der Assistent in SSMS tun, die Informationen werden jedoch nicht mehr in der erweiterten Eigenschaft gespeichert, und der Zugriff auf diese Daten wird im Audit automatisch als neue XML-Spalte data_sensitivity_information angezeigt.  Es enthält alle Arten von Informationen, die während des Audits betroffen waren. <br><br>  Angenommen, ich habe eine Tabelle für externe Auftragnehmer: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.Contractors ( FirstName sysname, LastName sysname, SSN <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>), HourlyRate <span class="hljs-built_in"><span class="hljs-built_in">decimal</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) );</code> </pre> <br>  Bei Betrachtung einer solchen Struktur wird deutlich, dass alle vier Spalten entweder potenziell anfällig für Leckagen sind oder nur einem begrenzten Personenkreis zugänglich sein sollten.  Hier können Sie mit Berechtigungen auskommen, aber zumindest müssen Sie sich auf diese konzentrieren.  Daher können wir diese Spalten auf verschiedene Arten klassifizieren: <br><br><pre> <code class="sql hljs">ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.FirstName, dbo.Contractors.LastName <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Confidential â€“ GDPR'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'Personal Info'</span></span>); ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.SSN <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Highly Confidential'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'National ID'</span></span>); ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.HourlyRate <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Highly Confidential'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'Financial'</span></span>);</code> </pre> <br>  Anstatt sich sys.extended_properties anzusehen, können Sie sie jetzt in sys.sensitivity_classifications sehen: <br><br><img src="https://habrastorage.org/webt/xs/4u/bx/xs4ubxognfau0yxlbl_g8caqujm.png"><br><br>  Und wenn wir für diese Tabelle Audit Sampling (oder DML) durchführen, müssen wir nichts speziell ändern.  Nach dem Erstellen der Klassifizierung zeichnet <code>SELECT *</code> im Überwachungsprotokoll einen Datensatz dieser Art von Informationen in einer neuen Spalte data_sensitivity_information auf: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attributes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Confidential - GDPR"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Personal Info"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Highly Confidential"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"National ID"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Highly Confidential"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Financial"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attributes</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Dies löst natürlich nicht alle Probleme der Einhaltung von Standards, kann aber einen echten Vorteil bringen.  Die Verwendung des Assistenten zum automatischen Identifizieren von Spalten und zum Übersetzen von sp_addextendedproperty-Aufrufen in ADD SENSITIVITY CLASSIFICATION-Befehle kann die Einhaltung von Standards erheblich vereinfachen.  Später werde ich einen separaten Artikel darüber schreiben. <br><br>  Sie können auch die Erstellung (oder Aktualisierung) von Berechtigungen basierend auf der Bezeichnung in den Metadaten automatisieren - die Erstellung eines dynamischen SQL-Skripts, das den Zugriff auf alle vertraulichen (GDPR) Spalten verbietet, mit denen Sie Benutzer, Gruppen oder Rollen verwalten können.  Ich werde in Zukunft an diesem Thema arbeiten. <br><br><h2>  <font color="#c30">Verfügbarkeit</font> </h2><br><h4>  <font color="#004d71">Erstellung eines erneuerbaren Index in Echtzeit</font> </h4><br>  In SQL Server 2017 wurde es möglich, die Neuerstellung des Index in Echtzeit anzuhalten und fortzusetzen. Dies kann sehr nützlich sein, wenn Sie die Anzahl der verwendeten Prozessoren ändern, ab dem Zeitpunkt der Unterbrechung nach einem Fehler fortfahren oder einfach die Lücke zwischen den Servicefenstern schließen müssen.  Ich habe in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">früheren Artikel</a> über diese Funktion gesprochen. <br><br>  In SQL Server 2019 können Sie dieselbe Syntax verwenden, um Echtzeitindizes zu erstellen, anzuhalten und fortzufahren sowie die Ausführungszeit zu begrenzen (Festlegen der Pausenzeit): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar(blat) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">RESUMABLE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, MAX_DURATION = <span class="hljs-number"><span class="hljs-number">10</span></span> MINUTES);</code> </pre> <br>  Wenn diese Abfrage zu lange funktioniert, können Sie zum Anhalten ALTER INDEX in einer anderen Sitzung ausführen (auch wenn der Index physisch noch nicht vorhanden ist): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar PAUSE;</code> </pre> <br>  In aktuellen Builds kann der Grad der Parallelität während der Erneuerung nicht verringert werden, wie dies beim Wiederaufbau der Fall ist.  Beim Versuch, DOP zu reduzieren: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar <span class="hljs-keyword"><span class="hljs-keyword">RESUME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (MAXDOP = <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre> <br>  Wir bekommen folgendes: <br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">10666</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-type"><span class="hljs-type">Line</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> Cannot resume <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> build <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> required DOP <span class="hljs-number"><span class="hljs-number">4</span></span> (DOP operation was started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> available. Please ensure sufficient DOP <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> available <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span> existing <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> operation <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> try again. The <span class="hljs-keyword"><span class="hljs-keyword">statement</span></span> has been terminated.</code> </pre> <br>  Wenn Sie dies versuchen und dann den Befehl ohne zusätzliche Parameter ausführen, wird derselbe Fehler angezeigt, zumindest bei den aktuellen Builds.  Ich denke, dass der Erneuerungsversuch irgendwo aufgezeichnet wurde und das System ihn wieder verwenden wollte.  Um fortzufahren, müssen Sie den richtigen (oder höheren) DOP-Wert angeben: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar <span class="hljs-keyword"><span class="hljs-keyword">RESUME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (MAXDOP = <span class="hljs-number"><span class="hljs-number">4</span></span>);</code> </pre> <br>  Um es klar zu machen: Sie können den DOP erhöhen, wenn Sie eine angehaltene Indexerstellung fortsetzen, aber nicht senken. <br><br>  Ein zusätzlicher Vorteil davon ist, dass Sie die Erstellung und / oder Erneuerung von Indizes in Echtzeit als Standardmodus konfigurieren können, indem Sie die Klauseln ELEVATE_ONLINE und ELEVATE_RESUMABLE für die neue Datenbank verwenden. <br><br><h4>  <font color="#004d71">Echtzeiterstellung / Neuerstellung von gruppierten Spaltenindizes</font> </h4><br>  Neben der Erstellung erneuerbarer Indizes haben wir auch die Möglichkeit, Clustered-Column-Indizes in Echtzeit zu erstellen oder neu zu erstellen.  Dies ist eine wesentliche Änderung, die es Ihnen ermöglicht, die Zeit der Servicefenster nicht mehr für die Pflege solcher Indizes zu verwenden oder (zur größeren Sicherheit) Indizes von zeilenweise in spaltenweise umzuwandeln: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> CLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CLUSTERED COLUMNSTORE <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (DROP_EXISTING = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Warnung: Wenn ein vorhandener traditioneller Clustered-Index in Echtzeit erstellt wurde, ist seine Konvertierung in einen Clustered-Spaltenindex auch nur in diesem Modus möglich. </font><font style="vertical-align: inherit;">Wenn es Teil des Primärschlüssels ist, eingebaut oder nicht ...</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Splunge PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> CLUSTERED (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); GO <span class="hljs-comment"><span class="hljs-comment">-- or after the fact -- ALTER TABLE dbo.splunge ADD CONSTRAINT PK_Splunge PRIMARY KEY CLUSTERED(id);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir erhalten folgenden Fehler: </font></font><br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">1907</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> Cannot recreate <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-string"><span class="hljs-string">'PK_Splunge'</span></span>. The <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> definition does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> match the <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> being enforced <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> the existing <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie müssen zuerst die Einschränkung entfernen, um sie in einen gruppierten Spaltenindex zu konvertieren. Beide Vorgänge können jedoch in Echtzeit ausgeführt werden: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CLUSTERED COLUMNSTORE <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies funktioniert, aber große Tabellen dauern wahrscheinlich länger als wenn der Primärschlüssel als eindeutiger Clustered-Index implementiert würde. </font><font style="vertical-align: inherit;">Ich kann nicht sicher sagen, ob dies eine absichtliche Einschränkung oder nur eine Einschränkung des aktuellen CTP ist.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umleiten einer Replikationsverbindung von einem sekundären Server zu einem primären </font></font><br></font> </h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit dieser Funktion können Sie die Umleitung konfigurieren, ohne zu lauschen, sodass Sie die Verbindung zum Primärserver wechseln können, auch wenn der Sekundärserver direkt in der Verbindungszeichenfolge angegeben ist. </font><font style="vertical-align: inherit;">Diese Funktion kann verwendet werden, wenn die Clustering-Technologie das Abhören nicht unterstützt, wenn AGs ohne Cluster verwendet werden oder wenn in einem Szenario mit mehreren Subnetzen ein komplexes Umleitungsschema vorhanden ist. </font><font style="vertical-align: inherit;">Dadurch wird verhindert, dass die Verbindung beispielsweise Schreibvorgänge für die schreibgeschützte Replikation (bzw. Fehler) versucht.</font></font><br><br><h2>  <font color="#c30">Entwicklung</font> </h2><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusätzliche Funktionen des Diagramms</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrammbeziehungen unterstützen jetzt die MERGE-Anweisung für einen Knoten oder Grenztabellen unter Verwendung von MERGE-Prädikaten. </font><font style="vertical-align: inherit;">Jetzt kann ein Bediener eine vorhandene Kante aktualisieren oder eine neue einfügen. </font><font style="vertical-align: inherit;">Mit der neuen Kantenbeschränkung können Sie bestimmen, welche Knoten die Kante verbinden kann.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utf-8</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server 2012 hat die Unterstützung für UTF-16 und zusätzliche Zeichen hinzugefügt, indem die Sortierung durch Angabe eines Namens mit dem Suffix _SC festgelegt wurde, z. B. Latin1_General_100_CI_AI_SC, um Unicode-Spalten (nchar / nvarchar) zu verwenden. In SQL Server 2017 können Sie UTF-8-Daten mit Tools wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BULK INSERT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus und in diese Spalten importieren und exportieren </font><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In SQL Server 2019 gibt es neue Sortieroptionen, um die erzwungene Aufbewahrung von UTF-8-Daten in ihrer ursprünglichen Form zu unterstützen. </font><font style="vertical-align: inherit;">Mit der neuen Sortierung mit dem Suffix _SC_UTF8 wie Latin1_General_100_CI_AI_SC_UTF8 können Sie auf einfache Weise Zeichen- oder Varchar-Spalten erstellen und UTF-8-Daten korrekt speichern. </font><font style="vertical-align: inherit;">Dies kann dazu beitragen, die Kompatibilität mit externen Anwendungen und DBMS zu verbessern, ohne die Kosten für die Verarbeitung und Speicherung von nvarchar zu verursachen.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Osterei habe ich gefunden</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Soweit ich mich erinnere, beschweren sich SQL Server-Benutzer über diese vage Fehlermeldung: </font></font><br><br><pre> <code class="hljs vbscript">Msg <span class="hljs-number"><span class="hljs-number">8152</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> binary data would be truncated.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In den CTP-Builds, mit denen ich experimentiert habe, wurde eine interessante Fehlermeldung festgestellt, die vorher nicht vorhanden war: </font></font><br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">2628</span></span> String <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> binary data would be truncated <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span>. Truncated <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich denke, hier wird nichts anderes benötigt. Dies ist eine große (wenn auch sehr späte) Verbesserung und verspricht, viele glücklich zu machen. Diese Funktionalität ist in CTP 2.0 jedoch nicht verfügbar. Ich gebe Ihnen nur die Gelegenheit, ein wenig nach vorne zu schauen. Brent Ozar listete alle neuen Nachrichten auf, die er im aktuellen CTP gefunden hatte, und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">würzte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sie mit einigen hilfreichen Kommentaren in seinem Artikel </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">sys.messages: Entdecken zusätzlicher Funktionen</font></a><font style="vertical-align: inherit;"> .</font></font><br><br><h2>  <font color="#c30">Fazit</font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server 2019 bietet gute zusätzliche Funktionen, mit denen Sie die Arbeit mit Ihrer bevorzugten relationalen Datenbankplattform verbessern können, und es gibt eine Reihe von Änderungen, über die ich nicht gesprochen habe. Energieeffizienter Speicher, Clustering für maschinelle Lerndienste, Replikation und verteilte Transaktionen unter Linux, Kubernetes, Konnektoren für Oracle / Teradata / MongoDB, synchrone AG-Replikationen sind gestiegen, um Java (eine Implementierung ähnlich wie Python / R) und ebenso wichtig einen neuen Sprung zu unterstützen. mit dem Titel Big Data Cluster. Um einige dieser Funktionen nutzen zu können, müssen Sie sich mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesem EAP-Formular</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> registrieren </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bob Wards bevorstehendes Buch </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pro SQL Server unter Linux - einschließlich containergestützter Bereitstellung mit Docker und Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann einige Hinweise auf eine Reihe anderer Dinge geben, die bald kommen. </font><font style="vertical-align: inherit;">Und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diese Veröffentlichung von</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Brent Ozar spricht über eine mögliche bevorstehende Korrektur für eine skalare benutzerdefinierte Funktion. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber selbst in dieser ersten öffentlichen CTP ist für fast jeden etwas Bedeutendes, und ich fordere Sie auf, es selbst zu versuchen!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424441/">https://habr.com/ru/post/de424441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424429/index.html">Wissenschaft Kunst und Klang: 4 beeindruckende Projekte</a></li>
<li><a href="../de424431/index.html">Valve enthüllt Steam Game Controller-Ranglisten</a></li>
<li><a href="../de424433/index.html">Warum Hacker Mikrotik und wie ich 100.000 RouterOS vor einem Botnetz versteckt habe</a></li>
<li><a href="../de424435/index.html">Ölbohrzoo: Ordnung schaffen</a></li>
<li><a href="../de424437/index.html">Ulme. Bequem und umständlich. Json.Encoder und Json.Decoder</a></li>
<li><a href="../de424443/index.html">Vivaldi 2.0 zu unseren Gunsten</a></li>
<li><a href="../de424445/index.html">Neil Fords Übersetzung von Microservices als evolutionäre Architektur</a></li>
<li><a href="../de424447/index.html">Lisp mit Pascal oder der Programmiersprache 8501. gewürzt</a></li>
<li><a href="../de424453/index.html">Lerne OpenGL. Lektion 6.2 - Physikalisches Rendern. Analytische Lichtquellen</a></li>
<li><a href="../de424455/index.html">Intel Optane - Jetzt 1,5 Terabyte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>