<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•å üåø üåè Localizaci√≥n de marcador de Aruco üë® ‚óºÔ∏è ü§∏üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la √∫ltima publicaci√≥n, hablamos sobre c√≥mo llegar del punto A al punto B sin golpear nada. Pero para dar la vuelta a algo, debe comprender d√≥nde es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Localizaci√≥n de marcador de Aruco</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482220/">  <a href="https://habr.com/ru/post/479636/">En la √∫ltima publicaci√≥n,</a> hablamos sobre c√≥mo llegar del punto A al punto B sin golpear nada.  Pero para dar la vuelta a algo, debe comprender d√≥nde estamos y d√≥nde hay obst√°culos din√°micos (nuestros oponentes y no solo). <br><br>  Una persona tiene ojos, o√≠dos y software establecidos por la naturaleza y la experiencia personal para que pueda moverse y navegar f√°cilmente en el espacio.  El sistema de localizaci√≥n es casi el ojo y el o√≠do para los robots.  Es necesario para que el robot pueda navegar en el espacio y, ajust√°ndose al entorno, moverse en √©l. <br><br>  Hoy hablaremos sobre c√≥mo resolvimos el problema de determinar la posici√≥n de los robots en el campo Eurobot, c√≥mo hacer todo esto, lanzarlo y configurarlo usted mismo. <br><br><img src="https://habrastorage.org/webt/wd/ob/7l/wdob7lxsj1x5z0ubs94tyz5hf08.png"><br><a name="habracut"></a><br><h2>  Condiciones objetivo del sistema de localizaci√≥n </h2><br>  Uno de los principios de Eurobot Open es la autonom√≠a.  Autonom√≠a de todo lo que est√° detr√°s del campo de juego.  Todos los c√°lculos, la toma de decisiones y la localizaci√≥n deben hacerse en \ en robots o en sitios especiales en el campo. <br><br>  El tama√±o del campo es de 2x3 metros, y el error en el tama√±o y la posici√≥n de los elementos de un campo a otro suele ser de 3-5 mm. <br><br>  En la imagen a continuaci√≥n hay un diagrama del campo Eurobot 2019 con zonas marcadas en las que podemos colocar algo m√°s que robots. <br><br><img src="https://habrastorage.org/webt/ed/sn/nr/edsnnr36r2ksmv9sr7pzjz1khhk.png"><br><br><ul><li>  6 - Zona de experimento (una de las tareas adicionales) </li><li>  10 - Zonas del faro </li><li>  11 - Una torre especial para instalar un dispositivo de seguimiento central (en lo sucesivo, el CCC).  Ubicado sobre el campo a una altura de 1 metro </li><li>  Tambi√©n en los robots mismos podemos instalar balizas. </li></ul><br>  Para todas estas √°reas y las dimensiones de los robots en s√≠, existen restricciones estrictas de peso y tama√±o, por lo que es imposible hacer un gran superm√≥dulo productivo en el que todo encaje.  Y tambi√©n hay un l√≠mite de 3 minutos para la preparaci√≥n para el lanzamiento.  Durante este tiempo, una o dos personas del equipo deben sacar los robots y todo lo relacionado con ellos, organizarlos, configurarlos y prepararse para el lanzamiento.  Obviamente, cuanto menos basura necesites configurar y ajustar, menos probabilidades tendr√°s de cometer un error o ser multado antes del comienzo de la batalla. <br><br><img src="https://habrastorage.org/webt/73/ic/e7/73ice79-lmosmu6rt-gi5gdz744.jpeg"><br>  <i>y otro segundo cuadro completo</i> <br><br><h3>  Analizamos opciones </h3><br>  Con la conciencia de nuestras capacidades y el deseo de obtener una precisi√≥n de posicionamiento de al menos unos pocos mil√≠metros, veamos qu√© podemos usar en general para resolver este problema: <br><br><ul><li>  <b>La odometr√≠a de las ruedas</b> con codificadores ubicados directamente en el variador o ruedas de medici√≥n adicionales le permite leer la distancia recorrida por el robot y determinar su posici√≥n en relaci√≥n con el punto de partida.  Muchos equipos de Eurobot lo usan como su m√©todo de localizaci√≥n principal.  Esta es una de las fuentes m√°s r√°pidas de informaci√≥n de movimiento para el robot.  Sin embargo, en la pr√°ctica, especialmente cuando se conduce en omni-ruedas (un √°rea de contacto m√°s peque√±a que las ruedas cl√°sicas, el juego de rodillos y los errores de fabricaci√≥n m√°s grandes), la odometr√≠a es susceptible al problema de acumulaci√≥n de errores, que debe corregirse de alguna manera.  Puede alinearse con la superficie con coordenadas conocidas, o puede formar complejos con un sistema adicional.  Adem√°s, si usa codificadores en las ruedas motrices, existe el problema del deslizamiento de las ruedas durante maniobras bruscas y en colisiones del robot.  Las ruedas de medici√≥n pueden eliminar este problema, pero son dif√≠ciles de colocar en un robot peque√±o. <br><br><img src="https://habrastorage.org/webt/v0/8u/bd/v08ubdzodh5zpr8kr7ee3fhbo5y.png"><br>  <i>Rueda omnidireccional de medici√≥n propia con suspensi√≥n independiente y con codificador magn√©tico, que utilizamos en 2018</i> <br></li><li>  <b>Los lidares</b> tienen ventajas significativas: obtenemos una vista casi circular y distancias a los obst√°culos.  De los inconvenientes, vale la pena se√±alar el alto precio, la dificultad para tratar de distinguir peque√±os objetos distantes de la basura y un algoritmo de localizaci√≥n relativamente complicado.  Los lidares baratos (como rplidar) tienen una frecuencia de actualizaci√≥n y una resoluci√≥n angular bastante bajas, y tambi√©n est√°n sujetos a la luz de otros lidars, tel√©metros, etc. Las reglas de elevaci√≥n para los sistemas de localizaci√≥n tienen pocos objetos est√°ticos para el enlace.  Sin embargo, el equipo de Skoltech ha estado patinando con √©xito durante varios a√±os utilizando el hokuyo ust-10lx y el a√±o pasado obtuvo el segundo lugar en la final europea de la competencia Eurobot en Francia. </li><li>  Tambi√©n consideramos <b>sistemas inerciales</b> , pero en nuestro caso no encajaban bien.  El aceler√≥metro hace ruido, el giroscopio est√° flotando, puede olvidarse de usar la br√∫jula en interiores.  Incluso el uso de un filtro Kalman no logra la precisi√≥n deseada.  Resulta que la IMU solo se puede usar de manera efectiva para la correcci√≥n en un per√≠odo de tiempo muy corto.  El m√°ximo de informaci√≥n √∫til que pudimos obtener con pixhawk2 es el √°ngulo durante un giro brusco (por ejemplo, de una colisi√≥n). </li><li>  <b>El GPS</b> no funciona en interiores, y la precisi√≥n sin RTK es metros. </li><li>  <b>Localizaci√≥n ultras√≥nica</b> .  Una de las implementaciones se puede encontrar aqu√≠: <a href="https://m.habr.com/ru/post/451408/">m.habr.com/en/post/451408</a> .  Por desgracia, la precisi√≥n de nuestras tareas no es muy alta (+ -2 cm), la diafon√≠a afecta fuertemente o, si utiliza sensores con protecci√≥n contra esto, se obtiene una baja frecuencia de sondeo.  Uno de los equipos en Rusia usa esta soluci√≥n con un √©xito variable, y el equipo alem√°n Turag utiliza con bastante √©xito una tecnolog√≠a similar desarrollada dentro del laboratorio. </li><li>  <b>La odometr√≠a visual</b> no proporciona informaci√≥n sobre la posici√≥n de los oponentes debido al hecho de que no hay muchos puntos en el campo a los que sea posible aferrarse de manera confiable. </li><li>  <b>\ Las c√°maras est√©reo</b> tienen un √°ngulo estrecho, que no permite cubrir el campo cuando se encuentra en el dispositivo de seguimiento central, ni obtener una vista circular o al menos aceptable cuando se instala en un robot. </li><li>  <b>Los marcadores fiduciarios</b> que hemos elegido y que examinaremos con m√°s detalle. </li></ul><br><h3>  Marcadores fiduciarios </h3><br>  La navegaci√≥n por marcadores ha existido durante mucho tiempo.  Te√≥ricamente, el llamado marcador puede ser cualquier objeto.  Pero hay muchos problemas al usar: <br><br><ul><li>  restricciones debido a la resoluci√≥n de la c√°mara; </li><li>  falta de fiabilidad de detecci√≥n cuando se utiliza el color como fuente principal de informaci√≥n; </li><li>  la necesidad de determinar la orientaci√≥n del marcador; </li><li>  las marcas de bajo contraste funcionan bien solo con buena luz; </li><li>  Se requiere un alto poder de procesamiento del equipo (procesamiento en tiempo real de las tramas entrantes). </li></ul><br>  Para sortear los problemas anteriores, generalmente debe usar algo simple e inequ√≠voco para el reconocimiento, por ejemplo, un c√≠rculo de color o un cuadrado (y me gustar√≠a un pato amarillo). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/636/59e/f61/63659ef613cf69454b7b3b9d788d934e.png" alt="imagen"><br>  <i>diferentes tipos de marcadores</i> <br><br>  De hecho, adem√°s de determinar la posici√≥n de un marcador, a menudo es necesario determinar su singularidad, por ejemplo, para detectar varios objetos a la vez.  Para hacer esto, puede cambiar el color o la forma, pero luego nos enfrentaremos r√°pidamente a una disminuci√≥n en la confiabilidad de la detecci√≥n. <br>  Este problema es bastante com√∫n y hay muchos est√°ndares de marcadores.  El m√°s famoso de ellos es el c√≥digo qr, pero rara vez se usa para problemas de localizaci√≥n debido a la redundancia y la necesidad de alta resoluci√≥n.  Como regla general, todos los marcadores son bicolores (la mayor√≠a de las veces b / w), de forma simple (la mayor√≠a de las veces un cuadrado) y de alguna manera codifican el identificador en s√≠ mismos.  Los marcadores m√°s famosos para la localizaci√≥n son Aruco, April Tag, ARToolKit. <br><br>  Cualquier persona interesada en aprender m√°s sobre ellos es un <a href="https://www.researchgate.net/publication/303752217_An_evaluation_of_artificial_fiducial_markers_in_underwater_environments">art√≠culo</a> interesante que tambi√©n compara la fiabilidad de su detecci√≥n. <br><br><div class="spoiler">  <b class="spoiler_title">Marcadores fractales</b> <div class="spoiler_text">  Hay momentos en los que necesitamos detectar un objeto tanto desde lejos como en blanco.  Usar varios marcadores de diferentes tama√±os es una forma, pero puede hacerlo de manera m√°s astuta y usar marcadores "fractales", cuyas diferentes partes funcionan a diferentes escalas de la imagen. <br><br>  <a href="https://docs.google.com/document/u/1/d/1SdsOTjGdu5o8gy2Ot2FDqYDS9ALgyhOBJcJHOZBR7B4/mobilebasic">docs.google.com/document/u/1/d/1SdsOTjGdu5o8gy2Ot2FDqYDS9ALgyhOBJcJHOZBR7B4/mobilebasic</a> <br></div></div><br>  En nuestro caso, tenemos muchos aspectos positivos del uso de marcadores: <br><br><ul><li>  con la posibilidad de instalar una c√°mara est√°tica con un buen √°ngulo de visi√≥n y marcado, esto no requiere un equipo dif√≠cil de encontrar y potencialmente no es muy dif√≠cil de implementar; </li><li>  la c√°mara remota puede evaluar la posici√≥n de todos los objetos en los que podemos colocar marcadores; </li><li>  los c√°lculos se llevan a cabo no en el dispositivo de a bordo del robot, sino en una computadora separada (pero existe un problema de confiabilidad y demoras en la transferencia de datos); </li><li>  La capacidad de resolver cualquier otro problema asociado con la visi√≥n. </li></ul><br>  Despu√©s de analizar los sistemas anteriores, nos decidimos por la detecci√≥n de marcadores.  Esto nos permiti√≥ no solo liberar nuestros odroides en robots, sino tambi√©n permitirles ver toda la situaci√≥n en el campo desde una vista de p√°jaro. <br><br><h3>  ¬øC√≥mo funciona fuera de la caja? </h3><br>  La "fiabilidad" de la detecci√≥n de marcadores es un t√©rmino relativo.  Diferentes tareas requieren diferentes niveles de precisi√≥n y estabilidad.  La inclusi√≥n de estos par√°metros depende del sensor de video, lentes, condiciones de iluminaci√≥n, etc. <br><br><img src="https://habrastorage.org/webt/yi/xs/5m/yixs5m5g6pv5xya8axbd-zqov-4.png"><br>  En nuestro caso, con un tama√±o de campo de 2x3 metros y una c√°mara a solo un metro por encima, es necesario utilizar una √≥ptica de gran angular con un campo de visi√≥n de al menos 120-140 grados para garantizar la visibilidad de todo el espacio de juego, lo que afecta negativamente la detecci√≥n (y su precisi√≥n) de peque√±os marcadores en el extremo esquina del campo de juego, y bajo condiciones arbitrarias de iluminaci√≥n hacen que esta tarea sea a√∫n m√°s dif√≠cil. <br>  Como ha demostrado la pr√°ctica, incluso en condiciones normales, completamente naturales, iluminadas, pueden ocurrir definiciones err√≥neas de la posici√≥n del marcador. <br><br><img src="https://habrastorage.org/webt/km/-n/cl/km-nclpq-m4g3jcgvwxls4eixb0.png"><br><br>  Por lo tanto, las siguientes im√°genes muestran dos cuadros consecutivos con resultados de detecci√≥n de marcadores: la direcci√≥n del eje Z (azul) cambia 180 grados. <br><br><img src="https://habrastorage.org/webt/sd/a5/ha/sda5haouwemxqiobswwckpb8dhw.png"><br><br><img src="https://habrastorage.org/webt/tu/gj/ii/tugjiiiol9ts2m4laiexh7nwnue.png"><br>  <i><a href="https://www.youtube.com/watch%3Fv%3DxzG2jQfxLlY">www.youtube.com/watch?v=xzG2jQfxLlY</a></i> <br><br><h3>  Llevar a un estado competitivo </h3><br><h4>  Cambiar el algoritmo </h4><br>  Para determinar con precisi√≥n la ubicaci√≥n del robot en el campo, debe conocer la posici√≥n angular de la c√°mara, la transformaci√≥n general del sistema de coordenadas y la posici√≥n de la c√°mara en relaci√≥n con la posici√≥n del campo.  Para hacer esta conversi√≥n, desarrollamos nuestro propio algoritmo.  Dado que una persona cuelga el centro de control central manualmente, adem√°s de que los campos son ligeramente diferentes entre s√≠, entonces no es posible obtener siempre la misma posici√≥n de c√°mara.  El desplazamiento angular de la c√°mara con respecto al campo tiene un efecto muy negativo en la detecci√≥n de la posici√≥n de los robots.  La soluci√≥n fundamental es determinar varios marcadores est√°ticos que podemos establecer antes del partido para la calibraci√≥n. <br><br>  La biblioteca Aruco en opencv proporciona la capacidad de determinar la posici√≥n del marcador 6dof en relaci√≥n con la c√°mara.  Al principio intentamos usarlo, pero result√≥ muy inestable e inexacto.  En nuestro caso, cuando se conoce la posici√≥n de la c√°mara, est√° fija, y los robots (y los marcadores asociados) se mueven en un plano que no pasa por el punto de fijaci√≥n de la c√°mara, es racional limitarnos a la tarea de detectar la posici√≥n 3dof (z-const, x-y, + rotaci√≥n alrededor un eje z) a trav√©s de la triangulaci√≥n de un punto en un plano en un √°ngulo visible. <br><br>  Se espera que una disminuci√≥n en la dimensi√≥n y un aumento en la base de la triangulaci√≥n (el tama√±o del marcador versus la distancia desde el plano de los marcadores a la c√°mara) del problema a resolver reduzca el nivel de incertidumbre y ruido de los resultados de la detecci√≥n. <br>  Para hacer esto, en lugar de la funci√≥n est√°ndar <br><br><pre><code class="cpp hljs">cv::aruco::estimatePoseSingleMarkers(markerCorners, <span class="hljs-number"><span class="hljs-number">0.05</span></span>, cameraMatrix, distCoeffs, rvecs, tvecs);</code> </pre> <br><br>  que, en base a las esquinas encontradas de los marcadores, determina la posici√≥n 6dof del marcador, escribimos nuestro estimador de posici√≥n, trabajando de acuerdo con los siguientes principios: <br><br><ul><li>  La posici√≥n de la c√°mara 3D se conoce de antemano; </li><li>  la altura del marcador se conoce de antemano; </li><li>  Como resultado de la detecci√≥n, se conocen p√≠xeles (v, u) de 4 esquinas del marcador; </li><li>  Como resultado de la calibraci√≥n de la c√°mara, se define una matriz de c√°mara 4x4; </li><li>  conociendo la 'matriz de c√°mara', la posici√≥n y orientaci√≥n de la c√°mara, la posici√≥n de los √°ngulos de p√≠xeles del marcador, puede obtener la proyecci√≥n de la posici√≥n de los √°ngulos en el espacio 3D en el plano z en el que se ubican los v√©rtices del marcador (la altura del marcador est√° determinada por su n√∫mero); </li><li>  haciendo el paso anterior para las 4 esquinas del marcador y promediando los datos obtenidos, es posible obtener coordenadas 3D de los v√©rtices del marcador en el sistema de coordenadas de la c√°mara; </li><li>  aplicando la transformaci√≥n de la c√°mara SK al SK del campo de juego, se obtienen las coordenadas del marcador en el campo SK. </li></ul><br><h4>  Resolver problemas de iluminaci√≥n y rendimiento </h4><br>  La estabilidad y la velocidad de detecci√≥n de los marcadores dependen en gran medida de las condiciones de iluminaci√≥n ambiental y de la estructura de fondo; cuantos m√°s objetos diferentes haya en el marco, m√°s tiempo llevar√° el procesamiento.  Dado que las reglas de iluminaci√≥n y fondo de Eurobot no est√°n reguladas de ninguna manera, pueden cambiar mucho de vez en cuando, puede haber otros campos, personas en segundo plano.  En particular, se pueden esperar exposiciones adicionales de robots enemigos, flashes de c√°mara o focos que caen en el campo de visi√≥n de la c√°mara. <br><br>  Para reducir la influencia de la iluminaci√≥n ambiental en la estabilidad de la detecci√≥n de marcadores, se desarroll√≥ un "dise√±o" especial en el que se utilizaron marcadores de aruco invertidos.  La parte oscura se reemplaza por una pel√≠cula retrorreflectante y se instala una luz de fondo LED activa directamente en la c√°mara.  El procesamiento de im√°genes se realiza en negativo, mientras que el contraste del fondo es mucho menor que el contraste de sus propios marcadores. <br><br>  Aumentar el contraste del marcador le permite seleccionar efectivamente regiones de inter√©s en el marco y buscar marcadores solo en ellos, y no en todo el marco, lo que mejora enormemente la productividad. <br><br><img src="https://habrastorage.org/webt/fz/p0/4n/fzp04n01ugkpz4b8yuqrasmv2qy.png"><br>  <i>Comparaci√≥n de las diferencias de contraste entre un marcador est√°ndar y un marcador con una superficie reflectante</i> <br><br><h3>  Seleccionamos hierro </h3><br>  Dado que las condiciones de iluminaci√≥n no est√°n definidas, y la velocidad de los robots puede ser bastante grande, desde el principio est√°bamos buscando una c√°mara con un obturador global, y no con un obturador enrollable.  La diferencia es que el global recopila informaci√≥n sobre el brillo de los p√≠xeles al mismo tiempo y se desplaza l√≠nea por l√≠nea, por lo que puede haber distorsiones en la forma geom√©trica de los objetos en movimiento. <br>  La c√°mara m√°s econ√≥mica es oCam-1mgn, que utilizamos durante 2 a√±os.  Sin embargo, es en blanco y negro y tiene una resoluci√≥n de solo 1Mpx, que se encuentra en el borde inferior de una resoluci√≥n aceptable (el n√∫mero de p√≠xeles en la imagen, por 1 "p√≠xel" del marcador). <br>  Inicialmente, el detector se consideraba en la misma placa √∫nica que los robots mismos: odroid xu4, y la velocidad de trabajo era de aproximadamente 20 fps, sin embargo, el deseo de colgar funcionalidades adicionales en el centro de control central y comprender que se necesitaba una mejor c√°mara llev√≥ a reemplazar la PC con un Intel m√°s vigoroso. Nuc, y la c√°mara ... la c√°mara que todav√≠a estamos recogiendo para la nueva temporada. <br><br><h3>  Comenzamos el proyecto </h3><br>  Se supone adem√°s que ya tiene configurado ROS Kinetic o Melodic. <br><br>  Lo primero que debe hacer es descargar e instalar OpenCV 3, Eigen3 y el proyecto <a href="https://bitbucket.org/eurobot1718/ocam_usb_cam">https://bitbucket.org/eurobot1718/ocam_usb_cam</a> (para la c√°mara Ocam), o usar otro proyecto que tenga una estructura similar a la publicaci√≥n de datos en los temas. <br><br>  Clonamos el repositorio con el proyecto de detector arude: <a href="https://gitlab.com/eurobot2019/aruco_detector">https://gitlab.com/eurobot2019/aruco_detector</a> y gui para ello <a href="https://github.com/alexpostnikov/aruco-gui">https://github.com/alexpostnikov/aruco-gui</a> <br>  Despu√©s de instalar los proyectos, debe calibrar la c√°mara y obtener la matriz de dispersi√≥n y la matriz de distorsi√≥n de la c√°mara, y luego envolver todo en el archivo yaml "camera_params.yml".  Un ejemplo simple es el uso de un tablero de ajedrez.  <a href="https://github.com/sourishg/fisheye-stereo-calibration">Enlace</a> a la implementaci√≥n en C ++, donde solo necesita recopilar y especificar los par√°metros de la placa y la c√°mara, as√≠ como el nombre del archivo de salida. <br><br>  La configuraci√≥n principal est√° en el archivo aruco_detector_params.yml: <br><br><ul><li>  <b>len_of_cube_markers</b> y <b>width_marker la</b> longitud y el ancho de los marcadores en metros; </li><li>  <b>markers_height</b> : comparaci√≥n del marcador y su altura; </li><li>  <b>marcadores</b> : una matriz que describe si un marcador particular pertenece a un robot espec√≠fico.  Indica los marcadores en sentido horario.  Y en el caso de los oponentes, dado que su direcci√≥n no es importante para nosotros, el orden de los marcadores en la configuraci√≥n tampoco es importante.  Solo necesita especificar el c√≥digo del marcador.  Tambi√©n tenemos marcadores en la cubierta superior, sus n√∫meros se resaltan por separado; </li><li>  <b>static_markers_ids</b> : marcadores que se buscan durante el proceso de calibraci√≥n; </li><li>  <b>posici√≥n de marcadores</b> : un diccionario con el desplazamiento y la rotaci√≥n de cada marcador en relaci√≥n con el centro del robot; </li><li>  no se puede tocar el <b>umbral de brillo</b> : esto se usa en la calibraci√≥n autom√°tica inicial de la luz; </li><li>  <b>camera_position_yellow</b> y un par√°metro similar sirven como configuraciones predeterminadas en caso de que <b>falle la</b> calibraci√≥n. </li></ul><br>  La matriz de transformaci√≥n del sistema de coordenadas de la c√°mara al sistema de coordenadas del campo est√° en el archivo transform_from_cam_to_map.xml <br><br>  Despu√©s de todas las configuraciones, finalmente necesita ejecutarlo.  Las rutas al archivo con los par√°metros, el lado predeterminado y la ruta al dispositivo de video se establecen en aruco_detector_debug.launch, que iniciaremos.  Pero para un lanzamiento completo es mejor usar el script bash aruco.bash, que, adem√°s del detector, inicia la interfaz gr√°fica de usuario (127.0.0.1‚ñ∫000).  Aqu√≠ podemos elegir el lado, comenzar la calibraci√≥n y controlar el sistema.  En la segunda ventana, las zonas de inter√©s y los marcadores encontrados son visibles. <br><br><img src="https://habrastorage.org/webt/qe/ch/qf/qechqfeowcgq9xevhj8fplpmjqc.gif"><br><br>  Ahora en los temas: "/ enemy_robot1 / aruco", "/ enemy_robot2 / aruco", "/ big_robot / aruco", "/ small_robot / aruco" se publicar√° la posici√≥n de los robots encontrados. <br><br>  ¬°Hurra!  Pudimos obtener las coordenadas de los robots.  Eso es justo, como puedes ver, est√°n equivocados.  Esto se debe a que antes de usarlo es necesario calibrar la posici√≥n de la c√°mara con respecto al campo.  Para esto es necesario <br><br><ul><li>  establecer los cubos en las esquinas del campo, mientras que es importante que est√©n girados por los lados especificados en la configuraci√≥n </li><li>  ajustar la inclinaci√≥n de la c√°mara para que todo el espacio requerido caiga en el marco </li><li>  ajustar el brillo de la luz de fondo hasta una detecci√≥n confiable </li><li>  en gui, seleccione el lado deseado y haga clic en "calibrar" </li><li>  entonces el estado de "buscar cubos est√°ticos" deber√≠a cambiar a "buscar cubos" </li></ul><br><h2>  Hacemos marcadores y TsUS </h2><br>  De acuerdo con las reglas, podemos colorear nuestros robots como queramos y, adem√°s, usar un lugar especial en nuestros robots y en los de otras personas, en el que puede colocar algo de hasta 10x10x8cm de tama√±o.  Un lugar especial se encuentra en la cubierta del robot, tiene una altura fija y una mejor visibilidad para el centro de control central, excepto cuando el robot est√° debajo de la c√°mara. <br><br><img src="https://habrastorage.org/webt/mm/_a/zu/mm_azulfvnfcqxm869zluovaq9e.png"><br>  <i>Altura y dimensiones de los faros del robot.</i> <br><br>  Por lo tanto, como los principales marcadores de nuestros robots, utilizamos paralelep√≠pedos de 10x10x108cm pegados en 4 lados del aruco, as√≠ como marcadores adicionales en la parte superior de nuestros robots para su localizaci√≥n en un √°rea compleja debajo de la c√°mara. <br><br>  Como no podemos pegar nada a la tapa del enemigo, decidimos hacer marcadores en forma de pir√°mide truncada para ampliar el rango de visibilidad.  Y como puede ver, el marcador se ha vuelto mucho mejor visible. <br><br><img src="https://habrastorage.org/webt/9_/xo/re/9_xoreh7phv_pp5ci_u7utyw5cm.png"><br><br>  Imprimimos la base para el cubo \ pir√°mide en una impresora 3D para que sea lo suficientemente fuerte y tenga un montaje conveniente y confiable. <br><br><img src="https://habrastorage.org/webt/r9/-l/ek/r9-lekwcd5xkzs_lys0hkrkjw4m.png"><br><br>  <a href="https://yadi.sk/d/swUJUwxTnTVYFw">Aqu√≠</a> se encuentran modelos para imprimir un cubo, una pir√°mide y una montura de acoplamiento <a href="https://yadi.sk/d/swUJUwxTnTVYFw">.</a> <br><br>  Este cubo est√° pegado con un reflector (usamos blanco AVERY <br>  DENNISON V6700B de 50 mm de ancho, aunque es m√°s caro, funciona muchas veces mejor que el chino barato), y los marcadores en s√≠ est√°n pegados encima.  La forma m√°s f√°cil de hacer esto es cortar los marcadores en el plotter, aunque puede cortarlos de papel o pel√≠cula en un par de horas de pacificaci√≥n (un conjunto consta de 16 marcadores). <br><br>  <a href="https://yadi.sk/d/0E5ajh4pumiahA">Aqu√≠ est√°</a> nuestro kit del a√±o pasado. <br><br><img src="https://habrastorage.org/webt/2h/1b/9w/2h1b9wwkizem2k9ptbwmwc64spm.png"><br>  <i>varias "generaciones" de nuestros marcadores</i> <br><br>  Tambi√©n se pueden usar como marcadores est√°ticos para la calibraci√≥n.  Para hacer esto, col√≥quelos en las esquinas lejanas del campo y haga clic en calibrar. <br><br><h3>  Montaje de un dispositivo de seguimiento central </h3><br><h4>  Lo que se necesita: </h4><br>  <b>Computadora de placa √∫nica.</b>  Estos dibujos est√°n hechos para la ubicaci√≥n de Intel NUC, pero puede pensar en colocar en el caso, por ejemplo, odroid xu4 o raspberry pi4. <br><br>  <b>oCam</b> .  En realidad la c√°mara, por lo que todo va.  Cambiamos la lente est√°ndar a <a href="https://air-hobby.ru/katalog/product/2262-linza-runcam-rc25g-fpv-lens-25mm-fov140-wide-angle.html">2.5 mm</a> para un amplio √°ngulo de visi√≥n <br>  <b>Pantalla (wavehare 7inch HDMI LCD (B))</b> . Con su ayuda, se realizan la calibraci√≥n y otras operaciones. <br><br>  <b>Tira de LED.</b>  Se utiliza para iluminar la superficie reflectante de los marcadores.  Es mejor usar el m√°s brillante disponible. <br><br>  <b>Bater√≠a 16.8v LiPo.</b>  Usamos 4s5200mAh.  Estas son las mismas bater√≠as que en el robot, ya que es conveniente y dura mucho tiempo. <br><br>  <b>Convertidor CC-CC reductor.</b>  Para alimentar la tira de LED.  Nuc y el enrutador se alimentan directamente de la bater√≠a, porque todos los arneses de alimentaci√≥n ya est√°n en ellos. <br><br>  Piezas impresas  Esto, en particular, un soporte para c√°mara, una pantalla y esquinas para ensamblar la carcasa: <a href="https://yadi.sk/d/swUJUwxTnTVYFw">https://yadi.sk/d/swUJUwxTnTVYFw</a> <br><br>  <b>Detalles de la vivienda.</b>  En nuestro caso, era una l√°mina de carbono de 2 mm.  Pero esta no es la mejor opci√≥n, ya que es conductora de carbono, dif√≠cil de procesar y no tan liviana como, por ejemplo, el plexigl√°s, quiz√°s la opci√≥n m√°s simple.  Aunque mucho m√°s duro.  Encuentra el enlace de arriba. <br><br>  <b>Router (Zyxel keenetic extra).</b>  Tuvimos que sacarlo de la caja para que se ajustara a su tama√±o y peso.  Pero en el caso general, no recomendamos esto. <br>  Muchas peque√±as cosas.  Tornillos M3 * 8 ~ 40 piezas, bastidores para placas de circuito impreso 3x10 ~ 12 piezas, cables, destornilladores, wago, etc. <br><br><h4>  Asamblea </h4><br>  Primero debes preparar las esquinas impresas, presionando las tuercas en ellas.  Es posible que haya pocos ajustes a presi√≥n y que tengan que estar ligeramente pegados o usar <a href="http://www.dart.moscow/index.php%3Fproductcode%3D160923">tuercas fundidas</a> <br>  A continuaci√≥n, debe instalar esta parte en la base.  Proporciona un posicionamiento claro del centro de control central en su lugar. <br><br><img src="https://habrastorage.org/webt/cv/0u/vr/cv0uvrzekp09qx2typzni7gzmm4.png"><br><br>  Ahora ensamblamos el soporte de la c√°mara, insertamos oCam all√≠, pegamos la luz de fondo de la tira de LED lo m√°s cerca posible de la lente y sujetamos el m√≥dulo a la base. <br><br><img src="https://habrastorage.org/webt/x8/c5/sz/x8c5szf7llbkchzglqbbrz22yas.png"><br><br><img src="https://habrastorage.org/webt/k1/oj/w5/k1ojw5cbuwtnireb0axfynlffrk.png"><br><br>  Despu√©s de eso, puede instalar todas las paredes laterales, fij√°ndolas en las esquinas descritas anteriormente.  Es mejor contrarrestar los agujeros para ellos. <br><br><img src="https://habrastorage.org/webt/ne/mo/v0/nemov0qtrzitlompmpymxhm9npw.png"><br><br>  Ponemos una computadora de placa √∫nica y un enrutador.  En nuestro caso, estos son NUC y Zyxel keenetic extra. <br><br><img src="https://habrastorage.org/webt/7l/vc/85/7lvc85rwy0gzifdg9w7a9-n0k8a.png"><br><br><img src="https://habrastorage.org/webt/er/t9/8t/ert98t1wicsogrkpabregc60o2e.png"><br><br><img src="https://habrastorage.org/webt/7y/hk/rc/7yhkrcmukr6oyrgqqyeoiwwz_io.png"><br>  <i>Y obtenemos el sistema de seguimiento ensamblado.</i>  <i>Solo queda ajustar la inclinaci√≥n de la c√°mara.</i> <br><br><img src="https://habrastorage.org/webt/zm/lp/zr/zmlpzrgcfrd68o_xnoaw69sdgeg.png"><br>  <i>depuraci√≥n de localizaci√≥n en 2018</i> <br><br><h3>  Cual es el resultado </h3><br>  Entonces contamos todos los secretos que nos permiten repetir nuestro sistema con nuestras propias manos.  Utiliz√°ndolo, puede hacer r√°pidamente y sin alteraciones su sistema para localizar el robot en el campo Eurobot.  Y con alteraciones m√≠nimas, haga un sistema de seguimiento bastante universal y confiable para algo.  Sin embargo, vale la pena considerar que cuando se usa aruco 8x8, un tama√±o de marcador de 10x8cm y una c√°mara en 1Mpx, no es particularmente posible aumentar el radio de detecci√≥n, sin embargo, si tenemos limitaciones estrictas en tama√±o y rendimiento, en general solo usamos equipos m√°s interesantes. <br><br>  Este a√±o, las reglas mencionaron el uso de aruco 4x4, as√≠ como sus rangos no intersectantes para cada lado del campo.  En el futuro cercano, planeamos integrar esto en nuestra soluci√≥n para que en el futuro no tengamos miedo de la intersecci√≥n de los n√∫meros de marcador.  Otra herramienta imprescindible, pero lo que a√∫n no se ha hecho es la calibraci√≥n manual en el campo. <br>  En el pr√≥ximo art√≠culo, hablaremos sobre el nivel inferior de los robots, c√≥mo se considera la cinem√°tica de los robots, c√≥mo controlamos servidores, motores y conos cuando trabajamos con freertos. <br><br>  Quiero decir gracias: <br><br>  <a href="https://github.com/alexpostnikov/aruco-gui">Alexey Postnikov</a> (en cuyo nombre probablemente vali√≥ la pena publicarlo todo), por lo general, para todo el c√≥digo de este art√≠culo y directamente ayuda para escribir el art√≠culo. <br>  <a href="https://habr.com/ru/users/eppy/">Egor Alexandrov</a> : para todos los dibujos y modelos, asistencia para escribir el art√≠culo y 34 comas. <br>  <a href="https://habr.com/ru/users/toma_sin/">Tamara Sinelnikova</a> : por ayuda para escribir el art√≠culo. <br><br>  ¬°Y el resto del equipo! <br><br>  Quedan menos de 4 meses antes del inicio de la competencia, pero el equipo Sberbank Eurobot a√∫n est√° abierto a nuevos participantes.  Nuestro telegrama: <a href="https://t.me/SetUpSber">https://t.me/SetUpSber</a> <br><br>  Art√≠culos anteriores: <br><br>  <a href="https://habr.com/ru/post/478836/">Lo que es com√∫n entre un rev√≥lver, lavadoras y un robot aut√≥nomo.</a> <br>  <a href="https://habr.com/ru/post/479636/">Propia pila de navegaci√≥n.</a>  <a href="https://habr.com/ru/post/479636/">¬øMejor que ROS?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/482220/">https://habr.com/ru/post/482220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../482208/index.html">Regalos que te hacen perder A√±o Nuevo</a></li>
<li><a href="../482210/index.html">Bot para Tetris y animaci√≥n de ingenier√≠a inversa. An√°lisis de la pista m√≥vil del segundo campeonato de programaci√≥n.</a></li>
<li><a href="../482212/index.html">Hablar de ... queso?</a></li>
<li><a href="../482216/index.html">23 respuestas a la depresi√≥n de un psiquiatra profesional Maxim Malyavin (dpmmax)</a></li>
<li><a href="../482218/index.html">Java Digest para el 27 de diciembre</a></li>
<li><a href="../482222/index.html">Aplicaci√≥n web en Kotlin + Spring Boot + Vue.js (complemento)</a></li>
<li><a href="../482224/index.html">Cuando un dise√±ador necesita ser un peque√±o programador</a></li>
<li><a href="../482226/index.html">Las 20 mejores aplicaciones que un proveedor de atenci√≥n m√©dica no puede perderse</a></li>
<li><a href="../482228/index.html">Escribimos una "calculadora" en C #. Parte I. C√°lculo del valor, derivada, simplificaci√≥n y otros gansos.</a></li>
<li><a href="../482230/index.html">La batalla de los servidores WEB. Parte 2: escenario realista de HTTPS:</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>