<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥌 🌿 🌏 Localización de marcador de Aruco 👨 ◼️ 🤸🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la última publicación, hablamos sobre cómo llegar del punto A al punto B sin golpear nada. Pero para dar la vuelta a algo, debe comprender dónde es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Localización de marcador de Aruco</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482220/">  <a href="https://habr.com/ru/post/479636/">En la última publicación,</a> hablamos sobre cómo llegar del punto A al punto B sin golpear nada.  Pero para dar la vuelta a algo, debe comprender dónde estamos y dónde hay obstáculos dinámicos (nuestros oponentes y no solo). <br><br>  Una persona tiene ojos, oídos y software establecidos por la naturaleza y la experiencia personal para que pueda moverse y navegar fácilmente en el espacio.  El sistema de localización es casi el ojo y el oído para los robots.  Es necesario para que el robot pueda navegar en el espacio y, ajustándose al entorno, moverse en él. <br><br>  Hoy hablaremos sobre cómo resolvimos el problema de determinar la posición de los robots en el campo Eurobot, cómo hacer todo esto, lanzarlo y configurarlo usted mismo. <br><br><img src="https://habrastorage.org/webt/wd/ob/7l/wdob7lxsj1x5z0ubs94tyz5hf08.png"><br><a name="habracut"></a><br><h2>  Condiciones objetivo del sistema de localización </h2><br>  Uno de los principios de Eurobot Open es la autonomía.  Autonomía de todo lo que está detrás del campo de juego.  Todos los cálculos, la toma de decisiones y la localización deben hacerse en \ en robots o en sitios especiales en el campo. <br><br>  El tamaño del campo es de 2x3 metros, y el error en el tamaño y la posición de los elementos de un campo a otro suele ser de 3-5 mm. <br><br>  En la imagen a continuación hay un diagrama del campo Eurobot 2019 con zonas marcadas en las que podemos colocar algo más que robots. <br><br><img src="https://habrastorage.org/webt/ed/sn/nr/edsnnr36r2ksmv9sr7pzjz1khhk.png"><br><br><ul><li>  6 - Zona de experimento (una de las tareas adicionales) </li><li>  10 - Zonas del faro </li><li>  11 - Una torre especial para instalar un dispositivo de seguimiento central (en lo sucesivo, el CCC).  Ubicado sobre el campo a una altura de 1 metro </li><li>  También en los robots mismos podemos instalar balizas. </li></ul><br>  Para todas estas áreas y las dimensiones de los robots en sí, existen restricciones estrictas de peso y tamaño, por lo que es imposible hacer un gran supermódulo productivo en el que todo encaje.  Y también hay un límite de 3 minutos para la preparación para el lanzamiento.  Durante este tiempo, una o dos personas del equipo deben sacar los robots y todo lo relacionado con ellos, organizarlos, configurarlos y prepararse para el lanzamiento.  Obviamente, cuanto menos basura necesites configurar y ajustar, menos probabilidades tendrás de cometer un error o ser multado antes del comienzo de la batalla. <br><br><img src="https://habrastorage.org/webt/73/ic/e7/73ice79-lmosmu6rt-gi5gdz744.jpeg"><br>  <i>y otro segundo cuadro completo</i> <br><br><h3>  Analizamos opciones </h3><br>  Con la conciencia de nuestras capacidades y el deseo de obtener una precisión de posicionamiento de al menos unos pocos milímetros, veamos qué podemos usar en general para resolver este problema: <br><br><ul><li>  <b>La odometría de las ruedas</b> con codificadores ubicados directamente en el variador o ruedas de medición adicionales le permite leer la distancia recorrida por el robot y determinar su posición en relación con el punto de partida.  Muchos equipos de Eurobot lo usan como su método de localización principal.  Esta es una de las fuentes más rápidas de información de movimiento para el robot.  Sin embargo, en la práctica, especialmente cuando se conduce en omni-ruedas (un área de contacto más pequeña que las ruedas clásicas, el juego de rodillos y los errores de fabricación más grandes), la odometría es susceptible al problema de acumulación de errores, que debe corregirse de alguna manera.  Puede alinearse con la superficie con coordenadas conocidas, o puede formar complejos con un sistema adicional.  Además, si usa codificadores en las ruedas motrices, existe el problema del deslizamiento de las ruedas durante maniobras bruscas y en colisiones del robot.  Las ruedas de medición pueden eliminar este problema, pero son difíciles de colocar en un robot pequeño. <br><br><img src="https://habrastorage.org/webt/v0/8u/bd/v08ubdzodh5zpr8kr7ee3fhbo5y.png"><br>  <i>Rueda omnidireccional de medición propia con suspensión independiente y con codificador magnético, que utilizamos en 2018</i> <br></li><li>  <b>Los lidares</b> tienen ventajas significativas: obtenemos una vista casi circular y distancias a los obstáculos.  De los inconvenientes, vale la pena señalar el alto precio, la dificultad para tratar de distinguir pequeños objetos distantes de la basura y un algoritmo de localización relativamente complicado.  Los lidares baratos (como rplidar) tienen una frecuencia de actualización y una resolución angular bastante bajas, y también están sujetos a la luz de otros lidars, telémetros, etc. Las reglas de elevación para los sistemas de localización tienen pocos objetos estáticos para el enlace.  Sin embargo, el equipo de Skoltech ha estado patinando con éxito durante varios años utilizando el hokuyo ust-10lx y el año pasado obtuvo el segundo lugar en la final europea de la competencia Eurobot en Francia. </li><li>  También consideramos <b>sistemas inerciales</b> , pero en nuestro caso no encajaban bien.  El acelerómetro hace ruido, el giroscopio está flotando, puede olvidarse de usar la brújula en interiores.  Incluso el uso de un filtro Kalman no logra la precisión deseada.  Resulta que la IMU solo se puede usar de manera efectiva para la corrección en un período de tiempo muy corto.  El máximo de información útil que pudimos obtener con pixhawk2 es el ángulo durante un giro brusco (por ejemplo, de una colisión). </li><li>  <b>El GPS</b> no funciona en interiores, y la precisión sin RTK es metros. </li><li>  <b>Localización ultrasónica</b> .  Una de las implementaciones se puede encontrar aquí: <a href="https://m.habr.com/ru/post/451408/">m.habr.com/en/post/451408</a> .  Por desgracia, la precisión de nuestras tareas no es muy alta (+ -2 cm), la diafonía afecta fuertemente o, si utiliza sensores con protección contra esto, se obtiene una baja frecuencia de sondeo.  Uno de los equipos en Rusia usa esta solución con un éxito variable, y el equipo alemán Turag utiliza con bastante éxito una tecnología similar desarrollada dentro del laboratorio. </li><li>  <b>La odometría visual</b> no proporciona información sobre la posición de los oponentes debido al hecho de que no hay muchos puntos en el campo a los que sea posible aferrarse de manera confiable. </li><li>  <b>\ Las cámaras estéreo</b> tienen un ángulo estrecho, que no permite cubrir el campo cuando se encuentra en el dispositivo de seguimiento central, ni obtener una vista circular o al menos aceptable cuando se instala en un robot. </li><li>  <b>Los marcadores fiduciarios</b> que hemos elegido y que examinaremos con más detalle. </li></ul><br><h3>  Marcadores fiduciarios </h3><br>  La navegación por marcadores ha existido durante mucho tiempo.  Teóricamente, el llamado marcador puede ser cualquier objeto.  Pero hay muchos problemas al usar: <br><br><ul><li>  restricciones debido a la resolución de la cámara; </li><li>  falta de fiabilidad de detección cuando se utiliza el color como fuente principal de información; </li><li>  la necesidad de determinar la orientación del marcador; </li><li>  las marcas de bajo contraste funcionan bien solo con buena luz; </li><li>  Se requiere un alto poder de procesamiento del equipo (procesamiento en tiempo real de las tramas entrantes). </li></ul><br>  Para sortear los problemas anteriores, generalmente debe usar algo simple e inequívoco para el reconocimiento, por ejemplo, un círculo de color o un cuadrado (y me gustaría un pato amarillo). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/636/59e/f61/63659ef613cf69454b7b3b9d788d934e.png" alt="imagen"><br>  <i>diferentes tipos de marcadores</i> <br><br>  De hecho, además de determinar la posición de un marcador, a menudo es necesario determinar su singularidad, por ejemplo, para detectar varios objetos a la vez.  Para hacer esto, puede cambiar el color o la forma, pero luego nos enfrentaremos rápidamente a una disminución en la confiabilidad de la detección. <br>  Este problema es bastante común y hay muchos estándares de marcadores.  El más famoso de ellos es el código qr, pero rara vez se usa para problemas de localización debido a la redundancia y la necesidad de alta resolución.  Como regla general, todos los marcadores son bicolores (la mayoría de las veces b / w), de forma simple (la mayoría de las veces un cuadrado) y de alguna manera codifican el identificador en sí mismos.  Los marcadores más famosos para la localización son Aruco, April Tag, ARToolKit. <br><br>  Cualquier persona interesada en aprender más sobre ellos es un <a href="https://www.researchgate.net/publication/303752217_An_evaluation_of_artificial_fiducial_markers_in_underwater_environments">artículo</a> interesante que también compara la fiabilidad de su detección. <br><br><div class="spoiler">  <b class="spoiler_title">Marcadores fractales</b> <div class="spoiler_text">  Hay momentos en los que necesitamos detectar un objeto tanto desde lejos como en blanco.  Usar varios marcadores de diferentes tamaños es una forma, pero puede hacerlo de manera más astuta y usar marcadores "fractales", cuyas diferentes partes funcionan a diferentes escalas de la imagen. <br><br>  <a href="https://docs.google.com/document/u/1/d/1SdsOTjGdu5o8gy2Ot2FDqYDS9ALgyhOBJcJHOZBR7B4/mobilebasic">docs.google.com/document/u/1/d/1SdsOTjGdu5o8gy2Ot2FDqYDS9ALgyhOBJcJHOZBR7B4/mobilebasic</a> <br></div></div><br>  En nuestro caso, tenemos muchos aspectos positivos del uso de marcadores: <br><br><ul><li>  con la posibilidad de instalar una cámara estática con un buen ángulo de visión y marcado, esto no requiere un equipo difícil de encontrar y potencialmente no es muy difícil de implementar; </li><li>  la cámara remota puede evaluar la posición de todos los objetos en los que podemos colocar marcadores; </li><li>  los cálculos se llevan a cabo no en el dispositivo de a bordo del robot, sino en una computadora separada (pero existe un problema de confiabilidad y demoras en la transferencia de datos); </li><li>  La capacidad de resolver cualquier otro problema asociado con la visión. </li></ul><br>  Después de analizar los sistemas anteriores, nos decidimos por la detección de marcadores.  Esto nos permitió no solo liberar nuestros odroides en robots, sino también permitirles ver toda la situación en el campo desde una vista de pájaro. <br><br><h3>  ¿Cómo funciona fuera de la caja? </h3><br>  La "fiabilidad" de la detección de marcadores es un término relativo.  Diferentes tareas requieren diferentes niveles de precisión y estabilidad.  La inclusión de estos parámetros depende del sensor de video, lentes, condiciones de iluminación, etc. <br><br><img src="https://habrastorage.org/webt/yi/xs/5m/yixs5m5g6pv5xya8axbd-zqov-4.png"><br>  En nuestro caso, con un tamaño de campo de 2x3 metros y una cámara a solo un metro por encima, es necesario utilizar una óptica de gran angular con un campo de visión de al menos 120-140 grados para garantizar la visibilidad de todo el espacio de juego, lo que afecta negativamente la detección (y su precisión) de pequeños marcadores en el extremo esquina del campo de juego, y bajo condiciones arbitrarias de iluminación hacen que esta tarea sea aún más difícil. <br>  Como ha demostrado la práctica, incluso en condiciones normales, completamente naturales, iluminadas, pueden ocurrir definiciones erróneas de la posición del marcador. <br><br><img src="https://habrastorage.org/webt/km/-n/cl/km-nclpq-m4g3jcgvwxls4eixb0.png"><br><br>  Por lo tanto, las siguientes imágenes muestran dos cuadros consecutivos con resultados de detección de marcadores: la dirección del eje Z (azul) cambia 180 grados. <br><br><img src="https://habrastorage.org/webt/sd/a5/ha/sda5haouwemxqiobswwckpb8dhw.png"><br><br><img src="https://habrastorage.org/webt/tu/gj/ii/tugjiiiol9ts2m4laiexh7nwnue.png"><br>  <i><a href="https://www.youtube.com/watch%3Fv%3DxzG2jQfxLlY">www.youtube.com/watch?v=xzG2jQfxLlY</a></i> <br><br><h3>  Llevar a un estado competitivo </h3><br><h4>  Cambiar el algoritmo </h4><br>  Para determinar con precisión la ubicación del robot en el campo, debe conocer la posición angular de la cámara, la transformación general del sistema de coordenadas y la posición de la cámara en relación con la posición del campo.  Para hacer esta conversión, desarrollamos nuestro propio algoritmo.  Dado que una persona cuelga el centro de control central manualmente, además de que los campos son ligeramente diferentes entre sí, entonces no es posible obtener siempre la misma posición de cámara.  El desplazamiento angular de la cámara con respecto al campo tiene un efecto muy negativo en la detección de la posición de los robots.  La solución fundamental es determinar varios marcadores estáticos que podemos establecer antes del partido para la calibración. <br><br>  La biblioteca Aruco en opencv proporciona la capacidad de determinar la posición del marcador 6dof en relación con la cámara.  Al principio intentamos usarlo, pero resultó muy inestable e inexacto.  En nuestro caso, cuando se conoce la posición de la cámara, está fija, y los robots (y los marcadores asociados) se mueven en un plano que no pasa por el punto de fijación de la cámara, es racional limitarnos a la tarea de detectar la posición 3dof (z-const, x-y, + rotación alrededor un eje z) a través de la triangulación de un punto en un plano en un ángulo visible. <br><br>  Se espera que una disminución en la dimensión y un aumento en la base de la triangulación (el tamaño del marcador versus la distancia desde el plano de los marcadores a la cámara) del problema a resolver reduzca el nivel de incertidumbre y ruido de los resultados de la detección. <br>  Para hacer esto, en lugar de la función estándar <br><br><pre><code class="cpp hljs">cv::aruco::estimatePoseSingleMarkers(markerCorners, <span class="hljs-number"><span class="hljs-number">0.05</span></span>, cameraMatrix, distCoeffs, rvecs, tvecs);</code> </pre> <br><br>  que, en base a las esquinas encontradas de los marcadores, determina la posición 6dof del marcador, escribimos nuestro estimador de posición, trabajando de acuerdo con los siguientes principios: <br><br><ul><li>  La posición de la cámara 3D se conoce de antemano; </li><li>  la altura del marcador se conoce de antemano; </li><li>  Como resultado de la detección, se conocen píxeles (v, u) de 4 esquinas del marcador; </li><li>  Como resultado de la calibración de la cámara, se define una matriz de cámara 4x4; </li><li>  conociendo la 'matriz de cámara', la posición y orientación de la cámara, la posición de los ángulos de píxeles del marcador, puede obtener la proyección de la posición de los ángulos en el espacio 3D en el plano z en el que se ubican los vértices del marcador (la altura del marcador está determinada por su número); </li><li>  haciendo el paso anterior para las 4 esquinas del marcador y promediando los datos obtenidos, es posible obtener coordenadas 3D de los vértices del marcador en el sistema de coordenadas de la cámara; </li><li>  aplicando la transformación de la cámara SK al SK del campo de juego, se obtienen las coordenadas del marcador en el campo SK. </li></ul><br><h4>  Resolver problemas de iluminación y rendimiento </h4><br>  La estabilidad y la velocidad de detección de los marcadores dependen en gran medida de las condiciones de iluminación ambiental y de la estructura de fondo; cuantos más objetos diferentes haya en el marco, más tiempo llevará el procesamiento.  Dado que las reglas de iluminación y fondo de Eurobot no están reguladas de ninguna manera, pueden cambiar mucho de vez en cuando, puede haber otros campos, personas en segundo plano.  En particular, se pueden esperar exposiciones adicionales de robots enemigos, flashes de cámara o focos que caen en el campo de visión de la cámara. <br><br>  Para reducir la influencia de la iluminación ambiental en la estabilidad de la detección de marcadores, se desarrolló un "diseño" especial en el que se utilizaron marcadores de aruco invertidos.  La parte oscura se reemplaza por una película retrorreflectante y se instala una luz de fondo LED activa directamente en la cámara.  El procesamiento de imágenes se realiza en negativo, mientras que el contraste del fondo es mucho menor que el contraste de sus propios marcadores. <br><br>  Aumentar el contraste del marcador le permite seleccionar efectivamente regiones de interés en el marco y buscar marcadores solo en ellos, y no en todo el marco, lo que mejora enormemente la productividad. <br><br><img src="https://habrastorage.org/webt/fz/p0/4n/fzp04n01ugkpz4b8yuqrasmv2qy.png"><br>  <i>Comparación de las diferencias de contraste entre un marcador estándar y un marcador con una superficie reflectante</i> <br><br><h3>  Seleccionamos hierro </h3><br>  Dado que las condiciones de iluminación no están definidas, y la velocidad de los robots puede ser bastante grande, desde el principio estábamos buscando una cámara con un obturador global, y no con un obturador enrollable.  La diferencia es que el global recopila información sobre el brillo de los píxeles al mismo tiempo y se desplaza línea por línea, por lo que puede haber distorsiones en la forma geométrica de los objetos en movimiento. <br>  La cámara más económica es oCam-1mgn, que utilizamos durante 2 años.  Sin embargo, es en blanco y negro y tiene una resolución de solo 1Mpx, que se encuentra en el borde inferior de una resolución aceptable (el número de píxeles en la imagen, por 1 "píxel" del marcador). <br>  Inicialmente, el detector se consideraba en la misma placa única que los robots mismos: odroid xu4, y la velocidad de trabajo era de aproximadamente 20 fps, sin embargo, el deseo de colgar funcionalidades adicionales en el centro de control central y comprender que se necesitaba una mejor cámara llevó a reemplazar la PC con un Intel más vigoroso. Nuc, y la cámara ... la cámara que todavía estamos recogiendo para la nueva temporada. <br><br><h3>  Comenzamos el proyecto </h3><br>  Se supone además que ya tiene configurado ROS Kinetic o Melodic. <br><br>  Lo primero que debe hacer es descargar e instalar OpenCV 3, Eigen3 y el proyecto <a href="https://bitbucket.org/eurobot1718/ocam_usb_cam">https://bitbucket.org/eurobot1718/ocam_usb_cam</a> (para la cámara Ocam), o usar otro proyecto que tenga una estructura similar a la publicación de datos en los temas. <br><br>  Clonamos el repositorio con el proyecto de detector arude: <a href="https://gitlab.com/eurobot2019/aruco_detector">https://gitlab.com/eurobot2019/aruco_detector</a> y gui para ello <a href="https://github.com/alexpostnikov/aruco-gui">https://github.com/alexpostnikov/aruco-gui</a> <br>  Después de instalar los proyectos, debe calibrar la cámara y obtener la matriz de dispersión y la matriz de distorsión de la cámara, y luego envolver todo en el archivo yaml "camera_params.yml".  Un ejemplo simple es el uso de un tablero de ajedrez.  <a href="https://github.com/sourishg/fisheye-stereo-calibration">Enlace</a> a la implementación en C ++, donde solo necesita recopilar y especificar los parámetros de la placa y la cámara, así como el nombre del archivo de salida. <br><br>  La configuración principal está en el archivo aruco_detector_params.yml: <br><br><ul><li>  <b>len_of_cube_markers</b> y <b>width_marker la</b> longitud y el ancho de los marcadores en metros; </li><li>  <b>markers_height</b> : comparación del marcador y su altura; </li><li>  <b>marcadores</b> : una matriz que describe si un marcador particular pertenece a un robot específico.  Indica los marcadores en sentido horario.  Y en el caso de los oponentes, dado que su dirección no es importante para nosotros, el orden de los marcadores en la configuración tampoco es importante.  Solo necesita especificar el código del marcador.  También tenemos marcadores en la cubierta superior, sus números se resaltan por separado; </li><li>  <b>static_markers_ids</b> : marcadores que se buscan durante el proceso de calibración; </li><li>  <b>posición de marcadores</b> : un diccionario con el desplazamiento y la rotación de cada marcador en relación con el centro del robot; </li><li>  no se puede tocar el <b>umbral de brillo</b> : esto se usa en la calibración automática inicial de la luz; </li><li>  <b>camera_position_yellow</b> y un parámetro similar sirven como configuraciones predeterminadas en caso de que <b>falle la</b> calibración. </li></ul><br>  La matriz de transformación del sistema de coordenadas de la cámara al sistema de coordenadas del campo está en el archivo transform_from_cam_to_map.xml <br><br>  Después de todas las configuraciones, finalmente necesita ejecutarlo.  Las rutas al archivo con los parámetros, el lado predeterminado y la ruta al dispositivo de video se establecen en aruco_detector_debug.launch, que iniciaremos.  Pero para un lanzamiento completo es mejor usar el script bash aruco.bash, que, además del detector, inicia la interfaz gráfica de usuario (127.0.0.1►000).  Aquí podemos elegir el lado, comenzar la calibración y controlar el sistema.  En la segunda ventana, las zonas de interés y los marcadores encontrados son visibles. <br><br><img src="https://habrastorage.org/webt/qe/ch/qf/qechqfeowcgq9xevhj8fplpmjqc.gif"><br><br>  Ahora en los temas: "/ enemy_robot1 / aruco", "/ enemy_robot2 / aruco", "/ big_robot / aruco", "/ small_robot / aruco" se publicará la posición de los robots encontrados. <br><br>  ¡Hurra!  Pudimos obtener las coordenadas de los robots.  Eso es justo, como puedes ver, están equivocados.  Esto se debe a que antes de usarlo es necesario calibrar la posición de la cámara con respecto al campo.  Para esto es necesario <br><br><ul><li>  establecer los cubos en las esquinas del campo, mientras que es importante que estén girados por los lados especificados en la configuración </li><li>  ajustar la inclinación de la cámara para que todo el espacio requerido caiga en el marco </li><li>  ajustar el brillo de la luz de fondo hasta una detección confiable </li><li>  en gui, seleccione el lado deseado y haga clic en "calibrar" </li><li>  entonces el estado de "buscar cubos estáticos" debería cambiar a "buscar cubos" </li></ul><br><h2>  Hacemos marcadores y TsUS </h2><br>  De acuerdo con las reglas, podemos colorear nuestros robots como queramos y, además, usar un lugar especial en nuestros robots y en los de otras personas, en el que puede colocar algo de hasta 10x10x8cm de tamaño.  Un lugar especial se encuentra en la cubierta del robot, tiene una altura fija y una mejor visibilidad para el centro de control central, excepto cuando el robot está debajo de la cámara. <br><br><img src="https://habrastorage.org/webt/mm/_a/zu/mm_azulfvnfcqxm869zluovaq9e.png"><br>  <i>Altura y dimensiones de los faros del robot.</i> <br><br>  Por lo tanto, como los principales marcadores de nuestros robots, utilizamos paralelepípedos de 10x10x108cm pegados en 4 lados del aruco, así como marcadores adicionales en la parte superior de nuestros robots para su localización en un área compleja debajo de la cámara. <br><br>  Como no podemos pegar nada a la tapa del enemigo, decidimos hacer marcadores en forma de pirámide truncada para ampliar el rango de visibilidad.  Y como puede ver, el marcador se ha vuelto mucho mejor visible. <br><br><img src="https://habrastorage.org/webt/9_/xo/re/9_xoreh7phv_pp5ci_u7utyw5cm.png"><br><br>  Imprimimos la base para el cubo \ pirámide en una impresora 3D para que sea lo suficientemente fuerte y tenga un montaje conveniente y confiable. <br><br><img src="https://habrastorage.org/webt/r9/-l/ek/r9-lekwcd5xkzs_lys0hkrkjw4m.png"><br><br>  <a href="https://yadi.sk/d/swUJUwxTnTVYFw">Aquí</a> se encuentran modelos para imprimir un cubo, una pirámide y una montura de acoplamiento <a href="https://yadi.sk/d/swUJUwxTnTVYFw">.</a> <br><br>  Este cubo está pegado con un reflector (usamos blanco AVERY <br>  DENNISON V6700B de 50 mm de ancho, aunque es más caro, funciona muchas veces mejor que el chino barato), y los marcadores en sí están pegados encima.  La forma más fácil de hacer esto es cortar los marcadores en el plotter, aunque puede cortarlos de papel o película en un par de horas de pacificación (un conjunto consta de 16 marcadores). <br><br>  <a href="https://yadi.sk/d/0E5ajh4pumiahA">Aquí está</a> nuestro kit del año pasado. <br><br><img src="https://habrastorage.org/webt/2h/1b/9w/2h1b9wwkizem2k9ptbwmwc64spm.png"><br>  <i>varias "generaciones" de nuestros marcadores</i> <br><br>  También se pueden usar como marcadores estáticos para la calibración.  Para hacer esto, colóquelos en las esquinas lejanas del campo y haga clic en calibrar. <br><br><h3>  Montaje de un dispositivo de seguimiento central </h3><br><h4>  Lo que se necesita: </h4><br>  <b>Computadora de placa única.</b>  Estos dibujos están hechos para la ubicación de Intel NUC, pero puede pensar en colocar en el caso, por ejemplo, odroid xu4 o raspberry pi4. <br><br>  <b>oCam</b> .  En realidad la cámara, por lo que todo va.  Cambiamos la lente estándar a <a href="https://air-hobby.ru/katalog/product/2262-linza-runcam-rc25g-fpv-lens-25mm-fov140-wide-angle.html">2.5 mm</a> para un amplio ángulo de visión <br>  <b>Pantalla (wavehare 7inch HDMI LCD (B))</b> . Con su ayuda, se realizan la calibración y otras operaciones. <br><br>  <b>Tira de LED.</b>  Se utiliza para iluminar la superficie reflectante de los marcadores.  Es mejor usar el más brillante disponible. <br><br>  <b>Batería 16.8v LiPo.</b>  Usamos 4s5200mAh.  Estas son las mismas baterías que en el robot, ya que es conveniente y dura mucho tiempo. <br><br>  <b>Convertidor CC-CC reductor.</b>  Para alimentar la tira de LED.  Nuc y el enrutador se alimentan directamente de la batería, porque todos los arneses de alimentación ya están en ellos. <br><br>  Piezas impresas  Esto, en particular, un soporte para cámara, una pantalla y esquinas para ensamblar la carcasa: <a href="https://yadi.sk/d/swUJUwxTnTVYFw">https://yadi.sk/d/swUJUwxTnTVYFw</a> <br><br>  <b>Detalles de la vivienda.</b>  En nuestro caso, era una lámina de carbono de 2 mm.  Pero esta no es la mejor opción, ya que es conductora de carbono, difícil de procesar y no tan liviana como, por ejemplo, el plexiglás, quizás la opción más simple.  Aunque mucho más duro.  Encuentra el enlace de arriba. <br><br>  <b>Router (Zyxel keenetic extra).</b>  Tuvimos que sacarlo de la caja para que se ajustara a su tamaño y peso.  Pero en el caso general, no recomendamos esto. <br>  Muchas pequeñas cosas.  Tornillos M3 * 8 ~ 40 piezas, bastidores para placas de circuito impreso 3x10 ~ 12 piezas, cables, destornilladores, wago, etc. <br><br><h4>  Asamblea </h4><br>  Primero debes preparar las esquinas impresas, presionando las tuercas en ellas.  Es posible que haya pocos ajustes a presión y que tengan que estar ligeramente pegados o usar <a href="http://www.dart.moscow/index.php%3Fproductcode%3D160923">tuercas fundidas</a> <br>  A continuación, debe instalar esta parte en la base.  Proporciona un posicionamiento claro del centro de control central en su lugar. <br><br><img src="https://habrastorage.org/webt/cv/0u/vr/cv0uvrzekp09qx2typzni7gzmm4.png"><br><br>  Ahora ensamblamos el soporte de la cámara, insertamos oCam allí, pegamos la luz de fondo de la tira de LED lo más cerca posible de la lente y sujetamos el módulo a la base. <br><br><img src="https://habrastorage.org/webt/x8/c5/sz/x8c5szf7llbkchzglqbbrz22yas.png"><br><br><img src="https://habrastorage.org/webt/k1/oj/w5/k1ojw5cbuwtnireb0axfynlffrk.png"><br><br>  Después de eso, puede instalar todas las paredes laterales, fijándolas en las esquinas descritas anteriormente.  Es mejor contrarrestar los agujeros para ellos. <br><br><img src="https://habrastorage.org/webt/ne/mo/v0/nemov0qtrzitlompmpymxhm9npw.png"><br><br>  Ponemos una computadora de placa única y un enrutador.  En nuestro caso, estos son NUC y Zyxel keenetic extra. <br><br><img src="https://habrastorage.org/webt/7l/vc/85/7lvc85rwy0gzifdg9w7a9-n0k8a.png"><br><br><img src="https://habrastorage.org/webt/er/t9/8t/ert98t1wicsogrkpabregc60o2e.png"><br><br><img src="https://habrastorage.org/webt/7y/hk/rc/7yhkrcmukr6oyrgqqyeoiwwz_io.png"><br>  <i>Y obtenemos el sistema de seguimiento ensamblado.</i>  <i>Solo queda ajustar la inclinación de la cámara.</i> <br><br><img src="https://habrastorage.org/webt/zm/lp/zr/zmlpzrgcfrd68o_xnoaw69sdgeg.png"><br>  <i>depuración de localización en 2018</i> <br><br><h3>  Cual es el resultado </h3><br>  Entonces contamos todos los secretos que nos permiten repetir nuestro sistema con nuestras propias manos.  Utilizándolo, puede hacer rápidamente y sin alteraciones su sistema para localizar el robot en el campo Eurobot.  Y con alteraciones mínimas, haga un sistema de seguimiento bastante universal y confiable para algo.  Sin embargo, vale la pena considerar que cuando se usa aruco 8x8, un tamaño de marcador de 10x8cm y una cámara en 1Mpx, no es particularmente posible aumentar el radio de detección, sin embargo, si tenemos limitaciones estrictas en tamaño y rendimiento, en general solo usamos equipos más interesantes. <br><br>  Este año, las reglas mencionaron el uso de aruco 4x4, así como sus rangos no intersectantes para cada lado del campo.  En el futuro cercano, planeamos integrar esto en nuestra solución para que en el futuro no tengamos miedo de la intersección de los números de marcador.  Otra herramienta imprescindible, pero lo que aún no se ha hecho es la calibración manual en el campo. <br>  En el próximo artículo, hablaremos sobre el nivel inferior de los robots, cómo se considera la cinemática de los robots, cómo controlamos servidores, motores y conos cuando trabajamos con freertos. <br><br>  Quiero decir gracias: <br><br>  <a href="https://github.com/alexpostnikov/aruco-gui">Alexey Postnikov</a> (en cuyo nombre probablemente valió la pena publicarlo todo), por lo general, para todo el código de este artículo y directamente ayuda para escribir el artículo. <br>  <a href="https://habr.com/ru/users/eppy/">Egor Alexandrov</a> : para todos los dibujos y modelos, asistencia para escribir el artículo y 34 comas. <br>  <a href="https://habr.com/ru/users/toma_sin/">Tamara Sinelnikova</a> : por ayuda para escribir el artículo. <br><br>  ¡Y el resto del equipo! <br><br>  Quedan menos de 4 meses antes del inicio de la competencia, pero el equipo Sberbank Eurobot aún está abierto a nuevos participantes.  Nuestro telegrama: <a href="https://t.me/SetUpSber">https://t.me/SetUpSber</a> <br><br>  Artículos anteriores: <br><br>  <a href="https://habr.com/ru/post/478836/">Lo que es común entre un revólver, lavadoras y un robot autónomo.</a> <br>  <a href="https://habr.com/ru/post/479636/">Propia pila de navegación.</a>  <a href="https://habr.com/ru/post/479636/">¿Mejor que ROS?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/482220/">https://habr.com/ru/post/482220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../482208/index.html">Regalos que te hacen perder Año Nuevo</a></li>
<li><a href="../482210/index.html">Bot para Tetris y animación de ingeniería inversa. Análisis de la pista móvil del segundo campeonato de programación.</a></li>
<li><a href="../482212/index.html">Hablar de ... queso?</a></li>
<li><a href="../482216/index.html">23 respuestas a la depresión de un psiquiatra profesional Maxim Malyavin (dpmmax)</a></li>
<li><a href="../482218/index.html">Java Digest para el 27 de diciembre</a></li>
<li><a href="../482222/index.html">Aplicación web en Kotlin + Spring Boot + Vue.js (complemento)</a></li>
<li><a href="../482224/index.html">Cuando un diseñador necesita ser un pequeño programador</a></li>
<li><a href="../482226/index.html">Las 20 mejores aplicaciones que un proveedor de atención médica no puede perderse</a></li>
<li><a href="../482228/index.html">Escribimos una "calculadora" en C #. Parte I. Cálculo del valor, derivada, simplificación y otros gansos.</a></li>
<li><a href="../482230/index.html">La batalla de los servidores WEB. Parte 2: escenario realista de HTTPS:</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>