<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÇ üññüèª üëà Como restauramos a programa√ß√£o de √¥nibus interurbanos üë®‚Äçüíº üåã ‚ôìÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como em todos os mercados normais, as passagens de √¥nibus s√£o vendidas on-line h√° alguns anos. N√£o √© necess√°rio fazer fila no caixa da esta√ß√£o de √¥nib...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como restauramos a programa√ß√£o de √¥nibus interurbanos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tuturu/blog/411629/"><img src="https://habrastorage.org/webt/zq/0q/cb/zq0qcbx7jnixdqezvc2pwx3doqs.jpeg"><br><br>  Como em todos os mercados normais, as passagens de √¥nibus s√£o vendidas on-line h√° alguns anos.  N√£o √© necess√°rio fazer fila no caixa da esta√ß√£o de √¥nibus para receber um recibo.  Na R√∫ssia, at√© 60% das rotas (em dias melhores, a estimativa √© um pouco confusa, considerando v√¥os cinzentos) podem ser compradas on-line.  Inclusive n√≥s, Tutu. <br><br>  A primeira coisa que quer√≠amos era fazer a programa√ß√£o on-line tamb√©m e possibilitar a compra de uma passagem em alguns cliques.  Estamos acostumados a resolver esses problemas e, de alguma forma, comemos o cachorro no transporte ferrovi√°rio.  Os √¥nibus √† primeira vista n√£o pareciam muito complicados.  √â apenas neg√≥cio - negociar com os sistemas de automa√ß√£o das rodovi√°rias, descarregar seus voos por meio da API e pentear um pouco. <br><br>  <b>Trabalho f√°cil, eles disseram.</b>  Um projeto por alguns dias, disseram eles. <br><br>  Nossos equ√≠vocos: <br><br>  1. Todas as esta√ß√µes de √¥nibus no pa√≠s s√£o automatizadas. <br>  2. Ok, a maioria √© automatizada. <br>  3. A contabilidade em um notebook n√£o √© realizada em nenhum outro lugar. <br>  4. Ok, mas h√° sempre uma maneira de saber a programa√ß√£o remotamente. <br>  5. Aqueles que s√£o automatizados mostram a mesma rota igualmente. <br>  6. Ok, pelo menos aqueles que s√£o automatizados pelo mesmo sistema mostram igualmente a mesma rota. <br>  7. Ok, onde n√£o h√° automa√ß√£o, pelo menos h√° um cronograma. <br>  8. Bem, deve haver um hor√°rio, porque sem ele apenas tr√°fego ilegal! <br>  9. Tr√°fego ilegal n√£o √© suficiente. <br>  10. Ok, existem menos de 10% do mercado. <br>  11. Um bilhete pode ser comprado ali mesmo e de volta. <br>  12. N√£o h√° rotas de m√£o √∫nica. <br>  13. Bem, pelo menos os √¥nibus est√£o voltando!  Era uma vez ... <br>  14. N√£o √© poss√≠vel deixar 300 √¥nibus para outra cidade em um ano e n√£o retornar. <br>  15. As paradas t√™m nomes √∫nicos diferentes. <br>  16. N√£o haver√° problemas com uma parada chamada ‚ÄúTurn‚Äù ou ‚ÄúReabastecer‚Äù. <a name="habracut"></a><br>  17. As paradas na regi√£o t√™m nomes diferentes. <br>  18. N√£o haver√° problemas com uma parada com o nome "Rota". <br>  19. As paradas na cidade t√™m nomes diferentes. <br>  20. Uma parada pode ter apenas um nome. <br>  21. Ok, n√£o mais que cinco nomes alternativos. <br>  22. Esses aliases tamb√©m s√£o bastante √∫nicos. <br>  23. Em qualquer caso, as paradas nos documentos oficiais t√™m coordenadas. <br>  24. Ok, a parada √© pelo menos indicada com a cidade / regi√£o. <br>  25. Quando h√° um hor√°rio para uma parada, sabe-se de onde veio e para onde o √¥nibus ir√°. <br>  26. Ok, isso sempre pode ser encontrado nos documentos. <br>  27. Droga, pelo menos h√° uma programa√ß√£o para uma parada espec√≠fica! <br>  28. A rota cidade A - cidade B √© do centro para o centro. <br>  29. Bem, pelo menos ele leva √† cidade de B. <br>  30. Bem, pelo menos uma vez ele levou √† cidade de B. <br>  31. Os √¥nibus n√£o podem pegar e desaparecer no meio da rota. <br>  32. Um voo em um hor√°rio espec√≠fico = um √¥nibus. <br>  33. Um √¥nibus n√£o pode se mover mais r√°pido que 120 quil√¥metros por hora. <br>  34. O centro da cidade √© um ponto compreens√≠vel. <br>  35. Ok, esta √© pelo menos a principal esta√ß√£o de √¥nibus. <br>  36. Ok, isso √© pelo menos algum tipo de esta√ß√£o de √¥nibus. <br>  37. Ok, pelo menos na cidade. <br>  38. N√£o √© poss√≠vel que o hor√°rio seja √∫nico, mas a resposta do sistema da esta√ß√£o para um voo espec√≠fico √© diferente. <br>  39. Se voc√™ puder comprar um bilhete l√°, na chegada poder√° comprar um retorno. <br>  40. Os bilhetes de ida e volta custam o mesmo. <br>  41. Bem, eles n√£o podem diferir no pre√ßo pela metade. <br><br>  Esta √© a principal coisa.  Todos os dias complementamos esta lista com pequenas coisas novas.  Agora vamos conversar um pouco mais.  No in√≠cio - sobre a base do b√°sico, voos oficiais. <br><br><h3>  O que √© um voo cinza? </h3><br>  Existem diferentes trens nas ferrovias, diferentes transportadoras e trens competem ativamente entre si.  Mas quando voc√™ compra um bilhete, voc√™ o compra em uma √∫nica janela, porque a infraestrutura se resume a Russian Railways.  Seus trilhos s√£o seu padr√£o, eles n√£o ser√£o capazes de entrar em colapso. <br><br>  J√° existe uma ordem de magnitude de mais transportadoras na avia√ß√£o, mas existem grandes n√≥s - aeroportos, padr√µes comuns e um √∫nico sistema de informa√ß√£o (mais precisamente, v√°rios), nos quais existem identificadores exclusivos elementares para cada n√≥. <br><br>  A informatiza√ß√£o chegou aos √¥nibus h√° muito tempo, mas o mercado, em termos de TI, √© semelhante a um ornitorrinco.  S√£o mil esta√ß√µes de √¥nibus e dez mil transportadoras.  Sim, existem grandes grupos como o Mostransavto, mas tamb√©m existem IPs com um barramento enferrujado.  At√© pequenas esta√ß√µes de √¥nibus nas aldeias t√™m seus pr√≥prios padr√µes. <br><br>  E o mais engra√ßado: se n√£o houver transportes ilegais nas ferrovias e no ar, o mercado de √¥nibus ainda estar√° em grande parte "cinza".  Estou falando de uma "parada em um posto perto da esta√ß√£o de √¥nibus" para pegar mais passageiros e de micro√¥nibus nos servi√ßos de companheiros de viagem, por exemplo. <br><br>  Se o condutor do vag√£o pegar os passageiros em troca de dinheiro na esta√ß√£o e os colocar em seu compartimento - √© claro que esse √© um transporte cinza.  Mas o v√¥o em si n√£o √© "cinza".  E no transporte de √¥nibus, a rota e o hor√°rio s√£o importantes.  Se voc√™ pegar seu √¥nibus e transportar passageiros para algum lugar, este ser√° um voo √∫nico feito sob medida (fretar um √¥nibus, algo como um fretamento em que a lista de passageiros √© conhecida antecipadamente) ou transporte n√£o comercial (√¥nibus para shopping centers ou √¥nibus para escrit√≥rios) do metr√¥). <br><br>  Conseguiu amigos na Gazelle e dirigiu at√© a casa - voc√™ n√£o tem o direito de vender ingressos.  Ou pague uma multa de cerca de 200 mil rublos ao transportador da entidade legal. <br><br>  Um voo "cinza" √© algo que se parece com um voo personalizado, mas n√£o √© (venda ilegal de passagens) ou √© apenas uma viagem n√£o documentada com passageiros, que logicamente deve ser gratuita, mas, na realidade, o motorista coleta dinheiro para bilhetes e n√£o emite nenhum documento justificativo. <br><br>  E um v√¥o "cinza" tamb√©m pode ser implementado usando a infraestrutura da esta√ß√£o de √¥nibus, embora nos √∫ltimos tempos tenha havido menos casos assim.  √â quando os passageiros pousam legalmente, mas o desembarque est√° em um ponto de parada ilegal. <br><br>  Se algo acontecer com voc√™ durante um voo cinza, este √© seu problema.  No caso do funcion√°rio, este √© um problema de transportadora.  Note-se que o hor√°rio de opera√ß√£o e lazer da transportadora cinza n√£o √© regulamentado.  Al√©m disso, o motorista "cinza" n√£o √© submetido a exame m√©dico antes da viagem. <br><br><h3>  O que √© uma "compra de ingresso online"? </h3><br>  Quando a R√∫ssia ousadamente entrou na era digital, a m√£o invis√≠vel do mercado mostrou que era necess√°rio vender ingressos online.  √â elementar mais lucrativo para as esta√ß√µes de √¥nibus. <br><br>  No entanto, como o mercado √© fragmentado, em regra, as seguintes entidades entram em jogo - agregadores.  Existem v√°rios sistemas principais de bilh√©tica e dezenas de sistemas menores.  E a rodovi√°ria pode adquirir seu pr√≥prio sistema de informa√ß√µes e tentar alterar de alguma forma os dados do grande. <br><br>  Os tr√™s maiores players de automa√ß√£o na R√∫ssia s√£o E-tr√°fego, KVC e Avibus.  Eles automatizam a rodovi√°ria e permitem que voc√™ abra a API para agregadores, se a rodovi√°ria ou a transportadora n√£o se importar.  Atrav√©s de seus sistemas, voc√™ pode obter as passagens da rodovi√°ria ou da transportadora.  Por exemplo, o Buses of the Big Country nos d√° acesso direto √†s suas rotas - √© assim que o trabalho √© constru√≠do diretamente com os maiores players.  Mas com os empreendedores que compraram um √¥nibus nos anos 80 e viajam, as coisas n√£o funcionam dessa maneira.  Ou existem operadoras que trabalharam bem por 40 anos sem a Internet e n√£o entendem por que ela √© necess√°ria.  Com todas as tentativas de reunir todos eles em uma associa√ß√£o (lembrem-se, s√£o dezenas de milhares de entidades legais e empreendedores individuais), todos se perguntam amigavelmente e sinceramente por que isso √© necess√°rio. <br><br>  Trabalhamos especificamente com pequenas transportadoras por meio de um agregador que coleta seus voos no n√≠vel das esta√ß√µes de √¥nibus de partida. <br><br>  O pr√≥ximo grande freio no mercado s√£o os requisitos para imprimir um bilhete (mais precisamente, um recibo de rota).  Voc√™ pode entrar no trem com registro eletr√¥nico apenas com um passaporte na m√£o.  Voc√™ receber√° uma passagem de avi√£o em qualquer lugar do aeroporto antes do embarque.  Mas no √¥nibus - procure uma impressora, as esta√ß√µes de √¥nibus nem sempre fornecem esses servi√ßos.  Felizmente, aqui o papel deve ser derrotado exatamente como foi derrotado na ferrovia.  Com o tempo. <br><br><h3>  Agora sangue e l√°grimas </h3><br>  Os sistemas de automa√ß√£o, mesmo os maiores, funcionam muito localmente.  Ou seja, eles automatizam a cidade, na melhor das hip√≥teses, a regi√£o.  Ent√£o, se poss√≠vel, v√° para os vizinhos. <br>  Portanto, todos os sistemas usam uma estrutura de dados geogr√°ficos muito simples (ou de nenhum uso).  Pode n√£o haver esse par√¢metro na parada, como coordenadas, a regi√£o / regi√£o / regi√£o tamb√©m costuma estar ausente. <br><br>  Isso significa que, assim que voc√™ misturar dados de dois sistemas, por exemplo, para poder comprar uma passagem de ida e volta na rota inter-regional, √© necess√°rio trazer todos os dados das paradas para um formul√°rio. <br><br>  Como resultado, tivemos que escrever nossa pr√≥pria geobase com a estrutura e o conjunto de dados corretos.  Como base, eles usaram o OpenStreetMap. <br><br>  Objetos geogr√°ficos de sistemas integr√°veis ‚Äã‚Äãj√° s√£o comparados com objetos geogr√°ficos do banco de dados principal e tentam anexar a eles.  Nos sistemas integrados, existem muitas paradas, como ‚ÄúTrilha‚Äù, ‚ÄúTurn‚Äù, etc., que, de fato, fazem parte do percurso.  Nomes como Aleksandrovka, Mikhaylovka etc. s√£o sempre uma surpresa, porque existem dezenas e at√© centenas dessas aldeias na R√∫ssia. <br><br>  Mas n√≥s somos matem√°ticos!  Solu√ß√£o: ajuste o motor, que criar√° uma hip√≥tese sobre onde o √¥nibus ter√° tempo para ficar entre os pontos j√° conhecidos (anexos) de sua rota - qual Mikhailovka?  Pode acontecer que de maneira alguma.  A prop√≥sito, isso significa que ou inexplicado estava escondido l√°, ou era Mikhailovka h√° 20 anos, ou algo mais.  Voc√™ precisa ligar e perguntar aos habitantes locais. <br><br>  Ainda mais interessante.  Nem todos os sistemas enviam dados nas paradas e os passageiros podem n√£o saber para onde eles chegam ou para onde o √¥nibus sai.  Em sistemas diferentes, as mesmas paradas s√£o chamadas de maneira diferente.  √Äs vezes, os pontos s√£o marcados como pontos materiais, e isso √© importante, por exemplo, se um passageiro comprou uma passagem para a cidade e o √¥nibus p√°ra na rodovia nos arredores da cidade e continua.  Do ponto de vista do sistema de informa√ß√£o, uma cidade pode ser um objeto e um passageiro outros 10 quil√¥metros a p√©. <br><br>  Com grande dificuldade, recebemos e continuamos a receber os dados necess√°rios.  No mesmo est√°gio, nas cidades onde n√£o h√° automa√ß√£o, pedimos √†s pessoas que ajudassem - a enviar fotos de peda√ßos de papel das esta√ß√µes de √¥nibus.  Posteriormente, esses peda√ßos de papel tiveram um papel muito importante: verificamos a precis√£o das hip√≥teses usando-as, por exemplo, sobre o movimento reverso dos √¥nibus. <br><br>  Sim  O movimento reverso geralmente √© a tarefa de restaurar uma rota.  Porque A - B √© uma rota de uma regi√£o e B - A √© outra rota de outra regi√£o.  E eles podem estar em diferentes sistemas de informa√ß√£o.  E os ingressos para eles s√£o vendidos em diferentes esta√ß√µes.  E o hor√°rio n√£o √© conhecido nas bilheterias, mas o motorista sabe. <br><br>  A hip√≥tese era que √© poss√≠vel prever matematicamente o movimento do √¥nibus ao longo da rota, com base na id√©ia de que os √¥nibus √†s vezes retornam para casa e que seu n√∫mero na rota √© limitado.  Em geral, isso acabou sendo correto.  Em geral, como existem situa√ß√µes em que o √¥nibus parte para outra cidade, desaparece por algumas semanas (aparentemente em outras rotas) e, de repente, se encontra na cidade inicial.  Esses s√£o apenas os hor√°rios que ajudaram a capturar esses casos. <br><br>  Ainda precisa colar v√¥os.  Porque em sistemas diferentes, o mesmo voo tamb√©m pode ser levado em considera√ß√£o de maneiras diferentes.  E at√© sair em um hor√°rio um pouco diferente.  Como resultado, quatro v√¥os podem entrar no hor√°rio √†s 20:00, por exemplo.  Tivemos que escrever a mec√¢nica de algo como um hash perceptivo - comparando voos de diferentes sistemas com base em 4-5 par√¢metros.  Um esquema semelhante foi necess√°rio para unir os v√¥os A - B - C - √†s vezes, esse √© um v√¥o real, mas dois em sistemas de informa√ß√£o. <br><br><h3>  Mudan√ßas na programa√ß√£o </h3><br>  Comparado aos nossos trens el√©tricos favoritos, onde tudo √© automatizado centenas de vezes, mas tamb√©m muda frequentemente, o √¥nibus muda com muito menos frequ√™ncia.  Por isso, voc√™ precisa concordar com um novo mapa de rota e tempo de viagem.  O procedimento para atualizar o agendamento √© bastante simples, o cache de pesquisa tamb√©m n√£o √© muito complicado - pelo menos ele esquenta. <br><br><h3>  O que aconteceu </h3><br><img src="https://habrastorage.org/webt/sp/iz/o2/spizo2_fx6ftwn4sbamfkut4dig.png"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Hor√°rio de √¥nibus Rostov do Don - Moscow</a></i> <br><br>  Agora, temos a oportunidade de mostrar aos usu√°rios informa√ß√µes de voo e a capacidade de comprar uma passagem de √¥nibus em algum lugar em 40-50% das viagens de √¥nibus que viajam pela R√∫ssia.  Em 50-60% dos usu√°rios n√£o encontram informa√ß√µes sobre os voos dispon√≠veis (embora eles efetivamente voem, e somos informados de que partem).  Portanto, decidimos seguir o caminho de fechar pelo menos a necessidade b√°sica de informa√ß√µes, enquanto expand√≠amos o sortimento de compra de ingressos. <br><br>  Podemos restaurar as rotas com o mesmo grau de erro que a diferen√ßa usual no tr√°fego de ve√≠culos. <br><br>  Bem, estamos obtendo um grande banco de dados de avalia√ß√µes para todos os voos, como fazemos com trens e avi√µes.  Isso permite que voc√™ entenda claramente os recursos de cada rota, √¥nibus e o que surpreende um passageiro. <br><br>  E aqui est√° mais sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como os √¥nibus funcionam na R√∫ssia em geral.</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt411629/">https://habr.com/ru/post/pt411629/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt411613/index.html">Clash of the Titans: comparando os principais leitores do PocketBook 740 e Amazon Kindle Oasis 2017</a></li>
<li><a href="../pt411617/index.html">Sistema de m√≠dia para Toyota Prius (Restayl)</a></li>
<li><a href="../pt411621/index.html">A SpaceX construir√° o Big Fucking Rocket em Los Angeles</a></li>
<li><a href="../pt411623/index.html">Os cientistas criaram uma enzima que quebra o pl√°stico</a></li>
<li><a href="../pt411625/index.html">Radio-86RK no ESP-01S</a></li>
<li><a href="../pt411631/index.html">O telegrama na R√∫ssia pode ser bloqueado devido aos planos de Durov de lan√ßar sua pr√≥pria criptomoeda</a></li>
<li><a href="../pt411633/index.html">Gravidez da m√£e, parto e sa√∫de de seus olhos</a></li>
<li><a href="../pt411635/index.html">A Microsoft abriu o c√≥digo-fonte do Gerenciador de Arquivos</a></li>
<li><a href="../pt411637/index.html">V√°rios bilh√µes de anos atr√°s, o germe do planeta foi destru√≠do no sistema solar.</a></li>
<li><a href="../pt411639/index.html">Os cientistas desenvolveram tecnologia para a produ√ß√£o de grafeno em rolos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>