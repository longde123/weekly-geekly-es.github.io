<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∂ ‚õπüèº üôãüèø En quoi les composants React fonctionnels sont-ils diff√©rents des composants bas√©s sur les classes? üë®üèº‚Äçüíª üà∏ üîõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En quoi les composants React fonctionnels sont-ils diff√©rents des composants bas√©s sur les classes? Depuis un certain temps maintenant, la r√©ponse tra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>En quoi les composants React fonctionnels sont-ils diff√©rents des composants bas√©s sur les classes?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/444348/">  En quoi les composants React fonctionnels sont-ils diff√©rents des composants bas√©s sur les classes?  Depuis un certain temps maintenant, la r√©ponse traditionnelle √† cette question est: "L'utilisation de classes vous permet d'utiliser un grand nombre de fonctionnalit√©s de composants, par exemple l'√©tat."  Maintenant, avec l'av√®nement des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">crochets</a> , cette r√©ponse ne refl√®te plus la v√©ritable situation. <br><br>  Vous avez peut-√™tre entendu dire que l'un de ces types de composants a de meilleures performances que l'autre.  Mais lequel?  La plupart des rep√®res qui testent cela ont des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©fauts</a> , donc je <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tirerais des conclusions</a> bas√©es sur leurs r√©sultats avec une grande prudence.  Les performances d√©pendent principalement de ce qui se passe dans le code, et non de la s√©lection des composants fonctionnels ou des composants bas√©s sur les classes pour impl√©menter certaines fonctionnalit√©s.  Notre √©tude a montr√© que la diff√©rence de performance entre les diff√©rents types de composants est n√©gligeable.  Cependant, il convient de noter que les strat√©gies d'optimisation utilis√©es pour travailler avec elles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">diff√®rent</a> l√©g√®rement. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/x-/vn/je/x-vnjetrulggl4xjpo2jmitqjvg.jpeg"></a> <br><br>  En tout cas, je <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne recommande pas de</a> r√©√©crire les composants existants √† l'aide de nouvelles technologies s'il n'y a pas de bonnes raisons √† cela, et si cela ne vous d√©range pas de faire partie de ceux qui ont commenc√© √† utiliser ces technologies avant tout le monde.  Les crochets sont encore une nouvelle technologie (identique √† la biblioth√®que React en 2014), et certaines ¬´meilleures pratiques¬ª pour leur application n'ont pas encore √©t√© incluses dans les manuels React. <br><a name="habracut"></a><br>  O√π en sommes-nous finalement arriv√©s?  Existe-t-il des diff√©rences fondamentales entre les composants fonctionnels de React et les composants bas√©s sur les classes?  Bien s√ªr, il existe de telles diff√©rences.  Ce sont des diff√©rences dans le mod√®le mental d'utilisation de ces composants.  Dans cet article, je consid√©rerai leur diff√©rence la plus s√©rieuse.  Il existe depuis que, en 2015, des composants fonctionnels sont apparus, mais il est souvent n√©glig√©.  Elle consiste dans le fait que les composants fonctionnels capturent les valeurs rendues.  Parlons de ce que cela signifie vraiment. <br><br>  Il convient de noter que ce mat√©riel ne constitue pas une tentative d'√©valuation de composants de diff√©rents types.  Je viens de d√©crire la diff√©rence entre les deux mod√®les de programmation dans React.  Si vous souhaitez en savoir plus sur l'utilisation des composants fonctionnels √† la lumi√®re des innovations, reportez-vous √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette</a> liste de questions et r√©ponses sur les crochets. <br><br><h2>  <font color="#3AC1EF">Quelles sont les caract√©ristiques du code des composants bas√©s sur des fonctions et des classes?</font> </h2><br>  Consid√©rez ce composant: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfilePage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> showMessage = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {    alert(<span class="hljs-string"><span class="hljs-string">'Followed '</span></span> + props.user);  };  <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handleClick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {    setTimeout(showMessage, <span class="hljs-number"><span class="hljs-number">3000</span></span>);  };  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (    <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{handleClick}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Follow</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>  ); }</code> </pre> <br>  Il affiche un bouton qui, en appuyant sur la fonction <code>setTimeout</code> , imite une demande r√©seau, puis affiche une bo√Æte de message confirmant que l'op√©ration est termin√©e.  Par exemple, si ¬´ <code>props.user</code> <code>'Dan'</code> est stock√© dans <code>props.user</code> , alors dans la fen√™tre de message, apr√®s trois secondes, <code>'Followed Dan'</code> s'affiche. <br><br>  Notez que peu importe si des fonctions fl√©ch√©es ou des d√©clarations de fonctions sont utilis√©es ici.  Une construction de la <code>function handleClick()</code> formulaire <code>function handleClick()</code> fonctionnera exactement de la m√™me mani√®re. <br><br>  Comment r√©√©crire ce composant en classe?  Si vous venez de refaire le code que vous venez d'examiner, en le convertissant en code d'un composant bas√© sur une classe, vous obtenez ce qui suit: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProfilePage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ showMessage = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   alert(<span class="hljs-string"><span class="hljs-string">'Followed '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.user); }; handleClick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setTimeout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showMessage, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }; render() {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.handleClick}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Follow</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } }</code> </pre> <br>  Il est g√©n√©ralement admis que deux de ces fragments de code sont √©quivalents.  Et les d√©veloppeurs sont souvent totalement libres, au cours du refactoring de code, se transforment les uns en les autres, sans penser aux cons√©quences possibles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/c7a/341/1d3c7a341ee3fcadc79df00e7d872e4b.gif"></div><br>  <i><font color="#999999">Ces morceaux de code semblent √™tre √©quivalents</font></i> <br><br>  Cependant, il existe une l√©g√®re diff√©rence entre ces extraits de code.  Regardez-les de plus pr√®s.  Tu vois la diff√©rence?  Par exemple, je ne l'ai pas vue tout de suite. <br><br>  De plus, nous consid√©rerons cette diff√©rence, par cons√©quent, pour ceux qui veulent comprendre l'essence de ce qui se passe eux-m√™mes, un exemple de travail de ce code. <br><br>  Avant de continuer, je voudrais souligner que la diff√©rence en question n'a rien √† voir avec les crochets React.  Dans les exemples pr√©c√©dents, d'ailleurs, les crochets ne sont m√™me pas utilis√©s.  Il s'agit de la diff√©rence entre les fonctions et les classes dans React.  Et si vous pr√©voyez d'utiliser de nombreux composants fonctionnels dans vos applications React, vous souhaiterez peut-√™tre comprendre cette diff√©rence. <br><br>  En fait, nous illustrerons la diff√©rence entre les fonctions et les classes par l'exemple d'une erreur qui est souvent rencontr√©e dans les applications React. <br><br><h2>  <font color="#3AC1EF">L'erreur courante dans les applications React.</font> </h2><br>  Ouvrez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la page d'exemple</a> qui affiche une liste qui vous permet de s√©lectionner des profils utilisateur et deux boutons <code>Follow</code> qui sont affich√©s par les <code>ProfilePageClass</code> <code>ProfilePageFunction</code> et <code>ProfilePageClass</code> , fonctionnels et bas√©s sur la classe, dont le code est illustr√© ci-dessus. <br><br>  Essayez, pour chacun de ces boutons, d'effectuer la s√©quence d'actions suivante: <br><br><ol><li>  Cliquez sur le bouton. </li><li>  Modifiez le profil s√©lectionn√© avant 3 secondes apr√®s avoir cliqu√© sur le bouton. </li><li>  Lisez le texte affich√© dans la bo√Æte de message. </li></ol><br>  Cela fait, vous remarquerez les fonctionnalit√©s suivantes: <br><br><ul><li>  Lorsque vous cliquez sur le bouton form√© par le composant fonctionnel avec le profil <code>Dan</code> s√©lectionn√©, puis que vous passez au profil <code>Sophie</code> , <code>'Followed Dan'</code> s'affiche dans la bo√Æte de message. </li><li>  Si vous faites de m√™me avec un bouton form√© par un composant bas√© sur une classe, <code>'Followed Sophie'</code> s'affichera. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/386/a44/911/386a449110202d5140d67336a0ade5a0.gif"></div><br>  <i><font color="#999999">Caract√©ristiques des composants bas√©s sur les classes</font></i> <br><br>  Dans cet exemple, le comportement du composant fonctionnel est correct.  Si je me suis abonn√© au profil de quelqu'un, puis suis pass√© √† un autre profil, mon composant ne devrait pas douter du profil auquel je me suis abonn√©.  De toute √©vidence, la mise en ≈ìuvre du m√©canisme en question bas√© sur l'utilisation de classes contient une erreur (√† propos, vous devriez certainement devenir abonn√© √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sofia</a> ). <br><br><h2>  <font color="#3AC1EF">Causes de dysfonctionnement d'un composant bas√© sur une classe</font> </h2><br>  Pourquoi un composant bas√© sur une classe se comporte-t-il de cette fa√ßon?  Afin de comprendre cela, jetons un coup d'≈ìil √† la m√©thode <code>showMessage</code> dans notre classe: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProfilePage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ showMessage = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   alert(<span class="hljs-string"><span class="hljs-string">'Followed '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.user); };</code> </pre> <br>  Cette m√©thode lit les donn√©es de <code>this.props.user</code> .  Les propri√©t√©s de React sont immuables, elles ne changent donc pas.  Cependant, comme toujours, il s'agit d'une entit√© mutable. <br><br>  En fait, le but d'avoir <code>this</code> dans une classe r√©side dans la capacit√© de <code>this</code> √† changer.  La biblioth√®que React elle-m√™me effectue p√©riodiquement <code>this</code> mutations, ce qui permet de travailler avec les derni√®res versions de la m√©thode de <code>render</code> et des m√©thodes de cycle de vie des composants. <br><br>  Par cons√©quent, si notre composant effectue un nouveau rendu pendant l'ex√©cution de la demande, <code>this.props</code> changera.  Apr√®s cela, la m√©thode <code>showMessage</code> lira la valeur <code>user</code> de l'entit√© d' <code>props</code> "trop ‚Äã‚Äãnouveau". <br><br>  Cela vous permet de faire une observation int√©ressante concernant les interfaces utilisateur.  Si nous disons que l'interface utilisateur, conceptuellement, est fonction de l'√©tat actuel de l'application, alors les gestionnaires d'√©v√©nements font partie des r√©sultats de rendu - tout comme les r√©sultats de rendu visibles.  Nos gestionnaires d'√©v√©nements ¬´appartiennent¬ª √† une op√©ration de rendu sp√©cifique avec des propri√©t√©s et un √©tat sp√©cifiques. <br><br>  Cependant, la planification d'un d√©lai dont le rappel <code>this.props</code> lu par <code>this.props</code> viole cette connexion.  Le <code>showMessage</code> showMessage <code>showMessage</code> pas ¬´li√©¬ª √† une op√©ration de rendu particuli√®re, par cons√©quent, il ¬´perd¬ª les propri√©t√©s correctes.  La lecture des donn√©es √† partir de <code>this</code> rompt cette connexion. <br><br><h2>  <font color="#3AC1EF">Comment, au moyen de composants bas√©s sur les classes, r√©soudre le probl√®me?</font> </h2><br>  Imaginez qu'il n'y ait pas de composants fonctionnels dans React.  Comment alors r√©soudre ce probl√®me? <br><br>  Nous avons besoin d'un m√©canisme pour "restaurer" la connexion entre la m√©thode de <code>render</code> avec les propri√©t√©s correctes et le <code>showMessage</code> showMessage, qui lit les donn√©es des propri√©t√©s.  Ce m√©canisme devrait √™tre situ√© quelque part o√π l'essence des <code>props</code> avec les donn√©es correctes est perdue. <br><br>  Une fa√ßon de proc√©der consiste √† lire <code>this.props</code> √† l'avance dans le gestionnaire d'√©v√©nements, puis √† transmettre explicitement ce qui a √©t√© lu √† la fonction de rappel utilis√©e dans <code>setTimeout</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProfilePage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ showMessage = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user</span></span></span><span class="hljs-function">) =&gt;</span></span> {   alert(<span class="hljs-string"><span class="hljs-string">'Followed '</span></span> + user); }; handleClick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {user} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props;   setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showMessage(user), <span class="hljs-number"><span class="hljs-number">3000</span></span>); }; render() {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.handleClick}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Follow</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } }</code> </pre> <br>  Cette approche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctionne</a> .  Mais les constructions suppl√©mentaires utilis√©es ici, au fil du temps, entra√Æneront une augmentation du volume du code et le fait que la probabilit√© d'erreurs y augmentera.  Et si nous avons besoin de plus qu'une seule propri√©t√©?  Et si nous devons √©galement travailler avec l'√âtat?  Si la m√©thode <code>showMessage</code> une autre m√©thode et que cette m√©thode lit <code>this.props.something</code> ou <code>this.state.something</code> , nous rencontrerons √† nouveau le m√™me probl√®me.  Et pour le r√©soudre, nous devons passer <code>this.props</code> et <code>this.state</code> comme arguments √† toutes les m√©thodes appel√©es depuis <code>showMessage</code> . <br><br>  Si cela est vrai, cela d√©truira toutes les commodit√©s offertes par l‚Äôutilisation des composants bas√©s sur les classes.  Il est difficile de se rappeler que travailler avec des m√©thodes de cette mani√®re est difficile, il est difficile d'automatiser, en cons√©quence, les d√©veloppeurs conviennent souvent, au lieu d'utiliser des m√©thodes similaires, qu'il y a des erreurs dans leurs projets. <br><br>  De m√™me, l'incorporation de code d' <code>alert</code> dans <code>handleClick</code> ne r√©sout pas un probl√®me plus global.  Nous devons structurer le code afin qu'il puisse √™tre divis√© en plusieurs m√©thodes, mais aussi pour pouvoir lire les propri√©t√©s et l'√©tat qui correspondent √† l'op√©ration de rendu associ√©e √† un appel particulier.  Ce probl√®me, d'ailleurs, ne s'applique m√™me pas exclusivement √† React.  Vous pouvez le lire dans n'importe quelle biblioth√®que pour d√©velopper des interfaces utilisateur, ce qui place les donn√©es dans des objets mutables comme <code>this</code> . <br><br>  Peut-√™tre que pour r√©soudre ce probl√®me, vous pouvez lier des m√©thodes √† <code>this</code> dans le constructeur? <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProfilePage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) {   <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props);   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showMessage = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showMessage.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleClick = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.handleClick.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } showMessage() {   alert(<span class="hljs-string"><span class="hljs-string">'Followed '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.user); } handleClick() {   setTimeout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showMessage, <span class="hljs-number"><span class="hljs-number">3000</span></span>); } render() {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.handleClick}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Follow</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } }</code> </pre> <br>  Mais cela ne r√©sout pas notre probl√®me.  N'oubliez pas que c'est que nous lisons les donn√©es de <code>this.props</code> trop tard, et non dans la syntaxe utilis√©e!  Cependant, ce probl√®me sera r√©solu si nous nous appuyons sur les fermetures JavaScript. <br><br>  Les d√©veloppeurs essaient souvent d'√©viter les fermetures, car il n'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pas facile de</a> penser √† des valeurs qui, au fil du temps, ne peuvent pas muter.  Mais les propri√©t√©s de React sont immuables!  (Ou, au minimum, cela est fortement recommand√©).  Cela vous permet d'arr√™ter de percevoir les fermetures comme quelque chose √† cause duquel le programmeur peut, comme on dit, ¬´se tirer une balle dans le pied¬ª. <br><br>  Cela signifie que si vous ¬´verrouillez¬ª les propri√©t√©s ou l'√©tat d'une op√©ration de rendu particuli√®re dans la fermeture, vous pouvez toujours compter sur eux pour ne pas changer. <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProfilePage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() {   <span class="hljs-comment"><span class="hljs-comment">//  !   const props = this.props;   //    ,      render.   //   -   .   const showMessage = () =&gt; {     alert('Followed ' + props.user);   };   const handleClick = () =&gt; {     setTimeout(showMessage, 3000);   };   return &lt;button onClick={handleClick}&gt;Follow&lt;/button&gt;; } }</span></span></code> </pre> <br>  Comme vous pouvez le voir, nous avons ici ¬´captur√©¬ª les propri√©t√©s lors de l'appel √† la m√©thode de <code>render</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa4/83d/d56/fa483dd5699aac1350c57591770a49be.gif"></div><br>  <i><font color="#999999">Propri√©t√©s captur√©es par l'appel de rendu</font></i> <br><br>  Avec cette approche, tout code trouv√© dans la m√©thode de <code>render</code> (y compris <code>showMessage</code> ) est garanti de voir les propri√©t√©s captur√©es lors d'un appel particulier √† cette m√©thode.  En cons√©quence, React ne pourra plus nous emp√™cher de faire ce dont nous avons besoin. <br><br>  Dans la m√©thode de <code>render</code> , vous pouvez d√©crire autant de fonctions auxiliaires que vous le souhaitez et toutes pourront utiliser les propri√©t√©s et l'√©tat ¬´captur√©s¬ª.  C'est ainsi que les fermetures ont r√©solu notre probl√®me. <br><br><h2>  <font color="#3AC1EF">Analyse de la solution du probl√®me √† l'aide de la fermeture</font> </h2><br>  Ce que nous venons d'arriver nous permet de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©soudre le probl√®me</a> , mais un tel code semble √©trange.  Pourquoi une classe est-elle n√©cessaire du tout si des fonctions sont d√©clar√©es √† l'int√©rieur de la m√©thode de <code>render</code> , et non en tant que m√©thodes de classe? <br><br>  En fait, nous pouvons simplifier ce code en nous d√©barrassant du ¬´shell¬ª sous la forme d'une classe qui l'entoure: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfilePage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> showMessage = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   alert(<span class="hljs-string"><span class="hljs-string">'Followed '</span></span> + props.user); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handleClick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setTimeout(showMessage, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{handleClick}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Follow</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br>  Ici, comme dans l'exemple pr√©c√©dent, les propri√©t√©s sont captur√©es dans la fonction, puisque React leur les transmet en argument.  Contrairement √† <code>this</code> , React ne <code>props</code> jamais <code>props</code> objet d' <code>props</code> . <br><br>  Cela devient un peu plus √©vident si les <code>props</code> d√©truits dans la d√©claration de fonction: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProfilePage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ user }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> showMessage = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   alert(<span class="hljs-string"><span class="hljs-string">'Followed '</span></span> + user); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handleClick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setTimeout(showMessage, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{handleClick}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Follow</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br>  Lorsque le composant parent <code>ProfilePage</code> avec d'autres propri√©t√©s, React appellera √† <code>ProfilePage</code> fonction <code>ProfilePage</code> .  Mais le gestionnaire d'√©v√©nements qui a d√©j√† √©t√© appel√© appartient √† l'appel pr√©c√©dent √† cette fonction, cet appel utilise sa propre valeur <code>user</code> et son propre <code>showMessage</code> showMessage, qui lit cette valeur.  Tout cela reste intact. <br><br>  C'est pourquoi dans la version <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">originale</a> de notre exemple, lorsque vous travaillez avec un composant fonctionnel, la s√©lection d'un autre profil apr√®s avoir cliqu√© sur le bouton correspondant avant que le message ne s'affiche ne change rien.  Si un profil <code>Sophie</code> √©t√© s√©lectionn√© avant de cliquer sur le bouton, <code>'Followed Sophie'</code> s'affichera dans la fen√™tre de message, quoi qu'il arrive. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/96c/4b3/84396c4b3982827bead96912a947904e.gif"></div><br>  <i><font color="#999999">Utiliser un composant fonctionnel</font></i> <br><br>  Ce comportement est correct (vous pouvez √©galement vous inscrire √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sunil en passant</a> ). <br><br>  Nous avons maintenant compris quelle est la grande diff√©rence entre les fonctions et les classes dans React.  Comme d√©j√† mentionn√©, nous parlons du fait que les composants fonctionnels capturent des valeurs.  Parlons maintenant des crochets. <br><br><h2>  <font color="#3AC1EF">Crochets</font> </h2><br>  Lors de l'utilisation de hooks, le principe de "capture de valeurs" s'√©tend √† l'√©tat.  Prenons l'exemple suivant: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MessageThread</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [message, setMessage] = useState(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> showMessage = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   alert(<span class="hljs-string"><span class="hljs-string">'You said: '</span></span> + message); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handleSendClick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setTimeout(showMessage, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handleMessageChange = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> {   setMessage(e.target.value); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   &lt;&gt;     &lt;input value={message} onChange={handleMessageChange} /&gt;     &lt;button onClick={handleSendClick}&gt;Send&lt;/button&gt;   &lt;/&gt; ); }</code> </pre> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ici,</a> vous pouvez exp√©rimenter avec lui <br><br>  Bien qu'il ne s'agisse pas d'un exemple exemplaire d'une interface d'application de messagerie, ce projet illustre la m√™me id√©e: si un utilisateur envoie un message, le composant ne doit pas √™tre confondu sur le message envoy√©.  La constante de <code>message</code> de ce composant fonctionnel capture l'√©tat qui "appartient" au composant qui rend le navigateur le gestionnaire de clics pour le bouton qu'il appelle.  Par cons√©quent, le <code>message</code> stocke ce qui √©tait dans le champ de saisie au moment o√π vous cliquez sur le bouton <code>Send</code> . <br><br><h2>  <font color="#3AC1EF">Le probl√®me de la capture des propri√©t√©s et des √©tats par des composants fonctionnels</font> </h2><br>  Nous savons que les composants fonctionnels de React capturent par d√©faut les propri√©t√©s et l'√©tat.  Mais que se passe-t-il si nous devons lire les derni√®res donn√©es des propri√©t√©s ou des √©tats qui n'appartiennent pas √† un appel de fonction particulier?  Et si nous voulons ¬´les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lire du futur</a> ¬ª? <br><br>  Dans les composants bas√©s sur les classes, cela pourrait √™tre fait simplement en se r√©f√©rant √† <code>this.props</code> ou <code>this.state</code> , car <code>this</code> s'agit d'une entit√© mutable.  Son changement est engag√© dans React.  Les composants fonctionnels peuvent √©galement fonctionner avec des valeurs mutables partag√©es par tous les composants.  Ces valeurs sont appel√©es <code>ref</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ref = useRef(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     `ref.current`. // ... }</span></span></code> </pre> <br>  Cependant, le programmeur doit g√©rer ces valeurs ind√©pendamment. <br><br>  L'essence de <code>ref</code> joue le m√™me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√¥le</a> que les champs d'une instance d'une classe.  Il s'agit d'une ¬´sortie d'urgence¬ª dans un monde imp√©ratif mutable.  Vous connaissez peut-√™tre le concept des r√©f√©rences DOM, mais cette id√©e est beaucoup plus g√©n√©rale.  Il peut √™tre compar√© √† une bo√Æte dans laquelle un programmeur peut mettre quelque chose. <br><br>  M√™me √† l'ext√©rieur, une construction comme <code>this.something</code> ressemble √† une image miroir de <code>something.current</code> construction actuelle.  Ils sont une repr√©sentation du m√™me concept. <br><br>  Par d√©faut, React ne cr√©e pas d'entit√©s de <code>ref</code> dans les composants fonctionnels pour les valeurs de propri√©t√© ou d'√©tat les plus r√©centes.  Dans de nombreux cas, vous n'en aurez pas besoin et leur cr√©ation automatique serait une perte de temps.  Cependant, travailler avec eux, si n√©cessaire, peut √™tre organis√© de mani√®re autonome: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MessageThread</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [message, setMessage] = useState(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> latestMessage = useRef(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> showMessage = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   alert(<span class="hljs-string"><span class="hljs-string">'You said: '</span></span> + latestMessage.current); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handleSendClick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setTimeout(showMessage, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handleMessageChange = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> {   setMessage(e.target.value);   latestMessage.current = e.target.value; };</code> </pre> <br>  Si nous lisons le <code>message</code> dans <code>showMessage</code> , nous verrons alors le message qui se trouvait dans le champ au moment de cliquer sur le bouton <code>Send</code> .  Mais si vous lisez <code>latestMessage.current</code> , vous pouvez obtenir la derni√®re valeur - m√™me si nous continuons √† saisir du texte dans le champ apr√®s avoir cliqu√© sur le bouton <code>Send</code> . <br><br>  Vous pouvez comparer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ceci</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ces</a> exemples afin d'√©valuer ind√©pendamment la diff√©rence.  La valeur de <code>ref</code> est un moyen ¬´d'√©viter¬ª l'uniformit√© du rendu, dans certains cas, elle peut √™tre tr√®s utile. <br><br>  En g√©n√©ral, vous devez √©viter de lire ou d'√©crire des valeurs <code>ref</code> pendant le processus de rendu car ces valeurs sont mutables.  Nous nous effor√ßons de rendre le rendu pr√©visible.  Cependant, si nous devons obtenir la valeur la plus r√©cente de quelque chose stock√© dans des propri√©t√©s ou dans un √©tat, la mise √† jour manuelle de la valeur <code>ref</code> peut √™tre une t√¢che fastidieuse.  Il peut √™tre automatis√© en utilisant l'effet: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MessageThread</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [message, setMessage] = useState(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    . const latestMessage = useRef(''); useEffect(() =&gt; {   latestMessage.current = message; }); const showMessage = () =&gt; {   alert('You said: ' + latestMessage.current); };</span></span></code> </pre> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici</a> un exemple qui utilise ce code <br><br>  Nous attribuons une valeur √† l'int√©rieur de l'effet, par cons√©quent, la valeur de <code>ref</code> ne changera qu'apr√®s la mise √† jour du DOM.  Cela garantit que notre mutation ne perturbe pas des fonctionnalit√©s comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Time Slicing et Suspense</a> , qui reposent sur la continuit√© des op√©rations de rendu. <br><br>  L'utilisation de la valeur <code>ref</code> de cette mani√®re n'est pas souvent requise.  La capture de propri√©t√©s ou d'√©tats semble g√©n√©ralement √™tre un mod√®le bien meilleur de comportement standard du syst√®me.  Cependant, cela peut √™tre pratique lorsque vous travaillez avec des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API imp√©ratives</a> , comme celles qui utilisent des intervalles ou des abonnements.  N'oubliez pas que vous pouvez travailler de cette fa√ßon avec n'importe quelle valeur - avec des propri√©t√©s, avec des variables stock√©es dans l'√©tat, avec l'objet <code>props</code> entier <code>props</code> ou m√™me avec une fonction. <br><br>  Ce mod√®le peut en outre √™tre utile √† des fins d'optimisation.  Par exemple, lorsque quelque chose comme <code>useCallback</code> change trop souvent.  Certes, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">solution pr√©f√©r√©e est</a> souvent d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utiliser un r√©ducteur</a> . <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Dans cet article, nous avons examin√© l'un des mauvais mod√®les d'utilisation des composants bas√©s sur les classes et expliqu√© comment r√©soudre ce probl√®me avec les fermetures.  Cependant, vous pouvez remarquer que lorsque vous essayez d'optimiser les hooks en sp√©cifiant un tableau de d√©pendances, vous pouvez rencontrer des erreurs li√©es √† des fermetures obsol√®tes.  Est-ce √† dire que les d√©fauts eux-m√™mes sont un probl√®me.  Je ne pense pas. <br><br>  Comme indiqu√© ci-dessus, les fermetures nous aident en fait √† r√©soudre les petits probl√®mes difficiles √† d√©tecter.  De m√™me, ils facilitent l'√©criture de code qui fonctionne correctement en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">parall√®le</a> .  Cela est possible du fait que dans le composant, les propri√©t√©s et l'√©tat corrects avec lesquels ce composant a √©t√© rendu sont ¬´verrouill√©s¬ª. <br><br>  Dans tous les cas que j'ai vus jusqu'√† pr√©sent, le probl√®me des ¬´fermetures obsol√®tes¬ª s'est produit en raison de l'hypoth√®se erron√©e que ¬´les fonctions ne changent pas¬ª ou que ¬´les propri√©t√©s restent toujours les m√™mes¬ª.  J'esp√®re qu'apr√®s avoir lu ce document, vous √™tes convaincu que ce n'est pas le cas. <br><br>  Les fonctions ¬´capturent¬ª leurs propri√©t√©s et leur √©tat - et il est donc √©galement important de comprendre quelles fonctions sont en question.  Ce n'est pas une erreur, c'est une caract√©ristique des composants fonctionnels.  Les fonctions ne doivent pas √™tre exclues du "tableau de d√©pendances" pour <code>useEffect</code> ou <code>useCalback</code> , par exemple.  (Un outil appropri√© pour r√©soudre le probl√®me est g√©n√©ralement <code>useReducer</code> ou <code>useRef</code> . Nous en avons parl√© ci-dessus, et bient√¥t nous pr√©parerons du mat√©riel qui sera consacr√© au choix de telle ou telle approche). <br><br>  Si la plupart du code de nos applications sera bas√© sur des composants fonctionnels, cela signifie que nous devons en savoir plus sur l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">optimisation du code</a> et quelles valeurs peuvent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">changer au</a> fil du temps. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>     : ¬´  ,   ,    ,   ,    ,         ¬ª. <br><br>          .  ,        React    ,   .     ,    ¬´ ¬ª,     . ,         React  . <br><br>      ,      ,   . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc3/bdd/f6d/fc3bddf6d4ca14bc77917ac0cfad3608.gif"></div><br> <i><font color="#999999">  React ‚Äî    </font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444348/">https://habr.com/ru/post/fr444348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444338/index.html">Encapsulation dans Python 3</a></li>
<li><a href="../fr444340/index.html">Caract√©ristiques de l'utilisation du type de donn√©es Symbol en JavaScript</a></li>
<li><a href="../fr444342/index.html">D√©veloppement d'applications JavaScript simples et modernes √† l'aide de Webpack et de technologies Web avanc√©es</a></li>
<li><a href="../fr444344/index.html">10 √©tapes pour r√©ussir un projet Python</a></li>
<li><a href="../fr444346/index.html">GraphQL et Golang</a></li>
<li><a href="../fr444350/index.html">Pour une raison quelconque, MVP (produit minimum viable) ne d√©marre pas</a></li>
<li><a href="../fr444352/index.html">Kontur.Kampus: nous vous invitons √† un camp √©tudiant gratuit de d√©veloppement industriel pr√®s de Saint-P√©tersbourg</a></li>
<li><a href="../fr444356/index.html">Tutoriel React, partie 24: Le√ßon sur les seconds formulaires</a></li>
<li><a href="../fr444358/index.html">Enumerable: comment g√©n√©rer une valeur commerciale</a></li>
<li><a href="../fr444360/index.html">Injustice Google Play comme une bonne exp√©rience de vie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>