<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ぐ ぐ  Crear extensi贸n de Azure DevOps   ぐ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tenemos un proyecto con un proceso de CI / CD personalizado. Cuando el desarrollador finaliza la tarea e inyecta sus cambios en desarrollo \ qa, la co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Crear extensi贸n de Azure DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/461389/"> Tenemos un proyecto con un proceso de CI / CD personalizado.  Cuando el desarrollador finaliza la tarea e inyecta sus cambios en desarrollo \ qa, la compilaci贸n se inicia autom谩ticamente, lo que coloca la nueva versi贸n de la aplicaci贸n en el entorno de prueba.  En un mundo ideal, el probador aprende autom谩ticamente sobre las tareas que se completaron y en qu茅 entorno se implementan.  En este caso, el flujo de trabajo se vuelve continuo, ininterrumpido y requiere menos comunicaci贸n, lo que distrae el trabajo concentrado.  En la pr谩ctica, no todo es tan color de rosa. <br><br>  Y una ma帽ana, el l铆der del equipo me pregunt贸: "驴Se puede hacer algo as铆 para TFS para que las etiquetas que se adjuntan a la compilaci贸n cuelguen la etiqueta especificada despu茅s de pasar por esta compilaci贸n?" <br><br>  Decid铆 implementar mi tarea build \ release para la tarea.  Adem谩s, las fuentes de todas las tareas de compilaci贸n est谩n en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> , y toda la informaci贸n est谩 disponible. <br><br>  Nuestra tarea marca el color de la tarea, que se completa, pero no se prueba.  Gracias a esto, el desarrollador notar谩 de inmediato si olvid贸 poner la etiqueta deseada, y el control de calidad ve de inmediato lo que debe verificarse.  Esto visualiza el estado de las tareas y acelera el trabajo en el proyecto. <br><br>  En este art铆culo hablar茅 sobre la implementaci贸n de la l贸gica necesaria, el empaquetado en extensi贸n.  Entonces, si est谩 interesado en c贸mo crear dicho complemento, bienvenido a cat. <br><br>  Para los m谩s impacientes: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> y una extensi贸n lista en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mercado</a> . <br><br><img src="https://habrastorage.org/webt/pk/id/hb/pkidhbjiwp_hxtyri2tmrixkgf4.png"><br><a name="habracut"></a><br>  Azure DevOps tiene la capacidad de crear filtros que le permiten colorear las m谩scaras en el tablero en diferentes colores. <br><br><img src="https://habrastorage.org/webt/eh/nu/lj/ehnuljwjrqsqh862boczyproajc.png"><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ai/z8/pe/aiz8pewcypvkamnobuhpgiavhpo.png"></div><br><br>  Estamos interesados en tareas que: <br><br><ul><li>  completado </li><li>  vertido en el entorno de prueba </li><li>  QA a煤n no verificado </li></ul><br>  Para los art铆culos, las etiquetas byc son las m谩s adecuadas, pero configurarlas manualmente es desagradable, y todos se olvidan de hacerlo.  Entonces, escribiremos una extensi贸n que, despu茅s de la implementaci贸n, las colocar谩 autom谩ticamente. <br><br>  Por lo tanto, necesitamos el paso de compilaci贸n / lanzamiento personalizado para reducir el factor humano (el desarrollador olvid贸 poner una etiqueta) y para ayudar al control de calidad (puede ver de inmediato lo que debe verificarse). <br><br><h4>  Prerrequisitos </h4><br>  Para desarrollar la extensi贸n, necesitamos: <br><br><ol><li>  IDE favorito </li><li>  instalado TypeScript + node.js + npm (ahora he instalado las versiones 3.5.1 \ 12.4 \ 6.9.0) </li><li>  tfx-cli: biblioteca para empaquetar la extensi贸n 'a (npm i -g tfx-cli). </li></ol><br>  Tenga en cuenta la presencia de la bandera -g <br><br>  Microsoft tiene una buena <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci贸n</a> en la que est谩n en la parte superior y le dicen c贸mo crear alg煤n tipo de extensi贸n.  Adem谩s, de la misma manera, hay un dock para crear una tarea de compilaci贸n / liberaci贸n. <br><br>  En mi opini贸n, hay inconvenientes en ambos art铆culos desde el punto de vista de detallar o explicar ciertos puntos, por lo que confiar茅 en ellos, centr谩ndome en aquellos puntos que en realidad no me parec铆an del todo evidentes. <br><br>  En t茅rminos generales, puede escribir el paso build / release en una cantidad bastante grande de idiomas.  Dar茅 un ejemplo en TypeScript. <br><br><h4>  驴Por qu茅 TypeScript? </h4><br>  La primera versi贸n de build step'a fue escrita en PowerShell'e, solo nuestro equipo y un par de personas lo sab铆an.  Casi de inmediato, nos enfrentamos con el hecho de que si intentas agregar una tarea a la compilaci贸n que se ejecuta en el agente de compilaci贸n de Docker, entonces no habr谩 PowerShell y la tarea simplemente no funcionar谩.  Adem谩s, de vez en cuando, varios tipos de errores despegaban de las personas, que se atribu铆an a PowerShell kooky.  De ah铆 la conclusi贸n: la soluci贸n debe ser multiplataforma. <br><br><h4>  Estructura del proyecto </h4><br><pre><code class="plaintext hljs">|--- README.md |--- images |---extension-icon.png |--- TaskFolder (     build\release step'a) |--- vss-extension.json ( )</code> </pre> <br>  A continuaci贸n, necesitamos instalar la biblioteca para la implementaci贸n del paso de compilaci贸n'a <br><br><ol><li>  cd TaskFolder </li><li>  npm init </li><li>  npm install azure-pipelines-task-lib --save &amp;&amp; npm install @ types / node --save-dev &amp;&amp; npm install @ types / q --save-dev </li><li>  tsc --init </li></ol><br><h4>  Extensi贸n de desarrollo </h4><br>  En primer lugar, dentro del TaskFolder, necesitamos crear el archivo task.json: este es el archivo de manifiesto para el paso de compilaci贸n en s铆.  Contiene informaci贸n de servicio (versi贸n, creador, descripci贸n), un entorno para el lanzamiento y la configuraci贸n de todas las entradas, que veremos en el futuro en el formulario. <br><br>  Propongo estudiar su estructura con m谩s detalle en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci贸n</a> . <br>  En nuestro caso, habr谩 2 input'a en el formulario: la etiqueta que agregaremos a los elementos de trabajo y la elecci贸n del tipo de canalizaci贸n (compilaci贸n o lanzamiento). <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"pipelineType"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"pickList"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"Specify type of pipeline"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"helpMarkDown"</span></span>: <span class="hljs-string"><span class="hljs-string">"Specify whether task is used for build or release"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"defaultValue"</span></span>: <span class="hljs-string"><span class="hljs-string">"Build"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"options"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"Build"</span></span>: <span class="hljs-string"><span class="hljs-string">"Build"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Release"</span></span>: <span class="hljs-string"><span class="hljs-string">"Release"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"tagToAdd"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tag to add to work items"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"defaultValue"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"helpMarkDown"</span></span>: <span class="hljs-string"><span class="hljs-string">"Specify a tag that will be added to work items"</span></span> } ]</code> </pre><br>  Por nombre, en el siguiente c贸digo nos referiremos al valor de cada una de las entradas. <br>  Cree un index.ts en TaskFolder y escriba el primer fragmento de c贸digo <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tl <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'azure-pipelines-task-lib/task'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineType = tl.getInput(<span class="hljs-string"><span class="hljs-string">'pipelineType'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { tl.setResult(tl.TaskResult.Failed, err.message); } } run();</code> </pre><br>  Vale la pena se帽alar que TFS tiene una documentaci贸n muy rica en la API REST existente, pero por ahora, todo lo que tenemos que hacer es adjuntar elementos de trabajo a la compilaci贸n. <br><br>  Instale una biblioteca para una f谩cil ejecuci贸n de consultas <br><br><pre> <code class="plaintext hljs">npm install request --save &amp;&amp; npm install request-promise-native --save</code> </pre><br>  Agr茅guelo a index.ts <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> request <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"request-promise-native"</span></span>;</code> </pre><br>  Implementamos la funci贸n, que a partir de la compilaci贸n actual obtendr谩 los elementos de trabajo adjuntos <br><br><h4>  Un poco sobre autorizaci贸n </h4><br>  Para acceder a la API REST, necesitamos obtener accessToken <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> accessToken = tl.getEndpointAuthorization(<span class="hljs-string"><span class="hljs-string">'SystemVssConnection'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).parameters.AccessToken;</code> </pre><br>  A continuaci贸n, establezca la autorizaci贸n del encabezado en "Bearer $ {accessToken}" <br><br>  Volvemos a recibir elementos de trabajo vinculados a la compilaci贸n. <br><br>  El servidor Url Azure DevOps y el nombre de TeamProject se pueden obtener de las variables de entorno de la siguiente manera <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> collectionUrl = process.env[<span class="hljs-string"><span class="hljs-string">"SYSTEM_TEAMFOUNDATIONCOLLECTIONURI"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> teamProject = process.env[<span class="hljs-string"><span class="hljs-string">"SYSTEM_TEAMPROJECT"</span></span>];</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWorkItemsFromBuild</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buildId = process.env[<span class="hljs-string"><span class="hljs-string">"BUILD_BUILDID"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> uri = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${collectionUrl}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${teamProject}</span></span></span><span class="hljs-string">/_apis/build/builds/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${buildId}</span></span></span><span class="hljs-string">/workitems`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = createGetRequestOptions(uri); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> request.get(options); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.value; }</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createGetRequestOptions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uri: string</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">uri</span></span>: uri, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${accessToken}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-string"><span class="hljs-string">"content-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">json</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options; }</code> </pre><br>  Como respuesta a una solicitud GET por URL <br><br><pre> <code class="plaintext hljs">${collectionUrl}/${teamProject}/_apis/build/builds/${buildId}/workitems</code> </pre> <br>  tenemos este tipo de JSON <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"count"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"55402"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"59777"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/59777"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"60199"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/60199"</span></span> } ] }</code> </pre><br>  Para cada url, a trav茅s de la misma API REST, puede obtener datos sobre el elemento de trabajo. <br><br>  Por el momento, nuestro m茅todo de ejecuci贸n es el siguiente. <br><br>  El m茅todo para obtener elementos de trabajo de la versi贸n es casi id茅ntico al descrito anteriormente. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineType = tl.getInput(<span class="hljs-string"><span class="hljs-string">'pipelineType'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> workItemsData = pipelineType === <span class="hljs-string"><span class="hljs-string">"Build"</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromBuild() : <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromRelease(); <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { tl.setResult(tl.TaskResult.Failed, err.message); }</code> </pre><br>  El siguiente paso es obtener el conjunto actual de etiquetas para cada uno de los elementos de trabajo recibidos y agregar el que especificamos. <br><br>  Agreguemos el m茅todo de ejecuci贸n: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineType = tl.getInput(<span class="hljs-string"><span class="hljs-string">'pipelineType'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> workItemsData = pipelineType === <span class="hljs-string"><span class="hljs-string">"Build"</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromBuild() : <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromRelease(); workItemsData.forEach(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (workItem: any) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> addTagToWorkItem(workItem); }); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { tl.setResult(tl.TaskResult.Failed, err.message); } }</code> </pre> <br>  Consideremos agregar una etiqueta a los elementos de trabajo. <br><br>  Primero, necesitamos obtener la etiqueta que indicamos en el formulario. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tagFromInput = tl.getInput(<span class="hljs-string"><span class="hljs-string">'tagToAdd'</span></span>);</code> </pre><br>  Porque  Dos pasos atr谩s recibimos las URL de la API de cada elemento de trabajo, luego, con su ayuda, podemos solicitar f谩cilmente una lista de etiquetas actuales: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> uri = workItem.url + <span class="hljs-string"><span class="hljs-string">"?fields=System.Tags&amp;api-version=2.0"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getOptions = createGetRequestOptions(uri) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> request.get(getOptions);</code> </pre><br>  En respuesta, obtenemos este JSON: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">55402</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rev"</span></span>: <span class="hljs-number"><span class="hljs-number">85</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fields"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"System.Tags"</span></span>: <span class="hljs-string"><span class="hljs-string">"added-to-prod-package; test-tag"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"_links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemUpdates"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402/updates"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemRevisions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402/revisions"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemHistory"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402/history"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"html"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://..../web/wi.aspx?pcguid=e3c978d9-6ea1-406f-987d-5b03e24973a1&amp;id=55402"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemType"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../602fd27d-4e0d-4aec-82a0-dcf55c8eef73/_apis/wit/workItemTypes"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"fields"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/fields"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402"</span></span> }</code> </pre><br>  Tomamos todas las etiquetas antiguas y les agregamos una nueva: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentTags = result.fields[<span class="hljs-string"><span class="hljs-string">'System.Tags'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newTags = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentTags !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { newTags = currentTags + <span class="hljs-string"><span class="hljs-string">";"</span></span> + tagFromInput; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { newTags = tagFromInput; }</code> </pre> <br>  Enviamos una solicitud de parche al elemento de trabajo api: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> patchOptions = getPatchRequestOptions(uri, newTags); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> request.patch(patchOptions) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPatchRequestOptions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uri: string, newTags: string</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">uri</span></span>: uri, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${accessToken}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-string"><span class="hljs-string">"content-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json-patch+json"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"op"</span></span>: <span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/fields/System.Tags"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: newTags }], <span class="hljs-attr"><span class="hljs-attr">json</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options }</code> </pre><br><h4>  Montaje y embalaje extension'a </h4><br>  Por la belleza de todo lo que sucede, propongo agregar tsconfig.json a compilerOptions <pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"outDir"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist"</span></span></code> </pre>  .  Ahora, si ejecutamos el comando <code>tsc</code> dentro del TaskFolder, obtenemos la carpeta dist, dentro de la cual estar谩 index.js, que ir谩 al paquete final. <br><br>  Porque  nuestro index.js se encuentra en la carpeta dist y luego lo copiaremos tambi茅n al paquete final, necesitamos arreglar un poco task.json: <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"execution"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Node"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"target"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.js"</span></span> } }</code> </pre> <br>  En vss-extension.json en la secci贸n de archivos, debe declarar expl铆citamente lo que se copiar谩 en el paquete final. <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/dist"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/dist"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/node_modules"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/node_modules"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/icon.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/icon.png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/task.json"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/task.json"</span></span> } ]</code> </pre><br>  ltimo paso: necesitamos empacar nuestra extensi贸n. <br><br>  Para hacer esto, ejecute el comando: <br><br><pre> <code class="plaintext hljs"> tfx extension create --manifest-globs ./vss-extension.json</code> </pre> <br>  Despu茅s de la ejecuci贸n, obtenemos un archivo * .vsix, que se instalar谩 en TFS. <br><br>  El archivo PS * .vsix es esencialmente un archivo ordinario, puede abrirlo f谩cilmente a trav茅s de 7-zip, por ejemplo, y ver que todo lo que necesita est谩 realmente dentro. <br><br><h4>  A帽ade algo de belleza </h4><br>  Si desea tener una imagen cuando selecciona su paso de compilaci贸n mientras lo agrega a la tuber铆a, este archivo debe colocarse junto a task.json y llamado icon.png.  No es necesario que realice ning煤n cambio en task.json. <br><br>  Puede agregar una secci贸n a vss-extension.json: <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/logo.png"</span></span> }</code> </pre> <br>  Esta imagen se mostrar谩 en la galer铆a de extensiones locales. <br><br><h4>  Instalar extensi贸n </h4><br><ol><li>  Vaya a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tfs_server_url / _gallery / manage</a> </li><li>  Haga clic en Subir extensi贸n </li><li>  Especifique la ruta o arrastre y suelte para lanzar el archivo * .vsix recibido anteriormente </li><li>  Despu茅s de la verificaci贸n, en el men煤 contextual de la extensi贸n, seleccione ver extensi贸n, en la p谩gina que se abre, seleccione la colecci贸n en la que desea instalarla </li><li>  Despu茅s de esta extensi贸n, puede comenzar a usarla. </li></ol><br><h4>  Usando build step'a </h4><br><ol><li>  Abre la tuber铆a que necesitas </li><li>  Ir a agregar compilaci贸n step'a </li><li>  Estamos buscando extensi贸n <br><br><img src="https://habrastorage.org/webt/rx/c0/zm/rxc0zmf88g5xv535rdwop4xfkkc.png"><br></li><li>  Indicamos todas las configuraciones necesarias <br><br><img src="https://habrastorage.org/webt/hu/iv/cs/huivcsdfsc357aqcx7eiwrtbjiw.png"></li><li>  Disfruta la vida :) </li></ol><br><h4>  Conclusi贸n </h4><br>  En este art铆culo, mostr茅 c贸mo hacer un complemento para Azure DevOps, que coloca autom谩ticamente la etiqueta correcta para las tareas para el lanzamiento.  Los colegas lo incorporaron a la tuber铆a, que se ejecuta tanto en Windows como en los agentes de construcci贸n de Linux. <br><br>  Gracias a este complemento, nos ha resultado m谩s f谩cil trabajar con tareas y desarrollar un trabajo continuo en el proyecto.  Los desarrolladores ya no se distraen con cosas extra帽as, y el control de calidad aprende r谩pidamente sobre nuevas tareas de prueba. <br><br>  Una vez m谩s, recuerdo el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace de</a> descarga: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace</a> <br><br>  Esperamos comentarios y sugerencias para la revisi贸n :) <br><br><h5>  PS </h5><br>  Tambi茅n existe la idea de agregar la capacidad de eliminar las etiquetas especificadas en el complemento.  Si el probador encontr贸 un error y tiene que implementar la tarea nuevamente, puede deshacerse de las etiquetas "Verificadas". </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461389/">https://habr.com/ru/post/461389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461373/index.html">GoLand 2019.2: soporte para llamadas a funciones durante la depuraci贸n, esquemas de color mejorados, finalizaci贸n de Postfix personalizada</a></li>
<li><a href="../461379/index.html">Datos del museo Art. M贸dems de rob贸tica de EE. UU.</a></li>
<li><a href="../461381/index.html">El anonimato es una ilusi贸n. Seg煤n los datos de los conjuntos de datos an贸nimos, puede identificar personas reales</a></li>
<li><a href="../461385/index.html">Vino y ratas: el uso de resveratrol para restaurar el m煤sculo bajo la gravedad marciana</a></li>
<li><a href="../461387/index.html">Del cl谩sico y el modernismo a la fantas铆a y el steampunk: lo que leen los administradores del sistema</a></li>
<li><a href="../461395/index.html">Elemento fractal</a></li>
<li><a href="../461399/index.html">Un pedido inesperado para inicializar clases heredadas en JavaScript</a></li>
<li><a href="../461401/index.html">驴Qu茅 eres, Event Loop? O c贸mo funciona el bucle de eventos en el navegador Chrome</a></li>
<li><a href="../461403/index.html">C贸mo escribir m煤sica usando OOP</a></li>
<li><a href="../461405/index.html">C贸mo tom茅 CFA Nivel 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>