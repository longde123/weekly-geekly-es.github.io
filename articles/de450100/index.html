<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤷🏿 🦈 🌿 Codegenerierung für das Backend. Was zu generieren, wie und warum? 💗 🧑🏻‍🤝‍🧑🏻 🕐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel möchte ich zeigen, wie ein Backend-Code (und ein bisschen Front-End-Code) in unserem Unternehmen generiert wird, warum er überhaupt ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Codegenerierung für das Backend. Was zu generieren, wie und warum?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450100/"> In diesem Artikel möchte ich zeigen, wie ein Backend-Code (und ein bisschen Front-End-Code) in unserem Unternehmen generiert wird, warum er überhaupt benötigt wird und wie er besser funktioniert. <br><br>  Was genau wir generieren werden, ist nicht so wichtig. <br>  Es ist wichtig, dass wir drei Arten von Objekten beschreiben, auf deren Grundlage wir eine Frontend-Interaktion mit dem Backend generieren. An einigen Stellen erfolgt die Backend-Implementierung vollständig <br><br>  Diese Arten von Objekten: <br>  1. <i>Nachrichten</i> - Objekte, die in JSON serialisiert werden und am Informationsaustausch zwischen Frontend und Backend teilnehmen <br>  2. <i>Endpunkte</i> - URI, der das Front-End zusammen mit einer Beschreibung der HTTP-Methode, der Anforderungsparameter, des Anforderungskörpertyps und des Antwortertyps aufruft <br>  3. <i>Entitäten</i> - Dies sind Nachrichten, für die sie Standardendpunkte für Erstellen / Aktualisieren / Auflisten / Löschen haben (möglicherweise nicht alle), die in der Datenbank gespeichert sind und für die es ein Datenzugriffsobjekt oder ein Spring JPA-Repository gibt - abhängig von Technologie, aber eine Art Zugriff auf die Datenbank <br><br>  Ich mache überhaupt kein Frontend, aber <br>  1) Ich weiß, dass es in Typescript geschrieben ist, daher generieren wir auch Typoskriptklassen <br>  2) Die meisten Backend-Anforderungen stammen von Frontend-Entwicklern. <br><br><h3>  Code-Anforderungen </h3><br><br><a name="habracut"></a>  Also, was sind die Anforderungen vom Frontend? <br><br>  1. REST-ähnliche Interaktionsschnittstelle <br>  2. Monotone Antworten - json, Nutzlast im Feld 'Daten' <br>  3. Monotone Fehler Wenn im Backend eine Ausnahme aufgetreten ist, empfiehlt es sich, auch einen Stack-Trace hinzuzufügen <br>  4. "korrekte" HTTP-Codes - 404, wenn das Buch nicht gefunden wird, 400, wenn die Anforderung fehlerhaft ist (z. B. ungültiger JSON) usw. <br><br>  Ich werde dem Backend-Code "auf eigene Faust" Anforderungen hinzufügen: <br>  1. Fehlerbehandlung an einer Stelle <br>  2. Möglichkeit, den Fluss an einer beliebigen Stelle im Code zu stoppen und den gewünschten HTTP-Code zurückzugeben <br>  3. Ich möchte eine Geschäftslogik als blockierend und einige als asynchron schreiben, abhängig von den verwendeten Bibliotheken.  All dies sollte jedoch in einem asynchronen Framework funktionieren <br>  4. Es ist ratsam, dass die Backend-Entwickler überhaupt nicht an HTTP-Anforderungen und -Antworten, an Vertx-Routen und Ereignisbässe denken, sondern einfach ihre Geschäftslogik schreiben. <br><br>  Es ist ratsam, alle oben genannten Anforderungen mit Vererbung und Zusammensetzung zu implementieren und nur dort, wo dies fehlschlägt, die Codegenerierung zu verwenden <br><br>  Es ist auch ratsam, parallele Klassen für das Skript und Kotlin zu generieren, damit das Front-End dem Backend immer das sendet, was benötigt wird (und sich nicht darauf verlassen, dass die Entwickler nicht vergessen, der Klasse ein neues Feld hinzuzufügen). <br><br><h3>  Was werden wir generieren </h3><br><br>  Nehmen Sie zum Beispiel eine hypothetische Webanwendung, die Bücher speichern und bearbeiten, ihre Liste anzeigen und nach Namen suchen kann. <br><br>  In technologischer Hinsicht ist das Kotlin-Backend Vert.x eine Coroutine.  So etwas wie das, was ich im Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„Drei Paradigmen der asynchronen Programmierung in Vertx“ gezeigt habe.</a> <br><br>  Um es interessanter zu machen, werden wir auf die Datenbank zugreifen, die auf Spring Data JPA basiert. <br>  Ich sage nicht, dass Sie Spring und Vert.x in einem Projekt mischen müssen (obwohl ich es selbst mache, gebe ich zu), aber ich nehme nur Spring, da es für ihn am einfachsten ist, eine Generation basierend auf Entitäten zu zeigen. <br><br><h3>  Projektstruktur mit Generierung </h3><br><cut></cut><br>  Jetzt müssen Sie ein Projekt zur Generierung erstellen. <br>  Wir werden viele Gradle-Projekte haben.  Jetzt werde ich sie in einem Git-Repository erstellen, aber im wirklichen Leben sollte jeder in seinem eigenen sitzen, da sie sich zu unterschiedlichen Zeiten ändern und ihre eigenen Versionen haben. <br><br>  Das erste Projekt ist also ein Projekt mit Anmerkungen, die auf unsere Router, HTTP-Methoden usw. hinweisen.  Nennen <i>wir</i> es <i>metainfo</i> <br>  Zwei weitere Projekte hängen davon ab: <br>  <i>Codegen</i> und <i>API</i> <br><br>  <i>Die API</i> enthält Beschreibungen von Routern und Nachrichten - die Klassen, die zwischen dem Backend und dem Frontend hin und her gehen <br>  <i>codegen</i> ist ein Codegenerierungsprojekt (aber kein Projekt, in dem der Code generiert wird!) - es enthält die Sammlung von Informationen aus den <i>API-</i> Klassen und den eigentlichen Codegeneratoren. <br>  Die Generatoren erhalten alle Details der Generierung in Argumenten - von welchem ​​Paket die Beschreibung der Router übernommen werden soll, in welches Verzeichnis generiert werden soll, welcher Name der Velocity-Vorlage für die Generierung - d. H.  <i>metainfo</i> und <i>codegen</i> können in der Regel in völlig unterschiedlichen Projekten eingesetzt werden <br><br>  Nun, zwei Projekte, in denen die Generation tatsächlich durchgeführt wird: <br>  <i>Frontend-generiert,</i> in dem wir die Typescript-Klasse generieren, die unseren Kotlin-Nachrichten entspricht <br>  und <i>Backend</i> - mit der eigentlichen Vertx-Anwendung. <br><br>  Damit ein Projekt das Ergebnis der Kompilierung eines anderen "sehen" kann, werden wir das Plugin verwenden, um Artefakte im lokalen Maven-Repository zu veröffentlichen. <br><br>  <b><i>Metafinfo-</i> Projekt</b> : <br><br>  Anmerkungen, mit denen wir Generierungsquellen markieren - Beschreibungen von Endpunkten, Nachrichten, Entitäten: <br><pre><code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">/* Contains a number of endpoints. We will generate Vert.x router or Spring MVC controller from it*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EndpointController</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url:String) <span class="hljs-comment"><span class="hljs-comment">/* Endpoint inside a controller. Concrete URI and HTTP method. May be has query param */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Endpoint</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> method: HttpMethodName, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> param: String = <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* For empty constructor generation */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmptyConstructorMessage</span></span></span><span class="hljs-class"> /* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Make</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abstract</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">endpoint</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">logic</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">asynchronous</span></span></span><span class="hljs-class"> */ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncHandler</span></span></span><span class="hljs-class"> /* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">All</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotations</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">are</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">only</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">*/ annotation class GenerateCreate annotation class GenerateUpdate annotation class GenerateGetById annotation class GenerateList annotation class GenerateDelete /* Make CRUD implementation abstract</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">so that we will override it*/ annotation class AbstractImplementation /* Generate search by this field in DAO layer */ annotation class FindBy /* This entity is child of another entity</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">so generate end point like /parent/$id/child to bring all children of concrete parent instead of /child - bring all entities of this type */ annotation class ChildOf</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parents: KClass&lt;*&gt;) <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpMethodName</span></span></span><span class="hljs-class"> </span></span>{ POST,PUT,GET,DELETE }</code> </pre> <br>  Für Typescript-Klassen definieren wir Anmerkungen, die an die Felder gehängt werden können und in die generierte Typescript-Klasse fallen <br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsString</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsEmail</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsBoolean</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MaxLength</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> len:<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>)</code> </pre><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Quellcode des Metainfo-Projekts</a> <br><br>  <b><i>API-</i> Projekt:</b> <br><br>  Beachten Sie die Plugins noArg und jpa in build.gradle zum Generieren von Konstruktoren ohne Argumente <br><br>  Ich habe nicht genug Fantasie, daher erstellen wir einige verrückte Beschreibungen von Controllern und Entitäten für unsere Anwendung: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@EndpointController(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/util"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchRouter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Endpoint(HttpMethodName.GET, param = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"id"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String <span class="hljs-meta"><span class="hljs-meta">@Endpoint(method = HttpMethodName.POST)</span></span> <span class="hljs-meta"><span class="hljs-meta">@AsyncHandler</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(searchRequest: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SearchRequest</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">// we have no check or response type } data class SearchRequest( @field:IsString val author: String?, @field:IsEmail val someEmail: String, @field:IsString val title: String? ) @GenerateList @GenerateGetById @GenerateUpdate @Entity @AbstractImplementation data class Book( @Id @GeneratedValue(strategy = GenerationType.IDENTITY) var id: Long?, @field:IsBoolean @Column(name = "is_deleted") var hardcover: Boolean, @field:IsString @field:MaxLength(128) @Column(nullable = false, length = 128) val title: String, @field:IsString @field:MaxLength(128) @Column(nullable = false, length = 255) val author: String ) @GenerateList @GenerateGetById @GenerateUpdate @GenerateDelete @GenerateCreate @Entity @ChildOf(Book::class) data class Chapter( @Id @GeneratedValue(strategy = GenerationType.IDENTITY) var id: Long?, @Column(nullable = false, name = "book_id") var bookId: Long?, @field:IsString @field:MaxLength(128) @Column(nullable = false, length = 128) @field:FindBy val name: String, @Column(nullable = false) val page:Int )</span></span></code> </pre> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellcode des API-Projekts</a> <br><br>  <b><i>Codegen-</i> Projekt:</b> <br><br>  Zuerst definieren wir die „Deskriptoren“ - jene Klassen, die wir ausfüllen werden, indem wir die Reflexion über unser API-Projekt durchgehen: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EndPoint</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> input: String?, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> param: String?, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> output: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> method: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> handler: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> asyncHandler: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Router</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> endpoints: List&lt;EndPoint&gt;) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span></span>( name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parents: List&lt;String&gt;, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> abstractVerticle: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> crudFeatures: CrudFeatures, fields: List&lt;Field&gt;, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> children: List&lt;Entity&gt; ) : Message(name, fields) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldGenerateRouterAndVerticle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> crudFeatures.generateRouterAndVerticle() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Entity(parents=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$parents</span></span></span><span class="hljs-string">, abstractVerticle=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$abstractVerticle</span></span></span><span class="hljs-string">, crudFeatures=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$crudFeatures</span></span></span><span class="hljs-string">, children=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$children</span></span></span><span class="hljs-string">)"</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudFeatures</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> create: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> update: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> delete: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> ) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateRouterAndVerticle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list || create || update || delete || <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fields: List&lt;Field&gt;) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Field</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> validators: List&lt;Annotation&gt;, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> findBy: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>)</code> </pre><br><br>  Der Code, der die Informationen sammelt, sieht folgendermaßen aus: <br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntitiesCreator</span></span></span></span>(typeMapper: TypeMapper, frontendAnnoPackage:String) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> messagesDescriptor = MessagesCreator(typeMapper, frontendAnnoPackage) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEntities</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(entitiesPackage: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Entity&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reflections = Reflections(entitiesPackage, SubTypesScanner(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types = reflections.getSubTypesOf(Object::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class"> </span></span>{ createEntity(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEntityRestEndpoints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(entity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Entity</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;EndPoint&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name = entity.name <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url = name.toLowerCase() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> endpoints: MutableList&lt;EndPoint&gt; = mutableListOf() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.create) { endpoints.add( EndPoint(url, name, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, name, <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleNew</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) ) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>) { endpoints.add( EndPoint( <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$url</span></span></span><span class="hljs-string">/:id"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>, name, <span class="hljs-string"><span class="hljs-string">"get"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleGet</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.update) { endpoints.add( EndPoint(url, name, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, name, <span class="hljs-string"><span class="hljs-string">"put"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleUpdate</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) ) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.delete) { endpoints.add( EndPoint( <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$url</span></span></span><span class="hljs-string">/:id"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"delete"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleDelete</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.list) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.parents.isEmpty()) { endpoints.add( EndPoint( url, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"List&lt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"get"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleGetAllFor</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ) } } entity.children.forEach { endpoints.add( EndPoint( <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$url</span></span></span><span class="hljs-string">/:id/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.name.toLowerCase()}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"List&lt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"get"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleGet</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.name}</span></span></span><span class="hljs-string">For</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> endpoints } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: Entity { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Entity( aClass.simpleName, getParents(aClass), isVerticleAbstract(aClass), shouldGenerateCrud(aClass), messagesDescriptor.createFields(aClass), listOf() ) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isVerticleAbstract</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aClass.getDeclaredAnnotation(AbstractImplementation::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) != </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getParents</span></span></span></span>(aClass: Class&lt;*&gt;): List&lt;String&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aClass.getDeclaredAnnotation(ChildOf::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">)?.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parents</span></span></span><span class="hljs-class">?.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class"> </span></span>{ it.simpleName }?.requireNoNulls() ?: listOf() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldGenerateCrud</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: CrudFeatures { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> listAnno = aClass.getDeclaredAnnotation(GenerateList::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">createAnno</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aClass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getDeclaredAnnotation</span></span></span></span>(GenerateCreate::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getAnno</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aClass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getDeclaredAnnotation</span></span></span></span>(GenerateGetById::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updateAnno</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aClass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getDeclaredAnnotation</span></span></span></span>(GenerateUpdate::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">deleteAnno</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aClass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getDeclaredAnnotation</span></span></span></span>(GenerateDelete::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudFeatures</span></span></span></span>( list = listAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, create = createAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, update = updateAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, delete = deleteAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> = getAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MessagesCreator</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> typeMapper: TypeMapper, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> frontendAnnotationsPackageName: String) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createMessages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(packageName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Message&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reflections = Reflections(packageName, SubTypesScanner(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reflections.allTypes.map { Class.forName(it) }.map { createMessages(it) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createMessages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: Message { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Message(aClass.simpleName, createFields(aClass)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: List&lt;Field&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ReflectionUtils.getAllFields(aClass).map { createField(it) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createField</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(field: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">java</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">lang</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">reflect</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Field</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Field { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> annotations = field.declaredAnnotations <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Field( field.name, typeMapper.map(field.type), createConstraints(annotations), annotations.map { anno -&gt; anno::annotationClass.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() }.contains(FindBy::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">) ) } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">createConstraints</span></span></span></span>(annotations: Array&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Annotation&gt;): List&lt;Annotation&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> annotations.filter { it.toString().startsWith(<span class="hljs-string"><span class="hljs-string">"@</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$frontendAnnotationsPackageName</span></span></span><span class="hljs-string">"</span></span>) } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoutersCreator</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> typeMapper: TypeMapper, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> endpointsPackage:String ) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRouters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Router&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reflections = Reflections(endpointsPackage, SubTypesScanner(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reflections.allTypes.map { createRouter( Class.forName( it ) ) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRouter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: Router { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Router(aClass.simpleName, getUrl(aClass), ReflectionUtils.getAllMethods(aClass).map { createEndpoint(it) }) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aClass.getAnnotation(EndpointController::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getEndPointMethodName</span></span></span></span>(declaredAnnotation: Endpoint?): String { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> httpMethodName = declaredAnnotation?.method <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (httpMethodName ?: HttpMethodName.GET).name.toLowerCase() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParamName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(declaredAnnotation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Endpoint</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paramName = declaredAnnotation?.param <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (paramName ?: <span class="hljs-string"><span class="hljs-string">"id"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEndpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(method: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Method</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: EndPoint { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types = method.parameterTypes <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> declaredAnnotation: Endpoint? = method.getDeclaredAnnotation(Endpoint::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">methodName</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getEndPointMethodName</span></span></span></span>(declaredAnnotation) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = method.name <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> input: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> param: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hasInput = types.isNotEmpty() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> handlerName = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$methodName</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${StringUtils.capitalize(url)}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasInput) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inputType = types[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inputTypeName = typeMapper.map(inputType) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> createUrlParameterName = inputType == java.lang.String::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span></span>(createUrlParameterName) { param = getParamName(declaredAnnotation) url += <span class="hljs-string"><span class="hljs-string">"/:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$param</span></span></span><span class="hljs-string">"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { input = simpleName(inputTypeName) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EndPoint( url, input, param, method.returnType.toString(), methodName, handlerName, isHandlerAsync(method) ) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isHandlerAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(method: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Method</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> declaredAnnotation: AsyncHandler? = method.getDeclaredAnnotation(AsyncHandler::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">declaredAnnotation</span></span></span><span class="hljs-class"> != </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">simpleName</span></span></span></span>(name: String): String { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> index = name.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) name.substring(index + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> name } }</code> </pre><br><br>  Nun, es gibt auch Hauptklassen, die Argumente erhalten - welche Pakete sollten reflektiert werden, welche Velocity-Vorlagen verwendet werden sollen usw. <br>  Sie sind nicht so interessiert, man kann sich alles im Repository ansehen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellcode</a> <br><br>  <b>In <i>Frontend-generierten</i> und <i>Backend-</i> Projekten machen</b> wir ähnliche Dinge: <br>  1. Abhängigkeit von der <i>API</i> zur Kompilierungszeit <br>  2. Abhängigkeit von <i>Codegen</i> in der Build-Phase <br>  3. Generierungsvorlagen befinden sich im Verzeichnis <i>buildSrc,</i> in das Dateien und Code im Gradle benötigt werden, die in der Build-Phase, jedoch nicht in der Kompilierungs- oder Laufzeitphase benötigt werden.  Das heißt,  Wir können das Generierungsmuster ändern, ohne das <i>Codegen-</i> Projekt neu zu kompilieren <br>  4. <i>Frontend-generiert</i> kompiliert das generierte Typescript und veröffentlicht es im npm-Paket-Repository <br>  5. Im <i>Backend</i> werden Router generiert, die von einem nicht generierten abstrakten Router erben, der weiß, wie verschiedene Arten von Anforderungen behandelt werden.  Es werden auch vertikale Verticles generiert, die mit der Implementierung der Geschäftslogik selbst vererbt werden müssen.  Außerdem werden alle möglichen kleinen Dinge generiert, über die ich als Programmierer nicht nachdenken möchte - das Registrieren von Codecs und Adresskonstanten im Event-Bass. <br>  Quellcode <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Frontend generiert</a></i> und <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Backend</a></i> <br><br>  Beim <i>Frontend-Generieren müssen</i> Sie auf das Plugin achten, das die generierten Quellen im npm-Repository veröffentlicht.  Damit dies funktioniert, müssen Sie die IP Ihres Repositorys in build.gradle und Ihr Authentifizierungstoken in .npmrc ablegen <br><br>  Die generierten Klassen sehen folgendermaßen aus: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { IsString, MaxLength, IsDate, IsArray, } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'class-validator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Type } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'class-transformer'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Entity(parents=[], abstractVerticle=false, crudFeatures=CrudFeatures(list=true, create=true, update=true, delete=true, get=true), children=[]) export class Chapter { // Field(name=bookId, type=number, validators=[], findBy=false) bookId!: number; @IsString() @MaxLength(128) // Field(name=name, type=string, validators=[@com.valapay.test.annotations.frontend.IsString(), @com.valapay.test.annotations.frontend.MaxLength(len=128)], findBy=false) name!: string; // Field(name=id, type=number, validators=[], findBy=false) id!: number; // Field(name=page, type=number, validators=[], findBy=false) page!: number; }</span></span></code> </pre><br><br>  Beachten Sie die Anmerkungen zum Klassenvalidator tc. <br><br>  Im Backend-Projekt werden auch Repositorys für Spring Data JPA generiert. Es ist möglich zu sagen, dass das Nachrichtenverarbeitungsprojekt in Verticle blockiert (und über Vertx.executeBlocking ausgeführt wird) oder asynchron (mit Coroutinen). Es ist möglich zu sagen, dass der für Entity generierte Verticle abstrakt ist, und dann besteht die Möglichkeit Überschreiben Sie Hooks, die vor und nach dem Aufruf der generierten Methoden aufgerufen werden.  Die Verticles-Bereitstellung erfolgt automatisch an der Schnittstelle von Spring Beans - kurz gesagt, viele Extras. <br><br>  Und all dies ist einfach zu erweitern - zum Beispiel das Aufhängen einer Liste von Rollen an Endpunkten und das Generieren einer Überprüfung der Rolle des angemeldeten Benutzers beim Aufrufen des Endpunkts und vieles mehr - was für die Vorstellungskraft ausreicht. <br><br>  Es ist auch einfach, nicht Vertx, nicht Spring, sondern etwas anderes zu generieren - selbst bei akka-http reicht es aus, nur die Vorlagen im Backend-Projekt zu ändern. <br><br>  Eine andere mögliche Entwicklungsrichtung besteht darin, mehr Front-End zu generieren. <br><br>  Der gesamte Quellcode ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Vielen Dank an Ildar vom Frontend für die Hilfe bei der Erstellung der Generation in unserem Projekt und beim Schreiben des Artikels <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450100/">https://habr.com/ru/post/de450100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450090/index.html">Nachrichten aus der Welt von OpenStreetMap Nr. 457 (16.04.2019 - 22.04.2019)</a></li>
<li><a href="../de450092/index.html">Was ist was und wer ist wer auf dem DDoS-Schutzmarkt</a></li>
<li><a href="../de450094/index.html">Solarkaffee: Steigerung der Effizienz von Solarzellen durch Koffein</a></li>
<li><a href="../de450096/index.html">Automatische Katzentoilette</a></li>
<li><a href="../de450098/index.html">Yuri Bushmelev „Rechenkarte im Feld Protokollsammlung und -zustellung“ - Abschrift des Berichts</a></li>
<li><a href="../de450102/index.html">Selbsteinstellende Uhr mit elektronischer Anzeige</a></li>
<li><a href="../de450104/index.html">Sehr schwierig und sehr interessant: IT-Communities auf TechTrain</a></li>
<li><a href="../de450106/index.html">Das Projekt der Organisation von Bau und Wiederaufbau unter beengten Verhältnissen auf der SPDS-Baustelle</a></li>
<li><a href="../de450110/index.html">Geschmacksmuster: Teil zwei (Beispiele von Microsoft, Snapchat, Samsung, Netflix, Airbnb, Tinder)</a></li>
<li><a href="../de450112/index.html">Eh, was ist mit den Koffern passiert ?! Am Beispiel eines Kinderkofferscooters ZINC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>