<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♌️ 🐑 🚵🏿 Ersetzen von Redux durch Observables und React Hooks 🌞 🐴 👩🏻‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="State Management ist eine der wichtigsten Aufgaben, die bei der Entwicklung von React gelöst wurden. Viele Tools wurden entwickelt, um Entwicklern bei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ersetzen von Redux durch Observables und React Hooks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484952/"><p><img align="right" src="https://habrastorage.org/webt/fo/2d/t7/fo2dt7_8xrgtb3goulj7cwpxrpg.png">  State Management ist eine der wichtigsten Aufgaben, die bei der Entwicklung von React gelöst wurden.  Viele Tools wurden entwickelt, um Entwicklern bei der Lösung dieses Problems zu helfen.  Das beliebteste Tool ist Redux, eine kleine Bibliothek, die von Dan Abramov erstellt wurde, um Entwicklern dabei zu helfen, das Flux-Entwurfsmuster in ihren Anwendungen zu verwenden.  In diesem Artikel schauen wir uns an, ob wir Redux wirklich brauchen und wie wir es durch einen einfacheren Ansatz ersetzen können, der auf Observable und React Hooks basiert. </p><a name="habracut"></a><br><h1 id="zachem-nam-voobsche-nuzhen-redux">  Warum brauchen wir überhaupt Redux? </h1><br><p> Redux wird so oft mit React in Verbindung gebracht, dass viele Entwickler es verwenden, ohne darüber nachzudenken, warum sie Redux benötigen.  Mit React ist es einfach, eine Komponente und ihren Status mit <code>setState()</code> / <code>useState()</code> zu synchronisieren.  Aber alles wird komplizierter, sobald der Zustand von mehreren Komponenten gleichzeitig genutzt wird.  Die naheliegendste Lösung für die gemeinsame Nutzung eines Status zwischen mehreren Komponenten besteht darin, ihn (Status) auf den gemeinsamen übergeordneten Status zu verschieben.  Eine solche direkte Lösung kann jedoch schnell zu Problemen führen: Wenn die Komponenten in der Komponentenhierarchie weit voneinander entfernt sind, erfordert die Aktualisierung des allgemeinen Status ein umfangreiches Scrollen durch die Eigenschaften der Komponenten.  React Context kann dazu beitragen, die Anzahl der ausgelaufenen Inhalte zu verringern. Das Deklarieren eines neuen Kontexts bei jeder Verwendung eines Status in Verbindung mit einer anderen Komponente ist jedoch aufwändiger und kann letztendlich zu Fehlern führen. </p><br><p>  Redux löst diese Probleme, indem es ein <code>Store</code> Objekt einführt, das den gesamten Status der Anwendung enthält.  In Komponenten, die Zugriff auf den Status benötigen, wird dieser <code>Store</code> mithilfe der <code>connect</code> implementiert.  Diese Funktion stellt auch sicher, dass beim Ändern eines Status alle davon abhängigen Komponenten neu gezeichnet werden.  Um den Status zu ändern, müssen Komponenten schließlich Aktionen senden, die die Reduzierung auslösen, um den neuen geänderten Status zu berechnen. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b6f/531/9dc/b6f5319dc6eb751b9a18482cb7863f8d.gif"><br><p>  <em>Als ich zum ersten Mal die Konzepte von Redux verstand</em> </p><br><h1 id="chto-ne-tak-s-redux">  Was ist los mit Redux? </h1><br><p>  Als ich das offizielle <a href="https://redux.js.org/basics/basic-tutorial/" rel="nofollow">Redux-Tutorial zum</a> ersten Mal las, war ich am meisten beeindruckt von der großen Menge an Code, die ich schreiben musste, um den Status zu ändern.  Das Ändern des Status erfordert das Deklarieren einer neuen Aktion, das Implementieren des entsprechenden Reduzierers und das endgültige Senden der Aktion.  Redux empfiehlt auch das <a href="https://redux.js.org/basics/actions/" rel="nofollow">Schreiben eines Aktionserstellers</a> , um das Erstellen einer Aktion bei jeder <a href="https://redux.js.org/basics/actions/" rel="nofollow">Übermittlung</a> zu vereinfachen. </p><br><p>  Mit all diesen Schritten erschwert Redux das Codeverständnis, das Refactoring und das Debuggen.  Beim Lesen von Code, der von einer anderen Person geschrieben wurde, ist es oft schwierig, herauszufinden, was passiert, wenn die Aktion gesendet wird.  Zuerst müssen wir uns mit dem Code des Aktionserstellers befassen, um den entsprechenden Aktionstyp zu finden, und dann die Reduzierungen, die diesen Aktionstyp handhaben.  Die Dinge können noch komplizierter werden, wenn einige Middlewares wie Redux-Saga verwendet werden, wodurch der Lösungskontext noch impliziter wird. </p><br><p>  Und schließlich kann Redux bei der Verwendung von TypeScript enttäuschend sein.  Aktionen sind konstruktionsbedingt einfach Zeichenfolgen, die mit zusätzlichen Parametern verknüpft sind.  Es gibt Möglichkeiten, gut typisierten Redux-Code mit TypeScript zu schreiben, aber dies kann sehr mühsam sein und wiederum zu einer Erhöhung der zu schreibenden Codemenge führen. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b0e/9ff/261/b0e9ff26168370d91b5433ad8b1ae4fe.gif"><br><p>  <em>Der Nervenkitzel beim Lernen von Code, der mit Redux geschrieben wurde</em> </p><br><h1 id="observable-i-hook-prostoy-podhod-k-upravleniyu-sostoyaniem">  Observable and Hook: Ein einfacher Ansatz zur Verwaltung des Staates. </h1><br><h3 id="zamenyaem-store-c-pomoschyu-observable">  Ersetzen Sie Store durch Observable </h3><br><p>  Um das Problem der Statusfreigabe auf einfachere Weise zu lösen, müssen wir zunächst eine Möglichkeit finden, Komponenten zu benachrichtigen, wenn andere Komponenten ihren allgemeinen Status ändern.  Dazu erstellen wir eine <code>Observable</code> Klasse, die einen einzelnen Wert enthält und die es Komponenten ermöglicht, Änderungen an diesem Wert zu abonnieren.  Die Abonnementmethode gibt die Funktion zurück, die aufgerufen werden muss, um das Abonnement für <code>Observable</code> . </p><br><p>  Unter TypeScript ist die Implementierung einer solchen Klasse recht einfach: </p><br><pre> <code class="javascript hljs">type Listener&lt;T&gt; = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val: T</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; type Unsubscriber = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ private _listeners: Listener&lt;T&gt;[]; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private _val: T) {} get(): T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val; } set(val: T) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val !== val) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val = val; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">l</span></span></span><span class="hljs-function"> =&gt;</span></span> l(val)); } } subscribe(listener: Listener&lt;T&gt;): Unsubscriber { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.push(listener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">l</span></span></span><span class="hljs-function"> =&gt;</span></span> l !== listener); }; } }</code> </pre> <br><p>  Wenn Sie diese Klasse mit dem Redux <code>Store</code> , werden Sie <code>getState()</code> , dass sie sich sehr ähnlich sind: <code>get()</code> entspricht <code>getState()</code> und <code>subscribe()</code> ist dasselbe.  Der Hauptunterschied ist die Methode <code>dispatch()</code> , die durch die einfachere Methode <code>set()</code> , mit der Sie den darin enthaltenen Wert ändern können, ohne auf die Reduzierung angewiesen zu sein.  Ein weiterer wesentlicher Unterschied ist, dass wir im Gegensatz zu Redux viel <code>Observable</code> anstelle eines einzelnen <code>Store</code> , der den gesamten Status enthält. </p><br><h3 id="zamenyaem-reducer-servisami">  Reduzierungsservices ersetzen </h3><br><p>  Jetzt kann <code>Observable</code> verwendet werden, um den allgemeinen Zustand zu speichern, aber wir müssen noch die im Reduzierer enthaltene Logik verschieben.  Dafür verwenden wir das Konzept der Dienstleistungen.  Services sind Klassen, die die gesamte Geschäftslogik unserer Anwendungen implementieren.  Versuchen wir, den Reducer <code>Todo</code> aus dem Redux-Tutorial mit <code>Observable</code> in den <code>Todo</code> Service umzuschreiben: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observable"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Todo { readonly text: string; readonly completed: boolean; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> enum VisibilityFilter { SHOW_ALL, SHOW_COMPLETED, SHOW_ACTIVE, } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TodoService</span></span></span><span class="hljs-class"> </span></span>{ readonly todos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observable&lt;Todo[]&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">readonly</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">visibilityFilter</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Observable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter.SHOW_ALL</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">addTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text: string</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[...</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.todos.get(</span></span></span><span class="hljs-function">), { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">completed</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">false</span></span></span><span class="hljs-function"> }]); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">toggleTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index: number</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.todos.get(</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">map</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> (todo, i</span></span></span><span class="hljs-function">) =&gt;</span></span> (i === index ? { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: todo.text, <span class="hljs-attr"><span class="hljs-attr">completed</span></span>: !todo.completed } : todo) )); } setVisibilityFilter(filter: VisibilityFilter) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.visibilityFilter.set(filter); } }</code> </pre> <br><p>  Vergleicht man dies mit dem Reduzierer <code>Todo</code> , können wir die folgenden Unterschiede feststellen: </p><br><ul><li>  Aktionen wurden durch Methoden ersetzt, sodass kein Aktionstyp, keine Aktion selbst und kein Aktionsersteller deklariert werden müssen. </li><li>  Sie müssen keinen großen Schalter mehr schreiben, um zwischen den Aktionstypen zu wechseln.  Dafür sorgt der dynamische Javascript-Versand (d. H. Methodenaufrufe). </li><li>  Und am wichtigsten ist, dass der Service den von ihm verwalteten Status enthält und ändert.  Dies ist ein großer konzeptioneller Unterschied zu Reduzierern, die reine Funktionen sind. </li></ul><br><h2 id="dostup-k-servisam-i-observable-iz-komponentov">  Zugang zu Diensten und von Komponenten aus beobachtbar </h2><br><p>  Nachdem wir "Store and Reducer from Redux" durch "Observable and Services" ersetzt haben, müssen wir die Services für alle React-Komponenten verfügbar machen.  Hierfür gibt es mehrere Möglichkeiten: Wir könnten das IoC-Framework verwenden, z. B. Inversify.  Verwenden Sie den Kontext Reagieren oder verwenden Sie denselben Ansatz wie in <code>Store</code> Redux - eine globale Instanz für jeden Dienst.  In diesem Artikel betrachten wir den letzten Ansatz: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TodoService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./todoService"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todoService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TodoService();</code> </pre> <br><p>  Jetzt können wir auf den freigegebenen Status zugreifen und ihn in allen React-Komponenten ändern, indem wir eine Instanz von <code>todoService</code> importieren.  Wir müssen jedoch noch einen Weg finden, um unsere Komponenten neu zu zeichnen, wenn der allgemeine Status durch eine andere Komponente geändert wird.  Dazu schreiben wir einen einfachen Hook, der der Komponente eine Statusvariable hinzufügt, die <code>Observable</code> abonniert und die Statusvariable aktualisiert, wenn sich der <code>Observable</code> Wert ändert: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useEffect, useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observable"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useObservable</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">observable: Observable&lt;T&gt;</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [val, setVal] = useState(observable.get()); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { setVal(observable.get()); <span class="hljs-comment"><span class="hljs-comment">//   @mayorovp return observable.subscribe(setVal); }, [observable]); return val; }</span></span></code> </pre> <br><h1 id="sobiraem-vse-vmeste">  Alles zusammen </h1><br><p>  Unser Toolkit ist fertig.  Wir können <code>Observable</code> , um den allgemeinen Status in Diensten zu speichern, und <code>useObservable</code> um sicherzustellen, dass Komponenten immer mit diesem Status synchron sind. </p><br><p>  Lassen Sie uns die TodoList-Komponente aus dem Redux-Tutorial mit dem neuen Hook umschreiben: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useObservable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observableHook"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { todoService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./services"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Todo, VisibilityFilter } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./todoService"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TodoList = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todos = useObservable(todoService.todos); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = useObservable(todoService.visibilityFilter); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> visibleTodos = getVisibleTodos(todos, filter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; &lt;ul&gt; {visibleTodos.map((todo, index</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">TodoItem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{index}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">todo</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{todo}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{index}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;p&gt; Show: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FilterLink</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">filter</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{VisibilityFilter.SHOW_ALL}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">All</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FilterLink</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>, &lt;FilterLink filter={VisibilityFilter.SHOW_ACTIVE}&gt;Active&lt;<span class="hljs-regexp"><span class="hljs-regexp">/FilterLink&gt;, &lt;FilterLink filter={VisibilityFilter.SHOW_ALL}&gt;Completed&lt;/</span></span>FilterLink&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ); }; const TodoItem = ({ todo: { text, completed }, index }: { todo: Todo; index: number }) =&gt; { return ( &lt;li style={{ textDecoration: completed ? "line-through" : "none", }} onClick={() =&gt; todoService.toggleTodo(index)} &gt; {text} &lt;/</span></span>li&gt; ); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FilterLink = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ filter, children }: { filter: VisibilityFilter; children: React.ReactNode }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> activeFilter = useObservable(todoService.visibilityFilter); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> active = filter === activeFilter; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> active ? <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;span&gt;{children}&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/span&gt; ) : ( &lt;a href="" onClick={() =&gt; todoService.setVisibilityFilter(filter)}&gt; {children} &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">a&gt; </span></span></span><span class="hljs-function">); }; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getVisibleTodos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos: Todo[], filter: VisibilityFilter</span></span></span><span class="hljs-function">): </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Todo</span></span></span><span class="hljs-function">[] { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">switch</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_ALL</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_COMPLETED</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t =&gt; t.completed</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_ACTIVE</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t =&gt; !t.completed</span></span></span><span class="hljs-function">); } }</span></span></code> </pre> <br><p>  Wie wir sehen können, haben wir mehrere Komponenten geschrieben, die sich auf allgemeine <code>todos</code> beziehen ( <code>todos</code> und <code>visibilityFilter</code> ).  Diese Werte werden einfach durch Aufrufen von Methoden aus <code>todoService</code> .  Dank des Hooks useObservable, der Wertänderungen abonniert, werden diese Komponenten automatisch neu gezeichnet, wenn sich der allgemeine Status ändert. </p><br><h1 id="vyvod">  Fazit </h1><br><p>  Wenn wir diesen Code mit dem Redux-Ansatz vergleichen, werden wir mehrere Vorteile sehen: </p><br><ul><li>  <strong>Prägnanz: Das</strong> Einzige, was wir tun mussten, war, die <code>useObservable</code> in <code>Observable</code> <code>useObservable</code> und den Hook <code>useObservable</code> wenn auf diese Werte von den Komponenten aus <code>useObservable</code> .  Es ist nicht erforderlich, eine Aktion zu deklarieren, eine Aktion zu <code>mapStateToProps</code> , eine Reduzierung zu schreiben oder zu kombinieren oder unsere Komponenten mit den <code>mapDispatchToProps</code> <code>mapStateToProps</code> und <code>mapDispatchToProps</code> mit dem <code>mapStateToProps</code> <code>mapDispatchToProps</code> . </li><li>  <strong>Einfachheit:</strong> Jetzt ist es viel einfacher, die Codeausführung zu verfolgen.  Um zu verstehen, was beim Drücken einer Taste tatsächlich passiert, müssen Sie lediglich zur Implementierung der aufgerufenen Methode wechseln.  Die schrittweise Ausführung mit dem Debugger wird ebenfalls erheblich verbessert, da keine Zwischenstufe zwischen unseren Komponenten und unseren Services besteht. </li><li>  Typensicherheit ab Werk <strong>:</strong> TypeScript-Entwickler benötigen keine zusätzliche Arbeit, um den Code korrekt eingeben zu können.  Es ist nicht erforderlich, Typen für den Status und für jede Aktion zu deklarieren. </li><li>  <strong>Unterstützung für async / await:</strong> Obwohl dies hier nicht demonstriert wurde, <strong>eignet sich</strong> diese Lösung hervorragend für asynchrone Funktionen und vereinfacht die asynchrone Programmierung erheblich.  Sie müssen sich nicht auf Middleware wie Redux-Thunk verlassen, für deren Verständnis fundierte Kenntnisse der funktionalen Programmierung erforderlich sind. </li></ul><br><p>  Natürlich bietet Redux immer noch einige wichtige Vorteile, insbesondere Redux DevTools, mit denen Entwickler Statusänderungen während der Entwicklung überwachen und rechtzeitig zu früheren Anwendungsstatus wechseln können, was ein großartiges Debugging-Tool sein kann.  Aber meiner Erfahrung nach habe ich das selten genutzt, und der zu zahlende Preis scheint zu hoch für einen kleinen Gewinn. </p><br><p>  In all unseren React- und React Native-Anwendungen haben wir erfolgreich einen Ansatz verwendet, der dem in diesem Artikel beschriebenen ähnelt.  Tatsächlich hatten wir nie das Bedürfnis nach einem komplexeren Staatsverwaltungssystem als diesem. </p><br><h1 id="primechaniya">  Hinweise </h1><br><p>  Die in diesem Beitrag vorgestellte <code>Observable</code> Klasse ist ziemlich einfach.  Es kann durch fortgeschrittenere Implementierungen wie Micro Observables (unsere eigene Bibliothek) oder RxJS ersetzt werden. </p><br><p>  Die hier vorgestellte Lösung ähnelt der, die mit MobX erreicht werden kann.  Der Hauptunterschied besteht darin, dass MobX eine tiefgreifende Veränderbarkeit des Zustands von Objekten unterstützt.  Es ist auch darauf angewiesen, dass ES6-Proxys Änderungen melden, implizit neu rendern und das Debuggen erschweren, wenn die Dinge nicht wie erwartet funktionieren.  Darüber hinaus funktioniert MobX nicht gut mit asynchronen Funktionen. </p><br><blockquote>  Von einem Übersetzer: Diese Publikation, die als Einführung in die Zustandsverwaltung mit Observable betrachtet werden kann, ist eine Fortsetzung des Themas, das im Artikel <a href="https://habr.com/ru/post/483526/">Verwalten des Anwendungszustands mit RxJS / Immer als einfache Alternative zu Redux / MobX behandelt wird</a> , in dem beschrieben wird, wie die Verwendung dieses Ansatzes vereinfacht wird. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484952/">https://habr.com/ru/post/de484952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484934/index.html">Von der persönlichen Entwicklung zu Agile im XXXL-Maßstab in zwei Tagen bei TeamLead Conf</a></li>
<li><a href="../de484936/index.html">Wissen und Kompetenzen im Team: Finden, sehen, pumpen</a></li>
<li><a href="../de484944/index.html">Was ist mir in ACID oder passt nicht zu uns</a></li>
<li><a href="../de484946/index.html">GPR-Modellierung</a></li>
<li><a href="../de484948/index.html">NEC hat ein U-Boot-Kabel mit einem Rekord von 20 Glasfaserpaaren herausgebracht</a></li>
<li><a href="../de484954/index.html">Visuelle Fehlerbehebung für Kubernetes</a></li>
<li><a href="../de484964/index.html">Konfigurieren des Lastenausgleichs in InfoWatch Traffic Monitor</a></li>
<li><a href="../de484966/index.html">Vorgefertigte Vorlage zum Testen mit Spring</a></li>
<li><a href="../de484968/index.html">WPF DataGrid. Kampf um Vorlage</a></li>
<li><a href="../de484972/index.html">Wine 5.0 veröffentlicht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>