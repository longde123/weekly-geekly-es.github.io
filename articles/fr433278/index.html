<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜüèæ üñïüèª üå¶Ô∏è Programmation WebGL-wind et GPU. Conf√©rence √† FrontTalks 2018 üéì üë®‚Äç‚ù§Ô∏è‚Äçüë® üè•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour le rendu de graphiques complexes sur des pages Web, il existe une biblioth√®que de graphiques Web, abr√©g√©e en WebGL. Le concepteur d'interface Dmi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Programmation WebGL-wind et GPU. Conf√©rence √† FrontTalks 2018</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/433278/">  Pour le rendu de graphiques complexes sur des pages Web, il existe une biblioth√®que de graphiques Web, abr√©g√©e en WebGL.  Le concepteur d'interface Dmitry Vasiliev a parl√© de la programmation GPU du point de vue d'un concepteur de mise en page, de ce qu'est WebGL et de la mani√®re dont nous avons r√©solu le probl√®me de la visualisation de donn√©es m√©t√©orologiques volumineuses √† l'aide de cette technologie. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-yvY4-ovavo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - Je d√©veloppe des interfaces au bureau d'Ekaterinbourg de Yandex.  J'ai commenc√© dans le groupe Sport.  Nous d√©veloppions des projets sportifs sp√©ciaux lors des championnats du monde de hockey, de football, des Jeux olympiques, des Jeux paralympiques et d'autres √©v√©nements sympas.  J'ai √©galement travaill√© sur le d√©veloppement de r√©sultats de recherche sp√©ciaux, d√©di√©s √† la nouvelle piste de Sotchi. <br><br><a name="habracut"></a><img src="https://habrastorage.org/webt/5p/l2/e_/5pl2e_nhpyefyjt0q3wfspflpyc.jpeg"><br><br><img src="https://habrastorage.org/webt/qw/zy/xd/qwzyxdlvu0jukewd-9prrerk-a8.jpeg"><br><br><img src="https://habrastorage.org/webt/uy/7b/mp/uy7bmpkufgne4mck5yiawv3mj1o.jpeg"><br><br><img src="https://habrastorage.org/webt/q6/cu/kw/q6cukwvmpmwru6iew_ranhk7mwo.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sup></sub> </h5><br>  De plus, dans un casque et demi, nous avons red√©marr√© le service Work on Errors.  Et puis le travail a commenc√© √† Pogoda, o√π j'√©tais engag√© dans le soutien de l'op√©rabilit√© de l'API, son d√©veloppement, l'√©criture de l'infrastructure autour de cette API et l'√©criture de liants de n≈ìuds pour les formules d'apprentissage automatique form√©es. <br><br><img src="https://habrastorage.org/webt/sz/xs/zy/szxszynumbssi9qyhkxwalfmsdy.jpeg"><br><br>  Puis le travail a commenc√© plus int√©ressant.  Particip√© √† la refonte de nos services m√©t√©o.  Ordinateurs de bureau, brouettes. <br><br><img src="https://habrastorage.org/webt/io/q4/cw/ioq4cwweh1vbjyqonlto5yuo_1e.jpeg"><br><br><img src="https://habrastorage.org/webt/ij/er/w6/ijerw62hpfkj2kvph4wvuag_www.jpeg"><br><br>  Apr√®s avoir mis les pr√©visions standard en ordre, nous avons d√©cid√© de faire les pr√©visions que personne n'a.  Cette pr√©vision √©tait la pr√©vision du mouvement des pr√©cipitations √† travers les territoires. <br><br><img src="https://habrastorage.org/webt/xc/n_/cf/xcn_cfakd_xnyoxaazxgc4bvmso.jpeg"><br><br>  Il existe des radars m√©t√©orologiques sp√©ciaux qui d√©tectent les pr√©cipitations dans un rayon de 2000 km, ils connaissent leur densit√© et leur distance. <br><br><img src="https://habrastorage.org/webt/as/ea/av/aseaavvwl0v3lqhex1kx_dvsr1w.jpeg"><br><br>  En utilisant ces donn√©es et en pr√©disant √† l'aide de l'apprentissage automatique de leur mouvement ult√©rieur, nous avons fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une telle visualisation</a> sur la carte.  Vous pouvez vous d√©placer d'avant en arri√®re. <br><br><img src="https://habrastorage.org/webt/jt/qo/fj/jtqofjz8eo8wrjybcydczpxse0a.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sup></sub> </h5><br>  Nous avons regard√© les critiques des gens.  Les gens ont aim√©.  Toutes sortes de m√®mes ont commenc√© √† appara√Ætre, et il y avait des images sympas lorsque Moscou inondait l'enfer. <br><br>  Puisque tout le monde aimait le format, nous avons d√©cid√© de passer √† autre chose et de consacrer les pr√©visions suivantes au vent. <br><br><img src="https://habrastorage.org/webt/kl/mc/_f/klmc_fqnedxn-okos6d6bhmlszs.jpeg"><br><br>  Les services qui montrent les pr√©visions de vent sont d√©j√† l√†.  Ce sont quelques-uns de ceux qui se distinguent. <br><br><img src="https://habrastorage.org/webt/vo/vc/4k/vovc4kev5lhxvyph9t46z4uhei8.jpeg"><br><br>  En les regardant, nous avons r√©alis√© que nous voulions faire de m√™me - ou du moins pas pire. <br><br>  Par cons√©quent, nous avons d√©cid√© de visualiser les particules qui se d√©placent en douceur sur la carte en fonction de la vitesse du vent, et de laisser une sorte de boucle pour qu'elles puissent √™tre vues, la trajectoire du vent peut √™tre vue. <br><br>  Comme nous sommes d√©j√† g√©niaux et avons fait une carte cool avec des pr√©cipitations en utilisant une toile 2D, nous avons d√©cid√© de faire de m√™me avec les particules. <br><br><img src="https://habrastorage.org/webt/hz/jd/yi/hzjdyivbulbjmfod7n2-nix8uca.jpeg"><br><br>  Apr√®s avoir consult√© le concepteur, nous avons r√©alis√© que nous devons remplir environ 6% de l'√©cran avec des particules pour avoir un effet cool. <br><br>  Pour dessiner un tel nombre de particules en utilisant l'approche standard, nous avions un timing minimum de 5 ms. <br><br><img src="https://habrastorage.org/webt/yu/l1/7n/yul17ngn7dfm6cadtcy2dpkf6zu.jpeg"><br><br>  Si vous pensez que nous devons encore d√©placer les particules et apporter une sorte de beaut√© telle que dessiner la queue des particules, nous pouvons supposer que nous tomberons pendant un temps minimum de 40 ms pour afficher une animation fluide afin de produire au moins 25 images par seconde. <br><br>  Le probl√®me est qu'ici, chaque particule serait trait√©e s√©quentiellement.  Mais que se passe-t-il si vous les traitez en parall√®le? <br><br>  Une distinction claire entre le fonctionnement des processeurs centraux et graphiques a √©t√© montr√©e par ¬´Legend Destroyers¬ª lors d'une des conf√©rences.  Ils ont d√©ploy√© une machine sur laquelle un marqueur de paintball a √©t√© install√©, dont la t√¢che √©tait de dessiner un smiley d'une seule couleur.  En environ 10 secondes, il a dessin√© une telle image.  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers la vid√©o</a> - environ.) <br><br><img src="https://habrastorage.org/webt/kk/pi/cw/kkpicwfdskxnicbu0jb7sowhgfq.jpeg"><br><br><img src="https://habrastorage.org/webt/zd/ka/3a/zdka3al72tgfcavb5yvww_qx2ug.jpeg"><br><br><img src="https://habrastorage.org/webt/i9/tm/kh/i9tmkhykoiz8vkim-vzftxjjl44.jpeg"><br><br>  Ensuite, les gars ont d√©ploy√© un cano√´, qui est un GPU, et quelques broches ont peint Mona Lisa.  C'est ainsi que la vitesse de calcul du CPU et du GPU est diff√©rente. <br><br><img src="https://habrastorage.org/webt/dm/x-/hc/dmx-hckqzdlztdat2wm-j88cj-k.jpeg"><br><br><img src="https://habrastorage.org/webt/zg/pa/3m/zgpa3m281vzirvjqotbuoqnmms8.jpeg"><br><br><img src="https://habrastorage.org/webt/hq/lf/uj/hqlfujoqgr4mhgxucjpx7xnmedu.jpeg"><br><br><img src="https://habrastorage.org/webt/qb/zo/xz/qbzoxzq0tywqxi0pc2xifdnvnds.jpeg"><br><br><img src="https://habrastorage.org/webt/d6/z5/kq/d6z5kq5c23fjmb2uzfx4aqqj3ec.jpeg"><br><br>  Pour tirer parti de ces fonctionnalit√©s dans un navigateur, la technologie WebGL a √©t√© invent√©e. <br><br>  Qu'est ce que c'est  Avec cette question, je suis mont√© sur Internet.  En ajoutant quelques mots avec animation de particules et vent, j'ai trouv√© quelques articles. <br><br><img src="https://habrastorage.org/webt/ob/d-/w_/obd-w_edp80lvmzlh3xmh437itw.jpeg"><br><h5>  <sub><sup>Liens depuis la diapositive: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premier</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deuxi√®me</a></sup></sub> </h5><br>  L'un d'eux est une d√©mo de Vladimir Agafonkin, un ing√©nieur de Mapbox, qui a fait le vent sur WebGL et a fait r√©f√©rence au blog de Chris Wellons, qui a expliqu√© comment d√©placer et stocker l'√©tat des particules sur le GPU. <br><br>  Nous prenons et copions.  Nous attendons un tel r√©sultat.  Ici, les particules se d√©placent en douceur. <br><br><img src="https://habrastorage.org/webt/s6/5t/7-/s65t7-020jphv-fvyzbk5vpkmoq.jpeg"><br><br>  Nous ne comprenons pas quoi. <br><br><img src="https://habrastorage.org/webt/7n/8i/t1/7n8it1gwmfklms2akt9nydmgima.jpeg"><br><br>  Essayer de comprendre le code.  Am√©lioration, obtenant √† nouveau un r√©sultat insatisfaisant.  Nous montons encore plus profond√©ment - nous obtenons de la pluie au lieu du vent. <br><br><img src="https://habrastorage.org/webt/n4/bd/b1/n4bdb1-ar38mb8lokfjfgjqbrue.jpeg"><br><br>  D'accord, nous d√©cidons de le faire nous-m√™mes. <br><br><img src="https://habrastorage.org/webt/lw/ue/kv/lwuekvj_c1996sjj2q1c2fl4pyk.jpeg"><br><br>  Pour fonctionner avec WebGL, des cadres existent.  Presque tous visent √† travailler avec des objets 3D.  Nous n'avons pas besoin de ces capacit√©s 3D.  Il suffit de dessiner une particule et de la d√©placer.  Par cons√©quent, nous d√©cidons de tout faire avec nos mains. <br><br><img src="https://habrastorage.org/webt/rt/db/4z/rtdb4zokw74ivcedzljp4t3fu_g.jpeg"><br><br>  Il existe actuellement deux versions de la technologie WebGL.  La deuxi√®me version, qui est cool, a une version tr√®s moderne du langage de programmation dans lequel le programme est ex√©cut√© dans l'adaptateur graphique, peut effectuer directement des calculs, et pas seulement dessiner.  Mais il a une mauvaise compatibilit√©. <br><br><img src="https://habrastorage.org/webt/yk/gr/ty/ykgrtypkwclnix0f4pat1retheu.jpeg"><br><br>  Eh bien, nous d√©cidons d'utiliser l'ancien WebGL 1 √©prouv√©, qui a un bon support en plus d'Opera Mini, dont personne n'a besoin. <br><br><img src="https://habrastorage.org/webt/sr/1q/xr/sr1qxr_ch7enl9z1rjwuv1hshpg.jpeg"><br><br>  WebGL est une chose √† deux composants.  Il s'agit de JS qui ex√©cute l'√©tat des programmes qui s'ex√©cutent sur la carte graphique.  Et il y a des composants qui s'ex√©cutent directement sur la carte graphique. <br><br>  Commen√ßons par JS.  WebGL est juste le contexte appropri√© pour l'√©l√©ment canvas.  De plus, √† la r√©ception de ce contexte, ce n'est pas seulement un objet sp√©cifique qui est allou√©, les ressources en fer sont allou√©es.  Et si nous ex√©cutons quelque chose de beau sur WebGL dans un navigateur, puis d√©cidons de jouer √† Quake, il est fort possible que ces ressources soient perdues, que le contexte soit perdu et que votre programme entier se brise. <br><br><img src="https://habrastorage.org/webt/y3/bm/p0/y3bmp0fddy1vkxkktxantfrfcdw.jpeg"><br><br>  Par cons√©quent, lorsque vous travaillez avec WebGL, vous devez √©galement √©couter la perte de contexte et pouvoir la r√©cup√©rer.  Par cons√©quent, j'ai soulign√© que init est. <br><br><img src="https://habrastorage.org/webt/aj/iu/zk/ajiuzkpsukwyhrhvte4oduqivri.jpeg"><br><br>  De plus, tout le travail de JS se r√©sume √† collecter des programmes qui s'ex√©cutent sur le GPU, √† leur envoyer une carte graphique, √† d√©finir certains param√®tres et √† dire ¬´dessiner¬ª. <br><br><img src="https://habrastorage.org/webt/3k/2m/zd/3k2mzdhdejzpaxjrx_upik6fdeu.jpeg"><br><br>  Dans WebGL, si vous regardez l'√©l√©ment de contexte lui-m√™me, vous voyez un tas de constantes.  Ces constantes font r√©f√©rence aux adresses en m√©moire.  Ils ne sont pas vraiment constants dans le processus du programme.  Parce que si le contexte est perdu et restaur√© √† nouveau, un autre pool d'adresses peut √™tre allou√©, et ces constantes seront diff√©rentes pour le contexte actuel.  Par cons√©quent, presque toutes les op√©rations dans WebGL c√¥t√© JS sont effectu√©es via des utilitaires.  Personne ne veut faire le travail de routine pour trouver des adresses et autres d√©chets. <br><br><img src="https://habrastorage.org/webt/ii/o7/sa/iio7sahs5z0gt5bccxesgiict44.jpeg"><br><br>  Nous passons √† ce qui est effectu√© sur la carte vid√©o elle-m√™me - un programme compos√© de deux ensembles d'instructions √©crites dans un langage GLSL de type C.  Ces instructions sont appel√©es vertex shader et fragment shader.  Un programme est cr√©√© √† partir de leur paire. <br><br><img src="https://habrastorage.org/webt/qg/fu/lb/qgfulbs6almqwpkmutcsxv38-cm.jpeg"><br><br>  Quelle est la diff√©rence entre ces shaders?  Le vertex shader d√©finit la surface sur laquelle quelque chose doit √™tre dessin√©.  Une fois la primitive d√©finie, qui doit √™tre repeinte, le fragment shader qui tombe dans cette plage est appel√©. <br><br><img src="https://habrastorage.org/webt/up/h_/ya/uph_yasoh3q-99otxdym43zykmw.jpeg"><br><br><img src="https://habrastorage.org/webt/u7/vi/qb/u7viqbviwm76x4ovlvion5mm2o8.jpeg"><br><br>  En code, cela ressemble √† ceci.  Le shader a une section pour d√©clarer les variables qui sont d√©finies en externe √† partir de JS, leur type et leur nom sont d√©termin√©s.  Ainsi que la section principale, qui ex√©cute le code n√©cessaire √† cette it√©ration. <br><br>  Dans la plupart des cas, un vertex shader devrait d√©finir la variable gl_Position sur des coordonn√©es dans un espace √† quatre dimensions.  Ce sont x, y, z et la largeur de l'espace, ce qui n'est pas tr√®s n√©cessaire √† conna√Ætre pour le moment. <br><br>  Le shader de fragment s'attend √† d√©finir la couleur d'un pixel sp√©cifique. <br><br>  Dans cet exemple, la couleur des pixels est s√©lectionn√©e dans la texture connect√©e. <br><br><img src="https://habrastorage.org/webt/y8/nw/1y/y8nw1y1gnwstkv2rgqxatduyuni.jpeg"><br><br>  Pour transf√©rer cela vers JS, enveloppez simplement le code source des shaders dans des variables. <br><br><img src="https://habrastorage.org/webt/ax/fz/ou/axfzouj0xwui47sftwgdhlcadd0.jpeg"><br><br>  De plus, ces variables sont transform√©es en shaders.  Il s'agit d'un contexte WebGL, nous cr√©ons des shaders √† partir de codes sources, cr√©ons un programme en parall√®le et nous attachons quelques shaders au programme.  Nous obtenons un programme viable. <br><br>  Sur le chemin, nous v√©rifions que la compilation des shaders a √©t√© r√©ussie, que le programme a √©t√© construit avec succ√®s.  Nous disons que vous devez utiliser ce programme, car il peut y avoir plusieurs programmes pour diff√©rentes valeurs de rendu. <br><br>  Configurez-le et dites dessiner.  Il se r√©v√®le une sorte d'image. <br><br><img src="https://habrastorage.org/webt/oz/py/ri/ozpyrifyoft_invjrawmmz-_fjg.jpeg"><br><br>  Mont√© plus profond√©ment.  Dans le vertex shader, tous les calculs sont effectu√©s dans un espace compris entre -1 et 1, quelle que soit la taille de votre point de sortie.  Par exemple, l'espace de -1 √† 1 peut occuper la totalit√© de l'√©cran 1920 x 1080. Pour dessiner un triangle au centre de l'√©cran, vous devez dessiner une surface qui couvre la coordonn√©e 0, 0. <br><br><img src="https://habrastorage.org/webt/4q/yp/ex/4qypexiothorcvzkrk9y_p5v9tk.jpeg"><br><br>  Le fragment shader fonctionne dans l'espace de 0 √† 1, et les couleurs sont affich√©es par quatre composants: R, G, B, Alpha. <br><br>  En utilisant CSS comme exemple, vous pourriez rencontrer une notation de couleur similaire lorsque vous utilisez des pourcentages. <br><br><img src="https://habrastorage.org/webt/ys/cn/kn/yscnkn-8x_yg0bl_zknm-42l17q.jpeg"><br><br>  Pour dessiner quelque chose, vous devez dire quelles donn√©es doivent √™tre dessin√©es.  Sp√©cifiquement pour un triangle, nous d√©finissons un tableau typ√© de trois sommets, chacun compos√© de trois composantes, x, y et suffisamment. <br><br>  Dans ce cas, le vertex shader ressemble √† l'obtention de la paire actuelle de points, de coordonn√©es, ainsi qu'√† la d√©finition de ces coordonn√©es √† l'√©cran.  Ici, en l'√©tat, sans transformations, nous mettons un point sur l'√©cran. <br><br><img src="https://habrastorage.org/webt/up/h_/ya/uph_yasoh3q-99otxdym43zykmw.jpeg"><br><br>  Le shader de fragment peut colorer les constantes pass√©es de JS avec la couleur, √©galement sans calculs suppl√©mentaires.  De plus, si certaines variables du fragment shader sont transf√©r√©es de l'ext√©rieur ou du shader pr√©c√©dent, la pr√©cision doit √™tre sp√©cifi√©e.  Dans ce cas, une pr√©cision moyenne est suffisante et presque toujours suffisante. <br><br><img src="https://habrastorage.org/webt/dx/9v/jb/dx9vjbxuiz_swlbl1hlmlb5hmys.jpeg"><br><br>  Nous passons √† JS.  Nous attribuons les m√™mes shaders aux variables et d√©clarons une fonction qui cr√©era ces shaders.  Autrement dit, un shader est cr√©√©, la source y est vers√©e, puis compil√©e. <br><br><img src="https://habrastorage.org/webt/jf/x3/eg/jfx3eg-hhqsdbmpc378peyi6tym.jpeg"><br><br>  Nous faisons deux shaders, vertex et fragment. <br><br><img src="https://habrastorage.org/webt/jh/pb/um/jhpbumsovp4-rkstmx9dldtg7ug.jpeg"><br><br>  Apr√®s cela, cr√©ez un programme, t√©l√©chargez-y des shaders d√©j√† compil√©s.  Nous lions le programme car les shaders peuvent √©changer des variables entre eux.  Et √† ce stade, la correspondance des types de variables que ces shaders √©changent est v√©rifi√©e. <br><br>  Nous disons que l'utilisation de ce programme. <br><br><img src="https://habrastorage.org/webt/7i/hm/rc/7ihmrctum2gyy9cuybn5pr6hcbu.jpeg"><br><br>  Ensuite, nous cr√©ons une liste de sommets que nous voulons visualiser.  WebGL a une fonctionnalit√© int√©ressante pour certaines variables.  Pour modifier un type de donn√©es sp√©cifique, vous devez d√©finir le contexte global pour l'√©dition de array_buffer, puis t√©l√©charger quelque chose √† cette adresse.  Il n'y a pas d'affectation explicite de donn√©es √† une variable.  Tout se fait gr√¢ce √† l'inclusion d'un certain contexte. <br><br>  Il est √©galement n√©cessaire d'√©tablir les r√®gles de lecture √† partir de ce tampon.  On peut voir que nous avons sp√©cifi√© un tableau de six √©l√©ments, mais le programme doit expliquer que chaque sommet se compose de deux composants, dont le type est float, cela se fait dans la derni√®re ligne. <br><br><img src="https://habrastorage.org/webt/js/_j/qe/js_jqevmwlq0fmo_n6-vbdwsr-k.jpeg"><br><br>  Pour d√©finir la couleur, le programme recherche l'adresse de la variable u_color et d√©finit la valeur de cette variable.  Nous d√©finissons la couleur, rouge 255, 0,8 √† partir du vert, 0 bleu et un pixel compl√®tement opaque - il devient jaune.  Et nous disons que pour ex√©cuter ce programme en utilisant les primitives triangulaires, dans WebGL, vous pouvez dessiner des points, des lignes, des triangles, des triangles de forme complexe, etc.  Et fais trois pics. <br><br><img src="https://habrastorage.org/webt/lk/pz/xe/lkpzxe_tur-bgozsoj47kohstty.jpeg"><br><br>  Vous pouvez √©galement sp√©cifier que le tableau sur lequel nous effectuons le rendu doit √™tre compt√© d√®s le d√©but. <br><br><img src="https://habrastorage.org/webt/p4/1f/_k/p41f_kioprwkxx7ommkzz7tcclw.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sup></sub> </h5><br>  Si vous compliquez un peu l'exemple, vous pouvez ajouter une d√©pendance de couleur √† la position du curseur.  En m√™me temps, le fps passe par le toit. <br><br><img src="https://habrastorage.org/webt/sl/eu/zl/sleuzlnxn8s1tlflhawo5obsrg8.jpeg"><br><br>  Pour dessiner des particules partout dans le monde, vous devez conna√Ætre la vitesse du vent √† chaque point de ce monde. <br><br>  Pour agrandir et d√©placer la carte, vous devez cr√©er des conteneurs qui correspondent √† la position actuelle de la carte. <br><br>  Pour d√©placer les particules elles-m√™mes, vous devez trouver un format de donn√©es qui pourrait √™tre mis √† jour √† l'aide d'un GPU.  Faites le dessin lui-m√™me et dessinez la boucle. <br><br><img src="https://habrastorage.org/webt/2o/vf/o_/2ovfo_hqaimoyygbbcpkbupf_cu.jpeg"><br><br>  Nous faisons toutes les donn√©es √† travers la texture.  Nous utilisons 22 canaux pour d√©terminer les vitesses horizontales et verticales, o√π la vitesse du vent nul correspond au milieu de la gamme de couleurs.  C'est 128 environ.  Comme la vitesse peut √™tre n√©gative et positive, nous d√©finissons la couleur par rapport au milieu de la plage. <br><br>  Il s'av√®re une telle image. <br><br><img src="https://habrastorage.org/webt/3-/qu/i8/3-qui8mkzufp6hucltuzpampili.jpeg"><br><br>  Pour le charger sur une carte, nous devons le couper.  Pour connecter l'image √† la carte, nous utiliserons l'outil Yandex.Map Layer standard, dans lequel nous d√©terminerons l'adresse √† partir de laquelle couper les tuiles et ajouter cette couche √† la carte. <br><br><img src="https://habrastorage.org/webt/jo/zj/a8/jozja8duysio2wljyezgjnhfn64.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sup></sub> </h5><br>  Nous obtenons une image o√π la couleur verte d√©sagr√©able est la vitesse du vent cod√©e. <br><br><img src="https://habrastorage.org/webt/uh/nk/jh/uhnkjh1e8sxzgzp-myix3xxyjn4.jpeg"><br><br>  Ensuite, vous devez obtenir un endroit o√π nous allons dessiner l'animation elle-m√™me, tandis que cet endroit devrait correspondre aux coordonn√©es de la carte, √† ses mouvements et √† d'autres actions. <br><br>  Par d√©faut, nous pouvons supposer que nous utiliserions le calque, mais le calque de carte cr√©e un canevas √† partir duquel il capture imm√©diatement le contexte 2D qu'il peut capturer.  Mais si nous essayons de prendre √† partir du canevas, qui a d√©j√† un contexte d'un type diff√©rent, et d'en tirer un contexte GL, nous obtenons le r√©sultat nul.  Si vous y acc√©dez, le programme se bloque. <br><br><img src="https://habrastorage.org/webt/lg/9a/mn/lg9amncxtx9ndmnc7bjqkzcs_lw.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sup></sub> </h5><br>  Par cons√©quent, nous avons utilis√© Pane, ce sont des conteneurs pour les mises en page, et y avons ajout√© notre toile, √† partir de laquelle nous avons d√©j√† pris le contexte dont nous avions besoin. <br><br><img src="https://habrastorage.org/webt/v9/on/pb/v9onpb5gnorqq05kg0og8bd6wvq.jpeg"><br><br>  Afin de disposer en quelque sorte les particules sur l'√©cran et de pouvoir les d√©placer, le format de la position des particules dans la texture a √©t√© utilis√©. <br><br>  Comment √ßa marche?  Une texture carr√©e est cr√©√©e pour l'optimisation, et ici la taille de son c√¥t√© est connue. <br><br><img src="https://habrastorage.org/webt/ov/hm/qg/ovhmqgdfgbzg3k5wua7se3l-scm.jpeg"><br><br>  En dessinant les particules dans l'ordre et en connaissant le num√©ro de s√©rie de la particule et la taille de la texture dans laquelle elles sont stock√©es, vous pouvez calculer un pixel sp√©cifique dans lequel la position sur l'√©cran r√©el est cod√©e. <br><br><img src="https://habrastorage.org/webt/xw/6c/ly/xw6clysjjqrtppxzih0cm4q3sis.jpeg"><br><br><img src="https://habrastorage.org/webt/a_/jt/9m/a_jt9ml9jdjn0vxxk7riv9sbkw8.jpeg"><br><br>  Dans le shader lui-m√™me, cela ressemble √† la lecture de l'index rendu, de la texture avec la position actuelle des particules et la taille du c√¥t√©.  Ensuite, nous d√©terminons les coordonn√©es x, y pour cette particule, lisons cette valeur et la d√©codons.  Quel genre de magie est-ce: rg / 255 + ba? <br><br>  Pour la position des particules, nous utilisons 20 canaux doubles.  Le canal de couleur a une valeur de 0 √† 255, et pour l'√©cran 1080, nous ne pouvons pas placer les particules dans n'importe quelle position de l'√©cran pendant un peu, car nous pouvons placer la particule √† un maximum de 255 pixels.  Par cons√©quent, dans un canal, nous stockons la connaissance du nombre de fois o√π une particule a pass√© 255 pixels, et dans le deuxi√®me canal, nous stockons la valeur exacte de ce qu'elle est pass√©e apr√®s. <br><br>  Ensuite, le vertex shader doit convertir ces valeurs dans son espace de travail, c'est-√†-dire de -1 √† 1, et d√©finir ce point sur l'affichage. <br><br><img src="https://habrastorage.org/webt/g2/ht/g_/g2htg_vqu8k5fdnn_zx6xtl82fs.jpeg"><br><br>  Pour regarder nos particules, il suffit de les peindre en blanc.  GLSL a un tel sucre que si nous d√©finissons le type d'une variable et le passons dans une constante, alors cette constante sera r√©partie sur les quatre composants, par exemple. <br><br><img src="https://habrastorage.org/webt/ee/h-/hz/eeh-hzn9oaitmm7k7gwfpzin8rq.jpeg"><br><br>  Apr√®s avoir dessin√© un tel programme, nous voyons un ensemble de carr√©s identiques.  Essayons de leur ajouter de la beaut√©. <br><br><img src="https://habrastorage.org/webt/-r/ud/i1/-rudi16ytlwsw-_fvafdhqmqync.jpeg"><br><br>  Tout d'abord, ajoutez la d√©pendance de ces carr√©s √† la vitesse actuelle du vent.  Nous lisons simplement la vitesse actuelle et les textures correspondantes pour chaque particule.  Nous obtenons la longueur du vecteur, qui correspond √† la vitesse absolue au point, et ajoutons cette vitesse √† la taille des particules. <br><br><img src="https://habrastorage.org/webt/or/v-/qs/orv-qs0vwvlrcxadmlpvbywokdw.jpeg"><br><br>  De plus, afin de ne pas dessiner les carr√©s, dans le shader de fragment, nous coupons tous les pixels qui se trouvent en dehors du rayon, qui ne sont pas inclus dans le rayon du cercle inscrit.  Autrement dit, notre shader se transforme en une telle chose. <br><br><img src="https://habrastorage.org/webt/t4/rx/ah/t4rxahmunedzb3k0jamjxiikvia.jpeg"><br><br>  Nous calculons la distance au pixel rendu du centre.  S'il d√©passe la moiti√© de l'espace, nous ne le montrons pas. <br><br><img src="https://habrastorage.org/webt/nr/do/ma/nrdomaus-zdhgroynefo3qacxck.jpeg"><br><br>  Nous obtenons une image plus diversifi√©e. <br><br>  Ensuite, vous devez en quelque sorte d√©placer ces choses.  Puisque WebGL 1 ne sait pas calculer quelque chose, travailler directement avec des donn√©es, nous profiterons de la possibilit√© de rendre des programmes en composants sp√©ciaux, des tampons de trames. <br><br>  Les tampons d'images peuvent √™tre mapp√©s, par exemple, √† des textures qui peuvent √™tre mises √† jour.  Si le tampon d'image n'est pas d√©clar√©, le dessin par d√©faut est effectu√© √† l'√©cran. <br><br>  En basculant la sortie d'une texture de position √† une autre, nous pouvons les mettre √† jour une par une, puis les utiliser pour le rendu. <br><br><img src="https://habrastorage.org/webt/j7/-j/tn/j7-jtnjwzj-8pav52t-ngiolwji.jpeg"><br><br><img src="https://habrastorage.org/webt/8y/me/ey/8ymeey1havzw-wavn5x8ztr87em.jpeg"><br><br>  La proc√©dure de mise √† jour de la position elle-m√™me ressemble √† ceci: lire la position actuelle, l'ajouter au vecteur vitesse actuel et l'ajouter, l'encoder dans une nouvelle couleur. <br><br><img src="https://habrastorage.org/webt/t7/up/wj/t7upwjpzr8ubgig0cwr1_hn7npa.jpeg"><br><br>  Dans le code, cela ressemble √† lire la position actuelle, d√©coder, lire la vitesse actuelle, ramener la vitesse √† la normale, plier les deux composants, coder en couleur. <br><br><img src="https://habrastorage.org/webt/uo/cc/qo/uoccqo8i2fubmgay3oi90teclzw.jpeg"><br><br>  Il s'av√®re une telle image.  L'√©tat des particules change constamment et une sorte d'animation appara√Æt. <br><br>  Si vous ex√©cutez une telle animation pendant 5 √† 10 minutes, il sera clair que toutes les particules arriveront √† leur destination finale.  Ils glissent tous dans l'entonnoir.  Vous obtenez une telle image. <br><br><img src="https://habrastorage.org/webt/be/m0/bx/bem0bxbrxar_it9lgdjdc2fk91y.jpeg"><br><br>  Pour √©viter cela, nous introduisons un facteur de permutation des particules dans un endroit al√©atoire. <br><br>  Cela d√©pend de la vitesse actuelle du vent, de la position actuelle des particules et du nombre al√©atoire que nous transmettons de JS - car la premi√®re version de WebGL n'a pas de fonction de randomisation et une sorte de fonctions de bruit. <br><br><img src="https://habrastorage.org/webt/zt/ur/_b/ztur_bhp_epcyqk1kzaz9b1r0a0.jpeg"><br><br>  Dans cet exemple, nous calculons la position pr√©dite de la particule, la position al√©atoire, et s√©lectionnons l'une ou l'autre, en fonction du facteur de r√©initialisation. <br><br><img src="https://habrastorage.org/webt/6o/qq/m8/6oqqm8iswgovcsguseunzhwxauc.jpeg"><br><h5>  <sub><sup>Liens depuis la diapositive: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premier</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deuxi√®me</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">troisi√®me</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">quatri√®me</a></sup></sub> </h5><br>  Pour comprendre ce qui √©tait sur la derni√®re diapositive, vous pouvez lire ces articles.  Le premier fournit un √©norme coup de pouce pour comprendre ce que WebGL fournit, en quoi il consiste et comment ne pas s'y tromper.  Chez Khronos, c'est un groupe qui est engag√© dans le d√©veloppement de la norme, il y a une description de toutes les fonctions. <br><br><img src="https://habrastorage.org/webt/5u/qi/st/5uqistm5t05pqha9xfm1oqdnxfu.jpeg"><br><br>  Le dernier point de notre t√¢che est de tracer une trace de particules.  Pour ce faire, nous, comme pour les textures de mise √† jour de position, enregistrerons la position actuelle sur l'√©cran en deux textures, et afficherons la position actuelle, en augmentant l√©g√®rement sa transparence, en superposant une nouvelle position des particules, puis en augmentant encore et encore la transparence de cette image    . <br><br><img src="https://habrastorage.org/webt/es/-8/oa/es-8oakhvm9ds8uh-e7teuivgnk.jpeg"><br><br>      . <br><br><img src="https://habrastorage.org/webt/qv/2s/hi/qv2shigmfokikarpx9kzdx0vsck.jpeg"><br><br><img src="https://habrastorage.org/webt/mu/3s/x2/mu3sx2aovopotm_gnyln8to95rm.jpeg"><br><br>      WebGL         2D canvas,      .   64 .   2D canvas,    25 ,     WebGL     0,3 .     . <br><br>  ,  WebGL     ,        ,      . <br><br>   , ,    ,   - break points, -  ,   . WebGL ‚Äî  . <br><br><img src="https://habrastorage.org/webt/6l/ke/u_/6lkeu_xuquuzt8pjc1uj8ckv1fa.jpeg"><br><br>    ,     . ,  Firefox    ¬´¬ª,        WebGL-,    ,    ,     . ,          . <br><br><img src="https://habrastorage.org/webt/w1/0j/vs/w10jvskiqvyvfrvhqwr4mpnu2uk.jpeg"><br><br>  ,    ,     Spector.js.    canvas  WebGL-         canvas,    . <br><br><img src="https://habrastorage.org/webt/o-/gm/sa/o-gmsa_uu9gddh7qzrept9418ne.jpeg"><br><br>          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>  . ,   ,    , WebGL,    ,        .   . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433278/">https://habr.com/ru/post/fr433278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433268/index.html">Client PHP Telegram (et r√©ception de messages √† l'aide de MadelineProto)</a></li>
<li><a href="../fr433270/index.html">R√©solution de probl√®mes MapStruct avec ManyToMany</a></li>
<li><a href="../fr433272/index.html">Entretien avec David Gobel</a></li>
<li><a href="../fr433274/index.html">Oleg Dokuka √† propos du d√©veloppement r√©actif sur jug.msk.ru</a></li>
<li><a href="../fr433276/index.html">√Ä propos des avantages de l'int√©gration de CSS dans JS</a></li>
<li><a href="../fr433280/index.html">Conf√©rence DEFCON 18. Trollim Reverse Engineering Using Mathematics</a></li>
<li><a href="../fr433282/index.html">Passerelles de protocoles d'√©changes industriels sous Linux. Assemblez-vous</a></li>
<li><a href="../fr433286/index.html">10 r√©unions et hackathons informatiques les plus proches √† Moscou</a></li>
<li><a href="../fr433288/index.html">S√©curit√© Web: Introduction √† HTTP</a></li>
<li><a href="../fr433292/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 279 (du 10 au 16 d√©cembre)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>