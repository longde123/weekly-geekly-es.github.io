<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♓️ 🕡 👨🏿‍🏭 Mengompresi APK, berusaha membuatnya bekerja ✍🏽 👩🏽‍🎨 🛵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="/ PxHere / PD 


 Mengoptimalkan bobot APK adalah tugas yang tidak sepele, tetapi sangat relevan pada zaman Aplikasi Instan. Mengaktifkan proguard aka...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengompresi APK, berusaha membuatnya bekerja</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452524/"><p><img src="https://habrastorage.org/webt/mt/4c/5p/mt4c5phurcqjoygefzy7edmhsxa.jpeg"><br>  <em>/ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PxHere</a> / PD</em> </p><br><p>  Mengoptimalkan bobot APK adalah tugas yang tidak sepele, tetapi sangat relevan pada zaman Aplikasi Instan.  Mengaktifkan proguard akan menyelamatkan Anda dari kode yang tidak perlu jika dependensi Anda dapat ditentukan pada tahap kompilasi, tetapi ada beberapa jenis file lain di APK yang dapat dikecualikan dari perakitan. </p><br><p>  Di bawah kucing tentang cara membuat dependensi - ditentukan pada tahap kompilasi, file mana yang dapat dikecualikan dari perakitan dan bagaimana melakukannya, serta, kami akan menganalisis cara mengecualikan komponen yang tidak digunakan dari perakitan jika Anda memiliki beberapa aplikasi dengan basis kode yang umum. </p><a name="habracut"></a><br><h1 id="pered-prochteniem">  Sebelum membaca </h1><br><ul><li>  Sebelum menerapkan tips dari artikel, optimalkan APK untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">panduan Google</a> .  Artikel ini ditujukan bagi mereka yang tidak memiliki optimisasi standar yang cukup. </li><li>  Dengan "proguard" yang saya maksud adalah kompiler yang mengoptimalkan dengan minifikasi. </li><li>  Menurut komponen, maksud saya adalah fitur tertentu dari produk dari sudut pandang bisnis.  Dalam kasus kami, ini hanya kumpulan file dalam paket tertentu.  Kami memiliki satu modul gradle untuk seluruh aplikasi. </li></ul><br><p> Berat APK yang dioptimalkan Google kami adalah <code>4.4 </code> . </p><br><h1 id="lishnie-fayly">  File ekstra </h1><br><p>  Mari kita mulai dengan yang sederhana.  Jika Anda tidak menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kotlin-reflect</a> , maka Anda dapat mengecualikan meta-informasi tentang kelas kotlin dari majelis.  Anda dapat melakukan ini sebagai berikut: <br>  In <code>build.gradle (Module: app)</code> </p><br><pre> <code class="plaintext hljs">android { packagingOptions { exclude("META-INF/*.kotlin_module") exclude("**.kotlin_builtins") exclude("**.kotlin_metadata") } }</code> </pre> <br><p>  Refleksi Java tidak memerlukan <code>*.kotlin_module</code> , <code>*.kotlin_builtins</code> dan <code>*.kotlin_metadata</code> .  Menentukan refleksi mana yang Anda gunakan sangat sederhana.  Jika Anda menulis <code>obj::class.&lt;method&gt;</code> , maka Anda menggunakan refleksi kotlin, jika <code>obj::class.java.&lt;method&gt;</code> , maka java reflection. </p><br><p>  <em>Hasil optimasi untuk kami: -602.1 kb</em> </p><br><h1 id="zavisimosti">  Ketergantungan </h1><br><p>  Perpustakaan terkadang menambahkan dependensi untuk kasus-kasus yang tidak pernah terjadi dalam aplikasi Anda.  Sebagai contoh, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ktor-klien</a> menarik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kotlin-refleksi</a> bersama dengannya (0,5 mb!). <br>  Saya bergumul dengan kasus-kasus seperti berikut: Saya mengumpulkan APK dengan <code>minifyEnabled = true</code> , melemparkannya ke dalam penganalisa Android Studio, mengunduh <code>mapping.txt</code> dan mencari paket yang, secara teori, tidak boleh ada dalam perakitan.  Misalnya, <code>kotlin.reflect</code> .  Setelah menjalankan <code>./gradlew app:dependencies</code> di folder proyek untuk mencari dependensi (jangan lupa untuk menambah panjang sejarah di terminal. Pohon dependensi bisa jadi besar!).  Dari pohon ini mudah untuk memahami apa yang merujuk pada dependensi yang tidak perlu dan mengeluarkannya.  Di <code>build.gradle</code> modul Anda: </p><br><pre> <code class="plaintext hljs">dependencies { implementation("io.ktor:ktor-client-core:$ktorVersion") { exclude(group: "org.jetbrains.kotlin", module: "kotlin-reflect") } implementation("io.ktor:ktor-client-okhttp:$ktorVersion") { exclude(group: "org.jetbrains.kotlin", module: "kotlin-reflect") } }</code> </pre> <br><p>  Kode ini menghilangkan ketergantungan perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ktor-klien</a> pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kotlin-reflect</a> .  Jika Anda ingin mengecualikan sesuatu yang lain, gantikan nilainya. </p><br><p>  <strong>!!!</strong>  <strong>Gunakan saran ini dengan sangat hati-hati!</strong>  <strong>Sebelum menghilangkan ketergantungan, pastikan Anda tidak membutuhkannya.</strong>  <strong>Jika tidak, maka aplikasi mungkin mulai turun produksi !!!</strong> </p><br><p>  <em>Hasil optimasi untuk kami: -500,3 kb</em> </p><br><h1 id="proverte-vashi-xml">  Validasikan XML Anda </h1><br><p>  Sayangnya, proguard tidak menghapus file markup XML tambahan dari folder layout.  XML yang tidak digunakan dapat menggunakan widget "berat" dan proguard tidak akan dapat mengecualikan mereka dari perakitan juga!  Untuk menghindarinya, hapus sumber daya yang tidak digunakan dengan <code>Refactor -&gt; Remove unused resources...</code> </p><br><h1 id="proverte-vash-di">  Periksa di Anda </h1><br><p>  Jika Anda, seperti kami, menggunakan runtime DI, maka periksa apakah Anda memiliki penyedia untuk dependensi yang tidak Anda gunakan.  Proguard tidak dapat mengecualikan mereka dari rakitan karena mereka tidak digunakan dari sudut pandang kompiler.  Anda menggunakannya ketika membangun grafik ketergantungan. </p><br><h1 id="isklyuchite-otladochnye-zavisimosti-iz-reliznoy-sborki">  Kecualikan Ketergantungan pada Debug dari Rilis Build </h1><br><p>  Alat debugging dapat mengambil banyak ruang secara tak terduga.  Sebagai contoh, <code>stetho</code> memiliki berat sekitar <code>0.2 </code> setelah kompresi!  Bagaimanapun, lebih baik untuk mengecualikan seluruh infrastruktur debugging dari rilis rilis sehingga tidak ada yang bisa belajar terlalu banyak tentang aplikasi Anda hanya dengan mengunduhnya dari Google Play. </p><br><p>  Anda dapat membuat versi berbeda dari file yang sama untuk debug dan rilis.  Untuk melakukan ini, di folder <code>src</code> , di sebelah <code>main</code> , buat folder <code>debug</code> dan <code>release</code> .  Sekarang Anda dapat menulis fungsi <code>initStetho</code> yang menginisialisasi Stetho di file <code>src/debug/java/your/pkg/Stetho.kt</code> dan fungsi <code>initStetho</code> yang tidak melakukan apa pun di file <code>src/release/java/your/pkg/Stetho.kt</code> . </p><br><p>  Untuk berjaga-jaga, pastikan bahwa ketergantungan ini disertakan hanya dalam build debug.  Anda bisa melakukan ini dengan mengganti <code>implementation</code> dengan <code>debugImplementation</code> di <code>build.gradle</code> .  Lebih sering daripada tidak, proguard menghilangkan file yang tidak perlu bahkan tanpa langkah ini, tetapi tidak selalu.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Jawaban untuk pertanyaan "mengapa?"</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di bawah ini dalam teks artikel</a> . </p><br><h1 id="platformy">  Platform </h1><br><p>  Terkadang, pada basis kode yang sama, beberapa versi aplikasi yang berbeda dikeluarkan.  Ini dapat berupa versi yang berbeda untuk negara atau wilayah yang berbeda, atau, seperti dalam kasus kami, untuk klien yang berbeda.  Di bawah ini adalah tips tentang cara menurunkan platform. </p><br><p><img src="https://habrastorage.org/webt/5d/oy/ze/5doyzeespts24cj8hqkey7lsros.jpeg"><br>  <em>/ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PxHere</a> / PD</em> </p><br><h1 id="nash-opyt">  Pengalaman kami </h1><br><p>  Kami sedang mengembangkan perancang aplikasi seluler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">E-SHOP</a> .  Kami memiliki beberapa lusin pelanggan dan masing-masing memiliki komponen sendiri-sendiri.  Beberapa komponen digunakan oleh semua pelanggan, beberapa hanya sebagian.  Tugas kita adalah untuk memasukkan dalam perakitan klien hanya komponen-komponen yang dia butuhkan. </p><br><h1 id="isklyuchenie-komponenta-po-flagu">  Tandai Pengecualian </h1><br><p>  Untuk setiap klien kami membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ProductFlavor</a> terpisah.  Ini nyaman karena mudah untuk membuat sumber daya yang berbeda untuk klien yang berbeda, IDE menyediakan antarmuka grafis untuk beralih antar rasa, dan cache berfungsi dengan baik.  Dan Anda juga dapat membuat <code>BuildConfig.java</code> Anda sendiri untuk setiap klien.  Nilai-nilai bidang dari kelas ini diketahui pada tahap kompilasi.  Inilah yang kami butuhkan!  Buat bidang tipe <code>boolean</code> untuk setiap komponen. </p><br><pre> <code class="plaintext hljs">android { productFlavors { client1 { buildConfigField("boolean", "IS_CATALOG_ENABLED", "true") } client2 { buildConfigField("boolean", "IS_CATALOG_ENABLED", "false") } } }</code> </pre> <br><p>  <em>Ini adalah versi konfigurasi yang disederhanakan.</em>  <em>Hadiah ini rumit karena integrasi dengan CI kami.</em> </p><br><p>  Sekarang diketahui apakah komponen tersebut aktif pada tahap kompilasi, dan proguard dapat mengeluarkannya dari perakitan! </p><br><h1 id="snova-xml">  XML lagi </h1><br><p>  Sekarang masalah dengan tata letak XML yang tidak digunakan mengambil dimensi baru!  Anda tidak bisa mengambil dan menghapus markup komponen hanya karena beberapa pelanggan tidak membutuhkannya. </p><br><p>  Dalam aplikasi XML kami dari salah satu komponen yang jarang digunakan, kami menggunakan widget yang merujuk ke pustaka pengenalan gambar <code>firebase.ml.vision</code> .  Beratnya sekitar 0,2 mb, yang banyak.  Diputuskan untuk menambahkan widget ini dengan kode alih-alih menyatakannya di markup.  Setelah itu, proguard dapat mengecualikan <code>vision</code> dari majelis untuk klien yang tidak membutuhkannya. </p><br><p>  <em>Hasil optimasi untuk kami: -222,3 kb untuk APK rata-rata</em> </p><br><h1 id="annotaciya-keep">  <code>@Keep</code> </h1><br><p>  Ada 2 cara untuk memberi tahu proguard bahwa kelas Anda tidak dapat dikecilkan: tulis aturan di file <code>proguard-rules.pro</code> atau <code>@Keep</code> penjelasan <code>@Keep</code> .  Di perpustakaan <code>play-services-vision</code> , anotasi ini ada di kelas root.  Oleh karena itu, 0,2 mb mati bahkan dalam aplikasi klien yang tidak memerlukan pengenalan gambar. </p><br><p>  Saya tidak menemukan cara sederhana dan aman untuk menghapus anotasi ini.  Jika Anda tahu caranya - silakan tulis di komentar. </p><br><p>  Untungnya, pustaka <code>firebase.ml.vision</code> , yang merupakan versi lebih baru dari <code>play-services-vision</code> , tidak menggunakan anotasi ini dan kami memecahkan masalahnya dengan masuk ke sana. </p><br><h1 id="i-vnov-di">  Dan lagi DI </h1><br><p>  Terakhir tapi tidak kalah pentingnya.  DI untuk komponen yang terputus.  Semuanya sederhana di sini: untuk setiap komponen kami menggunakan wadah kami sendiri, dan kami menghubungkan dependensi umum melalui modul terpisah. </p><br><p>  <em>Hasil optimasi untuk kami: -20.1 kb untuk APK rata-rata</em> </p><br><h1 id="vyvody">  Kesimpulan </h1><br><ul><li>  Berat APK rata-rata telah menurun dari <code>4.4 </code> menjadi <code>3.1 </code> , dan minimum - menjadi <code>2.5 </code> ! </li><li>  Kode aplikasi tidak dirugikan, tetapi ditingkatkan.  DI sekarang lebih mudah untuk dikerjakan </li></ul><br><p>  Semua optimisasi yang disajikan dalam artikel adalah "buah-buahan yang mudah digantung."  Mereka cukup mudah diimplementasikan dan dengan cepat mendapatkan hasilnya.  Hingga <em>-43%</em> untuk APK yang sudah dioptimalkan dalam kasus kami.  Saya harap saya menghemat waktu Anda dengan mendaftarkan semuanya di satu tempat. </p><br><h3 id="vsem-spasibo">  Terima kasih semuanya! </h3></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id452524/">https://habr.com/ru/post/id452524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id452514/index.html">Desain game menjadi hidup. Ekonomi Permainan (Bagian II)</a></li>
<li><a href="../id452516/index.html">Docker container untuk manajemen server HP bersama ILO</a></li>
<li><a href="../id452518/index.html">VMware EMPOWER 2019 - topik utama konferensi, yang akan diadakan 20-23 Mei di Lisbon</a></li>
<li><a href="../id452520/index.html">"Elemen" Fancy Euclid di TeX</a></li>
<li><a href="../id452522/index.html">Delapan opsi Bash yang kurang dikenal</a></li>
<li><a href="../id452526/index.html">Kelas menengah: mengapa musisi modern mendapat penghasilan</a></li>
<li><a href="../id452528/index.html">Elon Musk: jika Anda tidak memotong biaya secara drastis, uang Tesla akan habis dalam 10 bulan</a></li>
<li><a href="../id452530/index.html">Geeks otomatis, fintech dan pemasaran konten, atau mengapa perusahaan asuransi harus memasang iklan edisi IT</a></li>
<li><a href="../id452532/index.html">Termometer & hygrometer Arduino dengan E-PAPER pada nRF52832 - atau apa yang lupa dilepaskan oleh produsen</a></li>
<li><a href="../id452534/index.html">Tips Pendekatan Multiplikasi Baru Cara Meningkatkan Komputer Quantum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>