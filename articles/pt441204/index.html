<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì¨ üë¶üèø üíá Uma abordagem avan√ßada para detectar limites usando as paredes dos navios como exemplo üåÉ üê´ üå®Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Informa√ß√£o interessante 
 A figura abaixo mostra uma reconstru√ß√£o tridimensional do cora√ß√£o, obtida como resultado do trabalho de um tom√≥grafo moderno...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Uma abordagem avan√ßada para detectar limites usando as paredes dos navios como exemplo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/inobitec/blog/441204/"><h2>  Informa√ß√£o interessante </h2><br>  A figura abaixo mostra uma reconstru√ß√£o tridimensional do cora√ß√£o, obtida como resultado do trabalho de um tom√≥grafo moderno: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uy/7v/fc/uy7vfcx7nzqfq_kqcnmu7xhzipq.png"></div><br>  Para escala, a espessura da l√¢mpada a√≥rtica √© de 3,2 cm, pense!  No entanto, quando as pessoas t√™m problemas card√≠acos devido a vasos sangu√≠neos, ent√£o, como regra, n√£o estamos falando sobre esses grandes.  A imagem mostra que o cora√ß√£o est√° cercado por vasos menores, e alguns deles se ramificam diretamente das grandes art√©rias.  Estas s√£o as chamadas art√©rias coron√°rias que alimentam o cora√ß√£o diretamente com sangue.  Se ocorrer um estreitamento do l√∫men (estenose), por exemplo, devido √† forma√ß√£o de c√°lcio, o fluxo sangu√≠neo diminui.  Quando a estenose √© pronunciada, ocorre necrose tecidual, ou seja, um ataque card√≠aco.  A seguir, falarei sobre nossa abordagem para calcular os limites dos vasos sangu√≠neos, o que, como resultado, permite que voc√™ encontre automaticamente o estreitamento e fa√ßa uma estimativa. <br><a name="habracut"></a><br>  Para entender o material, voc√™ precisa ter um entendimento superficial do volume, voxels e suas intensidades.  Voc√™ pode descobrir lendo o come√ßo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">deste artigo</a> . <br><br>  Para avaliar o estreitamento de uma embarca√ß√£o, precisamos conhecer o l√∫men da embarca√ß√£o ou sua borda interna.  Para fazer isso, pelo menos, detecte todo o c√°lcio.  Tamb√©m encontramos o limite externo, porque permite estimar a espessura da parede, o que tamb√©m √© √∫til.  Para come√ßar, vamos dar uma olhada no esquema completo de detec√ß√£o de limites e, em seguida, analisaremos cada est√°gio em detalhes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/cw/va/blcwvavrk6rpr7dncjp0ydgtxfo.png"></div><br><h2>  Tra√ßando a linha central </h2><br>  O est√°gio mais dif√≠cil em termos de implementa√ß√£o (pelo menos levou mais tempo).  O m√©todo baseia-se no uso de uma matriz Hessian (segmenta√ß√£o de navios em v√°rias escalas usando aprimoramento da matriz Hessian).  Mais detalhes no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> j√° mencionado. <br><br><h2>  Fatiar </h2><br>  Temos apenas uma linha central e precisamos de intensidades espacialmente dependentes de voxels que possam ser convenientemente trabalhadas.  Para obt√™-los, uma ‚Äúpilha‚Äù de fatias est√° indo.  Para iniciantes, os pontos s√£o definidos atrav√©s de dist√¢ncias fixas na linha central.  Ent√£o uma perpendicular √© constru√≠da a partir de cada ponto <img src="https://habrastorage.org/getpro/habr/post_images/629/d90/498/629d904983c27d11c1874e959481ac0e.svg">  .  Depois √© o segundo perpendicular <img src="https://habrastorage.org/getpro/habr/post_images/c49/6e6/18d/c496e618db88f915ed3d3fe3e8ffebf5.svg">  .  Onde <img src="https://habrastorage.org/getpro/habr/post_images/715/6f4/21f/7156f421f73f84d8f74072c47d8feb40.svg">  - a dire√ß√£o da linha central em um ponto.  As duas perpendiculares s√£o normalizadas.  Em todo ponto <img src="https://habrastorage.org/getpro/habr/post_images/d76/c4d/c2b/d76c4dc2b17f00a09c864bf2d24ab365.svg">  vetor de linha central <img src="https://habrastorage.org/getpro/habr/post_images/ccc/5f9/fa9/ccc5f9fa9ba4fd68b9d82f5f64c964a5.svg">  formar um sistema de coordenadas 2D.  Assim, as fatias s√£o formadas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1i/u3/fy/1iu3fy_dalyttcp8pm_5tbmvblu.png"></div><br>  A posi√ß√£o do voxel √© definida como <img src="https://habrastorage.org/getpro/habr/post_images/61a/d30/8c1/61ad308c13008a755317c1e29b64d2c5.svg">  onde <img src="https://habrastorage.org/getpro/habr/post_images/038/a72/de3/038a72de3b3aa84f6df45501491024e0.svg">  aqui <img src="https://habrastorage.org/getpro/habr/post_images/c85/e97/693/c85e97693d356905ea98d6f6cbacc674.svg">  S√£o as coordenadas reais do voxel, k √© o n√∫mero da fatia.  F√≥rmula inversa para coordenadas reais: <img src="https://habrastorage.org/getpro/habr/post_images/797/f2e/fae/797f2efaeb13453aa8d76293b288bd73.svg">  .  Ao mover para um novo sistema de coordenadas, o espa√ßo formado pelas fatias √© simplificado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pj/c3/cq/pjc3cqpbmjzhvsb2ioyumlgilam.png"></div><br>  Do que precisamos! <br><br><h2>  Constru√ß√£o da borda externa do navio </h2><br>  Vamos dar uma olhada no diagrama: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gm/ii/i2/gmiii2tsk4iqtvaolp9y3fhvd9c.png"></div><br>  Cortamos nossa pilha de fatias obtidas no est√°gio anterior em oito planos (semelhante ao corte de um bolo) e realizamos todos os c√°lculos no espa√ßo dos planos: <br><br><div class="spoiler">  <b class="spoiler_title">Cut</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ov/jd/db/ovjddbzkgm-vdtrv6gcwzzuao1o.png"></div><br></div></div><br>  Se voc√™ exibir os valores normalizados das intensidades dos voxels que atingem o plano de corte, obteremos a seguinte imagem: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/nf/km/uenfkmqzel_cvnooctxzi9cl-3m.png"></div><br>  Para detectar os limites do navio, a abordagem cl√°ssica (detec√ß√£o de arestas por gradiente) √© usada em conjunto com a busca do caminho.  Esquema: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/tu/ox/kwtuox6hip2d3cu0t65wj_z4fqc.png"></div><br>  1. Aplique a suaviza√ß√£o gaussiana com um valor pequeno <img src="https://habrastorage.org/getpro/habr/post_images/77c/f13/7bb/77cf137bb0d151fa8fc5a4eb4a7f21e0.svg">  para suprimir ru√≠dos: <br>  Para um ponto com coordenadas <img src="https://habrastorage.org/getpro/habr/post_images/733/058/d18/733058d18a17c8fcbb58bb5b1879082a.svg">  : <br><img src="https://habrastorage.org/getpro/habr/post_images/2a4/722/67f/2a472267fd4f70baed2798401c41edd6.svg">  onde <img src="https://habrastorage.org/getpro/habr/post_images/7ec/a6c/c6a/7eca6cc6aeb64ba5e76063f0019d9542.svg">  retorna o valor da intensidade em um ponto <img src="https://habrastorage.org/getpro/habr/post_images/65c/c1e/d7f/65cc1ed7f6ce98859b0f80176a24fc08.svg">  ;  r normalmente leva o valor <img src="https://habrastorage.org/getpro/habr/post_images/d02/f53/56b/d02f5356b7b9c5234d7c2975efd6a994.svg">  ( <img src="https://habrastorage.org/getpro/habr/post_images/1b6/903/f11/1b6903f1101a871ba3ba64fe1924f873.svg">  - arredondamento); <img src="https://habrastorage.org/getpro/habr/post_images/77c/f13/7bb/77cf137bb0d151fa8fc5a4eb4a7f21e0.svg">  - coeficiente de suaviza√ß√£o. <br><br>  2. Em cada ponto, encontramos o gradiente e seu valor, os c√°lculos s√£o realizados com valores de intensidade suavizada: <br><img src="https://habrastorage.org/getpro/habr/post_images/9d3/c90/939/9d3c9093937e8aff5520ded5071984ac.svg">  , <br>  onde <img src="https://habrastorage.org/getpro/habr/post_images/698/280/401/6982804016ef30ecdc8ac8fddeb72c4e.svg">  - derivativos privados.  Eles s√£o encontrados pelo m√©todo das diferen√ßas finitas: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/791/209/8dc/7912098dc806f588c1458ad8b9faabdc.svg">  , <br>  onde <img src="https://habrastorage.org/getpro/habr/post_images/b20/94b/690/b2094b69077bfe82f7dca9f140480d0b.svg">  - intensidade em um ponto <img src="https://habrastorage.org/getpro/habr/post_images/65c/c1e/d7f/65cc1ed7f6ce98859b0f80176a24fc08.svg">  depois de alisar. <br>  Em seguida, precisamos da dire√ß√£o do gradiente <img src="https://habrastorage.org/getpro/habr/post_images/341/0a9/910/3410a9910584413131b3320a186f314b.svg">  ( <img src="https://habrastorage.org/getpro/habr/post_images/64b/66b/58e/64b66b58e46e62b07ecb6e7b86851d21.svg">  √â a normaliza√ß√£o do vetor) e o valor do gradiente <img src="https://habrastorage.org/getpro/habr/post_images/e64/fb2/3c8/e64fb23c8f2225d8f538813e1fe4cbb3.svg">  ( <img src="https://habrastorage.org/getpro/habr/post_images/06d/0ad/537/06d0ad537ee5254e1af0392adeb5008d.svg">  √â o comprimento do vetor) <br><br>  3. A dire√ß√£o do gradiente √© traduzida em graus ou radianos: <br><img src="https://habrastorage.org/getpro/habr/post_images/89d/fd2/c8a/89dfd2c8ab531ad40fd223765fac9596.svg">  (atan2 () √© a fun√ß√£o do arco tangente em C ++, que n√£o deve ser confundida com atan ()), arredondamos o √¢ngulo para que ele possa ter 4 valores em incrementos de 45 graus, ou seja,  superior e inferior s√£o considerados na mesma dire√ß√£o: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t3/tq/jx/t3tqjxxfdgjsdqubxdputqzbh8w.jpeg"></div><br>  4. Execute a supress√£o de valores n√£o m√°ximos.  Se o valor do gradiente <img src="https://habrastorage.org/getpro/habr/post_images/e64/fb2/3c8/e64fb23c8f2225d8f538813e1fe4cbb3.svg">  pelo menos em um dos dois pontos vizinhos (de acordo com a dire√ß√£o do gradiente) for maior ou igual ao valor do gradiente no ponto atual, esse ponto n√£o poder√° pertencer ao limite: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bf/0d/tf/bf0dtfvisx3vymgm2fjjpj7cbxe.png"></div><br>  5. Todos os voxels restantes s√£o considerados limites.  Com base no valor do gradiente, no limiar de c√°lcio (que n√£o est√° dispon√≠vel imediatamente) e na proximidade do centro "vertical", cada ponto recebe um determinado custo (quanto mais brilhante o voxel, maior a prioridade ao procurar um caminho): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ad/wn/ng/adwnng9jtvu5knuetwbngyhubq8.png"></div><br>  Nesta forma, os limites da embarca√ß√£o s√£o quase exclusivamente definidos. <br><br>  6, 7. Para construir limites, usamos a pesquisa do caminho.  Os pontos extremos mais pr√≥ximos e com o menor custo s√£o tomados como inicial e final.  Para procurar um caminho, use uma pesquisa simples da primeira largura, que seleciona os pontos de limite de menor custo.  Saltos tamb√©m est√£o dispon√≠veis, mas seu pre√ßo √© alto.  Os limites superior e inferior do vaso s√£o pesquisados ‚Äã‚Äãseparadamente e a suaviza√ß√£o √© aplicada a eles: <br><br><div class="spoiler">  <b class="spoiler_title">Resultado</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/t_/67/_u/t_67_u6vbtpbn5nthgj1uzfglle.png"></div><br></div></div><br>  Este procedimento √© realizado para cada plano, o que resulta em an√©is de dezesseis segmentos para cada fatia na pilha.  Esses an√©is formam as bordas externas do navio. <br><br>  Como voc√™ pode ver na imagem, h√° √°reas nas quais as bordas s√£o detectadas incorretamente.  Isso ocorre devido √† presen√ßa de c√°lcio, que resulta na detec√ß√£o de limites de c√°lcio em vez de limites de vasos.  Para impedir que isso aconte√ßa ap√≥s a primeira detec√ß√£o de limites, √© necess√°rio determinar o limiar de c√°lcio (mais sobre isso posteriormente) e, em seguida, executar a segunda detec√ß√£o de limites, ignorando os voxels relacionados ao c√°lcio.  Ent√£o temos: <br><br><div class="spoiler">  <b class="spoiler_title">Bom resultado</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/7p/we/tz/7pwetz2lmrhzbikdhjpjmwsc7rw.png"></div><br><h2>  Detec√ß√£o de limiares de fronteiras internas, externas e limiar de c√°lcio </h2><br>  Depois que o limite externo √© conhecido, precisamos coletar informa√ß√µes estat√≠sticas.  Ou seja, as intensidades de todos os voxels que est√£o dentro do navio. <br></div></div><br><h2>  Detec√ß√£o de limiar </h2><br>  Agora considere a maximiza√ß√£o da expectativa do algoritmo de cluster (a seguir denominada EM).  Vamos come√ßar com a fun√ß√£o de distribui√ß√£o normal: √© caracterizada por uma expectativa matem√°tica <img src="https://habrastorage.org/getpro/habr/post_images/849/a42/16c/849a4216c1bc55877bc86f4a97513f7a.svg">  e desvio padr√£o <img src="https://habrastorage.org/getpro/habr/post_images/77c/f13/7bb/77cf137bb0d151fa8fc5a4eb4a7f21e0.svg">  .  Veja como eles afetam o tipo de distribui√ß√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1f/vg/gj/1fvggjfo2r_nz87bzdb3kngomri.gif"></div><br><br>  Suponha que tenhamos dados (pontos) provenientes de uma fonte "amarela" e de uma fonte "azul": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/9q/er/rw9qern6glz7e696mx7k1sviuom.png"></div><br>  Em seguida, usando f√≥rmulas padr√£o, encontramos facilmente a m√©dia e o desvio padr√£o para cada fonte.  F√≥rmulas para a fonte "a": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c13/a5b/94d/c13a5b94d8d81bc4353b884bc8970aeb.svg"><br><img src="https://habrastorage.org/getpro/habr/post_images/154/906/8ae/1549068ae55c21dcb6e7efa2d3185f56.svg"><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4x/js/jx/4xjsjxajyvozdnueljew75whnyg.png"></div><br>  Mas e se soubermos o n√∫mero de fontes, mas n√£o soubermos quais pontos pertencem a qual fonte?  E se tivermos uma foto dessas? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ei/cb/9a/eicb9atkan-akjv2zgp9rodyow0.png"></div><br>  Se algu√©m viesse nos contar os par√¢metros de distribui√ß√£o, poder√≠amos calcular facilmente a probabilidade de cada ponto pertencente a cada uma das fontes.  A probabilidade de o ponto pertencer √† fonte "a": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c24/2eb/8d9/c242eb8d94d7b7a7ad237c8509b54d65.svg">  onde <br><br><img src="https://habrastorage.org/getpro/habr/post_images/75c/129/b81/75c129b8112508e711b04727e48b05d3.svg"><br><img src="https://habrastorage.org/getpro/habr/post_images/7b0/a47/b22/7b0a47b2227447f62daaf67a8fc519b0.svg"><br><br>  E se precisarmos calcular os par√¢metros de origem, conhecendo as probabilidades: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb6/eee/7f9/cb6eee7f9578ca134c470c445f69bdd6.svg"><br><img src="https://habrastorage.org/getpro/habr/post_images/bf3/2e7/ed5/bf32e7ed508e6dcd536ee3fe6ab63f32.svg"><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ws/ok/gf/wsokgf4bevva43d9cxzhktmzzws.png"></div>  Assim, √© obtido um c√≠rculo vicioso: se conhec√™ssemos os par√¢metros das fontes, calcular√≠amos qual ponto pertence a qual fonte, mas n√£o conhecemos os par√¢metros.  E se soub√©ssemos qual ponto pertence a qual fonte, calcular√≠amos seus par√¢metros, mas n√£o sabemos qual ponto pertence a qual fonte.  Equilibrar esses fatos √© exatamente o que o algoritmo EM faz. <br><br>  Na inicializa√ß√£o, o EM recebe alguns par√¢metros predefinidos para fontes, que podem ser simplesmente selecionados aleatoriamente.  Obviamente, se os par√¢metros forem conhecidos, podemos calcular a probabilidade de cada ponto pertencente a cada uma das fontes.  Agora que as probabilidades s√£o conhecidas, podemos calcular novos par√¢metros mais precisos.  Ent√£o, tudo come√ßa novamente, mas com novos par√¢metros.  Ap√≥s cada ciclo, os par√¢metros das fontes est√£o se tornando mais precisos. <br><br>  Como podemos usar esse conhecimento em rela√ß√£o aos navios?  Vamos dar uma olhada na estrutura de um deles: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/il/st/gqilstduy1jpu4f_e7wiu0hns2g.png"></div>  Nos diagramas, esse ponto geralmente √© omitido, mas forma√ß√µes de gordura e c√°lcio tamb√©m podem estar presentes no vaso.  Assim, cada voxel pertencer√° a um dos tecidos.  Ap√≥s os experimentos, verificou-se que basta fazer as seguintes divis√µes: <br><br>  - gordo <br>  - parede # 1 <br>  - parede # 2 <br>  - meio de contraste <br>  - c√°lcio <br><br>  A distribui√ß√£o das intensidades do voxel em cada caso √© normal.  I.e.  temos tudo o que precisamos para usar o EM para encontrar os par√¢metros de cada fonte. <br><br><div class="spoiler">  <b class="spoiler_title">Os resultados s√£o bons o suficiente</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/f3/ht/_o/f3ht_obxm187_gnzmu8aue4sbbg.png"></div><br>  A linha verde √© um histograma de intensidades, a linha vermelha √© o modelo matem√°tico resultante. <br></div></div><br>  Agora que conhecemos os par√¢metros de cada fonte, podemos calcular os limites - os valores das intensidades, na interse√ß√£o das quais, a associa√ß√£o ao voxel muda de uma fonte para outra.  Estamos interessados ‚Äã‚Äãem: <br><br>  1. O limiar do limite externo do navio.  Se a intensidade do voxel estiver abaixo desse valor, considera-se que ele n√£o pertence ao vaso; <br><br>  2. O limiar do limite interno do vaso.  Se a intensidade do voxel for maior que esse valor, ent√£o <br>  refere-se ao l√∫men do vaso, isto √©,  a uma mistura de sangue e meio de contraste; <br><br>  3. O limiar de c√°lcio.  Se o valor da intensidade do voxel for maior que esse valor, ele se refere ao c√°lcio. <br><br><h2>  Constru√ß√£o da borda interna do navio </h2><br>  Como sempre, vamos come√ßar com o diagrama; os c√°lculos s√£o realizados para cada fatia. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8a/-m/9v/8a-m9vgz6e1vywymf8xsnckgm4m.png"></div><br><br>  Se voc√™ exibir visualmente os dados de acordo com os limites obtidos na etapa anterior, obteremos a seguinte imagem: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gi/qr/uf/giqrufs9lrd7j1rup_-8ckjkpww.png"></div><br><br>  A cor vermelha √© a parede do vaso.  Cor verde - folga.  Branco √© c√°lcio. <br><br>  A primeira coisa que chama sua aten√ß√£o √© o c√°lcio "pendurado", que n√£o fica ao lado de nenhuma das paredes.  Isso √© considerado normal e surge devido √† suaviza√ß√£o aplicada pelo pr√≥prio tom√≥grafo. <br><br>  Primeiro, voc√™ precisa obter os limites de acordo com os limites e, para isso, o algoritmo de quadrados de marcha √© usado.  Pode-se dizer, passa em duas etapas.  Primeiro, a √°rea √© dividida por uma grade discreta e os quadrados em que os valores de intensidade s√£o maiores ou iguais ao limiar s√£o considerados "positivos", o restante √© considerado "negativo". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3q/4f/rq/3q4frqwpj7hnj5nu-mu2fintttq.png"></div>  Cada vez que estamos em algum tipo de n√≥, precisamos desenhar um contorno em torno dos quadrados "positivos".  Para tomar uma decis√£o, consideraremos os sinais de quatro quadrados vizinhos: superior esquerdo, inferior esquerdo, superior direito, inferior direito.  Excluindo a simetria, estamos interessados ‚Äã‚Äãem tr√™s casos. <br><br>  1. Tr√™s quadrados de um sinal e um oposto, o movimento do contorno ocorre na diagonal: <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j7/si/y_/j7siy_5nyv_vu-zjkt6lrxwtgwi.png"><br></div></div><br>  2. Dois quadrados do mesmo sinal e dois opostos, e os quadrados com o mesmo sinal est√£o em um lado, o movimento do contorno √© vertical ou horizontal: <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ky/4u/0c/ky4u0chgxifkj8cbmysyygdmcwg.png"><br></div></div><br>  3. Dois quadrados do mesmo sinal e dois opostos, quadrados com os mesmos sinais s√£o colocados em lados opostos: <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ak/jc/fn/akjcfnqk3ekjhnynsk8gaqlpgu0.png"><br></div></div><br>  Este √© um caso excepcional, para tomar uma decis√£o, o valor m√©dio da intensidade em todos os quatro quadrados √© obtido e, se for maior ou igual ao limiar, o centro √© positivo; em outros casos, √© negativo.  Tamb√©m √© importante qual n√≥ est√° atual no momento: <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8r/qd/5m/8rqd5mrjzqmdivmw_dpyxpqbkbu.png"><img src="https://habrastorage.org/webt/tp/uf/y9/tpufy92j4dfe3vtindh4blsi-su.png"><br></div></div><br>  O algoritmo dos quadrados de marchas constr√≥i um contorno de maneira precisa e inequ√≠voca.  No exemplo abaixo, eu deliberadamente mudei a linha do centro do lado para que cada passo fosse claramente vis√≠vel. <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gg/41/ld/gg41ldwyplhod11zpgqblopf7ho.png"></div>  Especificamente, o primeiro e o segundo casos: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fa/wq/oy/fawqoy8amtn9paiodwj6jowzql8.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ra/1l/md/ra1lmdd4wobzgjt9tgyp7rzxznc.png"></div><br></div></div><br>  Para cada se√ß√£o do navio, encontramos dois contornos principais - este √© o contorno da borda externa e o contorno da borda interna.  Imediatamente "cortamos" o contorno externo com o outro contorno externo, encontrado no in√≠cio do artigo, procurando caminhos.  Isso √© feito para ignorar os galhos da embarca√ß√£o.  Ignoramos os contornos do c√°lcio que est√£o muito distantes da parede interna, como se eles n√£o existissem, encontramos o resto e os usamos no futuro.  Se o centro do vaso estiver dentro do c√°lcio, ent√£o o deslocamos na dire√ß√£o mais pr√≥xima do circuito do c√°lcio at√© que o centro esteja no l√∫men (na regi√£o verde).  Um centro t√£o atualizado, vou chamar a posi√ß√£o inicial. <br><br>  De acordo com o esquema, pode haver dois casos: simples e complexo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ac/qq/1c/acqq1c5bc1mqei30gplmu2z2gok.png"></div><br>  Se a posi√ß√£o inicial estiver dentro de um loop fechado de c√°lcio (por exemplo, se um stent estiver instalado), imediatamente equipararemos a borda interna a esse loop.  As coisas ficam mais complicadas quando o centro est√° fora do c√°lcio.  Nesse caso, precisamos expandir o circuito de partida para que ele flua suavemente ao redor do c√°lcio e da borda interna: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mz/ds/5w/mzds5whlkw7e3tffnl5crfvd-vk.gif"></div><br>  Para alcan√ßar o resultado desejado, um algoritmo especial foi desenvolvido com base nas id√©ias usadas nos motores 2d f√≠sicos, em particular na resolu√ß√£o de colis√µes de pol√≠gonos e no teorema do eixo separado. <br><br>  Dois conceitos b√°sicos que n√£o podem ser dispensados: para a interse√ß√£o de pol√≠gonos convexos, o vetor mtv (vetor m√≠nimo de convers√£o) √© o menor deslocamento de um dos pol√≠gonos, ap√≥s o qual a interse√ß√£o para. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ns/yh/_9/nsyh_9qufvxdkohpt_fsjejwdx8.png"></div>  Tamb√©m precisamos das normais poligonais - em 2D elas s√£o perpendiculares √†s faces e indicam "fora": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/y3/fc/fi/y3fcfiywkig3dbgrxkhw9twh1gk.png"></div>  Para n√£o prolongar o artigo, omitirei o restante dos detalhes sobre os motores f√≠sicos.  A √∫nica coisa que observo √© que, durante cada itera√ß√£o, cada ponto do contorno acumula a influ√™ncia de for√ßas sobre si mesmo na forma de um vetor e, no final de cada itera√ß√£o, ele muda pelo comprimento desse vetor em sua dire√ß√£o.  Considere as for√ßas: <br><br>  1. Duas for√ßas agem em cada v√©rtice do contorno inicial na dire√ß√£o dos v√©rtices vizinhos, e as for√ßas s√£o diretamente proporcionais √† dist√¢ncia desses v√©rtices.  Isso faz o contorno encolher e se esfor√ßa para manter uma forma arredondada; <br><br>  2. Se o v√©rtice do contorno lateral cair dentro do contorno inicial, o deslocamento proporcional ao vetor v√©rtice mtv do v√©rtice ser√° aplicado √† face mais pr√≥xima do contorno inicial; <br><br>  3. Se a parte superior do contorno inicial estiver dentro do contorno lateral, ser√° aplicado um deslocamento proporcional ao vetor de v√©rtice mtv do v√©rtice na parte superior do contorno inicial.  Isso, juntamente com o par√°grafo anterior, n√£o permite que o circuito ultrapasse os limites de outros circuitos; <br><br>  4. Se os casos 2 e 3 n√£o funcionaram para o v√©rtice, ent√£o uma for√ßa √© aplicada na dire√ß√£o m√©dia das duas normais das faces adjacentes.  Isso garante o crescimento do contorno "em largura". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lz/by/zx/lzbyzx2rujiluinvtom2jj6tana.png"></div>  Importante: voc√™ n√£o pode mudar completamente um v√©rtice ou uma face pelo comprimento do vetor mtv - ele √© multiplicado por um certo coeficiente no intervalo de 0,2 a 0,8.  Os coeficientes para cada for√ßa nos demais casos s√£o selecionados experimentalmente. <br><br>  Gra√ßas a essa abordagem, encontramos o l√∫men do vaso, levando em considera√ß√£o o fato de que o c√°lcio n√£o se aproxima das paredes.  Agora basta combinar os resultados de todas as se√ß√µes e obter as bordas interna e externa da embarca√ß√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gv/4z/z7/gv4zz7jnpkx4jdrb1ojm8xojcce.png"></div><br>  A aparente imprecis√£o da borda ap√≥s o stent √© causada por bifurca√ß√£o an√¥mala: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ub/i-/cx/ubi-cxfe-hfuys8ufibs97o8xes.png"></div><br>  A √°rea da borda interna no corte caracterizar√° a mesma folga em que estamos interessados.  Uso adicional desses dados considero trivial e n√£o requer considera√ß√£o.  Por fim, deixarei a imagem da borda interna exportada em 3D: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/cv/g4/blcvg4klqzx9imn2qcgw6cizyay.png"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt441204/">https://habr.com/ru/post/pt441204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt441192/index.html">Usando o poder computacional de R para testar a hip√≥tese de igualdade de m√©dias</a></li>
<li><a href="../pt441194/index.html">Livro "GraphQL: Linguagem de Consulta para Aplica√ß√µes Web Modernas"</a></li>
<li><a href="../pt441196/index.html">Sobre quem e para que mensageiros "bater√£o"</a></li>
<li><a href="../pt441198/index.html">Din√¢mica espiral de Scrum e Graves: como n√£o se deparar com recifes</a></li>
<li><a href="../pt441202/index.html">As empresas de servi√ßos sonham com seus produtos? Conversa com Maxilect</a></li>
<li><a href="../pt441206/index.html">Wolfensteiny 3D - engenharia reversa 251 bytes de JavaScript</a></li>
<li><a href="../pt441208/index.html">Como reduzimos a emiss√£o de empr√©stimos para 2 cliques</a></li>
<li><a href="../pt441210/index.html">Marca-passo de armazenamento em cluster + DRBD (prim√°rio duplo) + samba</a></li>
<li><a href="../pt441212/index.html">Trabalhar com prote√ß√£o de informa√ß√µes criptogr√°ficas e portadores de chaves de hardware no Linux</a></li>
<li><a href="../pt441214/index.html">Guia do Usu√°rio Kibana. Visualiza√ß√£o. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>