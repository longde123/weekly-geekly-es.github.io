<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñºÔ∏è üë®‚Äçüé® ‚ÅâÔ∏è Configuration de NextCloud + ONLYOFFICE sur le m√™me serveur √† l'aide de Docker üñêüèº ‚úäüèº üÜñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Je vous pr√©sente la traduction de l'article "Configuration de NextCloud et ONLYOFFICE sur un seul serveur avec Docker" . 

 Il est diff...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configuration de NextCloud + ONLYOFFICE sur le m√™me serveur √† l'aide de Docker</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463629/">  Bonjour, Habr!  Je vous pr√©sente la traduction de l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Configuration de NextCloud et ONLYOFFICE sur un seul serveur avec Docker"</a> . <br><br>  Il est difficile de sous-estimer les avantages des packages de suite bureautique en ligne tels que Google Docs et le stockage cloud dans la vie des personnes ax√©es sur la technologie.  Les technologies sont devenues si r√©pandues que m√™me Microsoft, qui a longtemps domin√© le march√© des applications bureautiques, s'est r√©cemment concentr√© sur le d√©veloppement de l'application Web Office 365 et sur la convaincre les utilisateurs de passer √† un mod√®le d'abonnement en utilisant leurs propres services.  Ceux qui sont int√©ress√©s par le processus d'installation et de configuration de leur propre stockage sont invit√©s √† cat. <br><a name="habracut"></a><br>  Il y a quelque temps, nous avons examin√© des solutions de stockage dans le cloud et une suite bureautique open source d'applications Web qui pourraient √™tre facilement mises en ≈ìuvre pour une utilisation dans des microentreprises.  La principale motivation pour le stockage de toute la documentation en ligne est de minimiser le volume de flux de travail papier et de mettre en ≈ìuvre des pratiques commerciales positives, malgr√© le faible volume des op√©rations.  Le revers de la m√©daille est que la location d'un serveur cloud pour fournir ce service est moins s√©curis√©e que le stockage direct sur place, car vous n'avez aucun moyen de v√©rifier l'acc√®s physique √† votre serveur ou le trafic.  Par cons√©quent, un chiffrement de bout en bout et un logiciel open source sont √©galement requis. <br><br>  En tenant compte de toutes les informations disponibles sur les solutions open source, nous avons trouv√© deux projets existants (avec des validations dans les r√©f√©rentiels git au cours des 12 derniers mois) con√ßus pour le stockage cloud: NextCloud et OwnCloud, et la seule suite bureautique active ONLYOFFICE.  Les deux installations de stockage en nuage ont approximativement les m√™mes fonctionnalit√©s, et la d√©cision de choisir NextCloud √©tait bas√©e sur l'existence de preuves qu'il peut √™tre int√©gr√© √† ONLYOFFICE pour une interaction confortable des utilisateurs avec le logiciel.  Cependant, lorsque nous avons commenc√© le d√©ploiement des services, le manque d'informations sur l'int√©gration des services ci-dessus est devenu apparent.  Nous avons trouv√© 3 vid√©os de tutoriel sur la fa√ßon d'int√©grer: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com/watch?v=GAd-x_sP6ng</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com/watch?v=ceOld6P16wI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com/watch?v=DvTXyl-OOZA</a> </li></ul><br>  Aucune des trois vid√©os n'a r√©pondu √† la question de l'installation du service de document ONLYOFFICE sur le m√™me serveur physique que NextCloud avec nginx partag√©.  Au lieu de cela, ils ont utilis√© des technologies de s√©paration telles que l'utilisation de ports s√©par√©s pour le service de documents api.  Une autre option propos√©e consistait √† d√©ployer un serveur distinct pour le service de documents avec une configuration manuelle de l'instance nginx int√©gr√©e au service de documents pour installer la cl√© d'acc√®s (une cl√© d'acc√®s pr√©c√©demment connue qui confirme l'acc√®s au cloud de donn√©es) et les certificats TLS.  Les approches ci-dessus ont √©t√© consid√©r√©es comme non s√ªres et pas assez efficaces, nous avons donc int√©gr√© NextCloud, ONLYOFFICE et nginx commun, qui partage les demandes par nom de domaine, en utilisant docker-compose.  Voici des informations √©tape par √©tape sur la fa√ßon de proc√©der. <br><br><h2>  √âtape 1: conteneur Nginx </h2><br>  Il s'agit d'une installation tr√®s simple, mais cette √©tape n√©cessite le plus de travail pour configurer le serveur proxy inverse.  Tout d'abord, nous avons cr√©√© la configuration docker-compose pour l'image nginx: stable. <br><br><pre><code class="plaintext hljs">version: '2' services: nginx: image : nginx:stable restart: always volumes: - ./nginx/nginx-vhost.conf:/etc/nginx/conf.d/default.conf:ro - ./nginx/certificates:/mycerts ports: - 443:443 - 80:80</code> </pre> <br>  Cela cr√©e un conteneur avec les ports 80 et 443 ouverts √† l'acc√®s public, mappe la configuration √† nginx / nginx-vhost.conf et d√©finit le magasin pour les certificats g√©n√©r√©s en tant que certificats auto-sign√©s ou en utilisant le certificat Let's Go Encrypt de / nginx / certificats.  Cet emplacement doit contenir des dossiers pour office.votredomaine.com et cloud.votredomaine.com avec respectivement les fichiers fullchain1.pem et privkey1.pem pour la cha√Æne de certificats et la cl√© priv√©e du serveur.  Vous pouvez en savoir plus sur la fa√ßon de g√©n√©rer un certificat auto-sign√© ici <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.akadia.com/services/ssh_test_certificate.html</a> (renommer .key et .crt en .pem fonctionne sans convertir la structure de fichiers pour nginx). <br><br>  Apr√®s cela, nous avons d√©fini le fichier vhost.  Tout d'abord, nous d√©finissons le comportement du port 80 comme une simple redirection vers https, comme  nous ne voulons autoriser aucun trafic http <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> https://<span class="hljs-variable"><span class="hljs-variable">$host</span></span><span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>; } }</code> </pre><br>  Ensuite, nous avons cr√©√© deux serveurs virtuels sur le port 443 pour nos services: <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> cloud.yourdomain.com ; <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /var/www/html; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate</span></span> /mycerts/cloud.yourdomain.com/fullchain1.pem; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate_key</span></span> /mycerts/cloud.yourdomain.com/privkey1.pem; <span class="hljs-attribute"><span class="hljs-attribute">ssl_protocols</span></span> TLSv1 TLSv1.<span class="hljs-number"><span class="hljs-number">1</span></span> TLSv1.<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_ciphers</span></span> HIGH:!aNULL:!MD5; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-Proto <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$http_host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_redirect</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://app:80; } } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> office.yourdomain.com; <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /var/www/html; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate</span></span> /mycerts/office.yourdomain.com/fullchain1.pem; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate_key</span></span> /mycerts/office.yourdomain.com/privkey1.pem; <span class="hljs-attribute"><span class="hljs-attribute">ssl_protocols</span></span> TLSv1 TLSv1.<span class="hljs-number"><span class="hljs-number">1</span></span> TLSv1.<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_ciphers</span></span> HIGH:!aNULL:!MD5; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-Proto <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$http_host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_redirect</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://onlyoffice:80; } }</code> </pre><br><h2>  √âtape 2: service de documentation </h2><br>  Nous devons maintenant ajouter le conteneur de service de document √† notre docker-compose.yml.  Il n'y a rien de sp√©cial √† configurer ici. <br><br><pre> <code class="plaintext hljs">services: ... onlyoffice: image: onlyoffice/documentserver restart: always</code> </pre><br>  Mais n'oubliez pas d'associer le conteneur nginx au service de document: <br><br><pre> <code class="plaintext hljs">services: ... nginx: ... depends_on: - onlyoffice</code> </pre><br><h2>  √âtape 3: NextCloud </h2><br>  Nous ajoutons d'abord de nouveaux services: <br><br><pre> <code class="plaintext hljs">services: ... db: image: mariadb command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW restart: always volumes: - /data/nextcloud_db:/var/lib/mysql environment: - MYSQL_ROOT_PASSWORD=#put some password here - MYSQL_PASSWORD=#put some other password here - MYSQL_DATABASE=nextcloud - MYSQL_USER=nextcloud app: image: nextcloud depends_on: - db - onlyoffice restart: always</code> </pre><br>  et ajoutez le lien vers nginx: <br><br><pre> <code class="plaintext hljs">services: ... nginx: ... depends_on: - app</code> </pre><br>  Il est maintenant temps de charger les conteneurs. <br><br><pre> <code class="plaintext hljs">docker-compose up -d</code> </pre><br>  Apr√®s un certain temps, nginx commencera √† vous rediriger vers le frontend NextCloud, qui est la page de configuration par d√©faut.  Vous devrez entrer le nom d'utilisateur et le mot de passe de votre premier utilisateur administrateur et les informations d'identification de la base de donn√©es que vous avez sp√©cifi√©es dans docker-compose.yml. Une fois la configuration termin√©e, vous pouvez vous connecter.  Dans notre cas, l'attente a pris pr√®s d'une minute et a n√©cessit√© une mise √† jour suppl√©mentaire de la page de connexion avant de pouvoir acc√©der au service cloud. <br><br><div class="spoiler">  <b class="spoiler_title">Fen√™tre des param√®tres du service NextCloud</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gg/tv/hr/ggtvhrg3f4vqjlapvamnnqcxki4.png" alt="image"><br></div></div><br><h2>  √âtape 4: connexion de NextCloud et ONLYOFFICE </h2><br>  √Ä cette √©tape, vous devrez installer l'application pour NextCloud, qui connecte la fonctionnalit√© ONLYOFFICE.  Commen√ßons par le panneau de configuration de l'application dans le coin sup√©rieur droit du menu.  Trouvez l'application ONLYOFFICE (dans la section ¬´Office &amp; texte¬ª ou en utilisant la recherche), installez-la et activez-la. <br><br>  Apr√®s cela, allez dans Param√®tres via le menu dans le coin sup√©rieur droit, et vous devrez trouver l'√©l√©ment ONLYOFFICE dans le menu de gauche.  Allez-y.  Vous devrez enregistrer les adresses comme indiqu√© ci-dessous. <br><br><div class="spoiler">  <b class="spoiler_title">Param√®tres d'application d'int√©gration</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/6z/yo/zd/6zyozdod-h5kbcac9bug6ewuce0.png" alt="image"><br></div></div><br>  La premi√®re adresse est utilis√©e pour √©tablir un lien vers certains fichiers js et css directement √† partir de l'application ex√©cut√©e dans le navigateur (c'est pourquoi nous devons ouvrir l'acc√®s au service ONLYOFFICE via nginx).  La cl√© priv√©e n'est pas utilis√©e car nous faisons davantage confiance √† la couche d'isolation Docker qu'√† la cl√© d'authentification permanente.  La troisi√®me adresse est utilis√©e par le conteneur NextCloud pour se connecter directement √† l'API ONLYOFFICE et utilise le nom d'h√¥te interne par d√©faut de Docker.  Eh bien, le dernier champ est utilis√© pour que ONLYOFFICE puisse faire des demandes √† l'API NextCloud en utilisant une adresse IP externe ou une adresse Docker interne si vous utilisez des r√©seaux Docker, mais dans notre cas, cela n'est pas utilis√©.  Assurez-vous que vos param√®tres de pare-feu autorisent ces types d'interactions. <br><br>  Apr√®s l'enregistrement, NextCloud testera la connexion et, si tout est correct, vous montrera les param√®tres li√©s √† l'int√©gration - par exemple, quels types de fichiers peuvent √™tre modifi√©s par cette int√©gration.  Personnalisez comme bon vous semble. <br><br><h2>  La derni√®re √©tape: o√π chercher l'√©diteur </h2><br>  Si vous revenez dans les dossiers de votre stockage cloud et cliquez sur ¬´+¬ª pour cr√©er un nouveau fichier, une nouvelle option sera disponible pour cr√©er un document, un tableau ou une pr√©sentation.  Avec leur aide, vous allez cr√©er et √©diter imm√©diatement ces types de fichiers en utilisant ONLYOFFICE. <br><br><div class="spoiler">  <b class="spoiler_title">Menu de cr√©ation de fichiers</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xz/t6/-u/xzt6-uihcp-ofdpjhbcofhnu-wk.png" alt="image"><br></div></div><br><br><h4>  Addition 1 </h4><br>  Le contenu complet de docker-compose.yml peut √™tre trouv√© ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://pastebin.com/z1Ti1fTZ</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463629/">https://habr.com/ru/post/fr463629/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463617/index.html">Caract√©ristiques du test du MMO mobile</a></li>
<li><a href="../fr463619/index.html">Travailler √† distance: notre exp√©rience</a></li>
<li><a href="../fr463623/index.html">Nous sommes s√©lectionn√©s dans la jungle des tests: nous construisons √† courte distance des luminaires aux tests</a></li>
<li><a href="../fr463625/index.html">Surveillance du r√©seau et d√©tection de l'activit√© r√©seau anormale √† l'aide des solutions Flowmon Networks</a></li>
<li><a href="../fr463627/index.html">Biblioth√®que de g√©n√©rateur de code assembleur pour microcontr√¥leurs AVR. Partie 4</a></li>
<li><a href="../fr463631/index.html">Dialogues sur les lettres</a></li>
<li><a href="../fr463637/index.html">Tester votre infrastructure en tant que code avec Pulumi. 2e partie</a></li>
<li><a href="../fr463639/index.html">Eh bien Apple BLEee</a></li>
<li><a href="../fr463647/index.html">Vid√©os et rapports avec SmartMail Meetup: Frontend</a></li>
<li><a href="../fr463649/index.html">Note analytique. R√©vision de l'ordonnance du minist√®re de l'√ânergie de la F√©d√©ration de Russie du 6 novembre 2018 N 1015</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>