<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçÔ∏è üé† ü§† So erstellen Sie eine IIoT-Architektur zum Selbermachen üèöÔ∏è üìÇ ü§öüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im vergangenen Jahr haben wir mehrere IIoT-Projekte entworfen (und unterst√ºtzen sie auch weiterhin). Sie haben vielleicht schon von IIoT geh√∂rt, aber ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So erstellen Sie eine IIoT-Architektur zum Selbermachen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/415933/"><p>  Im vergangenen Jahr haben wir mehrere IIoT-Projekte entworfen (und unterst√ºtzen sie auch weiterhin).  Sie haben vielleicht schon von IIoT geh√∂rt, aber f√ºr alle F√§lle werden wir versuchen, so einfach wie m√∂glich zu erkl√§ren, was es ist und warum es f√ºr Entwickler, Architekten und Administratoren hoch geladener L√∂sungen interessant ist. </p><br><p><img src="https://habrastorage.org/webt/4v/ah/zc/4vahzcmpo0wh-i7hhutwxwzjjkk.png"></p><br><p>  IoT - das Internet der Dinge - umfasst die Steuerung von Ger√§ten, die f√ºr einfache Haushaltsaufgaben ausgelegt sind (√ñffnen des Garagentors beim Anfahren des Autos, Einschalten des Lichts mithilfe eines Bewegungssensors oder eines Befehls, √úberwachung der Raumtemperatur) und dann unter IIoT - dem industriellen Internet der Dinge - normalerweise im Hinblick auf die ‚ÄûDigitalisierung‚Äú von Daten aus der Industrie, auf deren Grundlage Expertenanalysen durchgef√ºhrt werden k√∂nnen, h√§ufig unter Verwendung von maschinellem Lernen. </p><a name="habracut"></a><br><p>  Sie k√∂nnen beispielsweise Daten von Rotationsmotoren sammeln und analysieren, um rechtzeitig √ºber Fehler zu erfahren und Reparaturen zu sparen.  Das Ersetzen einer komplett defekten Turbine ist viel teurer als eine rechtzeitige Reparatur.  Ein weiteres Beispiel ist der Kohlebergbau.  Durch die Analyse von Daten zur Luftzusammensetzung in Bergwerken k√∂nnen Sie rechtzeitig auf √úberschreitungen zul√§ssiger Werte reagieren.  Dies hilft, lebensbedrohliche Situationen f√ºr Bergleute zu verhindern. </p><br><p>  Der Datenstrom - von Feldsensoren, von Industriemaschinen, von Gassensoren - gelangt zu Aggregationsknotenpunkten und weiter zur Datenverarbeitungs- und Analyseplattform. </p><br><p>  Wir m√∂chten dar√ºber sprechen, wie eine solche Architektur aussieht, wie Daten ganz einfach erfasst und analysiert werden k√∂nnen und wie auf die Besonderheiten einzelner Anwendungen eingegangen wird.  Wir werden uns auf √úbersetzungen englischsprachiger Artikel und unsere eigene Designerfahrung verlassen.  Dieser Artikel wurde mit unseren Erkl√§rungen und Erg√§nzungen √ºbersetzt. </p><br><p>  Im ersten Artikel werden wir versuchen, eine IIoT-Architektur zu erstellen, in die wir Daten von Sensoren weiter √ºbertragen und sie dann an ein System √ºbertragen, das die Verarbeitung, Analyse, maschinelles Lernen und √úberwachung eingehender Daten erm√∂glicht. </p><br><h3 id="sozdavaemaya-arhitektura">  Erstellte Architektur </h3><br><p> Im industriellen IoT gibt es h√§ufig keinen direkten Zugriff auf Sensoren und Steuerungssysteme. Daher wird ein Gateway verwendet, um die Ebenen OT (Betriebstechnologie) und IT (Informationstechnologie) zu verbinden. </p><br><p>  Daher umfasst die IIoT-Architektur normalerweise: Endger√§te, Gateways, regionale Hubs und schlie√ülich Informationsverarbeitungs- und Speichersysteme. </p><br><p>  Die erstellte Architektur sollte eine Gelegenheit bieten: </p><br><ul><li>  Sammeln Sie Daten von Sensoren zum Gateway </li><li>  √úbertragen Sie Daten in die Cloud oder ins Rechenzentrum </li><li>  Aktualisieren Sie die Gateway-Konfigurationen automatisch </li><li>  Sorgen Sie f√ºr eine sichere Daten√ºbertragung und -verarbeitung </li></ul><br><p>  Auf dem Bild: Architektur des erstellten Systems und der Software, mit der wir es auf jeder Ebene erstellen werden. </p><br><p><img src="https://habrastorage.org/webt/pb/g9/ei/pbg9eiqinl-rarf31fvlpinih9o.png"></p><br><p>  Sensoren erfassen Daten und senden sie mithilfe verschiedener drahtgebundener und drahtloser Protokolle (seriell, RS-485, MODBUS, CAN-Bus, OPC UA, BLE, WiFi usw.) an das Gateway.  In unserem Beispiel werden wir ber√ºcksichtigen, dass die Daten √ºber WLAN zum Gateway gelangen. </p><br><p>  Als Gateway werden wir den Raspberry Pi verwenden, auf dem der Mosquitto-Broker und der MiNiFi-Agent gestartet werden.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mosquitto</a> ist ein Open-Source-Broker f√ºr leichte Nachrichten, mit dem wir Daten von Sensoren mithilfe des MQTT-Protokolls weiter √ºbertragen.  MQTT f√ºgt einen minimalen Overhead hinzu und ist daher f√ºr die Verwendung im IoT praktisch, wenn die Hardwareressourcen der Endger√§te begrenzt sind (z. B. Telefone und Mikrocontroller). </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apache MiNiFi</a> - ein Teilprojekt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apache NiFi</a> - ein leichtgewichtiger Agent, der die Kernfunktionalit√§t von Apache NiFi implementiert und speziell f√ºr die Erfassung von Daten auf Endger√§ten entwickelt wurde. </p><br><p>  MiNiFi ist kompakt, verbraucht nur minimale Ressourcen und erm√∂glicht die zentrale Verwaltung aller Agenten.  Mithilfe von Site-to-Site (S2S) kann problemlos eine Verbindung zu NiFi hergestellt werden. Auf diese Weise k√∂nnen Sie eine umfassende Datenflusskontrolle erstellen - skalierbar, sicher und mit einer klaren Vorstellung von allen Phasen der Informations√ºbertragung. </p><br><p>  In unserem System abonniert MiNiFi alle Mosquitto-Broker-Themen und leitet jede Nachricht an NiFi weiter, das auf regionaler Ebene festgelegt wurde.  Sie k√∂nnen es auch verwenden, um eine Verbindung zu einem SCADA-System oder einer anderen OT-Datenquelle herzustellen. </p><br><p>  Auf regionaler Ebene gibt es zwei Komponenten: </p><br><p>  Apache NiFi ist ein leistungsstarkes Datenstrom-Verwaltungssystem, das mehr als 200 Konnektoren unterst√ºtzt.  √úber eine grafische Oberfl√§che k√∂nnen Sie Datenstr√∂me schnell und einfach entwerfen. </p><br><p>  NiFi opfert der Einfachheit halber keine Leistung.  Es ist ein gut skalierbares verteiltes System mit garantierter Zustellung, Gegendruck (die F√§higkeit, Daten zu speichern, bevor sie auf andere, langsamere Systeme hochgeladen werden) und Lastausgleich.  Diese Funktionalit√§t macht NiFi zu einem hervorragenden Werkzeug f√ºr IoT-Anwendungen, die h√§ufig in instabilen Netzwerkumgebungen funktionieren. </p><br><p>  In unserem System ist NiFi ein Datenerfassungszentrum, das sie an verschiedene Systeme und Anwendungen (HDFS, HBase, Kafka, S3 usw.) weiterleitet. </p><br><p>  MiNiFi C2 Server (MiNiFi Command &amp; Control) ist ein weiteres Apache NiFi-Teilprojekt, das sich noch in der Entwicklung befindet.  Seine Aufgabe ist es, der zentrale Punkt bei der Konfiguration von Hunderten und Tausenden von MiNiFi-Agenten zu sein, die vor Ort produziert werden (verschiedene Hallen, Fabriken, Gebiete).  Der C2-Server verwaltet MiNiFi-Stream-Konfigurationen (in der C2-Terminologie - versionierte Anwendungsklasse) und ver√∂ffentlicht sie √ºber die Rest-API.  MiNiFi-Agenten k√∂nnen mit einer bestimmten H√§ufigkeit eine Verbindung zu dieser API herstellen, um ihre eigene Konfiguration zu aktualisieren. </p><br><p>  Beginnen wir also mit der Erstellung unseres Prototyps. </p><br><h4 id="soglashenie-o-imenovanii-domennyh-imen">  Domain Name Agreement </h4><br><p>  F√ºr die weitere Konfiguration der verschiedenen Systeme, die sich gegenseitig kontaktieren sollen, vereinbaren wir die Dom√§nennamen, die wir in den Konfigurationen verwenden werden. </p><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Apache NiFi      192.168.0.20 nifi.iot.local #  Apache MiNiFi C2     MiNiFi 192.168.0.20 minifi-c2.iot.local #raspberry pi,      Apache MiNiFi  MQTT  192.168.0.68 iot-hub-1.iot.local</span></span></code> </pre> <br><h4 id="podgotovka-raspberry-pi-mqtt-i-minifi">  Himbeer-Pi-Vorbereitung: MQTT und MiNiFi </h4><br><p>  F√ºhren Sie die folgenden Befehle auf Ihrem Raspberry Pi aus, um den MQTT Mosquitto-Broker und den MiNiFi-Agenten zu installieren. </p><br><p>  Standardm√§√üig enth√§lt MiNiFi einen minimalen Satz von Datenhandlern.  Sie k√∂nnen zus√§tzliche Handler aus dem NiFI-Kit hinzuf√ºgen, indem Sie dem Bibliotheksverzeichnis ein NAR-Archiv (NiFi-Archiv) hinzuf√ºgen. </p><br><p>  Mit dem letzten Befehl f√ºgen wir den NAR MQTT-Handler hinzu. </p><br><pre> <code class="bash hljs">sudo apt-get update <span class="hljs-comment"><span class="hljs-comment">#install and run Mosquitto broker on default port 1883 sudo apt-get install mosquitto mosquitto #install and prepare MiNiFi agent wget http://apache.crihan.fr/dist/nifi/minifi/0.4.0/minifi-0.4.0-bin.tar.gz tar -xvf minifi-0.4.0-bin.tar.gz cd minifi-0.4.0 #add mqtt processor wget https://github.com/ahadjidj-hw/NiFi/raw/master/nifi-mqtt-nar-1.5.0.nar -P ./lib/</span></span></code> </pre> <br><p>  Installieren wir nun den MiNiFi C2-Konfigurationsverwaltungsserver auf dem Server, der mit dem Raspberry Pi verf√ºgbar sein wird </p><br><h4 id="ustanovka-i-konfigurirovanie-minifi-c2-servera">  Installation und Konfiguration des MiNiFi C2-Servers. </h4><br><p>  Installieren Sie den MiNiFi C2-Server auf einem √∂ffentlichen Server, der f√ºr MiNiFi-Agenten verf√ºgbar ist.  Sie k√∂nnen die hierarchische Verteilung von C2-Servern f√ºr komplexe Netzwerkinfrastrukturen verwenden, wie unten beschrieben.  F√ºhren Sie den folgenden Befehl aus, um den C2-Server zu installieren: </p><br><pre> <code class="bash hljs">wget http://apache.crihan.fr/dist/nifi/minifi/0.4.0/minifi-c2-0.4.0-bin.tar.gz tar -xvf minifi-c2-0.4.0-bin.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> minifi-c2-0.4.0</code> </pre> <br><ul><li>  Der C2-Server ver√∂ffentlicht die klassenorganisierte Konfiguration.  C2 unterst√ºtzt steckbare ‚ÄûKonfigurationsanbieter‚Äú: </li><li>  Der CacheConfigurationProvider, der die Konfiguration basierend auf der im Dateisystem oder in S3 angegebenen Konfiguration aktualisiert </li><li>  Der DelegatingConfigurationProvider, der die Delegierung an einen anderen C2-Server √ºbergibt, um hierarchische Strukturen von C2-Servern zu erstellen. </li><li>  Der NiFiRestConfigurationProvider, der Vorlagen von Apache NiFi-Servern √ºber ihre REST-API entfernt. </li></ul><br><p>  Wir konfigurieren den C2-Server so, dass NiFi als Konfigurationsanbieter verwendet wird.  Bearbeiten Sie die Datei ./conf/minifi-c2-context.xml und kommentieren Sie den XML-Block aus </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.nifi.minifi.c2.provider.nifi.rest.NiFiRestConfigurationProvider"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  und notieren Sie sich die Adresse des NiFi-Servers ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: //nifi.iot.local: 8080</a> ). </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>http://nifi.iot.local:8080/nifi-api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4 id="dalneyshee-konfigurirovanie-minifi-na-raspberry-pi">  Weitere Konfiguration von MiNiFi auf dem Raspberry Pi </h4><br><p>  Um Handler und ihre Konfigurationen hinzuzuf√ºgen, m√ºssen Sie standardm√§√üig die Konfiguration ./conf/config.yml bearbeiten.  Die Konfiguration kann auch manuell geschrieben oder √ºber die Apache NiFi-Benutzeroberfl√§che erstellt und anschlie√üend als Vorlage exportiert werden.  Eine Vorlage ist eine XML-Datei, die mit dem MiNiFi-Toolkit in eine MiMLiFi-YML-Konfigurationsdatei konvertiert werden muss.  Hier ist eine Beispielkonfigurationsdatei, die die Datei auf dem Ger√§t √ºberwacht und jede neue Leitung mithilfe des S2S-Protokolls an NiFi weiterleitet. </p><br><p>  F√ºr unser Projekt verwenden wir keine manuelle Abstimmung.  Wenn es viele MiNiFi-Agenten gibt, ist es nicht einfach, die Datei config.yml manuell zu stoppen, zu bearbeiten und den Agenten jedes Mal neu zu starten, wenn sich die Konfiguration √§ndert. </p><br><p>  MiNiFi verwendet Change Ingestor, mit dem der Agent neue m√∂gliche Konfigurationen erf√§hrt.  Change Ingestor ist ein Plug-In, und es gibt drei ChangeIngestor, die von MiNiFi nativ unterst√ºtzt werden. </p><br><ul><li>  FileChangeIngestor </li><li>  RestChangeIngestor </li><li>  PullHttpChangeIngestor </li></ul><br><p>  Wir werden PullHttpChangeIngestor verwenden, um regelm√§√üig auf den C2-Server zuzugreifen und die neue Konfiguration herunterzuladen.  Um diesen Ingestor zu konfigurieren, m√ºssen Sie die Datei ./conf/bootstrap.conf bearbeiten, die entsprechenden Zeilen auskommentieren und die folgenden Einstellungen vornehmen: </p><br><pre> <code class="bash hljs">nifi.minifi.notifier.ingestors=org.apache.nifi.minifi.bootstrap.configuration.ingestors.PullHttpChangeIngestor <span class="hljs-comment"><span class="hljs-comment"># Hostname on which to pull configurations from nifi.minifi.notifier.ingestors.pull.http.hostname=minifi-c2.iot.local # Port on which to pull configurations from nifi.minifi.notifier.ingestors.pull.http.port=10080 # Path to pull configurations from nifi.minifi.notifier.ingestors.pull.http.path=/c2/config # Query string to pull configurations with nifi.minifi.notifier.ingestors.pull.http.query=class=iot-minifi-raspberry-agent # Period on which to pull configurations from, defaults to 5 minutes if commented out nifi.minifi.notifier.ingestors.pull.http.period.ms=60000</span></span></code> </pre> <br><p>  Mit dieser Konfiguration greift jeder MiNiFi-Agent jede Minute √ºber das REST-API-Protokoll unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: //minifi-c2.iot.local: 10080 / c2 / config</a> auf den C2-Server zu und fordert eine neue Konfiguration f√ºr die Klasse iot-minifi-raspberry-agent an <br>  Ein wichtiger Punkt: Die Frequenz von 1 Minute ist nur zur Demonstration eingestellt.  In einer Produktionsumgebung m√ºssen Sie Agenten h√∂chstwahrscheinlich nicht mit einer solchen H√§ufigkeit aktualisieren. </p><br><p>  Bevor Sie den Agenten starten, wechseln Sie zur Steuerungsebene und konfigurieren den MiNiFi C2-Server und Apache NiFi selbst. </p><br><h4 id="ustanovka-i-konfigurirovanie-nifi-servera">  Installieren und Konfigurieren eines NiFi-Servers </h4><br><p>  Installieren Sie den NiFi-Server, auf den vom C2-Server aus zugegriffen werden kann, und starten Sie ihn. </p><br><pre> <code class="bash hljs">wget http://apache.crihan.fr/dist/nifi/1.6.0/nifi-1.6.0-bin.tar.gz tar -xvf nifi-1.6.0-bin.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> nifi-1.6.0 ./bin/nifi.sh start</code> </pre> <br><p>  Stellen Sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // nifi-dev: 8080 / nifi /</a> eine Verbindung zur NiFi-Schnittstelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">her</a> und erstellen Sie einen Flow, der auf MiNiFi-Agenten ausgef√ºhrt wird. F√ºgen Sie jedoch zuvor den Eingangsport (hinzugef√ºgt durch Dr√ºcken der Schaltfl√§che Eingangsport im Men√º) in der Stammschicht hinzu und benennen Sie ihn von Raspberry MiNiFi.  Hier empf√§ngt NiFi Stream-Dateien von MiNiFi. </p><br><p>  F√ºgen Sie Trichter hinzu und verbinden Sie den Eingangsanschluss mit Trichter. In zuk√ºnftigen Artikeln werden wir uns mit der Datenverarbeitung auf der Apache NiFi-Seite befassen. </p><br><p>  F√ºgen Sie einen Processor consumerMQTT hinzu, um den Mosquitto-Broker zu abonnieren, und abonnieren Sie ihn f√ºr alle Themen </p><br><p><img src="https://habrastorage.org/webt/lx/pk/vf/lxpkvfs8-shmdy1newdrmvrxc2w.png"></p><br><p>  Verwenden Sie das Processor UpdateAttribute, um das Attribut "version" hinzuzuf√ºgen, mit dem wir das System √ºber die Neukonfiguration benachrichtigen.  Sie k√∂nnen zus√§tzliche Attribute hinzuf√ºgen: Zeitstempel, Standort, Agentenname usw. </p><br><p><img src="https://habrastorage.org/webt/ah/de/6o/ahde6oblujww3keigvuzk_jjoje.png"></p><br><p>  F√ºgen Sie abschlie√üend die Remote Process Group (RPG) hinzu, um empfangene Ereignisse an NiFi zu senden.  Kombinieren Sie alle drei Prozesse. </p><br><p><img src="https://habrastorage.org/webt/up/re/sf/upresfdp_hwcku4z4lykpp6upzc.png"></p><br><p>  Ihr Stream sollte jetzt wie im folgenden Screenshot aussehen.  Der linke Stream wird auf Apache NiFi selbst gestartet und empf√§ngt Daten von Apache MiNiFi.  Der rechte Thread startet nicht in Apache Nifi, das f√ºr Prototyping- und Konfigurationszwecke erstellt wurde, und l√§uft auf dem Raspberry Pi. </p><br><p><img src="https://habrastorage.org/webt/9q/jh/fi/9qjhfidv9dmhcxwlbu5bnwtafpk.png"></p><br><p>  Speichern Sie den richtigen Stream als Vorlage mit dem Namen "iot-minifi-raspberry-agent.v1".  Das Namensprinzip ist hier √§u√üerst wichtig.  Wir m√ºssen denselben Namen wie den in der MiNiFi-Konfiguration verwendeten Klassennamen verwenden. </p><br><p>  <em>Es ist sehr wichtig - Sie m√ºssen nicht nur die gespeicherten Komponenten hervorheben, sondern auch die Beziehungen zwischen ihnen.</em> <em><br></em> </p><br><p><img src="https://habrastorage.org/webt/zw/7u/8p/zw7u8prl5qspooe5igan-b7cy6c.png"></p><br><h4 id="razmeschenie-i-zapusk-prilozheniya">  Platzierung und Start der Anwendung </h4><br><p>  Bevor Sie die MiNiFi-Agenten auf dem Raspberry Pi starten, √ºberpr√ºfen Sie, ob der C2-Server korrekt konfiguriert ist.  √ñffnen Sie die URL in Ihrem Browser: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // c2-server: 10080 / c2 / config? Class = iot-minifi-raspberry-agent &amp; version = 1 Der</a> C2-Server sollte mit einer Datei antworten, die die Konfiguration der Vorlage enth√§lt, die wir im YML-Format erstellt haben. </p><br><p><img src="https://habrastorage.org/webt/-2/b-/oj/-2b-oj_o1-wcxszifh4zopzmkd8.png"></p><br><p>  Wenn der Server anstelle der Konfiguration eine Java-Ausnahme ausl√∂st, tritt auf dem hier genannten C2-Server ein Problem auf: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/apache/nifi-minifi/pull/126#issuecomment-388856304</a> <br>  Sie m√ºssen entweder Version 0.3.0 installieren oder die Datei javax.ws.rs-api-2.1.jar aus dem Ordner lib des C2-Serververzeichnisses entfernen. </p><br><p>  Wenn Sie sich die C2-Serverprotokolle ansehen, k√∂nnen Sie sehen, dass der Server die Anforderung mit den Parametern {class = [iot-minifi-raspberry-agent], version = [1]} akzeptiert hat. </p><br><p><img src="https://habrastorage.org/webt/ov/u_/r-/ovu_r-lyumqz9l_j_qpigysyuoe.png"></p><br><p>  Nachdem die Verbindung zwischen den einzelnen Architekturkomponenten (MQTT, MiNiFi, NiFi und C2) hergestellt wurde, starten Sie den MiNiFi-Agenten auf dem Raspberry Pi mit dem folgenden Befehl: </p><br><pre> <code class="bash hljs">./bin/minifi.sh start</code> </pre> <br><p>  Nach einigen Sekunden sollten die C2-Serverprotokolle angezeigt werden.  Der Host 192.168.1.50 (in unserem Fall die IP-Adresse des Raspberry Pi-Ger√§ts) forderte den C2-Server auf, die neueste Version der Klasse ‚Äûiot-minifi-raspberry-agent‚Äú bereitzustellen.  Im Vergleich zu unserer vorherigen Anfrage, die wir im Browser gestellt haben, k√∂nnen Sie feststellen, dass MiNiFi die Version nicht angegeben hat.  Wenn Sie die Konfiguration des MiNiFi-Agenten in ./conf/config.yml √∂ffnen, wird dieselbe Konfiguration angezeigt, die wir im Browser erhalten haben, und die Anforderung wird manuell festgelegt. </p><br><p><img src="https://habrastorage.org/webt/mx/iz/kt/mxizktf5jxyrrqz2k3wtvzjrtx0.png"></p><br><p>  MQTT zeigt, dass der MiNiFi-Agent mit dem Broker verbunden ist und die Themen iot / sensor / # abonniert hat </p><br><p><img src="https://habrastorage.org/webt/5r/3m/gy/5r3mgyboojzkkldhcmxicengpsu.png"></p><br><h4 id="kontrol-peredavaemyh-dannyh">  Getriebesteuerung </h4><br><p>  Gro√üartig, jetzt lassen Sie unsere Sensoren Daten generieren und in MQTT ver√∂ffentlichen.  MiNiFi beginnt mit dem Hochladen von Informationen und dem Senden an NiFi, wie im folgenden Screenshot gezeigt. </p><br><p>  <em>Wichtig: Damit die Apache NiFi-Komponente funktioniert, m√ºssen Sie auf die Schaltfl√§che Wiedergabe klicken.</em> <em><br></em> <br><img src="https://habrastorage.org/webt/0z/h_/qu/0zh_qu6j5ftih7dgmupq7we3b4e.png"></p><br><p>  Schauen wir uns nun einen dieser Beitr√§ge in NiFi an.  Die Informationen stammen vom Sensor ‚Äûiot / sensors / LightIntensity / z‚Äú, Anwendungsversion - 1 </p><br><p><img src="https://habrastorage.org/webt/pj/zh/ie/pjzhiekpoq8vqe4wgipbjxgiwha.png"></p><br><h4 id="obnovlenie-konfiguracii-minifi">  MiNiFi-Konfigurationsupdate </h4><br><p>  Nachdem unsere Infrastruktur funktioniert und die Daten in unser ‚ÄûRechenzentrum‚Äú gelangen, installieren wir eine neue MiNiFi-Konfiguration.  Gehen Sie zur Apache NiFi-Oberfl√§che und bearbeiten Sie den updateAttribute-Handler.  √Ñndern Sie das Attribut "version" in 2 anstelle von 1 und speichern Sie die neue Vorlage "iot-minifi-raspberry-agent.v2".  Das ist alles.  Die neue Konfiguration wird automatisch bereitgestellt. </p><br><p>  Sie k√∂nnen in den C2-Serverprotokollen nachsehen, dass eine neue Version von V2 erkannt wurde. Der Server hat sie nicht in seinem Cache gefunden und geladen. </p><br><p><img src="https://habrastorage.org/webt/cm/-4/sc/cm-4sccwolb-9dnpd4f88fga5pk.png"></p><br><p>  Dann erkennt MiNiFi die neue Konfiguration, reserviert die vorherige Konfiguration, entl√§dt die neue und startet neu: </p><br><p><img src="https://habrastorage.org/webt/w-/tv/44/w-tv44lsbcmdb0ckfdnue4r4iya.png"></p><br><blockquote>  Im n√§chsten Artikel werden wir dar√ºber sprechen, wie wir die Sensoren zusammengebaut und in unsere Architektur integriert haben.  Danach werden wir √ºber die Datenanalyse sprechen. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415933/">https://habr.com/ru/post/de415933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415919/index.html">Refactoring eines Programms auf Go: 23-fache Beschleunigung</a></li>
<li><a href="../de415923/index.html">Ist die Einheit langsam? Achtung LINQ</a></li>
<li><a href="../de415925/index.html">MasterCard patentierte anonyme Blockchain-Technologie</a></li>
<li><a href="../de415927/index.html">Industrielampe Breeze 50</a></li>
<li><a href="../de415929/index.html">Optimierung der Architektur der k√ºnstlichen Intelligenz: Das Rennen beginnt</a></li>
<li><a href="../de415935/index.html">Insertion Sorts</a></li>
<li><a href="../de415937/index.html">Die japanische Privatrakete MOMO-2 explodierte auf der Startrampe</a></li>
<li><a href="../de415939/index.html">Verteilte Grafikverarbeitung mit Spark GraphX</a></li>
<li><a href="../de415941/index.html">Wie wir versucht haben, Barcodes herauszufinden und nichts verstanden haben</a></li>
<li><a href="../de415943/index.html">"Spieleentwicklung und Unterhaltungstheorie": Wichtige Punkte aus Raff Costers Buch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>