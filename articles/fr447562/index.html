<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüéì üßõüèæ üßëüèæ‚Äçü§ù‚ÄçüßëüèΩ Introduction √† la r√©tro-ing√©nierie: piratage du format de donn√©es de jeu üõåüèæ üö¥ üçê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 
 L'ing√©nierie inverse d'un fichier de donn√©es inconnu peut √™tre d√©crite comme un processus de compr√©hension progressive. √Ä bien des √©gar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Introduction √† la r√©tro-ing√©nierie: piratage du format de donn√©es de jeu</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447562/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/xm/us/qv/xmusqvwf26b55v59lw13mtqxrru.png"></div><br><h3>  Pr√©sentation </h3><br>  L'ing√©nierie inverse d'un fichier de donn√©es inconnu peut √™tre d√©crite comme un processus de compr√©hension progressive.  √Ä bien des √©gards, elle ressemble √† une m√©thode scientifique, appliqu√©e uniquement aux objets abstraits cr√©√©s par l'homme, et non au monde naturel.  Nous commen√ßons par collecter des donn√©es, puis utilisons ces informations pour avancer une ou plusieurs hypoth√®ses.  Nous testons les hypoth√®ses et appliquons les r√©sultats de ces tests pour les clarifier.  Si n√©cessaire, r√©p√©tez le processus. <br><br>  Le d√©veloppement de comp√©tences en ing√©nierie inverse est essentiellement une question de pratique.  En acqu√©rant de l'exp√©rience, vous acqu√©rez une compr√©hension intuitive de ce que vous devez d'abord explorer, des mod√®les que vous devez rechercher et des outils les plus pratiques √† utiliser. <br><br>  Dans cet article, je parlerai en d√©tail du processus de r√©tro-ing√©nierie des fichiers de donn√©es d'un ancien jeu informatique pour montrer comment cela se fait. <br><br><h3>  Un peu de fond </h3><br>  Tout a commenc√© lorsque j'ai essay√© de recr√©er le <em>Chip's Challenge</em> sur Linux. <br><br>  Le <em>Chip's Challenge a</em> √©t√© initialement publi√© en 1989 pour la console portable Atari Lynx, aujourd'hui oubli√©e.  √Ä cette √©poque, Atari Lynx √©tait une voiture impressionnante, mais elle est sortie en m√™me temps que la Nintendo Game Boy, qui a finalement conquis le march√©. <br><br>  <em>Chip's Challenge</em> est un jeu de puzzle avec une vue de dessus et une carte de tuiles.  Comme pour la plupart de ces jeux, l'objectif de chaque niveau est d'arriver √† la sortie.  Dans la plupart des niveaux, la sortie est prot√©g√©e par un connecteur pour la puce, qui ne peut √™tre contourn√© qu'en collectant un certain nombre de puces informatiques. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7a/ec3/52a/d7aec352a9ecea5a20825cb1d7eb1273.jpg" alt="image"></div><br>  Vid√©o: <a href="">Atari Lynx en action</a> , <a href="">proc√©dure pas √† pas de niveau un</a> . <br><br>  Un nouveau jeu d√©marre √† partir du premier niveau sous le nom de "LE√áON 1".  En plus des puces et d'un emplacement pour une puce, des cl√©s et des portes y apparaissent.  √Ä d'autres niveaux, des obstacles tels que des pi√®ges, des bombes, de l'eau et des cr√©atures se posent qui se d√©placent (le plus souvent) le long d'itin√©raires pr√©visibles.  Une large gamme d'objets et d'appareils vous permet de cr√©er de nombreux puzzles et limites de temps.  Pour terminer le jeu, vous devez passer par plus de 140 niveaux. <br><br>  Bien que Lynx ait finalement √©chou√©, le <em>Chip's Challenge</em> s'est r√©v√©l√© tr√®s populaire et a √©t√© port√© sur de nombreuses autres plates-formes, apparaissant finalement sur Microsoft Windows, o√π il s'est g√©n√©ralis√©.  Autour du jeu, une petite mais d√©di√©e de fans s'est form√©e et, au fil du temps, un √©diteur de niveau a √©t√© √©crit qui a permis aux joueurs de cr√©er d'innombrables niveaux. <br><br>  Et c'est l√† que commence mon histoire.  J'ai d√©cid√© que je voulais cr√©er une version du moteur de jeu open source de base afin de pouvoir jouer au <em>Chip's Challenge</em> sur Linux et Windows, et faciliter l'ex√©cution de tous les niveaux cr√©√©s par les fans. <br><br>  L'existence de l'√©diteur de niveau s'est av√©r√©e √™tre un miracle pour moi, car j'ai pu explorer les fonctionnalit√©s cach√©es de la logique du jeu, cr√©er mes propres niveaux et effectuer des tests.  Malheureusement, il n'y avait pas d'√©diteur de niveau pour le jeu Lynx original; il n'apparaissait que dans le port le plus connu sous Windows. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a57/5e9/279/a575e927941878177f8b346378d1735d.jpg" alt="image"></div><br>  Le port Windows n'a pas √©t√© cr√©√© par les d√©veloppeurs d'origine, donc de nombreux changements dans la logique du jeu y sont apparus (et tous n'√©taient pas intentionnels).  Quand j'ai commenc√© √† √©crire mon moteur, je voulais recr√©er la logique du jeu original sur Lynx et la version la plus connue pour Windows.  Mais l'absence d'un √©diteur de niveau sur Lynx a s√©rieusement limit√© ma capacit√© √† √©tudier le jeu original en d√©tail.  Le port Windows avait un avantage: les niveaux √©taient stock√©s dans un fichier de donn√©es s√©par√©, ce qui simplifiait sa d√©tection et son reverse engineering.  Le jeu pour Lynx a √©t√© distribu√© sur des cartouches ROM contenant des images de sprite, des effets sonores et du code machine, ainsi que des donn√©es de niveau qui ont √©t√© ex√©cut√©es ensemble.  Il n'y a aucune indication sur l'emplacement des donn√©es dans ce vidage de 128 kilo-octets de la ROM, ni √† quoi elles ressemblent, et sans cette connaissance, je ne pourrais pas cr√©er un √©diteur de niveau pour la version Lynx. <br><br>  Une fois, dans un processus de recherche tranquille, je suis tomb√© sur une copie du port <em>Chip's Challenge</em> sous MS-DOS.  Comme pour la plupart des premiers ports du jeu, sa logique √©tait plus proche de l'original que dans la version Windows.  Quand j'ai regard√© les donn√©es du programme pour savoir comment elles sont stock√©es, j'ai √©t√© surpris de constater que les donn√©es de niveau √©taient allou√©es dans un r√©pertoire s√©par√©, et chaque niveau √©tait stock√© dans son propre fichier.  Ayant des donn√©es de niveau si commod√©ment s√©par√©es, j'ai sugg√©r√© qu'il ne serait pas trop difficile de proc√©der √† une r√©tro-ing√©nierie des fichiers de donn√©es de niveau.  Et cela vous permettra d'√©crire un √©diteur de niveau pour la version du jeu sous MS-DOS.  J'ai d√©cid√© que c'√©tait une opportunit√© int√©ressante. <br><br>  Mais un autre membre de la communaut√© <em>Chip's Challenge</em> m'a averti d'un fait int√©ressant.  Le contenu des fichiers de niveau pour MS-DOS s'est av√©r√© √™tre un vidage d'octets de ROM Lynx.  Cela signifiait que si je pouvais d√©coder les fichiers MS-DOS, je pourrais alors utiliser ces connaissances pour lire et modifier les niveaux √† l'int√©rieur du vidage de la m√©moire ROM Lynx.  Ensuite, vous pouvez cr√©er un √©diteur de niveau directement pour le jeu original sur Lynx. <br><br>  Du coup, ma priorit√© absolue √©tait les fichiers de niveau de r√©tro-ing√©nierie pour MS-DOS. <br><br><h3>  Fichiers de donn√©es </h3><br>  Voici un lien vers le r√©pertoire <a href="">tarball</a> contenant tous les fichiers de donn√©es.  Je le donne au cas o√π vous voudriez r√©p√©ter apr√®s moi toutes les √©tapes d√©crites dans cet article, ou essayer de d√©coder vous-m√™me les fichiers de donn√©es. <br><blockquote>  <strong>Est-ce l√©gal?</strong>  Bonne question.  √âtant donn√© que ces fichiers ne sont qu'une petite partie du programme pour MS-DOS, et en eux-m√™mes, ils sont inutiles, et puisque je les publie uniquement √† des fins √©ducatives, je pense que cela rel√®ve des exigences d'utilisation √©quitable.  J'esp√®re que toutes les parties int√©ress√©es seront d'accord avec moi.  (Si je re√ßois n√©anmoins une lettre de menaces de la part d'avocats, je peux modifier l'article de mani√®re √† pr√©senter les fichiers de donn√©es de mani√®re amusante, puis d√©clarer qu'il s'agit d'une parodie.) </blockquote><br><h3>  Pr√©requis </h3><br>  Je suppose que vous connaissez le calcul hexad√©cimal, m√™me si vous ne connaissez pas le d√©codage des valeurs hexad√©cimales, et aussi que vous connaissez un peu le shell Unix.  La session shell pr√©sent√©e dans cet article s'ex√©cute sur un syst√®me Linux standard, mais les commandes presque utilis√©es sont des utilitaires Unix courants et sont largement distribu√©es sur d'autres syst√®mes de type Unix. <br><br><h3>  Premier coup d'oeil </h3><br>  Voici une liste du r√©pertoire contenant les fichiers de donn√©es du port sous MS-DOS: <br><blockquote><pre>  Niveaux $ ls
 all_full.pak cake_wal.pak eeny_min.pak iceberg.pak lesson_5.pak mulligan.pak playtime.pak southpol.pak totally_.pak
 alphabet.pak castle_m.pak elementa.pak ice_cube.pak lesson_6.pak nice_day.pak potpourr.pak special.pak traffic_.pak
 amsterda.pak catacomb.pak fireflie.pak icedeath.pak lesson_7.pak nightmar.pak problems.pak spirals.pak trinity.pak
 apartmen.pak cellbloc.pak firetrap.pak icehouse.pak lesson_8.pak now_you_.pak refracti.pak spooks.pak trust_me.pak
 arcticfl.pak chchchip.pak floorgas.pak invincib.pak lobster_.pak nuts_and.pak reverse_.pak steam.pak undergro.pak
 balls_o_.pak chiller.pak forc√©_e.pak i.pak lock_blo.pak on_the_r.pak rink.pak stripes.pak up_the_b.pak
 beware_o.pak chipmine.pak force_fi.pak i_slide.pak loop_aro.pak oorto_ge.pak roadsign.pak suicide.pak vanishin.pak
 blink.pak citybloc.pak force_sq.pak jailer.pak memory.pak open_que.pak sampler.pak telebloc.pak victim.pak
 blobdanc.pak colony.pak fortune_.pak jumping_.pak metastab.pak oversea_.pak scavenge.pak telenet.pak vortex.pak
 blobnet.pak corridor.pak four_ple.pak kablam.pak mind_blo.pak pain.pak scoundre.pak t_fair.pak wars.pak
 block_fa.pak cypher.pak four_squ.pak knot.pak mishmesh.pak paranoia.pak voyant_s.pak the_last.pak √©crivains_.pak
 block_ii.pak deceptio.pak glut.pak ladder.pak miss_dir.pak partial_.pak short_ci.pak the_mars.pak yorkhous.pak
 block_n_.pak deepfree.pak goldkey.pak lemmings.pak mixed_nu.pak pentagra.pak shrinkin.pak the_pris.pak
 block_ou.pak digdirt.pak go_with_.pak lesson_1.pak mix_up.pak perfect_.pak skelzie.pak three_do.pak
 block.pak digger.pak grail.pak lesson_2.pak monster_.pak pier_sev.pak slide_st.pak time_lap.pak
 bounce_c.pak doublema.pak hidden_d.pak lesson_3.pak morton.pak ping_pon.pak slo_mo.pak torturec.pak
 brushfir.pak drawn_an.pak hunt.pak lesson_4.pak mugger_s.pak playhous.pak socialis.pak tossed_s.pak </pre></blockquote>  Comme vous pouvez le voir, tous les fichiers se terminent par <code>.pak</code> .  <code>.pak</code> est l'autorisation standard pour le fichier de donn√©es d'application, et cela, malheureusement, ne nous donne aucune information sur sa structure interne.  Les noms de fichiers sont les huit premiers caract√®res du nom de niveau, √† quelques exceptions pr√®s.  (Par exemple, dans les noms des fichiers de niveau ¬´BLOCK BUSTER¬ª et ¬´BLOCK BUSTER II¬ª, le mot ¬´buster¬ª est omis afin qu'ils ne correspondent pas.) <br><blockquote><pre>  Niveaux $ ls |  wc
      17 148 1974 </pre></blockquote>  Il y a 148 fichiers de donn√©es dans le r√©pertoire, et le jeu a en fait exactement 148 niveaux, donc tout est pareil ici. <br><br>  Examinons maintenant ce que sont ces fichiers.  <code>xxd</code> est un utilitaire standard pour vider des donn√©es hexad√©cimales (hexdump).  Voyons √† quoi cela ressemble √† l'int√©rieur de la LE√áON 1. <br><blockquote><pre>  $ xxd niveaux / le√ßon_1.pak
 00000000: 1100 cb00 0200 0004 0202 0504 0407 0505 ................
 00000010: 0807 0709 0001 0a01 010b 0808 0d0a 0a11 ................
 00000020: 0023 1509 0718 0200 2209 0d26 0911 270b. # ...... ".. &amp; ..".
 00000030: 0b28 0705 291e 0127 2705 020d 0122 0704. (..) ..''.... "..
 00000040: 0902 090a 0215 0426 0925 0111 1502 221d ....... &amp;.% .... ".
 00000050: 0124 011d 0d01 0709 0020 001b 0400 1a00. $ ....... ......
 00000060: 2015 2609 1f00 3300 2911 1522 2302 110d. &amp; ... 3.) .. "# ...
 00000070: 0107 2609 1f18 2911 1509 181a 0223 021b .. &amp; ...) ...... # ..
 00000080: 0215 2201 1c01 1c0d 0a07 0409 0201 0201 .. ".............
 00000090: 2826 0123 1505 0902 0121 1505 220a 2727 (&amp;. # .....! .. ". ''
 000000a0: 0b05 0400 060b 0828 0418 780b 0828 0418 ....... (.. x .. (..
 000000b0: 700b 0828 0418 6400 1710 1e1e 1a19 0103 p .. (.. d .........
 000000c0: 000e 1a17 1710 0e1f 010e 1314 1b29 1f1a .............) ..
 000000d0: 0012 101f 011b 0c1e 1f01 1f13 1001 0e13 ................
 000000e0: 141b 001e 1a0e 1610 1f2d 0020 1e10 0116 .........-.  ....
 000000f0: 1024 291f 1a01 1a1b 1019 000f 1a1a 1d1e. $) .............
 00000100: 2d02 </pre></blockquote><blockquote>  <strong>Qu'est-ce qu'un utilitaire hexdump?</strong>  Un vidage hexad√©cimal est un moyen standard d'afficher les octets exacts d'un fichier binaire.  La plupart des valeurs d'octets ne peuvent pas √™tre associ√©es √† des caract√®res ASCII imprimables, ou elles ont une apparence incompr√©hensible (comme un caract√®re de tabulation).  Dans un vidage hexad√©cimal, les octets individuels sont sortis sous forme de valeurs num√©riques.  Les valeurs sont affich√©es en hexad√©cimal, d'o√π le nom.  Dans l'exemple ci-dessus, 16 octets sont affich√©s sur une ligne de sortie.  La colonne la plus √† gauche indique la position de la ligne dans le fichier, √©galement en hexad√©cimal, de sorte que le nombre dans chaque ligne est augment√© de 16. Les octets sont affich√©s sur huit colonnes et deux octets sont affich√©s dans chaque colonne.  Le vidage hexad√©cimal √† droite montre √† quoi ressembleraient les octets lorsqu'ils sont affich√©s par des caract√®res, seules toutes les valeurs ASCII non imprimables sont remplac√©es par des points.  Cela facilite la recherche de cha√Ænes pouvant √™tre incorpor√©es dans un fichier binaire. </blockquote>  √âvidemment, la r√©tro-ing√©nierie de ces fichiers ne se r√©sumera pas √† parcourir simplement le contenu et √† explorer ce qui y est visible.  Jusqu'√† pr√©sent, rien ne nous dit quelles fonctions remplissent les donn√©es. <br><br><h3>  Qu'attendons-nous de voir? </h3><br>  Prenons un peu de recul et clarifions la situation: quelles donn√©es sp√©cifiques attendons-nous √† trouver dans ces fichiers de donn√©es? <br><br>  Le plus √©vident est une certaine ¬´carte¬ª du niveau: des donn√©es indiquant la position des murs et des portes, ainsi que tout le reste, ce qui rend le niveau unique. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fe5/03a/ae9/fe503aae95f2acaa3a3663c43f528cef.png"></div><br>  (Heureusement pour nous, les fans du jeu ont fait un travail minutieux et ont collect√© des cartes compl√®tes pour les 148 niveaux, afin que nous puissions les utiliser pour savoir ce qui devrait √™tre sur chaque carte.) <br><br>  En plus de la carte, chaque niveau doit avoir plusieurs autres attributs.  Par exemple, vous remarquerez peut-√™tre que chaque niveau a un nom, par exemple, ¬´LE√áON 1¬ª, ¬´PARFAIT MATCH¬ª, ¬´DESSIN√â ET QUARTIER¬ª, etc.  Diff√©rents niveaux ont √©galement des d√©lais diff√©rents, nous pouvons donc supposer que ces informations sont √©galement contenues dans les donn√©es.  De plus, chaque niveau a son propre nombre de puces assembl√©es.  (Nous pourrions supposer que ce nombre correspond simplement au nombre de puces au niveau, mais il s'av√®re qu'√† certains niveaux, il y a plus de puces que n√©cessaire pour ouvrir le slot de puce. Au moins pour ces niveaux, le nombre minimum doit √™tre indiqu√© de mani√®re explicite.) <br><br>  Un autre √©l√©ment de donn√©es que nous nous attendons √† trouver dans les donn√©es de niveau est le texte de conseil.  √Ä certains niveaux, il y a un ¬´bouton d'indication¬ª - un grand point d'interrogation gisant sur le sol.  Lorsque la puce se l√®ve dessus, un texte d'info-bulle s'affiche.  Le bouton d'indication est √† environ 20 niveaux. <br><br>  Enfin, chaque niveau a un mot de passe - une s√©quence de quatre lettres qui permet au joueur de continuer le jeu √† partir de ce niveau.  (Ce mot de passe est requis car Lynx n'a pas de magasin de donn√©es. Il √©tait impossible d'enregistrer des jeux sur la console, vous pouvez donc continuer √† jouer apr√®s avoir allum√© la console √† l'aide de mots de passe.) <br><br>  Voici donc notre liste de donn√©es pertinentes: <br><br><ul><li>  Carte des niveaux </li><li>  Nom du niveau </li><li>  Niveau de mot de passe </li><li>  Limite de temps </li><li>  Nombre de jetons </li><li>  Texte de l'info-bulle </li></ul><br>  Estimons approximativement la taille totale des donn√©es.  Le moyen le plus simple de d√©terminer la limite de temps et le nombre de jetons.  Ces deux param√®tres peuvent avoir des valeurs comprises entre 0 et 999, ils sont donc tr√®s probablement stock√©s sous forme de valeurs enti√®res avec une taille totale de 4 octets.  Le mot de passe se compose toujours de quatre lettres, il est donc tr√®s probablement stock√© sur quatre octets suppl√©mentaires, c'est-√†-dire seulement 8 octets.  La longueur des noms des niveaux varie de quatre √† dix-neuf caract√®res.  Si nous supposons que nous avons besoin d'un autre octet pour terminer la ligne, alors cela fait vingt octets, c'est-√†-dire que le sous-total est de 28 octets.  Le texte de l'infobulle le plus long fait plus de 80 octets;  si nous arrondissons cette valeur √† 90, nous obtiendrons 118 octets au total. <br><br>  Qu'en est-il du sch√©ma de niveaux?  La plupart des niveaux ont une taille de 32 √ó 32 tuiles.  Des niveaux plus importants n'existent pas.  Certains niveaux sont inf√©rieurs, mais il serait logique de supposer qu'ils sont simplement int√©gr√©s dans une carte 32 √ó 32. Si nous supposons qu'un octet est requis pour une tuile, alors 1024 octets sont n√©cessaires pour le circuit complet.  Autrement dit, nous obtenons une estimation approximative de 1142 octets par niveau.  Bien s√ªr, ce n'est qu'une estimation initiale approximative.  Il est possible que certains de ces √©l√©ments soient stock√©s diff√©remment, ou pas du tout stock√©s dans des fichiers de niveau.  Ou ils peuvent contenir d'autres donn√©es que nous n'avons pas remarqu√©es ou que nous ne connaissons pas √† leur sujet.  Mais jusqu'√† pr√©sent, nous avons jet√© de bonnes bases. <br><br>  Apr√®s avoir d√©cid√© de ce que nous nous attendons √† voir dans les fichiers de donn√©es, revenons √† l'√©tude de ce qu'ils contiennent r√©ellement. <br><br><h3>  Qu'est-ce qui est l√† et ce qui ne l'est pas </h3><br>  Bien qu'√† premi√®re vue, le fichier de donn√©es semble compl√®tement incompr√©hensible, vous pouvez toujours y remarquer quelques points.  D'abord, c'est ce que nous <em>ne</em> voyons <em>pas</em> .  Par exemple, nous ne voyons ni le nom du niveau ni le texte des conseils.  Vous pouvez comprendre que ce n'est pas un hasard, apr√®s avoir √©tudi√© d'autres fichiers: <br><blockquote><pre>  $ strings niveaux / * |  moins
 : !!; #
 &amp;&gt; '' :: 4 #
 . ,,!
 -54 ";
 / &amp; 67
 !) 60
 &lt;171
 * (0 *
 82&gt; '= /
 8&gt; &lt;171 &amp;&amp;
 9&gt; # 2 ') (
 ,) 9
  0hX
 `@PX
 ) "" *
 24 ** 5
 ;)) &lt;
 B777: .. 22C1
 E ,, F
 -GDED
 EGFF16G ;; H &lt;
 IECJ
 9K444
 = MBBB &gt;&gt; N9 "O" 9P3? Q
 lignes 1-24 / 1544 (plus) </pre></blockquote>  Rien n'est visible ici, sauf des fragments arbitraires de d√©chets ASCII. <br><br>  Vraisemblablement, quelque part dans ces fichiers, il y a des noms et des indices de niveau, mais ils ne sont pas stock√©s en ASCII ou ont subi une transformation (par exemple, en raison de la compression). <br><br>  Il convient √©galement de noter ce qui suit: le fichier atteint √† peine 256 octets.  C'est assez petit, √©tant donn√© qu'au d√©part, nous estimions sa taille √† plus de 1140 octets. <br><br>  L'option <code>-S</code> trie les fichiers par ordre d√©croissant de taille. <br><br><blockquote><pre>  Niveaux $ ls -lS |  t√™te
 592 au total
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 680 23 juin 2015 mulligan.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 675 23 juin 2015 shrinkin.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 671 23 juin 2015 balls_o_.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 648 23 juin 2015 cake_wal.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 647 23 juin 2015 citybloc.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 639 23 juin 2015 four_ple.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 636 23 juin 2015 trust_me.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 625 23 juin 2015 block_n_.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 622 23 juin 2015 mix_up.pak </pre></blockquote><br>  Le plus gros fichier ne prend que 680 octets, et ce n'est pas beaucoup.  Et quelle sera la plus petite? <br><br>  L'option <code>-r</code> indique √† <code>ls</code> d'inverser l'ordre. <br><br><blockquote><pre>  Niveaux $ ls -lSr |  t√™te
 592 au total
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 206 23 juin 2015 kablam.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 214 23 juin 2015 fortune_.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 219 23 juin 2015 digdirt.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 226 23 juin 2015 le√ßon_2.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 229 23 juin 2015 le√ßon_8.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 237 23 juin 2015 partial_.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 239 23 juin 2015 knot.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 247 23 juin 2015 cellbloc.pak
 -rw-r - r-- 1 bo√Æte √† pain bo√Æte √† pain 248 23 juin 2015 torturec.pak </pre></blockquote><br>  Le plus petit fichier ne prend que 206 octets, ce qui est plus de trois fois plus petit que le plus grand.  Il s'agit d'une gamme assez large, compte tenu du fait que nous nous attendions √† peu pr√®s aux m√™mes tailles de niveau. <br><br>  Dans notre √©valuation initiale, nous avons suppos√© que la carte aurait besoin d'un octet par tuile, et seulement 1024 octets.  Si nous r√©duisons cette estimation de moiti√©, c'est-√†-dire que chaque tuile ne n√©cessitera que 4 bits (ou deux tuiles par octet), alors la carte occupera toujours 512 octets.  512 est plus petit que 680, mais toujours plus grand que la plupart des niveaux.  Et en tout cas - 4 bits ne fourniront que 16 valeurs diff√©rentes, et dans le jeu il y a beaucoup plus d'objets diff√©rents. <br><br>  Autrement dit, il est √©vident que les cartes ne sont pas stock√©es dans ces fichiers sous forme ouverte.  Ils utilisent soit un codage plus complexe, fournissant une description plus efficace, et / ou ils sont en quelque sorte compress√©s.  Par exemple, au niveau ¬´LE√áON 1¬ª, nous pouvons voir comment les entr√©es manquantes pour les tuiles ¬´vides¬ª r√©duiront consid√©rablement la taille globale des donn√©es cartographiques. <br><br>  Nous pouvons regarder les cartes des plus gros fichiers: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9c/175/2b5/b9c1752b51bd23f6dda6893236e0de52.png"></div><br>  <i>Carte du niveau 57: STRANGE MAZE</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/193/6ec/806/1936ec8062fe1d211522161d7322c213.png"></div><br>  <i>Carte Niveau 98: R√âTRACTATION</i> <br><br>  puis comparez-les avec les cartes des plus petits fichiers: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/522/4ef/687/5224ef6870b3120bb4cdc7bf0fde9322.png"></div><br>  <i>Carte Niveau 106: KABLAM</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/812/ac5/5c0/812ac55c04b62d73430a182064af2d90.png"></div><br>  <i>Carte Niveau 112: FORTUNE FAVORISE LE</i> <br><br>  Cette comparaison soutient notre id√©e que les petits fichiers de donn√©es correspondent √† des niveaux plus simples ou contiennent plus de redondance.  Par exemple, si les donn√©es sont compress√©es par une sorte de codage de longueur d'ex√©cution, cela peut facilement expliquer les intervalles de taille des diff√©rents fichiers. <br><br>  Si les fichiers sont r√©ellement crypt√©s, nous devrons tr√®s probablement d√©crypter la compression avant de d√©crypter les donn√©es de la carte. <br><br><h3>  Nous √©tudions plusieurs fichiers en m√™me temps </h3><br>  Notre br√®ve √©tude du premier fichier de donn√©es nous a permis de faire quelques hypoth√®ses, mais n'a rien trouv√© de concret.  Dans une prochaine √©tape, nous commencerons √† explorer les mod√®les de plusieurs fichiers de donn√©es.  Pour l'instant, nous supposons que tous les 148 fichiers utilisent le m√™me sch√©ma de classement pour coder les donn√©es, donc la recherche de mod√®les en double dans ces fichiers nous aidera √† d√©marrer. <br><br>  Commen√ßons par le tout d√©but des tuiles.  Le haut du fichier est probablement utilis√© pour stocker des ¬´m√©tadonn√©es¬ª qui nous renseignent sur le contenu du fichier.  En ne regardant que la premi√®re ligne du vidage hexad√©cimal, nous pouvons effectuer une comparaison simple et rapide des 16 premiers octets et y rechercher des mod√®les importants: <br><br><blockquote><pre>  $ pour f dans les niveaux / *;  faire xxd $ f |  sed -n 1p;  fait |  moins
 00000000: 2300 dc01 0300 0004 0101 0a03 030b 2323 # ............. ##
 00000000: 2d00 bf01 0300 0015 0101 2203 0329 2222 -... "..)"
 00000000: 2b00 a101 0301 0105 0000 0601 0207 0505 + ...............
 00000000: 1d00 d300 0200 0003 0101 0402 0205 0102 ................
 00000000: 2d00 7a01 0300 0006 1414 0701 0109 0303 -.z .............
 00000000: 3100 0802 0200 0003 0101 0502 0206 1313 1 ...............
 00000000: 1a00 b700 0200 0003 0100 0502 0206 0101 ................
 00000000: 1a00 0601 0300 0005 0001 0601 0107 0303 ................
 00000000: 2000 7a01 0200 0003 0202 0401 0105 0028 .z ............ (
 00000000: 3a00 a400 0200 0003 2828 0428 0205 0303: ....... ((. (....
 00000000: 2600 da00 0300 0004 0507 0901 010a 0303 &amp; ...............
 00000000: 2400 f000 0300 0004 0303 0504 0407 0101 $ ...............
 00000000: 2a00 ef01 0300 0005 0101 0614 0007 0303 * ...............
 00000000: 2c00 8c01 0300 0004 0303 0500 0107 0101, ...............
 00000000: 2a00 0001 0300 0004 0303 0501 0107 0404 * ...............
 00000000: 1b00 6d01 0200 0003 0101 0502 0206 0003 ..m .............
 00000000: 1e00 1701 0200 0003 0202 0401 0105 0013 ................
 00000000: 3200 ee01 0f00 0015 0101 270f 0f29 1414 2 ......... '..) ..
 00000000: 2a00 5b01 0300 0005 0303 0601 0107 1414 *. [.............
 00000000: 2c00 8a01 0200 0003 0202 0401 0105 0303, ...............
 00000000: 1d00 9c00 0216 1604 0000 0516 0107 0205 ................
 00000000: 2000 e100 0200 0003 0101 0402 0205 0303 ...............
 00000000: 2000 2601 0300 0004 0303 0502 0207 0101. &amp; .............
 00000000: 1f00 f600 0132 0403 0000 0532 3206 0404 ..... 2 ..... 22 ...
 lignes 1-24 / 148 (plus) </pre></blockquote><br>  En regardant ce vidage, vous pouvez voir que dans chaque colonne il y a des valeurs similaires. <br><br>  En commen√ßant par le premier octet, nous nous rendons vite compte que sa valeur est dans une plage de valeurs tr√®s limit√©e, dans la plage hexad√©cimale de <code>40</code> (ou environ <code>20‚Äì60</code> √† <code>20‚Äì60</code> en d√©cimal).  Il s'agit d'une fonctionnalit√© assez sp√©cifique. <br><br>  Encore plus int√©ressant, le deuxi√®me octet de chaque fichier est toujours nul, sans exception.  Le deuxi√®me octet n'est probablement pas utilis√© ou est un espace r√©serv√©.  Cependant, il existe une autre possibilit√© - ces deux premiers octets repr√©sentent ensemble une valeur de 16 bits stock√©e dans un ordre petit-boutien. <br><br><blockquote>  <strong>Qu'est-ce que le petit-endian?</strong>  Lors du stockage d'une valeur num√©rique sup√©rieure √† un octet, vous devez d'abord s√©lectionner l'ordre dans lequel les octets seront stock√©s.  Si vous stockez d'abord un octet repr√©sentant la plus petite partie du nombre, cela s'appelle ordre direct ( <em>little-endian</em> );  si vous stockez d'abord des octets indiquant la majeure partie du nombre, alors c'est l'ordre inverse ( <em>big-endian</em> ).  Par exemple, nous √©crivons les valeurs d√©cimales dans l'ordre inverse (big-endian): la ligne ¬´42¬ª signifie ¬´quarante-deux¬ª, pas ¬´quatre et vingt¬ª.  Le petit-endian est un ordre naturel pour de nombreuses familles de microprocesseurs, il est donc g√©n√©ralement plus populaire, √† l'exception des protocoles r√©seau, qui n√©cessitent g√©n√©ralement le big-endian. </blockquote><br>  Si nous continuons l'analyse, nous verrons bient√¥t que le troisi√®me octet du fichier n'est pas similaire aux deux pr√©c√©dents: sa valeur varie sur une large plage.  Cependant, le quatri√®me octet est toujours <code>00</code> , <code>01</code> ou <code>02</code> , et <code>01</code> est le plus courant.  Cela nous indique √©galement que ces deux octets constituent une autre valeur de 16 bits, qui se situe approximativement dans la plage de valeurs d√©cimales 0-700.  Cette hypoth√®se peut √©galement √™tre confirm√©e par le fait que la valeur du troisi√®me octet est g√©n√©ralement faible si la valeur du quatri√®me octet est <code>02</code> , et g√©n√©ralement grande si le quatri√®me octet est <code>00</code> . <br><br>  Soit dit en passant, il convient de noter que c'est en partie la raison pour laquelle le format de vidage hexad√©cimal affiche les octets par paires par d√©faut - cela facilite la lecture d'une s√©quence de nombres entiers de 16 bits.  Le format de vidage hexad√©cimal a √©t√© normalis√© lorsque des ordinateurs 16 bits √©taient utilis√©s.  Essayez de remplacer <code>xxd</code> par <code>xxd -g1</code> pour d√©sactiver compl√®tement le regroupement, et vous remarquerez que la reconnaissance des paires d'octets au milieu d'une ligne repr√©sente beaucoup de travail.  Ceci est un exemple simple de la fa√ßon dont les outils utilis√©s pour √©tudier les donn√©es inconnues ont tendance √† nous faire remarquer certains types de mod√®les.  Il est bon que <code>xxd</code> souligne ce mod√®le par d√©faut car il est tr√®s courant (m√™me aujourd'hui, lorsque des ordinateurs 64 bits sont utilis√©s partout).  Mais il est utile de savoir comment modifier ces param√®tres s‚Äôils n‚Äôaident pas. <br><br>  Continuons l'exploration visuelle et voyons si ce mod√®le est pr√©serv√© des valeurs enti√®res 16 bits.  Le cinqui√®me octet a g√©n√©ralement des valeurs tr√®s faibles: <code>02</code> et <code>03</code> sont le plus souvent rencontr√©s, et la valeur maximale semble √™tre <code>05</code> .  Le sixi√®me octet d'un fichier est tr√®s souvent nul - mais il contient parfois des valeurs beaucoup plus grandes, telles que <code>32</code> ou <code>2C</code> .  Dans cette paire, notre hypoth√®se sur les valeurs distribu√©es dans l'intervalle n'est pas particuli√®rement confirm√©e. <br><br><h3>  Nous √©tudions soigneusement les valeurs initiales </h3><br>  Nous pouvons tester notre supposition en utilisant <code>od</code> pour g√©n√©rer un vidage hexad√©cimal.  L'utilitaire <code>od</code> est similaire √† <code>xxd</code> , mais offre une s√©lection beaucoup plus large de formats de sortie.  Nous pouvons l'utiliser pour vider la sortie sous forme d'entiers d√©cimaux 16 bits: <br><br>  L'option <code>-t</code> de l'utilitaire <code>od</code> sp√©cifie le format de sortie.  Dans ce cas, <code>u</code> repr√©sente les nombres d√©cimaux non sign√©s et <code>2</code> repr√©sente deux octets par enregistrement.  (Vous pouvez √©galement sp√©cifier ce format √† l'aide de l'option <code>-d</code> .) <br><br><blockquote><pre>  $ pour f dans les niveaux / *;  faire od -tu2 $ f |  sed -n 1p;  fait |  moins
 0000000 35 476 3 1024 257 778 2819 8995
 0000000 45 447 3 5376 257 802 10499 8738
 0000000 43 417 259 1281 0 262 1794 1285
 0000000 29 211 2 768 257 516 1282 513
 0000000 45 378 3 1536 5140 263 2305 771
 0000000 49 520 2 768 257 517 1538 4883
 0000000 26 183 2 768 1 517 1538 257
 0000000 26 262 3 1280 256 262 1793 771
 0000000 32 378 2 768 514 260 1281 10240
 0000000 58 164 2 768 10280 10244 1282 771
 0000000 38 218 3 1024 1797 265 2561 771
 0000000 36 240 3 1024 771 1029 1796 257
 0000000 42 495 3 1280 257 5126 1792 771
 0000000 44 396 3 1024 771 5 1793 257
 0000000 42 256 3 1024 771 261 1793 1028
 0000000 27 365 2 768 257 517 1538 768
 0000000 30 279 2 768 514 260 1281 4864
 0000000 50 494 15 5376 257 3879 10511 5140
 0000000 42 347 3 1280 771 262 1793 5140
 0000000 44 394 2 768 514 260 1281 771
 0000000 29156 5634 1046 0 5637 1793 1282
 0000000 32 225 2 768 257 516 1282 771
 0000000 32 294 3 1024 771 517 1794 257
 0000000 31 246 12801 772 0 12805 1586 1028
 lignes 1-24 / 148 (plus) </pre></blockquote><br>  Cette sortie montre que nos suppositions sur les premiers octets √©taient correctes.  Nous voyons que la premi√®re valeur de 16 bits est dans la plage d√©cimale de 20 √† 70, et la deuxi√®me valeur de 16 bits est dans la plage d√©cimale de 100 √† 600.  Cependant, les valeurs suivantes ne se comportent pas si bien.  Certains motifs y apparaissent (par exemple, en quatri√®me position, √©tonnamment souvent 1024), mais ils n'ont pas la r√©p√©tabilit√© inh√©rente aux premi√®res valeurs du fichier. <br><br>  Par cons√©quent, supposons d'abord que les quatre premiers octets du fichier sont sp√©ciaux et se composent de deux valeurs 16 bits.  Puisqu'elles se trouvent au tout d√©but du fichier, il s'agit probablement de m√©tadonn√©es et elles aident √† d√©terminer comment lire le reste du fichier. <br><br>  En fait, le deuxi√®me intervalle de valeurs (100‚Äì600) est assez proche de l'intervalle de taille de fichier que nous avons remarqu√© plus t√¥t (208‚Äì680).  Ce n'est peut-√™tre pas une co√Øncidence?  Prenons une hypoth√®se: la valeur 16 bits stock√©e dans les troisi√®me et quatri√®me octets du fichier est en corr√©lation avec la taille totale du fichier.  Maintenant que nous avons une hypoth√®se, nous pouvons la tester.  Voyons si les gros fichiers √† cet endroit ont vraiment de grandes valeurs √† tout moment, et les petits ont de petites valeurs. <br><br>  Pour afficher la taille du fichier en octets sans aucune autre information, vous pouvez utiliser <code>wc</code> avec l'option <code>-c</code> .  De m√™me, vous pouvez ajouter des options √† <code>od</code> qui vous permettent d'afficher uniquement les valeurs qui nous int√©ressent.  Ensuite, nous pouvons utiliser la substitution de commandes pour √©crire ces valeurs dans des variables de shell et les afficher ensemble: <br><br>  L'option <code>-An</code> de l'utilitaire <code>od</code> d√©sactive la colonne la plus √† gauche, qui affiche le d√©calage dans le fichier, et <code>-N4</code> indique √† <code>od</code> s'arr√™ter apr√®s les 4 premiers octets du fichier. <br><br><blockquote><pre>  $ pour f dans les niveaux / *;  faire taille = $ (wc -c &lt;$ f);  donn√©es = $ (od -tuS -An -N4 $ f);  echo "$ size: $ data";  fait |  moins
 585: 35 476
 586: 45 447
 550: 43,417
 302: 29,211
 517: 45 378
 671: 49 520
 265: 26 183
 344: 26,262
 478: 32 378
 342: 58 164
 336: 38 218
 352: 36 240
 625: 42 495
 532: 44,396
 386: 42 256
 450: 27 365
 373: 30 279
 648: 50 494
 477: 42 347
 530: 44,394
 247: 29 156
 325: 32,225
 394: 32,294
 343: 31 246 </pre></blockquote><br>  En regardant cette sortie, vous pouvez voir que les valeurs sont approximativement corr√©l√©es.  Les fichiers plus petits ont g√©n√©ralement des valeurs inf√©rieures en deuxi√®me position, et les fichiers volumineux ont des valeurs plus grandes.  Cependant, la corr√©lation n'est pas pr√©cise et il convient de noter que la taille du fichier est toujours nettement sup√©rieure √† la valeur qui y est stock√©e. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En outre, la premi√®re valeur 16 bits est g√©n√©ralement plus grande avec des fichiers de grande taille, mais la correspondance n'est pas non plus compl√®te, et vous pouvez facilement trouver des exemples de fichiers de taille moyenne avec des valeurs relativement grandes en premi√®re position. Mais peut-√™tre que si nous additionnons ces deux valeurs ensemble, leur somme sera mieux corr√©l√©e avec la taille du fichier? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous pouvons utiliser </font></font><code>read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour extraire deux nombres de la sortie </font></font><code>od</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans des variables distinctes, puis utiliser l'arithm√©tique du shell pour trouver leur somme: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande Shell</font></font><code>read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne peut pas √™tre utilis√© sur le c√¥t√© droit de la barre verticale, car les commandes transf√©r√©es au pipeline sont ex√©cut√©es dans un processeur de commandes enfant (sous-shell), qui, une fois quitt√©, prend ses variables d'environnement dans le r√©cepteur de bits. </font><font style="vertical-align: inherit;">Par cons√©quent, √† la place, nous devons utiliser la fonction de substitution de processus </font></font><code>bash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et diriger la sortie </font></font><code>od</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers un fichier temporaire, qui peut ensuite √™tre redirig√© vers la commande </font></font><code>read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ pour f dans les niveaux / *; </font><font style="vertical-align: inherit;">faire taille = $ (wc -c &lt;$ f); </font><font style="vertical-align: inherit;">lire v1 v2 &lt;&lt; (od -tuS -An -N4 $ f); </font><font style="vertical-align: inherit;">sum = $ (($ v1 + $ v2));</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    echo "$ taille: $ v1 + $ v2 = $ sum"; </font><font style="vertical-align: inherit;">fait | </font><font style="vertical-align: inherit;">moins</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
585: 35 + 476 = 511</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
586: 45 + 447 = 492</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
550: 43 + 417 = 460</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
302: 29 + 211 = 240</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
517: 45 + 378 = 423</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
671: 49 + 520 = 569</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
265: 26 + 183 = 209</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
344: 26 + 262 = 288</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
478: 32 + 378 = 410</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
342: 58 + 164 = 222</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
336: 38 + 218 = 256</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
352: 36 + 240 = 276</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
625: 42 + 495 = 537</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
532: 44 + 396 = 440</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
386: 42 + 256 = 298</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
450: 27 + 365 = 392</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
373: 30 + 279 = 309</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
648: 50 + 494 = 544</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
477: 42 + 347 = 389</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
530: 44 + 394 = 438</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
247: 29 + 156 = 185</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
325: 32 + 225 = 257</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
394: 32 + 294 = 326</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
343: 31 + 246 = 277</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lignes 1-24 / 148 (plus) </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La somme des deux nombres correspond √©galement approximativement √† la taille du fichier, mais ils ne correspondent toujours pas tout √† fait. </font><font style="vertical-align: inherit;">En quoi sont-ils diff√©rents? </font><font style="vertical-align: inherit;">Montrons leur diff√©rence:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ pour f dans les niveaux / *; </font><font style="vertical-align: inherit;">faire taille = $ (wc -c &lt;$ f); </font><font style="vertical-align: inherit;">lire v1 v2 &lt;&lt; (od -tuS -An -N4 $ f); </font><font style="vertical-align: inherit;">diff = $ (($ taille - $ v1 - $ v2));</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    echo "$ size = $ v1 + $ v2 + $ diff"; </font><font style="vertical-align: inherit;">fait | </font><font style="vertical-align: inherit;">moins</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
585 = 35 + 476 + 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
586 = 45 + 447 + 94</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
550 = 43 + 417 + 90</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
302 = 29 + 211 + 62</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
517 = 45 + 378 + 94</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
671 = 49 + 520 + 102</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
265 = 26 + 183 + 56</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
344 = 26 + 262 + 56</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
478 = 32 + 378 + 68</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
342 = 58 + 164 + 120</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
336 = 38 + 218 + 80</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
352 = 36 + 240 + 76</font></font><font></font>
625 = 42 + 495 + 88<font></font>
532 = 44 + 396 + 92<font></font>
386 = 42 + 256 + 88<font></font>
450 = 27 + 365 + 58<font></font>
373 = 30 + 279 + 64<font></font>
648 = 50 + 494 + 104<font></font>
477 = 42 + 347 + 88<font></font>
530 = 44 + 394 + 92<font></font>
247 = 29 + 156 + 62<font></font>
325 = 32 + 225 + 68<font></font>
394 = 32 + 294 + 68<font></font>
343 = 31 + 246 + 66<font></font>
lines 1-24/148 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diff√©rence, ou valeur ¬´r√©siduelle¬ª, est affich√©e √† l'extr√™me droite de la sortie. </font><font style="vertical-align: inherit;">Cette valeur ne tombe pas tout √† fait dans le sch√©ma constant, mais elle semble rester approximativement dans une plage limit√©e de 40 √† 120. </font><font style="vertical-align: inherit;">Et encore une fois, plus les fichiers sont volumineux, plus leur valeur r√©siduelle est g√©n√©ralement √©lev√©e. </font><font style="vertical-align: inherit;">Mais parfois, les petits fichiers ont √©galement de grandes valeurs r√©siduelles, ce n'est donc pas aussi constant que nous le souhaiterions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, il convient de noter que les valeurs des r√©sidus ne sont jamais n√©gatives. </font><font style="vertical-align: inherit;">Par cons√©quent, l'id√©e que ces deux valeurs de m√©tadonn√©es indiquent des sous-sections d'un fichier reste int√©ressante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Si vous √™tes assez prudent, vous avez d√©j√† vu quelque chose donnant un indice sur une connexion qui n'a pas encore √©t√© remarqu√©e. Si ce n'est pas le cas, continuez √† lire; le secret sera bient√¥t r√©v√©l√©.)</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comparaisons crois√©es de fichiers plus importantes </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä ce stade, ce serait bien de pouvoir comparer plus de 16 octets √† la fois. Pour cela, nous avons besoin d'un type de visualisation diff√©rent. L'une des bonnes approches consiste √† cr√©er une image dans laquelle chaque pixel d√©note un octet distinct de l'un des fichiers, et la couleur d√©note la valeur de cet octet. Une image peut afficher une tranche des 148 fichiers √† la fois si chaque fichier de donn√©es est indiqu√© par une seule rang√©e de pixels d'image. √âtant donn√© que tous les fichiers sont de tailles diff√©rentes, nous prenons les 200 premiers octets de chacun pour cr√©er une image rectangulaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le moyen le plus simple consiste √† cr√©er une image en niveaux de gris, dans laquelle la valeur de chaque octet correspond √† diff√©rents niveaux de gris. Il est tr√®s simple de cr√©er un fichier PGM avec nos donn√©es, car l'en-t√™te PGM se compose uniquement de texte ASCII:</font></font><br><br><blockquote><pre> $ echo P5 200 148 255 &gt;hdr.pgm </pre></blockquote><br><blockquote> <strong>   PGM?</strong> PGM,    ¬´portable graymap¬ª (¬´   ¬ª) ‚Äî       ,        :    ASCII,         .        ‚Äî  PBM (¬´portable bitmap¬ª, ¬´  ¬ª),     8   ,  PPM (¬´portable pixmap¬ª, ¬´  ¬ª),     3   . </blockquote><br> <code>P5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Correspond √† la signature initiale du format de fichier PGM. </font><font style="vertical-align: inherit;">Les deux nombres suivants </font></font><code>200</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>148</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sp√©cifiez la largeur et la hauteur de l'image, et le dernier </font></font><code>255</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,, indique la valeur maximale par pixel. </font><font style="vertical-align: inherit;">L'en-t√™te PGM se termine par une nouvelle ligne suivie de donn√©es de pixels. </font><font style="vertical-align: inherit;">(Il convient de noter que l'en-t√™te PGM est le plus souvent divis√© en trois lignes de texte distinctes, mais la norme PGM n√©cessite uniquement que les √©l√©ments soient s√©par√©s par un caract√®re d'espacement.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous pouvons utiliser l'utilitaire </font></font><code>head</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour extraire les 200 premiers octets de chaque fichier:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ pour f dans les niveaux / *; </font><font style="vertical-align: inherit;">faire t√™te -c200 $ f; </font><font style="vertical-align: inherit;">fait&gt; out.pgm</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, nous pouvons les concat√©ner avec un en-t√™te et cr√©er une image affich√©e: </font></font><br><br> <code>xview</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- il s'agit d'un ancien programme X pour afficher des images dans une fen√™tre. </font><font style="vertical-align: inherit;">Vous pouvez le remplacer par votre visionneuse d'images pr√©f√©r√©e, par exemple, un utilitaire </font></font><code>display</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'ImageMagick, mais gardez √† l'esprit qu'il existe √©tonnamment de nombreuses visionneuses d'images qui n'acceptent pas un fichier image redirig√© vers l'entr√©e standard.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ cat hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">xview / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/160/236/6cf/1602366cf98b4fd6fd448d5f3cf0b3a8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'il vous est difficile de prendre en compte les d√©tails d'une image sombre, vous pouvez choisir un sch√©ma de couleurs diff√©rent. </font><font style="vertical-align: inherit;">Utilisez l'utilitaire </font></font><code>pgmtoppm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'ImageMagick pour convertir les pixels en une gamme de couleurs diff√©rente. </font><font style="vertical-align: inherit;">Cette version va cr√©er une image ¬´n√©gative¬ª:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ cat hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">pgmtoppm blanc-noir | </font><font style="vertical-align: inherit;">xview / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/923/1ed/90a/9231ed90a4b0e0b0f94dfb67dc5f4e6d.png"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et cette version rend les faibles valeurs jaunes et les hautes valeurs bleues: </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ cat hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">pgmtoppm jaune-bleu | </font><font style="vertical-align: inherit;">xview / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/44f/61b/53e/44f61b53ecc026af2ad851f24d494c06.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La visibilit√© des couleurs est une question tr√®s subjective, vous pouvez donc exp√©rimenter et choisir celle qui vous convient le mieux. </font><font style="vertical-align: inherit;">Quoi qu'il en soit, l'image 200 √ó 148 est assez petite, il est donc pr√©f√©rable d'augmenter la visibilit√© en augmentant sa taille:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ cat hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">xview -zoom 300 / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/97a/ed3/b4d97aed3c0baf3086d16c62b146742f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'image est sombre, ce qui signifie que la plupart des octets contiennent de petites valeurs. Une bande visible de pixels principalement lumineux plus pr√®s du bord gauche contraste avec elle. Cette bande est situ√©e dans le troisi√®me octet du fichier qui, comme nous l'avons dit plus haut, varie dans toute la plage de valeurs. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et bien qu'il n'y ait pas beaucoup de valeurs √©lev√©es en dehors du troisi√®me octet, lorsqu'elles apparaissent, elles sont souvent constitu√©es de s√©ries, cr√©ant de courtes bandes lumineuses dans l'image. Certaines de ces s√©ries sont interrompues p√©riodiquement, cr√©ant un effet de ligne pointill√©e. (Peut-√™tre qu'avec la bonne s√©lection de couleurs, il sera possible de remarquer de telles s√©quences dans des couleurs plus sombres.)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une √©tude attentive de l'image permet de comprendre que la bande gauche domine principalement dans la partie gauche. Ces bandes nous parlent d'une certaine r√©p√©tabilit√© dans la plupart des fichiers. Mais pas dans tous les fichiers - de temps en temps, il y a des lignes de pixels o√π les bandes sont interrompues - mais c'est plus que suffisant pour d√©terminer la pr√©sence d'un motif r√©el. Ce motif dispara√Æt sur le c√¥t√© droit de l'image, le fond sombre des rayures laisse place √† quelque chose de plus bruyant et ind√©fini. (Il semble que les rayures manquent √©galement dans la partie tout √† gauche de l'image, mais, je le r√©p√®te, il est possible que lorsque vous utilisez un jeu de couleurs diff√©rent, vous pouvez voir qu'elles commencent plus pr√®s du bord gauche qu'il n'y para√Æt ici.)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les rayures sont constitu√©es de fines lignes de pixels l√©g√®rement plus lumineux sur un fond de pixels l√©g√®rement plus sombres. Par cons√©quent, ce mod√®le graphique doit √™tre en corr√©lation avec le mod√®le des fichiers de donn√©es dans lesquels des valeurs l√©g√®rement plus grandes sont √©galement r√©parties entre des valeurs d'octets l√©g√®rement plus petites. Il semble que les rayures soient √©puis√©es approximativement au milieu de l'image. Puisqu'il affiche les 200 premiers octets de fichiers, vous devez vous attendre √† ce que le mod√®le d'octets se termine apr√®s environ 100 octets. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fait que ces mod√®les changent dans diff√©rents fichiers de donn√©es devrait nous conduire √† la question: √† quoi ressembleront les fichiers apr√®s les 200 premiers octets. Eh bien, nous pouvons facilement remplacer l'utilitaire par un </font></font><code>head</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilitaire </font></font><code>tail</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et voir √† quoi ressemblent les 200 derniers octets:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ pour f dans les niveaux / *; </font><font style="vertical-align: inherit;">do tail -c200 $ f; </font><font style="vertical-align: inherit;">done&gt; out.pgm; </font><font style="vertical-align: inherit;">cat hdr.pgm out.pgm | </font><font style="vertical-align: inherit;">xview -zoom 300 / dev / stdin</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b7/e21/262/5b7e2126215bf4e9953890622b4e2767.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On voit imm√©diatement que ce domaine des fichiers de donn√©es est tr√®s diff√©rent. </font><font style="vertical-align: inherit;">Ici, les octets sont beaucoup plus courants, surtout vers la fin du fichier. </font><font style="vertical-align: inherit;">(Cependant, comme auparavant, ils pr√©f√®rent se regrouper en couvrant l'image avec des bandes horizontales lumineuses.) Il semble que la fr√©quence des valeurs d'octets √©lev√©es augmente presque jusqu'√† la fin, o√π elle se casse brusquement et est remplac√©e par des valeurs faibles dans les dix √† douze derniers octets environ. </font><font style="vertical-align: inherit;">Et le mod√®le ici n'est pas non plus universel, mais il est trop standard pour √™tre une co√Øncidence.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peut-√™tre au milieu des dossiers, il peut y avoir d'autres domaines que nous n'avons pas encore pris en consid√©ration. </font><font style="vertical-align: inherit;">La prochaine chose que nous voulons faire est d'examiner les fichiers entiers de cette fa√ßon. </font><font style="vertical-align: inherit;">Mais comme tous les fichiers ont des tailles diff√©rentes, ils ne peuvent pas √™tre plac√©s dans un magnifique tableau rectangulaire de pixels. </font><font style="vertical-align: inherit;">Nous pouvons remplir la fin de chaque ligne avec des pixels noirs, mais il serait pr√©f√©rable de les redimensionner afin que toutes les lignes aient la m√™me largeur et que les zones proportionnelles des diff√©rents fichiers correspondent plus ou moins. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et nous pouvons r√©ellement le faire avec un peu plus d'efforts. </font><font style="vertical-align: inherit;">Vous pouvez utiliser Python et sa biblioth√®que pour travailler avec des images </font></font><code>PIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(¬´Pillow¬ª): </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fichier showbytes.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image <span class="hljs-comment"><span class="hljs-comment"># Retrieve the full list of data files. filenames = sys.argv[1:] # Create a grayscale image, its height equal to the number of data files. width = 750 height = len(filenames) image = Image.new('L', (width, height)) # Fill in the image, one row at a time. for y in range(height): # Retrieve the contents of one data file. data = open(filenames[y]).read() linewidth = len(data) # Turn the data into a pixel-high image, each byte becoming one pixel. line = Image.new(image.mode, (linewidth, 1)) linepixels = line.load() for x in range(linewidth): linepixels[x,0] = ord(data[x]) # Stretch the line out to fit the final image, and paste it into place. line = line.resize((width, 1)) image.paste(line, (0, y)) # Magnify the final image and display it. image = image.resize((width, 3 * height)) image.show()</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lorsque nous appelons ce script, en utilisant la liste compl√®te des fichiers de donn√©es comme arguments, il cr√©e une image compl√®te et l'affiche dans une fen√™tre distincte: </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ python showbytes.py niveaux / * </font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/844/f82/c04/844f82c04bc2b27a36a62ffe2511f8fc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malheureusement, bien que cette image soit compl√®te, elle ne nous montre rien de nouveau. </font><font style="vertical-align: inherit;">(Mais en r√©alit√©, cela montre encore moins, car le redimensionnement a d√©truit le motif des rayures.) Probablement, pour √©tudier l'ensemble des donn√©es, nous avons besoin d'un meilleur processus de visualisation.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Caract√©risez les donn√©es </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cet esprit, arr√™tons-nous un instant et terminons un recensement complet des donn√©es. </font><font style="vertical-align: inherit;">Nous devons savoir si les fichiers de donn√©es donnent la pr√©f√©rence √† certaines valeurs d'octets. </font><font style="vertical-align: inherit;">Par exemple, si chaque valeur est g√©n√©ralement √©galement dupliqu√©e, cela constituera une preuve solide que les fichiers sont r√©ellement compress√©s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©√©crire </font><font style="vertical-align: inherit;">compl√®tement les valeurs, quelques lignes en Python suffisent: </font><font style="vertical-align: inherit;">Le fichier Census.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys data = sys.stdin.read() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">256</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> c, data.count(chr(c))</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Apr√®s avoir pouss√© toutes les donn√©es dans une variable, nous pouvons calculer la fr√©quence d'occurrence de chaque valeur d'octet. </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ niveaux de chat / * | </font><font style="vertical-align: inherit;">python ./census.py | </font><font style="vertical-align: inherit;">moins</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0 2458</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 2525</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 1626</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 1768</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 1042</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5 1491</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6 1081</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 1445</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8 958</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
9 1541</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10 1279</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
11 1224</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12 845</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
13 908</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
14 859</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
15 1022</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
16 679</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
17 1087</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
18 881</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
19 1116</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
20 1007</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
21 1189</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22 1029</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
23 733</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lignes 1-24 / 256 (plus) </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous voyons que le plus souvent, il y a des valeurs d'octets 0 et 1, les fr√©quences suivantes sont 2 et 3, apr√®s quoi le nombre continue de diminuer (bien qu'avec moins de constance). </font><font style="vertical-align: inherit;">Afin de mieux visualiser ces donn√©es, nous pouvons transf√©rer la sortie vers </font></font><code>gnuplot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et transformer ce recensement en un histogramme: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'option </font></font><code>-p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilitaire </font></font><code>gnuplot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ordonne de ne pas fermer la fen√™tre avec le graphique apr√®s la fin des travaux </font></font><code>gnuplot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ niveaux de chat / * | </font><font style="vertical-align: inherit;">python ./census.py | </font><font style="vertical-align: inherit;">gnuplot -p -e 'plot "-" with boxes'</font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/040/76b/783/04076b783d61f8b6f976333a67a95a25.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est tr√®s visible que les premi√®res valeurs d'octets sont beaucoup plus courantes que toutes les autres. </font><font style="vertical-align: inherit;">Plusieurs des valeurs suivantes sont √©galement assez courantes, puis les fr√©quences de valeurs d'environ 50 commencent √† diminuer le long d'une courbe de probabilit√© lisse. </font><font style="vertical-align: inherit;">Cependant, il existe un sous-ensemble de valeurs √©lev√©es qui sont r√©guli√®rement s√©par√©es les unes des autres, dont la fr√©quence semble plut√¥t stable. </font><font style="vertical-align: inherit;">En regardant la sortie d'origine, nous pouvons nous assurer que ce sous-ensemble se compose de valeurs qui peuvent √™tre divisibles par huit.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ces diff√©rences dans le nombre de valeurs sugg√®rent qu'il existe plusieurs ¬´classes¬ª diff√©rentes de valeurs d'octets, il sera donc logique de voir comment ces classes sont distribu√©es. Le premier groupe de valeurs d'octets sera les valeurs les plus basses: 0, 1, 2 et 3. Ensuite, le deuxi√®me groupe peut √™tre des valeurs de 4 √† 64. Et le troisi√®me groupe sera des valeurs sup√©rieures √† 64, qui sont divisibles par 8. Tout le reste, y compris non divisible par 8 valeurs sup√©rieures √† 64 sera le quatri√®me et dernier groupe.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avec tout cela √† l'esprit, nous pouvons changer le dernier script de g√©n√©ration d'image √©crit. </font><font style="vertical-align: inherit;">Au lieu d'afficher les valeurs r√©elles de chaque octet dans une couleur distincte, montrons simplement √† quel groupe appartient chaque octet. </font><font style="vertical-align: inherit;">Vous pouvez attribuer une couleur unique √† chacun des quatre groupes, ce qui nous aidera √† voir si certaines valeurs apparaissent r√©ellement √† certains endroits. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fichier Showbytes2.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image <span class="hljs-comment"><span class="hljs-comment"># Retrieve the full list of data files. filenames = sys.argv[1:] # Create a color image, its height equal to the number of data files. width = 750 height = len(filenames) image = Image.new('RGB', (width, height)) # Fill in the image, one row at a time. for y in range(height): # Retrieve the contents of one data file. data = open(filenames[y]).read() linewidth = len(data) # Turn the data into a pixel-high image, each byte becoming one pixel. line = Image.new(image.mode, (linewidth, 1)) linepixels = line.load() # Determine which group each byte belongs to and assign it a color. for x in range(linewidth): byte = ord(data[x]) if byte &lt; 0x04: linepixels[x,0] = (255, 0, 0) elif byte &lt; 0x40: linepixels[x,0] = (0, 255, 0) elif byte % 8 == 0: linepixels[x,0] = (0, 0, 255) else: linepixels[x,0] = (255, 255, 255) # Paste the line of pixels into the final image, stretching to fit. line = line.resize((width, 1)) image.paste(line, (0, y)) # Magnify the final image and display it. image = image.resize((width, 3 * height)) image.show()</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons attribu√© quatre groupes rouge, vert, bleu et blanc. </font><font style="vertical-align: inherit;">(Encore une fois, vous pouvez essayer de choisir d'autres couleurs selon vos pr√©f√©rences.)</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ python showbytes2.py niveaux / * </font></font></pre></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/322/77f/f31/32277ff31e600de756627d442671ba9e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gr√¢ce √† cette image, nous pouvons pr√©-confirmer l'exactitude de la s√©paration des fichiers de donn√©es en cinq parties: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'en-t√™te de quatre octets que nous avons trouv√© plus t√¥t. </font></font></li><li>  ,     ,       (..   ). </li><li>  ,           (.   64). </li><li>    ,      . </li><li>   ,      . </li></ol><br>    ,    ,     ,        ,     ,   8. <br><br>     ,   ,     ,      .   ,       ,    ,   ,    . <br><br>   ,                    ( ,  ).      ,    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien entendu, cette division du dossier en cinq parties est tr√®s arbitraire. </font><font style="vertical-align: inherit;">Une quatri√®me partie avec des valeurs d'octets √©lev√©es divisibles par huit peut s'av√©rer √™tre juste la fin de la troisi√®me partie. </font><font style="vertical-align: inherit;">Ou il peut s'av√©rer qu'il est pr√©f√©rable de diviser une grande troisi√®me partie en plusieurs parties que nous n'avons pas encore d√©termin√©es. </font><font style="vertical-align: inherit;">A ce stade, la d√©couverte de pi√®ces nous aide davantage √† trouver des lieux de recherches compl√©mentaires. </font><font style="vertical-align: inherit;">Pour l'instant, il nous suffit de savoir qu'il existe des parties dans lesquelles la composition g√©n√©rale des valeurs d'octets change, et une id√©e approximative de leur taille nous aidera √† poursuivre nos recherches.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recherche de structure </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que devons-nous chercher ensuite? Eh bien, comme auparavant, la fa√ßon la plus simple de commencer est √† partir du haut du fichier. Ou plut√¥t pr√®s du sommet. √âtant donn√© que nous avons d√©j√† identifi√© avec confiance la premi√®re partie comme un en-t√™te de quatre octets, examinons de plus pr√®s ce qui vient ensuite - la zone que nous appelons la deuxi√®me partie, ou une partie des bandes. Ces bandes sont le signe le plus fort de l'existence de la structure, il est donc pr√©f√©rable de chercher de nouvelles preuves de la pr√©sence du motif ici. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Pour le moment, nous supposons que le mod√®le de bande commence imm√©diatement apr√®s les quatre premiers octets. Visuellement, ce n'est pas √©vident, mais cela semble probable, et l'examen des valeurs d'octets devrait rapidement nous montrer la v√©rit√©.)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revenons au vidage hexad√©cimal, cette fois en nous concentrant sur la deuxi√®me partie. </font><font style="vertical-align: inherit;">N'oubliez pas que nous nous attendons √† trouver un motif r√©p√©titif de valeurs l√©g√®rement plus √©lev√©es uniform√©ment r√©parties entre des valeurs l√©g√®rement inf√©rieures. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'option </font></font><code>-s4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ordonne de </font></font><code>xxd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sauter les 4 premiers octets du fichier.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ pour f dans les niveaux / *; </font><font style="vertical-align: inherit;">faire xxd -s4 $ f | </font><font style="vertical-align: inherit;">sed -n 1p; </font><font style="vertical-align: inherit;">fait | </font><font style="vertical-align: inherit;">moins</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0200 0003 0202 0401 0105 0303 0700 0108 ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0201 0104 0000 0504 0407 0202 0902 010a ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0300 0004 0303 0504 0407 0505 0801 0109 ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0300 0009 0202 1203 0313 0909 1401 0115 ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0203 0305 0000 0602 0207 0505 0901 010a ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0203 0304 0000 0502 0206 0404 0901 010a ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 0300 0005 022a 0602 2907 0303 0902 000a ..... * ..) .......</font></font><font></font>
00000004: 0203 0305 0000 0605 0507 0101 0802 0209 ................<font></font>
00000004: 0300 0007 0303 0901 010a 0707 0b09 090c ................<font></font>
00000004: 0300 0004 0101 0903 030e 0404 1609 0920 ...............<font></font>
00000004: 0200 0003 1313 0402 0205 0013 0701 0109 ................<font></font>
00000004: 0500 0006 0505 0701 0109 0606 0e07 070f ................<font></font>
00000004: 0100 0003 0101 0a03 030b 0a0a 0e32 3216 .............22.<font></font>
00000004: 0300 0004 0705 0903 030a 0606 0b08 080c ................<font></font>
00000004: 0200 0003 0701 0402 0209 0501 0a08 080b ................<font></font>
00000004: 0200 0003 0202 0901 010a 0303 0b05 010d ................<font></font>
00000004: 0200 0003 0202 0403 0305 0101 0904 040a ................<font></font>
00000004: 0300 0007 0303 0f01 0115 0707 2114 1422 ............!.."<font></font>
00000004: 0200 0003 0202 0403 0309 0101 0a04 040b ................<font></font>
00000004: 0231 3103 0202 0500 0006 0303 0701 0109 .11.............<font></font>
00000004: 0200 0003 0202 0b32 320c 0303 0e08 0811 .......22.......<font></font>
00000004: 0201 0103 0000 0902 020a 0303 0b09 090c ................<font></font>
00000004: 0200 0003 0202 0a01 010b 0303 0d0b 0b0f ................<font></font>
00000004: 0300 0005 0303 0701 0109 0001 0b05 051b ................<font></font>
lines 27-50/148 (more) </pre></blockquote><br>       ,    ,   , ,     ,    .   ,    ,     ,     ,    . (        ,         .) <br><br>     ,        ,         . <br><br>     ,       : <br><br>  <code>-g3</code>       .  <code>-c18</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©finit 18 octets (un multiple de 3) par ligne au lieu de 16. </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ pour f dans les niveaux / *; </font><font style="vertical-align: inherit;">faire xxd -s4 -g3 -c18 $ f | </font><font style="vertical-align: inherit;">sed -n 1p; </font><font style="vertical-align: inherit;">fait | </font><font style="vertical-align: inherit;">moins</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 050000 060505 070101 090606 0e0707 0f0001 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 010000 030101 0a0303 0b0a0a 0e3232 161414 ............. 22 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 030000 040705 090303 0a0606 0b0808 0c0101 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030701 040202 090501 0a0808 0b0101 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030202 090101 0a0303 0b0501 0d0302 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030202 040303 050101 090404 0a0302 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 030000 070303 0f0101 150707 211414 221313 ............! .. "..</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030202 040303 090101 0a0404 0b0001 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 023131 030202 050000 060303 070101 090505 .11 ...............</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 030202 0b3232 0c0303 0e0808 110b0b ....... 22 .........</font></font><font></font>
00000004: 020101 030000 090202 0a0303 0b0909 0c0a0a ..................<font></font>
00000004: 020000 030202 0a0101 0b0303 0d0b0b 0f2323 ................##<font></font>
00000004: 030000 050303 070101 090001 0b0505 1b0707 ..................<font></font>
00000004: 022323 030000 040202 050303 030101 070505 .##...............<font></font>
00000004: 031414 050000 060303 070505 080101 090707 ..................<font></font>
00000004: 030000 050202 060303 070505 080101 090606 ..................<font></font>
00000004: 030202 040000 050303 070404 080005 090101 ..................<font></font>
00000004: 030202 040000 050303 090404 1d0101 1f0909 ..................<font></font>
00000004: 020000 050303 060101 070202 0f0300 110505 ..................<font></font>
00000004: 050000 070101 0c0505 0d0007 110c0c 120707 ..................<font></font>
00000004: 030202 050000 060303 070505 080101 090606 ..................<font></font>
00000004: 020000 030101 050202 060505 070100 080303 ..................<font></font>
00000004: 020000 030202 050303 090101 0a0505 0b0302 ..................<font></font>
00000004: 022c2c 030000 040202 020303 050101 060202 .,,...............<font></font>
lines 38-61/148 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans un vidage format√© de cette mani√®re, d'autres fonctionnalit√©s de ce mod√®le commencent √† appara√Ætre. Comme pr√©c√©demment, le premier octet de chaque triplet est g√©n√©ralement plus grand que les octets qui l'entourent. Vous pouvez √©galement remarquer que les deuxi√®me et troisi√®me octets de chaque triplet sont souvent dupliqu√©s. En descendant la premi√®re colonne, nous verrons que la plupart des valeurs des deuxi√®me et troisi√®me octets sont √©gales </font></font><code>0000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mais les valeurs non nulles sont √©galement souvent trouv√©es par paires, par exemple, </font></font><code>0101</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>2323</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ce sch√©ma est √©galement imparfait, mais il a trop en commun pour √™tre une co√Øncidence. Et en regardant la colonne ASCII √† droite, nous verrons que lorsque nous avons des valeurs d'octets qui correspondent au caract√®re ASCII imprimable, elles sont souvent trouv√©es par paires.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre motif √† noter qui n'est pas imm√©diatement perceptible: le premier octet de chaque triple augmente de gauche √† droite. Bien que ce mod√®le soit moins perceptible, sa stabilit√© est √©lev√©e; nous devons examiner beaucoup de lignes avant de trouver le premier d√©calage. Et les octets augmentent g√©n√©ralement de petites valeurs, mais ils ne repr√©sentent aucun mod√®le r√©gulier. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En √©tudiant l'image d'origine, nous avons remarqu√© que la partie avec les rayures se termine dans chaque fichier pas au m√™me endroit. Il y a une transition entre la cr√©ation d'une bande de motifs √† gauche et un bruit al√©atoire √† droite, mais cette transition se produit pour chaque ligne de pixels √† diff√©rents points. Cela implique qu'il doit y avoir un marqueur pour que le programme qui lit le fichier de donn√©es puisse comprendre o√π se termine le tableau et o√π commence un autre ensemble de donn√©es.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Revenons au vidage uniquement au premier niveau pour examiner l'ensemble du fichier: </font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ xxd -s4 -g3 -c18 niveaux / le√ßon_1.pak</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000004: 020000 040202 050404 070505 080707 090001 ..................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000016: 0a0101 0b0808 0d0a0a 110023 150907 180200 ........... # ......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000028: 22090d 260911 270b0b 280705 291e01 272705 ".. &amp; .. '.. (..) ..' '.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0000003a: 020d01 220704 090209 0a0215 042609 250111 ... "......... &amp;.% ..</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0000004c: 150222 1d0124 011d0d 010709 002000 1b0400 .. ".. $ ....... ....</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0000005e: 1a0020 152609 1f0033 002911 152223 02110d ... &amp; ... 3.) .. "# ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000070: 010726 091f18 291115 09181a 022302 1b0215 .. &amp; ...) ...... # ....</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000082: 22011c 011c0d 0a0704 090201 020128 260123 "............. (&amp;. #</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000094: 150509 020121 150522 0a2727 0b0504 00060b .....! .. ".''......</font></font><font></font>
000000a6: 082804 18780b 082804 18700b 082804 186400 .(..x..(..p..(..d.<font></font>
000000b8: 17101e 1e1a19 010300 0e1a17 17100e 1f010e ..................<font></font>
000000ca: 13141b 291f1a 001210 1f011b 0c1e1f 011f13 ...)..............<font></font>
000000dc: 10010e 13141b 001e1a 0e1610 1f2d00 201e10 .............-. ..<font></font>
000000ee: 011610 24291f 1a011a 1b1019 000f1a 1a1d1e ...$).............<font></font>
00000100: 2d02 </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En √©tudiant la s√©quence des triplets, nous pouvons supposer que la partie avec des bandes dans ces donn√©es se termine apr√®s 17 triplets, par d√©calage </font></font><code>00000036</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ce n'est pas exact, mais le premier octet de chaque triplet augmente constamment sa valeur, puis diminue du dix-huiti√®me triplet. Encore une preuve: dans le dix-huiti√®me triplet, le deuxi√®me octet a la m√™me signification que le premier. Nous ne l'avons pas encore remarqu√©, mais si nous regardons en arri√®re, nous verrons que le premier octet n'est jamais √©gal au deuxi√®me ou au troisi√®me octet.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si notre th√©orie des marqueurs est correcte, il y a deux possibilit√©s. Premi√®rement, il est possible qu'apr√®s la partie de bande il y ait une valeur d'octet sp√©ciale (juste apr√®s le dix-septi√®me triplet). Deuxi√®mement, il existe probablement une valeur stock√©e quelque part qui est √©gale √† la taille de la pi√®ce avec des rayures. Cette taille peut √™tre √©gale √† 17 (c'est-√†-dire qu'elle indique le nombre de triplets), ou 51 (elle indique le nombre total d'octets dans une partie), ou 55 (51 plus 4, c'est-√†-dire le d√©calage du fichier dans lequel se termine cette partie). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour la premi√®re option, une valeur √† deux octets peut √™tre un marqueur pour la fin de la partie (√©tant donn√© qu'une telle s√©quence ne se produit jamais dans la deuxi√®me partie). Cependant, une √©tude attentive de plusieurs autres fichiers de donn√©es contredit cette id√©e, car un tel mod√®le n'appara√Æt nulle part ailleurs.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour la deuxi√®me option, il cherchera √©videmment l'indicateur de taille dans la premi√®re partie. </font><font style="vertical-align: inherit;">Voici - la premi√®re valeur de 16 bits dans l'en-t√™te de fichier de quatre octets est 17:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ od -An -tuS -N4 niveaux / le√ßon_1.pak</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    17 203 </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si notre th√©orie est correcte, cette valeur ne d√©termine pas la taille de la partie avec des rayures, mais le nombre d'enregistrements sur trois octets. </font><font style="vertical-align: inherit;">Pour tester cette id√©e, revenons √† l'informatique, o√π nous avons compar√© la somme de deux valeurs enti√®res de 16 bits avec la taille du fichier. </font><font style="vertical-align: inherit;">Cette fois, nous multiplions le premier nombre par trois pour obtenir la taille r√©elle en octets:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ pour f dans les niveaux / *; </font><font style="vertical-align: inherit;">faire taille = $ (wc -c &lt;$ f); </font><font style="vertical-align: inherit;">lire v1 v2 &lt;&lt; (od -tuS -An -N4 $ f); </font><font style="vertical-align: inherit;">diff = $ (($ taille - 3 * $ v1 - $ v2));</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    echo "$ size = 3 * $ v1 + $ v2 + $ diff"; </font><font style="vertical-align: inherit;">fait | </font><font style="vertical-align: inherit;">moins</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
585 = 3 * 35 + 476 + 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
586 = 3 * 45 + 447 + 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
550 = 3 * 43 + 417 + 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
302 = 3 * 29 + 211 + 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
517 = 3 * 45 + 378 + 4</font></font><font></font>
671 = 3 * 49 + 520 + 4<font></font>
265 = 3 * 26 + 183 + 4<font></font>
344 = 3 * 26 + 262 + 4<font></font>
478 = 3 * 32 + 378 + 4<font></font>
342 = 3 * 58 + 164 + 4<font></font>
336 = 3 * 38 + 218 + 4<font></font>
352 = 3 * 36 + 240 + 4<font></font>
625 = 3 * 42 + 495 + 4<font></font>
532 = 3 * 44 + 396 + 4<font></font>
386 = 3 * 42 + 256 + 4<font></font>
450 = 3 * 27 + 365 + 4<font></font>
373 = 3 * 30 + 279 + 4<font></font>
648 = 3 * 50 + 494 + 4<font></font>
477 = 3 * 42 + 347 + 4<font></font>
530 = 3 * 44 + 394 + 4<font></font>
247 = 3 * 29 + 156 + 4<font></font>
325 = 3 * 32 + 225 + 4<font></font>
394 = 3 * 32 + 294 + 4<font></font>
343 = 3 * 31 + 246 + 4<font></font>
lines 1-24/148 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouais! Apr√®s cette modification, le montant total de l'en-t√™te est toujours exactement quatre fois inf√©rieur √† la taille de l'ensemble du fichier de donn√©es. Et puisque quatre est √©galement le nombre d'octets dans l'en-t√™te, il est √©vident que ce n'est pas une co√Øncidence. Le premier nombre nous donne le nombre d'entr√©es de trois octets dans la table, et le deuxi√®me nombre nous donne le nombre d'octets qui composent le reste du fichier de donn√©es. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons trouv√© une formule constante, ce qui signifie que nous comprenons maintenant parfaitement ce que signifient les chiffres dans la premi√®re partie.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Au fait, voici le sch√©ma tr√®s secret que les lecteurs attentifs peuvent remarquer. Une √©tude attentive des √©quations montre clairement que lorsque les fichiers ont le m√™me premier nombre, ils obtiennent la m√™me diff√©rence r√©siduelle. Cela se produit car la diff√©rence est toujours le double de la valeur C'est un mod√®le peu √©vident, mais un observateur minutieux ou r√©ussi pourrait le remarquer.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, nous pouvons dire que le fichier comprend trois parties principales:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en-t√™te de quatre octets; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tableau de trois enregistrements d'octets; </font></font> et </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le reste du fichier, qui contient soi-disant la plupart des donn√©es. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Par cons√©quent, les autres parties que nous avons approximativement d√©termin√©es pr√©c√©demment devraient √™tre des sous-sections de la troisi√®me partie.) </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interpr√©tation des m√©tadonn√©es </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compte tenu de ce sch√©ma, il serait logique de supposer que les entr√©es du tableau de la deuxi√®me partie sont des m√©tadonn√©es n√©cessaires √† l'interpr√©tation des donn√©es de la troisi√®me partie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais quel type de m√©tadonn√©es ce tableau contient-il?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons remarqu√© ci-dessus qu'il y a quelques signes que le fichier de donn√©es peut √™tre compress√©. (Maintenant, cela semble encore plus plausible, car nous savons que la troisi√®me partie de chaque fichier, cens√©e contenir des donn√©es de chaque niveau, ne fait que 100 √† 600 octets.) Si c'est le cas, il est fort possible que la table qui pr√©c√®de les donn√©es principales contienne des m√©tadonn√©es de compression - un dictionnaire utilis√© lors du d√©ballage. Par exemple, avant les donn√©es cod√©es par l'algorithme Huffman, il existe g√©n√©ralement un dictionnaire qui mappe les valeurs d'octets d'origine aux s√©quences de bits. Bien que nous ne nous attendions pas √† ce que ces fichiers soient cod√©s par l'algorithme de Huffman (puisque les donn√©es montrent des mod√®les clairs au niveau des octets, c'est-√†-dire qu'ils ne sont gu√®re un flux binaire), il serait sage d'essayer d'interpr√©ter ce tableau comme un dictionnaire de d√©compression.</font></font><br><br> (,        . ,  deflate,   <code>gzip</code>  <code>zlib</code> ,       .      ,  .) <br><br>       :   . ,    , ,       ,   .    ,           ‚Äî  ,      ,        .   ,        ,     ‚Äî . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si tel est le cas, alors l'un des moyens les plus simples d'interpr√©ter la partie de bande est que le premier octet est la valeur d'octet qui doit √™tre remplac√©e dans les donn√©es compress√©es, et les deuxi√®me et troisi√®me octets sont la valeur qui doit √™tre remplac√©e. </font><font style="vertical-align: inherit;">Le r√©sultat cr√©√© par ce sch√©ma sera certainement plus grand, bien qu'il ne soit pas clair combien. </font><font style="vertical-align: inherit;">Quoi qu'il en soit, c'est une hypoth√®se logique, et elle est assez facile √† v√©rifier. </font><font style="vertical-align: inherit;">Nous pouvons √©crire un petit programme en Python qui impl√©mente ce sch√©ma de d√©compression: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File decompress.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-comment"><span class="hljs-comment"># Read the compressed data file. data = sys.stdin.read() # Extract the two integers of the four-byte header. tablesize, datasize = struct.unpack('HH', data[0:4]) data = data[4:] # Separate the dictionary table and the compressed data. tablesize *= 3 table = data[0:tablesize] data = data[tablesize:datasize] # Apply the dictionary entries to the data section. for n in range(0, len(table), 3): key = table[n] val = table[n+1:n+3] data = data.replace(key, val) # Output the expanded result. sys.stdout.write(data)</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant, nous pouvons v√©rifier ce script en utilisant un exemple de fichier de donn√©es: </font></font><br><br><blockquote> <code>$ python ./decompress.py &lt;levels/lesson_1.pak | xxd <br> 00000000: 0b0b 0b0b 0404 0000 0a0a 0109 0d05 0502 ................ <br> 00000010: 0200 0100 0000 0101 0100 0009 0702 0209 ................ <br> 00000020: 1100 0125 0100 2309 0700 0009 0d1d 0124 ...%..#........$ <br> 00000030: 011d 0a0a 0105 0500 0100 2000 1b02 0200 .......... ..... <br> 00000040: 1a00 2009 0709 1100 011f 0033 001e 0100 .. ........3.... <br> 00000050: 2309 0709 0d23 0000 0023 0a0a 0105 0509 #....#...#...... <br> 00000060: 1100 011f 0200 1e01 0023 0907 0001 0200 .........#...... <br> 00000070: 1a00 0023 0000 1b00 0009 0709 0d01 1c01 ...#............ <br> 00000080: 1c0a 0a01 0105 0502 0200 0100 0001 0000 ................ <br> 00000090: 0107 0509 1101 2309 0704 0400 0100 0001 ......#......... <br> 000000a0: 2109 0704 0409 0d01 010b 0b0b 0b08 0804 !............... <br> 000000b0: 0402 0200 0608 0807 0707 0502 0202 0078 ...............x <br> 000000c0: 0808 0707 0705 0202 0200 7008 0807 0707 ..........p..... <br> 000000d0: 0502 0202 0064 0017 101e 1e1a 1901 0300 .....d.......... <br> 000000e0: 0e1a 1717 100e 1f01 0e13 141b 1e01 1f1a ................ <br> 000000f0: 0012 101f 011b 0c1e 1f01 1f13 1001 0e13 ................ <br> 00000100: 141b 001e 1a0e 1610 1f2d 0020 1e10 0116 .........-. .... <br> 00000110: 1024 1e01 1f1a 011a 1b10 1900 0f1a 1a1d .$.............. <br> 00000120: 1e2d 0000</code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, les r√©sultats ne sont pas remarquables. Bien s√ªr, le flux de donn√©es r√©sultant est devenu plus d√©ploy√© que l'original, mais pas beaucoup. Certainement pas assez pour contenir toutes les donn√©es que nous esp√©rons trouver. De toute √©vidence, ce sch√©ma de d√©ballage est un peu plus simple que n√©cessaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous examinons attentivement la sortie r√©sultante, nous verrons bient√¥t qu'elle commence par de nombreux octets r√©p√©t√©s. </font></font><code>0b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>04</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>0a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ils se produisent tous les </font><font style="vertical-align: inherit;">deux par deux. En regardant l'original compress√©, nous verrons que toutes ces paires sont apparues en raison d'un remplacement de dictionnaire. Mais dans le processus, nous remarquons imm√©diatement que toutes ces significations en double correspondent √©galement √† des entr√©es dans le dictionnaire. Autrement dit, si nous appliquons √† nouveau le dictionnaire, les donn√©es se d√©velopperont √† nouveau. Peut-√™tre que nous ne d√©ballons pas assez?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre premi√®re supposition peut √™tre d'effectuer une deuxi√®me passe, en appliquant chaque entr√©e de dictionnaire une deuxi√®me fois pour √©tendre encore plus les donn√©es. La deuxi√®me supposition peut √™tre d'effectuer plusieurs passes avec le dictionnaire, en r√©p√©tant le processus jusqu'√† ce que tous les octets similaires aux cl√©s du dictionnaire soient remplac√©s. Cependant, si nous examinons de plus pr√®s la structure du dictionnaire, nous r√©alisons que nous appliquons simplement les entr√©es </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dictionnaire </font><em><font style="vertical-align: inherit;">de droite √† gauche</font></em><font style="vertical-align: inherit;"> , et non de gauche √† droite, lorsque toutes nos valeurs sont d√©velopp√©es en une seule passe.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En prenant cette hypoth√®se, nous pouvons voir la structure d'un algorithme de compression plus plausible. Le programme prend les donn√©es sources et les analyse, √† la recherche des s√©quences √† deux octets les plus courantes. Il remplace ensuite la s√©quence de deux octets par une valeur d'octet qui ne se trouve pas dans les donn√©es. Il r√©p√®te ensuite le processus en le poursuivant jusqu'√† ce que les donn√©es contiennent plus de deux r√©p√©titions de s√©quences √† deux octets. En fait, un tel algorithme de compression a un nom: il est connu sous le nom de compression ¬´re-pair¬ª, qui est l'abr√©viation de ¬´paires r√©cursives¬ª.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Et cela peut expliquer certains mod√®les que nous voyons dans le dictionnaire. Pendant la compression, le dictionnaire est construit de gauche √† droite, donc lors du d√©ballage, il doit √™tre appliqu√© de droite √† gauche. Comme les entr√©es du dictionnaire font souvent r√©f√©rence aux entr√©es pr√©c√©dentes, il est logique que les deuxi√®me et troisi√®me octets soient souvent plus petit que le premier.) </font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien que la recompression ne produise pas de r√©sultats tr√®s impressionnants, elle pr√©sente un avantage: le d√©compresseur peut √™tre impl√©ment√© avec un minimum de code. </font><font style="vertical-align: inherit;">J'ai moi-m√™me utilis√© le recouplage dans certaines situations lorsque j'avais besoin de minimiser la </font><font style="vertical-align: inherit;">taille </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">totale</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des donn√©es compress√©es et du code de d√©compression.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, nous pouvons effectuer une modification sur une ligne du programme Python pour appliquer le dictionnaire de droite √† gauche: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fichier decompress2.py:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-comment"><span class="hljs-comment"># Read the compressed data file. data = sys.stdin.read() # Extract the two integers of the four-byte header. tablesize, datasize = struct.unpack('HH', data[0:4]) data = data[4:] # Separate the dictionary table and the compressed data. tablesize *= 3 table = data[0:tablesize] data = data[tablesize:datasize] # Apply the dictionary entries to the data section in reverse order. for n in range(len(table) - 3, -3, -3): key = table[n] val = table[n+1:n+3] data = data.replace(key, val) # Output the expanded result. sys.stdout.write(data)</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si nous essayons cette version, la sortie sera beaucoup plus grande: </font></font><br><br><blockquote><pre> $ python ./decompress2.py &lt;levels/lesson_1.pak | xxd | less<font></font>
00000000: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000010: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000020: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000030: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000040: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000050: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000060: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000070: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000080: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000090: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000a0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000b0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000c0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000d0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000e0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000000f0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000100: 0000 0000 0000 0000 0000 0101 0101 0100 ................<font></font>
00000110: 0101 0101 0100 0000 0000 0000 0000 0000 ................<font></font>
00000120: 0000 0000 0000 0000 0000 0100 0000 0101 ................<font></font>
00000130: 0100 0000 0100 0000 0000 0000 0000 0000 ................<font></font>
00000140: 0000 0000 0000 0000 0000 0100 2300 0125 ............#..%<font></font>
00000150: 0100 2300 0100 0000 0000 0000 0000 0000 ..#.............<font></font>
00000160: 0000 0000 0000 0000 0101 0101 011d 0124 ...............$<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000170: 011d 0101 0101 0100 0000 0000 0000 0000 ................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lignes 1-24 / 93 (plus) </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous voyons beaucoup d'octets nuls dans cette sortie, mais cela peut bien correspondre √† une carte presque vide. </font><font style="vertical-align: inherit;">Les octets diff√©rents de z√©ro semblent √™tre regroup√©s les uns √† c√¥t√© des autres. </font><font style="vertical-align: inherit;">Puisque nous esp√©rons trouver une carte 32 √ó 32, reformatons la sortie √† 32 octets par ligne:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ python ./decompress2.py &lt;niveaux / le√ßon_1.pak | </font><font style="vertical-align: inherit;">xxd -c32 | </font><font style="vertical-align: inherit;">moins</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000000: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000020: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000040: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................</font></font><font></font>
00000060: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
00000080: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
000000a0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
000000c0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
000000e0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
00000100: 0000 0000 0000 0000 0000 0101 0101 0100 0101 0101 0100 0000 0000 0000 0000 0000 ................................<font></font>
00000120: 0000 0000 0000 0000 0000 0100 0000 0101 0100 0000 0100 0000 0000 0000 0000 0000 ................................<font></font>
00000140: 0000 0000 0000 0000 0000 0100 2300 0125 0100 2300 0100 0000 0000 0000 0000 0000 ............#..%..#.............<font></font>
00000160: 0000 0000 0000 0000 0101 0101 011d 0124 011d 0101 0101 0100 0000 0000 0000 0000 ...............$................<font></font>
00000180: 0000 0000 0000 0000 0100 2000 1b00 0000 0000 1a00 2000 0100 0000 0000 0000 0000 .......... ......... ...........<font></font>
000001a0: 0000 0000 0000 0000 0100 2300 011f 0033 001e 0100 2300 0100 0000 0000 0000 0000 ..........#....3....#...........<font></font>
000001c0: 0000 0000 0000 0000 0101 0101 0123 0000 0023 0101 0101 0100 0000 0000 0000 0000 .............#...#..............<font></font>
000001e0: 0000 0000 0000 0000 0100 2300 011f 0000 001e 0100 2300 0100 0000 0000 0000 0000 ..........#.........#...........<font></font>
00000200: 0000 0000 0000 0000 0100 0000 1a00 0023 0000 1b00 0000 0100 0000 0000 0000 0000 ...............#................<font></font>
00000220: 0000 0000 0000 0000 0101 0101 0101 1c01 1c01 0101 0101 0100 0000 0000 0000 0000 ................................<font></font>
00000240: 0000 0000 0000 0000 0000 0000 0100 0001 0000 0100 0000 0000 0000 0000 0000 0000 ................................<font></font>
00000260: 0000 0000 0000 0000 0000 0000 0100 2301 2300 0100 0000 0000 0000 0000 0000 0000 ..............#.#...............<font></font>
00000280: 0000 0000 0000 0000 0000 0000 0100 0001 2100 0100 0000 0000 0000 0000 0000 0000 ................!...............<font></font>
000002a0: 0000 0000 0000 0000 0000 0000 0101 0101 0101 0100 0000 0000 0000 0000 0000 0000 ................................<font></font>
000002c0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
000002e0: 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ................................<font></font>
lines 1-24/47 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s avoir soigneusement examin√© les mod√®les de valeurs non nulles, nous verrons que la carte est clairement visible dans la sortie. </font><font style="vertical-align: inherit;">En fait, nous pouvons rendre ce motif plus visible √† l'aide de l'outil de vidage ¬´color√©¬ª, qui attribue une couleur √† chaque valeur d'octet, simplifiant la recherche de motifs de valeurs en double: </font></font><br><br> <code>xcd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il s'agit d'un outil non standard, mais vous pouvez le t√©l√©charger √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partir d'ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Notez l'option </font></font><code>-r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilitaire </font></font><code>less</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui vous indique d'effacer les s√©quences de contr√¥le.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w4/8p/68/w48p68o5f00b_zuu13pagsfb0um.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comparez cela √† une carte de premier niveau dessin√©e par des fans: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fe5/03a/ae9/fe503aae95f2acaa3a3663c43f528cef.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sans aucun doute, nous voyons les donn√©es de la carte de niveau. </font><font style="vertical-align: inherit;">Vous pouvez √™tre s√ªr que nous avons correctement d√©termin√© l'algorithme de d√©ballage.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interpr√©tation des donn√©es </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En comparant les valeurs d'octets avec l'image de la carte, nous pouvons d√©terminer ce qui </font></font><code>00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code une tuile vide, </font></font><code>01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code un mur et </font></font><code>23</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©signe une puce. </font></font><code>1A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©signe une porte rouge, </font></font><code>1B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- une porte bleue, etc. Nous pouvons attribuer des valeurs exactes aux puces, cl√©s, portes et toutes les autres tuiles qui composent la carte de niveau enti√®re. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, nous pouvons passer au niveau suivant et trouver les valeurs d'octets pour les objets qui y apparaissent. Et continuez avec les niveaux suivants jusqu'√† ce que nous obtenions une liste compl√®te des valeurs d'octets et des objets de jeu qu'ils encodent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme nous l'avons initialement sugg√©r√©, la carte se termine exactement apr√®s 1024 octets (au d√©calage </font></font><code>000003FF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette fois, pour supprimer les 32 premi√®res lignes du vidage, nous utilisons</font></font><code>sed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Comme nous avons 32 octets par ligne, nous ignorerons les 1024 premiers octets.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lq/xf/tu/lqxftuj5dvg9tletfkavcjd3n6m.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imm√©diatement apr√®s les donn√©es de la carte se trouve une s√©quence de 384 octets (dont les valeurs sont dans l'intervalle </font></font><code>00000400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>0000057F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), presque toutes √©gales √† z√©ro, mais des valeurs non nulles se situent √©galement entre elles. </font><font style="vertical-align: inherit;">Apr√®s cela vient un mod√®le d'octets compl√®tement diff√©rent, il serait donc logique de supposer que cette s√©quence de 384 octets est une partie distincte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous regardons quelques niveaux suppl√©mentaires, nous remarquons rapidement le mod√®le. </font><font style="vertical-align: inherit;">La partie de 384 octets se compose en fait de trois sous-sections de 128 octets chacune. </font><font style="vertical-align: inherit;">Chaque sous-section commence par quelques octets non nuls suivis de z√©ros qui remplissent le reste de la sous-section.</font></font><br><br>       ;   (   )   .     ,   ,            ¬´¬ª  .      ¬´¬ª     ,   (   ,    )      ().        ,      . <br><br>  ,   ,           ,     ,       . <br><br>  128-  ‚Äî    ,   . ,     : <br><br><blockquote><pre> $ python ./decompress2.py &lt;levels/lesson_2.pak | xxd | less<font></font>
00000400: 0608 1c1c 0808 0000 0000 0000 0000 0000 ................<font></font>
00000410: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000420: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000430: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000440: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000450: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000460: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000470: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000480: a870 98a0 6868 0000 0000 0000 0000 0000 .p..hh..........<font></font>
00000490: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004a0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004b0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004c0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004d0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004e0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
000004f0: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000500: 6060 6060 5868 0000 0000 0000 0000 0000 ````Xh..........<font></font>
00000510: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000520: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000530: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000540: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000550: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000560: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
00000570: 0000 0000 0000 0000 0000 0000 0000 0000 ................<font></font>
lines 64-87/93 (more) </pre></blockquote><br>     : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/705/4aa/f21/7054aaf21da6d4ccaf7c7d30a31cee94.png"></div><br>      :  ,    .  128-     <code>06</code> ,   <code>08</code>    <code>1C</code> .   ,  <code>06</code>  , <code>08</code> ‚Äî ,  <code>1C</code> ‚Äî . <br><br> (           ,       :       ,   <code>04</code> , <code>05</code> , <code>06</code>  <code>07</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cet ensemble de notations contient en fait tous les monstres. Lorsque nous √©tudierons attentivement les diff√©rentes valeurs, nous comprendrons finalement que la valeur 0, 1, 2 ou 3 est ajout√©e √† la valeur d'octet indiquant le type, indiquant la direction initiale de la foule: nord, est, sud ou ouest. C'est-√†-dire, par exemple, qu'une valeur d'octet </font></font><code>06</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indique une puce orient√©e vers le sud.)</font></font><br><br>      .             ,  ,        X  ,      ‚Äî  Y  .      ,  ,    ,      3  , ..   8.     ¬´¬ª ,      . (,     , ,          ,   .) <br><br>    ,    ,          : <br><br> ,  <code>xxd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepte une </font></font><code>-s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur hexad√©cimale </font><font style="vertical-align: inherit;">pour l'option </font><font style="vertical-align: inherit;">.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ pour f dans les niveaux / *; </font><font style="vertical-align: inherit;">faire python ./decompress2.py &lt;$ f | </font><font style="vertical-align: inherit;">xxd -s 0x580 | </font><font style="vertical-align: inherit;">sed -n 1p; </font><font style="vertical-align: inherit;">fait | </font><font style="vertical-align: inherit;">moins</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 9001 0c17 1701 1120 1717 00 ....... ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 0000 0c17 1b13 0c0d 101f 011e 1a20 1b00 ............. ..</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: f401 0c18 1e1f 101d 0f0c 1800 ............</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 2c01 0c1b 0c1d 1f18 1019 1f00, ...........</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 9001 0c1d 0e1f 140e 1117 1a22 00 ............ "</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 2c01 0d0c 1717 1e01 1a01 1114 1d10 00, ..............</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 2c01 0d10 220c 1d10 011a 1101 0d20 1200, ... "........ ..</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 5802 0d17 1419 1600 X .......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: 0000 0d17 1a0d 0f0c 190e 1000 ............</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: f401 0d17 1a0d 1910 1f00 ..........</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000580: f401 0d17 1a0e 1601 110c 0e1f 1a1d 2400 .............. $.</font></font><font></font>
00000580: ee02 0d17 1a0e 1601 0d20 1e1f 101d 0114 ......... ......<font></font>
00000580: 5802 0d17 1a0e 1601 1901 1d1a 1717 00 X..............<font></font>
00000580: 5e01 0d17 1a0e 1601 1a20 1f00 ^........ ..<font></font>
00000580: c201 0d17 1a0e 1601 0d20 1e1f 101d 00 ......... .....<font></font>
00000580: 2c01 0d1a 2019 0e10 010e 141f 2400 ,... .......$.<font></font>
00000580: 5000 0d1d 201e 1311 141d 1000 P... .......<font></font>
00000580: e703 0e0c 1610 0122 0c17 1600 ......."....<font></font>
00000580: 5802 0e0c 1e1f 1710 0118 1a0c 1f00 X.............<font></font>
00000580: 8f01 0e0c 1f0c 0e1a 180d 1e00 ............<font></font>
00000580: 0000 0e10 1717 0d17 1a0e 1610 0f00 1b1d ................<font></font>
00000580: 2c01 0e13 0e13 0e13 141b 1e00 ,...........<font></font>
00000580: 8f01 0e13 1417 1710 1d00 ..........<font></font>
00000580: bc02 0e13 141b 1814 1910 00 ...........<font></font>
lines 1-24/148 (more) </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'examen de la premi√®re paire d'octets dans le reste nous indique rapidement qu'ils contiennent une autre valeur enti√®re de 16 bits. </font><font style="vertical-align: inherit;">Si nous les consid√©rons comme ceci, alors la majorit√© des valeurs apparaissent en notation d√©cimale sous forme de nombres ronds: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La commande </font></font><code>od</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilise √† la </font></font><code>-j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">place </font><font style="vertical-align: inherit;">pour passer au d√©calage d'origine </font></font><code>-s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il convient √©galement de noter la commande </font></font><code>printf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: en plus de fournir une mise en forme, c'est un moyen pratique d'afficher du texte sans un retour √† la ligne √† la fin.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ pour f dans les niveaux / *; </font><font style="vertical-align: inherit;">faire printf "% -20s" $ f; </font><font style="vertical-align: inherit;">python ./decompress2.py &lt;$ f | </font><font style="vertical-align: inherit;">od -An -j 0x580 -tuS -N2; </font><font style="vertical-align: inherit;">fait | </font><font style="vertical-align: inherit;">moins</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
levels / all_full.pak 400</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / alphabet.pak 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / amsterda.pak 500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
levels / apartmen.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / arcticfl.pak 400</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / boules_o_.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / beware_o.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / blink.pak 600</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / blobdanc.pak 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / blobnet.pak 500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / block_fa.pak 500</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
levels / block_ii.pak 750</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / block_n_.pak 600</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
levels / block_ou.pak 350</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
levels / block.pak 450</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / bounce_c.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / brushfir.pak 80</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / cake_wal.pak 999</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
levels / castle_m.pak 600</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / catacomb.pak 399</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / cellbloc.pak 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / chchchip.pak 300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / chiller.pak 399</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
niveaux / chipmine.pak 700</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lignes 1-24 / 148 (plus) </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous nous tournons √† nouveau vers la liste, cr√©√©e √† l'origine √† partir des donn√©es que nous nous attendions √† trouver dans les fichiers, nous nous rendons compte que ce nombre est le temps de passer le niveau (si la valeur est z√©ro, il n'y a pas de limite de temps sur le niveau). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s ces deux octets, les donn√©es deviennent plus volatiles. </font><font style="vertical-align: inherit;">Le fait que pour la plupart des niveaux il reste une dizaine d'octets dans le fichier limite s√©rieusement leur contenu:</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ python ./decompress2.py &lt;levels / all_full.pak | </font><font style="vertical-align: inherit;">xxd -s 0x0582</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000582: 0c17 1701 1120 1717 00 ..... ... </font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, il ne reste que neuf octets √† ce niveau. </font><font style="vertical-align: inherit;">Nous prenons en compte cette taille limit√©e, ainsi que le fait que ces neuf octets contiennent quatre occurrences de la valeur </font></font><code>17</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, collect√©es en deux paires. </font><font style="vertical-align: inherit;">On remarquera imm√©diatement que le motif des chiffres </font></font><code>17</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">correspond au motif des lettres </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au nom du niveau ¬´TOUT COMPL√àTE¬ª. </font><font style="vertical-align: inherit;">Le nom comporte huit caract√®res, donc l'octet nul √† la fin est tr√®s probablement le caract√®re de fin de ligne. </font><font style="vertical-align: inherit;">Apr√®s avoir d√©couvert cela, vous pouvez regarder trivialement tous les autres niveaux et utiliser leurs noms pour construire une liste compl√®te de personnages:</font></font><br><br><table><tbody><tr><td> <code>00</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fin de ligne </font></font></td></tr><tr><td> <code>01</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> barre d'espace </font></font></td></tr><tr><td> <code>02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><code>0B</code> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chiffres 0-9 </font></font></td></tr><tr><td> <code>0C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><code>25</code> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lettres AZ </font></font></td></tr><tr><td> <code>26</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><code>30</code> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signes de ponctuation </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour la plupart des niveaux, le fichier de donn√©es se termine ici. </font><font style="vertical-align: inherit;">Cependant, quelques dizaines de noms contiennent encore des donn√©es. </font><font style="vertical-align: inherit;">Si nous jetons un coup d'≈ìil √† la liste, nous verrons qu'il existe des niveaux avec des boutons de conseil, et ces donn√©es restantes contiennent le texte de la ligne de conseil de niveau cod√© avec le m√™me jeu de caract√®res que les noms de niveau. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s cela, nous avons atteint la fin de tous les fichiers. </font><font style="vertical-align: inherit;">Nous avons maintenant une description compl√®te du sch√©ma de ces niveaux. </font><font style="vertical-align: inherit;">Notre t√¢che est termin√©e.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Affaires inachev√©es </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un lecteur attentif peut remarquer qu'au d√©part, nous nous attendions √† trouver dans ces fichiers deux autres √©l√©ments que nous n'avons jamais rencontr√©s. Nous expliquerons l'absence des deux: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le premier √©l√©ment est le nombre de jetons, c'est-√†-dire Le nombre total de jetons qu'un joueur doit collecter pour passer √† travers le connecteur de jetons. Comme nous l'avons dit initialement, il est souvent √©gal au nombre total de puces √† un niveau, mais cela ne se produit pas toujours. Par cons√©quent, ces donn√©es doivent √™tre obtenues d'une mani√®re ou d'une autre. La r√©ponse peut √™tre trouv√©e en √©tudiant les cartes des niveaux auxquels il y a des jetons suppl√©mentaires. Il s'av√®re que deux valeurs diff√©rentes sont utilis√©es pour indiquer les puces. La valeur que </font></font><code>23</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous avons trouv√©e initialement, mais la valeur est √©galement utilis√©e.</font></font><code>31</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©signant une puce qui n'affecte pas le montant total requis pour ouvrir le connecteur de puce. (Cependant, du point de vue du gameplay, les deux types de jetons sont identiques. S'il y a un type de jeton </font></font><code>31</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au niveau, alors au niveau vous ne pouvez pas collecter autant de jetons que vous le souhaitez.)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le deuxi√®me √©l√©ment est le mot de passe de niveau √† quatre lettres. </font><font style="vertical-align: inherit;">Il n'est masqu√© nulle part dans les donn√©es de niveau. </font><font style="vertical-align: inherit;">Malheureusement, ce probl√®me ne peut pas √™tre r√©solu par une enqu√™te plus approfondie du fichier de donn√©es. </font><font style="vertical-align: inherit;">Nous sommes oblig√©s de conclure que les mots de passe sont simplement stock√©s ailleurs. </font><font style="vertical-align: inherit;">L'explication la plus probable: ils sont cod√©s en dur quelque part dans le programme lui-m√™me. </font><font style="vertical-align: inherit;">Cependant, il est devenu plus tard clair que les mots de passe ne sont pas stock√©s directement. </font><font style="vertical-align: inherit;">Des gens familiers avec le code lui-m√™me, j'ai appris que les mots de passe sont g√©n√©r√©s dynamiquement √† l'aide d'un g√©n√©rateur de nombres pseudo-al√©atoires initialis√© avec une s√©quence sp√©cifique. </font><font style="vertical-align: inherit;">Par cons√©quent, les mots de passe des niveaux ne peuvent pas √™tre modifi√©s directement, cela ne peut √™tre fait qu'en changeant le code assembleur.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Postface </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En effectuant une ing√©nierie inverse compl√®te des donn√©es dans les fichiers de niveau, j'ai pu commencer √† √©crire un programme qui peut coder et d√©coder les donn√©es de niveau. Gr√¢ce √† elle, j'ai pu cr√©er l'√©diteur de niveau tant attendu pour la version de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chip's Challenge</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour Lynx, et la pr√©sence de cet outil a consid√©rablement accru ma capacit√© √† √©tudier la logique du jeu, et √©galement am√©lior√© la qualit√© de son √©mulation.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais ... je dois admettre que j'ai personnellement fait le d√©veloppement inverse des fichiers de donn√©es d'une mani√®re non d√©crite ci-dessus. J'ai commenc√© √† l'autre bout - avec la d√©finition des donn√©es de cha√Æne. J'ai commenc√© √† √©tudier les fichiers des huit premiers niveaux. Puisqu'ils sont appel√©s de "LE√áON 1" √† "LE√áON 8", j'ai recherch√© des donn√©es de sous-cha√Ænes identiques en eux. Et j'ai eu de la chance: aucun des noms de ces niveaux n'a √©t√© compress√©, donc les huit noms sont stock√©s dans les fichiers de donn√©es dans leur forme d'origine. Bien s√ªr, j'√©tais g√™n√© que ces lignes ne soient pas stock√©es en caract√®res ASCII, mais le double S du nom m'a aid√© √† d√©tecter un motif qui se r√©p√©tait dans les huit fichiers de donn√©es. Et ayant trouv√© le nom, j'ai reconnu l'encodage des lettres, des chiffres et du caract√®re espace. Ensuite, j'ai appliqu√© cet encodage au reste du fichier, et juste apr√®s le nom, j'ai vu des lignes d'invite et j'ai commenc√© √† observer les anomalies:</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un grand utilitaire </font></font><code>tr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facilite la conversion de votre propre jeu de caract√®res de fichiers de donn√©es en ASCII.</font></font><br><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ tr '\ 001- \ 045' '0-9A-Z' &lt;niveaux / le√ßon_1.pak | </font><font style="vertical-align: inherit;">xxd</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000000: 4600 cb00 3000 0032 3030 3332 3235 3333 F ... 0..200322533</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000010: 3635 3537 0020 3820 2039 3636 4238 3846 6557. 8 966B88F</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000020: 0058 4a37 354d 3000 5737 4226 3746 2739 .XJ75M0.W7B &amp; 7F'9</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000030: 3928 3533 2953 2027 2733 3042 2057 3532 9 (53) S '' 30B W52</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000040: 3730 3738 304a 3226 375a 2046 4a30 5752 70780J2 &amp; 7Z FJ0WR</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000050: 2059 2052 4220 3537 0055 0050 3200 4f00 Y RB 57.U.P2.O.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000060: 554a 2637 5400 3300 2946 4a57 5830 4642 UJ &amp; 7T.3.) FJWX0FB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000070: 2035 2637 544d 2946 4a37 4d4f 3058 3050 5 &amp; 7TM) FJ7MO0X0P</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00000080: 304a 5720 5120 5142 3835 3237 3020 3020 0JW Q QB85270 0</font></font><font></font>
00000090: 2826 2058 4a33 3730 2056 4a33 5738 2727 (&amp; XJ370 VJ3W8''<font></font>
000000a0: 3933 3200 3439 3628 324d 7839 3628 324d 932.496(2Mx96(2M<font></font>
000000b0: 7039 3628 324d 6400 4c45 5353 4f4e 2031 p96(2Md.LESSON 1<font></font>
000000c0: 0043 4f4c 4c45 4354 2043 4849 5029 544f .COLLECT CHIP)TO<font></font>
000000d0: 0047 4554 2050 4153 5420 5448 4520 4348 .GET PAST THE CH<font></font>
000000e0: 4950 0053 4f43 4b45 542d 0055 5345 204b IP.SOCKET-.USE K<font></font>
000000f0: 4559 2954 4f20 4f50 454e 0044 4f4f 5253 EY)TO OPEN.DOORS<font></font>
00000100: 2d30 -0 </pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, dans le texte d'aide, il y a deux endroits o√π la s√©quence de S et l'espace sont remplac√©s par le crochet droit. </font><font style="vertical-align: inherit;">Ces anomalies m'ont donn√© suffisamment de preuves pour calculer d√©ductivement la pr√©sence de compression et obtenir des informations sur sa nature. </font><font style="vertical-align: inherit;">Plus tard, j'ai associ√© des valeurs d'octets anormales √† leurs occurrences plus pr√®s du d√©but du fichier de donn√©es. </font><font style="vertical-align: inherit;">(Par exemple, dans le vidage de d√©calage hexad√©cimal illustr√© ci-dessus, </font></font><code>00000035</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il y a un crochet droit, suivi d'un S majuscule et d'un espace.) √Ä partir de cela, j'ai calcul√© le sch√©ma de compression de mani√®re similaire au processus d√©crit dans l'article. </font><font style="vertical-align: inherit;">Tout le reste √©tait assez simple. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il me semble que l'on peut en tirer une le√ßon: il n'y a pas de moyen unique d'examiner un fichier de donn√©es inconnu. </font><font style="vertical-align: inherit;">Tous les outils qui vous conviennent sont les bons outils pour la r√©tro-ing√©nierie.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447562/">https://habr.com/ru/post/fr447562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447552/index.html">Comment optimiser les sections du catalogue dans une boutique en ligne: instructions √©tape par √©tape</a></li>
<li><a href="../fr447554/index.html">Pr√©sentation des nouvelles fonctionnalit√©s de NestJS 6</a></li>
<li><a href="../fr447556/index.html">Extension Mypy avec plugins</a></li>
<li><a href="../fr447558/index.html">R√©alit√© virtuelle - jeu, traitement, vie. La technologie VR au service de la m√©decine de r√©√©ducation</a></li>
<li><a href="../fr447560/index.html">Cr√©ation d'un projet BEM √† l'aide de Webpack</a></li>
<li><a href="../fr447564/index.html">Modifications de l'autorisation de r√©f√©rentiel sur GitLab.com</a></li>
<li><a href="../fr447566/index.html">Les scientifiques ont d'abord montr√© une v√©ritable "photo" d'un trou noir</a></li>
<li><a href="../fr447568/index.html">Entretien avec l'astronaute Alexander Laveikin sur le cin√©ma spatial, les surcharges de 20 unit√©s et l'atterrissage en douceur</a></li>
<li><a href="../fr447570/index.html">GoLand 2019.1: analyse des performances du code, Smart Step Into, refactoring Extract Interface, Nilness Analyzer et plus</a></li>
<li><a href="../fr447572/index.html">√ânergie, chaleur et eau: deuxi√®me partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>