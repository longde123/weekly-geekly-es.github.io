<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüëß üî† üïµüèª Criar um Thin Client RDP baseado em Raspberry Pi ü•© üöù üöµüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Com a crescente popularidade de mini-PCs como Raspberry Pi e clones similares, houve muitos casos para seu uso na infraestrutura de TI da empresa, em ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criar um Thin Client RDP baseado em Raspberry Pi</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479504/">  Com a crescente popularidade de mini-PCs como Raspberry Pi e clones similares, houve muitos casos para seu uso na infraestrutura de TI da empresa, em casa / chal√© / garagem inteligente e outros aplicativos. <br><br>  Um dos casos convenientes e desej√°veis ‚Äã‚Äã√© o uso do RPi como um thin client que se conecta via RDP a sistemas baseados no Windows. <br><br>  Se voc√™ estiver interessado em como montar um local com base no Raspberry Pi e de maneira a "montar e esquecer" - seja bem-vindo ao gato.  Existe uma imagem pronta para os pregui√ßosos (consulte a se√ß√£o 6.B). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3v/mj/zp/3vmjzprnt4v33dvnqnr6rwlikb8.png" alt="Uma imagem para atrair a aten√ß√£o"></div><br><a name="habracut"></a><br>  Especificamente, na minha experi√™ncia (especialista em automa√ß√£o cont√°bil / gerencial), muitas vezes eu precisava organizar locais de trabalho cujo √∫nico objetivo era acessar um programa (principalmente amarelo), uma su√≠te de escrit√≥rio, a Internet e o correio.  √Äs vezes - trabalhe com pen drives.  O servidor, ao mesmo tempo, j√° estava na empresa. <br><br>  Ao mesmo tempo, a esta√ß√£o exigia baixo n√≠vel de ru√≠do, compacidade e confiabilidade.  Ou, sejamos honestos, barato.  Especialmente se a pergunta fosse sobre varejo, onde tudo deveria ser "acertado". <br><br>  Ao mesmo tempo, no passado, muitas solu√ß√µes foram tentadas na forma de thin clients especializados em "ferro", mas por uma s√©rie de raz√µes, eles se mostraram desconfort√°veis.  Em algum lugar, tarefas relacionadas espec√≠ficas eram necess√°rias, como encaminhamento de impressoras para um servidor, com as quais eles n√£o conseguiam lidar.  Em algum lugar, as mesas apareceram lentamente, o que deixou os usu√°rios loucos.  Em algum lugar, os thin clients simplesmente trabalhavam em um √∫nico local, e era imposs√≠vel entender o porqu√™.  Em algum lugar a carga de rede caprichosa n√£o funcionou ou os par√¢metros n√£o foram transferidos via DHCP. <br><br>  Portanto, de alguma maneira natural, tudo chegou √† conclus√£o de que √© mais f√°cil comprar um lixo eletr√¥nico e colocar nele um conjunto m√≠nimo de software do que adivinhar um jogo com ferro obscuro, al√©m de suas pr√≥prias custas, porque onde e o que n√£o funciona n√£o √© conhecido antecipadamente , mas sabe-se com certeza que tudo deveria estar bem e n√£o demoraria tanto tempo. <br><br>  O artigo estava um pouco atrasado com a relev√¢ncia.  Se voc√™ retornar ao mesmo programa amarelo, nos √∫ltimos anos, a plataforma evoluiu, ela possui seu pr√≥prio thin client e a relev√¢ncia de sua implanta√ß√£o no modo de √°rea de trabalho remota diminuiu. <br><br>  Mas existem v√°rias outras tarefas em que uma esta√ß√£o de trabalho silenciosa e confi√°vel conectada via RDP ser√° apropriada.  E, nos √∫ltimos anos, o custo dos mini-PCs aumentou muito e, nos computadores e nettops padr√£o, tornou-se mais lucrativo (custo de hardware, uma hora de trabalho especializado, al√©m de licen√ßas CAL / TCAL para Windows Server) para criar exatamente essas solu√ß√µes. <br><br><h2>  Declara√ß√£o do problema </h2><br>  Portanto, com base no Raspberry Pi, <b>precisamos</b> implantar um cliente RDP fino, "prego" em um servidor espec√≠fico, al√©m de fornecer reconex√£o em caso de falha. <br><br>  Qualquer intera√ß√£o do usu√°rio com o pr√≥prio dispositivo deve ser exclu√≠da.  Consequentemente, nenhum desktop local e comandos de console.  A senha √© inserida apenas para a sess√£o RDP. <br><br>  Como um b√¥nus, - organize unidades USB remov√≠veis de montagem autom√°tica e probros. <br><br>  <b>Dado:</b> <br><br><ul><li>  Raspberry Pi puro 3 Modelo B 1Gb ou 4 Modelo B 1 Gb </li><li>  Adaptador de energia 5v 2A, </li><li>  Cabo HDMI </li><li>  adaptador com HDMI ao monitor (se o monitor n√£o tiver uma porta HDMI embutida), </li><li>  Cabo Ethernet (ou a presen√ßa de uma rede WiFi), </li><li>  Cart√£o de mem√≥ria MicroSD com 8 GB ou mais (4 GB √© objetivamente suficiente, mas parece-me que voc√™ pode comprar um cart√£o de 4 GB apenas no museu). </li><li>  monitor, teclado e mouse para framboesa. </li></ul><br>  No momento da instala√ß√£o - um computador (laptop) com Windows ou Linux, um adaptador de cart√£o microSD. <br><br>  Sup√µe-se que o leitor tenha a habilidade b√°sica de administrar sistemas Linux, e a pergunta "crie e edite um arquivo, copie o texto deste artigo para ele" ou "conecte-se via SSH" n√£o causar√° dificuldades.  No entanto, √†s vezes me permito uma excurs√£o mais profunda, para aqueles que podem n√£o ter encontrado especificamente com Raspbian. <br><br>  L√≥gica geral: configure o sistema b√°sico, instale o cliente RDP, configure o login autom√°tico, teste, corrija problemas. <br><br>  Tamb√©m descrever√° como clonar uma montagem finalizada para outro Raspberry. <br><br>  O layout do software em si √© simples, nasceu de uma forma ou de outra cerca de 9 anos atr√°s - como me lembro agora, fiz isso no Debian Etch.  Desde ent√£o, mudou um pouco das vers√µes de software e hardware para vers√µes, e agora √© hora de port√°-lo para o Raspberry. <br><br>  O consumo de tempo planejado √© de aproximadamente 30 minutos. <br><br><h2>  1. Configurando o sistema b√°sico </h2><br><h4>  1.1 Baixar imagem do sistema </h4><br>  Vamos escolher Raspbian como o sistema. <br><br>  No momento da reda√ß√£o <a href="https://www.raspberrypi.org/downloads/raspbian/" rel="nofollow">deste documento</a> , <a href="https://www.raspberrypi.org/downloads/raspbian/" rel="nofollow">isso pode ser feito aqui</a> .  A vers√£o atual √© Buster. <br><br>  Selecione Imagem M√≠nima Baseada no Debian Buster. <br><br><img src="https://habrastorage.org/webt/iy/eb/jv/iyebjvlxbebhaqflevjeihob5fa.png"><br><br>  Fa√ßa o download do arquivo ZIP a partir do qual o √∫nico arquivo .img ser√° obtido. <br><br><img src="https://habrastorage.org/webt/vp/qo/5w/vpqo5wlbndwf9n2ntw5stuylso0.png"><br><br><h4>  1.2 Escreva em um cart√£o flash </h4><br>  <b>a) No Windows</b> <br><br>  Fa√ßa o download do programa <b>Rufus</b> no <a href="https://rufus.ie/" rel="nofollow">site oficial</a> .  Uma vers√£o port√°til √© suficiente. <br><br>  Execute o programa, selecione o cart√£o SD e a imagem retirada do arquivo no par√°grafo 1.1. <br><br><img src="https://habrastorage.org/webt/yx/9o/3f/yx9o3ftepbvxw5qytwiu5__d_fi.png"><br><br>  Pressione o bot√£o "INICIAR", confirme a destrui√ß√£o dos dados no cart√£o SD, aguarde a conclus√£o do processo (cerca de 5 minutos). <br><br>  Remova com seguran√ßa o cart√£o. <br><br>  <b>b) no Linux</b> <br><br>  Execute o comando: <br><br><pre><code class="plaintext hljs"># dd if=2019-09-26-raspbian-buster-lite.img of=/dev/&lt; SD-&gt; bs=4M</code> </pre> <br>  Aguarde a conclus√£o do processo, retire o cart√£o. <br><br><h4>  1.3 Implantar o sistema no RPI </h4><br>  Reorganizamos o cart√£o no dispositivo de destino.  Conectamos o mini-PC a um monitor, teclado, mouse e aplicamos energia a ele. <br><br>  Depois de algum tempo, sem fazer perguntas adicionais, o mini-PC ser√° reiniciado no sistema rec√©m-implantado e o convidar√° a inserir seu login e senha. <br>  Por padr√£o, este √© <b>pi: raspberry.</b> <br><br><img src="https://habrastorage.org/webt/7p/ej/p6/7pejp6fntkhztb-4tkbhdlcmdq8.jpeg"><br><br><h4>  1.4 Fa√ßa login e altere sua senha </h4><br><pre> <code class="plaintext hljs"># passwd pi</code> </pre> <br>  ou <br><br><pre> <code class="plaintext hljs">$ sudo passwd pi</code> </pre> <br>  (Executei intencionalmente o passwd para o usu√°rio pi como root, para que o Raspbian n√£o nos perturbe os requisitos de seguran√ßa da senha, mas a aceite e a aceite) <br><br>  Voc√™ n√£o pode efetuar login diretamente como root, a menos que defina explicitamente uma senha para ela.  Em geral, isso n√£o √© ruim.  Todos os comandos que devem ser executados sob o superusu√°rio devem ser executados no usu√°rio pi com o comando sudo prefix.  Como no Ubuntu. <br><br>  Por exemplo (uma <b><u>piada famosa, n√£o corra!</u></b> ) <br><br><pre> <code class="plaintext hljs">$ sudo rm -rf --no-preserve-root</code> </pre> <br>  No entanto, como sou patologicamente pregui√ßoso, ent√£o, entrando no Raspbian ou no mesmo Ubuntu, digito: <br><br><pre> <code class="plaintext hljs">$ sudo bash</code> </pre> <br>  E recebo o convite #, j√° com direitos elevados.  Ent√£o eu trabalho. <br>  A rigor, isso n√£o √© bom, mas no est√°gio da configura√ß√£o inicial do sistema economiza muito tempo. <br><br>  A seguir, se os comandos acima forem precedidos por #, eles dever√£o ser executados sob superusu√°rio.  Se com $, ent√£o sob o usu√°rio (geralmente √© indicado acima sob o qual). <br><br><h2>  2. Instalando o software necess√°rio "no m√≠nimo", testando a conex√£o </h2><br><h4>  2.1 Configurar rede </h4><br>  Para fazer isso, execute o utilit√°rio administrativo executando o comando: <br><br><pre> <code class="plaintext hljs"># raspi-config</code> </pre> <br><img src="https://habrastorage.org/webt/cl/ds/fb/cldsfbbpwcg-xln0ezbmc54refm.png"><br><br>  (A navega√ß√£o √© realizada por setas, tabula√ß√£o, Enter - escolha, ESC - retorno) <br>  V√° para <b>Op√ß√µes de rede</b> . <br><br>  Defina o nome do computador (ponto <b>N1 Hostname</b> ), por exemplo, <b>TERM1</b> . <br><br>  Se o computador estiver conectado √† rede com um cabo Ethernet e receber um endere√ßo DHCP, nada mais precisar√° ser feito. <br><br>  Se voc√™ precisar configurar uma rede Wi-Fi, fa√ßa-o (aponte <b>N2 Wi-Fi</b> ).  Escolha o seu pa√≠s.  <b>O nome da rede</b> precisar√° ser digitado manualmente; nenhuma vis√£o geral √© fornecida.  N√≥s especificamos a <b>senha</b> . <br><br>  Ent√£o <b>Concluir -&gt; Concluir</b> . <br><br>  Reinicie a pedido, ou com o comando: <br><br><pre> <code class="plaintext hljs"># reboot</code> </pre> <br>  Ap√≥s fazer o login novamente, verifique se voc√™ tem acesso √† Internet. <br><br><pre> <code class="plaintext hljs"># ping 8.8.8.8</code> </pre> <br><h4>  2.2 Sistema de atualiza√ß√£o </h4><br>  Atualize as informa√ß√µes sobre os pacotes dispon√≠veis. <br><br><pre> <code class="plaintext hljs"># apt-get update</code> </pre> <br>  Agora atualize o sistema (opcional, mas altamente desej√°vel. Pode ser feito mais tarde.) <br><br><pre> <code class="plaintext hljs"># apt-get upgrade</code> </pre> <br>  Esse est√°gio pode levar um longo tempo (eu tenho cerca de 15 minutos), porque o RPi do carregador de inicializa√ß√£o bin√°rio √© atualizado, o que descompacta muitos arquivos pequenos no cart√£o SD. <br><blockquote>  Observe que quase imediatamente ap√≥s a conclus√£o do download e a descompacta√ß√£o come√ßar, algum pacote desagrad√°vel solicitar√° que voc√™ pressione "q", interrompendo o processo.  Voc√™ precisar√° clicar antes de se distrair com outras coisas para esperar. <br></blockquote>  No final da atualiza√ß√£o, voc√™ deve reiniciar <br><br><pre> <code class="plaintext hljs"># reboot</code> </pre><br><h4>  2.3 Instalar o c√≥digo de idioma e o layout russo </h4><br>  Novamente no utilit√°rio administrativo: <br><br><pre> <code class="plaintext hljs"># raspi-config</code> </pre> <br>  Siga as <b>Op√ß√µes de localiza√ß√£o</b> , l√°: <br><br><ol><li>  <b>Altere Locale</b> , remova * do <b>pt-BR.UTF-8</b> e instale o oposto do <b>ru-RU.UTF-8</b> .  Confirmamos e, na pr√≥xima janela, a selecionamos como a principal. </li><li>  <b>Alterar fuso hor√°rio</b> e selecione seu pa√≠s e fuso hor√°rio da cidade. </li><li>  <b>Alterar layout do teclado</b> , <b>PC gen√©rico de 105 teclas (Intl)</b> ‚Üí <b>Outro</b> ‚Üí <b>Russo</b> ‚Üí <b>Russo</b> ‚Üí <b>Control + Shift</b> (ou Alt + Shift, se desejado, para alternar layouts) ‚Üí <b>Sem alternador tempor√°rio</b> ‚Üí <b>Alt direito (AltGr)</b> ‚Üí <b>Nenhuma tecla de composi√ß√£o</b> . </li></ol><br>  Confirme e saia - <b>Concluir</b> ‚Üí <b>Concluir</b> . <br><br>  Deixamos o utilit√°rio de administra√ß√£o, execute o comando: <br><br><pre> <code class="plaintext hljs"># dpkg-reconfigure console-setup</code> </pre> <br>  selecione <b>UTF-8</b> ‚Üí <b>Adivinhe o conjunto de caracteres ideal</b> ‚Üí <b>Deixe o sistema selecionar ...</b> (abaixo) ‚Üí <b>8x16</b> . <br><br>  As fontes devem ficar visualmente mais finas, mas o principal √© que agora elas suportam o alfabeto cir√≠lico. <br><br>  Reinicializamos, efetuamos login, testamos o layout em ingl√™s, a altern√¢ncia e o layout em russo. <br><br><h4>  2.4 Determinado com software auxiliar e editor </h4><br>  Para trabalhar com arquivos, navegar na estrutura de pastas e editar arquivos, eu realmente gosto do <b>Midnight Commander</b> , portanto: <br><br><pre> <code class="plaintext hljs"># apt-get install mc</code> </pre><br>  Eu o inicio com direitos de root e, na primeira vez em que uso o editor (tecla F4 em algum arquivo), seleciono <b>mcedit</b> (ponto 2). <br><br>  Obviamente, voc√™ pode editar arquivos usando as ferramentas de sua escolha.  Por exemplo, usando nano ou mesmo VIM. <br><br><h4>  2.5 Instalar o servidor ssh </h4><br><pre> <code class="plaintext hljs"># apt-get install ssh</code> </pre> <br>  Editando / etc / ssh / sshd_config.  Remova o coment√°rio da linha: <br><br><pre> <code class="plaintext hljs">ListenAddress 0.0.0.0</code> </pre> <br>  Desbloquear carregamento autom√°tico <br><br><pre> <code class="plaintext hljs"># systemctl enable ssh.service</code> </pre> <br>  Reinicie o servi√ßo <br><br><pre> <code class="plaintext hljs"># systemctl restart ssh.service</code> </pre> <br>  Descobrimos o endere√ßo IP com o comando <br><br><pre> <code class="plaintext hljs"># ifconfig</code> </pre> <br>  E agora podemos conectar-se ao dispositivo remotamente a partir do computador de origem via SSH (no Windows, eu pessoalmente gosto do cliente <b>PuTTY</b> SSH) para configurar a partir de uma esta√ß√£o de trabalho conveniente e poder copiar e colar os textos deste artigo nas configura√ß√µes.  Lembro que o login √© <b>pi</b> , n√£o raiz. <br><br><img src="https://habrastorage.org/webt/n7/rf/dp/n7rfdpupnveaxml-qs16hyjmmnw.png"><br><br>  Outras a√ß√µes eu recomendaria fazer exatamente atrav√©s do SSH, a menos que indicado de outra forma. <br><br><h4>  2.6 Mova parti√ß√µes vol√°teis para discos virtuais </h4><br>  Por exemplo, <b>/ tmp</b> e <b>/ var / log</b> , para: <br><br><ol><li>  o sistema n√£o apontou um cart√£o SD, </li><li>  havia menos chance de o sistema de arquivos raiz desmoronar durante uma queda de energia, </li><li>  para que, em um futuro distante, os logs n√£o obstruam o espa√ßo livre no mapa. </li></ol><br>  Para fazer isso, adicione linhas ao <b>/ etc / fstab</b> : <br><br><pre> <code class="plaintext hljs">tmpfs /var/log tmpfs defaults,noatime,nosuid,mode=0755,size=100m 0 0 tmpfs /tmp tmpfs defaults,noatime,nosuid,size=100m 0 0</code> </pre><br>  N√£o se esque√ßa de colocar uma quebra de linha no final do arquivo. <br><br>  Aqui, as se√ß√µes <b>/ var / log</b> e <b>/ tmp</b> recebem 100 MB de mem√≥ria cada (ela ser√° usada apenas quando estiver cheia).  Gigabyte Pi, usado apenas para RDP, essas despesas n√£o atrapalham nada. <br><br>  Reinicie o sistema e execute o comando: <br><br><pre> <code class="plaintext hljs"># df</code> </pre> <br>  e verifique se as parti√ß√µes est√£o montadas no tmpfs (as colunas 3 e 4 podem ser diferentes): <br><br><pre> <code class="plaintext hljs">tmpfs 102400 8 102392 1% /tmp tmpfs 102400 224 102176 1% /var/log</code> </pre><br><h4>  2.7 Obteremos o usu√°rio sob o qual, posteriormente, iniciaremos automaticamente o shell gr√°fico </h4><br>  Execute o comando: <br><br><pre> <code class="plaintext hljs"># adduser user</code> </pre> <br>  Defina uma senha arbitr√°ria.  Todos os tipos de nomes e telefones podem ser ignorados.  Confirme. <br><br><h4>  2.8 Instalar o servidor X em uma vers√£o m√≠nima </h4><br>  Execute o comando: <br><br><pre> <code class="plaintext hljs"># apt-get install xserver-xorg xinit xterm x11-xserver-utils</code> </pre> <br>  Isso pode levar cerca de 5 minutos. <br><br>  Agora voc√™ precisa <u>se sentar no terminal f√≠sico</u> (no sentido de um monitor, teclado e mouse conectado diretamente ao Pi), fa√ßa login como usu√°rio e execute o comando: <br><br><pre> <code class="plaintext hljs">$ startx</code> </pre> <br>  A imagem a seguir deve aparecer na tela, o que significa que o x-server foi instalado com sucesso e voc√™ pode seguir em frente. <br><br><img src="https://habrastorage.org/webt/c1/na/qb/c1naqbmygzqagi02s3dm5exinn0.png"><br><br>  Passamos o mouse sobre o cursor (√© importante, pois n√£o h√° janela formando um quadro e um t√≠tulo, e a janela simplesmente n√£o recebe texto sem um foco expl√≠cito) e digita <br><br><pre> <code class="plaintext hljs">$ exit</code> </pre> <br>  voltar. <br><br><h4>  2.9 Instalar software para trabalhar com a √°rea de trabalho remota </h4><br>  Eu pessoalmente gosto do <b>rdesktop</b> .  Obviamente, n√£o √© sem nuances (consulte a se√ß√£o "Extra√ß√£o de rake").  Existem alternativas como <b>xfreerdp</b> , <b>remmina</b> , etc., embora elas tamb√©m se queixem. <br><br>  Vou dar um exemplo para o primeiro. <br><br><pre> <code class="plaintext hljs"># apt-get install rdesktop</code> </pre> <br>  Crie um script que execute o rdesktop em tela cheia.  No diret√≥rio <b>/ home / user,</b> crie o arquivo <b>runrdp</b> (de prefer√™ncia como usu√°rio): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash rdesktop &lt;  IP  &gt; -u &lt;   &gt; -f -z</span></span></code> </pre><br>  Se voc√™ escolheu outro cliente RDP, escreva aqui a linha de comando ou use a massa de par√¢metros adicionais que o rdesktop possui.  Voc√™ pode at√© codificar a senha para fazer login automaticamente. <br><br>  Voc√™ deve colocar os direitos para executar neste script e, se voc√™ o criou como root, o propriet√°rio √© o usu√°rio. <br><br><pre> <code class="plaintext hljs"># chmod 755 /home/user/runrdp # chown user:user /home/user/runrdp</code> </pre><br>  Agora, vamos ao console f√≠sico em user, start startx, no terminal gr√°fico aberto (veja a figura acima), digite: <br><br><pre> <code class="plaintext hljs">$ ./runrdp</code> </pre> <br>  A janela para conectar-se √† √°rea de trabalho remota deve aparecer na tela. <br><br><img src="https://habrastorage.org/webt/av/mt/y8/avmty8dt4vclbpt5yrkw-3mmmlc.png"><br><br>  Se: <br><br>  a) o console exibe algo sobre o erro CredSSP, <br>  b) o modo de tela cheia no FullHD deixa bordas escuras (como na foto 4 da foto neste artigo, embora exista um modo de console, mas voc√™ pode ver as bordas) <br>  depois veja a se√ß√£o Extra√ß√£o de Rake. <br><br>  E se estiver tudo bem, cancele o login do sistema (Esc ou o item de menu ‚ÄúDesativar‚Äù), saia para o terminal x, digite exit, retorne ao console. <br><br><h2>  3. Automa√ß√£o de sess√µes de eleva√ß√£o </h2><br>  Se todas as etapas anteriores funcionarem, √© hora de juntar tudo. <br><br>  Para fazer isso, faremos com que, quando o sistema for iniciado, o usu√°rio efetue login automaticamente no terminal, inicie o servidor X e se conecte ao RDP sob ele.  Assim, a senha ser√° solicitada apenas para a sess√£o RDP, o que salvar√° as mentes imaturas do usu√°rio de habilidades desnecess√°rias para domesticar o Linux. <br><br><h4>  3.1 RDP infinito </h4><br>  Vamos criar um script que, ao iniciar o x-server, tentaria infinitamente abrir uma sess√£o RDP. <br>  Para fazer isso, no diret√≥rio <b>/ home / user,</b> crie um arquivo de execu√ß√£o autom√°tica no in√≠cio da sess√£o X <b>.xinitrc</b> , o seguinte conte√∫do: <br><pre> <code class="bash hljs">setxkbmap -option terminate:ctrl_alt_bksp <span class="hljs-comment"><span class="hljs-comment">#    Ctrl-Alt-BkSpace setterm -blank 0 -cursor off #   xsetroot -solid gray #      while /bin/true; do ./runrdp done</span></span></code> </pre> <br><h4>  3.2 Servidor X infinito </h4><br>  Corrigimos um script que define a inicializa√ß√£o autom√°tica de programas e configura√ß√µes de perfil durante o login no console para que a sess√£o x seja iniciada automaticamente, mas somente quando o usu√°rio fizer login no 1¬∫ terminal. <br><br><blockquote>  Obrigado ao <a href="https://habr.com/ru/users/gecube/">gecube</a> por me lembrar de desativar o protetor de tela.  Por padr√£o, √© uma tela preta que, para a maioria dos monitores modernos, √© bastante prejudicial. </blockquote><br><br>  <b>Vamos editar /home/user/.profile</b> , <u><b>adicionando</b></u> as seguintes linhas: <br><br><pre> <code class="bash hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DISPLAY</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; [ $(tty) = <span class="hljs-string"><span class="hljs-string">"/dev/tty1"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> startx clear <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" 5    "</span></span> sleep 5 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br><h4>  3.3 Testando um monte de forma intermedi√°ria </h4><br>  N√≥s reiniciamos o Pi, sentamos no terminal, efetuamos login como usu√°rio.  Aparecemos a janela de in√≠cio da sess√£o na tela, como na figura acima. <br><br>  Tentamos nos recusar a inserir a senha (esc ou depende da vers√£o do Windows) - obtemos a mesma janela para o in√≠cio da sess√£o (ou seja, nosso script da 3.1 √© constantemente reconectado). <br><br>  Esperamos cerca de um minuto (dependendo do servidor) sem tocar no teclado e no mouse - a janela para iniciar a sess√£o deve se desligar em breve (a sess√£o RDP no est√°gio de entrada de senha sem atividade expira em um tempo limite).  Obviamente, devido √† cl√°usula 3.1, ser√° reconectado. <br><br>  Agora pressione <b>Ctrl + Alt + BkSp</b> .  A sess√£o X deve ser interrompida, uma inscri√ß√£o sobre a espera de 5 segundos ser√° exibida, ap√≥s o que a sess√£o do console tamb√©m ser√° encerrada.  A tela solicitar√° que voc√™ entre no terminal com um nome de usu√°rio e senha. <br><br>  Se tudo √© t√£o - excelente. <br><br>  N√≥s s√≥ precisamos de login autom√°tico no terminal. <br><br><h4>  3.4 Autologin de repeti√ß√£o infinitamente <s>delicioso em laranja em</s> tty1 </h4><br>  Para fazer isso, a partir da raiz, crie o arquivo <b>/etc/systemd/system/getty@tty1.service.d/autologin.conf</b> com o seguinte conte√∫do: <br><br><pre> <code class="plaintext hljs">[Service] ExecStart= ExecStart=-/sbin/agetty --autologin user --noclear %I 38400 linux</code> </pre><br>  Ent√£o: <br><br><pre> <code class="plaintext hljs">#systemctl enable getty@tty1.service</code> </pre> <br>  N√≥s reinicializamos, certifique-se de que o console f√≠sico seja logado automaticamente como usu√°rio, o servidor X inicie e a sess√£o RDP seja aberta e tudo esteja como no 3.3. <br>  Pressione Ctrl + Alt + BkSp, aguarde a reconex√£o. <br><br>  Entramos no sistema, teste de comuta√ß√£o, o trabalho de layouts.  Se algo estiver errado, consulte a se√ß√£o 4. <br><br>  <b>Isso completa a instala√ß√£o.</b> <br><br>  Os usu√°rios devem ser instru√≠dos que, se algo der errado (a tela fica em branco, algo congela etc.), eles primeiro pressionam Ctrl + Alt + BkSp e aguardam a rea√ß√£o. <br><br>  Consulte tamb√©m a se√ß√£o 5 sobre montagem autom√°tica em USB. <br><br><h2>  4. Extra√ß√£o de rake </h2><br>  Como esse √© um c√≥digo aberto, a extra√ß√£o de rake √© um processo desesperado e cont√≠nuo.  Vou tentar descrever o principal rake poss√≠vel, mas quem sabe o que nos espera.  Pessoalmente, nunca tive sorte e nem uma √∫nica instru√ß√£o funcionou para mim sem horas de pesquisa adicional. <br><br><h4>  4.1 Problemas com o uso incompleto da resolu√ß√£o da tela </h4><br>  Sintomas: Em alguns equipamentos (adaptadores HDMI-DSUB, alguns monitores), o raspbian n√£o usa toda a resolu√ß√£o dispon√≠vel do monitor Full-HD.  Os campos escuros permanecem entre as informa√ß√µes relevantes e a borda f√≠sica da tela. <br><br>  √â resolvido da seguinte forma: <br><br>  Edite <b>/boot/config.txt</b> , encontre a linha <br><br><pre> <code class="plaintext hljs"># disable_overscan = 1</code> </pre> <br>  e descomente. <br><br>  Reinicie. <br><br>  Agora os campos escuros das bordas da tela devem ser removidos nos modos console e gr√°fico. <br><br><h4>  4.2 Problemas com o cursor do mouse ao conectar o rdesktop aos servidores RDP modernos </h4><br>  Isso se refere principalmente ao Windows 2012, 2016 e Windows 10, onde o tema do cursor est√° inclu√≠do. <br><br>  Sintomas: o cursor desaparece, √© mal desenhado, depois de mudar para fora do padr√£o (ampulheta, s√≠mbolo I, setas para janelas, etc.) esquece de mudar para uma seta comum. <br><br>  Solu√ß√£o: como usu√°rio do servidor ao qual voc√™ est√° se conectando, acesse as propriedades do mouse atrav√©s do painel de controle, redefina o tema para "N√£o" e desative as sombras sob o ponteiro. <br><br><img src="https://habrastorage.org/webt/ek/na/rc/eknarc92omul5c37i4ta4lfenmc.png"><br><br>  Os cursores devem chegar √† obedi√™ncia. <br><br><h4>  4.3  Problemas de codifica√ß√£o com o rdesktop </h4><br>  Sintomas: em alguns casos, pela conex√£o RDP, os caracteres especiais s√£o digitados incorretamente no sistema remoto: til, barras, aspas, pontos, paus verticais.  Especialmente comece a enfurecer os pontos, porque eles geralmente s√£o digitados. <br><br>  Solu√ß√£o: <br><br>  Em <b>/ usr / share / rdesktop / keymaps,</b> crie um arquivo <b>bruto</b> e preencha-o com o seguinte conte√∫do: <br><br><pre> <code class="plaintext hljs">include common map 0x419 grave 0x29 asciicircum 0x07 shift backslash 0x2b bar 0x2b shift apostrophe 0x28 greater 0x34 shift less 0x33 shift</code> </pre><br>  Adicione o argumento <b>-k raw</b> ao prompt de comando rdesktop no script <b>/ home / user / runrdp</b> .  Por exemplo: <br><br><pre> <code class="bash hljs">rdesktop 10.0.0.1 -u user -k raw</code> </pre> <br>  Reinicie a sess√£o no terminal com Ctrl + Alt + BkSp ou geralmente reinicie o Pi. <br><br>  Digite RDP, teste todos os caracteres especiais, incluindo  com Shift na linha num√©rica do teclado e as teclas laterais √† esquerda e √† direita da se√ß√£o de letras, com Shift e sem (aspas, dois pontos, sinais de pontua√ß√£o, paus, etc.).  Tudo deve funcionar. <br><br><h4>  4.4  Quando voc√™ tenta iniciar o rdesktop, a sess√£o n√£o abre, o erro CredSSP √© exibido no console </h4><br><pre> <code class="bash hljs">CredSSP: Initialize failed, <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> you have correct kerberos tgt initialized ? Failed to connect, CredSSP required by server.</code> </pre><br>  O sistema de destino requer um algoritmo de autentica√ß√£o de cliente moderno, o que o rdesktop normalmente n√£o pode fazer. <br><br>  Op√ß√µes da solu√ß√£o: <br><br><ol><li>  Desative a autentica√ß√£o do servidor reduzindo as configura√ß√µes de seguran√ßa.  Basicamente, em ambientes em que o Pi est√° tentando usar o RDP como um cliente, isso n√£o deve ser um problema de seguran√ßa. </li><li>  Use outro cliente, por exemplo, freerdp, remmina, substituindo o conte√∫do do script runrdp pela linha de inicializa√ß√£o desse cliente. </li><li>  Instale e configure o cliente kerberos, mas de alguma forma tudo √© complicado l√°.  Se voc√™ quiser tentar, <a href="https://github.com/rdesktop/rdesktop/issues/71" rel="nofollow">comece aqui</a> . </li></ol><br><h4>  4.5  Ligar e desligar o dispositivo </h4><br>  O Raspberry Pi n√£o possui um bot√£o de desligamento.  Isso √© ruim.  Acontece que n√£o h√° maneira eficaz de ligar e desligar.  Muito foi escrito sobre isso, tentarei resumir brevemente: <br><br><ol><li>  Por um lado, n√£o podemos desligar o dispositivo, desligando apenas o monitor.  A rigor, onde coloco o RPi, tudo est√° feito.  Em geral, o dispositivo quase n√£o esquenta, n√£o consome eletricidade, n√£o produz ru√≠do.  O monitor, antes de sair, o usu√°rio ser√° desligado. </li><li>  Voc√™ pode configurar a noite de folga com Cron, mas, para ligar o RPi pela manh√£, o usu√°rio precisar√° manipular o fio ou a fonte de alimenta√ß√£o. </li><li>  Voc√™ pode solucionar esse problema comprando um cabo de alimenta√ß√£o USB com um bot√£o aberto (para ligar o RPi, basta abrir o circuito brevemente com um bot√£o).  120 rublos √© tudo um prazer.  Mas aqui, os usu√°rios ter√£o o desligamento autom√°tico funcionando da mesma maneira que o dispositivo trava.  Dado que transferimos as parti√ß√µes vol√°teis para tmpfs, provavelmente √© improv√°vel que ocorram problemas, mas ainda assim ningu√©m est√° seguro de que o usu√°rio n√£o far√° logon pela manh√£ devido ao colapso do rootfs.  N√£o deu certo, por assim dizer, a solu√ß√£o "pregada". </li><li>  Existem solu√ß√µes com um bot√£o adicional que est√° inclu√≠do na porta GPIO e liga / desliga o dispositivo suavemente (da maneira correta).  Mas fazendas coletivas para o edif√≠cio - √© gastar horas e aumentar os custos de produ√ß√£o. </li><li>  No entanto, para o RPi h√° at√© um caso com um bot√£o embutido (os chineses t√™m tudo).  Mas eu pessoalmente ainda n√£o tentei. </li><li>  Penso em ligar o dispositivo atrav√©s de um disjuntor no cabo USB e deslig√°-lo por uma tecla de atalho (como Ctrl + Alt + Shift + P), que √© monitorada pelo servi√ßo do sistema, mas n√£o √© poss√≠vel trabalhar com esta solu√ß√£o. </li></ol><br><h4>  4.6 M√∫ltiplas reconex√µes com o servidor RDP </h4><br>  No esquema atual, o dispositivo cliente se conectar√° ao servidor usando o protocolo RDP, exibir√° a janela de entrada de login e senha e, se o usu√°rio n√£o inserir nada, depois de algum tempo a sess√£o ser√° redefinida e o cliente RDP ser√° iniciado novamente, e assim por diante ad infinitum. <br><br><blockquote>  Nos coment√°rios, o usu√°rio do <a href="https://habr.com/ru/users/Mnemonik/">Mnemonik</a> <a href="https://habr.com/ru/post/479504/">disse</a> que, com v√°rias reconex√µes permanentes, o Windows Server fica sem mem√≥ria e deu um exemplo de como resolver o problema. <br></blockquote><br>  Eu vou trazer o meu.  Modificaremos o script .xinitrc para que, ap√≥s a conclus√£o do pr√≥ximo processo do rdesktop, uma caixa de di√°logo modal seja exibida na tela, o que impede a reinicializa√ß√£o at√© o clique no bot√£o OK. <br><br>  Para fazer isso, voc√™ pode usar o xmessage regular inclu√≠do no pacote xorg, mas as janelas criadas por ele s√£o t√£o feias que meu monitor est√° quebrando.  Al√©m disso, este aplicativo n√£o √© amig√°vel com o idioma russo e ativ√°-lo √© outra tarefa. <br><br>  Estou impressionado com o gxmessage, desprovido dessa desvantagem, mas ele extrai GTK e 25 megabytes de outras depend√™ncias, das quais eu tamb√©m n√£o gosto.  Bem, vamos escolher um mal menor: <br><pre> <code class="plaintext hljs">apt-get install gxmessage</code> </pre> <br>  Mude o script .xinitrc: <br><pre> <code class="bash hljs">setxkbmap -option terminate:ctrl_alt_bksp <span class="hljs-comment"><span class="hljs-comment">#    Ctrl-Alt-BkSpace setterm -blank 0 -cursor off #   xsetroot -solid gray #      while /bin/true; do ./runrdp gxmessage --center " OK      RDP" done</span></span></code> </pre> <br>  Agora, entre as tentativas do rdesktop de conectar-se ao servidor, uma mensagem correspondente ser√° exibida em nossa tela e n√£o haver√° "bombardeio" constante do servidor. <br><br>  Ap√≥s concluir o script com facilidade, voc√™ pode verificar previamente a disponibilidade de rede do servidor e exibir uma mensagem sobre a reconex√£o devido √† falta de comunica√ß√£o. <br><br><h4>  4.7 Configurando o NTP </h4><br><blockquote>  Agrade√ßo ao <a href="https://habr.com/ru/users/gecube/">gecube</a> por me lembrar desse momento.  Teoricamente, o tempo no dispositivo pode "flutuar" ao longo do tempo, o que pode causar dificuldades na autentica√ß√£o e talvez outros problemas. <br></blockquote>  Para corrigir esse pequeno problema, voc√™ deve instalar o programa ntpdate e registrar no cron uma tarefa para atualizar o hor√°rio a cada hora (o dispositivo precisar√° de acesso √† Internet): <br><br><pre> <code class="plaintext hljs"># apt-get install ntpdate # echo "0 * * * * root ntpdate pool.ntp.org" &gt; /etc/cron.d/ntp</code> </pre><br>  Se voc√™ tiver um servidor NTP local na sua rede, substitua o nome do host pelo seu. <br><h2>  5 Opcional: conectar, desconectar e encaminhar dispositivos USB </h2><br>  Na verdade, esta se√ß√£o inclui dois est√°gios cruciais.  Primeiramente, gerenciar dispositivos USB para garantir sua montagem autom√°tica e, pelo menos, uma desmontagem controlada pelo usu√°rio.  Em segundo lugar, encaminhe os dispositivos conectados ao terminal para que eles possam ser acessados ‚Äã‚Äãpela rede. <br><br><h4>  5.1  Configura√ß√£o de montagem autom√°tica </h4><br>  Os dispositivos USB plug-in com sistemas de arquivos ser√£o montados em subdiret√≥rios do diret√≥rio / media.  Em seguida, encaminharemos o mesmo diret√≥rio para o rdesktop. <br><br>  Vamos precisar do pacote pmount. <br><br><pre> <code class="plaintext hljs"># apt-get install pmount.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m precisaremos criar uma regra para o udev que capture os dispositivos conectados e os monte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/udev/rules.d,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crie o arquivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80-usbstick.rules</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o seguinte conte√∫do:</font></font><br><br><pre> <code class="plaintext hljs">ACTION=="add", KERNEL=="sd[az][0-9]", TAG+="systemd", ENV{SYSTEMD_WANTS}="usbstick-handler@%k"</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora crie um servi√ßo para systemd. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ lib / systemd / system,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crie o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo usbstick-handler @ .service</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o seguinte conte√∫do:</font></font><br><br><pre> <code class="plaintext hljs">[Unit] Description=Mount USB sticks BindsTo=dev-%i.device After=dev-%i.device [Service] Type=oneshot RemainAfterExit=yes ExecStart=/usr/bin/pmount --umask 000 --noatime -w --sync /dev/%i /media/%i ExecStop=/usr/bin/pumount /dev/%i</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / local / bin,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crie o arquivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unmount-devices</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o seguinte conte√∫do:</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash for folder in /media/*; do pumount $folder echo "Unmounted $folder" done</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Atribua a ele os direitos de execu√ß√£o. </font></font><br><br><pre> <code class="plaintext hljs">#chmod 755 unmount-devices</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inclua o usu√°rio usu√°rio no grupo plugdev para que ele possa usar esse script (o pumount permite que os membros deste grupo montem e desmonte dispositivos) </font></font><br><br><pre> <code class="plaintext hljs"># adduser user plugdev</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reinicie. Se tudo for feito corretamente, ao inserir a unidade flash na porta USB do mini-PC, ap√≥s alguns segundos, a pasta sda1 etc. aparecer√° no diret√≥rio / media, onde a unidade flash ser√° montada para leitura e grava√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os dispositivos s√£o montados com o sinalizador ‚Äìsync; portanto, em teoria, se voc√™ retirar o dispositivo quando a opera√ß√£o de grava√ß√£o for conclu√≠da, n√£o haver√° problemas com a seguran√ßa dos dados; no entanto, o sinalizador de extra√ß√£o n√£o seguro permanecer√° no dispositivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testaremos este ponto (insira a unidade flash USB, remova a unidade flash USB, insira o dispositivo no PC com Windows e corrija os poss√≠veis erros). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora insira o dispositivo no Pi novamente, verifique se a pasta / media / sda1 aparece novamente.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execute desmontar dispositivos sob o usu√°rio usu√°rio. </font><font style="vertical-align: inherit;">O sda1 de / media deve desaparecer e o dispositivo deve ser desmontado com seguran√ßa e n√£o cometer um erro quando inserido em um PC com Windows.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5.2 Encaminhe o diret√≥rio / media pelo RDP e forne√ßa dispositivos de montagem autom√°tica </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ home / user / runrdp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , adicionamos um argumento adicional √† linha de comando do rdesktop:</font></font><br><br><pre> <code class="bash hljs">rdesktop ‚Ä¶... -r disk:USB=/media/</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora edite </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/home/user/.profile</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , adicionando uma chamada para desmontar dispositivos.</font></font><br><br><pre> <code class="bash hljs">... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DISPLAY</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; [ $(tty) = <span class="hljs-string"><span class="hljs-string">"/dev/tty1"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> startx clear unmount-devices <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" 5    "</span></span> sleep 5 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reinicie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, se estivermos trabalhando em uma sess√£o RDP e precisarmos conectar um disco USB ao Pi, basta inseri-lo e ir para Meu computador, onde vemos aproximadamente a figura a seguir. </font></font><br><br><img src="https://habrastorage.org/webt/vu/l_/qu/vul_quyi50ig54vjbewcwgpa83w.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Podemos usar livremente esses dispositivos, eles aparecer√£o como pastas (sda1-xx, sdb1-xx, etc.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se precisarmos remover o dispositivo, basta pressionar Ctrl + Alt + BkSp. A sess√£o ser√° desconectada (portanto, qualquer c√≥pia para o dispositivo deve ser interrompida, mesmo que tenha sido realizada), o console exibir√° a desmontagem dos dispositivos (neste momento </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eles foram removidos com seguran√ßa) e uma mensagem aguardando 5 segundos antes de se reconectar ao RDP.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois de reconectar, voc√™ pode digitar uma senha e continuar trabalhando do mesmo ponto, mas os dispositivos conectados anteriormente ser√£o desmontados. </font><font style="vertical-align: inherit;">Nesse ponto, eles podem ser removidos fisicamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso completa a etapa de configura√ß√£o.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Clone o sistema para outro Rpi </font></font></h2><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.A Se configurado independentemente </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se todos os ancinhos forem removidos, o dispositivo funcionar√° aceit√°vel, e voc√™ poder√° estender a montagem para outros dispositivos. </font><font style="vertical-align: inherit;">Se eles s√£o do mesmo tipo, n√£o h√° necessidade de repetir o processo do zero. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insira o cart√£o SD (me deparei com 16 gigabytes) no cart√£o adaptador e coloque-o na porta USB do Raspberry. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ j√° configurou a montagem autom√°tica a partir da √∫ltima se√ß√£o, execute o script</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># unmount-devices</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que ele desmonte o cart√£o SD rec√©m-conectado, que, √© claro, foi imediatamente montado em / media / sdxx. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora execute o comando lsblk e veja a lista de dispositivos:</font></font><br><br><pre> <code class="plaintext hljs">sda 8:0 1 14.6G 0 disk ‚îî‚îÄsda1 8:1 1 14.6G 0 part mmcblk0 179:0 0 7.4G 0 disk ‚îú‚îÄmmcblk0p1 179:1 0 256M 0 part /boot ‚îî‚îÄmmcblk0p2 179:2 0 7.2G 0 part /</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© obviamente a nossa nova placa e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mmcblk0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© uma </font><font style="vertical-align: inherit;">placa do </font><font style="vertical-align: inherit;">sistema. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execute:</font></font><br><br><pre> <code class="plaintext hljs">dd if=/dev/mmcblk0 of=/dev/sda bs=4M</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e aguarde o resultado esperado em cerca de meia hora (para um cart√£o de 8 GB). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois disso, insira outro Raspberry, altere o nome do host, o nome de usu√°rio no script runrdp e repita conforme necess√°rio.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.B Fa√ßa o download da imagem final </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se, √© claro, voc√™ confia em mim, pode usar a imagem preparada por mim reconfigurando-a levemente. Quaisquer favoritos, ferramentas de telemetria etc. - N√£o adicionei, n√£o √© o Windows 10, mas n√£o sou a Microsoft e tamb√©m n√£o acredito na perspectiva econ√¥mica de minera√ß√£o oculta de bitcoins no RPi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A imagem foi compilada de acordo com as instru√ß√µes e compactada para uso em um cart√£o SD com um tamanho m√≠nimo de 2 GB chineses (desonestos) (1977614336 bytes). Al√©m disso, a parte preenchida da imagem geralmente ocupa os primeiros 1966080000 bytes, que devem caber mesmo no cart√£o SD mais chin√™s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para fazer isso: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Fa√ßa o download do arquivo </font><font style="vertical-align: inherit;">morto </font></font><a href="https://dropmefiles.com/ljUGS" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (MD5: 0B5033A9CA12BA8299340BC482111998) e descompacte o arquivo de imagem.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Copie-o para o cart√£o SD, utilizando, por analogia, as instru√ß√µes do par√°grafo 1.2. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Inicialize o sistema, aguarde a tela gr√°fica aparecer e pressione Ctrl + Alt + F2 para acessar o console. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Efetue login como usu√°rio pi, senha 111. Execute:</font></font><br><br><pre> <code class="plaintext hljs">$ sudo bash</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Siga as etapas 1.4, 2.1, verifique se a Internet funciona (comando ping, por exemplo). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5) Execute raspi-config, v√° para Advanced Options, selecione Expand Filesystem (para expandir a imagem do sistema para todo o espa√ßo dispon√≠vel no cart√£o SD) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6) Edit / home / user / runrdp, substituindo o nome do host do servidor pelo nome ou IP- o endere√ßo do seu servidor e o nome de usu√°rio "usu√°rio" para o nome do usu√°rio sob o qual o operador deve se conectar ao servidor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7) Reinicie novamente e verifique a opera√ß√£o.</font></font><br><br><h2>  Conclus√£o </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S√≥ isso, obrigado pela aten√ß√£o. </font><font style="vertical-align: inherit;">Espero que esta informa√ß√£o seja √∫til para algu√©m. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infelizmente, cobrir tudo em um artigo √© extremamente dif√≠cil. </font><font style="vertical-align: inherit;">Se houver um feedback positivo, escreverei como √© conveniente encaminhar as impressoras a partir desta montagem. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS 12/11/2019. </font><font style="vertical-align: inherit;">Obrigado aos colegas (gecube, Mnemonik, mkovalevskyi, SannX) pelas dicas e edi√ß√µes. </font><font style="vertical-align: inherit;">Altera√ß√µes feitas:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicionado um comando de prote√ß√£o de tela de desligamento; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configura√ß√£o NTP adicionada; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre o consumo de mem√≥ria no servidor com v√°rias conex√µes incompletas de clientes RDP - adicionou uma caixa de mensagens ao script com uma pausa. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, acabei de testar um cart√£o retirado do RPi3, inserindo-o no RPi4 Modelo B 1Gb rec√©m-descompactado. </font><font style="vertical-align: inherit;">Tudo funciona muito bem sem corre√ß√µes. </font><font style="vertical-align: inherit;">Por conseguinte, esta instru√ß√£o tamb√©m √© adequada para RPi 4 e pode ser adequada para outras modifica√ß√µes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para tanta alegria, adicionei uma imagem para download (consulte a se√ß√£o 6.B), que voc√™ pode baixar e clonar sem seguir todas as instru√ß√µes.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479504/">https://habr.com/ru/post/pt479504/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479488/index.html">De um laptop - um servidor dom√©stico com energia redundante ao roteador Mikrotik</a></li>
<li><a href="../pt479492/index.html">Computa√ß√£o sem servidor baseada no OpenWhisk, parte 3</a></li>
<li><a href="../pt479496/index.html">Analisando tarefas WTF em JavaScript</a></li>
<li><a href="../pt479498/index.html">Como o tempo linear se transforma no Windows em O (n¬≤)</a></li>
<li><a href="../pt479502/index.html">Como sobreviver √† era glacial mais severa da hist√≥ria da Terra?</a></li>
<li><a href="../pt479508/index.html">Antipadr√µes do PostgreSQL: JOINs e ORs prejudiciais</a></li>
<li><a href="../pt479510/index.html">Revis√£o do PocketBook X - um enorme leitor de 10,3 polegadas com uma tela E Ink Carta Mobius e uma caixa de metal</a></li>
<li><a href="../pt479512/index.html">MVCC no PostgreSQL-4. Instant√¢neos</a></li>
<li><a href="../pt479514/index.html">Privacidade por design e privacidade por padr√£o (prote√ß√£o de dados projetada e privacidade padr√£o pelo GDPR)</a></li>
<li><a href="../pt479516/index.html">O que √© entropia no software e como gerenci√°-lo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>