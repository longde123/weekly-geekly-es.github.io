<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌛 👩🏻‍💻 👨🏼‍✈️ Anwendung für ein Framework für einen Multi-Plattform-Bot 👩🏼‍🔧 🦓 🙅🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chatbots sind eng in unser Informationsleben eingedrungen. Alle sich selbst respektierenden sozialen Netzwerke und Instant Messenger unterstützen Bots...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Anwendung für ein Framework für einen Multi-Plattform-Bot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422081/"><img src="https://habrastorage.org/getpro/habr/post_images/10c/297/311/10c2973112bf3e696147b9c86d6d333e.jpg" alt="Bild"><br><br>  Chatbots sind eng in unser Informationsleben eingedrungen. Alle sich selbst respektierenden sozialen Netzwerke und Instant Messenger unterstützen Bots. Sie bieten eine praktische API für ihre Entwicklung und Verwendung, alles für Benutzer und Programmierer.  Um einen Bot in Telegram zu erstellen, müssen Sie nicht einmal eine Programmiersprache kennen.  Es gibt Dienste, mit denen Sie einen Bot über die Weboberfläche entwerfen können.  Und das ist wirklich gut, aber erst kürzlich bin ich auf ein Problem gestoßen und war überrascht, dass es bei dieser Welle der Popularität von Chatbots, die jetzt nicht nur eine coole Funktion, sondern auch ein einkommensschaffendes Werkzeug sind, praktisch keine Antwort gibt. <br><br>  Und die Frage ist: Was ist, wenn ich mehr als einen Bot für einen Dienst erstellen möchte?  Ich weiß zum Beispiel, dass CA in Vkontakte und Telegram sitzt. Wie kann ich mit minimalem Aufwand Bots schreiben, um dort und dort mit Leuten zu arbeiten?  Wenn ich plötzlich (zum Beispiel als Besitzer eines Online-Shops) auch mit dem Publikum auf Facebook über Bots arbeiten möchte, muss ich wirklich einen neuen Bot von Grund auf neu entwickeln und die gesamte Logik dafür neu schreiben oder versuchen, in eine neue API oder Bibliothek einzutauchen.  Und ich habe versucht, die Antwort unter dem Schnitt zu finden, ich frage an den Tisch. <br><a name="habracut"></a><br>  Tatsächlich gibt es Lösungen, und es gibt viele, aber alle laufen darauf hinaus, dass Sie Ihren Bot mit einem Dienst hosten müssen, der auch eine Plattform bietet.  Das heißt, Sie können keine Box-Lösung erhalten.  Vielleicht irre ich mich und habe nicht vollständig untersucht, was tatsächlich existiert, aber die Tatsache, dass der erste Link in Google nicht zu einer Lösung führt, ist bereits alarmierend.  Es gibt auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Botman</a> .  Dies ist eine wirklich leistungsstarke, vollwertige Open-Source-Entwicklungsbibliothek mit einer Reihe von Chips und umfassender Dokumentation.  Und es ist in <i>PHP geschrieben.</i>  Ich habe nichts gegen <i>PHP</i> , auf jeden Fall gebe ich es nicht öffentlich zu, um keinen unnötigen Holivar zu züchten, aber ich habe keine Lust, es zu entwickeln.  Ich habe mich entschlossen, nach etwas ähnlichem wie Python zu suchen. Zusätzlich zu Python gibt es viele Bibliotheken, mit denen Sie mit der Telegramm-Bot-API arbeiten können.  Und ich fand nichts, so dass ich bald zu dem Schluss kam, dass es sich lohnt, selbst zu schreiben.  <i>(Vielleicht kennt jemand die geeigneten Lösungen für Multi-Plattform-Bots mit einem offenen System, ich freue mich über jede Information)</i> <br><br>  Hier braut sich übrigens ein weiteres Problem zusammen.  Ich habe absolut keine Ahnung, wo Sie die Arbeit in Form eines anderen Artikels als über Habré mit dem Publikum teilen können.  Ich werde sehr gerne in dieser Angelegenheit helfen. <br><br>  Der Name <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Botovod</a> kam von selbst. <br><br>  Im Allgemeinen werde ich mit Botovod einen kleinen Code geben und ihn kurz erklären. <br><div class="spoiler">  <b class="spoiler_title">Spoiler Überschrift</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> botovod <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Botovod, Message, utils @utils.convert_to_text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, text)</span></span></span><span class="hljs-function">:</span></span> message = Message() message.text = <span class="hljs-string"><span class="hljs-string">"  "</span></span> agent.send_message(chat, message) @utils.convert_to_images <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, images)</span></span></span><span class="hljs-function">:</span></span> message = Message() message.text = <span class="hljs-string"><span class="hljs-string">"  "</span></span> agent.send_message(chat, message) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_echo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, message)</span></span></span><span class="hljs-function">:</span></span> agent.send_message(chat, message) settings = [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"telegram"</span></span>, <span class="hljs-string"><span class="hljs-string">"agent"</span></span>: <span class="hljs-string"><span class="hljs-string">"botovod.agents.telegram"</span></span>, <span class="hljs-string"><span class="hljs-string">"settings"</span></span>: {<span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"462755273:AzBZBQ7AAnqFEXqZ_P8Z-qvCddmjqTVAYPI"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"polling"</span></span>} }, ] botovod = Botovod(settings) botovod.add_handler(handler_message) botovod.add_handler(handler_images) botovod.add_handler(handler_echo) botovod.start()</code> </pre> <br></div></div><br><br>  Hier definieren wir 3 Handler für eingehende Nachrichten, von denen jeder eine Antwort sendet.  Das erste: "Ich habe eine Nachricht erhalten", das zweite: "Ich sehe ein Foto", das dritte sendet einfach zurück, was ich erhalten habe.  Dann erstellen wir einen Bot-Manager (Botovod) und übergeben ihm die Einstellungen für die Bots, in diesem für den Bot in Telegram.  Als Nächstes fügen wir nacheinander Nachrichtenhandler hinzu.  Wenn eine Nachricht beim Bot eintrifft, geht sie an den ersten Handler, der sich bereit erklärt, sie zu akzeptieren.  Wenn beispielsweise ein Audio an uns gesendet wurde, versucht der erste Handler, es zuerst zu akzeptieren, lehnt es jedoch ab, da dies kein Text ist.  Dann wird er das zweite akzeptieren, aber auch ablehnen, da dies kein Bild ist, dann wird er das dritte akzeptieren, das keine Einschränkungen hat - auf diese Weise wird das Audio-Ortho weitergeleitet  Einschränkungen werden als Dekoratoren aus dem Utils-Modul auferlegt. <br><br>  Jetzt werde ich versuchen, im Detail zu sagen, was was ist: <br><br>  Es gibt einen Bot-Manager - ein Objekt der Botovod-Klasse - den Namen des Bots (jeder hat seine eigene eindeutige), die Agentenklasse, die ihn verarbeitet, und die Einstellungen für den Bot werden im Konstruktor an ihn übergeben.  Außerdem werden dem Bot-Manager nacheinander Handler hinzugefügt.  Wenn eine Nachricht beim Bot eintrifft, überprüft der Manager diese nacheinander, bis er den Handler findet, der die NotPassed-Ausnahme auslöst.  Der erste hinzugefügte Handler wird zuerst überprüft, der letzte bzw. der letzte.  Wenn Sie Webhooks verwenden möchten, kann der Bot-Manager mit dem Webserver verbunden werden.  Zu diesem Zweck verfügt der Bot-Manager über eine Listen-Methode, die den Bot-Namen, die Header und den Anforderungshauptteil akzeptiert.  Anschließend werden diese Daten an den Agentenparser übergeben, der die generierte Nachricht zurückgibt, nachdem diese Nachricht durch die Handler gesendet wurde.  Als Antwort gibt die Listen-Methode das Wörterbuch {"status": any_code, "headers": dict (), "body": "any_text"} zurück, wobei in Headern die Antwortheader und im body der Antworttext sind.  Manchmal erfordert der Messenger / das soziale Netzwerk, dass der Server ein Objekt zurückgibt, daher halte ich dieses Verhalten für praktisch. <br><br>  Ich werde ein Beispiel für den Vkontakte-Bot unter dem Namen "vk-bot" geben, und Botovod wird eine Verbindung zum Django-Server herstellen <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> response = manager.listen(<span class="hljs-string"><span class="hljs-string">"vk-bot"</span></span>, request.headers, request.text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponse(status = response[<span class="hljs-string"><span class="hljs-string">"status"</span></span>], headers = response[<span class="hljs-string"><span class="hljs-string">"headers"</span></span>], response[<span class="hljs-string"><span class="hljs-string">"body"</span></span>])</code> </pre><br><br>  Eine gebildete Nachricht ist ein Objekt der Nachrichtenklasse.  Es enthält die folgenden Felder: Text - Nachrichtentext;  Bilder - eine Liste mit Bildern;  Audios - eine Liste mit Audiodateien;  Videos - eine Liste von Videos;  Dokumente - eine Liste mit Dokumenten;  Orte - eine Liste mit Orten auf der Karte;  raw - der rohe Nachrichtentext oder zusätzliche Informationen dazu (Wörterbuch). <br><br>  Außerdem enthält jede Liste des Nachrichtenobjekts (Bilder, Audios, Videos, Dokumente) spezielle Objekte, deren Klassen vom Anhang geerbt werden.  Die Attachment-Klasse verfügt standardmäßig über die Methoden url und file_path, mit denen Agenten-Parser normalerweise Informationen über die empfangene Datei ablegen.  Die Standortliste enthält Standortobjekte, an deren Konstruktor Sie Längen- und Breitengrad (Längen- und Breitengrad) übergeben müssen. <br><br>  Unten finden Sie ein Beispiel für die Erstellung von Nachrichten in Handlern <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, message)</span></span></span><span class="hljs-function">:</span></span> out = botovod.Message() image = botovod.Image() image.file_path = <span class="hljs-string"><span class="hljs-string">"/tmp/1.png"</span></span> location = botovod.Location() out.images.append(image) out.text = <span class="hljs-string"><span class="hljs-string">" ,   "</span></span> agent.send_message(chat, out)</code> </pre><br><br>  Das ist alles, was im Moment drin ist, aber ich hoffe, dass jemand an einer solchen Lösung interessiert ist und jemand mit Ratschlägen, Kommentaren, Ideen und vielleicht seiner eigenen Beteiligung an der Entwicklung helfen möchte.  Vielen Dank fürs Lesen! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github Link</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de422081/">https://habr.com/ru/post/de422081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422069/index.html">PHP Digest Nr. 138 (20. August - 2. September 2018)</a></li>
<li><a href="../de422071/index.html">Genug für alle oder wie man das Internet in Entwicklungsländer liefert</a></li>
<li><a href="../de422073/index.html">Der einfachste Weg, die Integration eines Java-Clients in einen Java-Server zu unterstützen</a></li>
<li><a href="../de422077/index.html">Ist die JavaScript-Injektion relevant?</a></li>
<li><a href="../de422079/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends für die letzte Woche Nr. 329 (27. August - 2. September 2018)</a></li>
<li><a href="../de422083/index.html">Einseitige Site auf Kotlin und SpringBoot ohne Verwendung von JSP</a></li>
<li><a href="../de422085/index.html">Nach Auswahl sortieren</a></li>
<li><a href="../de422087/index.html">Computer Vision in der Industrie. Vortrag in Yandex</a></li>
<li><a href="../de422089/index.html">JavaScript-Ausführungskontext und Aufrufstapel</a></li>
<li><a href="../de422091/index.html">Effektive Verwendung von Array-Methoden in JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>