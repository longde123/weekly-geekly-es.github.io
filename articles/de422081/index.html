<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåõ üë©üèª‚Äçüíª üë®üèº‚Äç‚úàÔ∏è Anwendung f√ºr ein Framework f√ºr einen Multi-Plattform-Bot üë©üèº‚Äçüîß ü¶ì üôÖüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chatbots sind eng in unser Informationsleben eingedrungen. Alle sich selbst respektierenden sozialen Netzwerke und Instant Messenger unterst√ºtzen Bots...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Anwendung f√ºr ein Framework f√ºr einen Multi-Plattform-Bot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422081/"><img src="https://habrastorage.org/getpro/habr/post_images/10c/297/311/10c2973112bf3e696147b9c86d6d333e.jpg" alt="Bild"><br><br>  Chatbots sind eng in unser Informationsleben eingedrungen. Alle sich selbst respektierenden sozialen Netzwerke und Instant Messenger unterst√ºtzen Bots. Sie bieten eine praktische API f√ºr ihre Entwicklung und Verwendung, alles f√ºr Benutzer und Programmierer.  Um einen Bot in Telegram zu erstellen, m√ºssen Sie nicht einmal eine Programmiersprache kennen.  Es gibt Dienste, mit denen Sie einen Bot √ºber die Weboberfl√§che entwerfen k√∂nnen.  Und das ist wirklich gut, aber erst k√ºrzlich bin ich auf ein Problem gesto√üen und war √ºberrascht, dass es bei dieser Welle der Popularit√§t von Chatbots, die jetzt nicht nur eine coole Funktion, sondern auch ein einkommensschaffendes Werkzeug sind, praktisch keine Antwort gibt. <br><br>  Und die Frage ist: Was ist, wenn ich mehr als einen Bot f√ºr einen Dienst erstellen m√∂chte?  Ich wei√ü zum Beispiel, dass CA in Vkontakte und Telegram sitzt. Wie kann ich mit minimalem Aufwand Bots schreiben, um dort und dort mit Leuten zu arbeiten?  Wenn ich pl√∂tzlich (zum Beispiel als Besitzer eines Online-Shops) auch mit dem Publikum auf Facebook √ºber Bots arbeiten m√∂chte, muss ich wirklich einen neuen Bot von Grund auf neu entwickeln und die gesamte Logik daf√ºr neu schreiben oder versuchen, in eine neue API oder Bibliothek einzutauchen.  Und ich habe versucht, die Antwort unter dem Schnitt zu finden, ich frage an den Tisch. <br><a name="habracut"></a><br>  Tats√§chlich gibt es L√∂sungen, und es gibt viele, aber alle laufen darauf hinaus, dass Sie Ihren Bot mit einem Dienst hosten m√ºssen, der auch eine Plattform bietet.  Das hei√üt, Sie k√∂nnen keine Box-L√∂sung erhalten.  Vielleicht irre ich mich und habe nicht vollst√§ndig untersucht, was tats√§chlich existiert, aber die Tatsache, dass der erste Link in Google nicht zu einer L√∂sung f√ºhrt, ist bereits alarmierend.  Es gibt auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Botman</a> .  Dies ist eine wirklich leistungsstarke, vollwertige Open-Source-Entwicklungsbibliothek mit einer Reihe von Chips und umfassender Dokumentation.  Und es ist in <i>PHP geschrieben.</i>  Ich habe nichts gegen <i>PHP</i> , auf jeden Fall gebe ich es nicht √∂ffentlich zu, um keinen unn√∂tigen Holivar zu z√ºchten, aber ich habe keine Lust, es zu entwickeln.  Ich habe mich entschlossen, nach etwas √§hnlichem wie Python zu suchen. Zus√§tzlich zu Python gibt es viele Bibliotheken, mit denen Sie mit der Telegramm-Bot-API arbeiten k√∂nnen.  Und ich fand nichts, so dass ich bald zu dem Schluss kam, dass es sich lohnt, selbst zu schreiben.  <i>(Vielleicht kennt jemand die geeigneten L√∂sungen f√ºr Multi-Plattform-Bots mit einem offenen System, ich freue mich √ºber jede Information)</i> <br><br>  Hier braut sich √ºbrigens ein weiteres Problem zusammen.  Ich habe absolut keine Ahnung, wo Sie die Arbeit in Form eines anderen Artikels als √ºber Habr√© mit dem Publikum teilen k√∂nnen.  Ich werde sehr gerne in dieser Angelegenheit helfen. <br><br>  Der Name <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Botovod</a> kam von selbst. <br><br>  Im Allgemeinen werde ich mit Botovod einen kleinen Code geben und ihn kurz erkl√§ren. <br><div class="spoiler">  <b class="spoiler_title">Spoiler √úberschrift</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> botovod <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Botovod, Message, utils @utils.convert_to_text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, text)</span></span></span><span class="hljs-function">:</span></span> message = Message() message.text = <span class="hljs-string"><span class="hljs-string">"  "</span></span> agent.send_message(chat, message) @utils.convert_to_images <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, images)</span></span></span><span class="hljs-function">:</span></span> message = Message() message.text = <span class="hljs-string"><span class="hljs-string">"  "</span></span> agent.send_message(chat, message) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_echo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, message)</span></span></span><span class="hljs-function">:</span></span> agent.send_message(chat, message) settings = [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"telegram"</span></span>, <span class="hljs-string"><span class="hljs-string">"agent"</span></span>: <span class="hljs-string"><span class="hljs-string">"botovod.agents.telegram"</span></span>, <span class="hljs-string"><span class="hljs-string">"settings"</span></span>: {<span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"462755273:AzBZBQ7AAnqFEXqZ_P8Z-qvCddmjqTVAYPI"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"polling"</span></span>} }, ] botovod = Botovod(settings) botovod.add_handler(handler_message) botovod.add_handler(handler_images) botovod.add_handler(handler_echo) botovod.start()</code> </pre> <br></div></div><br><br>  Hier definieren wir 3 Handler f√ºr eingehende Nachrichten, von denen jeder eine Antwort sendet.  Das erste: "Ich habe eine Nachricht erhalten", das zweite: "Ich sehe ein Foto", das dritte sendet einfach zur√ºck, was ich erhalten habe.  Dann erstellen wir einen Bot-Manager (Botovod) und √ºbergeben ihm die Einstellungen f√ºr die Bots, in diesem f√ºr den Bot in Telegram.  Als N√§chstes f√ºgen wir nacheinander Nachrichtenhandler hinzu.  Wenn eine Nachricht beim Bot eintrifft, geht sie an den ersten Handler, der sich bereit erkl√§rt, sie zu akzeptieren.  Wenn beispielsweise ein Audio an uns gesendet wurde, versucht der erste Handler, es zuerst zu akzeptieren, lehnt es jedoch ab, da dies kein Text ist.  Dann wird er das zweite akzeptieren, aber auch ablehnen, da dies kein Bild ist, dann wird er das dritte akzeptieren, das keine Einschr√§nkungen hat - auf diese Weise wird das Audio-Ortho weitergeleitet  Einschr√§nkungen werden als Dekoratoren aus dem Utils-Modul auferlegt. <br><br>  Jetzt werde ich versuchen, im Detail zu sagen, was was ist: <br><br>  Es gibt einen Bot-Manager - ein Objekt der Botovod-Klasse - den Namen des Bots (jeder hat seine eigene eindeutige), die Agentenklasse, die ihn verarbeitet, und die Einstellungen f√ºr den Bot werden im Konstruktor an ihn √ºbergeben.  Au√üerdem werden dem Bot-Manager nacheinander Handler hinzugef√ºgt.  Wenn eine Nachricht beim Bot eintrifft, √ºberpr√ºft der Manager diese nacheinander, bis er den Handler findet, der die NotPassed-Ausnahme ausl√∂st.  Der erste hinzugef√ºgte Handler wird zuerst √ºberpr√ºft, der letzte bzw. der letzte.  Wenn Sie Webhooks verwenden m√∂chten, kann der Bot-Manager mit dem Webserver verbunden werden.  Zu diesem Zweck verf√ºgt der Bot-Manager √ºber eine Listen-Methode, die den Bot-Namen, die Header und den Anforderungshauptteil akzeptiert.  Anschlie√üend werden diese Daten an den Agentenparser √ºbergeben, der die generierte Nachricht zur√ºckgibt, nachdem diese Nachricht durch die Handler gesendet wurde.  Als Antwort gibt die Listen-Methode das W√∂rterbuch {"status": any_code, "headers": dict (), "body": "any_text"} zur√ºck, wobei in Headern die Antwortheader und im body der Antworttext sind.  Manchmal erfordert der Messenger / das soziale Netzwerk, dass der Server ein Objekt zur√ºckgibt, daher halte ich dieses Verhalten f√ºr praktisch. <br><br>  Ich werde ein Beispiel f√ºr den Vkontakte-Bot unter dem Namen "vk-bot" geben, und Botovod wird eine Verbindung zum Django-Server herstellen <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> response = manager.listen(<span class="hljs-string"><span class="hljs-string">"vk-bot"</span></span>, request.headers, request.text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponse(status = response[<span class="hljs-string"><span class="hljs-string">"status"</span></span>], headers = response[<span class="hljs-string"><span class="hljs-string">"headers"</span></span>], response[<span class="hljs-string"><span class="hljs-string">"body"</span></span>])</code> </pre><br><br>  Eine gebildete Nachricht ist ein Objekt der Nachrichtenklasse.  Es enth√§lt die folgenden Felder: Text - Nachrichtentext;  Bilder - eine Liste mit Bildern;  Audios - eine Liste mit Audiodateien;  Videos - eine Liste von Videos;  Dokumente - eine Liste mit Dokumenten;  Orte - eine Liste mit Orten auf der Karte;  raw - der rohe Nachrichtentext oder zus√§tzliche Informationen dazu (W√∂rterbuch). <br><br>  Au√üerdem enth√§lt jede Liste des Nachrichtenobjekts (Bilder, Audios, Videos, Dokumente) spezielle Objekte, deren Klassen vom Anhang geerbt werden.  Die Attachment-Klasse verf√ºgt standardm√§√üig √ºber die Methoden url und file_path, mit denen Agenten-Parser normalerweise Informationen √ºber die empfangene Datei ablegen.  Die Standortliste enth√§lt Standortobjekte, an deren Konstruktor Sie L√§ngen- und Breitengrad (L√§ngen- und Breitengrad) √ºbergeben m√ºssen. <br><br>  Unten finden Sie ein Beispiel f√ºr die Erstellung von Nachrichten in Handlern <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, message)</span></span></span><span class="hljs-function">:</span></span> out = botovod.Message() image = botovod.Image() image.file_path = <span class="hljs-string"><span class="hljs-string">"/tmp/1.png"</span></span> location = botovod.Location() out.images.append(image) out.text = <span class="hljs-string"><span class="hljs-string">" ,   "</span></span> agent.send_message(chat, out)</code> </pre><br><br>  Das ist alles, was im Moment drin ist, aber ich hoffe, dass jemand an einer solchen L√∂sung interessiert ist und jemand mit Ratschl√§gen, Kommentaren, Ideen und vielleicht seiner eigenen Beteiligung an der Entwicklung helfen m√∂chte.  Vielen Dank f√ºrs Lesen! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github Link</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de422081/">https://habr.com/ru/post/de422081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422069/index.html">PHP Digest Nr. 138 (20. August - 2. September 2018)</a></li>
<li><a href="../de422071/index.html">Genug f√ºr alle oder wie man das Internet in Entwicklungsl√§nder liefert</a></li>
<li><a href="../de422073/index.html">Der einfachste Weg, die Integration eines Java-Clients in einen Java-Server zu unterst√ºtzen</a></li>
<li><a href="../de422077/index.html">Ist die JavaScript-Injektion relevant?</a></li>
<li><a href="../de422079/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 329 (27. August - 2. September 2018)</a></li>
<li><a href="../de422083/index.html">Einseitige Site auf Kotlin und SpringBoot ohne Verwendung von JSP</a></li>
<li><a href="../de422085/index.html">Nach Auswahl sortieren</a></li>
<li><a href="../de422087/index.html">Computer Vision in der Industrie. Vortrag in Yandex</a></li>
<li><a href="../de422089/index.html">JavaScript-Ausf√ºhrungskontext und Aufrufstapel</a></li>
<li><a href="../de422091/index.html">Effektive Verwendung von Array-Methoden in JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>