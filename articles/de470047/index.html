<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙏🏾 🚃 🤜🏿 Ich schaute zurück, um zu sehen, ob sie zurückblickte - 2 oder über AWS zu meinem eigenen Rechenzentrum 🧒 🍷 ✌🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir veröffentlichen alle im Home-Hypervisor befindlichen Dienste über den EC2 Amazon Web Services-Dienst über eine kostenlose Instanz für Amazon Linux...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ich schaute zurück, um zu sehen, ob sie zurückblickte - 2 oder über AWS zu meinem eigenen Rechenzentrum</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470047/"><img src="https://habrastorage.org/webt/hb/3k/nj/hb3knjstg1kmyhx0g_bzk-r5jiu.jpeg" alt="Bild"><br><br>  Wir veröffentlichen alle im Home-Hypervisor befindlichen Dienste über den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">EC2 Amazon Web Services-Dienst</a> über eine kostenlose Instanz für Amazon Linux AMI 2018 mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Libreswan</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">xl2tpd</a> und mit ein wenig Verzerrung ... <br><a name="habracut"></a><br>  Systemadministratoren eines traditionellen (Nicht-IT-) Unternehmens mit Erfahrung verfügen normalerweise nach einer Weile über eine eigene Servervirtualisierungsfarm zu Hause, um den Haufen von Lösungen vor Ort zu testen.  Dies kann eine banale Nachahmung eines verteilten Zweigstellennetzwerks, das Testen einer integrierten Infrastruktur mit hoher Verfügbarkeit, die Bereitstellung neuer Versionen einiger Lösungen usw. sein. <br><br>  Extern kann es von einem einfachen speichergepumpten Heim-PC mit integriertem Hypervisor und einem Consumer-NAS als iSCSI-Speicher (oder sogar als einfache virtuelle Maschine auf demselben PC) bis zu vollwertigen kleinen Rack-Mount-Servern reichen, die für kostengünstig abgeschriebene Steuergeräte gekauft wurden mit einem Stammbaum aus westlichen Rechenzentren, mit der gleichen BU tsiska für die Netzwerkkonnektivität und im Fibre Channel gleich stecken geblieben, auf dem Sekundärmarkt NAS gekauft, aber bereits eine Business Class. <br><br>  Natürlich kann in unserer Zeit der Begeisterung für Clouds die gesamte Infrastruktur problemlos in Cloud-Rechenzentren bereitgestellt werden, aber dies ist vor allem aufgrund der Kosten immer noch nicht immer möglich.  Es spielt keine Rolle, ob für die Tests mehrere leichte virtuelle Maschinen aus den verfügbaren Plänen erforderlich sind, aber was ist, wenn Sie im Dienst mehrere Dutzend oder sogar Hunderte separater „virtueller Maschinen“ mit einer Vielzahl von Diensten verdrehen müssen und außerdem ein Archiv haben möchten, damit Sie es jederzeit haben können Vor einem Jahr gab es eine Stichprobe, die sich in Konfigurationen / Einstellungen verdreht hat.  Oder es besteht die Notwendigkeit, alle Fallstricke mit derselben Synchronisation zwischen ADDS und ADFS zu übertragen, bevor einige der vorhandenen Geschäftsdienste auf dasselbe MS Azure übertragen werden. <br><br>  Das Hauptproblem in diesem Fall ist die Veröffentlichung (Weiterleitung) dieser gesamten Infrastruktur nach außen, damit Sie üben können, Benutzer von außen mit Ihrer "Server-Site" zu Hause oder mit Ihren eigenen "Cloud" -Diensten zu verbinden oder in Dienste von Drittanbietern usw. zu integrieren. <br><br>  Es ist gut, wenn die Heimverbindung für einen Geschäftstarif ausgelegt ist. In diesem Fall gibt es keine Probleme mit eingehenden Anforderungen, und die IP-Adresse ist fast immer "weiß", statisch. <br><br>  Was tun, wenn am Wohnort der übliche „Heimanbieter“ anwesend ist, der zusätzlich nur eine Adresse aus dem privaten Netzwerk bereitstellen kann?  Oder wird eine weiße Adresse angegeben, aber traditionell alle eingehenden Nachrichten aus dem privilegierten (&lt;1024) Portbereich abgeschnitten?  Oder Sie sind ein blöder armer Student und können sich einfach keine monatliche Rate leisten, die für juristische Personen bestimmt ist.  Oder müssen Sie häufig Ihren Wohnort wechseln und die "Habseligkeiten" Ihres virtuellen Servers auf den Buckel ziehen?  Ein Sonderfall ist auch für Personen relevant, die außerhalb der GUS leben, wenn der Anbieter zwangsweise seine eigenen Geräte für die Verbindung zum Internet bereitstellt und Sie die Weiterleitung der benötigten Ports an die virtuelle Heimfarm außerhalb einfach nicht konfigurieren können. <br><br>  Eine Lösung besteht darin, einen der VPN-Dienste von Drittanbietern zu verwenden.  Leider erlauben nur wenige von ihnen die Erlaubnis eingehender Verbindungen in Bezug auf den Tunnel, meistens handelt es sich um einen separaten kostenpflichtigen Dienst.  In diesem Fall ist die Auswahl an externen IP-Adressen sehr begrenzt, wenn Sie die Situation mit einer externen IP-Adresse in einem bestimmten Land testen möchten. Darüber hinaus gibt es in der Regel keine Garantie dafür, dass nicht gleichzeitig eine Reihe anderer VPN-Dienstclients an dieser Adresse hängen , oder es wird für eine lange Zeit statisch sein, was für das Einrichten von Service-Subdomain-Einträgen in DNS wichtig ist. <br><br>  Es lohnt sich auch (IMHO), trotz einiger perverser Methoden, Ihren eigenen „virtuellen“ Router auf einer externen Cloud-Plattform bereitzustellen, mit der Möglichkeit, einen VPN-Tunnel von der Home-Hypervisor-Farm zu dieser virtuellen Maschine in der Cloud zu konfigurieren, wobei die erforderlichen eingehenden Verbindungen von der externen Netzwerkschnittstelle weitergeleitet werden Clouds zu Hause Hypervisor-Dienste.  Und im Idealfall fast nichts für das Ganze zu bezahlen. <br><br>  Nachdem ich kürzlich meinen Job verloren hatte und damit Zugang zu einer warmen und komfortablen Testfarm für Unternehmen hatte, aber im Gegenzug viel Zeit erhielt, um meine Fähigkeiten zu aktualisieren, beschloss ich, den Diensten meines Heimhypervisors die Möglichkeit zu geben, eingehende Kundenverbindungen zu sehen. <br><br>  Der Autor dieser Zeilen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„liebt alle Arten von Infrastrukturperversionen“</a> . Daher verwenden wir als virtueller Router die kostenlose Instanz von Amazon Web Services (AWS) EC2 t2.micro für Linux, die anstelle von AWS: VPC (theoretisch) etwas mehr Flexibilität beim Debuggen und bei den Funktionen bietet und die Topologie dieser VPN-Perversion wird unten gezeigt: <br><br><img src="https://habrastorage.org/webt/xs/o5/_k/xso5_kg5gwlm9ozy9pj7udiqxuc.png" alt="Bild"><br><br>  Was sehen wir hier? <br><br>  Unter Linux ist eine kostenlose virtuelle Maschine (Instanz) (750 Stunden pro Monat im Jahr) unter Linux verfügbar, die in AWS: EC2 bereitgestellt wird.  Eingehende Anrufe von einigen Benutzern Ihrer Heimdienste fallen an die externe weiße IPv4-Adresse von Elastic IP. Durch die eingehenden (eingehenden) Regeln in den „Sicherheitsgruppen“ werden die Ports, die wir benötigen, der Netzwerkschnittstelle der Instanz zugeordnet. Anschließend werden Pakete dieser Anforderungen über iptables durch den IPSec-Tunnel geleitet Eine virtuelle Maschine für Windows 2016, bei der RRAS mithilfe des Routings zum gewünschten Dienst in der virtuellen Heimfarm gelangt.  Besonderes Augenmerk legen wir auf das gleichzeitige Vorhandensein von drei NATs: eines in AWS Linux, eines auf dem Router für das Büronetzwerk und eines implizit auf dem Heimrouter. <br><br>  In diesem (meinem) Fall spielt eine virtuelle Maschine unter Windows Server 2016 die Rolle eines Routers zur Simulation eines Büronetzwerks und seiner Serverplattform. MS WAP wird auf diesem Computer in Verbindung mit einem separaten Computer mit MS ADFS und anderen bereitgestellt, sodass es kein Problem gibt, ihn durch ein anderes Betriebssystem oder zu ersetzen sogar ein hausgemachtes Stück nach Geschmack.  Mit Windows RRAS werden die Dinge übrigens auf dem Weg kompliziert, während ich mich mit verschiedenen unangenehmen Momenten befassen musste (über die unten). Wenn Sie also MS Windows Server als Router nicht mögen, ist es mit einem anderen Betriebssystem möglicherweise einfacher. <br><br>  Zuerst erstellen wir ein AWS-Konto, falls Sie noch kein Konto haben.  Es gibt keine Probleme beim Erstellen des Kontos selbst. Sie müssen lediglich die Details Ihrer Plastikkarte angeben, von der 1 USD als Scheck abgebucht (und dann zurückgegeben) wird. <br><br>  Hier sind nur zwei Punkte zu erwähnen: <br><br><ol><li>  Gehen Sie unbedingt zu AWS: IAM (Identity and Access Management) und aktivieren Sie MFA (Multi-Factor Authentication) für Ihr neues Konto, und noch besser, wie AWS empfiehlt - erstellen Sie auch ein separates Konto bei MFA und arbeiten Sie weiterhin an der Einschränkung der entsprechenden Rechte. sie.  Andernfalls könnten Sie in eine unangenehme Situation geraten, wenn ein Trojaner AWS-Anmeldeinformationen von Ihrem PC stiehlt und beispielsweise jemand auf Ihre Kosten teure Hochleistungsinstanzpläne aus Ihrem Herzen abbaut ... </li><li>  Aus praktischen Gründen wird empfohlen, eine Budgetbenachrichtigung einzurichten.  Dies erfolgt in den Kontoeinstellungen, der entsprechende Menüpunkt heißt "Billing &amp; Cost Management Dashboard".  Wählen Sie im daraufhin angezeigten Fenster links den Eintrag „Budgets“ aus und konfigurieren Sie das geplante Monatsbudget mithilfe des integrierten Assistenten nach Belieben.  Vergessen Sie nicht, dort eine Warnung einzurichten: Bei Überschreitung des angegebenen Betrags erhalten Sie sofort eine Nachricht.  Dies ist nützlich, wenn Sie zuvor noch nicht mit AWS gearbeitet haben und Angst haben, im Verlauf Ihrer Experimente versehentlich eine runde Summe zu erhalten. </li></ol><br>  Als nächstes brauchen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS: EC2</a> . <br><br>  Einer der wichtigsten Schritte ist die Auswahl der AWS-Region (im Wesentlichen eines Rechenzentrums), in der wir unsere virtuelle Maschine bereitstellen möchten.  Die Platzierung wirkt sich direkt auf den geografischen Standort Ihres „virtuellen Routers“ und damit auf die Netzwerkverzögerung bei der Arbeit mit ihm aus.  Das ist wichtig, weil  AWS bietet keine Live-Migration zwischen Regionen (der integrierte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS Server-Migrationsdienst</a> kann nur etwas in die AWS-Cloud selbst migrieren). Im Falle eines Platzierungsfehlers ist es einfacher, eine neue Instanz am gewünschten Speicherort erneut zu erstellen.  Alternativ müssen Sie das Image aus der Instanz (Image, integriertes EC2) in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS: S3</a> (Speicherdienst) entfernen und von dort aus dieses Image in die EC2-Instanz in der neuen Region ziehen.  In meinem Fall wurde ursprünglich die Region <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Frankfurt</a> ausgewählt: <br><br><img src="https://habrastorage.org/webt/8c/2s/yh/8c2syhsrly1luamcwjsvbmlnbtg.png" alt="Bild"><br><br>  Wir erstellen eine neue Instanz und wählen links die Option <b>"Nur kostenlose Ebene"</b> aus, wodurch die vorgeschlagene Liste der Bilder auf nur freie beschränkt wird.  Ich habe mich für <b>"Amazon Linux AMI 2018" entschieden</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mehr</a> über Linux-Distributionen in AWS), weil  unter "Amazon Linux 2 AMI" funktioniert xl2tpd aufgrund der Art des von Amazon zusammengestellten Kernels nicht ordnungsgemäß. <br><br>  Sie können aus der bereitgestellten Liste jedes andere Linux-Image auswählen, das Ihnen vertraut ist.  Sie können auch tiefer in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS Marketplace</a> einsteigen und dort nach alternativen Images suchen. Lesen Sie einfach die Kommentare zu den Kosten sorgfältig durch: Das Image selbst und die Computerressourcen können kostenlos sein, aber Sie müssen extra für Speicherplatz usw. bezahlen. <br><br>  Wir wählen den vorgeschlagenen Typ <b>"t2.micro" aus</b> . Er bietet 1 vCPU, 1 GB Speicher, <b>8 bis 30</b> GB (SSD / Magnetic) Speicherplatz und 750 Stunden Arbeit pro Monat für ein Jahr.  Genug für unseren „virtuellen Router“.  Es ist erwähnenswert, dass für alle Instanzen freier Speicherplatz und Arbeitszeit aufgewendet werden. Bei finanziellen Schwierigkeiten müssen Sie also nicht mehr erstellen / ausführen, als Sie sich leisten können, außer kostenlos. <br><br>  Klicken Sie in den Assistenten "Weiter ...". Im dritten Schritt belassen wir alle Standardwerte. Im vierten Schritt stimmen wir den vorgeschlagenen 8 Gigabyte SSD-Standardfestplatte zu. Die Instanz beginnt mit der Schaltfläche Überprüfen und Starten: <br><br><img src="https://habrastorage.org/webt/ta/dv/of/tadvofw_fyn1iozzpgvxiwaswla.png"><br><br>  Danach erhalten wir ein Fenster mit einer Meldung zum Erstellen eines neuen Schlüsselpaars für die Verbindung mit unserem über SSH und einem Vorschlag, dieses Paar zu benennen und den privaten Schlüssel im * .pem-Format herunterzuladen.  Wir werden es in Zukunft wirklich brauchen, daher ist es ratsam, es sofort an einem sicheren Ort aufzubewahren.  Wenn diese Datei verloren geht, können Sie keine Remoteverbindung zu Instanzen herstellen, die sie verwenden.  In EC2 gibt es keine Möglichkeit, es für eine vorhandene Instanz erneut zu generieren. Die einzige Möglichkeit besteht darin, die Instanzdiskette mit einer anderen Instanz zu verbinden, die Zugriff hat, und anschließend die Schlüssel zu bearbeiten. <br><br>  Nach einer Weile wird die Instanz gestartet und verfügt über eine interne (private) und externe (öffentliche) IPv4-Adresse sowie zwei entsprechende DNS-Namen. <br>  Konfigurieren Sie Sicherheitsgruppen sofort, um den Datenverkehr für die von Ihnen benötigten Dienste sicherzustellen: <br><br><img src="https://habrastorage.org/webt/ex/rh/7y/exrh7yxlnlqsb36u5pdqifxrdb8.png"><br><br>  Wir benötigen die offenen eingehenden Ports 500, 1701, 4500 UDP und 4500 TCP für die Organisation des IPSec L2TP-VPN-Tunnels, HTTP und HTTPS für die Veröffentlichung von Home Farm-Diensten. Der externe Zugriff auf die Instanz über SSH wurde beim Erstellen der Instanz automatisch erstellt, da  EC2 enthält im Wesentlichen keinen integrierten Zugriff auf die Konsole der virtuellen Maschine über die Webschnittstelle.  Es gibt nur die Möglichkeit, den Bildschirm anzuzeigen: <br><br><img src="https://habrastorage.org/webt/zr/g4/uw/zrg4uw5t3_nihfjq8qaipfwxfkw.png"><br><br>  Es wird empfohlen, den Zugriff über VPN und SSH nur von Ihrer privaten IP-Adresse aus zu konfigurieren.  Die Reihenfolge der Regeln in Sicherheitsgruppen spielt keine Rolle. <br><br>  Da wir mehrere NAT-Dokumentationen verwenden, empfiehlt AWS, die <b>Überprüfung der Netzwerkquelle / des Netzwerkziels</b> in diesem Fall zu deaktivieren: <br><br><img src="https://habrastorage.org/webt/oa/6m/mg/oa6mmgeh6dyzg6sjxzdj0lkzbne.png"><br><br>  Da wir IPSec-Tunneling und nicht Transport verwenden, ist diese Einstellung für uns nicht sehr sinnvoll, aber für alle Fälle ist es besser, sie auszuschalten. <br><br>  Stellen Sie über SSH eine Verbindung zu unserer Instanz her.  Wenn Sie einen SSH-Grafikclient verwenden, z. B. PuTTY, um eine Verbindung herzustellen, hilft Ihnen die integrierte Hilfe für die Verbindung, die von RMB auf der Instanz aufgerufen wird -&gt; Verbinden: <br><br><img src="https://habrastorage.org/webt/dc/tm/s1/dctms1dbkmpble2n5vojwkdq3py.png"><br><br>  Amazon Linux verwaltet einen Stammbaum von RHEL und CentOS, daher wird der yum-Paketmanager verwendet. <br><br>  Alle unten beschriebenen Vorgänge müssen mit einer Eskalation von Berechtigungen ausgeführt werden. Daher stellen wir ihnen sudo voran oder arbeiten nur als root. <br><br>  Erstes Update: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum update</span></span></code> </pre> <br>  Als Software zur Organisation eines VPN-Servers verwenden wir eine Kombination aus Libreswan und xl2tpd. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LibreSwan</a> (Fork von Openswan und ein Analogon von strongSwan) ist eine beliebte Implementierung von VPN IPSec und IKE (Internet Key Exchange).  Es kann verschiedene Arten von NAT und ihre Kombinationen korrekt umgehen, was besonders wichtig ist, wenn das IPSec-Tunneling organisiert wird. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">xl2tpd ist</a> ebenfalls weit verbreitet. Sein Hauptvorteil ist die integrierte Fähigkeit, Clientverbindungsparameter beim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Herstellen einer</a> Verbindung über ppp zu authentifizieren und zu übertragen (z. B. IP-Adressen, Standardrouteneinstellungen, DNS-Server usw.), wodurch die Notwendigkeit einer zusätzlichen DHCP- und Radius-Bereitstellung für unsere überflüssig wird einfache Aufgaben. <br><br>  Da xl2tpd nicht in den Standard-Amazon Linux-Repositorys enthalten ist, müssen wir EPEL (Extra Packages for Enterprise Linux) aktivieren: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum-config-manager --enable epel</span></span></code> </pre> <br><h3>  Installieren Sie die erforderlichen Pakete: </h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install libreswan xl2tpd -y</span></span></code> </pre> <br><h3>  Aktivieren Sie das Routing auf Kernelebene: </h3><br>  In die Datei <b>/etc/sysctl.conf</b> schreiben <b>wir</b> : <br><br><pre> <code class="bash hljs">net.ipv4.ip_forward = 1 net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.all.secure_redirects = 1 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.default.secure_redirects = 0 net.ipv4.conf.default.send_redirects = 0 net.ipv4.conf.lo.accept_redirects = 0 net.ipv4.conf.lo.secure_redirects = 0 net.ipv4.conf.lo.send_redirects = 0 net.ipv4.conf.eth0.accept_redirects = 0 net.ipv4.conf.eth0.secure_redirects = 0 net.ipv4.conf.eth0.send_redirects = 0 net.ipv4.conf.all.rp_filter = 0 net.ipv4.conf.default.rp_filter = 0 net.ipv4.conf.eth0.rp_filter = 0</code> </pre><br>  <b>Deaktivieren Sie rp_filter</b> in der aktuellen Sitzung, um keinen Neustart <b>durchzuführen</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># for f in /proc/sys/net/ipv4/conf/*/rp_filter ; do # echo 0 &gt; $f # done</span></span></code> </pre><br>  Wir übernehmen die Einstellungen und prüfen die Verfügbarkeit des Routings: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sysctl -p /etc/sysctl.conf # cat /proc/sys/net/ipv4/ip_forward</span></span></code> </pre><br>  Wir müssen sicherstellen, dass eingehende (in Bezug auf die öffentliche Schnittstelle der Instanz) Pakete von den Ports der erforderlichen Dienste an unseren zukünftigen IPSec-Tunnel weitergeleitet werden.  Dazu ist es nicht nur erforderlich, diese Pakete zu de- <b>NATen</b> , sondern auch die Maskierung auf der <b>ppp0-</b> Schnittstelle <b>durchzuführen</b> . <br>  Wir werden hierfür die integrierten <b>iptables-</b> Funktionen verwenden, die im Fall von Amazon Linux zunächst so konfiguriert sind, dass jeglicher Datenverkehr in jede Richtung vollständig zugelassen wird: <br><br>  DNAT der erforderlichen Ports erstellen: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 80 -j DNAT --to-destination 10.100.0.2:80 # iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 443 -j DNAT --to-destination 10.100.0.2:443</span></span></code> </pre> <br>  Leiten Sie alle Pakete, die an diese Ports kamen, an die Windows-Gate-Adresse weiter: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 80 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT # iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</span></span></code> </pre> <br>  Maskieren Sie diese Pakete: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</span></span></code> </pre><br>  Es ist ratsam, die iptables-Regeln beizubehalten, damit sie beim Neustart der Instanz automatisch verschärft werden: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># service iptables save</span></span></code> </pre> <br>  In diesem Fall verwenden wir den DNAT (Destination NAT) des erforderlichen TCP-Ports von der Netzwerkschnittstelle eth0 der Instanz in Richtung der IPv4-Adresse 10.100.0.2, die die Adresse auf der PPP-Schnittstelle des RRAS-Dienstes unseres Windows-Gates im Home-Hypervisor ist. <br><br>  Das Folgende ist ein sehr wichtiger Punkt: Da die Dienste im Hypervisor in der Lage sein müssen, auf von der AWS-Instanz empfangene Anforderungen zu antworten, muss vor dem Senden des Pakets eine Maskierung (Ersetzen der Absenderadresse) auf der <b>ppp0-</b> Schnittstelle der Instanz <b>bereitgestellt</b> werden. Andernfalls geht die Antwort in eine völlig andere Richtung: von Das Windows-Gate im Hypervisor führt hinter dem IPSec-Tunnel direkt zum Standard-Router (Home-Router). Dadurch wird es natürlich auf der Clientseite des Dienstes gelöscht, als stamme es von einer nicht angeforderten Ressource.  Wenn Maskierung im Paket-Header am Eingang zum VPN-Tunnel verwendet wird, ändert sich die Absenderadresse von der Adresse irgendwo im Internet zu der Adresse <b>ppp0 der</b> Schnittstelle der AWS-Instanz: EC2, d. H.  in meinem Fall um 10.100.0.1 <br><br>  Als Alternative zur Verwendung von iptables für andere Linux-Distributionen oder * NIX-Systeme können Sie das gute alte rinetd empfehlen, bei dem dies alles in der Regel in einer Zeile in der <b>Konfiguration rinetd.conf erfolgt</b> : <br><br><pre> <code class="bash hljs">&lt;ip <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;port <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;ip destination&gt; &lt;port destination&gt;</code> </pre> <br>  Das einzige, was in diesem Fall im Kernel aktiviert werden muss, ist die Möglichkeit des Routings / NAT-Verkehrs. <br><br><h3>  Es ist Zeit, Libreswan zu kochen. </h3><br>  Die Datei <b>/etc/ipsec.conf</b> enthält Anweisungen zum Herunterladen aller .conf-Dateien von /etc/ipsec.d/. Daher erstellen wir eine neue Konfigurationsdatei im Verzeichnis /etc/ipsec.d/aws_vpn.conf und fügen sie hinzu: <br><br><pre> <code class="bash hljs">config setup <span class="hljs-comment"><span class="hljs-comment">#       # plutostderrlog=/var/log/pluto.log # logfile=/var/log/pluto.log # plutodebug = all #  NAT-T -   NAT- nat_traversal=yes oe=off protostack=netkey nhelpers=0 interfaces=%defaultroute conn aws_vpn type=tunnel auto=start forceencaps=yes pfs=no fragmentation=yes authby=secret left=%defaultroute #   &lt;…&gt;      Elastic IP leftid=&lt;…&gt; #   &lt;…&gt;     (172...) leftsubnet=&lt;…&gt;/32 leftnexthop=%defaultroute leftprotoport=17/1701 rightprotoport=17/%any right=%any rightsubnetwithin=0.0.0.0/0 rightsubnet=vhost:%priv</span></span></code> </pre><br>  Der Einfachheit halber verwenden wir die IPSec-Authentifizierung basierend auf einem gemeinsam genutzten Schlüssel (PSK) und nicht auf Zertifikaten. Daher müssen wir ihn explizit angeben.  Die Datei <b>/etc/ipsec.secrets</b> enthält Anweisungen zum Herunterladen aller .secrets-Dateien von <b>/etc/ipsec.d/</b> . Dort erstellen wir eine neue Datei <b>/etc/ipsec.d/aws_vpn.secrets</b> und geben die PSK im folgenden Format an: <br><br><pre> <code class="bash hljs">&lt;     172...&gt; %any : PSK <span class="hljs-string"><span class="hljs-string">"&lt; PSK&gt;"</span></span></code> </pre> <br>  Als Beispiel: <br><br><pre> <code class="bash hljs">172.31.20.120 %any : PSK <span class="hljs-string"><span class="hljs-string">"Pa$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$w0rd</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  Da die ppp-Verbindung innerhalb des IPSec-Tunnels verwendet wird und es eine eigene Authentifizierung gibt, konfigurieren wir sie auch: <br>  Wir geben den Benutzernamen und das Passwort in die Datei <b>/ etc / ppp / chap-secret</b> im folgenden Format ein: <br><br><pre> <code class="bash hljs">&lt;user&gt; * &lt;password&gt; *</code> </pre> <br>  Als Beispiel: <br><br><pre> <code class="bash hljs">aws_user * Pa$<span class="hljs-variable"><span class="hljs-variable">$w0rd</span></span> *</code> </pre> <br>  Bei der Verbindung mit dem ppp-Client können eine Reihe von Optionen übergeben werden, um die Netzwerkschnittstelle und die Routing-Tabelle zu konfigurieren. <br><br>  <b>Legen Sie in der</b> Datei <b>/etc/ppp/options.xl2tpd</b> die <b>folgenden</b> Optionen fest: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  xl2tpd  ip   ipcp-accept-local ipcp-accept-remote #    defaultroute   Windows-    nodefaultroute noccp auth #   RRAS  Windows-  mschap-v2   require-mschap-v2 #   MTU  MRU mtu 1410 mru 1410 lock</span></span></code> </pre><br>  Weil  Wir müssen keine DNS-, Wins- usw. Adressen an den Client weitergeben.  Dinge - alle anderen Optionen müssen auskommentiert werden. <br><br>  Hier benötigen Sie eine Erläuterung der Konfiguration. <br><br>  Das Standardverhalten für VPN-Verbindungen besteht darin, eine neue Standardroute in der Client-Tabelle zu installieren, die den gesamten Datenverkehr von dieser zum Internet zwingt, über den VPN-Server zu "gehen".  In unserem Fall ist das falsch, weil  Das Ziel des Windows-Gates besteht darin, einen simulierten Zugriff auf das Internet des dahinter liegenden virtuellen Büronetzwerks im Hypervisor bereitzustellen und die Ressourcen interner Dienste über AWS: EC2 nach außen zu veröffentlichen. Daher ist es irrational, den gesamten Datenverkehr über die Instanz an AWS: EC2 weiterzuleiten.  Aus diesem Grund müssen Sie verhindern, dass eine VPN-Verbindung in RRAS die Standardroute (zu einem Heimrouter) ändert. <br><br>  Es ist auch wichtig, die richtigen MTU- und MRU-Werte auszuwählen: Wir verwenden IPSec-Tunneling und eine zu große Nutzlast passt möglicherweise nicht in die Kapselungsgrenze, was zu Fragmentierung und höchstwahrscheinlich zu einem Fehler führt.  Wenn dies angezeigt wird, versuchen Sie zunächst, diese Werte beispielsweise auf 1280 zu reduzieren. Die in der angegebenen Konfiguration angegebenen Werte sind mit dem Windows VPN-Client kompatibel. <br><br><h3>  Es bleibt xl2tpd zu konfigurieren </h3><br>  Wir konfigurieren alles Notwendige in der Konfigurationsdatei xl2tpd <b>/etc/xl2tpd/xl2tpd.conf</b> : <br><br><pre> <code class="bash hljs">[global] port=1701 ipsec saref = yes ; ,      ;debug tunnel = yes ;debug avp = yes ;debug network = yes ;debug state = yes ;debug tunnel = yes [lns default] name = AWSvpnServer ;       ppp ip range = 10.100.0.2-10.100.0.2 ;    ppp0 AWS:EC2  <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> ip = 10.100.0.1 require authentication = yes require chap = yes refuse pap = yes pppoptfile = /etc/ppp/options.xl2tpd length bit = yes</code> </pre><br><h3>  Wir überprüfen alles, was wir getan haben </h3><br>  Wir versuchen beide Dienste auszuführen und die Konfigurationen zu überprüfen: <br><br><pre> <code class="bash hljs">service ipsec start service xl2tpd start ipsec verify</code> </pre><br>  Möglicherweise werden Dienste bereits ausgeführt. In diesem Fall werden sie einfach neu gestartet. <br><br>  Wenn alles in Ordnung ist, sollte die Ausgabe von ipsec verify dem Screenshot ähnlich sein: <br><br><img src="https://habrastorage.org/webt/o1/rv/br/o1rvbrchcizb6jn9qewgrj_hrn4.png"><br><br>  Sie können xl2tpd interaktiv debuggen, indem Sie es mit dem Schalter -D ausführen und mit dem <b>Bildschirmdienstprogramm</b> in einem separaten „Fenster“ des SSH-Terminals aufhängen: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># xl2tpd -D</span></span></code> </pre> <br>  In diesem Fall tritt der xl2tpd-Prozess nicht in den Hintergrund, sondern zeigt alle seine Aktivitäten auf dem Terminalbildschirm an. <br><br>  Bei Problemen müssen Sie die Debugging-Optionen in den Konfigurationen auskommentieren (siehe Kommentare) und den Inhalt der Systemprotokolle und der Datei <b>/var/log/pluto.log überprüfen</b> .  Beachten Sie auch den Inhalt der Option <b>virtual_private / virtual-private</b> in der Datei <b>/etc/ipsec.conf</b> . Sie listet alle privaten Netzwerke auf, die für den Datenaustausch über IPSec verfügbar sind.  Wenn Sie aus irgendeinem Grund eine eigene Adressierung haben, z. B. einen eigenen Pool weißer IPv4-Adressen verwenden, sollten Sie Änderungen an diesem Parameter vornehmen. <br><br><h3>  Fahren wir mit dem letzten Schritt fort: Einrichten des RRAS-Dienstes im Windows-Gate und Überprüfen der Veröffentlichung von Diensten aus dem Internet </h3><br>  Es wird davon ausgegangen, dass Ihr Heimhypervisor über eine virtuelle Maschine unter Windows 2012R2 oder höher verfügt, die im grafischen Modus (Desktop) bereitgestellt wird, und dass diese virtuelle Maschine zwei Netzwerkadapter enthält: Einer "schaut" in das Heimnetzwerk und hat einen Heimrouter als Standardroute und das andere in ein virtuelles lokales "Büro" -Netzwerk, in dem Dienste außerhalb veröffentlicht werden.  Eine Windows-Domäne ist optional, es sei denn, die Dienste selbst erfordern dies. <br><br>  Wir installieren alle erforderlichen Rollen mithilfe des Server-Managers oder des Cmdlets PowerShell <b>Install-WindowsFeature</b> : <br><br><img src="https://habrastorage.org/webt/lv/vw/ul/lvvwull1qus2dpgplvaxfvjv_gq.png"><img src="https://habrastorage.org/webt/pc/ag/80/pcag80h9dc8jq6gtim8jbdoeseq.png"><br><br>  Hier demonstriere ich die Installation von Rollen durch Grafiken, da es dann noch viel bequemer ist, den Setup-Assistenten vom Server-Manager aus aufzurufen und den RRAS-Dienst selbst im Zeitplan zu konfigurieren, was uns mit der guten alten Oberfläche aus der Zeit von Windows Server 2003 gefallen wird: <br><br><img src="https://habrastorage.org/webt/ai/rx/hz/airxhzrmjcbvyopop4rt_rcu4ga.png"><br><br>  Klicken Sie auf Ihrem Server auf RMB, wählen Sie <b>"Routing und RAS konfigurieren und aktivieren"</b> und konfigurieren Sie dann manuell: <br><br><img src="https://habrastorage.org/webt/na/gj/bc/nagjbch0d6jxmyjzgywhnqqe17s.png"><br><br>  Sie können alle Dohlen auswählen, den Assistenten abschließen und den Dienst starten: <br><br><img src="https://habrastorage.org/webt/ku/ir/sq/kuirsqjvnmskwfjrikybcl2kacu.png"><br><br>  Lassen Sie uns zunächst unser virtuelles lokales Netzwerk außerhalb freigeben.  Wir gehen zu IPv4-&gt; NAT und erstellen eine neue Schnittstelle, da die vorhandene Schnittstelle, auf der NAT implementiert wird, die externe Schnittstelle (die im Internet bzw. in Ihrem Heimnetzwerk angezeigt wird) ausgewählt, als öffentlich markiert und NAT darauf aktiviert wird: <br><br><img src="https://habrastorage.org/webt/gk/zh/lx/gkzhlxjyvjsgkhdnfvaqyhcn3xo.png"><img src="https://habrastorage.org/webt/kw/wx/xw/kwwxxw5u1gtezu2moo-3beokuli.png"><br><br>  Wir überprüfen, wie der Datenverkehr aus dem virtuellen LAN durch unser Gate abfließt.  Wir müssen die Windows-Firewall noch nicht konfigurieren. <br><br>  Wenn alles in Ordnung ist, werden wir endlich das schaffen, wofür wir gekämpft haben, eine VPN-Verbindung zu unserer AWS-Instanz und die Veröffentlichung unserer Dienste überprüfen.  Wir gehen im RRAS-Snap-In zu <b>„Netzwerkschnittstellen“</b> und erstellen eine neue Demand-Dial-Schnittstelle mit einem beliebigen Namen: <br><br><img src="https://habrastorage.org/webt/-v/04/yx/-v04yxa-najhry2evwovvtydsby.png"><br><br>  Wählen Sie sofort die L2TP-Verbindung aus, damit unsere neue Schnittstelle nicht automatisch versucht, den VPN-Typ zu ermitteln, und dadurch eine schnellere Verbindung herstellt: <br><br><img src="https://habrastorage.org/webt/jg/mw/xb/jgmwxbg1nzbih2grilgopxrlfv8.png"><br><br>  Weiter im Assistenten geben wir die öffentliche Adresse unserer Cloud an (in meinem Fall Elastic IP).  Lassen Sie in den nächsten Schritten alles so wie es ist, weil  Wir benötigen keine Site-to-Site-Verbindung: <br><br><img src="https://habrastorage.org/webt/fa/fn/p7/fafnp7fmggqxnbmosjcpdkx1wck.png"><img src="https://habrastorage.org/webt/d1/zc/wm/d1zcwmsgomejupu7if4ynp2rqjk.png"><br><br>  Geben Sie das Benutzerkonto an, unter dem wir die ppp-Verbindung konfiguriert haben (in der Datei <b>/ etc / ppp / chap-secret</b> ).  Es ist kein Domainname erforderlich: <br><br><img src="https://habrastorage.org/webt/zc/to/ei/zctoei91of_eyji6fncqhgvcii4.png"><br><br>  Der Assistent erstellt eine neue Verbindung.  Jetzt bleibt es zu konfigurieren.  Wir werden das Leerlaufzeitlimit (Leerlaufzeit) anpassen, das veraltete CHAP zugunsten von nur MS-CHAPv2 entfernen und den PSK-Schlüssel in den "Erweiterten Eigenschaften" angeben (der für xl2tpd in der Datei /etc/ipsec.d/aws_vpn festgelegt wurde). Geheimnisse) und IPv6 entfernen: <br><br><img src="https://habrastorage.org/webt/a0/qf/tf/a0qftfatglil4qkjv-hyn5hzvlc.png"><img src="https://habrastorage.org/webt/ax/hy/hu/axhyhuwgchr9z2vhmel17jjbx1s.png"><img src="https://habrastorage.org/webt/vq/xl/qz/vqxlqzejzpi3rs0i9x0r5ol9fkg.png"><img src="https://habrastorage.org/webt/km/ro/um/kmroumh0brc2_yq3przzb-a7jm8.png"><br><br>  Nach dem Erstellen einer neuen Schnittstelle müssen Sie auch die Eigenschaften des RRAS-Dienstes selbst aufrufen, Ihre IPSec-Richtlinie für L2TP aktivieren und Ihr PSK angeben.  Sie werden aufgefordert, den RRAS-Dienst neu zu starten. <br><br><img src="https://habrastorage.org/webt/h8/0w/zk/h80wzkz1pfymizhrqruvwrgj9di.png"><br><br>  Es scheint, dass alles sicher eine neue Oberfläche aufgerufen werden kann und die Arbeit genießen kann.  Aber nein.  Aufgrund der Tatsache, dass wir NAT auf der Seite der AWS: EC2-Instanz verwendet haben, kann der Windows-VPN-Client keine Verbindung zu einem solchen Nat-Traversal-Knoten herstellen.  Dies gilt sowohl für Client-Versionen (bis zum Zeitpunkt des Schreibens dieses Artikels des Windows 10-Builds) als auch für Server-Versionen. <br><br>  Glücklicherweise gibt es eine offizielle Lösung für dieses Problem in Form von Änderungen in der Registrierung der IPSec Policy Service-Einstellungen, gefolgt von einem Neustart: <br><br>  An die Adresse <br>  <b>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ PolicyAgent</b> <br>  Erstellen Sie einen DWORD-Schlüssel (32-Bit) <br>  <b>Angenommen, UDPEncapsulationContextOnSendRule = 2</b> <br>  und starten Sie unser Windows Gate neu. <br><br>  Der RRAS-Dienst ist leider für seine launische Konfiguration und Bedienung bekannt und führt auch nach einem Neustart einen verzögerten Start durch.  So können Sie es nach einem Neustart beschleunigen. <br>  Wenn alles richtig gemacht wurde, funktioniert die Verbindung innerhalb von 5-10 Sekunden. <br><br>  Es bleibt die Veröffentlichung der erforderlichen Ressourcen auf dem Windows-Gate selbst. <br><br>  Für den Test werden wir die Veröffentlichung des Webservers ausarbeiten.  Schauen Sie sich zuerst unseren IPSec-Tunnel und die iptables-Regeln an. <br><br>  Mit zitternden Händen prüfen wir von einem beliebigen PC aus, der mit dem Internet verbunden ist: <br><br><img src="https://habrastorage.org/webt/ho/yg/c-/hoygc-blrya-dt30hytsmdruezg.png"><img src="https://habrastorage.org/webt/8v/yc/q7/8vycq7c2bsc6dqjcc3t7qzcacje.png"><br><br>  Wow, es funktioniert ... <br><br>  Während der Installation der erforderlichen Rollen wurde der "native" MS IIS zwangsweise installiert, aber wir möchten, dass es noch einfacher wird.  Auf einer Windows-Plattform ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>HFS</b></a> (HTTP File Server) dafür gut geeignet - es ist kostenlos, erfordert keine Installation, gibt eine bestimmte Seite und einen bestimmten HTTP-Header an und kann an einem beliebigen Port arbeiten (standardmäßig ist es 8080, in unserem Fall muss es also auf 80 neu konfiguriert werden). Außerdem wird sofort in die Konsole geschrieben, woher die Verbindung stammt. Dies ist sehr praktisch, um die Veröffentlichung vieler Webressourcen auf der Windows-Plattform zu debuggen.  Um es zu verwenden, müssen Sie zuerst die MS IIS-Site stoppen, um den eingebetteten Server vom erforderlichen Port zu trennen.  Da wir die MS IIS-Verwaltungskonsole nicht installieren möchten (die MS IIS 6-Konsole ist aus Kompatibilitätsgründen vorhanden, IIS 7+ kann jedoch nicht über sie gesteuert werden), führen wir dies über PowerShell aus: <br><br><pre> <code class="bash hljs">Stop-WebSite -Name <span class="hljs-string"><span class="hljs-string">"Default Web Site"</span></span></code> </pre> <br>  oder einfach über das iisreset-Verwaltungsdienstprogramm: <br><br><pre> <code class="bash hljs">iisreset /stop</code> </pre> <br>  Danach müssen Sie eingehenden Datenverkehr zu Port 80 in der integrierten Windows-Firewall zulassen. <br>  Wir starten HFS und überprüfen: <br><br><img src="https://habrastorage.org/webt/ti/u2/bc/tiu2bcpm3ynhzteryfe9njxvfq4.png"><br><br>  Alles ist großartig.  Wir haben erreicht, dass Sie von überall im Internet den Webserver, der in unserem Haus lebt, als virtuelle Maschine in einem beliebigen Hypervisor sehen können. <br><br>  Der letzte Schliff: Wir bringen RRAS bei, alle derartigen Anfragen von außen an das virtuelle Büronetzwerk weiterzuleiten, wo wir der Legende nach einen anderen Webserver haben. <br><br>  Dazu rufen wir erneut das RRAS-Verwaltungs-Snap-In in IPv4-&gt; NAT und RMB auf unserer VPN-Schnittstelle auf. Dort wählen wir die Registerkarte <b>„Dienste und Ports“ aus</b> , markieren sie in der Liste der Webserver und geben den Webserver im internen virtuellen Netzwerk an, auf dessen Ressourcen wir veröffentlichen möchten Internet: <br><br><img src="https://habrastorage.org/webt/d7/bq/jv/d7bqjv0ir3a2l8w4vzxpdax8nra.png"><br><br>  Klicken Sie auf OK und ... alles ist fertig.  Wir überprüfen - alles sollte gut funktionieren. <br><br>  Auf diese einfache Weise können Sie schnell fast alle Dienste und Ressourcen veröffentlichen, von Websites über Mailserver bis hin zu komplexen Integrationen.  Für die meisten von ihnen benötigen Sie natürlich eine eigene DNS-Domain, in der Sie Subdomains erstellen und die erforderlichen Einträge bearbeiten können.  Es ist auch ratsam, SSL-Zertifikate zum Veröffentlichen von Webressourcen zu verwenden. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dank LetsEncrypt</a> und ähnlichen ACME-kompatiblen Diensten kann dies völlig kostenlos und mit automatischer Aktualisierung erfolgen. <br><br>  Wenn Sie die Instanz neu starten, ändert sich die öffentliche IPv4-Adresse nicht - nur wenn sie gestoppt wird. Es wird jedoch weiterhin empfohlen, eine statische IPv4-Adresse in AWS: EC2 zu verwenden.  Statisch in dem Sinne, dass Ihre Instanz beim Ausschalten dieser Instanz zugewiesen bleibt und nicht in den allgemeinen freien Pool fällt.  Dies ist natürlich erforderlich, um nicht jedes Mal die Neukonfiguration von DNS-Einträgen in Domänen zu stören, und niemand hat TTL mit Caching abgebrochen.  Es kostet viel Geld und wird, wie oben bereits erwähnt, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Elastic IP genannt</a> . <br><br><h3>  Primitive Prozessautomatisierung </h3><br>  Abschließend möchte ich eine weitere großartige Funktion von AWS erwähnen: EC2 - schnelle Konfiguration der bereitstellbaren Instanz.  In AWS: EC2 gibt es viele schnelle Bereitstellungsoptionen, bis hin zu speziellen (und recht komplexen, aber sehr leistungsfähigen) Diensten. Die einfachste: In Schritt 3 des Assistenten zum Erstellen einer neuen Instanz befindet sich unten das Feld <b>"Benutzerdaten"</b> .  Sie können ein Bash-Skript oder sogar PowerShell (im Fall einer Instanz unter Windows) einfügen. Dieses Skript wird unmittelbar nach dem Erstellen der Instanz automatisch ausgeführt. <br>  Das heißt,  Sie können alle oben genannten Befehle und Konfigurationen leicht ändern, um Ihr eigenes Bash-Skript zu erstellen und damit schnell einen solchen virtuellen AWS: EC2-Router zu starten.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erfahren Sie mehr über diese Funktion</a> . <br><br>  Vielen Dank, dass Sie sich die Zeit genommen haben, diesen Artikel zu lesen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de470047/">https://habr.com/ru/post/de470047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de470029/index.html">Extreme Pädagogik: „Wir wissen“ über die Langzeitbehandlung mit Kindern</a></li>
<li><a href="../de470033/index.html">F # 2: FSI-Umgebung</a></li>
<li><a href="../de470035/index.html">Wahngenerator: Erstellen Sie Texte in einer beliebigen Sprache mithilfe eines neuronalen Netzwerks</a></li>
<li><a href="../de470043/index.html">Die Wissenschaft dahinter, wie unser Gehirn am besten funktioniert und wie Technologie und unsere Umwelt helfen können</a></li>
<li><a href="../de470045/index.html">Visual Studio für Mac: Top-Funktionen des neuen Editors</a></li>
<li><a href="../de470049/index.html">Einführung in NuGet Package Management auf Lösungsebene in Visual Studio für Mac</a></li>
<li><a href="../de470051/index.html">Neurowissenschaften: Wenn unser Gehirn am besten funktioniert und wie Technologie helfen kann</a></li>
<li><a href="../de470055/index.html">Einführung in NuGet Package Management auf Lösungsebene in Visual Studio für Mac</a></li>
<li><a href="../de470057/index.html">Visual Studio für Mac: 5 neue coole Funktionen</a></li>
<li><a href="../de470061/index.html">Wie man weniger Code schreibt und mehr Sinn bekommt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>