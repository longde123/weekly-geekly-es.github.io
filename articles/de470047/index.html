<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèæ üöÉ ü§úüèø Ich schaute zur√ºck, um zu sehen, ob sie zur√ºckblickte - 2 oder √ºber AWS zu meinem eigenen Rechenzentrum üßí üç∑ ‚úåüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir ver√∂ffentlichen alle im Home-Hypervisor befindlichen Dienste √ºber den EC2 Amazon Web Services-Dienst √ºber eine kostenlose Instanz f√ºr Amazon Linux...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ich schaute zur√ºck, um zu sehen, ob sie zur√ºckblickte - 2 oder √ºber AWS zu meinem eigenen Rechenzentrum</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470047/"><img src="https://habrastorage.org/webt/hb/3k/nj/hb3knjstg1kmyhx0g_bzk-r5jiu.jpeg" alt="Bild"><br><br>  Wir ver√∂ffentlichen alle im Home-Hypervisor befindlichen Dienste √ºber den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">EC2 Amazon Web Services-Dienst</a> √ºber eine kostenlose Instanz f√ºr Amazon Linux AMI 2018 mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Libreswan</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">xl2tpd</a> und mit ein wenig Verzerrung ... <br><a name="habracut"></a><br>  Systemadministratoren eines traditionellen (Nicht-IT-) Unternehmens mit Erfahrung verf√ºgen normalerweise nach einer Weile √ºber eine eigene Servervirtualisierungsfarm zu Hause, um den Haufen von L√∂sungen vor Ort zu testen.  Dies kann eine banale Nachahmung eines verteilten Zweigstellennetzwerks, das Testen einer integrierten Infrastruktur mit hoher Verf√ºgbarkeit, die Bereitstellung neuer Versionen einiger L√∂sungen usw. sein. <br><br>  Extern kann es von einem einfachen speichergepumpten Heim-PC mit integriertem Hypervisor und einem Consumer-NAS als iSCSI-Speicher (oder sogar als einfache virtuelle Maschine auf demselben PC) bis zu vollwertigen kleinen Rack-Mount-Servern reichen, die f√ºr kosteng√ºnstig abgeschriebene Steuerger√§te gekauft wurden mit einem Stammbaum aus westlichen Rechenzentren, mit der gleichen BU tsiska f√ºr die Netzwerkkonnektivit√§t und im Fibre Channel gleich stecken geblieben, auf dem Sekund√§rmarkt NAS gekauft, aber bereits eine Business Class. <br><br>  Nat√ºrlich kann in unserer Zeit der Begeisterung f√ºr Clouds die gesamte Infrastruktur problemlos in Cloud-Rechenzentren bereitgestellt werden, aber dies ist vor allem aufgrund der Kosten immer noch nicht immer m√∂glich.  Es spielt keine Rolle, ob f√ºr die Tests mehrere leichte virtuelle Maschinen aus den verf√ºgbaren Pl√§nen erforderlich sind, aber was ist, wenn Sie im Dienst mehrere Dutzend oder sogar Hunderte separater ‚Äûvirtueller Maschinen‚Äú mit einer Vielzahl von Diensten verdrehen m√ºssen und au√üerdem ein Archiv haben m√∂chten, damit Sie es jederzeit haben k√∂nnen Vor einem Jahr gab es eine Stichprobe, die sich in Konfigurationen / Einstellungen verdreht hat.  Oder es besteht die Notwendigkeit, alle Fallstricke mit derselben Synchronisation zwischen ADDS und ADFS zu √ºbertragen, bevor einige der vorhandenen Gesch√§ftsdienste auf dasselbe MS Azure √ºbertragen werden. <br><br>  Das Hauptproblem in diesem Fall ist die Ver√∂ffentlichung (Weiterleitung) dieser gesamten Infrastruktur nach au√üen, damit Sie √ºben k√∂nnen, Benutzer von au√üen mit Ihrer "Server-Site" zu Hause oder mit Ihren eigenen "Cloud" -Diensten zu verbinden oder in Dienste von Drittanbietern usw. zu integrieren. <br><br>  Es ist gut, wenn die Heimverbindung f√ºr einen Gesch√§ftstarif ausgelegt ist. In diesem Fall gibt es keine Probleme mit eingehenden Anforderungen, und die IP-Adresse ist fast immer "wei√ü", statisch. <br><br>  Was tun, wenn am Wohnort der √ºbliche ‚ÄûHeimanbieter‚Äú anwesend ist, der zus√§tzlich nur eine Adresse aus dem privaten Netzwerk bereitstellen kann?  Oder wird eine wei√üe Adresse angegeben, aber traditionell alle eingehenden Nachrichten aus dem privilegierten (&lt;1024) Portbereich abgeschnitten?  Oder Sie sind ein bl√∂der armer Student und k√∂nnen sich einfach keine monatliche Rate leisten, die f√ºr juristische Personen bestimmt ist.  Oder m√ºssen Sie h√§ufig Ihren Wohnort wechseln und die "Habseligkeiten" Ihres virtuellen Servers auf den Buckel ziehen?  Ein Sonderfall ist auch f√ºr Personen relevant, die au√üerhalb der GUS leben, wenn der Anbieter zwangsweise seine eigenen Ger√§te f√ºr die Verbindung zum Internet bereitstellt und Sie die Weiterleitung der ben√∂tigten Ports an die virtuelle Heimfarm au√üerhalb einfach nicht konfigurieren k√∂nnen. <br><br>  Eine L√∂sung besteht darin, einen der VPN-Dienste von Drittanbietern zu verwenden.  Leider erlauben nur wenige von ihnen die Erlaubnis eingehender Verbindungen in Bezug auf den Tunnel, meistens handelt es sich um einen separaten kostenpflichtigen Dienst.  In diesem Fall ist die Auswahl an externen IP-Adressen sehr begrenzt, wenn Sie die Situation mit einer externen IP-Adresse in einem bestimmten Land testen m√∂chten. Dar√ºber hinaus gibt es in der Regel keine Garantie daf√ºr, dass nicht gleichzeitig eine Reihe anderer VPN-Dienstclients an dieser Adresse h√§ngen , oder es wird f√ºr eine lange Zeit statisch sein, was f√ºr das Einrichten von Service-Subdomain-Eintr√§gen in DNS wichtig ist. <br><br>  Es lohnt sich auch (IMHO), trotz einiger perverser Methoden, Ihren eigenen ‚Äûvirtuellen‚Äú Router auf einer externen Cloud-Plattform bereitzustellen, mit der M√∂glichkeit, einen VPN-Tunnel von der Home-Hypervisor-Farm zu dieser virtuellen Maschine in der Cloud zu konfigurieren, wobei die erforderlichen eingehenden Verbindungen von der externen Netzwerkschnittstelle weitergeleitet werden Clouds zu Hause Hypervisor-Dienste.  Und im Idealfall fast nichts f√ºr das Ganze zu bezahlen. <br><br>  Nachdem ich k√ºrzlich meinen Job verloren hatte und damit Zugang zu einer warmen und komfortablen Testfarm f√ºr Unternehmen hatte, aber im Gegenzug viel Zeit erhielt, um meine F√§higkeiten zu aktualisieren, beschloss ich, den Diensten meines Heimhypervisors die M√∂glichkeit zu geben, eingehende Kundenverbindungen zu sehen. <br><br>  Der Autor dieser Zeilen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Äûliebt alle Arten von Infrastrukturperversionen‚Äú</a> . Daher verwenden wir als virtueller Router die kostenlose Instanz von Amazon Web Services (AWS) EC2 t2.micro f√ºr Linux, die anstelle von AWS: VPC (theoretisch) etwas mehr Flexibilit√§t beim Debuggen und bei den Funktionen bietet und die Topologie dieser VPN-Perversion wird unten gezeigt: <br><br><img src="https://habrastorage.org/webt/xs/o5/_k/xso5_kg5gwlm9ozy9pj7udiqxuc.png" alt="Bild"><br><br>  Was sehen wir hier? <br><br>  Unter Linux ist eine kostenlose virtuelle Maschine (Instanz) (750 Stunden pro Monat im Jahr) unter Linux verf√ºgbar, die in AWS: EC2 bereitgestellt wird.  Eingehende Anrufe von einigen Benutzern Ihrer Heimdienste fallen an die externe wei√üe IPv4-Adresse von Elastic IP. Durch die eingehenden (eingehenden) Regeln in den ‚ÄûSicherheitsgruppen‚Äú werden die Ports, die wir ben√∂tigen, der Netzwerkschnittstelle der Instanz zugeordnet. Anschlie√üend werden Pakete dieser Anforderungen √ºber iptables durch den IPSec-Tunnel geleitet Eine virtuelle Maschine f√ºr Windows 2016, bei der RRAS mithilfe des Routings zum gew√ºnschten Dienst in der virtuellen Heimfarm gelangt.  Besonderes Augenmerk legen wir auf das gleichzeitige Vorhandensein von drei NATs: eines in AWS Linux, eines auf dem Router f√ºr das B√ºronetzwerk und eines implizit auf dem Heimrouter. <br><br>  In diesem (meinem) Fall spielt eine virtuelle Maschine unter Windows Server 2016 die Rolle eines Routers zur Simulation eines B√ºronetzwerks und seiner Serverplattform. MS WAP wird auf diesem Computer in Verbindung mit einem separaten Computer mit MS ADFS und anderen bereitgestellt, sodass es kein Problem gibt, ihn durch ein anderes Betriebssystem oder zu ersetzen sogar ein hausgemachtes St√ºck nach Geschmack.  Mit Windows RRAS werden die Dinge √ºbrigens auf dem Weg kompliziert, w√§hrend ich mich mit verschiedenen unangenehmen Momenten befassen musste (√ºber die unten). Wenn Sie also MS Windows Server als Router nicht m√∂gen, ist es mit einem anderen Betriebssystem m√∂glicherweise einfacher. <br><br>  Zuerst erstellen wir ein AWS-Konto, falls Sie noch kein Konto haben.  Es gibt keine Probleme beim Erstellen des Kontos selbst. Sie m√ºssen lediglich die Details Ihrer Plastikkarte angeben, von der 1 USD als Scheck abgebucht (und dann zur√ºckgegeben) wird. <br><br>  Hier sind nur zwei Punkte zu erw√§hnen: <br><br><ol><li>  Gehen Sie unbedingt zu AWS: IAM (Identity and Access Management) und aktivieren Sie MFA (Multi-Factor Authentication) f√ºr Ihr neues Konto, und noch besser, wie AWS empfiehlt - erstellen Sie auch ein separates Konto bei MFA und arbeiten Sie weiterhin an der Einschr√§nkung der entsprechenden Rechte. sie.  Andernfalls k√∂nnten Sie in eine unangenehme Situation geraten, wenn ein Trojaner AWS-Anmeldeinformationen von Ihrem PC stiehlt und beispielsweise jemand auf Ihre Kosten teure Hochleistungsinstanzpl√§ne aus Ihrem Herzen abbaut ... </li><li>  Aus praktischen Gr√ºnden wird empfohlen, eine Budgetbenachrichtigung einzurichten.  Dies erfolgt in den Kontoeinstellungen, der entsprechende Men√ºpunkt hei√üt "Billing &amp; Cost Management Dashboard".  W√§hlen Sie im daraufhin angezeigten Fenster links den Eintrag ‚ÄûBudgets‚Äú aus und konfigurieren Sie das geplante Monatsbudget mithilfe des integrierten Assistenten nach Belieben.  Vergessen Sie nicht, dort eine Warnung einzurichten: Bei √úberschreitung des angegebenen Betrags erhalten Sie sofort eine Nachricht.  Dies ist n√ºtzlich, wenn Sie zuvor noch nicht mit AWS gearbeitet haben und Angst haben, im Verlauf Ihrer Experimente versehentlich eine runde Summe zu erhalten. </li></ol><br>  Als n√§chstes brauchen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS: EC2</a> . <br><br>  Einer der wichtigsten Schritte ist die Auswahl der AWS-Region (im Wesentlichen eines Rechenzentrums), in der wir unsere virtuelle Maschine bereitstellen m√∂chten.  Die Platzierung wirkt sich direkt auf den geografischen Standort Ihres ‚Äûvirtuellen Routers‚Äú und damit auf die Netzwerkverz√∂gerung bei der Arbeit mit ihm aus.  Das ist wichtig, weil  AWS bietet keine Live-Migration zwischen Regionen (der integrierte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS Server-Migrationsdienst</a> kann nur etwas in die AWS-Cloud selbst migrieren). Im Falle eines Platzierungsfehlers ist es einfacher, eine neue Instanz am gew√ºnschten Speicherort erneut zu erstellen.  Alternativ m√ºssen Sie das Image aus der Instanz (Image, integriertes EC2) in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS: S3</a> (Speicherdienst) entfernen und von dort aus dieses Image in die EC2-Instanz in der neuen Region ziehen.  In meinem Fall wurde urspr√ºnglich die Region <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Frankfurt</a> ausgew√§hlt: <br><br><img src="https://habrastorage.org/webt/8c/2s/yh/8c2syhsrly1luamcwjsvbmlnbtg.png" alt="Bild"><br><br>  Wir erstellen eine neue Instanz und w√§hlen links die Option <b>"Nur kostenlose Ebene"</b> aus, wodurch die vorgeschlagene Liste der Bilder auf nur freie beschr√§nkt wird.  Ich habe mich f√ºr <b>"Amazon Linux AMI 2018" entschieden</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mehr</a> √ºber Linux-Distributionen in AWS), weil  unter "Amazon Linux 2 AMI" funktioniert xl2tpd aufgrund der Art des von Amazon zusammengestellten Kernels nicht ordnungsgem√§√ü. <br><br>  Sie k√∂nnen aus der bereitgestellten Liste jedes andere Linux-Image ausw√§hlen, das Ihnen vertraut ist.  Sie k√∂nnen auch tiefer in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS Marketplace</a> einsteigen und dort nach alternativen Images suchen. Lesen Sie einfach die Kommentare zu den Kosten sorgf√§ltig durch: Das Image selbst und die Computerressourcen k√∂nnen kostenlos sein, aber Sie m√ºssen extra f√ºr Speicherplatz usw. bezahlen. <br><br>  Wir w√§hlen den vorgeschlagenen Typ <b>"t2.micro" aus</b> . Er bietet 1 vCPU, 1 GB Speicher, <b>8 bis 30</b> GB (SSD / Magnetic) Speicherplatz und 750 Stunden Arbeit pro Monat f√ºr ein Jahr.  Genug f√ºr unseren ‚Äûvirtuellen Router‚Äú.  Es ist erw√§hnenswert, dass f√ºr alle Instanzen freier Speicherplatz und Arbeitszeit aufgewendet werden. Bei finanziellen Schwierigkeiten m√ºssen Sie also nicht mehr erstellen / ausf√ºhren, als Sie sich leisten k√∂nnen, au√üer kostenlos. <br><br>  Klicken Sie in den Assistenten "Weiter ...". Im dritten Schritt belassen wir alle Standardwerte. Im vierten Schritt stimmen wir den vorgeschlagenen 8 Gigabyte SSD-Standardfestplatte zu. Die Instanz beginnt mit der Schaltfl√§che √úberpr√ºfen und Starten: <br><br><img src="https://habrastorage.org/webt/ta/dv/of/tadvofw_fyn1iozzpgvxiwaswla.png"><br><br>  Danach erhalten wir ein Fenster mit einer Meldung zum Erstellen eines neuen Schl√ºsselpaars f√ºr die Verbindung mit unserem √ºber SSH und einem Vorschlag, dieses Paar zu benennen und den privaten Schl√ºssel im * .pem-Format herunterzuladen.  Wir werden es in Zukunft wirklich brauchen, daher ist es ratsam, es sofort an einem sicheren Ort aufzubewahren.  Wenn diese Datei verloren geht, k√∂nnen Sie keine Remoteverbindung zu Instanzen herstellen, die sie verwenden.  In EC2 gibt es keine M√∂glichkeit, es f√ºr eine vorhandene Instanz erneut zu generieren. Die einzige M√∂glichkeit besteht darin, die Instanzdiskette mit einer anderen Instanz zu verbinden, die Zugriff hat, und anschlie√üend die Schl√ºssel zu bearbeiten. <br><br>  Nach einer Weile wird die Instanz gestartet und verf√ºgt √ºber eine interne (private) und externe (√∂ffentliche) IPv4-Adresse sowie zwei entsprechende DNS-Namen. <br>  Konfigurieren Sie Sicherheitsgruppen sofort, um den Datenverkehr f√ºr die von Ihnen ben√∂tigten Dienste sicherzustellen: <br><br><img src="https://habrastorage.org/webt/ex/rh/7y/exrh7yxlnlqsb36u5pdqifxrdb8.png"><br><br>  Wir ben√∂tigen die offenen eingehenden Ports 500, 1701, 4500 UDP und 4500 TCP f√ºr die Organisation des IPSec L2TP-VPN-Tunnels, HTTP und HTTPS f√ºr die Ver√∂ffentlichung von Home Farm-Diensten. Der externe Zugriff auf die Instanz √ºber SSH wurde beim Erstellen der Instanz automatisch erstellt, da  EC2 enth√§lt im Wesentlichen keinen integrierten Zugriff auf die Konsole der virtuellen Maschine √ºber die Webschnittstelle.  Es gibt nur die M√∂glichkeit, den Bildschirm anzuzeigen: <br><br><img src="https://habrastorage.org/webt/zr/g4/uw/zrg4uw5t3_nihfjq8qaipfwxfkw.png"><br><br>  Es wird empfohlen, den Zugriff √ºber VPN und SSH nur von Ihrer privaten IP-Adresse aus zu konfigurieren.  Die Reihenfolge der Regeln in Sicherheitsgruppen spielt keine Rolle. <br><br>  Da wir mehrere NAT-Dokumentationen verwenden, empfiehlt AWS, die <b>√úberpr√ºfung der Netzwerkquelle / des Netzwerkziels</b> in diesem Fall zu deaktivieren: <br><br><img src="https://habrastorage.org/webt/oa/6m/mg/oa6mmgeh6dyzg6sjxzdj0lkzbne.png"><br><br>  Da wir IPSec-Tunneling und nicht Transport verwenden, ist diese Einstellung f√ºr uns nicht sehr sinnvoll, aber f√ºr alle F√§lle ist es besser, sie auszuschalten. <br><br>  Stellen Sie √ºber SSH eine Verbindung zu unserer Instanz her.  Wenn Sie einen SSH-Grafikclient verwenden, z. B. PuTTY, um eine Verbindung herzustellen, hilft Ihnen die integrierte Hilfe f√ºr die Verbindung, die von RMB auf der Instanz aufgerufen wird -&gt; Verbinden: <br><br><img src="https://habrastorage.org/webt/dc/tm/s1/dctms1dbkmpble2n5vojwkdq3py.png"><br><br>  Amazon Linux verwaltet einen Stammbaum von RHEL und CentOS, daher wird der yum-Paketmanager verwendet. <br><br>  Alle unten beschriebenen Vorg√§nge m√ºssen mit einer Eskalation von Berechtigungen ausgef√ºhrt werden. Daher stellen wir ihnen sudo voran oder arbeiten nur als root. <br><br>  Erstes Update: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum update</span></span></code> </pre> <br>  Als Software zur Organisation eines VPN-Servers verwenden wir eine Kombination aus Libreswan und xl2tpd. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LibreSwan</a> (Fork von Openswan und ein Analogon von strongSwan) ist eine beliebte Implementierung von VPN IPSec und IKE (Internet Key Exchange).  Es kann verschiedene Arten von NAT und ihre Kombinationen korrekt umgehen, was besonders wichtig ist, wenn das IPSec-Tunneling organisiert wird. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">xl2tpd ist</a> ebenfalls weit verbreitet. Sein Hauptvorteil ist die integrierte F√§higkeit, Clientverbindungsparameter beim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Herstellen einer</a> Verbindung √ºber ppp zu authentifizieren und zu √ºbertragen (z. B. IP-Adressen, Standardrouteneinstellungen, DNS-Server usw.), wodurch die Notwendigkeit einer zus√§tzlichen DHCP- und Radius-Bereitstellung f√ºr unsere √ºberfl√ºssig wird einfache Aufgaben. <br><br>  Da xl2tpd nicht in den Standard-Amazon Linux-Repositorys enthalten ist, m√ºssen wir EPEL (Extra Packages for Enterprise Linux) aktivieren: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum-config-manager --enable epel</span></span></code> </pre> <br><h3>  Installieren Sie die erforderlichen Pakete: </h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install libreswan xl2tpd -y</span></span></code> </pre> <br><h3>  Aktivieren Sie das Routing auf Kernelebene: </h3><br>  In die Datei <b>/etc/sysctl.conf</b> schreiben <b>wir</b> : <br><br><pre> <code class="bash hljs">net.ipv4.ip_forward = 1 net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.all.secure_redirects = 1 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.default.secure_redirects = 0 net.ipv4.conf.default.send_redirects = 0 net.ipv4.conf.lo.accept_redirects = 0 net.ipv4.conf.lo.secure_redirects = 0 net.ipv4.conf.lo.send_redirects = 0 net.ipv4.conf.eth0.accept_redirects = 0 net.ipv4.conf.eth0.secure_redirects = 0 net.ipv4.conf.eth0.send_redirects = 0 net.ipv4.conf.all.rp_filter = 0 net.ipv4.conf.default.rp_filter = 0 net.ipv4.conf.eth0.rp_filter = 0</code> </pre><br>  <b>Deaktivieren Sie rp_filter</b> in der aktuellen Sitzung, um keinen Neustart <b>durchzuf√ºhren</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># for f in /proc/sys/net/ipv4/conf/*/rp_filter ; do # echo 0 &gt; $f # done</span></span></code> </pre><br>  Wir √ºbernehmen die Einstellungen und pr√ºfen die Verf√ºgbarkeit des Routings: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sysctl -p /etc/sysctl.conf # cat /proc/sys/net/ipv4/ip_forward</span></span></code> </pre><br>  Wir m√ºssen sicherstellen, dass eingehende (in Bezug auf die √∂ffentliche Schnittstelle der Instanz) Pakete von den Ports der erforderlichen Dienste an unseren zuk√ºnftigen IPSec-Tunnel weitergeleitet werden.  Dazu ist es nicht nur erforderlich, diese Pakete zu de- <b>NATen</b> , sondern auch die Maskierung auf der <b>ppp0-</b> Schnittstelle <b>durchzuf√ºhren</b> . <br>  Wir werden hierf√ºr die integrierten <b>iptables-</b> Funktionen verwenden, die im Fall von Amazon Linux zun√§chst so konfiguriert sind, dass jeglicher Datenverkehr in jede Richtung vollst√§ndig zugelassen wird: <br><br>  DNAT der erforderlichen Ports erstellen: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 80 -j DNAT --to-destination 10.100.0.2:80 # iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 443 -j DNAT --to-destination 10.100.0.2:443</span></span></code> </pre> <br>  Leiten Sie alle Pakete, die an diese Ports kamen, an die Windows-Gate-Adresse weiter: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 80 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT # iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</span></span></code> </pre> <br>  Maskieren Sie diese Pakete: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</span></span></code> </pre><br>  Es ist ratsam, die iptables-Regeln beizubehalten, damit sie beim Neustart der Instanz automatisch versch√§rft werden: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># service iptables save</span></span></code> </pre> <br>  In diesem Fall verwenden wir den DNAT (Destination NAT) des erforderlichen TCP-Ports von der Netzwerkschnittstelle eth0 der Instanz in Richtung der IPv4-Adresse 10.100.0.2, die die Adresse auf der PPP-Schnittstelle des RRAS-Dienstes unseres Windows-Gates im Home-Hypervisor ist. <br><br>  Das Folgende ist ein sehr wichtiger Punkt: Da die Dienste im Hypervisor in der Lage sein m√ºssen, auf von der AWS-Instanz empfangene Anforderungen zu antworten, muss vor dem Senden des Pakets eine Maskierung (Ersetzen der Absenderadresse) auf der <b>ppp0-</b> Schnittstelle der Instanz <b>bereitgestellt</b> werden. Andernfalls geht die Antwort in eine v√∂llig andere Richtung: von Das Windows-Gate im Hypervisor f√ºhrt hinter dem IPSec-Tunnel direkt zum Standard-Router (Home-Router). Dadurch wird es nat√ºrlich auf der Clientseite des Dienstes gel√∂scht, als stamme es von einer nicht angeforderten Ressource.  Wenn Maskierung im Paket-Header am Eingang zum VPN-Tunnel verwendet wird, √§ndert sich die Absenderadresse von der Adresse irgendwo im Internet zu der Adresse <b>ppp0 der</b> Schnittstelle der AWS-Instanz: EC2, d. H.  in meinem Fall um 10.100.0.1 <br><br>  Als Alternative zur Verwendung von iptables f√ºr andere Linux-Distributionen oder * NIX-Systeme k√∂nnen Sie das gute alte rinetd empfehlen, bei dem dies alles in der Regel in einer Zeile in der <b>Konfiguration rinetd.conf erfolgt</b> : <br><br><pre> <code class="bash hljs">&lt;ip <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;port <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;ip destination&gt; &lt;port destination&gt;</code> </pre> <br>  Das einzige, was in diesem Fall im Kernel aktiviert werden muss, ist die M√∂glichkeit des Routings / NAT-Verkehrs. <br><br><h3>  Es ist Zeit, Libreswan zu kochen. </h3><br>  Die Datei <b>/etc/ipsec.conf</b> enth√§lt Anweisungen zum Herunterladen aller .conf-Dateien von /etc/ipsec.d/. Daher erstellen wir eine neue Konfigurationsdatei im Verzeichnis /etc/ipsec.d/aws_vpn.conf und f√ºgen sie hinzu: <br><br><pre> <code class="bash hljs">config setup <span class="hljs-comment"><span class="hljs-comment">#       # plutostderrlog=/var/log/pluto.log # logfile=/var/log/pluto.log # plutodebug = all #  NAT-T -   NAT- nat_traversal=yes oe=off protostack=netkey nhelpers=0 interfaces=%defaultroute conn aws_vpn type=tunnel auto=start forceencaps=yes pfs=no fragmentation=yes authby=secret left=%defaultroute #   &lt;‚Ä¶&gt;      Elastic IP leftid=&lt;‚Ä¶&gt; #   &lt;‚Ä¶&gt;     (172...) leftsubnet=&lt;‚Ä¶&gt;/32 leftnexthop=%defaultroute leftprotoport=17/1701 rightprotoport=17/%any right=%any rightsubnetwithin=0.0.0.0/0 rightsubnet=vhost:%priv</span></span></code> </pre><br>  Der Einfachheit halber verwenden wir die IPSec-Authentifizierung basierend auf einem gemeinsam genutzten Schl√ºssel (PSK) und nicht auf Zertifikaten. Daher m√ºssen wir ihn explizit angeben.  Die Datei <b>/etc/ipsec.secrets</b> enth√§lt Anweisungen zum Herunterladen aller .secrets-Dateien von <b>/etc/ipsec.d/</b> . Dort erstellen wir eine neue Datei <b>/etc/ipsec.d/aws_vpn.secrets</b> und geben die PSK im folgenden Format an: <br><br><pre> <code class="bash hljs">&lt;     172...&gt; %any : PSK <span class="hljs-string"><span class="hljs-string">"&lt; PSK&gt;"</span></span></code> </pre> <br>  Als Beispiel: <br><br><pre> <code class="bash hljs">172.31.20.120 %any : PSK <span class="hljs-string"><span class="hljs-string">"Pa$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$w0rd</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  Da die ppp-Verbindung innerhalb des IPSec-Tunnels verwendet wird und es eine eigene Authentifizierung gibt, konfigurieren wir sie auch: <br>  Wir geben den Benutzernamen und das Passwort in die Datei <b>/ etc / ppp / chap-secret</b> im folgenden Format ein: <br><br><pre> <code class="bash hljs">&lt;user&gt; * &lt;password&gt; *</code> </pre> <br>  Als Beispiel: <br><br><pre> <code class="bash hljs">aws_user * Pa$<span class="hljs-variable"><span class="hljs-variable">$w0rd</span></span> *</code> </pre> <br>  Bei der Verbindung mit dem ppp-Client k√∂nnen eine Reihe von Optionen √ºbergeben werden, um die Netzwerkschnittstelle und die Routing-Tabelle zu konfigurieren. <br><br>  <b>Legen Sie in der</b> Datei <b>/etc/ppp/options.xl2tpd</b> die <b>folgenden</b> Optionen fest: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  xl2tpd  ip   ipcp-accept-local ipcp-accept-remote #    defaultroute   Windows-    nodefaultroute noccp auth #   RRAS  Windows-  mschap-v2   require-mschap-v2 #   MTU  MRU mtu 1410 mru 1410 lock</span></span></code> </pre><br>  Weil  Wir m√ºssen keine DNS-, Wins- usw. Adressen an den Client weitergeben.  Dinge - alle anderen Optionen m√ºssen auskommentiert werden. <br><br>  Hier ben√∂tigen Sie eine Erl√§uterung der Konfiguration. <br><br>  Das Standardverhalten f√ºr VPN-Verbindungen besteht darin, eine neue Standardroute in der Client-Tabelle zu installieren, die den gesamten Datenverkehr von dieser zum Internet zwingt, √ºber den VPN-Server zu "gehen".  In unserem Fall ist das falsch, weil  Das Ziel des Windows-Gates besteht darin, einen simulierten Zugriff auf das Internet des dahinter liegenden virtuellen B√ºronetzwerks im Hypervisor bereitzustellen und die Ressourcen interner Dienste √ºber AWS: EC2 nach au√üen zu ver√∂ffentlichen. Daher ist es irrational, den gesamten Datenverkehr √ºber die Instanz an AWS: EC2 weiterzuleiten.  Aus diesem Grund m√ºssen Sie verhindern, dass eine VPN-Verbindung in RRAS die Standardroute (zu einem Heimrouter) √§ndert. <br><br>  Es ist auch wichtig, die richtigen MTU- und MRU-Werte auszuw√§hlen: Wir verwenden IPSec-Tunneling und eine zu gro√üe Nutzlast passt m√∂glicherweise nicht in die Kapselungsgrenze, was zu Fragmentierung und h√∂chstwahrscheinlich zu einem Fehler f√ºhrt.  Wenn dies angezeigt wird, versuchen Sie zun√§chst, diese Werte beispielsweise auf 1280 zu reduzieren. Die in der angegebenen Konfiguration angegebenen Werte sind mit dem Windows VPN-Client kompatibel. <br><br><h3>  Es bleibt xl2tpd zu konfigurieren </h3><br>  Wir konfigurieren alles Notwendige in der Konfigurationsdatei xl2tpd <b>/etc/xl2tpd/xl2tpd.conf</b> : <br><br><pre> <code class="bash hljs">[global] port=1701 ipsec saref = yes ; ,      ;debug tunnel = yes ;debug avp = yes ;debug network = yes ;debug state = yes ;debug tunnel = yes [lns default] name = AWSvpnServer ;       ppp ip range = 10.100.0.2-10.100.0.2 ;    ppp0 AWS:EC2  <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> ip = 10.100.0.1 require authentication = yes require chap = yes refuse pap = yes pppoptfile = /etc/ppp/options.xl2tpd length bit = yes</code> </pre><br><h3>  Wir √ºberpr√ºfen alles, was wir getan haben </h3><br>  Wir versuchen beide Dienste auszuf√ºhren und die Konfigurationen zu √ºberpr√ºfen: <br><br><pre> <code class="bash hljs">service ipsec start service xl2tpd start ipsec verify</code> </pre><br>  M√∂glicherweise werden Dienste bereits ausgef√ºhrt. In diesem Fall werden sie einfach neu gestartet. <br><br>  Wenn alles in Ordnung ist, sollte die Ausgabe von ipsec verify dem Screenshot √§hnlich sein: <br><br><img src="https://habrastorage.org/webt/o1/rv/br/o1rvbrchcizb6jn9qewgrj_hrn4.png"><br><br>  Sie k√∂nnen xl2tpd interaktiv debuggen, indem Sie es mit dem Schalter -D ausf√ºhren und mit dem <b>Bildschirmdienstprogramm</b> in einem separaten ‚ÄûFenster‚Äú des SSH-Terminals aufh√§ngen: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># xl2tpd -D</span></span></code> </pre> <br>  In diesem Fall tritt der xl2tpd-Prozess nicht in den Hintergrund, sondern zeigt alle seine Aktivit√§ten auf dem Terminalbildschirm an. <br><br>  Bei Problemen m√ºssen Sie die Debugging-Optionen in den Konfigurationen auskommentieren (siehe Kommentare) und den Inhalt der Systemprotokolle und der Datei <b>/var/log/pluto.log √ºberpr√ºfen</b> .  Beachten Sie auch den Inhalt der Option <b>virtual_private / virtual-private</b> in der Datei <b>/etc/ipsec.conf</b> . Sie listet alle privaten Netzwerke auf, die f√ºr den Datenaustausch √ºber IPSec verf√ºgbar sind.  Wenn Sie aus irgendeinem Grund eine eigene Adressierung haben, z. B. einen eigenen Pool wei√üer IPv4-Adressen verwenden, sollten Sie √Ñnderungen an diesem Parameter vornehmen. <br><br><h3>  Fahren wir mit dem letzten Schritt fort: Einrichten des RRAS-Dienstes im Windows-Gate und √úberpr√ºfen der Ver√∂ffentlichung von Diensten aus dem Internet </h3><br>  Es wird davon ausgegangen, dass Ihr Heimhypervisor √ºber eine virtuelle Maschine unter Windows 2012R2 oder h√∂her verf√ºgt, die im grafischen Modus (Desktop) bereitgestellt wird, und dass diese virtuelle Maschine zwei Netzwerkadapter enth√§lt: Einer "schaut" in das Heimnetzwerk und hat einen Heimrouter als Standardroute und das andere in ein virtuelles lokales "B√ºro" -Netzwerk, in dem Dienste au√üerhalb ver√∂ffentlicht werden.  Eine Windows-Dom√§ne ist optional, es sei denn, die Dienste selbst erfordern dies. <br><br>  Wir installieren alle erforderlichen Rollen mithilfe des Server-Managers oder des Cmdlets PowerShell <b>Install-WindowsFeature</b> : <br><br><img src="https://habrastorage.org/webt/lv/vw/ul/lvvwull1qus2dpgplvaxfvjv_gq.png"><img src="https://habrastorage.org/webt/pc/ag/80/pcag80h9dc8jq6gtim8jbdoeseq.png"><br><br>  Hier demonstriere ich die Installation von Rollen durch Grafiken, da es dann noch viel bequemer ist, den Setup-Assistenten vom Server-Manager aus aufzurufen und den RRAS-Dienst selbst im Zeitplan zu konfigurieren, was uns mit der guten alten Oberfl√§che aus der Zeit von Windows Server 2003 gefallen wird: <br><br><img src="https://habrastorage.org/webt/ai/rx/hz/airxhzrmjcbvyopop4rt_rcu4ga.png"><br><br>  Klicken Sie auf Ihrem Server auf RMB, w√§hlen Sie <b>"Routing und RAS konfigurieren und aktivieren"</b> und konfigurieren Sie dann manuell: <br><br><img src="https://habrastorage.org/webt/na/gj/bc/nagjbch0d6jxmyjzgywhnqqe17s.png"><br><br>  Sie k√∂nnen alle Dohlen ausw√§hlen, den Assistenten abschlie√üen und den Dienst starten: <br><br><img src="https://habrastorage.org/webt/ku/ir/sq/kuirsqjvnmskwfjrikybcl2kacu.png"><br><br>  Lassen Sie uns zun√§chst unser virtuelles lokales Netzwerk au√üerhalb freigeben.  Wir gehen zu IPv4-&gt; NAT und erstellen eine neue Schnittstelle, da die vorhandene Schnittstelle, auf der NAT implementiert wird, die externe Schnittstelle (die im Internet bzw. in Ihrem Heimnetzwerk angezeigt wird) ausgew√§hlt, als √∂ffentlich markiert und NAT darauf aktiviert wird: <br><br><img src="https://habrastorage.org/webt/gk/zh/lx/gkzhlxjyvjsgkhdnfvaqyhcn3xo.png"><img src="https://habrastorage.org/webt/kw/wx/xw/kwwxxw5u1gtezu2moo-3beokuli.png"><br><br>  Wir √ºberpr√ºfen, wie der Datenverkehr aus dem virtuellen LAN durch unser Gate abflie√üt.  Wir m√ºssen die Windows-Firewall noch nicht konfigurieren. <br><br>  Wenn alles in Ordnung ist, werden wir endlich das schaffen, wof√ºr wir gek√§mpft haben, eine VPN-Verbindung zu unserer AWS-Instanz und die Ver√∂ffentlichung unserer Dienste √ºberpr√ºfen.  Wir gehen im RRAS-Snap-In zu <b>‚ÄûNetzwerkschnittstellen‚Äú</b> und erstellen eine neue Demand-Dial-Schnittstelle mit einem beliebigen Namen: <br><br><img src="https://habrastorage.org/webt/-v/04/yx/-v04yxa-najhry2evwovvtydsby.png"><br><br>  W√§hlen Sie sofort die L2TP-Verbindung aus, damit unsere neue Schnittstelle nicht automatisch versucht, den VPN-Typ zu ermitteln, und dadurch eine schnellere Verbindung herstellt: <br><br><img src="https://habrastorage.org/webt/jg/mw/xb/jgmwxbg1nzbih2grilgopxrlfv8.png"><br><br>  Weiter im Assistenten geben wir die √∂ffentliche Adresse unserer Cloud an (in meinem Fall Elastic IP).  Lassen Sie in den n√§chsten Schritten alles so wie es ist, weil  Wir ben√∂tigen keine Site-to-Site-Verbindung: <br><br><img src="https://habrastorage.org/webt/fa/fn/p7/fafnp7fmggqxnbmosjcpdkx1wck.png"><img src="https://habrastorage.org/webt/d1/zc/wm/d1zcwmsgomejupu7if4ynp2rqjk.png"><br><br>  Geben Sie das Benutzerkonto an, unter dem wir die ppp-Verbindung konfiguriert haben (in der Datei <b>/ etc / ppp / chap-secret</b> ).  Es ist kein Domainname erforderlich: <br><br><img src="https://habrastorage.org/webt/zc/to/ei/zctoei91of_eyji6fncqhgvcii4.png"><br><br>  Der Assistent erstellt eine neue Verbindung.  Jetzt bleibt es zu konfigurieren.  Wir werden das Leerlaufzeitlimit (Leerlaufzeit) anpassen, das veraltete CHAP zugunsten von nur MS-CHAPv2 entfernen und den PSK-Schl√ºssel in den "Erweiterten Eigenschaften" angeben (der f√ºr xl2tpd in der Datei /etc/ipsec.d/aws_vpn festgelegt wurde). Geheimnisse) und IPv6 entfernen: <br><br><img src="https://habrastorage.org/webt/a0/qf/tf/a0qftfatglil4qkjv-hyn5hzvlc.png"><img src="https://habrastorage.org/webt/ax/hy/hu/axhyhuwgchr9z2vhmel17jjbx1s.png"><img src="https://habrastorage.org/webt/vq/xl/qz/vqxlqzejzpi3rs0i9x0r5ol9fkg.png"><img src="https://habrastorage.org/webt/km/ro/um/kmroumh0brc2_yq3przzb-a7jm8.png"><br><br>  Nach dem Erstellen einer neuen Schnittstelle m√ºssen Sie auch die Eigenschaften des RRAS-Dienstes selbst aufrufen, Ihre IPSec-Richtlinie f√ºr L2TP aktivieren und Ihr PSK angeben.  Sie werden aufgefordert, den RRAS-Dienst neu zu starten. <br><br><img src="https://habrastorage.org/webt/h8/0w/zk/h80wzkz1pfymizhrqruvwrgj9di.png"><br><br>  Es scheint, dass alles sicher eine neue Oberfl√§che aufgerufen werden kann und die Arbeit genie√üen kann.  Aber nein.  Aufgrund der Tatsache, dass wir NAT auf der Seite der AWS: EC2-Instanz verwendet haben, kann der Windows-VPN-Client keine Verbindung zu einem solchen Nat-Traversal-Knoten herstellen.  Dies gilt sowohl f√ºr Client-Versionen (bis zum Zeitpunkt des Schreibens dieses Artikels des Windows 10-Builds) als auch f√ºr Server-Versionen. <br><br>  Gl√ºcklicherweise gibt es eine offizielle L√∂sung f√ºr dieses Problem in Form von √Ñnderungen in der Registrierung der IPSec Policy Service-Einstellungen, gefolgt von einem Neustart: <br><br>  An die Adresse <br>  <b>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ PolicyAgent</b> <br>  Erstellen Sie einen DWORD-Schl√ºssel (32-Bit) <br>  <b>Angenommen, UDPEncapsulationContextOnSendRule = 2</b> <br>  und starten Sie unser Windows Gate neu. <br><br>  Der RRAS-Dienst ist leider f√ºr seine launische Konfiguration und Bedienung bekannt und f√ºhrt auch nach einem Neustart einen verz√∂gerten Start durch.  So k√∂nnen Sie es nach einem Neustart beschleunigen. <br>  Wenn alles richtig gemacht wurde, funktioniert die Verbindung innerhalb von 5-10 Sekunden. <br><br>  Es bleibt die Ver√∂ffentlichung der erforderlichen Ressourcen auf dem Windows-Gate selbst. <br><br>  F√ºr den Test werden wir die Ver√∂ffentlichung des Webservers ausarbeiten.  Schauen Sie sich zuerst unseren IPSec-Tunnel und die iptables-Regeln an. <br><br>  Mit zitternden H√§nden pr√ºfen wir von einem beliebigen PC aus, der mit dem Internet verbunden ist: <br><br><img src="https://habrastorage.org/webt/ho/yg/c-/hoygc-blrya-dt30hytsmdruezg.png"><img src="https://habrastorage.org/webt/8v/yc/q7/8vycq7c2bsc6dqjcc3t7qzcacje.png"><br><br>  Wow, es funktioniert ... <br><br>  W√§hrend der Installation der erforderlichen Rollen wurde der "native" MS IIS zwangsweise installiert, aber wir m√∂chten, dass es noch einfacher wird.  Auf einer Windows-Plattform ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>HFS</b></a> (HTTP File Server) daf√ºr gut geeignet - es ist kostenlos, erfordert keine Installation, gibt eine bestimmte Seite und einen bestimmten HTTP-Header an und kann an einem beliebigen Port arbeiten (standardm√§√üig ist es 8080, in unserem Fall muss es also auf 80 neu konfiguriert werden). Au√üerdem wird sofort in die Konsole geschrieben, woher die Verbindung stammt. Dies ist sehr praktisch, um die Ver√∂ffentlichung vieler Webressourcen auf der Windows-Plattform zu debuggen.  Um es zu verwenden, m√ºssen Sie zuerst die MS IIS-Site stoppen, um den eingebetteten Server vom erforderlichen Port zu trennen.  Da wir die MS IIS-Verwaltungskonsole nicht installieren m√∂chten (die MS IIS 6-Konsole ist aus Kompatibilit√§tsgr√ºnden vorhanden, IIS 7+ kann jedoch nicht √ºber sie gesteuert werden), f√ºhren wir dies √ºber PowerShell aus: <br><br><pre> <code class="bash hljs">Stop-WebSite -Name <span class="hljs-string"><span class="hljs-string">"Default Web Site"</span></span></code> </pre> <br>  oder einfach √ºber das iisreset-Verwaltungsdienstprogramm: <br><br><pre> <code class="bash hljs">iisreset /stop</code> </pre> <br>  Danach m√ºssen Sie eingehenden Datenverkehr zu Port 80 in der integrierten Windows-Firewall zulassen. <br>  Wir starten HFS und √ºberpr√ºfen: <br><br><img src="https://habrastorage.org/webt/ti/u2/bc/tiu2bcpm3ynhzteryfe9njxvfq4.png"><br><br>  Alles ist gro√üartig.  Wir haben erreicht, dass Sie von √ºberall im Internet den Webserver, der in unserem Haus lebt, als virtuelle Maschine in einem beliebigen Hypervisor sehen k√∂nnen. <br><br>  Der letzte Schliff: Wir bringen RRAS bei, alle derartigen Anfragen von au√üen an das virtuelle B√ºronetzwerk weiterzuleiten, wo wir der Legende nach einen anderen Webserver haben. <br><br>  Dazu rufen wir erneut das RRAS-Verwaltungs-Snap-In in IPv4-&gt; NAT und RMB auf unserer VPN-Schnittstelle auf. Dort w√§hlen wir die Registerkarte <b>‚ÄûDienste und Ports‚Äú aus</b> , markieren sie in der Liste der Webserver und geben den Webserver im internen virtuellen Netzwerk an, auf dessen Ressourcen wir ver√∂ffentlichen m√∂chten Internet: <br><br><img src="https://habrastorage.org/webt/d7/bq/jv/d7bqjv0ir3a2l8w4vzxpdax8nra.png"><br><br>  Klicken Sie auf OK und ... alles ist fertig.  Wir √ºberpr√ºfen - alles sollte gut funktionieren. <br><br>  Auf diese einfache Weise k√∂nnen Sie schnell fast alle Dienste und Ressourcen ver√∂ffentlichen, von Websites √ºber Mailserver bis hin zu komplexen Integrationen.  F√ºr die meisten von ihnen ben√∂tigen Sie nat√ºrlich eine eigene DNS-Domain, in der Sie Subdomains erstellen und die erforderlichen Eintr√§ge bearbeiten k√∂nnen.  Es ist auch ratsam, SSL-Zertifikate zum Ver√∂ffentlichen von Webressourcen zu verwenden. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dank LetsEncrypt</a> und √§hnlichen ACME-kompatiblen Diensten kann dies v√∂llig kostenlos und mit automatischer Aktualisierung erfolgen. <br><br>  Wenn Sie die Instanz neu starten, √§ndert sich die √∂ffentliche IPv4-Adresse nicht - nur wenn sie gestoppt wird. Es wird jedoch weiterhin empfohlen, eine statische IPv4-Adresse in AWS: EC2 zu verwenden.  Statisch in dem Sinne, dass Ihre Instanz beim Ausschalten dieser Instanz zugewiesen bleibt und nicht in den allgemeinen freien Pool f√§llt.  Dies ist nat√ºrlich erforderlich, um nicht jedes Mal die Neukonfiguration von DNS-Eintr√§gen in Dom√§nen zu st√∂ren, und niemand hat TTL mit Caching abgebrochen.  Es kostet viel Geld und wird, wie oben bereits erw√§hnt, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Elastic IP genannt</a> . <br><br><h3>  Primitive Prozessautomatisierung </h3><br>  Abschlie√üend m√∂chte ich eine weitere gro√üartige Funktion von AWS erw√§hnen: EC2 - schnelle Konfiguration der bereitstellbaren Instanz.  In AWS: EC2 gibt es viele schnelle Bereitstellungsoptionen, bis hin zu speziellen (und recht komplexen, aber sehr leistungsf√§higen) Diensten. Die einfachste: In Schritt 3 des Assistenten zum Erstellen einer neuen Instanz befindet sich unten das Feld <b>"Benutzerdaten"</b> .  Sie k√∂nnen ein Bash-Skript oder sogar PowerShell (im Fall einer Instanz unter Windows) einf√ºgen. Dieses Skript wird unmittelbar nach dem Erstellen der Instanz automatisch ausgef√ºhrt. <br>  Das hei√üt,  Sie k√∂nnen alle oben genannten Befehle und Konfigurationen leicht √§ndern, um Ihr eigenes Bash-Skript zu erstellen und damit schnell einen solchen virtuellen AWS: EC2-Router zu starten.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erfahren Sie mehr √ºber diese Funktion</a> . <br><br>  Vielen Dank, dass Sie sich die Zeit genommen haben, diesen Artikel zu lesen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de470047/">https://habr.com/ru/post/de470047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de470029/index.html">Extreme P√§dagogik: ‚ÄûWir wissen‚Äú √ºber die Langzeitbehandlung mit Kindern</a></li>
<li><a href="../de470033/index.html">F # 2: FSI-Umgebung</a></li>
<li><a href="../de470035/index.html">Wahngenerator: Erstellen Sie Texte in einer beliebigen Sprache mithilfe eines neuronalen Netzwerks</a></li>
<li><a href="../de470043/index.html">Die Wissenschaft dahinter, wie unser Gehirn am besten funktioniert und wie Technologie und unsere Umwelt helfen k√∂nnen</a></li>
<li><a href="../de470045/index.html">Visual Studio f√ºr Mac: Top-Funktionen des neuen Editors</a></li>
<li><a href="../de470049/index.html">Einf√ºhrung in NuGet Package Management auf L√∂sungsebene in Visual Studio f√ºr Mac</a></li>
<li><a href="../de470051/index.html">Neurowissenschaften: Wenn unser Gehirn am besten funktioniert und wie Technologie helfen kann</a></li>
<li><a href="../de470055/index.html">Einf√ºhrung in NuGet Package Management auf L√∂sungsebene in Visual Studio f√ºr Mac</a></li>
<li><a href="../de470057/index.html">Visual Studio f√ºr Mac: 5 neue coole Funktionen</a></li>
<li><a href="../de470061/index.html">Wie man weniger Code schreibt und mehr Sinn bekommt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>