<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯОе ЁЯПЩя╕П тЮ░ рд▓рд╛рдареА рдФрд░ рдХрд╛рдЙрдВрдЯрд░ рд░рд┐рд╕рд╛рд╡ рд╕рдВрд░рдХреНрд╖рдг ЁЯСКЁЯП╗ ЁЯСНЁЯП╛ ЁЯеЦ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдирдорд╕реНрддреЗред рдРрд╕реА рдХреЛрдИ рдмрд╛рдд рдирд╣реАрдВ рд╣реИ - рдЕрдЧрд░ рдПрдХ рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рд░рд┐рд╕рд╛рд╡ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рд╛рдЗрдбреНрд░реЛрдХреНрд▓реВ \ рдиреЗрдкреНрдЪреНрдпреВрди \ _- рдПрдВрдХрд╡рд╛рд╕реНрддреЛрд░реЛрдЬрд╝реЛ - рдкрд╛рдиреА рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рд╕рд┐рджреНрдзрд╛рдВрдд рд╕рд░рд▓ рд╣реИ -...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд▓рд╛рдареА рдФрд░ рдХрд╛рдЙрдВрдЯрд░ рд░рд┐рд╕рд╛рд╡ рд╕рдВрд░рдХреНрд╖рдг</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/399459/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдорд╕реНрддреЗред рдРрд╕реА рдХреЛрдИ рдмрд╛рдд рдирд╣реАрдВ рд╣реИ - рдЕрдЧрд░ рдПрдХ рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рд░рд┐рд╕рд╛рд╡ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рд╛рдЗрдбреНрд░реЛрдХреНрд▓реВ \ рдиреЗрдкреНрдЪреНрдпреВрди \ _- рдПрдВрдХрд╡рд╛рд╕реНрддреЛрд░реЛрдЬрд╝реЛ - рдкрд╛рдиреА рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рд╕рд┐рджреНрдзрд╛рдВрдд рд╕рд░рд▓ рд╣реИ - рдПрдХ рдкрд╛рдиреА рд╕реЗрдВрд╕рд░ + рд╕реНрд╡рдЪрд╛рд▓рди + рд╡рд┐рджреНрдпреБрдд рдирд▓ рдХреА рдПрдХ рдЬреЛрдбрд╝реАред рд▓реЗрдХрд┐рди рд╢реИрддрд╛рди, рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рд╡рд┐рд╡рд░рдг рдореЗрдВ рд╣реИ: рдХреИрд╕реЗ рдирд▓ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреА рдЬрд╛рддреА рд╣реИ, рд░рд┐рд╕рд╛рд╡ рд╕реЗрдВрд╕рд░ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреИрд╕реЗ рдХреА рдЬрд╛рддреА рд╣реИ, рдФрд░ рдХреНрдпреЛрдВ рдПрдХ рдХреА рд▓рд╛рдЧрдд 50 рд░реВрдмрд▓ рдФрд░ рджреВрд╕рд░реЗ рдХреА рд▓рд╛рдЧрдд 500 рд░реВрдмрд▓ рд╣реИред рдПрдХ рдХрд┐рд▓реЛрдЧреНрд░рд╛рдо рдХрд╛ рдПрдХ рдмреБрд▓реЗрдЯрд┐рди рдЗрд╕ рдкреВрд░реА рдЪреАрдЬрд╝ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рд▓рдкреЗрдЯрд╛ рдЬрд╛рдПрдЧрд╛, рдкреИрдХреЗрдЬрд┐рдВрдЧ рдЖрдкрдХреА рдЖрдБрдЦреЛрдВ рдХреЛ рдмрд╛рд╣рд░ рд▓реЗ рдЬрд╛рдПрдЧреА, рдЖрджрд┐ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд╣рд╛рдиреА рдореЗрдВ рдореИрдВ рд╕рд┐рд╕реНрдЯрдо рдХреА рдИрдВрдЯреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓реВрдВрдЧрд╛, рдЬрд┐рд╕рдиреЗ рдореБрдЭреЗ рдкрд╕рдВрдж рдореЗрдВ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ред рдкреВрд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдлреИрдХреНрдЯреНрд░реА рд╕реЗрдВрд╕рд░ рдкрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдкрд╛рд░реНрдЯрд┐рдХрд▓ (рдПрдХреНрд╕ред рдПрд╕рдкреАрдЖрд░) рдлреЛрдЯреЙрди (рдРрд╕реЗ рдПрд╕реНрдк 8266 рдЬрд┐рд╕рдореЗрдВ рдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ рд╡рд╛рдпрд░рд┐рдВрдЧ рдкрд░ рдХреНрд▓рд╛рдЙрдб-рдЖрдзрд╛рд░рд┐рдд рдЖрдИрдбреАрдИ рд╣реИ) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рдШрд░-рдирд┐рд░реНрдорд┐рдд рдирд┐рдпрдВрддреНрд░рдХ рд╣реИ, рдбрд┐рд╡рд╛рдЗрд╕ рдмреЗрд╕ рдмреНрд░реЙрдбрдХреЙрдо рд╕реЗ рдПрд╕рдЯреАрдПрдо рдирд┐рдпрдВрддреНрд░рдХ рдпрд╛ рд╡рд╛рдИрдлрд╛рдИ рдореЙрдбреНрдпреВрд▓ рд╣реИред рдпрд╣ рд╕рдм рдСрд░реЗрдВрдЬ рдкрд╛рдИ рд╡рди рдкрд░ рдПрдХ рдУрдкрдирд╣реИрдм рд╕рд░реНрд╡рд░ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИред</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/715/6ee/aa2/7156eeaa28b44479a5d5aff2e63ff89c.png" width="600"></div><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╕рдорд╛рдкреНрдд рдкреНрд░рдгрд╛рд▓реА рдХреНрдпреЛрдВ рдирд╣реАрдВ? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - рдХреНрдпреЛрдВрдХрд┐ рдореИрдВ рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ рдФрд░ рдпрд╣ рдЙрдЪреНрдЪ рд╣реИ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - рдмрд╛рд╣рд░реА рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг рддреИрдпрд╛рд░-рдирд┐рд░реНрдорд┐рдд рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдореЗрдВ рд▓рдВрдЧрдбрд╝рд╛ рд╣реИред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - рддреИрдпрд╛рд░ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рд╕рд╣рд╛рдпрдХ рдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ - рдореАрдЯрд░ рд░реАрдбрд┐рдВрдЧ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рдкрд╛рдиреА рдХрд╛ рддрд╛рдкрдорд╛рди рд╕реЗрдВрд╕рд░, рдкрд╛рдиреА рдХреА рдирд┐рдХрд╛рд╕реА рдХреА рдЕрдзрд┐рд╕реВрдЪрдирд╛ рдФрд░ рдЕрдиреНрдп рдЪрд▓рдиреЗ рд╡рд╛рд▓реА рдХрд╛рдореБрдХ рдХрд▓реНрдкрдирд╛рдПрдВред</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ рдХреНрд░реЗрди рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореВрд░реНрдЦрддрд╛рдкреВрд░реНрдг рддрд░реАрдХреЗ рд╕реЗ рдЯреЛрдХрд╝ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдорд╛рдереЗред рдХреБрдЫ рд╕рдордп рдХреЗ рд▓рд┐рдП рд╡рд╣ рдЙрдкрдирдЧрд░реЛрдВ рдореЗрдВ рд░рд╣рддрд╛ рдерд╛, рдЬрд╣рд╛рдБ рдкрд╛рдиреА рдХреА рдЧреБрдгрд╡рддреНрддрд╛ (рдЬреИрд╕реЗ рдХрд┐ рдЬрд╝рдордХрд╛рдбреЗ рдореЗрдВ рд╣рд░ рдЬрдЧрд╣) рд╡рд╛рдВрдЫрд┐рдд рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдХреБрдЫ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИред рддреЛ рдЧреЗрдВрдж рд╡рд╛рд▓реНрд╡ 1/2 рдЗрдВрдЪ рдпрджрд┐ рдЖрдк рд╡рд░реНрд╖ рдХреЛ рдирд╣реАрдВ рдЫреВрддреЗ рд╣реИрдВ - рдЗрд╕реЗ рдЪрд╛рд▓реВ рдХрд░рдирд╛ рдмрд╣реБрдд рдореБрд╢реНрдХрд┐рд▓ рд╣реИред рдФрд░ 1 рдЗрдВрдЪ рдЧрд░реНрдо рддреМрд▓рд┐рдпрд╛ рд░реЗрд▓ рдкрд░, рдореИрдВ рдЗрд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рднреА рдирд╣реАрдВ рдХрд░рддрд╛ - рдХреЗрд╡рд▓ рдЕрдЧрд░ рдореИрдВ рдПрдХ рд░рд┐рдВрдЪ рдХреЗ рд╕рд╛рде рдХрдВрдзреЗ рдХреЛ рдордЬрдмреВрдд рдХрд░рддрд╛ рд╣реВрдВ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рдЖрдк рдХреБрдЫ рдЪреАрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╕рдорд╕реНрдпрд╛ рдХреИрд▓реНрд╢рд┐рдпрдо-рджреГрдврд╝ рд▓рдХрдбрд╝реА рдХреЗ рдЬрдорд╛рд╡ рдореЗрдВ рд╣реИ, рдПрдХ рд╢рдмреНрдж рдХреЗ рд╕рд╛рде "рдЕрддрд┐рд╡реГрджреНрдзрд┐"ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рддрджрдиреБрд╕рд╛рд░, рдЪреБрдирд╛рд╡ рд╣рд╛рдЗрдбреНрд░реЛрдХреНрд▓реЙрдХ рд╕реЗ рдкреЗрд╢реЗрд╡рд░ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдкрд░ рдЧрд┐рд░ рдЧрдпрд╛ - 21 рдПрди * рдЯреЛрдХрд╝ рдХрд╛ рдореА рд╡рд┐рдЬреНрдЮрд╛рдкрди рдЪрдЯрд░рдХрд╛рд░ рдХреА рддрд░рд╣ рдорд╣рд╕реВрд╕ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдХреНрд░реЗрди рдмрд╕ рд╡рд┐рд╢рд╛рд▓ рд╣реИ - рдЦрд░реАрдж рд╕реЗ рдкрд╣рд▓реЗ рдЗрд╕рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд╕реНрдерд╛рди рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░реЗрдВред </font></font><br>
<br>
<img src="https://habrastorage.org/files/758/e07/18c/758e0718cc9a46e09306bac214db8cf1.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд▓ рдХреЛ рд╕реАрд▓ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдкрд░рд┐рдзрд┐ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдПрдХ рд░рдмрд░ рд╕реАрд▓, рдкреЗрдВрдЪ рдЧреНрд░рдВрдерд┐ рдХреЗ рдиреАрдЪреЗ рдкреНрд░рд╡реЗрд╢ рджреНрд╡рд╛рд░ред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрд╡рд░рдг рд╣рдЯрд╛ рджреЗрдВред</font></font><br>
<br>
<img src="https://habrastorage.org/files/f9d/aa4/a25/f9daa4a251e140c3bbe4b049a5af7f46.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдорд╕реЗ рдкрд╣рд▓реЗ рдмреЛрд░реНрдб рдФрд░ рд╕реНрдЯреЗрдкрд░ рдореЛрдЯрд░ рдХрд╛ рд╢реАрд░реНрд╖ рд╣реИред рдпрд╣ рд╕рдм 12 рд╡реЛрд▓реНрдЯ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реЛрддрд╛ рд╣реИред рдЬрдореАрди рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреЗрдмрд▓ рдХреЛ рдЫреЛрдЯрд╛ рдХрд░рдирд╛ рд╡рд╛рд▓реНрд╡ рдХреЛ рдмрдВрдж рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд░рдЦрддрд╛ рд╣реИред рдмреЛрд░реНрдб рдкрд░ рд╣рдо рдПрдХ рд╕рд╛рдзрд╛рд░рдг PIC 12f629 рдХрдВрдЯреНрд░реЛрд▓рд░ рджреЗрдЦрддреЗ рд╣реИрдВред рд░рд╣рддреЗ рдереЗ, рдХреНрд░реЗрди рдбреНрд░рд╛рдЗрд╡ рдореЗрдВ рдирд┐рдпрдВрддреНрд░рдХред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмреЛрд░реНрдб рдХреЗ рдкреАрдЫреЗ рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/files/c14/e08/f2e/c14e08f2e4224088a534e1811fa3729a.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L293 shagovik рдбреНрд░рд╛рдЗрд╡рд░ рдФрд░ рдлреЛрдЯреЛрдХреЙрдкрд░ (рдПрдорд┐рдЯрд░ + рдлреЛрдЯреЛрдбреЗрдЯреЗрдХреНрдЯрд░)ред рд╡рд╣ рдбреНрд░рд╛рдЗрд╡ рдХреЗ рдореБрдЦреНрдп рдЧрд┐рдпрд░ рдХреЛ рджреЗрдЦрддреА рд╣реИ, рдЬрд┐рд╕реЗ рднрд╛рдЧреЛрдВ рдореЗрдВ рдЪрд┐рддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ - рд╕рдлреЗрдж рдФрд░ рдХрд╛рд▓рд╛, рдмрдВрдж / рдЦреБрд▓рд╛ред </font></font><br>
<br>
<img src="https://habrastorage.org/files/a14/cec/177/a14cec1771ef4d52bc15c83e9183124e.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреНрд░реЗрди рд╣рд░ рд╕рдордп рдПрдХ рджрд┐рд╢рд╛ рдореЗрдВ рдШреВрдорддрд╛ рд╣реИ, рдирд┐рдпрдВрддреНрд░рдХ рдХрд╛ рддрд░реНрдХ рд╕рд░рд▓ рд╣реИ - рд╣рдо рд╢рд╛рдлреНрдЯ рдХреЛ рдореЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ рдЬрдм рддрдХ рд╣рдо рд╡рд╛рдВрдЫрд┐рдд рд░рдВрдЧ рдкрд░ рд╕реНрд╡рд┐рдЪ рдирд╣реАрдВ рдХрд░рддреЗред рдПрдХ рджрд┐рд╢рд╛ рдореЗрдВ рдХреНрд░реЗрди рдХрд╛ рд░реЛрдЯреЗрд╢рди рдХрдо рдкрд╣рдирдирд╛ рд╣реИ, рдФрд░ рд╕реНрдерд┐рддрд┐ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдиреЗ рдХреЗ рдЧреИрд░-рд╕рдВрдкрд░реНрдХ рддрд░реАрдХреЗ рд╕реЗ рдПрдХ рдЪрд░ рд░реЛрдХрдиреЗрд╡рд╛рд▓рд╛ рдпрд╛ рд╕реАрдорд╛ рд╕реНрд╡рд┐рдЪ рдХреЗ рдЦрдЯреНрдЯрд╛ / рдЦрд░рд╛рдмреА рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрдо рд╣реИред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд▓рд┐рдП, рдЖрдк рдбреНрд░рд╛рдЗрд╡ рд╕реЗ рдХреНрд░реЗрди рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ - рдпрд╣ 2 рдирдЯреНрд╕ рдкрд░ рдЖрдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдбреНрд░рд╛рдЗрд╡ рдФрд░ рдХреНрд░реЗрди рдХреЗ рдмреАрдЪ рдПрдХ рдЧрд░реНрдореА-рдЗрдиреНрд╕реБрд▓реЗрдЯ рдЧреИрд╕реНрдХреЗрдЯ рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/files/bf7/37c/1f7/bf737c1f7a144c72baba7a17fdc94615.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдбреЗрдврд╝ рд╕рд╛рд▓ рдкрд╣рд▓реЗ рдореЗрд░реА рдорд░рдореНрдордд рд╣реБрдИ рдереАред рдХреНрд░реЗрди рдиреЗ рддреАрди рд╕рд╛рд▓ рдкрд╣рд▓реЗ рдЦрд░реАрджрд╛ рдерд╛ - рдЬреБрджрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдВрджрд░ рджреЗрдЦреЛ, рдЕрдзрд┐рдХ рдЦрд░реАрджреЗрдВ рдФрд░ рдорд░рдореНрдордд рдХреЗ рджреМрд░рд╛рди рдЗрд╕реЗ рд╣рд╡рд╛ рджреЗрдВред рд╣рд╛рдБ, рдЕрдм ... рдореИрдВ рдЗрд╕ рдирд╛рд░рдХреАрдп рд╕рд░реНрдХрд╕ рдореЗрдВ рдЬреЛ рдЕрдзрд┐рдХрддрдо рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рдерд╛, рдЙрд╕реЗ рдПрдХ рдХреНрд░реЗрди рдХреЗ рд╕рд╛рде рдмрджрд▓рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЗ рд╕рд╛рде рдкрд╛рдиреА рдХреА рдЖрдкреВрд░реНрддрд┐ рдХреЗ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдореЗрдВ рдПрдХ рдЧрдВрджрдЧреА рдХрд▓реЗрдХреНрдЯрд░ рд░рдЦрдирд╛ рдерд╛ред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдХреЗрд╡рд▓ рдбреЗрдврд╝ рд╕рд╛рд▓ рдмрд╛рдж - рдореИрдВрдиреЗ рдПрдХ рджреВрд╕рд░реА рдХреНрд░реЗрди рдЦрд░реАрджреА рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЦрд░рд╛рдм рдХрд░ рджрд┐рдпрд╛ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирддреАрдЬрддрди, рд╣рдо рдПрдХ рдЕрдЬреАрдм рдФрд░ рджреБрд░реНрд▓рдн рдШрдЯрдирд╛ рдХрд╛ рдЕрд╡рд▓реЛрдХрди рдХрд░рддреЗ рд╣реИрдВ (рдбреЙрд░рдЬрд╝рд╛рджреЛрд╡ рдХреА рдЖрд╡рд╛рдЬрд╝ рдореЗрдВ рдкрдврд╝реЗрдВ) - рдирд┐рд░реНрдорд╛рддрд╛ рдХреА рд╡реЗрдмрд╕рд╛рдЗрдЯ рд╕реЗ рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдХреА рдкреБрд╖реНрдЯрд┐ рдХреА рдЧрдИ рдереАред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╡рд░реНрдгрди рдЕрдЬреАрдм рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рддрдХрдиреАрдХ рдиреЗ рд▓рд┐рдЦрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рд╡рд┐рдкрдгрди рдХреЛ рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдкрд╛рдиреА рдкрд┐рд▓рд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдЕрднреА рднреА рдХреБрдЫ рд▓реЛрдЧ рд╕рднреА рдЪрд┐рдкреНрд╕ рдХреЛ рд╕рдордЭрддреЗ рд╣реИрдВред рд╕рд╛рдЗрдЯ рдкрд░ рдкрд░реНрдпрд╛рдкреНрдд рдЦрдВрдб рдирд╣реАрдВ рд╣реИ - рдЕрдВрджрд░ рддрдХрдиреАрдХреА рд╡рд┐рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЗрдВрдЯреАрдЧреНрд░реЗрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдПред рдмрдврд╝реЗ рд╣реБрдП рдЯреЙрд░реНрдХ рдХреА рдХреАрдордд рдкрд░ рднреА, рд╡реЗ рд╢реБрд░реВ рдореЗрдВ рдЭреВрда рдирд╣реАрдВ рдмреЛрд▓рддреЗ - рд╢реБрд░реБрдЖрдд рдореЗрдВ рдХреНрд░реЗрди 1.5 рдП рдХреЗ рдЗрдВрдЬрди рдХреЗ рд╕рд╛рде рдзрдорд╛рдХрд╛ рдХрд░ рд░рд╣реА рд╣реИ рдФрд░ 2-3 рд╕реЗрдХрдВрдб рдХреЗ рдмрд╛рдж рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп (рд╡рд░реНрддрдорд╛рди 0.7 рдП) рдореЛрдб рдореЗрдВ рдКрдкрд░ рдЬрд╛рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддреА рд╣реИред рдЗрд╕реЗ рдмрдВрдж рдХрд░рдиреЗ рдореЗрдВ рд▓рдЧрднрдЧ 25-30 рд╕реЗрдХрдВрдб рд▓рдЧрддреЗ рд╣реИрдВред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдФрд░ рдЕрдиреБрднрд╡: рдЯреЛрдХрд╝ рдХреА рдХреАрдордд рдкрд░ - рдпрд╣ рдореЙрд╕реНрдХреЛ рд╕рдордп рдХреЗ рд▓рд┐рдП рдЕрддреНрдпрдзрд┐рдХ рд╣реИ, рдпрд╣рд╛рдВ рдкрд╛рдиреА рдХрд╛рдлреА рдареАрдХ рд╣реИ, рдПрдХ 100 рдорд╛рдЗрдХреНрд░реЛрди рдлрд┐рд▓реНрдЯрд░ рдореЗрдВ рдбреЗрдврд╝ рд╕рд╛рд▓ рдХреЗ рд▓рд┐рдП рд╕рдХрд▓ рдФрд░ рдХреЛрдИ рдЕрддрд┐рд╡реГрджреНрдзрд┐ рдХреА рдПрдХ рдЬреЛрдбрд╝реА рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдкрдХреЛ рдХреАрдордд, рд╢реБрд░реБрдЖрддреА рд╕рдордп рдФрд░ рдХреЛрдард░реА рдореЗрдВ рдЬрдЧрд╣ рдХреЗ рд╕рд╛рде рдмрдбрд╝реЗ рдЯреЛрдХрд╝ рдХреЗ рд▓рд┐рдП рднреБрдЧрддрд╛рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рд╛рдЗрдбреНрд░реЛрд▓рд╛рдХ рдЕрд▓реНрдЯрд┐рдореЗрдЯ, рдиреЗрдкрдЪреНрдпреВрди рдпрд╛ рдПрдХреНрд╡рд╛рд╕реНрдЯреЛрд░реЛрдЬрд╝ рд╕реЗ рдкрд░реНрдпрд╛рдкреНрдд рдкрд╛рд░рдВрдкрд░рд┐рдХ рдбреНрд░рд╛рдЗрд╡ рд╣реЛрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдореИрдВ рдкрд┐рдЫрд▓реЗ рджреЛ рдХреЗ рд▓рд┐рдП рд╡рд╛рдЙрдЪ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ - рдореИрдВрдиреЗ рдЗрд╕реЗ рдирд╣реАрдВ рдмрдирд╛рдпрд╛ рд╣реИ, рд▓рдЧрднрдЧ 5 рд╕рд╛рд▓ рдкрд╣рд▓реЗ рдЙрдирдХреЗ рдкрд╛рд╕ рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдкреНрд▓рд╛рд╕реНрдЯрд┐рдХ рдЧрд┐рдпрд░ рдереЗ, рдЕрдм рдЙрдиреНрд╣реЗрдВ рдпрд╣ рддрдп рд╣реЛ рдЧрдпрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдбреНрд░рд╛рдЗрд╡ рдХреЗ рд▓рд┐рдП рд╕реЗрдВрд╕рд░ рдХреЗ рдкреНрд░рддреНрдпрдХреНрд╖ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдПрдХ рд╡рд┐рдЬреЗрддрд╛ рд╣рд╛рдЗрдбреНрд░реЛрд▓реЙрдХ рднреА рд╣реИ - рдпрд╣ рд╣реИ рдХрд┐ рдЕрдЧрд░ рдЖрдкрдХреЛ рдореЗрд░реЗ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рд╣рд░ рдЪреАрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╣рд╛рдВ, рд╢рдХреНрддрд┐ 4 рдмреИрдЯрд░реА рд╕реЗ рд╕реНрд╡рд╛рдпрддреНрдд рд╣реИ, рдФрд░ рдЖрдзрд╛рд░ рдПрдХ рдЕрдВрддрд┐рдо рдбреНрд░рд╛рдЗрд╡ рдХреЗ рд╕рдорд╛рди рд╣реИред </font><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдпрд╣ рд╕реНрд╡-рдирд┐рд░реНрдорд┐рдд рдирд┐рдпрдВрддреНрд░рдХ рдХреЗ рд▓рд┐рдП рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ - рдпрд╣ 5 рд╡реЛрд▓реНрдЯ рд╣реИ, рдЖрдкрдХреЛ 5 рдФрд░ 12 рд╡реЛрд▓реНрдЯ рдкрд░ рджреЛ рдмрд╕реЗрдВ рд▓рдЧрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдФрд░ рдЖрдк рдСрдкреНрдЯрд┐рдХрд▓ рдЕрд▓рдЧрд╛рд╡ рдХреЛ рджреВрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рд╕рд╛рд╡ рд╕рдВрд╡реЗрджрдХ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореИрдВрдиреЗ рдЙрд╕реА WSU рдХрд╛рдЙрдВрдЯрд░ рдХреЗ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ - рд╕реЗрдВрд╕рд░реЛрдВ рдХреЛ рдЦрд░реАрджрд╛ред </font><font style="vertical-align: inherit;">рдЙрдирдХреЗ рдкрд╛рд╕ рджреЛ "рдУрдкрди рдХрд▓реЗрдХреНрдЯрд░" рдЖрдЙрдЯрдкреБрдЯ рд╣реИрдВ, рдПрдХ рдЬрдореАрди рдкрд░ рддрднреА рдЦреАрдВрдЪрддрд╛ рд╣реИ рдЬрдм рдкрд╛рдиреА рд╣реЛрддрд╛ рд╣реИ, рджреВрд╕рд░рд╛ - рдЕрдЧрд░ рдкрд╛рдиреА рдЕрдВрджрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдмрд┐рдЬрд▓реА рдХрдЯрдиреЗ рддрдХ рд╣рд░ рд╕рдордп рдЬрдореАрди рдкрд░ рдЦреАрдВрдЪрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдореИрдВ рдХреЗрд╡рд▓ рдкрд╣рд▓реЗ рдЖрдЙрдЯрдкреБрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ, рдмрд╛рдХреА рддрд░реНрдХ рдирд┐рдпрдВрддреНрд░рдХ рдореЗрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЖрдЙрдЯрдкреБрдЯ рдХреБрдЫ рдФрд░ рдХреЛрдВрдбреЛ рдкреНрд░реЗрд╖рдг рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд┐рдЯ рдореЗрдВ рддрд╛рд░ рдХрд╣реАрдВ рддреАрди рдореАрдЯрд░ рд╣реИрдВред </font><font style="vertical-align: inherit;">рддрд╛рд░реЛрдВ рдХрд╛ рд░рдВрдЧ Ad_i_Israel рд╣реИред </font><font style="vertical-align: inherit;">рдмреЛрд▓реА рджреЗрдЦреЗрдВ:</font></font><br>
<br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд╛рд▓ (рднреВрд░рд╛) рддрд╛рд░ (Vcc) +5 рд╕реЗ +30 рд╡реЛрд▓реНрдЯ рддрдХ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реЛрддрд╛ рд╣реИред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд╛рд▓реЗ (рд╕рдлреЗрдж) рддрд╛рд░ (OUT2) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рд░реЗ рддрд╛рд░ (OUT1) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреАрд▓реЗ рддрд╛рд░ (GND)</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рд╢реНрд╡реЗрдд / рд╢реНрдпрд╛рдо рдкреГрдереНрд╡реА рдмрдирд╛рдиреЗ рд╕реЗ рдХреНрдпрд╛ рд░реЛрдХрд╛ рдЬрд╛рддрд╛ рд╣реИ? </font><font style="vertical-align: inherit;">рдХреНрд░реЗрди рдбреНрд░рд╛рдЗрд╡ рдкрд░, рд╡реИрд╕реЗ, рддрд░реНрдХ рдХреЗ рд╕рд╛рде рд░рдВрдЧ рдореЗрдВ рддрд╛рд░ рдирд╣реАрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдбрд┐рд╢рд╡реЙрд╢рд░ рдХреЗ рдмрдЧрд▓ рдореЗрдВ рд╕рд┐рдВрдХ рдХреЗ рдиреАрдЪреЗ рдкрд╣рд▓рд╛ рд╕реЗрдВрд╕рд░ рд░рд╕реЛрдИ рдореЗрдВ рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/files/2ea/407/a25/2ea407a255b8420e9b1d6c26772e2709.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЬрд▓ рдирд┐рдХрд╛рд╕реА рдЦрд╛рдИ рдореЗрдВ рдмрд╛рдерд░реВрдо рдореЗрдВ рджреВрд╕рд░рд╛ред </font><font style="vertical-align: inherit;">рдЬрдм рдЙрд╕рдиреЗ рдкрдВрдЧрд╛ рд▓рд┐рдпрд╛, рддреЛ рд╡рд╣ рдЙрд╕реЗ рджреАрд╡рд╛рд░ рдкрд░ рдирд╣реАрдВ рд▓рд╛рдпрд╛ред </font><font style="vertical-align: inherit;">рдирддреАрдЬрд╛ рдпрд╣ рдерд╛ рдХрд┐ рдмрд╛рдерд░реВрдо рдФрд░ рдЯреЙрдпрд▓реЗрдЯ рд╕реЗ рдкрд╛рдиреА рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд╛рдВрда рдереАред </font></font><br>
<br>
<img src="https://habrastorage.org/files/51d/715/898/51d71589848d4a77a59f8caf0dbf2041.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдСрдкрд░реЗрдЯрд┐рдВрдЧ рдЕрдиреБрднрд╡ рд╕реЗ - рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдбрд┐рд╢рд╡реЙрд╢рд░ рдореЗрдВ рд╕реЗрдВрд╕рд░ рдХрд╛ рдПрдХ рдЧрд▓рдд рдЕрд▓рд╛рд░реНрдо рдерд╛ред </font><font style="vertical-align: inherit;">рдПрдХ рдорддрджрд╛рди рдЪрдХреНрд░ (500ms) рдХреЗ рд▓рд┐рдП рд▓реЙрдЧ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП рдПрдХ рд╕рд░реНрдХрд┐рдЯ рдерд╛, рдХреЛрдб рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ - рд░рд╛рдЬреНрдп рдкрд░рд┐рд╡рд░реНрддрди рдЕрдм рд╕реЗрдВрд╕рд░ рд╕реЗ рд▓рдЧрд╛рддрд╛рд░ 10 рд╕рдорд╛рди рдореВрд▓реНрдпреЛрдВ рдкрд░ рд╣реЛрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реЗрдВрд╕рд░ рдХреЙрдиреНрдЯреИрдХреНрдЯ рдЧреЛрд▓реНрдб рдкреНрд▓реЗрдЯреЗрдб рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рдорд┐рддреНрд░ рдХреЗ рдкрд╛рд╕ рдХрдИ рд╡рд░реНрд╖реЛрдВ рд╕реЗ рд╕рдорд╛рди рд╕реЗрдВрд╕рд░ рд╣реИрдВ, рдХреЛрдИ рдСрдХреНрд╕реАрдХрд░рдг рдирд╣реАрдВ рджреЗрдЦрд╛ рдЧрдпрд╛ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджрдмрд╛рд╡ рд╕реЗрдВрд╕рд░</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд░реВрдк рд╕реЗ - рд╢реЛрдореАрдЯрд░ред </font><font style="vertical-align: inherit;">рд╕рдЯреАрдХрддрд╛ + - 0.5 рдПрдЯреАрдПрдо рдиреЗ рдореБрдЭреЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдиреБрдХреВрд▓ рдмрдирд╛ рджрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рд╕реЗрдВрд╕рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдкрд╛рдиреА рдмрдВрдж рдХрд░рдиреЗ рдХрд╛ рдЕрд▓рд░реНрдЯ рдЖрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрд▓реА рдХреЛ рдЦрд░реАрджрд╛ </font><font style="vertical-align: inherit;">ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдкрдорд╛рди рд╕реЗрдВрд╕рд░</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдХреНрдпреЛрдВ рди рдЬреЛрдбрд╝реЗрдВ? </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧреА рд╕реЗ - рдпрд╣ рд╡рд░реНрд╖ рдореЗрдВ рдПрдХ рдмрд╛рд░ рдЧрд░реНрдо рдкрд╛рдиреА рдХреЗ рдмрдВрдж рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдкреНрд░рдпреБрдХреНрдд рдбреАрдПрд╕ 18 рдмреА 20ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рдЙрдВрдЯрд░реЛрдВ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдмрд╕реЗ рдЖрдо Itelma, рдПрдХ рдмрд╛рд░ рд╣рд░ 10 рд▓реАрдЯрд░ рд╕рдВрдкрд░реНрдХ рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдирд┐рдпрдВрддреНрд░рдХ рдкрдХреНрд╖ рдкрд░, рдЖрдЙрдЯрдкреБрдЯ + 3.3v рддрдХ рдЦреАрдВрдЪ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдореАрдЯрд░ рдЗрд╕реЗ рдЬрдореАрди рдкрд░ рдЦреАрдВрдЪрддрд╛ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдпрдВрддреНрд░рдХ</font></font></h3><br>
<img src="https://habrastorage.org/files/318/4e6/d7a/3184e6d7ad9c4eab99d9962410c7918c.jpg"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрджрд░</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/a83/72d/117/a8372d1170ca43f8b92925fa76a240f8.jpg"><br>
<img src="https://habrastorage.org/files/f7b/e62/ee8/f7be62ee80a54ff2a0ed60ad17467a8b.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрдг рдлреЛрдЯреЙрди рдХреЗ рдЖрдзрд╛рд░ рдкрд░, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг </font><font style="vertical-align: inherit;">ред рдЙрдирдХреЗ рдкрд╛рд╕ 2 рдЬреА рдпрд╛ 3 рдЬреА рдореЙрдбреНрдпреВрд▓ (рдЗрд▓реЗрдХреНрдЯреНрд░реЙрди) рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрд╕реНрдХрд░рдг рд╣реИред рдкрд╣рд▓реЗ рдлрд░реНрдорд╡реЗрдпрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реНрд▓реИрдЧ рдерд╛, рдУрдХреЗ рдбрд╛рдпреЛрдб рдХреЗ рд╕рд╛рде рдмреНрд▓рд┐рдВрдХрд┐рдВрдЧ, рд▓реЗрдХрд┐рди рдЬреИрд╕реЗ рд╣реА рдЖрдк рдЬрдЯрд┐рд▓ рд╕реЙрд╕реЗрдЬ рдЪрдмрд╛рдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, i2c рдФрд░ рдЗрдВрдЯрд░рдкреНрдЯ рдХреЗ рд╕рд╛рде рдЦреЗрд▓рдирд╛ рд╡рд╛рдИрдлрд╛рдИ рдЦреЛ рд╕рдХрддрд╛ рд╣реИред рдЕрдм рдЖрдк рд░рд╣ рд╕рдХрддреЗ рд╣реИрдВред рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЖрдк рд╕рд░реНрдХрд┐рдЯ рд╕реЗ рдмрд╛рд╣рд░ рджрдмрд╛рд╡ рд╕реЗрдВрд╕рд░ рдлреЗрдВрдХ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ ESP8266 рдкрд░ рд╕рдм рдХреБрдЫ рд╣рд▓рдЪрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдЗрд╕рдХреЗ рд▓рд┐рдП рдЬрд╛рдПрдВред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдлреЛрдЯреЙрди рдХреЛ рдХрдг рдЦрд╛рддреЗ рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдореЛрдмрд╛рдЗрд▓ рдкрд░ рдРрдк рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдпрд╛ рдХрдг рд╕реАрдПрд▓рдЖрдИ рдХрдВрд╕реЛрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ - рдореИрдВ рдХреЗрд╡рд▓ рджреВрд╕рд░реА рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ) рдФрд░ рдПрдХ рд╡рд╛рдИрдлрд╛рдИ рдиреЗрдЯрд╡рд░реНрдХ рдкрдВрдЬреАрдХреГрдд рдХрд░рддрд╛ рд╣реВрдВред рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдХреЗ рдмрд╛рдж, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗрдХреНрд╢рди рдореЗрдВ рдХрдВрдЯреНрд░реЛрд▓рд░ рдФрд░ рдХреНрд▓рд╛рдЙрдб рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИред</font></font><br>
<br>
<img src="https://habrastorage.org/files/71d/c17/687/71dc17687ccb4a289d0a0dd2296fdfca.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореЗрд░реЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ рдлрд░реНрдорд╡реЗрдпрд░ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЙрдб рд╕реЗ рдЬреБрдбрд╝реЗ рд╕рднреА рдиреЛрдбреНрд╕ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдореИрдВ рдкрд╛рдЧрд▓ рд╣реЛ рдЬрд╛рдКрдВрдЧрд╛ - рдмрд╕ рдХреНрд▓рд╛рдЙрдб рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рд╕рдореГрджреНрдз рдирд┐рдпрдВрддреНрд░рдХ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдирд╣реАрдВ рдЦрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЖрдИрдбреАрдИ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рд╢рд╛рдмреНрджрд┐рдХ рд░реВрдк рд╕реЗ рдПрдХ рджрд░реНрдЬрди рдХрд╛рдЙрдВрдЯрд░ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╣реИрдВ, рдмрд╛рдХреА рд╕рдореБрджрд╛рдп рджреНрд╡рд╛рд░рд╛ред </font><font style="vertical-align: inherit;">рдореЗрд░реЗ рдЕрд╡рд▓реЛрдХрди рдореЗрдВ, рд▓рдВрдмреЗ рд╕рдордп рддрдХ рд╕рдм рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдЪрд┐рддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдПрдХ рдЕрдиреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЖрдИрдбреАрдИ рддреБрд░рдВрдд рдЬрд╛рдирддрд╛ рд╣реИ рдХрд┐ рдХрд┐рддрдиреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд░реНрдорд╡реЗрдпрд░ рд╕реНрд░реЛрдд рдХреЛрдб</font></font></b><div class="spoiler_text"><pre><code class="hljs cpp"><span class="hljs-comment"><span class="hljs-comment">// This #include statement was automatically added by the Particle IDE.</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Adafruit_SSD1306/Adafruit_SSD1306.h"</span></span></span></span>

<span class="hljs-comment"><span class="hljs-comment">// This #include statement was automatically added by the Particle IDE.</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MQTT/MQTT.h"</span></span></span></span>

<span class="hljs-comment"><span class="hljs-comment">// This #include statement was automatically added by the Particle IDE.</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"OneWire/OneWire.h"</span></span></span></span>

SYSTEM_THREAD(ENABLED);
SYSTEM_MODE(MANUAL);
STARTUP(WiFi.selectAntenna(ANT_EXTERNAL));
STARTUP(System.enableFeature(FEATURE_RETAINED_MEMORY));

<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">counter_struct</span></span></span><span class="hljs-class"> {</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> value;
  byte state;
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pin;
};
<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">valve_struct</span></span></span><span class="hljs-class"> {</span></span>
  byte state;
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pin;
};
<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sensor_struct</span></span></span><span class="hljs-class"> {</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> timeout;
  byte state;
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pin;
};

<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> currentMillis = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> previous_conected = <span class="hljs-number"><span class="hljs-number">100000</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> previous_wifi_uptime = <span class="hljs-number"><span class="hljs-number">100000</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> previous_counter_read = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> wifi_uptime;
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> start_temp_timer = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> read_temp_timer = <span class="hljs-number"><span class="hljs-number">0</span></span>;
byte display_timeout = <span class="hljs-number"><span class="hljs-number">0</span></span>;

<span class="hljs-comment"><span class="hljs-comment">//temp onewire </span></span>
OneWire ds0 = OneWire(D2);
OneWire ds1 = OneWire(D3);
byte addr0[<span class="hljs-number"><span class="hljs-number">8</span></span>];
byte addr1[<span class="hljs-number"><span class="hljs-number">8</span></span>];
<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> presense0 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> presense1 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
byte data[<span class="hljs-number"><span class="hljs-number">12</span></span>];

<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> OLED_RESET A7</span></span>
<span class="hljs-function"><span class="hljs-function">Adafruit_SSD1306 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OLED_RESET)</span></span></span></span>;


<span class="hljs-comment"><span class="hljs-comment">//valve control</span></span>
retained valve_struct valve[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, D4}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, D5} };

<span class="hljs-comment"><span class="hljs-comment">//counter control</span></span>
retained counter_struct counter[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, A0}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, A1} };
<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pressure[<span class="hljs-number"><span class="hljs-number">2</span></span>] = {A2, A3};
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SENSOR_TIMEOUT 10</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> sensor_struct sensor[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, D6}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, D7} };

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* topic, byte* payload, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length)</span></span></span></span>;

byte server[] = { <span class="hljs-number"><span class="hljs-number">192</span></span>,<span class="hljs-number"><span class="hljs-number">168</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">101</span></span>};
<span class="hljs-function"><span class="hljs-function">MQTT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(server, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1883</span></span></span></span><span class="hljs-function"><span class="hljs-params">, callback)</span></span></span></span>;

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publish_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* t, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* p, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> retain)</span></span></span><span class="hljs-function"> 
</span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> client.publish(t, (<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>*)p, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(p), retain);
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publish_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* t, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> p, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> retain)</span></span></span><span class="hljs-function"> 
</span></span>{   
    <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf_d[<span class="hljs-number"><span class="hljs-number">12</span></span>];
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf_d,<span class="hljs-string"><span class="hljs-string">"%d"</span></span>,p);
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> client.publish(t, (<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>*)buf_d, n, retain);
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publish_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* t, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> p, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> retain)</span></span></span><span class="hljs-function"> 
</span></span>{   
    <span class="hljs-comment"><span class="hljs-comment">//char buf_f[18];</span></span>
    <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>;
<span class="hljs-comment"><span class="hljs-comment">//    dtostrf(p, 9, 4, buf_f);</span></span>
    <span class="hljs-comment"><span class="hljs-comment">//int n = sprintf(buf_f,"%f",p);</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> client.publish(t, (<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>*)s.c_str(), s.length(), retain);
}

<span class="hljs-comment"><span class="hljs-comment">// recieve message</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* topic, byte* payload, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length)</span></span></span><span class="hljs-function"> </span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> p[length + <span class="hljs-number"><span class="hljs-number">1</span></span>];
    <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(p, payload, length);
    p[length] = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>;
    <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p)</span></span></span></span>;
    <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(topic)</span></span></span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t.equals(<span class="hljs-string"><span class="hljs-string">"home/water_count/spark/set"</span></span>))
    {
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"1"</span></span>))
        {
            Particle.connect();
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waitFor(Particle.connected, <span class="hljs-number"><span class="hljs-number">10000</span></span>)) 
                {publish_message(<span class="hljs-string"><span class="hljs-string">"home/water_count/spark"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);}
            <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
                {Particle.disconnect(); publish_message(<span class="hljs-string"><span class="hljs-string">"home/water_count/spark"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);}
        }
        <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
        {
            Particle.disconnect();
            publish_message(<span class="hljs-string"><span class="hljs-string">"home/water_count/spark"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);
        }
    }
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t.startsWith(<span class="hljs-string"><span class="hljs-string">"home/water_count/valve/"</span></span>))
    {
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> m = message.toInt();
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = t.substring(<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">24</span></span>).toInt();
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> &amp;&amp; m &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; x &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> &amp;&amp; x &lt;<span class="hljs-number"><span class="hljs-number">2</span></span>) 
        {
            set_valve(x, m);
        }
        <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
        {
            publish_message(<span class="hljs-string"><span class="hljs-string">"home/water_count/valve/"</span></span> + t.substring(<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">24</span></span>),  valve[x].state , <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
        }
    }
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t.startsWith(<span class="hljs-string"><span class="hljs-string">"home/water_count/counter/"</span></span>))
    {
        <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m = message.toFloat();
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = t.substring(<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">26</span></span>).toInt();
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> &amp;&amp; m &lt;= <span class="hljs-number"><span class="hljs-number">999999</span></span> &amp;&amp; x &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> &amp;&amp; x &lt;<span class="hljs-number"><span class="hljs-number">2</span></span>) 
        {
            counter[x].value = m;
        }
        publish_message(<span class="hljs-string"><span class="hljs-string">"home/water_count/counter/"</span></span> + t.substring(<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">26</span></span>),  counter[x].value , <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
    }
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{
<span class="hljs-comment"><span class="hljs-comment">//Serial.begin(9600);</span></span>
    WiFi.on();
    WiFi.connect();
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waitFor(WiFi.ready, <span class="hljs-number"><span class="hljs-number">5000</span></span>)) {mqtt_connect();}
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) 
    {
        pinMode(valve[i].pin, OUTPUT);
        digitalWrite(valve[i].pin, valve[i].state);
        pinMode(counter[i].pin, INPUT);
        pinMode(sensor[i].pin, INPUT);
        counter[i].state = digitalRead(counter[i].pin);
        pinMode(pressure[i], AN_INPUT);
    }
    pinMode(A4, INPUT_PULLUP);

    display.begin(SSD1306_SWITCHCAPVCC, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>);  <span class="hljs-comment"><span class="hljs-comment">// initialize with the I2C addr 0x3C (for the 128x64)</span></span>
    display.clearDisplay();   <span class="hljs-comment"><span class="hljs-comment">// clears the screen and buffer</span></span>

    <span class="hljs-comment"><span class="hljs-comment">//Particle.connect();</span></span>
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> 
</span></span>{
    currentMillis = millis();
    <span class="hljs-comment"><span class="hljs-comment">//       MQTT </span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMillis - previous_conected &gt;= <span class="hljs-number"><span class="hljs-number">30000</span></span> || previous_conected &gt; currentMillis)
    {
        previous_conected = currentMillis;
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!client.isConnected() &amp; wifi_uptime &gt; <span class="hljs-number"><span class="hljs-number">60</span></span>)
        {
            mqtt_connect();
        }
        publish_message(<span class="hljs-string"><span class="hljs-string">"home/water_count/rssi"</span></span>, WiFi.RSSI(), <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
    }
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMillis - previous_wifi_uptime &gt;= <span class="hljs-number"><span class="hljs-number">1000</span></span> || previous_wifi_uptime &gt; currentMillis)
    {
        previous_wifi_uptime = currentMillis;
        WiFi.ready() ? wifi_uptime++ : wifi_uptime = <span class="hljs-number"><span class="hljs-number">0</span></span>;
        <span class="hljs-comment"><span class="hljs-comment">//work with button and display</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fg = digitalRead(A4);
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (display_timeout &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>)
        {
            display_timeout -= <span class="hljs-number"><span class="hljs-number">1</span></span>;
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (display_timeout == <span class="hljs-number"><span class="hljs-number">0</span></span>) 
            { 
                display.clearDisplay();
                display.display();
            } 
        }
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fg == <span class="hljs-number"><span class="hljs-number">0</span></span>)
        {
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (display_timeout == <span class="hljs-number"><span class="hljs-number">0</span></span>)
            {
                display.clearDisplay();   <span class="hljs-comment"><span class="hljs-comment">// clears the screen and buffer</span></span>
                display.setTextSize(<span class="hljs-number"><span class="hljs-number">2</span></span>);
                display.setTextColor(WHITE);
                display.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);
                display.print(<span class="hljs-string"><span class="hljs-string">"C="</span></span>);
                display.println(counter[<span class="hljs-number"><span class="hljs-number">0</span></span>].value, <span class="hljs-number"><span class="hljs-number">4</span></span>);
                display.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>);
                display.print(<span class="hljs-string"><span class="hljs-string">"H="</span></span>);
                display.println(counter[<span class="hljs-number"><span class="hljs-number">1</span></span>].value, <span class="hljs-number"><span class="hljs-number">4</span></span>);
                display.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">32</span></span>);
                display.print(<span class="hljs-string"><span class="hljs-string">"Valve="</span></span>);
                display.print(valve[<span class="hljs-number"><span class="hljs-number">0</span></span>].state);
                display.print(<span class="hljs-string"><span class="hljs-string">"|"</span></span>);
                display.println(valve[<span class="hljs-number"><span class="hljs-number">1</span></span>].state);
                display.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">48</span></span>);
                display.print(<span class="hljs-string"><span class="hljs-string">"Sensor="</span></span>);
                display.print(sensor[<span class="hljs-number"><span class="hljs-number">0</span></span>].state);
                display.print(<span class="hljs-string"><span class="hljs-string">"|"</span></span>);
                display.println(sensor[<span class="hljs-number"><span class="hljs-number">1</span></span>].state);
                display.display();
            }
            display_timeout = <span class="hljs-number"><span class="hljs-number">10</span></span>;
        }
    }
    <span class="hljs-comment"><span class="hljs-comment">//counter check</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMillis - previous_counter_read &gt;= <span class="hljs-number"><span class="hljs-number">500</span></span> || previous_counter_read &gt; currentMillis)
    {
        previous_counter_read = currentMillis;
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) 
        {
            byte count_state = digitalRead(counter[i].pin);
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count_state != counter[i].state)
            {
                counter[i].state = count_state;
                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count_state == <span class="hljs-number"><span class="hljs-number">0</span></span>)
                {
                    counter[i].value += <span class="hljs-number"><span class="hljs-number">0.01</span></span>;
                    <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf18[<span class="hljs-number"><span class="hljs-number">30</span></span>];
                    <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf18,<span class="hljs-string"><span class="hljs-string">"home/water_count/counter/%d"</span></span>, i);
                    publish_message(buf18 , counter[i].value, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
                }
            }
            <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
            byte sensor_state = digitalRead(sensor[i].pin);
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sensor_state != sensor[i].state) <span class="hljs-comment"><span class="hljs-comment">//</span></span>
            {
                sensor[i].state = sensor_state;
                sensor[i].timeout = SENSOR_TIMEOUT; 
            }
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sensor[i].timeout &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) 
            {
                sensor[i].timeout -= <span class="hljs-number"><span class="hljs-number">1</span></span>;
                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sensor[i].timeout == <span class="hljs-number"><span class="hljs-number">0</span></span>)
                {
                    <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf18[<span class="hljs-number"><span class="hljs-number">30</span></span>];
                    <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf18,<span class="hljs-string"><span class="hljs-string">"home/water_count/sensor/%d"</span></span>, i);
                    publish_message(buf18 , sensor[i].state, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
                    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sensor[i].state  == <span class="hljs-number"><span class="hljs-number">0</span></span>)
                    {
                        set_valve(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//close both valve</span></span>
                        set_valve(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//close both valve</span></span>
                    }
                }
            }
        }
    }

    <span class="hljs-comment"><span class="hljs-comment">// temp onewire</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMillis - start_temp_timer &gt;= <span class="hljs-number"><span class="hljs-number">299000</span></span> || start_temp_timer &gt; currentMillis)
    { <span class="hljs-comment"><span class="hljs-comment">// </span></span>
        start_temp_timer = currentMillis;
        presense0 = start_temp0();
        presense1 = start_temp1();
    }
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMillis - read_temp_timer &gt;= <span class="hljs-number"><span class="hljs-number">300000</span></span> || read_temp_timer &gt; currentMillis)
    {<span class="hljs-comment"><span class="hljs-comment">// </span></span>
        read_temp_timer = currentMillis;
        start_temp_timer = currentMillis;
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (presense0) read_temp0();
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (presense1) read_temp1();
        <span class="hljs-comment"><span class="hljs-comment">//preasure calc and send</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf18[<span class="hljs-number"><span class="hljs-number">30</span></span>]; 
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>; i++)
        {
            <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf18,<span class="hljs-string"><span class="hljs-string">"home/water_count/pressure/%d"</span></span>, i);
            <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> read_val = analogRead(pressure[i]);
            <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> value = (read_val - <span class="hljs-number"><span class="hljs-number">600.0</span></span>) / <span class="hljs-number"><span class="hljs-number">300.0</span></span> ;
            publish_message(buf18 , value, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);
        }
    }
    <span class="hljs-comment"><span class="hljs-comment">//Particle.process();</span></span>
    client.loop();
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mqtt_connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (client.connect(<span class="hljs-string"><span class="hljs-string">"water_count"</span></span>))
    { <span class="hljs-comment"><span class="hljs-comment">//  spark    </span></span>
        client.subscribe(<span class="hljs-string"><span class="hljs-string">"home/water_count/spark/set"</span></span>);
        publish_message(<span class="hljs-string"><span class="hljs-string">"home/water_count/spark"</span></span>, Particle.connected() ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
        client.subscribe(<span class="hljs-string"><span class="hljs-string">"home/water_count/valve/+/set"</span></span>);
        client.subscribe(<span class="hljs-string"><span class="hljs-string">"home/water_count/counter/+/set"</span></span>);
        
    }
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_temp0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
    
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !ds0.search(addr0)) { ds0.reset_search(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;}
    ds0.reset_search();
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OneWire::crc8(addr0, <span class="hljs-number"><span class="hljs-number">7</span></span>) != addr0[<span class="hljs-number"><span class="hljs-number">7</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;}
    
    ds0.reset();
    ds0.select(addr0);
    ds0.write(<span class="hljs-number"><span class="hljs-number">0x44</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; 
}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_temp1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
    
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !ds1.search(addr1)) { ds1.reset_search(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;}
    ds1.reset_search();
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OneWire::crc8(addr1, <span class="hljs-number"><span class="hljs-number">7</span></span>) != addr1[<span class="hljs-number"><span class="hljs-number">7</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;}
    
    ds1.reset();
    ds1.select(addr1);
    ds1.write(<span class="hljs-number"><span class="hljs-number">0x44</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; 
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_temp0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
    <span class="hljs-comment"><span class="hljs-comment">//delay(1000);</span></span>
    ds0.reset();
    ds0.select(addr0);
    ds0.write(<span class="hljs-number"><span class="hljs-number">0xBE</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);

    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">9</span></span>; i++) 
    {
        data[i] = ds0.read();
    }
    <span class="hljs-keyword"><span class="hljs-keyword">int16_t</span></span> raw = (data[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) | data[<span class="hljs-number"><span class="hljs-number">0</span></span>];
    <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> celsius = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)raw * <span class="hljs-number"><span class="hljs-number">0.0625</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (celsius &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || celsius &gt; <span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    publish_message(<span class="hljs-string"><span class="hljs-string">"home/water_count/temp/0"</span></span>, celsius, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);
    <span class="hljs-comment"><span class="hljs-comment">//Serial.println(celsius);</span></span>
    ds0.reset_search();
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_temp1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
    <span class="hljs-comment"><span class="hljs-comment">//delay(1000);</span></span>
    ds1.reset();
    ds1.select(addr1);
    ds1.write(<span class="hljs-number"><span class="hljs-number">0xBE</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);

    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">9</span></span>; i++) 
    {
        data[i] = ds1.read();
    }
    <span class="hljs-keyword"><span class="hljs-keyword">int16_t</span></span> raw = (data[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) | data[<span class="hljs-number"><span class="hljs-number">0</span></span>];
    <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> celsius = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)raw * <span class="hljs-number"><span class="hljs-number">0.0625</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (celsius &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || celsius &gt; <span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    publish_message(<span class="hljs-string"><span class="hljs-string">"home/water_count/temp/1"</span></span>, celsius, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);
    <span class="hljs-comment"><span class="hljs-comment">//Serial.println(celsius);</span></span>
    ds1.reset_search();
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_valve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vlv, byte state)</span></span></span><span class="hljs-function">
</span></span>{
    valve[vlv].state = state;
    digitalWrite(valve[vlv].pin, state);
    <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf26[<span class="hljs-number"><span class="hljs-number">26</span></span>];
    <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf26,<span class="hljs-string"><span class="hljs-string">"home/water_count/valve/%d"</span></span>, vlv);
    publish_message(buf26 , state , <span class="hljs-literal"><span class="hljs-literal">true</span></span>);
}
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MQTT рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдо рдмреНрд░реЛрдХрд░ рд╕реЗ рдЬреБрдбрд╝рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">Mqtt рдШрдЯрдирд╛рдУрдВ рдФрд░ рдореВрд▓реНрдпреЛрдВ рдХреА рдЗрд╕реА рд╢рд╛рдЦрд╛рдУрдВ рдореЗрдВ рд╕реЗрдВрд╕рд░ рдФрд░ рд╣реЗрд▓рдореЗрдЯ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдШрд░ / water_count / рд╡рд╛рд▓реНрд╡ / 0 - рдкрд╛рдиреА рдХреА рдПрдХ рдбреНрд░рд╛рдЗрд╡ред </font><font style="vertical-align: inherit;">рдШрд░ / рдкрд╛рдиреА_рдХрд╛рдЙрдВрдЯ / рдХрд╛рдЙрдВрдЯрд░ / 0 - рдПрдХ рдардВрдбреЗ рдкрд╛рдиреА рдХреЗ рдХрд╛рдЙрдВрдЯрд░ рдХреА рд░реАрдбрд┐рдВрдЧред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдбреНрд░рд╛рдЗрд╡ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрджрд▓рдиреЗ рдФрд░ рдХрд╛рдЙрдВрдЯрд░ рдХреЗ рдореМрдЬреВрджрд╛ рдореВрд▓реНрдп (рдардВрдбреЗ рдФрд░ рдЧрд░реНрдо рдкрд╛рдиреА) рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб рдХреА рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="hljs axapta"><span class="hljs-keyword"><span class="hljs-keyword">client</span></span>.subscribe(<span class="hljs-string"><span class="hljs-string">"home/water_count/valve/+/set"</span></span>);
<span class="hljs-keyword"><span class="hljs-keyword">client</span></span>.subscribe(<span class="hljs-string"><span class="hljs-string">"home/water_count/counter/+/set"</span></span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдПрдХ рдмрдЯрди рд╣реИ - рд╕реНрдХреНрд░реАрди рдкрд░ рд╣рдо рджрдмрд╛рдХрд░, рдХрд╛рдЙрдВрдЯрд░, рд╕реЗрдВрд╕рд░ рдФрд░ рдЯреИрдк рдХреА рд╡рд░реНрддрдорд╛рди рд░реАрдбрд┐рдВрдЧ рдХреЛ рдЦреАрдВрдЪрддреЗ рд╣реИрдВред рдУрдПрд▓рдИрдбреА рд╕реНрдХреНрд░реАрди, рдЕрдЧрд░ рд╣рд░ рд╕рдордп рдЪрд╛рд▓реВ рд╣реЛ рдЬрд╛рдП рддреЛ рдЬрд▓реНрджреА рд╕реЗ рдлреАрдХрд╛ рдкрдбрд╝ рдЬрд╛рддрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="hljs lisp">STARTUP(<span class="hljs-name"><span class="hljs-name">System</span></span>.enableFeature(<span class="hljs-name"><span class="hljs-name">FEATURE_RETAINED_MEMORY</span></span>))<span class="hljs-comment"><span class="hljs-comment">;</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ stm рдХрдВрдЯреНрд░реЛрд▓рд░ рдХрд╛ рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдФрд░ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдлреАрдЪрд░ рд╣реИ, рд╕рдВрджрд░реНрдн рдХрдг рдореЗрдВ рд╡реЗ рдЗрд╕реЗ BackupSRAM рдХрд╣рддреЗ рд╣реИрдВред рдлреЛрдЯреЙрди рдХрд╛ vbat рдЖрдЙрдЯрдкреБрдЯ рд╣реИ - рдпрд╣ рдмреИрдЯрд░реА рдкрд╛рд╡рд░ рдпрд╛ рдЪрд╛рд░реНрдЬрд┐рдВрдЧ рдирд╣реАрдВ рд╣реИред рдЬрдм рддрдХ рдЗрд╕ рдкреИрд░ рдкрд░ рд╡реЛрд▓реНрдЯреЗрдЬ рд╣реИ, рддрдм рддрдХ SRAM рдХреЗ 4k рдмрд╛рдЗрдЯреНрд╕ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдбреА-рдПрдирд░реНрдЬреЗрдЯрд┐рдХ рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рд╕рд╛рде рдмрдирд╛рдП рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ EEPROM рдкрд░ рдкрд╣рдирдиреЗ рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЛрдб рдореЗрдВ, рдЪрд░ рдЬрд┐рдиреНрд╣реЗрдВ рдЗрд╕ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрдЪрд╛рд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рд╕рдВрдХреЗрдд рдХреЗ рд╕рд╛рде рдШреЛрд╖рд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВ: рдмрдирд╛рдП рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИред рдореИрдВрдиреЗ 1.5F рдкрд░ рд╕реБрдкрд░рдХреИрдкреЗрд╕рд┐рдЯрд░ рд╕реЗ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ред рдбреЗрдЯрд╛рд╢реАрдЯ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдореЗрдореЛрд░реА 1.6v рдкрд░ рдорд░ рдЬрд╛рдПрдЧреА, рдкреНрд░реЛрдЯреЛ-рдмреЛрд░реНрдб рдкрд░ рдореЗрд░реЗ рдмреЗрдВрдЪ рдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдпрд╣ рдореЗрд░реЗ рдХреИрдкреЗрд╕рд┐рдЯрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ 2 рд╕рдкреНрддрд╛рд╣ рдореЗрдВ рдЖрдПрдЧрд╛ред рд╕реЗрдВрд╕рд░ рдЪрд╛рд▓реВ рд╣реЛрдиреЗ рдкрд░ рдХреНрд░реЗрди рдХреЛ рдмрдВрдж рдХрд░рдиреЗ рдХрд╛ рддрд░реНрдХ "рд╕реНрд╡рд╛рдпрддреНрдд" рд╣реИ рдФрд░ рдУрдкрдирд╣реИрдм рдХреЗ рдХрдиреЗрдХреНрд╢рди рдкрд░ рдирд┐рд░реНрднрд░ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред рдбрд╛рдпрд░реЗрдХреНрдЯ рдбреНрд░рд╛рдЗрд╡ рдХрдВрдЯреНрд░реЛрд▓ рдХреЗ рд▓рд┐рдП 3-рд╡реЗ рд╕реНрд╡рд┐рдЪ рд╣реИ - рдСрдЯреЛрдореИрдЯрд┐рдХ, рдСрдл (рдУрдкрди рдЯреИрдкреНрд╕), рдХреНрд▓реЛрдЬ (рдХрд░реАрдм)ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╕рд░реНрдХрд┐рдЯ рдЖрд░реЗрдЦ: </font></font><br>
<br>
<img src="https://habrastorage.org/files/1a8/f4c/63d/1a8f4c63dba34f4e9905b703fabad0fd.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдИрдЧрд▓ рдкрд░рд┐рдпреЛрдЬрдирд╛, рдХрд╕реНрдЯрдо рд▓рд┐рдмрд╛рд╕ рдХреЗ рд╕рд╛рде, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рд╣реИ</font></a><font style="vertical-align: inherit;"> ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╢реБрд▓реНрдХ LUT рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдкрдЯрд░рд┐рдпреЛрдВ рдореЗрдВ рд╕рд┐рдХреБрдбрд╝ рдирд╣реАрдВ рдерд╛ред</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LUT рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рджреЛрд╕реНрдд рдкрд╛рдиреА рдХрд╛ рд╕реНрдирд╛рди</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/351/e37/1c3/351e371c3caf487d9f14f839f89402be.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд┐рдЬрд▓реА рдЖрдкреВрд░реНрддрд┐ рдЗрдХрд╛рдИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ 12 рдФрд░ 5 рд╡реЛрд▓реНрдЯ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рджрд╛рддрд╛ рд▓рд╛рдЗрди рдкрд░ ebay рдкрд░ рдЦреЛрдЬрд╛: ┬лрд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдкрд╛рд╡рд░ рдПрдбрд╛рдкреНрдЯрд░ 5v 12 рд╡реА ┬╗, </font><font style="vertical-align: inherit;">рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕ рддрд░рд╣ рдХреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╡рд╛рд╕</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдПрдХ 3 рдбреА рдкреНрд░рд┐рдВрдЯрд░ (рдЯрд╛рд░реЗрдВрдЯрдпреБрд▓рд╛ рдЯреЗрд╡реЛ) рдкрд░ рдкреАрдПрд▓рдП рдкреНрд▓рд╛рд╕реНрдЯрд┐рдХ рдХреЗ рд╕рд╛рде рдореБрджреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдиреЛрдЬрд▓ 0.4 рдорд┐рдореА, рдкрд░рдд 0.25 рдорд┐рдореАред </font><font style="vertical-align: inherit;">рдХрд╡рд░ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдФрд░ рдирд┐рдпрдВрддреНрд░рдХ рдмреЛрд░реНрдб рдмрдврд╝рддреЗ рдХреЗ рд▓рд┐рдП рдЖрдзрд╛рд░ рд╣реИред </font><font style="vertical-align: inherit;">рдмрд┐рдЬрд▓реА рдХреА рдЖрдкреВрд░реНрддрд┐ рдХреЗ рд╕рд╛рде рдЖрдзрд╛рд░ рджреАрд╡рд╛рд░ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИред </font><font style="vertical-align: inherit;">рдврдХреНрдХрди рдХреЗ рд╕рд╛рде рдЖрдзрд╛рд░ рдХреЛ рд╢рд┐рдХрдВрдЬрд╛ рдХреЗ рд╕рд╛рде рдмрд╛рдВрдзрд╛ рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИ, рдкрд░реНрдпрд╛рдкреНрдд рдврдХреНрдХрди рддрдирд╛рд╡ рд╣реИ (рдЬреИрд╕реЗ рдЬрд╛рдо рдХреЗ рдЬрд╛рд░ рдкрд░ рджрд╛рджреА рдХреЗ рдврдХреНрдХрди) рдФрд░ рджреАрд╡рд╛рд░реЛрдВ рдХреА рд╕реНрддрд░рд┐рдд рд╕рдВрд░рдЪрдирд╛ рдХрд╛рдо рдХрд░рддреА рд╣реИред </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рд╕рдВрдЧреНрд░рд╣</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдореЗрдВ 3 рдбреА рдореЙрдбрд▓ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рдм рдПрдХ рдкрд╛рдиреА рдХреЗ рдкрд╛рдЗрдк рдкрд░ рдХреИрд╕реЗ рджрд┐рдЦрддрд╛ рд╣реИред</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/files/945/110/37d/94511037d3734ad1a573e84e5fc426ef.png"><br>
<br>
<img src="https://habrastorage.org/files/5aa/546/c0b/5aa546c0b6dd41d58fd6b33bde08df74.png"><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/files/cfb/293/f66/cfb293f66c3f4bb9ad2f46e812418918.jpg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openhab</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдСрд░реЗрдВрдЬ рдкрд╛рдИ рд╡рди рдкрд░ рдЖрд░реНрдордмрд┐рдпрди рдХреЗ рддрд╣рдд рддреИрдирд╛рддред</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдЯрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди</font></font></b><div class="spoiler_text"><pre><code class="hljs julia">  -    ,  .
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_temp1	<span class="hljs-string"><span class="hljs-string">"T cool [%.1f ┬░C]"</span></span>			(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/temp1:state:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_temp2	<span class="hljs-string"><span class="hljs-string">"T hot [%.1f ┬░C]"</span></span>			(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/temp2:state:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_count0	<span class="hljs-string"><span class="hljs-string">"Count cool [%.2f ┬│]"</span></span>					(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/counter/0:state:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_count1	<span class="hljs-string"><span class="hljs-string">"Count hot [%.2f ┬│]"</span></span>				(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/counter/1:state:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_pressure0	<span class="hljs-string"><span class="hljs-string">"P cool [%.2f .]"</span></span>			(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/pressure/0:state:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_pressure1	<span class="hljs-string"><span class="hljs-string">"P hot [%.2f .]"</span></span>				(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/pressure/1:state:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_sensor0	<span class="hljs-string"><span class="hljs-string">"Sensor0 is [MAP(water_sensor.map):%s]"</span></span>		(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/sensor/0:state:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_sensor1	<span class="hljs-string"><span class="hljs-string">"Sensor1 is [MAP(water_sensor.map):%s]"</span></span>		(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/sensor/1:state:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_valve0	<span class="hljs-string"><span class="hljs-string">"Valve cool"</span></span>		(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/valve/0:state:default], &gt;[mqtt_bro:home/water_count/valve/0/set:command:*:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_valve1	<span class="hljs-string"><span class="hljs-string">"Valve hot"</span></span>				(gWaterCount)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/valve/1:state:default], &gt;[mqtt_bro:home/water_count/valve/1/set:command:*:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>	watercount_sendStr <span class="hljs-string"><span class="hljs-string">"LastVol:[%s]"</span></span>						(gWaterCount)
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_sendCool <span class="hljs-string"><span class="hljs-string">"Send cool [%.2f ┬│]"</span></span>		(gWaterCount)
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_sendHot <span class="hljs-string"><span class="hljs-string">"Send hot [%.2f ┬│]"</span></span>			(gWaterCount)
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_sendSwitch <span class="hljs-string"><span class="hljs-string">"Autosend"</span></span> 	(gWaterCount)
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_rssi	<span class="hljs-string"><span class="hljs-string">"WaterCount [%d dB]"</span></span>	(gSpark_RSSI)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/rssi:state:default]"</span></span> }
<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>	watercount_spark_state	<span class="hljs-string"><span class="hljs-string">"WaterCount Spark"</span></span>		(gSpark)		{ mqtt=<span class="hljs-string"><span class="hljs-string">"&lt;[mqtt_bro:home/water_count/spark:state:default], &gt;[mqtt_bro:home/water_count/spark/set:command:*:default]"</span></span> }</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд░рд┐рд╕рд╛рд╡ рд╕реЗрдВрд╕рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдЫреЛрдЯреЗ рдкрд░рд┐рд╡рд░реНрддрди рдирд┐рдпрдо рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдВрдлрд░реНрдЯ рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдо рдХрд░рддрд╛ рд╣реИ</font></font></b><div class="spoiler_text"><b>transform\water_sensor.map </b><br>
1=dry<br>
0=wet<br>
undefined=undefined<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП рдкреГрд╖реНрда рдмрдирд╛рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдЗрдЯрдореИрдк рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИ</font></font></b><div class="spoiler_text"><b>Sitemap</b><br>
Text label=┬л┬╗ icon=┬лwater┬╗ <br>
 {<br>
 Frame <br>
 {<br>
 Text item=watercount_temp1<br>
 Text item=watercount_count0<br>
 Text item=watercount_pressure0<br>
 Switch item=watercount_valve0 mappings=[1=┬лClose┬╗, 0=┬лOpen┬╗]<br>
 }<br>
 Frame <br>
 {<br>
 Text item=watercount_temp2<br>
 Text item=watercount_count1<br>
 Text item=watercount_pressure1<br>
 Switch item=watercount_valve1 mappings=[1=┬лClose┬╗, 0=┬лOpen┬╗]<br>
 }<br>
 Frame <br>
 {<br>
 Text item=watercount_sensor0<br>
 Text item=watercount_sensor1 <br>
 }<br>
 Frame <br>
 {<br>
 Switch item=watercount_sendSwitch mappings=[0=┬лOFF┬╗, 1=┬лON┬╗]<br>
 Text item=watercount_sendStr<br>
 Text item=watercount_sendCool<br>
 Text item=watercount_sendHot<br>
 }<br>
 } <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдпрдо:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдпрдореЛрдВ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИ</font></font></b><div class="spoiler_text"><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> "Check watercount_sensor0"
	<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>
		Item watercount_sensor0 received <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>
	<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_sensor0.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) == <span class="hljs-number"><span class="hljs-number">1</span></span>)
		{
			<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_sensor0.historicState(now.minusSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)).state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) == <span class="hljs-number"><span class="hljs-number">1</span></span>)
			{
				sendTelegram("****_bot", "Sensor0 was wet less than 5 seconds")
			}
			<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
			{
				sendTelegram("****_bot", "Sensor0 become dry")
			}
		}
		<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
		{
			<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_sensor0.historicState(now.minusSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)).state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) == <span class="hljs-number"><span class="hljs-number">0</span></span>)
			{
				sendTelegram("****_bot", "Sensor0 was dry less than 5 seconds");			
			}
			<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
			{
				sendTelegram("****_bot", "Sensor0 become wet! Valves will be closed!")
			}
		}
	<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> "Check watercount_sensor1"
	<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>
		Item watercount_sensor1 received <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>
	<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_sensor1.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) == <span class="hljs-number"><span class="hljs-number">1</span></span>)
		{
			<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_sensor1.historicState(now.minusSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)).state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) == <span class="hljs-number"><span class="hljs-number">1</span></span>)
			{
				sendTelegram("****_bot", "Sensor1 was wet less than 5 seconds")
			}
			<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
			{
				sendTelegram("****_bot", "Sensor1 become dry")
			}
		}
		<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
		{
			<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_sensor1.historicState(now.minusSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)).state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) == <span class="hljs-number"><span class="hljs-number">0</span></span>)
			{
				sendTelegram("****_bot", "Sensor1 was dry less than 5 seconds");			
			}
			<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
			{
				sendTelegram("****_bot", "Sensor1 become wet! Valves will be closed!")
			}
		}
	<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>
	
<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> "Check watercount_temp2"
	<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>
		Item watercount_temp2 received <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>
	<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_temp2.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) &lt; <span class="hljs-number"><span class="hljs-number">37</span></span> )
		{
			sendTelegram("****_bot", String::format("Hot water temp drop to %s", watercount_temp2.state.toString));
		}
	<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>

<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> "Check watercount_pressure0"
	<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>
		Item watercount_pressure0 received <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>
	<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_pressure0.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; (watercount_pressure0.historicState(now.minusSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)).state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>)
		{
			sendTelegram("****_bot", String::format("Cool pressure drop to %s", watercount_pressure0.state.toString));
		}
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_pressure0.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; (watercount_pressure0.historicState(now.minusSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)).state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>)
		{
			sendTelegram("****_bot", String::format("Cool pressure rise to %s", watercount_pressure0.state.toString));
		}
	<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> "Check watercount_pressure1"
	<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>
		Item watercount_pressure1 received <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>
	<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_pressure1.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; (watercount_pressure1.historicState(now.minusSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)).state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>)
		{
			sendTelegram("****_bot", String::format("Hot pressure drop to %s", watercount_pressure1.state.toString));
		}
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((watercount_pressure1.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; (watercount_pressure1.historicState(now.minusSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)).state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType) &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>)
		{
			sendTelegram("****_bot", String::format("Hot pressure rise to %s", watercount_pressure1.state.toString));
		}
	<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>

<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> "Generate send string counters" //every <span class="hljs-number"><span class="hljs-number">24</span></span> day <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> mounth  <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">00.01</span></span> minutes
	<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>
		<span class="hljs-type"><span class="hljs-type">Time</span></span> cron "0 0 1 24 1/1 ?" 
	<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
		
		var <span class="hljs-type"><span class="hljs-type">float</span></span> deltaCool = (watercount_count0.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType).floatValue() - (watercount_sendCool.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType).floatValue()
		var <span class="hljs-type"><span class="hljs-type">float</span></span> deltaHot = (watercount_count1.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType).floatValue() - (watercount_sendHot.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType).floatValue()
		
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (deltaCool &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; deltaHot &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>)
		{
			watercount_sendStr.postUpdate(String::format(" %.2f / %.2f 3", deltaCool, deltaHot))
			watercount_sendCool.state = watercount_count0.state
			watercount_sendHot.state = watercount_count1.state
			sendTelegram("****_bot", String::format(" 23,  5, . 23.  тДЦ2560097 (.) = %.2f 3. C тДЦ2538996 (.) = %.2f 3. %s", (watercount_sendCool.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType).floatValue(), (watercount_sendHot.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType).floatValue(), watercount_sendStr.state.toString()))
		}
		<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
		{
			watercount_sendSwitch.postUpdate(<span class="hljs-number"><span class="hljs-number">0</span></span>)
			sendTelegram("****_bot", "Current counters value less than sended last time. Turn off autosend.")
		}
<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> "Send string counters" 
	<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>
		<span class="hljs-type"><span class="hljs-type">Time</span></span> cron "0 0 23 24 1/1 ?"
	<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (watercount_sendSwitch.state == <span class="hljs-number"><span class="hljs-number">1</span></span>)
		{
			sendMail("uk@uk.ru", " 23,  5, . 23", String::format(" 23,  5, . 23.  тДЦ2560097 (.) = %.2f 3. C тДЦ2538996 (.) = %.2f 3", (watercount_sendCool.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType).floatValue(), (watercount_sendHot.state <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DecimalType).floatValue()));
			sendTelegram("****_bot", "Send email with watercount values");
		}
		<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
		{
			sendTelegram("****_bot", "Can't send email with watercount values - autosend is OFF.");
		}
<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> "Rotate valves" 
	<span class="hljs-keyword"><span class="hljs-keyword">when</span></span>
		<span class="hljs-type"><span class="hljs-type">Time</span></span> cron "0 0 05 25 1/1 ?"
	<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (watercount_valve0.state == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; watercount_valve1.state == <span class="hljs-number"><span class="hljs-number">0</span></span>)
		{	
			watercount_valve0.postUpdate(<span class="hljs-number"><span class="hljs-number">1</span></span>)
			Thread::sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>)
			watercount_valve1.postUpdate(<span class="hljs-number"><span class="hljs-number">1</span></span>)
			Thread::sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>)
			watercount_valve0.postUpdate(<span class="hljs-number"><span class="hljs-number">0</span></span>)
			Thread::sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>)
			watercount_valve1.postUpdate(<span class="hljs-number"><span class="hljs-number">0</span></span>)
			sendTelegram("****_bot", "Valves was rotated.");
		}
		<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>
		{
			sendTelegram("****_bot", "Can't rotate valves, it's closed.");
		}
<span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВ рдУрдкрдирд╣реЗрдб рдПрдВрдбреНрд░реЙрдЗрдб рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реВрдВ, рди рд╣реА рдореИрдВ рдЙрдирдХреЗ рдХреНрд▓рд╛рдЙрдб рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рдХрд░рддрд╛ рд╣реВрдВред </font><font style="vertical-align: inherit;">рдореБрдЭреЗ рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдмреЙрдЯ рдкрд╕рдВрдж рд╣реИред </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдХреА</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░ рдмреЙрдЯ рдХреЛ рдХреИрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдФрд░ рдХрдиреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬреАрдореЗрд▓ рдореЗрд▓рдмреЙрдХреНрд╕ рд╕реЗ рдкрддреНрд░ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рджреЛ-рдХрд╛рд░рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдореЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд░ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЗрд╕ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдУрдкрдирд╣реИрдм рдХреЙрдиреНрдлрд┐рдЧрд░ рдореЗрдВ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рдпрдо рд╕реЗ рдЪрд▓реЛред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watercount_sensor рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдирд┐рдпрдВрддреНрд░рдХ рдирдП рд░рд┐рд╕рд╛рд╡ рд╕рдВрд╡реЗрджрдХ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдХреЗрд╡рд▓ рддрднреА рднреЗрдЬрддрд╛ рд╣реИ рдЬрдм рдореВрд▓реНрдп рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рдпрджрд┐ рдХреЛрдИ рдЧрд▓рдд рдЕрд▓рд╛рд░реНрдо рдерд╛ (10 рдЪрдХреНрд░реЛрдВ рд╕реЗ рдХрдо)ред рд╣рдо рдЖрдП рдФрд░ рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рдорд╣рддреНрд╡ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддреЗ рд╣реИрдВ, рд╣рдо рд╕реВрдЪрдирд╛рддреНрдордХ рд╕рдВрджреЗрд╢ рдмрдирд╛рддреЗ рд╣реИрдВред рдПрдХ рдЕрддрд┐ рд╕реВрдХреНрд╖реНрдо рдЕрдВрддрд░ рд╣реИ - рдкреНрд░реАрд╡рд┐рдпрд╕ рдЗрдЯрд┐рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рд▓рдЧрд╛рддрд╛рд░ рд╡рд░реНрддрдорд╛рди рдореВрд▓реНрдп рджреЗрддрд╛ рд╣реИ, рдореБрдЭреЗ рдХреЛрдИ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рдорд┐рд▓рд╛ рд╣реИ - рдореИрдВ "-3 рд╕реЗрдХрдВрдб" рдорд╛рди рд▓реЗрддрд╛ рд╣реВрдВ, рдпрджрд┐ рдХреЛрдИ рдЗрд╕реЗ рдЕрдзрд┐рднреВрдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ рдпрд╛ рдкреАрдПрдо рдореЗрдВ рд▓рд┐рдЦреЗрдВред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watercount_temp2 рдХреА</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд╛рдВрдЪ рдХрд░реЗрдВ - рдпрджрд┐ 37 рд╕реЗ рдХрдо рд╣реИ, рддреЛ рдЬрд╛рдВрдЪ рд▓реЗрдВ рдХрд┐ рдЧрд░реНрдо рдкрд╛рдиреА рдардВрдбрд╛ рд╣реЛ рдЧрдпрд╛ рд╣реИ, рдЖрдкрдХреЛ рдЖрдЧрдорди рдкрд░ рдлреНрд▓реЛ рд╣реАрдЯрд░ рдЪрд╛рд▓реВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реЙрдЯрд░рдХрд╛рдЙрдВрдЯ_рдкреНрд░реЗрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - рд╣рдо рд╡рд░реНрддрдорд╛рди рдФрд░ рдкрд┐рдЫрд▓реЗ рдореВрд▓реНрдп рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддреЗ рд╣реИрдВ, рд╣рдо рдПрдХ рд╕рдВрджреЗрд╢ рдХреЗ рд╕рд╛рде 1 рдПрдЯреАрдПрдо рд╕реЗ рдиреАрдЪреЗ рдХреА рдЧрд┐рд░рд╛рд╡рдЯ рдФрд░ рдЙрд╕рдХреЗ рдКрдкрд░ рд╡рд┐рдХрд╛рд╕ рдХрд╛ рдЬрд╡рд╛рдм рджреЗрддреЗ рд╣реИрдВред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреЗрдЬреЗрдВ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛рдЙрдВрдЯрд░</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдкреНрд░рддреНрдпреЗрдХ рдорд╣реАрдиреЗ рдХреА 24 рддрд╛рд░реАрдЦ рдХреЛ рд╕реБрдмрд╣ 1 рдмрдЬреЗ рдХреНрд░реЛрди рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред рд╣рдо рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рдХрд┐ рдкрд┐рдЫрд▓реА рдмрд╛рд░ рднреЗрдЬреЗ рдЧрдП рдореВрд▓реНрдпреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдм рдорд╛рди рдмрдбрд╝реЗ рд╣реИрдВред рдпрджрд┐ рдХрдо рд╣реИ, рддреЛ рдСрдЯреЛ рднреЗрдЬрдиреЗ рдХреЛ рдмрдВрдж рдХрд░реЗрдВ рдФрд░ рдЕрд▓рд░реНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВред рдпрджрд┐ рдареАрдХ рд╣реИ - рд╣рдореЗрдВ рдЖрдкрд░рд╛рдзрд┐рдХ рдХреЛрдб рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдЙрдВрдЯрд░реЛрдВ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдпрд╛рдж рд╣реИ, рддреЛ рд╣рдо рднрд╡рд┐рд╖реНрдп рдХреЗ рд╕рдВрджреЗрд╢ рдирд┐рдХрд╛рдп рдХреЛ рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдкрд░ рднреЗрдЬрддреЗ рд╣реИрдВред рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ, рд╣рдо watercount_sendStr рдореЗрдВ рдмрдЪрдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдордиреЗ рдкрд┐рдЫрд▓реЗ рдорд╣реАрдиреЗ рдореЗрдВ рдХрд┐рддрдирд╛ рдЦрд╛рдпрд╛ред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдирд░реЗрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╕реНрдЯреНрд░рд┐рдВрдЧ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 24 рддрд╛рд░реАрдЦ рдХреЛ 23.00 рдмрдЬреЗ рдХреНрд░реЛрди рдкрд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред рдЬрд╛рдБрдЪрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдСрдЯреЛ рднреЗрдЬрдирд╛ рд╕рдХреНрд╖рдо рд╣реИ, рдЕрдЧрд░ рдпрд╣ рдЪрд╛рд▓реВ рд╣реИ - рд╣реЗрд▓рдореЗрдЯ рд╢рд┐рдкрд┐рдВрдЧ рдХрдВрдкрдиреА рдХреЗ рдореЗрд▓ рдкрд░ рдХрд╛рдЙрдВрдЯрд░ рднреЗрдЬрддрд╛ рд╣реИред рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдореЗрд░реЗ рдкрд╛рд╕ рдкреВрд░реЗ рджрд┐рди рдореЗрдВ 24 рд╡рд╛рдВ рджрд┐рди рд╣реИ, рдХреБрдЫ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдпрд╛ рдмрд╕ рдСрдЯреЛ рднреЗрдЬрдиреЗ рдореЗрдВ рдХрдЯреМрддреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдЧрд░ рдЯреЗрд▓реАрдлрд╝реЛрди рдореЗрдВ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рд╣реБрдИред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯрд┐рдкреНрдкрдгреА рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рд▓реНрд╡ рдШреБрдорд╛рдПрдБ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдЙрдмрд▓рдиреЗ рдХреЗ рдЦрд┐рд▓рд╛рдл рдорд╣реАрдиреЗ рдореЗрдВ рдПрдХ рдмрд╛рд░ рдирд▓ рдХреЛ рдмрдВрдж рдХрд░рдиреЗ / рдЦреЛрд▓рдиреЗ рдХрд╛ рдирд┐рдпрдоред </font><font style="vertical-align: inherit;">25 рддрд╛рд░реАрдЦ рдХреЛ рд╕реБрдмрд╣ 5 рдмрдЬреЗ - рддрд╛рдХрд┐ рдбрд┐рд╢рд╡реЙрд╢рд░ рдпрд╛ рд╡реЙрд╢рд┐рдВрдЧ рдорд╢реАрди рдХреЗ рдХрд╛рдо рдореЗрдВ рди рдЖрдПрдВ, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдпрд╣ рд╡рд╣рд╛рдВ рдкрд╣реБрдВрдЪ рднреА рдЬрд╛рддрд╛ рд╣реИ - рддреЛ рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИ, рдкрд╛рдиреА рдХрд╛ рдУрд╡рд░рд▓реИрдк рд▓рдЧрднрдЧ 3-4 рд╕реЗрдХрдВрдб рд╣реЛрдЧрд╛ред </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдХреЗрд╡рд▓ рдпрд╣рд╛рдВ рд╕реНрдорд╛рд░реНрдЯ рд╣реЛрдо рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ ...</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдПрдХ рдмрд┐рдВрджреБ (рдУрдкрдирд╣реИрдм) рдореЗрдВ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рд╕реЗ рдЖрдк рддрд░реНрдХ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдХрд┐ рд╕реНрд╡рд╛рдпрддреНрдд рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рдПрдХ рд╕реЗрдЯ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: рдкрд╛рдиреА рдХреЗ рдореАрдЯрд░ рдореЗрдВ рд╡реГрджреНрдзрд┐ рдХреА рдПрдХ рдШрдЯрдирд╛ рдЖ рдЧрдИ рд╣реИ - рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдгрд╛рд▓реА рд╕рдХреНрд░рд┐рдп рд╣реИ, рд╕рд╛рдордиреЗ рдХреЗ рджрд░рд╡рд╛рдЬреЗ рдХреЗ рддрд╛рд▓реЗ рдмрдВрдж рд╣реИрдВ, рдбрд┐рд╢рд╡реЙрд╢рд░ рдФрд░ рд╡реЙрд╢рд┐рдВрдЧ рдорд╢реАрди рдХреА рдКрд░реНрдЬрд╛ рдЦрдкрдд 5 рд╡рд╛рдЯ рд╕реЗ рдХрдо рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╕реЗрдВрд╕рд░ рджреНрд╡рд╛рд░рд╛ рдПрдХ рд░рд┐рд╕рд╛рд╡ рдХрд╛ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдХреНрд░реЗрди рдХреЛ рдмрдВрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрдорд╛рдВрдб рдмрдирд╛рддреЗ рд╣реИрдВ, рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдореЗрдВ рдмреЙрдЯ рдХреЛ рдПрдХ рд╕рдВрджреЗрд╢ рднреЗрдЬрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпрд╣ рдмрд╛рдж рдореЗрдВ рдПрдХ рдзрд╛рдЧреЗ рдХреА рддрд░рд╣ рд╣реИред</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi399459/">https://habr.com/ru/post/hi399459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi399449/index.html">рдбреАрдПрдирдП рдЧреБрдгрд╕реВрддреНрд░реЛрдВ рдХрд╛ рдХреЗрд╡рд▓ рдЖрдзрд╛ рдЖрдХрд╛рд░ рд╣реИред рдмрд╛рдХреА рд╕рдм рдХреБрдЫ рдЕрдЬреНрдЮрд╛рдд рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдПрдХ рдЦреЛрд▓ рд╣реИ</a></li>
<li><a href="../hi399451/index.html">рд╣рдорд╛рд░реА рдХреЛрдИ рд╢рд┐рд╢реБ рдпрд╛рджреЗрдВ рдХреНрдпреЛрдВ рдирд╣реАрдВ рд╣реИрдВ</a></li>
<li><a href="../hi399453/index.html">рдмреНрд▓реЙрдХрдЪреЗрди рдордиреА рдХреЗ рдкрд╛рдВрдЪ рд░реВрдк рдЕрдм рдЙрдкрд▓рдмреНрдз рд╣реИрдВ</a></li>
<li><a href="../hi399455/index.html">рдХреЗрд╡рд▓ рдШрд░реЗрд▓реВ рдЙрдкрдХрд░рдг рд╣реА рдирд╣реАрдВ: рд╕рдВрдЧреАрдд рдкреНрд░реЗрдорд┐рдпреЛрдВ, рдкреНрд░реЗрдорд┐рдпреЛрдВ рдФрд░ рд╕рдВрдЧреАрддрдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдСрдбреЛрдореЗрдирд┐рдпрд╛ рдореЗрдВ рдФрд░ рдХреНрдпрд╛ рд╣реИ</a></li>
<li><a href="../hi399457/index.html">рд░реВрд╕реА рдлрд┐рдирдЯреЗрдХ рдореАрдЯрдЕрдк # 2: рдбрд┐рдЬрд┐рдЯрд▓ рдпреБрдЧ рдореЗрдВ рдЯреНрд░реЗрдбрд┐рдВрдЧ</a></li>
<li><a href="../hi399461/index.html">рдЖрд░реНрдЯрд┐рдлрд┐рд╢рд┐рдпрд▓ рдЗрдВрдЯреЗрд▓рд┐рдЬреЗрдВрд╕ рд╕реЗ рд▓реЛрдЧреЛрдВ рдХреЛ рдлреЛрдмрд┐рдпрд╛ рдФрд░ рднрдп рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдореЗрдВ рдорджрдж рдорд┐рд▓реЗрдЧреА</a></li>
<li><a href="../hi399463/index.html">рдорд▓реНрдЯреАрдХреНрд░реЙрдкреНрдЯрд░ рдиреЗ рдЪрд▓рддреА рдХрд╛рд░реЛрдВ рдХреА рдЫрддреЛрдВ рдкрд░ рдмреИрдардирд╛ рд╕реАрдЦрд╛</a></li>
<li><a href="../hi399469/index.html">Pix2pix рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд░реВрдк рд╕реЗ рдкреЗрдВрд╕рд┐рд▓ рд╕реНрдХреЗрдЪ рдФрд░ рдХрд╛рд▓реЗ рдФрд░ рд╕рдлреЗрдж рдлреЛрдЯреЛ рд░рдВрдЧ</a></li>
<li><a href="../hi399471/index.html">рдЕрдВрддрд░рд┐рдХреНрд╖ рдЖрд╡рд╛рд╕, рднрд╛рдЧ 5: рд╣рдо рдмреБрдз рдкрд░ рдХреИрд╕реЗ рд░рд╣реЗрдВрдЧреЗ (рдпрд╛ рд╣рдо рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ)</a></li>
<li><a href="../hi399473/index.html">рдЪрд┐рдк рдЗрдВрдЯреЗрд▓ 4004 45 рд╕рд╛рд▓ рдХреА рд╣реЛ рдЧрдИред рдЖрдИрдЯреА рдЗрддрд┐рд╣рд╛рд╕ рдХрд╛ рдПрдХ рд╕рд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>