<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘ğŸ¿ ğŸ‘¥ ğŸ‘¨ğŸ¾â€ğŸ« æˆ‘ä»¬å¦‚ä½•æ‘†è„±Windows Corporate ğŸ’— ğŸ“¹ âœŠğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¢°å·§åœ¨æˆ‘ä»¬å…¬å¸ä¸­ï¼ŒCï¼ƒè¢«é€‰ä½œåç«¯å¼€å‘çš„ä¸»è¦è¯­è¨€ã€‚ é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸€ç›´å¯¹è¿™ä¸ªé€‰æ‹©æ„Ÿåˆ°æ»¡æ„ï¼Œå½“MSå¼€å§‹å¼€å‘.net Coreå¹³å°æ—¶ï¼Œå®ƒå˜å¾—æ›´åŠ æœ‰è¶£ï¼Œå› ä¸ºCï¼ƒå¾ˆå¥½ï¼Œä½†æ˜¯Linuxä¸‹çš„Cï¼ƒæ›´å¥½ã€‚ 


 æˆ‘ä¸ä¼šæè¿°è·¨å¹³å°å¼€å‘çš„è¿‡æ¸¡è·¯å¾„ï¼Œå› ä¸ºå·²ç»æœ‰å¾ˆå¤šäººå·²ç»ä»æ¡†æ¶è¿‡æ¸¡åˆ°æ ¸å¿ƒã€‚ 


 æˆ‘å°†åªå…³æ³¨ä¸€ç‚¹ã€‚ é™¤å…¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æˆ‘ä»¬å¦‚ä½•æ‘†è„±Windows Corporate</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419975/"><p> ç¢°å·§åœ¨æˆ‘ä»¬å…¬å¸ä¸­ï¼ŒCï¼ƒè¢«é€‰ä½œåç«¯å¼€å‘çš„ä¸»è¦è¯­è¨€ã€‚ é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸€ç›´å¯¹è¿™ä¸ªé€‰æ‹©æ„Ÿåˆ°æ»¡æ„ï¼Œå½“MSå¼€å§‹å¼€å‘.net Coreå¹³å°æ—¶ï¼Œå®ƒå˜å¾—æ›´åŠ æœ‰è¶£ï¼Œå› ä¸ºCï¼ƒå¾ˆå¥½ï¼Œä½†æ˜¯Linuxä¸‹çš„Cï¼ƒæ›´å¥½ã€‚ </p><br><p> æˆ‘ä¸ä¼šæè¿°è·¨å¹³å°å¼€å‘çš„è¿‡æ¸¡è·¯å¾„ï¼Œå› ä¸ºå·²ç»æœ‰å¾ˆå¤šäººå·²ç»ä»æ¡†æ¶è¿‡æ¸¡åˆ°æ ¸å¿ƒã€‚ </p><br><p> æˆ‘å°†åªå…³æ³¨ä¸€ç‚¹ã€‚ é™¤å…¶ä»–äº‹é¡¹å¤–ï¼ŒDockerä¿ƒä½¿æˆ‘ä»¬ä¸ºLinuxæ‰˜ç®¡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå› ä¸ºæˆ‘çœŸçš„å¾ˆæƒ³åŠ å…¥å¹´è½»çš„å®¹å™¨åŒ–è¶‹åŠ¿ï¼Œå³ä¸€åˆ‡å¯èƒ½çš„äº‹æƒ…ã€‚ </p><br><p> ç”±äºæˆ‘ä»¬æ­£åœ¨å¼€å‘ä¼ä¸šï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¿…é¡»é€šè¿‡Linuxè¿›è¡Œä¼ é€’Windowsèº«ä»½éªŒè¯ã€‚ å®é™…ä¸Šï¼Œè¿™å°±æ˜¯æ’°å†™æœ¬æ–‡çš„åŠ¨åŠ›ã€‚ ç”±äºä¿¡æ¯éå¸¸å›°éš¾ï¼Œéœ€è¦åˆ†å¼€å¤„ç†ï¼Œå¹¶ä¸”éœ€è¦ä¸è®¸å¤šäººè¿›è¡Œäº¤æµï¼Œå› æ­¤å°†æ‚¨éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯æ”¶é›†åœ¨ä¸€ä¸ªåœ°æ–¹å¹¶æè¿°å·¥ä½œæ–¹æ¡ˆçš„æƒ³æ³•ä¼¼ä¹ä¸é”™ã€‚ </p><a name="habracut"></a><br><p> ä½œä¸ºè§£å†³æ–¹æ¡ˆï¼Œåœ¨å…·æœ‰kerberosèº«ä»½éªŒè¯çš„nginxä¸‹é€‰æ‹©äº†åå‘ä»£ç†é€‰é¡¹ã€‚ ä¸ºäº†ä½¿æ¥è‡ªä¸åŒé¡¹ç›®çš„åŒå¿—å¯ä»¥ä½¿ç”¨è¯¥è§£å†³æ–¹æ¡ˆï¼Œå› æ­¤å†³å®šå½’æ¡£dockeræ˜ åƒï¼Œè¿™å°†è§£å†³åŸºæœ¬é—®é¢˜ï¼Œå…¶ä»–äººå¯ä»¥ä»ä¸­ç»§æ‰¿æˆ–æŒ‰åŸæ ·ä½¿ç”¨å®ƒã€‚ </p><br><p> ä¸ºäº†ä½¿kerberosæ­£å¸¸å·¥ä½œï¼Œæ‚¨å¿…é¡»ä½¿ç”¨å…¶ä»–æ¨¡å—æ¥æ„å»ºnginxã€‚ <br> ç»“æœï¼Œæˆ‘ä»¬ç»„å»ºäº†è¿™æ ·çš„å›¢é˜Ÿã€‚ ä¸¤æ¬¡è°ƒç”¨å°†æ‰€æœ‰å†…å®¹æ‹¼å‡‘åœ¨ä¸€èµ·ï¼Œä»¥åˆ›å»ºæ›´å°‘çš„å›¾å±‚ã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„Dockerfileã€‚ æˆ‘ä»¬å°†åŸºäºéå¸¸ç´§å‡‘çš„é«˜å±±å›¾åƒ </p><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> alpine:<span class="hljs-number"><span class="hljs-number">3.7</span></span></code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ”¶ç´§å¿…è¦çš„è½¯ä»¶åŒ…ï¼Œnginxçš„æ¥æºå’Œå¿…éœ€çš„æ¨¡å—spnego-http-auth-nginx-moduleã€‚ ç»“æœæ˜¯è¿™æ ·çš„å‘½ä»¤ </p><br><pre> <code class="hljs powershell">ENV NGINX_VERSION <span class="hljs-number"><span class="hljs-number">1.15</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RUN set <span class="hljs-literal"><span class="hljs-literal">-ex</span></span> \ &amp;&amp; apk add -<span class="hljs-literal"><span class="hljs-literal">-no</span></span><span class="hljs-literal"><span class="hljs-literal">-cache</span></span> \ git \ krb5 \ krb5<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> \ ca<span class="hljs-literal"><span class="hljs-literal">-certificates</span></span> \ libressl \ pcre \ zlib \ &amp;&amp; apk add -<span class="hljs-literal"><span class="hljs-literal">-no</span></span><span class="hljs-literal"><span class="hljs-literal">-cache</span></span> -<span class="hljs-literal"><span class="hljs-literal">-virtual</span></span> .build<span class="hljs-literal"><span class="hljs-literal">-deps</span></span> \ build<span class="hljs-literal"><span class="hljs-literal">-base</span></span> \ linux<span class="hljs-literal"><span class="hljs-literal">-headers</span></span> \ libressl<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> \ pcre<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> \ wget \ zlib<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> \ &amp;&amp; cd /tmp \ &amp;&amp; wget http://nginx.org/download/nginx-<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NGINX_VERSION}.tar.gz \ &amp;&amp; tar xzf nginx-<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NGINX_VERSION}.tar.gz \ &amp;&amp; git clone https://github.com/stnoonan/spnego<span class="hljs-literal"><span class="hljs-literal">-http</span></span><span class="hljs-literal"><span class="hljs-literal">-auth</span></span><span class="hljs-literal"><span class="hljs-literal">-nginx</span></span><span class="hljs-literal"><span class="hljs-literal">-module</span></span>.git nginx-<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NGINX_VERSION}/spnego<span class="hljs-literal"><span class="hljs-literal">-http</span></span><span class="hljs-literal"><span class="hljs-literal">-auth</span></span><span class="hljs-literal"><span class="hljs-literal">-nginx</span></span><span class="hljs-literal"><span class="hljs-literal">-module</span></span></code> </pre> <br><p> è¯¥å—æ˜¯å•ç‹¬åˆ†é…çš„ï¼Œå› æ­¤é‡ç»„æ—¶å¯ä»¥ä»é«˜é€Ÿç¼“å­˜ä¸­è·å–æ­¤å±‚ï¼Œå› ä¸ºå®ƒçš„æ—¶é—´æœ€é•¿ã€‚ </p><br><p> ä½¿ç”¨ä¸‹ä¸€ç»„å‘½ä»¤ï¼Œæˆ‘ä»¬å°†æ„å»ºnginxå¹¶å°†å…¶æ¸…ç†ï¼Œä»¥ä½¿å›¾åƒä¸ä¼šç™½ç™½è†¨èƒ€ã€‚ </p><br><pre> <code class="hljs powershell">RUN cd /tmp/nginx-<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NGINX_VERSION} \ &amp;&amp; ./configure \ \ -<span class="hljs-literal"><span class="hljs-literal">-prefix</span></span>=/etc/nginx \ -<span class="hljs-literal"><span class="hljs-literal">-sbin</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/usr/sbin/nginx \ -<span class="hljs-literal"><span class="hljs-literal">-conf</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/etc/nginx/nginx.conf \ -<span class="hljs-literal"><span class="hljs-literal">-error</span></span><span class="hljs-literal"><span class="hljs-literal">-log</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/var/log/nginx/error.log \ -<span class="hljs-literal"><span class="hljs-literal">-pid</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/var/run/nginx.pid \ -<span class="hljs-literal"><span class="hljs-literal">-lock</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/var/run/nginx.lock \ -<span class="hljs-literal"><span class="hljs-literal">-user</span></span>=nginx \ -<span class="hljs-literal"><span class="hljs-literal">-group</span></span>=nginx \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-threads</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-operator"><span class="hljs-operator">-file</span></span><span class="hljs-literal"><span class="hljs-literal">-aio</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_ssl_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_v2_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_realip_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_addition_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_sub_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_dav_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_flv_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_mp4_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_gunzip_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_gzip_static_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_auth_request_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_random_index_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_secure_link_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_slice_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-http_stub_status_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-http</span></span><span class="hljs-literal"><span class="hljs-literal">-log</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/var/log/nginx/access.log \ -<span class="hljs-literal"><span class="hljs-literal">-http</span></span><span class="hljs-literal"><span class="hljs-literal">-client</span></span><span class="hljs-literal"><span class="hljs-literal">-body</span></span><span class="hljs-literal"><span class="hljs-literal">-temp</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/var/cache/nginx/client_temp \ -<span class="hljs-literal"><span class="hljs-literal">-http</span></span><span class="hljs-literal"><span class="hljs-literal">-proxy</span></span><span class="hljs-literal"><span class="hljs-literal">-temp</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/var/cache/nginx/proxy_temp \ -<span class="hljs-literal"><span class="hljs-literal">-http</span></span><span class="hljs-literal"><span class="hljs-literal">-fastcgi</span></span><span class="hljs-literal"><span class="hljs-literal">-temp</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/var/cache/nginx/fastcgi_temp \ -<span class="hljs-literal"><span class="hljs-literal">-http</span></span><span class="hljs-literal"><span class="hljs-literal">-uwsgi</span></span><span class="hljs-literal"><span class="hljs-literal">-temp</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/var/cache/nginx/uwsgi_temp \ -<span class="hljs-literal"><span class="hljs-literal">-http</span></span><span class="hljs-literal"><span class="hljs-literal">-scgi</span></span><span class="hljs-literal"><span class="hljs-literal">-temp</span></span><span class="hljs-literal"><span class="hljs-literal">-path</span></span>=/var/cache/nginx/scgi_temp \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-mail</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-mail_ssl_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-stream</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-stream_ssl_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-stream_realip_module</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-add</span></span><span class="hljs-literal"><span class="hljs-literal">-module</span></span>=spnego<span class="hljs-literal"><span class="hljs-literal">-http</span></span><span class="hljs-literal"><span class="hljs-literal">-auth</span></span><span class="hljs-literal"><span class="hljs-literal">-nginx</span></span><span class="hljs-literal"><span class="hljs-literal">-module</span></span> \ &amp;&amp; make <span class="hljs-literal"><span class="hljs-literal">-j</span></span><span class="hljs-variable"><span class="hljs-variable">$</span></span>(getconf _NPROCESSORS_ONLN) \ &amp;&amp; make install \ &amp;&amp; sed <span class="hljs-literal"><span class="hljs-literal">-i</span></span> <span class="hljs-literal"><span class="hljs-literal">-e</span></span> <span class="hljs-string"><span class="hljs-string">'s/#access_log logs\/access.log main;/access_log \/dev\/stdout;/'</span></span> <span class="hljs-literal"><span class="hljs-literal">-e</span></span> <span class="hljs-string"><span class="hljs-string">'s/#error_log logs\/error.log notice;/error_log stderr notice;/'</span></span> /etc/nginx/nginx.conf \ &amp;&amp; adduser <span class="hljs-literal"><span class="hljs-literal">-D</span></span> nginx \ &amp;&amp; mkdir <span class="hljs-literal"><span class="hljs-literal">-p</span></span> /var/cache/nginx \ &amp;&amp; apk del .build<span class="hljs-literal"><span class="hljs-literal">-deps</span></span> \ &amp;&amp; rm <span class="hljs-literal"><span class="hljs-literal">-rf</span></span> /tmp/*</code> </pre> <br><p> ä¸ºäº†ä½¿æ‰€æœ‰è¿™äº›éƒ½æœ‰æ„ä¹‰ï¼Œè¯·æé«˜nginx </p><br><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">CMD</span></span> [<span class="hljs-string"><span class="hljs-string">"nginx"</span></span>, <span class="hljs-string"><span class="hljs-string">"-g"</span></span>, <span class="hljs-string"><span class="hljs-string">"daemon off;"</span></span>]</code> </pre> <br><p> æˆ‘ä»¬å¯ä»¥å‡è®¾æ˜ åƒå·²å‡†å¤‡å°±ç»ªï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹ç¡®ä¿æœåŠ¡å™¨å…·æœ‰æˆæƒç”¨æˆ·çš„èƒ½åŠ›ã€‚ </p><br><p> ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåŸŸç®¡ç†å‘˜ï¼Œæˆ‘å¯¹ä»–éå¸¸å¹¸è¿-è¿™ä¸ªå®¶ä¼™ååº”çµæ•ï¼Œå¾ˆå¿«å°±å›ç­”äº†ä»–çš„è¦æ±‚ã€‚ æ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚ <br> å‡è®¾ä¸»æœºä¸Šçš„ä¸»æœºåæ˜¯â€œ host-linuxâ€ï¼Œè€Œæ‚¨çš„åŸŸæ˜¯â€œ DOMAIN.LOCALâ€ã€‚ <br> åœ¨åŸŸä¸­ï¼Œæ‚¨éœ€è¦å¯åŠ¨åç§°ä¸ºâ€œ host-linuxâ€çš„è®¡ç®—æœºï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬å°†å…¶ç»‘å®šåˆ°çš„å¸æˆ·ï¼Œä¾‹å¦‚â€œ host-linux-userâ€ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªSPNå¹¶ç”Ÿæˆä¸€ä¸ªå¯†é’¥è¡¨æ–‡ä»¶ï¼Œè¿™åœ¨æèµ·å®¹å™¨æ—¶å°†éœ€è¦ã€‚ </p><br><p> æˆ‘ä»¬çš„å›¢é˜ŸåŸæ¥æ˜¯è¿™æ ·çš„ </p><br><pre> <code class="hljs pgsql">C:\Windows\system32&gt;ktpass -princ HTTP/HOST-LINUX.<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">DOMAIN</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> -mapuser host-linux-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">DOMAIN</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> -pass yourpassword -cryptoAll -ptype KRB5_NT_PRINCIPAL -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> C:\<span class="hljs-keyword"><span class="hljs-keyword">Temp</span></span>\web.keytab</code> </pre> <br><p> æ”¶åˆ°æ–‡ä»¶åï¼Œæˆ‘å¯ä»¥è¿›è¡Œå®éªŒã€‚ ç»“æœï¼Œæˆ‘å¾—åˆ°ä»¥ä¸‹nginx.conf </p><br><pre> <code class="hljs pgsql">http { #Whatever <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; server_name localhost; #Here kerberos stuff starts auth_gss <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>; auth_gss_realm <span class="hljs-keyword"><span class="hljs-keyword">DOMAIN</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span>; #Keytab file <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> the mounted folder auth_gss_keytab /home/spnego/config/web.keytab; auth_gss_service_name HTTP/HOST-LINUX.<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>; auth_gss_allow_basic_fallback <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>; #Here kerberos stuff ends <span class="hljs-keyword"><span class="hljs-keyword">location</span></span> / { root html; <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.htm; } #bla-bla-bla</code> </pre> <br><p> ç°åœ¨ï¼Œä¸€åˆ‡å¼€å§‹ï¼ŒæŠ¬èµ·å®¹å™¨æ—¶ï¼Œæ‚¨éœ€è¦å°†å½“å‰çš„nginx.confæ‹–æ”¾åˆ°è¯¥å®¹å™¨ä¸Šï¼Œå¹¶å°†å…¶è¾“å…¥åˆ°æ¥æ”¶åˆ°çš„web.keytabä¸­ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨docker-compose magic </p><br><pre> <code class="hljs powershell">version: <span class="hljs-string"><span class="hljs-string">"2"</span></span> services: nginx<span class="hljs-literal"><span class="hljs-literal">-spnego</span></span>: image: fclmman/alpine<span class="hljs-literal"><span class="hljs-literal">-nginx</span></span><span class="hljs-literal"><span class="hljs-literal">-spnego</span></span> <span class="hljs-comment"><span class="hljs-comment">#  .   ports: - 80:80 - 5010:5010 - 443:443 - 8001:8001 #   web.keytab,       volumes: - ./config:/home/spnego/config - ./config/nginx.conf:/etc/nginx/nginx.conf</span></span></code> </pre> <br><p> æˆ‘ä»¬è½¬åˆ°æ‹¥æœ‰docker-compose.ymlçš„ç›®å½•ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒåŒ…å«nginx.confå’Œweb.keytabæ–‡ä»¶çš„./configç›®å½•åº”è¯¥åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸­ã€‚ è¿è¡Œå‘½ä»¤ </p><br><pre> <code class="hljs powershell">docker<span class="hljs-literal"><span class="hljs-literal">-compose</span></span> <span class="hljs-operator"><span class="hljs-operator">-f</span></span> ./docker<span class="hljs-literal"><span class="hljs-literal">-compose</span></span>.yml up <span class="hljs-literal"><span class="hljs-literal">-d</span></span></code> </pre> <br><p> å®¹å™¨ä¸Šå‡äº†ï¼Œæ²¡æœ‰æ­»ã€‚ è¿™ç»™æˆåŠŸå¸¦æ¥å¸Œæœ›ã€‚ </p><br><p> è®©æˆ‘ä»¬åœ¨åŸŸWindowsè®¡ç®—æœºä¸Šæ‰“å¼€æµè§ˆå™¨ã€‚ </p><br><p> åœ¨ä¸€ä¸ªæ ‡ç­¾ä¸­ï¼Œæ‰“å¼€chromeï¼š// net-internals /å¹¶å†™ä¸‹æˆ‘ä»¬çš„è¯·æ±‚ã€‚ åœ¨å¦ä¸€ä¸ªé€‰é¡¹å¡ä¸­ï¼Œæ‰“å¼€<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">httpï¼š// // host-linuxï¼š80 /</a> ã€‚ è®©æˆ‘ä»¬å›åˆ°chromeï¼š// net-internals /å¹¶æŸ¥çœ‹ç»“æœã€‚ </p><br><pre> <code class="hljs vbscript">#    negotiate t= <span class="hljs-number"><span class="hljs-number">3</span></span> [st= <span class="hljs-number"><span class="hljs-number">3</span></span>] HTTP_TRANSACTION_READ_RESPONSE_HEADERS --&gt; HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">401</span></span> Unauthorized <span class="hljs-built_in"><span class="hljs-built_in">Server</span></span>: nginx/<span class="hljs-number"><span class="hljs-number">1.15</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>: Fri, <span class="hljs-number"><span class="hljs-number">10</span></span> Aug <span class="hljs-number"><span class="hljs-number">2018</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span> GMT Content-Type: text/html Content-Length: <span class="hljs-number"><span class="hljs-number">597</span></span> Connection: keep-alive WWW-Authenticate: Negotiate t= <span class="hljs-number"><span class="hljs-number">4</span></span> [st= <span class="hljs-number"><span class="hljs-number">4</span></span>] HTTP_TRANSACTION_SEND_REQUEST_HEADERS --&gt; <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> / HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: host-linux Connection: keep-alive Pragma: no-cache Cache-Control: no-cache Authorization: Negotiate #    Upgrade-Insecure-Requests: <span class="hljs-number"><span class="hljs-number">1</span></span> User-Agent: Mozilla/<span class="hljs-number"><span class="hljs-number">5.0</span></span> (Windows NT <span class="hljs-number"><span class="hljs-number">6.3</span></span>; Win64; x64) AppleWebKit/<span class="hljs-number"><span class="hljs-number">537.36</span></span> (KHTML, like Gecko) Chrome/<span class="hljs-number"><span class="hljs-number">67.0</span></span><span class="hljs-number"><span class="hljs-number">.3396</span></span><span class="hljs-number"><span class="hljs-number">.99</span></span> Safari/<span class="hljs-number"><span class="hljs-number">537.36</span></span> Accept: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number"><span class="hljs-number">0.9</span></span>,image/webp,image/apng,*/*;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span> Accept-Encoding: gzip, deflate Accept-Language: ru-RU,ru;q=<span class="hljs-number"><span class="hljs-number">0.9</span></span>,en-US;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,en;q=<span class="hljs-number"><span class="hljs-number">0.7</span></span> t= <span class="hljs-number"><span class="hljs-number">4</span></span> [st= <span class="hljs-number"><span class="hljs-number">4</span></span>] -HTTP_TRANSACTION_SEND_REQUEST t= <span class="hljs-number"><span class="hljs-number">4</span></span> [st= <span class="hljs-number"><span class="hljs-number">4</span></span>] +HTTP_TRANSACTION_READ_HEADERS [dt=<span class="hljs-number"><span class="hljs-number">47</span></span>] t= <span class="hljs-number"><span class="hljs-number">4</span></span> [st= <span class="hljs-number"><span class="hljs-number">4</span></span>] HTTP_STREAM_PARSER_READ_HEADERS [dt=<span class="hljs-number"><span class="hljs-number">47</span></span>] t=<span class="hljs-number"><span class="hljs-number">51</span></span> [st=<span class="hljs-number"><span class="hljs-number">51</span></span>] HTTP_TRANSACTION_READ_RESPONSE_HEADERS --&gt; HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK <span class="hljs-built_in"><span class="hljs-built_in">Server</span></span>: nginx/<span class="hljs-number"><span class="hljs-number">1.15</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>: Fri, <span class="hljs-number"><span class="hljs-number">10</span></span> Aug <span class="hljs-number"><span class="hljs-number">2018</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span> GMT Content-Type: text/html Content-Length: <span class="hljs-number"><span class="hljs-number">612</span></span> Last-Modified: Fri, <span class="hljs-number"><span class="hljs-number">10</span></span> Aug <span class="hljs-number"><span class="hljs-number">2018</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span> GMT Connection: keep-alive WWW-Authenticate: Negotiate #   ETag: <span class="hljs-string"><span class="hljs-string">"5b6d8350-264"</span></span> Accept-Ranges: bytes</code> </pre> <br><p> ç»“æœï¼Œæˆ‘ä»¬çœ‹åˆ°è¯¥æ“ä½œæˆåŠŸï¼Œå¹¶ä¸”çœ‹åˆ°äº†nginxæ¬¢è¿å±å¹•ã€‚ <br> æœ‰å¿…è¦æ¾„æ¸…ä¸€ä¸‹ï¼Œæ‰€æœ‰å†…å®¹éƒ½åªèƒ½æŒ‰ä¸»æœºåè¿è¡Œï¼Œä½†æ®æˆ‘æ‰€çŸ¥ï¼Œå› ä¸ºæˆ‘ä»¬å°†kerberosç»‘å®šåˆ°äº†ä¸»æœºåã€‚ </p><br><p> æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼Œå¦‚æœæ‚¨å¯¹è¿™ä¸ªåœ°æ–¹æœ‰æ‰€äº†è§£ï¼Œæˆ‘çœŸçš„å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN419975/">https://habr.com/ru/post/zh-CN419975/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN419963/index.html">æˆ‘ä»¬åœ¨ESP8266ä¸Šä¸ºç©ºè°ƒåˆ¶ä½œäº†ä¸€ä¸ªâ€œæ™ºèƒ½â€æ§åˆ¶å™¨</a></li>
<li><a href="../zh-CN419965/index.html">ExtremeXOSäº¤æ¢æœºé…ç½®åŠŸèƒ½</a></li>
<li><a href="../zh-CN419969/index.html">éšè—åœ¨Rubyä¸­ã€‚ åŒæ—¶ä»é¡¶çº§éšè—ç±»</a></li>
<li><a href="../zh-CN419971/index.html">ç«ç®­å®éªŒå®¤ä¿®è¡¥ï¼Œæ‰©å±•å’ŒåŠ é€Ÿ</a></li>
<li><a href="../zh-CN419973/index.html">8æœˆ13æ—¥è‡³19æ—¥åœ¨è«æ–¯ç§‘ä¸¾è¡Œçš„æ•°å­—æ´»åŠ¨</a></li>
<li><a href="../zh-CN419977/index.html">ç ”ç©¶äººå‘˜ï¼šå¹¶éæ‰€æœ‰çš„2çº§è‡ªåŠ¨é©¾é©¶ä»ªéƒ½èƒ½åŒæ ·å‡ºè‰²åœ°å·¥ä½œï¼Œä½†è¿›æ­¥æ˜¾è€Œæ˜“è§</a></li>
<li><a href="../zh-CN419979/index.html">Pythonå¦‚ä½•å¸®åŠ©å–ä»£è´¢åŠ¡é¡¾é—®</a></li>
<li><a href="../zh-CN419981/index.html">å¤œç”Ÿæ´»çš„å¤©ç©ºæˆ–å¯»æ‰¾è‹±ä»™åº§</a></li>
<li><a href="../zh-CN419983/index.html">ä¸Šå‘¨ç¬¬326æœŸï¼ˆ2018å¹´8æœˆ6æ—¥è‡³12æ—¥ï¼‰çš„å‰ç«¯ä¸–ç•Œæ‘˜è¦</a></li>
<li><a href="../zh-CN419985/index.html">Klatsï¼Œklatsï¼šCherryçš„æ•…äº‹ï¼Œä»¥é”®ç›˜å¼€å…³è€Œé—»å</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>