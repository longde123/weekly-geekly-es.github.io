<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∫ ‚õ∑Ô∏è üî∑ Une autre montre intelligente de vos propres mains ü•à üêπ üëºüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inspir√© il y a quelque temps par l'article "Montres intelligentes de vos propres mains pour 1500r." , J'ai √©galement d√©cid√© d'essayer de fabriquer un ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une autre montre intelligente de vos propres mains</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/404737/"><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/web/603/ba0/2c4/603ba02c4cbf47ae94b451b9dedfdc7d.png"></a> </p><br><p>  Inspir√© il y a quelque temps par l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Montres intelligentes de vos propres mains pour 1500r."</a>  , J'ai √©galement d√©cid√© d'essayer de fabriquer un appareil similaire. </p><br><p>  Cet article n'est pas positionn√© comme un guide d'action ou d'instruction, mais plut√¥t comme une indication des points cl√©s que j'ai rencontr√©s.  Peut-√™tre que pour quelqu'un, il servira de source d'inspiration et d'informations utiles. </p><br><p>  S√©lection des composants, disposition des circuits imprim√©s, soudure dans des conditions difficiles, bo√Ætier imprim√© en 3D et JavaScript sur la montre - sous la coupe.  Bienvenue! </p><a name="habracut"></a><br><h2 id="trebovaniya">  Pr√©requis </h2><br><ul><li>  Vous devez conna√Ætre l'heure sans avoir √† entrer dans votre poche derri√®re votre t√©l√©phone </li><li>  Il devrait y avoir une r√©ception des notifications d'appels entrants, des SMS et des notifications des messageries instantan√©es </li><li>  La dur√©e de vie de la batterie doit √™tre d'au moins une semaine </li><li>  Soyez aussi compact que possible </li></ul><br><p>  D√©j√† sur la base de cette petite liste d'exigences, vous pouvez commencer √† s√©lectionner les composants et clarifier les caract√©ristiques techniques de la mise en ≈ìuvre.  Le budget du projet pour le temps et les finances n‚Äô√©tait pas particuli√®rement limit√©, la production de masse n‚Äô√©tait pas pr√©vue, vous pouviez donc vous permettre de faire une promenade et ne pas vraiment vous soucier d‚Äô√©conomiser chaque centime. </p><br><p>  En plus du plan g√©n√©ral, il y avait aussi des plans purement techniques: </p><br><ul><li>  Cr√©ation et ex√©cution d'applications personnalis√©es sur l'horloge.  Comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pebble</a> .  En g√©n√©ral, ci-apr√®s, l'horloge ressemblera de plus en plus √† un clone de Pebble, mais pourquoi pas </li><li>  M√©moire pour les applications et leurs donn√©es </li><li>  Contr√¥le ad√©quat du niveau de charge afin que la montre ne s'√©teigne pas soudainement lorsque la batterie est d√©charg√©e, mais affiche des ¬´b√¢tons¬ª et avertit √† l'avance </li><li>  Acc√©l√©rom√®tre, gyroscope et magn√©tom√®tre pour un suivi complet des mouvements de l'utilisateur.  Pour pouvoir faire un podom√®tre ou un r√©veil intelligent qui surveille les phases de sommeil par la pr√©sence de mouvement </li></ul><br><p>  Tout cela s'est finalement cristallis√© dans un petit diagramme: </p><br><p><img src="https://habrastorage.org/web/6b6/b29/8b4/6b6b298b4ae848cf84df6ab2bb900ee1.png"><br>  <em>Le microcontr√¥leur combine BLE 4.x pour la communication avec un smartphone, les bus I¬≤C et SPI pour les capteurs et un √©cran avec m√©moire, contr√¥le les vibrations et r√©pond aux pressions sur les boutons, tout est aliment√© par une batterie Li-Po.</em> </p><br><p>  Vous pouvez maintenant commencer le processus de s√©lection des puces et des pi√®ces.  En termes de travail et de temps pass√©, c'√©tait le processus le plus difficile et le plus long, il fallait comparer beaucoup de choses, chercher et plonger t√™te baiss√©e l√† o√π je n'avais pas nag√© auparavant. </p><br><h2 id="vybor-komponentov">  S√©lection des composants </h2><br><h3 id="mikrokontroller">  Microcontr√¥leur </h3><br><p>  La premi√®re √©tape consiste √† choisir un contr√¥leur qui sera le "cerveau" de l'appareil et tout le reste sur la carte lui servira pour le bien. </p><br><p>  Pour rendre l'appareil plus compact, il est n√©cessaire d'utiliser le moins de composants et de modules possible.  Ici, divers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syst√®mes sur puce</a> viennent √† la rescousse, qui combinent les fonctionnalit√©s d'un module Bluetooth et d'un microcontr√¥leur. </p><br><div class="spoiler">  <b class="spoiler_title">Que nous offre le march√©?</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/979/a27/5f2/979a275f28bf4e8fade3f573c1677038.png" alt="image"><br>  <em>Source: www.argenox.com</em> </p><br><ul><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cypress PSoC BLE</a></strong> core ARM Cortex-M0, BLE 4.2, 256kB FLASH, 32kB RAM, un tas de p√©riph√©riques et un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">balun</a> int√©gr√©, une large gamme de tension d'alimentation: 1,9-5 volts </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Texas Insturments CC2541</a></strong> - BLE 4.0 et 8051-core, 256kB FLASH, 8kB RAM </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Texas Instruments CC2640</a></strong> - BLE 4.1, Cortex-M3, FLASH 128 Ko, RAM 20 Ko </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dialog DA-14580</a></strong> - Cortex-M0, BLE 4.1, 16 MHz, 42 + 8 Ko de RAM, 32 Ko OTP (m√©moire programmable unique, mais il est possible d'ex√©cuter du code √† partir d'un SPI FLASH externe), la puce la plus petite et la moins consommatrice de ce qui pr√©c√®de </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SiLabs EFR32</a></strong> - Cortex-M4F, 40 MHz, BLE 4.x, Bluetooth 5, jusqu'√† 1 Mo de FLASH, jusqu'√† 256 Ko de RAM </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nordic nRF52832</a></strong> - Cortex-M4F, 64MHz, BLE 4.x, Bluetooth 5, 512kB FLASH, 64kB RAM, √©mulation d'√©tiquette NFC, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ballon</a> int√©gr√© </li></ul></div></div><br><p>  Dans le tas de d√©cisions savoureuses et peu <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">engageantes</a></strong> , le choix s'est <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">port√©</a></strong> sur le <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nRF52832</a></strong> , cette puce s'est av√©r√©e √™tre la plus productive et la plus pratique en termes de bo√Ætier (QFN 6x6mm 48 broches).  Une option chic qui simplifie consid√©rablement le c√¢blage de la carte est √©galement la possibilit√© d'affecter par programme n'importe quel p√©riph√©rique √† l'une des broches GPIO.  C'est quelque chose qui manque √† de nombreux microcontr√¥leurs.  Gr√¢ce √† la prise en charge NFC, vous pouvez ajouter la fonctionnalit√© d'un √©mulateur NFC √† la montre et coudre toutes vos cartes de passe dans la montre. </p><br><p><img src="https://habrastorage.org/web/e58/636/0f5/e586360f52d647bc83189ba795011014.jpg"></p><br><p>  La fiche technique indique qu'il y a un RTC (horloge en temps r√©el) int√©gr√©, c'est pratique.  Mais plus tard, il s'est av√©r√© que ce n'est pas une horloge, mais un <em>compteur en</em> temps r√©el, c'est-√†-dire  Il s'agit de la minuterie la plus courante, fonctionnant √† partir de quartz √† 32 768 kHz, y compris en mode veille.  Par cons√©quent, dans la prochaine r√©vision de l'appareil, j'utiliserai une puce distincte pour RTC, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STMicroelectronics M41T62LC6F</a> .  Il a un quartz int√©gr√© √† 32,768 kHz et fonctionne sur l'interface I¬≤C. </p><br><p>  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">carte de</a> d√©bogage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nRF52-DK</a> co√ªte assez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bon march√©</a> , environ 4 mille.  roubles.  Sur Aliexpress peut √™tre trouv√© pour ~ 3tys. </p><br><div class="spoiler">  <b class="spoiler_title">Au fait</b> <div class="spoiler_text"><p>  √âtant donn√© que l'appareil n'implique pas de production de masse ni de vente sur le march√©, dessiner votre propre planche et construire votre solution sur BLE SoC est une t√¢che plut√¥t fascinante sans cons√©quences graves.  Pour ceux qui souhaitent entrer rapidement sur le march√©, il est recommand√© d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des modules pr√©-certifi√©s pr√™ts</a> √† l'emploi. </p><br><p>  Il y a plusieurs raisons √† cela et elles sont associ√©es √† la radio: pour tout nouvel appareil √©lectronique sur le march√©, il est n√©cessaire d'obtenir l'autorisation et de passer la certification de r√©gulateurs tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CE</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FCC</a> . <br><img src="https://habrastorage.org/web/024/c98/5d7/024c985d746a4223b8dba41f7ec4d1f5.jpg" alt="Logos des r√©gulateurs, souvent trouv√©s sur le bo√Ætier de l'appareil"></p><br><p>  Les joies qui l'accompagnent incluent une disposition sp√©ciale de la carte, prenant en compte les caract√©ristiques de propagation des signaux avec une fr√©quence de 2,4 GHz, le blindage, les mesures dans une chambre an√©cho√Øque, l'adaptation d'imp√©dance et d'autres magies micro-ondes.  Dans les modules finis, tout ce travail a d√©j√† √©t√© fait par leurs d√©veloppeurs, l'utilisateur a juste besoin d'int√©grer le module dans sa solution et il n'y a rien √† certifier. </p></div></div><br><h3 id="kvarcevye-rezonatory">  R√©sonateurs √† quartz </h3><br><p>  Les r√©sonateurs √† quartz sont connect√©s √† la puce nRF52832 s√©lectionn√©e: </p><br><ol><li>  √Ä 32 MHz pour cadencer le c≈ìur et la radio, requis </li><li>  √Ä 32,768 kHz pour synchroniser le minuteur et les intervalles de temps BLE en mode veille.  En option, mais sa connexion r√©duit la consommation d'√©nergie (les intervalles de temps peuvent √™tre raccourcis) et augmente la pr√©cision de l'horloge RTC. </li></ol><br><p>  Les deux types de quartz sont command√©s dans un bo√Ætier de montage en surface avec Aliexpress: </p><br><div class="spoiler">  <b class="spoiler_title">Image</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/46f/ab8/e9c/46fab8e9c84641629e77bb14ddf5c620.png"></p></div></div><br><h3 id="displey">  Affichage </h3><br><p>  Pour que l'horloge tourne sans se recharger pendant au moins une semaine, il est n√©cessaire de r√©soudre le probl√®me que la matrice d'affichage consomme beaucoup de courant en mode de fonctionnement.  Si je comprends bien, les fabricants de montres r√©solvent ce probl√®me de deux mani√®res: </p><br><ol><li>  Allumez l'√©cran et affichez le contenu uniquement lorsqu'un mouvement de la main se produit et que l'√©cran de la montre tombe dans le champ de vision de l'utilisateur, ou lorsque l'attention de l'utilisateur a d√©j√† √©t√© attir√©e, par exemple par une notification ou un r√©veil </li><li>  Affichez le contenu en permanence, en utilisant des √©crans qui ne consomment pratiquement pas de courant pour afficher l'image et ne le consommez que pour mettre √† jour le contenu.  Vous n'avez pas besoin d'aller loin pour des exemples: il s'agit de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">e-ink</a> , du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Memory LCD</a> ou de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IMOD / mirasol</a> </li></ol><br><div class="spoiler">  <b class="spoiler_title">Que nous offre le march√©?</b> <div class="spoiler_text"><p>  Pour l'option lorsque l'affichage est la plupart du temps l'≈ìuvre de Malevitch, il existe de telles options sur le march√©: OLED, TFT, Amoled, modules t√©l√©phoniques LCD (Nokia, Siemens, etc.).  Reste √† trouver un affichage avec une diagonale adapt√©e. </p><br><p>  Exemples: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les petits √©crans OLED</a> , comme sur Ali Express, co√ªtent un sou. <br>  Un tas d'inconv√©nients: petite diagonale, monochrome, consommation 10-20mA, module encombrant.  Sans carte de module - une large boucle et une mer de cerclage, qui absorbera une partie importante de la zone sur la carte. </li><li>  LCD TFT, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ILI9341</a> .  Des inconv√©nients: consommation, boucle large </li></ul><br><p>  Les √©crans de l'E-Ink ont ‚Äã‚Äãdisparu imm√©diatement, car la vitesse de mise √† jour de l'√©cran est trop lente, le monochrome et, tr√®s probablement, il est difficile de trouver un √©cran E-Ink assez petit sur le march√© libre. </p><br><p>  Si vous regardez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pebble</a> , vous pouvez voir qu'il utilise l'affichage ¬´Always on¬ª.  Pebble Classic utilise un √©cran <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LCD</a> monochrome <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SHARP Memory</a> , Pebble Time utilise un √©cran couleur (64 couleurs) utilisant une technologie similaire, mais produit par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JDI</a> , il n'est pas en vente. </p><br><p>  En ce qui concerne IMOD / Mirasol, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qualcomm</a> n'a pu trouver que des brochures marketing et des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">montres Toq de Qualcomm</a> . </p></div></div><br><p>  Je voulais prendre un √©cran couleur comme le Pebble Time.  L'analogue le plus proche, qui est en vente libre, √©tait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SHARP LS013B7DH06</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sa fiche technique</a> ). </p><br><p><img src="https://habrastorage.org/web/843/c78/b5e/843c78b5e870402cbba399bdede1fb0e.JPG"></p><br><p>  CARACT√âRISTIQUES </p><br><ul><li>  Diagonale 1,33 " </li><li>  R√©solution: 128x128, 8 couleurs (3 bits par pixel) </li><li>  Dimensions: 26,82 x 31,3 mm </li><li>  Interface: SPI </li><li>  Tension d'alimentation: 5 V, mais niveaux logiques SPI √† partir de 2,7 V </li></ul><br><p>  L'embuscade s'est av√©r√©e avec la tension d'alimentation, car la batterie Li-Po n'obtient pas la tension 5V requise sans convertisseurs suppl√©mentaires.  Mais le courant √† l'√©cran est faible et obtenir le 5 V dont vous avez besoin est assez simple avec une pompe de charge comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Linear LTC1754-5</a> : </p><br><p><img src="https://habrastorage.org/web/4fa/599/9d6/4fa5999d699540c1b25fdcf02d5ccc36.jpg"><br>  Une autre caract√©ristique √©tait la n√©cessit√© de changer l'√©tat de la broche EXTCOMIN (inversion COM externe) au moins une fois par seconde d'un niveau √©lev√© √† un niveau bas et vice versa, afin que la charge ne s'accumule pas sur le panneau de l'√©cran et que l'image ne se fige pas √† un moment donn√©.  √Ä ces fins, vous pouvez utiliser le PWM (PWM) int√©gr√© du microcontr√¥leur, r√©gl√© sur un rapport cyclique de 50% (onde carr√©e) et une fr√©quence de 1 Hz ou plus, ou tout autre g√©n√©rateur d'ondes carr√©es (y compris externe). </p><br><p>  L'√©cran est connect√© √† la carte √† l'aide d'un petit c√¢ble, il est tr√®s pratique d'utiliser un connecteur FPC √† 10 broches par incr√©ments de 0,5 mm, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Hirose FH12-10S-0.5SH</a> : </p><br><p><img src="https://habrastorage.org/web/cd6/c7e/1d8/cd6c7e1d8d6e41e9af61a05b705f9ea0.jpg"><br>  Le module d'affichage n'a pas son propre r√©tro-√©clairage et ne brille pas √† travers les LED comme un √©cran LCD ordinaire, donc pour l'instant nous n'avons pas le temps de regarder l'horloge sans r√©tro-√©clairage.  <em>Si quelqu'un conna√Æt le processus de cr√©ation d'un module de r√©tro√©clairage pour ce type d'√©crans, veuillez r√©pondre.</em> </p><br><h3 id="akkumulyator">  La batterie </h3><br><p>  J'ai d√ª passer du temps √† choisir la bonne taille de batterie dans la gamme standard de tailles.  Je cherchais une batterie lithium-polym√®re d'une tension de 3,7V et d'une capacit√© d'environ 100mAh. </p><br><p>  La batterie √©tait pr√©vue pour √™tre plac√©e sous la carte, connaissant la taille de la carte, vous pouvez facilement ramasser une batterie qui s'adaptera et ne d√©passera rien. </p><br><div class="spoiler">  <b class="spoiler_title">Qu'offre le march√©?</b> <div class="spoiler_text"><p>  Sur Aliexpress, vous pouvez commander tout un tas de batteries pour presque toutes les tailles, l'essentiel est de conna√Ætre le syst√®me de codage de leurs noms.  Et c'est comme ceci: HHWWLL, o√π HH est l'√©paisseur (hauteur) de la batterie en dixi√®mes de millim√®tre, WW est sa largeur et LL est sa longueur en millim√®tres. </p><br><p>  Exemple: 402025 - batterie d'une √©paisseur de 4 mm et d'une taille de 20x25 mm <br><img src="https://habrastorage.org/web/a8b/a4e/129/a8ba4e1299df4be69ab9048680ae8da4.png"></p></div></div><br><p>  <strong>302025</strong> batteries (3x20x25mm) d'une capacit√© de 110mAh ont √©t√© s√©lectionn√©es et command√©es sur Aliexpress. </p><br><p><img src="https://habrastorage.org/web/b54/87c/266/b5487c2667514d8ea864e303af4fcc54.png"></p><br><h3 id="pitanie">  La nutrition </h3><br><p>  √âtant donn√© que les batteries au lithium-polym√®re ont un sens de ne d√©charger que jusqu'√† 3 volts, il a √©t√© d√©cid√© d'alimenter l'ensemble du circuit √† partir de 3V stabilis√© et si la tension sur la batterie tombait en dessous de 3V, puis de couper le r√©gulateur de puissance principal pour la puce de protection ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Maxim MAX809TEUR + T</a> ). </p><br><p>  La tension d'alimentation totale de 3 V s'int√®gre dans les plages de puissance de tous les √©l√©ments du circuit, √† l'exception de l'√©cran, qui a besoin de 5 V.  Par cons√©quent, l'affichage est aliment√© via le convertisseur boost <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lin√©aire LTC1754-5</a> directement √† partir de la batterie. </p><br><p>  Si vous regardez la courbe de d√©charge de ce type de batterie, <br><img src="https://habrastorage.org/web/6f9/d21/e2c/6f9d21e2cd6b475b913667c1f667fe32.gif"></p><br><p>  on peut voir que toute la capacit√© de la batterie tombe sur la plage de tension de ~ 4V √† 3V, donc un convertisseur abaisseur 3V conventionnel sera suffisant pour fournir au syst√®me une tension stable et en m√™me temps aspirer efficacement toute l'√©nergie de la batterie sans rien laisser, mais sans la d√©charger excessivement . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Texas Instruments TPS78230DRVT a</a> √©t√© choisi comme convertisseur abaisseur, il a un petit courant de fonctionnement de 500nA et un courant maximum de 150mA, ce qui est tout √† fait suffisant.  Le bo√Ætier SON-6 est compact et tout √† fait payant: </p><br><p><img src="https://habrastorage.org/web/f31/c89/056/f31c89056e624439af40162263e57c18.jpg"></p><br><h3 id="zaryadka-akkumulyatora">  Charge de la batterie </h3><br><p>  Il a √©t√© d√©cid√© de charger la batterie via un port microUSB standard ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Molex 47346-0001</a> ), mais il ne suffit pas de connecter la batterie directement au bus USB 5V et de la charger comme √ßa, il est n√©cessaire d'assurer le bon processus de charge, divis√© en plusieurs phases: pr√©conditionnement, courant constant, constant tension. </p><br><div class="spoiler">  <b class="spoiler_title">Profil de charge typique pour une batterie de 180 mAh</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/f70/022/db6/f70022db6ac747c089c50bfa34320854.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Bonne explication du processus de facturation sur EEVBlog</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/A6mKd5_-abk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><p>  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">puce Microchip MCP73831</a> est une solution populaire pour charger des batteries de petite capacit√© (jusqu'√† 500mAh).  Le courant de charge (en fonction de la capacit√© de la batterie) est programm√© par une r√©sistance, il y a une sortie √† trois √©tats ou √† drain ouvert pour vous informer du d√©but et de la fin du processus de charge. </p><br><p>  J'ai √©galement choisi une autre puce - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Maxim MAX1555EZK-T</a> .  Il a un courant de charge fixe de 100mAh et a le m√™me bo√Ætier que la puce √† puce, et en m√™me temps n√©cessite un minimum de composants externes et a une sortie √† drain ouvert pour informer sur le processus de charge: </p><br><p><img src="https://habrastorage.org/web/b33/64a/b80/b3364ab804ef4332abb7c68fdd9452d8.jpg"></p><br><div class="spoiler">  <b class="spoiler_title">Image de fiche technique</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/092/c7b/994/092c7b994d134222a43096e9eaa4fa22.png"></p></div></div><br><p>  Dans la prochaine r√©vision de la carte, je passerai toujours √† la puce √† puce, car le courant de charge de 100mA pour une batterie de 110mAh est probablement un peu trop. </p><br><h3 id="kontroller-yomkosti-akkumulyatora">  Contr√¥leur de capacit√© de batterie </h3><br><p>  Il existe plusieurs techniques pour surveiller le degr√© de charge de la batterie qui sont quelque peu diff√©rentes dans l'ex√©cution et la pr√©cision du r√©sultat final (dans les sources anglaises, cela s'appelle State of Charge): </p><br><div class="spoiler">  <b class="spoiler_title">Liste</b> <div class="spoiler_text"><ol><li><p>  Mesurer le soi-disant  tension en circuit ouvert / OCV (tension sur les plaques) de la batterie via l'ADC et tirer une conclusion sur la capacit√© de la batterie.  Le plus souvent, il est n√©cessaire de transf√©rer la plage de tension dans une zone acceptable pour le fonctionnement de l'ADC √† l'aide d'un diviseur de tension.  Les inconv√©nients de cette approche sont que le graphique de la tension en fonction de la capacit√© des batteries au lithium-polym√®re est assez plat, et les lectures elles-m√™mes changent avec chaque cycle et sont sujettes au bruit et √† l'incapacit√© de mesurer la tension r√©elle sur les plaques en raison de l'influence du courant de charge </p><br></li><li><p>  Une autre fa√ßon consiste √† mesurer le courant qui entre et sort de la batterie au lieu de mesurer la tension aux bornes des plaques.  C'est le d√©nomm√© comptage de Coulomb.  Une solution typique consiste √† int√©grer la valeur de la chute de tension √† travers une petite r√©sistance de shunt de r√©sistance (environ 100 mOhm).  Connaissant la capacit√© de la batterie, par le courant qui en a coul√© pendant un certain temps, nous pouvons conclure combien il reste d'√©nergie dans la batterie (en n√©gligeant l'autod√©charge).  Les inconv√©nients de cette approche sont que l'autod√©charge n'est pas prise en compte, ainsi que le fait que la capacit√© r√©elle de la batterie change √† chaque cycle de charge-d√©charge.  En gros, moins de courant s'√©coule de la batterie que celui-ci lors de la charge.  Pour cette raison, au fil du temps, une erreur dans les lectures s'accumulera in√©vitablement </p><br></li><li>  La combinaison des premi√®re et deuxi√®me m√©thodes: mesure et tension sur les plaques et courant circulant.  Une combinaison comp√©tente des deux approches aidera √† construire un mod√®le qui √©valuera la capacit√© de la batterie avec une bonne pr√©cision.  Pour que cette approche fonctionne, il est n√©cessaire de produire au moins un cycle charge-d√©charge pour collecter des donn√©es sur la d√©pendance de la tension aux bornes des plaques de la capacit√©.  De plus, chaque cycle suivant devra apporter des modifications au mod√®le de batterie afin que l'erreur ne s'accumule pas.  Il y a des articles dans lesquels les gens racontent comment, en utilisant le filtre de Kalman, les donn√©es de diff√©rentes mesures ont √©t√© combin√©es pour pr√©dire la charge restante ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[1]</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[2]</a> ) </li></ol></div></div><br><div class="spoiler">  <b class="spoiler_title">Que nous offre le march√©?</b> <div class="spoiler_text"><ul><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Maxim MAX17043</a></strong> - en utilisant un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">algorithme propri√©taire</a> pour la tension sur les plaques, construit un mod√®le de batterie √† l'int√©rieur de lui-m√™me.  Promet la pr√©cision de mesure de la charge restante de 3%.  Interface I¬≤C.  Joli et petit corps </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OnSemi LC709203F</a></strong> - mesure l'OCV, l'interface I¬≤C, une pr√©cision de 2,8%, il y a une compensation de temp√©rature via une thermistance externe.  Cher et mauvais en Russie </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Texas Instruments BQ27621</a></strong> - mesure la tension sur les plaques, I¬≤C, pr√©cision non sp√©cifi√©e, cher, bo√Ætier BGA </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Texas Instruments BQ27421</a></strong> - mesure simultan√©ment la tension et le courant circulant.  Interface I¬≤C, pr√©cision non sp√©cifi√©e, cher, bo√Ætier BGA </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LTC2941 lin√©aire</a></strong> - mesure le courant circulant, interface I¬≤C, pr√©cision 1%, n√©cessite en outre une r√©sistance de shunt externe (elle est int√©gr√©e au LTC2941-1), bo√Ætier: 2x3mm DFN-6 </li></ul></div></div><br><p>  Parmi les options disponibles, la puce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LTC2941 lin√©aire a</a> √©t√© choisie pour le bo√Ætier le plus petit, mais payant, et un algorithme de travail clair.  Command√© sur Aliexpress. </p><br><div class="spoiler">  <b class="spoiler_title">Image de fiche technique</b> <div class="spoiler_text"><p><img src="http://cds.linear.com/image/8650.png" alt="image"><br>  <em>Source: Technologie lin√©aire</em> </p></div></div><br><p>  Le microcircuit utilise la technique du compteur coulomb et compte le courant circulant avec une pr√©cision de 1%, fonctionne via l'interface I¬≤C (SMBus) et dispose d'un bo√Ætier petit mais pratique: 2x3mm DFN-6: <br><img src="https://habrastorage.org/web/348/3e8/90b/3483e890b3e34789ad68abaa6cf19c0a.jpg"></p><br><p>  Gr√¢ce √† I¬≤C √† l'int√©rieur du microcircuit, vous pouvez d√©finir la valeur de l'homologue du compteur actuel, ainsi que d√©finir ou lire la valeur du compteur lui-m√™me.  Le compteur est de 16 bits et augmente lorsque le courant circule dans la batterie et diminue lorsque le courant s'√©coule de la batterie.  La valeur maximale du compteur (0xFFFF) peut √™tre consid√©r√©e comme une batterie compl√®tement charg√©e, et la valeur minimale (0x0000) comme une batterie compl√®tement d√©charg√©e.  Avec un pr√©s√©lecteur de compteur bien choisi, il est possible d'obtenir que le compteur atteigne son maximum pendant la charge et atteigne z√©ro lorsque la batterie est compl√®tement d√©charg√©e.  Il est possible de d√©finir la limite de la valeur du compteur, en dessous de laquelle le microcircuit d√©clenchera une alarme et d√©clenchera une interruption. </p><br><h3 id="akselerometr">  Acc√©l√©rom√®tre </h3><br><p>  Parmi le tas d'options sur le march√©, une puce assez populaire a √©t√© choisie: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">InvenSense MPU-9250</a> .  Il s'agit d'un syst√®me dans un bo√Ætier (SiP), combinant un acc√©l√©rom√®tre MEMS, un gyroscope MEMS et une puce de magn√©tom√®tre. </p><br><p><img src="https://habrastorage.org/web/1d8/c0d/685/1d8c0d6854a7433e9d6ccb6e2ffebf08.png"></p><br><div class="spoiler">  <b class="spoiler_title">CARACT√âRISTIQUES</b> <div class="spoiler_text"><ul><li>  Tension d'alimentation de 2,4 V √† 3,6 V </li><li>  Acc√©l√©rom√®tre MEMS √† trois axes 16 bits avec des plages de mesure de ¬± 2g, ¬± 4g, ¬± 8g, ¬± 16g </li><li>  Gyroscope MEMS 16 bits √† trois axes jusqu'√† 2000 ¬∞ / sec </li><li>  Magn√©tom√®tre √† trois axes 16 bits avec plage de mesure jusqu'√† ¬± 4800 ŒºT </li><li>  Filtres num√©riques int√©gr√©s </li><li>  Interfaces I¬≤C et SPI </li><li>  Interruptions programmables </li><li>  Coprocesseur de lecture DMP (Digital Motion Processor) </li></ul></div></div><br><p>  La puce est excellente, mais au final, il semblait que c'√©tait une surpuissance et un simple acc√©l√©rom√®tre suffit pour une utilisation dans une montre.  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Analog ADXL362</a> - selon le fabricant, il s'agit de l'acc√©l√©rom√®tre MEMS √† trois axes le plus √©conomique. </p><br><h3 id="flesh-pamyat">  M√©moire flash </h3><br><p>  Il a √©t√© d√©cid√© d'utiliser une m√©moire SPI-FLASH externe pour les applications et les donn√©es.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Parmi</a> une vari√©t√© d'options, la puce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Winbond W25Q256FV</a> dans le bo√Ætier compact WSON-8 a √©t√© choisie: </p><br><p><img src="https://habrastorage.org/web/7ca/6f6/617/7ca6f6617c454838be1f4b0ee964779f.jpg"></p><br><p>  La quantit√© de m√©moire flash est de 256 m√©gaoctets (ou 32 m√©gaoctets), c'est suffisant.  La m√©moire est divis√©e en pages de 256 octets, regroup√©es en secteurs de 4 kilo-octets et en blocs de 32 kilo-octets.  En mode actif (lecture ou √©criture), il consomme jusqu'√† 20mA, en mode veille - moins de 1ŒºA. </p><br><p>  Comme avec l'acc√©l√©rom√®tre, plus tard, il a sembl√© que 32 m√©gaoctets √©taient √©galement une surpuissance et vous pouvez utiliser la m√©moire FLASH int√©gr√©e du microcontr√¥leur √† la place, il a d√©j√† 512 kilo-octets.         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>     . </p><br><h3 id="knopki">  Boutons </h3><br><p>  ,           (   Pebble,  ).             .          ,            : </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wealth Metal TD-26EA</a> : </p><br><p><img src="https://habrastorage.org/web/55f/13a/47d/55f13a47d7c6491094d471c3a94af858.jpg"><br> <em>: &amp;</em> </p><br><p>  ,              . </p><br><p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Omron B3U-3000P</a> : </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/889/246/2d0/8892462d032444d691d70ef546c62743.png"></p></div></div><br><p>       . </p><br><h3 id="vibromotorchik">  </h3><br><p>     ,    ,  . </p><br><p>  Aliexpress       ,   3V   (HxWxL) 3x3x12mm: </p><br><div class="spoiler">  <b class="spoiler_title">Image</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/147/477/5c7/1474775c7260460896a4ea3b080e5571.jpg"></p></div></div><br><p>         ,    100mA      . </p><br><h3 id="antenna">  </h3><br><p> -     ,      -  .   ,      ,    .      ,          .    ,          . </p><br><p>   -  2.4GHz  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Johanson 2450AT18B100</a> : <br><img src="https://habrastorage.org/web/84b/dc7/0e5/84bdc70e556b490896f937b3aa23f574.jpg"></p><br><p> ,    ,   Johanson    ,     ,      Nordic.   nRF52 Johanson    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Johanson 2450FM07A0029</a> ,     - LC-  . </p><br><p> Les antennes ont √©t√© command√©es sur Aliexpress avec du ruban de 10 pi√®ces.  pour 214r / tape. </p><br><h3 id="vsyo-ostalnoe">  Tout le reste </h3><br><p>  Les composants passifs pour bretelles et cerclage sont principalement des puces de tailles 0402 et 0603 et command√©es en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Elitan</a> .  En plus des composants passifs, il y a deux transistors et une paire de diodes sur la carte.  Ils participent au contr√¥le du moteur de vibration, ainsi qu'au circuit de puissance, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©couplant l'alimentation USB et la batterie</a> . </p><br><h2 id="shema-i-plata">  Circuit et carte </h2><br><p>  <em>L'apparence de la carte dans les captures d'√©cran est l√©g√®rement diff√©rente de celle command√©e et est pr√©sente sur les photos de l'appareil.</em>  <em>Les captures d'√©cran de la carte sont juste une r√©vision un peu plus tard avec des changements mineurs.</em> </p><br><p>  Ayant d√©cid√© d'essayer quelque chose de nouveau, j'ai dessin√© le circuit et la carte non pas dans le DipTrace habituel, mais dans le cloud EDA Upverter: un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien vers le design</a> . </p><br><p>  Upverter vous permet d'effectuer la conception de bout en bout de la carte et du circuit en m√™me temps, de sorte que certains des √©l√©ments de c√¢blage ont √©t√© r√©alis√©s conform√©ment au sch√©ma, et une partie du circuit a √©t√© con√ßue en tenant compte des caract√©ristiques de c√¢blage. </p><br><p>  Une autre caract√©ristique qui tue Upverter est une √©norme biblioth√®que de composants, soigneusement g√©n√©r√©s par des robots et un tas d'Indiens.  Il s'est av√©r√© tr√®s pratique de prendre la partie d√©j√† dessin√©e et de v√©rifier simplement que tout est plus ou moins correct, au lieu de dessiner compl√®tement le symbole et l'empreinte vous-m√™me. </p><br><p>  Tout d'abord, j'ai d√©cid√© d'arranger les composants, dont la position sera fix√©e avec pr√©cision: boutons, port microUSB et connecteur pour l'√©cran.  Je n'ai pas fait de trous de montage, dans l'espoir que la planche sera bloqu√©e par le boitier et que rien ne pendra. </p><br><p>  Apr√®s l'emplacement des √©l√©ments fixes, suivez la "r√®gle d'or" et nous reproduirons la radio en premier.  L'antenne √† puce a une petite zone de conservation pr√®s d'elle, √† l'int√©rieur et en dessous de laquelle il n'est pas recommand√© de placer des pistes et des polygones sur toutes les couches, donc la r√®gle de bonne tonalit√© est de placer l'antenne au bord de la planche, de pr√©f√©rence plus pr√®s de l'un des coins.  En fait, l'emplacement de l'antenne a dict√© l'emplacement du microcontr√¥leur.  Pour que la longueur du conducteur entre le port de sortie de l'antenne sur la puce et l'antenne elle-m√™me soit aussi petite que possible (en tenant compte des composants correspondants), nous pla√ßons le contr√¥leur plus pr√®s du bord sur lequel l'antenne sera situ√©e. </p><br><p>  Tous les autres composants peuvent √™tre localis√©s (sans oublier le bon sens) assez librement.  Cela est d√ª au fait que la position des ports pour les p√©riph√©riques num√©riques du microcontr√¥leur nRF52 peut √™tre d√©termin√©e par programme. </p><br><p>  D'apr√®s ma petite exp√©rience, un arrangement mutuel r√©ussi des composants est un succ√®s √† 90% et il dicte la qualit√© du c√¢blage suppl√©mentaire, donc ce processus doit faire l'objet d'une attention particuli√®re. </p><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran du tableau (les polygones ne sont pas inond√©s, vue de dessous)</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/9dc/5f1/7cd/9dc5f17cd1c34a00943ebd444b28a964.png"></p></div></div><br><p>  Pour plus de clart√©, j'ai peint une topologie approximative des domaines cl√©s: </p><br><p><img src="https://habrastorage.org/web/fd0/136/bef/fd0136bef5c140c3bb6b069615f4837f.png"></p><br><p>  La carte est √† quatre couches, placer les composants s√©lectionn√©s sur la carte et diluer leurs connexions a √©t√© une question de plusieurs nuits, puis il a fallu environ une semaine pour rester coinc√© dans la carte, trouver des erreurs, v√©rifier sans rel√¢che et relire les fiches techniques pour √©viter les surprises soudaines. </p><br><p>  La carte a √©t√© dessin√©e en tenant compte des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">normes technologiques</a> du fabricant de cartes, devenu l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OSHPark.com</a> am√©ricain: </p><br><ul><li>  Conducteur / D√©gagement: 5/5 Mil </li><li>  Vias: 10/4 mil trou / pad </li><li>  Mat√©riel: FR408 </li><li>  Finition: or d'immersion avec une sous-couche de nickel (ENIG) </li><li>  Les vias aveugles et les transitions de couche interne (vias enterr√©s) ne sont pas pris en charge.  <em>Et nous n'avons pas besoin</em> </li></ul><br><p>  En m√™me temps, le prix est de 10 $ le sq.  pouces et le nombre de planches dans l'ordre - 3pcs.  Ce sont des cartes m√®res de tr√®s haute qualit√© et peu co√ªteuses (pour les prototypes) avec un masque violet reconnaissable, je recommande √† tous ceux qui ne sont pas critiques d'attendre deux semaines pour leurs cartes m√®res bilat√©rales ou √† quatre couches pendant un mois. </p><br><div class="spoiler">  <b class="spoiler_title">Commander une capture d'√©cran</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/ab1/daf/2ae/ab1daf2ae0b64016ac897c4afd23fb51.png"></p></div></div><br><p>  En cons√©quence, pour trois frais, j'ai d√ª payer 14 $ et un mois plus tard les r√©cup√©rer par la poste. </p><br><div class="spoiler">  <b class="spoiler_title">Photos de la carte sans composants</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/a45/223/d98/a45223d982164562992fd1c3b9a9b308.jpg"><br><img src="https://habrastorage.org/web/6b0/438/119/6b043811948c4552a2d51294007dd385.jpg"></p></div></div><br><p>  Tous les composants sont situ√©s sur le c√¥t√© inf√©rieur de la carte, sur le c√¥t√© sup√©rieur de la carte se trouve le module d'affichage, sous lequel se trouve une bobine NFC plate, qui vous permet d'√©conomiser plusieurs millim√®tres de hauteur et assure un ajustement lisse et serr√© de l'√©cran. </p><br><div class="spoiler">  <b class="spoiler_title">Il s'av√®re qu'un tel sandwich</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/18a/5c4/a32/18a5c4a320d14b31be2aad99ff8e9d7f.png"></p></div></div><br><p>  Sur le c√¥t√© sup√©rieur de la carte, il y a √©galement un tas de points de test, de tampons de test, auxquels I¬≤C, des lignes de bus SPI, des lignes d'interruption et certains signaux de contr√¥le sont connect√©s.  Un oscilloscope ou un analyseur logique peut √™tre connect√© √† ces plates-formes et cette fonctionnalit√© simplifie consid√©rablement l'√©criture des pilotes et le d√©bogage du micrologiciel.  Sur le c√¥t√© sup√©rieur de la carte se trouve √©galement l'interface de d√©bogage JTAG (SWD) pour le clignotement et le d√©bogage via Segger JLink, qui est incluse dans le kit nRF52-DK, et des plots pour souder la bobine d'antenne NFC. </p><br><h2 id="sborka-i-payka">  Assemblage et soudure </h2><br><p>  Si vous suivez l'ensemble du processus de montage en surface, vous devez commander un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pochoir smd (pochoir smd)</a> et une p√¢te √† souder, appliquer la p√¢te √† souder √† travers le pochoir, organiser les composants et les envoyer au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">four de refusion</a> . </p><br><p>  Mais je n'avais pas de four, ni de pochoir.  Et le d√©sir de jouer avec lui et de la p√¢te √† souder aussi.  Je voulais assembler rapidement un prototype et commencer √† tester et √† √©crire un logiciel.  Par cons√©quent, j'ai soud√© manuellement tous les composants, dont les plus petits sont des copeaux de taille 0402, en appliquant de la p√¢te avec une aiguille, en pla√ßant les composants avec une pince √† vide et en les soudant avec un s√®che-cheveux. </p><br><p>  Le r√©sultat peut √™tre vu sur la photo: </p><br><p><img src="https://habrastorage.org/web/4e1/164/938/4e11649380fb457b9ebce97f267e32ac.jpg"></p><br>  <em>Les boutons ne sont pas soud√©s, et au lieu de plusieurs puces √† trois pattes - des cavaliers.</em> <br>  <em>Je m'excuse pour les photos de mauvaise qualit√©, prises sur une brique.</em> <br><br><br><div class="spoiler">  <b class="spoiler_title">Photo par loupe x30</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/web/8d8/25c/fed/8d825cfedfe047ddb9f260548d365219.jpg"><br>  <em>Vous pouvez voir des composants l√©g√®rement tourn√©s et par endroits un exc√®s de soudure.</em>  <em>Cela est in√©vitable avec l'installation et l'application manuelles de la p√¢te.</em> </p></div></div><br><p>  D√®s que la carte a √©t√© assembl√©e, j'ai pris le testeur dans mes mains et j'ai commenc√© √† faire sonner tout ce que je pouvais atteindre pour les courts-circuits.  Apr√®s s'√™tre assur√© qu'il ne semblait pas √™tre petit, il a connect√© un c√¢ble USB.  Il n'y a pas de fum√©e, les puces ne chauffent pas, la tension sur le port USB est de 5 volts, la sortie de charge est de 4,2 V, la tension apr√®s LDO est exactement de trois volts.  Cela semble fonctionner. </p><br><p>  M√™me lorsqu'il est enti√®rement aliment√©, l'appareil ne montre bien s√ªr aucun signe de vie.  Maintenant, vous devez y insuffler de l'√¢me - firmware (ou "syst√®me d'exploitation", comme certains fabricants de montres: WatchOS, PebbleOS, etc.). </p><br><p>  L'√©tape suivante du test a √©t√© de connecter le d√©bogueur JLink int√©gr√© au nRF52-DK via l'interface SWD.  Nous connectons le c√¢blage, ex√©cutons JLinkExe et voyons notre puce!  Vous pouvez commencer √† √©crire le firmware et √† tester les blocs de fer restants par programmation. </p><br><h2 id="laquooperacionnaya-sistemaraquo-dlya-chasov">  "Syst√®me d'exploitation" pour montres </h2><br><p>  Pour les travaux p√©riph√©riques de bas niveau, Nordic propose son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nRF5-SDK</a> , qui convient aux s√©ries nRF51 et nRF52. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/web/1c6/54b/0cd/1c654b0cd48540efbb8e9a2ab79dc299.png"></a> </p><br><p>SDK             , , NFC   .     Makefile    <code>arm-none-eabi-gcc</code>.        ,       .</p><br>
<p>       .hex-,      nRF52-DK    .   nRF52-DK  ,  Mass Storage Device (),      .hex         .</p><br>
<p>     <code>JLinkExe</code>   GDB-    <code>nrfjprog</code>.</p><br>
<p>        ,   .          ,     ,                 ,            ,      .</p><br>
<p>    ,             .</p><br>
<p><img src="https://habrastorage.org/web/2fe/4fb/faf/2fe4fbfaf96746da8573e732632c6fa8.png"><br>
<em> , -,  ,     .</em></p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p><img src="https://habrastorage.org/web/a1f/ee6/9e3/a1fee69e3bee4918babac61db1c25ca8.jpg"></p></div></div><br>
<p>     ,        ,    -   .      API     X-Lib            .             ,        .</p><br>
<p>  :</p><br>
<p><img src="https://thumbs.gfycat.com/BoldThornyBuck-size_restricted.gif"></p><br>
<div class="spoiler"><b class="spoiler_title">   </b><div class="spoiler_text"><p><img src="https://thumbs.gfycat.com/ArtisticSoupyAntlion-size_restricted.gif" alt="image"></p></div></div><br>
<p> ,    API  ,    JavaScript (ES 5),                 .   ,  .</p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JerryScript</a>,         , API      ,     ,    .   ,        ,   :    Date  .., JSON-,       ..</p><br>
<div class="spoiler"><b class="spoiler_title">    JS-</b><div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Duktape</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Espruino</a></li>
</ul></div></div><br>
<p>   JS  :</p><br>
<p><img src="https://habrastorage.org/web/ac6/a92/c2f/ac6a92c2faab4f3bb18f65b4fa2d8968.jpg"></p><br>
<p>  API          GUI,    , Bluetooth,   ..</p><br>
<p>        ( <code>-O0</code>):</p><br>
<p><img src="https://habrastorage.org/web/a41/e24/f8f/a41e24f8faf84949a14c79d1f9938cea.png"></p><br>
<p>106kB FLASH, 12.8kB RAM.   8kB RAM ‚Äî  (heap)   JavaScript .           . ,   FLASH  nRF52832  512kB,    RAM ‚Äî 64kB.</p><br>
<p> FLASH (120kB)      RAM   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> BLE- SoftDevice.</p><br>
<h2 id="korpus"></h2><br>
<p>    ‚Äî  3D- .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TinkerCad</a>    3D-.    :</p><br>
<div class="spoiler"><b class="spoiler_title">   USB-  </b><div class="spoiler_text"><p><img src="https://habrastorage.org/web/e66/5fa/e0d/e665fae0d3414e56bead2ff4ff5050e2.jpg"></p></div></div><br>
<p><em> -          3D-,          !</em></p><br>
<h2 id="zaklyuchenie"></h2><br>
<p>       ,         .       ,   ,     ,          .  ,  ,            ,      .</p><br>
<p>         ,     API-  JS-,           JS-,   -  Android.           ,     .    ,        , , Android-   .</p><br>
<p>    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://upverter.com/EP/cdbd8b9abc72b7cd/nRF52-smart-watch/</a><br>
         ,     Github.</p><br>
<p>    , ,       -        ,      .</p><br>
<p>      !</p><br>
<p><strong>P.S.:</strong>  .</p></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr404737/">https://habr.com/ru/post/fr404737/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr404725/index.html">Intel abandonne Edison, Galileo et Joule</a></li>
<li><a href="../fr404727/index.html">Elon Musk a expliqu√© comment il r√©ussit √† √™tre si productif</a></li>
<li><a href="../fr404731/index.html">La soci√©t√© d'h√©bergement sud-cor√©enne a vers√© 1 million de dollars aux d√©veloppeurs de la version Linux du crypto-ran√ßongiciel Erebus</a></li>
<li><a href="../fr404733/index.html">Nous connaissons des particules √©l√©mentaires (apparemment)</a></li>
<li><a href="../fr404735/index.html">Une nouvelle √©tude a montr√© que les chats n'√©taient pas apprivois√©s comme les autres animaux</a></li>
<li><a href="../fr404741/index.html">√âvaluation du dioxyde de carbone dans une pi√®ce climatis√©e</a></li>
<li><a href="../fr404745/index.html">Demandez √† Ethan: Quelle doit √™tre la taille de la portion de l'univers pour se d√©velopper?</a></li>
<li><a href="../fr404747/index.html">WikiLeaks a publi√© la documentation de la CIA sur l'infection d'ordinateurs physiquement isol√©s</a></li>
<li><a href="../fr404749/index.html">Microsoft a admis qu'il d√©connecte parfois des parties d'antivirus tiers</a></li>
<li><a href="../fr404751/index.html">Routeur avec fonctionnalit√©s VoIP en seulement cent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>