<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüåæ üç¶ üôáüèª Configurer le VPN site √† site IPSec sur le mat√©riel de Palo Alto Networks üë©üèø‚Äçü§ù‚Äçüë®üèΩ üåñ ü§¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est une continuation du mat√©riel pr√©c√©dent sur les caract√©ristiques de la configuration de l'√©quipement Palo Alto Networks . Ici, nous vou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configurer le VPN site √† site IPSec sur le mat√©riel de Palo Alto Networks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/crosstech/blog/448952/"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/68c/d7c/a2c68cd7c6cbac21b84a65f55eb7dd33.png" alt="image"><br><br>  Cet article est une continuation du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mat√©riel pr√©c√©dent</a> sur les caract√©ristiques de la configuration de l'√©quipement <b>Palo Alto Networks</b> .  Ici, nous voulons parler de la configuration <b>du VPN site √† site IPSec</b> sur les √©quipements <b>Palo Alto Networks</b> et d'une option de configuration possible pour connecter plusieurs fournisseurs Internet. <br><a name="habracut"></a><br>  Pour d√©monstration, le sch√©ma standard de connexion du si√®ge social √† la succursale sera utilis√©.  Afin de fournir une connexion Internet √† tol√©rance de pannes, le si√®ge social utilise la connexion simultan√©e de deux fournisseurs: ISP-1 et ISP-2.  La succursale n'a de connexion qu'avec un seul fournisseur, ISP-3.  Entre les pare-feu PA-1 et PA-2, deux tunnels sont construits.  Les tunnels fonctionnent en mode de <b>veille active</b> , le tunnel-1 est actif, le tunnel-2 commencera √† transmettre le trafic lorsque le tunnel-1 √©choue.  Tunnel-1 utilise une connexion au fournisseur de services Internet ISP-1, Tunnel-2 utilise une connexion au fournisseur de services Internet ISP-2.  Toutes les adresses IP sont g√©n√©r√©es al√©atoirement √† des fins de d√©monstration et ne sont pas li√©es √† la r√©alit√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/312/8a1/67b/3128a167bfa98d8aed104e6e1e85ef22.png" alt="image"><br><br>  Pour construire un VPN de site √† site, <b>IPSec</b> sera utilis√© - un ensemble de protocoles pour prot√©ger les donn√©es transmises sur IP.  <b>IPSec</b> fonctionnera en utilisant le protocole de s√©curit√© <b>ESP</b> (Encapsulating Security Payload), qui assurera le cryptage des donn√©es transmises. <br><br>  <b>IPSec</b> comprend <b>IKE</b> (Internet Key Exchange), le protocole charg√© de n√©gocier les param√®tres de s√©curit√© SA (associations de s√©curit√©) qui sont utilis√©s pour prot√©ger les donn√©es transmises.  Les pare-feu PAN prennent en charge <b>IKEv1</b> et <b>IKEv2</b> . <br><br>  Dans le VPN <b>IKEv1</b> , la connexion est √©tablie en deux √©tapes: <b>Phase 1 IKEv</b> (tunnel IKE) et <b>Phase 2 IKEv1</b> (tunnel IPSec), de sorte que deux tunnels sont cr√©√©s, dont l'un sert √† l'√©change d'informations de service entre les pare-feu et le second √† la transmission du trafic.  Il existe deux modes de fonctionnement dans <b>IKEv1 Phase 1</b> - le mode principal et le mode agressif.  Le mode agressif utilise moins de messages et est plus rapide, mais ne prend pas en charge la protection de l'identit√© des pairs. <br><br>  <b>IKEv2 a</b> remplac√© <b>IKEv1</b> , et par rapport √† <b>IKEv1,</b> son principal avantage est moins d'exigences de bande passante et une n√©gociation SA plus rapide.  <b>IKEv2</b> utilise moins de messages de service (4 au total), prend en charge le protocole EAP, MOBIKE et ajoute un m√©canisme de v√©rification de la disponibilit√© des pairs avec lequel un tunnel est cr√©√© - <b>Liveness Check</b> , rempla√ßant la d√©tection des homologues morts dans IKEv1.  Si le test √©choue, <b>IKEv2</b> peut r√©initialiser le tunnel, puis r√©cup√©rer automatiquement d√®s que possible.  Vous pouvez en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">savoir</a> plus sur les diff√©rences <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Si le tunnel est construit entre des pare-feu de diff√©rents fabricants, il peut y avoir des bogues dans l'impl√©mentation d' <b>IKEv2</b> , et pour la compatibilit√© avec un tel √©quipement, il est possible d'utiliser <b>IKEv1</b> .  Dans d'autres cas, il est pr√©f√©rable d'utiliser <b>IKEv2</b> . <br><br>  √âtapes de configuration: <br><br>  <b>‚Ä¢ Configuration de deux fournisseurs Internet en mode actif \ veille</b> <br><br>  Il existe plusieurs fa√ßons d'impl√©menter cette fonctionnalit√©.  L'un d'eux consiste √† utiliser le m√©canisme de <b>surveillance de chemin d'acc√®s</b> , qui est devenu disponible depuis <b>PAN-OS 8.0.0</b> .  Cet exemple utilise la version 8.0.16.  Cette fonctionnalit√© est similaire √† IP SLA dans les routeurs Cisco.  Dans le param√®tre de la route statique par d√©faut, l'envoi de paquets ping √† une adresse IP sp√©cifique √† partir d'une adresse source sp√©cifique est configur√©.  Dans ce cas, l'interface ethernet1 / 1 envoie une requ√™te ping √† la passerelle par d√©faut une fois par seconde.  S'il n'y a pas de r√©ponse √† trois pings cons√©cutifs, la route est consid√©r√©e comme inop√©rante et est supprim√©e de la table de routage.  Le m√™me itin√©raire est configur√© en direction du deuxi√®me fournisseur Internet, mais avec plus de m√©triques (c'est la sauvegarde).  D√®s que la premi√®re route est supprim√©e de la table, le pare-feu commencera √† envoyer du trafic le long de la deuxi√®me route - <b>Basculement</b> .  Lorsque le premier fournisseur commence √† r√©pondre aux pings, son itin√©raire revient √† la table et remplace le second en raison de la meilleure m√©trique - <b>Fail-Back</b> .  Le processus de <b>basculement</b> prend plusieurs secondes en fonction des intervalles configur√©s, mais dans tous les cas, le processus n'est pas instantan√© et √† ce moment le trafic est perdu.  <b>Le fail-back</b> passe sans perte de trafic.  Il est possible d'acc√©l√©rer le <b>basculement en</b> utilisant <b>BFD</b> , si votre FAI propose cette option.  <b>BFD est</b> pris en charge √† partir de la s√©rie <b>PA-3000</b> et <b>VM-100</b> .  En tant qu'adresse de ping, il est pr√©f√©rable de sp√©cifier non pas la passerelle du fournisseur, mais une adresse Internet publique, toujours accessible. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/459/47f/546/45947f5469df67a6ecd315180779465b.png" alt="image"><br><br>  <b>‚Ä¢ Cr√©ation d'une interface tunnel</b> <br><br>  Le trafic √† l'int√©rieur du tunnel est transmis via des interfaces virtuelles sp√©ciales.  Chacun d'eux doit √™tre configur√© avec une adresse IP du r√©seau de transit.  Dans cet exemple, le sous-r√©seau 172.16.1.0/30 sera utilis√© pour Tunnel-1 et le sous-r√©seau 172.16.2.0/30 sera utilis√© pour Tunnel-2. <br>  L'interface tunnel est cr√©√©e dans la section <b>R√©seau -&gt; Interfaces -&gt; Tunnel</b> .  Vous devez sp√©cifier le routeur virtuel et la zone de s√©curit√©, ainsi que l'adresse IP du r√©seau de transport correspondant.  Le num√©ro d'interface peut √™tre quelconque. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b06/a3d/08e/b06a3d08e1ee5088b23f5196aae51d3f.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/13f/9e5/5b6/13f9e55b6855207fc6bc8c2be69657c7.png" alt="image"><br><br>  Dans la section <b>Avanc√©</b> , vous pouvez sp√©cifier un <b>profil de gestion</b> qui autorise le ping vers cette interface, cela peut √™tre utile pour les tests. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b67/f4d/47a/b67f4d47a922bdf70f010be46f3e3fe2.png" alt="image"><br><br>  <b>‚Ä¢ Configurer le profil IKE</b> <br><br>  <b>Le profil IKE</b> est responsable de la premi√®re √©tape de la cr√©ation d'une connexion VPN; ici, les param√®tres du tunnel <b>IKE phase 1</b> sont sp√©cifi√©s.  Le profil est cr√©√© dans la section <b>R√©seau -&gt; Profils r√©seau -&gt; Crypto IKE</b> .  Vous devez sp√©cifier l'algorithme de chiffrement, le hachage, le groupe Diffie-Hellman et la dur√©e de vie de la cl√©.  En g√©n√©ral, plus les algorithmes sont complexes, plus les performances sont mauvaises; ils doivent √™tre s√©lectionn√©s en fonction d'exigences de s√©curit√© sp√©cifiques.  Cependant, il est fortement d√©conseill√© d'utiliser le groupe Diffie-Hellman inf√©rieur √† 14 pour prot√©ger les informations importantes.  Cela est d√ª √† la vuln√©rabilit√© du protocole, qui ne peut √™tre nivel√© qu'en utilisant une taille de module de 2048 bits ou plus, ou des algorithmes de cryptographie elliptiques, qui sont utilis√©s dans les groupes 19, 20, 21, 24. Ces algorithmes sont plus productifs que la cryptographie traditionnelle.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plus de d√©tails ici</a> .  Et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ff/18a/d04/3ff18ad0457e792f86045d8b42534e39.png" alt="image"><br><br>  <b>‚Ä¢ Configurer le profil IPSec</b> <br><br>  La deuxi√®me √©tape de la cr√©ation d'une connexion VPN est le tunnel IPSec.  Les param√®tres SA pour celui-ci sont configur√©s dans <b>R√©seau -&gt; Profils r√©seau -&gt; Profil de cryptage IPSec</b> .  Ici, vous devez sp√©cifier le protocole IPSec - <b>AH</b> ou <b>ESP</b> , ainsi que les param√®tres <b>SA</b> - hachage, algorithmes de chiffrement, groupes Diffie-Hellman et dur√©e de vie des cl√©s.  Les param√®tres SA dans IKE Crypto Profile et IPSec Crypto Profile peuvent ne pas correspondre. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b38/5e2/30c/b385e230c1548d0c65f6b8d7ead35b29.png" alt="image"><br><br>  <b>‚Ä¢ Configurer la passerelle IKE</b> <br><br>  <b>Une passerelle IKE</b> est un objet qui identifie le routeur ou le pare-feu avec lequel un tunnel VPN est construit.  Pour chaque tunnel, vous devez cr√©er votre propre <b>passerelle IKE</b> .  Dans ce cas, deux tunnels sont cr√©√©s, un via chaque fournisseur Internet.  L'interface sortante correspondante et son adresse IP, son adresse IP homologue et sa cl√© commune sont indiqu√©es.  Vous pouvez utiliser des certificats comme alternative √† une cl√© partag√©e. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a56/251/b36/a56251b36a69840ec730e50568e690e8.png" alt="image"><br><br>  Cela indique le <b>profil de cryptage IKE</b> cr√©√© pr√©c√©demment.  Les param√®tres du deuxi√®me objet de <b>passerelle IKE</b> sont similaires, √† l'exception des adresses IP.  Si le pare-feu Palo Alto Networks se trouve derri√®re un routeur NAT, le m√©canisme <b>NAT Traversal</b> doit √™tre activ√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/23b/3cc/da8/23b3ccda8c845371f4bd4e7efd41a7ea.png" alt="image"><br><br>  <b>‚Ä¢ Configurer le tunnel IPSec</b> <br><br>  <b>Le tunnel IPSec</b> est un objet qui sp√©cifie les param√®tres du tunnel IPSec, comme son nom l'indique.  Ici, vous devez sp√©cifier l'interface de tunnel et les objets de <b>passerelle</b> <b>IPSec Crypto Profile</b> cr√©√©s pr√©c√©demment.  Pour garantir la commutation automatique du routage vers le tunnel de secours, vous devez activer <b>Tunnel Monitor</b> .  Il s'agit d'un m√©canisme qui v√©rifie si un homologue est vivant √† l'aide du trafic ICMP.  En tant qu'adresse de destination, vous devez sp√©cifier l'adresse IP de l'interface de tunnel du pair avec lequel le tunnel est en cours de construction.  Le profil indique les temporisateurs et l'action en cas de perte de connexion.  <b>Wait Recover</b> - attendez que la connexion soit r√©tablie, <b>Fail Over</b> - envoyez du trafic sur une autre route, le cas √©ch√©ant.  La configuration du deuxi√®me tunnel est compl√®tement la m√™me; la deuxi√®me interface de tunnel et la passerelle IKE sont indiqu√©es. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fdb/29c/f75/fdb29cf75864f4fcf0ca5ec1d7459dc4.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/96c/330/1cb/96c3301cb47e3dcbb449f5174227532a.png" alt="image"><br><br>  <b>‚Ä¢ Configuration du routage</b> <br><br>  Cet exemple utilise le routage statique.  Sur le pare-feu PA-1, en plus de deux routes par d√©faut, vous devez sp√©cifier deux routes vers le sous-r√©seau 10.10.10.0/24 dans la branche.  Un itin√©raire utilise Tunnel-1, l'autre Tunnel-2.  L'itin√©raire via Tunnel-1 est basique car il a une m√©trique inf√©rieure.  Le m√©canisme de <b>surveillance</b> des chemins pour ces routes n'est pas utilis√©.  <b>Tunnel Monitor</b> est responsable de la commutation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f94/b4f/3ed/f94b4f3ed8ce6c2d44af95ebfaf3c1b1.png" alt="image"><br><br>  Les m√™mes routes pour le sous-r√©seau 192.168.30.0/24 doivent √™tre configur√©es sur PA-2. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bdd/a93/ffb/bdda93ffb9dc17d0765d7e6cf78515ad.png" alt="image"><br><br>  <b>‚Ä¢ Configurer les r√®gles de r√©seau</b> <br><br>  Pour que le tunnel fonctionne, vous avez besoin de trois r√®gles: <br><br><ol><li>  Pour que <b>Path Monitor</b> fonctionne, activez ICMP sur les interfaces externes. </li><li>  Pour <b>IPSec,</b> activez les applications <b>ike</b> et <b>ipsec</b> sur les interfaces externes. </li><li>  Autorisez le trafic entre les sous-r√©seaux internes et les interfaces de tunnel. </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/157/271/34a/15727134adc31c0260c32ef6c2768248.png" alt="image"><br><br>  <b>Conclusion</b> <br><br>  Cet article d√©crit la configuration d'une connexion Internet √† s√©curit√© int√©gr√©e et <b>d'un VPN de site √† site</b> .  Nous esp√©rons que ces informations ont √©t√© utiles et le lecteur a eu une id√©e des technologies utilis√©es dans les <b>r√©seaux de Palo Alto</b> .  Si vous avez des questions sur la personnalisation et des suggestions sur les sujets des futurs articles - √©crivez-les dans les commentaires, nous nous ferons un plaisir de vous r√©pondre. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448952/">https://habr.com/ru/post/fr448952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448940/index.html">Dell Latitude 5491: un ordinateur portable d'entreprise robuste avec un processeur puissant</a></li>
<li><a href="../fr448942/index.html">Crypto-monnaie: vit ou meurt?</a></li>
<li><a href="../fr448944/index.html">Fluent 1.0: syst√®me de localisation flexible</a></li>
<li><a href="../fr448946/index.html">Comment commencer √† appliquer R dans Enterprise. Exemple pratique</a></li>
<li><a href="../fr448948/index.html">La science de la logique en programmation</a></li>
<li><a href="../fr448956/index.html">Col√®re contre le code: programmeurs et n√©gativit√©</a></li>
<li><a href="../fr448958/index.html">Comment Amazon choisit ses offres apparemment al√©atoires de la journ√©e. Et pourquoi les vendeurs les poursuivent-ils</a></li>
<li><a href="../fr448960/index.html">La technologie XR illimit√©e √† l'√®re de l'informatique distribu√©e</a></li>
<li><a href="../fr448962/index.html">L'efficacit√© de l'entonnoir marketing AARRR</a></li>
<li><a href="../fr448964/index.html">Le grille-pain donne aux utilisateurs plus de droits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>