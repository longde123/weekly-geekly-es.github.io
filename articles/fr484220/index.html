<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò≠ üë©üèª‚Äçüöí üî≠ Avez-vous command√© la livraison? Comment Crossroads livre 6 000 commandes par jour üòê üëù ‚åõÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les gens aiment la livraison. Pour une somme modique, vous achetez la possibilit√© d'obtenir les bons produits sans quitter votre maison: la nourriture...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Avez-vous command√© la livraison? Comment Crossroads livre 6 000 commandes par jour</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/484220/">  Les gens aiment la livraison.  Pour une somme modique, vous achetez la possibilit√© d'obtenir les bons produits sans quitter votre maison: la nourriture de votre restaurant pr√©f√©r√©, des meubles surdimensionn√©s, un livre que vous vouliez lire depuis longtemps, et m√™me n'importe quoi.  Et l'augmentation du nombre de services pour une livraison rapide de tout dans le monde ne fait que confirmer cette th√®se.  Oui, et pour les magasins, c'est un plus - il s'est associ√© √† toute livraison de marchandises √† la porte et a augment√© son ch√®que. <br><br>  Chez ¬´Crossroads¬ª, nous avons notre propre livraison.  Pour une personne de l'ext√©rieur, le processus de livraison d'un magasin √† une maison ressemble √† ceci: <br><br><ol><li>  J'ai choisi quelque chose sur le site et je l'ai mis dans le panier. </li><li>  J'ai entr√© l'adresse et pay√© la commande. </li><li>  Le magasin a rapidement donn√© l'ordre au courrier. </li><li>  Le courrier a rendu la commande. </li></ol><br>  En fait, tout est un peu plus compliqu√©.  Je m'appelle Vitaliy, je suis le chef du d√©partement d√©veloppement, et aujourd'hui je vais vous dire comment tout fonctionne pour nous.  Et sur quoi. <br><br><img src="https://habrastorage.org/webt/vo/rn/u7/vornu7hu0kjkmk1jwluuqb1usj4.jpeg"><br><a name="habracut"></a><br>  Deux applications sont responsables de la stabilit√© du processus - une vitrine et une application mobile utilisateur.  Tout est classique avec la vitrine - l'acheteur visite le site, passe du temps √† choisir des produits et √† remplir le panier, √† examiner les fiches produits.  La derni√®re √©tape ici consiste √† passer une commande.  Apr√®s cela, la commande est transf√©r√©e pour un traitement ult√©rieur au back-office. <br><br>  En g√©n√©ral, le back office d'une boutique en ligne est un syst√®me dans lequel de nombreuses actions sont effectu√©es sur les marchandises: nous prescrivons la participation des marchandises √† certaines promotions, y attachons des banni√®res, mettons en √©vidence les zones de marque et plus encore.  Bien s√ªr, les commandes sont trait√©es ici.  Lorsque l'acheteur ach√®ve le processus de commande et que la commande arrive au back office, celle-ci doit √™tre confirm√©e.  Cela se produit automatiquement si nous connaissons d√©j√† cet acheteur, ou par l'op√©rateur en mode manuel selon le sch√©ma habituel "Bonjour, avez-vous command√© quelque chose ici, confirmez, les donn√©es sont-elles correctes?" Et ainsi de suite.  Et ici, la participation du back-office au processus de formation de la livraison est d√©j√† termin√©e, la commande est confirm√©e, le statut passe de ¬´Trait√©e¬ª √† ¬´En cours¬ª.  Une commande dans WMS (o√π elle est r√©serv√©e, collect√©e, les marchandises command√©es qui ne sont pas disponibles et qui sont faites sur commande aupr√®s du fournisseur) et en m√™me temps, elle peut commencer √† √™tre achemin√©e par les logisticiens.  Dans l'ensemble, le WMS et la logistique sont des syst√®mes ind√©pendants qui fonctionnent en parall√®le avec les commandes. <br><br><h3>  En attendant, en stock </h3><br>  Le syst√®me WMS est une combinaison de nos logiciels, entrep√¥ts, employ√©s de ces entrep√¥ts et appareils, ce qui simplifie consid√©rablement la vie de ces employ√©s.  Un petit terminal, qui est mont√© sur le poignet d'un employ√©, vous permet d'assembler rapidement une commande dans l'ordre souhait√©. <br><br><img src="https://habrastorage.org/webt/fb/bj/sj/fbbjsjtm6z0gt3l5zx4yi6zcjz4.jpeg"><br><br>  La coh√©rence est importante car nous livrons les commandes √† nos clients dans des bo√Ætes sp√©ciales Crossroads.  Et avec une bo√Æte une chose - c'est rectangulaire.  Comme la plupart des bo√Ætes. <br><br>  Par cons√©quent, il est n√©cessaire de respecter deux conditions en m√™me temps - et de remplir la bo√Æte elle-m√™me autant que possible afin que le client ne re√ßoive pas deux bo√Ætes qui ne sont qu'√† moiti√© pleines (c'est √† la fois peu √©conomique, respectueux de l'environnement et g√©n√©ralement √©trange), et remplissez la bo√Æte selon le principe ¬´de lourd √† l√©ger¬ª ".  Le syst√®me prend en compte la taille du produit et son emballage.  Connaissant cela et les param√®tres de la bo√Æte, il est possible de former des commandes afin que la bo√Æte soit remplie au maximum.  Cela vous permet √©galement de vous d√©barrasser des situations o√π la voiture du courrier semble √™tre partie pour remplacer tous les 100% charg√©s de bo√Ætes, mais √† moiti√© vides. <br><br>  Et le syst√®me √©crit pour le magasinier dans quel ordre collecter la commande.  Peu de gens veulent obtenir une bo√Æte dans laquelle un bon employ√© d'entrep√¥t a d√©pos√© trois douzaines d'≈ìufs au fond, en posant soigneusement sur 10 paquets de lait et quelques kilogrammes de l√©gumes, par exemple.  Avec du lait, c'est s√ªr, tout ira bien, ce qui ne peut pas √™tre dit des ≈ìufs.  Toutes sortes de cookies fragiles sont √©galement toujours au top. <br><br><img src="https://habrastorage.org/webt/nq/hd/ml/nqhdmlyl2ybszay3eo2jocrd7sg.jpeg"><br><br>  De plus, vous devez suivre les r√®gles du voisinage des marchandises.  Disons que ce sera plut√¥t triste pour vous si vous avez command√© 2 vari√©t√©s de pommes, de petits pains et de poisson, et tout cela ne puait pas avec du poisson, mais avec du d√©tergent en g√©n√©ral, car tout est arriv√© dans une bo√Æte.  Par cons√©quent, la nourriture - s√©par√©ment, les produits chimiques m√©nagers - s√©par√©ment.  Le voisinage des marchandises est d√©termin√© par les normes SanPiN, soit dit en passant.  Et nous les observons.  D'un point de vue humain, il s'agit d'un mod√®le logique et unique.  Du point de vue de l'entrep√¥t, ce sont des variables suppl√©mentaires lors de la construction de la route du magasinier. <br><br>  Le syst√®me prend tout en compte et construit un itin√©raire, gr√¢ce auquel l'employ√© recueille la commande dans l'ordre souhait√© - le terminal le conduit au rayonnage correct.  Si vous exag√©rez, il semble que le travail de la partie cliente de l'application soit le suivant: ¬´Guy, va au B4, prends 5 paquets de farine avec eux, mets-les tout en bas de la bo√Æte.  Puis √† partir de A2, prenez le lait.  Non, pas celui-ci, c'est dans cette cellule. ¬ª <br><br><img src="https://habrastorage.org/webt/r7/tr/ve/r7trvey_hhcwxgzqtcnq9p4fsag.jpeg"><br><br>  Une fois qu'ils ont fait une demande pour les gars de l'entrep√¥t, il √©tait n√©cessaire de faire une demande pour les coursiers.  Il permet non seulement de cr√©er des itin√©raires, mais √©galement d'imprimer rapidement des ch√®ques et de noter les nouveaux statuts des commandes.  Eh bien, les m√©triques, o√π n'y a-t-il pas de m√©triques - nous voyons o√π se trouve un coursier particulier, il s'inscrit normalement dans le calendrier ou non, il a imprim√© un ch√®que lors du transfert de la commande √† l'acheteur ou non, et ainsi de suite. <br><br><img src="https://habrastorage.org/webt/gc/ni/r9/gcnir9cqhhgmsyhsclvpqy-ylkw.png"><br><br>  Soit dit en passant, pourquoi n'imprimons-nous pas imm√©diatement les ch√®ques: lorsque nous apportons nos bo√Ætes au client, il peut refuser n'importe quel produit pour quelque raison que ce soit.  Par exemple, il a r√©ussi √† acheter des glaces pour lui-m√™me, ou a fait bouillir deux litres de lait et a d√©cid√© que le poisson et les concombres marin√©s pour ce soir n'√©taient qu'une id√©e.  En g√©n√©ral, il peut y avoir de nombreuses raisons de rejeter une position, y compris un ¬´changement d'avis¬ª.  Par cons√©quent, le courrier supprime les postes que le client a refus√©s et imprime le ch√®que final. <br><br><h3>  Sous le capot </h3><br>  Nous √©crivons nos applications sur Swift et Kotlin (iOS et Android, respectivement).  Dans ce cas, tout le backend tourne en PHP, nous avons d√©cid√© de faire la base de donn√©es sur Postgres, pour le broker nous avons Rabbit mq. <br><br>  Oui, il est clair qu'en 2019, tout le monde fait tout d'abord sur le principe du mobile, mais il s'est av√©r√© que le site est n√©anmoins plus proche et plus cher.  Il travaille chez Lavarel.  En ce qui concerne les microservices, nous commen√ßons √©galement √† peine √† bouger, donc en ce moment, le site et l'application sont un monolithe si lourd qui se trouve et attend qu'il soit d√©j√† retir√© pour les microservices. <br><br>  Soit dit en passant, le Postgres mentionn√© se pr√©sente comme un goulot d'√©tranglement, nous allons donc changer quelque chose.  Nous utilisons activement des √©quilibreurs, car la charge sur les syst√®mes peut prendre des valeurs tr√®s diff√©rentes. <br><br>  Tout cela est commod√©ment situ√© sur les serveurs sous cette forme: <br>  16 serveurs d'applications avec PHP-FPM et Postgres, Postgres a 1 ma√Ætre et 4 esclaves.  Comme vous pouvez le voir, pas de v√©los.  L'ensemble du back-office est parfaitement int√©gr√© aux syst√®mes internes - WMS, entrep√¥t, logistique, comptabilit√© et marketing. <br><br>  Nous avons lanc√© l'application mobile et le site Web en 2017.  Aujourd'hui, la charge moyenne sur le syst√®me est d'environ 6 000 commandes par jour.  D'une part, ce n'est pas beaucoup, d'autre part, il vaut toujours la peine de consid√©rer que cela n'est pas r√©parti uniform√©ment pendant 24 heures, les gens ne commandent pas de nourriture 24h / 24, il y a aussi une jarreti√®re pour une activit√© standard pendant les heures de travail.  Les requ√™tes PHP elles-m√™mes (y compris l'API) sont environ 70 000 en 5 minutes. <br><br><h3>  Chemin de commande </h3><br>  D√®s que la commande est assembl√©e avec succ√®s √† l'entrep√¥t et pr√™te √† partir en voyage, elle est achemin√©e.  Nous avons maintenant commenc√© √† utiliser Yandex.Routing pour cela - un bon produit qui nous permet de construire rapidement l'itin√©raire optimal pour les conducteurs en tenant compte des situations de circulation - les embouteillages, la m√©t√©o, les sols, les barri√®res et autres joies.  Cela nous permet d'√©conomiser du carburant, afin que les coursiers ne coupent pas les cercles autour de la ville.  Le conducteur a un itin√©raire clair, une liste de l'ordre dans lequel les commandes doivent √™tre transport√©es, les commandes elles-m√™mes sont plac√©es dans la voiture de mani√®re √† √™tre livr√©es dans le m√™me ordre. <br><br><img src="https://habrastorage.org/webt/ad/lw/-n/adlw-nhq5gqszohajkwaymwqnsm.jpeg"><br><br>  Nous avons fait la demande de courriers pour Android, comme je l'ai d√©j√† √©crit, sur Kotlin.  C'est en cela que le routage est cousu, la possibilit√© de communiquer avec le client (nous cachons le num√©ro du client, le chauffeur n'a que le bouton "Appeler"), la possibilit√© de modifier la commande et de supprimer quelque chose, d'imprimer le ch√®que, et aussi de payer pour la commande. <br><br><img src="https://habrastorage.org/webt/xt/1f/aq/xt1faql6nzdxupzg_vz4pjmtvj8.png"><br><br>  S√©par√©ment, √† propos de la t√©l√©m√©trie: l'application prend tout en compte: le temps de trajet, l'heure d'arriv√©e au client et l'heure de d√©part, cela aide grandement √† construire beaucoup de rapports analytiques et √† suivre la logistique.  Par exemple, le coursier ne bouge pas pendant un certain temps, mais en g√©n√©ral il devrait - ils le contactent et sp√©cifient si tout va bien.  Le lien avec la logistique √† cet √©gard est tr√®s important, car il y a des situations o√π le courrier, par exemple, √† 15 heures devrait √™tre √† une adresse et √† 15 h 30 - √† une autre.  Mais √† la premi√®re adresse, il y avait un accroc d√ª au contr√¥le d'acc√®s dans la cour, une barri√®re ou une porte, j'ai d√ª passer 10 minutes suppl√©mentaires pour contacter le client, afin que le client contacte la s√©curit√© et ainsi de suite, vous savez comment cela se passe. <br><br><img src="https://habrastorage.org/webt/cb/jr/pv/cbjrpvltj1-mgahk1ww7dvvtevw.jpeg"><br><br>  Mais du point de vue du client √† 15h30 ce n'est jamais du tout son probl√®me, il attend la commande √† l'heure indiqu√©e.  Par cons√©quent, le chauffeur contacte les logisticiens, ils surveillent de pr√®s sp√©cifiquement sa t√©l√©m√©trie, et ils contactent eux-m√™mes le prochain client, sp√©cifiant l'intervalle de livraison en raison d'un accrochage sur la barri√®re.  Bien s√ªr, en tout cas, c'est triste quand le courrier est en retard.  Mais quand il est en retard et ne l'avertit pas - c'est encore pire. <br><br>  En g√©n√©ral, si c'est basique, c'est ainsi que nous travaillons.  Vous pouvez √™tre plus int√©ress√© √† en savoir plus sur le fonctionnement de l'entrep√¥t et du WMS, ou sur les applications pour les chauffeurs ou les employ√©s de l'entrep√¥t, ou sur le routage, alors √©crivez-en simplement dans les commentaires, et je ferai un article s√©par√©. <br><br>  Merci d'avoir lu. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484220/">https://habr.com/ru/post/fr484220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484208/index.html">Utilisation de l'apprentissage automatique dans l'analyse statique du code source du programme</a></li>
<li><a href="../fr484212/index.html">Des trucs gratuits pour le karma - l'histoire d'une startup bi√©lorusse qui change le principe de la consommation</a></li>
<li><a href="../fr484214/index.html">Tenseurs dans TensorFlow</a></li>
<li><a href="../fr484216/index.html">Deuxi√®me conf√©rence Zabbix en Russie: inscription et dates importantes</a></li>
<li><a href="../fr484218/index.html">Nous optimisons l'automatisation: comment nous avons acc√©l√©r√© les autotests de 3 √† 4 fois, en pr√©servant les anciens d√©veloppements</a></li>
<li><a href="../fr484222/index.html">Une tentative de r√©soudre le probl√®me du choix des billets avant les vacances</a></li>
<li><a href="../fr484224/index.html">Tri LSD au niveau du bit (Tri Radix)</a></li>
<li><a href="../fr484236/index.html">Fant√¥mes dans les nuages: d√©tails du piratage de nombreuses entreprises</a></li>
<li><a href="../fr484238/index.html">L'apprentissage automatique face √† un probl√®me math√©matique non r√©solu</a></li>
<li><a href="../fr484240/index.html">Devenez conf√©rencier aux Positive Hack Days 10. L'appel √† communications commence</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>