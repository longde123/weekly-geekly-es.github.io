<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☁️ 😧 🛠️ إزميل - (ليس تمامًا) نهجًا جديدًا لتطوير المنطق الرقمي 💓 👉 🧑🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مع تطور الإلكترونيات الدقيقة ، أصبحت تصميمات RTL أكثر فأكثر. إعادة استخدام كود فيريلوج هو الكثير من الإزعاج ، حتى مع توليد ، وحدات الماكرو ورقائق فيري...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>إزميل - (ليس تمامًا) نهجًا جديدًا لتطوير المنطق الرقمي</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419413/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ka/wc/b5/kawcb52amqtfs9chlivqku8sj-a.jpeg"></p><br><p style=";text-align:right;direction:rtl">  مع تطور الإلكترونيات الدقيقة ، أصبحت تصميمات RTL أكثر فأكثر.  إعادة استخدام كود فيريلوج هو الكثير من الإزعاج ، حتى مع توليد ، وحدات الماكرو ورقائق فيريلوج النظام.  ومع ذلك ، فإن إزميل يجعل من الممكن تطبيق القوة الكاملة للكائنات والبرمجة الوظيفية على تطوير rtl ، وهي خطوة طال انتظارها يمكن أن تملأ رئتي مطوري ASIC و FPGA بالهواء النقي. </p><br><p style=";text-align:right;direction:rtl">  ستقدم هذه المقالة نظرة عامة موجزة على الوظائف الرئيسية وستنظر في بعض حالات الاستخدام للمستخدم ، وسنتحدث أيضًا عن أوجه القصور في هذه اللغة.  في المستقبل ، إذا كان الموضوع مثيرًا للاهتمام ، فإننا نواصل المقالة في دروس أكثر تفصيلاً. </p><a name="habracut"></a><br><h3 id="sistemnye-trebovaniya" style=";text-align:right;direction:rtl">  متطلبات النظام </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  مستوى قاعدة سكالا </li><li style=";text-align:right;direction:rtl">  فيريلوج والمبادئ الأساسية لبناء التصاميم الرقمية. </li><li style=";text-align:right;direction:rtl">  حافظ على وثائق إزميل في متناول اليد </li></ul><br><p style=";text-align:right;direction:rtl">  سأحاول فهم أساسيات الإزميل باستخدام أمثلة بسيطة ، ولكن إذا كان هناك شيء غير واضح ، يمكنك إلقاء نظرة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . </p><br><p style=";text-align:right;direction:rtl">  أما بالنسبة إلى السكالا ، فقد تساعد <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ورقة الغش</a> هذه في الغوص السريع. </p><br><p style=";text-align:right;direction:rtl">  هناك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">واحد</a> مماثل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">للإزميل</a> . </p><br><p style=";text-align:right;direction:rtl">  يمكن العثور على كود المقالة الكامل (في شكل مشروع scala sbt) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . </p><br><h3 id="prostoy-schetchik" style=";text-align:right;direction:rtl">  عداد بسيط </h3><br><p style=";text-align:right;direction:rtl">  كما يوحي الاسم ، فإن إزميل "بناء الأجهزة في لغة سكالا المضمنة" هو عبارة عن لغة وصف للأجهزة مبنية على أعلى سكالا. </p><br><p style=";text-align:right;direction:rtl">  باختصار حول كيفية عمل كل شيء ، ثم: يتم إنشاء رسم بياني للأجهزة من وصف rtl على الإزميل ، والذي يتحول بدوره إلى وصف وسيط في لغة firrtl ، وبعد ذلك يتم إنشاء مترجم الخلفية المدمج من firrtl verilog. </p><br><p style=";text-align:right;direction:rtl">  دعونا نلقي نظرة على تطبيقين للعداد البسيط. </p><br><p style=";text-align:right;direction:rtl">  فيريلوج: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">module SimpleCounter #( parameter WIDTH = 8 )( input clk, input reset, input wire enable, output wire [WIDTH-1:0] out ); reg [WIDTH-1:0] counter; assign out = counter; always @(posedge clk) if (reset) begin counter &lt;= {(WIDTH){1'b0}}; end else if (enable) begin counter &lt;= counter + 1; end endmodule</code> </pre> <br><p style=";text-align:right;direction:rtl">  إزميل: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCounter</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enable = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> out = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) io.out &lt;&gt; counter when(io.enable) { counter := counter + <span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span> } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  قليلا عن الإزميل: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>Module</code> - حاوية لوصف وحدة RTL </li><li style=";text-align:right;direction:rtl">  <code>Bundle</code> هي بنية بيانات في الإزميل ، تستخدم بشكل أساسي لتحديد الواجهات. </li><li style=";text-align:right;direction:rtl">  <code>io</code> - متغير لتحديد المنافذ </li><li style=";text-align:right;direction:rtl">  <code>Bool</code> - نوع البيانات ، إشارة بسيطة أحادية البت </li><li style=";text-align:right;direction:rtl">  <code>UInt(width: Width)</code> - عدد صحيح بدون إشارة ، يقبل المنشئ عمق البت للإشارة كمدخل. </li><li style=";text-align:right;direction:rtl">  <code>RegInit[T &lt;: Data](init: T)</code> هو مُنشئ تسجيل ؛ يأخذ قيمة إعادة تعيين عند الإدخال وله نفس نوع البيانات. </li><li style=";text-align:right;direction:rtl">  <code>&lt;&gt;</code> - عامل توصيل إشارة عالمي </li><li style=";text-align:right;direction:rtl">  <code>when(cond: =&gt; Bool) { /*...*/ }</code> - التناظرية <code>if</code> في فيريلوج </li></ul><br><p style=";text-align:right;direction:rtl">  سنتحدث عن أي فيريلوج يولد إزميلًا بعد ذلك بقليل.  الآن فقط قارن بين هذين التصميمين.  كما ترى ، لا يوجد أي إشارة إلى إشارات <code>clk</code> وإعادة <code>reset</code> في الإزميل.  والحقيقة هي أن الإزميل يضيف هذه الإشارات إلى الوحدة بشكل افتراضي.  يتم <code>RegInit</code> قيمة إعادة تعيين تسجيل <code>counter</code> <code>RegInit</code> مُنشئ التسجيل مع إعادة تعيين <code>RegInit</code> .  يحتوي الإزميل على دعم الوحدات مع العديد من إشارات الساعة ، ولكن بعد ذلك بقليل. </p><br><h3 id="schetchik-chut-poslozhnee" style=";text-align:right;direction:rtl">  العداد أكثر تعقيدًا قليلاً </h3><br><p style=";text-align:right;direction:rtl">  دعنا نذهب إلى أبعد من ذلك وتعقد المهمة قليلاً ، على سبيل المثال - سنقوم بعمل عداد متعدد القنوات مع معلمة إدخال في شكل سلسلة من البتات لكل قناة. </p><br><p style=";text-align:right;direction:rtl">  لنبدأ الآن بإصدار الإزميل </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultiChannelCounter</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">] = </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">(32, 16, 8, 4</span></span></span><span class="hljs-class">)) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enable = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Vec</span></span>(width.length, <span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> out = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.sum.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOut</span></span></span></span>(i: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">UInt</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> right = width.dropRight(width.length - i).sum <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.out(right + width(i) - <span class="hljs-number"><span class="hljs-number">1</span></span>, right) } }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counters: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">SimpleCounter</span></span>] = width.map(x =&gt; <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SimpleCounter</span></span>(x)) ) io.out &lt;&gt; util.<span class="hljs-type"><span class="hljs-type">Cat</span></span>(counters.map(_.io.out)) width.indices.foreach { i =&gt; counters(i).io.enable &lt;&gt; io.enable(i) } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  قليلا عن سكالا: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>width: Seq[Int]</code> - معلمة الإدخال <code>MultiChannelCounter</code> فئة <code>MultiChannelCounter</code> ، لها النوع <code>Seq[Int]</code> - تسلسل بعناصر صحيحة. </li><li style=";text-align:right;direction:rtl">  <code>Seq</code> هو أحد أنواع المجموعات في سكالا مع تسلسل محدد للعناصر. </li><li style=";text-align:right;direction:rtl">  <code>.map</code> هي وظيفة مألوفة للمجموعات للجميع ، قادرة على تحويل مجموعة إلى أخرى بسبب نفس العملية على كل عنصر ، في حالتنا تتحول سلسلة من القيم الصحيحة إلى سلسلة من <code>SimpleCounter</code> مع عمق البت المقابل. </li></ul><br><p style=";text-align:right;direction:rtl">  قليلا عن الإزميل: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>Vec[T &lt;: Data](gen: T, n: Int): Vec[T]</code> - نوع بيانات الإزميل ، هو تناظري للصفيف. </li><li style=";text-align:right;direction:rtl">  <code>Module[T &lt;: BaseModule](bc: =&gt; T): T</code> هي طريقة الغلاف المطلوبة <code>Module[T &lt;: BaseModule](bc: =&gt; T): T</code> . </li><li style=";text-align:right;direction:rtl">  <code>util.Cat[T &lt;: Bits](r: Seq[T]): UInt</code> - دالة تسلسل ، تناظرية <code>{1'b1, 2'b01, 4'h0}</code> في <code>{1'b1, 2'b01, 4'h0}</code> </li></ul><br><p style=";text-align:right;direction:rtl">  انتبه للموانئ: <br>  <code>enable</code> - تم نشره بالفعل في <code>Vec[Bool]</code> * ، تقريبًا ، في مصفوفة من إشارات بت واحد ، واحدة لكل قناة ، كان من الممكن جعل <code>UInt(width.length.W)</code> . <br>  <code>out</code> - تم توسيعه ليصبح مجموع عرض كل قنواتنا. </p><br><p style=";text-align:right;direction:rtl">  <code>counters</code> المتغيرة هي مجموعة من عداداتنا.  نقوم بتوصيل إشارة <code>enable</code> لكل عداد بمنفذ الإدخال المقابل ، <code>util.Cat</code> جميع الإشارات الخارجية في واحدة باستخدام وظيفة <code>util.Cat</code> المضمنة. </p><br><p style=";text-align:right;direction:rtl">  نلاحظ أيضًا <code>getOut(i: Int)</code> - تقوم هذه الوظيفة بحساب وإرجاع نطاق البتات في إشارة <code>out</code> للقناة <code>i</code> .  سيكون مفيدًا جدًا في المزيد من العمل مع مثل هذا العداد.  تنفيذ شيء من هذا القبيل في فيريلوج لن ينجح </p><br><p style=";text-align:right;direction:rtl">  * لا ينبغي الخلط بين <code>Vec</code> <code>Vector</code> ، الأول هو مجموعة من البيانات في الإزميل ، والثاني هو مجموعة في سكالا. </p><br><p style=";text-align:right;direction:rtl">  دعونا نحاول الآن كتابة هذه الوحدة على verilog ، للراحة ، حتى على systemVerilog. </p><br><p style=";text-align:right;direction:rtl">  بعد الجلوس في التفكير ، جئت إلى هذا الخيار (على الأرجح أنه ليس الخيار الوحيد الحقيقي والأفضل ، ولكن يمكنك دائمًا اقتراح التنفيذ في التعليقات). </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">فيريلوج</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">module MultiChannelCounter #( parameter TOTAL = 4, parameter integer WIDTH_SEQ [TOTAL] = {32, 16, 8, 4} )(clk, reset, enable, out); localparam OUT_WIDTH = get_sum(TOTAL, WIDTH_SEQ); input clk; input reset; input wire [TOTAL - 1 : 0] enable; output wire [OUT_WIDTH - 1 :0] out; genvar j; generate for(j = 0; j &lt; TOTAL; j = j + 1) begin : counter_generation localparam OUT_INDEX = get_sum(j, WIDTH_SEQ); SimpleCounter #( WIDTH_SEQ[j] ) SimpleCounter_unit ( .clk(clk), .reset(reset), .enable(enable[j]), .out(out[OUT_INDEX + WIDTH_SEQ[j] - 1: OUT_INDEX]) ); end endgenerate function automatic integer get_sum; input integer array_width; input integer array [TOTAL]; integer counter = 0; integer i; begin for(i = 0; i &lt; array_width; i = i + 1) counter = counter + array[i]; get_sum = counter; end endfunction endmodule</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  يبدو بالفعل أكثر إثارة للإعجاب.  ولكن ماذا لو ذهبنا إلى أبعد من ذلك ونقرّب واجهة عظم الترقوة الشهيرة مع إمكانية الوصول إلى التسجيل. </p><br><h3 id="bundle-interfeysy" style=";text-align:right;direction:rtl">  واجهات حزمة </h3><br><p style=";text-align:right;direction:rtl">  Wishbone عبارة عن حافلة صغيرة مشابهة لـ AMBA APB ، تستخدم بشكل أساسي لأنوية IP مفتوحة المصدر. </p><br><p style=";text-align:right;direction:rtl">  مزيد من التفاصيل حول الويكي: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://ru.wikipedia.org/wiki/Wishbone</a> </p><br><p style=";text-align:right;direction:rtl">  لأن  يزودنا الإزميل بحاويات بيانات من نوع <code>Bundle</code> ، فمن المنطقي أن نلف الحافلة في حاوية يمكن استخدامها لاحقًا في أي مشاريع إزميل. </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneMasterSignals</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> addrWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, dataWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, gotTag: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = false</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> adr = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(addrWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dat_master = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(dataWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dat_slave = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(dataWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> stb = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> we = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cyc = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sel = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>((dataWidth / <span class="hljs-number"><span class="hljs-number">8</span></span>).<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ack_master = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ack_slave = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tag_master: <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">UInt</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(gotTag) <span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tag_slave: <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">UInt</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(gotTag) <span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wbTransaction</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = cyc &amp;&amp; stb <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wbWrite</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = wbTransaction &amp;&amp; we <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wbRead</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = wbTransaction &amp;&amp; !we <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneType</span></span></span></span>: wishboneMasterSignals.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMasterSignals(addrWidth, dataWidth, gotTag).asInstanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] }</code> </pre> <br><p style=";text-align:right;direction:rtl">  قليلا عن سكالا: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>Option</code> - مجمع بيانات اختياري في سكالا يمكن أن يكون إما عنصرًا أو <code>None</code> ، <code>Option[UInt]</code> إما <code>Some(UInt(/*...*/))</code> أو بلا ، مفيد عند تحديد معلمات الإشارات. </li></ul><br><p style=";text-align:right;direction:rtl">  يبدو أنه لا يوجد شيء غير عادي.  مجرد وصف للواجهة بواسطة المعالج ، باستثناء بعض الإشارات والأساليب: </p><br><p style=";text-align:right;direction:rtl">  <code>tag_master</code> و <code>tag_slave</code> هي <code>tag_slave</code> اختيارية للأغراض العامة في بروتوكول عظم الترقوة ، وسوف نراها إذا كانت معلمة <code>gotTag</code> <code>true</code> . </p><br><p style=";text-align:right;direction:rtl">  <code>wbTransaction</code> ، <code>wbWrite</code> ، <code>wbRead</code> - وظائف لتبسيط العمل مع الناقل. </p><br><p style=";text-align:right;direction:rtl">  <code>cloneType</code> - طريقة الاستنساخ من النوع المطلوب لجميع فئات المعلمات <code>[T &lt;: Bundle]</code> </p><br><p style=";text-align:right;direction:rtl">  لكننا نحتاج أيضًا إلى واجهة تابعة ، دعنا نرى كيف يمكن تنفيذها. </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneSlave</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> addrWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, dataWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, tagWidht: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 0</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb = <span class="hljs-type"><span class="hljs-type">Flipped</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMasterSignals(addrWidth , dataWidth, tagWidht)) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneType</span></span></span></span>: wishboneSlave.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneSlave(addrWidth, dataWidth, tagWidht).asInstanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] }</code> </pre> <br><p style=";text-align:right;direction:rtl">  إن الطريقة <code>Flipped</code> ، كما قد تخمن من الاسم ، تقلب الواجهة ، والآن تحولت واجهة المعالج إلى عبد ، نضيف نفس الفئة للمعالج. </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneMaster</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> addrWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, dataWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 32, tagWidht: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = 0</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMasterSignals(addrWidth , dataWidth, tagWidht) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneType</span></span></span></span>: wishboneMaster.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMaster(addrWidth, dataWidth, tagWidht).asInstanceOf[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>] }</code> </pre> <br><p style=";text-align:right;direction:rtl">  حسنًا ، هذا كل شيء ، الواجهة جاهزة.  ولكن قبل كتابة معالج ، دعنا نرى كيف يمكننا استخدام هذه الواجهات في حال احتجنا إلى التبديل أو شيء مع مجموعة كبيرة من واجهات عظم الترقوة. </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WishboneCrossbarIo</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">n: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, addrWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, dataWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> slaves = <span class="hljs-type"><span class="hljs-type">Vec</span></span>(n, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneSlave(addrWidth, dataWidth, <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> master = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneMaster(addrWidth, dataWidth, <span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WBCrossBar</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">WishboneCrossbarIo</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>)) io.master &lt;&gt; io.slaves(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  هذا فارغ صغير للمفتاح.  من الملائم الإعلان عن واجهة من النوع <code>Vec[wishboneSlave]</code> ، ويمكنك توصيل الواجهات بنفس عامل التشغيل <code>&lt;&gt;</code> .  رقائق إزميل مفيدة عندما يتعلق الأمر بإدارة مجموعة كبيرة من الإشارات. </p><br><h3 id="universalnyy-kontroller-shiny" style=";text-align:right;direction:rtl">  تحكم عالمي للحافلات </h3><br><p style=";text-align:right;direction:rtl">  كما ذكرنا سابقًا حول قوة البرمجة الوظيفية وبرمجة الكائن ، سنحاول تطبيقه.  علاوة على ذلك ، سنتحدث عن تنفيذ وحدة التحكم في ناقل الترقوة العالمي في شكل <code>trait</code> ، سيكون نوعًا من الخلط لأي وحدة نمطية مع ناقل <code>wishboneSlave</code> ، بالنسبة للوحدة التي تحتاجها فقط لتحديد بطاقة ذاكرة ومزج وحدة تحكم <code>trait</code> إليها أثناء التوليد. </p><br><h4 id="realizaciya" style=";text-align:right;direction:rtl">  التنفيذ </h4><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">بالنسبة لأولئك الذين لا يزالون متحمسين</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  دعنا ننتقل إلى تنفيذ المعالج.  سيكون الأمر بسيطًا ويستجيب على الفور للمعاملات الفردية ، في حالة الخروج من مجموعة العناوين ، يتم إرجاع صفر. </p><br><p style=";text-align:right;direction:rtl">  دعونا نحلل في أجزاء: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  يجب الرد على كل معاملة مع الإقرار </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io : wishboneSlave = <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb_ack = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) when(io.wb.wbTransaction) { wb_ack := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> }.otherwise { wb_ack := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } wb_ack &lt;&gt; io.wb.ack_slave</code> </pre> <br></li><li style=";text-align:right;direction:rtl">  نرد على القراءة بالبيانات <br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb_dat = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>(io.wb.dat_slave.getWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-comment"><span class="hljs-comment">// getWidth   when(io.wb.wbRead) { wb_dat := MuxCase(default = 0.U, Seq( (io.wb.addr === ADDR_1) -&gt; data_1, (io.wb.addr === ADDR_3) -&gt; data_2, (io.wb.addr === ADDR_3) -&gt; data_2 )) } wb_dat &lt;&gt; io.wb.dat_slave</span></span></code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>MuxCase[T &lt;: Data] (default: T, mapping: Seq[(Bool, T)]): T</code> هو مخطط التنسيق المدمج لنوع <code>case</code> في verilog *. </li></ul></li></ul><br><p style=";text-align:right;direction:rtl">  كيف سيبدو في فيريلوج: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> always @(posedge clock) if(reset) wb_dat_o &lt;= 0; else if(wb_read) case (wb_adr_i) `ADDR_1 : wb_dat_o &lt;= data_1; `ADDR_2 : wb_dat_o &lt;= data_2; `ADDR_3 : wb_dat_o &lt;= data_3; default : wb_dat_o &lt;= 0; endcase }</code> </pre> <br><p style=";text-align:right;direction:rtl">  * بشكل عام ، في هذه الحالة ، يعد هذا اختراقًا صغيرًا من أجل وضع المعايير ، في إزميل يوجد تصميم قياسي أفضل للاستخدام إذا كتبت شيئًا أبسط. </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs">switch(x) { is(value1) { <span class="hljs-comment"><span class="hljs-comment">// ... } is(value2) { // ... } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  حسنا ، السجل </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> when(io.wb.wbWrite) { data_4 := <span class="hljs-type"><span class="hljs-type">Mux</span></span>(io.wb.addr === <span class="hljs-type"><span class="hljs-type">ADDR_4</span></span>, io.wb.dat_master, data_4) }</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>Mux[T &lt;: Data](cond: Bool, con: T, alt: T): T</code> - معدد إرسال عادي </li></ul><br><p style=";text-align:right;direction:rtl">  قمنا بتضمين شيء مشابه لعدادنا متعدد القنوات ، وقمنا بتعليق التسجيلات لإدارة القنوات وقبعة.  ولكن هنا قريب من وحدة تحكم ناقل WB العالمي التي سننقل إليها بطاقة ذاكرة من هذا النوع: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">ADDR_1</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_1</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_2</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> writeMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">ADDR_1</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_1</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_2</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> )</code> </pre> <br><p style=";text-align:right;direction:rtl">  لمثل هذه المهمة ، ستساعدنا <code>trait</code> - شيء مثل mixins في Sala.  ستكون المهمة الرئيسية هي جعل <code>readMemMap: [Int, Data]</code> تبدو مثل <code>Seq( -&gt; )</code> ، وسيكون من الرائع أيضًا أن تتمكن من نقل العنوان الأساسي ومجموعة البيانات داخل بطاقة الذاكرة </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_2</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> )</code> </pre> <br><p style=";text-align:right;direction:rtl">  ما سيتم توسيعه إلى شيء مشابه ، حيث WB_DAT_WIDTH هو عرض البيانات بالبايت </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span> * (<span class="hljs-type"><span class="hljs-type">WB_DAT_WIDHT</span></span>)-&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ_0</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> * (<span class="hljs-type"><span class="hljs-type">WB_DAT_WIDHT</span></span>)-&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ_1</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> * (<span class="hljs-type"><span class="hljs-type">WB_DAT_WIDHT</span></span>)-&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ_2</span></span>, <span class="hljs-type"><span class="hljs-type">ADDR_1_BASE</span></span> + <span class="hljs-number"><span class="hljs-number">3</span></span> * (<span class="hljs-type"><span class="hljs-type">WB_DAT_WIDHT</span></span>)-&gt; <span class="hljs-type"><span class="hljs-type">DATA_SEQ_3</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> <span class="hljs-type"><span class="hljs-type">ADDR_2</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DATA_2</span></span> <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> )</code> </pre> <br><p style=";text-align:right;direction:rtl">  لتنفيذ ذلك ، نكتب دالة محول من <code>Map[Int, Any]</code> إلى <code>Seq[(Bool, UInt)]</code> .  عليك استخدام mathcing نمط سكالا. </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseMemMap</span></span></span></span>(memMap: <span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Any</span></span>]): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[(<span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>)] = memMap.flatMap { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(addr, data) =&gt; data <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a: <span class="hljs-type"><span class="hljs-type">UInt</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Seq</span></span>((io.wb.adr === addr.<span class="hljs-type"><span class="hljs-type">U</span></span>) -&gt; a) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">UInt</span></span>] =&gt; a.map(x =&gt; (io.wb.adr === (addr + io.wb.dat_slave.getWidth / <span class="hljs-number"><span class="hljs-number">8</span></span>).<span class="hljs-type"><span class="hljs-type">U</span></span>) -&gt; x) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">"WRONG MEM MAP!!!"</span></span>) } }.toSeq</code> </pre> <br><p style=";text-align:right;direction:rtl">  أخيرًا ، ستبدو سماتنا كما يلي: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneSlaveDriver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io : wishboneSlave <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap: <span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Any</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> writeMemMap: <span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Any</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parsedReadMap: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[(<span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>)] = parseMemMap(readMemMap) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parsedWriteMap: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[(<span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>)] = parseMemMap(writeMemMap) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb_ack = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wb_dat = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>(io.wb.dat_slave.getWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) when(io.wb.wbTransaction) { wb_ack := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> }.otherwise { wb_ack := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } when(io.wb.wbRead) { wb_dat := <span class="hljs-type"><span class="hljs-type">MuxCase</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> = <span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>, parsedReadMap) } when(io.wb.wbWrite) { parsedWriteMap.foreach { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(addrMatched, data) =&gt; data := <span class="hljs-type"><span class="hljs-type">Mux</span></span>(addrMatched, io.wb.dat_master, data) } } wb_dat &lt;&gt; io.wb.dat_slave wb_ack &lt;&gt; io.wb.ack_slave <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseMemMap</span></span></span></span>(memMap: <span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Any</span></span>]): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[(<span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>)] = { <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span>} }</code> </pre> <br><p style=";text-align:right;direction:rtl">  قليلا عن سكالا: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>io , readMemMap, writeMemMap</code> هي الحقول المجردة <code>io , readMemMap, writeMemMap</code> 'a ، والتي يجب تحديدها في الصف الذي سنقوم بخلطه فيه. </li></ul></div></div><br><h4 id="kak-im-polzovatsya" style=";text-align:right;direction:rtl">  كيفية استخدامه </h4><br><p style=";text-align:right;direction:rtl">  من أجل خلط <code>trait</code> مع الوحدة ، يجب استيفاء العديد من الشروط: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>io</code> يجب أن يرث من فئة <code>wishboneSlave</code> </li><li style=";text-align:right;direction:rtl">  بحاجة إلى إعلان اثنين من بطاقات الذاكرة <code>readMemMap</code> و <code>writeMemMap</code> </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WishboneMultiChannelCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">BASE</span></span> = <span class="hljs-number"><span class="hljs-number">0x11A00000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">OUT</span></span> = <span class="hljs-number"><span class="hljs-number">0x00000100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">S_EN</span></span> = <span class="hljs-number"><span class="hljs-number">0x00000200</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">H_EN</span></span> = <span class="hljs-number"><span class="hljs-number">0x00000300</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wbAddrWidth = <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wbDataWidth = <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wbTagWidth = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> width = <span class="hljs-type"><span class="hljs-type">Seq</span></span>(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishboneSlave(wbAddrWidth, wbDataWidth, wbTagWidth) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hardwareEnable: <span class="hljs-type"><span class="hljs-type">Vec</span></span>[<span class="hljs-type"><span class="hljs-type">Bool</span></span>] = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Vec</span></span>(width.length, <span class="hljs-type"><span class="hljs-type">Bool</span></span>())) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counter = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MultiChannelCounter</span></span>(width)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> softwareEnable = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>(width.length.<span class="hljs-type"><span class="hljs-type">W</span></span>)) width.indices.foreach(i =&gt; counter.io.enable(i) := io.hardwareEnable(i) &amp;&amp; softwareEnable(i)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> readMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">BASE</span></span> + <span class="hljs-type"><span class="hljs-type">OUT</span></span> -&gt; width.indices.map(counter.io.getOut), <span class="hljs-type"><span class="hljs-type">BASE</span></span> + <span class="hljs-type"><span class="hljs-type">S_EN</span></span> -&gt; softwareEnable, <span class="hljs-type"><span class="hljs-type">BASE</span></span> + <span class="hljs-type"><span class="hljs-type">H_EN</span></span> -&gt; io.hardwareEnable.asUInt ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> writeMemMap = <span class="hljs-type"><span class="hljs-type">Map</span></span>( <span class="hljs-type"><span class="hljs-type">BASE</span></span> + <span class="hljs-type"><span class="hljs-type">S_EN</span></span> -&gt; softwareEnable ) }</code> </pre> <br><p style=";text-align:right;direction:rtl">  نقوم بإنشاء سجل <code>softwareEnable</code> ، تتم إضافته إلى "و" بواسطة إشارة إدخال <code>hardwareEnable</code> ويذهب لتمكين <code>counter[MultiChannelCounter]</code> . </p><br><p style=";text-align:right;direction:rtl">  نعلن عن بطاقتي ذاكرة للقراءة والكتابة: <code>readMemMap</code> <code>writeMemMap</code> ، لمزيد من التفاصيل حول الهيكل ، انظر الفصل أعلاه. <br>  في بطاقة ذاكرة القراءة ، نقوم بنقل قيمة العداد لكل قناة * ، <code>softwareEnable</code> القابلة للتمكين <code>hardwareEnable</code> القابلة <code>hardwareEnable</code> .  وللسجل نعطي فقط تسجيل <code>softwareEnable</code> القابلة للتمكين. </p><br><p style=";text-align:right;direction:rtl">  * <code>width.indices.map(counter.io.getOut)</code> - تصميم غريب ، سنقوم بتحليله في أجزاء. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>width.indices</code> - سيعرض مصفوفة بمؤشرات العناصر ، أي  إذا كان <code>width.length == 4</code> ثم <code>width.indices = {0, 1, 2, 3}</code> </li><li style=";text-align:right;direction:rtl">  <code>{0, 1, 2, 3}.map(counter.io.getOut)</code> - تعطي شيئًا مثل هذا: <br> <code>{ counter.io.getOut(0), counter.io.getOut(1), /*...*/ }</code> </li> </ul><br><p style=";text-align:right;direction:rtl">  الآن بالنسبة لأي وحدة على إزميل ، يمكننا الإعلان عن بطاقات الذاكرة للقراءة والكتابة وتوصيل جهاز التحكم في ناقل الترقوة العالمي عند التوليد ، شيء من هذا القبيل: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishbone_multicahnnel_counter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WishboneMultiChannelCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wishboneSlaveDriver</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">countersDriver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(<span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-string"><span class="hljs-string">"-td"</span></span>, <span class="hljs-string"><span class="hljs-string">"./src/generated"</span></span>), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> wishbone_multicahnnel_counter ) }</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>wishboneSlaveDriver</code> - هذا هو بالضبط مزيج السمات الذي وصفناه تحت المفسد. </p><br><p style=";text-align:right;direction:rtl">  بالطبع ، هذه النسخة من وحدة التحكم العالمية بعيدة عن أن تكون نهائية ، لكنها بالأحرى خام على العكس.  هدفه الرئيسي هو إظهار أحد الأساليب الممكنة لتطوير rtl على الإزميل.  مع كل قدرات scala ، يمكن أن تكون هذه الأساليب أكبر بكثير ، لذلك كل مطور لديه مجاله الخاص للإبداع.  صحيح أنه لا يوجد مكان يمكن أن نستلهم منه بشكل خاص ، باستثناء: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  مكتبة أدوات الإزميل الأصلية ، والتي يمكن أن تبحث عنها في وراثة الوحدات والواجهات </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/freechipsproject/rocket-chip</a> - risc-v يتم تنفيذ النواة بالكامل على الإزميل ، بشرط أن تعرف السكالا جيدًا ، للمبتدئين الذين لا يملكون نصف لتر ، كما يقولون ، ستستغرق وقتًا طويلاً جدًا لفهمها.  لا توجد وثائق رسمية عن الهيكل الداخلي للمشروع. </li></ul><br><h3 id="multiclockdomain" style=";text-align:right;direction:rtl">  MultiClockDomain </h3><br><p style=";text-align:right;direction:rtl">  ماذا لو أردنا التحكم يدويًا في الساعة وإعادة ضبط الإشارات في الإزميل.  حتى وقت قريب ، لم يكن بالإمكان القيام بذلك ، ولكن مع أحد الإصدارات الأحدث ، <code>withClock {}</code> الدعم مع <code>withClock {}</code> ، مع <code>withReset {}</code> ومع <code>withClockAndReset {}</code> .  دعونا نلقي نظرة على مثال: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoubleClockModule</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clockB = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> in = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> out = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outB = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> regClock = <span class="hljs-type"><span class="hljs-type">RegNext</span></span>(io.in, <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) regClock &lt;&gt; io.out <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> regClockB = withClock(io.clockB) { <span class="hljs-type"><span class="hljs-type">RegNext</span></span>(io.in, <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) } regClockB &lt;&gt; io.outB }</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>regClock</code> - سجل سيتم تسجيله بواسطة إشارة <code>clock</code> القياسية وإعادة تعيينه بواسطة إعادة <code>regClock</code> القياسية </li><li style=";text-align:right;direction:rtl">  <code>regClockB</code> - تم تسجيل نفس التسجيل في الساعة ، حسب تخمينك ، بواسطة إشارة <code>io.clockB</code> ، ولكن سيتم استخدام إعادة <code>io.clockB</code> القياسية. </li></ul><br><p style=";text-align:right;direction:rtl">  إذا أردنا إزالة <code>clock</code> القياسية وإعادة <code>reset</code> الإشارات تمامًا ، فيمكننا استخدام الميزة التجريبية - <code>RawModule</code> (وحدة بدون ساعة قياسية وإشارات إعادة تعيين ، سيتعين التحكم في الجميع يدويًا).  مثال: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultiClockModule</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RawModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clockA = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clockB = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resetA = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resetB = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> in = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outA = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outB = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> regClockA = withClockAndReset(io.clockA, io.resetA) { <span class="hljs-type"><span class="hljs-type">RegNext</span></span>(io.in, <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) } regClockA &lt;&gt; io.outA <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> regClockB = withClockAndReset (io.clockB, io.resetB) { <span class="hljs-type"><span class="hljs-type">RegNext</span></span>(io.in, <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) } regClockB &lt;&gt; io.outB }</code> </pre> <br><h3 id="utils-biblioteka" style=";text-align:right;direction:rtl">  مكتبة Utils </h3><br><p style=";text-align:right;direction:rtl">  لا تنتهي المكافآت الممتعة للإزميل عند هذا الحد.  عمل منشئوها بجد وكتبوا مكتبة صغيرة ولكنها مفيدة جدًا من الواجهات والوحدات والوظائف الصغيرة.  من الغريب أنه لا يوجد وصف للمكتبة على الويكي ، ولكن يمكنك رؤية رابط ورقة الغش الذي في البداية (هناك قسمان أخيران) </p><br><p style=";text-align:right;direction:rtl">  الواجهات: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>DecoupledIO</code> هو واجهة جاهزة / صالحة تستخدم بشكل شائع. <br>  <code>DecoupledIO(UInt(32.W))</code> - سيحتوي على إشارات: <br> <code>val ready = Input(Bool())</code> <br> <code>val valid = Output(Bool())</code> <br> <code>val data = Output(UInt(32.W))</code> </li> <li style=";text-align:right;direction:rtl">  <code>ValidIO</code> - مثل <code>ValidIO</code> فقط بدون <code>ready</code> </li></ul><br><p style=";text-align:right;direction:rtl">  الوحدات: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>Queue</code> - تعد وحدة FIFO المتزامنة أمرًا مفيدًا للغاية ، حيث تبدو الواجهة <br>  <code>val enq: DecoupledIO[T]</code> - <code>DecoupledIO</code> مقلوب <br>  <code>val deq: DecoupledIO[T]</code> - <code>DecoupledIO</code> العادية <br>  <code>val count: UInt</code> - مقدار البيانات في قائمة الانتظار </li><li style=";text-align:right;direction:rtl">  وحدة تأخر <code>Pipe</code> - تدرج العدد التاسع من شرائح التسجيل </li><li style=";text-align:right;direction:rtl">  <code>Arbiter</code> - حكم على واجهات <code>DecoupledIO</code> ، لديها العديد من الأنواع الفرعية تختلف في نوع التحكيم <br>  <code>val in: Vec[DecoupledIO[T]]</code> - مجموعة من واجهات الإدخال <br> <code>val out: DecoupledIO[T]</code> <br>  <code>val chosen: UInt</code> - يعرض القناة المختارة </li></ul><br><p style=";text-align:right;direction:rtl">  بقدر ما يمكنك أن تفهم من المناقشة على github - في الخطط العالمية هناك امتداد كبير لهذه المكتبة من الوحدات: مثل FIFO غير المتزامن ، LSFSR ، مقسمات التردد ، قوالب PLL لـ FPGA ؛  واجهات مختلفة ؛  تحكم لهم وأكثر من ذلك بكثير. </p><br><h3 id="chisel-io-teseters" style=";text-align:right;direction:rtl">  إزميل io-teseters </h3><br><p style=";text-align:right;direction:rtl">  يجب ذكر إمكانية الاختبار في الإزميل ، في الوقت الحالي هناك طريقتان لاختبار هذا: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>peekPokeTesters</code> - اختبارات محاكاة بحتة تختبر منطق تصميمك </li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <code>hardwareIOTeseters</code> بالفعل أكثر إثارة للاهتمام منذ ذلك الحين  مع هذا النهج ، ستحصل على مقعد ثابت تم إنشاؤه مع الاختبارات التي كتبتها على الإزميل ، وحتى إذا كان لديك آلة لف ، فسوف تحصل حتى على جدول زمني. </p><br><p style=";text-align:right;direction:rtl">  ولكن حتى الآن ، لم يتم الانتهاء من نهج الاختبار ، ولا تزال المناقشة مستمرة.  في المستقبل ، على الأرجح ستظهر أداة عالمية ، للاختبار والاختبارات سيكون من الممكن أيضًا الكتابة على الإزميل.  ولكن في الوقت الحالي ، يمكنك إلقاء نظرة على ما هو موجود بالفعل وكيفية <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">استخدامه هنا</a> . </p><br></li></ul><br><h3 id="nedostatki-chisel" style=";text-align:right;direction:rtl">  مساوئ الإزميل </h3><br><p style=";text-align:right;direction:rtl">  هذا لا يعني أن الإزميل أداة عالمية ، وأنه يجب على الجميع التبديل إليه.  ربما ، مثل ، جميع المشاريع في مرحلة التطوير ، لها عيوبها ، والتي تجدر الإشارة إليها من أجل الاكتمال. </p><br><p style=";text-align:right;direction:rtl">  العيب الأول وربما الأهم هو عدم وجود تدفق غير متزامن.  ثقيل بما فيه الكفاية ، ولكن يمكن حلها بعدة طرق ، وأحدها هي النصوص البرمجية في الجزء العلوي من verilog ، والتي تحول إعادة الضبط المتزامن إلى غير متزامن.  هذا من السهل القيام به لأنه  جميع الإنشاءات في verilog المتولدة <code>always</code> موحدة تمامًا. </p><br><p style=";text-align:right;direction:rtl">  العيب الثاني ، وفقا للكثيرين ، هو عدم قراءة فيريلوج المولد ، ونتيجة لذلك ، مضاعفات التصحيح.  ولكن دعنا نلقي نظرة على الرمز الذي تم إنشاؤه من المثال باستخدام عداد بسيط </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ولدت فيريلوج</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">`ifdef RANDOMIZE_GARBAGE_ASSIGN `define RANDOMIZE `endif `ifdef RANDOMIZE_INVALID_ASSIGN `define RANDOMIZE `endif `ifdef RANDOMIZE_REG_INIT `define RANDOMIZE `endif `ifdef RANDOMIZE_MEM_INIT `define RANDOMIZE `endif module SimpleCounter( input clock, input reset, input io_enable, output [7:0] io_out ); reg [7:0] counter; reg [31:0] _RAND_0; wire [8:0] _T_7; wire [7:0] _T_8; wire [7:0] _GEN_0; assign _T_7 = counter + 8'h1; assign _T_8 = _T_7[7:0]; assign _GEN_0 = io_enable ? _T_8 : counter; assign io_out = counter; `ifdef RANDOMIZE integer initvar; initial begin `ifndef verilator #0.002 begin end `endif `ifdef RANDOMIZE_REG_INIT _RAND_0 = {1{$random}}; counter = _RAND_0[7:0]; `endif // RANDOMIZE_REG_INIT end `endif // RANDOMIZE always @(posedge clock) begin if (reset) begin counter &lt;= 8'h0; end else begin if (io_enable) begin counter &lt;= _T_8; end end end endmodule</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  للوهلة الأولى ، يمكن لـ verilog الناتج أن يبتعد ، حتى في تصميم متوسط ​​الحجم ، ولكن دعونا نلقي نظرة. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تعرف RANDOMIZE - (قد تكون مفيدة عند الاختبار باستخدام أجهزة اختبار الإزميل) - بشكل عام عديمة الفائدة ، لكنها لا تتدخل بشكل خاص </li><li style=";text-align:right;direction:rtl">  كما نرى اسم موانئنا ، والسجل محفوظ </li><li style=";text-align:right;direction:rtl">  _GEN_0 هو متغير عديم الفائدة بالنسبة لنا ، ولكنه ضروري لكي يقوم firrtl للمترجم بإنشاء verilog.  نحن أيضا لا ننتبه إليها. </li><li style=";text-align:right;direction:rtl">  لا يزال هناك _T_7 و _T_8 ، سيتم تقديم كل المنطق التوافقي في فيريلوج الذي تم إنشاؤه خطوة بخطوة في شكل المتغيرات _T. </li></ul><br><p style=";text-align:right;direction:rtl">  الأهم من ذلك أن جميع المنافذ والسجلات والأسلاك اللازمة لتصحيح الأخطاء تحافظ على أسمائها من الإزميل.  وإذا لم تنظر فقط إلى verilog ولكن أيضًا إلى الإزميل ، فسرعان ما ستسير عملية تصحيح الأخطاء كما هو الحال مع verilog النقي. </p><br><h3 id="zaklyuchenie" style=";text-align:right;direction:rtl">  الخلاصة </h3><br><p style=";text-align:right;direction:rtl">  في الحقائق الحديثة ، تطور تطوير RTL ، سواء كان أسيكيًا أو fpga خارج البيئة الأكاديمية ، لفترة طويلة من استخدام رمز فيريلوج خالص مكتوب بخط اليد فقط إلى نوع أو نوع آخر من نص الجيل ، سواء كان نصًا صغيرًا من tcl أو IDE كاملًا مع مجموعة من الميزات. </p><br><p style=";text-align:right;direction:rtl">  الإزميل ، بدوره ، هو التطور المنطقي للغات لتطوير واختبار المنطق الرقمي.  افترض أنه في هذه المرحلة هو بعيد عن الكمال ، ولكنه قادر بالفعل على توفير الفرص التي يمكنك من خلالها تحمل عيوبه.      ,                   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar419413/">https://habr.com/ru/post/ar419413/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar419401/index.html">واجهات سطر أوامر Java: picocli</a></li>
<li><a href="../ar419405/index.html">كيف تسير الأمور مع IPv6 ، أو ما يعوق الانتقال إلى نسخة جديدة من البروتوكول - ناقش الموقف</a></li>
<li><a href="../ar419407/index.html">تحليل مفصل لمباراة Dota 2 بين OpenAI والأشخاص بتنسيق 5x5. خسر الناس</a></li>
<li><a href="../ar419409/index.html">NUCs الجديدة من Intel تعتمد على معالجات Lake Lake</a></li>
<li><a href="../ar419411/index.html">عن الحريق في ناطحة سحاب. السينما والواقع</a></li>
<li><a href="../ar419415/index.html">ماترموست وبورشيل - قوة هائلة ، أو أتمتة صغيرة في المنزل</a></li>
<li><a href="../ar419417/index.html">اللائحة العامة لحماية البيانات: رسم خرائط البيانات أو كيفية عثور العملاء على أجهزة الكمبيوتر المحمولة المنسية منذ فترة طويلة</a></li>
<li><a href="../ar419419/index.html">الاختبارات التلقائية لواجهة المستخدم: كيف لا تفعل ذلك</a></li>
<li><a href="../ar419423/index.html">لقد وعدنا بالفيديو في الوقت الحقيقي بدون أفاريز وتشنجات</a></li>
<li><a href="../ar419425/index.html">أسبوع الأمن 29. قرصنة Reddit ، وهي محفظة للعملات المشفرة وأجهزة التوجيه MikroTik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>