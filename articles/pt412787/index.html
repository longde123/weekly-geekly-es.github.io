<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüë©‚Äçüëß‚Äçüë¶ ü§ê üíÜüèº Incorporando o Git em um sistema de desenvolvimento corporativo üòú üõ§Ô∏è üôãüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os desenvolvedores que sabem e sabem como trabalhar com o git cresceram em uma ordem de magnitude recentemente. Voc√™ se acostuma com a velocidade de e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Incorporando o Git em um sistema de desenvolvimento corporativo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412787/"><p><img src="https://habrastorage.org/webt/vt/fp/ou/vtfpoukjlruesmucbjvwrgshncc.jpeg"></p><br><p>  Os desenvolvedores que sabem e sabem como trabalhar com o git cresceram em uma ordem de magnitude recentemente.  Voc√™ se acostuma com a velocidade de execu√ß√£o dos comandos.  Voc√™ se acostuma com a conveni√™ncia das ramifica√ß√µes e com a revers√£o f√°cil das altera√ß√µes.  A resolu√ß√£o de conflitos √© t√£o comum que os programadores est√£o acostumados a resolver heroicamente conflitos onde n√£o deveriam estar. </p><br><p> Nossa equipe da Directum est√° desenvolvendo uma ferramenta de desenvolvimento para solu√ß√µes de plataforma.  Se voc√™ viu o 1C, pode imaginar o ambiente de trabalho de nossos "clientes" - desenvolvedores de aplicativos.  Usando essa ferramenta de desenvolvimento, um desenvolvedor de aplicativos cria uma solu√ß√£o de aplicativos para os clientes. </p><br><p>  Nossa equipe enfrentou a tarefa de simplificar a vida de nossos candidatos.  Somos mimados com chips modernos do Visual Studio, ReSharper e IDEA.  Os candidatos exigiram que integ√°ssemos o git fora da caixa na ferramenta. </p><a name="habracut"></a><br><p>  Essa √© a dificuldade.  Na ferramenta para cada tipo de entidade (contrato, relat√≥rio, diret√≥rio, m√≥dulo), um bloqueio pode estar presente.  Um desenvolvedor come√ßou a editar o tipo de entidade e o bloqueou at√© concluir as altera√ß√µes e as comprometeu com o servidor.  Outros desenvolvedores no momento veem o mesmo tipo de entidade somente leitura.  O desenvolvimento lembrava trabalhar no SVN ou enviar um documento do Word por correio entre v√°rios usu√°rios.  Quero tudo de uma vez, mas talvez apenas um. </p><br><p>  Cada tipo de entidade pode ter muitos manipuladores (abrir um documento, validar antes de salvar, gravar no banco de dados), no qual voc√™ deseja escrever um c√≥digo que funcione com uma inst√¢ncia espec√≠fica da entidade.  Por exemplo, bloqueie os bot√µes, exiba uma mensagem para o usu√°rio ou crie uma nova tarefa para os artistas.  Todo o c√≥digo dentro da estrutura da API fornecida pela plataforma.  Manipuladores s√£o classes nas quais existem muitos m√©todos.  Quando duas pessoas precisaram corrigir o mesmo arquivo com o c√≥digo, n√£o foi poss√≠vel fazer isso, porque a plataforma bloqueou todo o tipo de entidade junto com o c√≥digo dependente. </p><br><p>  Nossos praticantes percorreram todo o caminho.  Eles silenciosamente se compraram uma c√≥pia "ilegal" do nosso ambiente de desenvolvimento, comentaram a parte de bloqueio e fundiram nossos compromissos para si mesmos.  O c√≥digo do aplicativo foi mantido sob o git, confirmado por meio de ferramentas de terceiros (git bash, SourceTree e outros).  Tiramos nossas conclus√µes: </p><br><ol><li>  Nossa equipe subestimou a disposi√ß√£o dos desenvolvedores de aplicativos de se ajustarem √† plataforma.  Enorme respeito e honra! </li><li>  A solu√ß√£o que eles propuseram n√£o √© adequada para produ√ß√£o.  Com o git, as m√£os de uma pessoa est√£o desatadas e ele √© capaz de criar qualquer coisa.  Para apoiar toda a diversidade ser√° est√∫pido, n√£o sequestrar.  Al√©m disso, ser√° necess√°rio educar os clientes da plataforma.  Documentar todos os comandos git da plataforma deixaria a equipe de documenta√ß√£o louca. </li></ol><br><p><img src="https://habrastorage.org/webt/2o/o9/ik/2oo9ikx4h9ctyrdh86yktmh-waa.jpeg"></p><br><h1 id="chego-hochetsya-ot-git">  O que voc√™ quer do Git </h1><br><p>  Portanto, distribuir para produ√ß√£o com git out n√£o √© bom.  Decidimos, de alguma forma, encapsular a l√≥gica das opera√ß√µes principais e limitar seu n√∫mero.  Pelo menos para o primeiro lan√ßamento.  A lista de equipes foi reduzida quanto poss√≠vel e permaneceu: </p><br><ul><li>  status </li><li>  comprometer </li><li>  puxar </li><li>  empurrar </li><li>  reset --hard para HEAD </li><li>  redefinir para a √∫ltima confirma√ß√£o "servidor" </li></ul><br><p>  Para o primeiro lan√ßamento, eles decidiram se recusar a trabalhar com ramifica√ß√µes.  N√£o que isso seja muito dif√≠cil, apenas a equipe n√£o encontrou o recurso de tempo. </p><br><p>  Periodicamente, nossos parceiros enviam o desenvolvimento de aplicativos e perguntam: "Algo n√£o funciona para n√≥s. O que estamos fazendo de errado?".  Nesse caso, o aplicativo se carrega com o desenvolvimento de outra pessoa e analisa o c√≥digo.  Isso costumava funcionar assim: </p><br><ol><li>  O desenvolvedor levou o arquivo com o desenvolvimento; </li><li>  Mudou o banco de dados local nas configura√ß√µes; </li><li>  Despejou o desenvolvimento de outra pessoa em sua base; </li><li>  Depurado, encontrado erros; </li><li>  Recomenda√ß√µes emitidas; </li><li>  Ele retornou seu desenvolvimento de volta. </li></ol><br><p>  A nova metodologia n√£o se encaixava na abordagem antiga.  Eu tive que esmagar minha cabe√ßa.  A equipe prop√¥s duas abordagens para resolver esse problema: </p><br><ol><li>  Armazene todo o desenvolvimento em um reposit√≥rio git.  Se necess√°rio, trabalhe com a decis√£o de outra pessoa de criar uma ramifica√ß√£o tempor√°ria. </li><li>  Armazene o desenvolvimento de diferentes equipes em diferentes reposit√≥rios.  Mova as configura√ß√µes das pastas carregadas no ambiente para o arquivo de configura√ß√£o. </li></ol><br><p>  Decidimos seguir o segundo caminho.  O primeiro parecia mais dif√≠cil de implementar e, al√©m disso, era mais f√°cil dar um tiro no p√© com a troca de ramifica√ß√£o. </p><br><p>  Mas o segundo tamb√©m n√£o √© doce.  Os comandos descritos acima devem funcionar n√£o apenas no mesmo reposit√≥rio, mas com v√°rios de uma vez.  H√° uma altera√ß√£o nos tipos de entidade de diferentes reposit√≥rios?  N√≥s mostramos em uma janela.  Isso √© mais conveniente e transparente para o desenvolvedor de aplicativos.  Pressionando o bot√£o de confirma√ß√£o, a ferramenta confirma altera√ß√µes em cada um dos reposit√≥rios.  Por conseguinte, os comandos pull / push / reset "under the hood" funcionam com reposit√≥rios fisicamente diferentes. </p><br><p><img src="https://habrastorage.org/webt/cj/jx/hc/cjjxhctyhbggbu0zuy2-tfw1zhs.jpeg"></p><br><h1 id="libgit2sharp">  Libgit2sharp </h1><br><p>  Para trabalhar com o git, escolhemos entre duas op√ß√µes: </p><br><ol><li>  Trabalhe com o git instalado no sistema, puxando-o pelo Process.Start e analisando a sa√≠da. </li><li>  Use libgit2sharp, que via pinvoke puxa a biblioteca libgit2. </li></ol><br><p>  Pareceu-nos que usar uma biblioteca pronta √© uma solu√ß√£o razo√°vel.  Em v√£o.  Eu vou te contar um pouco mais tarde porque.  No in√≠cio, a biblioteca nos deu a oportunidade de lan√ßar rapidamente um prot√≥tipo funcional. </p><br><h1 id="pervaya-iteraciya-razrabotki">  Primeira itera√ß√£o de desenvolvimento </h1><br><p> Foi poss√≠vel implementar em cerca de um m√™s.  Na verdade, estragar o git foi r√°pido, e na maioria das vezes tentamos curar as feridas que foram abertas devido ao corte do antigo mecanismo de armazenamento de arquivos de origem.  Tudo o que o <code>git status</code> retornou foi retornado √† interface.  Clicar em cada arquivo exibe diff.  Parecia uma interface git gui. </p><br><h1 id="vtoraya-iteraciya-razrabotki">  Segunda itera√ß√£o de desenvolvimento </h1><br><p>  A primeira op√ß√£o foi excessivamente informativa.  Com cada tipo de entidade, muitos arquivos s√£o associados ao mesmo tempo.  Esses arquivos criaram ru√≠do e ficou claro que tipos de entidades foram alteradas e o que exatamente. </p><br><p>  Arquivos agrupados por tipo de entidade.  Cada arquivo recebeu um nome leg√≠vel por humanos, o mesmo da GUI.  Os metadados do tipo de entidade s√£o descritos em JSON.  Eles tamb√©m precisavam ser apresentados em um formato leg√≠vel por humanos.  A an√°lise das altera√ß√µes nas vers√µes json "antes" e "depois" foi iniciada usando a biblioteca jsondiffpatch e, em seguida, eles escreveram sua pr√≥pria implementa√ß√£o da compara√ß√£o JSON (a seguir chamarei jsondiff).  Executamos os resultados da compara√ß√£o atrav√©s de analisadores que produzem registros leg√≠veis por humanos.  Muitos arquivos foram ocultados, deixando uma entrada simples na √°rvore de altera√ß√µes. </p><br><p>  O resultado final √© o seguinte: </p><br><p><img src="https://habrastorage.org/webt/g7/pl/3k/g7pl3ku4bqatgba2u9t6_msyxlc.png"></p><br><h1 id="voznikshie-slozhnosti-s-libgit2">  Tendo problemas com a libgit2 </h1><br><p>  O Libgit2 gerou um grande n√∫mero de surpresas inesperadas.  Lidar com alguns estava al√©m do poder de um tempo razo√°vel.  Vou lhe contar o que me lembro. </p><br><p>  Inesperado e dif√≠cil de reproduzir cai em algumas opera√ß√µes padr√£o.  "Nenhum erro fornecido pela biblioteca nativa" nos diz o wrapper.  √ìtimo.  Voc√™ est√° xingando, est√° reconstruindo a biblioteca nativa na depura√ß√£o, est√° repetindo um caso descartado anteriormente, mas n√£o falha no modo de depura√ß√£o.  Reconstrua na vers√£o e caia novamente. </p><br><p>  Se uma ferramenta de terceiros, por exemplo, SourceTree, estiver sendo executada em paralelo com a libgit2sharp, a confirma√ß√£o poder√° n√£o confirmar alguns arquivos.  Ou congela ao exibir diferen√ßas em alguns arquivos.  Assim que voc√™ tenta depurar, voc√™ n√£o pode se reproduzir. </p><br><p>  Em uma de nossas aplica√ß√µes, a implementa√ß√£o do anal√≥gico de <code>git status</code> levou 40 segundos.  Quarenta Carl!  Ao mesmo tempo, o git lan√ßado a partir do console funcionou como deveria por um segundo.  Passei alguns dias para resolver o problema.  Ao procurar por mudan√ßas, o Libgit2 analisa os atributos de arquivo das pastas e os compara com a entrada no √≠ndice.  Se a hora da modifica√ß√£o for diferente, algo mudou dentro da pasta e voc√™ precisar√° procurar dentro e / ou procurar nos arquivos.  E se nada mudou, voc√™ n√£o deve subir l√° dentro.  Aparentemente, essa otimiza√ß√£o tamb√©m est√° no console git.  N√£o sei por que motivo, mas apenas uma pessoa no √≠ndice git mtime mudou.  Por causa disso, o git sempre verificava o conte√∫do de TODOS os arquivos no reposit√≥rio quanto a altera√ß√µes. </p><br><p>  Mais perto do lan√ßamento, nossa equipe cedeu aos desejos da equipe de aplicativos e substituiu o <code>git pull</code> por <code>fetch + rebase + autostash</code> .  E ent√£o v√°rios bugs vieram at√© n√≥s, incluindo "Nenhum erro fornecido pela biblioteca nativa". </p><br><p>  status, pull e rebase funcionam muito mais tempo do que chamar comandos do console. </p><br><h1 id="avtomaticheskiy-merzh">  Mesclagem autom√°tica </h1><br><p>  Os arquivos em desenvolvimento s√£o divididos em dois tipos: </p><br><ol><li>  Arquivos que o aplicativo v√™ na ferramenta de desenvolvimento.  Por exemplo, c√≥digo, imagens, recursos.  Esses arquivos precisam ser mesclados como o git. </li><li>  Arquivos JSON criados pelo ambiente de desenvolvimento, mas o desenvolvedor do aplicativo os v√™ apenas na forma de uma GUI.  Eles precisam resolver automaticamente conflitos. </li><li>  Arquivos gerados que s√£o recriados automaticamente ao trabalhar com a ferramenta de desenvolvimento.  Esses arquivos n√£o entram no reposit√≥rio, a ferramenta imediatamente coloca cuidadosamente .gitignore. </li></ol><br><p>  Com uma nova maneira, dois aplicadores diferentes foram capazes de alterar o mesmo tipo de entidade. </p><br><p>  Por exemplo, Sasha alterar√° as informa√ß√µes sobre como armazenar o tipo de uma entidade no banco de dados e gravar√° um manipulador para o evento save, e Sergey estilizar√° a representa√ß√£o da entidade.  Do ponto de vista do git, isso n√£o ser√° um conflito e as duas altera√ß√µes ser√£o mescladas sem complexidade. </p><br><p>  E ent√£o Sasha alterou a propriedade Property1 e definiu um manipulador para ela.  Sergey criou a propriedade Property2 e definiu o manipulador.  Se voc√™ observar a situa√ß√£o de cima, suas altera√ß√µes n√£o entrar√£o em conflito, embora do ponto de vista do git os mesmos arquivos sejam afetados. <br>  Eu queria que o instrumento fosse capaz de resolver essa situa√ß√£o por conta pr√≥pria. </p><br><p>  Um exemplo de algoritmo para mesclar dois JSON em caso de conflito: </p><br><ol><li><p>  Fa√ßa o download do JSON base git. </p><br></li><li><p>  Fa√ßa o download do nosso JSON gita. </p><br></li><li><p>  Baixando o JSON deles de um git. </p><br></li><li><p>  Utilizando o jsondiff, formamos patches de software base e aplicamos aos deles.  O JSON resultante √© chamado P1. </p><br></li><li><p>  Usando jsondiff, formamos patches de software b√°sicos e aplicamos aos nossos.  O JSON resultante √© chamado P2. </p><br></li><li><p>  Idealmente, ap√≥s a aplica√ß√£o dos adesivos P1 === P2.  Nesse caso, escreva P1 no disco. </p><br></li><li>  No caso imperfeito (quando o conflito foi realmente encontrado), sugerimos que o usu√°rio escolha entre P1 e P2 com a capacidade de terminar manualmente.  N√≥s escrevemos a sele√ß√£o no disco. </li></ol><br><p>  Ap√≥s a mesclagem, verificamos se o estado sem erros de valida√ß√£o chegou.  Se voc√™ n√£o chegou, cancele a mesclagem e pe√ßa ao usu√°rio para repeti-la.  Esta n√£o √© a melhor solu√ß√£o, mas pelo menos garante que a partir da segunda ou terceira tentativa, a fus√£o ocorrer√° sem consequ√™ncias desagrad√°veis. </p><br><h1 id="itogi">  Sum√°rio </h1><br><ol><li>  Os a√ßougueiros est√£o felizes por poderem usar legalmente. </li><li>  A introdu√ß√£o do desenvolvimento acelerado do git. </li><li>  Fus√µes autom√°ticas geralmente parecem m√°gicas. </li><li>  Colocamos a rejei√ß√£o futura da libgit2 em favor da invoca√ß√£o do processo git. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt412787/">https://habr.com/ru/post/pt412787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../In146151/index.html">‡§è‡§ú‡§æ‡§á‡§≤ ‡§°‡§æ‡§á‡§µ ‡§°‡•á‡§™‡•ç‡§•: ‡§è‡§ú‡§æ‡§á‡§≤ ‡§á‡§µ‡•à‡§≤‡•ç‡§Ø‡•Ç‡§è‡§∂‡§® ‡§´‡•ç‡§∞‡•á‡§Æ‡§µ‡§∞‡•ç‡§ï</a></li>
<li><a href="../In146152/index.html">‡§ü‡•à‡§≤‡•á‡§Ç‡§ü ‡§Æ‡•à‡§™ ‡§∞‡§ø‡§ú‡•ç‡§Ø‡•Ç‡§Æ‡•á ‡§µ‡§ø‡§ú‡§º‡•Å‡§Ö‡§≤‡§æ‡§á‡§ú‡§º‡§∞ - ‡§∞‡§ø‡§≤‡•Ä‡§ú‡§º ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§∞‡§æ‡§∏‡•ç‡§§‡•á ‡§™‡§∞ ‡§è‡§°‡§µ‡•á‡§Ç‡§ö‡§∞‡•ç‡§∏</a></li>
<li><a href="../pt412781/index.html">F√£ do NES tornou poss√≠vel o lan√ßamento de jogos SNES no console</a></li>
<li><a href="../pt412783/index.html">Instalando o proxy MTProto Telegram da origem no Centos 7</a></li>
<li><a href="../pt412785/index.html">Mestre em Gest√£o e Freelancer. A hist√≥ria em tr√™s partes</a></li>
<li><a href="../pt412789/index.html">‚ÄúAjuda no trabalho‚Äù: como tornar os bots de bate-papo mais inteligentes</a></li>
<li><a href="../pt412791/index.html">Melhorando o desempenho do sistema de videovigil√¢ncia e prevenindo falhas</a></li>
<li><a href="../pt412793/index.html">MassTransit, Saga e RabbitMQ para implementar um gerenciador de processos</a></li>
<li><a href="../pt412795/index.html">E vamos tirar conclus√µes da discuss√£o do artigo "O que h√° de errado com o retorno dos Geektimes a Habr"</a></li>
<li><a href="../pt412797/index.html">Sobre os perigos da CDN, servi√ßos e fontes do Google</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>