<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💄 ⚠️ 🤹🏿 Unity3d的可视逻辑编辑器。 第一部分 ♏️ 😮 👁️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="引言 
 尊敬的读者您好，在今天的文章中，我想谈谈在Unity3d上开发应用程序时出现的一种现象， 即可视化开发，或更准确地说，是使用可视化代码和逻辑表示的开发。 而且，在继续之前，我想立即澄清一下，这与视觉编程无关，从“绝对”一词开始，Unity世界中没有Blueprint版本，也没有C＃代码生成...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unity3d的可视逻辑编辑器。 第一部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448190/"><h2> 引言 </h2><br> 尊敬的读者您好，在今天的文章中，我想<b>谈谈</b>在<b>Unity3d</b>上开发应用程序时<b>出现的</b>一种现象， <b>即可</b>视化开发，或更准确地说，是使用可视化代码和逻辑表示的开发。 而且，在继续之前，我想立即澄清一下，这与视觉编程无关，从“绝对”一词开始，Unity世界中没有<b>Blueprint</b>版本，也没有C＃代码生成。 那么，可视逻辑编辑器意味着什么？ 如果您对这个问题的答案感兴趣，欢迎来到cat下。 <br><br> 该系列文章： <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">视觉逻辑编辑器第2部分</a> <br><a name="habracut"></a><br><h2> 什么是视觉逻辑编辑器 </h2><br> 很多时候，有人认为，在开发过程中，程序员经常编写许多不同的代码，它们执行从系统代码到游戏机制的许多不同事情。 如果程序员是“真实的”，那么这些代码通常会被统一和隔离，以便可以重复使用（在Unity中，这些代码是组件，它们也是<b>MonoBehavior</b>的继承人）。 不难想象会有很多这样的代码，特别是如果这不是第一个项目的话。 现在想象一下，我们正在开始一个新项目，我们需要制作许多快速且不同的原型，并且程序员团队有限，整个团队都在忙于一个或多个主要项目。 游戏设计师很愤慨，他们需要测试，检查，制作人在经理周围奔波，试图让自己成为一名程序员，金钱有限，时间不多，等等。 <br><br> 硬币的另一面，我们（程序员）以组件的形式编写了很多代码，它们悬挂在场景中不同对象上的大量列表中。 因此，我们扩大了团队，聘请了新的程序员，他打开了进行整理的阶段，并淹没在一个混乱的问题中：谁导致谁，以什么顺序，哪个组件与哪个以及如何连接等。您可以合理地说：-文档？” 有文档（尽管根本没有事实），但这是关于新人加入团队的门槛应尽可能低，并且此过程的时间应尽可能短。 <br><br> 如何解决上述情况？ 本文标题中的答案是Visual Logic Editor。 这是什么 这是一个环境，使您可以直观地操作逻辑的各个组件并配置它们的关系（在“软”版本中），以及从场景间接地操纵场景的对象。 如果您以一种非常简单的形式来描述它，那么就像在童年时期就用多维数据集组装不同的设计（仅在我们这种情况下，多维数据集没有紧密连接，移除了底部，我们的设计不会跌落）。 <br><br> 因此，我们确定了定义，但这最终给我们带来了什么？ <br><br><ul><li> 您可以组装可在项目中重用的通用设计，从而减少了后续例程。 想象一个纯粹的领域，这是我们的项目，我们只是从另一个游戏中提取组装的结构，然后将其放在领域上就这样。 </li><li> 您可以创建一个包含孤立的“多维数据集”（机械，逻辑，功能）的数据库，非程序员可以从中独立构建结构。 </li><li> 可以用其他动态替换设计，从而改变逻辑行为。 </li><li> 您可以在延迟模式下使用构造，例如，如果现在世界上不存在NPC，那么在我们的“字段”上将不存在与之关联的逻辑。 </li><li> 由于我们的多维数据集不是通过刚性关系连接的，因此我们可以根据需要关闭和打开它们，并实现任意复杂的条件分支和无条件分支。 </li></ul><br> 好吧，听起来不错吗？ 但是实际上呢？ 如果您打开<b>资源商店</b>并看到“ <b>可视脚本”</b>部分，则原则上可以看到大量不同的插件。 它们大多数是虚幻引擎对Blueprint主题的变体，即实质上是代码生成。 几乎没有适合视觉逻辑编辑器概念的系统。 最接近的含义是： <br><br><ol><li>  <b>游戏制作人</b> 是的，它是一个FSM插件，但是，它允许您编写自己的Action。 从界面的角度来看，它不是那么方便，但是对于某些事情来说，它是非常好的。 暴雪在炉石传说中没有白费。 </li><li>  <b>行为设计师/ MoonBehavior</b>等 状态树插件。 它与上面的描述更接近，但是有很多限制，毕竟，状态树不是组件上的完整逻辑。 </li><li>  <b>编码</b> 这是组织者的模拟，实际上也是状态机。 </li></ol><br> 亲爱的读者，您有没有解决的办法？ 我只找到了一个，写出了我写的系统，但是这样做的路很长而且很棘手。 <br><br><h2> 方式 </h2><br> 很早以前就出现了为<b>Unity3D</b>的可视逻辑编辑器开发插件的想法。 最初，只有这样的想法会很酷。 这些想法出现在一个项目中，该项目中有很多类似的游戏，需要非常非常快地完成20多个游戏。 第一个实现在界面方面很糟糕，尽管它当然使我们能够以给定的速度成功开发整套游戏。 <br><br> 对于下一个项目，决定制作一个完整的可视化编辑器，但结果是，由于经验不足，实现不成功，一切都非常缓慢，连接数量等超出规模，以至于无法弄清楚什么和在哪里（参见屏幕截图，请不要害怕）。 <br><br><img src="https://habrastorage.org/webt/kj/gm/bk/kjgmbkaf2uoytuksxl1x2cevbmc.png" alt="图片"><br><br> 此后，这个想法被推迟了一段时间。 我已经在纯代码上完成了以下项目，但是这个想法仍然在我的脑海中盘旋。 考虑到过去的错误，逐渐形成了最终的（在我看来）愿景和要求清单。 在2017年，下一个自由职业者项目完成之后，我决定我有能力花6-7个月的时间来处理此插件，并尝试将其放入<b>Asset Store</b> （它仍然存在，并称为<b>Panthea VS</b> ）。 从从事这样一个复杂项目的经验来看，一切都很酷，财务方面令人遗憾，仍然能够编程和能够出售是两件不同的事情。 那是2017年11月，此后我有点失去动力，离婚，改变了我的城市，彻底改变了我的生活，为了不陷入萨摩耶教义，我决定以不同的角度讨论视觉逻辑编辑器的主题。 结果是<b>uViLEd</b> ，我决定免费发布。 自从我签订了一份全职合同以来，我不得不在周末和节假日进行这项工作，这花了我整个2018年和2019年初的时间。  <b>uViLEd</b>是<b>Panthea VS</b>的重大重新思考，它是Roslyn编译器（C＃7+）的代码的完整重构，因此所有功能仅适用于Unity3d 2018.3版本。 <br><br>  <b>注意</b> ： <b>Panthea VS</b>启动了多个项目（Android和iOS，尤其是Lev的Truck和cars），原则上，使用它的经验很成功，但是当下浮出水面的是，写一个编辑器是一回事，另一件事是学习如何正确使用它（无论听起来多么奇怪）。 ） <br><br><h2>  uViLEd及其使用方法 </h2><br><h3> 引言 </h3><br> 因此，最后发生的事情是，首先我们查看图片，然后继续（会有更多图片）。 <br><br><img src="https://habrastorage.org/webt/ll/sk/g2/llskg2i3-e2niclqltvvh4csms4.png" alt="图片"><br><br> 可视逻辑编辑器基于什么？ <br><br><img src="https://habrastorage.org/webt/p0/pn/wn/p0pnwnewe_s-_vpu704ucuzaiso.png" alt="图片"><br><br> 在这里： <br><br><ul><li>  <b>组件</b> -这是我们的代码，实现一种或另一种功能，实际上是<b>MonoBehaviour</b>的类似物，仅在我们这种情况下，所有组件都是从<b>LogicComponent</b>类继承的，而<b>LogicComponent</b>类又是<b>ScriptableObject</b> 。 </li><li>  <b>变量</b>是允许存储数据的特殊<b>ScriptableObject</b> （任何对象，包括自定义结构和类，对场景对象的引用，预制件和资产）。 如果有必要使组件之间共享数据，则需要变量，也就是说，每个组件都可以引用所需类型的变量，它将是一个。 </li><li>  <b>关系</b>是以视觉形式描述什么组件，如何以及以什么顺序调用彼此的方法。 组件之间的关系使用类型为<b>INPUT_POINT</b>和<b>OUTPUT_POINT的</b>两个专用字段确定。 链接始终形成为一个组件的输出点到另一个组件的输入点。 这些连接不是严格的，也就是说，它们对于程序员是不可见的，并且它们也不在代码中。 它们仅在编辑器中存在，然后在场景开始时，逻辑控制器本身会理解代码。 如何发生这种情况，我们将在另一篇文章中讨论。 </li></ul><br> 隔离专区中的所有内容（组件，变量和关系）形成<b>逻辑</b> 。 通常，没有什么超级复杂的事情，程序员编写组件和变量的代码，然后游戏设计师或另一个（或同一个）程序员/脚本编写者通过将这些组件放置在编辑器中并设置连接和参数来形成逻辑。 <br><br><h3>  uViLEd的主要功能 </h3><br><ul><li> 以延迟模式运行逻辑（一组组件，变量和关系），包括从外部源（硬盘或服务器）启动 </li><li> 设置组件之间的连接（呼叫顺序，激活和停用） </li><li> 轻松集成组件和任何其他代码，包括MonoBehavior后代 </li><li> 覆盖编辑器中组件的外观（类似于CustomPropertyDrawer） </li><li> 通过Unity3d检查器配置组件设置 </li><li> 通过拖放脚本文件或目录轻松将组件添加到逻辑中 </li><li> 在逻辑编辑器中对组件进行分组 </li><li> 在编辑器中设置组件的显示（反转，最小化，激活和停用） </li><li> 直接从逻辑编辑器打开组件代码编辑器 </li><li> 在编辑器中启动期间，直接在逻辑编辑器中显示调试数据 </li><li> 缩放可视逻辑编辑器 </li><li> 如果逻辑中突然包含大量组件，则在选择时有可能重点搜索它们（这适用于变量） <br></li><li> 在Unity3d编辑器中以场景启动模式进行逐步调试，跟踪组件和变量值之间的所有传输数据 </li><li> 支持MonoBehaviour方法并设置其调用顺序。  <b>注意</b> ：这里是指默认情况下，SO中没有诸如Start，Update等方法。 因此，它们的支持已添加到组件本身。 同时，使用ExecuteOrder属性，可以配置调用Start，Update等方法的顺序。 </li><li> 支持检查程序的协程，异步/等待和所有Unity3d属性，以及对CustomPropertyDrawer的支持 </li></ul><br><h3> 与编辑一起工作 </h3><br> 要开始使用编辑器，必须打开场景，然后启动编辑器本身。 <br><br><img src="https://habrastorage.org/webt/17/w5/s3/17w5s38ymve2zxwovfycnluasjw.png" alt="图片"><br><br> 启动编辑器后，我们初始化场景（编辑器中的更新按钮），然后可以在场景中创建或添加现有逻辑。 <br> 创建逻辑（一个描述组件，它们的参数，组件之间的关系，变量和它们的值的文件）后，您可以在其中填充含义。 要添加组件或变量，只需将相应的脚本拖到逻辑编辑器的区域中即可。 另一种选择是使用使用<b>ComponentDefinition</b>属性自动生成的目录。 <br><br><img src="https://habrastorage.org/webt/ip/bh/oo/ipbhooqxvj2dkl7fu3ni7bgzhl0.png" alt="图片"><br><br> 在逻辑中添加了几个组件之后，就可以移动它们，包括成组移动或组合成可视组。 <br><br><img src="https://habrastorage.org/webt/8w/ph/h4/8wphh4i-jnvymggo5hrfqlc562g.png" alt="图片"><br><br> 让我们更详细地考虑在可视化编辑器中表示组件本身的内容。 <br><br><img src="https://habrastorage.org/webt/fo/nd/gd/fondgdse7kf9r_71dlpjmm8in0u.png" alt="图片"><br><br> 在这里： <br><br><ul><li> 组件的菜单按钮，打开一个下拉菜单，您可以使用以下菜单： <br><ul><li> 激活或停用组件 </li><li> 最小化组件（也可以通过双击标题来完成） </li><li> 反转组件（交换输入和输出点） </li><li> 隐藏或显示组件选项区域 </li><li> 打开组件的代码编辑器 </li></ul></li><li> 组件参数区域是显示组件关键参数值的地方，其组成取决于程序员 </li></ul><br> 要配置参数（公共字段或具有Seri​​alizeField属性的字段），您需要在逻辑编辑器中选择组件并打开Unity3d检查器。 <br><br><img src="https://habrastorage.org/webt/iz/fx/ep/izfxeppsnvrwpakv2xocjgueo-m.png" alt="图片"><br><br> 在这里： <br><br><ul><li> 右上角是一个按钮，可让您更改标题的颜色，该颜色显示在逻辑编辑器中 </li><li>  <b>名称</b> -用于设置组件实例名称的字段 </li><li>  <b>注释</b> -用于在组件实例上设置<b>注释</b>的字段；当您将鼠标悬停在组件上时，它将显示在逻辑编辑器中 </li><li>  <b>组件参数</b> -显示<b>组件参数</b>的区域（公共字段和标有Seri​​alizeField的字段） </li><li>  <b>变量链接</b> -用于设置对变量的引用的区域（有关变量的更多信息将在使用变量的部分中进行讨论）。 </li></ul><br> 为了可视化地对对象进行分组，您需要选择它们，然后按右键并在菜单中选择相应的项目。 可以重命名组以及更改其配色方案。 <br><br><img src="https://habrastorage.org/webt/qk/z8/yx/qkz8yxb7mo5rq7zgfanosvd_lak.png" alt="图片"><br><br> 要使用鼠标滚轮缩放组件的视觉表示，一切都非常简单。 <br><br> 最后我要注意的是使用组件之间的连接。 <br> 要建立连接，必须将一个组件的输出点与另一个组件的输入点连接。 <br><br><img src="https://habrastorage.org/webt/oj/xa/po/ojxapozb2kopugx2k-hq8r7aosk.png" alt="图片"><br><br><img src="https://habrastorage.org/webt/kc/jg/r5/kcjgr55qxhg8mgt87c8v8yqli8a.png" alt="图片"><br><br><img src="https://habrastorage.org/webt/nw/7b/sf/nw7bsf7vc7paqif6jhgx6fkxnr8.png" alt="图片"><br><br> 基于点发送和接收的类型匹配规则来建立关系。 不接收数据的输入点有例外；可以将任何输出点连接到该输入点。 建立连接后，系统会自动检查类型匹配并显示是否可以建立此连接。 使用以下类在组件代码中设置输入和输出点： <br><br><pre><code class="cs hljs">INPUT_POINT OUTPUT_POINT INPUT_POINT&lt;T&gt; OUTPUT_POINT&lt;T&gt;</code> </pre> <br> 前两个类别用于不接受参数的输入和输出点，第二个类别则相反。  T可以是任何类型。 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> INPUT_POINT &lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; InputFloatValue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> INPUT_POINT&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OUTPUT_POINT &lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; OutputFloatValue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OUTPUT_POINT&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;();</code> </pre><br> 要调用链接链，必须使用Execute函数。 <br><br><pre> <code class="cs hljs">OutputFloatValue.Execute(<span class="hljs-number"><span class="hljs-number">5f</span></span>);</code> </pre> <br> 为了处理这样的调用，有必要为组件代码中的输入点设置一个处理程序（大约稍后我们将讨论的确切位置）。 <br><br><pre> <code class="cs hljs">InputFloatValue.Handler = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> =&gt; Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>);</code> </pre> <br> 最后，我想提到有关连接的重要一点。 如果从一个点有多个链接，则可以在编辑器中调整其调用顺序。 <br><br><h3> 使用变量 </h3><br> 如前所述，变量是特殊的对象，使您可以通过指向它们的链接在组件之间共享数据。 像组件一样的变量是由程序员创建的。 <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ComponentDefinition(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Float"</span></span></span><span class="hljs-meta">, Path = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"uViLEd Components/Base/Variable/Base"</span></span></span><span class="hljs-meta">, Tooltip = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Variable for a floating-point number"</span></span></span><span class="hljs-meta">, Color = VLEColor.Cyan)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VariableFloat</span></span> : <span class="hljs-title"><span class="hljs-title">Variable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">float</span></span>&gt; { }</code> </pre><br> 如您所见，变量的基类是泛型类Variable，其中T是变量中包含的数据类型，T可以是可以序列化的任何类型。 <br><br> 在编辑器中，变量显示如下： <br><br><img src="https://habrastorage.org/webt/gu/nr/7u/gunr7u-e2ilyib-1whqiepzokpm.png" alt="图片"><br><br> 要更改变量值的显示，只需在类型T中重新定义ToString方法。 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> CustomData { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Value01; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Value02; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value01, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value02</span></span></span><span class="hljs-function">)</span></span> { Value01= value01; Value02= value02; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stringBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); stringBuilder.AppendLine(<span class="hljs-string"><span class="hljs-string">"Value01 = {0}"</span></span>.Fmt(Value01)); stringBuilder.Append(<span class="hljs-string"><span class="hljs-string">"Value02 = {0}"</span></span>.Fmt(Value02)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stringBuilder.ToString(); } }</code> </pre><br> 因此，这种类型的变量如下所示： <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VariableCustomData</span></span> : <span class="hljs-title"><span class="hljs-title">Variable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">CustomData</span></span>&gt; { }</code> </pre> <br> 为了在组件中添加对变量的引用，必须使用特殊的类。 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> VARIABLE_LINK&lt;CustomData&gt; CustomVariableLink = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VARIABLE_LINK&lt;CustomData&gt;();</code> </pre> <br> 此后，可以在检查器中设置链接，然后在下拉菜单中仅显示<b>CustomData</b>类型的变量，这大大简化了使用它们的工作。 <br><br> 为了方便使用变量，有一些特殊的方法可让您确定何时变量已更改其值或何时为其设置任何数据。 <br><br><pre> <code class="cs hljs">CustomVariableLink.AddSetEventHandler(CustomDataSet); CustomVariableLink.AddChangedEventHandler(CustomDataChanged);</code> </pre><br> 应当牢记，Changed在<b>Equals</b>条件下起作用，因此，如果使用结构和类，则必须重新定义此方法以确保正确操作。 <br><br><h3> 使用Unity对象 </h3><br> 由于uViLEd系统的性质，无法在其中使用指向Unity对象的直接链接，因为在加载逻辑时无法还原它们。 为了解决此问题，创建了专用的<b>VLObject</b> Shell，该外壳允许您创建此类链接以及保存和加载它们。 除其他外，此shell具有一个特殊的属性编辑器，如果您要访问它们，则可以从场景中的任何对象获取组件（请参见下图）。 使用<b>VLObject，</b>您不仅可以存储到场景对象及其组件的链接<b>，</b>还可以存储到预制件和资源文件（例如纹理，声音等）的链接。 <br><br><img src="https://habrastorage.org/webt/3i/wl/d4/3iwld4qttgr3fjboody9ruyeeyi.png" alt="图片"><br><br>  <b>注意</b> ：如果在另一个场景中使用现有逻辑，则将丢失对对象的引用，包括对预制件的引用，因为该场景充当其存储位置。 如果您打算将逻辑用作模板，则也应该考虑到这一点，在这种情况下，最好的选择是从外部（例如，从附加到场景的逻辑）转移到它的必要链接。 <br><br> 也可以限制将在<b>VLObject中</b>安装的Unity对象的类型。 这仅影响Unity检查器，并为方便使用它们而使用。 <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">SerializeField</span></span>] [TypeConstraint(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Button))] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> VLObject _button;</code> </pre> <br><h3> 创建一个逻辑组件 </h3><br> 为了创建逻辑组件，程序员将一个简单的C＃脚本文件添加到项目就足够了（您也可以通过“项目”选项卡中的特殊菜单立即创建组件或变量）并将其中的代码更改为以下内容： <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ComponentDefinition(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MyComponent"</span></span></span><span class="hljs-meta">, Path = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MyFolder/MySubfolder"</span></span></span><span class="hljs-meta">, Tooltip = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"this my logic component"</span></span></span><span class="hljs-meta">, Color = VSEColor.Green)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyLogicComponent</span></span> : <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> { }</code> </pre><br> 如前所述， <b>ComponentDefinition</b>是允许您自动创建组件目录的属性，在此应注意，Color（标题的颜色）在字符串中设置为十六进制格式。 <br><br>  <b>LogicComponent</b>是所有组件的基类，而这些组件又是<b>ScripatableObject</b>的后代。 <br><br> 以下是一个组件的简单示例，该组件按bool类型的传入值进行分支： <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">IfBool</span></span> : <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> INPUT_POINT&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; ValueToBeChecked = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> INPUT_POINT&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OUTPUT_POINT True = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OUTPUT_POINT(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OUTPUT_POINT False = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OUTPUT_POINT(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ValueToBeChecked.Handler = ValueToBeCheckedHandler; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValueToBeCheckedHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { True.Execute(); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { False.Execute(); } } }</code> </pre><br> 因此，正如您从代码中看到的那样，我们创建了组件的输入点，该输入点采用bool类型的值，并根据获得的值调用两个输出点。 <br><br> 也许您现在有一个问题，这<b>是</b>什么样的<b>构造函数</b> ？ 我解释一下 默认情况下， <b>ScriptableObject</b>不支持诸如<b>Start</b> ， <b>Update</b>等方法，但也支持<b>Awake</b> ， <b>OnEnable</b> ， <b>OnDisable</b>和<b>OnDestroy方法</b> 。 因此，这里是<b>Awake</b> （类似于<b>OnEnable</b> ），如果<b>ScriptableObject</b>是通过<b>CreateInstance</b>方法创建的，则始终会调用它，而实际上这就是问题所在。 由于实际上是在编辑器模式下在内存中创建对象以进行序列化的事实，因此此时必须排除组件代码的工作，因此添加了<b>Awake</b>模拟作为<b>Constructor</b>方法，当在编辑器中删除对象时，同样适用于<b>OnDisable</b>和<b>OnDestroy</b>方法。 如果需要正确处理组件的移除（例如，在卸载场景时），则必须使用<b>IDisposable</b>接口。 <br><br> 如您所见，一般而言，创建组件并不困难。 这是一个常规类，其中可以包含您想要的任何代码。 在特定情况下，这些组件可能根本不包含输入和输出点，而是使用全局消息进行通信。 顺便说一下，为此，在<b>uViLEd中</b>有一个<b>GlobalEvent</b>类-它是一个基于数据类型的消息系统（有关更多信息，请参见我的文章）。 <br><br> 我要说的最后一件事是能够根据组件的参数配置组件的输入和输出点的能力。 <br><br><img src="https://habrastorage.org/webt/om/xi/0e/omxi0ebaaiuixhln-gpqmkdqz5g.png" alt="图片"><br><br> 为此，在组件代码中，实现<b>IInputPointParse</b>和<b>IOutputPointParse接口中的</b>一个或两个就足够了。 下面是一个用于<b>Switch</b>分支组件的抽象通用类代码的示例；根据<b>SwitchValues</b>参数在此处自动创建输出点。 <br><br><div class="spoiler">  <b class="spoiler_title">SwitchAbstract类代码</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SwitchAbstract</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span>, <span class="hljs-title"><span class="hljs-title">IOutputPointParse</span></span> { [Tooltip(<span class="hljs-string"><span class="hljs-string">"input point for transmitting value, which should be checked"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> INPUT_POINT&lt;T&gt; ValueToBeChecked = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> INPUT_POINT&lt;T&gt;(); [Tooltip(<span class="hljs-string"><span class="hljs-string">"set of values for branching"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;T&gt; SwitchValues = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;T&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; outputPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ValueToBeChecked.Handler = ValueToBeCheckedHandler; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompareEqual</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T first, T second</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> first.Equals(second); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValueString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPontName = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.ToString(); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!UnityEditor.EditorApplication.isPlaying) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (outputPoints.ContainsKey(outputPontName)) { outputPontName += " ({0})".Fmt(outputPoints.Count); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> return outputPontName; } private void ValueToBeCheckedHandler(T checkedValue) { foreach (var value in SwitchValues) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (CompareEqual(checkedValue, value)) { ((OUTPUT_POINT)outputPoints[GetValueString(value)]).Execute(); return; } } } public IDictionary&lt;string, object&gt; GetOutputPoints() { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!UnityEditor.EditorApplication.isPlayingOrWillChangePlaymode) { outputPoints.Clear(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (outputPoints.Count == 0) { foreach (var value in SwitchValues) { outputPoints.Add(GetValueString(value), new OUTPUT_POINT()); } } return outputPoints; } }</span></span></code> </pre> <br></div></div><br><h3> 逻辑调试 </h3><br>  UViLEd提供了几种调试逻辑的机制： <br><br><ol><li> 在场景启动模式下，可以在逻辑编辑器中显示内部变量及其值的功能。 为此，请使用<b>ViewInDebugMode</b>属性 </li><li> 能够在场景启动模式下查看逻辑变量的值 </li><li> 可以逐步调试组件之间的调用并查看它们之间传输的数据 </li></ol><br>  UViLEd对最后一项具有特殊的模式，该模式在场景开始时打开。 <br><br><img src="https://habrastorage.org/webt/vg/i2/rs/vgi2rsffppoc1zwyq4px7ojgmk0.png" alt="图片"><br><br> 不幸的是，该模式具有与场景之间的过渡相关联的某些限制。 在这种情况下，先前场景和逻辑中的调试数据将丢失，而在新场景和逻辑中，仅从在编辑器中激活逻辑的那一刻开始显示调试数据。 <br><br><h2> 结论 </h2><br> 在本文中，我试图向您简要介绍我在当前项目中使用的开发方法。 尽管最初有怀疑（包括我的怀疑），实践还是显示出使用它的便利性，尤其是在制作原型时。 除其他事项外，游戏设计师的工作已大大简化，他们无需进入现场，不戳物体来配置游戏过程，而是使用一组变量和组件数据为他们创建了单独的逻辑，他们可以在其中轻松配置所有内容。 另外一个很大的优点是，在我的项目中，通常是从外部下载内容。 使用可视逻辑编辑器，我可以在不更新主应用程序的情况下更新游戏流程的平衡，在某些情况下，可以更改逻辑本身。 <br><br> 对我自己来说，我认为这样的开发方法是很合适的，当然它不适用于大型项目，但是可以将其用于一些游戏脚本，从而在关卡设计等方面重振整个世界。正在进行的项目（儿童部分），到目前为止，他显示出了出色的成绩。 <br><br> 接下来呢？ <br><br> 这是有关逻辑uViLEd的可视化编辑器的系列文章的第一部分，然后将涉及以下内容： <br><br><ol><li>  <b>系统的核心</b> ：如何加载逻辑，为什么选择ScriptableObject，如何安排API，允许您执行的操作等等，出现了什么困难以及如何解决所有问题。 </li><li>  <b>编辑器</b> ：我现在将重述它的开发方式，构建方式，存在的问题和解决方案等。 </li></ol><br> 如果您有任何我想在后续文章中讨论的特定问题，请在评论中写下。 <br><br>  <b>PS</b> ：我试图谈论<b>uViLEd</b>的关键点，如果您有需要，可以通过从Asset Store下载插件来熟悉它，这里有完整的文档（尽管是英文）：用户手册，程序员和API指南。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">视觉逻辑编辑器第2部分</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">UViLEd视觉逻辑编辑器</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">全球消息文章</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN448190/">https://habr.com/ru/post/zh-CN448190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN448180/index.html">优质wifi工具。 Ekahau Pro等</a></li>
<li><a href="../zh-CN448182/index.html">招聘软件开发人员的经验。 第一部分</a></li>
<li><a href="../zh-CN448184/index.html">安全周16：数字身份盗窃</a></li>
<li><a href="../zh-CN448186/index.html">从过程建模到设计自动化系统（第2部分）</a></li>
<li><a href="../zh-CN448188/index.html">时间囊：HP iPaq h1940“开箱即用”。 什么是2000年代的PDA</a></li>
<li><a href="../zh-CN448192/index.html">为什么在AR和VR的生产中需要</a></li>
<li><a href="../zh-CN448194/index.html">招聘软件开发人员的经验。 第二部分</a></li>
<li><a href="../zh-CN448196/index.html">等离子发动机的未来（或秘密存在）或如何在大气层中实现27个最大摆动</a></li>
<li><a href="../zh-CN448198/index.html">在两个应用程序之间进行安全的数据传输</a></li>
<li><a href="../zh-CN448202/index.html">我们在STM32F030中控制发生器或对抗ADC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>