<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§±üèæ üë®üèΩ‚Äçüíª üëµüèΩ Animasi yang disediakan server di aplikasi iOS ü§ΩüèΩ üë©üèæ‚Äçü§ù‚Äçüë©üèº üßñüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai semuanya! Sekitar enam bulan lalu kami meluncurkan salah satu fitur paling menarik di Badoo: Streaming Langsung . Salah satu fungsi utamanya adala...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Animasi yang disediakan server di aplikasi iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/439370/"><img src="https://habrastorage.org/webt/px/9h/mg/px9hmgqrpebneeamcitvv8b_wkw.jpeg"><br><br>  Hai semuanya!  Sekitar enam bulan lalu kami meluncurkan salah satu fitur paling menarik di Badoo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Streaming Langsung</a> .  Salah satu fungsi utamanya adalah bahwa pemirsa dapat mengirim hadiah ke pita favorit mereka untuk menyatakan penghargaan mereka.  Kami ingin membuat hadiah semewah dan semenarik mungkin, jadi diputuskan untuk membuat beberapa di antaranya benar-benar hidup, dan maksud saya ini adalah animasi.  Dan untuk lebih melibatkan orang, kami, tim Badoo, berencana untuk memperbarui hadiah dan animasi itu setiap beberapa minggu. <br><br>  Sebagai seorang insinyur iOS, Anda mungkin sudah menebak tantangan yang kami hadapi di sini: kebutuhan untuk menambahkan animasi baru dan menghapus yang lama akan membutuhkan banyak pekerjaan dari sisi klien.  Kami membutuhkan tim pengembangan Android dan iOS untuk setiap rilis - yang, jika dikombinasikan dengan jumlah waktu yang dibutuhkan oleh ulasan dan persetujuan App Store, akan berarti mungkin beberapa hari sebelum setiap pembaruan dapat ditayangkan.  Tetapi kami telah memecahkan masalahnya, dan saya akan menjelaskan kepada Anda caranya. <br><br><h1>  Ikhtisar solusi </h1><br>  Pada tahap ini, kami sudah tahu cara <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengekspor animasi Adobe After Effects (AAE) ke dalam format yang dapat dibaca oleh aplikasi iOS kami</a> menggunakan perpustakaan Lottie.  Namun kali ini, kami melangkah lebih jauh: kami memutuskan untuk membuat semacam layanan penyimpanan animasi, tersedia melalui internet.  Dengan kata lain, kami akan menyimpan semua animasi aktual di server dan mengirimkannya ke aplikasi klien sesuai permintaan: <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/wq/tz/6w/wqtz6w0lgzbjm1eq5bvcshngnxw.png"><br><br>  Berikut ini solusi akhir yang terlihat di simulator iOS pada mesin pengembang: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pe/3s/qo/pe3sqoahuswtkbfqd4wl-opzv8m.gif" width="250"></div><br>  Namun, dalam posting ini, contoh yang akan saya gunakan adalah animasi yang sangat sederhana yang saya buat sendiri.  Ini tidak semewah yang Badoo, tapi cukup bagus untuk menunjukkan potensi pendekatan yang dijelaskan. <br><br><h1>  Mengekspor animasi </h1><br>  Proyek animasi Adobe After Effects (AAE) yang saya gunakan di sini dapat ditemukan bersama dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">file sumber</a> lain <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di github</a> .  Jadi, setelah membuka proyek animasi AAE yang terletak di <code>_raw/animations/Fancy/Fancy.aep</code> , Anda akan melihat jendela seperti ini: <br><br><img src="https://habrastorage.org/webt/_k/hz/os/_khzosjwwyiiysdwfdon6iqjz10.png"><br><br>  Pada titik ini, saya tidak akan membahas bagaimana animasi dibuat di AEE, tetapi yang akan saya jelaskan adalah bagaimana mengimpor animasi yang sudah ada dari AAE ke dalam format yang dapat dibaca aplikasi iOS menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">plugin Bodymovin</a> . <br><br>  Setelah memastikan plugin terinstal, buka dengan memilih opsi <i>Window / Extensions / Bodymovin</i> di menu: <br><br><img src="https://habrastorage.org/webt/jq/3d/rw/jq3drw28ghwylkqidrecb78r9p4.png"><br><br>  Sekarang Anda akan melihat jendela Bodymovin di mana Anda dapat memilih animasi yang ingin Anda ekspor, tentukan path file output dan kemudian buka pengaturan ekspor: <br><br><img src="https://habrastorage.org/webt/iy/th/yl/iythylsx8lylzanrfavxmtn7u64.png"><br><br>  Setelah memilih dan membuka pengaturan animasi, kami sekarang dapat meminta Bodymovin untuk menanamkan aset ke dalam file JSON yang dihasilkan dengan mencentang opsi <i>Aset / Sertakan dalam json</i> : <br><br><img src="https://habrastorage.org/webt/c8/8v/od/c88vodmi3cksysyvdfg-89qqwby.png"><br><br>  Akhirnya, komposisi animasi yang dipilih diekspor dan disimpan ke file yang ditentukan dengan mengklik tombol <i>Render</i> . <br><br><h1>  Menyimpan animasi di server </h1><br>  Mari kita asumsikan kita telah memindahkan file JSON animasi yang diberikan ke server web pilihan kita melalui Internet.  Dalam kasus kami, demi kesederhanaan, saya telah mengunggahnya ke repositori github proyek ini.  Animasi tersedia di sini: <br><br><ul><li>  <a href="">Animasi awan</a> </li><li>  <a href="">Animasi kembang api</a> </li></ul><br>  URL Basis: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://raw.githubusercontent.com/chupakabr/server-provided-animations/master/_raw/rendered-animations/</a> <br><br>  ID khusus animasi: <br><br><ul><li> <code>clouds.json</code> </li> <li> <code>fireworks.json</code> </li> </ul><br><blockquote>  Catatan: Mencari server web penyedia animasi yang ditulis dalam Swift?  Temukan solusinya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini di github</a> dan penjelasan terperinci di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel ini</a> . </blockquote>  Pada titik ini, kami memiliki server penyedia animasi yang berfungsi penuh, jadi inilah saatnya untuk beralih ke bagian yang paling menarik: menyajikan animasi kepada pengguna kami. <br><br><h1>  Mengambil dan menyajikan animasi </h1><br>  Pada titik ini saya sangat menyarankan untuk membuka contoh proyek aplikasi iOS kami yang berlokasi di <code>Client/ServerProvidedAnimation.xcworkspace</code> karena sudah memiliki semua kode dan konfigurasi boilerplate yang diperlukan. <br><br><h2>  Memuat data animasi </h2><br>  Mengingat bahwa titik akhir REST API untuk memperoleh data animasi sekarang sedang berjalan, saatnya untuk memperkenalkan protokol penyedia data dan menambahkan implementasi servernya: <br><br><pre> <code class="plaintext hljs">import Lottie protocol AnimationsProviderProtocol { typealias Completion = (_ animation: LOTComposition?) -&gt; Void func loadAnimation(byId id: String, completion: @escaping Completion) } final class ServerAnimationProvider: AnimationsProviderProtocol { private let endpoint: URL init(endpoint: URL) { self.endpoint = endpoint } func loadAnimation(byId id: String, completion: @escaping Completion) { let path = "/\(id).json" guard let animationUrl = URL(string: path, relativeTo: self.endpoint) else { completion(nil) return } URLSession.shared.invalidateAndCancel() let task = URLSession.shared.dataTask(with: animationUrl) { (data, response, error) in guard error == nil, let data = data, let json = self.parseJson(from: data) else { completion(nil) return } let animation = LOTComposition(json: json) completion(animation) } task.resume() } private func parseJson(from data: Data?) -&gt; [AnyHashable : Any]? { guard let data = data else { return nil } do { let json = try JSONSerialization.jsonObject(with: data, options: []) as? [AnyHashable : Any] return json } catch { return nil } } }</code> </pre><br>  Kelas penyedia data ini memungkinkan kami memuat animasi dari server dalam format JSON sesuai permintaan dan menyimpannya di memori untuk dirender di UI.  Dengan asumsi kita mengikuti pola MVVM, ini dapat dengan mudah digunakan dalam entitas <code>ViewModel</code> dengan cara berikut: <br><br><pre> <code class="plaintext hljs"> // ... private let animationProvider: AnimationsProviderProtocol private(set) var animationModel: LOTComposition? // ‚Ä¶ func loadAnimation(byId animationId: String) {     self.animationProvider.loadAnimation(byId: animationId) { [weak self] (animationModel) in         self?.animationModel = animationModel     } } // ...</code> </pre> <br>  <code>ViewModel</code> memperbarui properti data animasi yang dipilih ketika menerima respons HTTP yang valid dari server dengan objek JSON yang tidak kosong di dalamnya.  Data ini digunakan oleh lapisan presentasi untuk menjadwalkan pembuatan animasi. <br><br><h2>  Lapisan presentasi </h2><br>  Sekarang kita bisa menggunakan ViewModel untuk mengakses data animasi dan menyajikannya melalui UI di action handler "on tap" yang dilampirkan pada tombol: <br><br><pre> <code class="plaintext hljs">class ViewController: UIViewController {   // ...   @IBOutlet weak var animationContainer: UIView!   override func viewDidLoad() {       super.viewDidLoad()       // ...       self.animationView = {           let view = LOTAnimationView(frame: self.animationContainer.bounds)           self.animationContainer.addSubview(view)           return view       }()   }   @IBAction func onPlayAnimationAction(_ sender: Any) {       self.animationView.stop()       self.animationView.sceneModel = self.viewModel.animationModel       self.animationView.play()   } }</code> </pre> <br>  Pada dasarnya, yang kita miliki di sini adalah penangan tombol yang memicu pembaruan contoh LOTAnimationView dengan data animasi terbaru yang berasal dari <code>ViewModel</code> . <br><br>  Seperti apa hasil akhirnya: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rn/3d/qq/rn3dqqo6ueg3tfye-tmh9rlhove.png" width="250"></div><br>  Cukup banyak.  Animasi sekarang sedang dimuat dari titik akhir REST API yang disiapkan dan diberikan pada klien sesuai permintaan. <br><br><h1>  Kiat &amp; Keterbatasan </h1><br>  Kiat dan trik: <br><br><ul><li>  AAE memungkinkan penggunaan sebagian besar jenis aset termasuk grafik raster dan vektor; </li><li>  Bodymovin memungkinkan untuk menanamkan semua aset ke dalam file animasi JSON keluaran (menggunakan pengkodean base64) - ini berarti kita dapat menghindari pemisah aset yang terpisah di sisi klien; </li><li>  Untuk animasi, Anda memiliki pilihan antara menggambar langsung ke vektor di AAE, atau hanya mengimpor grafik vektor Adobe Illustrator. </li></ul><br>  Sayangnya, impor vektor vektor SVG ke AAE belum dimungkinkan (saya sudah mencoba!). <br><br>  Lebih banyak trik dan masalah potensial dijelaskan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel menakjubkan yang</a> ditulis oleh kolega saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Radoslaw Cieciwa</a> . <br><br><h1>  Kesimpulan </h1><br>  Jadi, apa yang diberikan oleh animasi yang diberikan server kepada kita?  Manfaat paling nyata dari pendekatan ini adalah kemampuan untuk memisahkan semua pemangku kepentingan dari aliran pembaruan animasi.  Dengan kata lain, untuk merilis animasi baru yang mewah, yang harus dilakukan oleh semua desainer adalah memberikan representasi JSON animasi kepada tim server.  Dan untuk menghapus satu, tim server hanya perlu menghapus animasi tertentu dari layanan penemuan.  Tidak ada waktu yang terbuang! <br><br>  Hal keren lainnya adalah fungsionalitas yang sama dapat diterapkan pada semua platform klien yang didukung (iOS, Android, Web, ..) tanpa harus menyesuaikan fungsionalitas server yang ada atau animasi mentah. <br><br>  Itu untuk hari ini!  Terima kasih sudah membaca <br><br><h3>  Sumber daya </h3><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Di balik layar dengan mengimpor animasi Adobe After Effects ke aplikasi iOS Badoo</a> " oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Radoslaw Cieciwa</a> ; </li><li>  <a href="">Plugin Bodymovin untuk AAE</a> oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AirbnbEng</a> ; </li><li>  Proyek lengkap tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini di github</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menginstal plugin bodymovin untuk AAE</a> oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AirbnbEng</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Perpustakaan Lottie iOS</a> oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AirbnbEng</a> ; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">REST API with Swift on Vapor</a> " oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Valerii Che</a> vtaev; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penginstal plugin ZXP</a> untuk AAE. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id439370/">https://habr.com/ru/post/id439370/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id439360/index.html">Pelatihan Cisco 200-125 CCNA v3.0. Cisco Certified Network Specialist (CCNA). Hari 3. Subnet</a></li>
<li><a href="../id439362/index.html">Bagaimana kita mengajar Rekayasa Perangkat Lunak di St. Petersburg HSE</a></li>
<li><a href="../id439364/index.html">Kacamata Oculus Go dengan satu set konten "stroberi" muncul dijual</a></li>
<li><a href="../id439366/index.html">Otomasi tiga paku</a></li>
<li><a href="../id439368/index.html">Animasi di aplikasi iOS lahir di server</a></li>
<li><a href="../id439372/index.html">Ingin Bermain Detektif? Temukan Bug dalam Fungsi dari Komandan Tengah Malam</a></li>
<li><a href="../id439374/index.html">Bagi mereka yang ingin bermain detektif: temukan kesalahan dalam fungsi dari Midnight Commander</a></li>
<li><a href="../id439376/index.html">Klub Bunga</a></li>
<li><a href="../id439378/index.html">Buku (sedang?). Refleksi pada sifat pikiran. Bagian I</a></li>
<li><a href="../id439380/index.html">Bagaimana saya membuat ekstensi untuk Atom dan Kode VS: pengalaman dan sumber pribadi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>