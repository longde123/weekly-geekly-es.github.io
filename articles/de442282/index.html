<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≥üèº üòó üë®üèæ‚Äçü§ù‚Äçüë®üèº Dart 2. Asynchrone Programmierung: Futures üîÄ üë©üèæ‚Äçü§ù‚Äçüë®üèΩ üë©üèª‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Asynchrone Programmierung: Futures 


 Inhalt 


- Einf√ºhrung 
- Was ist die Zukunft? 
- Async - warte Fehlerbehandlung Sequentielle Ausf√ºhrung 
- Feh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dart 2. Asynchrone Programmierung: Futures</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442282/"><h1 id="asinhronnoe-programmirovanie-futures">  Asynchrone Programmierung: Futures </h1><br><p>  <strong>Inhalt</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einf√ºhrung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Was ist die Zukunft?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Async - warte</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fehlerbehandlung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sequentielle Ausf√ºhrung</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zuk√ºnftige API</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fehlerbehandlung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufruf mehrerer Funktionen, die die Zukunft zur√ºckgeben</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Was noch zu lesen?</a> </li></ul><br><p>  <strong>Was ist wichtig:</strong> </p><br><ul><li>  Der Code in Dart wird in einer einzelnen Thread-Ausf√ºhrung ( <em>Note Thread - Thread</em> ) ausgef√ºhrt. </li><li>  Aufgrund von Code, der den Thread f√ºr eine lange Zeit ben√∂tigt (blockiert), kann das Programm einfrieren. </li><li> <code>Future</code> ( <code>futures</code> ) Objekte stellen die Ergebnisse asynchroner Operationen dar - Verarbeitung oder E / A, die sp√§ter abgeschlossen werden. </li><li>  Um die Ausf√ºhrung in Zukunft bis zum Abschluss auszusetzen, verwenden Sie <code>await</code> in der asynchronen Funktion (oder <code>then()</code> wenn Sie die <code>Future</code> API verwenden). </li><li>  Verwenden Sie zum Abfangen von Fehlern das <code>try-catch</code> Konstrukt (oder <code>catchError()</code> bei Verwendung der <code>Future</code> API) in der asynchronen Funktion. </li><li>  Erstellen Sie f√ºr die gleichzeitige Verarbeitung ein Isolat (oder einen Worker f√ºr die Webanwendung). <a name="habracut"></a></li></ul><br><p>  Der Code in Dart wird in einem einzelnen Ausf√ºhrungsthread ausgef√ºhrt.  Wenn der Code mit langen Berechnungen besch√§ftigt ist oder auf eine E / A-Operation wartet, wird das gesamte Programm angehalten. </p><br><p>  Durch asynchrone Vorg√§nge kann Ihr Programm andere Aufgaben ausf√ºhren, w√§hrend Sie auf den Abschluss des Vorgangs warten.  Dart verwendet <code>futures</code> , um die Ergebnisse asynchroner Operationen darzustellen.  Sie k√∂nnen auch async and await oder die Future API verwenden, um mit <code>futures</code> zu arbeiten. </p><br><p>  <em>Eine Notiz</em> </p><br><blockquote>  Der gesamte Code wird im Kontext des Isolats ausgef√ºhrt, dem der gesamte vom Code verwendete Speicher geh√∂rt.  Es kann nicht mehr als eine Codeausf√ºhrung im selben Isolat gestartet werden. <br><br>  F√ºr die parallele Ausf√ºhrung von Codebl√∂cken k√∂nnen Sie diese in separate Isolate aufteilen.  (Webanwendungen verwenden Worker anstelle von Isolaten.) In der Regel wird jedes der Isolate auf einem eigenen Prozessorkern ausgef√ºhrt.  Isolate teilen sich nicht den Speicher und k√∂nnen nur interagieren, indem sie sich gegenseitig Nachrichten senden.  Informationen zum Thema finden Sie in der Dokumentation zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Isolaten</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Arbeitern</a> . </blockquote><br><h2 id="vvedenie">  Einf√ºhrung </h2><br><p>  Schauen wir uns ein Beispiel f√ºr Code an, der die Programmausf√ºhrung ‚Äûeinfrieren‚Äú kann: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Synchronous code void printDailyNewsDigest() { var newsDigest = gatherNewsReports(); // Can take a while. print(newsDigest); } main() { printDailyNewsDigest(); printWinningLotteryNumbers(); printWeatherForecast(); printBaseballScore(); }</span></span></code> </pre> <br><p>  Unser Programm liest Nachrichten aus der Tagesdatei, zeigt sie an und zeigt dann Informationen an, die f√ºr den Benutzer immer noch von Interesse sind: </p><br><pre> <code class="plaintext hljs">&lt;gathered news goes here&gt; Winning lotto numbers: [23, 63, 87, 26, 2] Tomorrow's forecast: 70F, sunny. Baseball score: Red Sox 10, Yankees 0</code> </pre> <br><p>  In diesem Beispiel besteht das Problem darin, dass alle Vorg√§nge nach dem Aufruf von <code>gatherNewsReports()</code> warten, bis <code>gatherNewsReports()</code> den Inhalt der Datei <code>gatherNewsReports()</code> , unabh√§ngig davon, wie lange es dauert.  Wenn das Lesen der Datei lange dauert, muss der Benutzer auf die Ergebnisse der Lotterie, die Wettervorhersage und den Gewinner eines k√ºrzlich durchgef√ºhrten Spiels warten. </p><br><p>  Um die Reaktionsf√§higkeit der Anwendung aufrechtzuerhalten, verwenden Dart-Autoren ein asynchrones Modell, um Funktionen zu identifizieren, die m√∂glicherweise teure Arbeiten ausf√ºhren.  Solche Funktionen geben ihren Wert √ºber <code>futures</code> . </p><br><h2 id="chto-takoe-future">  Was ist die Zukunft? </h2><br><p>  <code>future</code> ist eine Instanz der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Future &lt;T&gt;</a> -Klasse, bei der es sich um eine asynchrone Operation handelt, die ein Ergebnis vom Typ T zur√ºckgibt. Wenn das Ergebnis der Operation nicht verwendet wird, wird der <code>Future&lt;void&gt;</code> Typ durch <code>Future&lt;void&gt;</code> .  Beim Aufrufen einer Funktion, die die <code>future</code> zur√ºckgibt, passieren zwei Dinge: </p><br><ol><li>  Die Funktion steht zur Ausf√ºhrung in der Warteschlange und gibt ein unvollst√§ndiges <code>Future</code> Objekt zur√ºck. </li><li>  Sp√§ter, wenn der Vorgang abgeschlossen ist, wird die <code>future</code> mit einem Wert oder Fehler beendet. </li></ol><br><p>  Um <code>future</code> Code zu schreiben, haben Sie zwei M√∂glichkeiten: </p><br><ul><li>  Verwenden Sie <code>async</code> - <code>await</code> </li><li>  Verwenden Sie die <code>Future</code> API </li></ul><br><h2 id="async---await">  Async - warte </h2><br><p>  Die Schl√ºsselw√∂rter <code>async</code> und <code>await</code> sind Teil der <code>async</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Unterst√ºtzung</a> von Dart.  Mit ihnen k√∂nnen Sie asynchronen Code schreiben, der wie synchroner Code aussieht und die <code>Future</code> API nicht verwendet.  <em>Eine asynchrone Funktion</em> ist eine Funktion mit dem Schl√ºsselwort <code>async</code> vor ihrem Hauptteil.  Das Schl√ºsselwort <code>await</code> funktioniert nur in asynchronen Funktionen. </p><br><blockquote>  Hinweis: In Dart 1.x verz√∂gern asynchrone Funktionen sofort die Ausf√ºhrung.  In Dart 2 werden asynchrone Funktionen nicht sofort angehalten, sondern synchron ausgef√ºhrt, bis das erste <code>await</code> oder <code>return</code> . </blockquote><p>  Der folgende Code simuliert das Lesen von Nachrichten aus einer Datei mit <code>async</code> - <code>await</code> .  √ñffnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DartPad mit der Anwendung</a> , starten Sie und klicken Sie auf KONSOLE, um das Ergebnis anzuzeigen. </p><br><div class="spoiler">  <b class="spoiler_title">Beispielcode</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Copyright (c) 2013, the Dart project authors. Please see the AUTHORS file // for details. All rights reserved. Use of this source code is governed by a // BSD-style license that can be found in the LICENSE file. import 'dart:async'; Future&lt;void&gt; printDailyNewsDigest() async { var newsDigest = await gatherNewsReports(); print(newsDigest); } main() { printDailyNewsDigest(); printWinningLotteryNumbers(); printWeatherForecast(); printBaseballScore(); } printWinningLotteryNumbers() { print('Winning lotto numbers: [23, 63, 87, 26, 2]'); } printWeatherForecast() { print("Tomorrow's forecast: 70F, sunny."); } printBaseballScore() { print('Baseball score: Red Sox 10, Yankees 0'); } const news = '&lt;gathered news goes here&gt;'; const oneSecond = Duration(seconds: 1); // Imagine that this function is more complex and slow. :) Future&lt;String&gt; gatherNewsReports() =&gt; Future.delayed(oneSecond, () =&gt; news); // Alternatively, you can get news from a server using features // from either dart:io or dart:html. For example: // // import 'dart:html'; // // Future&lt;String&gt; gatherNewsReportsFromServer() =&gt; HttpRequest.getString( // 'https://www.dartlang.org/f/dailyNewsDigest.txt', // );</span></span></code> </pre> </div></div><br><p>  Beachten Sie, dass wir zuerst <code>printDailyNewsDigest()</code> aufrufen, die Nachrichten jedoch zuletzt gedruckt werden, selbst wenn die Datei nur eine Zeile enth√§lt.  Dies liegt daran, dass der Code, der die Datei liest und druckt, asynchron ausgef√ºhrt wird. </p><br><p>  In diesem Beispiel <code>printDailyNewsDigest()</code> <code>gatherNewsReports()</code> , das nicht blockiert.  Durch Aufrufen der Methode <code>gatherNewsReports()</code> wird <code>gatherNewsReports()</code> Job in die <code>gatherNewsReports()</code> Ausf√ºhrung des restlichen Codes wird jedoch nicht gestoppt.  Das Programm zeigt die Lotterienummern, Prognosen und Ergebnisse eines Baseballspiels an.  Das Programm druckt die Nachrichten, nachdem die Sammlung von <code>gatherNewsReports()</code> .  Wenn <code>gatherNewsReports()</code> einige Zeit ben√∂tigt, um seine Arbeit abzuschlie√üen, passiert nichts Schlimmes: Der Benutzer kann andere Dinge lesen, bevor der t√§gliche News Digest gedruckt wird. </p><br><p>  Achten Sie auf R√ºckgabetypen.  Der R√ºckgabetyp der Funktion <code>gatherNewsReports()</code> ist <code>Future&lt;String&gt;</code> <code>gatherNewsReports()</code> bedeutet, dass eine <code>future</code> , die mit einem Zeichenfolgenwert endet.  Die Funktion <code>printDailyNewsDigest()</code> , die keinen Wert <code>printDailyNewsDigest()</code> , hat den R√ºckgabetyp <code>Future&lt;void&gt;</code> . </p><br><p>  Das folgende Diagramm zeigt die Schritte zur Codeausf√ºhrung. </p><br><p><img src="https://habrastorage.org/webt/cs/ez/9h/csez9hgmhhk6r1fyu8c4jryuydi.png"></p><br><ol><li>  Die Anwendung wird gestartet. </li><li>  Die <code>main()</code> Funktion <code>printDailyNewsDigest()</code> asynchrone Funktion <code>printDailyNewsDigest()</code> und wird synchron ausgef√ºhrt. </li><li>  <code>printDailyNewsDigest()</code> verwendet <code>await</code> , um die Funktion <code>gatherNewsReports()</code> aufzurufen, die <code>gatherNewsReports()</code> wird. </li><li>  <code>gatherNewsReports()</code> gibt eine unvollendete <code>future</code> (eine Instanz von <code>Future&lt;String&gt;</code> ). </li><li>  Da <code>printDailyNewsDigest()</code> eine asynchrone Funktion ist und einen Wert erwartet, wird die Ausf√ºhrung <code>printDailyNewsDigest()</code> und die unvollst√§ndige <code>future</code> (in diesem Fall <code>Future&lt;void&gt;</code> ) an die aufrufende Funktion <code>main ()</code> . </li><li>  Die restlichen Ausgabefunktionen werden ausgef√ºhrt.  Da sie synchron sind, wird jede Funktion vollst√§ndig ausgef√ºhrt, bevor zur n√§chsten √ºbergegangen wird.  Beispielsweise werden alle Lottozahlen vor der Wettervorhersage angezeigt. </li><li>  Nach Abschluss von <code>main()</code> asynchrone Funktionen die Ausf√ºhrung fortsetzen.  Zuerst erhalten wir die <code>future</code> mit Neuigkeiten √ºber die Fertigstellung von <code>gatherNewsReports()</code> .  Anschlie√üend setzt <code>printDailyNewsDigest()</code> die Ausf√ºhrung fort und zeigt die Nachrichten an. </li><li>  Am Ende der Ausf√ºhrung von <code>printDailyNewsDigest()</code> ist die urspr√ºnglich empfangene <code>future</code> und die Anwendung wird beendet. </li></ol><br><p>  Beachten Sie, dass die asynchrone Funktion sofort (synchron) gestartet wird.  Die Funktion unterbricht die Ausf√ºhrung und gibt eine unvollendete <code>future</code> wenn das erste Auftreten eines der folgenden Ereignisse eintritt: </p><br><ul><li>  Der erste <code>await</code> Ausdruck (nachdem die Funktion aus diesem Ausdruck die unvollst√§ndige <code>future</code> ). </li><li>  Jede <code>return</code> in einer Funktion. </li><li>  Das Ende des Funktionsk√∂rpers. </li></ul><br><h3 id="obrabotka-oshibok">  Fehlerbehandlung </h3><br><p>  H√∂chstwahrscheinlich m√∂chten Sie einen Fehler bei der Ausf√ºhrung der Funktion "abfangen", die die <code>future</code> zur√ºckgibt.  In asynchronen Funktionen k√∂nnen Sie Fehler mit <code>try-catch</code> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Future&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printDailyNewsDigest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> async </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newsDigest = <span class="hljs-function"><span class="hljs-function">await </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gatherNewsReports</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; print(newsDigest); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-comment"><span class="hljs-comment">// Handle error... } }</span></span></code> </pre> <br><p>  Ein <code>try-catch</code> mit asynchronem Code verh√§lt sich genauso wie mit synchronem Code: Wenn der Code im <code>try</code> Block eine Ausnahme <code>try</code> , wird der Code in <code>catch</code> ausgef√ºhrt. </p><br><h3 id="posledovatelnoe-vypolnenie">  Sequentielle Ausf√ºhrung </h3><br><p>  Sie k√∂nnen mehrere <code>await</code> , um sicherzustellen, dass jede Anweisung abgeschlossen ist, bevor Sie Folgendes ausf√ºhren: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Sequential processing using async and await. main() async { await expensiveA(); await expensiveB(); doSomethingWith(await expensiveC()); }</span></span></code> </pre> <br><p>  <code>expensiveB()</code> Funktion <code>expensiveB()</code> wird erst ausgef√ºhrt, wenn die Funktion <code>expensiveA()</code> abgeschlossen ist, und so weiter. </p><br><h2 id="future-api">  Zuk√ºnftige API </h2><br><p>  Bevor <code>async</code> und <code>await</code> in Dart 1.9 hinzugef√ºgt wurden, mussten Sie die <code>Future</code> API verwenden.  Sie k√∂nnen die Verwendung der <code>Future</code> API immer noch in altem Code und in Code sehen, der mehr Funktionen ben√∂tigt als <code>async‚Äìawait</code> zu bieten hat. </p><br><p>  Verwenden Sie die <code>then()</code> -Methode, um asynchronen Code mithilfe der <code>Future</code> API zu schreiben und den R√ºckruf zu registrieren.  Dieser R√ºckruf funktioniert, wenn die <code>future</code> abgeschlossen ist. </p><br><p>  Der folgende Code simuliert das Lesen von Nachrichten aus einer Datei mithilfe der <code>Future</code> API.  √ñffnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DartPad mit der Anwendung</a> , starten Sie und klicken Sie auf KONSOLE, um das Ergebnis anzuzeigen. </p><br><div class="spoiler">  <b class="spoiler_title">Beispielcode</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Copyright (c) 2013, the Dart project authors. Please see the AUTHORS file // for details. All rights reserved. Use of this source code is governed by a // BSD-style license that can be found in the LICENSE file. import 'dart:async'; Future&lt;void&gt; printDailyNewsDigest() { final future = gatherNewsReports(); return future.then(print); // You don't *have* to return the future here. // But if you don't, callers can't await it. } main() { printDailyNewsDigest(); printWinningLotteryNumbers(); printWeatherForecast(); printBaseballScore(); } printWinningLotteryNumbers() { print('Winning lotto numbers: [23, 63, 87, 26, 2]'); } printWeatherForecast() { print("Tomorrow's forecast: 70F, sunny."); } printBaseballScore() { print('Baseball score: Red Sox 10, Yankees 0'); } const news = '&lt;gathered news goes here&gt;'; const oneSecond = Duration(seconds: 1); // Imagine that this function is more complex and slow. :) Future&lt;String&gt; gatherNewsReports() =&gt; Future.delayed(oneSecond, () =&gt; news); // Alternatively, you can get news from a server using features // from either dart:io or dart:html. For example: // // import 'dart:html'; // // Future&lt;String&gt; gatherNewsReportsFromServer() =&gt; HttpRequest.getString( // 'https://www.dartlang.org/f/dailyNewsDigest.txt', // );</span></span></code> </pre> </div></div><br><p>  Beachten Sie, dass wir zuerst <code>printDailyNewsDigest()</code> aufrufen, die Nachrichten jedoch zuletzt gedruckt werden, selbst wenn die Datei nur eine Zeile enth√§lt.  Dies liegt daran, dass der Code, der die Datei liest und druckt, asynchron ausgef√ºhrt wird. </p><br><p>  Diese Anwendung l√§uft wie folgt ab: </p><br><ol><li>  Die Anwendung wird gestartet. </li><li>  Die Hauptfunktion ruft <code>printDailyNewsDigest()</code> , das das Ergebnis nicht sofort <code>gatherNewsReports()</code> , sondern zuerst <code>gatherNewsReports()</code> . </li><li>  <code>gatherNewsReports()</code> beginnt mit dem Lesen von Nachrichten und gibt die <code>future</code> . </li><li>  <code>printDailyNewsDigest()</code> verwendet <code>then()</code> , um einen R√ºckruf zu registrieren, der den am Ende der <code>future</code> erhaltenen Wert als Parameter verwendet.  Der Aufruf <code>then()</code> gibt eine neue <code>future</code> , die mit dem Wert endet, den der R√ºckruf von <code>then()</code> zur√ºckgibt. </li><li>  Die restlichen Ausgabefunktionen werden ausgef√ºhrt.  Da sie synchron sind, wird jede Funktion vollst√§ndig ausgef√ºhrt, bevor zur n√§chsten √ºbergegangen wird.  Beispielsweise werden alle Lottozahlen vor der Wettervorhersage angezeigt. </li><li>  Wenn alle Nachrichten empfangen wurden, endet die von der Funktion <code>gatherNewsReports()</code> <code>future</code> mit einer Zeichenfolge, die die gesammelten Nachrichten enth√§lt. </li><li>  Der in <code>then()</code> in <code>printDailyNewsDigest()</code> angegebene Code wird ausgef√ºhrt, <code>printDailyNewsDigest()</code> Nachrichten zu <code>printDailyNewsDigest()</code> . </li><li>  Die Anwendung wird heruntergefahren. </li></ol><br><blockquote>  Hinweis: In der Funktion <code>printDailyNewsDigest()</code> entspricht der Code <code>future.then(print)</code> dem folgenden: <code>future.then((newsDigest) =&gt; print(newsDigest))</code> . </blockquote><p>  Au√üerdem kann der Code in <code>then()</code> geschweifte Klammern verwenden: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Future&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printDailyNewsDigest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> future = gatherNewsReports(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> future.then((newsDigest) { print(newsDigest); <span class="hljs-comment"><span class="hljs-comment">// Do something else... }); }</span></span></code> </pre> <br><p>  Sie m√ºssen das R√ºckrufargument in <code>then()</code> angeben, auch wenn <code>future</code> vom Typ <code>Future&lt;void&gt;</code> .  Konventionell wird ein nicht verwendetes Argument durch <code>_</code> (Unterstrich) definiert. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> future = printDailyNewsDigest(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> future.then((_) { <span class="hljs-comment"><span class="hljs-comment">// Code that doesn't use the `_` parameter... print('All reports printed.'); });</span></span></code> </pre> <br><h3 id="obrabotka-oshibok-1">  Fehlerbehandlung </h3><br><p>  Mit der <code>Future</code> API k√∂nnen Sie den Fehler mit <code>catchError()</code> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Future&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printDailyNewsDigest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>=&gt; gatherNewsReports().then(print).catchError(handleError);</code> </pre> <br><p>  Wenn die Nachrichten nicht lesbar sind, wird der obige Code wie folgt ausgef√ºhrt: </p><br><ol><li>  <code>future</code> von <code>gatherNewsReports()</code> <code>future</code> schl√§gt fehl. </li><li>  <code>future</code> von <code>then()</code> <code>future</code> schl√§gt fehl, <code>print()</code> nicht aufgerufen. </li><li>  Der <code>catchError()</code> in <code>catchError()</code> ( <code>handleError()</code> ) f√§ngt den Fehler ab, die von <code>catchError()</code> <code>future</code> wird <code>catchError()</code> abgeschlossen und der Fehler breitet sich nicht weiter aus. </li></ol><br><blockquote>  Die <code>then()</code> -Kette - <code>catchError()</code> ist ein g√§ngiges Muster bei Verwendung der <code>Future</code> API.  Betrachten Sie dieses Paar als das √Ñquivalent eines <code>try-catch</code> in der <code>Future</code> API. </blockquote><p>  Wie then () gibt catchError () eine neue <code>future</code> , die mit dem R√ºckgabewert des R√ºckrufs endet.  Um in das Thema <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einzutauchen</a> , lesen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Futures und Fehlerbehandlung</a> . </p><br><h3 id="vyzov-neskolkih-funkciy-vozvraschayuschih-future">  Aufruf mehrerer Funktionen, die die <code>future</code> </h3><br><p>  Betrachten wir drei Funktionen: <code>expensiveA()</code> , <code>expensiveB()</code> , <code>expensiveC()</code> , die die <code>future</code> .  Sie k√∂nnen sie nacheinander aufrufen (eine Funktion startet nach Abschluss der vorherigen) oder Sie k√∂nnen sie alle gleichzeitig ausf√ºhren und etwas tun, sobald alle Werte zur√ºckgegeben werden.  Die Benutzeroberfl√§che von Future ist flexibel genug, um beide Anwendungsf√§lle zu implementieren. </p><br><p>  <strong>Eine Funktionskette ruft mit <code>then()</code></strong> <br>  Wenn die Funktionen, die die <code>future</code> zur√ºckgeben, in der richtigen Reihenfolge ausgef√ºhrt werden m√ºssen, verwenden Sie die Kette von <code>then()</code> : </p><br><pre> <code class="java hljs">expensiveA() .then((aValue) =&gt; expensiveB()) .then((bValue) =&gt; expensiveC()) .then((cValue) =&gt; doSomethingWith(cValue));</code> </pre> <br><p>  Das Anh√§ngen von R√ºckrufen funktioniert ebenfalls, ist jedoch schwieriger zu lesen.  ( <em>Hinweis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://callbackhell.com/</a></em> ) </p><br><p>  <strong>Warten auf den Abschluss mehrerer <code>futures</code> mit <code>Future.wait()</code></strong> <br>  Wenn die Ausf√ºhrungsreihenfolge der Funktionen nicht wichtig ist, k√∂nnen Sie <code>Future.wait()</code> .  Wenn Sie die <code>futures</code> Liste f√ºr Parameter f√ºr die Future.wait () -Funktion angeben, wird sofort die <code>future</code> .  Diese <code>future</code> endet erst, wenn alle angegebenen <code>futures</code> .  Diese <code>future</code> endet mit einer Liste der Ergebnisse aller angegebenen <code>futures</code> . </p><br><pre> <code class="java hljs">Future.wait([expensiveA(), expensiveB(), expensiveC()]) .then((List responses) =&gt; chooseBestResponse(responses, moreInfo)) .catchError(handleError);</code> </pre> <br><p>  Wenn ein Aufruf einer der Funktionen fehlschl√§gt, schl√§gt auch die von <code>Future.wait()</code> <code>future</code> fehl.  Verwenden Sie <code>catchError()</code> , um diesen Fehler <code>catchError()</code> . </p><br><hr><br><h2 id="chto-esche-pochitat">  Was noch zu lesen? </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dart 2. Asynchrone Programmierung: Datenstr√∂me</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442282/">https://habr.com/ru/post/de442282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442270/index.html">5 Fehler, die beim Erstellen von 3D-Modellen f√ºr den 3D-Druck vermieden werden sollten</a></li>
<li><a href="../de442272/index.html">Go + = Paketversionierung</a></li>
<li><a href="../de442274/index.html">Dart 2. Asynchrone Programmierung: Datenstr√∂me</a></li>
<li><a href="../de442278/index.html">Kibana Benutzerhandbuch. Visualisierung. Teil 6</a></li>
<li><a href="../de442280/index.html">Maschinelles Lernen in Dodo. So starten Sie eine neue Richtung, wenn Sie Entwickler sind</a></li>
<li><a href="../de442284/index.html">NoVerify: Der Linter f√ºr PHP vom VKontakte-Team ist jetzt gemeinfrei</a></li>
<li><a href="../de442286/index.html">Russische Augen√§rzte sprachen √ºber bionisches Sehen. Die neue mobile Anwendung demonstriert die Arbeit von Cyber</a></li>
<li><a href="../de442288/index.html">Strahlung: Quellen</a></li>
<li><a href="../de442290/index.html">ST-Link V2.1 aus chinesischem ST-Link V2 erstellen</a></li>
<li><a href="../de442292/index.html">Sberseasons-Praktikum: Python, UX / UI, Daten und vieles mehr f√ºr Studenten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>