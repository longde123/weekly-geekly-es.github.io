<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßùüèø üëà üéè Un bot de todas las preocupaciones ‚úíÔ∏è üè¥‚Äç‚ò†Ô∏è ü§º</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hasta que se adopte la convenci√≥n "Sobre la protecci√≥n de los derechos de una persona inhumana", debe usar esto y dar la rutina de trabajo a los bots....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un bot de todas las preocupaciones</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/456806/">  Hasta que se adopte la convenci√≥n "Sobre la protecci√≥n de los derechos de una persona inhumana", debe usar esto y dar la rutina de trabajo a los bots.  Tiene sentido comenzar en este momento, o despu√©s de 5 a√±os, comenzar√° la sublevaci√≥n de autom√≥viles, las demandas masivas para insultar los sentimientos de los bots con tareas aburridas llenar√°n los tribunales para regular las relaciones hombre-m√°quina.  As√≠ que date prisa. <br><img src="https://habrastorage.org/webt/og/rl/mo/ogrlmoadcpzks4cxhqcjncpweyc.png"><br><blockquote>  La rutina conservadora y el m√©todo de trabajo, la adhesi√≥n servil a un patr√≥n establecido, se convirti√≥ en un h√°bito mec√°nico.  6 letras <br></blockquote><a name="habracut"></a><br>  Hay tal trabajo que no quieres hacer, pero debes hacerlo.  Este art√≠culo no tendr√° insertos grandes con c√≥digo e instrucciones sobre c√≥mo crear su bot desde cero.  Ser√° mejor que le cuente c√≥mo funciona el proceso de lanzamiento en nuestra Dodo Pizza, c√≥mo lo automatizamos y aceleramos, d√°ndole algo de la rutina aburrida a nuestro bot escrito en C #.  Prestar√© atenci√≥n a la funcionalidad y l√≥gica del bot.  Ser√° genial si este material lo inspira a escribir a su asistente, que le facilitar√° la vida a usted y a sus colegas. <br><br>  Hace un par de a√±os lanzamos un lanzamiento una vez por semana.  En mayo de 2018, con una tasa m√°xima de 147 horas para el lanzamiento, establecimos una meta para lanzar todos los d√≠as.  Ahora nuestro m√≠nimo: cuatro horas para lanzar, pero esto no sucede a menudo.  Queremos arreglar el registro y poder reducir todo el proceso con solo presionar un bot√≥n. <br><br><h2>  Ciclo de lanzamiento </h2><br>  Ahora en Dodo IS, siete equipos se turnan para lanzar un lanzamiento.  Una persona del equipo se convierte en "afortunada" - relizmen.  Relizmen como piloto de un avi√≥n: tiene un mont√≥n de palancas y dispositivos que debe manejar h√°bilmente para implementar las pr√≥ximas actualizaciones.  Pensamos y decidimos: "Es hora de hacer un piloto autom√°tico, y ser√° mejor que gastemos nuestro tiempo en algo m√°s emocionante que llenar tablas aburridas con estad√≠sticas y hacer un seguimiento de las pruebas autom√°ticas". <br><br>  Entonces, para convertirse en un relisman, es necesario que su equipo se alinee.  Para que todo estuviera claro y nadie estuviera confundido, pegamos calcoman√≠as con los nombres de los equipos en la pared.  El equipo de lanzamiento recibe una corona honoraria, que movemos con asas cada vez. <br><br>  Despu√©s de recibir la <s>marca de la</s> corona <s>negra,</s> Relismain debe recordar d√≥nde se encuentra la lista de verificaci√≥n de los pasos de liberaci√≥n.  Adem√°s: recordado -&gt; encontrado -&gt; cre√≥ una copia de la plantilla y, finalmente, abri√≥ la lista de verificaci√≥n en el sistema Kaiten.  Kaiten es una placa electr√≥nica en la que, en forma de tarjetas, colocamos y controlamos el estado de las tareas en desarrollo.  Para los nuevos desarrolladores, este procedimiento en su conjunto fue muy obvio.  ¬øY c√≥mo sabe d√≥nde buscar esta hoja de verificaci√≥n y d√≥nde comenzar cuando no hay pistas? <br><br>  Habiendo reunido nuestra voluntad en un pu√±o, decidimos que era suficiente para soportarla.  Es hora de darle algo de la rutina aburrida al bot.  ¬øQui√©n si no nosotros?  ¬øCu√°ndo, si no ahora? <br><br><h2>  Lo que logramos automatizar </h2><br>  Se tom√≥ la decisi√≥n, ¬°es hora de comenzar a dise√±ar nuestro piloto autom√°tico!  Despu√©s de encontrar la API de Kaiten aqu√≠: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://faq.kaiten.io/docs/api</a> , con solo una solicitud, creamos una tarjeta para el nuevo relizmen. <br><br><pre><code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//  POST     var createCardRequest = new RestRequest("https://&lt;domain&gt;.kaiten.io/api/latest/cards/", Method.POST); //     AddBasicAuth(createCardRequest); //        -      createCardRequest.AddJsonBody( new { board_id = _kaitenSettings.ReleasesBoardId, column_id = _kaitenSettings.ReleasesColumnId, lane_id = _kaitenSettings.ReleasesLaneId, title = $"release-{nextReleaseNumber}" } );</span></span></code> </pre> <br>  Ahora esta tarjeta debe ser entregada al equipo que lanzar√° la pr√≥xima. <br><br><blockquote>  La l√≥gica aqu√≠ es: <br><br><ol><li>  La versi√≥n anterior completa la versi√≥n escribiendo un comando para el bot en Slack. </li><li>  El bot toma la identificaci√≥n de Relisman en Slack y busca en qu√© equipo de desarrollo est√° nuestro afortunado.  Para hacer esto, el bot corre a trav√©s de los grupos de usuarios de Slack y analiza en qu√© consiste nuestro lanzamiento. </li><li>  Una vez encontrado el grupo, el bot observa qu√© equipo lanzar√° a continuaci√≥n y env√≠a una alerta al chat general.  En el mensaje, el bot proporciona cuidadosamente un enlace a la lista de verificaci√≥n ya creada para que no vaya a ning√∫n lado. </li></ol></blockquote><br><img src="https://habrastorage.org/webt/ap/wh/ru/apwhrub9rb0yyjd8ypnutxgqlli.png"><br><br><img src="https://habrastorage.org/webt/1y/sb/0i/1ysb0iyt7rvotwmgeedjp82tkm8.png"><br><br>  Genial  Ahora tenemos una idea de qu√© hacer a continuaci√≥n.  Abrimos la lista de verificaci√≥n, la miramos: "Cree un canal para su lanzamiento en Slack, invite a todos los equipos cuyos cambios est√©n en el lanzamiento all√≠ y descubra si necesitar√°n pruebas manuales".  Queda por ense√±ar esto a nuestro bot. <br><br>  Abra la documentaci√≥n de la API de Slack aqu√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://api.slack.com</a> y busque un m√©todo para crear un canal all√≠. <br><br><img src="https://habrastorage.org/webt/4s/pq/nj/4spqnjtah8zglsoss4xtqbp-lzq.png"><br><br>  Como puede ver, en Slack, como en otras herramientas, no hay nada complicado.  Todo se reduce a enviar una solicitud POST con dos par√°metros obligatorios (estos son los opuestos que dice requeridos).  En la solicitud, debemos pasar el nombre del canal creado (nombre del par√°metro) y el token de autorizaci√≥n (token de par√°metro).  Preste atenci√≥n a la l√≠nea "Funciona con: Tipo de token - usuario, alcance (s) requerido (s) - canales: escribir". <br><br>  Slack tiene dos tipos de tokens: emitidos por el usuario para los usuarios y bot emitidos por las aplicaciones.  Al emitir un token, determinamos qu√© derechos otorgar a su propietario.  Para crear canales, necesitamos un token de usuario (tipo de token - usuario), que tiene derechos para escribir canales (canales: escritura). <br><br><blockquote>  Quiero notar un matiz de nuestro env√≠o de mensajes a Slack.  Inicialmente, no pensamos qu√© har√≠amos si algo sal√≠a mal.  Reclutamos un equipo en Slack, y realiza todas las tareas que le asignamos.  ¬øY qu√© suceder√° si en una de las tareas cae el equipo?  En nuestro caso, la respuesta fue: "nada".  Y esto es malo.  La soluci√≥n para nosotros fue escribir en el chat de lanzamiento qu√© acci√≥n se est√° realizando actualmente y, si el comando no se complet√≥, informar un error al chat y registrar el error. </blockquote><br>  La segunda soluci√≥n exitosa fue conectar la base de datos en la que almacenamos el estado de la ejecuci√≥n de las acciones de los comandos.  Ahora, habiendo comenzado una nueva versi√≥n usando el comando "/ startregress", no tememos que algo se caiga, y cuando lo llamas de nuevo, los comandos se ejecutar√°n desde el principio por segunda vez.  No necesitamos crear un nuevo canal en Slack cada vez, hacer una solicitud de extracci√≥n, etc.  Creamos un canal en Slack: registramos el estado de ejecuci√≥n exitosa en la base de datos y ya no volveremos a esta acci√≥n. <br><br><img src="https://habrastorage.org/webt/hb/qa/cn/hbqacnv-qupq_tztgccgathkyri.png"><br><br>  Entonces, al hacer clic en un bot√≥n, creamos un canal de lanzamiento e invitamos a todos all√≠ cuyas tareas ser√°n lanzadas. <br><br>  Los siguientes en la l√≠nea fueron la integraci√≥n con Github y TeamCity.  Trabajamos en Gitflow.  Cuando queremos liberar, tomamos la rama DEV, el funcionamiento = verde = en el que pasan las pruebas, y de all√≠ creamos la rama de liberaci√≥n. <br><br>  Para hacer esto, nuestro bot va a TeamCity, mira all√≠ para lanzar una ejecuci√≥n de prueba para la rama DEV.  Si las pruebas son verdes, como el c√©sped cerca de la casa, vaya a GitHub, cree una rama de lanzamiento y una solicitud de extracci√≥n. <br><br>  Al crear una solicitud de extracci√≥n, debemos agregar una descripci√≥n de los cambios que estamos implementando.  Entonces Kaiten viene en nuestra ayuda.  Nuestro bot crea una columna con el nombre de la versi√≥n, toma tareas de la columna DEV y las mueve a la versi√≥n.  As√≠ que sabemos y vemos lo que ser√° molido con nosotros.  Despu√©s de moverse, el bot copia los nombres de las tarjetas y las agrega a la descripci√≥n de la solicitud de extracci√≥n con referencia a las propias tarjetas.  Ahora podemos ver para cada versi√≥n qu√© tareas sali√≥ y, abriendo la tarjeta a trav√©s del enlace, descubrimos todos los detalles sobre estas tareas. <br><br><img src="https://habrastorage.org/webt/x3/0x/-k/x30x-klbu6uiajhs9bipupayflc.png"><br><br>  Es casi posible liberar, solo queda probar a fondo nuestros cambios.  Para hacer esto, la rama de lanzamiento se implementa en un entorno cercano a la producci√≥n (lo llamamos etapa) y se prueba despu√©s del lanzamiento.  El despliegue y las pruebas se ensamblan en una sola tuber√≠a en TeamCity, y nuestra tarea es lanzarlo y esperar, con los dedos cruzados, que las pruebas funcionen bien.  El bot lanza una tuber√≠a durante el inicio de la regresi√≥n. <br><br>  Perm√≠teme recordarte que comenzamos con el hecho de que todo esto se hizo manualmente.  Apretando los pu√±os, Relizmen activ√≥ los enlaces y las herramientas: TeamCity, Kaiten, Slack, Github y eso no es todo.  Y ahora tenemos todo un conjunto de acciones a partir de las cuales el primer equipo para el bot ya est√° formado.  El lanzador escribe "/ startregress" y, recost√°ndose en su silla, observa a nuestro bot: <br><br><ul><li>  crea un canal en el messenger </li><li>  llama a todos los que necesitas </li><li>  comprueba si se puede crear una solicitud de extracci√≥n </li><li>  crea una solicitud de extracci√≥n y completa su descripci√≥n </li><li>  crea una columna de liberaci√≥n en un tablero electr√≥nico y mueve las tarjetas de tareas all√≠ </li><li>  lanza una tuber√≠a que liberar√° la rama de liberaci√≥n al medio ambiente y ejecutar√° pruebas all√≠ </li></ul><br>  Analizamos todo el proceso de lanzamiento, anotamos cu√°nto tiempo lleva cada etapa del lanzamiento.  Esto le da al desarrollo y al negocio una comprensi√≥n de qu√© tiempo se desperdicia y qu√© nos impide ofrecer nuevas funciones a los usuarios.  ¬°Estamos sentados dos d√≠as y no podemos ejecutar las pruebas!  Entonces, algo est√° mal con nuestras pruebas, debe darles m√°s tiempo y atenci√≥n.  Anteriormente, realizando las acciones de nuestra lista de verificaci√≥n, visitamos Google Sheets al menos 5 veces.  Cada vez que ingrese una fecha all√≠ y establezca la hora. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mu/fq/6d/mufq6drstsaqsbrb3m6mme6piei.png"></div><br>  Ok Google, ¬°tambi√©n te automatizaremos!  Para trabajar f√°cilmente y sin esfuerzo con tablas, conectamos el paquete nuget Google.Apis.Sheets.v4 al proyecto de nuestro bot.  Y luego todo sucede de manera similar con otros servicios de acuerdo con el esquema: enviamos una solicitud en la que decimos qu√© valor insertar en qu√© celda.  Esta consulta se ve as√≠: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> void <span class="hljs-type"><span class="hljs-type">InsertEntry</span></span>(string cellAddress, string value) { <span class="hljs-comment"><span class="hljs-comment">//          - _googleSettings.SheetName        - cellAddress var range = $"{_googleSettings.SheetName}!{cellAddress}"; var valueRange = new ValueRange(); //        - value var objectsList = new List&lt;object&gt; {$"{value}"}; valueRange.Values = new List&lt;IList&lt;object&gt;&gt; {objectsList}; //    Google.Apis.Sheets.v4           SpreadsheetId var insertEntryRequest = _service.Spreadsheets.Values.Update(valueRange, _googleSettings.SpreadsheetId, range); insertEntryRequest.ValueInputOption = SpreadsheetsResource.ValuesResource.UpdateRequest.ValueInputOptionEnum.USERENTERED; insertEntryRequest.Execute(); }</span></span></code> </pre> <br>  Despu√©s de configurar la integraci√≥n con Google, preparamos el segundo comando de nuestro bot "/ update" y esto es lo que hace: <br><br><ul><li>  agrega una cadena vac√≠a para insertar valores en ella </li><li>  va a GitHub, mira cuando crearon la rama de lanzamiento y agrega la fecha de su creaci√≥n a la tableta </li><li>  de TeamCity toma datos sobre el primer inicio de la tuber√≠a e informaci√≥n sobre cu√°ndo la tuber√≠a se complet√≥ con √©xito </li></ul><br>  El siguiente paso es el lanzador lanza el lanzamiento.  Ahora el c√°lculo se realiza manualmente.  Habiendo presentado un pa√≠s, observamos c√≥mo se comporta el lanzamiento en la batalla.  Despu√©s de asegurarnos de que todo est√© bien de acuerdo con los registros y las herramientas de monitoreo de Kibana y Grafana, publicamos el pr√≥ximo pa√≠s.  Este proceso no es tan f√°cil de automatizar.  Pero aqu√≠ hay algo que mejorar, aunque no con la ayuda de un bot.  Por ejemplo, antes, cada vez que le pregunt√°bamos al equipo de infraestructura si era posible lanzarlo.  Porque cuando √≠bamos a hacer esto, otro trabajo podr√≠a llevarse a cabo en nuestros servidores y nuestro lanzamiento habr√≠a sido inapropiado. <br><br>  Hemos organizado una reuni√≥n para optimizar el proceso de lanzamiento.  Una de las soluciones fue que ahora el lanzador simplemente mira el estado en uno de los canales de Slack, donde la infraestructura publica el permiso para despegar.  Esto es m√°s conveniente que preguntar constantemente lo mismo y, en el 90% de los casos, obtener la respuesta "Puedes". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tf/mi/dc/tfmidcakdy0dn1m2q9ywvgqb9g4.png"></div><br>  Por alguna raz√≥n, tales cosas aparentemente elementales no me vinieron a la mente de inmediato.  Se debe agradecer especialmente a los nuevos desarrolladores de la empresa.  Habiendo venido a nosotros, tarde o temprano se convirtieron en relismen.  Para los muchachos que trabajaron con nosotros durante mucho tiempo, el proceso no parec√≠a ser algo complicado, sino algo familiar.  Los nuevos miembros del equipo centraron nuestra atenci√≥n en los puntos de crecimiento y participaron activamente en la organizaci√≥n del trabajo sobre mejoras. <br><br>  Mientras tanto, hemos llegado a la √∫ltima etapa.  Nuestro lanzamiento de l√≠nea ha aterrizado, solo un equipo "/ releasecomplete" nos separa del final.  ¬øQu√© hace ella? <br><br><ul><li>  solicitud de extracci√≥n de mergit con liberaci√≥n a la rama maestra </li><li>  elimina la rama de liberaci√≥n </li><li>  crea una descripci√≥n de lanzamiento en github </li><li>  canal de lanzamiento de archivo en Slack </li><li>  mueve las tarjetas en Kaiten desde la columna "liberar -..." a la columna "Listo" y elimina la columna de liberaci√≥n </li><li>  pasa el testigo, invitando a liberar el siguiente comando </li></ul><br>  Para resumir, me gustar√≠a que se haga la pregunta: ¬øtiene procesos de rutina aburridos?  ¬øTodav√≠a los est√°s haciendo con tus manos?  ¬øQu√© te impide terminar esto de una vez por todas?  Re√∫na una reuni√≥n, revise los procesos, deseche todo lo que no necesita y se ha convertido en un ritual.  Al automatizar todo lo que necesita, comenzar√° a disfrutar de lo que duele antes, y ahorrar√° hasta el mont√≥n acelerando la liberaci√≥n o cualquier otro proceso. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456806/">https://habr.com/ru/post/456806/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456792/index.html">Implemente Kubernetes Cluster en OpenStack con Kubespray</a></li>
<li><a href="../456794/index.html">Arquitectura de la interfaz de usuario web: un pasado de madera, un presente extra√±o y un futuro brillante</a></li>
<li><a href="../456796/index.html">Svalbard - nuevo nombre para el proyecto Have I Been Pwned antes de la venta</a></li>
<li><a href="../456798/index.html">Tutoriales de SDL 2: Lecci√≥n 5 - Texturas</a></li>
<li><a href="../456804/index.html">Siga el dinero: c√≥mo el grupo RTM comenz√≥ a ocultar las direcciones de los servidores C&C en una billetera criptogr√°fica</a></li>
<li><a href="../456808/index.html">C√≥mo mejorar el rendimiento de las aplicaciones web front-end: cinco consejos</a></li>
<li><a href="../456810/index.html">Los primeros Una historia libre de Tesla</a></li>
<li><a href="../456812/index.html">Qu√© hay en la Universidad ITMO: festivales de TI, hackatones, conferencias y seminarios abiertos</a></li>
<li><a href="../456814/index.html">Aprenda programaci√≥n funcional en Python en 10 minutos</a></li>
<li><a href="../456818/index.html">El administrador del sistema en una empresa inaccesible. ¬øLa insoportable carga del ser?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>