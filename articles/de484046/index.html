<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§πüèº üë©üèø‚Äçüíª üôç Emby mit PVS-Studio √ºberpr√ºfen üë®üèæ‚Äçüöí üóæ üìê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Emby ist neben Plex und Kodi ein sehr beliebter Medienserver. In diesem Artikel diskutieren wir die Fehler, die in seinem Quellcode mit dem statischen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Emby mit PVS-Studio √ºberpr√ºfen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/484046/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/ar/h3/rrarh3smm2vkgpopwdn2fgqan0s.png" alt="Bild 3"></div><br>  Emby ist neben Plex und Kodi ein sehr beliebter Medienserver.  In diesem Artikel diskutieren wir die Fehler, die in seinem Quellcode mit dem statischen Analysator PVS-Studio gefunden wurden.  Die Bemerkung "Built with ReSharper" auf der offiziellen Website des Projekts macht die Analyse noch interessanter. <br><a name="habracut"></a><br><h2>  PVS-Studio </h2><br>  PVS-Studio kann auf 64-Bit-Windows-, Linux- und MacOS-Systemen ausgef√ºhrt werden.  Es kann Fehler im Quellcode von Software erkennen, die in C, C ++, C # und Java geschrieben wurde. <br><br><h2>  Das zu analysierende Projekt </h2><br>  Emby ist ein Medienserver;  Der Quellcode ist auf <a href="https://github.com/MediaBrowser/Emby">GitHub</a> verf√ºgbar.  Der Benutzer kann auf jedem Ger√§t Medieninhalte (Video, Audio, Fotos) streamen und darauf zugreifen.  Hier ist eine kurze Zusammenfassung der <a href="https://emby.media/">Funktionen</a> von <a href="https://emby.media/">Emby</a> gem√§√ü der offiziellen Website des Projekts: <br><br><ul><li>  Emby konvertiert und streamt Ihre Medien automatisch, um sie auf jedem Ger√§t wiederzugeben. </li><li>  Umfangreiche Optionen f√ºr die Kindersicherung f√ºr eine einfache Inhaltszugriffskontrolle, die f√ºr Familien mit kleinen Kindern wichtig ist. </li><li>  Emby organisiert Ihre Inhalte in einfachen und eleganten Pr√§sentationen.  Ihre pers√∂nlichen Medien werden niemals gleich aussehen. </li><li>  Streaming mit Cloud-Sync-Unterst√ºtzung; </li><li>  Einfaches Teilen von Inhalten mit Freunden und Familie; </li><li>  Und vieles mehr. </li></ul><br><h2>  Die interessantesten Codefragmente, die vom Analysator gemeldet wurden </h2><br>  <b>PVS-Studio-Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3001/">V3001</a> Es gibt identische Unterausdr√ºcke 'c! =' &lt;'' Links und rechts vom Operator '&amp;&amp;'.  HttpListenerRequest.Managed.cs 49 <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRequestLine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ic &gt;= <span class="hljs-string"><span class="hljs-string">'A'</span></span> &amp;&amp; ic &lt;= <span class="hljs-string"><span class="hljs-string">'Z'</span></span>) || (ic &gt; <span class="hljs-number"><span class="hljs-number">32</span></span> &amp;&amp; c &lt; <span class="hljs-number"><span class="hljs-number">127</span></span> &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">'('</span></span> &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">')'</span></span> &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span> &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= c != '&lt;' &amp;&amp; c != '&gt;' &amp;&amp; c != '@' &amp;&amp; c != ',' &amp;&amp; c != ';' &amp;&amp; // &lt;= c != ':' &amp;&amp; c != '\\' &amp;&amp; c != '"' &amp;&amp; c != '/' &amp;&amp; c != '[' &amp;&amp; c != ']' &amp;&amp; c != '?' &amp;&amp; c != '=' &amp;&amp; c != '{' &amp;&amp; c != '}')) continue; .... }</span></span></code> </pre> <br>  Der Analysator hat einen doppelten Unterausdruck <i>c! = '&lt;'</i> Festgestellt.  Eine Erkl√§rung ist, dass dies ein Programmierfehler ist und der Entwickler etwas anderes anstelle von <i>'&lt;'</i> schreiben wollte.  Eine andere, wahrscheinlichere Erkl√§rung ist, dass der zweite Unterausdruck √ºberhaupt nicht vorhanden war und entfernt werden sollte. <br><br>  <b>PVS-Studio Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3001/">V3001</a> Es gibt identische Unterausdr√ºcke 'SmbConstants.AttrHidden' links und rechts vom '|'  Betreiber.  SmbComDelete.cs 29 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SmbComDelete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { Path = fileName; Command = SmbComDelete; _searchAttributes = SmbConstants.AttrHidden | SmbConstants.AttrHidden | SmbConstants.AttrSystem; }</code> </pre> <br>  Ein weiterer Tippfehler, der mit doppelten Unterausdr√ºcken zu tun hat.  Nebenbei bemerkt, es gibt zu viele Probleme wie diese in Embys Quellcode - Fehler, die durch Unachtsamkeit verursacht werden.  Ich beschuldige die Entwickler jedoch nicht.  Manchmal k√∂nnen wir alle geistesabwesend sein ( <a href="https://www.viva64.com/en/examples/v501/">Beispiele</a> , <a href="https://www.viva64.com/en/examples/v3001/">Beispiele</a> , <a href="https://www.viva64.com/en/examples/v6001/">Beispiele</a> ), und genau deshalb gibt es statische Analysen - um uns vor unseren eigenen Fehlern zu sch√ºtzen. <br><br>  <b>PVS-Studio Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3004/">V3004</a> Die Anweisung 'then' entspricht der Anweisung 'else'.  SqliteItemRepository.cs 5648 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> QueryResult&lt;Tuple&lt;BaseItem, ItemCounts&gt;&gt; GetItemValues(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typesToCount.Length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { whereText += <span class="hljs-string"><span class="hljs-string">" And CleanName In (Select CleanValue from ItemValues where "</span></span> + typeClause + <span class="hljs-string"><span class="hljs-string">" AND ItemId in (select guid from TypedBaseItems"</span></span> + innerWhereText + <span class="hljs-string"><span class="hljs-string">"))"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//whereText += " And itemTypes not null"; whereText += " And CleanName In (Select CleanValue from ItemValues where " + typeClause + " AND ItemId in (select guid from TypedBaseItems" + innerWhereText + "))"; } .... }</span></span></code> </pre> <br>  Und dieser sieht einem Copy-Paste-Bug sehr √§hnlich, da die <i>if-</i> und <i>else-</i> Bl√∂cke dieselben K√∂rper haben.  Was <i>n√ºtzt es,</i> die Gr√∂√üe des <i>typesToCount-</i> Arrays zu √ºberpr√ºfen, wenn dies die nachfolgende Ausf√ºhrungslogik nicht beeinflusst?  Das wissen nur die Autoren. <br><br>  <b>PVS-Studio Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3005/">V3005</a> Die Variable '_validProviderIds' ist sich selbst zugeordnet.  BaseNfoParser.cs 77 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; _validProviderIds; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... _validProviderIds = _validProviderIds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;....&gt;(....); .... }</code> </pre> <br>  Ein weiterer Tippfehler, der dazu f√ºhrt, dass eine Variable einen eigenen Wert erh√§lt.  Dieser Code muss √ºberarbeitet werden. <br><br>  <b>PVS-Studio-Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3008/">V3008</a> Der Variablen 'Chapters' werden zweimal nacheinander Werte zugewiesen.  Vielleicht ist das ein Fehler.  Check lines: 29, 28. Title.cs 29 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Title</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> titleNum</span></span></span><span class="hljs-function">)</span></span> { ProgramChains = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ProgramChain&gt;(); Chapters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Chapter&gt;(); Chapters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Chapter&gt;(); TitleNumber = titleNum; }</code> </pre> <br>  Es geht wieder um Unaufmerksamkeit und Tippfehler ... Den <i>Chapters-</i> Variablen wird zweimal ein Wert zugewiesen.  Sicher, diese doppelte Zuweisung wird keinen Schaden anrichten, aber Sie m√∂chten immer noch nicht, dass in Ihrem Code solche Dinge vorkommen.  Es hat keinen Sinn, sich mit dieser Sache zu besch√§ftigen, also lasst uns weitermachen. <br><br>  <b>PVS-Studio-Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3013/">V3013</a> Es ist merkw√ºrdig, dass der Hauptteil der Funktion 'Lesen' dem Hauptteil der Funktion 'Schreiben' (407, Zeile 415) vollst√§ndig entspricht.  BaseSqliteRepository.cs 407 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDisposable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Read</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ReaderWriterLockSlim obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteLockToken(obj); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDisposable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Write</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ReaderWriterLockSlim obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteLockToken(obj); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WriteLockToken</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ReaderWriterLockSlim _sync; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLockToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReaderWriterLockSlim sync</span></span></span><span class="hljs-function">)</span></span> { _sync = sync; sync.EnterWriteLock(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_sync != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _sync.ExitWriteLock(); _sync = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br>  Die Funktionen <i>Lesen</i> und <i>Schreiben</i> haben die gleichen K√∂rper, und das sagt uns der Analysator.  Die <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.enterwritelock%3Fview%3Dnetframework-4.8"><i>EnterWriteLock-</i></a> Methode wird verwendet, um die Sperre im Schreibmodus einzugeben.  Wenn Sie die Sperre im Lesemodus eingeben m√∂chten, verwenden Sie die <i>EnterReadLock-</i> Methode, mit der eine Ressource von mehreren Threads gleichzeitig gelesen werden kann. <br><br>  Die Entwickler sollten diesen Code √ºberpr√ºfen, da er sehr wahrscheinlich einen Fehler enth√§lt - zumal im Code eine nicht verwendete Klasse enthalten ist: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReadLockToken</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ReaderWriterLockSlim _sync; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadLockToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReaderWriterLockSlim sync</span></span></span><span class="hljs-function">)</span></span> { _sync = sync; sync.EnterReadLock(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_sync != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _sync.ExitReadLock(); _sync = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br>  <b>PVS-Studio-Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3021/">V3021</a> Es gibt zwei "if" <a href="https://www.viva64.com/en/w/v3021/">-Anweisungen</a> mit identischen Bedingungsausdr√ºcken.  Die erste 'if'-Anweisung enth√§lt die Methode return.  Dies bedeutet, dass die zweite "if" -Anweisung sinnlos ist. SkiaEncoder.cs 537 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EncodeImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inputPath, DateTime dateModified, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outputPath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> autoOrient, ImageOrientation? orientation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> quality, ImageProcessingOptions options, ImageFormat selectedOutputFormat</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(inputPath)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"inputPath"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(inputPath)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"outputPath"</span></span>); } .... }</code> </pre> <br>  Der Entwickler muss die ersten vier Zeilen geklont haben, aber vergessen haben, den Namen der gepr√ºften Variablen von <i>inputPath</i> in <i>outputPath</i> zu <i>√§ndern</i> .  Es gibt mehrere Zeilen weiter, in denen <i>outputPath</i> ohne vorherige <i>Nullpr√ºfung</i> verwendet wird, was bedeutet, dass m√∂glicherweise eine Ausnahme ausgel√∂st wird. <br><br>  <b>PVS-Studio Diagnosemeldungen:</b> <br><br><ul><li>  V3022 Der Ausdruck 'processUnsupportedFrame (frame, CloseStatusCode.PolicyViolation, null)' ist immer falsch.  WebSocket.cs 462 </li><li>  V3022 Der Ausdruck 'processCloseFrame (frame)' ist immer falsch.  WebSocket.cs 461 </li><li>  V3022 Ausdruck 'frame.IsClose?  processCloseFrame (frame): processUnsupportedFrame (frame, CloseStatusCode.PolicyViolation, null) 'ist immer false.  WebSocket.cs 460 </li><li>  V3022 Der Ausdruck 'processPongFrame (frame)' ist immer wahr.  WebSocket.cs 459 </li><li>  V3022 Der Ausdruck 'processPingFrame (frame)' ist immer wahr.  WebSocket.cs 457 </li><li>  V3022 Der Ausdruck 'processDataFrame (frame)' ist immer wahr.  WebSocket.cs 455 </li><li>  V3022 Ausdruck ist immer falsch.  WebSocket.cs 448 </li></ul><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processWebSocketFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> frame.IsCompressed &amp;&amp; _compression == CompressionMethod.None ? processUnsupportedFrame(....) : frame.IsFragmented ? processFragmentedFrame(frame) : frame.IsData ? processDataFrame(frame) : frame.IsPing ? processPingFrame(frame) : frame.IsPong ? processPongFrame(frame) : frame.IsClose ? processCloseFrame(frame) : processUnsupportedFrame(....); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processUnsupportedFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { processException(....); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDataFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processPingFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mask = Mask.Unmask; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processPongFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { _receivePong.Set(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processCloseFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = frame.PayloadData; close(payload, !payload.ContainsReservedCloseStatusCode, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Ich habe bisher weniger Projekte √ºberpr√ºft als meine PVS-Studio-Teamkollegen, und dies erkl√§rt wahrscheinlich, warum ich noch nie einen Codeausschnitt von 13 Zeilen gesehen habe, der 7 Warnungen gleichzeitig ausl√∂sen w√ºrde (d. H. Etwas mehr als eine Warnung pro zwei Zeilen).  Deshalb f√ºge ich diesen Fall in den Artikel ein.  Im Folgenden finden Sie eine schrittweise Analyse des Problemfragments. <br><br><ol><li>  Der Ausdruck <i>frame.IsCompressed &amp;&amp; _compression == CompressionMethod.None</i> wird zuerst ausgewertet.  Wenn dies der Fall ist, wird die <i>processUnsupportedFrame-</i> Methode ausgef√ºhrt und in jedem Fall <i>false zur√ºckgegeben</i> (dies ist die erste Warnung).  Wenn die Pr√ºfung <i>falsch ist</i> , fahren wir mit der n√§chsten fort. </li><li>  Der Wert <i>frame.IsFragmented</i> wird gepr√ºft.  Keine Probleme hier. </li><li>  Der Wert <i>frame.IsData</i> wird gepr√ºft.  Wenn dies der Fall ist, gibt die <i>processDataFrame-</i> Methode in jedem Fall <i>true</i> zur√ºck.  Dies ist die zweite Warnung. </li><li>  Der Wert <i>frame.IsPing</i> wird gepr√ºft.  Wenn dies der Fall ist, gibt die <i>processPingFrame-</i> Methode <i>true zur√ºck</i> .  Dies ist die dritte Warnung. </li><li>  Der Wert <i>frame.IsPong</i> wird gepr√ºft.  Gleich wie der vorherige. </li><li>  Der letzte: <i>frame.IsClose</i> .  <i>processCloseFrame</i> und <i>processUnsupportedFrame</i> geben in jedem Fall <i>false</i> zur√ºck. </li></ol><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/ut/pe/squtpenxx02rmgsg31uyqk7yt6q.png" alt="Bild 1"></div><br>  Ich hoffe, es war nicht zu langweilig, um zu folgen.  Die restlichen Beispiele sind nicht so kompliziert. <br><br>  <b>PVS-Studio-Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3085/">V3085</a> Der Name des Felds 'RtpHeaderBytes' in einem verschachtelten Typ ist nicht eindeutig.  Der √§u√üere Typ enth√§lt ein statisches Feld mit identischem Namen.  HdHomerunUdpStream.cs 200 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HdHomerunUdpStream</span></span> : <span class="hljs-title"><span class="hljs-title">LiveStream</span></span>, <span class="hljs-title"><span class="hljs-title">IDirectStreamProvider</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RtpHeaderBytes = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UdpClientStream</span></span> : <span class="hljs-title"><span class="hljs-title">Stream</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RtpHeaderBytes = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PacketSize = <span class="hljs-number"><span class="hljs-number">1316</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> MediaBrowser.Model.Net.ISocket _udpClient; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> disposed; .... } .... }</code> </pre> <br>  Die verschachtelte Klasse <i>UdpClientStream</i> verf√ºgt √ºber ein Feld, dessen Name mit dem eines Felds der einschlie√üenden Klasse <i>HdHomerunUdpStream identisch ist</i> .  Es ist kein Fehler, aber es ist ein guter Grund, diesen Code erneut zu √ºberpr√ºfen, um sicherzustellen, dass er korrekt ist.  Wenn Sie Variablen mit identischen Namen haben, k√∂nnen Sie leicht versehentlich eine von ihnen anstelle der anderen verwenden, was zu einem unerwarteten Verhalten des Programms f√ºhrt, w√§hrend der Compiler kein Wort sagt. <br><br>  <b>PVS-Studio Diagnosemeldungen:</b> <br><br><ul><li>  V3090 Unsichere Verriegelung eines Typs.  Alle Instanzen eines Typs haben dasselbe 'Type'-Objekt.  Lmhosts.cs 49 </li><li>  V3090 Unsichere Verriegelung eines Typs.  Alle Instanzen eines Typs haben dasselbe 'Type'-Objekt.  Lmhosts.cs 57 </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Lmhosts</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NbtAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> host</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Lmhosts)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetByName(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Name(host, <span class="hljs-number"><span class="hljs-number">0x20</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>)); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NbtAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Name name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Lmhosts)) { .... } } }</code> </pre> <br>  Der Analysator warnt hier vor einer unsicheren Sperre.  Die Verwendung der <i>Sperre</i> auf diese Weise wird nicht empfohlen, da das Sperrobjekt √∂ffentlich zug√§nglich ist und an einer anderen Stelle gesperrt werden kann, und der Entwickler, der dieses Objekt zum ersten Mal verwendet hat, dies m√∂glicherweise nie wei√ü.  Dies kann zu einem Deadlock f√ºhren. <br><br>  Idealerweise sollten Sie ein privates Feld zum Sperren verwenden, zum Beispiel: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Object locker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NbtAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> host</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (locker) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetByName(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Name(host, <span class="hljs-number"><span class="hljs-number">0x20</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>)); } }</code> </pre> <br>  <b>PVS-Studio Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3142/">V3142</a> Unerreichbarer Code erkannt.  M√∂glicherweise liegt ein Fehler vor.  HdHomerunHost.cs 621 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;ILiveStream&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetChannelStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enableHttpStream = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (enableHttpStream) { mediaSource.Protocol = MediaProtocol.Http; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> httpUrl = channelInfo.Path; <span class="hljs-comment"><span class="hljs-comment">// If raw was used, the tuner doesn't support params if (!string.IsNullOrWhiteSpace(profile) &amp;&amp; !string.Equals(profile, "native", StringComparison.OrdinalIgnoreCase)) { httpUrl += "?transcode=" + profile; } mediaSource.Path = httpUrl; return new SharedHttpStream(....); } return new HdHomerunUdpStream(....); }</span></span></code> </pre> <br>  Der Analysator sagt, dass die letzte Zeile in diesem Snippet niemals ausgef√ºhrt wird.  Und was ist der Zweck, die Variable enableHttpStream zu deklarieren, ihr <i>true</i> zuzuweisen und sie anschlie√üend zu √ºberpr√ºfen? <br><br>  Vielleicht ist dieser Code einfach redundant, muss aber trotzdem √ºberarbeitet werden. <br><br>  <b>PVS-Studio Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3083/">V3083</a> Unsicherer Aufruf des Ereignisses 'RefreshStarted', NullReferenceException ist m√∂glich.  √úberlegen Sie, ob Sie einer lokalen Variablen ein Ereignis zuweisen m√∂chten, bevor Sie sie aufrufen.  ProviderManager.cs 943 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRefreshStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BaseItem item</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RefreshStarted != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { RefreshStarted(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericEventArgs&lt;BaseItem&gt;(item)); } }</code> </pre> <br>  Der Analyzer warnt uns vor einem m√∂glicherweise unsicheren Aufruf des <i>RefreshStarted-</i> Ereignishandlers. <br><br>  Lassen Sie uns herausfinden, warum dieser Aufruf unsicher ist.  Angenommen, das Ereignis wird momentan in einem anderen Thread abbestellt, zwischen dem √úberpr√ºfen des Ereignisses auf Null und dem Aufrufen des Ereignishandlers im Hauptteil der <i>if-</i> Anweisung.  Wenn keine Abonnenten mehr vorhanden sind, wird das <i>RefreshStarted-</i> Ereignis zu <i>null</i> , aber in dem Thread, in dem die <i>Nullpr√ºfung</i> bereits bestanden wurde, wird der Aufruf trotzdem ausgef√ºhrt: <br><br><pre> <code class="cs hljs">RefreshStarted(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericEventArgs&lt;BaseItem&gt;(item));</code> </pre> <br>  Dies f√ºhrt dazu, dass eine <i>NullReferenceException ausgel√∂st wird</i> . <br><br>  <b>PVS-Studio Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3029/">V3029</a> Die bedingten Ausdr√ºcke der <a href="https://www.viva64.com/en/w/v3029/">nebeneinander stehenden</a> ' <a href="https://www.viva64.com/en/w/v3029/">if'</a> -Anweisungen sind identisch.  √úberpr√ºfen Sie die Zeilen: 142, 152. LocalImageProvider.cs 142 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PopulateImages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-comment"><span class="hljs-comment">// Logo if (!isEpisode &amp;&amp; !isSong &amp;&amp; !isPerson) { added = AddImage(....); if (!added) { added = AddImage(....); } } // Art if (!isEpisode &amp;&amp; !isSong &amp;&amp; !isPerson) { AddImage(....); } .... }</span></span></code> </pre> <br>  Die beiden <i>if-</i> Anweisungen haben identische Bedingungen, aber unterschiedliche K√∂rper.  Ich bin nicht sicher, ob dies ein Fehler oder nur redundanter Code ist.  Vielleicht ist es in Ordnung und der Entwickler wollte einfach explizit zwischen zwei Aktionen unterscheiden, von denen eine mit "Logo" und die andere mit "Art" zu tun hat, was auch immer diese sind. <br><br>  <b>PVS-Studio-Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3041/">V3041</a> Der Ausdruck wurde implizit vom Typ 'int' in den Typ 'double' umgewandelt.  Erw√§gen Sie die Verwendung einer expliziten Typumwandlung, um den Verlust eines Bruchteils zu vermeiden.  Ein Beispiel: double A = (double) (X) / Y;  LiveTvManager.cs 1085 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshChannelsInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> progressPerService = _services.Length == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> / _services.Length; .... }</code> </pre> <br>  Dieser Code enth√§lt eine Ganzzahldivision, wobei der resultierende Wert in einen Gleitkommatyp umgewandelt wird, was anscheinend nicht richtig ist. <br><br>  Tats√§chlich hat die <i>progressPerService-</i> Variable nur dann den Wert 1.0, wenn <i>_services.Length = 1 ist</i> .  Bei jedem anderen Wert von <i>_services.Length</i> ist das Ergebnis <i>0.0</i> . <br><br>  Ich denke, stattdessen sollte folgendes geschrieben werden: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> progressPerService = _services.Length == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)<span class="hljs-number"><span class="hljs-number">1</span></span> / _services.Length;</code> </pre> <br>  <b>PVS-Studio Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3050/">V3050</a> M√∂glicherweise falsches HTML.  Das &lt;/ u&gt; schlie√üende Tag wurde gefunden, w√§hrend das &lt;/ i&gt; -Tag erwartet wurde.  SrtParserTests.cs 64 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestParse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> expectedSubs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SubtitleTrackInfo { TrackEvents = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SubtitleTrackEvent[] { .... <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SubtitleTrackEvent { Id = <span class="hljs-string"><span class="hljs-string">"6"</span></span>, StartPositionTicks = <span class="hljs-number"><span class="hljs-number">330000000</span></span>, EndPositionTicks = <span class="hljs-number"><span class="hljs-number">339990000</span></span>, Text = <span class="hljs-string"><span class="hljs-string">"This contains nested &lt;b&gt;bold, &lt;i&gt;italic, &lt;u&gt;underline&lt;/u&gt; and &lt;s&gt;strike-through&lt;/s&gt;&lt;/u&gt;&lt;/i&gt;&lt;/b&gt; HTML tags"</span></span> }, .... } }; }</code> </pre> <br>  Beachten Sie diese Zeile: <br><br><pre> <code class="cs hljs">&lt;u&gt;underline&lt;/u&gt;</code> </pre> <br>  Es hat bereits ein schlie√üendes Tag <i>&lt;/ u&gt;</i> . <br>  Dann sehen wir den folgenden Text: <br><pre> <code class="cs hljs">&lt;/s&gt;&lt;/u&gt;&lt;/i&gt;&lt;/b&gt; HTML tags<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre> <br>  Es gibt hier ein zus√§tzliches schlie√üendes Tag <i>&lt;/ u&gt;</i> , worauf der Analysator hinweist. <br><br>  <b>PVS-Studio Diagnosemeldung:</b> <a href="https://www.viva64.com/en/w/v3051/">V3051</a> Eine √ºberm√§√üige Typpr√ºfung.  Das Objekt ist bereits vom Typ 'Ausnahme'.  SmbFileInputStream.cs 107 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IOException </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SeToIoe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SmbException se</span></span></span><span class="hljs-function">)</span></span> { IOException ioe = se; Exception root = se.GetRootCause(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (root <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> TransportException) { ioe = (TransportException)root; root = ((TransportException)ioe).GetRootCause(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (root <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Exception) { ioe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(root.Message); ioe.InitCause(root); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ioe; }</code> </pre> <br>  Ehrlich gesagt verstehe ich nicht ganz, was der Entwickler mit diesem Code gemeint hat.  Der Analysator sagt, dass die Bedingung der zweiten <i>if-</i> Anweisung pr√ºft, ob das Stammobjekt mit seinem eigenen Typ kompatibel ist.  Dies ist wahrscheinlich nur redundanter Code, aber er sieht seltsam aus und ich empfehle, ihn zu √ºberarbeiten. <br><br><h2>  Fazit </h2><br>  Die Entwickler von Emby haben in jeder Hinsicht gro√üartige Arbeit geleistet (das Projekt hat eine L√§nge von 215.539 LOC, wovon 4,6% Kommentare sind).  Sie haben es gut gemacht, ich meine es ernst.  Aber PVS-Studio verdient auch Lob: Es wurden 113 High- <a href="https://www.viva64.com/en/m/0007/">Level-</a> , 213 Medium-Level- und 112 Low-Level-Warnungen ausgegeben.  Einige von ihnen waren falsch positiv, aber die meisten Fehler wurden hier nicht erw√§hnt, weil sie sehr √§hnlich waren.  Beispielsweise wurde <a href="https://www.viva64.com/en/w/v3022/">allein die</a> Diagnose <a href="https://www.viva64.com/en/w/v3022/">V3022</a> (immer falsch / wahr) 106-mal ausgel√∂st.  Nat√ºrlich h√§tte ich die Fehlalarme herausfiltern und den Rest in den Artikel aufnehmen k√∂nnen, aber es w√§re zu langweilig geworden, um ihn zu lesen. <br><br>  Ich hoffe, ich konnte zeigen, wie statische Analyse bei der Softwareentwicklung hilft.  Einmalige Kontrollen reichen nat√ºrlich nicht aus.  Sie sollten regelm√§√üig statische Analysen durchf√ºhren.  Dieses Thema wird im Artikel " <a href="https://www.viva64.com/en/b/0594/">Godot: Zur regelm√§√üigen Verwendung von statischen Analysatoren</a> " ausf√ºhrlicher behandelt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484046/">https://habr.com/ru/post/de484046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484020/index.html">Wen m√∂chten Sie mit Ihren Terminen beeindrucken?</a></li>
<li><a href="../de484026/index.html">Teil 6: MemTest86 + nach RISC-V portieren</a></li>
<li><a href="../de484028/index.html">Horseshoe Bend - Cabrio-Tablet mit Klappdisplay</a></li>
<li><a href="../de484034/index.html">Umsetzung des Arbeitsschemas der gezielten Warenlagerung auf Basis der Lagerabrechnungseinheit 1C Integrated Automation 2</a></li>
<li><a href="../de484036/index.html">Neue Industriegruppe schafft universellen Standard f√ºr Smart Homes</a></li>
<li><a href="../de484048/index.html">PHP und regul√§re Ausdr√ºcke: die Grundlagen f√ºr Anf√§nger</a></li>
<li><a href="../de484050/index.html">Emby Source Code Analyse mit dem PVS-Studio Analyzer</a></li>
<li><a href="../de484052/index.html">Aufgaben f√ºr die Mondbasis</a></li>
<li><a href="../de484056/index.html">Brauchen Sie f√ºr Ihr Projekt wirklich Tests?</a></li>
<li><a href="../de484062/index.html">Englisch lernen mit MEMASICS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>