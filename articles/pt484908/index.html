<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêò üë©üèΩ‚Äçüéì üë©‚Äçüé® HighLoad ++, Eugene Kuzovlev (EcommPay IT): o que fazer quando um minuto de inatividade custa US $ 100.000 ‚õπüèº üö∑ üë©üèæ‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todo mundo fala sobre os processos de desenvolvimento e teste, treinamento da equipe, motiva√ß√£o crescente, mas esses processos s√£o poucos quando um mi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Eugene Kuzovlev (EcommPay IT): o que fazer quando um minuto de inatividade custa US $ 100.000</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/484908/"> Todo mundo fala sobre os processos de desenvolvimento e teste, treinamento da equipe, motiva√ß√£o crescente, mas esses processos s√£o poucos quando um minuto de inatividade do servi√ßo custa espa√ßo em dinheiro.  O que fazer quando voc√™ realiza transa√ß√µes financeiras sob um SLA r√≠gido?  Como aumentar a confiabilidade e a toler√¢ncia a falhas de seus sistemas, descrevendo o desenvolvimento e os testes? <br><br><img src="https://habrastorage.org/webt/dz/-p/tn/dz-ptnygkaqhxsm07hgsfil2fxq.jpeg"><br><br>  A pr√≥xima confer√™ncia HighLoad ++ ser√° realizada nos dias 6 e 7 de abril de 2020 em S√£o Petersburgo.  Detalhes e ingressos <a href="http://bit.ly/2sSxgBx">aqui</a> .  9 de novembro, 18:00.  HighLoad ++ Moscou 2018, Delhi + Calcutta Hall.  Resumos e <a href="http://www.highload.ru/moscow/2018/abstracts/4226">apresenta√ß√£o</a> . <a name="habracut"></a><br><br>  <b>Evgeny Kuzovlev (a seguir denominada CE):</b> - Amigos, ol√°!  Meu nome √© Kuzovlev Evgeny.  Eu sou da EcommPay, uma divis√£o espec√≠fica √© a EcommPay IT, uma divis√£o de TI de um grupo de empresas.  E hoje falaremos sobre per√≠odos de inatividade - como evit√°-los, como minimizar suas consequ√™ncias, se voc√™ n√£o puder evit√°-las.  O tema √©: "O que fazer quando um minuto de inatividade custa US $ 100.000?"  Para n√≥s, olhando para o futuro, os n√∫meros s√£o compar√°veis. <br><br><h3>  O que o EcommPay IT faz? </h3><br>  Quem somos  Por que estou na sua frente?  Por que tenho o direito de lhe dizer uma coisa aqui?  E sobre o que falaremos com mais detalhes aqui? <br><br><img src="https://habrastorage.org/webt/id/bv/so/idbvsod8gah5mhw25b4pnidb8d4.jpeg"><br><br>  O Grupo de Empresas EcommPay √© um adquirente internacional.  Processamos pagamentos em todo o mundo - na R√∫ssia, na Europa e no Sudeste Asi√°tico (em todo o mundo).  Temos 9 escrit√≥rios, 500 funcion√°rios no total e cerca de um pouco menos da metade deles s√£o especialistas em TI.  Tudo o que fazemos, tudo em que ganhamos dinheiro, fizemos n√≥s mesmos. <br><br>  Temos todos os nossos produtos (e muitos deles - na linha de grandes produtos de TI, temos cerca de 16 componentes diferentes) que escrevemos;  n√≥s nos escrevemos, nos desenvolvemos.  E, no momento, estamos realizando cerca de um milh√£o de transa√ß√µes por dia (milh√µes - provavelmente ser√° correto dizer isso).  Somos uma empresa jovem o suficiente - temos apenas seis anos de idade. <br><br>  H√° 6 anos, era uma startup t√£o grande quando os caras vieram junto com o neg√≥cio.  Eles estavam unidos por uma id√©ia (n√£o havia mais nada al√©m de uma id√©ia), e n√≥s corremos.  Como qualquer startup, corremos mais r√°pido ... Para n√≥s, a velocidade era mais importante que a qualidade. <br><br>  Em algum momento, paramos: percebemos que n√£o pod√≠amos mais viver nessa velocidade e com essa qualidade, e precis√°vamos fazer qualidade em primeiro lugar.  Nesse ponto, decidimos escrever uma nova plataforma que seja correta, escal√°vel e confi√°vel.  Eles come√ßaram a escrever essa plataforma (come√ßaram a investir, desenvolver desenvolvimento, testar), mas em algum momento perceberam que o desenvolvimento e o teste n√£o permitiam alcan√ßar um novo n√≠vel de qualidade de servi√ßo. <br><br>  Voc√™ cria um novo produto, coloca-o em produ√ß√£o, mas ainda em algum lugar, algo d√° errado.  E hoje falaremos sobre como alcan√ßar um novo n√≠vel qualitativo (como o alcan√ßamos, sobre nossa experi√™ncia), tirando o desenvolvimento e os testes de cena;  falaremos sobre o que est√° dispon√≠vel para explora√ß√£o - o que a explora√ß√£o pode fazer por si s√≥, o que ela pode oferecer testes para afetar a qualidade. <br><br><h3>  Paradas.  Os mandamentos da explora√ß√£o. </h3><br>  Sempre a principal pedra angular da qual falaremos hoje √© o tempo de inatividade.  Palavra assustadora.  Se tivemos um tempo de inatividade, tudo est√° ruim conosco.  Estamos correndo para aumentar, os administradores est√£o mantendo o servidor - Deus o livre, ele n√£o cai, como naquela m√∫sica.  √â sobre isso que falaremos hoje. <br><br><img src="https://habrastorage.org/webt/7w/nd/t8/7wndt8zz0lal9gvkglnu8zcc-fw.jpeg"><br><br>  Quando come√ßamos a mudar nossa abordagem, formamos 4 mandamentos.  Eles s√£o apresentados nos meus slides: <br><br>  Esses mandamentos s√£o bastante simples: <br><br><img src="https://habrastorage.org/webt/kr/vd/zr/krvdzr268yzpyvwaf3_4fgatwrg.jpeg"><br><br><ul><li>  Identifique rapidamente o problema. </li><li>  Livre-se ainda mais r√°pido. </li><li>  Ajude a entender o motivo (posteriormente, para desenvolvedores). </li><li>  E padronizar abordagens. </li></ul><br>  Chamo sua aten√ß√£o para o ponto n√∫mero 2. N√≥s nos livramos do problema, mas n√£o o resolvemos.  Decidir √© a segunda vez.  A principal coisa para n√≥s √© que o usu√°rio est√° protegido contra esse problema.  Ele existir√° em um determinado ambiente isolado, mas esse ambiente n√£o entrar√° em contato com ele.  Na verdade, passaremos por esses quatro grupos de problemas (para alguns com mais detalhes, para outros com menos detalhes), vou lhe dizer o que usamos, que tipo de experi√™ncia temos na solu√ß√£o. <br><br><h3>  Solu√ß√£o de problemas: quando eles acontecem e o que fazer com eles? </h3><br>  Mas vamos come√ßar fora de ordem, come√ßamos com o ponto n√∫mero 2 - como se livrar rapidamente do problema?  H√° um problema - precisamos corrigi-lo.  "O que devemos fazer com isso?" √â a quest√£o principal.  E quando come√ßamos a pensar em como corrigir o problema, desenvolvemos alguns requisitos que a solu√ß√£o de problemas deveria seguir. <br><br><img src="https://habrastorage.org/webt/oq/ch/1z/oqch1zstieolkejut_t01rbzokw.jpeg"><br><br>  Para formular esses requisitos, decidimos nos perguntar: "E quando temos problemas"?  E os problemas, como se viu, s√£o encontrados em quatro casos: <br><br><img src="https://habrastorage.org/webt/ks/kw/zm/kskwzmylqshsejm96u-bxngu1uq.jpeg"><br><br><ul><li>  Mau funcionamento do hardware. </li><li>  Falha nos servi√ßos externos. </li><li>  Altera√ß√£o da vers√£o do software (a mesma implanta√ß√£o). </li><li>  Crescimento de carga explosiva. </li></ul><br>  N√≥s n√£o vamos falar sobre os dois primeiros.  Um mau funcionamento do hardware √© resolvido de maneira simples: voc√™ deve duplicar tudo.  Se estes s√£o discos - os discos devem ser montados no RAID, se for um servidor - o servidor deve ser duplicado, se voc√™ tiver uma infraestrutura de rede - voc√™ deve colocar uma segunda c√≥pia da infraestrutura de rede, ou seja, pegar e duplicar.  E se algo falhar com voc√™, voc√™ muda para reservar capacidades.  √â dif√≠cil dizer mais aqui. <br><br>  O segundo √© a falha de servi√ßos externos.  Para a maioria, o sistema n√£o √© um problema, mas n√£o para n√≥s.  Como processamos pagamentos, somos um agregador que fica entre o usu√°rio (que insere os detalhes do cart√£o) e os bancos, sistemas de pagamento ("Visa", "MasterCard", "World" do mesmo).  Nossos servi√ßos externos (sistemas de pagamento, bancos) tendem a falhar.  Nem n√≥s nem voc√™ (se voc√™ tiver esses servi√ßos) podemos influenciar isso. <br><br>  O que fazer ent√£o?  Existem duas op√ß√µes.  Primeiro, se voc√™ puder, voc√™ deve duplicar este servi√ßo de alguma forma.  Por exemplo, se pudermos, transferimos o tr√°fego de um servi√ßo para outro: processamos, por exemplo, cart√µes atrav√©s do Sberbank, o Sberbank tem problemas - transferimos o tr√°fego [condicionalmente] para o Raiffeisen.  A segunda coisa que podemos fazer √© notar rapidamente a falha de servi√ßos externos e, portanto, falaremos sobre a velocidade da rea√ß√£o na pr√≥xima parte do relat√≥rio. <br><br>  De fato, desses quatro, podemos afetar especificamente a altera√ß√£o das vers√µes de software - para executar a√ß√µes que levar√£o a uma melhoria no contexto de implanta√ß√µes e no contexto de crescimento explosivo de carga.  Na verdade, n√≥s fizemos isso.  Aqui, novamente, uma pequena observa√ß√£o ... <br><br>  Desses quatro problemas, v√°rios s√£o resolvidos imediatamente se voc√™ tiver uma nuvem.  Se voc√™ estiver nas nuvens Microsoft Azhur, Ozone, use nossas nuvens, do Yandex ou do Mail, pelo menos um mau funcionamento do hardware se tornar√° um problema e tudo imediatamente se tornar√° bom no contexto de um mau funcionamento do hardware. <br><br>  Somos uma empresa pouco padronizada.  Aqui todo mundo est√° falando sobre Kubernets, sobre nuvens - n√£o temos nem Kubernets, nem nuvens.  Mas temos racks com ferro em muitos data centers e somos for√ßados a viver com esse ferro, somos for√ßados a responder por tudo.  Portanto, neste contexto, conversaremos.  Ent√£o, sobre os problemas.  Os dois primeiros est√£o entre colchetes. <br><br><h3>  Mude a vers√£o do software.  Bases </h3><br>  Nossos desenvolvedores n√£o t√™m acesso √† produ√ß√£o.  Porque  Mas somos simplesmente certificados pelo PCI DSS, e nossos desenvolvedores simplesmente n√£o t√™m o direito de entrar no "prod".  √â isso a√≠, ponto final.  Absolutamente.  Portanto, a responsabilidade do desenvolvimento termina exatamente no momento em que o desenvolvimento passou a constru√ß√£o para o release. <br><br><img src="https://habrastorage.org/webt/ze/bp/su/zebpsueilk7pvkhrsqwn-0nrfko.jpeg"><br><br>  Nossa segunda base, que temos, que tamb√©m nos ajuda muito, √© a falta de conhecimento √∫nico e n√£o documentado.  Espero que voc√™ fa√ßa o mesmo.  Porque se n√£o for assim, voc√™ ter√° problemas.  Os problemas surgir√£o quando esse conhecimento √∫nico e n√£o documentado n√£o estiver presente no momento certo, no lugar certo.  Suponha que voc√™ tenha uma pessoa que saiba como implantar um componente espec√≠fico - n√£o h√° ningu√©m, ele esteja de f√©rias ou adoeceu - isso √© tudo, voc√™ tem problemas. <br><br>  E a terceira base para a qual chegamos.  Chegamos a ele com dor, sangue, l√°grimas - chegamos √† conclus√£o de que qualquer uma de nossas constru√ß√µes cont√©m erros, mesmo que sem erros.  Decidimos isso por n√≥s mesmos: quando implementamos algo, quando lan√ßamos algo no produto - temos uma compila√ß√£o com erros.  N√≥s formamos os requisitos que nosso sistema deve atender. <br><br><h3>  Requisitos de altera√ß√£o de vers√£o de software </h3><br>  Existem tr√™s destes requisitos: <br><br><img src="https://habrastorage.org/webt/ou/qm/ma/ouqmmajckkplivqpqoiuwsvs3hs.jpeg"><br><br><ul><li>  Devemos reverter rapidamente a implanta√ß√£o. </li><li>  Devemos minimizar o impacto de uma implanta√ß√£o malsucedida. </li><li>  E precisamos ser capazes de ficar presos rapidamente em paralelo. <br>  Nessa ordem!  Porque  Porque, em primeiro lugar, ao implantar a nova vers√£o, a velocidade n√£o √© importante, mas √© importante para voc√™, se algo der errado, reverta rapidamente e tenha um impacto m√≠nimo.  Mas se voc√™ tiver um conjunto de vers√µes na produ√ß√£o, para as quais ocorreu um erro (como neve em sua cabe√ßa, n√£o houve implanta√ß√£o, mas o erro est√° contido) - a velocidade da implanta√ß√£o subsequente √© importante para voc√™.  O que fizemos para atender a esses requisitos?  Recorremos a essa metodologia: <br><br><img src="https://habrastorage.org/webt/bx/xn/9h/bxxn9hd10bckeqbycqanabweery.jpeg"><br><br>  √â sabido que n√£o inventamos uma √∫nica vez - esse √© o implante azul / verde.  O que √© isso  Voc√™ deve ter uma c√≥pia para cada grupo de servidores nos quais seus aplicativos est√£o instalados.  A c√≥pia est√° ‚Äúquente‚Äù: n√£o h√° tr√°fego, mas a qualquer momento esse tr√°fego pode ser enviado para esta c√≥pia.  Esta c√≥pia cont√©m a vers√£o anterior.  E no momento da implanta√ß√£o, voc√™ lan√ßa o c√≥digo em uma c√≥pia inativa.  Em seguida, alterne parte do tr√°fego (ou todo) para a nova vers√£o.  Portanto, para alterar o fluxo de tr√°fego da vers√£o antiga para a nova, voc√™ s√≥ precisa executar uma a√ß√£o: voc√™ precisa alterar o balanceador no upstream, alterar a dire√ß√£o - de um upstream para outro.  Isso √© muito conveniente e resolve o problema de troca r√°pida e revers√£o r√°pida. <br><br>  Aqui, a solu√ß√£o para a segunda pergunta √© a minimiza√ß√£o: voc√™ pode colocar em uma nova linha, em uma linha com um novo c√≥digo, apenas parte do seu tr√°fego (deixe, por exemplo, 2%).  E esses 2% - eles n√£o s√£o 100%!  Se voc√™ perdeu 100% do tr√°fego durante uma implanta√ß√£o malsucedida - isso √© assustador, se voc√™ perdeu 2% do tr√°fego - isso √© desagrad√°vel, mas n√£o √© assustador.  Al√©m disso, os usu√°rios provavelmente nem perceber√£o isso, porque em alguns casos (nem todos) o mesmo usu√°rio, pressionando F5, ele chegar√° a outra vers√£o funcional. <br><br><h3>  Implanta√ß√£o azul / verde.  Encaminhamento </h3><br>  Al√©m disso, nem tudo √© t√£o simples "Implanta√ß√£o Azul / Verde" ... Todos os nossos componentes podem ser divididos em tr√™s grupos: <br><br><ul><li>  Este √© o frontend (p√°ginas de pagamento que nossos clientes veem); </li><li>  n√∫cleo de processamento; </li><li>  um adaptador para trabalhar com sistemas de pagamento (bancos, MasterCard, Visa ...). </li></ul><br>  E h√° uma nuance - a nuance √© o roteamento entre as linhas.  Se voc√™ simplesmente alternar 100% do tr√°fego, n√£o ter√° esses problemas.  Mas se voc√™ deseja alternar 2%, as perguntas come√ßam: ‚ÄúComo fazer isso?‚Äù A coisa mais simples na testa: voc√™ pode, aleatoriamente, configurar Round Robin no nginx, e voc√™ tem 2%, 98% - para a direita.  Mas isso nem sempre √© adequado. <br><br>  Aqui, por exemplo, o usu√°rio interage com o sistema em mais de uma solicita√ß√£o.  Isso √© normal: 2, 3, 4, 5 consultas - seus sistemas podem ser os mesmos.  E se for importante para voc√™ que todas as solicita√ß√µes do usu√°rio cheguem √† mesma linha em que a primeira solicita√ß√£o chegou, ou (no segundo momento) todas as solicita√ß√µes do usu√°rio cheguem a uma nova linha ap√≥s a troca (ele poderia trabalhar mais cedo com o sistema, antes da troca), - ent√£o essa distribui√ß√£o aleat√≥ria n√£o combina com voc√™.  Depois, existem as seguintes op√ß√µes: <br><br><img src="https://habrastorage.org/webt/hs/3f/fq/hs3ffqgbcy8wu3lzopom58r6tlm.jpeg"><br><br>  A primeira op√ß√£o, a mais f√°cil - com base nos par√¢metros b√°sicos do cliente (IP Hash).  Voc√™ tem um IP e compartilha da direita para a esquerda por IP.  Ent√£o, o segundo caso descrito por mim funcionar√° para voc√™ quando houver uma implanta√ß√£o, o usu√°rio j√° poder√° come√ßar a trabalhar com seu sistema e, a partir do momento da implanta√ß√£o, todas as solicita√ß√µes ser√£o direcionadas para uma nova linha (por exemplo, a mesma). <br><br>  Se, por algum motivo, isso n√£o lhe agradar e voc√™ precisar enviar solicita√ß√µes para a linha em que a solicita√ß√£o √≠ntima principal do usu√°rio veio, voc√™ tem duas op√ß√µes ... <br>  A primeira op√ß√£o: voc√™ pode receber nginx + pago.  Existe um mecanismo de sess√µes fixas, que, mediante solicita√ß√£o inicial do usu√°rio, exp√µe uma sess√£o ao usu√°rio e a vincula a um determinado montante.  Todas as solicita√ß√µes subsequentes do usu√°rio durante a vida √∫til da sess√£o ir√£o para o mesmo upstream em que a sess√£o foi configurada. <br><br>  Isso n√£o nos convinha, porque j√° t√≠nhamos nginx normal.  Mudar o nginx + n√£o √© caro, apenas foi um pouco doloroso para n√≥s e n√£o muito certo.  Por exemplo, ‚ÄúSticks Sessions‚Äù n√£o funcionou para n√≥s pelo simples motivo de que ‚ÄúSticks Sessions‚Äù n√£o oferece uma oportunidade de roteamento com base em ‚ÄúEli-or‚Äù.  L√°, voc√™ pode especificar o que fazemos "Sess√µes permanentes", por exemplo, por IP ou IP e por cookie ou por par√¢metro de postagem, mas "Eli-or" j√° √© mais complicado l√°. <br><br>  Portanto, chegamos √† quarta op√ß√£o.  Pegamos o nginx em "ester√≥ides" (isto √© openresty) - este √© o mesmo nginx que tamb√©m oferece suporte √† inclus√£o dos √∫ltimos scripts.  Voc√™ pode escrever um √∫ltimo script, deslizar para ‚Äúaberto‚Äù e esse √∫ltimo script ser√° executado quando uma solicita√ß√£o do usu√°rio chegar. <br><br>  E n√≥s escrevemos, de fato, um script desse tipo, nos definimos como "openrest" e nesse script classificamos 6 par√¢metros diferentes para a concatena√ß√£o de "Or".  Dependendo da disponibilidade deste ou daquele par√¢metro, sabemos que o usu√°rio chegou a uma p√°gina ou a outra, a uma linha ou a outra. <br><br><h3>  Implanta√ß√£o azul / verde.  Vantagens e desvantagens </h3><br>  √â claro que provavelmente poder√≠amos facilitar um pouco (use as mesmas ‚Äúsess√µes fixas‚Äù), mas ainda temos uma nuance que n√£o apenas o usu√°rio interage conosco no √¢mbito de um processamento de uma transa√ß√£o ... Mas os sistemas de pagamento tamb√©m interagem conosco: depois de processarmos a transa√ß√£o (enviando uma solicita√ß√£o ao sistema de pagamento), obtemos um retorno de chamada. <br>  E suponha que, dentro do nosso circuito, possamos executar o endere√ßo IP do usu√°rio em todas as solicita√ß√µes e separar usu√°rios com base no endere√ßo IP, ent√£o n√£o diremos o mesmo ‚ÄúVisa‚Äù: ‚ÄúCaras, somos uma empresa t√£o retro, somos meio internacionais (no site e em Da R√∫ssia) ... E, por favor, d√™ uma olhada no endere√ßo IP do usu√°rio em um campo adicional, seu protocolo √© padronizado! ‚Äù  Neg√≥cio claro, eles n√£o v√£o concordar. <br><br><img src="https://habrastorage.org/webt/he/5o/-w/he5o-wivis5fucv4e7_1wn1qz3y.jpeg"><br><br>  Portanto, para n√≥s, n√£o se encaixava - n√≥s abrimos espa√ßo.  Assim, com o roteamento, chegamos assim: <br><br>  O Blue / Green Deploy tem, respectivamente, as vantagens de que falei e as desvantagens. <br><br>  Desvantagem dois: <br><br><ul><li>  voc√™ precisa se preocupar com o roteamento; </li><li>  a segunda principal desvantagem √© o custo. </li></ul><br>  Voc√™ precisa do dobro de servidores, do dobro de recursos operacionais, do esfor√ßo para manter todo esse zool√≥gico. <br><br>  A prop√≥sito, entre as vantagens, h√° outra coisa que eu n√£o mencionei antes: voc√™ tem uma reserva em caso de aumento de carga.  Se voc√™ tiver um crescimento explosivo de carga, um grande n√∫mero de usu√°rios cair√° sobre voc√™, basta incluir a segunda linha na distribui√ß√£o de 50 a 50 - e voc√™ ter√° imediatamente 2 servidores no cluster at√© resolver o problema de ter servidores ainda. <br><br><h3>  Como fazer uma implanta√ß√£o r√°pida? </h3><br>  Falamos sobre como resolver o problema de minimiza√ß√£o e revers√£o r√°pida, mas a pergunta permanece: "Como implantar rapidamente?" <br><br><img src="https://habrastorage.org/webt/vy/8l/xo/vy8lxokper6luvftog4okdvgbh4.jpeg"><br><br>  Aqui √© breve e simples. <br><br><ul><li>  Voc√™ deve ter um sistema de CD (Entrega cont√≠nua) - sem ele, em lugar nenhum.  Se voc√™ tiver um servidor, poder√° ficar preso com canetas.  Temos cerca de mil e meio servidores e 1.500 al√ßas, √© claro - podemos plantar um departamento do tamanho desta sala, apenas para implantar. </li><li>  A implanta√ß√£o deve ser paralela.  Se voc√™ tem uma implanta√ß√£o consistente, tudo est√° ruim.  Um servidor √© normal, voc√™ implantar√° mil e meio servidores o dia todo. </li><li>  Novamente, para acelerar, isso n√£o √© mais necess√°rio, provavelmente.  Quando desploey geralmente constr√≥i o projeto.  Voc√™ tem um projeto da Web, existe uma parte de front-end (voc√™ faz um pacote da Web l√°, o npm coleta algo assim) e esse processo, em princ√≠pio, tem vida curta - 5 minutos, mas esses 5 minutos podem ser cr√≠ticos.  Portanto, por exemplo, n√£o fazemos isso: removemos esses 5 minutos, implantamos artefatos. <br><br>  O que √© um artefato?  Um artefato √© uma constru√ß√£o montada na qual toda a pe√ßa da montagem j√° foi conclu√≠da.  Armazenamos esse artefato no armazenamento de artefatos.  Usamos dois desses armazenamentos ao mesmo tempo - era o Nexus e agora o jFrog Artifactory.) Inicialmente, usamos o Nexus porque come√ßamos a praticar essa abordagem em aplicativos java (ela se adaptou bem).  Ent√£o eles colocam a parte dos aplicativos escritos pelo PHP l√°;  e o Nexus n√£o era mais adequado e, portanto, escolhemos o jFrog Artefactory, que pode criar quase tudo.  Chegamos at√© ao fato de que, nesse armazenamento de artefatos, armazenamos nossos pr√≥prios pacotes bin√°rios, que coletamos para servidores. </li></ul><br><h3>  Crescimento de carga explosiva </h3><br>  N√≥s conversamos sobre mudar a vers√£o do software.  A pr√≥xima coisa que temos √© um crescimento explosivo de carga.  Aqui eu provavelmente entendo que o crescimento explosivo da carga n√£o √© a coisa certa ... <br><br>  Escrevemos um novo sistema - ele √© orientado a servi√ßos, bonito e elegante, em todos os lugares, em todos os lugares, em todas as filas, em todos os lugares assincronia.  E nesses sistemas, os dados podem ter um fluxo diferente.  Para a primeira transa√ß√£o, o 1¬∫, 3¬∫ e 10¬∫ trabalhador pode estar envolvido, para a segunda transa√ß√£o - 2¬∫, 4¬∫, 5¬∫.  E hoje, digamos, de manh√£, voc√™ tem um fluxo de dados que usa os tr√™s primeiros trabalhadores e, √† noite, muda drasticamente, e tudo usa os outros tr√™s trabalhadores. <br><br>  E aqui acontece que voc√™ precisa de alguma forma escalar os trabalhadores, de alguma forma escalar seus servi√ßos, mas, ao mesmo tempo, impedir o aumento de recursos. <br><br><img src="https://habrastorage.org/webt/wg/1t/kr/wg1tkrnswlv954eaws3dj1ije_a.jpeg"><br><br>  Determinamos os requisitos para n√≥s mesmos.    :    Service discovery,  ‚Äì       ,    ‚Äì   .  ,      ,    .   ¬´¬ª,   ¬´¬ª,    . <br><br>     ?    .       70  .      ¬´¬ª,  ¬´¬ª ,  ,        .    100   ¬´¬ª,        100     .         .  ,    ‚Äì  24/7   ,      ,    ,  70   ,  . <br><br>     ¬´¬ª,     IP     Scale-Nomad ‚Äì ScaleNo,    :                 .  ,  : ¬´  ?¬ª     ‚Äì  ,   . <br><br>        ,       ,  ,     ,    ,       ‚Äì  , .     3-5  ‚Äì   . <br><br><img src="https://habrastorage.org/webt/8z/ja/m0/8zjam0uickgtjt67yl6grtzfmao.jpeg"><br><br>  Como isso funciona?  !  :       :   ,  ‚Äì   ,   ‚Äì  ,  ‚Äì  . <br><br>  ,     .         45  ‚Äì     .       2         ,     (    ‚Äì ,   ).     ‚Äì    ,  5-10 ,    . <br><br>     ¬´¬ª,      ,  ¬´¬ª      .  ,    ,    ‚Äì       .     .    ‚Ññ 2 ‚Äì ¬´    ¬ª. <br><br><h3> .    ? </h3><br>    ‚Äì ¬´   ?¬ª !      .      ? <br><br><img src="https://habrastorage.org/webt/md/xm/op/mdxmopdox-kznqvid9b4uesleeg.jpeg"><br><br>  ! <br><br><ul><li>           . </li><li>       ,   ,     . </li><li>   ‚Äì   .      ,     ,   -  . </li></ul><br>  , ,     .   .  ,    .    ¬´ ¬ª.       : <br><br><img src="https://habrastorage.org/webt/8w/1z/w4/8w1zw4dq1rwsz7e7dg7tp53wbke.jpeg"><br><br>   ¬´¬ª    ¬´¬ª,     . ¬´¬ª     . ¬´¬ª  ¬´¬ª      ,      ,   ‚Äì  ¬´¬ª  ¬´¬ª,  ‚Äì ¬´¬ª  ¬´¬ª  Telegraf. <br><br>      New Relic.  ,   .     ,    .       1,5  ,    , : ¬´     ¬ª.    ,  ,     .    ¬´-¬ª ,    15     ¬´-¬ª.    . <br><br>    ,     ‚Äì  Debugger.     ¬´¬ª,       ,  ,    ¬´¬ª.  O que √© isso  ,     15-30    ,  ¬´ ¬ª ,      . <br><br> ,    ( ) ‚Äì      ,    .   ,    ¬´¬ª ‚Äì ,   ¬´¬ª .       ‚Äì     ,  ,  ,     . <br><br><h3>     ? </h3><br>     ?     ? <br><br><img src="https://habrastorage.org/webt/8c/qe/tn/8cqetn3kfyedayuv9fwc8qpx4vq.jpeg"><br><br><ul><li> Response time / RPS   ‚Äì   .   ,    -  . </li><li>      . </li><li>  . </li><li>   . </li></ul><br>   ‚Äì ¬´¬ª, ¬´¬ª .       ,    - ,      .     ‚Äì   (        ).    -    5-10-15  ‚Äì ,     (  ). <br><br>      ‚Äì     : <br><br><img src="https://habrastorage.org/webt/73/xa/jg/73xajgyfx9xahrr_9hl3ysaapgw.jpeg"><br><br>    ‚Äì 6 ,     ‚Äì       .    ‚Äì RPS, RTS.  ‚Äì    ¬´¬ª.   ¬´¬ª     ,  -       ‚Ä¶      ,    . <br><br> ,      ‚Äì       .    OpenTracing ‚Äì , , ,     ;    .  OpenTracing-   ,       .     ,       , .  ,      ,   . <br><br><img src="https://habrastorage.org/webt/42/nw/5h/42nw5hrsai8-i8t3bnsclajtklw.jpeg"><br><br>   ,         3  ‚Äì    .     ,   ,    20-30 . <br><br>     ,   ‚Äì   . <br><br>  ,  ,     ,        ,   .   ,    . <br><br><img src="https://habrastorage.org/webt/d8/pz/1v/d8pz1vfzv9otccv6dsa-crqiuuu.jpeg"><br><br>      ? ,  :     (,  ¬´¬ª);   , .         ,   ,  ‚Ä¶      ‚Äì        -.   ,   : ¬´        ¬ª? <br><br>   ‚Ä¶       -,   ( )    ,      .    :       ‚Äì ,      ,     ( ).    ,    -        .     !      .         . <br><br>      ,    . <br><br><h3>     </h3><br>   ,    ‚Äì   ,    ,  ,     ,      ,    -   . ,   ,   . <br><br><img src="https://habrastorage.org/webt/e2/kb/jz/e2kbjzy9w7wvv6kicbniocak4ac.jpeg"><br><br>      (  ‚Äì ),       ELK Stack ‚Äì    .  -, ,   ELK,      ,       ELK.    . <br><br><img src="https://habrastorage.org/webt/_f/8a/3i/_f8a3ibc2i7os5pp3xot6m9_gxo.jpeg"><br><br>   .  ,    ,  ,     ,   ¬´¬ª,   id-       ( ).        .  Porque    ,      ,      .      ,     ‚Äì   OpenTracing,    . <br><br>     ,      ,      ‚Äì  ¬´¬ª (Zipkin)  ¬´¬ª (Jaeger). ¬´¬ª ‚Äì      ,   ¬´¬ª.  ¬´¬ª  ,  ,     ,      ,   .  ¬´¬ª  . <br><br>   ¬´¬ª:   ,    Api ( Api  PHP   , ,    ‚Äì   ,    ),     . ¬´¬ª, ‚Äì  ,    .    ?     : <br><br><img src="https://habrastorage.org/webt/uq/x2/mu/uqx2muumblbudpbjnuittfrsdkk.jpeg"><br><br>  ¬´¬ª     span'.  ,    ,           (1-2-3 ‚Äì      ,   ).      ,        . ,          Error.     Error    ,      .    ,    span: <br><br><img src="https://habrastorage.org/webt/3e/is/fk/3eisfkpsc9mkuipyg-5iaob2d-y.jpeg"><br><br>     .       ,       ,   .        :    ‚Äì  ,   ,            . <br><br> ,    .    ,    .      ,      ¬´¬ª   PHP ‚Äì   , welcome to use,  : <br><br><img src="https://habrastorage.org/webt/q7/vi/pc/q7vipcgfujbggn_zt64r3h7foay.jpeg"><br><br>     ‚Äì     OpenTracing Api,   php-extention,          .      .     ,   .   :     ,    extention up to you. <br><br><h3>   </h3><br>    .   ‚Äì   .   ?    : <br><br><img src="https://habrastorage.org/webt/3h/ka/zo/3hkazonrypgjcuakfff1yrutxlc.jpeg"><br><br>    ¬´¬ª?        , !  ¬´¬ª       ,    ,        ,      .     ? <br><br><img src="https://habrastorage.org/webt/b7/h6/qa/b7h6qavqwtn9fm9bam0jbg07nym.jpeg"><br><br><ul><li>     .      ,  .    60   ,        .     , ,         ‚Äì ,   . </li><li>    .          ,     ,        RnD-.       ,      (,    ) ,    ,   . </li><li>     ,   ‚Äì ,     .       . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos toler√¢ncias. </font><font style="vertical-align: inherit;">Por exemplo, n√£o consideramos o tempo de inatividade se perdermos 2% do tr√°fego em dois minutos. </font><font style="vertical-align: inherit;">Isso, em princ√≠pio, n√£o se enquadra em nossas estat√≠sticas. </font><font style="vertical-align: inherit;">Se mais em porcentagem ou tempo, j√° contamos.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E sempre escrevemos post-mortem. </font><font style="vertical-align: inherit;">O que quer que aconte√ßa conosco, qualquer situa√ß√£o em que ele se comporte de maneira inadequada no local de produ√ß√£o ser√° refletida no potencial de venda. </font><font style="vertical-align: inherit;">Um post-mortem √© um documento no qual voc√™ escreve o que aconteceu com voc√™, o tempo detalhado do que voc√™ fez para corrigi-lo e (este √© um bloco obrigat√≥rio!) O que voc√™ far√° para impedir que isso aconte√ßa no futuro. </font><font style="vertical-align: inherit;">Isso √© necess√°rio, necess√°rio para an√°lises subsequentes.</font></font></li></ul><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O que considerar no tempo de inatividade? </font></font></h3><br><img src="https://habrastorage.org/webt/ad/8v/ye/ad8vyesevuqquvkj4rtf15hggd8.jpeg"><br><br>  A que tudo isso levou? <br><br>  Isso levou ao fato de que (tivemos alguns problemas de estabilidade, isso n√£o era adequado para n√≥s ou clientes) nos √∫ltimos 6 meses, nosso indicador de estabilidade foi de 99,97.  Podemos dizer que isso n√£o √© muito.  Sim, temos algo pelo que lutar.  Cerca de metade desse indicador √© a estabilidade, por assim dizer, n√£o a nossa, mas o firewall de aplicativos da web, que est√° diante de n√≥s e √© usado como um servi√ßo, mas isso n√£o importa para os clientes. <br><br>  Aprendemos a dormir √† noite.  Finalmente!  Seis meses atr√°s, n√£o sab√≠amos como.  E nesta nota com os resultados, quero fazer uma observa√ß√£o.  Ontem √† noite houve um relat√≥rio maravilhoso sobre um sistema de controle de reatores nucleares.  Se as pessoas que escreveram esse sistema me ouvirem, esque√ßa o que eu disse sobre "2% n√£o √© tempo de inatividade".  Para voc√™, 2% √© tempo de inatividade, mesmo que por dois minutos "! <br><br>  Isso √© tudo!  Suas perguntas. <br><br><img src="https://habrastorage.org/webt/us/ih/xg/usihxgshbsygnv59b5detm4js5m.jpeg"><br><br><h3>  Sobre balanceadores e migra√ß√£o de banco de dados </h3><br>  Pergunta da plat√©ia (doravante - B): - Boa noite.  Muito obrigado por esse relat√≥rio de administrador!  A pergunta √© curta sobre o assunto de seus balanceadores.  Voc√™ mencionou que possui WAF, ou seja, pelo que entendi, voc√™ usa algum tipo de balanceador externo ... <br><br>  <b>:</b> - N√£o, usamos nossos servi√ßos como balanceador.  Nesse caso, o WAF √© para n√≥s apenas uma ferramenta de prote√ß√£o contra DDoS. <br><br>  <b>P:</b> - Voc√™ poderia dizer algumas palavras sobre os balanceadores? <br><br>  <b>EK:</b> - Como eu disse, este √© um grupo de servidores em openresty.  Agora temos 5 grupos de grupos redundantes que respondem exclusivamente ... ou seja, um servidor no qual fica exclusivamente aberto, apenas proxyiza o tr√°fego.  Portanto, para entender o quanto mantemos: agora temos um fluxo de tr√°fego regular - s√£o v√°rias centenas de megabits.  Eles conseguem, se sentem bem, nem se esfor√ßam. <br><br>  <b>P:</b> - Tamb√©m √© uma pergunta simples.  H√° uma implanta√ß√£o azul / verde.  E o que voc√™ faz, por exemplo, com migra√ß√µes do banco de dados? <br><br>  <b>EK:</b> - Boa pergunta!  Olha, n√≥s na implanta√ß√£o Azul / Verde temos linhas separadas para cada linha.  Ou seja, se estamos falando sobre as linhas de eventos que s√£o transmitidas do trabalhador para o trabalhador, existem linhas separadas para a linha azul e a linha verde.  Se estamos falando sobre o pr√≥prio banco de dados, reduzimos deliberadamente, como pudemos, colocar tudo quase na linha, temos apenas uma pilha de transa√ß√µes no banco de dados.  E temos uma √∫nica pilha de transa√ß√µes para todas as linhas.  Com um banco de dados nesse contexto: n√£o o compartilhamos em azul e verde, porque as duas vers√µes do c√≥digo devem saber o que est√° acontecendo com a transa√ß√£o. <br><br>  Amigos, ainda tenho um pr√™mio t√£o pequeno para estimular voc√™ - um livro.  E preciso entreg√°-la para a melhor pergunta. <br><br>  <b>Q:</b> - Ol√°.  Obrigado pelo relat√≥rio.  A quest√£o √© essa.  Voc√™ monitora pagamentos, monitora os servi√ßos com os quais se comunica ... Mas como voc√™ monitora para que uma pessoa de alguma forma chegue √† sua p√°gina de pagamento, fa√ßa um pagamento e o projeto lhe d√™ dinheiro?  Ou seja, como voc√™ monitora se o marchant est√° dispon√≠vel e aceita seu retorno de chamada? <br><br>  <b>Nota:</b> - "Comerciante" para n√≥s, neste caso, √© exatamente o mesmo servi√ßo externo que o sistema de pagamento.  Monitoramos a velocidade de resposta do "comerciante". <br><br><h3>  Sobre criptografia de banco de dados </h3><br>  <b>Q:</b> - Ol√°.  Eu tenho um pouco de pergunta.  Voc√™ possui dados sens√≠veis do PCI DSS.  Eu queria saber como voc√™ armazena os PANs em filas nas quais precisa jogar?  Voc√™ usa alguma criptografia?  A partir daqui, surge a seguinte segunda pergunta: no PCI DSS, √© necess√°rio criptografar o banco de dados periodicamente em caso de altera√ß√µes (dispensa de administradores e assim por diante) - como, neste caso, acontece com a acessibilidade? <br><br><img src="https://habrastorage.org/webt/0z/oh/29/0zoh293lif-ioxouzt79ui9j98a.jpeg"><br><br>  <b>EK:</b> - Pergunta maravilhosa!  Em primeiro lugar, n√£o armazenamos PANs nas filas.  N√£o temos o direito de armazenar o PAN em qualquer lugar de forma clara, em princ√≠pio, portanto, usamos um servi√ßo especial (chamamos de ‚ÄúKademon‚Äù) - este √© um servi√ßo que faz apenas uma coisa: recebe uma mensagem e envia uma mensagem criptografada.  E n√≥s armazenamos tudo com essa mensagem criptografada.  Consequentemente, o comprimento da chave para n√≥s √© inferior a kilobytes, para que seja direto, s√©rio e confi√°vel. <br><br>  <b>P:</b> - Voc√™ precisa de 2 kilobytes agora? <br><br>  <b>EK:</b> - Parece que ontem tinha 256 ... Bem, onde mais ?! <br><br>  Consequentemente, este √© o primeiro.  E segundo, a solu√ß√£o que existe, suporta o processo de re-criptografia - existem dois pares de "bolos" (chaves) que fornecem "decks" que criptografam (chave s√£o chaves, dek s√£o derivados de chaves que criptografam).  E no caso do in√≠cio do procedimento (ocorre regularmente, de 3 meses a ¬± alguns), enviamos um novo par de ‚Äúbolos‚Äù e os dados s√£o criptografados novamente.  Temos servi√ßos separados que separam todos os dados e os criptografam de uma nova maneira;  os dados s√£o armazenados ao lado do identificador de chave com o qual s√£o criptografados.  Assim, assim que nossos dados s√£o criptografados com novas chaves, exclu√≠mos a chave antiga. <br><br><h3>  √Äs vezes, voc√™ precisa fazer pagamentos manualmente ... </h3><br>  <b>P:</b> - Ou seja, se um retorno ocorreu para alguma opera√ß√£o, decifre-o com a chave antiga? <br><br>  <b>CE:</b> - Sim. <br><br>  <b>Q:</b> - Ent√£o, mais uma pequena pergunta.  Quando h√° algum tipo de falha, queda, incidente, √© necess√°rio enviar a transa√ß√£o no modo manual.  Existe uma situa√ß√£o dessas. <br><br>  <b>EK:</b> - Sim, faz. <br><br>  <b>P:</b> - De onde voc√™ tira esses dados?  Ou voc√™ mesmo vai com canetas para esta loja? <br><br>  <b>EK:</b> - N√£o, bem, √© claro - n√≥s temos algum tipo de sistema de back-office que cont√©m uma interface para nosso suporte.  Se n√£o soubermos em que status a transa√ß√£o est√° (por exemplo, enquanto o sistema de pagamento n√£o respondeu com um tempo limite), n√£o sabemos a priori, ou seja, atribu√≠mos o status final apenas com total confian√ßa.  Nesse caso, transferimos a transa√ß√£o para um status especial para processamento manual.  De manh√£, no dia seguinte, assim que o suporte recebe informa√ß√µes de que essas transa√ß√µes permanecem no sistema de pagamento, elas as processam manualmente nessa interface. <br><br><img src="https://habrastorage.org/webt/um/1e/qe/um1eqefsegdtcvv8gczvx2qe54o.jpeg"><br><br>  <b>P:</b> - Eu tenho algumas perguntas.  Uma delas √© a continua√ß√£o da zona PCI DSS: como voc√™ obt√©m os logs de loop?  Essa pergunta, porque o desenvolvedor pode colocar qualquer coisa nos logs!  Segunda pergunta: como voc√™ lan√ßa hotfixes?  As canetas no banco de dados s√£o uma op√ß√£o, mas pode haver corre√ß√µes gratuitas - qual √© o procedimento?  E a terceira pergunta provavelmente est√° relacionada ao RTO, RPO.  Sua disponibilidade era 99,97, quase quatro noves, mas, pelo que entendi, voc√™ tem um segundo data center, um terceiro data center e um quinto data center ... Como voc√™ lida com a sincroniza√ß√£o, replica√ß√£o e tudo mais? <br><br>  <b>EK:</b> - Vamos come√ßar do primeiro.  A primeira pergunta sobre os logs foi?  Quando escrevemos logs, temos uma camada que mascara todos os dados confidenciais.  Ela olha para a m√°scara e os campos adicionais.  Assim, nossos logs s√£o lan√ßados com dados j√° mascarados e um loop PCI DSS.  Essa √© uma das tarefas regulares atribu√≠das ao departamento de testes.  Eles s√£o obrigados a verificar todas as tarefas, incluindo os logs que escrevem, e essa √© uma das tarefas regulares na revis√£o de c√≥digo, para controlar se o desenvolvedor n√£o escreveu nada.  A verifica√ß√£o subsequente disso √© realizada regularmente pelo departamento de seguran√ßa da informa√ß√£o uma vez por semana: os logs s√£o selecionados seletivamente no √∫ltimo dia e s√£o executados atrav√©s de um analisador de scanner especial dos servidores de teste para verificar tudo isso. <br>  Sobre hot fixes.  Isso est√° inclu√≠do no nosso cronograma de implanta√ß√£o.  Temos um item separado sobre hotfixes.  Acreditamos que implantamos hotfixes o tempo todo quando precisamos.  Assim que a vers√£o for montada, assim que for executada, assim que tivermos o artefato, colocaremos o administrador do sistema de prontid√£o no suporte e ele a implantar√° no momento em que for necess√°rio. <br><br>  Sobre os "quatro noves".  O n√∫mero que temos agora, realmente foi alcan√ßado, e o procuramos em outro data center.  Agora temos um segundo data center, e estamos come√ßando a rotear entre eles, e a quest√£o do centro de replica√ß√£o de dados cruzados √© realmente uma quest√£o n√£o trivial.  Tentamos resolv√™-lo no devido tempo por diferentes meios: tentamos usar a mesma "Tar√¢ntula" - n√£o funcionou para n√≥s, estou dizendo imediatamente.  Portanto, chegamos ao fato de fazermos a ordem da "sensa√ß√£o" manualmente.  De fato, temos todas as aplica√ß√µes no modo ass√≠ncrono das unidades de sincroniza√ß√£o "alteradas" necess√°rias entre os datacenters. <br><br>  <b>P:</b> - Se voc√™ possui um segundo, por que n√£o um terceiro?  Porque ningu√©m ainda tem c√©rebro dividido ... <br><br>  <b>:</b> - E n√£o temos um c√©rebro dividido.  Devido ao fato de que cada aplicativo dirige um multimaster, n√£o importa para n√≥s qual o centro da solicita√ß√£o.  Estamos prontos para o fato de que, no caso de um data center travar (estamos deitados nele) e no meio da solicita√ß√£o de um usu√°rio alternar para um segundo data center, estaremos realmente prontos para perder esse usu√°rio;  mas ser√£o unidades, unidades absolutas. <br><br>  <b>Q:</b> - Boa noite.  Obrigado pelo relat√≥rio.  Voc√™ falou sobre seu depurador, que conduz algumas transa√ß√µes de teste na produ√ß√£o.  Mas conte-nos sobre transa√ß√µes de teste!  Qual a profundidade? <br><br>  <b>CE:</b> - Passa por todo o ciclo de todo o componente.  N√£o h√° diferen√ßas entre a transa√ß√£o de teste e a de combate para o componente.  E, do ponto de vista da l√≥gica, este √© apenas um projeto separado no sistema, no qual apenas as transa√ß√µes de teste s√£o perseguidas. <br><br>  <b>Q:</b> - E onde voc√™ cortou?  Ent√£o o Core enviou ... <br><br>  <b>::</b> - Estamos atr√°s de "Kor", neste caso, para transa√ß√µes de teste ... Temos um roteamento: "Kor" sabe para qual sistema de pagamento enviar - enviamos para um sistema de pagamento falso, que simplesmente fornece uma resposta http e √© tudo . <br><br>  <b>P:</b> - Diga-me, por favor, voc√™ teve o aplicativo escrito em um monolito enorme ou o cortou em alguns servi√ßos ou mesmo microsservi√ßos? <br><br>  <b>Nota:</b> - N√£o temos um mon√≥lito, √© claro, temos um aplicativo orientado a servi√ßos.  Temos uma piada de que temos um servi√ßo de mon√≥litos - eles s√£o realmente muito grandes.  A chamada de microsservi√ßos nesse idioma n√£o muda de maneira alguma, mas esses s√£o os servi√ßos nos quais os trabalhadores de m√°quinas distribu√≠dos trabalham. <br><br><h3>  Se o servi√ßo no servidor estiver comprometido ... </h3><br>  <b>Q:</b> - Ent√£o eu tenho a seguinte pergunta.  Mesmo que fosse um mon√≥lito, voc√™ ainda disse que possui muitos desses servidores instant√¢neos, todos eles processam os dados em princ√≠pio, e a pergunta √©: ‚ÄúSe um dos servidores instant√¢neos ou o aplicativo, qualquer link espec√≠fico estiver comprometido Eles t√™m algum tipo de controle de acesso?  Qual deles pode fazer o que?  Com quem entrar em contato, para quais dados? <br><br><img src="https://habrastorage.org/webt/3j/qn/pt/3jqnpt1dfzhas9kn5de1qb6x1lq.jpeg"><br><br>  <b>EK:</b> - Sim, claro.  Os requisitos de seguran√ßa s√£o bastante s√©rios.  Em primeiro lugar, temos tr√°fego de dados abertos e as portas s√£o apenas aquelas nas quais antecipamos o tr√°fego com anteced√™ncia.  Se o componente se comunicar com o banco de dados (digamos, ‚ÄúMuskul‚Äù) em 5-4-3-2, apenas 5-4-3-2 e outras portas estar√£o abertas para ele, outras dire√ß√µes de tr√°fego n√£o estar√£o dispon√≠veis.  Al√©m disso, devemos entender que, na produ√ß√£o, temos cerca de 10 loops de seguran√ßa diferentes.  E mesmo que o aplicativo tenha sido comprometido de alguma forma, Deus o permita, um invasor n√£o poder√° acessar o console de gerenciamento do servidor, porque esta √© outra zona de seguran√ßa da rede. <br><br>  <b>P:</b> - E neste contexto, estou mais interessado no momento em que voc√™ tem alguns contratos com servi√ßos - o que eles podem fazer, por meio de quais "a√ß√µes" eles podem entrar em contato ... E no fluxo normal, alguns servi√ßos espec√≠ficos perguntam quais uma s√©rie, uma lista de "a√ß√£o" em outro.  Eles n√£o parecem se voltar para os outros em uma situa√ß√£o normal e t√™m outras √°reas de responsabilidade.  Se um deles estiver comprometido, ele ser√° capaz de executar a "a√ß√£o" desse servi√ßo? <br><br>  <b>EK:</b> - Eu entendo.  Se em uma situa√ß√£o normal com outro servidor a comunica√ß√£o geralmente era permitida, ent√£o sim.  De acordo com o contrato de SLA, n√£o monitoramos se voc√™ tem apenas as 3 primeiras "a√ß√µes" e 4 "a√ß√µes" n√£o s√£o permitidas.  Isso provavelmente √© redundante para n√≥s, porque temos um sistema de prote√ß√£o de quatro n√≠veis, em princ√≠pio, para circuitos.  Preferimos defender com contornos do que no interior. <br><br><h3>  Como funcionam Visa, MasterCard e Sberbank </h3><br>  <b>P:</b> - Quero esclarecer um momento sobre a troca de um usu√°rio de um data center para outro.  At√© onde eu sei, "Visa" e "MasterCard" funcionam no protocolo s√≠ncrono bin√°rio 8583, existem misturas.  E eu queria saber, agora quero dizer mudar - √© diretamente "Visa" e "MasterCard" ou para sistemas de pagamento, para processamentos? <br><br>  <b>EK:</b> - Depende das misturas.  Misturas que temos em um data center. <br><br>  <b>P:</b> - Grosso modo, voc√™ tem um ponto de conex√£o? <br><br>  <b>::</b> - ‚Äú <b>Visor</b> ‚Äù e ‚ÄúMasterCard‚Äù - sim.  S√≥ porque "Visa" e "MasterCard" exigem investimentos bastante s√©rios em infraestrutura para concluir contratos separados para receber um segundo par de mixagens, por exemplo.  Eles s√£o reservados na estrutura de um datacenter, mas, se Deus proibir, o datacenter em que as misturas de conex√£o com o "Visa" e o "MasterCard" est√£o mortos, teremos uma conex√£o com o "Visa" e o "MasterCard" perdido ... <br><br>  <b>P:</b> - Como eles podem ser reservados?  Eu sei que o "Visa" permite que apenas uma conex√£o seja mantida em princ√≠pio! <br><br>  <b>EK:</b> - Eles pr√≥prios fornecem equipamentos.  De qualquer forma, recebemos equipamentos com redund√¢ncia interna. <br><br>  <b>P:</b> - Ou seja, o rack do Connects Orange? <br><br>  <b>CE:</b> - Sim. <br><br>  <b>P:</b> - Mas, como neste caso: se o seu data center desaparecer, voc√™ deve us√°-lo ainda mais?  Ou √© s√≥ parar o tr√°fego? <br><br>  <b>CE:</b> - N√£o.  Nesse caso, simplesmente mudamos o tr√°fego para outro canal, o que, obviamente, ser√° mais caro para n√≥s, mais caro para os clientes.  Mas o tr√°fego n√£o passar√° por nossa conex√£o direta com o "Visa", "MasterCard", mas pelo "Sberbank" convencional (muito exagerado). <br><br>  Sinto muito por machucar os funcion√°rios do Sberbank.  Mas, de acordo com nossas estat√≠sticas, o Sberbank est√° caindo com mais frequ√™ncia dos bancos russos.  Em menos de um m√™s, algo n√£o caiu no Sberbank. <br><br><img src="https://habrastorage.org/webt/u2/pm/rp/u2pmrpkbplsfx65dstp-lsstwcw.jpeg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6YB1kMnzyRs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Um pouco de publicidade :) </h3><br>  Obrigado por ficar conosco.  Voc√™ gosta dos nossos artigos?  Deseja ver materiais mais interessantes?  Ajude-nos fazendo um pedido ou recomendando aos seus amigos <a href="https://ua-hosting.company/cloudvps/nl">VPS baseado em nuvem para desenvolvedores a partir de US $ 4,99</a> , um <b>anal√≥gico exclusivo de servidores</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">b√°sicos</a> <b>que foi inventado por n√≥s para voc√™:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps de 10GB de US $ 19 ou como dividir o servidor?</a>  (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). <br><br>  <b>Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterd√£?</b>  Somente temos <b><a href="https://ua-hosting.company/serversnl">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</a> na Holanda!</b>  <b><b>Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de US $ 99!</b></b>  Leia sobre <a href="https://habr.com/company/ua-hosting/blog/329618/">Como criar um pr√©dio de infraestrutura.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">classe usando servidores Dell R730xd E5-2650 v4 custando 9.000 euros por um centavo?</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484908/">https://habr.com/ru/post/pt484908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484898/index.html">Bom motivo para testar suas depend√™ncias: edi√ß√£o AGPL</a></li>
<li><a href="../pt484900/index.html">Renderiza√ß√£o de site 101</a></li>
<li><a href="../pt484902/index.html">Em equa√ß√µes de graus mais altos</a></li>
<li><a href="../pt484904/index.html">Um ano sem Splunk - como uma empresa americana mudou o mercado de an√°lise de dados de m√°quinas na R√∫ssia e quem deixou para tr√°s</a></li>
<li><a href="../pt484906/index.html">Equipe distribu√≠da e l√≠der da equipe no controle remoto</a></li>
<li><a href="../pt484910/index.html">Paul Graham: Aborrecedores</a></li>
<li><a href="../pt484918/index.html">Processamento de anota√ß√£o incremental para acelerar constru√ß√µes de gradle</a></li>
<li><a href="../pt484920/index.html">Como entender que voc√™ √© um operador de fresadora?</a></li>
<li><a href="../pt484930/index.html">Vamos acelerar como profissionais</a></li>
<li><a href="../pt484932/index.html">A natureza dupla dos requisitos de software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>