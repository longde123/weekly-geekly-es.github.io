<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜ ğŸ‘©ğŸ½â€ğŸ“ ğŸ‘©â€ğŸ¨ HighLoad ++, Eugene Kuzovlev (EcommPay IT): o que fazer quando um minuto de inatividade custa US $ 100.000 â›¹ğŸ¼ ğŸš· ğŸ‘©ğŸ¾â€ğŸ’»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todo mundo fala sobre os processos de desenvolvimento e teste, treinamento da equipe, motivaÃ§Ã£o crescente, mas esses processos sÃ£o poucos quando um mi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Eugene Kuzovlev (EcommPay IT): o que fazer quando um minuto de inatividade custa US $ 100.000</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/484908/"> Todo mundo fala sobre os processos de desenvolvimento e teste, treinamento da equipe, motivaÃ§Ã£o crescente, mas esses processos sÃ£o poucos quando um minuto de inatividade do serviÃ§o custa espaÃ§o em dinheiro.  O que fazer quando vocÃª realiza transaÃ§Ãµes financeiras sob um SLA rÃ­gido?  Como aumentar a confiabilidade e a tolerÃ¢ncia a falhas de seus sistemas, descrevendo o desenvolvimento e os testes? <br><br><img src="https://habrastorage.org/webt/dz/-p/tn/dz-ptnygkaqhxsm07hgsfil2fxq.jpeg"><br><br>  A prÃ³xima conferÃªncia HighLoad ++ serÃ¡ realizada nos dias 6 e 7 de abril de 2020 em SÃ£o Petersburgo.  Detalhes e ingressos <a href="http://bit.ly/2sSxgBx">aqui</a> .  9 de novembro, 18:00.  HighLoad ++ Moscou 2018, Delhi + Calcutta Hall.  Resumos e <a href="http://www.highload.ru/moscow/2018/abstracts/4226">apresentaÃ§Ã£o</a> . <a name="habracut"></a><br><br>  <b>Evgeny Kuzovlev (a seguir denominada CE):</b> - Amigos, olÃ¡!  Meu nome Ã© Kuzovlev Evgeny.  Eu sou da EcommPay, uma divisÃ£o especÃ­fica Ã© a EcommPay IT, uma divisÃ£o de TI de um grupo de empresas.  E hoje falaremos sobre perÃ­odos de inatividade - como evitÃ¡-los, como minimizar suas consequÃªncias, se vocÃª nÃ£o puder evitÃ¡-las.  O tema Ã©: "O que fazer quando um minuto de inatividade custa US $ 100.000?"  Para nÃ³s, olhando para o futuro, os nÃºmeros sÃ£o comparÃ¡veis. <br><br><h3>  O que o EcommPay IT faz? </h3><br>  Quem somos  Por que estou na sua frente?  Por que tenho o direito de lhe dizer uma coisa aqui?  E sobre o que falaremos com mais detalhes aqui? <br><br><img src="https://habrastorage.org/webt/id/bv/so/idbvsod8gah5mhw25b4pnidb8d4.jpeg"><br><br>  O Grupo de Empresas EcommPay Ã© um adquirente internacional.  Processamos pagamentos em todo o mundo - na RÃºssia, na Europa e no Sudeste AsiÃ¡tico (em todo o mundo).  Temos 9 escritÃ³rios, 500 funcionÃ¡rios no total e cerca de um pouco menos da metade deles sÃ£o especialistas em TI.  Tudo o que fazemos, tudo em que ganhamos dinheiro, fizemos nÃ³s mesmos. <br><br>  Temos todos os nossos produtos (e muitos deles - na linha de grandes produtos de TI, temos cerca de 16 componentes diferentes) que escrevemos;  nÃ³s nos escrevemos, nos desenvolvemos.  E, no momento, estamos realizando cerca de um milhÃ£o de transaÃ§Ãµes por dia (milhÃµes - provavelmente serÃ¡ correto dizer isso).  Somos uma empresa jovem o suficiente - temos apenas seis anos de idade. <br><br>  HÃ¡ 6 anos, era uma startup tÃ£o grande quando os caras vieram junto com o negÃ³cio.  Eles estavam unidos por uma idÃ©ia (nÃ£o havia mais nada alÃ©m de uma idÃ©ia), e nÃ³s corremos.  Como qualquer startup, corremos mais rÃ¡pido ... Para nÃ³s, a velocidade era mais importante que a qualidade. <br><br>  Em algum momento, paramos: percebemos que nÃ£o podÃ­amos mais viver nessa velocidade e com essa qualidade, e precisÃ¡vamos fazer qualidade em primeiro lugar.  Nesse ponto, decidimos escrever uma nova plataforma que seja correta, escalÃ¡vel e confiÃ¡vel.  Eles comeÃ§aram a escrever essa plataforma (comeÃ§aram a investir, desenvolver desenvolvimento, testar), mas em algum momento perceberam que o desenvolvimento e o teste nÃ£o permitiam alcanÃ§ar um novo nÃ­vel de qualidade de serviÃ§o. <br><br>  VocÃª cria um novo produto, coloca-o em produÃ§Ã£o, mas ainda em algum lugar, algo dÃ¡ errado.  E hoje falaremos sobre como alcanÃ§ar um novo nÃ­vel qualitativo (como o alcanÃ§amos, sobre nossa experiÃªncia), tirando o desenvolvimento e os testes de cena;  falaremos sobre o que estÃ¡ disponÃ­vel para exploraÃ§Ã£o - o que a exploraÃ§Ã£o pode fazer por si sÃ³, o que ela pode oferecer testes para afetar a qualidade. <br><br><h3>  Paradas.  Os mandamentos da exploraÃ§Ã£o. </h3><br>  Sempre a principal pedra angular da qual falaremos hoje Ã© o tempo de inatividade.  Palavra assustadora.  Se tivemos um tempo de inatividade, tudo estÃ¡ ruim conosco.  Estamos correndo para aumentar, os administradores estÃ£o mantendo o servidor - Deus o livre, ele nÃ£o cai, como naquela mÃºsica.  Ã‰ sobre isso que falaremos hoje. <br><br><img src="https://habrastorage.org/webt/7w/nd/t8/7wndt8zz0lal9gvkglnu8zcc-fw.jpeg"><br><br>  Quando comeÃ§amos a mudar nossa abordagem, formamos 4 mandamentos.  Eles sÃ£o apresentados nos meus slides: <br><br>  Esses mandamentos sÃ£o bastante simples: <br><br><img src="https://habrastorage.org/webt/kr/vd/zr/krvdzr268yzpyvwaf3_4fgatwrg.jpeg"><br><br><ul><li>  Identifique rapidamente o problema. </li><li>  Livre-se ainda mais rÃ¡pido. </li><li>  Ajude a entender o motivo (posteriormente, para desenvolvedores). </li><li>  E padronizar abordagens. </li></ul><br>  Chamo sua atenÃ§Ã£o para o ponto nÃºmero 2. NÃ³s nos livramos do problema, mas nÃ£o o resolvemos.  Decidir Ã© a segunda vez.  A principal coisa para nÃ³s Ã© que o usuÃ¡rio estÃ¡ protegido contra esse problema.  Ele existirÃ¡ em um determinado ambiente isolado, mas esse ambiente nÃ£o entrarÃ¡ em contato com ele.  Na verdade, passaremos por esses quatro grupos de problemas (para alguns com mais detalhes, para outros com menos detalhes), vou lhe dizer o que usamos, que tipo de experiÃªncia temos na soluÃ§Ã£o. <br><br><h3>  SoluÃ§Ã£o de problemas: quando eles acontecem e o que fazer com eles? </h3><br>  Mas vamos comeÃ§ar fora de ordem, comeÃ§amos com o ponto nÃºmero 2 - como se livrar rapidamente do problema?  HÃ¡ um problema - precisamos corrigi-lo.  "O que devemos fazer com isso?" Ã‰ a questÃ£o principal.  E quando comeÃ§amos a pensar em como corrigir o problema, desenvolvemos alguns requisitos que a soluÃ§Ã£o de problemas deveria seguir. <br><br><img src="https://habrastorage.org/webt/oq/ch/1z/oqch1zstieolkejut_t01rbzokw.jpeg"><br><br>  Para formular esses requisitos, decidimos nos perguntar: "E quando temos problemas"?  E os problemas, como se viu, sÃ£o encontrados em quatro casos: <br><br><img src="https://habrastorage.org/webt/ks/kw/zm/kskwzmylqshsejm96u-bxngu1uq.jpeg"><br><br><ul><li>  Mau funcionamento do hardware. </li><li>  Falha nos serviÃ§os externos. </li><li>  AlteraÃ§Ã£o da versÃ£o do software (a mesma implantaÃ§Ã£o). </li><li>  Crescimento de carga explosiva. </li></ul><br>  NÃ³s nÃ£o vamos falar sobre os dois primeiros.  Um mau funcionamento do hardware Ã© resolvido de maneira simples: vocÃª deve duplicar tudo.  Se estes sÃ£o discos - os discos devem ser montados no RAID, se for um servidor - o servidor deve ser duplicado, se vocÃª tiver uma infraestrutura de rede - vocÃª deve colocar uma segunda cÃ³pia da infraestrutura de rede, ou seja, pegar e duplicar.  E se algo falhar com vocÃª, vocÃª muda para reservar capacidades.  Ã‰ difÃ­cil dizer mais aqui. <br><br>  O segundo Ã© a falha de serviÃ§os externos.  Para a maioria, o sistema nÃ£o Ã© um problema, mas nÃ£o para nÃ³s.  Como processamos pagamentos, somos um agregador que fica entre o usuÃ¡rio (que insere os detalhes do cartÃ£o) e os bancos, sistemas de pagamento ("Visa", "MasterCard", "World" do mesmo).  Nossos serviÃ§os externos (sistemas de pagamento, bancos) tendem a falhar.  Nem nÃ³s nem vocÃª (se vocÃª tiver esses serviÃ§os) podemos influenciar isso. <br><br>  O que fazer entÃ£o?  Existem duas opÃ§Ãµes.  Primeiro, se vocÃª puder, vocÃª deve duplicar este serviÃ§o de alguma forma.  Por exemplo, se pudermos, transferimos o trÃ¡fego de um serviÃ§o para outro: processamos, por exemplo, cartÃµes atravÃ©s do Sberbank, o Sberbank tem problemas - transferimos o trÃ¡fego [condicionalmente] para o Raiffeisen.  A segunda coisa que podemos fazer Ã© notar rapidamente a falha de serviÃ§os externos e, portanto, falaremos sobre a velocidade da reaÃ§Ã£o na prÃ³xima parte do relatÃ³rio. <br><br>  De fato, desses quatro, podemos afetar especificamente a alteraÃ§Ã£o das versÃµes de software - para executar aÃ§Ãµes que levarÃ£o a uma melhoria no contexto de implantaÃ§Ãµes e no contexto de crescimento explosivo de carga.  Na verdade, nÃ³s fizemos isso.  Aqui, novamente, uma pequena observaÃ§Ã£o ... <br><br>  Desses quatro problemas, vÃ¡rios sÃ£o resolvidos imediatamente se vocÃª tiver uma nuvem.  Se vocÃª estiver nas nuvens Microsoft Azhur, Ozone, use nossas nuvens, do Yandex ou do Mail, pelo menos um mau funcionamento do hardware se tornarÃ¡ um problema e tudo imediatamente se tornarÃ¡ bom no contexto de um mau funcionamento do hardware. <br><br>  Somos uma empresa pouco padronizada.  Aqui todo mundo estÃ¡ falando sobre Kubernets, sobre nuvens - nÃ£o temos nem Kubernets, nem nuvens.  Mas temos racks com ferro em muitos data centers e somos forÃ§ados a viver com esse ferro, somos forÃ§ados a responder por tudo.  Portanto, neste contexto, conversaremos.  EntÃ£o, sobre os problemas.  Os dois primeiros estÃ£o entre colchetes. <br><br><h3>  Mude a versÃ£o do software.  Bases </h3><br>  Nossos desenvolvedores nÃ£o tÃªm acesso Ã  produÃ§Ã£o.  Porque  Mas somos simplesmente certificados pelo PCI DSS, e nossos desenvolvedores simplesmente nÃ£o tÃªm o direito de entrar no "prod".  Ã‰ isso aÃ­, ponto final.  Absolutamente.  Portanto, a responsabilidade do desenvolvimento termina exatamente no momento em que o desenvolvimento passou a construÃ§Ã£o para o release. <br><br><img src="https://habrastorage.org/webt/ze/bp/su/zebpsueilk7pvkhrsqwn-0nrfko.jpeg"><br><br>  Nossa segunda base, que temos, que tambÃ©m nos ajuda muito, Ã© a falta de conhecimento Ãºnico e nÃ£o documentado.  Espero que vocÃª faÃ§a o mesmo.  Porque se nÃ£o for assim, vocÃª terÃ¡ problemas.  Os problemas surgirÃ£o quando esse conhecimento Ãºnico e nÃ£o documentado nÃ£o estiver presente no momento certo, no lugar certo.  Suponha que vocÃª tenha uma pessoa que saiba como implantar um componente especÃ­fico - nÃ£o hÃ¡ ninguÃ©m, ele esteja de fÃ©rias ou adoeceu - isso Ã© tudo, vocÃª tem problemas. <br><br>  E a terceira base para a qual chegamos.  Chegamos a ele com dor, sangue, lÃ¡grimas - chegamos Ã  conclusÃ£o de que qualquer uma de nossas construÃ§Ãµes contÃ©m erros, mesmo que sem erros.  Decidimos isso por nÃ³s mesmos: quando implementamos algo, quando lanÃ§amos algo no produto - temos uma compilaÃ§Ã£o com erros.  NÃ³s formamos os requisitos que nosso sistema deve atender. <br><br><h3>  Requisitos de alteraÃ§Ã£o de versÃ£o de software </h3><br>  Existem trÃªs destes requisitos: <br><br><img src="https://habrastorage.org/webt/ou/qm/ma/ouqmmajckkplivqpqoiuwsvs3hs.jpeg"><br><br><ul><li>  Devemos reverter rapidamente a implantaÃ§Ã£o. </li><li>  Devemos minimizar o impacto de uma implantaÃ§Ã£o malsucedida. </li><li>  E precisamos ser capazes de ficar presos rapidamente em paralelo. <br>  Nessa ordem!  Porque  Porque, em primeiro lugar, ao implantar a nova versÃ£o, a velocidade nÃ£o Ã© importante, mas Ã© importante para vocÃª, se algo der errado, reverta rapidamente e tenha um impacto mÃ­nimo.  Mas se vocÃª tiver um conjunto de versÃµes na produÃ§Ã£o, para as quais ocorreu um erro (como neve em sua cabeÃ§a, nÃ£o houve implantaÃ§Ã£o, mas o erro estÃ¡ contido) - a velocidade da implantaÃ§Ã£o subsequente Ã© importante para vocÃª.  O que fizemos para atender a esses requisitos?  Recorremos a essa metodologia: <br><br><img src="https://habrastorage.org/webt/bx/xn/9h/bxxn9hd10bckeqbycqanabweery.jpeg"><br><br>  Ã‰ sabido que nÃ£o inventamos uma Ãºnica vez - esse Ã© o implante azul / verde.  O que Ã© isso  VocÃª deve ter uma cÃ³pia para cada grupo de servidores nos quais seus aplicativos estÃ£o instalados.  A cÃ³pia estÃ¡ â€œquenteâ€: nÃ£o hÃ¡ trÃ¡fego, mas a qualquer momento esse trÃ¡fego pode ser enviado para esta cÃ³pia.  Esta cÃ³pia contÃ©m a versÃ£o anterior.  E no momento da implantaÃ§Ã£o, vocÃª lanÃ§a o cÃ³digo em uma cÃ³pia inativa.  Em seguida, alterne parte do trÃ¡fego (ou todo) para a nova versÃ£o.  Portanto, para alterar o fluxo de trÃ¡fego da versÃ£o antiga para a nova, vocÃª sÃ³ precisa executar uma aÃ§Ã£o: vocÃª precisa alterar o balanceador no upstream, alterar a direÃ§Ã£o - de um upstream para outro.  Isso Ã© muito conveniente e resolve o problema de troca rÃ¡pida e reversÃ£o rÃ¡pida. <br><br>  Aqui, a soluÃ§Ã£o para a segunda pergunta Ã© a minimizaÃ§Ã£o: vocÃª pode colocar em uma nova linha, em uma linha com um novo cÃ³digo, apenas parte do seu trÃ¡fego (deixe, por exemplo, 2%).  E esses 2% - eles nÃ£o sÃ£o 100%!  Se vocÃª perdeu 100% do trÃ¡fego durante uma implantaÃ§Ã£o malsucedida - isso Ã© assustador, se vocÃª perdeu 2% do trÃ¡fego - isso Ã© desagradÃ¡vel, mas nÃ£o Ã© assustador.  AlÃ©m disso, os usuÃ¡rios provavelmente nem perceberÃ£o isso, porque em alguns casos (nem todos) o mesmo usuÃ¡rio, pressionando F5, ele chegarÃ¡ a outra versÃ£o funcional. <br><br><h3>  ImplantaÃ§Ã£o azul / verde.  Encaminhamento </h3><br>  AlÃ©m disso, nem tudo Ã© tÃ£o simples "ImplantaÃ§Ã£o Azul / Verde" ... Todos os nossos componentes podem ser divididos em trÃªs grupos: <br><br><ul><li>  Este Ã© o frontend (pÃ¡ginas de pagamento que nossos clientes veem); </li><li>  nÃºcleo de processamento; </li><li>  um adaptador para trabalhar com sistemas de pagamento (bancos, MasterCard, Visa ...). </li></ul><br>  E hÃ¡ uma nuance - a nuance Ã© o roteamento entre as linhas.  Se vocÃª simplesmente alternar 100% do trÃ¡fego, nÃ£o terÃ¡ esses problemas.  Mas se vocÃª deseja alternar 2%, as perguntas comeÃ§am: â€œComo fazer isso?â€ A coisa mais simples na testa: vocÃª pode, aleatoriamente, configurar Round Robin no nginx, e vocÃª tem 2%, 98% - para a direita.  Mas isso nem sempre Ã© adequado. <br><br>  Aqui, por exemplo, o usuÃ¡rio interage com o sistema em mais de uma solicitaÃ§Ã£o.  Isso Ã© normal: 2, 3, 4, 5 consultas - seus sistemas podem ser os mesmos.  E se for importante para vocÃª que todas as solicitaÃ§Ãµes do usuÃ¡rio cheguem Ã  mesma linha em que a primeira solicitaÃ§Ã£o chegou, ou (no segundo momento) todas as solicitaÃ§Ãµes do usuÃ¡rio cheguem a uma nova linha apÃ³s a troca (ele poderia trabalhar mais cedo com o sistema, antes da troca), - entÃ£o essa distribuiÃ§Ã£o aleatÃ³ria nÃ£o combina com vocÃª.  Depois, existem as seguintes opÃ§Ãµes: <br><br><img src="https://habrastorage.org/webt/hs/3f/fq/hs3ffqgbcy8wu3lzopom58r6tlm.jpeg"><br><br>  A primeira opÃ§Ã£o, a mais fÃ¡cil - com base nos parÃ¢metros bÃ¡sicos do cliente (IP Hash).  VocÃª tem um IP e compartilha da direita para a esquerda por IP.  EntÃ£o, o segundo caso descrito por mim funcionarÃ¡ para vocÃª quando houver uma implantaÃ§Ã£o, o usuÃ¡rio jÃ¡ poderÃ¡ comeÃ§ar a trabalhar com seu sistema e, a partir do momento da implantaÃ§Ã£o, todas as solicitaÃ§Ãµes serÃ£o direcionadas para uma nova linha (por exemplo, a mesma). <br><br>  Se, por algum motivo, isso nÃ£o lhe agradar e vocÃª precisar enviar solicitaÃ§Ãµes para a linha em que a solicitaÃ§Ã£o Ã­ntima principal do usuÃ¡rio veio, vocÃª tem duas opÃ§Ãµes ... <br>  A primeira opÃ§Ã£o: vocÃª pode receber nginx + pago.  Existe um mecanismo de sessÃµes fixas, que, mediante solicitaÃ§Ã£o inicial do usuÃ¡rio, expÃµe uma sessÃ£o ao usuÃ¡rio e a vincula a um determinado montante.  Todas as solicitaÃ§Ãµes subsequentes do usuÃ¡rio durante a vida Ãºtil da sessÃ£o irÃ£o para o mesmo upstream em que a sessÃ£o foi configurada. <br><br>  Isso nÃ£o nos convinha, porque jÃ¡ tÃ­nhamos nginx normal.  Mudar o nginx + nÃ£o Ã© caro, apenas foi um pouco doloroso para nÃ³s e nÃ£o muito certo.  Por exemplo, â€œSticks Sessionsâ€ nÃ£o funcionou para nÃ³s pelo simples motivo de que â€œSticks Sessionsâ€ nÃ£o oferece uma oportunidade de roteamento com base em â€œEli-orâ€.  LÃ¡, vocÃª pode especificar o que fazemos "SessÃµes permanentes", por exemplo, por IP ou IP e por cookie ou por parÃ¢metro de postagem, mas "Eli-or" jÃ¡ Ã© mais complicado lÃ¡. <br><br>  Portanto, chegamos Ã  quarta opÃ§Ã£o.  Pegamos o nginx em "esterÃ³ides" (isto Ã© openresty) - este Ã© o mesmo nginx que tambÃ©m oferece suporte Ã  inclusÃ£o dos Ãºltimos scripts.  VocÃª pode escrever um Ãºltimo script, deslizar para â€œabertoâ€ e esse Ãºltimo script serÃ¡ executado quando uma solicitaÃ§Ã£o do usuÃ¡rio chegar. <br><br>  E nÃ³s escrevemos, de fato, um script desse tipo, nos definimos como "openrest" e nesse script classificamos 6 parÃ¢metros diferentes para a concatenaÃ§Ã£o de "Or".  Dependendo da disponibilidade deste ou daquele parÃ¢metro, sabemos que o usuÃ¡rio chegou a uma pÃ¡gina ou a outra, a uma linha ou a outra. <br><br><h3>  ImplantaÃ§Ã£o azul / verde.  Vantagens e desvantagens </h3><br>  Ã‰ claro que provavelmente poderÃ­amos facilitar um pouco (use as mesmas â€œsessÃµes fixasâ€), mas ainda temos uma nuance que nÃ£o apenas o usuÃ¡rio interage conosco no Ã¢mbito de um processamento de uma transaÃ§Ã£o ... Mas os sistemas de pagamento tambÃ©m interagem conosco: depois de processarmos a transaÃ§Ã£o (enviando uma solicitaÃ§Ã£o ao sistema de pagamento), obtemos um retorno de chamada. <br>  E suponha que, dentro do nosso circuito, possamos executar o endereÃ§o IP do usuÃ¡rio em todas as solicitaÃ§Ãµes e separar usuÃ¡rios com base no endereÃ§o IP, entÃ£o nÃ£o diremos o mesmo â€œVisaâ€: â€œCaras, somos uma empresa tÃ£o retro, somos meio internacionais (no site e em Da RÃºssia) ... E, por favor, dÃª uma olhada no endereÃ§o IP do usuÃ¡rio em um campo adicional, seu protocolo Ã© padronizado! â€  NegÃ³cio claro, eles nÃ£o vÃ£o concordar. <br><br><img src="https://habrastorage.org/webt/he/5o/-w/he5o-wivis5fucv4e7_1wn1qz3y.jpeg"><br><br>  Portanto, para nÃ³s, nÃ£o se encaixava - nÃ³s abrimos espaÃ§o.  Assim, com o roteamento, chegamos assim: <br><br>  O Blue / Green Deploy tem, respectivamente, as vantagens de que falei e as desvantagens. <br><br>  Desvantagem dois: <br><br><ul><li>  vocÃª precisa se preocupar com o roteamento; </li><li>  a segunda principal desvantagem Ã© o custo. </li></ul><br>  VocÃª precisa do dobro de servidores, do dobro de recursos operacionais, do esforÃ§o para manter todo esse zoolÃ³gico. <br><br>  A propÃ³sito, entre as vantagens, hÃ¡ outra coisa que eu nÃ£o mencionei antes: vocÃª tem uma reserva em caso de aumento de carga.  Se vocÃª tiver um crescimento explosivo de carga, um grande nÃºmero de usuÃ¡rios cairÃ¡ sobre vocÃª, basta incluir a segunda linha na distribuiÃ§Ã£o de 50 a 50 - e vocÃª terÃ¡ imediatamente 2 servidores no cluster atÃ© resolver o problema de ter servidores ainda. <br><br><h3>  Como fazer uma implantaÃ§Ã£o rÃ¡pida? </h3><br>  Falamos sobre como resolver o problema de minimizaÃ§Ã£o e reversÃ£o rÃ¡pida, mas a pergunta permanece: "Como implantar rapidamente?" <br><br><img src="https://habrastorage.org/webt/vy/8l/xo/vy8lxokper6luvftog4okdvgbh4.jpeg"><br><br>  Aqui Ã© breve e simples. <br><br><ul><li>  VocÃª deve ter um sistema de CD (Entrega contÃ­nua) - sem ele, em lugar nenhum.  Se vocÃª tiver um servidor, poderÃ¡ ficar preso com canetas.  Temos cerca de mil e meio servidores e 1.500 alÃ§as, Ã© claro - podemos plantar um departamento do tamanho desta sala, apenas para implantar. </li><li>  A implantaÃ§Ã£o deve ser paralela.  Se vocÃª tem uma implantaÃ§Ã£o consistente, tudo estÃ¡ ruim.  Um servidor Ã© normal, vocÃª implantarÃ¡ mil e meio servidores o dia todo. </li><li>  Novamente, para acelerar, isso nÃ£o Ã© mais necessÃ¡rio, provavelmente.  Quando desploey geralmente constrÃ³i o projeto.  VocÃª tem um projeto da Web, existe uma parte de front-end (vocÃª faz um pacote da Web lÃ¡, o npm coleta algo assim) e esse processo, em princÃ­pio, tem vida curta - 5 minutos, mas esses 5 minutos podem ser crÃ­ticos.  Portanto, por exemplo, nÃ£o fazemos isso: removemos esses 5 minutos, implantamos artefatos. <br><br>  O que Ã© um artefato?  Um artefato Ã© uma construÃ§Ã£o montada na qual toda a peÃ§a da montagem jÃ¡ foi concluÃ­da.  Armazenamos esse artefato no armazenamento de artefatos.  Usamos dois desses armazenamentos ao mesmo tempo - era o Nexus e agora o jFrog Artifactory.) Inicialmente, usamos o Nexus porque comeÃ§amos a praticar essa abordagem em aplicativos java (ela se adaptou bem).  EntÃ£o eles colocam a parte dos aplicativos escritos pelo PHP lÃ¡;  e o Nexus nÃ£o era mais adequado e, portanto, escolhemos o jFrog Artefactory, que pode criar quase tudo.  Chegamos atÃ© ao fato de que, nesse armazenamento de artefatos, armazenamos nossos prÃ³prios pacotes binÃ¡rios, que coletamos para servidores. </li></ul><br><h3>  Crescimento de carga explosiva </h3><br>  NÃ³s conversamos sobre mudar a versÃ£o do software.  A prÃ³xima coisa que temos Ã© um crescimento explosivo de carga.  Aqui eu provavelmente entendo que o crescimento explosivo da carga nÃ£o Ã© a coisa certa ... <br><br>  Escrevemos um novo sistema - ele Ã© orientado a serviÃ§os, bonito e elegante, em todos os lugares, em todos os lugares, em todas as filas, em todos os lugares assincronia.  E nesses sistemas, os dados podem ter um fluxo diferente.  Para a primeira transaÃ§Ã£o, o 1Âº, 3Âº e 10Âº trabalhador pode estar envolvido, para a segunda transaÃ§Ã£o - 2Âº, 4Âº, 5Âº.  E hoje, digamos, de manhÃ£, vocÃª tem um fluxo de dados que usa os trÃªs primeiros trabalhadores e, Ã  noite, muda drasticamente, e tudo usa os outros trÃªs trabalhadores. <br><br>  E aqui acontece que vocÃª precisa de alguma forma escalar os trabalhadores, de alguma forma escalar seus serviÃ§os, mas, ao mesmo tempo, impedir o aumento de recursos. <br><br><img src="https://habrastorage.org/webt/wg/1t/kr/wg1tkrnswlv954eaws3dj1ije_a.jpeg"><br><br>  Determinamos os requisitos para nÃ³s mesmos.    :    Service discovery,  â€“       ,    â€“   .  ,      ,    .   Â«Â»,   Â«Â»,    . <br><br>     ?    .       70  .      Â«Â»,  Â«Â» ,  ,        .    100   Â«Â»,        100     .         .  ,    â€“  24/7   ,      ,    ,  70   ,  . <br><br>     Â«Â»,     IP     Scale-Nomad â€“ ScaleNo,    :                 .  ,  : Â«  ?Â»     â€“  ,   . <br><br>        ,       ,  ,     ,    ,       â€“  , .     3-5  â€“   . <br><br><img src="https://habrastorage.org/webt/8z/ja/m0/8zjam0uickgtjt67yl6grtzfmao.jpeg"><br><br>  Como isso funciona?  !  :       :   ,  â€“   ,   â€“  ,  â€“  . <br><br>  ,     .         45  â€“     .       2         ,     (    â€“ ,   ).     â€“    ,  5-10 ,    . <br><br>     Â«Â»,      ,  Â«Â»      .  ,    ,    â€“       .     .    â„– 2 â€“ Â«    Â». <br><br><h3> .    ? </h3><br>    â€“ Â«   ?Â» !      .      ? <br><br><img src="https://habrastorage.org/webt/md/xm/op/mdxmopdox-kznqvid9b4uesleeg.jpeg"><br><br>  ! <br><br><ul><li>           . </li><li>       ,   ,     . </li><li>   â€“   .      ,     ,   -  . </li></ul><br>  , ,     .   .  ,    .    Â« Â».       : <br><br><img src="https://habrastorage.org/webt/8w/1z/w4/8w1zw4dq1rwsz7e7dg7tp53wbke.jpeg"><br><br>   Â«Â»    Â«Â»,     . Â«Â»     . Â«Â»  Â«Â»      ,      ,   â€“  Â«Â»  Â«Â»,  â€“ Â«Â»  Â«Â»  Telegraf. <br><br>      New Relic.  ,   .     ,    .       1,5  ,    , : Â«     Â».    ,  ,     .    Â«-Â» ,    15     Â«-Â».    . <br><br>    ,     â€“  Debugger.     Â«Â»,       ,  ,    Â«Â».  O que Ã© isso  ,     15-30    ,  Â« Â» ,      . <br><br> ,    ( ) â€“      ,    .   ,    Â«Â» â€“ ,   Â«Â» .       â€“     ,  ,  ,     . <br><br><h3>     ? </h3><br>     ?     ? <br><br><img src="https://habrastorage.org/webt/8c/qe/tn/8cqetn3kfyedayuv9fwc8qpx4vq.jpeg"><br><br><ul><li> Response time / RPS   â€“   .   ,    -  . </li><li>      . </li><li>  . </li><li>   . </li></ul><br>   â€“ Â«Â», Â«Â» .       ,    - ,      .     â€“   (        ).    -    5-10-15  â€“ ,     (  ). <br><br>      â€“     : <br><br><img src="https://habrastorage.org/webt/73/xa/jg/73xajgyfx9xahrr_9hl3ysaapgw.jpeg"><br><br>    â€“ 6 ,     â€“       .    â€“ RPS, RTS.  â€“    Â«Â».   Â«Â»     ,  -       â€¦      ,    . <br><br> ,      â€“       .    OpenTracing â€“ , , ,     ;    .  OpenTracing-   ,       .     ,       , .  ,      ,   . <br><br><img src="https://habrastorage.org/webt/42/nw/5h/42nw5hrsai8-i8t3bnsclajtklw.jpeg"><br><br>   ,         3  â€“    .     ,   ,    20-30 . <br><br>     ,   â€“   . <br><br>  ,  ,     ,        ,   .   ,    . <br><br><img src="https://habrastorage.org/webt/d8/pz/1v/d8pz1vfzv9otccv6dsa-crqiuuu.jpeg"><br><br>      ? ,  :     (,  Â«Â»);   , .         ,   ,  â€¦      â€“        -.   ,   : Â«        Â»? <br><br>   â€¦       -,   ( )    ,      .    :       â€“ ,      ,     ( ).    ,    -        .     !      .         . <br><br>      ,    . <br><br><h3>     </h3><br>   ,    â€“   ,    ,  ,     ,      ,    -   . ,   ,   . <br><br><img src="https://habrastorage.org/webt/e2/kb/jz/e2kbjzy9w7wvv6kicbniocak4ac.jpeg"><br><br>      (  â€“ ),       ELK Stack â€“    .  -, ,   ELK,      ,       ELK.    . <br><br><img src="https://habrastorage.org/webt/_f/8a/3i/_f8a3ibc2i7os5pp3xot6m9_gxo.jpeg"><br><br>   .  ,    ,  ,     ,   Â«Â»,   id-       ( ).        .  Porque    ,      ,      .      ,     â€“   OpenTracing,    . <br><br>     ,      ,      â€“  Â«Â» (Zipkin)  Â«Â» (Jaeger). Â«Â» â€“      ,   Â«Â».  Â«Â»  ,  ,     ,      ,   .  Â«Â»  . <br><br>   Â«Â»:   ,    Api ( Api  PHP   , ,    â€“   ,    ),     . Â«Â», â€“  ,    .    ?     : <br><br><img src="https://habrastorage.org/webt/uq/x2/mu/uqx2muumblbudpbjnuittfrsdkk.jpeg"><br><br>  Â«Â»     span'.  ,    ,           (1-2-3 â€“      ,   ).      ,        . ,          Error.     Error    ,      .    ,    span: <br><br><img src="https://habrastorage.org/webt/3e/is/fk/3eisfkpsc9mkuipyg-5iaob2d-y.jpeg"><br><br>     .       ,       ,   .        :    â€“  ,   ,            . <br><br> ,    .    ,    .      ,      Â«Â»   PHP â€“   , welcome to use,  : <br><br><img src="https://habrastorage.org/webt/q7/vi/pc/q7vipcgfujbggn_zt64r3h7foay.jpeg"><br><br>     â€“     OpenTracing Api,   php-extention,          .      .     ,   .   :     ,    extention up to you. <br><br><h3>   </h3><br>    .   â€“   .   ?    : <br><br><img src="https://habrastorage.org/webt/3h/ka/zo/3hkazonrypgjcuakfff1yrutxlc.jpeg"><br><br>    Â«Â»?        , !  Â«Â»       ,    ,        ,      .     ? <br><br><img src="https://habrastorage.org/webt/b7/h6/qa/b7h6qavqwtn9fm9bam0jbg07nym.jpeg"><br><br><ul><li>     .      ,  .    60   ,        .     , ,         â€“ ,   . </li><li>    .          ,     ,        RnD-.       ,      (,    ) ,    ,   . </li><li>     ,   â€“ ,     .       . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos tolerÃ¢ncias. </font><font style="vertical-align: inherit;">Por exemplo, nÃ£o consideramos o tempo de inatividade se perdermos 2% do trÃ¡fego em dois minutos. </font><font style="vertical-align: inherit;">Isso, em princÃ­pio, nÃ£o se enquadra em nossas estatÃ­sticas. </font><font style="vertical-align: inherit;">Se mais em porcentagem ou tempo, jÃ¡ contamos.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E sempre escrevemos post-mortem. </font><font style="vertical-align: inherit;">O que quer que aconteÃ§a conosco, qualquer situaÃ§Ã£o em que ele se comporte de maneira inadequada no local de produÃ§Ã£o serÃ¡ refletida no potencial de venda. </font><font style="vertical-align: inherit;">Um post-mortem Ã© um documento no qual vocÃª escreve o que aconteceu com vocÃª, o tempo detalhado do que vocÃª fez para corrigi-lo e (este Ã© um bloco obrigatÃ³rio!) O que vocÃª farÃ¡ para impedir que isso aconteÃ§a no futuro. </font><font style="vertical-align: inherit;">Isso Ã© necessÃ¡rio, necessÃ¡rio para anÃ¡lises subsequentes.</font></font></li></ul><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O que considerar no tempo de inatividade? </font></font></h3><br><img src="https://habrastorage.org/webt/ad/8v/ye/ad8vyesevuqquvkj4rtf15hggd8.jpeg"><br><br>  A que tudo isso levou? <br><br>  Isso levou ao fato de que (tivemos alguns problemas de estabilidade, isso nÃ£o era adequado para nÃ³s ou clientes) nos Ãºltimos 6 meses, nosso indicador de estabilidade foi de 99,97.  Podemos dizer que isso nÃ£o Ã© muito.  Sim, temos algo pelo que lutar.  Cerca de metade desse indicador Ã© a estabilidade, por assim dizer, nÃ£o a nossa, mas o firewall de aplicativos da web, que estÃ¡ diante de nÃ³s e Ã© usado como um serviÃ§o, mas isso nÃ£o importa para os clientes. <br><br>  Aprendemos a dormir Ã  noite.  Finalmente!  Seis meses atrÃ¡s, nÃ£o sabÃ­amos como.  E nesta nota com os resultados, quero fazer uma observaÃ§Ã£o.  Ontem Ã  noite houve um relatÃ³rio maravilhoso sobre um sistema de controle de reatores nucleares.  Se as pessoas que escreveram esse sistema me ouvirem, esqueÃ§a o que eu disse sobre "2% nÃ£o Ã© tempo de inatividade".  Para vocÃª, 2% Ã© tempo de inatividade, mesmo que por dois minutos "! <br><br>  Isso Ã© tudo!  Suas perguntas. <br><br><img src="https://habrastorage.org/webt/us/ih/xg/usihxgshbsygnv59b5detm4js5m.jpeg"><br><br><h3>  Sobre balanceadores e migraÃ§Ã£o de banco de dados </h3><br>  Pergunta da platÃ©ia (doravante - B): - Boa noite.  Muito obrigado por esse relatÃ³rio de administrador!  A pergunta Ã© curta sobre o assunto de seus balanceadores.  VocÃª mencionou que possui WAF, ou seja, pelo que entendi, vocÃª usa algum tipo de balanceador externo ... <br><br>  <b>:</b> - NÃ£o, usamos nossos serviÃ§os como balanceador.  Nesse caso, o WAF Ã© para nÃ³s apenas uma ferramenta de proteÃ§Ã£o contra DDoS. <br><br>  <b>P:</b> - VocÃª poderia dizer algumas palavras sobre os balanceadores? <br><br>  <b>EK:</b> - Como eu disse, este Ã© um grupo de servidores em openresty.  Agora temos 5 grupos de grupos redundantes que respondem exclusivamente ... ou seja, um servidor no qual fica exclusivamente aberto, apenas proxyiza o trÃ¡fego.  Portanto, para entender o quanto mantemos: agora temos um fluxo de trÃ¡fego regular - sÃ£o vÃ¡rias centenas de megabits.  Eles conseguem, se sentem bem, nem se esforÃ§am. <br><br>  <b>P:</b> - TambÃ©m Ã© uma pergunta simples.  HÃ¡ uma implantaÃ§Ã£o azul / verde.  E o que vocÃª faz, por exemplo, com migraÃ§Ãµes do banco de dados? <br><br>  <b>EK:</b> - Boa pergunta!  Olha, nÃ³s na implantaÃ§Ã£o Azul / Verde temos linhas separadas para cada linha.  Ou seja, se estamos falando sobre as linhas de eventos que sÃ£o transmitidas do trabalhador para o trabalhador, existem linhas separadas para a linha azul e a linha verde.  Se estamos falando sobre o prÃ³prio banco de dados, reduzimos deliberadamente, como pudemos, colocar tudo quase na linha, temos apenas uma pilha de transaÃ§Ãµes no banco de dados.  E temos uma Ãºnica pilha de transaÃ§Ãµes para todas as linhas.  Com um banco de dados nesse contexto: nÃ£o o compartilhamos em azul e verde, porque as duas versÃµes do cÃ³digo devem saber o que estÃ¡ acontecendo com a transaÃ§Ã£o. <br><br>  Amigos, ainda tenho um prÃªmio tÃ£o pequeno para estimular vocÃª - um livro.  E preciso entregÃ¡-la para a melhor pergunta. <br><br>  <b>Q:</b> - OlÃ¡.  Obrigado pelo relatÃ³rio.  A questÃ£o Ã© essa.  VocÃª monitora pagamentos, monitora os serviÃ§os com os quais se comunica ... Mas como vocÃª monitora para que uma pessoa de alguma forma chegue Ã  sua pÃ¡gina de pagamento, faÃ§a um pagamento e o projeto lhe dÃª dinheiro?  Ou seja, como vocÃª monitora se o marchant estÃ¡ disponÃ­vel e aceita seu retorno de chamada? <br><br>  <b>Nota:</b> - "Comerciante" para nÃ³s, neste caso, Ã© exatamente o mesmo serviÃ§o externo que o sistema de pagamento.  Monitoramos a velocidade de resposta do "comerciante". <br><br><h3>  Sobre criptografia de banco de dados </h3><br>  <b>Q:</b> - OlÃ¡.  Eu tenho um pouco de pergunta.  VocÃª possui dados sensÃ­veis do PCI DSS.  Eu queria saber como vocÃª armazena os PANs em filas nas quais precisa jogar?  VocÃª usa alguma criptografia?  A partir daqui, surge a seguinte segunda pergunta: no PCI DSS, Ã© necessÃ¡rio criptografar o banco de dados periodicamente em caso de alteraÃ§Ãµes (dispensa de administradores e assim por diante) - como, neste caso, acontece com a acessibilidade? <br><br><img src="https://habrastorage.org/webt/0z/oh/29/0zoh293lif-ioxouzt79ui9j98a.jpeg"><br><br>  <b>EK:</b> - Pergunta maravilhosa!  Em primeiro lugar, nÃ£o armazenamos PANs nas filas.  NÃ£o temos o direito de armazenar o PAN em qualquer lugar de forma clara, em princÃ­pio, portanto, usamos um serviÃ§o especial (chamamos de â€œKademonâ€) - este Ã© um serviÃ§o que faz apenas uma coisa: recebe uma mensagem e envia uma mensagem criptografada.  E nÃ³s armazenamos tudo com essa mensagem criptografada.  Consequentemente, o comprimento da chave para nÃ³s Ã© inferior a kilobytes, para que seja direto, sÃ©rio e confiÃ¡vel. <br><br>  <b>P:</b> - VocÃª precisa de 2 kilobytes agora? <br><br>  <b>EK:</b> - Parece que ontem tinha 256 ... Bem, onde mais ?! <br><br>  Consequentemente, este Ã© o primeiro.  E segundo, a soluÃ§Ã£o que existe, suporta o processo de re-criptografia - existem dois pares de "bolos" (chaves) que fornecem "decks" que criptografam (chave sÃ£o chaves, dek sÃ£o derivados de chaves que criptografam).  E no caso do inÃ­cio do procedimento (ocorre regularmente, de 3 meses a Â± alguns), enviamos um novo par de â€œbolosâ€ e os dados sÃ£o criptografados novamente.  Temos serviÃ§os separados que separam todos os dados e os criptografam de uma nova maneira;  os dados sÃ£o armazenados ao lado do identificador de chave com o qual sÃ£o criptografados.  Assim, assim que nossos dados sÃ£o criptografados com novas chaves, excluÃ­mos a chave antiga. <br><br><h3>  Ã€s vezes, vocÃª precisa fazer pagamentos manualmente ... </h3><br>  <b>P:</b> - Ou seja, se um retorno ocorreu para alguma operaÃ§Ã£o, decifre-o com a chave antiga? <br><br>  <b>CE:</b> - Sim. <br><br>  <b>Q:</b> - EntÃ£o, mais uma pequena pergunta.  Quando hÃ¡ algum tipo de falha, queda, incidente, Ã© necessÃ¡rio enviar a transaÃ§Ã£o no modo manual.  Existe uma situaÃ§Ã£o dessas. <br><br>  <b>EK:</b> - Sim, faz. <br><br>  <b>P:</b> - De onde vocÃª tira esses dados?  Ou vocÃª mesmo vai com canetas para esta loja? <br><br>  <b>EK:</b> - NÃ£o, bem, Ã© claro - nÃ³s temos algum tipo de sistema de back-office que contÃ©m uma interface para nosso suporte.  Se nÃ£o soubermos em que status a transaÃ§Ã£o estÃ¡ (por exemplo, enquanto o sistema de pagamento nÃ£o respondeu com um tempo limite), nÃ£o sabemos a priori, ou seja, atribuÃ­mos o status final apenas com total confianÃ§a.  Nesse caso, transferimos a transaÃ§Ã£o para um status especial para processamento manual.  De manhÃ£, no dia seguinte, assim que o suporte recebe informaÃ§Ãµes de que essas transaÃ§Ãµes permanecem no sistema de pagamento, elas as processam manualmente nessa interface. <br><br><img src="https://habrastorage.org/webt/um/1e/qe/um1eqefsegdtcvv8gczvx2qe54o.jpeg"><br><br>  <b>P:</b> - Eu tenho algumas perguntas.  Uma delas Ã© a continuaÃ§Ã£o da zona PCI DSS: como vocÃª obtÃ©m os logs de loop?  Essa pergunta, porque o desenvolvedor pode colocar qualquer coisa nos logs!  Segunda pergunta: como vocÃª lanÃ§a hotfixes?  As canetas no banco de dados sÃ£o uma opÃ§Ã£o, mas pode haver correÃ§Ãµes gratuitas - qual Ã© o procedimento?  E a terceira pergunta provavelmente estÃ¡ relacionada ao RTO, RPO.  Sua disponibilidade era 99,97, quase quatro noves, mas, pelo que entendi, vocÃª tem um segundo data center, um terceiro data center e um quinto data center ... Como vocÃª lida com a sincronizaÃ§Ã£o, replicaÃ§Ã£o e tudo mais? <br><br>  <b>EK:</b> - Vamos comeÃ§ar do primeiro.  A primeira pergunta sobre os logs foi?  Quando escrevemos logs, temos uma camada que mascara todos os dados confidenciais.  Ela olha para a mÃ¡scara e os campos adicionais.  Assim, nossos logs sÃ£o lanÃ§ados com dados jÃ¡ mascarados e um loop PCI DSS.  Essa Ã© uma das tarefas regulares atribuÃ­das ao departamento de testes.  Eles sÃ£o obrigados a verificar todas as tarefas, incluindo os logs que escrevem, e essa Ã© uma das tarefas regulares na revisÃ£o de cÃ³digo, para controlar se o desenvolvedor nÃ£o escreveu nada.  A verificaÃ§Ã£o subsequente disso Ã© realizada regularmente pelo departamento de seguranÃ§a da informaÃ§Ã£o uma vez por semana: os logs sÃ£o selecionados seletivamente no Ãºltimo dia e sÃ£o executados atravÃ©s de um analisador de scanner especial dos servidores de teste para verificar tudo isso. <br>  Sobre hot fixes.  Isso estÃ¡ incluÃ­do no nosso cronograma de implantaÃ§Ã£o.  Temos um item separado sobre hotfixes.  Acreditamos que implantamos hotfixes o tempo todo quando precisamos.  Assim que a versÃ£o for montada, assim que for executada, assim que tivermos o artefato, colocaremos o administrador do sistema de prontidÃ£o no suporte e ele a implantarÃ¡ no momento em que for necessÃ¡rio. <br><br>  Sobre os "quatro noves".  O nÃºmero que temos agora, realmente foi alcanÃ§ado, e o procuramos em outro data center.  Agora temos um segundo data center, e estamos comeÃ§ando a rotear entre eles, e a questÃ£o do centro de replicaÃ§Ã£o de dados cruzados Ã© realmente uma questÃ£o nÃ£o trivial.  Tentamos resolvÃª-lo no devido tempo por diferentes meios: tentamos usar a mesma "TarÃ¢ntula" - nÃ£o funcionou para nÃ³s, estou dizendo imediatamente.  Portanto, chegamos ao fato de fazermos a ordem da "sensaÃ§Ã£o" manualmente.  De fato, temos todas as aplicaÃ§Ãµes no modo assÃ­ncrono das unidades de sincronizaÃ§Ã£o "alteradas" necessÃ¡rias entre os datacenters. <br><br>  <b>P:</b> - Se vocÃª possui um segundo, por que nÃ£o um terceiro?  Porque ninguÃ©m ainda tem cÃ©rebro dividido ... <br><br>  <b>:</b> - E nÃ£o temos um cÃ©rebro dividido.  Devido ao fato de que cada aplicativo dirige um multimaster, nÃ£o importa para nÃ³s qual o centro da solicitaÃ§Ã£o.  Estamos prontos para o fato de que, no caso de um data center travar (estamos deitados nele) e no meio da solicitaÃ§Ã£o de um usuÃ¡rio alternar para um segundo data center, estaremos realmente prontos para perder esse usuÃ¡rio;  mas serÃ£o unidades, unidades absolutas. <br><br>  <b>Q:</b> - Boa noite.  Obrigado pelo relatÃ³rio.  VocÃª falou sobre seu depurador, que conduz algumas transaÃ§Ãµes de teste na produÃ§Ã£o.  Mas conte-nos sobre transaÃ§Ãµes de teste!  Qual a profundidade? <br><br>  <b>CE:</b> - Passa por todo o ciclo de todo o componente.  NÃ£o hÃ¡ diferenÃ§as entre a transaÃ§Ã£o de teste e a de combate para o componente.  E, do ponto de vista da lÃ³gica, este Ã© apenas um projeto separado no sistema, no qual apenas as transaÃ§Ãµes de teste sÃ£o perseguidas. <br><br>  <b>Q:</b> - E onde vocÃª cortou?  EntÃ£o o Core enviou ... <br><br>  <b>::</b> - Estamos atrÃ¡s de "Kor", neste caso, para transaÃ§Ãµes de teste ... Temos um roteamento: "Kor" sabe para qual sistema de pagamento enviar - enviamos para um sistema de pagamento falso, que simplesmente fornece uma resposta http e Ã© tudo . <br><br>  <b>P:</b> - Diga-me, por favor, vocÃª teve o aplicativo escrito em um monolito enorme ou o cortou em alguns serviÃ§os ou mesmo microsserviÃ§os? <br><br>  <b>Nota:</b> - NÃ£o temos um monÃ³lito, Ã© claro, temos um aplicativo orientado a serviÃ§os.  Temos uma piada de que temos um serviÃ§o de monÃ³litos - eles sÃ£o realmente muito grandes.  A chamada de microsserviÃ§os nesse idioma nÃ£o muda de maneira alguma, mas esses sÃ£o os serviÃ§os nos quais os trabalhadores de mÃ¡quinas distribuÃ­dos trabalham. <br><br><h3>  Se o serviÃ§o no servidor estiver comprometido ... </h3><br>  <b>Q:</b> - EntÃ£o eu tenho a seguinte pergunta.  Mesmo que fosse um monÃ³lito, vocÃª ainda disse que possui muitos desses servidores instantÃ¢neos, todos eles processam os dados em princÃ­pio, e a pergunta Ã©: â€œSe um dos servidores instantÃ¢neos ou o aplicativo, qualquer link especÃ­fico estiver comprometido Eles tÃªm algum tipo de controle de acesso?  Qual deles pode fazer o que?  Com quem entrar em contato, para quais dados? <br><br><img src="https://habrastorage.org/webt/3j/qn/pt/3jqnpt1dfzhas9kn5de1qb6x1lq.jpeg"><br><br>  <b>EK:</b> - Sim, claro.  Os requisitos de seguranÃ§a sÃ£o bastante sÃ©rios.  Em primeiro lugar, temos trÃ¡fego de dados abertos e as portas sÃ£o apenas aquelas nas quais antecipamos o trÃ¡fego com antecedÃªncia.  Se o componente se comunicar com o banco de dados (digamos, â€œMuskulâ€) em 5-4-3-2, apenas 5-4-3-2 e outras portas estarÃ£o abertas para ele, outras direÃ§Ãµes de trÃ¡fego nÃ£o estarÃ£o disponÃ­veis.  AlÃ©m disso, devemos entender que, na produÃ§Ã£o, temos cerca de 10 loops de seguranÃ§a diferentes.  E mesmo que o aplicativo tenha sido comprometido de alguma forma, Deus o permita, um invasor nÃ£o poderÃ¡ acessar o console de gerenciamento do servidor, porque esta Ã© outra zona de seguranÃ§a da rede. <br><br>  <b>P:</b> - E neste contexto, estou mais interessado no momento em que vocÃª tem alguns contratos com serviÃ§os - o que eles podem fazer, por meio de quais "aÃ§Ãµes" eles podem entrar em contato ... E no fluxo normal, alguns serviÃ§os especÃ­ficos perguntam quais uma sÃ©rie, uma lista de "aÃ§Ã£o" em outro.  Eles nÃ£o parecem se voltar para os outros em uma situaÃ§Ã£o normal e tÃªm outras Ã¡reas de responsabilidade.  Se um deles estiver comprometido, ele serÃ¡ capaz de executar a "aÃ§Ã£o" desse serviÃ§o? <br><br>  <b>EK:</b> - Eu entendo.  Se em uma situaÃ§Ã£o normal com outro servidor a comunicaÃ§Ã£o geralmente era permitida, entÃ£o sim.  De acordo com o contrato de SLA, nÃ£o monitoramos se vocÃª tem apenas as 3 primeiras "aÃ§Ãµes" e 4 "aÃ§Ãµes" nÃ£o sÃ£o permitidas.  Isso provavelmente Ã© redundante para nÃ³s, porque temos um sistema de proteÃ§Ã£o de quatro nÃ­veis, em princÃ­pio, para circuitos.  Preferimos defender com contornos do que no interior. <br><br><h3>  Como funcionam Visa, MasterCard e Sberbank </h3><br>  <b>P:</b> - Quero esclarecer um momento sobre a troca de um usuÃ¡rio de um data center para outro.  AtÃ© onde eu sei, "Visa" e "MasterCard" funcionam no protocolo sÃ­ncrono binÃ¡rio 8583, existem misturas.  E eu queria saber, agora quero dizer mudar - Ã© diretamente "Visa" e "MasterCard" ou para sistemas de pagamento, para processamentos? <br><br>  <b>EK:</b> - Depende das misturas.  Misturas que temos em um data center. <br><br>  <b>P:</b> - Grosso modo, vocÃª tem um ponto de conexÃ£o? <br><br>  <b>::</b> - â€œ <b>Visor</b> â€ e â€œMasterCardâ€ - sim.  SÃ³ porque "Visa" e "MasterCard" exigem investimentos bastante sÃ©rios em infraestrutura para concluir contratos separados para receber um segundo par de mixagens, por exemplo.  Eles sÃ£o reservados na estrutura de um datacenter, mas, se Deus proibir, o datacenter em que as misturas de conexÃ£o com o "Visa" e o "MasterCard" estÃ£o mortos, teremos uma conexÃ£o com o "Visa" e o "MasterCard" perdido ... <br><br>  <b>P:</b> - Como eles podem ser reservados?  Eu sei que o "Visa" permite que apenas uma conexÃ£o seja mantida em princÃ­pio! <br><br>  <b>EK:</b> - Eles prÃ³prios fornecem equipamentos.  De qualquer forma, recebemos equipamentos com redundÃ¢ncia interna. <br><br>  <b>P:</b> - Ou seja, o rack do Connects Orange? <br><br>  <b>CE:</b> - Sim. <br><br>  <b>P:</b> - Mas, como neste caso: se o seu data center desaparecer, vocÃª deve usÃ¡-lo ainda mais?  Ou Ã© sÃ³ parar o trÃ¡fego? <br><br>  <b>CE:</b> - NÃ£o.  Nesse caso, simplesmente mudamos o trÃ¡fego para outro canal, o que, obviamente, serÃ¡ mais caro para nÃ³s, mais caro para os clientes.  Mas o trÃ¡fego nÃ£o passarÃ¡ por nossa conexÃ£o direta com o "Visa", "MasterCard", mas pelo "Sberbank" convencional (muito exagerado). <br><br>  Sinto muito por machucar os funcionÃ¡rios do Sberbank.  Mas, de acordo com nossas estatÃ­sticas, o Sberbank estÃ¡ caindo com mais frequÃªncia dos bancos russos.  Em menos de um mÃªs, algo nÃ£o caiu no Sberbank. <br><br><img src="https://habrastorage.org/webt/u2/pm/rp/u2pmrpkbplsfx65dstp-lsstwcw.jpeg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6YB1kMnzyRs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Um pouco de publicidade :) </h3><br>  Obrigado por ficar conosco.  VocÃª gosta dos nossos artigos?  Deseja ver materiais mais interessantes?  Ajude-nos fazendo um pedido ou recomendando aos seus amigos <a href="https://ua-hosting.company/cloudvps/nl">VPS baseado em nuvem para desenvolvedores a partir de US $ 4,99</a> , um <b>analÃ³gico exclusivo de servidores</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">bÃ¡sicos</a> <b>que foi inventado por nÃ³s para vocÃª:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 nÃºcleos) 10GB DDR4 480GB SSD 1Gbps de 10GB de US $ 19 ou como dividir o servidor?</a>  (as opÃ§Ãµes estÃ£o disponÃ­veis com RAID1 e RAID10, atÃ© 24 nÃºcleos e atÃ© 40GB DDR4). <br><br>  <b>Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em AmsterdÃ£?</b>  Somente temos <b><a href="https://ua-hosting.company/serversnl">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</a> na Holanda!</b>  <b><b>Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de US $ 99!</b></b>  Leia sobre <a href="https://habr.com/company/ua-hosting/blog/329618/">Como criar um prÃ©dio de infraestrutura.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">classe usando servidores Dell R730xd E5-2650 v4 custando 9.000 euros por um centavo?</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484908/">https://habr.com/ru/post/pt484908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484898/index.html">Bom motivo para testar suas dependÃªncias: ediÃ§Ã£o AGPL</a></li>
<li><a href="../pt484900/index.html">RenderizaÃ§Ã£o de site 101</a></li>
<li><a href="../pt484902/index.html">Em equaÃ§Ãµes de graus mais altos</a></li>
<li><a href="../pt484904/index.html">Um ano sem Splunk - como uma empresa americana mudou o mercado de anÃ¡lise de dados de mÃ¡quinas na RÃºssia e quem deixou para trÃ¡s</a></li>
<li><a href="../pt484906/index.html">Equipe distribuÃ­da e lÃ­der da equipe no controle remoto</a></li>
<li><a href="../pt484910/index.html">Paul Graham: Aborrecedores</a></li>
<li><a href="../pt484918/index.html">Processamento de anotaÃ§Ã£o incremental para acelerar construÃ§Ãµes de gradle</a></li>
<li><a href="../pt484920/index.html">Como entender que vocÃª Ã© um operador de fresadora?</a></li>
<li><a href="../pt484930/index.html">Vamos acelerar como profissionais</a></li>
<li><a href="../pt484932/index.html">A natureza dupla dos requisitos de software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>