<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔮 👩‍🎓 😞 Istio dan Kubernetes dalam produksi. Bagian 2. Menelusuri 💇 🦏 🔩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel terakhir , kami memeriksa komponen dasar Service Mesh Istio, berkenalan dengan sistem dan menjawab pertanyaan dasar yang biasanya muncul ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Istio dan Kubernetes dalam produksi. Bagian 2. Menelusuri</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/433650/">  Pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> terakhir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">,</a> kami memeriksa komponen dasar Service Mesh Istio, berkenalan dengan sistem dan menjawab pertanyaan dasar yang biasanya muncul pada awal bekerja dengan Istio.  Pada bagian ini, kita akan melihat bagaimana mengatur pengumpulan informasi penelusuran melalui jaringan. <br><br><img src="https://habrastorage.org/webt/dz/-l/6j/dz-l6j3yddyja_gjqgvw-3_da2m.png"><br><a name="habracut"></a><br>  Hal pertama yang ditemukan oleh banyak pengembang dan administrator sistem ketika mereka mendengar kata-kata Service Mesh sedang ditelusuri.  Memang, kami menambahkan server proxy khusus untuk setiap node jaringan yang dilaluinya semua lalu lintas TCP.  Tampaknya sekarang Anda dapat dengan mudah mengirim informasi tentang semua interaksi jaringan di jaringan.  Sayangnya, pada kenyataannya ada banyak nuansa yang perlu diperhitungkan.  Mari lihat mereka. <br><br><h3>  Kesalahpahaman nomor satu: kita bisa mendapatkan data perjalanan melalui jaringan secara gratis </h3><br>  Bahkan, relatif gratis, kita hanya bisa mendapatkan node dari sistem kita terhubung dengan panah dan data rate yang melewati antar layanan (pada kenyataannya, hanya jumlah byte per unit waktu).  Namun, dalam kebanyakan kasus, layanan kami berkomunikasi menggunakan beberapa jenis protokol tingkat aplikasi, seperti HTTP, gRPC, Redis, dan sebagainya.  Dan, tentu saja, kami ingin melihat penelusuran informasi secara tepat berdasarkan protokol-protokol ini, kami ingin melihat laju permintaan, dan bukan laju data.  Kami ingin memahami latensi permintaan oleh protokol kami.  Terakhir, kami ingin melihat jalur lengkap dari permintaan yang masuk dari memasuki sistem kami hingga menerima respons dari pengguna.  Masalah ini tidak mudah dipecahkan. <br><br>  Untuk memulai, mari kita lihat bagaimana cara mengirim tracing span dari sudut pandang arsitektur di Istio.  Seperti yang kita ingat dari bagian pertama, Istio memiliki komponen terpisah untuk mengumpulkan telemetri, yang disebut Mixer.  Namun, dalam versi 1.0 saat ini. * Mengirim dilakukan langsung dari server proxy, yaitu, dengan proxy utusan.  Utusan proksi mendukung pengiriman rentang penelusuran melalui protokol zipkin di luar kotak.  Protokol lain dapat dihubungkan, tetapi hanya melalui plugin.  Dengan Istio, kami segera mendapatkan proxy utusan yang dirangkai dan dikonfigurasi, yang hanya mendukung protokol zipkin.  Jika kita ingin menggunakan, misalnya, protokol Jaeger dan mengirim tracing span melalui UDP, maka kita perlu merakit image istio-proxy kita.  Ada dukungan untuk plugin khusus untuk istio-proxy, namun masih dalam versi alpha.  Oleh karena itu, jika kita ingin melakukannya tanpa banyak pengaturan khusus, rentang teknologi yang digunakan untuk menyimpan dan menerima tracing span berkurang.  Dari sistem utama, pada kenyataannya, sekarang Anda dapat menggunakan Zipkin sendiri, atau Jaeger, tetapi mengirim semuanya ke sana menggunakan protokol yang kompatibel dengan zipkin (yang jauh lebih efisien).  Protokol zipkin sendiri melibatkan pengiriman semua informasi penelusuran ke kolektor menggunakan protokol HTTP, yang cukup mahal. <br><br>  Seperti yang saya katakan, kami ingin melacak protokol tingkat aplikasi.  Dan ini berarti bahwa server proxy yang ada di sebelah setiap layanan harus memahami jenis interaksi apa yang terjadi sekarang.  Secara default, Istio menetapkan tipe untuk semua port TCP biasa, yang berarti tidak ada jejak yang akan dikirim.  Agar jejak dapat dikirim, Anda harus terlebih dahulu mengaktifkan opsi ini di konfigurasi jala utama dan, yang sangat penting, ganti nama semua port entitas layanan kubernet sesuai dengan protokol yang digunakan dalam layanan.  Misalnya, seperti ini: <br><br><pre><code class="python hljs">apiVersion: v1 kind: Service metadata: name: nginx spec: ports: - port: <span class="hljs-number"><span class="hljs-number">80</span></span> targetPort: <span class="hljs-number"><span class="hljs-number">80</span></span> name: http selector: app: nginx</code> </pre> <br>  Anda juga dapat menggunakan nama majemuk, seperti http-magic (Istio melihat http dan mengenali port ini sebagai titik akhir http).  Formatnya adalah: proto-extra. <br><br>  Agar tidak menambal sejumlah besar konfigurasi untuk mendefinisikan protokol, Anda dapat menggunakan solusi kotor: untuk menambal komponen Pilot pada saat itu hanya <a href="">mengeksekusi logika definisi protokol</a> .  Pada akhirnya, tentu saja, Anda perlu mengubah logika ini menjadi standar dan pergi ke konvensi penamaan untuk semua port. <br><br>  Untuk memahami apakah protokol benar-benar didefinisikan dengan benar, Anda harus masuk ke salah satu wadah sespan dengan proxy utusan dan membuat permintaan ke port admin antarmuka utusan dengan lokasi / config_dump.  Dalam konfigurasi yang dihasilkan, Anda perlu melihat operasi bidang layanan yang diinginkan.  Ini digunakan dalam Istio sebagai pengidentifikasi ke mana tujuan permintaan.  Untuk menyesuaikan nilai parameter ini di Istio (kita akan melihatnya di sistem penelusuran kami), Anda harus menentukan flag serviceCluster pada tahap peluncuran wadah sespan.  Misalnya, dapat dihitung seperti ini dari variabel yang diperoleh dari kubernet API ke bawah: <br><br> <code>--serviceCluster ${POD_NAMESPACE}.$(echo ${POD_NAME} | sed -e 's/-[a-z0-9]*-[a-z0-9]*$//g')</code> <br> <br>  Contoh yang bagus untuk memahami bagaimana penelusuran berfungsi dalam utusan ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Titik akhir itu sendiri untuk mengirim tracing span juga harus ditentukan dalam flag awal proxy utusan, misalnya: <code>--zipkinAddress tracing-collector.tracing:9411</code> <br><br><h3>  Kesalahpahaman nomor dua: kita bisa mendapatkan jalan setapak yang lengkap dari permintaan untuk sistem di luar kotak </h3><br>  Sayangnya, ini tidak benar.  Kompleksitas implementasi tergantung pada bagaimana Anda telah menerapkan interaksi layanan.  Kenapa begitu <br><br>  Faktanya adalah agar istio-proxy dapat memahami korespondensi permintaan masuk ke layanan dengan mereka yang berasal dari layanan yang sama, tidak cukup hanya dengan mencegat semua lalu lintas.  Anda harus memiliki semacam pengenal tautan.  HTTP proxy utusan menggunakan header khusus, dimana utusan memahami permintaan layanan tertentu yang menghasilkan permintaan spesifik ke layanan lain.  Daftar tajuk tersebut: <br><br><ul><li>  x-request-id, </li><li>  x-b3-traceid, </li><li>  x-b3-spanid, </li><li>  x-b3-parentspanid, </li><li>  sampel x-b3, </li><li>  bendera x-b3, </li><li>  x-ot-span-context. </li></ul><br>  Jika Anda memiliki satu titik, misalnya, klien basis di mana Anda dapat menambahkan logika seperti itu, maka semuanya baik-baik saja, Anda hanya perlu menunggu semua klien untuk memperbarui perpustakaan ini.  Tetapi jika Anda memiliki sistem yang sangat heterogen dan tidak ada penyatuan dalam kampanye dari layanan ke layanan melalui jaringan, maka ini kemungkinan besar akan menjadi masalah besar.  Tanpa penambahan logika seperti itu, semua informasi penelusuran hanya akan menjadi "saudara".  Yaitu, kita mendapatkan semua interaksi antar-layanan, tetapi mereka tidak akan dilem menjadi satu rantai lintasan melalui jaringan. <br><br><h3>  Kesimpulan </h3><br>  Istio menyediakan alat yang mudah untuk mengumpulkan informasi penelusuran melalui jaringan, namun, Anda harus memahami bahwa untuk implementasinya Anda perlu menyesuaikan sistem Anda dan mempertimbangkan fitur-fitur implementasi Istio.  Akibatnya, Anda perlu menyelesaikan dua poin utama: menentukan protokol lapisan aplikasi (yang harus didukung oleh utusan utusan) dan menyiapkan penerusan informasi tentang konektivitas permintaan ke layanan dari permintaan dari layanan (menggunakan header, dalam kasus protokol HTTP).  Ketika masalah ini diselesaikan, kami mendapatkan alat yang ampuh yang memungkinkan Anda mengumpulkan informasi dari jaringan secara transparan, bahkan dalam sistem yang sangat heterogen yang ditulis dalam berbagai bahasa dan kerangka kerja. <br><br>  Pada artikel selanjutnya tentang Service Mesh, kami akan mempertimbangkan salah satu masalah terbesar Istio - konsumsi memori yang besar dari setiap wadah proxy sespan dan membahas bagaimana cara menanganinya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id433650/">https://habr.com/ru/post/id433650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id433638/index.html">Dekomposisi proyek untuk frontend</a></li>
<li><a href="../id433642/index.html">Tidak suka sistem CRM? Anda tidak tahu cara memasaknya</a></li>
<li><a href="../id433644/index.html">“Pemrograman Langsung”: Bagaimana semifinal Regional ICPC di Universitas ITMO</a></li>
<li><a href="../id433646/index.html">Staffcop: tampilan samping</a></li>
<li><a href="../id433648/index.html">Keuntungan pertama dalam sejarah layanan streaming Barat: mengapa ini bukan kabar baik</a></li>
<li><a href="../id433652/index.html">5G melalui mata pengguna. Harapan dan Kekhawatiran</a></li>
<li><a href="../id433658/index.html">TI di Jerman - cara mencari pekerjaan di kota-kota besar di Jerman</a></li>
<li><a href="../id433660/index.html">Bagaimana saya berbicara di DefCamp untuk kelima kalinya</a></li>
<li><a href="../id433664/index.html">SATA SSD Enterprise di Infortrend 2-Controller Storage - Pengukuran Kinerja</a></li>
<li><a href="../id433666/index.html">Kamus Funcorp</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>