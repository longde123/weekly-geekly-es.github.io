<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêû üéÖ üõ£Ô∏è Manipula√ß√£o em tempo real de malhas na unidade üë®üèø üè∞ üßê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uma das vantagens do Unity como plataforma para o desenvolvimento de jogos √© seu poderoso mecanismo 3D. Neste tutorial, voc√™ aprender√° sobre o mundo d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Manipula√ß√£o em tempo real de malhas na unidade</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428796/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce5/532/c83/ce5532c83ff152100775d62091370bf2.gif" alt="imagem"></div><br>  Uma das vantagens do Unity como plataforma para o desenvolvimento de jogos √© seu poderoso mecanismo 3D.  Neste tutorial, voc√™ aprender√° sobre o mundo dos objetos 3D e manipula√ß√£o de malhas. <br><br>  Devido ao crescimento das tecnologias de realidade virtual e aumentada (VR / AR), a maioria dos desenvolvedores enfrenta conceitos complexos de gr√°ficos 3D.  Deixe este tutorial ser o ponto de partida para eles.  N√£o se preocupe, n√£o haver√° matem√°tica 3D complicada - apenas cora√ß√µes, desenhos, setas e muitas coisas interessantes! <br><a name="habracut"></a><br><blockquote>  <em>Nota:</em> este tutorial √© destinado a usu√°rios familiarizados com o Unity IDE e com alguma experi√™ncia em programa√ß√£o em C #.  Se voc√™ n√£o tiver esse conhecimento, primeiro estude os tutoriais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">Introdu√ß√£o √† interface do usu√°rio do Unity</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">Introdu√ß√£o ao script do Unity</a> . <br><br>  Voc√™ precisar√° de uma vers√£o do Unity n√£o inferior a 2017.3.1.  A vers√£o mais recente do Unity pode ser baixada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">aqui</a> .  Este tutorial usa um editor personalizado e voc√™ pode aprender mais sobre eles no tutorial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">Estendendo o Unity Editor</a> . </blockquote><br><h2>  Come√ßando a trabalhar </h2><br>  Para come√ßar, familiarize-se com os termos b√°sicos dos gr√°ficos 3D, que permitir√£o entender melhor o tutorial. <br><br>  Termos t√©cnicos b√°sicos dos gr√°ficos 3D: <br><br><ul><li>  <em>V√©rtices</em> : Cada v√©rtice √© um ponto no espa√ßo 3D. </li><li>  <em>Malha</em> : cont√©m todos os v√©rtices, arestas, tri√¢ngulos, normais e dados UV do modelo. </li><li>  <em>Filtro de malha</em> : armazena dados de malha de modelo. </li><li>  <em>Renderizador de malha</em> : renderiza os dados de malha na cena. </li><li>  <em>Normais</em> : o vetor de um v√©rtice ou superf√≠cie.  √â direcionado para o exterior, perpendicular √† superf√≠cie da malha. </li><li>  <em>Linhas / arestas</em> : linhas invis√≠veis conectando v√©rtices entre si. </li><li>  <em>Tri√¢ngulos</em> : formados pela conex√£o de tr√™s picos. </li><li>  <em>Mapa UV</em> : anexa material a um objeto, criando uma textura e cor para ele. </li></ul><br>  A anatomia de um objeto 3D come√ßa com sua malha.  A cria√ß√£o dessa malha come√ßa no topo.  Linhas invis√≠veis que conectam esses v√©rtices formam tri√¢ngulos que definem a forma b√°sica do objeto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/83a/4c2/5a783a4c2ed2c144ccd0d7eb97369370.gif"></div><br>  Os dados normais e UV definem o sombreamento, a cor e a textura.  Os dados de malha s√£o armazenados em um filtro de malha e o renderizador de malha usa esses dados para desenhar um objeto na cena. <br><br>  Ou seja, o pseudoc√≥digo para criar um modelo 3D se parece com o seguinte: <br><br><ul><li>  Crie uma nova malha chamada "myMesh". </li><li>  Adicione dados √†s propriedades dos v√©rtices e tri√¢ngulos myMesh. </li><li>  Crie um novo filtro de malha chamado "myMeshFilter". </li><li>  Defina a propriedade de malha myMeshFilter como myMesh. </li></ul><br>  Depois de dominar o b√°sico, fa√ßa o download do <a href="">projeto</a> , descompacte os arquivos e execute a pe√ßa de trabalho do projeto no Unity.  Veja a estrutura da pasta na janela <em>Projeto</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/690/2d6/c2e/6902d6c2e14a98284c8af39055242bc7.png"></div><br>  Descri√ß√£o das pastas: <br><br><ul><li>  <em>Pr√©</em> - <em>fabricados</em> : cont√©m o pr√©-fabricado Sphere que ser√° usado para salvar a malha 3D durante a execu√ß√£o do aplicativo. </li><li>  <em>Cenas</em> : cont√©m as tr√™s cenas que usamos neste tutorial. </li><li>  <em>Editor</em> : os scripts dentro desta pasta nos fornecem os super recursos do editor que usamos no desenvolvimento. </li><li>  <em>Scripts</em> : aqui est√£o os scripts de tempo de execu√ß√£o anexados ao GameObject e executados quando voc√™ clica em <em>Play</em> . </li><li>  <em>Materiais</em> : esta pasta cont√©m o material para a malha. </li></ul><br>  Na pr√≥xima se√ß√£o, criaremos um editor personalizado para visualizar a cria√ß√£o de uma malha 3D. <br><br><h2>  Alterar malhas com o Editor personalizado </h2><br>  Abra a <em>01 Demonstra√ß√£o do Estudo de Malha,</em> localizada na pasta <em>Cenas</em> .  Na janela <em>Cena</em> , voc√™ ver√° um cubo 3D: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d5/ed2/812/6d5ed28123a0c65bb083c67efab702c7.gif"></div><br>  Antes de entrarmos na malha, vamos dar uma olhada no script do editor personalizado. <br><br><h3>  Editando um Script do Editor </h3><br>  Selecione a pasta <em>Editor</em> na janela <em>Projeto</em> .  Os scripts nesta pasta adicionam funcionalidade ao editor (Editor) durante o desenvolvimento e n√£o est√£o dispon√≠veis no modo Compilar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/442/653/b41/442653b41ca755b67d3a1ce42ae1ec5a.png"></div><br>  Abra o <em>MeshInspector.cs</em> e visualize o c√≥digo fonte.  Todos os scripts do Editor devem implementar a classe <code>Editor</code> , seu atributo <code>CustomEditor</code> informa √† classe <code>Editor</code> que tipo de objeto ele √©.  <code>OnSceneGUI()</code> √© um m√©todo de evento que permite a renderiza√ß√£o na janela Scene;  <code>OnInspectorGUI()</code> permite adicionar elementos adicionais da GUI ao Inspector. <br><br>  No <em>MeshInspector.cs,</em> antes de iniciar a classe <code>MeshInspector</code> adicione o seguinte: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">CustomEditor(typeof(MeshStudy))</span></span>]</code> </pre> <br>  Explica√ß√£o do c√≥digo: O atributo <code>CustomEditor</code> diz ao Unity que tipo de objeto a classe do editor personalizado pode modificar. <br><br>  Em <code>OnSceneGUI()</code> antes de <code>EditMesh()</code> adicione o seguinte: <br><br><pre> <code class="cs hljs">mesh = target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MeshStudy; Debug.Log(<span class="hljs-string"><span class="hljs-string">"Custom editor is running"</span></span>);</code> </pre> <br>  Explica√ß√£o do c√≥digo: A classe <code>Editor</code> possui uma vari√°vel de <code>target</code> padr√£o.  Aqui, o <code>target</code> √© uma convers√£o para o <code>MeshStudy</code> .  Agora, o editor personalizado desenhar√° todos os GameObjects na janela Scene e o <em>MeshStudy.cs</em> anexado a eles.  Adicionar mensagens de depura√ß√£o permite verificar no console que o editor personalizado est√° realmente em execu√ß√£o. <br><br>  Salve o arquivo e retorne ao Unity.  V√° para a pasta <em>Scripts</em> e arraste o <em>MeshStudy.cs</em> para o <em>cubo</em> <em>GameObject</em> na <em>hierarquia</em> para anex√°-lo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa6/b8a/ee4/aa6b8aee48eacb8421eff3c4e1ef4be3.png"></div><br>  Agora a mensagem "O editor personalizado est√° em execu√ß√£o" deve ser exibida no console, e isso significa que fizemos tudo certo!  Voc√™ pode excluir a mensagem de depura√ß√£o para que ela n√£o nos incomode no console. <br><br><h3>  Clonagem e descarte da malha </h3><br>  Ao trabalhar com uma malha 3D no modo Editar usando o editor personalizado, tome cuidado para n√£o substituir a malha padr√£o do Unity.  Se isso acontecer, voc√™ ter√° que reiniciar o Unity. <br><br>  Para clonar com seguran√ßa a malha sem substituir o formul√°rio original, crie uma c√≥pia da malha na propriedade <code>MeshFilter.sharedmesh</code> e atribua-a ao filtro de malha novamente. <br><br>  Para fazer isso, clique duas vezes em <em>MeshStudy.cs</em> na pasta <em>Scripts</em> para abrir o arquivo no editor de c√≥digo.  Esse script √© <code>MonoBehaviour</code> classe <code>MonoBehaviour</code> e sua fun√ß√£o <code>Start()</code> n√£o √© executada no modo de edi√ß√£o. <br><br>  No <em>MeshStudy.cs,</em> antes de iniciar a classe <code>MeshStudy</code> adicione o seguinte: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ExecuteInEditMode</span></span>]</code> </pre> <br>  Explica√ß√£o do c√≥digo: ap√≥s adicionar este atributo, a fun√ß√£o <code>Start()</code> ser√° executada no modo Play e no modo Edit.  Agora, podemos instanciar o objeto de malha e clon√°-lo. <br><br>  No <code>InitMesh()</code> adicione o seguinte c√≥digo: <br><br><pre> <code class="cs hljs">oMeshFilter = GetComponent&lt;MeshFilter&gt;(); oMesh = oMeshFilter.sharedMesh; <span class="hljs-comment"><span class="hljs-comment">//1 cMesh = new Mesh(); //2 cMesh.name = "clone"; cMesh.vertices = oMesh.vertices; cMesh.triangles = oMesh.triangles; cMesh.normals = oMesh.normals; cMesh.uv = oMesh.uv; oMeshFilter.mesh = cMesh; //3 vertices = cMesh.vertices; //4 triangles = cMesh.triangles; isCloned = true; Debug.Log("Init &amp; Cloned");</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  Obt√©m a malha <code>oMesh</code> original do componente <code>MeshFilter</code> . </li><li>  Copia o <code>cMesh</code> para uma nova <code>cMesh</code> malha. </li><li>  Atribui o filtro de malha de malha copiado novamente. </li><li>  Atualiza vari√°veis ‚Äã‚Äãlocais. </li></ol><br>  Salve o arquivo e retorne ao Unity.  A mensagem "Init &amp; Cloned" deve ser exibida no console de depura√ß√£o.  Selecione o <code>Cube</code> GameObject na <em>hierarquia</em> e verifique suas propriedades no <em>inspetor</em> .  <em>O filtro de malha</em> deve exibir um ativo de malha chamado <em>clone</em> .  √ìtimo!  Isso significa que clonamos a malha com sucesso. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6c/2da/3e0/c6c2da3e0e29703888bad5e50bb608a6.png"></div><br>  Na pasta Editor, navegue para <em>MeshInspector.cs</em> .  No <code>OnInspectorGUI()</code> , ap√≥s a segunda linha de c√≥digo, adicione o seguinte: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUILayout.Button(<span class="hljs-string"><span class="hljs-string">"Reset"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//1 { mesh.Reset(); //2 }</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  Este c√≥digo chama um bot√£o Redefinir no <em>Inspetor</em> . </li><li>  Quando pressionado, ele chama a fun√ß√£o <code>Reset()</code> no <em>MeshStudy.cs</em> . </li></ol><br>  Salve o arquivo, abra o <em>MeshStudy.cs</em> e adicione o seguinte c√≥digo √† fun√ß√£o <code>Reset()</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cMesh != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; oMesh != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-comment"><span class="hljs-comment">//1 { cMesh.vertices = oMesh.vertices; //2 cMesh.triangles = oMesh.triangles; cMesh.normals = oMesh.normals; cMesh.uv = oMesh.uv; oMeshFilter.mesh = cMesh; //3 vertices = cMesh.vertices; //4 triangles = cMesh.triangles; }</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  Verificando a exist√™ncia da fonte e da malha clonada. </li><li>  Redefina o <code>cMesh</code> para a malha original. </li><li>  Atribui√ß√£o para <code>cMesh</code> <code>oMeshFilter</code> . </li><li>  Atualizando vari√°veis ‚Äã‚Äãlocais. </li></ol><br>  Salve o arquivo e retorne ao Unity.  No <em>Inspetor,</em> clique no bot√£o <em>Editar teste</em> para distorcer a malha do cubo.  Em seguida, clique no bot√£o <em>Redefinir</em> ;  o cubo deve retornar √† sua forma original. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c3/a8a/e22/0c3a8ae22c8f8382dd46ee652b4b6eea.gif"></div><br><h3>  Explica√ß√£o de v√©rtices e tri√¢ngulos no Unity </h3><br>  Uma malha consiste em v√©rtices conectados por arestas em tri√¢ngulos.  Tri√¢ngulos definem a forma b√°sica do objeto. <br><br><blockquote>  <em>Classe de malha:</em> <br><br><ul><li>  Os v√©rtices s√£o armazenados como uma matriz de valores <code>Vector3</code> . </li><li>  Os tri√¢ngulos s√£o armazenados como uma matriz inteira correspondente aos √≠ndices da matriz de v√©rtices. </li></ul><br>  Ou seja, em uma malha Quad simples, composta por quatro v√©rtices e dois tri√¢ngulos, os dados da malha ter√£o a seguinte apar√™ncia: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56c/56d/794/56c56d794628ff20592f801340308790.gif"></div></blockquote><br><h3>  Mapeamento de v√©rtices </h3><br>  Aqui queremos exibir os v√©rtices do cubo como pontos azuis. <br><br>  No <em>MeshInspector.cs</em> , <em>iremos</em> para a fun√ß√£o <code>EditMesh()</code> e adicionaremos o seguinte: <br><br><pre> <code class="cs hljs">handleTransform = mesh.transform; <span class="hljs-comment"><span class="hljs-comment">//1 handleRotation = Tools.pivotRotation == PivotRotation.Local ? handleTransform.rotation : Quaternion.identity; //2 for (int i = 0; i &lt; mesh.vertices.Length; i++) //3 { ShowPoint(i); }</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  <code>handleTransform</code> obt√©m valores de transforma√ß√£o da <code>mesh</code> . </li><li>  <code>handleRotation</code> obt√©m o modo Rota√ß√£o da junta atual. </li><li>  Atravesse os v√©rtices da malha e desenhe os pontos usando <code>ShowPoint()</code> . </li></ol><br>  Na fun√ß√£o <code>ShowPoint()</code> , imediatamente ap√≥s o <code>//draw dot</code> coment√°rio do <code>//draw dot</code> , adicione o seguinte: <br><br><pre> <code class="cs hljs">Vector3 point = handleTransform.TransformPoint(mesh.vertices[index]);</code> </pre> <br>  C√≥digo Explica√ß√£o: Esta linha converte a posi√ß√£o local do v√©rtice em uma coordenada no espa√ßo do mundo. <br><br>  Na mesma fun√ß√£o, no bloco <code>if</code> , imediatamente ap√≥s a linha de c√≥digo adicionada, adicione o seguinte: <br><br><pre> <code class="cs hljs">Handles.color = Color.blue; point = Handles.FreeMoveHandle(point, handleRotation, mesh.handleSize, Vector3.zero, Handles.DotHandleCap);</code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  Define a cor, tamanho e posi√ß√£o de um ponto usando a classe auxiliar <code>Handles</code> . </li><li>  <code>Handles.FreeMoveHandle()</code> cria um manipulador de movimento ilimitado que simplifica a opera√ß√£o de arrastar e soltar, o que √© √∫til para n√≥s na pr√≥xima se√ß√£o. </li></ol><br>  Salve o arquivo e retorne ao Unity.  Verifique a propriedade do cubo no <em>Inspetor</em> e verifique se a op√ß√£o <em>Mover ponto de v√©rtice</em> est√° ativada.  Agora voc√™ deve ver que a malha na tela est√° marcada com v√°rios pontos azuis.  Aqui est√£o eles - os topos da malha do cubo!  Tente fazer isso com outros objetos 3D e observe os resultados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d78/3aa/205/d783aa2054dd9ca81ee7a6c948c7c00a.gif"></div><br><h3>  Mover um √∫nico v√©rtice </h3><br>  Vamos come√ßar com o passo mais simples de manipular a malha - movendo um √∫nico v√©rtice. <br><br>  V√° para <em>MeshInspector.cs</em> .  Dentro da fun√ß√£o <code>ShowPoint()</code> , imediatamente ap√≥s o <code>//drag</code> coment√°rio e imediatamente antes dos colchetes de fechamento do bloco <code>if</code> , adicione o seguinte: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUI.changed) <span class="hljs-comment"><span class="hljs-comment">//1 { mesh.DoAction(index, handleTransform.InverseTransformPoint(point)); //2 }</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  <code>GUI.changed</code> controla todas as altera√ß√µes que ocorrem com pontos e funciona bem em conjunto com <code>Handles.FreeMoveHandle()</code> para reconhecer uma opera√ß√£o de arrastar e soltar. </li><li>  Para o v√©rtice arrast√°vel, a fun√ß√£o <code>mesh.DoAction()</code> recebe seu √≠ndice e valores de transforma√ß√£o como par√¢metros.  Como os valores Transform do v√©rtice est√£o no espa√ßo mundial, os convertemos em espa√ßo local usando <code>InverseTransformPoint()</code> . </li></ol><br>  Salve o arquivo de script e v√° para <em>MeshStudy.cs</em> .  Em <code>DoAction()</code> , ap√≥s os colchetes de abertura, adicione o seguinte: <br><br><pre> <code class="cs hljs">PullOneVertex(index, localPos);</code> </pre> <br>  Em seguida, adicione o seguinte √† fun√ß√£o <code>PullOneVertex()</code> : <br><br><pre> <code class="cs hljs">vertices[index] = newPos; <span class="hljs-comment"><span class="hljs-comment">//1 cMesh.vertices = vertices; //2 cMesh.RecalculateNormals(); //3</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  Atualizamos o v√©rtice de destino com o valor <code>newPos</code> . </li><li>  <code>cMesh.vertices</code> valores atualizados de v√©rtice de volta a <code>cMesh.vertices</code> . </li><li>  Em <code>RecalculateNormals()</code> recalculamos e redesenhamos a malha para que ela corresponda √†s altera√ß√µes. </li></ol><br>  Salve o arquivo e retorne ao Unity.  Tente arrastar pontos no cubo;  voc√™ viu uma malha quebrada? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fca/ccf/c86/fcaccfc865e30b3c922e6cabcf9f79d7.gif"></div><br>  Parece que alguns dos v√©rtices t√™m a mesma posi√ß√£o; portanto, quando arrastamos apenas um, os v√©rtices restantes permanecem atr√°s dele e a malha quebra.  Na pr√≥xima se√ß√£o, corrigiremos esse problema. <br><br><h3>  Localizando todos os v√©rtices semelhantes </h3><br>  Visualmente, uma malha de cubo consiste em oito v√©rtices, seis lados e 12 tri√¢ngulos.  Vamos verificar se √© assim. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/253/a30/b3f/253a30b3fcca7b0d9028d92b4c4149c2.gif"></div><br>  Abra o <em>MeshStudy.cs</em> , d√™ uma olhada na frente da fun√ß√£o <code>Start()</code> e encontre a vari√°vel de <code>vertices</code> .  Veremos o seguinte: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HideInInspector</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3[] vertices;</code> </pre> <br>  Explica√ß√£o do c√≥digo: <code>[HideInInspector]</code> oculta uma vari√°vel compartilhada da janela <em>Inspetor</em> . <br><br>  Comente este atributo: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//[HideInInspector] public Vector3[] vertices;</span></span></code> </pre> <br><blockquote>  <em>Nota:</em> ocultar valores de v√©rtices ajuda o <code>[HideInInspector]</code> com malhas 3D mais complexas.  Como o tamanho da matriz de v√©rtices pode atingir milhares de elementos, isso pode levar √† inibi√ß√£o do Unity ao tentar visualizar o valor da matriz no Inspector. </blockquote><br>  Salve o arquivo e retorne ao Unity.  V√° para o <em>Inspetor</em> .  Agora, no componente de script <em>Estudo de malha</em> , a propriedade <em>v√©rtices</em> apareceu.  Clique no √≠cone de seta ao lado;  para <code>Vector3</code> matriz de elementos <code>Vector3</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/feb/f83/fd0/febf83fd02d469734b73910b1769d670.gif"></div><br>  Voc√™ pode ver que o tamanho da matriz √© 24, ou seja, existem v√©rtices com a mesma posi√ß√£o!  Antes de continuar, certifique-se de descomentar <code>[HideInInspector]</code> . <br><br><div class="spoiler">  <b class="spoiler_title">Por que existem 24 v√©rtices?</b> <div class="spoiler_text">  Existem muitas teorias sobre esse assunto.  Mas a resposta mais simples √©: o cubo tem seis lados e cada lado √© composto por quatro v√©rtices que formam um plano. <br><br>  Portanto, o c√°lculo √© o seguinte: 6 x 4 = 24 v√©rtices. <br><br>  Voc√™ pode procurar outras respostas.  Mas, por enquanto, √© simples o suficiente saber que algumas malhas ter√£o v√©rtices que t√™m a mesma posi√ß√£o. </div></div><br>  No <em>MeshStudy.cs,</em> substitua <em>todo o</em> c√≥digo dentro da fun√ß√£o <code>DoAction()</code> pelo seguinte: <br><br><pre> <code class="cs hljs">PullSimilarVertices(index, localPos);</code> </pre> <br>  Vamos para a fun√ß√£o <code>PullSimilarVertices()</code> e adicionar o seguinte: <br><br><pre> <code class="cs hljs">Vector3 targetVertexPos = vertices[index]; <span class="hljs-comment"><span class="hljs-comment">//1 List&lt;int&gt; relatedVertices = FindRelatedVertices(targetVertexPos, false); //2 foreach (int i in relatedVertices) //3 { vertices[i] = newPos; } cMesh.vertices = vertices; //4 cMesh.RecalculateNormals();</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  obtemos a posi√ß√£o do v√©rtice de destino, que ser√° usado como argumento para o m√©todo <code>FindRelatedVertices()</code> . </li><li>  Este m√©todo retorna uma lista de √≠ndices (correspondentes aos v√©rtices) que t√™m a mesma posi√ß√£o que o v√©rtice de destino. </li><li>  O loop percorre a lista inteira e define os v√©rtices correspondentes como <code>newPos</code> . </li><li>  <code>cMesh.vertices</code> <code>vertices</code> atualizados de volta a <code>cMesh.vertices</code> .  Em seguida, chamamos <code>RecalculateNormals()</code> para redesenhar a malha com os novos valores. </li></ol><br>  Salve o arquivo e retorne ao Unity.  Arraste qualquer um dos v√©rtices;  agora a malha deve manter sua forma e n√£o entrar em colapso. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1b/66d/bcc/b1b66dbccb73ac3a8ad8c56594611919.gif"></div><br>  Agora que completamos o primeiro passo na manipula√ß√£o das malhas, salve a cena e passe para a pr√≥xima se√ß√£o. <br><br><h2>  Manipula√ß√£o de malha </h2><br>  Nesta se√ß√£o, voc√™ aprender√° sobre a manipula√ß√£o de malhas em tempo real.  Existem v√°rias maneiras, mas neste tutorial, examinaremos o tipo mais simples de manipula√ß√£o de malha, ou seja, mover os v√©rtices de malha criados anteriormente. <br><br><h3>  Coletando √≠ndices selecionados </h3><br>  Vamos come√ßar selecionando os v√©rtices que iremos mover em tempo real. <br><br>  Cena aberta <em>02 Crie malha de cora√ß√£o</em> na pasta <em>Cenas</em> .  Na janela Cena, voc√™ ver√° uma esfera vermelha.  Selecione <em>Esfera</em> na <em>hierarquia</em> e v√° para o <em>Inspetor</em> .  Voc√™ ver√° que o componente de script <em>Heart Mesh</em> est√° anexado ao objeto. <br><br>  Agora precisamos do script Editor para esse objeto para exibir os v√©rtices da malha na janela Cena.  V√° para a pasta <em>Editor</em> e clique duas vezes em <em>HeartMeshInspector.cs</em> . <br><br>  Na fun√ß√£o <code>ShowHandle()</code> , dentro do bloco <code>if</code> , adicione o seguinte: <br><br><pre> <code class="cs hljs">Handles.color = Color.blue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Handles.Button(point, handleRotation, mesh.pickSize, mesh.pickSize, Handles.DotHandleCap)) <span class="hljs-comment"><span class="hljs-comment">//1 { mesh.selectedIndices.Add(index); //2 }</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  Define e exibe os v√©rtices da malha como um tipo <code>Handles.Button</code> . </li><li>  Quando clicado, ele adiciona o √≠ndice selecionado √† lista pressionada, <code>mesh.selectedIndices</code> . </li></ol><br>  No <code>OnInspectorGUI()</code> , antes do colchete de fechamento, adicione o seguinte: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GUILayout.Button(<span class="hljs-string"><span class="hljs-string">"Clear Selected Vertices"</span></span>)) { mesh.ClearAllData(); }</code> </pre> <br>  Explica√ß√£o do c√≥digo: √© assim que adicionamos um bot√£o Redefinir ao <em>Inspetor</em> para chamar <code>mesh.ClearAllData()</code> . <br><br>  Salve o arquivo e abra <em>HeartMesh.cs</em> na pasta <em>Scripts</em> .  Na fun√ß√£o <code>ClearAllData()</code> , adicione o seguinte: <br><br><pre> <code class="cs hljs">selectedIndices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); targetIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; targetVertex = Vector3.zero;</code> </pre> <br>  C√≥digo Explica√ß√£o: O c√≥digo limpa os valores em <code>selectedIndices</code> e <code>targetIndex</code> .  Ele tamb√©m redefine o <code>targetVertex</code> . <br><br>  Salve o arquivo e retorne ao Unity.  Selecione <em>Sphere</em> e v√° para o <em>Inspector</em> para o <em>componente de</em> script <em>HeartMesh</em> .  Expanda <em>√çndices Selecionados</em> clicando no √≠cone de seta ao lado.  Isso nos permitir√° rastrear cada v√©rtice adicionado √† lista. <br><br>  Ative o <em>Modo de edi√ß√£o</em> usando a caixa de sele√ß√£o ao lado.  Devido a isso, os v√©rtices da malha ser√£o desenhados na janela Cena.  Clicar nos pontos azuis nos <em>√≠ndices selecionados</em> deve alterar os valores de acordo.  Teste tamb√©m o bot√£o <em>Limpar v√©rtices</em> selecionados para garantir que ele apague todos os valores. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17a/271/dea/17a271dea970e9c3ade451773b87eb65.gif"></div><br>  <em>Nota:</em> no <em>Inspetor</em> personalizado modificado, temos a op√ß√£o de mostrar / ocultar o manipulador de transforma√ß√£o usando <em>Mostrar identificador de transforma√ß√£o</em> .  Portanto, n√£o entre em p√¢nico se voc√™ n√£o encontrar o manipulador Transform em outras cenas!  Ligue-o antes de sair. <br><br><h3>  Transformando uma esfera em um cora√ß√£o </h3><br>  A altera√ß√£o dos v√©rtices da malha em tempo real consiste essencialmente em tr√™s etapas: <br><br><ol><li>  Copie os v√©rtices de malha atuais (antes da anima√ß√£o) para <code>mVertices</code> . </li><li>  <code>mVertices</code> c√°lculos e <code>mVertices</code> os valores em <code>mVertices</code> . </li><li>  Atualize os v√©rtices de malha atuais com o <code>mVertices</code> ao mudar a cada etapa e deixe o Unity calcular automaticamente os normais. </li></ol><br>  Abra <em>HeartMesh.cs</em> e as seguintes vari√°veis ‚Äã‚Äãantes da fun√ß√£o <code>Start()</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> radiusofeffect = <span class="hljs-number"><span class="hljs-number">0.3f</span></span>; <span class="hljs-comment"><span class="hljs-comment">//1 public float pullvalue = 0.3f; //2 public float duration = 1.2f; //3 int currentIndex = 0; //4 bool isAnimate = false; float starttime = 0f; float runtime = 0f;</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  O raio da √°rea afetada pelo v√©rtice de destino. </li><li>  Arraste a for√ßa. </li><li>  A dura√ß√£o da anima√ß√£o. </li><li>  O √≠ndice atual da lista <code>selectedIndices</code> . </li></ol><br>  Na fun√ß√£o <code>Init()</code> , antes do bloco <code>if</code> , adicione o seguinte: <br><br><pre> <code class="cs hljs">currentIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br>  Explica√ß√£o do c√≥digo: no in√≠cio do jogo, <code>currentIndex</code> como 0, o primeiro √≠ndice da lista <code>selectedIndices</code> . <br><br>  Na mesma fun√ß√£o <code>Init()</code> , antes do colchete de fechamento do bloco <code>else</code> , adicione o seguinte: <br><br><pre> <code class="cs hljs">StartDisplacement();</code> </pre> <br>  Explica√ß√£o do c√≥digo: execute a fun√ß√£o <code>StartDisplacement()</code> se <code>isEditMode</code> for false. <br><br>  Dentro da fun√ß√£o <code>StartDisplacement()</code> , adicione o seguinte: <br><br><pre> <code class="cs hljs">targetVertex = oVertices[selectedIndices[currentIndex]]; <span class="hljs-comment"><span class="hljs-comment">//1 starttime = Time.time; //2 isAnimate = true;</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  Selecione <code>targetVertex</code> para iniciar a anima√ß√£o. </li><li>  Defina a hora de in√≠cio e altere o valor de <code>isAnimate</code> para true. </li></ol><br>  Ap√≥s a fun√ß√£o <code>StartDisplacement()</code> , crie a fun√ß√£o <code>FixedUpdate()</code> com o seguinte c√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//1 { if (!isAnimate) //2 { return; } runtime = Time.time - starttime; //3 if (runtime &lt; duration) //4 { Vector3 targetVertexPos = oFilter.transform.InverseTransformPoint(targetVertex); DisplaceVertices(targetVertexPos, pullvalue, radiusofeffect); } else //5 { currentIndex++; if (currentIndex &lt; selectedIndices.Count) //6 { StartDisplacement(); } else //7 { oMesh = GetComponent&lt;MeshFilter&gt;().mesh; isAnimate = false; isMeshReady = true; } } }</span></span></span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  A fun√ß√£o <code>FixedUpdate()</code> √© executada em um loop FPS fixo. </li><li>  Se <code>isAnimate</code> for falso, pule o c√≥digo a seguir. </li><li>  Alterar anima√ß√µes de <code>runtime</code> . </li><li>  Se o <code>runtime</code> estiver dentro da <code>duration</code> , obteremos as coordenadas mundiais de <code>targetVertex</code> e <code>DisplaceVertices()</code> , cobrindo o v√©rtice de destino com os <code>radiusofeffect</code> e <code>radiusofeffect</code> . </li><li>  Caso contr√°rio, o tempo acabou.  Adicione um ao <code>currentIndex</code> . </li><li>  Verifique se <code>currentIndex</code> entre os <code>selectedIndices</code> .  V√° para o pr√≥ximo v√©rtice da lista usando <code>StartDisplacement()</code> . </li><li>  Caso contr√°rio, no final da lista, altere os dados <code>oMesh</code> para a malha atual e <code>isAnimate</code> como false para interromper a anima√ß√£o. </li></ol><br>  Em <code>DisplaceVertices()</code> adicione o seguinte: <br><br><pre> <code class="cs hljs">Vector3 currentVertexPos = Vector3.zero; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sqrRadius = radius * radius; <span class="hljs-comment"><span class="hljs-comment">//1 for (int i = 0; i &lt; mVertices.Length; i++) //2 { currentVertexPos = mVertices[i]; float sqrMagnitute = (currentVertexPos - targetVertexPos).sqrMagnitude; //3 if (sqrMagnitute &gt; sqrRadius) { continue; //4 } float distance = Mathf.Sqrt(sqrMagnitute); //5 float falloff = GaussFalloff(distance, radius); Vector3 translate = (currentVertexPos * force) * falloff; //6 translate.z = 0f; Quaternion rotation = Quaternion.Euler(translate); Matrix4x4 m = Matrix4x4.TRS(translate, rotation, Vector3.one); mVertices[i] = m.MultiplyPoint3x4(currentVertexPos); } oMesh.vertices = mVertices; //7 oMesh.RecalculateNormals();</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  O quadrado do raio. </li><li>  Passamos por cada v√©rtice da malha. </li><li>  <code>sqrMagnitude</code> entre <code>currentVertexPos</code> e <code>targetVertexPos</code> . </li><li>  Se <code>sqrMagnitude</code> exceder <code>sqrRadius</code> , v√° para o pr√≥ximo v√©rtice. </li><li>  Caso contr√°rio, continue definindo o valor de <code>falloff</code> , que depende da <code>distance</code> v√©rtice atual do ponto central do escopo. </li><li>  <code>Vector3</code> nova posi√ß√£o <code>Vector3</code> e aplique sua transforma√ß√£o ao v√©rtice atual. </li><li>  Quando voc√™ sai do loop, atribu√≠mos os valores alterados do <code>mVertices</code> aos <code>mVertices</code> do <code>mVertices</code> e for√ßamos o Unity a recalcular os valores normais. </li></ol><br><blockquote>  <em>Fonte de Tecnologia Falloff</em> <br>  A f√≥rmula original √© obtida no arquivo do pacote de recursos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">Exemplos de procedimentos</a> , que pode ser baixado gratuitamente no Unity Asset Store. </blockquote><br>  Salve o arquivo e retorne ao Unity.  Selecione <em>Esfera</em> , acesse o componente <em>HeartMesh</em> e tente adicionar alguns v√©rtices √† propriedade <em>√çndices Selecionados</em> .  Desative o <em>modo √â de edi√ß√£o</em> e clique em <em>Reproduzir</em> para ver o resultado do seu trabalho. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1e/527/23b/e1e52723b08453591da6d10a28dbe13d.gif"></div><br>  Experimente os valores <em>Radiusofeffect</em> , <em>Pullvalue</em> e <em>Duration</em> para obter resultados diferentes.  Quando estiver pronto, altere as configura√ß√µes de acordo com a captura de tela abaixo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a63/c44/082/a63c44082183529e737f287cb746dfd6.png"></div><br>  Clique em <em>Play</em> .  Sua esfera se transformou em um cora√ß√£o? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ce5/532/c83/ce5532c83ff152100775d62091370bf2.gif"></div><br>  Parab√©ns!  Na pr√≥xima se√ß√£o, salvaremos a malha como uma pr√©-fabricada para uso futuro. <br><br><h3>  Salvando a Malha em Tempo Real </h3><br>  Para salvar uma malha procedural em forma de cora√ß√£o no modo Reproduzir, voc√™ precisa preparar uma pr√©-fabricada cujo filho ser√° um objeto 3D e, em seguida, substituir seu ativo de malha por um novo usando um script. <br><br>  Na janela <em>Projeto,</em> localize <em>CustomHeart</em> na pasta <em>Prefabs</em> .  Clique no √≠cone de seta para expandir seu conte√∫do e selecione <em>Filho</em> .  Agora voc√™ v√™ um objeto Sphere na janela de visualiza√ß√£o do <em>Inspetor</em> .  Essa √© a pr√©-fabricada que armazenar√° os dados para a nova malha. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a3/f07/048/9a3f070486f3a66ee56304dae5bd2b12.png"></div><br>  Abra <em>HeartMeshInspector.cs</em> .  Dentro da fun√ß√£o <code>OnInspectorGUI()</code> , antes do colchete de fechamento, adicione o seguinte: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mesh.isEditMode &amp;&amp; mesh.isMeshReady) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">"Assets/Prefabs/CustomHeart.prefab"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//1 if (GUILayout.Button("Save Mesh")) { mesh.isMeshReady = false; Object pfObj = AssetDatabase.LoadAssetAtPath(path, typeof(GameObject)); //2 Object pfRef = AssetDatabase.LoadAssetAtPath (path, typeof(GameObject)); GameObject gameObj = (GameObject)PrefabUtility.InstantiatePrefab(pfObj); Mesh pfMesh = (Mesh)AssetDatabase.LoadAssetAtPath(path, typeof(Mesh)); //3 if (!pfMesh) { pfMesh = new Mesh(); } else { pfMesh.Clear(); } pfMesh = mesh.SaveMesh(); //4 AssetDatabase.AddObjectToAsset(pfMesh, path); gameObj.GetComponentInChildren&lt;MeshFilter&gt;().mesh = pfMesh; //5 PrefabUtility.ReplacePrefab(gameObj, pfRef, ReplacePrefabOptions.Default); //6 Object.DestroyImmediate(gameObj); //7 } }</span></span></code> </pre> <br>  C√≥digo Explica√ß√£o: <br><br><ol><li>  Define o <code>path</code> para o caminho do objeto <em>pr√©-fabricado</em> CustomHeart. </li><li>  Cria dois objetos da <em>prefab</em> CustomHeart, um para criar uma inst√¢ncia como <code>pfObj</code> ( <code>pfObj</code> ) e o segundo como links ( <code>pfRef</code> ). </li><li>  Cria <em>uma</em> inst√¢ncia do <code>pfMesh</code> malha <code>pfMesh</code> .  Se n√£o for encontrado, cria uma nova malha, caso contr√°rio, limpa os dados existentes. </li><li>  <code>pfMesh</code> com novos dados de malha e os adiciona como um ativo ao <em>CustomHeart</em> . <br></li><li>  Preenche um ativo de malha no <code>gameObj</code> valor <code>pfMesh</code> . </li><li>  Substitui <em>CustomHeart</em> por <code>gameObj</code> combinando conex√µes pr√©-existentes. </li><li>  Destr√≥i instantaneamente o <code>gameObj</code> . </li></ol><br>  Salve o arquivo e v√° para <em>HeartMesh.cs</em> .  No m√©todo geral <code>SaveMesh()</code> , ap√≥s criar a inst√¢ncia <code>nMesh</code> adicione o seguinte: <br><br><pre> <code class="cs hljs">nMesh.name = <span class="hljs-string"><span class="hljs-string">"HeartMesh"</span></span>; nMesh.vertices = oMesh.vertices; nMesh.triangles = oMesh.triangles; nMesh.normals = oMesh.normals;</code> </pre> <br>  C√≥digo Explica√ß√£o: Retorna um ativo de malha com valores de uma malha em forma de cora√ß√£o. <br><br>  Salve o arquivo e retorne ao Unity.  Clique em <em>Play</em> .  Ap√≥s a anima√ß√£o ser conclu√≠da, o bot√£o <em>Salvar malha</em> ser√° exibido no <em>Inspetor</em> .  Clique no bot√£o para salvar a nova malha e pare o player. <br><br>  V√° para a pasta <em>Prefabs</em> e consulte a <em>pr√©-fabricada</em> CustomHeart.  Voc√™ deve ver que agora no objeto <em>pr√©-fabricado</em> CustomHeart h√° uma malha em forma de cora√ß√£o completamente nova. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/126/dee/103/126dee103ce798611d2dc2e94013c23c.png"></div><br>  <i>Bom trabalho!</i> <br><br><h2>  Juntando tudo </h2><br>  Na cena anterior, a fun√ß√£o <code>DisplaceVertices()</code> usou a f√≥rmula de Falloff para determinar a for√ßa de arrasto aplicada a cada v√©rtice dentro de um determinado raio.  O ponto de "queda", no qual a for√ßa de arrasto come√ßa a diminuir, depende do tipo de Falloff usado: Linear, Gaussiano ou Agulha.  Cada tipo produz resultados diferentes na malha. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ff/284/9c0/9ff2849c0d0fe5f9d496d641c07e35d8.png"></div><br>  Nesta se√ß√£o, veremos outra maneira de manipular v√©rtices: usando uma determinada curva.  Tomando a regra de que a velocidade √© igual √† dist√¢ncia dividida pelo tempo (d = (v / t)), podemos determinar a posi√ß√£o do vetor, referindo-se √† sua dist√¢ncia dividida pelo tempo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b8/2d6/13c/3b82d613cedaf85e12db66beb6349201.gif"></div><br><h3>  Usando o m√©todo Curve </h3><br>  Salve a cena atual e abra <em>03 Customize Heart Mesh</em> na pasta <em>Scenes</em> .  Voc√™ ver√° uma inst√¢ncia de <em>Hierarquia</em> da <em>pr√©-fabricada</em> CustomHeart.  Clique no √≠cone de seta ao lado dele para expandir seu conte√∫do e selecione <em>Filho</em> . <br><br>  Veja suas propriedades no <em>Inspetor</em> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ ver√° o componente </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtro de malha</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o ativo de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malha</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><em><font style="vertical-align: inherit;">cora√ß√£o</font></em><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Anexe </font><font style="vertical-align: inherit;">um script de </font><em><font style="vertical-align: inherit;">cora√ß√£o personalizado</font></em><font style="vertical-align: inherit;"> ao </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filho</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como um componente </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Agora, o ativo deve mudar de </font><em><font style="vertical-align: inherit;">HeartMesh</font></em><font style="vertical-align: inherit;"> para </font><em><font style="vertical-align: inherit;">clonar</font></em><font style="vertical-align: inherit;"> .</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/954/27f/89d/95427f89d17410e26893a0ec27dff51d.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, abra </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CustomHeart.cs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na pasta </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scripts</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Antes da fun√ß√£o, </font></font><code>Start()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adicione o seguinte:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CurveType { Curve1, Curve2 } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CurveType curveType; Curve curve;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explica√ß√£o do c√≥digo: aqui √© criada uma enumera√ß√£o geral sob o nome </font></font><code>CurveType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ap√≥s a qual √© disponibilizada pelo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inspetor</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√° para </font></font><code>CurveType1()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e adicione o seguinte:</font></font><br><br><pre> <code class="cs hljs">Vector3[] curvepoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//1 curvepoints[0] = new Vector3(0, 1, 0); curvepoints[1] = new Vector3(0.5f, 0.5f, 0); curvepoints[2] = new Vector3(1, 0, 0); curve = new Curve(curvepoints[0], curvepoints[1], curvepoints[2], false); //2</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥digo Explica√ß√£o: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma curva simples consiste em tr√™s pontos. </font><font style="vertical-align: inherit;">Defina os pontos para a primeira curva.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geramos a primeira curva com a ajuda </font></font><code>Curve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e atribu√≠mos seus valores </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A curva desenhada pode ser exibida na visualiza√ß√£o se voc√™ especificar true como o √∫ltimo par√¢metro.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√° para </font></font><code>CurveType2()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e adicione o seguinte:</font></font><br><br><pre> <code class="cs hljs">Vector3[] curvepoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//1 curvepoints[0] = new Vector3(0, 0, 0); curvepoints[1] = new Vector3(0.5f, 1, 0); curvepoints[2] = new Vector3(1, 0, 0); curve = new Curve(curvepoints[0], curvepoints[1], curvepoints[2], false); //2</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥digo Explica√ß√£o: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Defina os pontos para a segunda curva. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geramos a segunda curva </font></font><code>Curve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e atribu√≠mos seus valores </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A curva desenhada pode ser exibida na visualiza√ß√£o se voc√™ especificar true como o √∫ltimo par√¢metro.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font><code>StartDisplacement()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, antes do colchete de fechamento, adicione o seguinte:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (curveType == CurveType.Curve1) { CurveType1(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (curveType == CurveType.Curve2) { CurveType2(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explica√ß√£o do c√≥digo: aqui verificamos a op√ß√£o selecionada pelo usu√°rio </font></font><code>curveType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a geramos de acordo </font></font><code>curve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font><code>DisplaceVertices()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dentro da instru√ß√£o de loop </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antes dos colchetes, adicione o seguinte:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> increment = curve.GetPoint(distance).y * force; <span class="hljs-comment"><span class="hljs-comment">//1 Vector3 translate = (vert * increment) * Time.deltaTime; //2 Quaternion rotation = Quaternion.Euler(translate); Matrix4x4 m = Matrix4x4.TRS(translate, rotation, Vector3.one); mVertices[i] = m.MultiplyPoint3x4(mVertices[i]);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥digo Explica√ß√£o: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s </font><font style="vertical-align: inherit;">obtemos a </font><font style="vertical-align: inherit;">posi√ß√£o da curva em uma dada </font></font><code>distance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e multiplicamos seu valor </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por </font></font><code>force</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para obter </font></font><code>increment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie um novo tipo de dados </font></font><code>Vector3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para armazenar a nova posi√ß√£o do v√©rtice atual e aplique sua transforma√ß√£o de acordo.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salve o arquivo e retorne ao Unity. </font><font style="vertical-align: inherit;">Verifique as propriedades do componente </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CustomHeart</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jogo de objetos </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crian√ßa</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voc√™ ver√° uma lista suspensa onde pode selecionar </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o Tipo de curva</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Na lista suspensa </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Editar tipo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">selecione </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar √≠ndices</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remover √≠ndices</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para atualizar a lista de v√©rtices e experimentar configura√ß√µes diferentes.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/792/1a7/3b6/7921a73b676b205bd33ec1db076cd4a6.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para ver resultados detalhados para diferentes tipos de curvas, insira os valores de acordo com a captura de tela: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e06/ab3/e5d/e06ab3e5d0bfc950be0c6dbc82d36f6e.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para a lista </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipo de curva</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">selecione </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Curva1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , verifique se </font><em><font style="vertical-align: inherit;">Nenhum est√°</font></em><font style="vertical-align: inherit;"> selecionado </font><font style="vertical-align: inherit;">para </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Editar tipo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e clique em </font><em><font style="vertical-align: inherit;">Reproduzir</font></em><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voc√™ deve ver a malha divergir no padr√£o. </font><font style="vertical-align: inherit;">Role o modelo para v√™-lo em vista lateral e compare os resultados para os dois tipos de curvas. </font><font style="vertical-align: inherit;">Aqui voc√™ v√™ como o </font><em><font style="vertical-align: inherit;">tipo de curva</font></em><font style="vertical-align: inherit;"> selecionado </font><font style="vertical-align: inherit;">afeta o deslocamento da malha.</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e1/f90/4d5/8e1f904d50987247014011ac32261134.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da0/e1a/df4/da0e1adf49f8503188f47826c4079cf1.png"></div><br>  Isso √© tudo!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode clicar em </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limpar v√©rtices selecionados</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para redefinir os </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√≠ndices selecionados</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e experimentar seus pr√≥prios padr√µes. </font><font style="vertical-align: inherit;">Mas n√£o esque√ßa que existem outros fatores que afetar√£o o resultado final da malha, a saber:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O valor do raio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A distribui√ß√£o de v√©rtices na √°rea. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A posi√ß√£o do padr√£o dos v√©rtices selecionados. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O m√©todo selecionado para o deslocamento. </font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para onde ir a seguir? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os arquivos do projeto finalizado est√£o no </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo do projeto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tutorial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o pare por a√≠! </font><font style="vertical-align: inherit;">Experimente as t√©cnicas mais sofisticadas usadas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tutorial </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Unity Procedural Maze Generation</font></a><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espero que voc√™ tenha gostado deste tutorial e tenha achado as informa√ß√µes √∫teis. </font><font style="vertical-align: inherit;">Um agradecimento especial eu expresso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jasper Flick</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catlike Codifica√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por suas excelentes tutoriais que me ajudaram a montar uma demo para o meu projeto.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/190/e37/362/190e3736241796c39eac74bbe3ddc86e.png"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt428796/">https://habr.com/ru/post/pt428796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt428786/index.html">Processador qu√¢ntico baseado em resson√¢ncia de rota√ß√£o e manipula√ß√µes com um sistema singlet-tripleto</a></li>
<li><a href="../pt428788/index.html">Sob o cap√¥ do Bitfury Clarke - como nosso novo chip de minera√ß√£o funciona</a></li>
<li><a href="../pt428790/index.html">Estamos escrevendo um chat de bot para o VKontakte em python usando longpoll. Parte Dois La√ßos duplos, exce√ß√µes e outras heresias</a></li>
<li><a href="../pt428792/index.html">Novo chip Apple T2 dificulta a audi√ß√£o atrav√©s do microfone embutido no laptop</a></li>
<li><a href="../pt428794/index.html">Vis√£o geral dos m√©todos b√°sicos de otimiza√ß√£o matem√°tica para problemas com restri√ß√µes</a></li>
<li><a href="../pt428798/index.html">Como sobreviver a um desenvolvedor independente. Parte 2</a></li>
<li><a href="../pt428800/index.html">Cozinhando CSS Perfeito</a></li>
<li><a href="../pt428806/index.html">An√°lise de cheques do consumidor: o que eles compram na Amazon</a></li>
<li><a href="../pt428808/index.html">Pouca conveni√™ncia na vida estudantil</a></li>
<li><a href="../pt428810/index.html">18 materiais sobre tecnologia digital em √°udio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>