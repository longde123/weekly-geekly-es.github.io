<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¨ ğŸ¦ ğŸ“¬ Apache Hadoopä»£ç è´¨é‡ï¼šç”Ÿäº§VSæµ‹è¯• ğŸ•§ ğŸ‘©ğŸ¿â€ğŸ³ ğŸ’‡ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸ºäº†è·å¾—é«˜è´¨é‡çš„ç”Ÿäº§ä»£ç ï¼Œä»…ç¡®ä¿æœ€å¤§çš„æµ‹è¯•è¦†ç›–èŒƒå›´è¿˜ä¸å¤Ÿã€‚ æ¯«æ— ç–‘é—®ï¼Œå‡ºè‰²çš„ç»“æœéœ€è¦ä¸»è¦çš„é¡¹ç›®ä»£ç å’Œæµ‹è¯•æœ‰æ•ˆåœ°ååŒå·¥ä½œã€‚ å› æ­¤ï¼Œæµ‹è¯•å¿…é¡»ä¸ä¸»è¦ä»£ç ä¸€æ ·å—åˆ°é‡è§†ã€‚ ä½“é¢çš„æµ‹è¯•æ˜¯æˆåŠŸçš„å…³é”®å› ç´ ï¼Œå› ä¸ºå®ƒå°†èµ¶ä¸Šç”Ÿäº§çš„è¡°é€€ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹PVS-Studioé™æ€åˆ†æå™¨è­¦å‘Šï¼Œä»¥æŸ¥çœ‹æµ‹è¯•é”™è¯¯ä¸ä¼šæ¯”ç”Ÿäº§é”™è¯¯ä¸¥é‡è¿™ä¸€...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apache Hadoopä»£ç è´¨é‡ï¼šç”Ÿäº§VSæµ‹è¯•</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/480918/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c48/f76/cf1/c48f76cf15c8138ce1d944918b1dcc07.png" alt="å›¾1"></div><br> ä¸ºäº†è·å¾—é«˜è´¨é‡çš„ç”Ÿäº§ä»£ç ï¼Œä»…ç¡®ä¿æœ€å¤§çš„æµ‹è¯•è¦†ç›–èŒƒå›´è¿˜ä¸å¤Ÿã€‚ æ¯«æ— ç–‘é—®ï¼Œå‡ºè‰²çš„ç»“æœéœ€è¦ä¸»è¦çš„é¡¹ç›®ä»£ç å’Œæµ‹è¯•æœ‰æ•ˆåœ°ååŒå·¥ä½œã€‚ å› æ­¤ï¼Œæµ‹è¯•å¿…é¡»ä¸ä¸»è¦ä»£ç ä¸€æ ·å—åˆ°é‡è§†ã€‚ ä½“é¢çš„æµ‹è¯•æ˜¯æˆåŠŸçš„å…³é”®å› ç´ ï¼Œå› ä¸ºå®ƒå°†èµ¶ä¸Šç”Ÿäº§çš„è¡°é€€ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹PVS-Studioé™æ€åˆ†æå™¨è­¦å‘Šï¼Œä»¥æŸ¥çœ‹æµ‹è¯•é”™è¯¯ä¸ä¼šæ¯”ç”Ÿäº§é”™è¯¯ä¸¥é‡è¿™ä¸€äº‹å®çš„é‡è¦æ€§ã€‚ å½“ä»Šçš„ç„¦ç‚¹ï¼šApache Hadoopã€‚ <br><a name="habracut"></a><br><h2> å…³äºé¡¹ç›® </h2><br> é‚£äº›ä»¥å‰å¯¹å¤§æ•°æ®æ„Ÿå…´è¶£çš„äººå¯èƒ½å·²ç»å¬è¯´è¿‡ç”šè‡³ä¸<a href="https://hadoop.apache.org/">Apache Hadoop</a>é¡¹ç›®åˆä½œã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒHadoopæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥ç”¨ä½œæ„å»ºå¤§æ•°æ®ç³»ç»Ÿå’Œä½¿ç”¨å®ƒä»¬çš„åŸºç¡€ã€‚ <br><br>  Hadoopç”±å››ä¸ªä¸»è¦æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ¨¡å—æ‰§è¡Œå¤§æ•°æ®åˆ†æç³»ç»Ÿæ‰€éœ€çš„ç‰¹å®šä»»åŠ¡ï¼š <br><br><ul><li>  Hadoopå¸¸è§ </li><li>  Mapreduce </li><li>  Hadoopåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ </li><li> çº±çº¿ </li></ul><br> æ— è®ºå¦‚ä½•ï¼ŒInternetä¸Šæœ‰å¾ˆå¤šæœ‰å…³å®ƒçš„èµ„æ–™ã€‚ <br><br><h2> å…³äºæ”¯ç¥¨ </h2><br> å¦‚æ–‡æ¡£ä¸­æ‰€ç¤ºï¼ŒPVS-Studioå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼é›†æˆåˆ°é¡¹ç›®ä¸­ï¼š <br><br><ul><li> ä½¿ç”¨mavenæ’ä»¶ï¼› </li><li> ä½¿ç”¨gradleæ’ä»¶ï¼› </li><li> ä½¿ç”¨gratell IntellJ IDEAï¼› </li><li> ç›´æ¥ä½¿ç”¨åˆ†æä»ªã€‚ </li></ul><br>  HadoopåŸºäºmavenæ„å»ºç³»ç»Ÿï¼Œå› æ­¤ï¼Œæ£€æŸ¥æ²¡æœ‰éšœç¢ã€‚ <br><br> åœ¨é›†æˆäº†æ–‡æ¡£ä¸­çš„è„šæœ¬å¹¶ç¼–è¾‘äº†ä¸€ä¸ªpom.xmlæ–‡ä»¶ï¼ˆä¾èµ–é¡¹ä¸­æœ‰ä¸€äº›æ¨¡å—ä¸å¯ç”¨ï¼‰ä¹‹åï¼Œåˆ†æå¼€å§‹äº†ï¼ <br><br> åˆ†æå®Œæˆåï¼Œæˆ‘é€‰æ‹©äº†æœ€æœ‰è¶£çš„è­¦å‘Šï¼Œå¹¶æ³¨æ„åˆ°åœ¨ç”Ÿäº§ä»£ç å’Œæµ‹è¯•ä¸­ï¼Œæˆ‘å…·æœ‰ç›¸åŒæ•°é‡çš„è­¦å‘Šã€‚ é€šå¸¸ï¼Œæˆ‘ä¸è€ƒè™‘é’ˆå¯¹æµ‹è¯•æä¾›çš„åˆ†æå™¨è­¦å‘Šã€‚ ä½†æ˜¯ï¼Œå½“æˆ‘å°†å®ƒä»¬åˆ†å¼€æ—¶ï¼Œæˆ‘æ— æ³•ä¸ç†ä¼šâ€œæµ‹è¯•â€è­¦å‘Šã€‚  â€œä¸ºä»€ä¹ˆä¸çœ‹ä¸€ä¸‹å®ƒä»¬ï¼Ÿâ€-æˆ‘æƒ³ï¼Œå› ä¸ºæµ‹è¯•ä¸­çš„é”™è¯¯å¯èƒ½è¿˜ä¼šå¸¦æ¥ä¸åˆ©çš„åæœã€‚ å®ƒä»¬å¯èƒ½å¯¼è‡´é”™è¯¯æˆ–éƒ¨åˆ†æµ‹è¯•ï¼Œç”šè‡³æ··æ­ï¼ˆå®ƒä»¬å­˜åœ¨çš„ç›®çš„åªæ˜¯ä¸ºäº†é€‰ä¸­å¤é€‰æ¡†ï¼Œå®ƒä»¬å§‹ç»ˆæ˜¯ç»¿è‰²çš„ï¼‰ã€‚ <br><br> é€‰æ‹©æœ€æœ‰è¶£çš„è­¦å‘Šåï¼Œæˆ‘å°†å…¶åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼šç”Ÿäº§ï¼Œæµ‹è¯•å’Œå››ä¸ªä¸»è¦Hadoopæ¨¡å—ã€‚ ç°åœ¨ï¼Œæˆ‘å¾ˆé«˜å…´ä¸ºæ‚¨æä¾›å¯¹åˆ†æä»ªè­¦å‘Šçš„å¤å®¡ã€‚ <br><br><h2> ç”Ÿäº§ä»£ç  </h2><br><h3>  Hadoopå¸¸è§ </h3><br>  <a href="https://www.viva64.com/en/w/v6033/">V6033</a>å·²ç»æ·»åŠ äº†å…·æœ‰ç›¸åŒé”®â€œ KDC_BIND_ADDRESSâ€çš„é¡¹ç›®ã€‚  MiniKdc.javaï¼ˆ163ï¼‰ï¼ŒMiniKdc.javaï¼ˆ162ï¼‰ <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MiniKdc</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Set&lt;String&gt; PROPERTIES = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;String&gt;(); .... <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { PROPERTIES.add(ORG_NAME); PROPERTIES.add(ORG_DOMAIN); PROPERTIES.add(KDC_BIND_ADDRESS); PROPERTIES.add(KDC_BIND_ADDRESS); <span class="hljs-comment"><span class="hljs-comment">// &lt;= PROPERTIES.add(KDC_PORT); PROPERTIES.add(INSTANCE); .... } .... }</span></span></code> </pre> <br> æ£€æŸ¥é¡¹ç›®æ—¶ï¼Œåœ¨<i>HashSetä¸­</i>ä¸¤æ¬¡æ·»åŠ çš„å€¼æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„ç¼ºé™·ã€‚ å®é™…ä¸Šï¼Œç¬¬äºŒä¸ªæ·»åŠ é¡¹å°†è¢«å¿½ç•¥ã€‚ æˆ‘å¸Œæœ›è¿™ç§é‡å¤åªæ˜¯ä¸€åœºä¸å¿…è¦çš„æ‚²å‰§ã€‚ å¦‚æœè¦æ·»åŠ å¦ä¸€ä¸ªå€¼æ€ä¹ˆåŠï¼Ÿ <br><br><h3>  Mapreduce </h3><br>  <a href="https://www.viva64.com/en/w/v6072/">V6072æ‰¾åˆ°</a>ä¸¤ä¸ªç›¸ä¼¼çš„ä»£ç ç‰‡æ®µã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™å­—ï¼Œåº”è¯¥ä½¿ç”¨â€œ localFilesâ€å˜é‡è€Œä¸æ˜¯â€œ localArchivesâ€ã€‚  LocalDistributedCacheManager.javaï¼ˆ183ï¼‰ï¼ŒLocalDistributedCacheManager.javaï¼ˆ178ï¼‰ï¼ŒLocalDistributedCacheManager.javaï¼ˆ176ï¼‰ï¼ŒLocalDistributedCacheManager.javaï¼ˆ181ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JobConf conf, JobID jobId)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">// Update the configuration object with localized data. if (!localArchives.isEmpty()) { conf.set(MRJobConfig.CACHE_LOCALARCHIVES, StringUtils .arrayToString(localArchives.toArray(new String[localArchives // &lt;= .size()]))); } if (!localFiles.isEmpty()) { conf.set(MRJobConfig.CACHE_LOCALFILES, StringUtils .arrayToString(localFiles.toArray(new String[localArchives // &lt;= .size()]))); } .... }</span></span></code> </pre> <br>  V6072è¯Šæ–­ç¨‹åºæœ‰æ—¶ä¼šäº§ç”Ÿä¸€äº›æœ‰è¶£çš„å‘ç°ã€‚ æ­¤è¯Šæ–­çš„ç›®çš„æ˜¯æ£€æµ‹ç”±äºå¤åˆ¶ç²˜è´´å’Œæ›¿æ¢ä¸¤ä¸ªå˜é‡è€Œå¯¼è‡´çš„ç›¸åŒç±»å‹çš„ä»£ç ç‰‡æ®µã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŸäº›å˜é‡ç”šè‡³ä¿æŒâ€œä¸å˜â€ã€‚ <br><br> ä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†è¿™ä¸€ç‚¹ã€‚ åœ¨ç¬¬ä¸€ä¸ªå—ä¸­ï¼Œä½¿ç”¨<i>localArchives</i>å˜é‡ï¼Œåœ¨ç¬¬äºŒä¸ªç±»ä¼¼çš„ç‰‡æ®µä¸­ï¼Œä½¿ç”¨<i>localFiles</i> ã€‚ å¦‚æœæ‚¨è®¤çœŸç ”ç©¶æ­¤ä»£ç ï¼Œè€Œä¸æ˜¯å¾ˆå¿«åœ°éå†å®ƒï¼Œå› ä¸ºå®ƒç»å¸¸åœ¨ä»£ç å®¡é˜…æ—¶å‘ç”Ÿï¼Œæ‚¨ä¼šæ³¨æ„åˆ°è¯¥ç‰‡æ®µï¼Œä½œè€…å¿˜è®°äº†æ›¿æ¢<i>localArchives</i>å˜é‡ã€‚ <br><br> è¿™ç§å¤±æ€å¯èƒ½å¯¼è‡´ä»¥ä¸‹æƒ…å†µï¼š <br><br><ul><li> å‡è®¾æˆ‘ä»¬æœ‰<i>localArchives</i> ï¼ˆå¤§å°= 4ï¼‰å’Œ<i>localFiles</i> ï¼ˆå¤§å°= 2ï¼‰ï¼› </li><li> åˆ›å»ºæ•°ç»„<i>localFiles.toArrayï¼ˆæ–°å­—ç¬¦ä¸²[localArchives.sizeï¼ˆï¼‰]ï¼‰æ—¶</i> ï¼Œæœ€å2ä¸ªå…ƒç´ å°†ä¸º<i>null</i> ï¼ˆ[[â€œ pathToFile1â€ï¼Œâ€œ pathToFile2â€ï¼Œnullï¼Œnull]ï¼‰ï¼› </li><li> ç„¶å<i>org.apache.hadoop.util.StringUtils.arrayToString</i>å°†è¿”å›æ•°ç»„çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªæ–‡ä»¶åå°†æ˜¾ç¤ºä¸ºâ€œ nullâ€ï¼ˆâ€œ pathToFile1ï¼ŒpathToFile2ï¼Œnullï¼Œnullâ€ <i>ï¼‰ï¼‰</i> ï¼› </li><li> æ‰€æœ‰è¿™ä¸€åˆ‡å°†è¿›ä¸€æ­¥ä¼ é€’ï¼Œä¸Šå¸åªçŸ¥é“è¿™ç§æƒ…å†µä¸‹ä¼šæœ‰ä»€ä¹ˆæ ·çš„æ£€æŸ¥ã€‚ </li></ul><br>  <a href="https://www.viva64.com/en/w/v6007/">V6007</a>è¡¨è¾¾å¼'children.sizeï¼ˆï¼‰&gt; 0'å§‹ç»ˆä¸ºtrueã€‚  Queue.javaï¼ˆ347ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isHierarchySameAs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Queue newState)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (children == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || children.size() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(children.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } .... }</code> </pre> <br> ç”±äºè¦å•ç‹¬æ£€æŸ¥å…ƒç´ æ•°æ˜¯å¦ä¸º0ï¼Œå› æ­¤è¿›ä¸€æ­¥æ£€æŸ¥<i>children.sizeï¼ˆï¼‰&gt; 0</i>å§‹ç»ˆä¸ºtrueã€‚ <br><br><h3>  HDFS </h3><br>  <a href="https://www.viva64.com/en/w/v6001/">V6001</a>åœ¨'ï¼…'è¿ç®—ç¬¦çš„å·¦ä¾§å’Œå³ä¾§æœ‰ç›¸åŒçš„å­è¡¨è¾¾å¼'this.bucketSize'ã€‚  RollingWindow.javaï¼ˆ79ï¼‰ <br><br><pre> <code class="java hljs"> RollingWindow(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> windowLenMs, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numBuckets) { buckets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bucket[numBuckets]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numBuckets; i++) { buckets[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bucket(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.windowLenMs = windowLenMs; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bucketSize = windowLenMs / numBuckets; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bucketSize % bucketSize != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= throw new IllegalArgumentException( "The bucket size in the rolling window is not integer: windowLenMs= " + windowLenMs + " numBuckets= " + numBuckets); } }</span></span></code> </pre> <br> æ­¤å¤„çš„ç¼ºé™·æ˜¯å˜é‡è¢«è‡ªèº«é™¤ã€‚ ç»“æœï¼Œå¯¹å¤šé‡æ€§çš„æ£€æŸ¥å°†å§‹ç»ˆæˆåŠŸï¼Œå¹¶ä¸”åœ¨è·å¾—ä¸æ­£ç¡®çš„è¾“å…¥ï¼ˆ <i>windowLenMs</i> ï¼Œ <i>numBuckets</i> ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ°¸è¿œä¸ä¼šå¼•å‘å¼‚å¸¸ã€‚ <br><br><h3> çº±çº¿ </h3><br>  <a href="https://www.viva64.com/en/w/v6067/">V6067</a>ä¸¤ä¸ªæˆ–æ›´å¤šæ¡ˆä»¶åˆ†æ”¯æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚  TimelineEntityV2Converter.javaï¼ˆ386ï¼‰ï¼ŒTimelineEntityV2Converter.javaï¼ˆ389ï¼‰ <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ApplicationReport </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToApplicationReport</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TimelineEntity entity)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (metrics != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> vcoreSeconds = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> memorySeconds = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> preemptedVcoreSeconds = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> preemptedMemorySeconds = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (TimelineMetric metric : metrics) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (metric.getId()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ApplicationMetricsConstants.APP_CPU_METRICS: vcoreSeconds = getAverageValue(metric.getValues().values()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ApplicationMetricsConstants.APP_MEM_METRICS: memorySeconds = ....; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ApplicationMetricsConstants.APP_MEM_PREEMPT_METRICS: preemptedVcoreSeconds = ....; <span class="hljs-comment"><span class="hljs-comment">// &lt;= break; case ApplicationMetricsConstants.APP_CPU_PREEMPT_METRICS: preemptedVcoreSeconds = ....; // &lt;= break; default: // Should not happen.. break; } } .... } .... }</span></span></code> </pre> <br> ä¸¤ä¸ª<i>æ¡ˆä¾‹</i>åˆ†æ”¯ä¸­çš„ç›¸åŒä»£ç ç‰‡æ®µã€‚ åˆ°å¤„éƒ½æ˜¯ï¼ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸æ˜¯çœŸæ­£çš„é”™è¯¯ï¼Œè€Œåªæ˜¯è€ƒè™‘å¯¹<i>switch</i>è¿›è¡Œé‡æ„çš„ä¸€ä¸ªåŸå› ã€‚ ä½†ç›®å‰æƒ…å†µå¹¶éå¦‚æ­¤ã€‚ é‡å¤çš„ä»£ç ç‰‡æ®µè®¾ç½®å˜é‡<i>preemptedVcoreSeconds</i>çš„å€¼ã€‚ å¦‚æœä»”ç»†æŸ¥çœ‹æ‰€æœ‰å˜é‡å’Œå¸¸é‡çš„åç§°ï¼Œæ‚¨å¯èƒ½ä¼šå¾—å‡ºç»“è®ºï¼Œå¦‚æœ<i>metric.getIdï¼ˆï¼‰== APP_MEM_PREEMPT_METRICSï¼Œ</i>åˆ™å¿…é¡»ä¸º<i>preemptedMemorySeconds</i>å˜é‡è€Œä¸æ˜¯<i>preemptedVcoreSeconds</i>è®¾ç½®å€¼ã€‚ åœ¨è¿™æ–¹é¢ï¼Œåœ¨â€œ switchâ€è¿ç®—ç¬¦ä¹‹åï¼Œ <i>preemptedMemorySeconds</i>å°†å§‹ç»ˆä¿æŒä¸º0ï¼Œè€Œ<i>preemptedVcoreSeconds</i>çš„å€¼å¯èƒ½ä¸æ­£ç¡®ã€‚ <br><br>  <a href="https://www.viva64.com/en/w/v6046/">V6046</a>æ ¼å¼é”™è¯¯ã€‚ é¢„è®¡ä¼šæœ‰ä¸åŒæ•°é‡çš„æ ¼å¼é¡¹ã€‚ ä¸ä½¿ç”¨çš„å‚æ•°ï¼š2. AbstractSchedulerPlanFollower.javaï¼ˆ186ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">synchronizePlan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Plan plan, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> shouldReplan)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { setQueueEntitlement(planQueueName, ....); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (YarnException e) { LOG.warn(<span class="hljs-string"><span class="hljs-string">"Exception while trying to size reservation for plan: {}"</span></span>, currResId, planQueueName, e); } .... }</code> </pre> <br> è®°å½•æ—¶ä¸ä½¿ç”¨<i>planQueueName</i>å˜é‡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¦ä¹ˆå¤åˆ¶å¤ªå¤šï¼Œè¦ä¹ˆæ ¼å¼å­—ç¬¦ä¸²æœªå®Œæˆã€‚ ä½†æ˜¯æˆ‘ä»ç„¶è¦è´£å¤‡æ—§çš„å¤åˆ¶ç²˜è´´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå°†å…¶ç²˜è´´åœ¨è„šä¸ŠçœŸæ˜¯å¤ªå¥½äº†ã€‚ <br><br><h2> æµ‹è¯•ç  </h2><br><h3>  Hadoopå¸¸è§ </h3><br>  <a href="https://www.viva64.com/en/w/v6072/">V6072æ‰¾åˆ°</a>ä¸¤ä¸ªç›¸ä¼¼çš„ä»£ç ç‰‡æ®µã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™å­—ï¼Œåº”è¯¥ä½¿ç”¨'allSecretsB'å˜é‡è€Œä¸æ˜¯'allSecretsA'ã€‚  TestZKSignerSecretProvider.javaï¼ˆ316ï¼‰ï¼ŒTestZKSignerSecretProvider.javaï¼ˆ309ï¼‰ï¼ŒTestZKSignerSecretProvider.javaï¼ˆ306ï¼‰ï¼ŒTestZKSignerSecretProvider.javaï¼ˆ313ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMultiple</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> order)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ .... currentSecretA = secretProviderA.getCurrentSecret(); allSecretsA = secretProviderA.getAllSecrets(); Assert.assertArrayEquals(secretA2, currentSecretA); Assert.assertEquals(<span class="hljs-number"><span class="hljs-number">2</span></span>, allSecretsA.length); <span class="hljs-comment"><span class="hljs-comment">// &lt;= Assert.assertArrayEquals(secretA2, allSecretsA[0]); Assert.assertArrayEquals(secretA1, allSecretsA[1]); currentSecretB = secretProviderB.getCurrentSecret(); allSecretsB = secretProviderB.getAllSecrets(); Assert.assertArrayEquals(secretA2, currentSecretB); Assert.assertEquals(2, allSecretsA.length); // &lt;= Assert.assertArrayEquals(secretA2, allSecretsB[0]); Assert.assertArrayEquals(secretA1, allSecretsB[1]); .... }</span></span></code> </pre> <br> å†æ¬¡æ˜¯V6072ã€‚ ä»”ç»†æŸ¥çœ‹å˜é‡<i>allSecretsA</i>å’Œ<i>allSecretsB</i> ã€‚ <br><br>  <a href="https://www.viva64.com/en/w/v6043/">V6043</a>è€ƒè™‘æ£€æŸ¥â€œ forâ€è¿ç®—ç¬¦ã€‚ è¿­ä»£å™¨çš„åˆå§‹å€¼å’Œæœ€ç»ˆå€¼ç›¸åŒã€‚  TestTFile.javaï¼ˆ235ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPrepWithUnknownLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Scanner scanner, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = start; i &lt; start; i++) { String key = String.format(localFormatter, i); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] read = readKey(scanner); assertTrue(<span class="hljs-string"><span class="hljs-string">"keys not equal"</span></span>, Arrays.equals(key.getBytes(), read)); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { read = readValue(scanner); assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException ie) { <span class="hljs-comment"><span class="hljs-comment">// should have thrown exception } String value = "value" + key; read = readLongValue(scanner, value.getBytes().length); assertTrue("values nto equal", Arrays.equals(read, value.getBytes())); scanner.advance(); } return (start + n); }</span></span></code> </pre> <br> æ€»æ˜¯ç»¿è‰²çš„æµ‹è¯•ï¼Ÿ  =ï¼‰ã€‚ å¾ªç¯çš„ä¸€éƒ¨åˆ†ï¼Œå³æµ‹è¯•æœ¬èº«çš„ä¸€éƒ¨åˆ†ï¼Œå°†æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚ è¿™æ˜¯ç”±äºä»¥ä¸‹äº‹å®ï¼š <i>for</i>è¯­å¥ä¸­çš„åˆå§‹è®¡æ•°å™¨å€¼å’Œæœ€ç»ˆè®¡æ•°å™¨å€¼ç›¸ç­‰ã€‚ ç»“æœï¼Œæ¡ä»¶<i>i &lt;å¼€å§‹</i>å°†ç«‹å³å˜ä¸ºå‡ï¼Œä»è€Œå¯¼è‡´è¿™ç§è¡Œä¸ºã€‚ æˆ‘æµè§ˆäº†æµ‹è¯•æ–‡ä»¶ï¼Œå¹¶å¾—å‡ºç»“è®ºï¼Œå®é™…ä¸Š<i>i &lt;ï¼ˆstart + nï¼‰</i>å¿…é¡»åœ¨å¾ªç¯æ¡ä»¶ä¸‹ç¼–å†™ã€‚ <br><br><h3>  Mapreduce </h3><br>  <a href="https://www.viva64.com/en/w/v6007/">V6007</a>è¡¨è¾¾å¼'byteAm &lt;0'å§‹ç»ˆä¸ºfalseã€‚  DataWriter.javaï¼ˆ322ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">GenerateOutput </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeSegment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> byteAm, OutputStream out)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> headerLen = getHeaderLength(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (byteAm &lt; headerLen) { <span class="hljs-comment"><span class="hljs-comment">// not enough bytes to write even the header return new GenerateOutput(0, 0); } // adjust for header length byteAm -= headerLen; if (byteAm &lt; 0) { // &lt;= byteAm = 0; } .... }</span></span></code> </pre> <br> æ¡ä»¶<i>byteAm &lt;0</i>å§‹ç»ˆä¸ºfalseã€‚ ä¸ºäº†å¼„æ¸…æ¥šï¼Œè®©æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ä»£ç ã€‚ å¦‚æœæµ‹è¯•æ‰§è¡Œåˆ°è¾¾æ“ä½œ<i>byteAm-= headerLen</i> ï¼Œåˆ™æ„å‘³ç€<i>byteAm&gt; = headerLenã€‚</i> ä»è¿™é‡Œå¼€å§‹ï¼Œå‡å»åï¼Œ <i>byteAm</i>å€¼å°†æ°¸è¿œä¸ä¼šä¸ºè´Ÿã€‚ é‚£å°±æ˜¯æˆ‘ä»¬å¿…é¡»è¯æ˜çš„ã€‚ <br><br><h3>  HDFS </h3><br>  <a href="https://www.viva64.com/en/w/v6072/">V6072æ‰¾åˆ°</a>ä¸¤ä¸ªç›¸ä¼¼çš„ä»£ç ç‰‡æ®µã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™å­—ï¼Œåº”è¯¥ä½¿ç”¨'normalFile'å˜é‡è€Œä¸æ˜¯'normalDir'ã€‚  TestWebHDFS.javaï¼ˆ625ï¼‰ï¼ŒTestWebHDFS.javaï¼ˆ615ï¼‰ï¼ŒTestWebHDFS.javaï¼ˆ614ï¼‰ï¼ŒTestWebHDFS.javaï¼ˆ624ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWebHdfsErasureCodingFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Path normalDir = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Path(<span class="hljs-string"><span class="hljs-string">"/dir"</span></span>); dfs.mkdirs(normalDir); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Path normalFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Path(normalDir, <span class="hljs-string"><span class="hljs-string">"file.log"</span></span>); .... <span class="hljs-comment"><span class="hljs-comment">// logic block #1 FileStatus expectedNormalDirStatus = dfs.getFileStatus(normalDir); FileStatus actualNormalDirStatus = webHdfs.getFileStatus(normalDir); // &lt;= Assert.assertEquals(expectedNormalDirStatus.isErasureCoded(), actualNormalDirStatus.isErasureCoded()); ContractTestUtils.assertNotErasureCoded(dfs, normalDir); assertTrue(normalDir + " should have erasure coding unset in " + ....); // logic block #2 FileStatus expectedNormalFileStatus = dfs.getFileStatus(normalFile); FileStatus actualNormalFileStatus = webHdfs.getFileStatus(normalDir); // &lt;= Assert.assertEquals(expectedNormalFileStatus.isErasureCoded(), actualNormalFileStatus.isErasureCoded()); ContractTestUtils.assertNotErasureCoded(dfs, normalFile); assertTrue( normalFile + " should have erasure coding unset in " + ....); }</span></span></code> </pre> <br> ä¿¡ä¸ä¿¡ç”±ä½ ï¼Œåˆæ˜¯V6072ï¼ åªéœ€éµå¾ªå˜é‡<i>normalDir</i>å’Œ<i>normalFileã€‚</i> <br><br>  <a href="https://www.viva64.com/en/w/v6027/">V6027</a>é€šè¿‡è°ƒç”¨åŒä¸€å‡½æ•°æ¥åˆå§‹åŒ–å˜é‡ã€‚ å¯èƒ½æ˜¯é”™è¯¯æˆ–æœªä¼˜åŒ–çš„ä»£ç ã€‚  TestDFSAdmin.javaï¼ˆ883ï¼‰ï¼ŒTestDFSAdmin.javaï¼ˆ879ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verifyNodesAndCorruptBlocks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numDn, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numLiveDn, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numCorruptBlocks, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numCorruptECBlockGroups, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DFSClient client, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Long highestPriorityLowRedundancyReplicatedBlocks, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Long highestPriorityLowRedundancyECBlocks)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* init vars */</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String expectedCorruptedECBlockGroupsStr = String.format( <span class="hljs-string"><span class="hljs-string">"Block groups with corrupt internal blocks: %d"</span></span>, numCorruptECBlockGroups); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String highestPriorityLowRedundancyReplicatedBlocksStr = String.format( <span class="hljs-string"><span class="hljs-string">"\tLow redundancy blocks with highest priority "</span></span> + <span class="hljs-string"><span class="hljs-string">"to recover: %d"</span></span>, highestPriorityLowRedundancyReplicatedBlocks); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String highestPriorityLowRedundancyECBlocksStr = String.format( <span class="hljs-string"><span class="hljs-string">"\tLow redundancy blocks with highest priority "</span></span> + <span class="hljs-string"><span class="hljs-string">"to recover: %d"</span></span>, highestPriorityLowRedundancyReplicatedBlocks); .... }</code> </pre> <br> åœ¨æ­¤ç‰‡æ®µä¸­ï¼Œå˜é‡<i>highestPriorityLowRedundancyReplicatedBlocksStr</i>å’Œ<i>highestPriorityLowRedundancyECBlocksStr</i>ç”¨ç›¸åŒçš„å€¼åˆå§‹åŒ–ã€‚ é€šå¸¸åº”è¯¥æ˜¯è¿™æ ·ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚ å˜é‡çš„åç§°åˆé•¿åˆç›¸ä¼¼ï¼Œå› æ­¤å¤åˆ¶ç²˜è´´çš„ç‰‡æ®µæ²¡æœ‰è¿›è¡Œä»»ä½•æ›´æ”¹ä¹Ÿå°±ä¸è¶³ä¸ºå¥‡äº†ã€‚ è¦è§£å†³æ­¤é—®é¢˜ï¼Œåœ¨åˆå§‹åŒ–<i>maximumPriorityLowRedundancyECBlocksStr</i>å˜é‡æ—¶ï¼Œä½œè€…å¿…é¡»ä½¿ç”¨è¾“å…¥å‚æ•°<i>maximumPriorityLowRedundancyECBlocks</i> ã€‚ æ­¤å¤–ï¼Œæœ€æœ‰å¯èƒ½çš„æ˜¯ï¼Œä»–ä»¬ä»ç„¶éœ€è¦æ›´æ­£æ ¼å¼è¡Œã€‚ <br><br>  <a href="https://www.viva64.com/en/w/v6019/">V6019</a>æ£€æµ‹<a href="https://www.viva64.com/en/w/v6019/">ä¸åˆ°</a>ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestReplaceDatanodeFailureReplication.javaï¼ˆ222ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verifyFileContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., SlowWriter[] slowwriters)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ LOG.info(<span class="hljs-string"><span class="hljs-string">"Verify the file"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; slowwriters.length; i++) { LOG.info(slowwriters[i].filepath + ....); FSDataInputStream in = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { in = fs.open(slowwriters[i].filepath); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>, x;; j++) { x = in.read(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((x) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { Assert.assertEquals(j, x); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { IOUtils.closeStream(in); } } }</code> </pre> <br> åˆ†æå™¨æŠ±æ€¨æ— æ³•æ›´æ”¹å¾ªç¯ä¸­çš„<i>i ++</i>è®¡æ•°å™¨ã€‚ è¿™æ„å‘³ç€åœ¨<i>forï¼ˆint i = 0; i &lt;slowwriters.length; i ++ï¼‰{....}</i>å¾ªç¯ä¸­ï¼Œæœ€å¤šå°†æ‰§è¡Œä¸€æ¬¡è¿­ä»£ã€‚ è®©æˆ‘ä»¬æ‰¾å‡ºåŸå› ã€‚ å› æ­¤ï¼Œåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†çº¿ç¨‹ä¸<i>æ…¢é€Ÿå†™å…¥å™¨[0]</i>å¯¹åº”çš„æ–‡ä»¶é“¾æ¥èµ·æ¥ï¼Œä»¥è¿›è¡Œè¿›ä¸€æ­¥çš„è¯»å–ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡å¾ªç¯è¯»å–æ–‡ä»¶å†…å®¹<i>ï¼ˆint j = 0ï¼Œx ;; j ++ï¼‰ï¼š</i> <br><br><ul><li> å¦‚æœæˆ‘ä»¬è¯»å–äº†ä¸€äº›ç›¸å…³çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å°†é€šè¿‡<i>assertEquals</i>å°†è¯»å–çš„å­—èŠ‚ä¸<i>j</i>è®¡æ•°å™¨çš„å½“å‰å€¼è¿›è¡Œæ¯”è¾ƒï¼ˆå¦‚æœæ£€æŸ¥ä¸æˆåŠŸï¼Œåˆ™æµ‹è¯•å¤±è´¥ï¼‰ï¼› </li><li> å¦‚æœæ–‡ä»¶æ£€æŸ¥æˆåŠŸï¼Œå¹¶ä¸”åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼ˆè¯»å–ä¸º-1ï¼‰ï¼Œåˆ™è¯¥æ–¹æ³•é€€å‡ºã€‚ </li></ul><br> å› æ­¤ï¼Œåœ¨æ£€æŸ¥<i>lowwriters [0]</i>æœŸé—´å‘ç”Ÿçš„ä»»ä½•äº‹æƒ…ï¼Œéƒ½ä¸ä¼šå»æ£€æŸ¥åç»­å…ƒç´ ã€‚ æœ€æœ‰å¯èƒ½çš„æ˜¯ï¼Œå¿…é¡»ä½¿ç”¨<i>ä¸­æ–­</i>æ¥ä»£æ›¿<i>è¿”å›ã€‚</i> <br><br><h3> çº±çº¿ </h3><br>  <a href="https://www.viva64.com/en/w/v6019/">V6019</a>æ£€æµ‹<a href="https://www.viva64.com/en/w/v6019/">ä¸åˆ°</a>ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestNodeManager.javaï¼ˆ176ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreationOfNodeLabelsProviderService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> InterruptedException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Assert.fail(<span class="hljs-string"><span class="hljs-string">"Exception caught"</span></span>); e.printStackTrace(); } }</code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <i>Assert.fail</i>æ–¹æ³•å°†ä¸­æ–­æµ‹è¯•ï¼Œå¹¶ä¸”åœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ä¸ä¼šæ‰“å°stacktraceã€‚ å¦‚æœæœ‰å…³æ•è·åˆ°çš„å¼‚å¸¸çš„æ¶ˆæ¯åœ¨è¿™é‡Œè¶³å¤Ÿå¤šäº†ï¼Œé‚£ä¹ˆæœ€å¥½å–æ¶ˆæ‰“å°stacktraceä»¥é¿å…æ··æ·†ã€‚ å¦‚æœéœ€è¦æ‰“å°ï¼Œåˆ™åªéœ€äº¤æ¢å®ƒä»¬ã€‚ <br><br> å·²å‘ç°è®¸å¤šç±»ä¼¼çš„ç‰‡æ®µï¼š <br><br><ul><li>  V6019æ£€æµ‹ä¸åˆ°ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestResourceTrackerService.javaï¼ˆ928ï¼‰ </li><li>  V6019æ£€æµ‹ä¸åˆ°ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestResourceTrackerService.javaï¼ˆ737ï¼‰ </li><li>  V6019æ£€æµ‹ä¸åˆ°ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestResourceTrackerService.javaï¼ˆ685ï¼‰ </li><li>  .... </li></ul><br>  <a href="https://www.viva64.com/en/w/v6072/">V6072æ‰¾åˆ°</a>ä¸¤ä¸ªç›¸ä¼¼çš„ä»£ç ç‰‡æ®µã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™å­—ï¼Œåº”è¯¥ä½¿ç”¨â€œ publicCacheâ€å˜é‡è€Œä¸æ˜¯â€œ usercacheâ€ã€‚  TestResourceLocalizationService.javaï¼ˆ315ï¼‰ï¼ŒTestResourceLocalizationService.javaï¼ˆ309ï¼‰ï¼ŒTestResourceLocalizationService.javaï¼ˆ307ï¼‰ï¼ŒTestResourceLocalizationService.javaï¼ˆ313ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDirectoryCleanupOnNewlyCreatedStateStore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, URISyntaxException </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">// verify directory creation for (Path p : localDirs) { p = new Path((new URI(p.toString())).getPath()); // logic block #1 Path usercache = new Path(p, ContainerLocalizer.USERCACHE); verify(spylfs).rename(eq(usercache), any(Path.class), any()); // &lt;= verify(spylfs).mkdir(eq(usercache), ....); // logic block #2 Path publicCache = new Path(p, ContainerLocalizer.FILECACHE); verify(spylfs).rename(eq(usercache), any(Path.class), any()); // &lt;= verify(spylfs).mkdir(eq(publicCache), ....); .... } .... }</span></span></code> </pre> <br> æœ€åï¼Œå†æ¬¡æ˜¯V6072 =ï¼‰ã€‚ ç”¨äºæŸ¥çœ‹å¯ç–‘ç‰‡æ®µçš„å˜é‡ï¼š <i>usercache</i>å’Œ<i>publicCache</i> ã€‚ <br><br><h2> ç»“è®º </h2><br> å¼€å‘ä¸­ç¼–å†™äº†æˆåƒä¸Šä¸‡çš„ä»£ç è¡Œã€‚ ç”Ÿäº§ä»£ç é€šå¸¸ä¿æŒæ¸…æ´ï¼Œæ²¡æœ‰é”™è¯¯ï¼Œç¼ºé™·å’Œç¼ºé™·ï¼ˆå¼€å‘äººå‘˜æµ‹è¯•ä»–ä»¬çš„ä»£ç ï¼Œæ£€æŸ¥ä»£ç ç­‰ï¼‰ã€‚ åœ¨è¿™æ–¹é¢ï¼Œæµ‹è¯•è‚¯å®šä¸å¦‚ã€‚ æµ‹è¯•ä¸­çš„ç¼ºé™·å¾ˆå®¹æ˜“éšè—åœ¨â€œç»¿è‰²åˆ»åº¦â€åé¢ã€‚ æ­£å¦‚æ‚¨å¯èƒ½ä»ä»Šå¤©çš„è­¦å‘Šå›é¡¾ä¸­äº†è§£åˆ°çš„é‚£æ ·ï¼Œç»¿è‰²æµ‹è¯•å¹¶ä¸æ€»æ˜¯ä¸€é¡¹æˆåŠŸçš„æ£€æŸ¥ã€‚ <br><br> è¿™æ¬¡ï¼Œå½“æ£€æŸ¥Apache Hadoopä»£ç åº“æ—¶ï¼Œåœ¨ç”Ÿäº§ä»£ç å’Œæµ‹è¯•ä¸­éƒ½éå¸¸éœ€è¦é™æ€åˆ†æï¼Œè€Œé™æ€åˆ†æåœ¨å¼€å‘ä¸­ä¹Ÿèµ·ç€é‡è¦ä½œç”¨ã€‚ <br><br> å› æ­¤ï¼Œå¦‚æœæ‚¨å…³å¿ƒä»£ç å¹¶æµ‹è¯•è´¨é‡ï¼Œå»ºè®®æ‚¨ç€çœ¼äºé™æ€åˆ†æã€‚ è®©<a href="https://www.viva64.com/en/pvs-studio-download/">PVS-Studio</a>æˆä¸ºè¿™é¡¹å·¥ä½œçš„ç¬¬ä¸€ç«äº‰è€…ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN480918/">https://habr.com/ru/post/zh-CN480918/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN480904/index.html">PHPå¾®æœåŠ¡æ¡†æ¶ï¼šSwoftçš„å¼€å‘ç¯å¢ƒ</a></li>
<li><a href="../zh-CN480906/index.html">ç¼–å†™ä¸€ä¸ªç®€å•çš„pythonæ¸¸æˆ</a></li>
<li><a href="../zh-CN480910/index.html">å¦‚ä½•ä¸ºSeleniumæµ‹è¯•åˆ›å»ºåŸºæœ¬æµ‹è¯•ç±»å¹¶é€šè¿‡JUnit RuleChainè¿›è¡Œåˆå§‹åŒ–</a></li>
<li><a href="../zh-CN480912/index.html">å¿«é€Ÿè¡ŒåŠ¨ã€‚ ç¼–å†™TodoMVCã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN480914/index.html">é¢å‘åˆå­¦è€…çš„å¾®æœåŠ¡</a></li>
<li><a href="../zh-CN480920/index.html">ä½¿ç”¨è¿œç¨‹PoEæµ‹è¯•TP-Linkäº¤æ¢æœºã€‚ å…³äºæ—§å‹å·çš„å‡çº§</a></li>
<li><a href="../zh-CN480922/index.html">Evgeny Usvitskyï¼šâ€œä¸–ç•Œä¸Šæ¯ä¸ªäººéƒ½çŸ¥é“åœ¨å“ªé‡Œå…è´¹è·å–åœ°ç†æ•°æ®-ä»…åœ¨OSMä¸­â€</a></li>
<li><a href="../zh-CN480924/index.html">é‡åˆ¶MediEvilçš„åˆ›å»ºè€…å¦‚ä½•ä»¥åŠä¸ºä½•é‡æ–°è®¾è®¡äº†æ¸¸æˆçš„ç‹‚çƒ­è€æ¿</a></li>
<li><a href="../zh-CN480926/index.html">ç‰©ç†ç²¾ç¡®æ¸²æŸ“çš„æ¦‚ç‡è®º</a></li>
<li><a href="../zh-CN480928/index.html">Apache Hadoopä»£ç è´¨é‡ï¼šç”Ÿäº§VSæµ‹è¯•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>