<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•• üê± üåü Hierarchische Abh√§ngigkeitsinjektion in React und MobX State Tree als Dom√§nenmodell üßù üê´ üëÅÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nach einigen Projekten zu React hatte ich die M√∂glichkeit, an einer Anwendung unter Angular 2 zu arbeiten. Ehrlich gesagt war ich nicht beeindruckt. E...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hierarchische Abh√§ngigkeitsinjektion in React und MobX State Tree als Dom√§nenmodell</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431942/"><p><img src="https://habrastorage.org/webt/78/ou/57/78ou57kbv7kdv7llnfl-_cwmxpw.png" align="left">  Nach einigen Projekten zu React hatte ich die M√∂glichkeit, an einer Anwendung unter Angular 2 zu arbeiten. Ehrlich gesagt war ich nicht beeindruckt.  Eines wurde jedoch beachtet: Verwalten der Logik und des Status der Anwendung mithilfe von Dependency Injection.  Und ich habe mich gefragt, ob es bequem ist, den Status in React mithilfe von DDD, einer Schichtarchitektur und Abh√§ngigkeitsinjektion zu verwalten. </p><br><p>  Wenn Sie daran interessiert sind, wie das geht, und vor allem warum - willkommen zum Schnitt! </p><a name="habracut"></a><br><p> Um ehrlich zu sein, wird DI selbst im Backend selten in vollem Umfang genutzt.  Es sei denn, in wirklich gro√üen Anwendungen.  Und in kleinen und mittleren, selbst mit einem DI, hat jede Schnittstelle normalerweise nur eine Implementierung.  Die Abh√§ngigkeitsinjektion hat jedoch immer noch ihre Vorteile: </p><br><ul><li>  Der Code ist besser strukturiert und die Schnittstellen fungieren als explizite Vertr√§ge. </li><li>  Die Erstellung von Stubs in Unit-Tests wird vereinfacht. </li></ul><br><p>  Moderne Testbibliotheken f√ºr JS wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jest</a> erm√∂glichen es Ihnen jedoch, Moki einfach auf der Basis des modularen ES6-Systems zu schreiben.  Hier werden wir also nicht viel von DI profitieren. </p><br><p>  Der zweite Punkt bleibt - die Verwaltung des Umfangs und der Lebensdauer von Objekten.  Auf dem Server ist die Lebensdauer normalerweise an die gesamte Anwendung (Singleton) oder an die Anforderung gebunden.  Auf dem Client ist die Hauptcodeeinheit die Komponente.  Wir werden daran h√§ngen. </p><br><p> Wenn Sie den Status auf Anwendungsebene verwenden m√ºssen, ist es am einfachsten, die Variable auf ES6-Modulebene festzulegen und gegebenenfalls zu importieren.  Und wenn der Status nur innerhalb der Komponente ben√∂tigt wird, setzen wir ihn einfach in diesen <strong><code>this.state</code></strong> .  F√ºr alles andere gibt es <strong><code>Context</code></strong> .  Der <strong><code>Context</code></strong> ist jedoch zu niedrig: </p><br><ul><li>  Wir k√∂nnen keinen Kontext au√üerhalb des Komponentenbaums "Reagieren" verwenden.  Zum Beispiel in einer Gesch√§ftslogikschicht. </li><li>  Wir k√∂nnen nicht mehr als einen Kontext in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code><strong>Class.contextType</strong></code></a> .  Um die Abh√§ngigkeit von mehreren verschiedenen Diensten zu bestimmen, m√ºssen wir auf neue Weise eine ‚ÄûHorrorpyramide‚Äú bauen: </li></ul><br><img src="https://habrastorage.org/webt/as/4r/2n/as4r2ncj0zh_2dmpoxbuahkio74.png"><br><br><p>  Der neue Hook <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code><strong>useContext()</strong></code></a> korrigiert die Situation f√ºr Funktionskomponenten geringf√ºgig.  Aber wir werden die vielen <strong><code>&lt;Context.Provider&gt;</code></strong> nicht los.  Bis wir unseren Kontext in einen Service Locator und seine √ºbergeordnete Komponente in einen Composition Root verwandeln.  Aber hier ist es nicht weit von DI, also fangen wir an! </p><br><blockquote>  Sie k√∂nnen diesen Teil √ºberspringen und direkt zur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beschreibung der Architektur gehen.</a> </blockquote><br><h2 id="realizaciya-mehanizma-di">  Implementierung des DI-Mechanismus </h2><br><p>  Zuerst brauchen wir einen Reaktionskontext: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InjectorContext= React.createContext(<span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre> <br><p>  Da React den Komponentenkonstruktor f√ºr seine Anforderungen verwendet, verwenden wir Property Injection.  Definieren Sie dazu den <strong><code>@inject</code></strong> Dekorator, der: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code><strong>Class.contextType</strong></code></a> die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code><strong>Class.contextType</strong></code></a> Eigenschaft fest. </li><li>  Ruft die Art der Abh√§ngigkeit ab </li><li>  findet ein <strong><code>Injector</code></strong> Objekt und l√∂st die Abh√§ngigkeit auf. </li></ul><br><div class="spoiler">  <b class="spoiler_title">injizieren.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"reflect-metadata"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target, key</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  static cotextType target.constructor.contextType = InjectorContext; //    const type = Reflect.getMetadata("design:type", target, key); //  property Object.defineProperty(target, key, { configurable: true, enumerable: true, get() { //  Injector       const instance = getInstance(getInjector(this), type); Object.defineProperty(this, key, { enumerable: true, writable: true, value: instance }); return instance; }, // settet     Dependency Injection set(instance) { Object.defineProperty(this, key, { enumerable: true, writable: true, value: instance }); } }); }</span></span></code> </pre> </div></div><br><p>  Jetzt k√∂nnen wir Abh√§ngigkeiten zwischen beliebigen Klassen definieren: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarService</span></span></span><span class="hljs-class"> </span></span>{ @inject foo: FooService; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject foo: FooService; @inject bar: BarService; }</code> </pre> <br><p>  F√ºr diejenigen, die keine Dekorateure akzeptieren, definieren wir die Funktion <strong><code>inject()</code></strong> mit dieser Signatur: </p><br><pre> <code class="javascript hljs">type Constructor&lt;T&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (...args: any[]) =&gt; T; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target: Object, type: Constructor&lt;T&gt; | Function</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">injizieren.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target, keyOrType</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFunction(keyOrType)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getInstance(getInjector(target), keyOrType); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> </div></div><br><p>  Auf diese Weise k√∂nnen Sie Abh√§ngigkeiten explizit definieren: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarService</span></span></span><span class="hljs-class"> </span></span>{ foo = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, FooService); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ foo = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, FooService); bar = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, BarService); <span class="hljs-comment"><span class="hljs-comment">//   static contextType = InjectorContext; }</span></span></code> </pre> <br><p>  Was ist mit Funktionskomponenten?  F√ºr sie k√∂nnen wir Hook <strong><code>useInstance()</code></strong> implementieren </p><br><div class="spoiler">  <b class="spoiler_title">hooks.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useRef, useContext } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ref = useRef(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> injector = useContext(InjectorContext); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ref.current || (ref.current = getInstance(injector, type)); }</code> </pre> </div></div><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useInstance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MyComponent = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> foo = useInstance(FooService); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bar = useInstance(BarService); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; }</span></span></code> </pre> <br><p>  Jetzt bestimmen wir, wie unser <strong><code>Injector</code></strong> aussehen k√∂nnte, wie er zu finden ist und wie Abh√§ngigkeiten aufgel√∂st werden.  Der Injektor muss einen Verweis auf das √ºbergeordnete Element, einen Objektcache f√ºr bereits aufgel√∂ste Abh√§ngigkeiten und ein Regelw√∂rterbuch f√ºr noch nicht aufgel√∂ste Abh√§ngigkeiten enthalten. </p><br><div class="spoiler">  <b class="spoiler_title">Injektor.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">type Binding = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector: Injector</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> abstract <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Injector</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    Injector _parent?: Injector; //    _bindingMap: Map&lt;Function, Binding&gt;; //      _instanceMap: Map&lt;Function, Object&gt;; }</span></span></code> </pre> </div></div><br><p>  F√ºr React-Komponenten ist <strong><code>Injector</code></strong> √ºber das Feld <strong><code>this.context</code></strong> verf√ºgbar, und f√ºr Abh√§ngigkeitsklassen k√∂nnen wir <strong><code>Injector</code></strong> vor√ºbergehend in eine globale Variable <strong><code>this.context</code></strong> .  Um die Suche nach einem Injektor f√ºr jede Klasse zu beschleunigen, wird der Link zu <strong><code>Injector</code></strong> in einem ausgeblendeten Feld zwischengespeichert. </p><br><div class="spoiler">  <b class="spoiler_title">Injektor.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INJECTOR = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span> === <span class="hljs-string"><span class="hljs-string">"function"</span></span> ? <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>() : <span class="hljs-string"><span class="hljs-string">"__injector__"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentInjector = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInjector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> injector = target[INJECTOR]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (injector) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector; } injector = currentInjector || target.context; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (injector <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Injector) { target[INJECTOR] = injector; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> </div></div><br><p>  Um eine bestimmte Bindungsregel zu finden, m√ºssen wir den Injektorbaum mit der Funktion <strong><code>getInstance()</code></strong> </p><br><div class="spoiler">  <b class="spoiler_title">Injektor.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector, type</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (injector) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> instance = injector._instanceMap.get(type); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> binding = injector._bindingMap.get(type); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (binding) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prevInjector = currentInjector; currentInjector = injector; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { instance = binding(injector); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { currentInjector = prevInjector; } injector._instanceMap.set(type, instance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } injector = injector._parent; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; }</code> </pre> </div></div><br><p>  Lassen Sie uns abschlie√üend mit dem Registrieren von Abh√§ngigkeiten fortfahren.  Dazu ben√∂tigen wir den HOC- <strong><code>provider()</code></strong> , der eine Reihe von Abh√§ngigkeitsbindungen in seine Implementierungen <strong><code>Injector</code></strong> und einen neuen <strong><code>Injector</code></strong> √ºber <strong><code>InjectorContext.Provider</code></strong> registriert </p><br><div class="spoiler">  <b class="spoiler_title">provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> provider = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...definitions</span></span></span><span class="hljs-function">) =&gt;</span></span> Wrapped =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bindingMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); addBindings(bindingMap, definitions); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Provider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Injector</span></span></span><span class="hljs-class"> </span></span>{ _parent = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context; _bindingMap = bindingMap; _instanceMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;InjectorContext.Provider value={this}&gt; &lt;Wrapped {...this.props} /&gt; &lt;/InjectorContext.Provider&gt; ); } static contextType = InjectorContext; static register(...definitions) { addBindings(bindingMap, definitions); } }; };</code> </pre> </div></div><br><p>  Au√üerdem eine Reihe von Bindungsfunktionen, die verschiedene Strategien zum Erstellen von Abh√§ngigkeitsinstanzen implementieren. </p><br><div class="spoiler">  <b class="spoiler_title">bindings.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toClass = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">constructor</span></span></span><span class="hljs-function"> =&gt;</span></span> asBinding(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(); if (!instance[INJECTOR]) { instance[INJECTOR] = injector; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toFactory = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">depsOrFactory, factory</span></span></span><span class="hljs-function">) =&gt;</span></span> asBinding( factory ? <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector</span></span></span><span class="hljs-function"> =&gt;</span></span> factory(...depsOrFactory.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function"> =&gt;</span></span> getInstance(injector, type))) : depsOrFactory ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toExisting = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function"> =&gt;</span></span> asBinding(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector</span></span></span><span class="hljs-function"> =&gt;</span></span> getInstance(injector, type)); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toValue = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> asBinding(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> value); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IS_BINDING = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span> === <span class="hljs-string"><span class="hljs-string">"function"</span></span> ? <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>() : <span class="hljs-string"><span class="hljs-string">"__binding__"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asBinding</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">binding</span></span></span><span class="hljs-function">) </span></span>{ binding[IS_BINDING] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> binding; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addBindings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bindingMap, definitions</span></span></span><span class="hljs-function">) </span></span>{ definitions.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">definition</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> token, binding; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.isArray(definition)) { [token, binding = token] = definition; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { token = binding = definition; } bindingMap.set(token, binding[IS_BINDING] ? binding : toClass(binding)); }); }</code> </pre> </div></div><br><p>  Jetzt k√∂nnen wir Abh√§ngigkeitsbindungen auf der Ebene einer beliebigen Komponente in Form einer Menge von Paaren <strong><code>[&lt;&gt;, &lt;&gt;]</code></strong> registrieren. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, toClass, toValue, toFactory, toExisting } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; @provider( <span class="hljs-comment"><span class="hljs-comment">//    [FirstService, toClass(FirstServiceImpl)], //     [SecondService, toValue(new SecondServiceImpl())], //    [ThirdService, toFactory( [FirstService, SecondService], (first, second) =&gt; ThirdServiceFactory.create(first, second) )], //      [FourthService, toExisting(FirstService)] ) class MyComponent extends React.Component { // ... }</span></span></code> </pre> <br><p>  Oder in Kurzform f√ºr Klassen: </p><br><pre> <code class="javascript hljs">@provider( <span class="hljs-comment"><span class="hljs-comment">// [FirstService, toClass(FirstService)] FirstService, // [SecondService, toClass(SecondServiceImpl)] [SecondService, SecondServiceImpl] ) class MyComponent extends React.Component { // ... }</span></span></code> </pre> <br><p>  Da die Lebensdauer eines Dienstes von der Anbieterkomponente bestimmt wird, in der er registriert ist, k√∂nnen wir f√ºr jeden Dienst eine Reinigungsmethode <strong><code>.dispose()</code></strong> definieren.  Darin k√∂nnen wir einige Ereignisse abbestellen, Sockets schlie√üen usw.  Wenn Sie den Anbieter aus dem DOM entfernen, ruft er <strong><code>.dispose()</code></strong> f√ºr alle von ihm erstellten Dienste auf. </p><br><div class="spoiler">  <b class="spoiler_title">provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> provider = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...definitions</span></span></span><span class="hljs-function">) =&gt;</span></span> Wrapped =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... return class Provider extends Injector { // ... componentWillUnmount() { this._instanceMap.forEach(instance =&gt; { if (isObject(instance) &amp;&amp; isFunction(instance.dispose)) { instance.dispose(); } }); } // ... }; };</span></span></code> </pre> </div></div><br><p>  Um den Code und das verz√∂gerte Laden zu trennen, m√ºssen wir m√∂glicherweise die Methode zum Registrieren von Diensten bei Anbietern umkehren.  Der Dekorateur <strong><code>@registerIn()</code></strong> hilft uns dabei. </p><br><div class="spoiler">  <b class="spoiler_title">provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> registrationQueue = []; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> registerIn = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getProvider, binding</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span> =&gt; { registrationQueue.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { getProvider().register(binding ? [<span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>, binding] : <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>); }); return <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>; };</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Injektor.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector, type</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (registrationQueue.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { registrationQueue.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">registration</span></span></span><span class="hljs-function"> =&gt;</span></span> { registration(); }); registrationQueue.length = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (injector) { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> </div></div><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { registerIn } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { HomePage } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../components/HomePage"</span></span>; @registerIn(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> HomePage) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyLazyLoadedService</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br><img src="https://habrastorage.org/webt/gu/w5/d-/guw5d-sj0h53wnapsftgqeqnvvg.png"><br><p>  F√ºr 150 Zeilen und 1 KB Code k√∂nnen Sie also einen fast vollst√§ndigen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hierarchischen DI-Container</a> implementieren. </p><br><h2 id="arhitektura-prilozheniya">  Anwendungsarchitektur </h2><br><p>  Kommen wir zum Schluss zur Hauptsache - wie man die Anwendungsarchitektur organisiert.  Abh√§ngig von der Gr√∂√üe der Anwendung, der Komplexit√§t des Themenbereichs und unserer Faulheit gibt es drei m√∂gliche Optionen. </p><br><h3 id="1-the-ugly">  1. Der H√§ssliche </h3><br><p>  Wir haben ein virtuelles DOM, was bedeutet, dass es schnell sein sollte.  Zumindest mit dieser Sauce wurde React zu Beginn einer Karriere serviert.  <strong><code>@observer</code></strong> daher nur an den Link zur <strong><code>@observer</code></strong> (z. B. mithilfe des <strong><code>@observer</code></strong> Dekorators).  Und wir werden <strong><code>.forceUpdate()</code></strong> nach jeder Aktion aufrufen, die sich auf gemeinsam genutzte Dienste auswirkt (z. B. mithilfe des <strong><code>@action</code></strong> Dekorators). </p><br><div class="spoiler">  <b class="spoiler_title">Observer.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">observer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Wrapped</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ componentDidMount() { observerRef = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } componentWillUnmount() { observerRef = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Wrapped</span></span></span></span><span class="xml"><span class="hljs-tag"> {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...this.props</span></span></span></span><span class="xml"><span class="hljs-tag">} /&gt;</span></span></span><span class="xml">; } } } let observerRef = null;</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">action.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_target, _key, descriptor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> method = descriptor.value; descriptor.value = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result; runningCount++; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = method.apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { runningCount--; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (runningCount === <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; observerRef) { observerRef.forceUpdate(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> runningCount = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> </div></div><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserService</span></span></span><span class="hljs-class"> </span></span>{ @action doSomething() {} } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject userService: UserService; } @provider(UserService) @observer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br><p>  Es wird sogar funktionieren.  Aber ... du selbst verstehst :-) </p><br><h3 id="2-the-bad">  2. Das B√∂se </h3><br><p>  Wir geben uns nicht damit zufrieden, alles f√ºr jedes Niesen zu rendern.  Aber wir wollen immer noch verwenden <del>  fast </del>  regul√§re Objekte und Arrays zum Speichern des Status.  Nehmen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MobX</a> ! </p><br><p>  Wir starten mehrere Datenspeicher mit Standardaktionen: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable, action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserStore</span></span></span><span class="hljs-class"> </span></span>{ byId = observable.map&lt;number, User&gt;(); @action add(user: User) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.byId.set(user.id, user); } <span class="hljs-comment"><span class="hljs-comment">// ... } export class PostStore { // ... }</span></span></code> </pre> <br><p>  Wir bringen Gesch√§ftslogik, E / A usw. in die Serviceschicht: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountService</span></span></span><span class="hljs-class"> </span></span>{ @inject userStore userStore; @action updateUserInfo(userInfo: Partial&lt;User&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userStore.byId.get(userInfo.id); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(user, userInfo); } }</code> </pre> <br><p>  Und wir verteilen sie in Komponenten: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; @provider(UserStore, PostStore) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{} @provider(AccountService) @observer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountPage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span></span>{} @observer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject accountService: AccountService; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Gleiches gilt f√ºr Funktionskomponenten und ohne Dekorateure</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountService</span></span></span><span class="hljs-class"> </span></span>{ userStore = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, UserStore); updateUserInfo = action(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userInfo: Partial&lt;User&gt;</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userStore.byId.get(userInfo.id); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(user, userInfo); }); }</code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-react-lite"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, useInstance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = provider(UserStore, PostStore)(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... }); const AccountPage = provider(AccountService)(observer(props =&gt; { // ... })); const UserFrom = observer(props =&gt; { const accountService = useInstance(AccountService); // ... });</span></span></code> </pre> </div></div><br><p>  Das Ergebnis ist eine klassische dreistufige Architektur. </p><br><h3 id="3-the-good">  3. Das Gute </h3><br><p>  Manchmal wird der Themenbereich so komplex, dass es bereits unpraktisch ist, mit einfachen Objekten (oder einem an√§mischen Modell in Bezug auf DDD) damit zu arbeiten.  Dies macht sich insbesondere dann bemerkbar, wenn die Daten eine relationale Struktur mit vielen Beziehungen haben.  In solchen F√§llen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hilft</a> die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MobX State Tree-</a> Bibliothek, sodass Sie die Prinzipien des dom√§nengesteuerten Designs in der Architektur der Front-End-Anwendung anwenden k√∂nnen. </p><br><p>  Das Entwerfen eines Modells beginnt mit einer Beschreibung der Typen: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// models/Post.ts import { types as t, Instance } from "mobx-state-tree"; export const Post = t .model("Post", { id: t.identifier, title: t.string, body: t.string, date: t.Date, rating: t.number, author: t.reference(User), comments: t.array(t.reference(Comment)) }) .actions(self =&gt; ({ voteUp() { self.rating++; }, voteDown() { self.rating--; }, addComment(comment: Comment) { self.comments.push(comment); } })); export type Post = Instance&lt;typeof Post&gt;;</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Modelle / User.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { types <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t, Instance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> User = t.model(<span class="hljs-string"><span class="hljs-string">"User"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: t.identifier, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: t.string }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> type User = Instance&lt;<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> User&gt;;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Modelle / Comment.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { types <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t, Instance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { User } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./User"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Comment = t .model(<span class="hljs-string"><span class="hljs-string">"Comment"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: t.identifier, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: t.string, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: t.Date, <span class="hljs-attr"><span class="hljs-attr">rating</span></span>: t.number, <span class="hljs-attr"><span class="hljs-attr">author</span></span>: t.reference(User) }) .actions(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ voteUp() { self.rating++; }, voteDown() { self.rating--; } })); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> type Comment = Instance&lt;<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> Comment&gt;;</code> </pre> </div></div><br><p>  Und die Art des Datenspeichers: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// models/index.ts import { types as t } from "mobx-state-tree"; export { User, Post, Comment }; export default t.model({ users: t.map(User), posts: t.map(Post), comments: t.map(Comment) });</span></span></code> </pre> <br><p>  Entit√§tstypen enthalten den Status des Dom√§nenmodells und grundlegende Operationen damit.  Komplexere Szenarien, einschlie√ülich E / A, werden in der Serviceschicht implementiert. </p><br><div class="spoiler">  <b class="spoiler_title">services / DataContext.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Instance, unprotect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataContext</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> create() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> models = Models.create(); unprotect(models); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> models; } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface DataContext extends Instance&lt;<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> Models&gt; {}</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">services / AuthService.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { User } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthService</span></span></span><span class="hljs-class"> </span></span>{ @observable currentUser: User; }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">services / PostService.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Post } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostService</span></span></span><span class="hljs-class"> </span></span>{ @inject dataContext: DataContext; @inject authService: AuthService; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> publishPost(postInfo: Partial&lt;Post&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(<span class="hljs-string"><span class="hljs-string">"/posts"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(postInfo) }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { id } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.json(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.savePost(id, postInfo); } @action savePost(id: string, <span class="hljs-attr"><span class="hljs-attr">postInfo</span></span>: Partial&lt;Post&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> post = Post.create({ id, <span class="hljs-attr"><span class="hljs-attr">rating</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(), <span class="hljs-attr"><span class="hljs-attr">author</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.authService.currentUser.id, <span class="hljs-attr"><span class="hljs-attr">comments</span></span>: [], ...postInfo }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataContext.posts.put(post); } }</code> </pre> </div></div><br><p>  Das Hauptmerkmal von MobX State Tree ist die effiziente Arbeit mit Datenschnappsch√ºssen.  Mit der Funktion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code><strong>getSnapshot()</strong></code></a> k√∂nnen wir jederzeit den serialisierten Status einer Entit√§t, Sammlung oder sogar des gesamten Status der Anwendung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code><strong>getSnapshot()</strong></code></a> .  Auf die gleiche Weise k√∂nnen wir mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code><strong>applySnapshot()</strong></code></a> einen Snapshot auf jeden Teil des Modells <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code><strong>applySnapshot()</strong></code></a> .  Auf diese Weise k√∂nnen wir den Status vom Server in mehreren Codezeilen initialisieren, aus LocalStorage laden oder sogar √ºber Redux DevTools mit ihm interagieren. </p><br><p>  Da wir ein normalisiertes relationales Modell verwenden, ben√∂tigen wir die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">normalizr-</a> Bibliothek, um Daten zu laden.  Sie k√∂nnen Baum-JSON gem√§√ü dem Datenschema in flache Tabellen von Objekten √ºbersetzen, die nach <strong><code>id</code></strong> gruppiert sind.  Nur in dem Format, in dem MobX State Tree als Snapshot ben√∂tigt wird. </p><br><p>  Definieren Sie dazu die Schemata der vom Server heruntergeladenen Objekte: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { schema } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"normalizr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UserSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">"users"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CommentSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">"comments"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">author</span></span>: UserSchema }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PostSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">"posts"</span></span>, { <span class="hljs-comment"><span class="hljs-comment">//   - //      author: UserSchema, comments: [CommentSchema] }); export { UserSchema, PostSchema, CommentSchema };</span></span></code> </pre> <br><p>  Und laden Sie die Daten in den Speicher: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { normalize } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"normalizr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { applySnapshot } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostService</span></span></span><span class="hljs-class"> </span></span>{ @inject dataContext: DataContext; <span class="hljs-comment"><span class="hljs-comment">// ... async loadPosts() { const response = await fetch("/posts.json"); const posts = await response.json(); const { entities } = normalize(posts, [PostSchema]); applySnapshot(this.dataContext, entities); } // ... }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">posts.json</b> <div class="spoiler_text"><pre> <code class="json hljs">[ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"    React"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"  -     React..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-10T18:18:58.512Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"John Doe"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"comments"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>, <span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hmmm..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-10T18:18:58.512Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"John Doe"</span></span> } }] }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">234</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lorem ipsum"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lorem ipsum dolor sit amet..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-10T18:18:58.512Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Marcus Tullius Cicero"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"comments"</span></span>: [] } ]</code> </pre> </div></div><br><p>  Registrieren Sie abschlie√üend die Dienste in den entsprechenden Komponenten: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; @provider(AuthService, PostService, [ DataContext, toFactory(DataContext.create) ]) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject postService: PostService; componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postService.loadPosts(); } }</code> </pre> <br><p>  Es stellt sich heraus, dass es sich um dieselbe dreischichtige Architektur handelt, jedoch mit der F√§higkeit, die Status- und Laufzeit√ºberpr√ºfung von Datentypen beizubehalten (im DEV-Modus).  Mit letzterem k√∂nnen Sie sicher sein, dass der Status des Data Warehouse der Spezifikation entspricht, wenn keine Ausnahme auftritt. </p><br><img src="https://habrastorage.org/webt/po/3u/vi/po3uvia2jujcg9q7w1ptr8kvwzk.png"><br><p><br></p><br><hr><br><p>  F√ºr Interessierte ein Link zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> und eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Demo</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431942/">https://habr.com/ru/post/de431942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431932/index.html">Fort Byte Car (und mehr) Indianer</a></li>
<li><a href="../de431934/index.html">Wie hilft k√ºnstliche Intelligenz bei der Arbeit mit juristischen Dokumenten? Vortrag von Egor Budnikov von ABBYY</a></li>
<li><a href="../de431936/index.html">Ergebnisse des TechnoText-Wettbewerbs</a></li>
<li><a href="../de431938/index.html">Ganzzahlige Kubikwurzel in Verilog</a></li>
<li><a href="../de431940/index.html">Menschen brennen aus, wenn sie sich nicht wert f√ºhlen. Was tun?</a></li>
<li><a href="../de431944/index.html">Yealink Meeting Server 2.0 - Neue Videokonferenzfunktionen</a></li>
<li><a href="../de431946/index.html">Sicherheitswoche 49: Hacken von Dell und Marriott</a></li>
<li><a href="../de431948/index.html">Deep Mind lehrte seine KI, die Proteinstruktur vorherzusagen</a></li>
<li><a href="../de431950/index.html">So prognostizieren Sie die Nachfrage und automatisieren Eink√§ufe mithilfe von maschinellem Lernen: Ozon-Fall</a></li>
<li><a href="../de431954/index.html">Der ehemalige Vizepr√§sident von Sun und DEC wird Pr√§sident von MIPS / Wave und spricht √ºber Russland und RISC / V.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>