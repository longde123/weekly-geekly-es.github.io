<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèø üïí üëÜüèª C√≥mo implementar un lenguaje de programaci√≥n en JavaScript. Parte 1: analizador üëäüèª üíª üë©üèª‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Le presento una traducci√≥n amateur de una gu√≠a para implementar su lenguaje de programaci√≥n JavaScript: PL Tutorial . 
 Del traductor 


 Crearem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo implementar un lenguaje de programaci√≥n en JavaScript. Parte 1: analizador</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443630/"><p>  Hola  Le presento una traducci√≥n amateur de una gu√≠a para implementar su lenguaje de programaci√≥n JavaScript: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PL Tutorial</a> . </p><br><h1 id="ot-perevodchika">  Del traductor </h1><br><p>  Crearemos nuestro propio lenguaje de programaci√≥n - <strong>lenguaje Œª</strong> (en el idioma original - Œª).  En el proceso de creaci√≥n, utilizaremos muchas t√©cnicas interesantes, como el descenso recursivo, el estilo de transferencia de control y las t√©cnicas b√°sicas de optimizaci√≥n.  Se crear√°n dos versiones del int√©rprete: los int√©rpretes regulares y los de CPS, el transcompilador en JavaScript. </p><br><p>  El autor del original es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mihai Bazon</a> , autor de la famosa biblioteca UglifyJS (una herramienta para minimizar y formatear el c√≥digo JS). </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Contenido</b> <div class="spoiler_text"><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo implementar un lenguaje de programaci√≥n en JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1: analizador</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo implementar un lenguaje de programaci√≥n en JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2: Int√©rprete</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo implementar un lenguaje de programaci√≥n en JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3: int√©rprete de CPS</a> </li><li>  C√≥mo implementar un lenguaje de programaci√≥n en JavaScript.  Parte 4: Trans Compilaci√≥n en JS </li></ol></div></div><br><h1 id="vstuplenie">  Entrada </h1><br><p> Si alguna vez ha escrito su compilador o int√©rprete, entonces no habr√° nada nuevo para usted.  Pero si usa expresiones regulares para <a href="">analizar</a> algo que se parece a un lenguaje de programaci√≥n, lea la secci√≥n sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">an√°lisis</a> .  ¬°Escribamos c√≥digo con menos errores! </p><br><p>  El art√≠culo est√° dividido en partes en el orden "de simple a complejo".  No recomiendo que omita partes del art√≠culo, a menos que comprenda bien el tema.  Siempre puedes regresar si no entiendes algo. </p><br><p>  ¬øQu√© vamos a aprender? </p><br><ul><li>  Qu√© es un analizador sint√°ctico y c√≥mo escribirlo. </li><li>  C√≥mo escribir un int√©rprete. </li><li>  La secuela de la transferencia y por qu√© es importante. </li><li>  Escribir un compilador (trans). </li><li>  Estilo de transferencia de continuaci√≥n. </li><li>  Algunas t√©cnicas b√°sicas de optimizaci√≥n de c√≥digo. </li><li>  Ejemplos de novedades en nuestro lenguaje Œª en comparaci√≥n con JavaScript. </li></ul><br><p>  Junto con esto, mostrar√© por qu√© Lisp es un gran lenguaje de programaci√≥n.  <strong>Sin embargo, el lenguaje en el que estamos trabajando no es Lisp.</strong>  Tiene una sintaxis m√°s rica (una notaci√≥n infija cl√°sica que todos conocen), algo as√≠ como Scheme (excepto las macros).  Bueno o no, pero las macros son la caracter√≠stica principal de Lisp, algo que otros lenguajes (excepto los dialectos de Lisp) no pueden hacer tan bien como lo hacen.  (S√≠, s√© sobre SweetJS ... cerca, pero no eso). </p><br><p>  Pero primero, presentemos nuestro lenguaje de programaci√≥n. </p><br><a name="Language"></a><br><h1 id="zyk">  idioma Œª </h1><br><p>  Antes de hacer algo, debemos tener una idea clara de lo que queremos hacer.  Ser√≠a bueno escribir una descripci√≥n de la gram√°tica del lenguaje, pero lo har√© m√°s f√°cil: escriba un ejemplo de un programa simple, as√≠ que aqu√≠ hay algunos ejemplos del lenguaje Œª: </p><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   println("Hello World!"); println(2 + 3 * 4); #       `lambda`  `Œª` fib = lambda (n) if n &lt; 2 then n else fib(n - 1) + fib(n - 2); println(fib(15)); print-range = Œª(a, b) # `Œª`     ,   `lambda` if a &lt;= b then { # `then`  ,      print(a); if a + 1 &lt;= b { print(", "); print-range(a + 1, b); } else println(""); #   }; print-range(1, 5);</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Nota sobre nombres de variables</b> <div class="spoiler_text"><p>  Tenga en cuenta que los identificadores pueden contener un signo menos ( <code>print-range</code> ).  Esto es cuesti√≥n de gustos.  Siempre pongo espacios alrededor de los operadores.  Realmente no me gusta el camelRegister y el tablero mejor que el espacio invisible ("_").  Qu√© bueno que puedes hacer lo que quieras cuando haces algo t√∫ mismo. </p></div></div><br><p>  Conclusi√≥n </p><br><pre> <code class="plaintext hljs">Hello World! 14 610 1, 2, 3, 4, 5</code> </pre> <br><p>  El lenguaje se parece a JavaScript, pero en general no lo es.  En primer lugar, no hay declaraciones, solo expresiones.  Una expresi√≥n debe devolver un valor y puede usarse en cualquier lugar de otra expresi√≥n.  Se necesitan punto y coma para separar las expresiones en una "secuencia" de expresiones.  Las llaves <code>{</code> y <code>}</code> crean una secuencia que es en s√≠ misma una expresi√≥n, y su valor es el √∫ltimo valor de la secuencia.  El siguiente programa es correcto: </p><br><pre> <code class="python hljs">a = { fib(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">#    ,      fib(15) #        }; print(a); #  610</span></span></code> </pre> <br><p>  Las funciones se crean usando las palabras clave <code>lambda</code> o <code>Œª</code> .  Despu√©s de eso, entre par√©ntesis hay una lista (posiblemente vac√≠a) de nombres de argumentos, separados por comas.  El cuerpo de una funci√≥n es una expresi√≥n, pero se puede encerrar en una secuencia <code>{...}</code> .  Tambi√©n vale la pena se√±alar que no hay una palabra clave de <code>return</code> .  La funci√≥n devuelve el valor de la √∫ltima expresi√≥n. </p><br><p>  Adem√°s, no <code>var</code> .  Para agregar una variable, puede usar lo que los programadores de JavaScript llaman <code>IIFE</code> .  Use <code>lambda</code> , declare variables como argumentos.  Para las variables, el alcance es una funci√≥n, y las funciones son cierres, como en JavaScript [aprox.  traducci√≥n: hasta ES6.]. </p><br><p>  Incluso <code>if</code> es una expresi√≥n.  JavaScript utiliza el operador ternario para hacer esto: </p><br><pre> <code class="python hljs">a = foo() ? bar() : baz(); // JavaScript a = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> foo() then bar() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> baz(); <span class="hljs-comment"><span class="hljs-comment"># Œª</span></span></code> </pre> <br><p>  La palabra clave <code>then</code> es opcional si la rama es una secuencia ( <code>{...}</code> ), como puede ver arriba.  En otro caso, es necesario.  <code>else</code> usa si hay una rama alternativa presente.  Y nuevamente, <code>then</code> y de lo <code>else</code> tome la expresi√≥n como el cuerpo, pero puede combinar varias expresiones en una usando <code>{...}</code> .  Si <code>else</code> y la condici√≥n es <code>false</code> , entonces el resultado de todo <code>if</code> es <code>false</code> .  Vale la pena se√±alar que <code>false</code> es una palabra clave que representa un valor que es el √∫nico valor falso en un idioma Œª: </p><br><pre> <code class="plaintext hljs">if foo() then print("OK");</code> </pre> <br><p>  generar√° <code>OK</code> si y solo si el resultado de <code>foo()</code> <strong>no</strong> <code>foo()</code> <code>false</code> .  Adem√°s, existe la palabra clave <code>true</code> , pero absolutamente todo lo que no sea <code>false</code> (en JavaScript, el operador <code>===</code> ) se considerar√° <code>true</code> en las ramas (incluido el n√∫mero <code>0</code> y la cadena vac√≠a <code>""</code> ). </p><br><p>  Tenga en cuenta que no hay necesidad de par√©ntesis alrededor de la expresi√≥n en <code>if</code> .  Si los agrega, no ser√° un error, porque <code>(</code> comienza la expresi√≥n, pero son superfluos. </p><br><p>  El programa completo se puede analizar incluso si est√° rodeado de par√©ntesis, por lo que debe agregar <code>;</code>  despu√©s de cada expresi√≥n  La √∫ltima expresi√≥n es una excepci√≥n. </p><br><p>  Genial, este es nuestro peque√±o lenguaje Œª.  El no es perfecto.  La sintaxis se ve hermosa, pero tiene fallas.  Faltan muchas caracter√≠sticas, como objetos y matrices.  No les prestamos atenci√≥n, ya que no son b√°sicos para nuestro lenguaje de programaci√≥n. </p><br><p>  A continuaci√≥n, escribiremos un analizador para nuestro idioma. </p><br><a name="Parsing"></a><br><h1 id="prevraschenie-koda-v-ast">  Conversi√≥n de c√≥digo a AST </h1><br><p>  Crear un analizador es una tarea dif√≠cil.  En esencia, debe tomar un fragmento de c√≥digo y convertirlo en un AST (√°rbol de sintaxis abstracta).  AST es una representaci√≥n estructurada de un programa en memoria, abstracta porque no contiene informaci√≥n completa sobre el c√≥digo, solo sem√°ntica.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Descripci√≥n AST</a> est√° en una parte separada. </p><br><p>  Por ejemplo, tenemos el siguiente c√≥digo: </p><br><pre> <code class="python hljs">sum = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>(a, b) { a + b; }; print(sum(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>));</code> </pre> <br><p>  Nuestro analizador generar√° un √°rbol como un objeto JavaScript: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">//  : { type: "assign", operator: "=", left: { type: "var", value: "sum" }, right: { type: "lambda", vars: [ "a", "b" ], body: { //     "prog",  ,  //     ,  //     . type: "binary", operator: "+", left: { type: "var", value: "a" }, right: { type: "var", value: "b" } } } }, //  : { type: "call", func: { type: "var", value: "print" }, args: [{ type: "call", func: { type: "var", value: "sum" }, args: [ { type: "num", value: 1 }, { type: "num", value: 2 } ] }] } ] }</span></span></code> </pre> <br><p>  La principal dificultad para crear un analizador es la dificultad de organizar correctamente el c√≥digo.  El analizador deber√≠a funcionar a un nivel m√°s alto que leer caracteres de una cadena.  Algunas pautas para reducir la complejidad del c√≥digo: </p><br><ul><li>  Escribe muchas caracter√≠sticas peque√±as.  En cada funci√≥n, haz una cosa y hazlo bien. </li><li>  No intente utilizar expresiones regulares para analizar.  Simplemente no funcionan.  Pueden ser √∫tiles en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">analizador l√©xico</a> , pero, por simplicidad, no los utilizaremos. </li><li>  No trates de adivinar.  Cuando no est√© seguro de c√≥mo analizar algo, inicie una excepci√≥n que contenga la ubicaci√≥n del error (fila y columna). </li></ul><br><p>  Para mantener el c√≥digo m√°s simple, lo dividiremos en tres partes, que a su vez se dividen en muchas funciones peque√±as: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Secuencia de personajes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Flujo de tokens (tokens)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Analizador</a> </li></ul><br><a name="InputStream"></a><br><h1 id="potok-simvolov">  Secuencia de personajes </h1><br><p>  Esta es la parte m√°s f√°cil.  Crearemos un objeto continuo que representar√° las operaciones de lectura secuencial de caracteres de una cadena.  Contiene cuatro funciones: </p><br><ul><li>  <code>peek()</code> : devuelve el siguiente car√°cter sin extraerlo de la secuencia. </li><li>  <code>next()</code> : devuelve el siguiente car√°cter, extray√©ndolo de la secuencia. </li><li>  <code>eof()</code> : devuelve <code>true</code> si no hay m√°s caracteres en la secuencia. </li><li>  <code>croak(msg)</code> : arroja una excepci√≥n que contiene el mensaje ( <code>msg</code> ) y la posici√≥n actual en la secuencia. </li></ul><br><p>  La √∫ltima funci√≥n es necesaria para que pueda simplemente lanzar una excepci√≥n que contenga la ubicaci√≥n del error. </p><br><p>  Aqu√≠ est√° el c√≥digo completo para este objeto (llam√©moslo <code>InputStream</code> ).  Es lo suficientemente peque√±o como para que no tenga problemas con √©l: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pos = <span class="hljs-number"><span class="hljs-number">0</span></span>, line = <span class="hljs-number"><span class="hljs-number">1</span></span>, col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">next</span></span> : next, <span class="hljs-attr"><span class="hljs-attr">peek</span></span> : peek, <span class="hljs-attr"><span class="hljs-attr">eof</span></span> : eof, <span class="hljs-attr"><span class="hljs-attr">croak</span></span> : croak, }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.charAt(pos++); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) line++, col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> col++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">peek</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> input.charAt(pos); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> peek() == <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">croak</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(msg + <span class="hljs-string"><span class="hljs-string">" ("</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + col + <span class="hljs-string"><span class="hljs-string">")"</span></span>); } }</code> </pre> <br><p>  Tenga en cuenta que este no es un objeto ordinario (que se crea a trav√©s de <code>new</code> ).  Para obtener este objeto, necesita: <code>var stream = InputStream(string)</code> . </p><br><p>  A continuaci√≥n, escribiremos el siguiente nivel de abstracci√≥n: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">flujo de tokens (tokens)</a> . </p><br><a name="TokenStream"></a><br><h1 id="potok-tokenov-leksem">  Flujo de tokens (tokens) </h1><br><p>  El tokenizer (lexer) usa una secuencia de caracteres y devuelve un objeto con la misma interfaz, pero los valores de retorno de las funciones <code>peek()</code> / <code>next()</code> ser√°n tokens.  Un token es un tipo con dos propiedades: <code>type</code> , <code>value</code> .  Aqu√≠ hay algunos ejemplos de tokens: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"punc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"("</span></span> } <span class="hljs-comment"><span class="hljs-comment">// . : , ,     . . { type: "num", value: 5 } //  { type: "str", value: "Hello World!" } //  { type: "kw", value: "lambda" } //   { type: "var", value: "a" } //  { type: "op", value: "!=" } // </span></span></code> </pre> <br><p>  Los espacios en blanco (espacio, tabulaci√≥n, saltos de l√≠nea) y los comentarios simplemente se omiten. </p><br><p>  Para escribir un tokenizador, debemos analizar m√°s de cerca nuestro idioma.  La idea es notar que dependiendo del car√°cter actual ( <code>input.peek()</code> ) podemos decidir qu√© token leer: </p><br><ul><li>  Primero, omita los espacios en blanco. </li><li>  Si <code>input.eof()</code> , devuelve <code>null</code> . </li><li>  Si es un car√°cter <code>#</code> , salte todos los caracteres al final de la l√≠nea (y devuelva el siguiente token). </li><li>  Si esto es una comilla, entonces lea la cadena. </li><li>  Si este es un n√∫mero, entonces lea el n√∫mero. </li><li>  Si es una letra, leemos la palabra y devolvemos el identificador o la palabra clave. </li><li>  Si este es uno de los caracteres especiales, devuelve el token correspondiente. </li><li>  Si este es uno de los s√≠mbolos del operador, devuelva el token correspondiente. </li><li>  Si nada de lo anterior aplica, entonces lanza una excepci√≥n usando <code>input.croak()</code> . </li></ul><br><p>  Tendremos la funci√≥n <code>read_next</code> , la funci√≥n principal del tokenizer: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ read_while(is_whitespace); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input.eof()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"#"</span></span>) { skip_comment(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_next(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">'"'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_string(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_digit(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_number(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_id_start(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_ident(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"punc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : input.next() }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_op_char(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"op"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : read_while(is_op_char) }; input.croak(<span class="hljs-string"><span class="hljs-string">"Can't handle character: "</span></span> + ch); }</code> </pre> <br><p>  Aqu√≠ puede ver muchas funciones adicionales que devuelven diferentes tipos de tokens, como <code>read_string()</code> , <code>read_number()</code> , etc. ... Se colocan en funciones separadas, para que el c√≥digo se vea m√°s simple y hermoso. </p><br><p>  Adem√°s, es interesante que no eliminemos todos los s√≠mbolos a la vez: cada vez que el analizador solicite el pr√≥ximo token, leeremos un token.  Si ocurre alg√∫n tipo de error, ni siquiera leeremos todos los caracteres. </p><br><p>  <code>read_ident()</code> leer√° todos los caracteres de una fila que pueden ser parte del identificador ( <code>is_id()</code> ).  El identificador debe comenzar con la letra, <code>Œª</code> o <code>_</code> , y puede contener los mismos caracteres, n√∫meros o cualquiera de: <code>?!-&lt;&gt;=</code> .  De ello se deduce que <code>foo-bar</code> no se leer√° como tres tokens, sino como uno (token <code>var</code> ).  ¬øEs esto necesario para poder definir funciones con nombres como <code>is-pair?</code>  o <code>string&gt;=</code> (lo siento, este es Lisper en m√≠). </p><br><p>  Adem√°s, <code>read_ident()</code> verificar√° si hay un identificador en la lista de palabras clave conocidas, y si est√° all√≠, se devolver√° un <code>kw</code> -token en lugar de un <code>var</code> -token. </p><br><p>  Creo que el c√≥digo habla por s√≠ mismo, as√≠ que aqu√≠ hay un tokenizer listo para nuestro idioma: </p><br><div class="spoiler">  <b class="spoiler_title">C√≥digo completo</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TokenStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keywords = <span class="hljs-string"><span class="hljs-string">" if then else lambda Œª true false "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">next</span></span> : next, <span class="hljs-attr"><span class="hljs-attr">peek</span></span> : peek, <span class="hljs-attr"><span class="hljs-attr">eof</span></span> : eof, <span class="hljs-attr"><span class="hljs-attr">croak</span></span> : input.croak }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_keyword</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keywords.indexOf(<span class="hljs-string"><span class="hljs-string">" "</span></span> + x + <span class="hljs-string"><span class="hljs-string">" "</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_digit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-regexp"><span class="hljs-regexp">/[0-9]/i</span></span>.test(ch); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_id_start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-regexp"><span class="hljs-regexp">/[a-zŒª_]/i</span></span>.test(ch); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_id</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_id_start(ch) || <span class="hljs-string"><span class="hljs-string">"?!-&lt;&gt;=0123456789"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_op_char</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"+-*/%=&amp;|&lt;&gt;!"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_punc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">",;(){}[]"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_whitespace</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">" \t\n"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_while</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">predicate</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> str = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof() &amp;&amp; predicate(input.peek())) str += input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_number</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> has_dot = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> number = read_while(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"."</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (has_dot) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; has_dot = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_digit(ch); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">parseFloat</span></span>(number) }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_ident</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = read_while(is_id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : is_keyword(id) ? <span class="hljs-string"><span class="hljs-string">"kw"</span></span> : <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : id }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_escaped</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">end</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> escaped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, str = <span class="hljs-string"><span class="hljs-string">""</span></span>; input.next(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (escaped) { str += ch; escaped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"\\"</span></span>) { escaped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == end) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { str += ch; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_string</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"str"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: read_escaped(<span class="hljs-string"><span class="hljs-string">'"'</span></span>) }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_comment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ read_while(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch != <span class="hljs-string"><span class="hljs-string">"\n"</span></span> }); input.next(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ read_while(is_whitespace); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input.eof()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"#"</span></span>) { skip_comment(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_next(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">'"'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_string(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_digit(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_number(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_id_start(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_ident(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"punc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : input.next() }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_op_char(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"op"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : read_while(is_op_char) }; input.croak(<span class="hljs-string"><span class="hljs-string">"Can't handle character: "</span></span> + ch); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">peek</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> current || (current = read_next()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = current; current = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok || read_next(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> peek() == <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> </div></div><br><ul><li>  La funci√≥n <code>next()</code> no siempre llama a <code>read_next()</code> , porque puede haber un token que se haya le√≠do antes (usando la funci√≥n <code>peek()</code> ).  Para esto, tenemos una variable <code>current</code> que contiene el token actual. </li><li>  Solo se admiten n√∫meros decimales en notaci√≥n regular (1E5, 0x, etc. no son compatibles).  Pero si quisi√©ramos agregar su soporte, solo cambiar√≠amos <code>read_number()</code> . </li><li>  A diferencia de JavaScript, los √∫nicos caracteres que no se pueden escapar de una cadena son las comillas y la barra invertida.  Las l√≠neas pueden contener saltos de l√≠nea, pesta√±as y cualquier otra cosa.  No interpretamos combinaciones est√°ndar como <code>\n</code> , <code>\t</code> , etc. ... Es muy f√°cil rehacer ( <code>read_string()</code> ). </li></ul><br><p>  Ahora tenemos herramientas poderosas para escribir f√°cilmente un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">analizador</a> , pero primero recomendar√≠a mirar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descripci√≥n de AST</a> . </p><br><a name="AST"></a><br><h1 id="opisanie-ast">  Descripci√≥n AST </h1><br><p>  Como se indic√≥ anteriormente, el analizador crear√° una estructura que muestra la sem√°ntica del programa.  AST consta de nodos.  Cada nodo es un objeto JavaScript normal que tiene una propiedad de <code>type</code> que determina el tipo de nodo, as√≠ como informaci√≥n adicional que depende del tipo. </p><br><table><thead><tr><th>  Tipo </th><th>  Estructura </th></tr></thead><tbody><tr><td>  num </td><td> <code>{ type: "num", value: NUMBER }</code> </td> </tr><tr><td>  str </td><td> <code>{ type: "str", value: STRING }</code> </td> </tr><tr><td>  bool </td><td> <code>{ type: "bool", value: true or false }</code> </td> </tr><tr><td>  var </td><td> <code>{ type: "var", value: NAME }</code> </td> </tr><tr><td>  lambda </td><td> <code>{ type: "lambda", vars: [ NAME... ], body: AST }</code> </td> </tr><tr><td>  llamar </td><td> <code>{ type: "call", func: AST, args: [ AST... ] }</code> </td> </tr><tr><td>  si </td><td> <code>{ type: "if", cond: AST, then: AST, else: AST }</code> </td> </tr><tr><td>  asignar </td><td> <code>{ type: "assign", operator: "=", left: AST, right: AST }</code> </td> </tr><tr><td>  binario </td><td> <code>{ type: "binary", operator: OPERATOR, left: AST, right: AST }</code> </td> </tr><tr><td>  prog </td><td> <code>{ type: "prog", prog: [ AST... ] }</code> </td> </tr><tr><td>  dejar </td><td> <code>{ type: "let", vars: [ VARS... ], body: AST }</code> </td> </tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Ejemplos</b> <div class="spoiler_text"><h5 id="chisla-num">  N√∫meros ( <code>num</code> ): </h5><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">123.5</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">123.5</span></span> }</code> </pre> <br><h5 id="stroki-str">  L√≠neas ( <code>str</code> ): </h5><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"Hello World"</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"str"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> }</code> </pre> <br><h5 id="true-i-false-bool">  <code>true</code> y <code>false</code> ( <code>bool</code> ): </h5><br><pre> <code class="python hljs">true false</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><h5 id="identifikatory-var">  Identificadores ( <code>var</code> ): </h5><br><pre> <code class="python hljs">foo</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }</code> </pre> <br><h5 id="funkcii-lambda">  Funciones ( <code>lambda</code> ): </h5><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> (x) <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">#  Œª (x) 10</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: [ <span class="hljs-string"><span class="hljs-string">"x"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">body</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } }</code> </pre> <br><p>  M√°s adelante agregaremos un <code>name</code> par√°metro opcional para admitir funciones con un nombre, pero la primera versi√≥n del analizador no las admitir√°. </p><br><h5 id="vyzovy-funkciy-call">  Llamadas de funci√≥n ( <code>call</code> ): </h5><br><pre> <code class="python hljs">foo(a, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"call"</span></span>, <span class="hljs-string"><span class="hljs-string">"func"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }, <span class="hljs-string"><span class="hljs-string">"args"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ] }</code> </pre> <br><h5 id="vetvleniya-if">  Ramas ( <code>if</code> ): </h5><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> foo then bar <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> baz</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-string"><span class="hljs-string">"cond"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }, <span class="hljs-string"><span class="hljs-string">"then"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"bar"</span></span> }, <span class="hljs-string"><span class="hljs-string">"else"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"baz"</span></span> } }</code> </pre> <br><h6 id="bez-else">  sin <code>else</code> : </h6><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> foo then bar</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-string"><span class="hljs-string">"cond"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }, <span class="hljs-string"><span class="hljs-string">"then"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"bar"</span></span> } }</code> </pre> <br><h5 id="prisvaivanie-assign">  Asignaci√≥n </h5><br><pre> <code class="python hljs">a = <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"assign"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"="</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } }</code> </pre> <br><h5 id="binarnye-operatory-binary">  Operadores <code>binary</code> ( <code>binary</code> ): </h5><br><pre> <code class="python hljs">x + y * z</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"x"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"y"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"z"</span></span> } } }</code> </pre> <br><h5 id="posledovtelnosti-prog">  Secuencias ( <code>prog</code> ): </h5><br><pre> <code class="python hljs">{ a = <span class="hljs-number"><span class="hljs-number">5</span></span>; b = a * <span class="hljs-number"><span class="hljs-number">2</span></span>; a + b; }</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-string"><span class="hljs-string">"prog"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"assign"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"="</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"assign"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"="</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } } }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } } ] }</code> </pre> <br><h5 id="peremennye-zaklyuchennye-v-bloki-let">  Variables encerradas en bloques ( <code>let</code> ): </h5><br><pre> <code class="python hljs">let (a = <span class="hljs-number"><span class="hljs-number">10</span></span>, b = a * <span class="hljs-number"><span class="hljs-number">10</span></span>) { a + b; }</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"let"</span></span>, <span class="hljs-string"><span class="hljs-string">"vars"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-string"><span class="hljs-string">"def"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-string"><span class="hljs-string">"def"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } } } ], <span class="hljs-string"><span class="hljs-string">"body"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } } }</code> </pre> <br><p>  La primera versi√≥n del analizador no admitir√° este tipo de nodo; lo agregaremos m√°s adelante. </p></div></div><br><a name="Parser"></a><br><h1 id="parser">  Analizador </h1><br><p>  El analizador construir√° el √°rbol descrito anteriormente. </p><br><p>  Gracias al trabajo que hicimos en el tokenizer, el analizador funciona con una secuencia de tokens, en lugar de una secuencia de caracteres.  Todav√≠a hay muchas caracter√≠sticas adicionales aqu√≠ para simplificar la estructura.  Hablaremos de los principales.  Comencemos con una funci√≥n de analizador de alto nivel: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_varname), <span class="hljs-attr"><span class="hljs-attr">body</span></span>: parse_expression() }; }</code> </pre> <br><p>  Esta funci√≥n se llamar√° cuando la palabra clave <code>lambda</code> ya se haya tomado de la secuencia de tokens, por lo que solo tenemos que tomar los nombres de los argumentos.  Pero dado que est√°n entre par√©ntesis y separados por comas, haremos esto usando la funci√≥n <code>delimited</code> , que toma los siguientes argumentos: <code>start</code> , <code>stop</code> , <code>separator</code> , la funci√≥n del <code>parser</code> , que analiza cada elemento por separado.  En este caso, usamos la funci√≥n <code>parse_varname</code> , que arroja un error si nota algo que no parece una variable.  El cuerpo de la funci√≥n es una expresi√≥n, por lo que lo <code>parse_expression</code> con <code>parse_expression</code> . </p><br><p>  La funci√≥n <code>delimited</code> es el nivel inferior: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delimited</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">start, stop, separator, parser</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [], first = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; skip_punc(start); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first) first = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> skip_punc(separator); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      a.push(parser()); } skip_punc(stop); return a; }</span></span></code> </pre> <br><p>  Como puede ver, utiliza a√∫n m√°s funciones: <code>is_punc</code> y <code>skip_punc</code> .  El primero devuelve <code>true</code> si el token actual es el signo de puntuaci√≥n dado (sin extraerlo), mientras que <code>skip_punc</code> verificar√° si el token actual es el car√°cter de puntuaci√≥n dado y lo extraer√° (o lanzar√° una excepci√≥n de lo contrario). </p><br><p>  La funci√≥n que analiza todo el programa parece ser la m√°s simple: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_toplevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prog = []; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { prog.push(parse_expression()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!input.eof()) skip_punc(<span class="hljs-string"><span class="hljs-string">";"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: prog }; }</code> </pre> <br><p>  Como solo tenemos expresiones, simplemente llamamos a <code>parse_expression()</code> y leemos las expresiones hasta que leemos todo.  Usando <code>skip_punc(";")</code> , lo hacemos <code>;</code>  obligatorio despu√©s de cada expresi√≥n. </p><br><p>  Otro ejemplo simple es <code>parse_if()</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_if</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ skip_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cond = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) skip_kw(<span class="hljs-string"><span class="hljs-string">"then"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> then = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ret = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cond</span></span>: cond, <span class="hljs-attr"><span class="hljs-attr">then</span></span>: then }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"else"</span></span>)) { input.next(); ret.else = parse_expression(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre> <br><p>  Ella omite la palabra clave <code>if</code> (lanza una excepci√≥n si el token actual no es la palabra clave <code>if</code> ), lee la condici√≥n usando <code>parse_expression()</code> .  Si el s√≠mbolo <code>{</code> no va m√°s all√°, entonces se requiere la palabra clave (la sintaxis no se ve muy bien sin ella).  Las ramas son solo expresiones, por lo que solo usamos <code>parse_expression()</code> nuevamente para ellas.  La rama <code>else</code> es opcional, por lo que primero verificamos la presencia de la palabra clave antes de analizarla. </p><br><p>  Con muchas funciones peque√±as, podemos simplificar el c√≥digo.  Escribimos el analizador casi como lo har√≠a si us√°ramos un lenguaje de alto nivel espec√≠ficamente para analizar la sintaxis.  Todas estas funciones son "recursivas mutuamente", es decir, tenemos <code>parse_atom()</code> , que, dependiendo del token actual, llama a otras funciones.  Uno de ellos es <code>parse_if()</code> (llamado cuando el token actual es <code>if</code> ) y a su vez llama a <code>parse_expression()</code> .  Pero <code>parse_expression()</code> llama a <code>parse_atom()</code> .  No hay recursi√≥n infinita porque una de las funciones siempre extrae al menos un token. </p><br><p>  Este tipo de m√©todo de an√°lisis se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">M√©todo de descenso recursivo</a> y, de hecho, es el m√°s f√°cil de escribir. </p><br><h3 id="bolee-nizkiy-uroven-parse_atom-i-parse_expression">  Nivel inferior: <code>parse_atom()</code> y <code>parse_expression()</code> </h3><br><p>  La funci√≥n <code>parse_atom()</code> llama a otra funci√≥n, dependiendo del token actual: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_atom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exp = parse_expression(); skip_punc(<span class="hljs-string"><span class="hljs-string">")"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exp; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_prog(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_if(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"true"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"false"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_bool(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"lambda"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"Œª"</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_lambda(); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok.type == <span class="hljs-string"><span class="hljs-string">"var"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"num"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"str"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok; unexpected(); }); }</code> </pre> <br><p>  Cuando ve el par√©ntesis de apertura, la expresi√≥n entre par√©ntesis debe ir, por lo tanto, omitiendo el par√©ntesis, la funci√≥n llama a <code>parse_expression()</code> y espera omitir el par√©ntesis de cierre despu√©s de eso.  Si ve alg√∫n tipo de palabra clave, llama a la funci√≥n correspondiente.  Si ve una constante o identificador, lo devuelve como est√°.  Y si no aparece nada, llama <code>unexpected()</code> , lo que arroja una excepci√≥n. </p><br><p>  Cuando ve <code>{</code> , llama a <code>parse_prog</code> para analizar la secuencia de expresiones.  Adem√°s, <code>parse_prog</code> realiza una optimizaci√≥n simple: si no hay expresiones entre <code>{</code> y <code>}</code> , devuelve <code>false</code> , si solo hay una expresi√≥n, solo la devuelve.  De lo contrario, se devuelve el nodo <code>prog</code> con una matriz de expresiones. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     FALSE   , //     . var FALSE = { type: "bool", value: false }; function parse_prog() { var prog = delimited("{", "}", ";", parse_expression); if (prog.length == 0) return FALSE; if (prog.length == 1) return prog[0]; return { type: "prog", prog: prog }; }</span></span></code> </pre> <br><p>  Y aqu√≠ est√° la funci√≥n <code>parse_expression()</code> .  A diferencia de <code>parse_atom()</code> , analizar√° tantas expresiones como sea posible usando <code>maybe_binary()</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_expression</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_binary(parse_atom(), <span class="hljs-number"><span class="hljs-number">0</span></span>); }); }</code> </pre> <br><h3 id="funkcii-maybe_">  Funciones <code>maybe_*</code> </h3><br><p>  Estas funciones comprueban lo que viene despu√©s de la expresi√≥n y deciden si ajustar la expresi√≥n en su nodo o devolverla como est√°. </p><br><p>  La funci√≥n <code>maybe_call()</code> es muy simple: obtiene una funci√≥n que analiza la expresi√≥n actual, y si encuentra <code>(</code> despu√©s de la expresi√≥n, se envuelve en una <code>call</code> . Observe c√≥mo <code>delimited()</code> es adecuado para analizar una lista de argumentos: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">expr</span></span></span><span class="hljs-function">) </span></span>{ expr = expr(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>) ? parse_call(expr) : expr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"call"</span></span>, <span class="hljs-attr"><span class="hljs-attr">func</span></span>: func, <span class="hljs-attr"><span class="hljs-attr">args</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_expression) }; }</code> </pre> <br><h3 id="prioritet-operatorov">  Prioridad del operador </h3><br><p>  La funci√≥n <code>maybe_binary(left, my_prec)</code> se usa para combinar expresiones como <code>1 + 2 * 3</code> .   , ,    ,     : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PRECEDENCE = { <span class="hljs-string"><span class="hljs-string">"="</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"||"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;&amp;"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"=="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"!="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"/"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"%"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, };</code> </pre> <br><p>   ,  <code>*</code> "",  <code>+</code> , ,  <code>1 + 2 * 3</code>    <code>(1 + (2 * 3))</code>  <code>((1 + 2) * 3)</code> . </p><br><p>   ,      ( <code>read_atom</code> )     <code>maybe_binary()</code> ( ),     ( <code>my_prec</code> ).  <code>maybe_binary</code>  ,   .     ,     ,     . </p><br><p>   ,    ,   ,         <code>binary</code> ,  ,       ,      (*): </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_binary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left, my_prec</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = is_op(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> his_prec = PRECEDENCE[tok.value]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (his_prec &gt; my_prec) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> right = maybe_binary(parse_atom(), his_prec) <span class="hljs-comment"><span class="hljs-comment">// (*); var binary = { type : tok.value == "=" ? "assign" : "binary", operator : tok.value, left : left, right : right }; return maybe_binary(binary, my_prec); } } return left; }</span></span></code> </pre> <br><p>  ,  ,     ,    <code>maybe_binary</code> ,    ( <code>my_prec</code> ),  ,      ,     .  - ,    (,        ),     . </p><br><p> ,   ,  <code>my_prec</code>   0,         <code>binary</code> ( <code>assign</code>   <code>=</code> ). </p><br><p>      ,    . </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FALSE = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PRECEDENCE = { <span class="hljs-string"><span class="hljs-string">"="</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"||"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;&amp;"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"=="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"!="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"/"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"%"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_toplevel(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_punc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok &amp;&amp; tok.type == <span class="hljs-string"><span class="hljs-string">"punc"</span></span> &amp;&amp; (!ch || tok.value == ch) &amp;&amp; tok; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_kw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">kw</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok &amp;&amp; tok.type == <span class="hljs-string"><span class="hljs-string">"kw"</span></span> &amp;&amp; (!kw || tok.value == kw) &amp;&amp; tok; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_op</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">op</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok &amp;&amp; tok.type == <span class="hljs-string"><span class="hljs-string">"op"</span></span> &amp;&amp; (!op || tok.value == op) &amp;&amp; tok; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_punc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(ch)) input.next(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting punctuation: \""</span></span> + ch + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_kw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">kw</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(kw)) input.next(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting keyword: \""</span></span> + kw + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_op</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">op</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_op(op)) input.next(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting operator: \""</span></span> + op + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unexpected</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ input.croak(<span class="hljs-string"><span class="hljs-string">"Unexpected token: "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(input.peek())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_binary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left, my_prec</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = is_op(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> his_prec = PRECEDENCE[tok.value]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (his_prec &gt; my_prec) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_binary({ <span class="hljs-attr"><span class="hljs-attr">type</span></span> : tok.value == <span class="hljs-string"><span class="hljs-string">"="</span></span> ? <span class="hljs-string"><span class="hljs-string">"assign"</span></span> : <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-attr"><span class="hljs-attr">operator</span></span> : tok.value, <span class="hljs-attr"><span class="hljs-attr">left</span></span> : left, <span class="hljs-attr"><span class="hljs-attr">right</span></span> : maybe_binary(parse_atom(), his_prec) }, my_prec); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delimited</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">start, stop, separator, parser</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [], first = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; skip_punc(start); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first) first = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> skip_punc(separator); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; a.push(parser()); } skip_punc(stop); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"call"</span></span>, <span class="hljs-attr"><span class="hljs-attr">func</span></span>: func, <span class="hljs-attr"><span class="hljs-attr">args</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_expression), }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_varname</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name.type != <span class="hljs-string"><span class="hljs-string">"var"</span></span>) input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting variable name"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name.value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_if</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ skip_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cond = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) skip_kw(<span class="hljs-string"><span class="hljs-string">"then"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> then = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ret = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cond</span></span>: cond, <span class="hljs-attr"><span class="hljs-attr">then</span></span>: then, }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"else"</span></span>)) { input.next(); ret.else = parse_expression(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_varname), <span class="hljs-attr"><span class="hljs-attr">body</span></span>: parse_expression() }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_bool</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : input.next().value == <span class="hljs-string"><span class="hljs-string">"true"</span></span> }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">expr</span></span></span><span class="hljs-function">) </span></span>{ expr = expr(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>) ? parse_call(expr) : expr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_atom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exp = parse_expression(); skip_punc(<span class="hljs-string"><span class="hljs-string">")"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exp; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_prog(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_if(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"true"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"false"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_bool(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"lambda"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"Œª"</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_lambda(); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok.type == <span class="hljs-string"><span class="hljs-string">"var"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"num"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"str"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok; unexpected(); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_toplevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prog = []; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { prog.push(parse_expression()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!input.eof()) skip_punc(<span class="hljs-string"><span class="hljs-string">";"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: prog }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_prog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prog = delimited(<span class="hljs-string"><span class="hljs-string">"{"</span></span>, <span class="hljs-string"><span class="hljs-string">"}"</span></span>, <span class="hljs-string"><span class="hljs-string">";"</span></span>, parse_expression); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prog.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prog.length == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prog[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: prog }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_expression</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_binary(parse_atom(), <span class="hljs-number"><span class="hljs-number">0</span></span>); }); } }</code> </pre> </div></div><br><h2 id="blagodarnosti">  </h2><br><p>   Marijn Haverbeke,   parse-js (Common Lisp),    ,   . ,        ,  JS,      . </p><br><p>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">     JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2: Int√©rprete</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/443630/">https://habr.com/ru/post/443630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443618/index.html">Emulador de computadora de los 80 en el navegador</a></li>
<li><a href="../443620/index.html">Nuestro problema con las dependencias.</a></li>
<li><a href="../443624/index.html">Digital Works y VMware: VDI est√° muerto, viva VDI</a></li>
<li><a href="../443626/index.html">Bienvenido a la Top 3D Expo 2019</a></li>
<li><a href="../443628/index.html">Funciones de Bessel en SymPy Symbolic Math Program</a></li>
<li><a href="../443636/index.html">Morse Key y Klopfer</a></li>
<li><a href="../443638/index.html">C√≥mo el FSB censura Protonmail en Rusia</a></li>
<li><a href="../443640/index.html">El agua afila una piedra</a></li>
<li><a href="../443642/index.html">El administrador de la NASA considera que es posible enviar a Ori√≥n en el primer viaje alrededor de la luna en un cohete comercial</a></li>
<li><a href="../443644/index.html">Roll huevos con unidad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>