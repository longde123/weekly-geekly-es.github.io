<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë• üë®üèΩ‚Äç‚öïÔ∏è üìß PVS-Studio geht in die Cloud: Azure DevOps üòÆ üßòüèΩ üéüÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dies ist der zweite Artikel √ºber die Verwendung des statischen Analysators PVS-Studio in Cloud-CI-Systemen. Dieses Mal wird die Azure DevOps-Plattform...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio geht in die Cloud: Azure DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/467359/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b53/5ba/6e6/b535ba6e6cf6250ad0c89d5315918d38.png" alt="Bild 9"></div><br>  Dies ist der zweite Artikel √ºber die Verwendung des statischen Analysators PVS-Studio in Cloud-CI-Systemen. Dieses Mal wird die Azure DevOps-Plattform betrachtet - eine Cloud-CI \ CD-L√∂sung von Microsoft.  Betrachten Sie diesmal ShareX als analysiertes Projekt. <br><a name="habracut"></a><br>  Wir werden drei Komponenten ben√∂tigen.  Der erste ist der statische Analysator PVS-Studio.  Das zweite ist Azure DevOps, in das wir den Analysator integrieren werden.  Das dritte Projekt wird √ºberpr√ºft, um die Funktionen von PVS-Studio bei der Arbeit in der Cloud zu demonstrieren.  Also fangen wir an. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PVS-Studio</a> ist ein statischer Code-Analysator zur Suche nach Fehlern und Sicherheitsm√§ngeln.  F√ºhrt eine Code-Analyse in C, C ++, C # und Java durch. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Azure DevOps</a> .  Die Azure DevOps-Plattform enth√§lt Tools wie Azure Pipeline, Azure Board, Azure Artifacts und andere, um das Erstellen von Software zu beschleunigen und deren Qualit√§t zu verbessern. <br><br>  ShareX ist eine kostenlose Anwendung, mit der Sie jeden Teil des Bildschirms erfassen und aufzeichnen k√∂nnen.  Das Projekt ist in C # geschrieben und eignet sich hervorragend zur Demonstration der Ausf√ºhrung des statischen Analysators.  Der Quellcode f√ºr das Projekt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ist auf GitHub verf√ºgbar</a> . <br><br>  Die Ausgabe des Befehls cloc f√ºr das ShareX-Projekt: <br><div class="scrollable-table"><table><tbody><tr><td>  Sprache <br></td><td>  Dateien <br></td><td>  leer <br></td><td>  Kommentar <br></td><td>  Code <br></td></tr><tr><td>  C # <br></td><td>  696 <br></td><td>  20658 <br></td><td>  24423 <br></td><td>  102565 <br></td></tr><tr><td>  MSBuild-Skript <br></td><td>  11 <br></td><td>  1 <br></td><td>  77 <br></td><td>  5859 <br></td></tr></tbody></table></div>  Mit anderen Worten, das Projekt ist klein, aber v√∂llig ausreichend, um die Arbeit von PVS-Studio in Verbindung mit einer Cloud-Plattform zu demonstrieren. <br><br><h2>  Lass uns einrichten </h2><br>  Um in Azure DevOps zu beginnen, klicken Sie auf den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> und dann auf die Schaltfl√§che "Kostenlos mit GitHub starten". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0dc/3d3/8d0/0dc3d38d0375af0a89db1b7be1b4f284.png" alt="Bild 2"></div><br>  Gew√§hren der Microsoft-Anwendung Zugriff auf die Daten des GitHub-Kontos. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b38/543/12b/b3854312bb046df2c1dd50d2025a0b25.png" alt="Bild 1"></div><br>  Um die Registrierung abzuschlie√üen, muss ein Microsoft-Konto erstellt werden. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f5/7a9/878/8f57a9878354a257a8ca68261b5b472a.png" alt="Bild 12"></div><br>  Erstellen Sie nach der Registrierung ein Projekt: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e69/a61/59a/e69a6159ac5c51089e075c37fc5e2465.png" alt="Bild 5"></div><br>  Als n√§chstes m√ºssen wir zum Abschnitt "Pipelines" - "Builds" gehen und eine neue Build-Pipeline erstellen <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fa/4d2/751/2fa4d27513aaf869962e11b9ea37214b.png" alt="Bild 8"></div><br>  Auf die Frage, wo sich unser Code befindet, werden wir antworten - GitHub. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a80/787/363/a80787363d8b260b9aac0ac64c66aeaf.png" alt="Bild 13"></div><br>  Wir autorisieren die Azure Pipelines-Anwendung und w√§hlen das Repository mit dem Projekt aus, f√ºr das wir den Start des statischen Analysators konfigurieren m√∂chten <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/df6/47e/1c1df647e46b8445c43b9cf39968d7ed.png" alt="Bild 7"></div><br>  W√§hlen Sie im Vorlagenauswahlfenster "Starter-Pipeline". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ac/11d/09f/8ac11d09f180433fe9e14a6279f2a059.png" alt="Bild 17"></div><br>  Wir k√∂nnen eine statische Analyse des Projektcodes auf zwei Arten durchf√ºhren: mithilfe von Microsoft-gehosteten oder selbst gehosteten Agenten. <br><br>  In der ersten Version werden von Microsoft gehostete Agenten verwendet.  Solche Agenten sind normale virtuelle Maschinen, die beim Starten unserer Pipeline gestartet und nach dem Ende der Aufgabe gel√∂scht werden.  Durch die Verwendung solcher Agenten k√∂nnen Sie keine Zeit damit verschwenden, sie zu unterst√ºtzen und zu aktualisieren. Sie unterliegen jedoch einigen Einschr√§nkungen, z. B. der Unm√∂glichkeit, zus√§tzliche Software zu installieren, die zum Erstellen des Projekts verwendet wird. <br><br>  Ersetzen Sie unsere Standardkonfiguration durch die folgende f√ºr die Verwendung von von Microsoft gehosteten Agenten: <br><br><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#    #      master- trigger: - master #         # ,   Docker-, #      Windows Server 1803 pool: vmImage: 'win1803' container: microsoft/dotnet-framework:4.7.2-sdk-windowsservercore-1803 steps: #    - task: PowerShell@2 inputs: targetType: 'inline' script: 'Invoke-WebRequest -Uri https://files.viva64.com/PVS-Studio_setup.exe -OutFile PVS-Studio_setup.exe' - task: CmdLine@2 inputs: workingDirectory: $(System.DefaultWorkingDirectory) script: | #      nuget restore .\ShareX.sln #  ,        md .\PVSTestResults #   PVS-Studio_setup.exe /VERYSILENT /SUPPRESSMSGBOXES /NORESTART /COMPONENTS=Core #        "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" credentials -u $(PVS_USERNAME) -n $(PVS_KEY) #        html. "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" -t .\ShareX.sln -o .\PVSTestResults\ShareX.plog "C:\Program Files (x86)\PVS-Studio\PlogConverter.exe" -t html -o .\PVSTestResults\ .\PVSTestResults\ShareX.plog #    - task: PublishBuildArtifacts@1 inputs: pathToPublish: PVSTestResults artifactName: PVSTestResults</span></span></code> </pre> <br>  <b>Hinweis:</b> Gem√§√ü der <a href="">Dokumentation</a> muss der verwendete Container im Image der virtuellen Maschine zwischengespeichert werden. Zum Zeitpunkt des Schreibens funktioniert dieser Artikel jedoch nicht und der Container wird bei jedem Start der Aufgabe heruntergeladen, was sich negativ auf die Ausf√ºhrungszeit auswirkt. <br><br>  Speichern Sie die Pipeline und erstellen Sie die Variablen, die zum Erstellen der Lizenzdatei verwendet werden.  √ñffnen Sie dazu das Pipeline-Bearbeitungsfenster und klicken Sie in der oberen rechten Ecke auf die Schaltfl√§che ‚ÄûVariablen‚Äú. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be8/bc0/e1c/be8bc0e1c3555c6375eac94465d27b9d.png" alt="Bild 14"></div><br>  F√ºgen Sie zwei Variablen hinzu - <i>PVS_USERNAME</i> und <i>PVS_KEY</i> , die den Benutzernamen bzw. den Lizenzschl√ºssel enthalten.  Vergessen Sie beim Erstellen der Variablen <i>PVS_KEY</i> nicht, das <i>Element</i> "Diesen Wert geheim halten" zu <i>aktivieren</i> , <i>um</i> den Variablenwert mit einem 2048-Bit-RSA-Schl√ºssel zu verschl√ºsseln und die Ausgabe des Variablenwerts an das <i>Taskausf√ºhrungsprotokoll zu</i> unterdr√ºcken. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/1e3/35e/9961e335e18b368820d930f14f01d796.png" alt="Bild 15"></div><br>  Wir speichern die Variablen und starten die Pipeline mit der Schaltfl√§che "Ausf√ºhren". <br><br>  Die zweite Option zum Ausf√ºhren der Analyse ist die Verwendung eines selbst gehosteten Agenten.  Selbst gehostete Agenten sind Agenten, die wir selbst konfigurieren und verwalten.  Solche Agenten bieten mehr M√∂glichkeiten f√ºr die Installation von Software, die f√ºr die Montage und das Testen unseres Softwareprodukts erforderlich ist. <br><br>  Vor der Verwendung solcher Agenten m√ºssen sie gem√§√ü den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen</a> konfiguriert und ein statischer Analysator installiert und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">konfiguriert werden</a> . <br><br>  Um die Aufgabe auf einem selbst gehosteten Agenten zu starten, ersetzen wir die vorgeschlagene Standardkonfiguration durch die folgende: <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#    #    master- trigger: - master #    self-hosted    'MyPool' pool: 'MyPool' steps: - task: CmdLine@2 inputs: workingDirectory: $(System.DefaultWorkingDirectory) script: | #      nuget restore .\ShareX.sln #  ,        md .\PVSTestResults #        html. "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" -t .\ShareX.sln -o .\PVSTestResults\ShareX.plog "C:\Program Files (x86)\PVS-Studio\PlogConverter.exe" -t html -o .\PVSTestResults\ .\PVSTestResults\ShareX.plog #    - task: PublishBuildArtifacts@1 inputs: pathToPublish: PVSTestResults artifactName: PVSTestResults</span></span></code> </pre> <br>  Nach Abschluss der Aufgabe kann das Archiv mit den Analyseberichten auf der Registerkarte "Zusammenfassung" heruntergeladen werden, oder wir k√∂nnen die Erweiterung "E-Mail <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">senden" verwenden</a> , mit der Sie das Senden von E-Mails konfigurieren oder auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Marktplatz</a> nach einem f√ºr uns bequemeren Tool suchen k√∂nnen. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/529/df2/932/529df29320ae9e253462e42fe2bfd596.png" alt="Bild 21"></div><br><h2>  √úber Analyseergebnisse </h2><br>  Schauen wir uns nun einige der Fehler an, die im √ºberpr√ºften Projekt gefunden wurden - ShareX. <br><br>  <b>Redundante Schecks</b> <br><br>  Beginnen wir zum Aufw√§rmen mit einfachen Fehlern im Code, n√§mlich mit redundanten √úberpr√ºfungen: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PbThumbnail_MouseMove</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, MouseEventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... IDataObject dataObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataObject(DataFormats.FileDrop, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { Task.Info.FilePath }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataObject != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Program.MainForm.AllowDrop = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; dragBoxFromMouseDown = Rectangle.Empty; pbThumbnail.DoDragDrop(dataObject, DragDropEffects.Copy | DragDropEffects.Move); Program.MainForm.AllowDrop = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  <b>PVS-Studio-</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Warnung</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022</a> [CWE-571] Der Ausdruck 'dataObject! = Null' ist immer wahr.  TaskThumbnailPanel.cs 415 <br><br>  <i>Achten Sie</i> darauf, die Variable <i>dataObject</i> auf <i>null</i> zu √ºberpr√ºfen.  Wof√ºr ist sie hier?  <i>dataObject</i> kann in diesem Fall einfach nicht <i>null sein</i> , da es mit einem Verweis auf das erstellte Objekt initialisiert wird.  Infolgedessen haben wir eine redundante √úberpr√ºfung.  Ist es kritisch?  Nein.  Sieht pr√§gnant aus?  Nein.  Diese Pr√ºfung wird deutlich besser entfernt, um den Code nicht zu √ºberladen. <br><br>  Werfen wir einen Blick auf einen anderen Code, zu dem Sie √§hnliche Kommentare abgeben k√∂nnen: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Image </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDIBImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MemoryStream ms</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(bmp); .... } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gcHandle != IntPtr.Zero) { GCHandle.FromIntPtr(gcHandle).Free(); } } .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Image </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetImageAlternative</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MemoryStream ms = dataObject.GetData(format) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MemoryStream) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ms != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Image img = GetDIBImage(ms); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (img != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> img; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { DebugHelper.WriteException(e); } } } .... }</code> </pre> <br>  <b>PVS-Studio Warnung</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022</a> [CWE-571] Der Ausdruck 'img! = Null' ist immer wahr.  ClipboardHelpers.cs 289 <br><br>  Die <i>GetImageAlternative-</i> Methode √ºberpr√ºft erneut, ob die Variable <i>img</i> unmittelbar nach dem Erstellen einer neuen Instanz der <i>Bitmap-</i> Klasse nicht <i>null ist</i> .  Der Unterschied zum vorherigen Beispiel besteht darin, dass zum Initialisieren der Variablen <i>img</i> nicht der Konstruktor, sondern die <i>GetDIBImage-</i> Methode verwendet wird.  Der Autor des Codes geht davon aus, dass bei dieser Methode eine Ausnahme auftreten kann, deklariert jedoch nur <i>try</i> und blockiert <i>schlie√ülich</i> , wobei <i>catch</i> weggelassen wird.  Wenn eine Ausnahme auftritt, erh√§lt die aufrufende Methode <i>-</i> <i>GetImageAlternative</i> <i>- daher</i> keinen Verweis auf ein Objekt vom Typ <i>Bitmap,</i> sondern muss die Ausnahme in einem eigenen <i>catch-Block behandeln</i> .  In diesem Fall wird die Variable <i>img</i> nicht initialisiert und der Ausf√ºhrungsthread erreicht nicht einmal die Pr√ºfung <i>img! = Null</i> , sondern f√§llt sofort in den <i>catch-Block</i> .  Daher zeigte der Analysator eine redundante Validierung an. <br><br>  Betrachten Sie das folgende <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Warnbeispiel</a> mit Code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022</a> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btnCopyLink_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lvClipboardFormats.SelectedItems.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { url = lvClipboardFormats.Items[<span class="hljs-number"><span class="hljs-number">0</span></span>].SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lvClipboardFormats.SelectedItems.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { url = lvClipboardFormats.SelectedItems[<span class="hljs-number"><span class="hljs-number">0</span></span>].SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text; } .... }</code> </pre> <br>  <b>PVS-Studio Warnung</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022</a> [CWE-571] Der Ausdruck 'lvClipboardFormats.SelectedItems.Count&gt; 0' ist immer wahr.  AfterUploadForm.cs 155 <br><br>  Schauen wir uns den zweiten bedingten Ausdruck an.  Dort √ºberpr√ºfen wir den Wert der schreibgesch√ºtzten <i>Count-</i> Eigenschaft.  Diese Eigenschaft zeigt die Anzahl der Elemente in einer Instanz der <i>SelectedItems-</i> Auflistung an.  Die Bedingung ist nur erf√ºllt, wenn die <i>Count-</i> Eigenschaft gr√∂√üer als Null ist.  Alles w√§re in Ordnung, aber nur in der externen <i>if-Anweisung ist</i> der <i>Count</i> bereits √ºberpr√ºft.  Eine Instanz der <i>SelectedItems-</i> Auflistung kann nicht die Anzahl der Elemente kleiner als Null haben. Daher nimmt <i>Count</i> einen Wert an, der entweder gleich Null oder gr√∂√üer als Null ist.  Da wir bereits in der ersten <i>if-Anweisung</i> √ºberpr√ºft haben, dass <i>Count</i> Null ist und sich als falsch herausgestellt hat, ist es nicht sinnvoll, eine weitere Pr√ºfung f√ºr den else-Zweig zu schreiben, bei dem <i>Count</i> gr√∂√üer als Null ist. <br><br>  Das letzte Beispiel f√ºr die Fehlernummer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022</a> ist das folgende Codefragment: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawCursorGraphics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Graphics g</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cursorOffsetX = <span class="hljs-number"><span class="hljs-number">10</span></span>, cursorOffsetY = <span class="hljs-number"><span class="hljs-number">10</span></span>, itemGap = <span class="hljs-number"><span class="hljs-number">10</span></span>, itemCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; Size totalSize = Size.Empty; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> magnifierPosition = <span class="hljs-number"><span class="hljs-number">0</span></span>; Bitmap magnifier = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Options.ShowMagnifier) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) totalSize.Height += itemGap; .... } .... }</code> </pre> <br>  <b>PVS-Studio Warnung</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022 Der</a> Ausdruck 'itemCount&gt; 0' ist immer falsch.  RegionCaptureForm.cs 1100. <br><br>  Der Analysator hat festgestellt, dass die Bedingung <i>itemCount&gt; 0</i> immer falsch ist, da eine etwas h√∂here Deklaration durchgef√ºhrt wird und gleichzeitig die Variable <i>itemCount auf</i> Null gesetzt wird.  Bis zur Bedingung wird diese Variable nirgendwo verwendet und √§ndert sich nicht. Daher hat der Analysator die richtige Schlussfolgerung √ºber den bedingten Ausdruck gezogen, dessen Wert immer falsch ist. <br><br>  Schauen wir uns jetzt etwas wirklich Interessantes an. <br><br>  <b>Der beste Weg, um den Fehler zu verstehen, besteht darin, den Fehler zu visualisieren.</b> <br><br>  Es scheint uns, dass an dieser Stelle ein ziemlich interessanter Fehler gefunden wurde: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pixelate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bitmap bmp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pixelSize</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, g = <span class="hljs-number"><span class="hljs-number">0</span></span>, b = <span class="hljs-number"><span class="hljs-number">0</span></span>, a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> weightedCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y2 = y; y2 &lt; yLimit; y2++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x2 = x; x2 &lt; xLimit; x2++) { ColorBgra color = unsafeBitmap.GetPixel(x2, y2); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>; r += color.Red * pixelWeight; g += color.Green * pixelWeight; b += color.Blue * pixelWeight; a += color.Alpha * pixelWeight; weightedCount += pixelWeight; } } .... ColorBgra averageColor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorBgra((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(a / pixelCount)); .... }</code> </pre> <br>  Ich m√∂chte nicht sofort alle Karten aufdecken und zeigen, was unser Analysator hier gefunden hat. Verschieben wir diesen Moment also f√ºr eine kurze Zeit. <br><br>  Anhand des Namens der Methode l√§sst sich leicht erraten, was sie bewirkt: Sie senden ihr ein Bild oder ein Fragment des Bildes als Eingabe und es f√ºhrt seine Pixelierung durch.  Der Methodencode ist ziemlich lang, daher geben wir ihn hier nicht vollst√§ndig an, sondern versuchen einfach, seinen Algorithmus zu erkl√§ren und zu erkl√§ren, welche Art von Fehler PVS-Studio hier gefunden hat. <br><br>  Diese Methode akzeptiert zwei Parameter als Eingabe: ein Objekt vom Typ <i>Bitmap</i> und einen Wert vom Typ <i>int</i> , der die Gr√∂√üe der Pixel angibt.  Der Operationsalgorithmus ist recht einfach: <br><br>  1) Wir zerlegen das Fragment des am Eingang empfangenen Bildes in Quadrate mit einer Seite, die der Gr√∂√üe der Pixelierung entspricht.  Wenn wir beispielsweise eine Pixelgr√∂√üe von 15 haben, erhalten wir ein Quadrat mit 15 x 15 = 225 Pixel. <br><br>  2) Als n√§chstes gehen wir um jedes Pixel in diesem Quadrat herum und akkumulieren die Werte der Felder <i>Rot</i> , <i>Gr√ºn</i> , <i>Blau</i> und <i>Alpha</i> in Zwischenvariablen und multiplizieren zuvor den Wert der entsprechenden Farbe und den Alphakanalwert mit der Variablen <i>pixelWeight</i> , die durch Teilen des <i>Alpha-</i> Werts durch 255 erhalten wird (die <i>Alpha-</i> Variable hat Typ <i>Byte</i> ).  Au√üerdem durchlaufen wir beim Durchlaufen von Pixeln die in <i>pixelWeight</i> aufgezeichneten <i>Werte</i> zu einer Variablen namens <i>weightedCount</i> . <br><br>  Das Code-Snippet, das die obigen Schritte ausf√ºhrt, lautet wie folgt: <br><br><pre> <code class="cs hljs">ColorBgra color = unsafeBitmap.GetPixel(x2, y2); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>; r += color.Red * pixelWeight; g += color.Green * pixelWeight; b += color.Blue * pixelWeight; a += color.Alpha * pixelWeight; weightedCount += pixelWeight;</code> </pre> <br>  Beachten Sie √ºbrigens, dass <i>pixelWeight</i> der Variablen <i>weightedCount</i> f√ºr dieses Pixel keinen Wert hinzuf√ºgt, wenn der Wert der <i>Alpha-</i> Variablen Null ist.  Wir werden das in Zukunft brauchen. <br><br>  3) Nachdem wir alle Pixel im aktuellen Quadrat umgangen haben, k√∂nnen wir die allgemeine ‚Äûdurchschnittliche‚Äú Farbe f√ºr dieses Quadrat ermitteln.  Der Code, der diese Aktionen ausf√ºhrt, lautet wie folgt: <br><br><pre> <code class="cs hljs">ColorBgra averageColor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorBgra((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(a / pixelCount));</code> </pre> <br>  4) <i>Nachdem</i> wir die endg√ºltige Farbe haben und sie in die Variable <i>durchschnittlicher</i> Farbe <i>schreiben</i> , k√∂nnen wir jedes Pixel im Quadrat erneut <i>umgehen</i> und ihm einen Wert aus der <i>durchschnittlichen Farbe zuweisen</i> . <br><br>  5) Wir kehren zu Schritt 2 zur√ºck, solange noch rohe Quadrate vorhanden sind. <br><br>  Wir stellen erneut fest, dass die Variable <i>weightedCount</i> nicht der Anzahl aller quadratischen Pixel entspricht.  Wenn beispielsweise ein absolut transparentes Pixel im Bild auftritt (der Wert im Alphakanal ist Null), ist die Variable <i>pixelWeight</i> f√ºr dieses Pixel Null ( <i>0/255</i> = 0). Daher tr√§gt dieses Pixel nicht zur Bildung des Werts der Variablen <i>weightedCount bei</i> .  Dies ist logisch - es macht keinen Sinn, die Farben eines absolut transparenten Pixels zu ber√ºcksichtigen. <br><br>  Alles scheint ziemlich vern√ºnftig - Pixelierung sollte korrekt funktionieren.  Und es funktioniert wirklich richtig.  Dies gilt nur nicht f√ºr PNG-Bilder mit Pixeln mit Werten im Alphakanal von weniger als 255 und ungleich Null.  Achten Sie auf das pixelige Bild unten: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/460/17b/7b5/46017b7b58a5206d0a51620fcce1a16f.png" alt="Bild 3"></div><br><br>  Hast du Pixelierung gesehen?  Und wir sind nicht.  Nun wollen wir diese kleine Intrige enth√ºllen und erkl√§ren, wo genau der Fehler in dieser Methode versteckt ist.  Der Fehler hat sich in die Zeile zur Berechnung des Werts der <i>pixelWeight-</i> Variablen eingeschlichen: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>;</code> </pre> <br>  Tatsache ist, dass der Autor des Codes, der die Variable <i>pixelWeight als</i> <i>float</i> deklarierte, implizierte, dass beim Teilen des <i>Alpha-</i> Feldes durch 255 zus√§tzlich zu Null und Eins Bruchzahlen erhalten werden sollten.  Hier liegt das Problem, da die <i>Alpha-</i> Variable vom Typ <i>Byte</i> ist und wenn wir sie durch 255 teilen, erhalten wir einen ganzzahligen Wert, und nur dann wird er implizit in <i>float umgewandelt</i> , sodass der Bruchteil verloren geht. <br><br>  Die Unf√§higkeit, PNG-Bilder mit einem gewissen Grad an Transparenz zu pixelisieren, ist leicht zu erkl√§ren.  Da die Alpha-Kanalwerte f√ºr diese Pixel im Bereich 0 &lt;Alpha &lt;255 liegen, erhalten wir beim Teilen der <i>Alpha-</i> Variablen durch 255 immer 0. Daher sind auch die Werte der <i>Variablen pixelWeight</i> , <i>r</i> , <i>g</i> , <i>b</i> , <i>a</i> und <i>weightedCount</i> immer immer wird Null sein.  Infolgedessen hat unsere durchschnittliche <i>Farbdurchschnittsfarbe</i> √ºber alle Kan√§le hinweg Nullwerte: Rot - 0, Blau - 0, Gr√ºn - 0, Alpha - 0. Wenn Sie das Quadrat mit dieser Farbe <i>f√ºllen,</i> √§ndern wir die urspr√ºngliche Farbe der Pixel nicht, da die <i>Durchschnittsfarbe</i> absolut transparent ist .  Um diesen Fehler zu beheben, m√ºssen Sie nur das <i>Alpha-</i> Feld explizit in den <i>Float-</i> Typ <i>umwandeln</i> .  Die korrigierte Codezeile kann folgenderma√üen aussehen: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>;</code> </pre> <br>  Und es ist Zeit, die Nachricht zu zitieren, die PVS-Studio an den falschen Code ausgegeben hat: <br><br>  <b>PVS-Studio Warnung</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3041</a> [CWE-682] Der Ausdruck wurde implizit vom Typ 'int' in den Typ 'float' umgewandelt.  Erw√§gen Sie die Verwendung eines expliziten Typgusses, um den Verlust eines Bruchteils zu vermeiden.  Ein Beispiel: double A = (double) (X) / Y;  ImageHelpers.cs 1119. <br><br>  Zum Vergleich geben wir einen Screenshot eines wirklich pixeligen Bildes, das mit einer festen Version der Anwendung erhalten wurde: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/977/0bc/e73/9770bce73229e72b6781f0349128aa3e.png" alt="Bild 6"></div><br>  <b>M√∂gliche NullReferenceException</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddMetadata</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Image img, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { .... pi.Value = bytesText; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pi != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { img.SetPropertyItem(pi); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3095</a> [CWE-476] Das ' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pi'</a> -Objekt wurde verwendet, bevor es gegen null verifiziert wurde.  √úberpr√ºfen Sie die Zeilen: 801, 803. ImageHelpers.cs 801 <br><br>  Dieses Codefragment zeigt, dass der Autor erwartet hat, dass die Variable <i>pi</i> <i>null</i> ist, weshalb die Pr√ºfung <i>pi! = Null</i> durchgef√ºhrt wird, bevor die <i>SetPropertyItem-</i> Methode <i>aufgerufen</i> wird.  Es ist seltsam, dass vor dieser √úberpr√ºfung der Eigenschaft <i>pi.Value</i> ein Byte-Array zugewiesen wird, da bei <i>pi</i> <i>null</i> eine Ausnahme vom Typ <i>NullReferenceException</i> ausgel√∂st wird. <br><br>  Eine √§hnliche Situation wurde anderswo gesehen: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task_TaskCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WorkerTask task</span></span></span><span class="hljs-function">)</span></span> { .... task.KeepImage = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.RequestSettingUpdate) { Program.MainForm.UpdateCheckStates(); } .... } .... }</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3095</a> [CWE-476] Das Objekt 'task' wurde verwendet, bevor es gegen null verifiziert wurde.  √úberpr√ºfen Sie die Zeilen: 268, 270. TaskManager.cs 268 <br><br>  PVS-Studio hat einen weiteren √§hnlichen Fehler gefunden.  Die Bedeutung ist immer noch dieselbe, daher besteht keine gro√üe Notwendigkeit, ein Codefragment anzugeben. Wir beschr√§nken uns auf die Analysator-Nachricht. <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3095</a> [CWE-476] Das Objekt 'Config.PhotobucketAccountInfo' wurde verwendet, bevor es gegen Null verifiziert wurde.  √úberpr√ºfen Sie die Zeilen: 216, 219. UploadersConfigForm.cs 216 <br><br>  <b>Der gleiche R√ºckgabewert</b> <br><br>  In der <i>EvalWindows-</i> Methode der <i>WindowsList-</i> Klasse wurde ein verd√§chtiger Code entdeckt, der unter keinen Umst√§nden <i>true</i> zur√ºckgibt: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WindowsList</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;IntPtr&gt; IgnoreWindows { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WindowsList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IgnoreWindows = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IntPtr&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WindowsList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr ignoreWindow</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IgnoreWindows.Add(ignoreWindow); } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EvalWindows</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr hWnd, IntPtr lParam</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IgnoreWindows.Any(window =&gt; hWnd == window)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } windows.Add(new WindowInfo(hWnd)); return true; // &lt;= } }</span></span></code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3009</a> Es ist seltsam, dass diese Methode immer ein und denselben Wert von 'true' zur√ºckgibt.  WindowsList.cs 82 <br><br>  Es erscheint logisch, dass die Methode <i>false zur√ºckgeben</i> sollte, wenn in der Liste ein Zeiger mit demselben Wert wie <i>hWnd</i> mit dem Namen <i>IgnoreWindows gefunden</i> wurde. <br><br>  Die <i>IgnoreWindows-</i> Liste kann entweder durch Aufrufen des <i>WindowsList-</i> Konstruktors <i>(IntPtr ignoreWindow)</i> oder direkt durch Zugriff auf die Eigenschaft <i>ausgef√ºllt werden</i> , da sie √∂ffentlich ist.  Auf die eine oder andere Weise wird diese Liste laut Visual Studio derzeit im Code in keiner Weise ausgef√ºllt.  Dies ist ein weiterer seltsamer Ort dieser Methode. <br><br>  <b>Unsicherer Aufruf von Ereignishandlern</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNewsLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NewsLoaded != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { NewsLoaded(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EventArgs.Empty); } }</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3083</a> [CWE-367] Unsicherer Aufruf des Ereignisses 'NewsLoaded', NullReferenceException ist m√∂glich.  √úberlegen Sie, ob Sie einer lokalen Variablen ein Ereignis zuweisen m√∂chten, bevor Sie sie aufrufen.  NewsListControl.cs 111 <br><br>  In diesem Fall kann die folgende unangenehme Situation auftreten: Nach dem √úberpr√ºfen der <i>NewsLoaded-</i> Variablen auf <i>Null-</i> Ungleichung kann die Methode, die das Ereignis verarbeitet, beispielsweise in einem anderen Thread abgemeldet werden, und wenn wir in den Hauptteil der bedingten <i>if-Anweisung gelangen</i> , wird die <i>NewsLoaded-</i> Variable gleich <i>null</i> .  <i>Wenn Sie</i> versuchen, Abonnenten f√ºr ein <i>NewsLoaded-</i> Ereignis <i>anzurufen</i> , das <i>null ist,</i> wird eine <i>NullReferenceException ausgel√∂st</i> .  Es ist viel sicherer, den bedingten Nulloperator zu verwenden und den obigen Code wie folgt neu zu schreiben: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNewsLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { NewsLoaded?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EventArgs.Empty); }</code> </pre> <br>  Der Analysator zeigte <b>68</b> weitere √§hnliche Stellen an.  Wir werden sie hier nicht beschreiben - das Muster des Ereignisaufrufs in ihnen ist √§hnlich. <br><br>  <b>Geben Sie null von ToString zur√ºck</b> <br><br>  Vor nicht allzu langer Zeit habe ich aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><u>interessanten Artikel</u></a> eines Kollegen herausgefunden, dass Microsoft nicht empfiehlt, <i>null</i> von einer √ºberschriebenen <i>ToString-</i> Methode zur√ºckzugeben.  PVS-Studio ist sich dessen bewusst: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (loggerLock) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sbMessages != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; sbMessages.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sbMessages.ToString(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3108</a> Es wird nicht empfohlen, 'null' von der 'ToSting ()' - Methode zur√ºckzugeben.  Logger.cs 167 <br><br>  <b>Warum angemessen, wenn nicht verwendet?</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SeafileCheckAccInfoResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAccountInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"account/info/?format=json"</span></span>); .... }</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3008</a> Der Variablen 'url' werden zweimal hintereinander Werte zugewiesen.  Vielleicht ist das ein Fehler.  Kontrollzeilen: 197, 196. Seafile.cs 197 <br><br>  Wie Sie dem Beispiel <i>entnehmen</i> k√∂nnen, wird der Deklaration der <i>URL-</i> Variablen ein Wert zugewiesen, der von der <i>FixPrefix-</i> Methode zur√ºckgegeben wird.  In der n√§chsten Zeile ‚Äûschleifen‚Äú wir den resultierenden Wert, auch ohne ihn irgendwo zu verwenden.  Wir bekommen etwas √Ñhnliches wie "toter Code" - es macht die Arbeit, es hat keinen Einfluss auf das Endergebnis.  Dieser Fehler ist h√∂chstwahrscheinlich das Ergebnis des Kopierens und Einf√ºgens, da solche Codefragmente in 9 weiteren Methoden gefunden werden. <br>  Als Beispiel geben wir zwei Methoden mit einer √§hnlichen ersten Zeile an: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckAuthToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"auth/ping/?format=json"</span></span>); .... } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckAPIURL</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"ping/?format=json"</span></span>); .... }</code> </pre> <br><h2>  Insgesamt </h2><br>  Wie wir sehen k√∂nnen, h√§ngt die Komplexit√§t der Einrichtung der automatischen √úberpr√ºfung durch den Analysator nicht vom ausgew√§hlten CI-System ab. In nur 15 Minuten und wenigen Mausklicks richten wir die √úberpr√ºfung unseres Projektcodes mit einem statischen Analysator ein. <br><br>  Abschlie√üend empfehlen wir Ihnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, den Analysator</a> f√ºr Ihre Projekte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">herunterzuladen und zu testen</a> . <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  Wenn Sie diesen Artikel einem englischsprachigen Publikum zug√§nglich machen m√∂chten, verwenden Sie bitte den Link zur √úbersetzung: Oleg Andreev, Ilya Gainulin.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PVS-Studio in den Clouds: Azure DevOps</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de467359/">https://habr.com/ru/post/de467359/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de467347/index.html">Buch ‚ÄûErstellen solider Smart-Vertr√§ge f√ºr die Ethereum-Blockchain. Praktischer Leitfaden</a></li>
<li><a href="../de467349/index.html">Umzug eines Programmierers nach Estland: Arbeit, Geld und Lebenshaltungskosten</a></li>
<li><a href="../de467353/index.html">Codeoptimierungsmethoden f√ºr Redd. Teil 1: Cache-Effekt</a></li>
<li><a href="../de467355/index.html">Interview mit Marktforschern und Softwareentwicklungstrends in Mittel- und Osteuropa, Eugene Schwab-Chesaru</a></li>
<li><a href="../de467357/index.html">PVS-Studio in den Clouds: Azure DevOps</a></li>
<li><a href="../de467361/index.html">Wir haben die Delegierung in JavaScript vergessen. Ereignisdelegation reagieren</a></li>
<li><a href="../de467363/index.html">Verwenden benutzerdefinierter Verlustfunktionen und Lernen von Qualit√§tsmetriken in Keras</a></li>
<li><a href="../de467365/index.html">Relais zur √úberwachung der Wohnspannung</a></li>
<li><a href="../de467369/index.html">RubyRussia 2019. Mikhail Pronyakin: Ist Ruby sicher?</a></li>
<li><a href="../de467371/index.html">Google Job Interview Parsing: Beziehungen finden</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>