<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÇüèº ‚úåÔ∏è ‚úãüèª Bypass de trampa angular y ahorro de tiempo üí¨ üì± ü§≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Con Angular, puedes hacer cualquier cosa. O casi todo. Pero a veces este "casi" insidioso lleva al hecho de que el desarrollador est√° perdiendo el tie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bypass de trampa angular y ahorro de tiempo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/459304/">  Con Angular, puedes hacer cualquier cosa.  O casi todo.  Pero a veces este "casi" insidioso lleva al hecho de que el desarrollador est√° perdiendo el tiempo creando soluciones o tratando de entender por qu√© sucede algo o por qu√© algo no funciona como se esperaba. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/bl/sj/vq/blsjvqaqs4fhtnqmscwlw7lx0zs.jpeg"></a> <br><br>  El autor del art√≠culo que estamos traduciendo hoy dice que quiere compartir consejos que ayudar√°n a los desarrolladores de Angular a ahorrar algo de tiempo.  √âl va a hablar sobre las trampas de Angular, que √©l (y no solo √©l) tuvo la oportunidad de conocer. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">No 1.</font>  <font color="#3AC1EF">La directiva personalizada que aplic√≥ no funciona</font> </h2><br>  Entonces, encontr√≥ una buena directiva Angular de terceros y decidi√≥ usarla con elementos est√°ndar en la plantilla Angular.  Genial  Intentemos hacer esto: <br><br><pre><code class="javascript hljs">&lt;span awesomeTooltip=<span class="hljs-string"><span class="hljs-string">"'Tooltip text'"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Inicia la aplicaci√≥n ... Y no pasa nada.  Usted, como cualquier programador normal y experimentado, busca en la consola de Chrome Developer Tools.  Y no ves nada all√≠.  La directiva no funciona y Angular est√° en silencio. <br><br>  Luego, una cabeza brillante de su equipo decide colocar la directiva entre corchetes. <br><br><pre> <code class="javascript hljs">&lt;span [awesomeTooltip]=<span class="hljs-string"><span class="hljs-string">"'Tooltip text'"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Despu√©s de eso, habiendo perdido un poco de tiempo, vemos lo siguiente en la consola. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/532/4aa/95f/5324aa95f7aa2d0d1a20e74f93953eb1.png"></div><br>  <i><font color="#999999">Aqu√≠ est√° la cosa: simplemente olvidamos importar el m√≥dulo con la directiva</font></i> <br><br>  Ahora la causa del problema es bastante obvia: simplemente olvidamos importar el m√≥dulo de directiva en el m√≥dulo de aplicaci√≥n angular. <br>  Esto lleva a una regla importante: nunca use directivas sin corchetes. <br><br>  Puedes experimentar con las directivas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h2>  <font color="#3AC1EF">No 2.</font>  <font color="#3AC1EF">ViewChild regresa indefinido</font> </h2><br>  Suponga que cre√≥ un enlace a un elemento de entrada de texto descrito en una plantilla angular. <br><br><pre> <code class="javascript hljs">&lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> name=<span class="hljs-string"><span class="hljs-string">"fname"</span></span> #inputTag&gt;</code> </pre> <br>  Usted va, utilizando la funci√≥n RxJS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fromEvent</a> , para crear una secuencia en la que caer√° lo que se ingresa en el campo.  Para hacer esto, necesita un enlace al campo de entrada, que se puede obtener utilizando el decorador Angular <code>ViewChild</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AfterViewInit</span></span></span><span class="hljs-class"> </span></span>{    @ViewChild(<span class="hljs-string"><span class="hljs-string">'inputTag'</span></span>) inputTag: ElementRef;    ngAfterViewInit(){        <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> input$ = fromEvent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inputTag.nativeElement, <span class="hljs-string"><span class="hljs-string">'keyUp'</span></span>)    } ...   }</code> </pre> <br>  Aqu√≠, usando la funci√≥n RxJS <code>fromEvent</code> , creamos una secuencia en la que caer√°n los datos ingresados ‚Äã‚Äãen el campo. <br>  Prueba este c√≥digo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f0/504/558/4f0504558e9daf73a87d78da7f00fb04.png"></div><br>  <i><font color="#999999">Error</font></i> <br><br>  Que paso <br><br>  De hecho, la siguiente regla se aplica aqu√≠: si <code>ViewChild</code> devuelve <code>undefined</code> , busque <code>*ngIf</code> en la plantilla. <br><br><pre> <code class="javascript hljs">&lt;div *ngIf=<span class="hljs-string"><span class="hljs-string">"someCondition"</span></span>&gt;    <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"fname"</span></span></span></span><span class="xml"><span class="hljs-tag"> #</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">inputTag</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Aqu√≠ √©l es el culpable del problema. <br><br>  Adem√°s, verifique la plantilla para otras directivas estructurales o <code>ng-template</code> sobre el elemento del problema. <br>  Considere posibles soluciones a este problema. <br><br><h3>  <font color="#3AC1EF">‚ñçVariante de resolver el problema ‚Ññ1</font> </h3><br>  Simplemente puede ocultar el elemento de plantilla si no lo necesita.  En este caso, el elemento siempre seguir√° existiendo y <code>ViewChild</code> podr√° devolverle un enlace en el <code>ngAfterViewInit</code> . <br><br><pre> <code class="javascript hljs">&lt;div [hidden]=<span class="hljs-string"><span class="hljs-string">"!someCondition"</span></span>&gt;    <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"fname"</span></span></span></span><span class="xml"><span class="hljs-tag"> #</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">inputTag</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçVariante de resolver el problema ‚Ññ2</font> </h3><br>  Otra forma de resolver este problema es usar setters. <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeComponent</span></span></span><span class="hljs-class"> </span></span>{   @ViewChild(<span class="hljs-string"><span class="hljs-string">'inputTag'</span></span>) set inputTag(input: ElementRef|<span class="hljs-literal"><span class="hljs-literal">null</span></span>) {    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!input) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.doSomething(input);  }  doSomething(input) {    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> input$ = keysfromEvent(input.nativeElement, <span class="hljs-string"><span class="hljs-string">'keyup'</span></span>);    ...  } }</code> </pre> <br>  Aqu√≠, tan pronto como Angular asigna un valor espec√≠fico a la propiedad <code>inputTag</code> , creamos una secuencia a partir de los datos ingresados ‚Äã‚Äãen el campo de entrada. <br><br>  Aqu√≠ hay un par de recursos √∫tiles relacionados con este problema: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> puede leer que los resultados de <code>ViewChild</code> en Angular 8 pueden ser est√°ticos y din√°micos. </li><li>  Si tiene dificultades para trabajar con RxJs, eche un vistazo a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> video curso. </li></ul><br><h2>  <font color="#3AC1EF">N√∫mero 3.</font>  <font color="#3AC1EF">Ejecuci√≥n de c√≥digo al actualizar la lista generada con * ngFor (despu√©s de que los elementos aparecieron en el DOM)</font> </h2><br>  Supongamos que tiene una directiva personalizada interesante para organizar listas desplazables.  Lo aplicar√° a una lista que se crea utilizando la <code>*ngFor</code> Angular <code>*ngFor</code> . <br><br><pre> <code class="javascript hljs">&lt;div *ngFor=<span class="hljs-string"><span class="hljs-string">"let item of itemsList; let i = index;"</span></span>     [customScroll]     &gt;  <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag"> *</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"let item of items"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"list-item"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{{item}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>   &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt;</span></span></code> </pre> <br>  Por lo general, en estos casos, al actualizar la lista, debe llamar a algo como <code>scrollDirective.update</code> para configurar el comportamiento de desplazamiento, teniendo en cuenta los cambios que se han producido en la lista. <br><br>  Puede parecer que esto se puede hacer usando el gancho <code>ngOnChanges</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnChanges</span></span></span><span class="hljs-class"> </span></span>{  @Input() itemsList = [];   @ViewChild(CustomScrollDirective) scroll: CustomScrollDirective;  ngOnChanges(changes) {    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (changes.itemsList) {      <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scroll.update();    }  } ... }</code> </pre> <br>  Es cierto, aqu√≠ nos enfrentamos a un problema.  Se llama al gancho antes de que el navegador muestre la lista actualizada.  Como resultado, el rec√°lculo de los par√°metros de la directiva para desplazarse por la lista se realiza incorrectamente. <br><br>  ¬øC√≥mo hacer una llamada justo despu√©s de <code>*ngFor</code> trabajo finalice? <br><br>  Puede hacer esto siguiendo estos 3 simples pasos: <br><br><h3>  <font color="#3AC1EF">‚ñçPaso n√∫mero 1</font> </h3><br>  Coloque los enlaces a los elementos donde se <code>*ngFor</code> ( <code>#listItems</code> ). <br><br><pre> <code class="javascript hljs">&lt;div [customScroll]&gt;    <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag"> *</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"let item of items"</span></span></span></span><span class="xml"><span class="hljs-tag"> #</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">listItems</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{{item}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt;</span></span></code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçPaso n√∫mero 2</font> </h3><br>  Obtenga una lista de estos elementos utilizando el decorador Angular <code>ViewChildren</code> .  Devuelve una entidad de tipo <code>QueryList</code> . <br><br><h3>  <font color="#3AC1EF">‚ñçPaso n√∫mero 3</font> </h3><br>  La clase <code>QueryList</code> tiene una propiedad de <a href="">cambios de</a> solo lectura que <code>QueryList</code> eventos cada vez que cambia la lista. <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AfterViewInit</span></span></span><span class="hljs-class"> </span></span>{  @Input() itemsList = [];   @ViewChild(CustomScrollDirective) scroll: CustomScrollDirective;  @ViewChildren(<span class="hljs-string"><span class="hljs-string">'listItems'</span></span>) listItems: QueryList&lt;any&gt;;  private sub: Subscription;   ngAfterViewInit() {    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sub = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listItems.changes.subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scroll.update())  } ... }</code> </pre> <br>  Ahora el problema est√° resuelto.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> puedes experimentar con el ejemplo correspondiente. <br><br><h2>  <font color="#3AC1EF">Numero 4.</font>  <font color="#3AC1EF">Problemas con ActivatedRoute.queryParam que se producen cuando las consultas se pueden ejecutar sin par√°metros</font> </h2><br>  El siguiente c√≥digo nos ayudar√° a comprender la esencia de este problema. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// app-routing.module.ts const routes: Routes = [    {path: '', redirectTo: '/home', pathMatch: 'full'},    {path: 'home', component: HomeComponent},  ];   @NgModule({    imports: [RouterModule.forRoot(routes)], //  #1    exports: [RouterModule]  })  export class AppRoutingModule { }    //app.module.ts  @NgModule({    ...    bootstrap: [AppComponent] //  #2  })  export class AppModule { }   // app.component.html  &lt;router-outlet&gt;&lt;/router-outlet&gt; //  #3    // app.component.ts  export class AppComponent implements OnInit {    title = 'QueryTest';     constructor(private route: ActivatedRoute) { }     ngOnInit() {      this.route.queryParams          .subscribe(params =&gt; {            console.log('saveToken', params); //  #4          });    }  }</span></span></code> </pre> <br>  Algunos fragmentos de este c√≥digo se hacen comentarios como <code> #x</code> .  Consid√©ralos: <br><br><ol><li>  En el m√≥dulo principal de la aplicaci√≥n, definimos las rutas y agregamos el <code>RouterModule</code> all√≠.  Las rutas se configuran de modo que si no se proporciona una ruta en la URL, redirigimos al usuario a la p√°gina <code>/home</code> . </li><li>  Como componente para descargar, especificamos en el m√≥dulo principal <code>AppComponent</code> . </li><li>  <code>AppComponent</code> usa <code>&lt;router-outlet&gt;</code> para generar los componentes de ruta apropiados. </li><li>  Ahora lo m√°s importante.  Necesitamos obtener <code>queryParams</code> para la ruta desde la URL </li></ol><br>  Supongamos que tenemos la siguiente URL: <br><br><pre> <code class="javascript hljs">https:<span class="hljs-comment"><span class="hljs-comment">//localhost:4400/home?accessToken=someTokenSequence</span></span></code> </pre> <br>  En este caso, <code>queryParams</code> se ver√° as√≠: <br><br><pre> <code class="javascript hljs">{<span class="hljs-attr"><span class="hljs-attr">accessToken</span></span>: <span class="hljs-string"><span class="hljs-string">'someTokenSequence'</span></span>}</code> </pre> <br>  Veamos el trabajo de todo esto en el navegador. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29f/aef/ae5/29faefae56d8e01e314cb6eab9fae6dc.png"></div><br>  <i><font color="#999999">Probar una aplicaci√≥n que implementa un sistema de enrutamiento</font></i> <br><br>  Aqu√≠ puede tener una pregunta sobre la esencia del problema.  Tenemos los par√°metros, todo funciona como se esperaba ... <br><br>  Eche un vistazo a la captura de pantalla anterior del navegador y lo que se muestra en la consola.  Aqu√≠ puede ver que el objeto <code>queryParams</code> se emite dos veces.  El primer objeto est√° vac√≠o; se emite durante el proceso de inicializaci√≥n del enrutador angular.  Solo despu√©s de eso obtenemos un objeto que contiene los par√°metros de solicitud (en nuestro caso - <code>{accessToken: 'someTokenSequence'}</code> ). <br><br>  El problema es que si no hay par√°metros de solicitud en la URL, el enrutador no devolver√° nada.  Es decir, despu√©s de emitir el primer objeto vac√≠o, no se emitir√° el segundo objeto, tambi√©n vac√≠o, que podr√≠a indicar la ausencia de par√°metros. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e16/1b7/8be/e161b78be5051b1ee9f9ca1ec2c9d31a.png"></div><br>  <i><font color="#999999">Al ejecutar una solicitud sin par√°metros, no se emite el segundo objeto</font></i> <br><br>  Como resultado, resulta que si el c√≥digo espera un segundo objeto del que pueda recibir datos de solicitud, no se iniciar√° si no hay par√°metros de solicitud en la URL. <br><br>  ¬øC√≥mo resolver este problema?  Aqu√≠ RxJs puede ayudarnos.  Crearemos dos objetos observables basados ‚Äã‚Äãen <code>ActivatedRoute.queryParams</code> .  Como de costumbre, considere una soluci√≥n paso a paso al problema. <br><br><h3>  <font color="#3AC1EF">‚ñçPaso n√∫mero 1</font> </h3><br>  El primer objeto observable, <code>paramsInUrl$</code> , <code>paramsInUrl$</code> datos si <code>queryParams</code> no <code>queryParams</code> vac√≠o: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private route: ActivatedRoute,                private locationService: Location) {    }    ngOnInit() {             <span class="hljs-comment"><span class="hljs-comment">//            //              const paramsInUrl$ = this.route.queryParams.pipe(            filter(params =&gt; Object.keys(params).length &gt; 0)        );     ...    } }</span></span></code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçPaso n√∫mero 2</font> </h3><br>  El segundo objeto observable, <code>noParamsInUrl$</code> , <code>noParamsInUrl$</code> valor vac√≠o solo si no se encontraron par√°metros de solicitud en la URL: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class"> </span></span>{    title = <span class="hljs-string"><span class="hljs-string">'QueryTest'</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private route: ActivatedRoute,                private locationService: Location) {    }    ngOnInit() {                 ...        <span class="hljs-comment"><span class="hljs-comment">//   ,     ,   URL        //             const noParamsInUrl$ = this.route.queryParams.pipe(            filter(() =&gt; !this.locationService.path().includes('?')),            map(() =&gt; ({}))        );            ...    } }</span></span></code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçPaso n√∫mero 3</font> </h3><br>  Ahora combine los objetos observados usando la funci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fusi√≥n</a> RxJS: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class"> </span></span>{    title = <span class="hljs-string"><span class="hljs-string">'QueryTest'</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private route: ActivatedRoute,                private locationService: Location) {    }    ngOnInit() {             <span class="hljs-comment"><span class="hljs-comment">//            //              const paramsInUrl$ = this.route.queryParams.pipe(            filter(params =&gt; Object.keys(params).length &gt; 0)        );        //   ,     ,   URL        //             const noParamsInUrl$ = this.route.queryParams.pipe(            filter(() =&gt; !this.locationService.path().includes('?')),            map(() =&gt; ({}))        );        const params$ = merge(paramsInUrl$, noParamsInUrl$);        params$.subscribe(params =&gt; {            console.log('saveToken', params);        });    } }</span></span></code> </pre> <br>  Ahora el <code>param$</code> object observado <code>param$</code> valor solo una vez, independientemente de si algo est√° <code>queryParams</code> en <code>queryParams</code> (se <code>queryParams</code> un objeto con par√°metros de consulta) o no (se <code>queryParams</code> un objeto vac√≠o). <br><br>  Puedes experimentar con este c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h2>  <font color="#3AC1EF">No 5.</font>  <font color="#3AC1EF">P√°ginas lentas</font> </h2><br>  Supongamos que tiene un componente que muestra algunos datos formateados: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// home.component.html &lt;div class="wrapper" (mousemove)="mouseCoordinates = {x: $event.x, y: $event.y}"&gt;  &lt;div *ngFor="let item of items"&gt;     &lt;span&gt;{{formatItem(item)}}&lt;/span&gt;  &lt;/div&gt; &lt;/div&gt; {{mouseCoordinates | json}} // home.component.ts export class HomeComponent {    items = [1, 2, 3, 4, 5, 6];    mouseCoordinates = {};    formatItem(item) {              //           const t = Array.apply(null, Array(5)).map(() =&gt; 1);             console.log('formatItem');        return item + '%';    } }</span></span></code> </pre> <br>  Este componente resuelve dos problemas: <br><br><ol><li>  Muestra una matriz de elementos (se supone que esta operaci√≥n se realiza una vez).  Adem√°s, formatea lo que se muestra llamando al m√©todo <code>formatItem</code> . </li><li>  Muestra las coordenadas del mouse (este valor obviamente se actualizar√° muy a menudo). </li></ol><br>  No espera que este componente tenga problemas de rendimiento.  Por lo tanto, ejecute una prueba de rendimiento solo para cumplir con todas las formalidades.  Sin embargo, algunas rarezas aparecen durante esta prueba. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/015/97d/621/01597d6210a35f37a8030702c0b71753.png"></div><br>  <i><font color="#999999">Muchas llamadas de formato de art√≠culo y mucha carga de CPU</font></i> <br><br>  Cual es el problema  Pero el hecho es que cuando Angular vuelve a dibujar la plantilla, llama a todas las funciones de la plantilla (en nuestro caso, la funci√≥n <code>formatItem</code> ).  Como resultado, si se realizan c√°lculos pesados ‚Äã‚Äãen las funciones de la plantilla, esto pone a prueba el procesador y afecta la forma en que los usuarios perciben la p√°gina correspondiente. <br><br>  ¬øC√≥mo arreglarlo?  Es suficiente realizar los c√°lculos realizados en <code>formatItem</code> de antemano y mostrar los datos que ya est√°n listos en la p√°gina. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// home.component.html &lt;div class="wrapper" (mousemove)="mouseCoordinates = {x: $event.x, y: $event.y}"&gt;  &lt;div *ngFor="let item of displayedItems"&gt;    &lt;span&gt;{{item}}&lt;/span&gt;  &lt;/div&gt; &lt;/div&gt; {{mouseCoordinates | json}} // home.component.ts @Component({    selector: 'app-home',    templateUrl: './home.component.html',    styleUrls: ['./home.component.sass'] }) export class HomeComponent implements OnInit {    items = [1, 2, 3, 4, 5, 6];    displayedItems = [];    mouseCoordinates = {};    ngOnInit() {        this.displayedItems = this.items.map((item) =&gt; this.formatItem(item));    }    formatItem(item) {        console.log('formatItem');        const t = Array.apply(null, Array(5)).map(() =&gt; 1);        return item + '%';    } }</span></span></code> </pre> <br>  Ahora la prueba de rendimiento parece mucho m√°s decente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ce/f49/118/2cef4911810ce0a506dd0697ee801119.png"></div><br>  <i><font color="#999999">Solo 6 llamadas de √≠tem de formato y baja carga de procesador</font></i> <br><br>  Ahora la aplicaci√≥n funciona mucho mejor.  Pero la soluci√≥n utilizada aqu√≠ tiene algunas caracter√≠sticas que no siempre son agradables: <br><br><ul><li>  Como mostramos las coordenadas del mouse en la plantilla, el evento <code>mousemove</code> a√∫n activa una verificaci√≥n de cambio.  Pero, dado que necesitamos las coordenadas del mouse, no podemos deshacernos de esto. </li><li>  Si el <code>mousemove</code> eventos <code>mousemove</code> solo necesita realizar algunos c√°lculos (que no afectan lo que se muestra en la p√°gina), entonces para acelerar la aplicaci√≥n, puede hacer lo siguiente: <br><br><ol><li>  Puede usar <code>NgZone.runOutsideOfAngular</code> dentro de la funci√≥n de controlador de eventos.  Esto evita que se <code>mousemove</code> las comprobaciones de cambios cuando se <code>mousemove</code> evento <code>mousemove</code> (esto solo afectar√° a este controlador). </li><li>  Puede evitar el parche zone.js para algunos eventos utilizando la siguiente l√≠nea de c√≥digo en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">polyfills.ts</a> .  Esto afectar√° a toda la aplicaci√≥n Angular. </li></ol></li></ul><br><pre> <code class="javascript hljs">* (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> any).__zone_symbol__UNPATCHED_EVENTS = [<span class="hljs-string"><span class="hljs-string">'scroll'</span></span>, <span class="hljs-string"><span class="hljs-string">'mousemove'</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//     </span></span></code> </pre> <br>  Si est√° interesado en los problemas de mejorar el rendimiento de las aplicaciones angulares, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , materiales √∫tiles sobre esto. <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>  Ahora que ha le√≠do este art√≠culo, deber√≠an aparecer 5 nuevas herramientas en su arsenal de desarrolladores Angular con las que puede resolver algunos problemas comunes.  Esperamos que los consejos que encontraste aqu√≠ te ayuden a ahorrar tiempo. <br><br>  <b>Estimados lectores!</b>  ¬øSabes algo que te ayude a ahorrar tiempo al desarrollar aplicaciones angulares? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/rw/6v/yn/rw6vyn2bxx4usoqc39holmj2z8m.jpeg"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459304/">https://habr.com/ru/post/459304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459294/index.html">¬øQu√© es m√°s importante: conocer un lenguaje de programaci√≥n o poder resolver un problema de negocios?</a></li>
<li><a href="../459296/index.html">Precio JavaScript 2019</a></li>
<li><a href="../459298/index.html">Angular: estado en 2019</a></li>
<li><a href="../459300/index.html">Quasar 1.0: una nueva herramienta √∫til para los desarrolladores de Vue y no solo para ellos</a></li>
<li><a href="../459302/index.html">Reintentando solicitudes HTTP fallidas en Angular</a></li>
<li><a href="../459306/index.html">Representaci√≥n del servidor en un entorno sin servidor</a></li>
<li><a href="../459308/index.html">¬øEl SEO no funciona en 2019?</a></li>
<li><a href="../459310/index.html">Pruebe las herramientas de automatizaci√≥n o el probador de esteroides m√≥vil</a></li>
<li><a href="../459312/index.html">Querida Agile, estoy harta de fingir</a></li>
<li><a href="../459314/index.html">Visualice y trate con Hash Match Join</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>