<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛌🏾 👸🏿 👩🏾‍🚒 Utilisation de la mémoire d'affichage Flash SPI pour stocker des ressources graphiques ou afficher une station météo domestique 👨‍⚕️ 🍒 🤵🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est destiné à parler de la possibilité d'utiliser l'affichage de mémoire Flash intégré pour les besoins du projet. 
 Pour qui c'est pertin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utilisation de la mémoire d'affichage Flash SPI pour stocker des ressources graphiques ou afficher une station météo domestique</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388449/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article est destiné à parler de la possibilité d'utiliser l'affichage de mémoire Flash intégré pour les besoins du projet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour qui c'est pertinent ou tout simplement intéressant - bienvenue sous le chat.</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant toute une année, j'ai posé un écran de 7 "sur une étagère en attendant mon temps. Pourquoi si longtemps? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, car il y avait un écran de 3,2" en usage, qui en général fonctionnait parfaitement. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, le volume d'informations affichées simultanément à 3,2 "ne me convenait pas du tout. La partie serveur de la station météo reçoit les prévisions météorologiques d'une semaine sur Internet, mais il n'y avait aucun moyen de les afficher (prévisions) simultanément avec les lectures du capteur. Par conséquent, j'ai été perplexe en achetant un écran plus grand. Au départ, j'ai regardé 5 ", mais après avoir participé à quelques reprises à la vente aux enchères, j'ai finalement acheté 7" au prix de 5 ", ce qui était très heureux. L'écran acheté est équipé d'un contrôleur SSD1963 et de 64 Mo de RAM Flash.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le nouvel écran était encore en train de s'accumuler sur l'étagère, j'ai attiré l'attention sur la présence sur Internet de bibliothèques avec une documentation qui permettait d'utiliser la mémoire flash intégrée pour mes besoins. Jusqu'à présent, j'ai trouvé des icônes de stockage montrant la météo actuelle là-bas. Dans la version précédente avec un écran de 3,2 pouces, les icônes étaient stockées sur une carte SD insérée dans le lecteur de carte du module d'affichage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je tiens à noter tout de suite que le processus de chargement des fichiers de ressources dans la mémoire d'affichage n'est pas simple et pratique, j'ai donc décidé d'écrire un court article d'instructions. : </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, téléchargez les archives à ces liens: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPIFlash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTFT_SPIflash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et développez les archives dans le répertoire des bibliothèques. Le </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
téléchargement se </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">déroule en</font></a><font style="vertical-align: inherit;"> plusieurs étapes:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Préparez à l'avance un ensemble d'icônes ou d'autres ressources graphiques que nous voulons utiliser dans votre projet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Dans le dossier SPIflash \ tools \ FlashUploader se trouve un outil FlashUploader et une bonne documentation pour cela. En théorie, cet outil est conçu pour charger des ressources dans un affichage flash, mais en fait, en raison de problèmes de communication logicielle avec le contrôleur, cela ne peut pas être fait, donc ce processus est quelque peu allongé. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant FlashUploader, nous préparons un fichier SFD contenant un ensemble d'images préparées ou d'autres ressources.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour préparer et enregistrer le fichier de ressources, il n'est pas nécessaire de connecter FlashUploader et l'écran, mais si vous voulez toujours le faire, vous devez charger un croquis spécial dans Arduino, auquel l'écran est connecté, situé dans le dossier SPIflash \ examples \ Arduino (AVR) \ SPIflash_FlashUploader . </font><font style="vertical-align: inherit;">Après avoir ajouté toutes les icônes et enregistré le fichier sfd, n'oubliez pas de créer un fichier avec une description du contenu joint en utilisant le bouton «Générer la liste des contenus». </font><font style="vertical-align: inherit;">À l'avenir, nous utiliserons le fichier avec la description comme référence pour rechercher le numéro de l'icône souhaitée.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capture d'écran de FlashUploader</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/180/53b/1b7/18053b1b71b4435cac987327a33637fb.png"><br>
</div></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Le fichier SFD résultant est écrit sur la carte SD, qui est ensuite insérée dans le lecteur de carte graphique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Connectez l'écran à Arduino et chargez l'esquisse SPIflash_Restore à partir du dossier SPIflash \ examples \ Arduino (AVR). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Nous commençons le processus de restauration du contenu SD dans la mémoire flash de l'écran.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capture d'écran de Serial Monitor après un téléchargement réussi</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/819/186/a61/819186a6151f42d581a77d593c7d2162.png"><br>
</div></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci termine le processus de démarrage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le projet, vous devez accéder à la ressource souhaitée (image) par son ID dans le fichier SFD.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un petit croquis de test pour afficher toutes les icônes (dans mon cas, 44 d'entre elles) sur l'écran</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UTFT.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPIflash.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UTFT_SPIflash.h&gt;</span></span></span></span>
<span class="hljs-comment"><span class="hljs-comment">//////      ////////</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> SmallFont[];
<span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> BigFont[];
<span class="hljs-comment"><span class="hljs-comment">///////////////////////////////////</span></span>
<span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-function"><span class="hljs-function">UTFT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myGLCD</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CTE70, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">38</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">39</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">40</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">41</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>;
<span class="hljs-comment"><span class="hljs-comment">// myFlash(&lt;SS&gt;); (if using the hardware SPI pins. See the manual for other configurations.)</span></span>
<span class="hljs-function"><span class="hljs-function">SPIflash      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myFlash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">45</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>;
<span class="hljs-function"><span class="hljs-function">UTFT_SPIflash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;myGLCD, &amp;myFlash)</span></span></span></span>;
<span class="hljs-comment"><span class="hljs-comment">//////////////////////////////////////////////////</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  myGLCD.InitLCD(LANDSCAPE);<font></font>
  myGLCD.setBright(<span class="hljs-number"><span class="hljs-number">7</span></span>);<font></font>
  myGLCD.setFont(BigFont);<font></font>
  myGLCD.setColor(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>);<font></font>
  myGLCD.setBackColor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
  myGLCD.clrScr();<font></font>
  myFlash.begin();<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myFlash.ID_device == <span class="hljs-number"><span class="hljs-number">0</span></span>)<font></font>
  {<font></font>
    myGLCD.print(F(<span class="hljs-string"><span class="hljs-string">"Unknown flash device!"</span></span>), <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) {};<font></font>
  }<font></font>
  TestIcon2Display(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestIcon2Display</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function">
</span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">44</span></span>; i++)<font></font>
  {<font></font>
      Serial.println(i);<font></font>
    myFiles.loadBitmap(i, x, y);<font></font>
    x = x + <span class="hljs-number"><span class="hljs-number">150</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &gt; <span class="hljs-number"><span class="hljs-number">800</span></span> - <span class="hljs-number"><span class="hljs-number">150</span></span>)<font></font>
    {<font></font>
      x = <span class="hljs-number"><span class="hljs-number">10</span></span>;<font></font>
      y = y + <span class="hljs-number"><span class="hljs-number">110</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (y &gt; <span class="hljs-number"><span class="hljs-number">480</span></span> - <span class="hljs-number"><span class="hljs-number">110</span></span>) y = <span class="hljs-number"><span class="hljs-number">10</span></span>;<font></font>
    delay(<span class="hljs-number"><span class="hljs-number">700</span></span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
}<font></font>
</code></pre><br>
</div></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, à la fin </font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affichage de la station météo en état de marche</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/4de/d44/31d/4ded4431d09d4cedbff7034320dff972.jpg"><br>
</div></div></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr388449/">https://habr.com/ru/post/fr388449/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr388435/index.html">Comment nous avons fait un analogue d'Oculus Rift</a></li>
<li><a href="../fr388437/index.html">Personnages de contes de fées de la vieille Russie, épisode II</a></li>
<li><a href="../fr388443/index.html">Le joueur emblématique de Winamp a de nouveau une chance de revivre</a></li>
<li><a href="../fr388445/index.html">Pourquoi les étoiles explosent</a></li>
<li><a href="../fr388447/index.html">La BBC a commencé à utiliser la traduction automatique des rapports</a></li>
<li><a href="../fr388453/index.html">Le premier prototype fonctionnel d'un processeur électron-optique monopuce a été créé</a></li>
<li><a href="../fr388455/index.html">Des dizaines de films DVD en pré-sortie divulgués en ligne</a></li>
<li><a href="../fr388457/index.html">[Message du Nouvel An] Kingston félicite les lecteurs de GeekTimes</a></li>
<li><a href="../fr388461/index.html">Что подарить на Новый год? Краткий гайд от Epson</a></li>
<li><a href="../fr388463/index.html">Gingwa (langage pour la communication interplanétaire entre les humanoïdes protéiques). Partie 2, atelier de formation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>