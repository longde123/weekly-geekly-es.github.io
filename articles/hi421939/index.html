<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯХз ЁЯзЧЁЯП╜ ЁЯСиЁЯП┐тАНЁЯТ╗ Rails рдореЗрдВ SQL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ ЁЯСк тЩ╗я╕П ЁЯд╜ЁЯП╗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд▓реЗрдЦ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдореБрдЭреЗ рд░реЗрд▓ рдХреИрд╕реЗ рдкрд╕рдВрдж рд╣реИ, рдФрд░ рджреВрд╕рд░реА рдмрд╛рдд, рд▓реЗрдЦ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдореИрдВ рдЙрдирд╕реЗ рдХреИрд╕реЗ рдирдлрд░рдд рдХрд░рддрд╛ рд╣реВрдВред рдЙрдирдХрд╛ рдЗрд▓рд╛рдЬ рдкреВрд░реА рддрд░рд╣ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rails рдореЗрдВ SQL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421939/"><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд▓реЗрдЦ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдореБрдЭреЗ рд░реЗрд▓ рдХреИрд╕реЗ рдкрд╕рдВрдж рд╣реИ, рдФрд░ рджреВрд╕рд░реА рдмрд╛рдд, рд▓реЗрдЦ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдореИрдВ рдЙрдирд╕реЗ рдХреИрд╕реЗ рдирдлрд░рдд рдХрд░рддрд╛ рд╣реВрдВред  рдЙрдирдХрд╛ рдЗрд▓рд╛рдЬ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╡реЗ рддрднреА рдмреЗрд╣рддрд░ рдмрдиреЗрдВрдЧреЗ рдЬрдм рдЖрдк рдЙрдиреНрд╣реЗрдВ рдмрджрд▓реЗрдВрдЧреЗред  рдФрд░ рд╡реЗ рдмрджрддрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдХреЗрд╡рд▓ рдЕрдЧрд░ рд╡реЗ рдмрджрд▓рдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдЦреИрд░, рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдореИрдВрдиреЗ рдЖрдкрдХреЛ рдЪреЗрддрд╛рд╡рдиреА рджреА рдереА, рд▓реЗрдХрд┐рди рдЖрдкрдиреЗ рдореБрдЭреЗ рд╕рдордЭрд╛ред </p><br><p> ActiveRecord рдХреА рдореБрдЦреНрдп рдЕрд╡рдзрд╛рд░рдгрд╛рдУрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдпрд╣ рд╣реИ рдХрд┐ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛рдлреА рдЙрдкрдпреЛрдЧрд┐рддрд╛рд╡рд╛рджреА рд╣реИ рдФрд░ рдЗрд╕реЗ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдареАрдХ рд╣реИ, рдЖрдк рд╡рд╣рд╛рдВ рдмреИрдареЗ рд╣реИрдВ, MySQL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдореЙрдбрд▓ рд▓рд┐рдЦ рд░рд╣реЗ рд╣реИрдВ, рдФрд░ рдЕрдЪрд╛рдирдХ рдЖрдкрдиреЗ рдХрд╣реАрдВ рдкрдврд╝рд╛ рд╣реИ рдХрд┐ рдЖрдк рдЗрд╕рдХреЗ рдмрдЬрд╛рдп MySQL рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ MongbDB рдХреЗ рд╕рд╛рде рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред  рдЦреИрд░, рдЗрддрдирд╛ рдХрдЯреНрдЯрд░рдкрдВрдереА рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди, рдХрд╣рддреЗ рд╣реИрдВ, PostgreSQL рдкрд░, рдЖрдкрдХреЗ рдкрд╛рд╕ MySQL рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рдХрд╛рд░рдг рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╛ рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, рдореЗрд░реЗ рдкрд╛рд╕ MySQL рдХреЗ рдЦрд┐рд▓рд╛рдл рдХреБрдЫ рднреА рдирд╣реАрдВ рд╣реИред  рдпрд╣рд╛рдВ ActiveRecord рдЖрдкрдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХрд╛ рджрд╛рд╡рд╛ рдХрд░рддрд╛ рд╣реИ, рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ, рдлрд╝рд┐рд▓реНрдЯрд░ рдФрд░ рдПрд╕реЛрд╕рд┐рдПрд╢рди рдХреЗ рдмрд╛рдж, рдбреЗрдЯрд╛рдмреЗрд╕ рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдЬрд┐рдХ рдХреА рджреЗрдЦрднрд╛рд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИрдВред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдП <code>WHERE is_archived = TRUE</code> рдмрдЬрд╛рдп рдЖрдк рдпрд╣ <code>WHERE is_archived = TRUE</code> рдЦреБрд╢ рд╣реИрдВ рдХрд┐ <code>where(is_archived: true)</code> рдФрд░ ActiveRecord рдЖрдкрдХреЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ рдХрд░реЗрдЧрд╛ред  рд╕рднреА рдЙрджрд╛рд╣рд░рдг PostgreSQL рдХреЗ рд▓рд┐рдП рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ, MySQL рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рдЗрд╕рд▓рд┐рдП MySQL рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрдкрдиреА рдмрд╛рдЗрдХ рдХрд╛ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e53/ff1/cfc/e53ff1cfc747b1a79b89c8139cd1d196.gif"></p><br><p>  рд▓реЗрдХрд┐рди рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛ рдХрд┐ рдХреИрд╕реЗ!  рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ, рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдЕрдореВрд░реНрдд рдХреА рдпрд╣ рдкрд░рдд рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЫрд┐рджреНрд░реЛрдВ рд╕реЗ рднрд░реА рд╣реБрдИ рд╣реИ, рдЬреИрд╕реЗ рдЧреЛрд▓реНрдбрди рдордЫрд▓реА рдХреА рдХрд╣рд╛рдиреА рд╕реЗ рдПрдХ рдЧрд░реНрддред  рдФрд░ рдпрд╣ рдХрд┐ рдХрдИ рдмреБрдирд┐рдпрд╛рджреА рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рддрд╛рд░реАрдЦреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░рдирд╛ рдпрд╛ рд╕рд░рдгрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ред  рдФрд░ рдЖрдкрдХреЛ рдордЬрдмреВрд░рди рд╕реНрдХреЛрдк рдорд┐рд▓рддреЗ рд╣реИрдВ <code>where("#{quoted_table_name}.finished_at &gt;= ?", Date.current)</code> рдпрд╛ <code>where("#{quoted_table_name}.other_ids &lt;@ ARRAY[?]", ids)</code> ред  рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП ActiveRecord рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдЪреЗрдд рдФрд░ рддрд╛рд░реНрдХрд┐рдХ рдЙрддреНрддрд░ рджреЗрддрд╛ рд╣реИ: рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВред  рд╕рд░рдгрд┐рдпреЛрдВ рдХреЗ рдмрдЬрд╛рдп, habtm рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдФрд░ рдпрджрд┐ рдЖрдкрдХреЛ рддрд╛рд░реАрдЦреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рд░рд╣реЗрдВред  рд╣рд╛рдВ, рдФрд░ рднрдЧрд╡рд╛рди рдиреЗ рдЖрдкрдХреЛ рдЗрд╕ рддрд░рд╣ рдХреЗ рджрд╛рдпрд░реЗ рдореЗрдВ <code>quoted_table_name</code> рдпрд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордирд╛ рдХрд┐рдпрд╛ рд╣реИ - рдкрд╣рд▓реЗ <code>includes</code> рдпрд╛ <code>joins</code> рд╕рдм рдХреБрдЫ рдЕрдкрдиреА рдЬрдЧрд╣ рдкрд░ <code>joins</code> ред  рдпрд╣ рд╣рд░ рдЬрдЧрд╣ рдФрд░ рд╣рдореЗрд╢рд╛ рд▓рд┐рдЦрдирд╛ рдЖрд╕рд╛рди рд╣реЛрддрд╛ рд╣реИ, рддрд╛рдХрд┐ рдЕрдкрдирд╛ рд╣рд╛рде рдиреАрдЪреЗ рди рдЧрд┐рд░рд╛рдПрдВред </p><a name="habracut"></a><br><p>  рдареАрдХ рд╣реИ, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдЬреИрд╕реЗ рд╣реА рдЖрдк рдпрд╣рд╛рдВ ActiveRecord рдХреЗ рд╕рд╛рде рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддреЗ рд╣реИрдВ, рдХреЛрдИ рднреА рдореЛрдбрд╝ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреЛрдИ рдореМрдХрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдХрд┐рд╕реА рдЕрдиреНрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рджрд░реНрдж рд░рд╣рд┐рдд рд╕рдВрдХреНрд░рдордг рдХреЗ рд▓рд┐рдП рдПрдХ рднреВрддрд┐рдпрд╛ рдЖрд╢рд╛ рднреАред  рдЗрд╕ рд╕реЛрд░реНрд╕ рдХреЛрдб рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░рдирд╛ рдФрд░ рдЬрд▓рд╛рдирд╛ рдЬреНрдпрд╛рджрд╛ рдЖрд╕рд╛рди рд╣реЛрдЧрд╛ред  рдФрд░ рд╣рд╛рдВ, рдЖрдкрдХреЗ рдЖрд╡реЗрджрди рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рдЕрдиреНрдп рдХрд╛рд░рдг рдирд╣реАрдВ рд╣реИред  рд╕реНрд╡рд╛рд╕реНрдереНрдп рдкрд░ рдкреНрд░рдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рджреВрд╕рд░реЛрдВ рдХреЛ рдордЬрдмреВрд░ рдХрд░реЗрдВ! </p><br><p>  рдФрд░ рдЬрдм рдпрд╣ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдореЙрдбрд▓ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдЖрдкрдХреЗ рд╕реНрдХреЛрдк рдЗрди рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рдЖрдзреЗ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИрдВ, рддреЛ рдпрд╣ рдХрд╛рдлреА рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдХреЛрдб рдХреЗ рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреЗ рд╕рд╛рде рд▓реЗрдмрд▓ рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЗ рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдПрдХреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ActiveRecord рд╕рд┐рд░реНрдл рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╢реЗрд▓ рд╣реИред  рдФрд░ scopes, <code>where(is_archived: true).joins(:sprint).merge(Sprint.archived)</code> , рдареАрдХ рдХрд╛рдо рдХрд░реЗрдЧрд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдирд╛ рддрд▓реЗ рд╣реБрдП рдЕрдВрдбреЗ рдмрдирд╛рдиреЗ рд╕реЗ рдЬреНрдпрд╛рджрд╛ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд╣реИ рдирд╛? </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/618/8a9/0b1/6188a90b173dcc6238fa5fa649ee3227.gif"></p><br><p>  рдЕрдЧрд▓реЗ рдЪрд░рдг рдХрд╛ рдирд╛рдордХрд░рдг рд╣реЛрдЧрд╛ред  рдирд╣реАрдВ, рд╡рд┐рдХреЗрдВрджреНрд░реАрдХрд░рдг, рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдерд╛, рд╣рдореЗрд╢рд╛ рдЧрд╛рдпрдм рдирд╣реАрдВ рд╣реБрдЖ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреА рджреЗрдЦрднрд╛рд▓ рд░реЗрд▓ рдФрд░ ActiveRecord рдХреЗ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдХрдВрдзреЛрдВ рдХреЗ рд╕рд╛рде рдЖрд░рд╛рдо рдХрд░рддреА рд╣реИ, рдФрд░ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЗрди рджреЛ рд▓реЛрдЧреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрди рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдореЗрдВ рддреЗрдЬ рдФрд░ рддрдкрд╕реНрд╡ рдореЗрдВ рднрд┐рдиреНрдирддрд╛ рдирд╣реАрдВ рдереАред  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ <code>counter_cache: true</code> <code>COUNT(*) AS sprints_count</code> рдУрд░ рдкрд╣рд▓рд╛ рдХрджрдо рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ <code>COUNT(*) AS sprints_count</code> рдЖрдкрдХреЛ ActiveRecord рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдЧрд╛ (рдЖрдк рд╕рд╣реА <code>select()</code> ?), <code>select()</code> рдХреЛ рдмрджрд▓рдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣реЗрдВрдЧреЗ)ред  рдФрд░ <code>counter_cache</code> рдкрд░рд┐рдкреВрд░реНрдг рд╕реЗ рдмрд╣реБрдд рджреВрд░ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдХреИрд╢реНрдб рд╕реЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд░рд╛рд╢рд┐ рдХрд╛ рдПрдХ рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЕрд▓реМрдХрд┐рдХ, рдмреЗрд╢рдХ, рд▓реЗрдХрд┐рди рдЕрдкреНрд░рд┐рдпред  рдФрд░ рдпрд╣ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдмрд╕рдиреЗ рд╡рд╛рд▓рд╛ рдкрд╣рд▓рд╛ рдЙрдореНрдореАрджрд╡рд╛рд░ рд╣реИ рдФрд░ рдорд╛рдгрд┐рдХ рдорд╢реАрди рдХреЗ рдкрд╣рд▓реЗ рд╕реЗ рд▓реЛрдб рдХрд┐рдП рдЧрдП рд╕рд┐рд░ рдХреЛ рд▓реЛрдб рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рд╕рд┐рд░реНрдл рдПрдХ рджреЛ рдЯреНрд░рд┐рдЧрд░реНрд╕ рдФрд░ рдЖрдк рдХрд░ рд░рд╣реЗ рд╣реИрдВ!  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдкреНрд▓реЗрдЯ рдП рдореЗрдВ рдПрдХ рдирдпрд╛ рд░рд┐рдХреЙрд░реНрдб рд╣рдЯрд╛рддреЗ рдФрд░ рдЬреЛрдбрд╝рддреЗ рд╕рдордп, рдЖрдкрдХреЛ рдкреНрд▓реЗрдЯ рдмреА рдореЗрдВ рд░рд┐рдХреЙрд░реНрдб рдХреА рд╕рдВрдЦреНрдпрд╛ рдФрд░ рдпрд╣ рд╕рд╣реА рд╣реИ, рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ?  рдареАрдХ рд╣реИ, рдЬрдм рд╕рдВрдкрд╛рджрди, рдЬрд╝рд╛рд╣рд┐рд░ рд╣реИ, рдЕрдЧрд░ <code>foreign_key</code> рдмрджрд▓ рдЧрдпрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ <code>UPDATE B SET a_id = $1 WHERE id = $2</code> рдкреБрд░рд╛рдиреЗ A рдФрд░ рдирдП рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП <code>UPDATE B SET a_id = $1 WHERE id = $2</code> рддреЛрдбрд╝ рджреЗрдЧрд╛ред </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> update_#{parent_table}_#{child_table}_counter_on_insert() <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-type"><span class="hljs-type">TRIGGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$<span class="pgsql"><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">BEGIN</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">UPDATE</span></span></span><span class="pgsql"> #{parent_table} </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SET</span></span></span><span class="pgsql"> #{counter_column} = COALESCE((</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> COUNT(id) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> #{child_table} </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">GROUP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">BY</span></span></span><span class="pgsql"> #{foreign_column} </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">HAVING</span></span></span><span class="pgsql"> #{foreign_column} = </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">NEW</span></span></span><span class="pgsql">.#{foreign_column}), </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">0</span></span></span><span class="pgsql">) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> (#{parent_table}.id = </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">NEW</span></span></span><span class="pgsql">.#{foreign_column}); </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">RETURN</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">NULL</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">END</span></span></span><span class="pgsql">; $$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql;</code> </pre><br><p>  рдЕрдЧрд▓рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдкрде рджрд┐рдирд╛рдВрдХ-рд╕рдордп рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛрдЧрд╛ред  рдФрд░ рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП, рдЖрдЗрдП рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ <code>created_at</code> рдФрд░ <code>updated_at</code> рдлрд╝реАрд▓реНрдбреНрд╕ рдХреА рд╕реЗрд╡рд╛ рдХрд░реЗрдВ, рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдпрд╣ рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИред  рдкрд╣рд▓рд╛ рд╕реЗрдЯ рдЪреВрдХ: </p><br><pre> <code class="hljs ruby"> change_column_default <span class="hljs-symbol"><span class="hljs-symbol">:table_name</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:created_at</span></span>, -&gt; { <span class="hljs-string"><span class="hljs-string">'CURRENT_TIMESTAMP'</span></span> } change_column_default <span class="hljs-symbol"><span class="hljs-symbol">:table_name</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:updated_at</span></span>, -&gt; { <span class="hljs-string"><span class="hljs-string">'CURRENT_TIMESTAMP'</span></span> }</code> </pre> <br><p>  рдФрд░ рддреБрд░рдВрдд рдЗрд╕реЗ рд╣рд░ рдЬрдЧрд╣ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рд╕рднреА рдкреНрд▓реЗрдЯреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪрдХреНрд░ рдХрд╛ рдЖрдпреЛрдЬрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдпреЗ рдХреНрд╖реЗрддреНрд░ рд╣реИрдВред  <code>schema_migrations</code> рдФрд░ <code>ar_internal_metadata</code> рдЕрд▓рд╛рд╡рд╛, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ: </p><br><pre> <code class="hljs matlab"> (tables - <span class="hljs-comment"><span class="hljs-comment">%w(schema_migrations ar_internal_metadata)).each { ... }</span></span></code> </pre> <br><p>  рдпрд╣реА рд╣реИ, рдЕрдм рдЗрди рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдореВрд▓реНрдп рд╡рд╣реА рд╣реЛрдЧрд╛ рдЬреЛ рд╣рдореЗрдВ рдЪрд╛рд╣рд┐рдПред  рдФрд░ рдЕрдм рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ рдХрд┐ рд░реЗрд▓ рдЗрди рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рди рдЫреВрдПрдВред  рдпрд╣ рд╕рд╣реА рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рджреЛ рдмреЛрд▓реНрдЯреЛрдВ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдФрд░ рд╣рд╛рдВ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдврд╛рдВрдЪрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╡рд┐рдХрд▓реНрдк рд╣реИ: </p><br><pre> <code class="hljs lua">Rails.application.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.active_record.record_timestamps = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><p>  рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд▓рд╛ рдЪрд░рдг рд░рд┐рдХреЙрд░реНрдб рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рд╕рдордп рдЕрдкрдбреЗрдЯ рдХрд┐рдП <code>updated_at</code> рдлреАрд▓реНрдб рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛ рд╣реИред  рдпрд╣ рд╕рд░рд▓ рд╣реИ: </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> touch_for_#{<span class="hljs-built_in"><span class="hljs-built_in">table_name</span></span>}_on_update() <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-type"><span class="hljs-type">TRIGGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$<span class="pgsql"><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">BEGIN</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">CURRENT_TIMESTAMP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INTO</span></span></span><span class="pgsql"> </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">NEW</span></span></span><span class="pgsql">.updated_at; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">RETURN</span></span></span><span class="pgsql"> </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">NEW</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">END</span></span></span><span class="pgsql">; $$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql;</code> </pre> <br><p>  рдЕрдм рдЖрдкрдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ <code>touch: true</code> рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ <code>touch: true</code> рдореЙрдбрд▓ рдореЗрдВ <code>touch: true</code> ред  рдпрд╣ рдмрд╛рдд рдбреИрд╢ рдореЗрдВ рд▓рдХреНрд╖реНрдп рдХреЗ рд╕рдорд╛рди рд╣реИ - рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЫрд┐рджреНрд░рдкреВрд░реНрдг рднреАред  рдФрд░ рдореИрдВ рдпрд╣ рднреА рдирд╣реАрдВ рдмрддрд╛ рд╕рдХрддрд╛ рдХрд┐ рдХреНрдпреЛрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрди рд╕рднреА рдорд╛рдорд▓реЛрдВ рдХреЛ рдЬрд╛рдирддреЗ рд╣реИрдВред  рдпрд╣ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИ, рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдЖрдк рдХреЛ рд╣реА рдЕрджреНрдпрддрди рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ: </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> touch_for_#{<span class="hljs-built_in"><span class="hljs-built_in">table_name</span></span>}_on_update() <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-type"><span class="hljs-type">TRIGGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$<span class="pgsql"><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">BEGIN</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">UPDATE</span></span></span><span class="pgsql"> foreign_table_name </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SET</span></span></span><span class="pgsql"> updated_at = </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">CURRENT_TIMESTAMP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> id = </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">NEW</span></span></span><span class="pgsql">.foreign_column_name; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">CURRENT_TIMESTAMP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INTO</span></span></span><span class="pgsql"> </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">NEW</span></span></span><span class="pgsql">.updated_at; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">RETURN</span></span></span><span class="pgsql"> </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">NEW</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">END</span></span></span><span class="pgsql">; $$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql;</code> </pre> <br><p>  рдмреЗрд╢рдХ, рдРрд╕реЗ рдЯреНрд░рд┐рдЧрд░реНрд╕ рдХреА рдХреЙрд▓ рдХреА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдПрдХ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░реЗрдЧреА, рд▓реЗрдХрд┐рди рд╕рд╛рдиреЗ рддрдВрддреНрд░ рдХреЗ рдкреЛрд╕реНрдЯрдЧреНрд░реЗрдЬ рдореЗрдВ, рдЯреНрд░рд┐рдЧрд░реНрд╕ рдХреЛ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рдмрд┐рдирд╛ рд╣реА рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЖрдк <code>SET title = title</code> рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ <code>SET updated_at = CURRENT_TIMESTAMP</code> рд╕реЗ рдмреЗрд╣рддрд░ рдирд╣реАрдВ рд╣реИред </p><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ рд╣реА рдЯреНрд░рд┐рдЧрд░ рдбрд╛рд▓рдиреЗ рдкрд░ рд╣реЛрдЧрд╛, рдХреЗрд╡рд▓ <code>updated_at</code> рдЕрджреНрдпрддрди рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ: </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> touch_for_#{<span class="hljs-built_in"><span class="hljs-built_in">table_name</span></span>}_on_insert() <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-type"><span class="hljs-type">TRIGGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$<span class="pgsql"><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">BEGIN</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">UPDATE</span></span></span><span class="pgsql"> foreign_table_name </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SET</span></span></span><span class="pgsql"> updated_at = </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">CURRENT_TIMESTAMP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> id = </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">NEW</span></span></span><span class="pgsql">.foreign_column_name; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">RETURN</span></span></span><span class="pgsql"> </span><span class="hljs-built_in"><span class="pgsql"><span class="hljs-built_in">NEW</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">END</span></span></span><span class="pgsql">; $$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql;</code> </pre> <br><p>  рдмреЗрд╢рдХ, рдЖрдк <code>IF TG_OP = 'UPDATE' THEN</code> рд╕рдорд╛рди, рдЯреНрд░рд┐рдЧрд░ рдХреЗ рдЕрдВрджрд░ рд╡рд░реНрддрдорд╛рди рдИрд╡реЗрдВрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪреЗрдХ рдЬреЛрдбрд╝рдХрд░, рдЗрд╕реЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рд▓рд┐рдЦрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рддреНрд░реБрдЯрд┐ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдЯреНрд░рд┐рдЧрд░реНрд╕ рдХреЛ рдпрдерд╛рд╕рдВрднрд╡ рд╕рд░рд▓ рдмрдирд╛рдирд╛ рдмреЗрд╣рддрд░ рд╣реИред </p><br><p>  рдЖрдк рдЗрд╕ рддрд░рд╣ рдХреЗ рдЯреНрд░рд┐рдЧрд░реНрд╕ рдХреА рдкреАрдврд╝реА рдХреЛ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдЖрдкрдХреЛ рд╡рд░реНрддрдорд╛рди рдЯреЗрдмрд▓ рдФрд░ рдмрд╛рдХреА рдХреЗ рдмреАрдЪ рд╕рднреА рд╡рд┐рджреЗрд╢реА рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред  рдЖрдк рдЗрд╕ рдкреНрд░рд╢реНрди рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ccu.<span class="hljs-built_in"><span class="hljs-built_in">table_name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> foreign_table_name, kcu.<span class="hljs-built_in"><span class="hljs-built_in">column_name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">column_name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> information_schema.table_constraints <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tc <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> information_schema.key_column_usage <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> kcu <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tc.<span class="hljs-built_in"><span class="hljs-built_in">constraint_name</span></span> = kcu.<span class="hljs-built_in"><span class="hljs-built_in">constraint_name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> information_schema.constraint_column_usage <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ccu <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ccu.<span class="hljs-built_in"><span class="hljs-built_in">constraint_name</span></span> = tc.<span class="hljs-built_in"><span class="hljs-built_in">constraint_name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> constraint_type = <span class="hljs-string"><span class="hljs-string">'FOREIGN KEY'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tc.<span class="hljs-built_in"><span class="hljs-built_in">table_name</span></span> = <span class="hljs-string"><span class="hljs-string">'#{table_name}'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ccu.<span class="hljs-built_in"><span class="hljs-built_in">table_name</span></span>;</code> </pre><br><p>  рдПрдХ рдФрд░ рдмрд╣реБрдд рд╣реА рдЙрдкрдпреЛрдЧреА рдЯрд┐рдкред  рдЯреНрд░рд┐рдЧрд░ рдХреЛ рдЙрд╕реА рддрд░рд╣ рд╕реЗ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП рдЙрдкрд╕реНрдерд┐рддрд┐ рдпрд╛ рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЕрдиреБрд░реЛрдз рд╕рднреА рдЯрдЪ-рдЗрдВрд╕рд░реНрдЯ рдЯреНрд░рд┐рдЧрд░ рдкрд╛рдПрдВрдЧреЗ: </p><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> routine_name <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> information_schema.<span class="hljs-keyword"><span class="hljs-keyword">routines</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> routine_name <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'touch_for_%_on_insert'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> routine_type =<span class="hljs-string"><span class="hljs-string">'FUNCTION'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> specific_schema=<span class="hljs-string"><span class="hljs-string">'public'</span></span>;</code> </pre> <br><p>  рдФрд░ рдЕрдВрдд рдореЗрдВ, рд╕рдмрд╕реЗ рдЦрд░рд╛рдм рдмрдЪрд╛ рд╣реИред  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рд░реЗрд▓ рдХреЛ рдХрдо рд╕реЗ рдХрдо рдХрд┐рд╕реА рддрд░рд╣ рдХреЗ рд╕реНрдорд╛рд░реНрдЯ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдЙрдиреНрд╣реЛрдВрдиреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рдХреА рд╣реИ рдХрд┐ <code>id</code> рдХреНрд╖реЗрддреНрд░ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХрдо рд╕реЗ рдХрдо рдХреБрдЫ рдФрд░ рдЪреАрдЬреЗрдВ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдмрджрд▓ рд╕рдХрддреА рд╣реИрдВ, рдФрд░ рдХреЗрд╡рд▓ рдЬрдм рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрджреНрдпрддрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>RETURNING updated_at</code> рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рднреА рддрдВрддреНрд░ рдирд╣реАрдВ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5e2/741/5b9/5e27415b90ea63490670e7d4e2e4e758.jpg"></p><br><p>  рдореИрдирд┐рдкреИрдЪ рдмрд╣реБрдд рд╕рд╛рдл рдирд╣реАрдВ рдирд┐рдХрд▓рд╛, рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдпрд╣ рд▓рдХреНрд╖реНрдп рдерд╛ рдХрд┐ рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдХрдо рд╕реЗ рдХрдо рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЗ рдореМрдЬреВрджрд╛ рдХрд╛рдо рдХреЛ рдиреБрдХрд╕рд╛рди рдкрд╣реБрдВрдЪрд╛рдпрд╛ рдЬрд╛рдПред </p><br><div class="spoiler">  <b class="spoiler_title">рдореИрдВ рдЙрд╕реЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд▓рд╛рдКрдВрдЧрд╛</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">module ActiveRecord module Persistence # https://github.com/rails/rails/blob/v5<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/activerecord/lib/active_record/persistence.rb#L729-L741 def _create_record(attribute_names = self.attribute_names) attribute_names &amp;= self.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>.column_names attributes_values = attributes_with_values_for_create(attribute_names) an_id, *affected_rows = self.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>._insert_record(attributes_values).dup self.id ||= an_id <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>.primary_key Hash[ApplicationRecord.custom_returning_columns(self.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>.quoted_table_name, :<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>).take(affected_rows.size).zip(affected_rows)].<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> |<span class="hljs-built_in"><span class="hljs-built_in">column_name</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>| public_send("#{column_name}=", self.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>.attribute_types[<span class="hljs-built_in"><span class="hljs-built_in">column_name</span></span>.to_s].deserialize(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> @new_record = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> yield(self) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> block_given? id <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> private :_create_record # https://github.com/rails/rails/blob/v5<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/activerecord/lib/active_record/persistence.rb#L710-L725 def _update_record(attribute_names = self.attribute_names) attribute_names &amp;= self.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>.column_names attribute_names = attributes_for_update(attribute_names) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute_names.empty? affected_rows = [] @_trigger_update_callback = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> affected_rows = _update_row(attribute_names) @_trigger_update_callback = affected_rows.<span class="hljs-keyword"><span class="hljs-keyword">any</span></span>? <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> Hash[ApplicationRecord.custom_returning_columns(self.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>.quoted_table_name, :<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>).take(affected_rows.size).zip(affected_rows)].<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> |<span class="hljs-built_in"><span class="hljs-built_in">column_name</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>| public_send("#{column_name}=", self.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>.attribute_types[<span class="hljs-built_in"><span class="hljs-built_in">column_name</span></span>.to_s].deserialize(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> yield(self) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> block_given? affected_rows.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span>? ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> private :_update_record <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> module ConnectionAdapters module PostgreSQL module DatabaseStatements # https://github.com/rails/rails/blob/v5<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb#L93-L96 def exec_update(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span> = nil, binds = []) execute_and_clear(sql_with_returning(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>), <span class="hljs-type"><span class="hljs-type">name</span></span>, binds) { |result| <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>.wrap(result.<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>.first) } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> # https://github.com/rails/rails/blob/v5<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/activerecord/lib/active_record/connection_adapters/abstract/database_statements.rb#L147-L152 def <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span>(arel, <span class="hljs-type"><span class="hljs-type">name</span></span> = nil, pk = nil, _id_value = nil, sequence_name = nil, binds = []) <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>, binds = to_sql_and_binds(arel, binds) exec_insert(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span>, binds, pk, sequence_name).<span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>.first <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> # https://github.com/rails/rails/blob/v5<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb#L98-L111 def sql_for_insert(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>, pk, id_value, sequence_name, binds) # :nodoc: table_ref = extract_table_ref_from_insert_sql(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pk.nil? # Extract the <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>. Yuck. pk = primary_key(table_ref) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> table_ref <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> returning_columns = quote_returning_column_names(table_ref, pk, :<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> returning_columns.<span class="hljs-keyword"><span class="hljs-keyword">any</span></span>? <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span> = "#{sql} RETURNING #{returning_columns.join(', ')}" <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> super <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> source <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> original repo def quote_returning_column_names(table_ref, pk, action) returning_columns = [] returning_columns &lt;&lt; pk <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> suppress_composite_primary_key(pk) returning_columns += ApplicationRecord.custom_returning_columns(table_ref, action) returning_columns.map { |<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>| quote_column_name(<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> source <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> original repo def sql_with_returning(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>) table_ref = extract_table_ref_from_update_sql(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>) returning_columns = quote_returning_column_names(table_ref, nil, :<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> returning_columns.blank? "#{sql} RETURNING #{returning_columns.join(', ')}" <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> source <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> original repo def extract_table_ref_from_update_sql(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>[/<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>\s("[A-Za-z0-9_."\[\]\s]+"|[A-Za-z0-9_."\[\]]+)\s*<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>/im] Regexp.last_match(<span class="hljs-number"><span class="hljs-number">1</span></span>)&amp;.strip <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </div></div><br><p>  рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣рд╛рдБ рд╣рдо рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП <code>ApplicationRecord.custom_returning_columns</code> рдУрд░ рд░реБрдЦ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдИрдбреА рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХреМрди рд╕реЗ рдХреЙрд▓рдо рд╣рдорд╛рд░реЗ рд▓рд┐рдП рджрд┐рд▓рдЪрд╕реНрдк рд╣реИрдВред  рдФрд░ рдпрд╣ рд╡рд┐рдзрд┐ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддреА рд╣реИ: </p><br><pre> <code class="hljs vhdl"> class &lt;&lt; self def custom_returning_columns(table_ref, action) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ['<span class="hljs-string"><span class="hljs-string">"schema_migrations"</span></span>', '<span class="hljs-string"><span class="hljs-string">"ar_internal_metadata"</span></span>'].include?(table_ref) res = [] res &lt;&lt; :created_at <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> action == :create res &lt;&lt; :updated_at res += <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> table_ref <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> '<span class="hljs-string"><span class="hljs-string">"user_applications"</span></span>' [:api_token] <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> '<span class="hljs-string"><span class="hljs-string">"users"</span></span>' [:session_salt, :password_changed_at] # ... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> [] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><hr><br><p>  рдирд┐рд╖реНрдХрд░реНрд╖ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдпрд╣ рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐, рд░реЗрд▓ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХрд╛ рд╕рд┐рд░ рдереЛрдбрд╝рд╛ рдХрдо рд╣реЛ рдЧрдпрд╛ рд╣реИред  <code>counter_cache</code> рдФрд░ <code>touch</code> рдЬреИрд╕реА <code>counter_cache</code> рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдЧреБрдордирд╛рдореА рдореЗрдВ рдбреВрдм рдЬрд╛рдПрдВрдЧреА рдФрд░ рдЕрдЧрд▓реЗ рд▓реЗрдЦ рдореЗрдВ рд╣рдо рдХреБрдЫ рдФрд░ рдЧреНрд▓реЛрдмрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рд╣реИрдВрдЧрд┐рдВрдЧ рд╕реНрдкреЗрд╕ рдХреЛ рд╣рдЯрд╛рдирд╛, рдбреЗрдЯрд╛ рд╡реЗрд▓рд┐рдбреЗрд╢рди, рдХреИрд╕реНрдХреЗрдбрд┐рдВрдЧ рдбреЗрдЯрд╛ рдбрд┐рд▓реАрдЯ рдпрд╛ рдкреИрд░рд╛рдиреЙрдпрдб рдбрд┐рд▓реАрдЯред  рдЕрдЧрд░ рдЖрдкрдХреЛ рдпрд╣ рд▓реЗрдЦ рдкрд╕рдВрдж рдЖрдпрд╛ рд╣реЛ рддреЛ рдЕрд╡рд╢реНрдп </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi421939/">https://habr.com/ru/post/hi421939/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi421929/index.html">рдмреНрд░реЗрдХреНрд╕рд┐рдЯ рд╕реЗ рдПрдХ рд╕рд╛рд▓ рдкрд╣рд▓реЗ: рдмреНрд░рд┐рдЯреЗрди рд░реЛрдмреЛрдЯрд┐рдХреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╢реНрд░рдо рдХреА рдХрдореА рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi421931/index.html">рд▓рд┐рдирдХреНрд╕ 4.19 рдкреНрд░рджрд░реНрд╢рди рдкрд░ рд╕реНрдкреЗрдХреНрдЯрд░, рдореЗрд▓реНрдЯрдбрд╛рдЙрди, рдФрд░ рдлреЛрд░рд╢реИрдбреЛ рд╕рдВрд░рдХреНрд╖рдг рдХрд╛ рдкреНрд░рднрд╛рд╡</a></li>
<li><a href="../hi421933/index.html">DVR рдореЙрдбрд▓ QCM-08DL рдХреЗ рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо HDD рдХрд╛ рдЕрдзреНрдпрдпрди</a></li>
<li><a href="../hi421935/index.html">Ubuntu 16.04 LTS рд╕реЗ Ubuntu 18.04 LTS рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдХрд╛ рдкрд╣рд▓рд╛ рдЗрдВрдкреНрд░реЗрд╢рди</a></li>
<li><a href="../hi421937/index.html">рд╕реНрдорд╛рд░реНрдЯ рд╕рд┐рдЯреА рдХреЗ рдЕрдВрджрд░ - рд╣реБрдЖрд╡реЗрдИ рдХреА рдПрдХ рдЭрд▓рдХ</a></li>
<li><a href="../hi421945/index.html">Google рдФрд░ рдорд╛рд╕реНрдЯрд░рдХрд╛рд░реНрдб рджреБрдХрд╛рдиреЛрдВ рдореЗрдВ рдЦрд░реАрдж рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЧреБрдкреНрдд рд╕реМрджреЗ рдХрд╛ рд╕рдорд╛рдкрди рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi421947/index.html">8 рд╕рд┐рддрдВрдмрд░ рдХреЛ Android Devs Meetup рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ</a></li>
<li><a href="../hi421949/index.html">рдЖрддреНрдордШрд╛рддреА рджрд╕реНрддреЗ рд╣рдо рд╕рдмрд╕реЗ рднрдпрдВрдХрд░ рдЬреВрдирд┐рдпрд░ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреА рднрд░реНрддреА рдХреИрд╕реЗ рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi421953/index.html">Sum3r 0f h4ck: рдбрд┐рдЬрд┐рдЯрд▓ рд╕реБрд░рдХреНрд╖рд╛ рдкрд░ рдЧреНрд░реАрд╖реНрдордХрд╛рд▓реАрди рдЗрдВрдЯрд░реНрдирд╢рд┐рдк</a></li>
<li><a href="../hi421955/index.html">рд╕реАрдиреЗрдЯ рдирд╣реАрдВ рдЪрд╛рд╣рддрд╛ рд╣реИ рдХрд┐ рдмреАрдпрд░ рд╕реЗ рд░реЛрдмреЛрдЯ рд╡рд┐рдЪрд▓рд┐рдд рд╣реЛрдВред рдФрд░ рд╢реБрдХреНрд░рд╡рд╛рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдХреНрдпрд╛ рд▓рд┐рдЦрдирд╛ рд╣реИ?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>