<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💪🏼 🚓 🤴🏻 Le cheval est mort - Cri: transition du tslint au eslint 🙁 🍌 ⁉️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jusqu'à récemment, dans tous les projets du front, les développeurs de Dodo Pizza Engineering utilisaient tslint - un outil utile qui vous indique qua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le cheval est mort - Cri: transition du tslint au eslint</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/473648/">  Jusqu'à récemment, dans tous les projets du front, les développeurs de Dodo Pizza Engineering utilisaient tslint - un outil utile qui vous indique quand vous avez <s>foiré le code,</s> fait des inexactitudes, aide à maintenir le code dans le même style et corrige de nombreux commentaires.  Mais alors tslint a pris et est mort.  Sous la coupe, je vais vous dire pourquoi cela s'est produit, comment arrêter de verser des larmes sur le défunt et passer à l'outil eslint, et montrer également quelque chose de très intime. <br><br><img src="https://habrastorage.org/webt/gx/11/-s/gx11-spjbfgbactdyqkgvjz7ore.png"><br><a name="habracut"></a><br>  En fait, tout a commencé il y a longtemps: la dernière version du noyau tslint était déjà en 2016.  Et c'est le moment où il est temps de commencer à dire «dernier», si quelqu'un dit encore «dernier», car cette version était vraiment la dernière.  Le 19 février 2019, un article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">officiel a</a> été publié pour arrêter le développement de tslint.  Dans ce document, la société de développement (d'ailleurs, ce n'est même pas Microsoft) conseille vivement à tout le monde de passer à eslint, car leurs efforts viseront désormais à améliorer la prise en charge de TypeScript dans ce linter. <br><br><h2>  Une langue, une pile, une communauté </h2><br>  Microsoft considère TypeScript comme le principal langage de développement Web, qui devrait remplacer Java / ECMA Script.  De toute évidence, un objectif aussi ambitieux implique une seule pile d'outils pour l'ensemble du développement frontal.  Cela devrait grandement simplifier la migration de la grande communauté JS vers TypeScript.  En plus de la garantie de confiance de Microsoft, eslint a une meilleure architecture que tslint.  Par exemple, vous pouvez connecter des analyseurs et il y a plus de choix de règles connectées. <br><br>  Microsoft ne serait pas lui-même s'il le voulait.  Quoi que nous disions sur la qualité de leurs logiciels, ils font d'excellents outils de développement (et, en passant, des périphériques d'entrée).  Cette fois, ils ne sont donc pas venus les mains vides, mais ont rédigé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un plan de migration</a> .  Conformément à ce plan, l'élaboration des règles tslint a déjà été interrompue le 1er août 2019 et le développement de tslint lui-même cessera le 1er novembre 2019.  Bien que, pour être honnête, le développement ait été interrompu depuis longtemps (voir ci-dessus pour la dernière version). <br><br>  Ici, il devrait devenir évident pour le lecteur qu'il est temps de passer à eslint, il n'y a pas d'autre choix.  Pour sucrer la pilule, il convient de dire que: <br><br><ul><li>  tandis que tslint se concentre sur TypeScript en mettant davantage l'accent sur l'utilisation correcte des types et la vérification de la syntaxe, eslint couvre tout ce qui peut être à l'avant, y compris la syntaxe des composants React; </li><li>  eslint a beaucoup plus de règles prédéfinies; </li><li>  il existe des règles (et plugins) qui vérifient le code au niveau du bloc (duplication de code, complexité perçue, etc.); </li><li>  il existe des plugins qui ne vérifient pas du tout le code, mais, par exemple, les expressions régulières. </li></ul><br>  En général, il semble que la transition vers un nouveau linter, qui est un produit traditionnel, nous ouvrira tout un monde d'opportunités inédites.  Eh bien, essayons! <br><br><h2>  Ajouter eslint au projet </h2><br>  Je vais parler de la migration des règles ci-dessous.  En attendant, configurez un projet pour travailler avec eslint. <br>  Si vous avez déjà un projet avec tslint, supprimez d'abord tous les packages liés à tslint: tslint lui-même, tslint-react, tslint-config-prettier, etc. <br><br>  Ajoutez maintenant des packages eslint au projet (définissez tout comme devDependencies): <br><br><ul><li>  se scintiller; </li><li>  @ typescript-eslint / parser - moteur pour analyser TypeScript; </li><li>  @ typescript-eslint / eslint-plugin - jeux de règles pour TypeScript </li></ul><br><h2>  Configuration minimale Eslint </h2><br>  Créez le fichier de configuration .eslintrc.json.  Eslint prend en charge de nombreux formats de fichiers pour sa configuration, mais JSON semble le plus pratique.  Voici à quoi ressemble l'option de travail minimale: <br><pre><code class="json hljs">{ //   <span class="hljs-attr"><span class="hljs-attr">"env"</span></span>: { //    <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, //   ES6 <span class="hljs-attr"><span class="hljs-attr">"es6"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, //   ES2017 <span class="hljs-attr"><span class="hljs-attr">"es2017"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, //   <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ //    eslint <span class="hljs-string"><span class="hljs-string">"eslint:recommended"</span></span>, //      <span class="hljs-string"><span class="hljs-string">"plugin:@typescript-eslint/eslint-recommended"</span></span>, //    TypeScript <span class="hljs-string"><span class="hljs-string">"plugin:@typescript-eslint/recommended"</span></span>, //  TS,     <span class="hljs-string"><span class="hljs-string">"plugin:@typescript-eslint/recommended-requiring-type-checking"</span></span> ], //   <span class="hljs-attr"><span class="hljs-attr">"parser"</span></span>: <span class="hljs-string"><span class="hljs-string">"@typescript-eslint/parser"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"parserOptions"</span></span>: { //    TS     <span class="hljs-attr"><span class="hljs-attr">"project"</span></span>: <span class="hljs-string"><span class="hljs-string">"tsconfig.json"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tsconfigRootDir"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>, }, //      TypeScript <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [<span class="hljs-string"><span class="hljs-string">"@typescript-eslint"</span></span>], <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: {} }</code> </pre> <br>  La section <code>env</code> indique à eslint les options de votre projet.  Dans mon exemple, il s'agit d'un projet pour le navigateur (c'est-à-dire que le code fonctionnera dans le navigateur).  Écrire pour Node.JS - définir le nœud: vrai.  Les deux options suivantes indiquent le dialecte du JS en cours de test.  En général, nous vérifierons le code pour TypeScript, mais si votre projet contient également du code pour JS, n'oubliez pas de les resserrer.  Pour nous-mêmes, nous avons décidé de définir ces paramètres sur la même valeur que target dans tsconfig.json. <br><br>  Il n'y a rien de controversé dans les ensembles de règles eslint standard, comme le point-virgule requis à la fin des expressions ou des espaces / tabulations.  Toutes les règles sont particulièrement utiles.  Vous pouvez voir quelles règles et avec quel niveau sont inclus <a href="">ici</a> . <br><br>  La ligne suivante, vous devez <a href="">désactiver la</a> moitié des règles.  Cela est nécessaire car ils ne fonctionnent pas avec TypeScript et au lieu de fonctionner normalement, ils génèrent un tas d'erreurs. <br><br>  Ensuite, vous devez connecter les règles recommandées de TypeScript dans un sac séparé.  Ici, vous devez garder à l'esprit que <a href="">les règles de syntaxe générales</a> (telles que l'interdiction de var) fonctionneront ainsi. <br><br>  Mais pour les règles qui <a href="">utilisent des types TS</a> (par exemple, @ typescript-eslint / no-inutile-type-assertion), le moteur TypeScript est nécessaire.  Et le moteur aura besoin du fichier tsconfig.json, dont le chemin doit être spécifié. <br><br>  Dans tsconfig.json, chez Dodo Pizza Engineering, nous spécifions généralement les tests d'exclusion et de rejet afin qu'ils ne soient pas construits avec le projet.  Mais pour qu'eslint fonctionne, vous devez spécifier et inclure.  Autrement dit, tous les fichiers qui doivent être lintés doivent être explicitement inclus dans le projet.  Sans cela, eslint jurera à chaque fichier qu'il trouve: "Le fichier n'est pas dans le projet, je ne ferai rien, je lancerai un tas d'erreurs."  Il existe une option sans spécifier explicitement les fichiers de projet - définissez le paramètre <code>createDefaultProgram: true</code> .  Cela signifie essentiellement: "Tout ce que vous trouvez est Parsi."  Mais les développeurs déconseillent fortement de le faire en raison d'une baisse significative des performances. <br><br>  Si vous utilisez ForkTsCheckerWebpackPlugin pour traiter les fichiers TypeScript, remplacez <code>tslint: true</code> par <code>eslint: true</code> dans ses paramètres (dans webpack.config.ts). <br><br>  Il vaut également la peine de configurer le lancement du linter à partir de la ligne de commande.  Avant cela, ajoutez cette valeur à la section des scripts dans <code>package.json</code> : <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"eslint"</span></span>: <span class="hljs-string"><span class="hljs-string">"eslint --cache --ext .js,.jsx,.ts,.tsx src"</span></span>, <span class="hljs-string"><span class="hljs-string">"eslint:dump"</span></span>: <span class="hljs-string"><span class="hljs-string">"eslint --print-config ./.eslintrc.json"</span></span>,</code> </pre> <br>  La première ligne commence juste la vérification eslint sans construire le projet.  La seconde affiche les paramètres eslint actuels, ce qui vous permet de voir les paramètres des paramètres de règle. <br><br>  Dans cette version, eslint fonctionnera déjà dans le projet et attrapera même des bancs: redéfinition des globales, variables inutilisées, etc. <br><br><h2>  Configuration du code Visual Studio </h2><br>  Après avoir parcouru tout ce chemin, vous pouvez déjà démarrer le linter à partir de la ligne de commande.  Il sera également implicitement lancé lors de la construction du projet.  Mais dans Visual Studio Code, nous ne verrons pas les commentaires du linter.  Comment ça?! <br><br>  Il existe un plugin eslint pour le studio (dbaeumer.vscode-eslint), il doit être installé.  Après cela, rien ne fonctionnera de toute façon, rien ne sera souligné et corrigé.  Pourquoi?  Parce que le plugin a une configuration, qui dit que vous devez travailler uniquement dans des fichiers JavaScript. <br><br>  Ce paramètre sournois n'est pas fait dans l'interface utilisateur, vous devez donc aller dans le fichier de paramètres du studio et ajouter manuellement les langues dont vous avez besoin au paramètre eslint.validate.  Une liste complète des langues peut être trouvée dans les entrailles de la documentation du studio.  Voici à quoi ressemble ce paramètre avec nous: <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"eslint.validate"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"javascript"</span></span>, <span class="hljs-string"><span class="hljs-string">"javascriptreact"</span></span>, <span class="hljs-string"><span class="hljs-string">"typescriptreact"</span></span>, <span class="hljs-string"><span class="hljs-string">"typescript"</span></span>, ],</code> </pre> <br>  Après cela, redémarrez le studio et tout commencera enfin à fonctionner. <br><br><h2>  Reste maintenant à configurer les règles </h2><br>  Le projet est mis en place.  Maintenant sur les règles, car dans l'exemple ci-dessus la liste des règles était vide. <br><br>  Je dois dire que tslint ne nous a pas empêchés de gâcher dans un code formellement correct.  Par exemple, oubliez attendre.  Eslint est capable de trouver de telles erreurs sémantiques et de le jurer: informer que la valeur de retour est Promise, mais pour cela, pour une raison quelconque, l'attente n'est pas écrite.  Cela inclut également des problèmes stylistiques de complexité moyenne: l'utilisation d'une lambda ou d'une fonction, etc., ce que Prettier ne peut plus faire. <br><br>  Concernant les règles simples: position des crochets, tabulations vs.  espaces, etc., on pense qu'ils devraient être donnés à Prettier ou à un paquet similaire.  Mais dans le linter, ils doivent être laissés de toute façon: c'est la dernière frontière, qui est toujours en mesure d'arrêter le développeur négligent de l'ensemble de projet déchu.  De plus, cette ligne peut être automatisée: par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">husky</a> , vous permet de démarrer le linter automatiquement pour chaque commit. <br><br>  Nous avons décidé de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne migrer</a> aucun des ensembles de règles tslint que nous avons.  Et créez votre propre ensemble à partir de zéro. <br><br>  Il existe des jeux de règles prédéfinis pour eslint: <br><br><ul><li>  ESLint Recommended est un ensemble de règles neutres conçu avec l'idée de ne pas engendrer d'holivars.  Seuls les contrôles évidemment nécessaires sont inclus: variables non utilisées, etc.  Tous les ensembles suivants prolongent celui-ci. </li><li>  Google - il y a déjà une raison pour holivar: pour l'indentation il y a strictement des espaces, un point-virgule est requis. </li><li>  AirBnB - Il existe également des règles de style strictes, y compris un point-virgule obligatoire. </li><li>  Standart - les points-virgules sont interdits ici, mais les virgules de fin sont également interdites. </li></ul><br>  Nous n'avons aimé aucun des forfaits prêts à l'emploi.  Cela peut sembler étrange, mais il est important pour nous de passer à un nouveau linter, en évitant les guerres stylistiques.  Si nous écrivons comme ça partout (tabulations, sans point-virgule, les virgules de fin sont obligatoires), alors laissez-le rester - l'essentiel est qu'il en soit de même dans tous les projets. <br><br><h2>  Sexe promis: son propre ensemble de règles </h2><br>  Honnêtement, pour montrer votre jeu de règles eslint, c'est comme une fille montrant des seins: il n'y a plus de secrets.  J'ai longtemps pensé si cela valait la peine.  Mais, après avoir consulté d'autres filles, j'ai décidé que cela en valait la peine. <br><br>  Je vais commencer par les plugins que nous utilisons: <br><br><ul><li>  react - vérifie le code du composant react.  Ensemble de règles de base plus le nôtre.  De l'important: nous nous noyons pour les composants fonctionnels purs; </li><li>  react-hooks - règles des développeurs de react concernant l'utilisation des hooks; </li><li>  promise - vérifie les erreurs courantes lors de l'utilisation de Promise.  Cela fonctionne un peu bizarrement avec le code TypeScript.  De l'important: nous essayons d'utiliser Promise partout et de ne pas utiliser de callbacks puis / catch en raison d'une meilleure lisibilité du code; </li><li>  Optimiser-regex est un plugin amusant qui donne des conseils sur l'amélioration des expressions régulières.  Pas très utile, car regexp nous en avons un peu.  Mais loin de tout posséder la magie regexp.  C'est donc utile, mais il n'y a pas grand-chose à demander; </li><li>  sonarjs est un plug-in d'incendie qui vérifie la complexité du code et les erreurs de refactorisation typiques.  Le premier est drôle: le plugin évalue la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">complexité perçue du</a> code et donne des conseils quand cela vaut la peine de simplifier le code.  La recherche d'erreurs de refactoring permet aussi souvent de simplifier le code ou, au moins, d'améliorer la lisibilité; </li><li>  @ typescript-eslint - règles eslint pour vérifier le code TypeScript.  Et un ensemble pour désactiver les règles de base qui ne sont pas compatibles avec TS. </li></ul><br>  Notre fichier de règles complet est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Je note que ce n'est pas un dogme et est mis à jour car il s'adapte aux projets. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473648/">https://habr.com/ru/post/fr473648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473636/index.html">Télécharger 16 Go de torrent via tablette avec 4 Go d'espace libre</a></li>
<li><a href="../fr473638/index.html">Shader n'est pas magique. Écriture de shaders dans Unity. Présentation</a></li>
<li><a href="../fr473640/index.html">Coucher de soleil Big Data</a></li>
<li><a href="../fr473642/index.html">Cribble Crabble Gradle: Auto-Build Magic</a></li>
<li><a href="../fr473646/index.html">Hackathon dans une petite entreprise: comment organiser sans vider un train de ressources</a></li>
<li><a href="../fr473652/index.html">Création d'une API REST avec Node.js et une base de données Oracle. Partie 5</a></li>
<li><a href="../fr473654/index.html">Compositeur PHP: corriger les dépendances sans douleur</a></li>
<li><a href="../fr473656/index.html">Expérience de générateur de site statique Hugo</a></li>
<li><a href="../fr473658/index.html">Gérer les bogues dans Go 1.13</a></li>
<li><a href="../fr473660/index.html">Arcade Reverse Engineering: Record Michael Jordan au NBA Jam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>