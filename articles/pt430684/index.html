<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¨ üßôüèø üõï Digitaliza√ß√£o de contratos do Ethereum ao vivo para erro de envio n√£o verificado. Parte 2 üíÄ üë∫ üë®‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continua√ß√£o do artigo ‚ÄúDigitalizando contratos do Ethereum ao vivo para o erro de envio n√£o verificado‚Äù. Parte 1 " . 


 Quase um ano atr√°s (enquanto ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Digitaliza√ß√£o de contratos do Ethereum ao vivo para erro de envio n√£o verificado. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430684/"><h3></h3><p>  Continua√ß√£o do artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúDigitalizando contratos do Ethereum ao vivo para o erro de envio n√£o verificado‚Äù.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1 "</a> . </p><br><p>  Quase um ano atr√°s (enquanto o Ethereum estava em seu lan√ßamento "de fronteira"), o popular contrato de loteria EtherPot <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[9]</a> tamb√©m sofreu com o mesmo erro.  Uma vers√£o anterior do BTCRelay tamb√©m mostrou esse erro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[7]</a> .  Embora um perigo tenha sido detectado em uma auditoria de seguran√ßa anterior, uma corre√ß√£o incorreta foi aplicada primeiro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[8]</a> . </p><a name="habracut"></a><br><h3>  Detec√ß√£o de erro de envio n√£o verificado no blockhain ativo </h3><br><p> Qu√£o comuns s√£o esses erros?  Eles ouvem avisos?  As melhores pr√°ticas s√£o aplicadas?  Respondemos a essas perguntas empiricamente analisando os dados da cadeia de blocos Ethereum, bem como o reposit√≥rio de c√≥digos Solidity encontrado em etherscrape.com.  Para isso, estamos desenvolvendo uma ferramenta simples de an√°lise de programa que verifica o contrato da cadeia de blocos e usa heur√≠sticas para verificar se um dos m√©todos de prote√ß√£o mais eficazes √© usado.  A Listagem 2 mostra a primeira t√©cnica de seguran√ßa, conforme recomendado na documenta√ß√£o do Ethereum, que deve verificar o valor de retorno de <strong>send</strong> e lan√ßar uma exce√ß√£o.  Para detectar o uso desse m√©todo, usamos uma aproxima√ß√£o aproximada: apenas verificamos se o valor de retorno do <strong>envio √©</strong> ignorado ou n√£o. <br><br>  A Listagem 4 ilustra a segunda t√©cnica de seguran√ßa recomendada no manual do UMD, que verifica diretamente se a <strong>pilha de chamadas</strong> est√° <strong>cheia</strong> enviando uma mensagem de teste.  Para descobrir essa t√©cnica, usamos novamente uma aproxima√ß√£o aproximada: apenas verificamos se uma mensagem est√° sendo enviada al√©m do comando <strong>send</strong> . <br><br>  Se nenhum desses indicadores heur√≠sticos estiver presente, conclu√≠mos que nenhuma das recomenda√ß√µes de melhores pr√°ticas est√° sendo seguida.  Implementamos essas heur√≠sticas usando a correspond√™ncia simples de padr√µes com o bytecode compilado do EVM.  Mais detalhes sobre como fazemos isso podem ser encontrados no Ap√™ndice <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[12]</a> . </p><br><h3>  Quantos contratos s√£o vulner√°veis? </h3><br><p>  Vamos come√ßar verificando a heur√≠stica no reposit√≥rio Etherscrape do c√≥digo fonte do Solidity.  Em 20 de mar√ßo de 2016, o rel√© Etherscrape continha 361 programas de contratos Solidity, 56 dos quais continham uma declara√ß√£o de envio.  Desses programas contratuais, assumimos que a maioria (pelo menos 36 de 56) n√£o usa nenhum dos m√©todos de programa√ß√£o defensiva. <br><br>  Mesmo que o contrato n√£o use nenhuma das tecnologias de prote√ß√£o, ele pode ou n√£o ter uma vulnerabilidade real.  Verificamos manualmente os contratos do Solidity para confirmar a vulnerabilidade.  Para nossos prop√≥sitos, consideramos um contrato vulner√°vel se seu estado puder mudar mesmo que o comando <strong>send</strong> n√£o funcione (portanto, veremos o c√≥digo vulner√°vel na Listagem 5).  Confirmamos que a grande maioria das vulnerabilidades est√° presente, 32 dos 36 desses contratos. <br></p><br><p>  Da mesma forma, nossa heur√≠stica n√£o garante a correta aplica√ß√£o da programa√ß√£o defensiva.  Tomemos, por exemplo, o WeiFund, um DApp descentralizado de crowdfunding de c√≥digo aberto.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=http://hackingdistributed.com/2016/06/16/scanning-live-ethereum-contracts-for-bugs/-%2520">Este contrato</a> tem duas fun√ß√µes: <strong>reembolso ()</strong> e <strong>pagamento ()</strong> , que enganam nossa heur√≠stica.  A seguir, um trecho do <strong>reembolso</strong> . <br></p><br><p></p><pre><code class="plaintext hljs">function refund(uint _campaignID, uint contributionID) public { ... receiver.send(donation.amountContributed); donation.refunded = true; ... if(c.config != address(0)) WeiFundConfig(c.config).refund(_campaignID, donation.contributor, donation.amountContributed); }</code> </pre> <br><p>  Nesse c√≥digo, uma mensagem √© enviada ao WeiFundConfig (c.config) para chamar o m√©todo de reembolso, mas apenas sob certas condi√ß√µes.  Se c.config for um valor nulo, o contrato estar√° realmente vulner√°vel a um ataque de pilha de chamada.  Ao marcar *, nenhum dos programas Solidity que passaram no teste heur√≠stico realmente aplicou diretamente a melhor pr√°tica recomendada de teste de pilha de chamada.  * <br><br>  Em seguida, voltamos nossa aten√ß√£o para os contratos elaborados na cadeia de blocos viva Ethereum.  Vimos a imagem de 20 de mar√ßo de 2016 (carimbo de data / hora: 1184243).  Esse instant√¢neo cont√©m um total de 13645 cadeias de blocos, aparentemente geradas pelo compilador Solidity, das quais apenas 1618 (11,8%) inclu√≠ram o comando <strong>send</strong> . <br><br>  Destes, a grande maioria parece n√£o usar nenhuma das t√©cnicas defensivas de programa√ß√£o. <br></p><br><p>  E o problema da corrida recursiva no TheDAO?  O contrato inteligente mais emocionante atualmente, TheDAO <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[11]</a> , sofre de um erro completamente separado, que √© o fato de n√£o ser "seguro para reutiliza√ß√£o" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[13]</a> .  Esse √© outro tipo de programa√ß√£o insegura (conectada, mas distinta), que tamb√©m era esperada em verifica√ß√µes de seguran√ßa anteriores <a href="">[6]</a> , mas, como antes, √© prov√°vel que muitos contratos n√£o sejam seguros atualmente.  O trabalho futuro foi criar uma ferramenta que tamb√©m pudesse detectar esse erro. <br></p><br><h3>  Onde tudo deu errado? </h3><br><p>  N√£o esperamos que a programa√ß√£o de contratos inteligentes seja completamente simples, pelo menos por enquanto.  No entanto, √© surpreendente que essa forma espec√≠fica de erro seja t√£o difundida, apesar do fato de ter sido descrita h√° muito tempo durante o desenvolvimento do ecossistema Ethereum. <br><br>  Um relat√≥rio de 2015 <a href="">[6]</a> fez essa recomenda√ß√£o aos desenvolvedores do Ethereum: " <br><br>  Atualmente, os exemplos de programa√ß√£o apresentados na documenta√ß√£o s√£o insuficientes para disseminar as melhores pr√°ticas para escrever contratos seguros e resolver o problema do mecanismo de g√°s.  Os tutoriais introdut√≥rios do C ++ geralmente ignoram <br>  verifica√ß√£o de erros quanto √† legibilidade, o que levou a v√°rios erros de seguran√ßa.  Os exemplos do Ethereum devem ensinar os melhores h√°bitos.  Recomenda√ß√£o: forne√ßa ainda mais exemplos da programa√ß√£o cuidadosa dos contratos de seguran√ßa ". <br><br>  Conhecemos apenas uma resposta oficial para essa pergunta, que √© adicionar um aviso √† documenta√ß√£o oficial do Solidity mencionada anteriormente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[3],</a> repetida abaixo: "Existe algum perigo ao usar o <strong>envio</strong> : A transmiss√£o falha se a profundidade da pilha de chamadas for 1024 (isso sempre pode ser chamado pelo chamador) e tamb√©m falha se o destinat√°rio ficar sem g√°s, para garantir uma transmiss√£o segura, sempre verifique o valor de retorno do <strong>envio</strong> ou melhor: use o padr√£o  em que o destinat√°rio retira dinheiro ". </p><br><p>  Acreditamos que essa observa√ß√£o n√£o √© suficiente para documentar o problema.  Ele oferece apenas mitiga√ß√£o incompleta e descreve apenas uma vers√£o do perigo, potencialmente enganando o leitor sobre seu grau. </p><br><ul><li><p>  Atualiza√ß√£o: <br>  A inadequa√ß√£o da documenta√ß√£o do Solidity tamb√©m foi ilustrada em detalhes por Peter Wesenes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[16]</a> </p><br></li></ul><p>  Al√©m disso, o aviso parece frequentemente ignorado.  Portanto, acreditamos que s√£o necess√°rias medidas preventivas adicionais. </p><br><br><h3>  Como a Etherscrape pode ajudar? </h3><br><p>  Acreditamos que o uso de ferramentas de an√°lise est√°tica, mesmo as cruas, como as descritas neste post, pode ajudar a melhorar a qualidade dos contratos inteligentes.No Etherscrape, integramos ferramentas de an√°lise como essa em nosso servi√ßo p√∫blico da Web e adicionamos um link √† p√°gina da ferramenta quando ela estiver pronta.  Isso facilitar√° a exibi√ß√£o do c√≥digo do contrato inteligente, destacando os locais onde podem ocorrer erros.  Assumimos que os usu√°rios de um contrato t√£o inteligente (por exemplo, potenciais investidores no TheDAO ou em suas ofertas) possam usar facilmente ferramentas como verifica√ß√£o de sanidade antes de depositar seu dinheiro.  At√© investidores n√£o t√©cnicos podem responsabilizar os desenvolvedores por explicar como reagiram aos problemas observados no c√≥digo. <br><br>  O Etherscrape tamb√©m ajuda na an√°lise da cadeia de blocos p√∫blica e no controle da preval√™ncia desse erro, o que pode ajudar a decidir, por exemplo, quanto dinheiro deve ser alocado para pesquisa e desenvolvimento de ferramentas de an√°lise est√°tica.  Al√©m disso, compiladores como o <strong>solc</strong> podem integrar essas an√°lises, fornecendo um aviso ao programador quando um erro parecer prov√°vel. <br></p><br><h3>  Leitura Recomendada </h3><br><ul><li>  [1] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Passo a passo para a cria√ß√£o de um contrato inteligente e seguro</a> <br></li><li>  [2] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia do Programador do UMD para Ethereum e Serpente (Se√ß√£o 5.14)</a> <br></li><li>  [3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Documentos oficiais do Ethereum Solidity</a> <br></li><li>  [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rei do √âter: Investiga√ß√£o Post-Mortem</a> <br></li><li>  [5] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Swende sobre seguran√ßa contratual.</a> <br></li><li>  [6] <a href="">Auditoria de menor autoridade do Ethereum.</a> <br></li><li>  [7] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Auditoria de retransmiss√£o BTC 1</a> <br></li><li>  [8] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Auditoria de retransmiss√£o BTC 2</a> <br></li><li>  [9] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Relat√≥rio de bug de seguran√ßa EtherPot</a> <br></li><li>  [10] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Contratos reentrantes</a> <br></li><li>  [11] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DAO (Organiza√ß√£o Aut√¥noma Descentralizada).</a> <br></li><li>  [12] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ap√™ndice A: detalhes sobre como analisamos o blockchain</a> <br></li><li>  [13] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pedido de uma morat√≥ria tempor√°ria no DAO.</a> <br></li><li>  [14] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ap√™ndice B: Contratos vulner√°veis ‚Äã‚Äãde solidez.</a> <br></li><li>  [15] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ap√™ndice C: Contratos vulner√°veis ‚Äã‚Äãde blockchain</a> <br></li><li>  [16] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ethereum Griefing</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Carteiras: enviar com arremesso √© perigoso</a> <br></li></ul><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt430684/">https://habr.com/ru/post/pt430684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt430674/index.html">A l√≥gica da constru√ß√£o de hor√°rios de trabalho universais</a></li>
<li><a href="../pt430676/index.html">Antiguidades: shshshsh, sssssss, VOIP, BBS e outros amigos do modem</a></li>
<li><a href="../pt430678/index.html">Teste de dez dimmers com l√¢mpadas LED</a></li>
<li><a href="../pt430680/index.html">Escrevendo um processador e ambiente simples para ele</a></li>
<li><a href="../pt430682/index.html">Tr√™s anos do projeto de microssat√©lites lunares: est√°gios de crescimento</a></li>
<li><a href="../pt430686/index.html">Vis√£o geral: a primeira m√°quina de corte a jato de √°gua da WAZER</a></li>
<li><a href="../pt430688/index.html">Transfer√™ncia de dados via QR animado para Gomobile e GopherJS</a></li>
<li><a href="../pt430690/index.html">Exce√ß√µes determin√≠sticas e tratamento de erros em "C ++ do futuro"</a></li>
<li><a href="../pt430692/index.html">Engenharia social com software Universal Windows Platform (APPX)</a></li>
<li><a href="../pt430694/index.html">Um pequeno guia para aprender C ++: o que, quando e sobre o que criar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>