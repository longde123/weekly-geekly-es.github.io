<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤·ğŸ½ ğŸšµğŸ¾ ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ¼ Apakah pemrogram YML memimpikan pengujian yang mungkin dilakukan? ğŸŒ¼ â›”ï¸ ğŸ’¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah versi teks dari kinerja 2018-04-25 di Saint-Petersburg Linux User Group . Kode contoh di sini: https://github.com/ultral/ansible-role-testi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apakah pemrogram YML memimpikan pengujian yang mungkin dilakukan?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437004/"><p><img src="https://habrastorage.org/webt/ct/me/vo/ctmevotjzsrr0s-5_erinl_pedk.png" alt="skema dapur-ci"></p><br><p>  Ini adalah versi teks dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kinerja</a> 2018-04-25 di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Saint-Petersburg Linux User Group</a> .  Kode contoh di sini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/ultral/ansible-role-testing</a> </p><br><p>  Saya percaya bahwa Anda menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">manajemen konfigurasi, bukan bash</a> .  Yaitu  konfigurasi Anda adalah kode.  Jika kita mengatakan bahwa infrastruktur adalah kode, maka filosofi yang sama harus diterapkan pada pembuatannya seperti untuk pengembangan perangkat lunak.  Sudahkah Anda memikirkan hal ini?  Bagaimana kamu melakukannya?  Dan lainnya? </p><a name="habracut"></a><br><h1 id="prerekvizity">  Prasyarat </h1><br><p>  Dalam kasus yang dijelaskan, ada banyak yang pengantar: </p><br><ul><li>  Banyak peran yang mungkin. </li><li>  Hyper-V sebagai hypervisor utama. </li><li> Cloud pribadi dengan kemampuan terbatas untuk membuat mesin virtual dengan cepat. </li><li>  Proksi untuk akses ke Internet. </li><li>  Ketidakmampuan untuk menjalankan pengujian peran yang mungkin dilakukan di buruh pelabuhan, karena peran tersebut adalah konfigurasi dari keseluruhan VM, termasuk pengaturan jaringan misalnya. </li><li>  Ingin menggunakan kebijakan panduan hijau untuk repositori dengan peran yang dimungkinkan. </li></ul><br><p>  Sebelum kita melakukan apa yang kita lakukan, kita membandingkan solusi yang ada. </p><br><table><thead><tr><th>  Proyek </th><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dapur uji</a> </th><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Molekul</a> </th><th>  Milik sendiri </th></tr></thead><tbody><tr><td>  Bahasa </td><td>  ruby </td><td>  ular sanca </td><td>  bash / ruby </td></tr><tr><td>  Pengamat </td><td>  132 </td><td>  126 </td><td>  0 </td></tr><tr><td>  Bintang </td><td>  1413 </td><td>  1154 </td><td>  1 </td></tr><tr><td>  Garpu </td><td>  502 </td><td>  174 </td><td>  2 </td></tr><tr><td>  Lisensi </td><td>  Apache 2.0 </td><td>  MIT </td><td>  Apa saja </td></tr><tr><td>  Berkomitmen </td><td>  1929 </td><td>  1264 </td><td>  0 </td></tr><tr><td>  Rilis </td><td>  101 </td><td>  121 </td><td>  0 </td></tr><tr><td>  Kontributor </td><td>  109 </td><td>  82 </td><td>  5 </td></tr></tbody></table><br><table><thead><tr><th>  Nama </th><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">testinfra</a> </th><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">serverpec</a> </th><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">inspec</a> </th><th>  Goss </th></tr></thead><tbody><tr><td>  Github </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">philpep / testinfra</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mizzy / serverpec</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">koki / inspec</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">aelsabbahy / goss</a> </td></tr><tr><td>  Bahasa </td><td>  ular sanca </td><td>  ruby </td><td>  ruby </td><td>  pergi </td></tr><tr><td>  Pengamat </td><td>  93 </td><td>  145 </td><td>  165 </td><td>  67 </td></tr><tr><td>  Bintang </td><td>  997 </td><td>  2105 </td><td>  1167 </td><td>  2170 </td></tr><tr><td>  Garpu </td><td>  138 </td><td>  361 </td><td>  330 </td><td>  156 </td></tr><tr><td>  Lisensi </td><td>  Apache 2.0 </td><td>  MIT </td><td>  Apache 2.0 </td><td>  Apache 2.0 </td></tr><tr><td>  Berkomitmen </td><td>  380 </td><td>  1854 </td><td>  4609 </td><td>  309 </td></tr><tr><td>  Rilis </td><td>  35 </td><td>  282 </td><td>  346 </td><td>  47 </td></tr><tr><td>  Kontributor </td><td>  43 </td><td>  110 </td><td>  159 </td><td>  31 </td></tr></tbody></table><br><p>  Kami memutuskan untuk tidak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menemukan kembali roda</a> dan mengambil solusi turnkey.  Tim infrastruktur kami tahu ruby, jadi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Test Kitchen</a> &amp; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">inspec</a> dipilih </p><br><h1 id="kitchen-ci">  Dapur-ci </h1><br><p><img src="https://habrastorage.org/webt/ct/me/vo/ctmevotjzsrr0s-5_erinl_pedk.png" alt="skema dapur-ci"></p><br><p>  Idenya sederhana jelek.  Kami membuat mesin virtual baru, menggunakan peran, menjalankan tes asap. </p><br><h1 id="green-build-policy">  Kebijakan pembangunan hijau </h1><br><p><img src="https://habrastorage.org/webt/0i/pj/ky/0ipjkykp-b0bmksesauecyoxbdi.png" alt="Skema kebijakan pembangunan hijau"></p><br><p>  Tapi kami memutuskan untuk pindah.  Gunakan aliran ala github, mis.  peran dalam brunch individu dan setelah peninjauan merjim di master.  Jika tes ok, maka kami menggulirkan peran ke infrastruktur. </p><br><h1 id="vlozhennaya-virtualizaciya">  Virtualisasi Bersarang </h1><br><p>  Seperti yang Anda ingat, kami memiliki batasan pada pembuatan mesin virtual, jadi kami harus membuat keputusan yang tidak menyenangkan dalam bentuk virtualisasi bersarang. </p><br><p><img src="https://habrastorage.org/webt/cy/5r/pn/cy5rpnk2a-hhcqzuyfszpfnvdfo.jpeg" alt="kita harus masuk lebih dalam"></p><br><p>  Awalnya, kami mencoba Virtualbox x32 untuk tidak menyertakan dukungan bersarang.  Ini ternyata bukan gagasan karena stabilitas panik kernel.  Faktor penting kedua adalah bahwa kita duduk di x86_64, jadi penelitian dilanjutkan (hi libvirt), tetapi menetap di virtualbox lebih umum pada OS yang didukung. </p><br><h1 id="slozhnosti">  Kesulitan </h1><br><p>  Selama peluncuran, semuanya baik-baik saja.Ada sejumlah kesulitan. </p><br><h2 id="prokinut-nastroyki-proxy-s-hosta-v-gostya-gostya">  Lewati pengaturan proxy dari host ke tamu tamu </h2><br><p>  Dalam beberapa skenario pengujian, pengaturan proxy digunakan, sementara pada host dengan testkitchen, proxy transparan digunakan dan bonus yang dimungkinkan tidak menerima variabel tambahan dengan nilai kosong. </p><br><p>  <em>Solusi:</em> norak - buat templat ERB. </p><br><pre><code class="plaintext hljs">&lt;%= ENV['http_proxy'].to_s.empty? ? 'http://proxy.example.com:3128' : ENV['http_proxy'] %&gt;</code> </pre> <br><h2 id="upravlenie-setevymi-nastroykami-cherez-ansible">  Manajemen pengaturan jaringan melalui ansible </h2><br><p>  Dalam beberapa peran, jaringan telah dikonfigurasi, dalam pengujian terlihat seperti ini: </p><br><ul><li>  Kami mengkonfigurasi jaringan dengan menyalin file. </li><li>  Terapkan pengaturan jaringan. </li><li>  Semua itu buruk. </li></ul><br><p>  <em>Solusi:</em> Tambahkan antarmuka ke mesin virtual </p><br><h2 id="esli-testovyy-nabor-soderzhi-_-vse-padaet">  Jika set tes berisi "_" semuanya jatuh </h2><br><p>  Virtualbox tidak dapat menggunakan "_" dalam nama mesin virtual.  Dan mesin virtual menggunakan nama skrip. </p><br><p>  <em>Solusi:</em> ganti nama set tes "vm_" =&gt; "vm-" </p><br><h2 id="testovye-scenarii-s-ustanovkoy-oracle-bez--v-konce-imeni-virtualnoy-mashiny-padayut">  Menguji kasus dengan menginstal Oracle tanpa "."  di akhir nama mesin virtual jatuh </h2><br><p>  Peran itu digunakan dalam penjualan bersyarat ketika mereka memutuskan untuk menutupinya dengan tes.  Ketika Anda memasukkannya ke dalam VM yang disiapkan, itu memenuhi peran, itu jatuh melalui testkitchen. </p><br><p>  Sedikit petunjuk </p><br><pre> <code class="plaintext hljs">[root@vm-oracle vagrant]# getent ahosts vm-oracle 127.0.0.1 STREAM vm-oracle 127.0.0.1 DGRAM 127.0.0.1 RAW [root@vm-oracle vagrant]# getent ahosts vm-oracle. fe80::a00:27ff:febd:bd6a STREAM vm-oracle fe80::a00:27ff:febd:bd6a DGRAM fe80::a00:27ff:febd:bd6a RAW 10.0.2.15 STREAM 10.0.2.15 DGRAM 10.0.2.15 RAW [root@oracle vagrant]# getent ahosts oracle.example.com. 192.168.128.182 STREAM oracle.example.local 192.168.128.182 DGRAM 192.168.128.182 RAW</code> </pre> <br><p>  Adakah yang tahu apa yang sedang terjadi? </p><br><p>  Itu adalah skenario yang menyenangkan: </p><br><ol><li>  Kami mengaktifkan pengikatan IPv4 hanya di pengaturan pendengar oracle. </li><li>  oracle menggunakan FQDN. </li><li>  linux mengandung basis khusus "myhostname" untuk menyelesaikan nama domain, itu digunakan setelah / etc / hosts &amp; dns server. </li><li>  Vagrant menciptakan VM &amp; pembaruan <code>/etc/hosts</code> . </li></ol><br><p>  Saya akan menjelaskan sedikit: <br>  Apa yang terjadi jika <em>vm-oracle</em> ? </p><br><ol><li>  gelandangan menciptakan mesin virtual. </li><li>  pembaruan gelandangan <code>/etc/hosts</code> ( <em>vm-oracle</em> x2) </li><li>  oracle listener mendengarkan IPv4. </li><li>  pendengar oracle menyelesaikan nama domain <em>vm-oracle.</em>  &amp; mendapat IPv6. </li><li>  GAGAL </li></ol><br><p>  Apa yang terjadi dalam kasus <em>vm-oracle.</em>  ? </p><br><ol><li>  gelandangan menciptakan mesin virtual. </li><li>  pembaruan gelandangan / etc / hosts ( <em>vm-oracle</em> &amp; <em>vm-oracle.</em> ) </li><li>  oracle listener mendengarkan IPv4. </li><li>  pendengar oracle menyelesaikan nama domain <em>vm-oracle.</em>  &amp; mendapat IPv4 </li><li>  Ok </li></ol><br><h2 id="oom-v-gosti-k-nam-prihodit">  OOM datang mengunjungi kami </h2><br><p>  OOM membunuh mesin virtual secara acak.  Testkitchen pada saat yang sama memberikan semua jenis pesan aneh di log-nya. </p><br><p>  <em>Solusi:</em> Tambah jumlah memori. </p><br><h2 id="medlennye-bildy">  Build lambat </h2><br><p>  Seluruh skema ini bekerja lambat, selama puluhan menit, kadang-kadang lebih dari satu jam. </p><br><p>  <em>Solusi:</em> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Packer</a> .  Preassemble gambar mesin virtual. </li><li>  Jalankan beberapa test case secara paralel </li></ul><br><h1 id="zaklyuchenie">  Kesimpulan </h1><br><p>  Jika kita mengatakan bahwa infrastruktur adalah kode, maka filosofi yang sama harus diterapkan pada pembuatannya seperti untuk pengembangan perangkat lunak.  Di satu sisi, kami mendapat solusi yang berfungsi, tetapi ada beberapa momen yang tidak menyenangkan: </p><br><ul><li>  Tidak ramah, semuanya terlihat. </li><li>  Campuran ruby â€‹â€‹&amp; python. </li><li>  Tidak ada peran pemeriksaan dan peran. </li><li>  Ini bekerja lambat. </li><li>  Sulit .... </li></ul><br><p>  Pada outputnya, molekul dengan buruh pelabuhan terlihat menarik dan lebih asli.  Kami sedang memikirkannya. </p><br><h1 id="ssylki">  Referensi </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Versi bahasa inggris</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Slide Kinerja</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Contoh kode</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://kitchen.ci/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/chef/kitchen-inspec</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://docs.chef.io/config_yml_kitchen.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://docs.chef.io/ctl_kitchen.html</a> </li><li>  <a href="">https://github.com/neillturner/kitchen-ansible/blob/master/provisioner_options.md</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id437004/">https://habr.com/ru/post/id437004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id436994/index.html">Liquibase dan Maven</a></li>
<li><a href="../id436996/index.html">Kursus Final Spesialisasi Python dari Mail.ru Group</a></li>
<li><a href="../id436998/index.html">Perlindungan microchip dari rekayasa terbalik dan entri tidak sah</a></li>
<li><a href="../id437000/index.html">Bagaimana cara mengajar orang menggunakan git</a></li>
<li><a href="../id437002/index.html">Inti ASP.NET yang valid</a></li>
<li><a href="../id437006/index.html">Review Printer 3D Wanhao Duplicator 10</a></li>
<li><a href="../id437008/index.html">NLP. Dasar-dasarnya. Teknik Pengembangan diri. Bagian 1</a></li>
<li><a href="../id437010/index.html">Gaung Masa Lalu: Pengalaman Muda di Dasar Metode Spektroskopi X-Ray Baru</a></li>
<li><a href="../id437014/index.html">Tugas tubuh N atau cara meledakkan galaksi tanpa meninggalkan dapur</a></li>
<li><a href="../id437018/index.html">Beberapa perangkap statis mengetik Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>