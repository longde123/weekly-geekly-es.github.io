<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🤝‍👨🏾 👧🏿 🦈 API di F #. Modul Aplikasi Berbasis Peran Akses 🤶🏼 🏮 😠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ASP.NET Core menawarkan standar untuk mengkonfigurasi akses ke api menggunakan atribut, dimungkinkan untuk membatasi akses ke pengguna dengan klaim te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>API di F #. Modul Aplikasi Berbasis Peran Akses</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461593/"><p>  ASP.NET Core menawarkan standar untuk mengkonfigurasi akses ke api menggunakan atribut, dimungkinkan untuk membatasi akses ke pengguna dengan klaim tertentu, Anda dapat menentukan kebijakan dan mengikat ke controller, membuat controller untuk peran yang berbeda <br>  Sistem ini memiliki minus, yang terbesar di dalamnya, melihat atribut ini: </p><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Authorize(Roles = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Administrator"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AdministrationController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { }</code> </pre> <br><p>  Kami tidak menerima informasi apa pun tentang hak apa yang dimiliki administrator. </p><a name="habracut"></a><br><p>  Tugas saya adalah untuk menampilkan semua pengguna yang dilarang untuk bulan ini (tidak hanya pergi ke database dan filter, ada aturan penghitungan tertentu yang ada di suatu tempat), saya melakukan <em>CTRL + N</em> pada proyek dan mencari <em>BannedUserHandler</em> atau <em>IHasInfoAbounBannedUser</em> atau <em>GetBannedUsersForAdmin</em> . </p><br><p>  Saya menemukan pengendali yang ditandai dengan atribut <em>[Otorisasi (Peran = "Administrator")]</em> , mungkin ada dua skenario: </p><br><p>  <em>Kami melakukan semua yang ada di controller</em> </p><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"api/[controller]/[action]"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AdminInfoController1</span></span> : <span class="hljs-title"><span class="hljs-title">ControllerBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IGetUserInfoService _getInfoAboutActiveUsers; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ICanBanUserService _banUserService; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ICanRemoveBanUserService _removeBanUserService; <span class="hljs-comment"><span class="hljs-comment">//    action public AdminInfoController1( IGetUserInfoService infoAboutActiveUsers, ICanBanUserService banUserService, ICanRemoveBanUserService removeBanUserService) { _getInfoAboutActiveUsers = infoAboutActiveUsers; _banUserService = banUserService; _removeBanUserService = removeBanUserService; } // actions //... //... }</span></span></code> </pre> <br><p>  <em>Kami mendistribusikan pada penangan</em> </p><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"api/[controller]/[action]"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AdminInfoController2</span></span> : <span class="hljs-title"><span class="hljs-title">ControllerBase</span></span> { [HttpPatch(<span class="hljs-string"><span class="hljs-string">"{id}"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;ActionResult&lt;BanUserResult&gt;&gt; BanUser( [FromServices] IAsyncHandler&lt;UserId, BanUserResult&gt; handler, UserId userId) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> handler.Handle(userId, HttpContext.RequestAborted); [HttpPatch(<span class="hljs-string"><span class="hljs-string">"{id}"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;ActionResult&lt;RemoveBanUserResult&gt;&gt; RemoveBanUser( [FromServices] IAsyncHandler&lt;UserId, RemoveBanUserResult&gt; handler, UserId userId) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> handler.Handle(userId, HttpContext.RequestAborted); }</code> </pre> <br><p>  Pendekatan pertama tidak buruk karena kita tahu akses ke sumber daya yang dimiliki Admin, dependensi apa yang dapat digunakan, saya akan menggunakan pendekatan ini dalam aplikasi kecil, tanpa area subjek yang kompleks </p><br><p>  Yang kedua tidak begitu berbicara, semua dependensi diselesaikan dalam penangan, saya tidak bisa melihat konstruktor dan mengerti apa jenis dependensi yang saya butuhkan, pendekatan ini membenarkan dirinya ketika aplikasi tersebut kompleks dan pengendali membengkak, menjadi tidak mungkin untuk mendukung mereka.  Solusi klasik untuk masalah ini adalah mempartisi solusi ke dalam folder / proyek, layanan yang diperlukan diletakkan di masing-masing, mereka mudah ditemukan dan digunakan </p><br><p>  Semua ini memiliki kelemahan besar, kode tidak memberi tahu pengembang apa yang harus dilakukan, itu membuat Anda berpikir =&gt; buang-buang waktu =&gt; kesalahan implementasi </p><br><p>  Dan semakin Anda harus berpikir, semakin banyak kesalahan dibuat. </p><br><h3>  Pengantar Routing Suave </h3><br><p>  Bagaimana jika routing dibangun <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">seperti ini</a> : </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> webPart = choose [ path <span class="hljs-string"><span class="hljs-string">"/"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"Home"</span></span>) path <span class="hljs-string"><span class="hljs-string">"/about"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"About"</span></span>) path <span class="hljs-string"><span class="hljs-string">"/articles"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"List of articles"</span></span>) path <span class="hljs-string"><span class="hljs-string">"/articles/browse"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"Browse articles"</span></span>) path <span class="hljs-string"><span class="hljs-string">"/articles/details"</span></span> &gt;=&gt; (<span class="hljs-type"><span class="hljs-type">OK</span></span> <span class="hljs-string"><span class="hljs-string">"Content of an article"</span></span>) ]</code> </pre> <br><p>  ''&gt; =&gt; '' - apa itu?  Benda ini memiliki nama, tetapi pengetahuannya tidak akan membuat pembaca satu gram lebih dekat untuk memahami cara kerjanya, jadi tidak ada gunanya membawanya, lebih baik untuk mempertimbangkan bagaimana semuanya bekerja </p><br><p>  Pipa dari Suave ditulis di atas, sama digunakan di Giraffe (dengan fungsi tanda tangan yang berbeda), ada tanda tangan: </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPart</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Async</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option&gt;</span></span></code> </pre> <br><p>  Async dalam hal ini tidak memainkan peran khusus (untuk memahami cara kerjanya), hilangkan saja </p><br><pre> <code class="haskell hljs"><span class="hljs-type"><span class="hljs-type">HttpContext</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">HttpContext</span></span> option</code> </pre> <br><p>  Sebuah fungsi dengan tanda tangan seperti itu menerima <em>HttpContext</em> , memproses (deserializes tubuh, melihat cookie, header permintaan), menghasilkan respons, dan jika semuanya berjalan dengan baik, membungkusnya dalam <em>Beberapa</em> , jika terjadi kesalahan, mengembalikan <em>Tidak ada</em> , misalnya ( <a href="">fungsi perpustakaan</a> ): </p><br><pre> <code class="haskell hljs"> //    async <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-type"><span class="hljs-type">OK</span></span> s : <span class="hljs-type"><span class="hljs-type">WebPart</span></span> = fun ctx -&gt; { ctx with response = { ctx.response with status = <span class="hljs-type"><span class="hljs-type">HTTP_200</span></span>.status; content = <span class="hljs-type"><span class="hljs-type">Bytes</span></span> s }} |&gt; <span class="hljs-type"><span class="hljs-type">Some</span></span> |&gt; async.<span class="hljs-type"><span class="hljs-type">Return</span></span></code> </pre> <br><p>  Fungsi ini tidak dapat "membungkus alur eksekusi permintaan", ia selalu melempar respons baru lebih jauh, dengan tubuh dan status 200, tetapi yang ini bisa: </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> path (str:string) ctx = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> path = ctx.request.rawPath <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> path.<span class="hljs-type"><span class="hljs-type">StartsWith</span></span> str <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ctx |&gt; <span class="hljs-type"><span class="hljs-type">Some</span></span> |&gt; async.<span class="hljs-type"><span class="hljs-type">Return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> async.<span class="hljs-type"><span class="hljs-type">Return</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span></code> </pre> <br><p>  Fungsi terakhir yang Anda <a href=""><em>butuhkan</em></a> adalah <a href=""><em>memilih</em></a> - ia mendapat daftar fungsi yang berbeda dan memilih yang mengembalikan Beberapa terlebih dahulu: </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> choose (webparts:(<span class="hljs-type"><span class="hljs-type">HttpContext</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">Async</span></span>&lt;<span class="hljs-type"><span class="hljs-type">HttpContext</span></span> option&gt;) list) context= async{ match webparts with | [head] -&gt; return! head context | head::tail -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>! result = head context match result with | <span class="hljs-type"><span class="hljs-type">Some</span></span> _-&gt; return result | <span class="hljs-type"><span class="hljs-type">None</span></span> -&gt; return! choose tail context | [] -&gt; return <span class="hljs-type"><span class="hljs-type">None</span></span> }</code> </pre> <br><p>  Nah, fungsi pengikatan yang paling penting (Async dihilangkan): </p><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPartWithoutAsync</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option let (&gt;=&gt;) (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h1</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPartWithoutAsync</span></span></span><span class="hljs-class"> ) (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h2</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPartWithoutAsync</span></span></span><span class="hljs-class">) ctx : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option = let result = h1 ctx match result with | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class"> ctx' -&gt; h2 ctx' | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Versi async</b> <div class="spoiler_text"><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPart</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Async</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option&gt; let (&gt;=&gt;) (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h1</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPart</span></span></span><span class="hljs-class"> ) (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h2</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WebPart</span></span></span><span class="hljs-class"> ) ctx : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Async</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HttpContext</span></span></span><span class="hljs-class"> option&gt;= async{ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h1</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">match</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx'</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h2</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx'</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span><span class="hljs-class"> }</span></span></code> </pre></div></div><br><p>  "&gt; =&gt;" menerima dua penangan di sisi kiri dan kanan dan <em>httpContext</em> , ketika permintaan datang, server membentuk objek HttpContext dan meneruskannya ke fungsi, "&gt; =&gt;" menjalankan penangan pertama (kiri) jika mengembalikan <em>beberapa ctx</em> , melewati ctx ke input dari penangan kedua. </p><br><p>  Dan mengapa kita bisa menulis seperti ini (menggabungkan beberapa fungsi)? </p><br><pre> <code class="haskell hljs"><span class="hljs-type"><span class="hljs-type">GET</span></span> &gt;=&gt; path <span class="hljs-string"><span class="hljs-string">"/api"</span></span> &gt;=&gt; <span class="hljs-type"><span class="hljs-type">OK</span></span></code> </pre> <br><p>  Karena "&gt; =&gt;" menerima dua fungsi WebPart dan mengembalikan satu fungsi yang mengambil <em>HttpContext</em> dan mengembalikan <em>Async &lt;HttpContext option&gt;</em> , dan fungsi mana yang mengambil konteks dan mengembalikan <em>Async &lt;HttpContext option&gt;</em> ? <br>  <em>Webpart</em> . </p><br><p>  Ternyata <em>"&gt; =&gt;"</em> mengambil WebPart untuk handler dan mengembalikan <em>WebPart</em> , jadi kita bisa menulis beberapa kombinator berturut-turut, dan bukan hanya dua. <br>  Detail tentang kerja kombinator dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini.</a> <br><br></p><br><h3 id="pri-chem-tut-roli-i-ogranichenie-dostupa">  Apa hubungan peran dan pembatasan akses dengan hal itu? </h3><br><p>  Mari kita kembali ke awal artikel, bagaimana kita dapat secara eksplisit menunjukkan kepada programmer sumber daya apa yang dapat diakses untuk peran tertentu?  Penting untuk memasukkan data ini ke dalam pipa sehingga penangan memiliki akses ke sumber daya yang sesuai, saya melakukannya seperti ini: </p><br><p><img src="https://habrastorage.org/webt/i5/oh/zi/i5ohziec88tovhgpezx11dc0lw0.png"></p><br><p>  Aplikasi ini dibagi menjadi beberapa bagian / modul.  Fungsi <em>AdminPart</em> dan <em>AccountPart</em> memungkinkan akses ke modul ini dari berbagai peran, semua pengguna memiliki akses ke <em>AccountPart,</em> hanya admin yang mengakses AdminPart, data diterima, memperhatikan fungsi selectP, saya harus menambahkan lebih banyak fungsi, karena yang standar melekat pada jenis ramah tamah, dan penangan di dalam <em>AdminPart</em> dan <em>AccountPart sekarang memiliki</em> tanda tangan yang berbeda: </p><br><pre> <code class="haskell hljs">// <span class="hljs-type"><span class="hljs-type">AdminPart</span></span> <span class="hljs-type"><span class="hljs-type">AdminInfo</span></span> * <span class="hljs-type"><span class="hljs-type">HttpContext</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Async</span></span>&lt;(<span class="hljs-type"><span class="hljs-type">AdminInfo</span></span> * <span class="hljs-type"><span class="hljs-type">HttpContext</span></span>) option&gt; // <span class="hljs-type"><span class="hljs-type">AccountPart</span></span> <span class="hljs-type"><span class="hljs-type">AccountInfo</span></span>* <span class="hljs-type"><span class="hljs-type">HttpContext</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Async</span></span>&lt;(<span class="hljs-type"><span class="hljs-type">AccountInfo</span></span> * <span class="hljs-type"><span class="hljs-type">HttpContext</span></span>) option&gt;</code> </pre> <br><p>  Di dalam, fitur-fitur baru benar-benar identik dengan yang asli. </p><br><p>  Sekarang pawang segera memiliki akses ke sumber daya untuk setiap peran, hanya <em>hal</em> utama <em>yang</em> perlu ditambahkan di sana sehingga Anda dapat dengan mudah menavigasi, misalnya, di <em>AccountPart</em> Anda dapat menambahkan nama panggilan, email, peran pengguna, daftar teman jika itu adalah jejaring sosial, tetapi ada masalah: untuk satu hal yang luar biasa kebanyakan penangan saya membutuhkan daftar teman, tetapi untuk sisanya saya tidak membutuhkannya sama sekali, apa yang harus saya lakukan?  Baik mendistribusikan penangan ini ke modul yang berbeda (lebih disukai), atau membuat akses malas (bungkus dalam <em>unit -&gt; daftar teman</em> ), hal utama adalah tidak menempatkan <em>IQueryable &lt;Friend&gt; di sana</em> , karena ini bukan layanan - itu adalah kumpulan data yang menentukan peran </p><br><p>  Saya memasukkan informasi <em>AdminInfo</em> tentang pengguna yang disetujui dan dicekal oleh administrator saat ini, dalam konteks "aplikasi" saya, ini mendefinisikan peran Administrator: </p><br><pre> <code class="haskell hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AdminInfo</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ActiveUsersEmails</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BanUsersEmails</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserInfo</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Name</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Surname</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> }</span></span></code> </pre> <br><p>  Apa perbedaan dari <em>Klaim</em> ?  <em>Apakah mungkin</em> untuk membuat <em>User.Claims</em> di controller dan mendapatkan hal yang sama? </p><br><p>  Dalam mengetik dan berbicara: modul, pengembang tidak harus mencari contoh kode pada penangan dalam konteks yang sama, ia menciptakan penangan dan menambahkannya ke perutean dan membuatnya semuanya dikompilasi </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-type"><span class="hljs-type">AccountPart</span></span> handler = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> getUserInfo ctx = async.<span class="hljs-type"><span class="hljs-type">Return</span></span> {<span class="hljs-type"><span class="hljs-type">Name</span></span>=<span class="hljs-string"><span class="hljs-string">"Al"</span></span>;<span class="hljs-type"><span class="hljs-type">Surname</span></span>=<span class="hljs-string"><span class="hljs-string">"Pacino"</span></span>} permissionHandler [<span class="hljs-type"><span class="hljs-type">User</span></span>;<span class="hljs-type"><span class="hljs-type">Admin</span></span>] getUserInfo handler</code> </pre> <br><p>  <em>getUserInfo</em> menerima data untuk modul <em>Akun</em> , memiliki akses ke konteks untuk mendapatkan data pribadi (dari user'a ini, admin'a) </p><br><p>  <em>permitHandler</em> memeriksa token token, mendekripsi, dan memeriksa akses, mengembalikan WebPart asli untuk mempertahankan kompatibilitas dengan Suave </p><br><p>  Kode sumber lengkap dapat ditemukan di <a href="">github</a> </p><br><p>  Terima kasih atas perhatian anda! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id461593/">https://habr.com/ru/post/id461593/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id461577/index.html">Bagian 5/2 Bldg. 1: Persimpangan RocketChip Avenue dan jalur instrumentasi yang licin</a></li>
<li><a href="../id461579/index.html">WebMoney memperkenalkan dompet WMP baru dan mengubah aturan permainan</a></li>
<li><a href="../id461583/index.html">Python untuk membantu menguji produk struktural</a></li>
<li><a href="../id461587/index.html">Lokalisasi aplikasi dalam 10 langkah</a></li>
<li><a href="../id461589/index.html">Tic Tac Toe: Siklus Konten</a></li>
<li><a href="../id461595/index.html">Dari teori ke praktek: bagaimana mahasiswa fakultas fotonics dan optoinformatika belajar dan bekerja</a></li>
<li><a href="../id461601/index.html">Apa yang harus diketahui oleh pendiri non-teknis tentang pengembangan perangkat lunak</a></li>
<li><a href="../id461605/index.html">Menciptakan Tower Defense in Unity: Ballistics</a></li>
<li><a href="../id461607/index.html">Cara Kerja Adapter Video Apple Lightning</a></li>
<li><a href="../id461611/index.html">Penerapan Cache Verilog</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>