<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘° ğŸ‘§ğŸ½ ğŸ½ ç°ä»£JavaæŠ€æœ¯å †æ ˆä¸Šçš„å¾®æœåŠ¡æ¶æ„ ğŸš‘ ğŸ•¹ï¸ ğŸ˜›</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬æ‹¥æœ‰JDK 11ï¼ŒKotlinï¼ŒSpring 5å’ŒSpring Boot 2ï¼ŒGradle 5å’Œå¯ç”¨äºç”Ÿäº§çš„Kotlin DSLï¼ŒJUnit 5ï¼Œä»¥åŠè®¸å¤šç”¨äºæœåŠ¡å‘ç°ï¼Œåˆ›å»ºç½‘å…³APIï¼Œå®¢æˆ·ç«¯å¹³è¡¡å’Œå®ç°Circuit Breakerçš„Spring Cloudå †æ ˆåº“ã€‚ç¼–å†™å£°æ˜æ€§çš„HTTPå®¢æˆ·ç«¯ï¼Œåˆ†å¸ƒ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç°ä»£JavaæŠ€æœ¯å †æ ˆä¸Šçš„å¾®æœåŠ¡æ¶æ„</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431474/">  <i>æˆ‘ä»¬æ‹¥æœ‰JDK 11ï¼ŒKotlinï¼ŒSpring 5å’ŒSpring Boot 2ï¼ŒGradle 5å’Œå¯ç”¨äºç”Ÿäº§çš„Kotlin DSLï¼ŒJUnit 5ï¼Œä»¥åŠè®¸å¤šç”¨äºæœåŠ¡å‘ç°ï¼Œåˆ›å»ºç½‘å…³APIï¼Œå®¢æˆ·ç«¯å¹³è¡¡å’Œå®ç°Circuit Breakerçš„Spring Cloudå †æ ˆåº“ã€‚ç¼–å†™å£°æ˜æ€§çš„HTTPå®¢æˆ·ç«¯ï¼Œåˆ†å¸ƒå¼è·Ÿè¸ªç­‰ç­‰ã€‚</i>  <i>åˆ›å»ºå¾®æœåŠ¡æ¶æ„å¹¶ä¸éœ€è¦æ‰€æœ‰è¿™äº›-ä»…å‡ºäºå¨±ä¹ç›®çš„...</i> <br><a name="habracut"></a><br><h1> å‚èµ›ä½œå“ </h1><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªä½¿ç”¨Javaä¸–ç•Œä¸­ç›¸å…³æŠ€æœ¯çš„å¾®æœåŠ¡ä½“ç³»ç»“æ„ç¤ºä¾‹ï¼Œå…¶ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼ˆæ‰€æŒ‡ç¤ºçš„ç‰ˆæœ¬åœ¨å‘å¸ƒæ—¶å·²åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼‰ï¼š <br><div class="scrollable-table"><table><tbody><tr><th> æŠ€æœ¯ç±»å‹ </th><th> èŒç§° </th><th> ç‰ˆæœ¬å· </th></tr><tr><td> å¹³å°å¹³å° </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ°å…‹</a> </td><td>  11.0.1 </td></tr><tr><td> ç¨‹å¼è¯­è¨€ </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç§‘ç‰¹æ—</a> </td><td>  1.3.10 </td></tr><tr><td rowspan="2"> åº”ç”¨æ¡†æ¶ </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ˜¥å­£æ¡†æ¶</a> </td><td>  5.0.9 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ˜¥å­£é´</a> </td><td>  2.0.5 </td></tr><tr><td rowspan="2"> å»ºç«‹ç³»ç»Ÿ </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ‘‡ç¯®</a> </td><td>  5.0 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Gradle Kotlin DSL</a> </td><td>  1.0.4 </td></tr><tr><td> å•å…ƒæµ‹è¯•æ¡†æ¶ </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æœ±å°¼ç‰¹</a> </td><td>  5.1.1 </td></tr><tr><td colspan="3" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ˜¥äº‘</a> </td></tr><tr><td> å•ä¸€è®¿é—®ç‚¹ï¼ˆAPIç½‘å…³ï¼‰ </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Spring Cloud Gateway</a> </td><td rowspan="7"> åŒ…å«åœ¨å‘è¡Œåˆ—è½¦Finchley SR2é¡¹ç›®Spring Cloudä¸­ </td></tr><tr><td> é›†ä¸­é…ç½® </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ˜¥å­£äº‘é…ç½®</a> </td></tr><tr><td> è¯·æ±‚è·Ÿè¸ªï¼ˆåˆ†å¸ƒå¼è·Ÿè¸ªï¼‰ </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ˜¥äº‘ä¾¦æ¢</a> </td></tr><tr><td> å£°æ˜å¼HTTPå®¢æˆ·ç«¯ </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Spring Cloud OpenFeign</a> </td></tr><tr><td> æœåŠ¡å‘ç° </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Spring Cloud Netflixå°¤é‡Œå¡</a> </td></tr><tr><td> æ–­è·¯å™¨ </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Spring Cloud Netflix Hystrix</a> </td></tr><tr><td> å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Spring Cloud NetflixåŠŸèƒ½åŒº</a> </td></tr></tbody></table></div><br> è¯¥é¡¹ç›®åŒ…å«5ä¸ªå¾®æœåŠ¡ï¼š3ä¸ªåŸºç¡€ç»“æ„ï¼ˆé…ç½®æœåŠ¡å™¨ï¼ŒæœåŠ¡å‘ç°æœåŠ¡å™¨ï¼ŒUIç½‘å…³ï¼‰ä»¥åŠå‰ç«¯ï¼ˆé¡¹ç›®UIï¼‰å’Œåç«¯ï¼ˆé¡¹ç›®æœåŠ¡ï¼‰çš„ç¤ºä¾‹ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jz/rw/ia/jzrwiaehuhksnkj2dzmjea-43fy.png"></div><br> æ‰€æœ‰è¿™äº›å°†åœ¨ä¸‹é¢æŒ‰é¡ºåºè€ƒè™‘ã€‚ æ˜¾ç„¶ï¼Œåœ¨â€œæˆ˜æ–—â€é¡¹ç›®ä¸­ï¼Œå°†å®ç°æ›´å¤šå®ç°ä»»ä½•ä¸šåŠ¡åŠŸèƒ½çš„å¾®æœåŠ¡ã€‚ ä»æŠ€æœ¯ä¸Šè®²ï¼Œå°†å®ƒä»¬æ·»åŠ åˆ°ç›¸ä¼¼çš„ä½“ç³»ç»“æ„ä¸­çš„æ–¹å¼ä¸Items UIå’ŒItemsæœåŠ¡ç›¸åŒã€‚ <br><br><h3> å…è´£å£°æ˜ </h3><br> æœ¬æ–‡ä¸è€ƒè™‘ç”¨äºå®¹å™¨åŒ–å’Œç¼–æ’çš„å·¥å…·ï¼Œå› ä¸ºç›®å‰åœ¨é¡¹ç›®ä¸­æœªä½¿ç”¨å®ƒä»¬ã€‚ <br><br><h1> é…ç½®æœåŠ¡å™¨ </h1><br>  Spring Cloud Configç”¨äºåˆ›å»ºåº”ç”¨ç¨‹åºé…ç½®çš„é›†ä¸­å¼å­˜å‚¨åº“ã€‚ å¯ä»¥ä»å„ç§æ¥æºè¯»å–é…ç½®ï¼Œä¾‹å¦‚ï¼Œå•ç‹¬çš„gitä¿¡æ¯åº“ï¼› åœ¨æ­¤é¡¹ç›®ä¸­ï¼Œä¸ºç®€å•èµ·è§ï¼Œå®ƒä»¬ä½äºåº”ç”¨ç¨‹åºèµ„æºä¸­ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sm/35/af/sm35aft9609348sicenfjgosw1k.png"></div><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé…ç½®æœåŠ¡å™¨ï¼ˆ <code>application.yml</code> ï¼‰æœ¬èº«çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="plaintext hljs">spring: profiles: active: native cloud: config: server: native: search-locations: classpath:/config server: port: 8888</code> </pre> <br> ä½¿ç”¨ç«¯å£8888å…è®¸ConfigæœåŠ¡å™¨å®¢æˆ·ç«¯ä¸è¦åœ¨å…¶<code>bootstrap.yml</code>æ˜¾å¼æŒ‡å®šå…¶ç«¯å£ã€‚ åœ¨å¯åŠ¨æ—¶ï¼Œä»–ä»¬é€šè¿‡æ‰§è¡ŒGETè¯·æ±‚åˆ°HTTP API ConfigæœåŠ¡å™¨æ¥ä¸Šä¼ é…ç½®ã€‚ <br><br> æ­¤å¾®æœåŠ¡çš„ç¨‹åºä»£ç ä»…ç”±ä¸€ä¸ªæ–‡ä»¶ç»„æˆï¼Œè¯¥æ–‡ä»¶åŒ…å«åº”ç”¨ç¨‹åºç±»çš„å£°æ˜å’Œmainæ–¹æ³•ï¼Œä¸ç­‰æ•ˆçš„Javaä»£ç ä¸åŒï¼Œå®ƒæ˜¯é¡¶çº§å‡½æ•°ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigServer</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConfigServerApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span></span>(args: Array&lt;String&gt;) { runApplication&lt;ConfigServerApplication&gt;(*args) }</code> </pre> <br> å…¶ä»–å¾®æœåŠ¡ä¸­çš„åº”ç”¨ç¨‹åºç±»å’Œä¸»è¦æ–¹æ³•å…·æœ‰ç›¸ä¼¼çš„å¤–è§‚ã€‚ <br><br><h1> æœåŠ¡å‘ç°æœåŠ¡å™¨ </h1><br> æœåŠ¡å‘ç°æ˜¯ä¸€ç§å¾®æœåŠ¡ä½“ç³»ç»“æ„æ¨¡å¼ï¼Œé¢å¯¹å®ä¾‹æ•°é‡å’Œç½‘ç»œä½ç½®å¯èƒ½å‘ç”Ÿå˜åŒ–çš„æƒ…å†µï¼Œå®ƒä½¿æ‚¨å¯ä»¥ç®€åŒ–åº”ç”¨ç¨‹åºä¹‹é—´çš„äº¤äº’ã€‚ è¿™ç§æ–¹æ³•çš„å…³é”®ç»„æˆéƒ¨åˆ†æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒ-å¾®æœåŠ¡ï¼Œå…¶å®ä¾‹å’Œç½‘ç»œä½ç½®çš„æ•°æ®åº“ï¼ˆæ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è§ï¼‰ã€‚ <br><br> åœ¨æ­¤é¡¹ç›®ä¸­ï¼ŒæœåŠ¡å‘ç°æ˜¯åŸºäºä½œä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">å®¢æˆ·ç«¯æœåŠ¡å‘ç°</a>çš„Netflix Eurekaå®ç°çš„ï¼šEurekaæœåŠ¡å™¨æ‰§è¡ŒService Registryçš„åŠŸèƒ½ï¼Œå¹¶ä¸”Eurekaå®¢æˆ·ç«¯åœ¨æ‰§è¡Œå¯¹ä»»ä½•å¾®æœåŠ¡çš„è¯·æ±‚ä¹‹å‰ï¼Œå…ˆè”ç³»EurekaæœåŠ¡å™¨ä»¥è·å–è¢«è°ƒç”¨åº”ç”¨ç¨‹åºçš„å®ä¾‹åˆ—è¡¨ï¼Œå¹¶ç‹¬ç«‹æ‰§è¡Œå¹³è¡¡åŠ è½½ï¼ˆä½¿ç”¨Netflix Ribbonï¼‰ã€‚ åƒå…¶ä»–Netflix OSSå †æ ˆç»„ä»¶ï¼ˆä¾‹å¦‚Hystrixå’ŒRibbonï¼‰ä¸€æ ·ï¼ŒNetflix Eurekaä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Spring Cloud Netflix</a>ä¸Spring Bootåº”ç”¨ç¨‹åºé›†æˆã€‚ <br><br> åœ¨ä½äºå…¶èµ„æºï¼ˆ <code>bootstrap.yml</code> ï¼‰ä¸­çš„æœåŠ¡å‘ç°æœåŠ¡å™¨é…ç½®ä¸­ï¼Œä»…æŒ‡ç¤ºåº”ç”¨ç¨‹åºçš„åç§°å’ŒæŒ‡ç¤ºåœ¨æ— æ³•è¿æ¥ConfigæœåŠ¡å™¨æ—¶å°†ä¸­æ–­å¾®æœåŠ¡å¯åŠ¨çš„å‚æ•°ï¼š <br><br><pre> <code class="plaintext hljs">spring: application: name: eureka-server cloud: config: fail-fast: true</code> </pre> <br> åº”ç”¨ç¨‹åºé…ç½®çš„å…¶ä½™éƒ¨åˆ†ä½äºConfigæœåŠ¡å™¨èµ„æºä¸­çš„<code>eureka-server.yml</code>ä¸­ï¼š <br><br><pre> <code class="plaintext hljs">server: port: 8761 eureka: client: register-with-eureka: true fetch-registry: false</code> </pre> <br>  EurekaæœåŠ¡å™¨ä½¿ç”¨ç«¯å£8761ï¼Œè¯¥ç«¯å£å…è®¸æ‰€æœ‰Eurekaå®¢æˆ·ç«¯ä¸ä½¿ç”¨é»˜è®¤å€¼æŒ‡å®šå®ƒã€‚  <code>register-with-eureka</code> ï¼ˆä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œ <code>register-with-eureka</code>å®ƒä¹Ÿæ˜¯é»˜è®¤ä½¿ç”¨çš„ï¼Œ <code>register-with-eureka</code>è¡¨ç¤ºå‡ºæ¥ï¼‰æ„å‘³ç€åº”ç”¨ç¨‹åºæœ¬èº«ï¼Œåƒå…¶ä»–å¾®æœåŠ¡ä¸€æ ·ï¼Œå°†åœ¨EurekaæœåŠ¡å™¨ä¸­æ³¨å†Œã€‚  <code>fetch-registry</code>å‚æ•°ç¡®å®šEurekaå®¢æˆ·ç«¯æ˜¯å¦å°†ä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æ¥æ”¶æ•°æ®ã€‚ <br><br> å¯åœ¨<code>http://localhost:8761/</code>æ‰¾åˆ°å·²æ³¨å†Œçš„åº”ç”¨ç¨‹åºå’Œå…¶ä»–ä¿¡æ¯çš„åˆ—è¡¨ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sh/co/lz/shcolza08r8j3qkdmgb42exawqs.png"></div><br> å®æ–½æœåŠ¡å‘ç°çš„æ›¿ä»£æ–¹æ³•æ˜¯é¢†äº‹ï¼ŒZookeeperç­‰ã€‚ <br><br><h1> ç‰©å“æœåŠ¡ </h1><br> æ­¤åº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨REST APIçš„åç«¯çš„ç¤ºä¾‹ï¼Œè¯¥REST APIä½¿ç”¨å‡ºç°åœ¨Spring 5ä¸­çš„WebFluxæ¡†æ¶ï¼ˆæ–‡æ¡£åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ­¤å¤„</a> ï¼‰æˆ–æ›´ç¡®åˆ‡åœ°è¯´æ˜¯Kotlin DSLæ¥å®ç°ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">itemsRouter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ItemHandler</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = router { path(<span class="hljs-string"><span class="hljs-string">"/items"</span></span>).nest { GET(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, handler::getAll) POST(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, handler::add) GET(<span class="hljs-string"><span class="hljs-string">"/{id}"</span></span>, handler::getOne) PUT(<span class="hljs-string"><span class="hljs-string">"/{id}"</span></span>, handler::update) } }</code> </pre> <br> å¤„ç†æ”¶åˆ°çš„HTTPè¯·æ±‚å°†å§”æ‰˜ç»™<code>ItemHandler</code>ç±»<code>ItemHandler</code> ã€‚ ä¾‹å¦‚ï¼Œä¸€ç§ç”¨äºè·å–æŸä¸ªå®ä½“çš„å¯¹è±¡åˆ—è¡¨çš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ServerRequest</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = ServerResponse.ok() .contentType(APPLICATION_JSON_UTF8) .body(fromObject(itemRepository.findAll()))</code> </pre> <br> ç”±äºå­˜åœ¨<code>spring-cloud-starter-netflix-eureka-client</code>é¡¹ï¼Œè¯¥åº”ç”¨ç¨‹åºæˆä¸ºEurekaæœåŠ¡å™¨å®¢æˆ·ç«¯ï¼Œå³ï¼Œå®ƒæ³¨å†Œå¹¶ä»Serviceæ³¨å†Œè¡¨æ¥æ”¶æ•°æ®ã€‚ æ³¨å†Œåï¼Œåº”ç”¨ç¨‹åºä»¥ä¸€å®šçš„é¢‘ç‡å°†å“ˆæ¯”ç‰¹æ¯”ç‰¹å‘é€åˆ°EurekaæœåŠ¡å™¨ï¼Œå¹¶ä¸”å¦‚æœåœ¨ä¸€å®šæ—¶é—´æ®µå†…EurekaæœåŠ¡å™¨æ¥æ”¶çš„å“ˆæ¯”ç‰¹æ¯”ç‰¹ç›¸å¯¹äºæœ€å¤§å¯èƒ½å€¼çš„ç™¾åˆ†æ¯”é™è‡³æŸä¸ªé˜ˆå€¼ä»¥ä¸‹ï¼Œåˆ™è¯¥åº”ç”¨å°†ä»æœåŠ¡æ³¨å†Œè¡¨ä¸­åˆ é™¤ã€‚ <br><br> è€ƒè™‘å°†å…¶ä»–å…ƒæ•°æ®å‘é€åˆ°EurekaæœåŠ¡å™¨çš„æ–¹æ³•ä¹‹ä¸€ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@PostConstruct</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addMetadata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = aim.registerAppMetadata(mapOf(<span class="hljs-string"><span class="hljs-string">"description"</span></span> to <span class="hljs-string"><span class="hljs-string">"Some description"</span></span>))</code> </pre> <br> é€šè¿‡<code>http://localhost:8761/eureka/apps/items-service</code>é€šè¿‡é‚®é€’å‘˜ï¼Œç¡®ä¿EurekaæœåŠ¡å™¨æ¥æ”¶åˆ°è¯¥æ•°æ®ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5l/0v/xg/5l0vxgolfgjzyuceskxhmdv-0kc.png"></div><br><br><h1> ç‰©å“ç•Œé¢ </h1><br> é™¤äº†æ¼”ç¤ºä¸UIç½‘å…³çš„äº¤äº’ï¼ˆå°†åœ¨ä¸‹ä¸€èŠ‚ä¸­æ˜¾ç¤ºï¼‰ä¹‹å¤–ï¼Œæ­¤å¾®æœåŠ¡è¿˜ä¸ºItemsæœåŠ¡æ‰§è¡Œå‰ç«¯åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å¯ä»¥é€šè¿‡å‡ ç§æ–¹å¼ä¸REST APIè¿›è¡Œäº¤äº’ï¼š <br><br><ol><li> ä½¿ç”¨OpenFeignç¼–å†™çš„REST APIå®¢æˆ·ç«¯ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@FeignClient(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"items-service"</span></span></span><span class="hljs-meta">, fallbackFactory = ItemsServiceFeignClient.ItemsServiceFeignClientFallbackFactory::class)</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemsServiceFeignClient</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GetMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/items/{id}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@PathVariable(</span></span></span><span class="hljs-meta-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-meta-string">"id"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String <span class="hljs-meta"><span class="hljs-meta">@GetMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/not-existing-path"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHystrixFallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemsServiceFeignClientFallbackFactory</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FallbackFactory</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ItemsServiceFeignClient</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> log = LoggerFactory.getLogger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">override</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span></span>(cause: Throwable) = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : ItemsServiceFeignClient { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String { log.error(<span class="hljs-string"><span class="hljs-string">"Cannot get item with id=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ItemsUiException(cause) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHystrixFallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String { log.error(<span class="hljs-string"><span class="hljs-string">"This is expected error"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"{\"error\" : \"Some error\"}"</span></span> } } } }</code> </pre> </li><li>  <code>RestTemplate</code> Bean <br> åœ¨Javaé…ç½®ä¸­åˆ›å»ºä¸€ä¸ªbinï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@LoadBalanced</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">restTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = RestTemplate()</code> </pre> <br> å¹¶ä»¥æ­¤æ–¹å¼ä½¿ç”¨ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestWithRestTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String = restTemplate.getForEntity(<span class="hljs-string"><span class="hljs-string">"http://items-service/items/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span>, String::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class"> ?: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">"No result"</span></span></span></span></code> </pre> </li><li>  <code>WebClient</code>ç±»<code>WebClient</code> ï¼ˆç‰¹å®šäºWebFluxæ¡†æ¶çš„æ–¹æ³•ï¼‰ <br> åœ¨Javaé…ç½®ä¸­åˆ›å»ºä¸€ä¸ªbinï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">webClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(loadBalancerClient: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoadBalancerClient</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = WebClient.builder() .filter(LoadBalancerExchangeFilterFunction(loadBalancerClient)) .build()</code> </pre> <br> å¹¶ä»¥æ­¤æ–¹å¼ä½¿ç”¨ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestWithWebClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Mono&lt;String&gt; = webClient.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>().uri(<span class="hljs-string"><span class="hljs-string">"http://items-service/items/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span>).retrieve().bodyToMono(String::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">)</span></span></code> </pre> </li></ol><br> å¯ä»¥é€šè¿‡è½¬åˆ°<code>http://localhost:8081/example</code>æ¥éªŒè¯æ‰€æœ‰ä¸‰ä¸ªæ–¹æ³•è¿”å›ç›¸åŒç»“æœçš„äº‹å®ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ma/c8/oz/mac8ozz07cju5mitffz_qiew9mc.png"></div><br> æˆ‘æ›´å–œæ¬¢ä½¿ç”¨OpenFeignçš„é€‰é¡¹ï¼Œå› ä¸ºå®ƒä½¿å¼€å‘ä¸è¢«è°ƒç”¨çš„å¾®æœåŠ¡äº¤äº’çš„å¥‘çº¦æˆä¸ºå¯èƒ½ï¼Œè¯¥å¥‘çº¦çš„å®ç°ç”±Springæ‰¿æ‹…ã€‚ å®ç°è¯¥åˆåŒçš„å¯¹è±¡åƒå¸¸è§„beanä¸€æ ·è¢«æ³¨å…¥å’Œä½¿ç”¨ï¼š <br><br><pre> <code class="kotlin hljs">itemsServiceFeignClient.getItem(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br> å¦‚æœè¯·æ±‚ç”±äºæŸç§åŸå› è€Œå¤±è´¥ï¼Œåˆ™å°†è°ƒç”¨å®ç°<code>FallbackFactory</code>æ¥å£çš„ç±»çš„ç›¸åº”æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæ‚¨éœ€è¦å¤„ç†é”™è¯¯å¹¶è¿”å›é»˜è®¤å“åº”ï¼ˆæˆ–è¿›ä¸€æ­¥å¼•å‘å¼‚å¸¸ï¼‰ã€‚ å¦‚æœä¸€å®šæ•°é‡çš„è¿ç»­å‘¼å«å¤±è´¥ï¼Œä¿é™©ä¸å°†æ–­å¼€ç”µè·¯ï¼ˆæ›´å¤šæœ‰å…³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ­¤å¤„</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ­¤å¤„çš„</a>æ–­è·¯å™¨çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä¿¡æ¯</a> ï¼‰ï¼Œä»è€Œæœ‰æ—¶é—´æ¢å¤æ‰è½çš„å¾®æœåŠ¡ã€‚ <br><br> è¦ä½¿ç”¨Feignå®¢æˆ·ç«¯ï¼Œæ‚¨éœ€è¦æ³¨é‡Š<code>@EnableFeignClients</code>åº”ç”¨ç¨‹åº<code>@EnableFeignClients</code> ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableFeignClients(clients = [ItemsServiceFeignClient::class])</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemsUiApplication</span></span></span></span></code> </pre> <br> è¦åœ¨Feignå®¢æˆ·ç«¯ä¸­ä½¿ç”¨Hystrixåå¤‡ï¼Œæ‚¨éœ€è¦åœ¨åº”ç”¨ç¨‹åºé…ç½®ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="plaintext hljs">feign: hystrix: enabled: true</code> </pre> <br> è¦åœ¨Feignå®¢æˆ·ç«¯ä¸­æµ‹è¯•Hystrix fallbackçš„æ“ä½œï¼Œåªéœ€è½¬åˆ°<code>http://localhost:8081/hystrix-fallback</code> ã€‚  Feignå®¢æˆ·ç«¯å°†å°è¯•åœ¨ItemsæœåŠ¡ä¸­ä¸å­˜åœ¨çš„è·¯å¾„ä¸Šæ‰§è¡Œè¯·æ±‚ï¼Œè¿™å°†å¯¼è‡´è¿”å›å“åº”ï¼š <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"error"</span></span> : <span class="hljs-string"><span class="hljs-string">"Some error"</span></span>}</code> </pre> <br><h1>  UIç½‘å…³ </h1><br> ä½¿ç”¨APIâ€‹â€‹ç½‘å…³æ¨¡å¼ï¼Œæ‚¨å¯ä»¥ä¸ºå…¶ä»–å¾®æœåŠ¡æä¾›çš„APIåˆ›å»ºå•ä¸ªå…¥å£ç‚¹ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ­¤å¤„æœ‰</a>æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼‰ã€‚ å®ç°æ­¤æ¨¡å¼çš„åº”ç”¨ç¨‹åºå°†è¯·æ±‚è·¯ç”±ï¼ˆè·¯ç”±ï¼‰åˆ°å¾®æœåŠ¡ï¼Œè¿˜å¯ä»¥æ‰§è¡Œå…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ã€‚ <br><br> åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œä¸ºäº†æ›´åŠ æ¸…æ™°èµ·è§ï¼Œå®ç°äº†ä¸€ä¸ªUIç½‘å…³ï¼Œå³ï¼Œç”¨äºä¸åŒUIçš„å•ä¸ªå…¥å£ç‚¹ï¼› æ˜¾ç„¶ï¼Œç½‘å…³APIçš„å®ç°æ–¹å¼ä¸æ­¤ç±»ä¼¼ã€‚ å¾®æœåŠ¡æ˜¯åœ¨Spring Cloud Gatewayæ¡†æ¶çš„åŸºç¡€ä¸Šå®ç°çš„ã€‚ æ›¿ä»£æ–¹æ¡ˆæ˜¯Netflix Zuulï¼Œå®ƒæ˜¯Netflix OSSçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä½¿ç”¨Spring Cloud Netflixä¸Spring Booté›†æˆã€‚ <br>  UIç½‘å…³ä½¿ç”¨ç”Ÿæˆçš„SSLè¯ä¹¦ï¼ˆä½äºé¡¹ç›®ä¸­ï¼‰åœ¨ç«¯å£443ä¸Šè¿è¡Œã€‚  SSLå’ŒHTTPSçš„é…ç½®å¦‚ä¸‹ï¼š <br><br><pre> <code class="plaintext hljs">server: port: 443 ssl: key-store: classpath:keystore.p12 key-store-password: qwerty key-alias: test_key key-store-type: PKCS12</code> </pre> <br> ç”¨æˆ·ç™»å½•åå’Œå¯†ç å­˜å‚¨åœ¨ç‰¹å®šäºWebFluxçš„<code>ReactiveUserDetailsService</code>æ¥å£çš„åŸºäºMapçš„å®ç°ä¸­ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reactiveUserDetailsService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ReactiveUserDetailsService { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user = User.withDefaultPasswordEncoder() .username(<span class="hljs-string"><span class="hljs-string">"john_doe"</span></span>).password(<span class="hljs-string"><span class="hljs-string">"qwerty"</span></span>).roles(<span class="hljs-string"><span class="hljs-string">"USER"</span></span>) .build() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> admin = User.withDefaultPasswordEncoder() .username(<span class="hljs-string"><span class="hljs-string">"admin"</span></span>).password(<span class="hljs-string"><span class="hljs-string">"admin"</span></span>).roles(<span class="hljs-string"><span class="hljs-string">"ADMIN"</span></span>) .build() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MapReactiveUserDetailsService(user, admin) }</code> </pre> <br> å®‰å…¨è®¾ç½®é…ç½®å¦‚ä¸‹ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">springWebFilterChain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(http: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ServerHttpSecurity</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: SecurityWebFilterChain = http .formLogin().loginPage(<span class="hljs-string"><span class="hljs-string">"/login"</span></span>) .and() .authorizeExchange() .pathMatchers(<span class="hljs-string"><span class="hljs-string">"/login"</span></span>).permitAll() .pathMatchers(<span class="hljs-string"><span class="hljs-string">"/static/**"</span></span>).permitAll() .pathMatchers(<span class="hljs-string"><span class="hljs-string">"/favicon.ico"</span></span>).permitAll() .pathMatchers(<span class="hljs-string"><span class="hljs-string">"/webjars/**"</span></span>).permitAll() .pathMatchers(<span class="hljs-string"><span class="hljs-string">"/actuator/**"</span></span>).permitAll() .anyExchange().authenticated() .and() .csrf().disable() .build()</code> </pre> <br> ç»™å®šçš„é…ç½®ç¡®å®šéƒ¨åˆ†Webèµ„æºï¼ˆä¾‹å¦‚ï¼Œé™æ€èµ„æºï¼‰å¯ç”¨äºæ‰€æœ‰ç”¨æˆ·ï¼ŒåŒ…æ‹¬å°šæœªé€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œè€Œå…¶ä»–æ‰€æœ‰å†…å®¹ï¼ˆ <code>.anyExchange()</code> ï¼‰éƒ½ä»…é€šè¿‡èº«ä»½éªŒè¯ã€‚ å¦‚æœæ‚¨å°è¯•è¾“å…¥éœ€è¦èº«ä»½éªŒè¯çš„URLï¼Œå®ƒå°†è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼ˆ <code>https://localhost/login</code> ï¼‰ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vz/eu/yx/vzeuyxohx_kfb17mrg4llnv4n8q.png"></div><br> è¯¥é¡µé¢ä½¿ç”¨Bootstrapæ¡†æ¶çš„å·¥å…·ï¼Œè¯¥å·¥å…·ä½¿ç”¨Webjarsè¿æ¥åˆ°é¡¹ç›®ï¼Œè¿™ä½¿å¾—å¯ä»¥å°†å®¢æˆ·ç«¯åº“ä½œä¸ºå¸¸è§„ä¾èµ–é¡¹è¿›è¡Œç®¡ç†ã€‚  Thymeleafç”¨äºå½¢æˆHTMLé¡µé¢ã€‚ ä½¿ç”¨WebFluxé…ç½®å¯¹ç™»å½•é¡µé¢çš„è®¿é—®ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">routes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = router { GET(<span class="hljs-string"><span class="hljs-string">"/login"</span></span>) { ServerResponse.ok().contentType(MediaType.TEXT_HTML).render(<span class="hljs-string"><span class="hljs-string">"login"</span></span>) } }</code> </pre> <br> å¯ä»¥åœ¨YAMLæˆ–Javaé…ç½®ä¸­é…ç½®Spring Cloud Gatewayè·¯ç”±ã€‚ åˆ°å¾®æœåŠ¡çš„è·¯ç”±å¯ä»¥æ‰‹åŠ¨åˆ†é…ï¼Œä¹Ÿå¯ä»¥åŸºäºä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æ¥æ”¶åˆ°çš„æ•°æ®è‡ªåŠ¨åˆ›å»ºã€‚ åœ¨éœ€è¦è·¯ç”±åˆ°è¶³å¤Ÿå¤šçš„UIçš„æƒ…å†µä¸‹ï¼Œä¸Service Registryé›†æˆä½¿ç”¨å°†æ›´åŠ æ–¹ä¾¿ï¼š <br><br><pre> <code class="plaintext hljs">spring: cloud: gateway: discovery: locator: enabled: true lower-case-service-id: true include-expression: serviceId.endsWith('-UI') url-expression: "'lb:http://'+serviceId"</code> </pre> <br>  <code>include-expression</code>å‚æ•°çš„å€¼è¡¨ç¤ºå°†ä»…ä¸ºåç§°ä»¥<i>-UI</i>ç»“å°¾çš„å¾®æœåŠ¡åˆ›å»ºè·¯ç”±ï¼Œå¹¶ä¸”<code>url-expression</code>å‚æ•°çš„å€¼æ˜¯å®ƒä»¬å¯é€šè¿‡HTTPåè®®è®¿é—®ï¼Œè¿™ä¸é€šè¿‡HTTPSèµ·ä½œç”¨çš„UIç½‘å…³ä¸åŒï¼Œå¹¶ä¸”åœ¨è®¿é—®æ—¶ä»–ä»¬å°†ä½¿ç”¨å®¢æˆ·ç«¯è´Ÿè½½å¹³è¡¡ï¼ˆä½¿ç”¨Netflix Ribbonå®ç°ï¼‰ã€‚ <br><br> è€ƒè™‘åœ¨Javaé…ç½®ä¸­æ‰‹åŠ¨åˆ›å»ºè·¯ç”±çš„ç¤ºä¾‹ï¼ˆä¸ä¸Serviceæ³¨å†Œè¡¨é›†æˆï¼‰ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">routeLocator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(builder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RouteLocatorBuilder</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = builder.routes { route(<span class="hljs-string"><span class="hljs-string">"eureka-gui"</span></span>) { path(<span class="hljs-string"><span class="hljs-string">"/eureka"</span></span>) filters { rewritePath(<span class="hljs-string"><span class="hljs-string">"/eureka"</span></span>, <span class="hljs-string"><span class="hljs-string">"/"</span></span>) } uri(<span class="hljs-string"><span class="hljs-string">"lb:http://eureka-server"</span></span>) } route(<span class="hljs-string"><span class="hljs-string">"eureka-internals"</span></span>) { path(<span class="hljs-string"><span class="hljs-string">"/eureka/**"</span></span>) uri(<span class="hljs-string"><span class="hljs-string">"lb:http://eureka-server"</span></span>) } }</code> </pre> <br> ç¬¬ä¸€æ¡è·¯ç”±è·¯ç”±åˆ°å…ˆå‰æ˜¾ç¤ºçš„EurekaæœåŠ¡å™¨ä¸»é¡µï¼ˆ <code>http://localhost:8761</code> ï¼‰ï¼Œç¬¬äºŒæ¡è·¯ç”±æ˜¯åŠ è½½è¯¥é¡µé¢ä¸Šçš„èµ„æºæ‰€å¿…éœ€çš„ã€‚ <br><br> è¯¥åº”ç”¨ç¨‹åºåˆ›å»ºçš„æ‰€æœ‰è·¯ç”±å‡ä½äº<code>https://localhost/actuator/gateway/routes</code> ã€‚ <br><br> åœ¨åŸºç¡€å¾®æœåŠ¡ä¸­ï¼Œå¯èƒ½æœ‰å¿…è¦è®¿é—®åœ¨UIç½‘å…³ä¸­ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„ç™»å½•åå’Œ/æˆ–è§’è‰²ã€‚ ä¸ºæ­¤ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå°†é€‚å½“çš„æ ‡å¤´æ·»åŠ åˆ°è¯·æ±‚ä¸­ï¼š <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddCredentialsGlobalFilter</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GlobalFilter { private val loggedInUserHeader = "logged-in-user" private val loggedInUserRolesHeader = "logged-in-user-roles" override fun filter</span></span></span></span>(exchange: ServerWebExchange, chain: GatewayFilterChain) = exchange.getPrincipal&lt;Principal&gt;() .flatMap { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> request = exchange.request.mutate() .header(loggedInUserHeader, it.name) .header(loggedInUserRolesHeader, (it <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Authentication).authorities?.joinToString(<span class="hljs-string"><span class="hljs-string">";"</span></span>) ?: <span class="hljs-string"><span class="hljs-string">""</span></span>) .build() chain.filter(exchange.mutate().request(request).build()) } }</code> </pre> <br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨UIç½‘å…³<code>https://localhost/items-ui/greeting</code>è½¬åˆ°Items UIï¼Œæ­£ç¡®åœ°å‡è®¾å·²ç»åœ¨Items UIä¸­å®ç°äº†è¿™äº›æ ‡å¤´çš„å¤„ç†ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rc/sl/_s/rcsl_sdjuf6vkxkite5h3rgzoui.png"></div><br>  Spring Cloud Sleuthæ˜¯ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æŸ¥è¯¢è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆã€‚ è·Ÿè¸ªIDï¼ˆä¼ é€’æ ‡è¯†ç¬¦ï¼‰å’Œè·¨åº¦IDï¼ˆå·¥ä½œæ ‡è¯†ç¬¦ï¼‰è¢«æ·»åŠ åˆ°é€šè¿‡å¤šä¸ªå¾®æœåŠ¡çš„è¯·æ±‚çš„æ ‡å¤´ä¸­ï¼ˆä¸ºäº†æ›´å®¹æ˜“ç†è§£ï¼Œæˆ‘ç®€åŒ–äº†è¯¥æ–¹æ¡ˆï¼› <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">è¿™æ˜¯</a>æ›´è¯¦ç»†çš„è¯´æ˜ï¼‰ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/1q/em/sp1qem4a6silx9bo3kh83enn_mu.png"></div><br> åªéœ€æ·»åŠ <code>spring-cloud-starter-sleuth</code>å³å¯è¿æ¥æ­¤åŠŸèƒ½ã€‚ <br><br> åœ¨æŒ‡å®šäº†é€‚å½“çš„æ—¥å¿—è®°å½•è®¾ç½®ä¹‹åï¼Œåœ¨ç›¸åº”çš„å¾®æœåŠ¡çš„æ§åˆ¶å°ä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„å†…å®¹ï¼ˆåœ¨å¾®æœåŠ¡åç§°ä¹‹åæ˜¾ç¤ºè·Ÿè¸ªIDå’Œè·¨åº¦IDï¼‰ï¼š <br><br><pre> <code class="plaintext hljs">DEBUG [ui-gateway,009b085bfab5d0f2,009b085bfab5d0f2,false] oscghRoutePredicateHandlerMapping : Route matched: CompositeDiscoveryClient_ITEMS-UI DEBUG [items-ui,009b085bfab5d0f2,947bff0ce8d184f4,false] oswrfunction.server.RouterFunctions : Predicate "(GET &amp;&amp; /example)" matches against "GET /example" DEBUG [items-service,009b085bfab5d0f2,dd3fa674cd994b01,false] oswrfunction.server.RouterFunctions : Predicate "(GET &amp;&amp; /{id})" matches against "GET /1"</code> </pre> <br> å¯¹äºåˆ†å¸ƒå¼è·Ÿè¸ªçš„å›¾å½¢è¡¨ç¤ºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¾‹å¦‚Zipkinï¼Œå®ƒå¯ä»¥å……å½“æœåŠ¡å™¨æ¥èšåˆæœ‰å…³æ¥è‡ªå…¶ä»–å¾®æœåŠ¡çš„HTTPè¯·æ±‚çš„ä¿¡æ¯ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ­¤å¤„æœ‰</a>æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼‰ã€‚ <br><br><h1> ç»„è£…æ–¹å¼ </h1><br> æ ¹æ®æ“ä½œç³»ç»Ÿï¼Œæ‰§è¡Œ<code>gradlew clean build</code>æˆ–<code>./gradlew clean build</code> ã€‚ <br><br> å¦‚æœå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">GradleåŒ…è£…å™¨</a> ï¼Œåˆ™æ— éœ€æœ¬åœ°å®‰è£…Gradleã€‚ <br><br> æ„å»ºå’Œéšåçš„å¯åŠ¨æˆåŠŸä¼ é€’ç»™JDK 11.0.1ã€‚ åœ¨æ­¤ä¹‹å‰ï¼Œè¯¥é¡¹ç›®åœ¨JDK 10ä¸Šè¿è¡Œï¼Œå› æ­¤æˆ‘è®¤ä¸ºåœ¨æ­¤ç‰ˆæœ¬ä¸Šï¼Œç»„è£…å’Œå¯åŠ¨ä¸ä¼šæœ‰é—®é¢˜ã€‚ æˆ‘æ²¡æœ‰æœ‰å…³JDKæ—©æœŸç‰ˆæœ¬çš„æ•°æ®ã€‚ å¦å¤–ï¼Œè¯·è®°ä½ï¼Œä½¿ç”¨çš„Gradle 5è‡³å°‘éœ€è¦JDK 8ã€‚ <br><br><h1> å‘å°„ </h1><br> æˆ‘å»ºè®®æŒ‰ç…§æœ¬æ–‡ä¸­æè¿°çš„é¡ºåºå¯åŠ¨åº”ç”¨ç¨‹åºã€‚ å¦‚æœä½¿ç”¨å¯ç”¨äº†è¿è¡Œä»ªè¡¨æ¿çš„Intellij IDEAï¼Œåˆ™åº”è·å¾—ä»¥ä¸‹å†…å®¹ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7h/yb/t0/7hybt0ljfcfnrkckajkikwctj-g.png"></div><br><h1> ç»“è®º </h1><br> æœ¬æ–‡ç ”ç©¶äº†Javaä¸–ç•Œä¸­å½“å‰æŠ€æœ¯å †æ ˆä¸Šçš„å¾®æœåŠ¡æ¶æ„ç¤ºä¾‹ï¼Œå…¶ä¸»è¦ç»„ä»¶å’ŒæŸäº›åŠŸèƒ½ã€‚ æˆ‘å¸Œæœ›å¯¹æŸäººæœ‰ç”¨ã€‚ æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼ <br><br><h1> å‚è€ƒæ–‡çŒ® </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">GitHub</a>é¡¹ç›®æºä»£ç  </li><li>  Chris Richardsonå¾®æœåŠ¡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ–‡ç« </a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">å…³äº</a> Martin Fowler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">çš„å¾®æœåŠ¡çš„æ–‡ç« </a> </li><li>  Martin Fowlerå¾®æœåŠ¡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æŒ‡å—</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN431474/">https://habr.com/ru/post/zh-CN431474/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN431460/index.html">11æœˆçš„â€œæµ‹è¯•è€…æ—¥å†â€ã€‚ åˆç†çš„é…å¯¹æµ‹è¯•</a></li>
<li><a href="../zh-CN431462/index.html">æˆ‘ä»¬å¦‚ä½•åˆ¶é€ èˆ¹èˆ¶å›¾ä¹¦æ‰«æä»ª</a></li>
<li><a href="../zh-CN431466/index.html">å¦‚ä½•åœæ­¢è¿½æ±‚å“è¶Šå¹¶å®ç°æœ€é«˜ç”Ÿäº§ç‡</a></li>
<li><a href="../zh-CN431468/index.html">ä½¿ç”¨Verilog HDLçš„å¼€å…³å‘ç”Ÿå™¨çš„å®é™…å®ç°</a></li>
<li><a href="../zh-CN431470/index.html">æ‚¨å¯ä»¥ï¼ˆè®¡ç®—æœºï¼‰ã€‚ å…³äºè¢«é—å¿˜çš„ç”µè§†èŠ‚ç›®çš„æ•…äº‹</a></li>
<li><a href="../zh-CN431478/index.html">Roskomnadzorä¼šè®®â€œä¸ªäººæ•°æ®ä¿æŠ¤â€</a></li>
<li><a href="../zh-CN431480/index.html">Magentoå‘å¸ƒäº†æ–°çš„ä¸»è¦å¹³å°ç‰ˆæœ¬-2.3.0 GA</a></li>
<li><a href="../zh-CN431482/index.html">è¿˜æœ‰ä½ Yota ...</a></li>
<li><a href="../zh-CN431486/index.html">éšå½¢è‹è‡ï¼šä¸€ç§é€šè¿‡ç»„ç»‡è‰²ç´ æ²‰ç€ç ”ç©¶ç¥ç»ç³»ç»Ÿçš„æ–°æ–¹æ³•</a></li>
<li><a href="../zh-CN431488/index.html">å£°éŸ³è°ƒåˆ¶</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>