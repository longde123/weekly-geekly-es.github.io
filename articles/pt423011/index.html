<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜí üßóüèø üëµ Gerenciamento de microsservi√ßos com Kubernetes e Istio üï¥üèª üñçÔ∏è ‚öõÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uma breve hist√≥ria sobre as vantagens e desvantagens dos microsservi√ßos, o conceito Service Mesh e as ferramentas do Google que permitem executar apli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gerenciamento de microsservi√ßos com Kubernetes e Istio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/423011/">  Uma breve hist√≥ria sobre as vantagens e desvantagens dos microsservi√ßos, o conceito Service Mesh e as ferramentas do Google que permitem executar aplicativos de microsservi√ßos sem obstruir sua cabe√ßa com in√∫meras configura√ß√µes de pol√≠ticas, acessos e certificados e encontrar rapidamente erros ocultos n√£o no c√≥digo, mas na l√≥gica do microsservi√ßo. <br><br><img src="https://habrastorage.org/webt/os/ta/tg/ostatgvg9ytjgcicnno567t2x_q.jpeg"><br><br>  O artigo √© baseado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio de Craig Box</a> na confer√™ncia DevOops 2017 do ano passado. O v√≠deo e a tradu√ß√£o do relat√≥rio est√£o sendo cortados. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/RnBXQpo6Mjs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Craig Box (Craig Box, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Twitter</a> ) - o DevRel do Google, encarregado dos microsservi√ßos e das ferramentas Kubernetes e Istio.  Sua hist√≥ria atual √© sobre o gerenciamento de microsservi√ßos nessas plataformas. <br><br>  Vamos come√ßar com um conceito relativamente novo chamado Service Mesh.  Este termo √© usado para descrever a rede de microsservi√ßos que interagem que comp√µem o aplicativo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91b/eb1/7c6/91beb17c6f784bdf2b8d433b44512285.jpg"><br><br>  Em um n√≠vel alto, vemos a rede como um canal que simplesmente move bits.  N√£o queremos nos preocupar com eles ou, por exemplo, com os endere√ßos MAC nos aplicativos, mas nos esfor√ßamos para pensar nos servi√ßos e conex√µes que eles precisam.  Se voc√™ olhar do ponto de vista da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OSI</a> , temos uma rede de terceiro n√≠vel (com fun√ß√µes para determinar a rota e o endere√ßamento l√≥gico), mas queremos pensar em termos da s√©tima (com a fun√ß√£o de acesso aos servi√ßos de rede). <br><br>  Como deve ser uma verdadeira rede de s√©timo n√≠vel?  Talvez desejemos ver algo como um tra√ßo de tr√°fego em torno de servi√ßos problem√°ticos.  Para que voc√™ possa se conectar ao servi√ßo e, ao mesmo tempo, o n√≠vel do modelo foi aumentado do terceiro n√≠vel.  Queremos ter uma id√©ia do que est√° acontecendo no cluster, encontrar depend√™ncias n√£o intencionais, descobrir as causas principais das falhas.  Tamb√©m precisamos evitar sobrecarga desnecess√°ria, por exemplo, conex√£o com alta lat√™ncia ou conex√£o a servidores com um cache frio ou n√£o totalmente aquecido. <br><br>  Devemos ter certeza de que o tr√°fego entre servi√ßos est√° protegido contra ataques triviais.  A autentica√ß√£o TLS m√∫tua √© necess√°ria, mas sem incorporar os m√≥dulos apropriados em todos os aplicativos que escrevemos.  √â importante poder controlar o que envolve nossos aplicativos, n√£o apenas no n√≠vel da conex√£o, mas tamb√©m em um n√≠vel superior. <br><br>  O Service Mesh √© uma camada que nos permite resolver os problemas acima em um ambiente de microsservi√ßo. <br><br><h2>  Mon√≥lito e microsservi√ßos: pr√≥s e contras </h2><br>  Mas primeiro nos perguntamos: por que dever√≠amos resolver esses problemas?  Como fizemos o desenvolvimento de software antes?  Tivemos um aplicativo que se parecia com isso - como um mon√≥lito. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c6/385/111/8c63851119c38df240c57cf399a8c344.jpg"><br><br>  √â √≥timo: todo o c√≥digo est√° √† vista.  Por que n√£o continuar usando essa abordagem? <br>  Sim, porque o mon√≥lito tem seus pr√≥prios problemas.  A principal dificuldade √© que, se queremos reconstruir esse aplicativo, precisamos reimplementar cada m√≥dulo, mesmo que nada tenha mudado.  Somos for√ßados a criar um aplicativo no mesmo idioma ou em idiomas compat√≠veis, mesmo que equipes diferentes trabalhem nele.  De fato, partes individuais n√£o podem ser testadas independentemente uma da outra.  Est√° na hora de mudar, est√° na hora dos microsservi√ßos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d19/ccb/fd5/d19ccbfd59552751e2171ba6b89ac9bc.jpg"><br><br>  Ent√£o, dividimos o mon√≥lito em partes.  Voc√™ pode perceber que neste exemplo removemos algumas depend√™ncias desnecess√°rias e paramos de usar os m√©todos internos chamados de outros m√≥dulos.  Criamos servi√ßos a partir dos modelos usados ‚Äã‚Äãanteriormente, criando abstra√ß√µes nos casos em que precisamos manter o estado.  Por exemplo, cada servi√ßo deve ter um estado independente para que, quando voc√™ o acesse, n√£o precise se preocupar com o que est√° acontecendo no restante de nosso ambiente. <br><br>  Qual √© o resultado? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd2/4da/729/cd24da7292ffd1e23eb4e56ca2842c5f.jpg"><br><br>  Deixamos o mundo de aplicativos gigantescos para obter o que realmente parece √≥timo.  Aceleramos o desenvolvimento, paramos de usar m√©todos internos, criamos servi√ßos e agora podemos escal√°-los independentemente, aumentar o servi√ßo sem ter que consolidar todo o resto.  Mas qual √© o pre√ßo da mudan√ßa que perdemos? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/234/b49/2b4234b49b4dcb5f79840391ee0f5a36.jpg"><br><br>  Tivemos chamadas confi√°veis ‚Äã‚Äãdentro de aplicativos porque voc√™ simplesmente chamou uma fun√ß√£o ou m√≥dulo.  Substitu√≠mos a chamada confi√°vel dentro do m√≥dulo por uma chamada de procedimento remoto n√£o confi√°vel.  Mas o servi√ßo do outro lado nem sempre est√° dispon√≠vel. <br><br>  Est√°vamos seguros, usando o mesmo processo dentro da mesma m√°quina.  Agora estamos nos conectando a servi√ßos que podem estar em m√°quinas diferentes e em uma rede n√£o confi√°vel. <br><br>  Na nova abordagem da rede, √© poss√≠vel a presen√ßa de outros usu√°rios que est√£o tentando se conectar aos servi√ßos.  Os atrasos aumentaram e, ao mesmo tempo, suas capacidades de medi√ß√£o diminu√≠ram.  Agora, temos conex√µes passo a passo em todos os servi√ßos que criam uma chamada de m√≥dulo e n√£o podemos mais apenas olhar para o aplicativo no depurador e descobrir o que exatamente causou a falha.  E esse problema precisa ser resolvido de alguma forma.  Obviamente, precisamos de um novo conjunto de ferramentas. <br><br><h2>  O que pode ser feito? </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/fd0/857/5a9/fd08575a99e8a4f4baf64d916eef077b.jpg"><br><br>  Existem v√°rias op√ß√µes.  Podemos pegar nosso aplicativo e dizer que, se o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RPC</a> n√£o funcionar pela primeira vez, tente novamente e novamente.  Espere um pouco e tente novamente ou adicione Jitter.  Tamb√©m podemos adicionar rastreamentos de entrada e sa√≠da para dizer que a chamada foi iniciada e encerrada, o que para mim √© equivalente a depura√ß√£o.  Voc√™ pode adicionar infraestrutura para fornecer autentica√ß√£o de conex√µes e ensinar todos os nossos aplicativos a trabalhar com a criptografia TLS.  Teremos que assumir o √¥nus do conte√∫do de equipes individuais e ter sempre em mente os v√°rios problemas que podem surgir nas bibliotecas SSL. <br><br>  Manter a consist√™ncia em v√°rias plataformas √© uma tarefa ingrata.  Gostaria que o espa√ßo entre aplicativos se tornasse razo√°vel, para que haja a possibilidade de rastreamento.  Tamb√©m precisamos alterar as configura√ß√µes no tempo de execu√ß√£o para n√£o recompilar ou reiniciar os aplicativos para migra√ß√£o.  Esta lista de desejos e implementa o Service Mesh. <br><br><h2>  Isstio </h2><br>  Fale sobre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Istio</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc8/cdf/0fe/fc8cdf0fe52823fcd092a2dd8de2aeb6.jpg"><br><br>  O Istio √© uma estrutura completa para conectar, gerenciar e monitorar a arquitetura de microsservi√ßos.  O Istio foi projetado para funcionar em cima do Kubernetes.  Ele pr√≥prio n√£o implementa o software e n√£o deseja disponibiliz√°-lo nas m√°quinas que usamos para esse fim em cont√™ineres no Kubernetes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ddb/e05/1e8/ddbe051e8e8f90273b1bd686d1f5c90e.jpg"><br><br>  Na figura, vemos tr√™s se√ß√µes diferentes das m√°quinas e blocos que comp√µem nossos microsservi√ßos.  Temos uma maneira de agrup√°-los usando os mecanismos fornecidos pelo Kubernetes.  Podemos segmentar e dizer que um grupo espec√≠fico, que pode ter escala autom√°tica, est√° anexado a um servi√ßo da web ou pode ter outros m√©todos de implanta√ß√£o, conter√° nosso servi√ßo da web.  Nesse caso, n√£o precisamos pensar em m√°quinas, operamos em termos do n√≠vel de acesso aos servi√ßos de rede. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/966/45b/f3c/96645bf3c0ff9d2104622a84edcafeeb.png"><br><br>  Esta situa√ß√£o pode ser representada na forma de um diagrama.  Considere um exemplo quando temos um mecanismo que faz algum processamento de imagem.  O usu√°rio √† esquerda √© o tr√°fego do qual chega at√© n√≥s no microsservi√ßo. <br><br>  Para aceitar o pagamento do usu√°rio, temos um microsservi√ßo de pagamento separado que chama uma API externa localizada fora do cluster. <br><br>  Para processar o logon do usu√°rio, fornecemos um microsservi√ßo de autentica√ß√£o e ele possui estados armazenados novamente fora do cluster no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">banco de dados Cloud SQL</a> . <br><br>  O que o Istio faz?  O Istio melhora o Kubernetes.  Voc√™ o instala usando uma fun√ß√£o alfa no Kubernetes chamada Initializer.  Quando voc√™ implanta o software, o kubernetes notar√° e perguntar√° se queremos alterar e adicionar outro cont√™iner dentro de cada kubernetes.  Este cont√™iner manipular√° caminhos e roteamento, esteja ciente de todas as altera√ß√µes de aplicativos. <br><br>  √â assim que o circuito se parece com o Istio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/398/f41/c6d/398f41c6dcbe3e0dea4741e71204d7bd.jpg"><br><br>  Temos m√°quinas externas que fornecem proxies de entrada e sa√≠da para o tr√°fego em um servi√ßo espec√≠fico.  Podemos descarregar as fun√ß√µes sobre as quais j√° falamos.  N√£o precisamos ensinar ao aplicativo como executar telemetria ou rastreamento usando TLS.  Mas podemos adicionar outras coisas por dentro: interrup√ß√£o autom√°tica, limite de velocidade, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libera√ß√£o de can√°rios</a> . <br><br>  Todo o tr√°fego passar√° por servidores proxy em m√°quinas externas, e n√£o diretamente para servi√ßos.  O Kubernetes faz tudo no mesmo endere√ßo IP.  Poderemos interceptar o tr√°fego que seria direcionado aos servi√ßos de front ou end. <br><br>  O proxy externo que o Istio usa √© chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Envoy</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a00/3ed/04f/a003ed04fc566d4f27b1e5df70e3ae21.jpg"><br><br>  O enviado √© realmente mais antigo que o Istio, foi desenvolvido na Lyft.  Trabalha na produ√ß√£o h√° mais de um ano, lan√ßando toda a infraestrutura de microsservi√ßos.  Escolhemos o Envoy para o projeto Istio em colabora√ß√£o com a comunidade.  Assim, Google, IBM e LYFT s√£o as tr√™s empresas que ainda est√£o trabalhando nisso. <br><br>  O Enviado √© escrito em C ++ 11. Est√° em produ√ß√£o h√° mais de 18 meses antes de se tornar um projeto de c√≥digo aberto.  N√£o ser√£o necess√°rios muitos recursos quando voc√™ o conectar aos seus servi√ßos. <br><br>  Aqui est√£o algumas coisas que o Enviado pode fazer.  Esta √© a cria√ß√£o de um servidor proxy para HTTP, incluindo HTTP / 2 e protocolos baseados nele, como o gRPC.  Tamb√©m pode encaminhar para outros protocolos no n√≠vel bin√°rio.  O enviado controla sua zona de infraestrutura para que voc√™ possa fazer sua parte aut√¥noma.  Ele pode lidar com um grande n√∫mero de conex√µes de rede com novas tentativas e espera.  Voc√™ pode definir um certo n√∫mero de tentativas de conex√£o com o servidor antes de interromper a chamada e transmitir informa√ß√µes aos servidores que o servi√ßo n√£o est√° respondendo. <br><br>  N√£o precisa se preocupar em recarregar o aplicativo para adicionar configura√ß√£o a ele.  Voc√™ simplesmente se conecta a ele usando uma API muito semelhante ao kubernetes e altera a configura√ß√£o no tempo de execu√ß√£o. <br><br>  A equipe do Istio fez uma grande contribui√ß√£o para a plataforma de envio UpStream.  Por exemplo, um alerta de erro de inje√ß√£o.  Tornamos poss√≠vel ver como o aplicativo se comporta no caso de exceder o n√∫mero de solicita√ß√µes para o objeto que falhou.  E tamb√©m implementou as fun√ß√µes de exibi√ß√£o gr√°fica e separa√ß√£o de tr√°fego para lidar com casos em que a implanta√ß√£o de can√°rios √© usada. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/068/0e1/351/0680e13511f2d5dc5eeac4bada02c05c.jpg"><br><br>  A figura mostra como √© a arquitetura do sistema Istio.  Tomaremos apenas dois microsservi√ßos mencionados anteriormente.  Por fim, no diagrama, tudo √© muito semelhante a uma rede definida por software.  No servidor proxy Envoy, implantado com os aplicativos, o tr√°fego √© transferido usando tabelas IP no espa√ßo para nome.  O painel de controle √© respons√°vel por gerenciar o console, mas n√£o processa o tr√°fego em si. <br>  N√≥s temos tr√™s componentes.  O piloto, que cria a configura√ß√£o, analisa as regras que podem ser alteradas usando a API do painel de controle do Istio e atualiza o Envoy para que ele se comporte como um servi√ßo de descoberta de cluster.  O Istio-Auth serve como uma autoridade de certifica√ß√£o e transmite certificados TLS para proxies.  O aplicativo n√£o requer SSL, eles podem se conectar via HTTP e os proxies cuidar√£o de tudo isso para voc√™. <br><br>  O Mixer processa solicita√ß√µes para garantir que voc√™ esteja em conformidade com a pol√≠tica de seguran√ßa e depois transmite informa√ß√µes de telemetria.  Sem fazer nenhuma altera√ß√£o no aplicativo, podemos ver tudo o que acontece dentro do nosso cluster. <br><br><h2>  Benef√≠cios do Istio </h2><br>  Ent√£o, vamos falar com mais detalhes sobre as cinco coisas que obteremos do Istio.  Primeiro de tudo, considere <b>o gerenciamento de tr√°fego</b> .  Podemos separar o controle de tr√°fego do dimensionamento da infraestrutura, para que pud√©ssemos fazer algo como 20 inst√¢ncias do aplicativo e 19 delas estar√£o na vers√£o antiga e uma na nova, ou seja, 5% do tr√°fego estar√° na nova vers√£o.  Com o Istio, podemos implantar qualquer n√∫mero de inst√¢ncias necess√°rias e, ao mesmo tempo, indicar qual porcentagem de tr√°fego deve ser enviada para novas vers√µes.  Uma simples regra de separa√ß√£o. <br><br>  Tudo pode ser programado em tempo real usando regras.  O enviado ser√° atualizado periodicamente conforme a configura√ß√£o for alterada, e isso n√£o levar√° a interrup√ß√µes no servi√ßo.  Como trabalhamos no n√≠vel de acesso aos servi√ßos de rede, podemos visualizar os pacotes e, nesse caso, existe a oportunidade de entrar no agente do usu√°rio, localizado no terceiro n√≠vel da rede. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/810/1a1/7d5/8101a17d596613c7cc6871ce0f7d238a.png"><br><br>  Por exemplo, podemos dizer que qualquer tr√°fego do iPhone segue uma regra diferente e vamos direcionar uma certa fra√ß√£o do tr√°fego para a nova vers√£o, que queremos testar para um dispositivo espec√≠fico.  O microsservi√ßo de chamada interna pode determinar a qual vers√£o espec√≠fica ele precisa se conectar e voc√™ pode transferi-lo para outra vers√£o, por exemplo, 2.0. <br><br>  A segunda vantagem √© a <b>transpar√™ncia</b> .  Quando voc√™ tem uma vis√£o dentro do cluster, pode entender como isso √© feito.  N√£o precisamos criar ferramentas para m√©tricas no processo de desenvolvimento.  As m√©tricas j√° est√£o em todos os componentes. <br><br>  Alguns acreditam que √© suficiente manter um registro de log para monitoramento.  Mas, na verdade, tudo o que precisamos √© ter um conjunto universal de indicadores que possa ser fornecido a qualquer servi√ßo de monitoramento. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/099/627/ab5/099627ab5e7b0615bb2e3725ce118160.jpg"><br><br>  √â assim que a barra de ferramentas do Istio criada usando o servi√ßo Prometheus se parece.  Lembre-se de implant√°-lo dentro do cluster. <br><br>  No exemplo, a captura de tela mostra v√°rios par√¢metros monitorados espec√≠ficos para todo o cluster.  Coisas mais interessantes podem ser deduzidas, por exemplo, qual porcentagem de aplicativos gera mais de 500 erros, o que implica uma falha.  O tempo de resposta √© agregado em todas as inst√¢ncias de servi√ßo de chamada e resposta no cluster; essa funcionalidade n√£o requer configura√ß√µes.  O Istio sabe o que o Prometheus oferece suporte e sabe quais servi√ßos est√£o dispon√≠veis no seu cluster, para que o Istio-Mixer possa enviar m√©tricas para o Prometheus sem nenhuma configura√ß√£o adicional. <br>  Vamos ver como isso funciona.  Se voc√™ chamar um servi√ßo espec√≠fico, o servi√ßo proxy envia informa√ß√µes sobre essa chamada ao Mixer, que captura par√¢metros como tempo de espera pela resposta, status do c√≥digo e IP.  Ele os normaliza e os envia para todos os servidores que voc√™ configurou.  Especialmente para exibir os principais indicadores, h√° o servi√ßo Prometheus e os adaptadores FLUX DB, mas voc√™ tamb√©m pode gravar seu pr√≥prio adaptador e exibir dados em qualquer formato para qualquer outro aplicativo.  E voc√™ n√£o precisa alterar nada na infraestrutura para adicionar uma nova m√©trica. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/477/8cf/7ea/4778cf7ea5f78c0d8dca61aaaf7756c5.jpg"><br><br>  Se voc√™ deseja fazer uma pesquisa mais aprofundada, use o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sistema de</a> rastreamento distribu√≠do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zipkin</a> .  Informa√ß√µes sobre todas as chamadas roteadas pelo Istio-Mixer podem ser enviadas para a Zipkin.  L√°, voc√™ ver√° toda a cadeia de chamadas de microsservi√ßo ao responder ao usu√°rio e encontrar√° facilmente um servi√ßo que est√° atrasando o tempo de processamento. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c0/820/3e5/1c08203e54bc8fc2cb3a0f6da427e497.jpg"><br><br>  No n√≠vel do aplicativo, h√° pouca necessidade de se preocupar em criar um rastreio.  O pr√≥prio enviado passa todas as informa√ß√µes necess√°rias para o Mixer, que as envia ao rastreamento, por exemplo, ao Zipkin, ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rastreamento</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">stackdriver</a> do Google ou a qualquer outro aplicativo de usu√°rio. <br><br>  Vamos falar sobre <b>toler√¢ncia a falhas e efici√™ncia</b> . <br><img src="https://habrastorage.org/getpro/habr/post_images/da4/c03/b1b/da4c03b1b08ebbc652e332c680b79599.jpg"><br><br>  √â necess√°rio tempo limite entre as chamadas de servi√ßo para testar a integridade de, antes de tudo, os balanceadores de carga.  Introduzimos erros nessa conex√£o e vemos o que acontece.  Considere um exemplo.  Suponha que exista uma conex√£o entre o servi√ßo A e o servi√ßo B. Esperamos uma resposta do servi√ßo de v√≠deo por 100 milissegundos e damos apenas 3 tentativas se o resultado n√£o for recebido.  Basicamente, vamos demorar 300 milissegundos antes de relatar uma tentativa de conex√£o sem √™xito. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c8/858/101/2c885810146ca5a44c88b42b2b1552c5.jpg"><br><br>  Al√©m disso, por exemplo, nosso servi√ßo de filmes deve analisar a classifica√ß√£o do filme atrav√©s de outro microsservi√ßo.  A classifica√ß√£o tem um tempo limite de 200 milissegundos e duas tentativas de chamada s√£o fornecidas.  Ligar para um servi√ßo de v√≠deo pode fazer com que voc√™ aguarde 400 milissegundos se a classifica√ß√£o por estrelas estiver fora de alcance.  Por√©m, lembramos que, ap√≥s 300 ms, o servi√ßo de filmes relatar√° que est√° ocioso e nunca saberemos a causa real da falha.  Usar tempos limite e testar o que acontece nesses casos √© uma √≥tima maneira de encontrar todos os tipos de erros inteligentes em sua arquitetura de microsservi√ßo. <br><br>  Vamos ver agora o que h√° com efici√™ncia.  O pr√≥prio balanceador de kubernetes age apenas no n√≠vel da quarta camada.  N√≥s inventamos um construtor de entrada para balanceamento de carga da segunda camada para a s√©tima.  O Istio √© implementado como um balanceador para a camada de rede com acesso aos servi√ßos de rede. <br><br>  Realizamos o descarregamento de TLS, portanto usamos SSL moderno e bem dopado no Envoy, para que voc√™ n√£o precise se preocupar com vulnerabilidades. <br><br>  Outra vantagem do Istio √© a <b>seguran√ßa</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/902/a1d/fcc/902a1dfcc83b7bbb4bc3d49463c5682b.jpg"><br><br>  Quais s√£o os recursos b√°sicos de seguran√ßa no Istio?  O servi√ßo Istio-Auth funciona em v√°rias dire√ß√µes.  Ele usa uma estrutura p√∫blica e um conjunto de padr√µes de autentica√ß√£o para servi√ßos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SPIFFE</a> .  Se estamos falando sobre fluxo de tr√°fego, temos uma autoridade de certifica√ß√£o Istio que emite certificados para as contas de servi√ßo que executamos dentro do cluster.  Esses certificados est√£o em conformidade com o padr√£o SPIFFE e s√£o distribu√≠dos pela Envoy usando o mecanismo de seguran√ßa kubernetes.  O enviado usa chaves para autentica√ß√£o TLS bidirecional.  Assim, os aplicativos de back-end recebem identificadores com base nos quais j√° √© poss√≠vel organizar uma pol√≠tica. <br><br>  O Istio mant√©m certificados raiz por conta pr√≥pria, para que voc√™ n√£o se preocupe com as datas de revoga√ß√£o e validade.  O sistema responder√° ao dimensionamento autom√°tico. Assim, ao introduzir uma nova entidade, voc√™ obt√©m um novo certificado.  Sem configura√ß√µes manuais.  Voc√™ n√£o precisa configurar um firewall.  Os usu√°rios usar√£o a pol√≠tica de rede e os kubernetes para implementar firewalls entre cont√™ineres. <br><br>  Finalmente, a <b>aplica√ß√£o de pol√≠ticas</b> .  O Mixer √© um ponto de integra√ß√£o com infra-estrutura que voc√™ pode expandir com o Service Mesh.  Os servi√ßos podem se mover facilmente dentro de um cluster, ser implantados em v√°rios ambientes, na nuvem ou localmente.  Tudo foi projetado para o controle operacional de chamadas que passam pelo Envoy.       ,      ,     . ,    -   20    .    20 ,   . <br><br>        , , ,    , ICL      .       ,  ,  ,   ,    . , Mixer      ,   .            . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/202/d7a/975/202d7a975db3a50477ac367ea4d6f1e4.jpg"><br><br>     ,      Istio?       .        .         ,         .     ,    . <br><br><h2>     Istio </h2><br> Istio    kubernetes,    ,    ,    1.7  .  -  kubernetes.    Google Container Engine Alpha clusters.    ,                 . <br><br>   Istio ‚Äî        github.      0.2.   0.1          kubernetes.   0.2          kubernetes.        ,     .    Envoy      ,    .   Istio    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cloud Foundry</a> . <br><br>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> .        Google Container Engine  1.8   -,   Istio ‚Äî     . <br><br><blockquote>     ,  14    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DevOops 2018</a> ():       ,         . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423011/">https://habr.com/ru/post/pt423011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt422997/index.html">O livro "PHP Moderno"</a></li>
<li><a href="../pt422999/index.html">Crie seu pr√≥prio conjunto de dados alien√≠genas</a></li>
<li><a href="../pt423005/index.html">Como o Yandex.Zen, o WordPress Caching Plugin e Hosting aumentaram minha press√£o</a></li>
<li><a href="../pt423007/index.html">‚ÄúMalyavki, mas bom‚Äù: como levamos os alunos a praticar</a></li>
<li><a href="../pt423009/index.html">Diagn√≥stico SENS. Biomarcadores de glica√ß√£o de prote√≠nas</a></li>
<li><a href="../pt423013/index.html">Como organizar suas depend√™ncias em um aplicativo Vue</a></li>
<li><a href="../pt423015/index.html">Git: erros comuns e como corrigi-los</a></li>
<li><a href="../pt423017/index.html">Bobbiniki: dez gravadores de rolo de cult - tell and show</a></li>
<li><a href="../pt423021/index.html">Online Hackathon por Naviaddress</a></li>
<li><a href="../pt423023/index.html">Por que os desenvolvedores precisam ensinar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>