<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ปโ๐ซ ๐๐ฟ โบ๏ธ ุงูุชุฒุงูู PostgreSQL: ููุณ ูุฑูููุง ุ ูููุณ ุญุตุงููุง ุ ูููุณ ูู ูุฑุงุบ ๐ง๐ฟ โซ๏ธ โฝ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุนุฏ ุชุทููุฑ ูุธุงู DBMS ูุณุชูุจููุง ูุชูุฏู ุจุงุณุชูุฑุงุฑ. DBMSs ุชุชุญุณู ูุชุชูุณุน ุจุดูู ุฃูุถู ุนูู ููุตุงุช ุงูุฃุฌูุฒุฉ ุ ูู ุญูู ุฃู ููุตุงุช ุงูุฃุฌูุฒุฉ ููุณูุง ุชุฒูุฏ ูู ุงูุฅูุชุงุฌูุฉ ุ ูุนุฏุฏ ุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุชุฒุงูู PostgreSQL: ููุณ ูุฑูููุง ุ ูููุณ ุญุตุงููุง ุ ูููุณ ูู ูุฑุงุบ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/423685/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/b0/s3/rq/b0s3rqkffufh7baruji0jc_vbgq.jpeg"><br><br>  ูุนุฏ ุชุทููุฑ ูุธุงู DBMS ูุณุชูุจููุง ูุชูุฏู ุจุงุณุชูุฑุงุฑ.  DBMSs ุชุชุญุณู ูุชุชูุณุน ุจุดูู ุฃูุถู ุนูู ููุตุงุช ุงูุฃุฌูุฒุฉ ุ ูู ุญูู ุฃู ููุตุงุช ุงูุฃุฌูุฒุฉ ููุณูุง ุชุฒูุฏ ูู ุงูุฅูุชุงุฌูุฉ ุ ูุนุฏุฏ ุงูููู ุ ูุงูุฐุงูุฑุฉ - ุฃุฎูู ุงููุญุงู ุจุงูุณูุญูุงุฉ ุ ูููู ูุง ูุฒุงู ูุง.  ูุดููุฉ ุชุญุฌูู DBMS ุนูู ูุฏู ูุณุงู. <br><br>  ูุงุฌู Postgres Professional ูุดููุฉ ูู ุงูุชูุณุน ููุณ ููุท ูุธุฑููุง ุ ูููู ุฃูุถูุง ุนููููุง: ูุน ุนููุงุฆู.  ูุฃูุซุฑ ูู ูุฑุฉ.  ุณุชุชู ููุงูุดุฉ ุฅุญุฏู ูุฐู ุงูุญุงูุงุช ูู ูุฐู ุงูููุงูุฉ. <br><br>  ูุชู ููุงุณ PostgreSQL ุจุดูู ุฌูุฏ ุนูู ุฃูุธูุฉ NUMA ุฅุฐุง ูุงูุช ููุญุฉ ุฃู ูุงุญุฏุฉ ูุน ูุนุงูุฌุงุช ูุชุนุฏุฏุฉ ููุงููุงุช ุจูุงูุงุช ูุชุนุฏุฏุฉ.  ูููู ูุฑุงุกุฉ ุจุนุถ ุงูุชุญุณููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุง</a> .  ููุน ุฐูู ุ ููุงู ูุฆุฉ ุฃุฎุฑู ูู ุงูุฃูุธูุฉ ุ ููุฏููุง ุงูุนุฏูุฏ ูู ุงูููุญุงุช ุงูุฃู ุ ููุชู ุชุจุงุฏู ุงูุจูุงูุงุช ุจูููุง ุจุงุณุชุฎุฏุงู ุงูุงุชุตุงู ุงูุจููู ุ ุจูููุง ูุนูู ูุซูู ูุงุญุฏ ูู ูุธุงู ุงูุชุดุบูู ุนูููุง ุ ูุจุงููุณุจุฉ ูููุณุชุฎุฏู ุ ูุจุฏู ูุฐุง ุงูุชุตููู ููุฃูู ุฌูุงุฒ ูุงุญุฏ.  ูุนูู ุงูุฑุบู ูู ุฃูู ูููู ุฃู ุชุนุฒู ูุฐู ุงูุฃูุธูุฉ ุฑุณูููุง ุฃูุถูุง ุฅูู NUMA ุ ูููููุง ูู ุฌููุฑูุง ุฃูุฑุจ ุฅูู ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงูุนููุงูุฉ ุ  ุงููุตูู ุฅูู ุงูุฐุงูุฑุฉ ุงููุญููุฉ ููุนูุฏุฉ ูุงููุตูู ุฅูู ุฐุงูุฑุฉ ุงูุนูุฏุฉ ุงููุฌุงูุฑุฉ ุชุฎุชูู ุงุฎุชูุงูุง ุฌุฐุฑูุง.  ูุนุชูุฏ ูุฌุชูุน PostgreSQL ุฃู ูุซูู Postgres ุงููุญูุฏ ุงูุฐู ูุนูู ุนูู ูุซู ูุฐู ุงูุจูู ูู ูุตุฏุฑ ุงููุดุงูู ุ ููุง ููุฌุฏ ููุฌ ููุธู ูุญููุง ุจุนุฏ. <br><a name="habracut"></a><br>  ูุฐูู ูุฃู ุจููุฉ ุงูุจุฑุงูุฌ ุงูุชู ุชุณุชุฎุฏู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ูุตููุฉ ุจุดูู ุฃุณุงุณู ูุญูููุฉ ุฃู ููุช ุงููุตูู ูุนูููุงุช ูุฎุชููุฉ ุฅูู ุฐุงูุฑุชูุง ุงูุฎุงุตุฉ ูุงูุฐุงูุฑุฉ ุงูุจุนูุฏุฉ ูููู ููุงุฑูุชู ุฅูู ุญุฏ ูุง.  ูู ุญุงูุฉ ุงูุนูู ูุน ุงูุนุฏูุฏ ูู ุงูุนูุฏ ุ ูุชููู ุงูุฑูุงู ุนูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ูููุงุฉ ุงุชุตุงู ุณุฑูุนุฉ ูุชุจุฑูุฑ ููุณูุง ุ ูุฃูู ูุธุฑูุง ูููุช ุงูุงุณุชุฌุงุจุฉ ุ ูููู ุฅุฑุณุงู ุทูุจ ูุชูููุฐ ุฅุฌุฑุงุก ูุนูู ุฅูู ุงูุนูุฏุฉ (ุงูุนูุฏุฉ) ุฃุฑุฎุต ุจูุซูุฑ ุจูุงูุงุช ูุซูุฑุฉ ููุงูุชูุงู ูู ุฅุฑุณุงู ูุฐู ุงูุจูุงูุงุช ูู ุงูุญุงููุฉ.  ูุฐูู ุ ุจุงููุณุจุฉ ููุญูุงุณูุจ ุงูุนููุงูุฉ ุ ูุจุดูู ุนุงู ุ ุงูุฃูุธูุฉ ุงูุชู ุชุญุชูู ุนูู ุงูุนุฏูุฏ ูู ุงูุนูุฏ ุ ูุฅู ุญููู ุงููุชูุฉ ุฐุงุช ุตูุฉ. <br><br>  ูุฐุง ูุง ูุนูู ุฃู ุงูุฌูุน ุจูู ุงูุฃูุธูุฉ ูุชุนุฏุฏุฉ ุงูุนูุฏ ูุจููุฉ ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ Postgres ุงููููุฐุฌูุฉ ูุญุชุงุฌ ุฅูู ูุถุน ุญุฏ ูู.  ุจุนุฏ ูู ุดูุก ุ ุฅุฐุง ูุงูุช ุนูููุงุช postgres ุชูุถู ูุนุธู ููุชูุง ูู ุฅุฌุฑุงุก ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุงููุนูุฏุฉ ูุญูููุง ุ ูุณุชููู ูุฐู ุงูุจููุฉ ุญุชู ูุนุงูุฉ ููุบุงูุฉ.  ูู ุญุงูุชูุง ุ ุงุดุชุฑู ุงูุนููู ุจุงููุนู ุฎุงุฏููุง ููููุง ูุชุนุฏุฏ ุงูุนูุฏุฉ ุ ููุงู ุนูููุง ุญู ูุดููุงุช PostgreSQL ุนููู. <br><br>  ููู ุงููุดุงูู ูุงูุช ุฎุทูุฑุฉ: ุชู ุชูููุฐ ุฃุจุณุท ุทูุจุงุช ุงููุชุงุจุฉ (ุชุบููุฑ ุงูุนุฏูุฏ ูู ููู ุงูุญููู ูู ุณุฌู ูุงุญุฏ) ูู ูุชุฑุฉ ูู ุนุฏุฉ ุฏูุงุฆู ุฅูู ุณุงุนุฉ.  ููุง ุชู ุชุฃููุฏู ูุงุญููุง ุ ูุฅู ูุฐู ุงููุดุงูู ุชุชุฌูู ูู ูู ูุฌุฏูุง ุนูู ูุฌู ุงูุชุญุฏูุฏ ุจุณุจุจ ุงูุนุฏุฏ ุงููุจูุฑ ูู ุงูููู ุ ูุจุงูุชุงูู ุ ุงูุชูุงุฒู ุงูุฌุฐุฑู ูู ุชูููุฐ ุงูุทูุจุงุช ูุน ุชุจุงุฏู ุจุทูุก ูุณุจููุง ุจูู ุงูุนูุฏ. <br><br>  ูุฐูู ุ ุณุชุธูุฑ ุงูููุงูุฉ ููุง ูู ูุงูุช ุฐุงุช ุงุณุชุฎุฏุงู ูุฒุฏูุฌ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุดุงุฑูุฉ ุงูุฎุจุฑุฉ: ูุงุฐุง ุชูุนู ุฅุฐุง ุชุจุงุทุฃุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ุฌุฏู ูู ูุธุงู ูุชุนุฏุฏ ุงูุนูุฏ.  ูู ุฃูู ูุจุฏุฃ ุ ูููููุฉ ุชุดุฎูุต ููุงู ุงูุงูุชูุงู. </li><li style=";text-align:right;direction:rtl">  ุตู ููู ูููู ุญู ูุดููุงุช PostgreSQL DBMS ููุณูุง ุจูุณุชูู ุนุงูู ูู ุงูุชูุงูู.  ุจูุง ูู ุฐูู ููู ูุคุซุฑ ุงูุชุบููุฑ ูู ุฎูุงุฑุฒููุฉ ุฃุฎุฐ ุงูุฃููุงู ุนูู ุฃุฏุงุก PostgreSQL. </li></ul><br><h3 style=";text-align:right;direction:rtl">  ุงูุฎุงุฏู ู DB </h3><br>  ูุชุฃูู ุงููุธุงู ูู 8 ุดูุฑุงุช ูุน 2 ููุงุจุณ ูู ูู ููููุง.  ูู ุงููุฌููุน ุ ุฃูุซุฑ ูู 300 ุงูููู (ุจุงุณุชุซูุงุก hypertreading).  ุฅุทุงุฑ ุณุฑูุน (ุชูููุฉ ุงูุดุฑูุฉ ุงููุตูุนุฉ) ูุฑุจุท ุงูุดูุฑุงุช.  ูุง ูุนูู ุฐูู ุฃูู ุฌูุงุฒ ููุจููุชุฑ ูุงุฆู ุ ูููู ุจุงููุณุจุฉ ููุซูู ูุงุญุฏ ูู DBMS ุ ูุฅู ุงูุชูููู ูุซูุฑ ููุฅุนุฌุงุจ. <br>  ุงูุญูู ูุจูุฑ ุฃูุถูุง.  ุฃูุซุฑ ูู 1 ุชูุฑุงุจุงูุช ูู ุงูุจูุงูุงุช.  ุญูุงูู 3000 ูุนุงููุฉ ูู ุงูุซุงููุฉ.  ุฃูุซุฑ ูู 1000 ุงุชุตุงูุงู ุจู postgres. <br><br>  ุจุนุฏ ุฃู ุจุฏุฃูุง ูู ุงูุชุนุงูู ูุน ุชููุนุงุช ุชุณุฌูู ุงูุณุงุนุฉ ุ ูุงู ุฃูู ุดูุก ูุนููุงู ูู ุงููุชุงุจุฉ ุฅูู ุงููุฑุต ูุณุจุจ ููุชุฃุฎูุฑ.  ุจูุฌุฑุฏ ุฃู ุจุฏุฃุช ุงูุชุฃุฎูุฑุงุช ุบูุฑ ุงููููููุฉ ุ ุจุฏุฃ ุฅุฌุฑุงุก ุงูุงุฎุชุจุงุฑุงุช ุญุตุฑููุง ุนูู <code>tmpfs</code> .  ูู ุชุชุบูุฑ ุงูุตูุฑุฉ.  ุงููุฑุต ูุง ุนูุงูุฉ ูู ุจู. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุดุฑูุน ูู ุงูุชุดุฎูุต: ุทุฑู ุงูุนุฑุถ </h3><br>  ูุธุฑูุง ูุฃู ุงููุดุงูู ุธูุฑุช ุนูู ุงูุฃุฑุฌุญ ุจุณุจุจ ุงูููุงูุณุฉ ุงูุนุงููุฉ ููุนูููุงุช ุงูุชู "ุชุฏู" ุนูู ููุณ ุงูุฃุดูุงุก ุ ูุฅู ุฃูู ุดูุก ูุฌุจ ุงูุชุญูู ููู ูู ุงูุฃููุงู.  ูู PostgreSQL ุ ููุงู ุทุฑููุฉ ุนุฑุถ <code>pg.catalog.pg_locks</code> ู <code>pg_stat_activity</code> ููุซู ูุฐุง ุงูุงุฎุชูุงุฑ.  ูุงูุซุงูู ุ ุจุงููุนู ูู ุงูุฅุตุฏุงุฑ 9.6 ุ ุฃุถุงู ูุนูููุงุช ุญูู ูุง ุชูุชุธุฑู ุงูุนูููุฉ ( <i>ุฃููุช ูุงุจููุง ุ Ildus Kurbangaliev</i> ) - <code>wait_event_type</code> .  ุงูููู ุงูููููุฉ ููุฐุง ุงููุฌุงู ููุตููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . <br><br>  ููู ุฃููุงู ุ ุงุญุณุจ ููุท: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">postgres=<span class="hljs-comment"><span class="hljs-comment"># SELECT COUNT(*) FROM pg_locks; count โ---โ 88453 (1 row) postgres=# SELECT COUNT(*) FROM pg_stat_activity; count โ---โ 1826 (1 row) postgres=# SELECT COUNT(*) FROM pg_stat_activity WHERE state ='active'; count โ---โ 1005</span></span></code> </pre> <br>  ูุฐู ุฃุฑูุงู ุญููููุฉ.  ูุตูุช ุฅูู 200ุ000 ููู. <br>  ูู ููุณ ุงูููุช ุ ุชู ุชุนููู ูุฐู ุงูุฃููุงู ุนูู ุงูุทูุจ ุงููุดุคูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">mode</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">mode</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_locks <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid =<span class="hljs-number"><span class="hljs-number">580707</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mode</span></span>; count | mode โ<span class="hljs-comment"><span class="hljs-comment">-----+---------------โ 93 | AccessShareLock 1 | ExclusiveLock</span></span></code> </pre> <br>  ุนูุฏ ูุฑุงุกุฉ ุงููุฎุฒู ุงููุคูุช ุ ูุณุชุฎุฏู DBMS ููู <code>share</code> ุ ุฃุซูุงุก ุงููุชุงุจุฉ - <code>exclusive</code> .  ุจูุนูู ุ ุดููุช ุฃููุงู ุงููุชุงุจุฉ ุฃูู ูู 1 ูช ูู ุฌููุน ุงูุทูุจุงุช. <br>  ูู ุทุฑููุฉ ุงูุนุฑุถ <code>pg_locks</code> ุ ูุง ุชุจุฏู ุฃููุงุน ุงูุชุฃููู ุฏุงุฆููุง ููุง ูู ููุถุญ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ูุซุงุฆู</a> ุงููุณุชุฎุฏู. <br><br>  ููุง ููุญุฉ ุงููุจุงุฑุงุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">AccessShareLock = LockTupleKeyShare RowShareLock = LockTupleShare ExclusiveLock = LockTupleNoKeyExclusive AccessExclusiveLock = LockTupleExclusive</code> </pre> <br>  ุฃุธูุฑ ุงุณุชุนูุงู SELECT ูุถุน FROM pg_locks ุฃู CREATE INDEX (ุจุฏูู CONCURRENTLY) ุณุชูุชุธุฑ 234 INSERTs ู 390 INSERTs <code>buffer content lock</code> .  ุงูุญู ุงููุญุชูู ูู "ุชุนููู" INSERTs ูู ุฌูุณุงุช ูุฎุชููุฉ ููุชูุงุทุน ุฃูู ูู ุงููุฎุงุฒู ุงููุคูุชุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุญุงู ุงูููุช ูุงุณุชุฎุฏุงู ุงูููุงู </h3><br>  ุชุฌูุน ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ <b><code>perf</code></b> ุงููุซูุฑ ูู ุงููุนูููุงุช ุงูุชุดุฎูุตูุฉ.  ูู ูุถุน ุงูุชุณุฌูู ... ููุชุจ ุฅุญุตุงุฆูุงุช ูุฃุญุฏุงุซ ุงููุธุงู ุฅูู ุงููููุงุช (ุจุดูู ุงูุชุฑุงุถู ูู <code>./perf_data</code> ) ุ ููู ูุถุน <code>report</code> ูููู ุจุชุญููู ุงูุจูุงูุงุช ุงูุชู ุชู ุฌูุนูุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ููููู ุชุตููุฉ ุงูุฃุญุฏุงุซ ุงูุชู ุชุชุนูู ููุท ุจู <code>postgres</code> ุฃู <code>pid</code> ูุนูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ perf record -u postgres  $ perf record -p 76876  ,  $ perf report &gt; ./my_results</code> </pre> <br>  ูุชูุฌุฉ ูุฐูู ุ ุณูุฑู ุดูุฆุง ูุซู <br><br><img src="https://habrastorage.org/webt/rn/ta/rv/rntarvj2jticq7glciiqockk3-y.jpeg"><br><br>  ูุชู ูุตู ููููุฉ ุงุณุชุฎุฏุงู <code>perf</code> ูุชุดุฎูุต PostgreSQL ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ุ ููุฐูู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููููู pg</a> . <br><br>  ูู ุญุงูุชูุง ุ ุญุชู ุงููุถุน ุงูุฃุจุณุท ุฃุนุทู ูุนูููุงุช ูููุฉ <code>perf top</code> - <code>perf top</code> ุ ูุงูุฐู ูุนูู ุ ุจุงูุทุจุน ุ ุจุฑูุญ ูุธุงู ุงูุชุดุบูู <code>top</code> .  ููุฏ ุฑุฃููุง ุฃูู ูุน <code>perf top</code> ููุถู ุงููุนุงูุฌ ูุนุธู ุงูููุช ูู <code>PinBuffer()</code> ุงูุฃุณุงุณูุฉ ุ ููุฐูู ูู <code>PinBuffer()</code> ู <code>LWLockAttemptLock().</code>  . <br><br>  <code>PinBuffer()</code> ูู ูุธููุฉ ุชุฒูุฏ ูู ุนุฏุงุฏ ุงูุฅุดุงุฑุงุช ุฅูู ุงููุฎุฒู ุงููุคูุช (ุชุนููู ุตูุญุฉ ุจูุงูุงุช ุฅูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู) ุ ุจูุถู ุนูููุงุช postgres ุชุนุฑู ุฃู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุชู ูููู <code>PinBuffer()</code> ูุง ูููู. <br><br>  <code>LWLockAttemptLock()</code> - ูุธููุฉ ุงูุชูุงุท <code>LWLock</code> .  <code>LWLock</code> ูู ููุน ูู ุงูููู ูุน ูุณุชูููู <code>shared</code> <code>LWLock</code> ุ ุฏูู ุชุญุฏูุฏ ุญุงูุงุช <code>deadlock</code> ุ ูุชู ุชุฎุตูุต ุงูุฃููุงู ูุณุจููุง <code>shared memory</code> ุ ุนูููุงุช ุงูุงูุชุธุงุฑ ุชูุชุธุฑ ูู ุทุงุจูุฑ. <br><br>  ููุฏ ุชู ุจุงููุนู ุชุญุณูู ูุฐู ุงููุธุงุฆู ุนูู ูุญูู ุงูุฌุฏ ูู PostgreSQL 9.5 ู 9.6.  ุชู ุงุณุชุจุฏุงู spinlocks ุฏุงุฎููุง ุจุงูุงุณุชุฎุฏุงู ุงููุจุงุดุฑ ููุนูููุงุช ุงูุฐุฑูุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฑุณูู ุงูุจูุงููุฉ ุงูููุจ </h3><br>  ุฅูู ูุณุชุญูู ุจุฏูููู: ุญุชู ูู ูุงููุง ุนุฏููู ุงููุงุฆุฏุฉ ุ ูุง ูุฒุงู ูู ุงูุฌุฏูุฑ ุฃู ูููู ุนููู - ููู ุฌูููุฉ ุจุดูู ุบูุฑ ุนุงุฏู.  ููููุง ูููุฏุฉ.  ููุง ุชูุถูุญ ูู <code>github</code> ุ ูููุณ ูู ูุถูุชูุง (ูุง ูุญู ููุง ุงูุนููู ุฌุงูุฒูู ูููุดู ุนู ุงูุชูุงุตูู ุญุชู ุงูุขู). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/75b/909/e8d/75b909e8de5177a48fa7d73f53eff437.svg"><br><br>  ุชูุธูุฑ ูุฐู ุงูุตูุฑ ุงูุฌูููุฉ ุจูุถูุญ ูุง ุชุชุทูุจู ุฏูุฑุงุช ุงููุนุงูุฌ.  ูููู <code>perf</code> ููุณู ุฌูุน ุงูุจูุงูุงุช ุ ูููู <code>flame graph</code> ูุชุตูุฑ ุงูุจูุงูุงุช ุจุฐูุงุก ุ ููุจูู ุงูุฃุดุฌุงุฑ ุจูุงุกู ุนูู ููุฏุณุงุช ุงูููุงููุงุช ุงููุฌูุนุฉ.  ููููู ูุฑุงุกุฉ ุงููุฒูุฏ ุญูู ุงูุชูููุท ุจุงุณุชุฎุฏุงู ุงูุฑุณูู ุงูุจูุงููุฉ ููุจ ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ุ ูุชูุฒูู ูู ูุง ุชุญุชุงุฌู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . <br><br>  ูู ุญุงูุชูุง ุ ูุงูุช ูููุฉ ูุจูุฑุฉ ูู <code>nestloop</code> ูุฑุฆูุฉ ุนูู ุงูุฑุณูู ุงูุจูุงููุฉ ุงูููุจ.  ุนูู ูุง ูุจุฏู ุ ุชุณุจุจุช JOINs ูุนุฏุฏ ูุจูุฑ ูู ุงูุฌุฏุงูู ูู ุงูุนุฏูุฏ ูู ุทูุจุงุช ุงููุฑุงุกุฉ ุงููุชุฒุงููุฉ ูู ุนุฏุฏ ูุจูุฑ ูู ุนูููุงุช ุชุฃููู <code>access share</code> . <br><br>  ุชุธูุฑ ุงูุฅุญุตุงุฆูุงุช ุงูุชู ุชู ุฌูุนูุง ุจูุงุณุทุฉ <code>perf</code> ุฃูู ุชุฐูุจ ุฏูุฑุงุช ุงููุนุงูุฌ.  ูุนูู ุงูุฑุบู ูู ุฃููุง ุฑุฃููุง ุฃู ูุนุธู ููุช ุงููุนุงูุฌ ููุฑ ุนูู ุงูุฃููุงู ุ ุฅูุง ุฃููุง ูู ูุฑ ูุง ูุคุฏู ุจุงูุถุจุท ุฅูู ูุซู ูุฐู ุงูุชููุนุงุช ุงูุทูููุฉ ููุฃููุงู ุ ุญูุซ ุฃููุง ูุง ูุฑู ุจุงูุถุจุท ุฃูู ุชุญุฏุซ ุชููุนุงุช ุงูููู ุ ูุฃู  ููุช ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูุง ูุถูุน ุงูุงูุชุธุงุฑ. <br><br>  ููุดุงูุฏุฉ ุงูุชููุนุงุช ุจุฃููุณูู ุ ููููู ุฅูุดุงุก ุทูุจ ูุนุฑุถ ุงููุธุงู <code>pg_stat_activity</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wait_event_type, wait_event, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> wait_event_type, wait_event;</code> </pre> <br>  ูุดูุช ุฃู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">LWLockTranche | buffer_content | UPDATE ************* LWLockTranche | buffer_content | INSERT INTO ******** LWLockTranche | buffer_content | \r | | insert into B4_MUTEX | | values (nextval('hib | | returning ID Lock | relation | INSERT INTO B4_***** LWLockTranche | buffer_content | UPDATE ************* Lock | relation | INSERT INTO ******** LWLockTranche | buffer_mapping | INSERT INTO ******** LWLockTranche | buffer_content | \r</code> </pre> <br>  (ุงูุนูุงูุงุช ุงููุฌููุฉ ููุง ุชุณุชุจุฏู ุจุจุณุงุทุฉ ุชูุงุตูู ุงูุทูุจ ุงูุชู ูู ููุดู ุนููุง). <br><br>  ููููู ุฑุคูุฉ ููู <code>buffer_content</code> (ุญุธุฑ ูุญุชููุงุช ุงููุฎุงุฒู ุงููุคูุชุฉ) ู <code>buffer_mapping</code> (ุญุธุฑ ููููุงุช ููุญุฉ ุงูุชุฌุฒุฆุฉ <code>shared_buffers</code> ). <br><br><h3 style=";text-align:right;direction:rtl">  ููุณุงุนุฏุฉ gdb </h3><br>  ูููู ููุงุฐุง ููุฌุฏ ุงููุซูุฑ ูู ุงูุชููุนุงุช ููุฐู ุงูุฃููุงุน ูู ุงูุฃููุงูุ  ููุญุตูู ุนูู ูุนูููุงุช ุฃูุซุฑ ุชูุตููุงู ุญูู ุงูุชููุนุงุช ุ ูุงู ุนูู ุงุณุชุฎุฏุงู ูุตุญุญ <code>GDB</code> .  ูุน <code>GDB</code> ูููููุง ุงูุญุตูู ุนูู ููุฏุณ ููุงููุงุช ูุนูููุงุช ูุญุฏุฏุฉ.  ูู ุฎูุงู ุชุทุจูู ุฃุฎุฐ ุงูุนููุงุช ุ ุฃู  ุจุนุฏ ุฌูุน ุนุฏุฏ ูุนูู ูู ููุฏุณุงุช ุงูููุงููุงุช ุงูุนุดูุงุฆูุฉ ุ ููููู ุงูุญุตูู ุนูู ููุฑุฉ ุนู ุงูููุฏุณุงุช ุงูุชู ููุง ุฃุทูู ุงูุชููุนุงุช. <br><br>  ุงููุธุฑ ูู ุนูููุฉ ุชุฌููุน ุงูุฅุญุตุงุกุงุช.  ุณููุธุฑ ูู ูุฌููุนุฉ "ุงูุฏููู" ููุฅุญุตุงุกุงุช ุ ุนูู ุงูุฑุบู ูู ุงุณุชุฎุฏุงู ูุตูุต ุฎุงุตุฉ ูู ุงูุญูุงุฉ ุงููุงูุนูุฉ ุชููู ุจุฐูู ุชููุงุฆููุง. <br><br>  ุฃููุงู ุ ูุฌุจ ุฅุฑูุงู gdb ุจุนูููุฉ PostgreSQL.  ููููุงู ุจุฐูู ุ ุงุจุญุซ ุนู <code>pid</code> ุนูููุฉ ุงูุฎุงุฏู ุ ุนูู ุณุจูู ุงููุซุงู ูู <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ ps aux | grep postgres</code> </pre> <br>  ูููุชุฑุถ ุฃููุง ูุฌุฏูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">postgres 2025 0.0 0.1 172428 1240 pts/17  S   23  0:00 /usr/local/pgsql/bin/postgres -D /usr/local/pgsql/data</code> </pre> <br>  ูุงูุขู ุฃุฏุฎู <code>pid</code> ูู ุงููุตุญุญ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">igor_le:~$gdb -p 2025</code> </pre> <br>  ูุฑุฉ ูุงุญุฏุฉ ุฏุงุฎู ุงููุตุญุญ ุ ููุชุจ <code>bt</code> [ุฃู <code>backtrace</code> ] ุฃู <code>where</code> .  ููุญุตู ุนูู ุงููุซูุฑ ูู ุงููุนูููุงุช ุญูู ูุฐุง ุงูููุน: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">(gdb) bt #0 0x00007fbb65d01cd0 in __write_nocancel () from /lib64/libc.so.6 #1 0x00000000007c92f4 in write_pipe_chunks ( data=0x110e6e8 "2018โ06โ01 15:35:38 MSK [524647]: [392โ1] db=bp,user=bp,app=[unknown],client=192.168.70.163 (http://192.168.70.163) LOG: relation 23554 new block 493: 248.389503\n2018โ06โ01 15:35:38 MSK [524647]: [393โ1] db=bp,user=bp,app=["..., len=409, dest=dest@entry=1) at elog.c:3123 #2 0x00000000007cc07b in send_message_to_server_log (edata=0xc6ee60 &lt;errordata&gt;) at elog.c:3024 #3 EmitErrorReport () at elog.c:1479</code> </pre> <br>  ุจุนุฏ ุฌูุน ุงูุฅุญุตุงุฆูุงุช ุ ุจูุง ูู ุฐูู ููุฏุณุงุช ุงูููุงููุงุช ูู ุฌููุน ุนูููุงุช postgres ุ ุงูุชู ุชู ุฌูุนูุง ุจุดูู ูุชูุฑุฑ ูู ููุงุท ุฒูููุฉ ูุฎุชููุฉ ุ ุฑุฃููุง ุฃู <code>buffer partition lock</code> ุฏุงุฎู <code>relation extension lock</code> ุงุณุชูุฑ 3706 ุซุงููุฉ (ุญูุงูู ุณุงุนุฉ) ุ ุฃู ุฃููุงู ุนูู ูุทุนุฉ ูู ุฌุฏูู ุชุฌุฒุฆุฉ ุงููุฎุฒู ุงููุคูุช ุงููุฏูุฑ ุ ุงูุฐู ูุงู ุถุฑูุฑููุง ูุชุญู ูุญู ุงููุฎุฒู ุงููุคูุช ุงููุฏูู ุ ูู ุฃุฌู ุงุณุชุจุฏุงูู ูุงุญููุง ุจูุงุญุฏ ุฌุฏูุฏ ูุชูุงูู ูุน ุงูุฌุฒุก ุงูููุชุฏ ูู ุงูุฌุฏูู.  ููุง ุชู ููุงุญุธุฉ ุนุฏุฏ ูุนูู ูู ุฃููุงู <code>buffer content lock</code> ุ ููู ูุง ูุชูุงูู ูุน ุชููุน ููู ุตูุญุงุช ููุฑุณ <code>B-tree</code> ููุฅุฏุฎุงู. <br><br><img src="https://habrastorage.org/webt/6c/y6/cw/6cy6cwmfye29jw84dkzoabjlgvg.jpeg"><br><br>  ูู ุงูุจุฏุงูุฉ ุ ุฌุงุก ุชูุณูุฑุงู ูููุช ุงูุชุธุงุฑ ูุงุฆู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุดุฎุต ุขุฎุฑ ุฃุฎุฐ ูุฐุง <code>LWLock</code> ูุชูุณู ุจู.  ููู ูุฐุง ุบูุฑ ูุฑุฌุญ.  ูุฃูู ูุง ููุฌุฏ ุดูุก ูุนูุฏ ูุญุฏุซ ุฏุงุฎู ููู ูุณู ุงููุฎุฒู ุงููุคูุช. </li><li style=";text-align:right;direction:rtl">  ูุงุฌููุง ุจุนุถ ุงูุณููู ุงููุฑุถู ูู <code>LWLock</code> .  ูุฐุง ุ ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃู ุฃุญุฏุงู ูู ููุณู ุงูููู ููุชุฑุฉ ุทูููุฉ ุ ููุฏ ุธู ุชููุนู ุทูููุงู ุจุดูู ุบูุฑ ูุนููู. </li></ul><br><h3 style=";text-align:right;direction:rtl">  ุจูุน ุงูุชุดุฎูุต ูุนูุงุฌ ุงูุฃุดุฌุงุฑ </h3><br>  ูู ุฎูุงู ุชูููู ุนุฏุฏ ุงูุงุชุตุงูุงุช ุงููุชุฒุงููุฉ ุ ูุฅููุง ุฑุจูุง ูููุฏ ุชุฏูู ุงูุทูุจุงุช ุฅูู ุงูุฃููุงู.  ููู ุฐูู ุณูููู ูุซู ุงูุงุณุชุณูุงู.  ุจุฏูุงู ูู ุฐูู ุ <i>ุงูุชุฑุญ ุฃููุณูุฏุฑ ููุฑูุชููู</i> ุ ูุจูุฑ ุงููููุฏุณูู ูู Postgres Professional (ุจุงูุทุจุน ุ ุณุงุนุฏ ูู ุฅุนุฏุงุฏ ูุฐู ุงูููุงูุฉ) ุ ุณูุณูุฉ ูู ุงูุชุตุญูุญุงุช. <br><br>  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุงู ูู ุงูุถุฑูุฑู ุงูุญุตูู ุนูู ุตูุฑุฉ ุฃูุซุฑ ุชูุตููุง ุนู ุงููุงุฑุซุฉ.  ุจุบุถ ุงููุธุฑ ุนู ูุฏู ุฌูุฏุฉ ุงูุฃุฏูุงุช ุงูููุงุฆูุฉ ุ ุณุชููู ุงูุจูุน ุงูุชุดุฎูุตูุฉ ูุชุตููุนูุง ูููุฏุฉ ุฃูุถูุง. <br><br>  ุชูุช ูุชุงุจุฉ ุชุตุญูุญ ูุถูู ุชุณุฌูููุง ุชูุตููููุง ููููุช ุงูุฐู ููุถูู ูู <code>relation extension</code> ุ ูุง ุงูุฐู ูุญุฏุซ ุฏุงุฎู ุฏุงูุฉ <code>RelationAddExtraBlocks()</code> . ูุฐุง ุ ุงูุชุดููุง ุงูููุช ุงูุฐู ููุถูู ุฏุงุฎู <code>RelationAddExtraBlocks().</code> <br><br>  ูุฏุนูุง ูู ุ ุชู ูุชุงุจุฉ ุชูุฑูุฑ ุฑูุนุฉ ุขุฎุฑ ูู ุชูุฑูุฑ <code>pg_stat_activity</code> ุญูู ูุง ูููู ุจู ุงูุขู <code>relation extension</code> .  ุชู ุฐูู ุนูู ูุฐุง ุงููุญู: ุนูุฏูุง ุชุชูุณุน <code>relation</code> ุ ูุตุจุญ <code>application_name</code> <code>RelationAddExtraBlocks</code> .  ูุชู ุงูุขู ุชุญููู ูุฐู ุงูุนูููุฉ ุจุดูู ููุงุฆู ูุน ุฃูุตู ูุฏุฑ ูู ุงูุชูุงุตูู ุจุงุณุชุฎุฏุงู <code>gdb bt</code> ู <code>perf</code> . <br><br>  ูู ุงููุงูุน ุชู ูุชุงุจุฉ ุจูุน ุทุจูุฉ (ูููุณ ุชุดุฎูุตูุฉ) ุงุซููู.  ุบููุฑ ุงูุชุตุญูุญ ุงูุฃูู ุณููู ุฃููุงู ุฃูุฑุงู <code>Bโtree</code> : ูู ููุช ุณุงุจู ุ ุนูุฏูุง ุทููุจ ุฅุฏุฎุงูู ุ ุชู ุญุธุฑ ุงููุฑูุฉ <code>share</code> ุ ูุจุนุฏ ุฐูู ุฃุตุจุญุช <code>exclusive</code> .  ุงูุขู ูุญุตู ุนูู ุงูููุฑ <code>exclusive</code> .  ุงูุขู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชู ุจุงููุนู ุชุซุจูุช</a> ูุฐุง ุงูุชุตุญูุญ ูู <b>PostgreSQL 12</b> .  ูุญุณู ุงูุญุธ ุ ุญุตู <i>ุฃููุณูุฏุฑ ููุฑูุชููู</i> ูุฐุง ุงูุนุงู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุตูุฉ</a> <i>ุงููุณุงูุฑ</i> - ุซุงูู PostgreSQL ูู ุฑูุณูุง ูุงูุซุงูู ูู ุงูุดุฑูุฉ. <br><br>  ุชู ุฃูุถูุง ุฒูุงุฏุฉ ูููุฉ <code>NUM_BUFFER_PARTITIONS</code> ูู 128 ุฅูู 512 ูุชูููู ุงูุญูู ุนูู ุฃููุงู ุงูุชุนููู: ุชู ุชูุณูู ุฌุฏูู ุชุฌุฒุฆุฉ ูุฏูุฑ ุงููุฎุฒู ุงููุคูุช ุฅูู ูุทุน ุฃุตุบุฑ ุ ุนูู ุฃูู ุฃู ูุชู ุชูููู ุงูุญูู ุนูู ูู ูุทุนุฉ ูุญุฏุฏุฉ. <br><br>  ุจุนุฏ ุชุทุจูู ูุฐุง ุงูุชุตุญูุญ ุ ุงุฎุชูุช ุงูุฃููุงู ุงูููุฌูุฏุฉ ุนูู ูุญุชููุงุช ุงููุฎุงุฒู ุงููุคูุชุฉ ุ ูููู ุนูู ุงูุฑุบู ูู ุงูุฒูุงุฏุฉ ูู <code>NUM_BUFFER_PARTITIONS</code> ุ ุจููุช <code>buffer_mapping</code> ุ ุฃู ุฃููุง ูุฐูุฑู ุจุญุธุฑ ูุทุน ุฌุฏูู ุชุฌุฒุฆุฉ ูุฏูุฑ ุงููุฎุฒู ุงููุคูุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">locks_count | active_session | buffer_content | buffer_mapping ----โโโ--โโโ+โ------โโโโโโโโโ+โโโ------โโโโโโโ+โโ------โโโ 12549 | 1218 | 0 | 15</code> </pre> <br>  ูุญุชู ูุฐุง ููุณ ุจุงููุซูุฑ.  ุจ- ูู ุชุนุฏ ุงูุดุฌุฑุฉ ุนูู ุงูุฒุฌุงุฌุฉ.  ุฌุงุก ุงูุชุฏุงุฏ <code>heap-</code> ุฅูู ุงูููุฏูุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุนูุงุฌ ุงูุถููุฑ </h3><br>  ุจุนุฏ ุฐูู ุ ุทุฑุญ ุฃููุณูุฏุฑ ุงููุฑุถูุฉ ูุงูุญู ุงูุชุงูู: <br><br>  ููุชุธุฑ ุงููุซูุฑ ูู ุงูููุช ุนูู <code>buffer parittion lock</code> ุนูุฏ <code>buffer parittion lock</code> ุงููุฎุฒู ุงููุคูุช.  ุฑุจูุง ุนูู ููุณ <code>buffer parittion lock</code> ููุงู ุจุนุถ ุงูุตูุญุงุช ุงููุทููุจุฉ ููุบุงูุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฌุฐุฑ ุจุนุถ <code>Bโtree</code>  ุนูุฏ ูุฐู ุงูููุทุฉ ุ ููุงู ุชุฏูู ูุณุชูุฑ ูุทูุจุงุช <code>shared lock</code> ูู ุทูุจุงุช ุงููุฑุงุกุฉ. <br><br>  ุฎุท ุงูุงูุชุธุงุฑ ูู <code>LWLock</code> "ููุณ ุนุงุฏูุงู".  ูุธุฑูุง ูุฃู <code>shared lock</code> ูููู ุฃุฎุฐูุง ุญุณุจ ุงูุญุงุฌุฉ ูู ููุช ูุงุญุฏ ุ ุซู ุฅุฐุง ุชู ุฃุฎุฐ <code>shared lock</code> ุจุงููุนู ุ ูุฅู <code>shared lock</code> ุงููุงุญูุฉ ุชูุฑ ุฏูู ุงูุชุธุงุฑ.  ูุจุงูุชุงูู ุ ุฅุฐุง ูุงู ุชุฏูู ุงูุฃููุงู ุงููุดุชุฑูุฉ ุจูุซุงูุฉ ูุงููุฉ ุจุญูุซ ูุง ุชูุฌุฏ "ููุงูุฐ" ุจููููุง ุ ูุฅู ุงูุชุธุงุฑ <code>exclusive lock</code> ูุฐูุจ ุฅูู ูุง ูุง ููุงูุฉ. <br><br>  ูุฅุตูุงุญ ุฐูู ุ ููููู ูุญุงููุฉ ุชูุฏูู - ุฑูุนุฉ ูู ุณููู ุงูุฃููุงู "ุงููุญุชุฑู".  ูููุธ ุถููุฑ <code>shared locker</code> ุทุงุจูุฑ ุจุตุฏู ุนูุฏูุง ูููู ูุฏููู ุจุงููุนู <code>exclusive lock</code> (ูู ุงููุซูุฑ ููุงูุชูุงู ุฃู ุงูุฃููุงู ุงูุซูููุฉ - <code>hwlock</code> - ููุณ ูุฏููู ูุดุงูู ูู ุงูุถููุฑ: ูู ุฏุงุฆููุง ูุตุทููู ุจุตุฏู) <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">locks_count | active_session | buffer_content | buffer_mapping | reladdextra | inserts&gt;30sec โโโโโโ-โโโโโ+โโโโโโโโโโโโโโโโ+โโโโโโโโโโโโโโโโ+โโโโโโโโโโโ--โ-โ+โโโโโโ-โโโโโโ+โโโโ------ 173985 | 1802 | 0 | 569 | 0 | 0</code> </pre> <br>  ูู ุดูุก ุนูู ูุง ูุฑุงู!  ูุง ุชูุฌุฏ <code>insert</code> ุทูููุฉ.  ุนูู ุงูุฑุบู ูู ุจูุงุก ุงูุฃููุงู ุนูู ูุทุน ููุญุงุช ุงูุชุฌุฒุฆุฉ.  ูููู ูุง ูุฌุจ ุงูููุงู ุจู ุ ูุฐู ูู ุฎุตุงุฆุต ุฅุทุงุฑุงุช ุญุงุณูุจูุง ุงูุตุบูุฑ ุงูุตุบูุฑ. <br><br>  ุชู <a href="">ุชูุฏูู</a> ูุฐุง ุงูุชุตุญูุญ ุฃูุถูุง <a href="">ูููุฌุชูุน</a> .  ูููู ุจุบุถ ุงููุธุฑ ุนู ููููุฉ ุชุทูุฑ ูุตูุฑ ูุฐู ุงูุชุตุญูุญุงุช ูู ุงููุฌุชูุน ุ ููุง ุดูุก ูููุนูู ูู ุงูุฏุฎูู ุฅูู ุงูุฅุตุฏุงุฑุงุช ุงูุชุงููุฉ ูู <b>Postgres Pro Enterprise</b> ุ ูุงูุชู ุชู ุชุตููููุง ุฎุตูุตูุง ููุนููุงุก ุงูุฐูู ูุฏููู ุฃูุธูุฉ ูุญููุฉ ุจูุซุงูุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ูุนููู </h3><br>  ุฃููุงู ุฎูููุฉ ุงููุฒู ุฐุงุช ุฃุฎูุงู ุนุงููุฉ - <code>exclusive</code> - ูุชู ุชุฎุทู ุงูุทุงุจูุฑ - ุญูุช ูุดููุฉ ุงูุชุฃุฎูุฑ ูู ุงูุณุงุนุฉ ูู ูุธุงู ูุชุนุฏุฏ ุงูุนูุฏ.  ูู ุชุนูู ุนูุงูุฉ ุชุฌุฒุฆุฉ <code>buffer manager</code> ุจุณุจุจ <code>share lock</code> ุชุฏูู <code>share lock</code> ุ ููุง ูู ูุชุฑู ุฃู ูุฑุตุฉ ููุฃููุงู ุงููุงุฒูุฉ ูุชุญู ูุญู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงููุฏููุฉ ูุชุญููู ูุฎุงุฒู ุฌุฏูุฏุฉ.  ูุงูุช ูุดุงูู ุชูุฏูุฏ ุงููุฎุฒู ุงููุคูุช ูุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชูุฌุฉ ูุฐูู ููุท.  ูุจู ุฐูู ุ ูุงู ูู ุงููููู ุชูุณูุน ุนูู ุงูุฒุฌุงุฌุฉ ูุน ุงููุตูู ุฅูู ุฌุฐุฑ <code>B-tree</code> <br><br>  ูู ูุชู ุชุตููู PostgreSQL ููุนูุงุฑูุงุช NUMA ูุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงูุนููุงูุฉ.  ูุนุฏ ุงูุชููู ูุน ููุงูู Postgres ูุฐู ูููุฉ ุถุฎูุฉ ุชุชุทูุจ (ูุฑุจูุง ุชุชุทูุจ) ุฌููุฏูุง ููุณูุฉ ููุนุฏูุฏ ูู ุงูุฃุดุฎุงุต ูุญุชู ุงูุดุฑูุงุช.  ูููู ูููู ุชุฎููู ุงูุนูุงูุจ ุบูุฑ ุงูุณุงุฑุฉ ููุฐู ุงููุดุงูู ุงููุนูุงุฑูุฉ.  ูุนูููุง ุฃู: ุฃููุงุน ุงูุญูู ุงูุชู ุฃุฏุช ุฅูู ุชุฃุฎูุฑุงุช ููุงุซูุฉ ูุชูู ุงูููุตููุฉ ูู ูููุฐุฌูุฉ ุชูุงููุง ุ ููุง ุชุฒุงู ุฅุดุงุฑุงุช ุงุณุชุบุงุซุฉ ููุงุซูุฉ ูู ุฃูุงูู ุฃุฎุฑู ุชุฃุชู ุฅูููุง.  ุธูุฑุช ูุดุงูู ููุงุซูุฉ ูู ููุช ุณุงุจู - ุนูู ุงูุฃูุธูุฉ ุฐุงุช ุงูููู ุงูุฃูู ุ ูู ุชูู ุงูุนูุงูุจ ูุฎููุฉ ููุบุงูุฉ ุ ูุชู ุนูุงุฌ ุงูุฃุนุฑุงุถ ุจุทุฑู ุฃุฎุฑู ูุจูุน ุฃุฎุฑู.  ุงูุขู ุธูุฑ ุฏูุงุก ุขุฎุฑ - ููุณ ุดุงููุงู ุ ููููู ูููุฏ ุจุดูู ูุงุถุญ. <br><br>  ูุฐูู ุ ุนูุฏูุง ุชุนูู PostgreSQL ูุน ุฐุงูุฑุฉ ุงููุธุงู ุจุฃูููู ูุฐุงูุฑุฉ ูุญููุฉ ุ ูุง ูููู ููุงุฑูุฉ ูุงูู ุนุงูู ุงูุณุฑุนุฉ ุจูู ุงูุนูุฏ ุจููุช ุงููุตูู ุฅูู ุงูุฐุงูุฑุฉ ุงููุญููุฉ.  ุชูุดุฃ ุงูููุงู ุจุณุจุจ ูุฐุง ุงูุฃูุฑ ุงูุตุนุจ ุ ุงูุนุงุฌู ุบุงูุจูุง ุ ููููู ูุซูุฑ ููุงูุชูุงู.  ูุชุฌุฑุจุฉ ุญููุง ูููุฏุฉ ููุณ ููุท ููุญุณู ุ ูููู ุฃูุถูุง ูููุฌุชูุน ุจุฃูููู. <br><br><img src="https://habrastorage.org/webt/od/n1/sf/odn1sf_id7l60ezlyo-padxymmi.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar423685/">https://habr.com/ru/post/ar423685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar423657/index.html">ุฃูุง ูุง ุฃุญุชุฑู ุงูุชุบููู ุ ุฃู ุงุณุชุฎุฏู ููุนูุง ูุฎุชูููุง ูู ุฌุฏูู ุงูุทุฑููุฉ ููุงุชุตุงู ุจุงูุทุฑู ุงูุฎุงุตุฉ ุจุณุฑุนุฉ</a></li>
<li><a href="../ar423663/index.html">ููุชุจ ูุชุฑุฌููุง ุจุณูุทูุง ูู Lisp - III</a></li>
<li><a href="../ar423677/index.html">ุงูุทูุงุฑูู ูู Jetpack: ูุฑุงููู ููุณุช</a></li>
<li><a href="../ar423679/index.html">ูููุฉ ูุน ูุงุทุญุฉ ุณุญุงุจ ูุจูุถ - ูููุณ ุณูุฉ ูููุชูุ</a></li>
<li><a href="../ar423683/index.html">ุจูุงุกู ุนูู ุงูุญุณ ุงูุณููู: ุชูููุฉ DevOps ูู ุงูุตูุฑ</a></li>
<li><a href="../ar423687/index.html">HyperX Pulsefire FPS Pro - ุฃุณุฑุน ูุฃูู ุชูููุฉ</a></li>
<li><a href="../ar423689/index.html">RTOS MAX - ูุฌุงููุ ูุฎุทุท ููุชุญ ุชุฑุฎูุต ููุงุณุชุฎุฏุงู ุงูุชุฌุงุฑู ุงููุฌุงูู</a></li>
<li><a href="../ar423693/index.html">ุทุฑููุฉ ุฃุฎุฑู ูุงุณุชุฎุฏุงู Webpack 4 ููุตู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ</a></li>
<li><a href="../ar423695/index.html">ููู ุชุชูุงุนุฏ ูุจู 40 ุณูุฉ ุจููููู ุฏููุงุฑ ูู ุญุณุงุจ ูุตุฑูู</a></li>
<li><a href="../ar423697/index.html">ููุฏู ููู ุจูุงูุงุช ุงูุฑุจูุน JDBC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>