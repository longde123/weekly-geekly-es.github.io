<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé£ üëºüèæ üëô EJTAG: Attraktion f√ºr Hacker-2 üé• üë∑üèº üë≤üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In meinen fr√ºheren EJTAG- Ver√∂ffentlichungen : Eine Attraktion f√ºr Hacker und Black Swift: Mit EJTAG wurde der einfachste Weg zur Verwendung von EJTAG...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>EJTAG: Attraktion f√ºr Hacker-2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/383505/"><img src="https://habrastorage.org/files/ac4/ecc/125/ac4ecc125c314e7682edb1a9e0fb99ed.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meinen fr√ºheren </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EJTAG-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ver√∂ffentlichungen </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">: Eine Attraktion f√ºr Hacker</font></a><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Black Swift: Mit EJTAG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wurde der einfachste Weg zur Verwendung von EJTAG in Betracht gezogen - Laden in den Arbeitsspeicher und Starten eines Benutzerprogramms. </font><font style="vertical-align: inherit;">Die F√§higkeiten von EJTAG sind jedoch nicht darauf beschr√§nkt. </font><font style="vertical-align: inherit;">In der Ver√∂ffentlichung wird beschrieben, wie Sie das einfache Debuggen von Code mithilfe von EJTAG mithilfe der Freeware-Tools openocd und GDB organisieren.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich wurde aufgefordert, diese Ver√∂ffentlichung durch einen Brief eines Lesers zu schreiben, der mich bat, anonym zu bleiben, und der mich um Hilfe bat - ein AR9344-basiertes Ger√§t bootet nicht (es h√§ngt in der U-Boot-Initialisierungsphase) - wie kann ich herausfinden, wo das Problem mit EJTAG liegt? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da ich kein Ger√§t zur Hand hatte, das auf dem AR9344 basiert, stellte sich heraus, dass das Black Swift Pro-Board, das auf dem zugeh√∂rigen AR9331-Chip basiert, die Erz√§hlung mit Blick darauf war. Ich denke, dass die √Ñnderungen, die f√ºr den AR9344 vorgenommen werden m√ºssen, nicht signifikant sind. </font><font style="vertical-align: inherit;">
Fahren wir mit </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
der Problemstellung fort: Es </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gibt eine Black Swift Pro-Karte, an die wir √ºber openocd √ºber EJTAG angeschlossen und den Prozessor in den Stoppmodus versetzt haben.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist erforderlich, mehrere zehn Prozessorbefehle nacheinander auszuf√ºhren, nach Ausf√ºhrung jedes Befehls anzuhalten und gegebenenfalls den Inhalt von RAM, Boot-ROM, Peripherie-Controller-Registern oder Prozessor-Registern zu √ºberpr√ºfen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um das Problem zu l√∂sen, sehe ich mindestens zwei Ans√§tze:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einfach - nur mit openocd - die grundlegende Funktionalit√§t zum Ausf√ºhren der erforderlichen Aktionen ist bereits in openocd enthalten. </font><font style="vertical-align: inherit;">Es ist nur notwendig, es benutzen zu k√∂nnen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komplex - Mit dem openocd + GDB-Bundle steuert der Benutzer den Prozess der Ausf√ºhrung von Prozessoranweisungen √ºber GDB, und openocd konvertiert GDB-Anforderungen in EJTAG-Befehle.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten Sie nun beide L√∂sungen genauer.</font></font><br>
<blockquote>    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Black Swift:  EJTAG</a>.<br>
</blockquote><br>
<br>
<h3> 1:   openocd</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diejenigen, die meine fr√ºheren Ver√∂ffentlichungen √ºber EJTAG gelesen haben, sollten sich daran erinnern, dass openocd in ihnen als dummer Skript-Executor (Konfigurationsdateien) angezeigt wird, der im Batch-Modus zu funktionieren scheint und keine Benutzerinteraktion erm√∂glicht. Dies ist jedoch nicht der Fall. W√§hrend die openocd-Software ausgef√ºhrt wird, kann sie tats√§chlich aufgefordert werden, einen Befehl √ºber die Befehlszeilenschnittstelle auszuf√ºhren. Um auf die Befehlszeilenschnittstelle zuzugreifen, startet openocd einen Telnet-Server. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Standardm√§√üig wird der TCP-Port 4444 f√ºr den Telnet-Server verwendet. Bei Bedarf kann die TCP-Portnummer mithilfe der Option ge√§ndert werden </font></font><code>telnet_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(siehe Beispiel unten). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, den Bootloader des Black Swift-Boards mit openocd zu verfolgen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispiel f√ºr eine Konfigurationsdatei</font></font><code>black-swift-trace.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºr openocd, wodurch openocd f√ºr den Telnet-Server gezwungen wird, Port 4455 zu verwenden:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quelle [find interface / ftdi / tumpa.cfg]</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 adapter_khz 6000</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Quelle [find black-swift.cfg]</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 telnet_port 4455</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 drin</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Halt</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Ausf√ºhren von openocd 0.9.0 als root sieht folgenderma√üen aus:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # openocd -f black-swift-trace.cfg</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Open On-Chip Debugger 0.9.0 (2015-05-28-17: 08)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Lizenziert unter GNU GPL v2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Lesen Sie f√ºr Fehlerberichte</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         http://openocd.org/doc/doxygen/bugs.html</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 keine getrennt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Adaptergeschwindigkeit: 6000 kHz</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Info: Automatische Auswahl des ersten verf√ºgbaren Sitzungstransports "jtag". </font><font style="vertical-align: inherit;">Verwenden Sie zum √úberschreiben 'transport select &lt;transport&gt;'.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Fehler: kein Ger√§t gefunden</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Fehler: ftdi-Ger√§t mit vid 0403, pid 8a98, Beschreibung '*' und seriellem '*' kann nicht ge√∂ffnet werden</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Info: Taktrate 6000 kHz</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Info: JTAG-Tipp: ar9331.cpu-Tipp / Ger√§t gefunden: 0x00000001 (Hersteller: 0x000, Teil: 0x0000, Version: 0x0)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Zielzustand: angehalten</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ziel im MIPS32-Modus aufgrund einer Debug-Anforderung angehalten, pc: 0xbfc00000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Zielzustand: angehalten</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ziel im MIPS32-Modus aufgrund von Einzelschritt angehalten, pc: 0xbfc00404</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt k√∂nnen wir ein weiteres Terminalfenster √∂ffnen und mit dem Programm eine Verbindung zum openocd-Telnet-Server herstellen </font></font><code>telnet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ telnet localhost 4455</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Versuch :: 1 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Versuch 127.0.0.1 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Verbunden mit localhost.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Escape-Zeichen ist '^]'.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 √ñffnen Sie den On-Chip-Debugger</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt;</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Liste aller openocd-Befehle ist mit dem Befehl leicht zu erhalten </font></font><code>help</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr die schrittweise Ausf√ºhrung von Prozessoranweisungen ist der </font></font><code>step</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folgende </font><font style="vertical-align: inherit;">Befehl hilfreich </font><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Schritt [Adresse]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       F√ºhren Sie einen Befehl an der vom Register angegebenen Adresse aus</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Befehlsz√§hler (PC). </font><font style="vertical-align: inherit;">Wenn der Adressparameter angegeben ist, dann</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Der Befehl wird beginnend mit der Adressadresse ausgef√ºhrt.</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die schrittweise Ausf√ºhrung von Prozessoranweisungen in der Konsole sieht folgenderma√üen aus:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; Schritt 0xbfc00400</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Zielzustand: angehalten</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ziel im MIPS32-Modus aufgrund von Einzelschritt angehalten, pc: 0xbfc00404</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; Schritt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Zielzustand: angehalten</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ziel im MIPS32-Modus aufgrund eines Einzelschritts angehalten, pc: 0xbfc00408</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; Schritt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Zielzustand: angehalten</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ziel im MIPS32-Modus aufgrund von Einzelschritt angehalten, pc: 0xbfc0040c</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgenden openocd-Befehle k√∂nnen ebenfalls n√ºtzlich sein:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reg [(register_number | register_name) [(value | 'force')]]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Prozessorregisterwert lesen oder schreiben.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Das Aufrufen von reg ohne Parameter f√ºhrt zur Ausgabe aller Register.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Wenn der Parameter 'force' verwendet wird, wird erzwungen</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Subtrahieren des Registers vom Prozessor (anstatt ein zwischengespeichertes auszugeben</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Werte).</font></font><font></font>
 <font></font>
 mwb ['phys'] address value [count]<font></font>
          address ,     value.<font></font>
          phys,   address ‚Äî  ,<font></font>
          ‚Äî .<font></font>
          count    address  <font></font>
           count,    <font></font>
         value.<font></font>
 <font></font>
 mwh ['phys'] address value [count]<font></font>
         mwb,     16- .<font></font>
 <font></font>
 mww ['phys'] address value [count]<font></font>
         mwb,     32- .<font></font>
 <font></font>
 mdb ['phys'] address [count]<font></font>
               address.<font></font>
          phys,   address ‚Äî  ,<font></font>
          ‚Äî .<font></font>
          count        <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Array an Adresse Adressl√§nge Anzahl Bytes.</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 mdh ['phys'] Adresse [Anzahl]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Der Befehl √§hnelt mdb, es wird jedoch anstelle eines Bytes ein 16-Bit-Wort gelesen</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 mdw ['phys'] address [count]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Der Befehl √§hnelt mdb, es wird jedoch ein 32-Bit-Wort anstelle eines Bytes gelesen.</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie leider sehen k√∂nnen, kann die neueste Version (zum Zeitpunkt dieses Schreibens) von openocd 0.9.0 Anweisungen von Prozessoren mit MIPS-Architektur nicht zerlegen, obwohl </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es einen solchen Disassembler f√ºr Prozessoren mit ARM-Architektur gibt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Fehlen eines Disassemblers macht die schrittweise Ausf√ºhrung von Prozessoranweisungen direkt mit openocd nicht sehr komfortabel. </font><font style="vertical-align: inherit;">Sie k√∂nnen den Komfort erh√∂hen, wenn Sie GDB verwenden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L√∂sung 2: Verwenden Sie das openocd + GDB-Bundle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im openocd + GDB-Bundle sind die Rollen wie folgt verteilt: Der Benutzer kommuniziert mit GDB, das eine bequeme Schnittstelle zum Debuggen bietet, von dem Mechanismus abstrahiert, mit dem die Ausf√ºhrung von Anweisungen gesteuert wird, und openocd √ºbernimmt die Aufgabe, den Prozessor gem√§√ü den Anweisungen von GDB direkt zu steuern. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verwendung von GDB zur Steuerung der Ausf√ºhrung von Anweisungen auf einem MIPS-Prozessor √ºber EJTAG bietet gegen√ºber openocd mehrere Vorteile:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie oben erw√§hnt, ist in GDB ein Disassembler f√ºr die MIPS-Architektur integriert.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist m√∂glich, Debugging-Informationen aus der Quelle zu verwenden. </font><font style="vertical-align: inherit;">Wenn Sie beispielsweise Ihr eigenes C-Programm debuggen, kann GDB anzeigen, welche C-Code-Zeile gerade ausgef√ºhrt wird, und den Status genau der Programmvariablen detaillieren, nicht der Speicherzellen mit mysteri√∂sen Adressen.</font></font></li>
<li>   openocd  GDB   GDB Remote Serial Protocol;  qemu    ,                ,              ‚Äî GDB;</li>
<li>,    GDB      TAB.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sollte bedacht werden, dass GDB mit hochrangigen Konzepten arbeitet und openocd gezwungen ist, mit den Ger√§ten zu arbeiten, die GDB Wishlist nicht immer effektiv mit EJTAG implementieren kann. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielsweise weist der Benutzer GDB an, einen Haltepunkt an der angegebenen Adresse festzulegen. Diese Anweisung geht an openocd. Bei MIPS-Prozessoren hat openocd jedoch mindestens zwei M√∂glichkeiten, einen Haltepunkt festzulegen:</font></font><br>
<ul>
<li>        sdbbp,        , openocd  sdbbp   ,    sdbbp     ,   .    software breakpoint.  ,          .</li>
<li>         .          .     , hardware breakpoint, .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl innerhalb des GDB Remote Serial Protocol zwischen Hardware-Haltepunkt und Software-Haltepunkt unterschieden wird (siehe Pakete z und z0 in der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protokollbeschreibung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) und GDB geeignete Optionen f√ºr die Auswahl des Haltepunkttyps bietet, kann sich herausstellen, dass die Verwendung von Punkten auf einem bestimmten Prozessor Einschr√§nkungen unterliegt Aufschl√ºsselung des einen oder anderen Typs. Dementsprechend verf√ºgt openocd √ºber eine Option </font></font><code>gdb_breakpoint_override</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mit der Sie eine der beiden beschriebenen Methoden zum Organisieren von Haltepunkten erzwingen k√∂nnen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den GDB-Debugger zu verbinden, implementiert openocd einen GDB-Server, der standardm√§√üig den TCP-Port 3333 verwendet. Bei Bedarf kann die TCP-Portnummer mithilfe der Option ge√§ndert werden </font></font><code>gdb_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um eine Verbindung zum openocd GDB-Server herzustellen, der den MIPS-Prozessor steuert, ben√∂tigen wir eine spezielle Version von GDB mit MIPS-Unterst√ºtzung. </font><font style="vertical-align: inherit;">Ich gehe davon aus, dass der Reader x86 / amd64-basierte Computer verwendet, auf denen Debian Linux ausgef√ºhrt wird, um openocd und GDB unter Verwendung von mips-linux-gnu-gdb aus dem Sourcery CodeBench-Paket auszuf√ºhren. </font><font style="vertical-align: inherit;">Informationen zur Installation dieses Pakets </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">hier</font></a><font style="vertical-align: inherit;"> . Sie m√ºssen lediglich die √Ñnderung einf√ºhren, dass zum Zeitpunkt des Schreibens dieser Zeilen die letzte Version von Sourcery CodeBench mips-2015.05-18 ist, die im Mai 2015 ver√∂ffentlicht wurde. Sie k√∂nnen das Archiv </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier √ºber diesen Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> herunterladen </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, das openocd + GDB-Bundle in der Praxis zu verwenden. </font><font style="vertical-align: inherit;">F√ºhren Sie openocd aus:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # openocd -f run-u-boot_mod-trace.cfg \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; -c "gdb_breakpoint_override hard" -c "Schritt 0xbfc00400"</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die letzten beiden Befehle f√ºr openocd bieten Folgendes:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware-Haltepunkte werden verwendet, unabh√§ngig davon, was GDB sich dort vorstellt (Adressen 0xbfc0xxxx entsprechen dem ROM, sodass Software-Haltepunkte nicht funktionieren).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Befehl wird von der Adresse 0xbfc00400 ausgef√ºhrt, wonach der Prozessor erneut stoppt.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√ñffnen Sie ein anderes Terminalfenster und starten Sie GDB:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ /opt/mips-2015.05/bin/mips-linux-gnu-gdb</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 GNU gdb (Sourcery CodeBench Lite 2015.05-18) 7.7.50.20140217-cvs</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Copyright (C) 2014 Freie Software Foundation, Inc.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Lizenz GPLv3 +: GNU GPL Version 3 oder h√∂her &lt;http://gnu.org/licenses/gpl.html&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Dies ist freie Software: Sie k√∂nnen sie √§ndern und weitergeben.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Es besteht KEINE GARANTIE, soweit dies gesetzlich zul√§ssig ist. </font><font style="vertical-align: inherit;">Geben Sie "Kopieren anzeigen" ein</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 und "Garantie anzeigen" f√ºr Details.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Diese GDB wurde als "--host = i686-pc-linux-gnu --target = mips-linux-gnu" konfiguriert.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Geben Sie "show configuration" f√ºr Konfigurationsdetails ein.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Anweisungen zur Fehlerberichterstattung finden Sie unter:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;https://sourcery.mentor.com/GNUToolchain/&gt;.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Das GDB-Handbuch und andere Dokumentationsressourcen finden Sie online unter:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;http://www.gnu.org/software/gdb/documentation/&gt;.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Um Hilfe zu erhalten, geben Sie "help" ein.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Geben Sie "apropos word" ein, um nach Befehlen zu suchen, die sich auf "word" beziehen.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt erkl√§ren wir GDB den Prozessortyp, mit dem wir arbeiten werden. Wir bitten Sie, die n√§chste ausf√ºhrbare Anweisung, den Prozessor, zu zerlegen und schlie√ülich eine Verbindung zum openocd GDB-Server herzustellen:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) setze Architektur-Mips: isa32r2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Es wird angenommen, dass die Zielarchitektur mips ist: isa32r2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) setze endian gro√ü</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Es wird angenommen, dass das Ziel Big Endian ist</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) disassemble-next-line aktivieren</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) Zielfernbedienung: 3333</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Remote-Debugging mit: 3333</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc00404 in ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc00404: 40 80 08 00 mtc0 Null, c0_random</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um einen Prozessorbefehl in GDB auszuf√ºhren, wird ein Befehl verwendet </font></font><code>stepi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Versuchen wir, ein paar Anweisungen des Prozessors zu befolgen, und lassen Sie sich nicht durch die Warnungen von GDB √ºber das Fehlen von Debugging-Informationen verwirren (der Start der Funktion kann nicht gefunden werden). In dieser Situation gibt es keinen Platz, um diese Informationen abzurufen.</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Warnung: GDB kann den Start der Funktion bei 0xbfc00408 nicht finden.</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     GDB kann den Start der Funktion bei 0xbfc00408 nicht finden</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 und kann daher die Gr√∂√üe des Stapelrahmens dieser Funktion nicht bestimmen.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Dies bedeutet, dass GDB m√∂glicherweise nicht auf diesen Stapelrahmen zugreifen kann, oder</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 die Rahmen darunter.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Dieses Problem wird h√∂chstwahrscheinlich durch einen ung√ºltigen Programmz√§hler oder verursacht</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Stapelzeiger.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Wenn Sie jedoch der Meinung sind, dass GDB einfach weiter zur√ºck suchen sollte</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 von 0xbfc00408 f√ºr Code, der wie der Anfang von a aussieht</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Funktion k√∂nnen Sie den Bereich der Suche mit dem `Set erh√∂hen</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 heuristischer Zaunpfosten 'Befehl.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc00408 in ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc00408: 40 80 10 00 mtc0 Null, c0_entrylo0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Warnung: GDB kann den Start der Funktion bei 0xbfc0040c nicht finden.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc0040c in ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc0040c: 40 80 18 00 mtc0 Null, c0_entrylo1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Warnung: GDB kann den Start der Funktion bei 0xbfc00410 nicht finden.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc00410 in ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc00410: 40 80 20 00 mtc0 Null, c0_context</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lesen Sie nun das 32-Bit-Wort unter 0xbfc00408:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) p / x * 0xbfc00408</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 $ 1 = 0x40801000</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verwenden Sie den folgenden Befehl, um den Status der Prozessorregister zu drucken </font></font><code>info registers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) Info-Register</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           Null bei v0 v1 a0 a1 a2 a3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R0 00000000 37c688e2 22b15a00 28252198 0c12d319 4193c014 84e49102 06193640</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             t0 t1 t2 t3 t4 t5 t6 t7</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R8 00000002 9f003bc0 92061301 1201c163 31d004a0 92944911 ac031248 b806001c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             s0 s1 s2 s3 s4 s5 s6 s7</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R16 8bc81985 402da011 c94d2454 88d5a554 81808e0d cc445151 4401a826 50020402</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             t8 t9 k0 k1 gp sp s8 ra</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R24 01c06b30 01000000 10000004 fffffffe 9f003bc0 54854eab 329d626b bfc004b4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         Status lo hi badvaddr Ursache PC</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       00400004 00244309 b9ca872c ed6a1f00 60808350 bfc00410</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           fcsr fir</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       00000000 00000000</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GDB ist ein erweitertes Tool mit einer Vielzahl von Befehlen und Optionen. </font><font style="vertical-align: inherit;">F√ºr eine n√§here Bekanntschaft mit GDB verweise ich den Leser auf die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offizielle GDB-Dokumentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialisierung des AR9331 RAM Controllers</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mal sehen, wie GDB ein bestimmtes Problem l√∂sen kann: Indem wir die U-Boot-Ausf√ºhrung auf der Black Swift-Karte verfolgen, identifizieren wir eine Folge von Eintr√§gen in den Registern des RAM-Controllers, die zu seiner Initialisierung f√ºhren. </font><font style="vertical-align: inherit;">Das Erkennen einer solchen Sequenz ist √§u√üerst n√ºtzlich, wenn wir Programme auf Black Swift unter Verwendung von openocd unter Umgehung des U-Boot ausf√ºhren m√∂chten. </font><font style="vertical-align: inherit;">Diese Initialisierungssequenz ist auch n√ºtzlich, wenn Sie einen alternativen Bootloader f√ºr Black Swift erstellen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºhren Sie openocd aus (genau wie im vorherigen Abschnitt):</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # openocd -f run-u-boot_mod-trace.cfg \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; -c "gdb_breakpoint_override hard" -c "Schritt 0xbfc00400"</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie ein Skript, um GDB auszuf√ºhren </font></font><code>bs-u-boot-trace-gdb.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> setze Architektur-Mips: isa32r2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 setze endian gro√ü</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Setzen Sie Disassemble-Next-Line auf</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Zielfernbedienung: 3333</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Paginierung ausl√∂sen</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Legen Sie die Protokolldatei bs_gdb.log fest</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Anmeldung einstellen</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 w√§hrend $ pc! = (void (*) ()) 0x9f002ab0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         Info-Register</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ende</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 abl√∂sen</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Verlassen</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Vergleich zum Beispiel im vorherigen Abschnitt bewirkt dieses Skript, dass GDB die Ausgabe in eine Datei dupliziert </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die Paginierung deaktiviert (Best√§tigung des Umbl√§tterns durch den Benutzer) und dann beginnt, Prozessoranweisungen zyklisch auszuf√ºhren und den Status der Prozessorregister nach jeder Anweisung anzuzeigen. </font><font style="vertical-align: inherit;">Wenn das PC-Register (Adressregister der folgenden Anweisung) den Wert 0x9f002ab0 erreicht, trennt GDB die Verbindung zu openocd und funktioniert nicht mehr. </font><font style="vertical-align: inherit;">Somit wird am Ende von GDB eine Datei </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit einer vollst√§ndigen Spur der Ausf√ºhrung von Prozessoranweisungen </font><font style="vertical-align: inherit;">erstellt </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Start von GDB wird wie folgt sein:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ /opt/mips-2015.05/bin/mips-linux-gnu-gdb -x bs-u-boot-trace-gdb.conf</font></font></pre></blockquote><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis: Das Skript </font></font><code>bs-u-boot-trace-gdb.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funktioniert h√∂chstwahrscheinlich nicht sofort nach dem Einschalten der Karte, da u-boot_mod zus√§tzlich die Anti-Mystery-Fehler AR9331 zur√ºcksetzt, wodurch das Skript nicht mehr ausgef√ºhrt wird. </font><font style="vertical-align: inherit;">Stoppen Sie in diesem Fall openocd und GDB und f√ºhren Sie openocd und GDB erneut aus.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt dreht sich alles um das Kleine - Sie m√ºssen </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alle Schreibanweisungen </font><font style="vertical-align: inherit;">aus der Datei ausw√§hlen </font></font><code>sw</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Wort speichern, dh einen 32-Bit-Wert schreiben). </font><font style="vertical-align: inherit;">Die Register des AR9331-Speichercontrollers sind 32-Bit-Register, sodass andere Anweisungen aus der Speicherfamilie sicher ignoriert werden k√∂nnen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da der Disassembler nur die Namen der Argumentregister der Anweisung erzeugt</font></font><code>sw</code><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =&gt; 0xbfc004ec: ad f9 00 00 sw t9,0 (t7)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es reicht jedoch nicht aus </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alle Zeilen mit der sw-Anweisung </font><font style="vertical-align: inherit;">aus der Datei </font><font style="vertical-align: inherit;">auszuw√§hlen. </font><font style="vertical-align: inherit;">Um festzustellen, welcher Wert mit sw an welche Adresse geschrieben wurde, muss die Datei einer </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zus√§tzlichen Verarbeitung </font><font style="vertical-align: inherit;">unterzogen </font><font style="vertical-align: inherit;">werden. </font><font style="vertical-align: inherit;">Die Verarbeitung kann mit dem Skript parse_gdb_output.pl erfolgen:</font></font><br>
<pre><code class="perl hljs"> <span class="hljs-comment">#!/usr/bin/perl -w</span><font></font>
 <font></font>
 <span class="hljs-keyword">my</span> %r;<font></font>
 <font></font>
 <span class="hljs-keyword">foreach</span> $i (<span class="hljs-string">qw(zero at v0 v1 a0 a1 a2 a3 t0 t1 t2 t3 t4 t5 t6 t7
        s0 s1 s2 s3 s4 s5 s6 s7 t8 t9 k0 k1 gp sp s8 ra)</span>) {<font></font>
    $r{$i} = <span class="hljs-string">"none"</span>;<font></font>
 }<font></font>
 <font></font>
 <span class="hljs-function"><span class="hljs-keyword">sub</span> <span class="hljs-title">parse_reg</span>($)
 </span>{<font></font>
    $_ = $_[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R/</span>) {
        <span class="hljs-keyword">my</span> @fields = <span class="hljs-keyword">split</span> <span class="hljs-keyword">m</span><span class="hljs-string">'\s+'</span>;
        <span class="hljs-keyword">my</span> $f = <span class="hljs-number">2</span>;
        <span class="hljs-keyword">my</span> @rgs;<font></font>
 <font></font>
        @rgs = <span class="hljs-string">qw(zero at v0 v1 a0 a1 a2 a3)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R0/</span>);<font></font>
        @rgs = <span class="hljs-string">qw(t0 t1 t2 t3 t4 t5 t6 t7)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R8/</span>);<font></font>
        @rgs = <span class="hljs-string">qw(s0 s1 s2 s3 s4 s5 s6 s7)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R1/</span>);<font></font>
        @rgs = <span class="hljs-string">qw(t8 t9 k0 k1 gp sp s8 ra)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R2/</span>);<font></font>
 <font></font>
        <span class="hljs-keyword">foreach</span> $i (@rgs) {<font></font>
            $r{$i} = $fields[$f];<font></font>
            $f = $f + <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    }<font></font>
 }<font></font>
 <font></font>
 <span class="hljs-keyword">while</span> (&lt;&gt;) {
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^=&gt;([^s]*)\tsw\t([^,]*),(\d+)\(([^)]*)\)/</span>) {
        <span class="hljs-keyword">my</span> $rs = $2;
        <span class="hljs-keyword">my</span> $offset = $3;
        <span class="hljs-keyword">my</span> $rd = $4;<font></font>
 <font></font>
        parse_reg(&lt;&gt;);<font></font>
        parse_reg(&lt;&gt;);<font></font>
        parse_reg(&lt;&gt;);<font></font>
        parse_reg(&lt;&gt;);<font></font>
 <font></font>
        <span class="hljs-keyword">print</span>(<span class="hljs-string">"$1    sw $rs={0x$r{$rs}}, $offset($rd={0x$r{$rd}})\n"</span>);<font></font>
    }<font></font>
 }</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Start </font></font><code>parse_gdb_output.pl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist wie folgt:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ grep "^ = \ | ^ R" bs_gdb.log | </font><font style="vertical-align: inherit;">./parse_gdb_output.pl</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein Ausschnitt der Ausgabe </font></font><code>parse_gdb_output.pl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(die Markierungen ' </font></font><code>&lt;&lt;&lt; PLL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' und ' </font></font><code>&lt;&lt;&lt; DDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' wurden sp√§ter manuell eingegeben):</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f002700: ad cf 00 00 sw t7 = {0x00dbd860}, 0 (t6 = {0xb8116248})</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f00271c: ad f9 00 00 sw t9 = {0x000fffff}, 0 (t7 = {0xb800009c})</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f0027a0: ad f9 00 00 sw t9 = {0x00018004}, 0 (t7 = {0xb8050008}) &lt;&lt;&lt; PLL</font></font><font></font>
  0x9f0027dc:   ad f9 00 00    sw t9={0x00000352}, 0(t7={0xb8050004}) &lt;&lt;&lt;<font></font>
  0x9f002840:   ad f9 00 00    sw t9={0x40818000}, 0(t7={0xb8050000}) &lt;&lt;&lt;<font></font>
  0x9f002898:   ad f9 00 00    sw t9={0x001003e8}, 0(t7={0xb8050010}) &lt;&lt;&lt;<font></font>
  0x9f0028f4:   ad f9 00 00    sw t9={0x00818000}, 0(t7={0xb8050000}) &lt;&lt;&lt;<font></font>
  0x9f002970:   ad cf 00 00    sw t7={0x00800000}, 0(t6={0xb8116248})<font></font>
 ...<font></font>
  0x9f002994:   ad cf 00 00    sw t7={0x40800700}, 0(t6={0xb8116248})<font></font>
  0x9f002a54:   ad f9 00 00    sw t9={0x00008000}, 0(t7={0xb8050008})<font></font>
  0x9f00309c:   af 38 00 00    sw t8={0x7fbc8cd0}, 0(t9={0xb8000000}) &lt;&lt;&lt; DDR<font></font>
  0x9f0030b0:   af 38 00 00    sw t8={0x9dd0e6a8}, 0(t9={0xb8000004}) &lt;&lt;&lt;<font></font>
  0x9f0030dc:   af 38 00 00    sw t8={0x00000a59}, 0(t9={0xb800008c}) &lt;&lt;&lt;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f0030ec: af 38 00 00 sw t8 = {0x00000008}, 0 (t9 = {0xb8000010}) &lt;&lt;&lt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ...</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da die Adressen der Register des Taktsignalgenerators (PLL) und die Adressen der Register des Speichercontrollers vom DDR-Typ bekannt sind, ist es leicht herauszufinden, welche Nummern an welche Adressen geschrieben werden sollten, um den RAM-Controller korrekt zu initialisieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen, ist das Debuggen √ºber JTAG mit openocd und GDB √ºberhaupt nicht schwierig, und die beschriebenen Arbeitsmethoden eignen sich nicht nur f√ºr AR9331, sondern nach einiger Anpassung auch f√ºr Prozessoren mit einer anderen Architektur, f√ºr die openocd und GDB unterst√ºtzt werden.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de383505/">https://habr.com/ru/post/de383505/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de383495/index.html">√úberleben in Russland. "Huskies, Reposts, Tweets: Wie man nicht gegen anti-extremistische Gesetze verst√∂√üt"</a></li>
<li><a href="../de383497/index.html">–ü–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Lode Runner —Å –ë–ö –Ω–∞ –£–ö–ù–¶</a></li>
<li><a href="../de383499/index.html">Notch macht schwere Zeiten durch</a></li>
<li><a href="../de383501/index.html">–í –°–®–ê —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø–æ –∏–º–∏—Ç–∞—Ü–∏–∏ –ø–æ–ª–µ—Ç–∞ –Ω–∞ –ú–∞—Ä—Å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –≤ 365 –¥–Ω–µ–π</a></li>
<li><a href="../de383503/index.html">–§–æ—Ç–æ—ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –ø–µ—Ä–æ–≤—Å–∫–∏—Ç–∞: –ø—è—Ç—å –≥—Ä–∞–º–º–æ–≤ –Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –º–µ—Ç—Ä</a></li>
<li><a href="../de383507/index.html">Mondbasisprojekte: Geschichte</a></li>
<li><a href="../de383509/index.html">Der Gr√ºnder von Pirate Bay wurde sofort nach dem Verlassen verhaftet</a></li>
<li><a href="../de383511/index.html">Die ersten Momente der Photosynthese wurden auf einem Supercomputer berechnet</a></li>
<li><a href="../de383513/index.html">Das Online-Arzneimittelangebot steigt auch nach Schlie√üung der Seidenstra√üe</a></li>
<li><a href="../de383517/index.html">RAICamp 2015 - Erster Tag</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>