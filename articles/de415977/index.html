<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👩🏼 🤽🏾 👩🏿‍🤝‍👨🏽 DPI-resistente Tunnel und VPNs 👨🏿‍✈️ 🧑🏾‍🤝‍🧑🏾 🧝🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir leben in einer interessanten Zeit. Ich würde es sogar auf erstaunliche Weise sagen. Auf der einen Seite sehen wir einige Leute, die wirklich wisse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DPI-resistente Tunnel und VPNs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415977/"> Wir leben in einer interessanten Zeit.  Ich würde es sogar auf erstaunliche Weise sagen.  Auf der einen Seite sehen wir einige Leute, die wirklich wissen wollen, was andere Leute miteinander reden, und ihnen wirklich sagen wollen, was gelesen werden kann und was nicht.  Auf der anderen Seite Bürger, die ihre Rechte auf Geheimnisse persönlicher Korrespondenz und kostenloser Informationen geltend machen möchten und nicht möchten, dass die Fakten dieser Korrespondenz und der Empfang dieser Informationen gegen sie verwendet werden.  Eine große Anzahl von Websites, Diensten und Unternehmen von Drittanbietern, die von „Teppichschlössern“ betroffen sind, leiden als Bonus. <br><br>  Aber nein, in diesem Artikel geht es nicht um die Gesellschaft, sondern um Technologie. <br><br><img src="https://habrastorage.org/webt/ai/x5/4v/aix54v5uoghgxq1dmmisvj-brke.jpeg" alt="Bild"><br><a name="habracut"></a><br>  Die technische Kompetenz der Menschen wächst dank allem, was geschieht, ebenfalls.  Waren früher die Wörter „VPN“ und „Proxies“ nur IT-Spezialisten bekannt, kennen sie jetzt sogar Hausfrauen und verwenden darüber hinaus die Bedeutung dieser Wörter. <br><br>  Im Allgemeinen sind die Nachrichten in letzter Zeit ziemlich unterhaltsam geworden.  Beispielsweise ist die Bereitstellung von VPN-Diensten und dergleichen zum Verschlüsseln des Datenverkehrs und zum Umgehen von Sperren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">jetzt strafbar</a> , und in China werden sie im Allgemeinen dafür <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">inhaftiert</a> .  Und vor nicht allzu langer Zeit begann ILV <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">,</a> die Paketanalyse zu verwenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, um</a> das MTProxy-Protokoll <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu blockieren</a> .  Sie können sich auch auf die Erfahrungen der anderen Länder beziehen, die in solchen Angelegenheiten am erfolgreichsten sind: China, Iran, Kasachstan, Venezuela.  In Venezuela beispielsweise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">blockieren</a> sie direkt direkte Verbindungen nach Tor und verschleierten den Verkehr zu Brücken.  Aufgrund all dessen können wir davon ausgehen, dass die Zukunft, die uns erwartet, auch sehr interessant ist, insbesondere wenn die "Verantwortlichen" immer wieder aufhören, dumme Fälschungen zu machen, und klüger und raffinierter handeln. <br><br>  Zu Habré äußerten sich in den Kommentaren wiederholt Prognosen darüber, wie der Kampf mit Verschlüsselungstechnologien für normale Bürger fortgesetzt werden kann.  Ich analysierte die geäußerten Gedanken und betrachtete Zeugnisse aus anderen Ländern. Ich versuchte vorzuschlagen, in welche Richtung sich die Maßnahmen zur Einschränkung der Kommunikation weiter bewegen könnten.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">DistortNeo</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">shifttstas</a> haben einige weitere interessante Ideen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">eingebracht</a> , und am Ende habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">el777</a> versprochen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">,</a> diesen Artikel hinzuzufügen. <br><br>  Mit ACL-Filtern ist alles klar.  Sie handeln jetzt und mit unterschiedlichem Erfolg sind sie erfolgreich und kämpfen nicht (obwohl es ziemlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pessimistische Prognosen gibt</a> ).  DPI ist interessanter. <br><br>  Die Methoden zum "Bestimmen" des Verkehrstyps für DPI können in zwei Gruppen unterteilt werden: <br><br><ul><li>  Signaturanalyse.  Zerlegen des Pakets "durch die Knochen", Vergleichen der Überschriften und der Struktur mit den Proben und somit Bestimmen seines Zwecks.  So werden viele Tunnel erkannt, beispielsweise OpenVPN, L2TP / IPSec, SOCKS usw. </li><li>  Eine vorläufige Analyse der Verkehrsaustauschmuster, beispielsweise das Verhältnis des eingehenden / ausgehenden Flusses, die Häufigkeit der Anforderung-Antwort und andere Kriterien, ermöglicht es uns, den „realen Verkehr“ eines Protokolls und den Tunnel, der sich nur als Protokoll tarnt, zu trennen. </li></ul><br><img src="https://habrastorage.org/webt/xj/a3/ny/xja3nye4iqnsser5zm2gxgbcjbq.jpeg" alt="Bild"><br><br>  Sie können den Datenverkehr in mehrere Gruppen aufteilen und davon ausgehen, was diese mit jeder Gruppe tun. <br><br><ol><li>  <b>"Explizite" VPNs, Tunnel und Proxys (OpenVPN, L2TP / IPSec, SOCKS usw.)</b> Gewöhnliche VPNs und Tunnel können durchaus automatisch blockiert werden, wie dies beispielsweise in China und Venezuela der Fall ist.  Wenn einige Organisationen oder Unternehmen es für die Arbeit benötigen, lassen Sie sie sich registrieren und zertifizieren, wie das oben erwähnte russische Gesetz ganz konkret vorsieht.  Mit einem Proxy ist es noch einfacher - dass HTTP, dass SOCKS Adressen und Inhalte im Klartext übertragen, was im Allgemeinen keine Probleme für das selektive „Schneiden“ von Anforderungen und das Abhören übertragener Informationen verursacht. </li><li>  <b>Dual-Use-Technologien wie SSH</b> .  Kurz nachdem die Sitzung eingerichtet wurde, wird die Geschwindigkeit auf eine Schildkröte reduziert, sodass Sie immer noch zumindest irgendwie in der Konsole arbeiten können, aber nicht mehr surfen und herunterladen müssen.  Die Tatsache, dass dies während der normalen Arbeit zu Problemen führt, stört niemanden (was uns ILV in letzter Zeit mehr als einmal gezeigt hat). </li><li>  <b>Hochspezifische Protokolle wie Messenger, Spieleclients usw.</b> </li><li>  <b>Verbindungen, deren Typ nicht bestimmt werden kann</b> . </li></ol><br>  Für die Punkte 3 und 4 sind durchaus "weiße Listen" möglich (in denen beispielsweise Subnetze von offiziellen Spielservern oder "korrekten" Messenger eingegeben werden und alles, was die Serverbesitzer deklarieren und nach Bedarf anordnen möchten, damit sie nicht berührt werden, analog dazu diejenigen, die ILV bereits für Domänen und IP-Adressen hat).  Und diejenigen, die nicht in diesen Listen aufgeführt sind, werden das gleiche Schicksal wie Absatz 1 oder Absatz 2 haben, obwohl es durchaus möglich ist, die Geschwindigkeit nicht unverblümt zu blockieren oder zu verringern, sondern die zuvor erwähnten Austauschmuster zu analysieren, um festzustellen, ob der Verkehr „rein“ ist. "Oder" verdächtig ". <br><br>  Das heißt, wenn Sie sich als spezielle Protokolle tarnen oder die Verbindungen verschleiern möchten, so dass es unmöglich ist, ihren Typ zu bestimmen, müssen Sie auch darauf achten, "Rauschen" zu erzeugen, das die Erkennung realer Austauschmuster verhindert.  Bisher sind mir solche Entwicklungen nicht aufgefallen. <br><br>  Sie können sich nicht einmal an verschiedene ICMP- und DNS-Tunnel erinnern - eine große Menge an Datenverkehr, der nicht benötigt wird, lässt automatisch auch Verdacht aufkommen. <br><br>  5. <b>TLS und SSL, HTTPS</b> .  Es ist unmöglich, sauber zu schneiden, da dies automatisch bedeutet, das gesamte Internet zu blockieren.  Die Musteranalyse ist nicht sinnvoll, da das Surfen im Internet nur der Hauptzweck der Verwendung von HTTPS ist.  Aus all diesen Gründen scheint SSL / TLS an Port 443 die „ahnungsloseste“ und zuverlässigste Option zu sein.  Versuchen wir deshalb, uns als ihn zu verkleiden. <br><br><img src="https://habrastorage.org/webt/sj/3u/2z/sj3u2zoggi2ofngemk1maytasyw.jpeg" alt="Bild"><br><br><h3>  Verkleide uns </h3><br>  Zur Prüfung wurde entschieden, Streisand- und SoftEther-Lösungen zu wählen. <br><br>  <a href="" rel="nofollow">Streisand</a> - eine ganze Reihe verschiedener Dienste: OpenConnect / AnyConnect, OpenVPN, Stunnel, Shadowsocks, WireGuard.  All dies wird im automatischen oder halbautomatischen „schlüsselfertigen“ Modus eingestellt, und am Ausgang erhält der Benutzer einen konfigurierten Server sowie Dateien und detaillierte Dokumentationen zum Einrichten von Clients. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">SoftEther</a> ist ein VPN-Server, der L2TP / IPsec-, OpenVPN-, SSTP- und andere Protokolle aufheben kann und über ein eigenes SSL-VPN-Protokoll verfügt, das laut den Autoren nicht vom normalen HTTPS-Verkehr zu unterscheiden ist. <br><br>  Also ... <br><br>  <b>OpenConnect / AnyConnect.</b>  Open Source-Implementierung des Cisco AnyConnect SSL-Protokolls.  Wenn eine Verbindung hergestellt wird, sind nicht nur TLS (TCP) -Pakete, sondern auch DTLS (UDP) -Pakete sichtbar.  DTLS wird im Prinzip auch häufig verwendet, wenn "für friedliche Zwecke", aber dies ist überhaupt nicht wie "normales HTTPS".  Wenn Sie jedoch den UDP-Verkehr in der Firewall reduzieren, wechselt AnyConnect sofort wieder zu TCP und sieht von außen wieder vollständig und vollständig wie normales TLS aus, und selbst die Authentifizierung innerhalb des verschlüsselten Tunnels ist fast wie bei HTTP. <br><br>  <b>Schattenstrümpfe</b> .  Verschlüsselter SOCKS-Proxy.  Anscheinend <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">kann es auf Wunsch erkannt werden</a> , es gibt jedoch Plugins, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">die es als "reines HTTPS" tarnen</a> .  Es gibt auch ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Plugin</a> zum Durcharbeiten von Websockets, aber dazu später mehr. <br><br>  <b>Wireguard</b>  Der Beschreibung nach zu urteilen, verfügt es über eine gut verdrillte Verschlüsselung und einen Sitzungsaufbau-Mechanismus, aber die gesamte Kommunikation erfolgt über UDP.  Wireshark definiert die Art der Pakete als etwas völlig Unhörbares, und was eine Meinung darüber ist, was mit einem DPI eines Drittanbieters passiert, ist eine sehr, sehr große Frage.  <b>Update:</b> Neuere Versionen definieren Wireguard eindeutig als Wireguard, sodass die Antwort auf die Frage offensichtlich ist. <br><br>  <b>obfs3, obfs4</b> .  Pakete werden so verschleiert, dass sie von außen wie ein völlig zufälliger Satz von Werten aussehen.  Das heißt, sie fallen unter Punkt 4 aus der obigen Liste. <br><br>  <b>SoftEther</b>  Es sieht aus wie HTTPS, aber mit einem Haken.  Zusätzlich zu TLS direkt über TCP sendet es aktiv Pakete von UDP-Paketen.  Wie in der Dokumentation festgestellt wurde, kann UDP verwendet werden, um die Datenübertragung zu beschleunigen, wenn sie nicht in der Firewall beendet wird.  Diese Funktionalität ist in der Konfiguration deaktiviert, und nachdem sie deaktiviert wurde, wird alles so, wie es sollte. <br><br>  <b>SSTP</b> .  VPN-Prokotol von Microsoft.  Wird von Windows nativ unterstützt und unterstützt Software unter GNU / Linux.  Von außen sieht es aus wie HTTPS, und Wireshark bestätigt dies voll und ganz. <br><br><h3>  Aber das ist noch nicht alles </h3><br>  Angenommen, Sie haben einen VPN-Server oder das Ende eines Tunnels auf einem Host installiert und so konfiguriert, dass er Port 443 überwacht.  Es scheint, dass alles in Ordnung ist, aber es gibt einen ABER: Wenn wir uns als HTTPS verkleiden, können Sie überprüfen, ob es tatsächlich an Port 443 hängt, indem Sie einfach versuchen, sich in diesem Port mit einem einfachen Browser oder CURL oder auf andere Weise zu begraben.  In einigen Artikeln wird eine solche Methode als "Leitungsverbindung" bezeichnet und wird, wie erwähnt, in China bereits häufig verwendet. <br><br>  Daher brauchen wir am 443. Port den gewöhnlichsten und anständigsten Webserver.  Und hier entsteht ein interessantes Problem. <br><br>  Keiner der oben genannten Dienste in der Hauptdokumentation fand eine Beschreibung des Arbeitsmechanismus der Portfreigabe.  Die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SSLH-Option ist</a> nicht geeignet, schon allein deshalb, weil sslh den Datenverkehr zwischen HTTPS und den oben genannten Diensten nicht gemeinsam nutzen kann.  Zumindest, weil DPI in der Lage sein wird, wenn die Art des Verkehrs ohne vollständige Entschlüsselung sslh unterscheiden könnte. <br><br>  In den meisten Fällen wird die Verwendung von SNI (Server Name Indication) empfohlen - einer TLS-Erweiterung, mit der Sie einen Hostnamen angeben und anschließend HAProxy, Sniproxy und andere Tools verwenden können, um Verbindungen für Dienste zu verteilen.  Das Problem ist, dass in modernen TLS-Implementierungen der bei der Verwendung von SNI angegebene Hostname im Klartext übertragen wird, dh in unverschlüsselter Form, und daher auch in Zukunft ausspioniert und verwendet werden kann. <br><br>  Deshalb werden wir improvisieren, und dann kamen mir zwei Optionen in den Sinn. <br><br><h4>  Port klopfen </h4><br><img src="https://habrastorage.org/webt/54/_n/v7/54_nv7qxgj4idvoek-ooxn6r6ju.jpeg" alt="Bild"><br><br>  Port Knocking dient nur dazu, "versteckte Dienste" auf dem Server zu aktivieren.  In ähnlicher Weise wird beispielsweise der Port, an dem der SSH-Dämon hängt, häufig "geschlossen", um Brute Force und die Verwendung von 0-Tage-Sicherheitslücken zu vermeiden.  In der klassischen Version (siehe z. B. die Implementierung des knockd-Daemons) wird unter Klopfen normalerweise der Versuch verstanden, eine Verbindung herzustellen oder Pakete an bestimmte Host-Ports in einer bestimmten Reihenfolge zu senden, wodurch der Daemon Sie als seinen eigenen "erkennt" und eine Firewall-Regel aktiviert, die den Zugriff auf einen bestimmten Port ermöglicht nur von Ihrer IP. <br><br>  In unserem Fall ist diese Option nicht ganz akzeptabel.  Erstens können die „nicht standardmäßigen“ Ports selbst irgendwo auf dem Weg blockiert sein, und zweitens kann das Verfahren selbst, wenn es von außen analysiert wird, verdächtig aussehen.  Da wir uns als HTTPS tarnen, müssen wir auf HTTPS „klopfen“. <br><br>  Überraschenderweise gab es keine HTTP / HTTPS-Klopfer mit der erforderlichen Funktionalität, und daher wurde ein Nocker mit dem romantischen Namen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Labean geboren</a> (Husaren, schweigen Sie!). <br><br>  Gegeben: unser Server, auf dem Nginx auf Port 443 mit korrekt konfigurierten Zertifikaten ausgeführt wird und einige völlig harmlose Inhalte anzeigt, z. B. GIFs mit Katzen, ISO-Images von GNU / Linux-Distributionen oder ein Wikipedia-Spiegel und Moshkovs Bibliothek. <br><br>  Gleichzeitig versteckten sich Zeilen des Formulars in der Nginx-Konfiguration <br><br><pre><code class="nginx hljs"> <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~ ^/somesecret/(.*)</span></span> {
    <span class="hljs-attribute"><span class="hljs-attribute">auth_basic</span></span>      <span class="hljs-string"><span class="hljs-string">"Administrator Login"</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">auth_basic_user_file</span></span>  /var/www/.htpasswd;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span>  X-Real-IP  <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://127.0.0.1:8080/<span class="hljs-variable"><span class="hljs-variable">$1</span></span>;
  }
</code></pre><br>
      ,       CURL'   <br>
<code>https://ourserver.org/somesecret/vpn/on</code><br>
  ,   ,     ,           IP-,  - <br>
<code>iptables -t nat -A PREROUTING -p tcp -s {clientIP} --dport 443 -j REDIRECT --to-port 4443</code><br>
    .<br>
<br>
  N  (,   )  ,    ,        ,         IP       .<br>
<br>
     ,    ,  URL   ,   /off  .<br>
<br>
       ,     IPv6 (v6-    X-Real-IP  ).<br>
<br>
   Go,    ,   ,    . ,      nginx  init-    Gihub:<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://github.com/uprt/labean</a><br>
<br>
<h4>Websockets</h4><br>
<img src="https://habrastorage.org/webt/as/nw/yn/asnwynceu_p8gghmcgf13e3ryiq.jpeg" alt="image"><br>
<br>
     :      HTTPS —    .  Web-         TCP    ,    Websocket (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">RFC 6455</a>).    HTTP-,      ,             TCP-.  , ,       HTTPS       .<br>
<br>
      WS  ,  - —    ,     CDN, , Cloudflare    .  ,        :    IP  CDN/proxy          CDN,          VPN/proxy   CDN,       .<br>
<br>
 WS-   (    Haskell),     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">wstunnel</a>,   nodejs   ,       .<br>
<br>
       .       wss://-, <br>
<br>
<pre><code class="bash hljs">wstunnel -t 33 wss://server:443</code></pre><br>
   ,  «» ws-      «» .   wstunnel,    ,      URI    -  :<br>
<br>
<pre><code class="bash hljs">wstunnel -t 33 wss://ourserver.org:443/hiddenws/</code></pre><br>
  :     <br>
<br>
   ,    443   Nginx c -  . <br>
<br>
    proxy-   Websockets-:<br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /hiddenws {
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://127.0.0.1:8081;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_http_version</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Upgrade <span class="hljs-variable"><span class="hljs-variable">$http_upgrade</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Connection <span class="hljs-string"><span class="hljs-string">"Upgrade"</span></span>;
  }</code></pre><br>
        websockets-.        SOCKS- (, Dante),  OpenVPN, ,   ,    .<br>
<br>
<div class="spoiler"><b class="spoiler_title"> selinux</b><div class="spoiler_text">   RHEL  ,   SELinux,    nginx   <br>
<code>2018/07/05 13:28:03 [crit] 7724#0: *11 connect() to 127.0.0.1:8081 failed (13: Permission denied) while connecting to upstream, client: IP_ADDRES, server: _, request: «GET /hiddenws/?dst=localhost:22 HTTP/1.1», upstream: «127.0.0.1:8081/hiddenws/?dst=localhost:22»,</code><br>
<br>
        :<br>
<br>
<pre><code class="bash hljs">semanage port -a -t http_port_t -p tcp 22
semanage port -m -t http_port_t -p tcp 22
semanage port -a -t http_port_t -p tcp 8081</code></pre><br>
<br>
 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Renatk</a>        .<br>
</div></div><br>
<br>
    —   SOCKS-  VPN-       wstunnel,           «» .<br>
<br>
 ,   v2ray  shadowcocks,   websockets    shadowsocks.    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://github.com/shadowsocks/v2ray-plugin</a><br>
<br>
<h3> </h3><br>
 —   VPN- -   MTU,  1400;<br>
 —   VPN- 2 IP-.        VPN/,       ;<br>
 —  «» IP-   ,    ICMP ping;<br>
 —     -  reverse DNS ,     -, , gateway-001.somehomeisp.net;<br>
 —      VPN/  DNS- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> OpenNIC</a>;<br>
         (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> </a>).<br>
<br>
<h3> </h3><br>
<img src="https://habrastorage.org/webt/dz/mp/tf/dzmptf35twb-e_wzib77grk3ksq.jpeg" alt="image"><br>
<br>
      - ,     —  .     ,   ,   —   ,    ,   . ,   HTTPS      — ,     ,    -    «   »/   /etc.,  ,      « »,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   </a>. <br>
<br>
 ,  ,   ,            ,     —  ,   ,    ,   . <br>
 .</div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415977/">https://habr.com/ru/post/de415977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415965/index.html">Was im Juli zu lesen ist: 19 neue Bücher für Digitalprofis</a></li>
<li><a href="../de415967/index.html">SolidFire - Speicher für diejenigen, die Hassspeicher haben</a></li>
<li><a href="../de415969/index.html">HyperX Pulsefire Surge RGB - ein natürlich geborener Killer</a></li>
<li><a href="../de415973/index.html">So brechen Sie den Apache Ignite-Cluster nicht von Anfang an</a></li>
<li><a href="../de415975/index.html">Die Chinesen führten eine Laserpistole mit einer Reichweite von fast einem Kilometer ein</a></li>
<li><a href="../de415979/index.html">Sicherheitswoche 24: Rowhammer unter Android und die Komplexität von Hardware-Schwachstellen</a></li>
<li><a href="../de415981/index.html">Google und HTTP</a></li>
<li><a href="../de415983/index.html">Frühes Universum 5. Kosmologische Rotverschiebung und Dynamik eines einheitlich expandierenden Universums, Teil 1</a></li>
<li><a href="../de415987/index.html">QA-Meetup SuperJob</a></li>
<li><a href="../de415989/index.html">Analyse der Verwendung digitaler Signaturen: 10 der 15 wichtigsten Kryptowährungen signieren keine Software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>