<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘©ğŸ¼ ğŸ¤½ğŸ¾ ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ½ DPI-resistente Tunnel und VPNs ğŸ‘¨ğŸ¿â€âœˆï¸ ğŸ§‘ğŸ¾â€ğŸ¤â€ğŸ§‘ğŸ¾ ğŸ§ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir leben in einer interessanten Zeit. Ich wÃ¼rde es sogar auf erstaunliche Weise sagen. Auf der einen Seite sehen wir einige Leute, die wirklich wisse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DPI-resistente Tunnel und VPNs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415977/"> Wir leben in einer interessanten Zeit.  Ich wÃ¼rde es sogar auf erstaunliche Weise sagen.  Auf der einen Seite sehen wir einige Leute, die wirklich wissen wollen, was andere Leute miteinander reden, und ihnen wirklich sagen wollen, was gelesen werden kann und was nicht.  Auf der anderen Seite BÃ¼rger, die ihre Rechte auf Geheimnisse persÃ¶nlicher Korrespondenz und kostenloser Informationen geltend machen mÃ¶chten und nicht mÃ¶chten, dass die Fakten dieser Korrespondenz und der Empfang dieser Informationen gegen sie verwendet werden.  Eine groÃŸe Anzahl von Websites, Diensten und Unternehmen von Drittanbietern, die von â€TeppichschlÃ¶ssernâ€œ betroffen sind, leiden als Bonus. <br><br>  Aber nein, in diesem Artikel geht es nicht um die Gesellschaft, sondern um Technologie. <br><br><img src="https://habrastorage.org/webt/ai/x5/4v/aix54v5uoghgxq1dmmisvj-brke.jpeg" alt="Bild"><br><a name="habracut"></a><br>  Die technische Kompetenz der Menschen wÃ¤chst dank allem, was geschieht, ebenfalls.  Waren frÃ¼her die WÃ¶rter â€VPNâ€œ und â€Proxiesâ€œ nur IT-Spezialisten bekannt, kennen sie jetzt sogar Hausfrauen und verwenden darÃ¼ber hinaus die Bedeutung dieser WÃ¶rter. <br><br>  Im Allgemeinen sind die Nachrichten in letzter Zeit ziemlich unterhaltsam geworden.  Beispielsweise ist die Bereitstellung von VPN-Diensten und dergleichen zum VerschlÃ¼sseln des Datenverkehrs und zum Umgehen von Sperren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">jetzt strafbar</a> , und in China werden sie im Allgemeinen dafÃ¼r <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">inhaftiert</a> .  Und vor nicht allzu langer Zeit begann ILV <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">,</a> die Paketanalyse zu verwenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, um</a> das MTProxy-Protokoll <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu blockieren</a> .  Sie kÃ¶nnen sich auch auf die Erfahrungen der anderen LÃ¤nder beziehen, die in solchen Angelegenheiten am erfolgreichsten sind: China, Iran, Kasachstan, Venezuela.  In Venezuela beispielsweise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">blockieren</a> sie direkt direkte Verbindungen nach Tor und verschleierten den Verkehr zu BrÃ¼cken.  Aufgrund all dessen kÃ¶nnen wir davon ausgehen, dass die Zukunft, die uns erwartet, auch sehr interessant ist, insbesondere wenn die "Verantwortlichen" immer wieder aufhÃ¶ren, dumme FÃ¤lschungen zu machen, und klÃ¼ger und raffinierter handeln. <br><br>  Zu HabrÃ© Ã¤uÃŸerten sich in den Kommentaren wiederholt Prognosen darÃ¼ber, wie der Kampf mit VerschlÃ¼sselungstechnologien fÃ¼r normale BÃ¼rger fortgesetzt werden kann.  Ich analysierte die geÃ¤uÃŸerten Gedanken und betrachtete Zeugnisse aus anderen LÃ¤ndern. Ich versuchte vorzuschlagen, in welche Richtung sich die MaÃŸnahmen zur EinschrÃ¤nkung der Kommunikation weiter bewegen kÃ¶nnten.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">DistortNeo</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">shifttstas</a> haben einige weitere interessante Ideen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">eingebracht</a> , und am Ende habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">el777</a> versprochen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">,</a> diesen Artikel hinzuzufÃ¼gen. <br><br>  Mit ACL-Filtern ist alles klar.  Sie handeln jetzt und mit unterschiedlichem Erfolg sind sie erfolgreich und kÃ¤mpfen nicht (obwohl es ziemlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pessimistische Prognosen gibt</a> ).  DPI ist interessanter. <br><br>  Die Methoden zum "Bestimmen" des Verkehrstyps fÃ¼r DPI kÃ¶nnen in zwei Gruppen unterteilt werden: <br><br><ul><li>  Signaturanalyse.  Zerlegen des Pakets "durch die Knochen", Vergleichen der Ãœberschriften und der Struktur mit den Proben und somit Bestimmen seines Zwecks.  So werden viele Tunnel erkannt, beispielsweise OpenVPN, L2TP / IPSec, SOCKS usw. </li><li>  Eine vorlÃ¤ufige Analyse der Verkehrsaustauschmuster, beispielsweise das VerhÃ¤ltnis des eingehenden / ausgehenden Flusses, die HÃ¤ufigkeit der Anforderung-Antwort und andere Kriterien, ermÃ¶glicht es uns, den â€realen Verkehrâ€œ eines Protokolls und den Tunnel, der sich nur als Protokoll tarnt, zu trennen. </li></ul><br><img src="https://habrastorage.org/webt/xj/a3/ny/xja3nye4iqnsser5zm2gxgbcjbq.jpeg" alt="Bild"><br><br>  Sie kÃ¶nnen den Datenverkehr in mehrere Gruppen aufteilen und davon ausgehen, was diese mit jeder Gruppe tun. <br><br><ol><li>  <b>"Explizite" VPNs, Tunnel und Proxys (OpenVPN, L2TP / IPSec, SOCKS usw.)</b> GewÃ¶hnliche VPNs und Tunnel kÃ¶nnen durchaus automatisch blockiert werden, wie dies beispielsweise in China und Venezuela der Fall ist.  Wenn einige Organisationen oder Unternehmen es fÃ¼r die Arbeit benÃ¶tigen, lassen Sie sie sich registrieren und zertifizieren, wie das oben erwÃ¤hnte russische Gesetz ganz konkret vorsieht.  Mit einem Proxy ist es noch einfacher - dass HTTP, dass SOCKS Adressen und Inhalte im Klartext Ã¼bertragen, was im Allgemeinen keine Probleme fÃ¼r das selektive â€Schneidenâ€œ von Anforderungen und das AbhÃ¶ren Ã¼bertragener Informationen verursacht. </li><li>  <b>Dual-Use-Technologien wie SSH</b> .  Kurz nachdem die Sitzung eingerichtet wurde, wird die Geschwindigkeit auf eine SchildkrÃ¶te reduziert, sodass Sie immer noch zumindest irgendwie in der Konsole arbeiten kÃ¶nnen, aber nicht mehr surfen und herunterladen mÃ¼ssen.  Die Tatsache, dass dies wÃ¤hrend der normalen Arbeit zu Problemen fÃ¼hrt, stÃ¶rt niemanden (was uns ILV in letzter Zeit mehr als einmal gezeigt hat). </li><li>  <b>Hochspezifische Protokolle wie Messenger, Spieleclients usw.</b> </li><li>  <b>Verbindungen, deren Typ nicht bestimmt werden kann</b> . </li></ol><br>  FÃ¼r die Punkte 3 und 4 sind durchaus "weiÃŸe Listen" mÃ¶glich (in denen beispielsweise Subnetze von offiziellen Spielservern oder "korrekten" Messenger eingegeben werden und alles, was die Serverbesitzer deklarieren und nach Bedarf anordnen mÃ¶chten, damit sie nicht berÃ¼hrt werden, analog dazu diejenigen, die ILV bereits fÃ¼r DomÃ¤nen und IP-Adressen hat).  Und diejenigen, die nicht in diesen Listen aufgefÃ¼hrt sind, werden das gleiche Schicksal wie Absatz 1 oder Absatz 2 haben, obwohl es durchaus mÃ¶glich ist, die Geschwindigkeit nicht unverblÃ¼mt zu blockieren oder zu verringern, sondern die zuvor erwÃ¤hnten Austauschmuster zu analysieren, um festzustellen, ob der Verkehr â€reinâ€œ ist. "Oder" verdÃ¤chtig ". <br><br>  Das heiÃŸt, wenn Sie sich als spezielle Protokolle tarnen oder die Verbindungen verschleiern mÃ¶chten, so dass es unmÃ¶glich ist, ihren Typ zu bestimmen, mÃ¼ssen Sie auch darauf achten, "Rauschen" zu erzeugen, das die Erkennung realer Austauschmuster verhindert.  Bisher sind mir solche Entwicklungen nicht aufgefallen. <br><br>  Sie kÃ¶nnen sich nicht einmal an verschiedene ICMP- und DNS-Tunnel erinnern - eine groÃŸe Menge an Datenverkehr, der nicht benÃ¶tigt wird, lÃ¤sst automatisch auch Verdacht aufkommen. <br><br>  5. <b>TLS und SSL, HTTPS</b> .  Es ist unmÃ¶glich, sauber zu schneiden, da dies automatisch bedeutet, das gesamte Internet zu blockieren.  Die Musteranalyse ist nicht sinnvoll, da das Surfen im Internet nur der Hauptzweck der Verwendung von HTTPS ist.  Aus all diesen GrÃ¼nden scheint SSL / TLS an Port 443 die â€ahnungslosesteâ€œ und zuverlÃ¤ssigste Option zu sein.  Versuchen wir deshalb, uns als ihn zu verkleiden. <br><br><img src="https://habrastorage.org/webt/sj/3u/2z/sj3u2zoggi2ofngemk1maytasyw.jpeg" alt="Bild"><br><br><h3>  Verkleide uns </h3><br>  Zur PrÃ¼fung wurde entschieden, Streisand- und SoftEther-LÃ¶sungen zu wÃ¤hlen. <br><br>  <a href="" rel="nofollow">Streisand</a> - eine ganze Reihe verschiedener Dienste: OpenConnect / AnyConnect, OpenVPN, Stunnel, Shadowsocks, WireGuard.  All dies wird im automatischen oder halbautomatischen â€schlÃ¼sselfertigenâ€œ Modus eingestellt, und am Ausgang erhÃ¤lt der Benutzer einen konfigurierten Server sowie Dateien und detaillierte Dokumentationen zum Einrichten von Clients. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">SoftEther</a> ist ein VPN-Server, der L2TP / IPsec-, OpenVPN-, SSTP- und andere Protokolle aufheben kann und Ã¼ber ein eigenes SSL-VPN-Protokoll verfÃ¼gt, das laut den Autoren nicht vom normalen HTTPS-Verkehr zu unterscheiden ist. <br><br>  Also ... <br><br>  <b>OpenConnect / AnyConnect.</b>  Open Source-Implementierung des Cisco AnyConnect SSL-Protokolls.  Wenn eine Verbindung hergestellt wird, sind nicht nur TLS (TCP) -Pakete, sondern auch DTLS (UDP) -Pakete sichtbar.  DTLS wird im Prinzip auch hÃ¤ufig verwendet, wenn "fÃ¼r friedliche Zwecke", aber dies ist Ã¼berhaupt nicht wie "normales HTTPS".  Wenn Sie jedoch den UDP-Verkehr in der Firewall reduzieren, wechselt AnyConnect sofort wieder zu TCP und sieht von auÃŸen wieder vollstÃ¤ndig und vollstÃ¤ndig wie normales TLS aus, und selbst die Authentifizierung innerhalb des verschlÃ¼sselten Tunnels ist fast wie bei HTTP. <br><br>  <b>SchattenstrÃ¼mpfe</b> .  VerschlÃ¼sselter SOCKS-Proxy.  Anscheinend <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">kann es auf Wunsch erkannt werden</a> , es gibt jedoch Plugins, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">die es als "reines HTTPS" tarnen</a> .  Es gibt auch ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Plugin</a> zum Durcharbeiten von Websockets, aber dazu spÃ¤ter mehr. <br><br>  <b>Wireguard</b>  Der Beschreibung nach zu urteilen, verfÃ¼gt es Ã¼ber eine gut verdrillte VerschlÃ¼sselung und einen Sitzungsaufbau-Mechanismus, aber die gesamte Kommunikation erfolgt Ã¼ber UDP.  Wireshark definiert die Art der Pakete als etwas vÃ¶llig UnhÃ¶rbares, und was eine Meinung darÃ¼ber ist, was mit einem DPI eines Drittanbieters passiert, ist eine sehr, sehr groÃŸe Frage.  <b>Update:</b> Neuere Versionen definieren Wireguard eindeutig als Wireguard, sodass die Antwort auf die Frage offensichtlich ist. <br><br>  <b>obfs3, obfs4</b> .  Pakete werden so verschleiert, dass sie von auÃŸen wie ein vÃ¶llig zufÃ¤lliger Satz von Werten aussehen.  Das heiÃŸt, sie fallen unter Punkt 4 aus der obigen Liste. <br><br>  <b>SoftEther</b>  Es sieht aus wie HTTPS, aber mit einem Haken.  ZusÃ¤tzlich zu TLS direkt Ã¼ber TCP sendet es aktiv Pakete von UDP-Paketen.  Wie in der Dokumentation festgestellt wurde, kann UDP verwendet werden, um die DatenÃ¼bertragung zu beschleunigen, wenn sie nicht in der Firewall beendet wird.  Diese FunktionalitÃ¤t ist in der Konfiguration deaktiviert, und nachdem sie deaktiviert wurde, wird alles so, wie es sollte. <br><br>  <b>SSTP</b> .  VPN-Prokotol von Microsoft.  Wird von Windows nativ unterstÃ¼tzt und unterstÃ¼tzt Software unter GNU / Linux.  Von auÃŸen sieht es aus wie HTTPS, und Wireshark bestÃ¤tigt dies voll und ganz. <br><br><h3>  Aber das ist noch nicht alles </h3><br>  Angenommen, Sie haben einen VPN-Server oder das Ende eines Tunnels auf einem Host installiert und so konfiguriert, dass er Port 443 Ã¼berwacht.  Es scheint, dass alles in Ordnung ist, aber es gibt einen ABER: Wenn wir uns als HTTPS verkleiden, kÃ¶nnen Sie Ã¼berprÃ¼fen, ob es tatsÃ¤chlich an Port 443 hÃ¤ngt, indem Sie einfach versuchen, sich in diesem Port mit einem einfachen Browser oder CURL oder auf andere Weise zu begraben.  In einigen Artikeln wird eine solche Methode als "Leitungsverbindung" bezeichnet und wird, wie erwÃ¤hnt, in China bereits hÃ¤ufig verwendet. <br><br>  Daher brauchen wir am 443. Port den gewÃ¶hnlichsten und anstÃ¤ndigsten Webserver.  Und hier entsteht ein interessantes Problem. <br><br>  Keiner der oben genannten Dienste in der Hauptdokumentation fand eine Beschreibung des Arbeitsmechanismus der Portfreigabe.  Die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SSLH-Option ist</a> nicht geeignet, schon allein deshalb, weil sslh den Datenverkehr zwischen HTTPS und den oben genannten Diensten nicht gemeinsam nutzen kann.  Zumindest, weil DPI in der Lage sein wird, wenn die Art des Verkehrs ohne vollstÃ¤ndige EntschlÃ¼sselung sslh unterscheiden kÃ¶nnte. <br><br>  In den meisten FÃ¤llen wird die Verwendung von SNI (Server Name Indication) empfohlen - einer TLS-Erweiterung, mit der Sie einen Hostnamen angeben und anschlieÃŸend HAProxy, Sniproxy und andere Tools verwenden kÃ¶nnen, um Verbindungen fÃ¼r Dienste zu verteilen.  Das Problem ist, dass in modernen TLS-Implementierungen der bei der Verwendung von SNI angegebene Hostname im Klartext Ã¼bertragen wird, dh in unverschlÃ¼sselter Form, und daher auch in Zukunft ausspioniert und verwendet werden kann. <br><br>  Deshalb werden wir improvisieren, und dann kamen mir zwei Optionen in den Sinn. <br><br><h4>  Port klopfen </h4><br><img src="https://habrastorage.org/webt/54/_n/v7/54_nv7qxgj4idvoek-ooxn6r6ju.jpeg" alt="Bild"><br><br>  Port Knocking dient nur dazu, "versteckte Dienste" auf dem Server zu aktivieren.  In Ã¤hnlicher Weise wird beispielsweise der Port, an dem der SSH-DÃ¤mon hÃ¤ngt, hÃ¤ufig "geschlossen", um Brute Force und die Verwendung von 0-Tage-SicherheitslÃ¼cken zu vermeiden.  In der klassischen Version (siehe z. B. die Implementierung des knockd-Daemons) wird unter Klopfen normalerweise der Versuch verstanden, eine Verbindung herzustellen oder Pakete an bestimmte Host-Ports in einer bestimmten Reihenfolge zu senden, wodurch der Daemon Sie als seinen eigenen "erkennt" und eine Firewall-Regel aktiviert, die den Zugriff auf einen bestimmten Port ermÃ¶glicht nur von Ihrer IP. <br><br>  In unserem Fall ist diese Option nicht ganz akzeptabel.  Erstens kÃ¶nnen die â€nicht standardmÃ¤ÃŸigenâ€œ Ports selbst irgendwo auf dem Weg blockiert sein, und zweitens kann das Verfahren selbst, wenn es von auÃŸen analysiert wird, verdÃ¤chtig aussehen.  Da wir uns als HTTPS tarnen, mÃ¼ssen wir auf HTTPS â€klopfenâ€œ. <br><br>  Ãœberraschenderweise gab es keine HTTP / HTTPS-Klopfer mit der erforderlichen FunktionalitÃ¤t, und daher wurde ein Nocker mit dem romantischen Namen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Labean geboren</a> (Husaren, schweigen Sie!). <br><br>  Gegeben: unser Server, auf dem Nginx auf Port 443 mit korrekt konfigurierten Zertifikaten ausgefÃ¼hrt wird und einige vÃ¶llig harmlose Inhalte anzeigt, z. B. GIFs mit Katzen, ISO-Images von GNU / Linux-Distributionen oder ein Wikipedia-Spiegel und Moshkovs Bibliothek. <br><br>  Gleichzeitig versteckten sich Zeilen des Formulars in der Nginx-Konfiguration <br><br><pre><code class="nginx hljs"> <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~ ^/somesecret/(.*)</span></span> {
    <span class="hljs-attribute"><span class="hljs-attribute">auth_basic</span></span>      <span class="hljs-string"><span class="hljs-string">"Administrator Login"</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">auth_basic_user_file</span></span>  /var/www/.htpasswd;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span>  X-Real-IP  <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://127.0.0.1:8080/<span class="hljs-variable"><span class="hljs-variable">$1</span></span>;
  }
</code></pre><br>
      ,       CURL'   <br>
<code>https://ourserver.org/somesecret/vpn/on</code><br>
  ,   ,     ,           IP-,  - <br>
<code>iptables -t nat -A PREROUTING -p tcp -s {clientIP} --dport 443 -j REDIRECT --to-port 4443</code><br>
    .<br>
<br>
  N  (,   )  ,    ,        ,         IP       .<br>
<br>
     ,    ,  URL   ,   /off  .<br>
<br>
       ,     IPv6 (v6-    X-Real-IP  ).<br>
<br>
   Go,    ,   ,    . ,      nginx  init-    Gihub:<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://github.com/uprt/labean</a><br>
<br>
<h4>Websockets</h4><br>
<img src="https://habrastorage.org/webt/as/nw/yn/asnwynceu_p8gghmcgf13e3ryiq.jpeg" alt="image"><br>
<br>
     :      HTTPS â€”    .  Web-         TCP    ,    Websocket (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">RFC 6455</a>).    HTTP-,      ,             TCP-.  , ,       HTTPS       .<br>
<br>
      WS  ,  - â€”    ,     CDN, , Cloudflare    .  ,        :    IP  CDN/proxy          CDN,          VPN/proxy   CDN,       .<br>
<br>
 WS-   (    Haskell),     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">wstunnel</a>,   nodejs   ,       .<br>
<br>
       .       wss://-, <br>
<br>
<pre><code class="bash hljs">wstunnel -t 33 wss://server:443</code></pre><br>
   ,  Â«Â» ws-      Â«Â» .   wstunnel,    ,      URI    -  :<br>
<br>
<pre><code class="bash hljs">wstunnel -t 33 wss://ourserver.org:443/hiddenws/</code></pre><br>
  :     <br>
<br>
   ,    443   Nginx c -  . <br>
<br>
    proxy-   Websockets-:<br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /hiddenws {
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://127.0.0.1:8081;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_http_version</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Upgrade <span class="hljs-variable"><span class="hljs-variable">$http_upgrade</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Connection <span class="hljs-string"><span class="hljs-string">"Upgrade"</span></span>;
  }</code></pre><br>
        websockets-.        SOCKS- (, Dante),  OpenVPN, ,   ,    .<br>
<br>
<div class="spoiler"><b class="spoiler_title"> selinux</b><div class="spoiler_text">   RHEL  ,   SELinux,    nginx   <br>
<code>2018/07/05 13:28:03 [crit] 7724#0: *11 connect() to 127.0.0.1:8081 failed (13: Permission denied) while connecting to upstream, client: IP_ADDRES, server: _, request: Â«GET /hiddenws/?dst=localhost:22 HTTP/1.1Â», upstream: Â«127.0.0.1:8081/hiddenws/?dst=localhost:22Â»,</code><br>
<br>
        :<br>
<br>
<pre><code class="bash hljs">semanage port -a -t http_port_t -p tcp 22
semanage port -m -t http_port_t -p tcp 22
semanage port -a -t http_port_t -p tcp 8081</code></pre><br>
<br>
 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Renatk</a>        .<br>
</div></div><br>
<br>
    â€”   SOCKS-  VPN-       wstunnel,           Â«Â» .<br>
<br>
 ,   v2ray  shadowcocks,   websockets    shadowsocks.    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://github.com/shadowsocks/v2ray-plugin</a><br>
<br>
<h3> </h3><br>
 â€”   VPN- -   MTU,  1400;<br>
 â€”   VPN- 2 IP-.        VPN/,       ;<br>
 â€”  Â«Â» IP-   ,    ICMP ping;<br>
 â€”     -  reverse DNS ,     -, , gateway-001.somehomeisp.net;<br>
 â€”      VPN/  DNS- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> OpenNIC</a>;<br>
         (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> </a>).<br>
<br>
<h3> </h3><br>
<img src="https://habrastorage.org/webt/dz/mp/tf/dzmptf35twb-e_wzib77grk3ksq.jpeg" alt="image"><br>
<br>
      - ,     â€”  .     ,   ,   â€”   ,    ,   . ,   HTTPS      â€” ,     ,    -    Â«   Â»/   /etc.,  ,      Â« Â»,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   </a>. <br>
<br>
 ,  ,   ,            ,     â€”  ,   ,    ,   . <br>
 .</div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415977/">https://habr.com/ru/post/de415977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415965/index.html">Was im Juli zu lesen ist: 19 neue BÃ¼cher fÃ¼r Digitalprofis</a></li>
<li><a href="../de415967/index.html">SolidFire - Speicher fÃ¼r diejenigen, die Hassspeicher haben</a></li>
<li><a href="../de415969/index.html">HyperX Pulsefire Surge RGB - ein natÃ¼rlich geborener Killer</a></li>
<li><a href="../de415973/index.html">So brechen Sie den Apache Ignite-Cluster nicht von Anfang an</a></li>
<li><a href="../de415975/index.html">Die Chinesen fÃ¼hrten eine Laserpistole mit einer Reichweite von fast einem Kilometer ein</a></li>
<li><a href="../de415979/index.html">Sicherheitswoche 24: Rowhammer unter Android und die KomplexitÃ¤t von Hardware-Schwachstellen</a></li>
<li><a href="../de415981/index.html">Google und HTTP</a></li>
<li><a href="../de415983/index.html">FrÃ¼hes Universum 5. Kosmologische Rotverschiebung und Dynamik eines einheitlich expandierenden Universums, Teil 1</a></li>
<li><a href="../de415987/index.html">QA-Meetup SuperJob</a></li>
<li><a href="../de415989/index.html">Analyse der Verwendung digitaler Signaturen: 10 der 15 wichtigsten KryptowÃ¤hrungen signieren keine Software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>