<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐พ ๐ ๐ ุชุฑุญูู ุณูุณ (ุชูุฑูุจูุง) ุจูู ุฅุตุฏุงุฑุงุช PostgreSQL ุงูุฑุฆูุณูุฉ ุจุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ุงูููุทูู ๐พ ๐ซ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู True Engineering ุ ูู ูุดุฑูุน ูุงุญุฏ ุ ุฃุตุจุญุช ุงูุญุงุฌุฉ ูุชุบููุฑ ุฅุตุฏุงุฑ PostgreSQL ูู 9.6 ุฅูู 11.1. 

 ููุงุฐุงุ ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงููุดุฑูุน ูู 1.5 ุชูุฑุงุจุงูุช ูุญ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุฑุญูู ุณูุณ (ุชูุฑูุจูุง) ุจูู ุฅุตุฏุงุฑุงุช PostgreSQL ุงูุฑุฆูุณูุฉ ุจุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ุงูููุทูู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/437318/" style=";text-align:right;direction:rtl">  ูู True Engineering ุ ูู ูุดุฑูุน ูุงุญุฏ ุ ุฃุตุจุญุช ุงูุญุงุฌุฉ ูุชุบููุฑ ุฅุตุฏุงุฑ PostgreSQL ูู 9.6 ุฅูู 11.1. <br><br>  ููุงุฐุงุ  ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงููุดุฑูุน ูู 1.5 ุชูุฑุงุจุงูุช ูุญุฌููุง ุขุฎุฐ ูู ุงูุงุฒุฏูุงุฏ.  ุงูุฃุฏุงุก ูู ุฃุญุฏ ุงููุชุทูุจุงุช ุงูุฑุฆูุณูุฉ ูููุธุงู.  ูุจููุฉ ุงูุจูุงูุงุช ููุณูุง ุชุชุทูุฑ: ุชุชู ุฅุถุงูุฉ ุฃุนูุฏุฉ ุฌุฏูุฏุฉ ุ ูุชุบููุฑ ุงูุฃุนูุฏุฉ ุงูููุฌูุฏุฉ.  ููุฏ ุชุนูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู Postgres ููููุฉ ุงูุนูู ุจููุงุกุฉ ูุน ุฅุถุงูุฉ ุฃุนูุฏุฉ ุฌุฏูุฏุฉ ุฐุงุช ูููุฉ ุงูุชุฑุงุถูุฉ ุ ูุฐูู ููุณุช ููุงู ุญุงุฌุฉ ูุณูุงุฌ ุงูุนูุงุฒุงุช ุงููุฎุตุตุฉ ุนูู ูุณุชูู ุงูุชุทุจูู.  ุญุชู ูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ุ ุชูุช ุฅุถุงูุฉ ุนุฏุฉ ุทุฑู ุฌุฏูุฏุฉ ูุชูุณูู ุงูุฌุฏุงูู ุ ููู ุฃูุฑ ูููุฏ ููุบุงูุฉ ุฃูุถูุง ูู ุธุฑูู ูููุฉ ูุจูุฑุฉ ูู ุงูุจูุงูุงุช. <br><br>  ูุฐูู ุ ุชูุฑุฑ ุ ูุญู ููุงุฌุฑ.  ุจุงูุทุจุน ุ ููููู ุฑูุน ูุณุฎุฉ ุฌุฏูุฏุฉ ูู ุฎุงุฏู PostgreSQL ุจุงูุชูุงุฒู ูุน ุงููุฏูู ุ ูุฅููุงู ุงูุชุทุจูู ุ ูุงุณุชุฎุฏุงู ุชูุฑูุบ / ุงุณุชุนุงุฏุฉ (ุฃู pg_upgrade) ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุจุฏุก ุงูุชุทุจูู ูุฑุฉ ุฃุฎุฑู.  ูู ููุงุณุจูุง ูุฐุง ุงูุญู ุจุณุจุจ ุงูุญุฌู ุงููุจูุฑ ูููุงุนุฏุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุนูู ุงูุชุทุจูู ูู ูุถุน ุงููุชุงู ุ ููุง ููุฌุฏ ุณูู ุจุถุน ุฏูุงุฆู ููุชููู. <br><br>  ูุฐูู ุ ูุฑุฑูุง ูุญุงููุฉ ุงูุชุฑุญูู ุจุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ุงูููุทูู ูู PostgreSQL ุจุงุณุชุฎุฏุงู ูููู ุฅุถุงูู ูุฌูุฉ ุฎุงุฑุฌูุฉ ูุณูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pglogical</a> . <br><br>  ูู ุนูููุฉ "ุงูุชุฌุฑุจุฉ" ุ ุตุงุฏููุง ูุซุงุฆู ูุฌุฒุฃุฉ ููุบุงูุฉ ุจุดุฃู ูุฐู ุงูุนูููุฉ (ูุงูุฑูุณูุฉ ููุณุช ุนูู ุงูุฅุทูุงู) ุ ููุฐูู ุจุนุถ ุงููุฒุงูู ูุงููุฑูู ุงูุฏูููุฉ ุบูุฑ ุงููุงุถุญุฉ.  ูู ูุฐู ุงูููุงูุฉ ุ ูุฑูุฏ ุชูุฏูู ุชุฌุฑุจุชูุง ูู ุดูู ุจุฑูุงูุฌ ุชุนูููู. <br><br><img src="https://habrastorage.org/webt/cp/i7/oi/cpi7oixtsenmioqdrcyyotgagyk.png"><br><br>  <b>TL ุ ุฏ</b> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญูู ูู ุดูุก (ูุง ูุฎูู ูู ุงูุนูุงุฒุงุช ุ ููุงู ุนููุง). </li><li style=";text-align:right;direction:rtl">  ููููู ุงูุชุฑุญูู ุฏุงุฎู ุฅุตุฏุงุฑ PostgreSQL ูู 9.4 ุฅูู 11.x ุ ูู ุฃู ุฅุตุฏุงุฑ ุฅูู ุฃู ุ ุฅูู ุฃุณูู ุฃู ูุฃุนูู. </li><li style=";text-align:right;direction:rtl">  ูุณุงูู ููุช ุงูุชููู ุนู ุงูุนูู ุงูููุช ุงูุฐู ูุณุชุบุฑูู ุงูุชุทุจูู ุงูุฎุงุต ุจู ูุฅุนุงุฏุฉ ุงูุงุชุตุงู ุจุฎุงุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏ (ูู ุญุงูุชูุง ุ ูุงูุช ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู ุจุงููุงูู ุ ูููู ุจุดูู ูุงุถุญ ุ "ุงูุฎูุงุฑุงุช ุงูููููุฉ"). </li></ul><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  ููุงุฐุง ูู ููุงุณุจูุง ุญู "ุงูุฌุจูุฉ"ุ </h3><br>  ููุง ูููุง ุจุงููุนู ุ ูุฅู ุฃุณูู ุทุฑููุฉ ููุฎุฑูุฌ ูู ุฑูุน ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู ุฎุงุฏู PostgreSQL ุจุงูุชูุงุฒู ูุน ุงููุฏูู ุ ูุฅููุงู ุงูุชุทุจูู ุ ูุงุณุชุฎุฏุงู ุชูุฑูุบ / ุงุณุชุนุงุฏุฉ (ุฃู pg_upgrade) ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุจุฏุก ุงูุชุทุจูู ูุฑุฉ ุฃุฎุฑู.  ุจุงููุณุจุฉ ูููุงุนุฏ ุงูุจูุงูุงุช ุฐุงุช ุงูุญุฌู ุงูุตุบูุฑ ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ูุนุฏ ูุฐุง ุฎูุงุฑูุง ููุงุณุจูุง (ุฃู ุ ูู ุงูุญุงูุฉ ุงูุนุงูุฉ ุ ุชููู ูุญุฏุฉ ุงูุชุฎุฒูู ุบูุฑ ูููุฉ ุนูุฏูุง ูููู ูุฏูู ุฎูุงุฑ ุชุนุทู ุงูุชุทุจูู ููุชุฑุฉ "ููู" ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงูุฎุงุฏู ุงููุฏูู ุฅูู ุงูุฌุฏูุฏ ุ ุจุบุถ ุงููุธุฑ ุนู ุงููุฏุฉ ุงูุชู ุชุณุชุบุฑููุง ูุฐู ุงููุฑุฉ).  ููู ูู ุญุงูุชูุง ุ ุชุฃุฎุฐ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุญูุงูู 1.5 ุชูุฑุงุจุงูุช ุนูู ุงููุฑุต ุ ูููููุง ููุณ ูุณุฃูุฉ ุฏูุงุฆู ุ ุจู ุนุฏุฉ ุณุงุนุงุช.  ูุนูู ุงูุชุทุจูู ุ ุจุฏูุฑู ุ ูู ูุถุน ุงููุชุงู ุ ูุฃุฑุฏุช ุญููุง ุชุฌูุจ ุงูุชููู ูุฃูุซุฑ ูู ุฏูููุชูู. <br><br>  ุถุฏ ูุฐุง ุงูุฎูุงุฑ ุฃูุถูุง ุ ุญูููุฉ ุฃููุง ูุณุชุฎุฏู ุงููุณุฎ ุงููุชูุงุซู Master-Slave ููุง ูููููุง ุฅููุงู ุชุดุบูู ุฎุงุฏู Slave ุจุฃูุงู ูู ุณูุฑ ุงูุนูู.  ูุฐูู ุ ูุชุญููู ุงูุชุทุจูู ูู ุงูุฅุตุฏุงุฑ ุงููุฏูู ูู PostgreSQL ุฅูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ุจุนุฏ ุชุฑุญูู ุฎุงุฏู Master ุ ุณูููู ูู ุงูุถุฑูุฑู ุฅุนุฏุงุฏ ุฎุงุฏู Slave ุฌุฏูุฏ ูุจู ุจุฏุก ุชุดุบูู ุงูุชุทุจูู.  ููุฐุง ูู ุจุถุน ุณุงุนุงุช ุฅุถุงููุฉ ูู ุงูุชููู ุญุชู ูุชู ุฅูุดุงุก ุงูุนุจุฏ (ุนูู ุงูุฑุบู ูู ุฃูู ุจูุซูุฑ ูู ูุฌุฑุฉ ุงูุณูุฏ). <br><br>  ูุฐูู ุ ูุฑุฑูุง ูุญุงููุฉ ุงูุชุฑุญูู ุจุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ุงูููุทูู ูู PostgreSQL ุจุงุณุชุฎุฏุงู ูููู ุฅุถุงูู ูุฌูุฉ ุฎุงุฑุฌูุฉ ูุณูู pglogical. <br><br><h3 style=";text-align:right;direction:rtl">  ูุนูููุงุช ุนุงูุฉ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pglogical</a> ูู ูุธุงู ุชูุฑุงุฑ ููุทูู ูุณุชุฎุฏู ูู ุงูุชุดููุฑ ุงูููุทูู ุงูุฃุตูู ูู PostgreSQL ููุชู ุชูููุฐู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุญู</a> PostgreSQL.  ูุชูุญ ูู ุชูููู ุงููุณุฎ ุงููุชูุงุซู ุงูุงูุชูุงุฆู ุจุงุณุชุฎุฏุงู ูููุฐุฌ ุงูุงุดุชุฑุงู / ุงููุดุฑ.  ูุง ูุชุทูุจ ุฅูุดุงุก ูุดุบูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃู ุงุณุชุฎุฏุงู ุฃู ุฃุฏูุงุช ูุณุงุนุฏุฉ ุฎุงุฑุฌูุฉ ูููุณุฎ ุงููุชูุงุซู. <br><br>  ูุนูู ุงูููุญู ุนูู ุฃู ุฅุตุฏุงุฑ ูู PostgreSQL ุ ุจุฏุกูุง ูู 9.4 (ููุฐ ุธููุฑ ูู ุงูุชุดููุฑ ุงูููุทูู ูุฃูู ูุฑุฉ ูู 9.4) ุ ููุณูุญ ูู ุจุงูุชุฑุญูู ุจูู ุฃู ุฅุตุฏุงุฑุงุช ูุฏุนููุฉ ูู PostgreSQL ูู ุฃู ุงุชุฌุงู. <br><br>  ุฅุนุฏุงุฏ ุงููุณุฎ ุงููุชูุงุซู ูุฏูููุง ุจุงุณุชุฎุฏุงู pglogical ูุฏูููุง ููุณ ุชุงูููุง ููุบุงูุฉ ุ ุนูู ุงูุฑุบู ูู ุฃูู ูู ุญูุซ ุงููุจุฏุฃ ูู ุงููููู ุชูุงููุง.  ูุญุณู ุงูุญุธ ุ ููุงู ุฃุฏุงุฉ ูุณุงุนุฏุฉ ูุฌูุฉ ุฎุงุฑุฌูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pgrepup</a> ูุฃุชูุชุฉ ุนูููุฉ ุงูุชูููู ุ ูุงูุชู ุณูู ูุณุชุฎุฏููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ูุฐูุฑุฉ ูุณุงุญุฉ ุงููุฑุต </h3><br>  ูุธุฑูุง ูุฃููุง ูุฎุทุท ูุฑูุน ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู PostgreSQL ุนูู ููุณ ุงูุฎูุงุฏู ุจุงูุชูุงุฒู ูุน ุงููุฏูู ุ ูุชู ูุถุงุนูุฉ ูุชุทูุจุงุช ุงููุฑุต ููุงุนุฏุฉ ุงูุจูุงูุงุช ุนูู ุฎูุงุฏู Master ู Slave.  ูุจุฏู ุฃู ูุฐุง ูุงุถุญ ุ ูููู ... ููุท ุงุนุชูู ุจูุณุงุญุฉ ุฎุงููุฉ ูุงููุฉ ูุจู ุจุฏุก ุงููุณุฎ ุงููุชูุงุซู ุญุชู ูุง ุชูุฏู ุนูู ุงูุณููุงุช ุงูุชู ูุถุงูุง ุจูุง ูุฏู. <br><br>  ูู ุญุงูุชูุง ุ ูุงูุช ุชุนุฏููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุทููุจุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุชูุณูู ุงูุชุฎุฒูู ุฃุซูุงุก ุงูุชุฑุญูู ูุง ุจูู 9.6 ู 11 "ุชุถุฎู" ููุณ ูุตุงูุญ ุงูุฅุตุฏุงุฑ ุงูุฃุฎูุฑ ุ ูุฐูู ูุงู ูุง ุจุฏ ูู ุฒูุงุฏุฉ ูุณุงุญุฉ ุงููุฑุต ููุณ 2 ุ ูููู ุจูุญู 2.2 ูุฑุฉ.  ุงูุญูุฏ LVM ุ ููููู ุงูููุงู ุจุฐูู ูู ุนูููุฉ ุงููุฌุฑุฉ ุนูู ุงูุทุงูุฑ. <br><br>  ุจุดูู ุนุงู ุ ุชุนุชูู ุจู. <br><br><h3 style=";text-align:right;direction:rtl">  ุชุซุจูุช PostgreSQL 11 ุนูู ูุงุฌุณุชูุฑ </h3><br><blockquote style=";text-align:right;direction:rtl">  ููุงุญุธุฉ: ูุณุชุฎุฏู Oracle Linux ุ ูุณูุชู ุชูุถูุญ ูู ูุง ููู ููุฐุง ุงูุชูุฒูุน.  ูู ุงููุญุชูู ุฃู ุชุชุทูุจ ุชูุฒูุนุงุช Linux ุงูุฃุฎุฑู ูุฑุงุฌุนุฉ ุตุบูุฑุฉ ูุน ููู ุ ููู ูู ุบูุฑ ุงููุญุชูู ุฃู ุชููู ูุจูุฑุฉ. </blockquote><pre style=";text-align:right;direction:rtl"><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   yum install https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-7-x86_64/pgdg-oraclelinux11-11-2.noarch.rpm #   postgresql11 yum install postgresql11 postgresql11-devel postgresql11-server postgresql11-contrib #   /usr/pgsql-11/bin/postgresql-11-setup initdb</span></span></code> </pre> <br>  ููุน datadir ุงููุฏูู ูู <b>/var/lib/pgsql/9.6/data</b> ุ ุงูุฌุฏูุฏ ูู <b>/ var / lib / pgsql / 11 / data</b> <br><br>  ุงูุณุฎ ุฅุนุฏุงุฏุงุช ุงููุตูู ( <b>pg_hba.conf</b> ) ูุฅุนุฏุงุฏุงุช ุงูุฎุงุฏู ( <b>postgresql.conf</b> ) ูู 9.6 ุฅูู 11. <br><br>  ูุชุดุบูู ุฎุงุฏูู PostgreSQL ุนูู ููุณ ุงูุฌูุงุฒ ุ ูู ุชููุฆุฉ ุชููุฆุฉ <b>postgresql.conf</b> 11 ุ ูู ุจุชุบููุฑ ุงููููุฐ ุฅูู 15432 (ุงููููุฐ = 15432). <br><br>  ููุง ุ ุนููู ุฃู ุชููุฑ ูููุง ูู ูุง ุชุญุชุงุฌ ุฅูู ูุนูู ูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู PostgreSQL ุนูู ูุฌู ุงูุชุญุฏูุฏ ูู ุญุงูุชู ุ ุจุญูุซ ูุจุฏุฃ ุจู <b>postgresql.conf</b> (ููููู ุฃู ูุนูู ุงูุชุทุจูู ุงูุฎุงุต ุจู ูู ุงูููุงูุฉ).  ูู ุญุงูุชูุง ุ ูุงู ูุทููุจูุง ุชุซุจูุช ููุญูุงุช PostgreSQL ุงููุณุชุฎุฏูุฉ ูู ูุจููุง ูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ.  ูุฐุง ุฎุงุฑุฌ ูุทุงู ุงูููุงูุฉ ุ ููุท ุงุฌุนู PostgreSQL ุงูุฌุฏูุฏ ูุจุฏุฃ ุงูุนูู ุ ููุชูุงุณุจ ูุนู ุชูุงููุง :) <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  ,  ,  shared libraries, whatever... # .... #  systemctl enable postgresql-11 systemctl start postgresql-11</span></span></code> </pre> <br>  ูุญู ููุธุฑ <b>/ var / lib / pgsql / 11 / data / pg_log /</b> .  ูู ูู ุดูุก ุจุฎูุฑุ  ููุงุตู! <br><br><h3 style=";text-align:right;direction:rtl">  ุชุซุจูุช ูุชูููู pgrepup </h3><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  python yum install python yum install python2-pip #  pgrepup pip install pgrepup #   pgrepup config</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/zg/xz/9o/zgxz9oct5l-qglkxyeyrqejh4we.png"><br><br>  ุงููุฑูู ุงูุฏูููุฉ: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจูุตููุง <b>app_owner ุ ูุฅููุง</b> ูุญุฏุฏ ุงููุณุชุฎุฏู ุงูุฐู ุชุนูู ุจููุฌุจู ุฎูุงุฏู PostgreSQL. </li><li style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ <b>ููุงุนุฏุฉ ุงูุจูุงูุงุช ุ</b> ุญุฏุฏ <b>template1</b> . </li><li style=";text-align:right;direction:rtl">  <b>ุงุณู ุงููุณุชุฎุฏู</b> ููููุฉ <b>ุงููุฑูุฑ</b> - ุงูุจูุงูุงุช ูููุตูู ุงูุฎุงุฑู.  ูู ุญุงูุชูุง ุ ุชู ุชุญุฏูุฏ ุทุฑููุฉ <b>ุงูุซูุฉ</b> ูู <b>pg_hba.conf</b> ููุงุชุตุงูุงุช ุงููุญููุฉ ูููุณุชุฎุฏู <b>postgres</b> ุ ุจุญูุซ ููููู ุชุญุฏูุฏ ูููุฉ ูุฑูุฑ ุชุนุณููุฉ. </li></ol><br><h3 style=";text-align:right;direction:rtl">  ุชูููู ุงููุณุฎ ุงููุชูุงุซู </h3><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   pgrepup check</span></span></code> </pre><br>  ูุญุตู ุนูู ุฅุฎุฑุงุฌ ูุงุฆูุฉ ุจุงูุนุฏูุฏ ูู ุงููุนููุงุช ุงูุชู ูุฌุจ ุชูููููุง ุนูู ุงููุญู ุงููุทููุจ. <br><br>  ูุซุงู ูุชุงุฆุฌ ุงูุชุญูู: <br><br><img src="https://habrastorage.org/webt/h3/wu/zm/h3wuzmcevo7idf-xlyrz3ae8av8.png"><br><br><img src="https://habrastorage.org/webt/58/zh/bb/58zhbbubdbfvzzgat051bviywqy.png"><br><br>  ูุฌุจ ุฅุฒุงูุฉ ุฌููุน ุงูุฃุฎุทุงุก ุฃุซูุงุก ุนูููุฉ ุงูุชุญูู.  ูู ุฅุนุฏุงุฏุงุช ููุง ุงูุฎุงุฏููู ูุฌุจ ุชุนููู <b>wal_level = LOGICAL</b> (ูู ุฃุฌู ูู ุงูุชุดููุฑ ุงูููุทูู ููุนูู) ุ ูุงูุฅุนุฏุงุฏุงุช ุงููุงุฒูุฉ ููุญุฑู ุงููุณุฎ ุงููุชูุงุซู (ุนุฏุฏ ูุชุญุงุช ู <b>wal_senders</b> ).  ุชูููุญุงุช ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ pgrepup ูููุฏุฉ ููุบุงูุฉ ุ ูุง ููุจุบู ุฃู ุชุซุงุฑ ุงูุฃุณุฆูุฉ ูู ูุนุธู ุงูููุงุท. <br><br>  ูุตูุน ุฌููุน ุงูุฅุนุฏุงุฏุงุช ุงููุงุฒูุฉ ุงูุชู ูุทูุจูุง pgrepup. <br><br>  ูู ููุง ุงูููููู <b>pg_hba.conf</b> ูุถูู ุฃุฐููุงุช ูููุณุชุฎุฏู ุงูุฐู ุณูููู ุจุงููุณุฎ ุงููุชูุงุซู ุ ูู ุฐูู ูู ููุฌู pgrepup: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">host replication pgrepup_replication 127.0.0.1/32 md5 host all pgrepup_replication 127.0.0.1/32 md5</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ุงูููุงุชูุญ ุงูุฃุณุงุณูุฉ </h3><br>  ููู ูุนูู ุงููุณุฎ ุงููุชูุงุซู ุ ูุฌุจ ุชุญุฏูุฏ ููุชุงุญ ุฃุณุงุณู ูู ุฌููุน ุงูุฌุฏุงูู. <br><br>  ูู ุญุงูุชูุง ุ PK ูู ููู ูู ูู ููุงู ุ ูุฐูู ุ ูู ููุช ุงููุณุฎ ุงููุชูุงุซู ุ ุชุญุชุงุฌ ุฅูู ุฅุถุงูุชู ุ ููู ููุงูุฉ ุงููุณุฎ ุงููุชูุงุซู ุ ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ุงุญุฐูู. <br><br>  ูุงุฆูุฉ ุงูุฌุฏุงูู ุจุฏูู PK ุ ูู ุจูู ุฃุดูุงุก ุฃุฎุฑู ุ ุชูุชุฌ <code>pgrepup check</code> .  ุจุงููุณุจุฉ ูุฌููุน ุงูุฌุฏุงูู ูู ูุฐู ุงููุงุฆูุฉ ุ ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ููุชุงุญ ุฃุณุงุณู ุจุฃู ุทุฑููุฉ ุชูุงุณุจู.  ูู ุญุงูุชูุง ุ ูุงู ุดูุก ูุซู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> %s <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> temporary_pk <span class="hljs-type"><span class="hljs-type">BIGSERIAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIMARY KEY</span></span></code> </pre> <br>  ุชุญุชูู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ pgrepup ุนูู ุฃูุฑ ูุถูู ูุชูููุฐ ูุฐู ุงูุนูููุฉ ( <code>pgrepup fix</code> ) ุ ูุญุชู ุฅุฐุง ุชู ุงุณุชุฎุฏุงููุง ุ ููู ุงูููููู ุฃูู ูู ุญุงูุฉ <code>pgrepup fix</code> ุงููุณุฎ ุงููุชูุงุซู ุ ุณูุชู ุญุฐู ูุฐู ุงูุฃุนูุฏุฉ ุงููุคูุชุฉ ุชููุงุฆููุง.  ูููู ุ ูุณูุก ุงูุญุธ ุ ูุงูุช ูุฐู ุงููุธููุฉ ููููุฉ ููุบุงูุฉ ูุนุฑุจุงุช ุงูุชู ุชุฌุฑูุง ุงูุฏูุงุจ ุจุดูู ุณุงุญุฑ ุนูู ููุงุนุฏ ูุจูุฑุฉ ุฃููุง ูุฑุฑูุง ุนุฏู ุงุณุชุฎุฏุงููุง ุ ูููู ููููุงู ุจูุฐู ุงูุนูููุฉ ูุฏููุง ุ ูุฃููุง ูุฑูุญุฉ ุจุงููุณุจุฉ ููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุชุซุจูุช ููุญู pglogical </h3><br>  ูููู ุงูุนุซูุฑ ุนูู ุชุนูููุงุช ุชุซุจูุช ุงูุงูุชุฏุงุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ูุฌุจ ุชุซุจูุช ุงูุงูุชุฏุงุฏ ุนูู ููุง ุงูุฎุงุฏููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#       curl https://access.2ndquadrant.com/api/repository/dl/default/release/9.6/rpm | bash curl https://access.2ndquadrant.com/api/repository/dl/default/release/11/rpm | bash #   yum install postgresql96-pglogical postgresql11-pglogical</span></span></code> </pre> <br>  ุฅุถุงูุฉ ุชุญููู ุงูููุชุจุฉ ูู <b>postgresql.conf ูู</b> ููุง ุงูุฎุงุฏููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">shared_preload_libraries = <span class="hljs-string"><span class="hljs-string">'pglogical'</span></span></code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุชุซุจูุช ููุญู pgl_ddl_deploy </h3><br>  ูุฐุง ููุญู ูุณุงุนุฏ ูุณุชุฎุฏูู pgrepup ูููุณุฎ ุงููุชูุงุซู ุงูููุทูู ูู DDL. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      git clone https://github.com/enova/pgl_ddl_deploy.git #       PATH=/usr/pgsql-9.6/bin/:$PATH USE_PGXS=1 make USE_PGXS=1 make install make clean #       PATH=/usr/pgsql-11/bin/:$PATH make CLANG=true make install</span></span></code> </pre> <br>  ุฅุถุงูุฉ ุชุญููู ุงูููุชุจุฉ ูู <b>postgresql.conf ูู</b> ููุง ุงูุฎุงุฏููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">shared_preload_libraries = <span class="hljs-string"><span class="hljs-string">'pglogical,pgl_ddl_deploy'</span></span></code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุงูุชุบููุฑุงุช </h3><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   postgresql systemctl restart postgresql-11</span></span></code> </pre> <br>  ุงูุขู ุจุงุณุชุฎุฏุงู <code>pgrepup check</code> ุฃูู ุจุญุงุฌุฉ ุฅูู ุงูุชุฃูุฏ ูู ุฃู ูู ุดูุก ุฃุตุจุญ <code>pgrepup check</code> ูุน ุงูุฎุงุฏู ุงููุฏู ูุฃู ุฌููุน ุงูุชุนูููุงุช ุงููุชุนููุฉ ุจุงูุฎุงุฏู ุงููุฏู ูุฏ ุชู ุงูุชุฎูุต ูููุง ุชูุงููุง. <br><br>  ุฅุฐุง ูุงู ูู ุดูุก ุนูู ูุง ูุฑุงู ุ ููููู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ุงููุฏูู.  ููุง ุชุญุชุงุฌ ุฅูู ุงูุชูููุฑ ูู ููููุฉ ุชูุงุนู ุงูุชุทุจูู ุงูุฎุงุต ุจู ูุน ุฅุนุงุฏุฉ ุชุดุบูู ุฎุงุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุฑุจูุง ูุฌุจ ุนููู ุฅููุงูู ุฃููุงู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  systemctl restart postgresql-9.6 #  pgrepup check</span></span></code> </pre> <br>  ุงูุขู ูู ุฅุฎุฑุงุฌ ุงูุฃูุฑ ุ ูุฌุจ ูุถุน ุนูุงูุฉ ุนูู ุฌููุน ุงูุนูุงุตุฑ ุนูู ุฃููุง ููุงูู. <br><br>  ูุจุฏู ุฃูู ููููู ุจุฏุก ุงูุชุฑุญูู ุ ูููู ... <br><br><h3 style=";text-align:right;direction:rtl">  ุฅุตูุงุญ ุงูุฎูู pgrepup </h3><br>  ููุฌุฏ ุงูุนุฏูุฏ ูู ุงูุฃุฎุทุงุก ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู ูู pgrepup ุงูุชู ุชุฌุนู ุงูุชุฑุญูู ูุณุชุญูููุง.  ุชู ุฅุฑุณุงู ุทูุจุงุช ุงูุณุญุจ ุ ูููู ููุฃุณู ุ ูุชู ุชุฌุงูููุง ุ ูุฐุง ุณูุชุนูู ุนููู ุฅุฌุฑุงุก ุงูุชุตุญูุญุงุช ูุฏูููุง. <br><br>  ูุฐูุจ ุฅูู ูุฌูุฏ ุชุซุจูุช pgrepup (ุญุงูุชูุง ูู <b>/usr/lib/python2.7/site-packages/pgrepup/commands/</b> ). <br><br>  ุงูุนููุง ูุฑุฉ ูุงุญุฏุฉ.  ูู ูู ููู <b>* .py</b> ุ ุฃุถู <code>**kwargs</code> ุงูููููุฏุฉ ูู ูุตู ุงููุธููุฉ.  ุงูุตูุฑุฉ ุฃูุถู ูู ุฃูู ูููุฉ: <br><br><img src="https://habrastorage.org/webt/l3/zc/uo/l3zcuo2exe8lq_0u3gwv_nq8jty.png"><br><br>  ุงุฑุชูุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . <br><br>  ูู ุงุซููู.  ูู <b>setup.py</b> ูููู ุจุงูุจุญุซ ุนู "sh -c" ุ ุฅุฏุฎุงููู ุ ุฌููุน ุฃูุงูุฑ shell ูุชุนุฏุฏุฉ ุงูุฃุณุทุฑ ุชุญุชุงุฌ ุฅูู ุฃู ุชููู ุณุทุฑูุง ูุงุญุฏูุง. <br><br>  ุงุฑุชูุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . <br><br><h3 style=";text-align:right;direction:rtl">  ุงุจุฏุฃ ุงูุชุฑุญูู </h3><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  pgrepup setup</span></span></code> </pre> <br>  ุจุงุณุชุฎุฏุงู ูุฐุง ุงูุฃูุฑ ุ ูููู ุฅุนุฏุงุฏ pgrepup ุจุฅุนุฏุงุฏ ููุง ุงูุฎุงุฏููู ูุจุฏุก ุงููุณุฎ ุงููุชูุงุซู ุ ูุฅูุดุงุก ูุณุชุฎุฏู ุ ูุชูููู pglogical ุ ูููู ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช. <br><br><img src="https://habrastorage.org/webt/ww/km/jd/wwkmjdmmpmwyvgbdqyktohnhmmy.png"><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   pgrepup start</span></span></code> </pre> <br>  ูุงู ุ "ุฏุนูุง ูุฐูุจ!"  ูููุญ ุจูุฏู: <br><br><img src="https://habrastorage.org/webt/3k/xc/_r/3kxc_rgde-t7q6yuhtvwkol5acs.png"><br><br>  ุงููุณุฎ ุงููุชูุงุซู ููุฏ ุงูุชุดุบูู.  ูููู ุฑุคูุฉ ุงููููู ุงูุญุงูู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ <code>pgrepup status</code> : <br><br><img src="https://habrastorage.org/webt/ig/gs/wb/iggswbqldii-c6cd5a1y7qyqawu.png"><br><br>  ููุง ูุฑู ุฃู ูุงุนุฏุชู ุจูุงูุงุช ูุฏ ุชุญุฑูุช ุจุงููุนู ูุฃู ุนูููุฉ ุงููุณุฎ ุงููุชูุงุซู ููุฏ ุงูุชูุฏู ุ ููุง ุฒุงูุช ููุงู ุนูููุฉ ููู.  ุงูุขู ูุจูู ููุท ุดุฑุจ ุงููููุฉ ูุงูุงูุชุธุงุฑ ุญุชู ูุชู ุถุฎ ูุงูู ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฃุตููุฉ. <br><br>  ุนูู ุทูู ุงูุทุฑูู ุ ููููู ุงููุธุฑ ุจุดูู ุฃุนูู ูู ูุงุฌูุฉ pgrepup ููุนุฑูุฉ ูุง ูุญุฏุซ ุชุญุช ุงูุบุทุงุก.  ููุงุณุชูุณุงุฑ ุนู ุงูุนููู ุ ุฅููู ูุงุฆูุฉ ูู ุงูุงุณุชุนูุงูุงุช ูููุทุฉ ุงูุทูุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_replication_origin_status <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> remote_lsn <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> *,pg_xlog_location_diff(s.sent_location,s.replay_location) byte_lag <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_replication s; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> query <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> application_name=<span class="hljs-string"><span class="hljs-string">'subscription_copy'</span></span></code> </pre> <br>  ุชูุงูู ุงููุซูุฑ ูู ุงููููุฉ (ุนูู ุฎุงุฏู ุงูุงุฎุชุจุงุฑ ุนูุฏ ูุชุงุจุฉ ูุฐุง ุงูููุงู ุ ูุงุณุชูุฑุงุฑ ุชุฑุญูู ุญูุงูู 700 ุฌูุฌุงุจุงูุช ูู ุงูุจูุงูุงุช ูู ุงูููู ุชูุฑูุจูุง) ุ ูุฑู ุฃุฎูุฑูุง ุงูุตูุฑุฉ ุงูุชุงููุฉ: <br><br><img src="https://habrastorage.org/webt/ep/2e/q2/ep2eq2c_mtywxboftk4ocb0e_1c.png"><br><br>  ููุฐุง ูุนูู ุฃู ุงูููุช ูุฏ ุญุงู ูุฅุนุฏุงุฏ ุงูุนุจุฏ ุงูุฌุฏูุฏ. <br><br><h3 style=";text-align:right;direction:rtl">  ุชุซุจูุช PostgreSQL 11 ุนูู ุงูุฑููู </h3><br>  ููุง ูู ุดูุก ุจุณูุท ูุญุณุจ ุงููุชุงุจ ุงููุฏุฑุณู ุ ูุง ุชูุฌุฏ ูุฑูู ุฏูููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   yum install https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-7-x86_64/pgdg-oraclelinux11-11-2.noarch.rpm #  postgresql 11 yum install postgresql11 postgresql11-devel postgresql11-server postgresql11-contrib #      su - postgres pg_basebackup -h db-master.hostname -p 15432 -D /var/lib/pgsql/11/data/ -R -P -U replication -X stream -c fast</span></span></code> </pre> <br>  ุงูุณุฎ ุฅุนุฏุงุฏุงุช ุงููุตูู ( <b>pg_hba.conf</b> ) ูุฅุนุฏุงุฏุงุช ุงูุฎุงุฏู ( <b>postgresql.conf</b> ) ูู 9.6 ุฅูู 11. ูู ุชููุฆุฉ <b>postgresql.conf</b> 11 ุ ูู ุจุชุบููุฑ ุงููููุฐ ุฅูู 15432 (ุงููููุฐ = 15432) <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  systemctl enable postgresql-11 systemctl start postgresql-11</span></span></code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">#     Master <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> *,pg_wal_lsn_diff(s.sent_lsn,s.replay_lsn) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> byte_lag <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_replication s; #     Slave <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> now()-pg_last_xact_replay_timestamp();</code> </pre><br><h3 style=";text-align:right;direction:rtl">  ุงููุฌุงููุน ุงููุฑุนูุฉ </h3><br>  ุจุนุฏ ูู ูุฐู ุงูุฅุฌุฑุงุกุงุช ุ ูุญุตู ุนูู ูุธุงู ุงููุณุฎ ุงููุชูุงุซู ุงูุตุนุจ ูุฐุง: <br><br><img src="https://habrastorage.org/webt/70/ns/ej/70nsejcslxlccih_yktvesptqjg.png"><br><br>  ููุง ุ ูุงุฎุชุจุงุฑ ููุงุฆู (ููู ุงูููุงูุฉ ุ ุฅูู ุฌููู ููุท) ุ ููููู ุฅุฌุฑุงุก ุจุนุถ ุงูุชุญุฏูุซุงุช ูู ูุงุนุฏุฉ ุจูุงูุงุช Master 9.6 ููุดุงูุฏุฉ ููููุฉ ูุณุฎูุง ุฅูู ุงูุฎูุงุฏู ุงูุซูุงุซุฉ ุงูุฃุฎุฑู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c0/c42/89e/7c0c4289e8a00b100f58ce751bd9209e.png" alt="ุงูุตูุฑุฉ"><br><br><h3 style=";text-align:right;direction:rtl">  ุชุจุฏูู ุงูุชุทุจูู ุฅูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู PostgreSQL </h3><br>  ุญุชู ุงูุขู ุ ูู ูุดู ุชุทุจูููุง ูู ุฃู ุดูุก ูุชุนูู ุจุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู PostgreSQL ุ ููุฏ ุญุงู ุงูููุช ูุฅุตูุงุญู.  ุงูุฎูุงุฑุงุช ููุง ุชุนุชูุฏ ุจุดูู ุฃุณุงุณู ุนูู ุดูุฆูู ููุท: <br>  ูู ุชููู ุงูุฎุฏูุงุช ุงูุฌุฏูุฏุฉ ุนูู ููุณ ุงูููุงูุฐ ุงูุชู ุนููุช ุนูููุง ุงููุฏููุฉุ <br>  ููุง ุฅุฐุง ูุงู ุงูุชุทุจูู ุงูุฎุงุต ุจู ูุชุทูุจ ุฅุนุงุฏุฉ ุชุดุบูู ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุฎุงุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช. <br><br>  ูููุชุนุฉ ุ ุณูู ูููู ุจุงูุฑุฏ ุนูู ููุง ุงูุณุคุงููู "ูุนู" ูุงููุถู ูุฏูุง. <br><br>  ูููู ุงูุชุทุจูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"># ,   , : <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    #       sequences. pgrepup stop</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/cz/hc/2t/czhc2t8k6pjk-6ivvilidj5k9xq.png"><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      pgrepup uninstall</span></span></code> </pre><br><img src="https://habrastorage.org/webt/2w/ud/dq/2wuddqovqbninwwz9rx9fia8psa.png"><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  master: #    systemctl disable postgresql-9.6 #   ,  ,  . systemctl stop postgresql-9.6 systemctl stop postgresql-11 #  slave: #    systemctl disable postgresql-9.6 #   ,  ,  . systemctl stop postgresql-9.6 systemctl stop postgresql-11</span></span></code> </pre> <br>  ูุฑุฌุน ุงููููุฐ ุงูููุงุณู ูู ุงูุชูููู <b>postgresql.conf</b> ูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ุฅูู Master and Slave. <br><br>  ุนูู Slave ุงูุฌุฏูุฏ ุ ูููู ุฃูุถูุง ุจุชุบููุฑ ุงููููุฐ ุฅูู ุงููููุฐ ุงูููุงุณู ูู <b>recovery.conf</b> . <br><br>  ุนูู ุทูู ุงูุทุฑูู ุ ููุงู ุงูุชุฑุงุญ ูู ุงูุฎุทูุฆุฉ ููุฒูุฏ ูู ุชุบููุฑ ุงููููุฐ ุนูู ุฃู ูุตุจุญ ุงูุฅุตุฏุงุฑ ุงููุฏูู ุบูุฑ ูุดุท: <br>  ูุญู ููุดู ุนู ุงููููุฐ ุบูุฑ ุงูููุงุณู ูู <b>postgresql.conf ูู</b> ุงูุฅุตุฏุงุฑ ุงููุฏูู ุฅูู Master and Slave. <br>  ุนูู Slave ุงููุฏูู ุ ูููู ุฃูุถูุง ุจุชุบููุฑ ุงููููุฐ ุฅูู ูููุฐ ุบูุฑ ููุงุณู ูู <b>recovery.conf</b> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   master systemctl enable postgresql-11 systemctl start postgresql-11 #   slave: systemctl enable postgresql-11 systemctl start postgresql-11</span></span></code> </pre> <br>  ุชุญูู ูู ุงูุณุฌูุงุช. <br><br>  ุชุญูู ูู ุญุงูุฉ ุงููุณุฎ ุงููุชูุงุซู ุนูู Master. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> *,pg_wal_lsn_diff(s.sent_lsn,s.replay_lsn) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> byte_lag <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_replication s;</code> </pre> <br>  ูุทูู ุงูุชุทุจูู.  ูุญู ุณุนุฏุงุก ููุฏุฉ ูุตู ุณุงุนุฉ. <br><br>  <b>ูุฃุฎูุฑุง ุ ุฃุฏุจ ูููุฏ ุญูู ูุฐุง ุงูููุถูุน:</b> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pglogical</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุนูููุงุช ุงูุชุซุจูุช ู pglogical</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุณุชูุฏุงุช pglogical</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฑููุฉ PostgreSQL ูู 9.4 ุฅูู 10.3 ุจุงุณุชุฎุฏุงู pglogical</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pgrepup - ุชุฑููุฉ PostgreSQL ุจุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ุงูููุทูู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pgrepup - PostgreSQL ุชูุฑุงุฑ ูุชุฑููุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฑููุฉ PostgreSQL ูู 9.6 ุฅูู 10 ูุน ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุชููู ุจุงุณุชุฎุฏุงู pglogical</a> </li></ul><br>  ุญุธุง ุณุนูุฏุง </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar437318/">https://habr.com/ru/post/ar437318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar437308/index.html">ุฏูุฑุฉ ุฏุฑุณ SDL 2.0: ุงูุฏุฑุณ 4 - ุงูุชุนุงูู ูุน ุงูุฃุญุฏุงุซ</a></li>
<li><a href="../ar437310/index.html">ุญุฏูุฏ ุงูุชุฏุฑุฌ ุงููุบูู</a></li>
<li><a href="../ar437312/index.html">ุชุทุจูู ุฅุนุงุฏุฉ ุชุญููู ุณุงุฎู ูุฑูุฒ C ++ ุนูู ูุธุงูู Linux ู macOS: ุงูุญูุฑ ุจุดูู ุฃุนูู</a></li>
<li><a href="../ar437314/index.html">ูุบุฒ ุงูุฅูุทุงููุฉ: ุขูุงุช ุงูุชุดููุฑ OMI</a></li>
<li><a href="../ar437316/index.html">ูุงู ูุนูุฏ ุชุทููุฑ ุงูุฅูุชุฑูุช ุจุชุณููุฉ ุงูููุงูุน ุงูุชู ูุฏ ูุชู ูุทุน ุงุชุตุงููุง ุนูู RuNet ููุฐ 1 ูุจุฑุงูุฑ</a></li>
<li><a href="../ar437320/index.html">2018 ูุคุดุฑ ุชุทููุฑ ุงููุฌุงู ุงูุฅุนูุงูู: ุฑููุฏ ุงูุชููุฒููู ูุฒูุงุฏุฉ ุงูุซูุฉ ูู ูุณุงุฆู ุงูุฅุนูุงู ุบูุฑ ุงูุฑุณููุฉ</a></li>
<li><a href="../ar437322/index.html">ูุชุดุงุฑู ุงูุฏููุฉ ูู BigDate</a></li>
<li><a href="../ar437324/index.html">ูุจูุฉ ุฏูููุฉ: ุฎุตุงุฆุต ุชูุณุน ุงูุฃูุนูุฉ ูุนุงุจ ุงูุฎูุงููุด ูุตุงุต ุงูุฏูุงุก</a></li>
<li><a href="../ar437326/index.html">ูููุง ูุชุนูู ุจูุณุฃูุฉ ุงูุถุฑุจ ูุงุณุชุฎุฑุงุฌ ุงูุฌุฐุฑ ุงูุชุฑุจูุนู ูุงุณุชุจุฏุงู ุงููุงุฑุฏุงุช ูุดุฑูุฉ Milander</a></li>
<li><a href="../ar437330/index.html">devleads - ุงูุญุฏูุซ ุนู ุงูุฅุฑูุงู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>