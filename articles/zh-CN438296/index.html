<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¦‹ ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ¾ â¿ OpenSceneGraphï¼šæ’ä»¶ç³»ç»Ÿ ğŸ’” ğŸ¤˜ğŸ¿ ğŸ‘³</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 åœ¨å…ˆå‰çš„è¯¾ç¨‹ä¸­ï¼Œæ›¾ç»æœ‰äººè¯´è¿‡OSGæ”¯æŒé€šè¿‡å…¶è‡ªèº«çš„æ’ä»¶ç³»ç»ŸåŠ è½½å„ç§èµ„æºï¼Œä¾‹å¦‚å…‰æ …å›¾åƒï¼Œå„ç§æ ¼å¼çš„3Dæ¨¡å‹æˆ–å­—ä½“ã€‚ OSGæ’ä»¶æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶ï¼Œå¯æ‰©å±•å¼•æ“çš„åŠŸèƒ½ï¼Œå¹¶åœ¨OSGä¸­å…·æœ‰æ ‡å‡†åŒ–çš„æ¥å£ã€‚ è¯¥æ’ä»¶å®ç°ä¸ºåŠ¨æ€å…±äº«åº“ï¼ˆWindowsä¸Šä¸ºdllï¼Œåœ¨Linuxç­‰ä¸Šä¸ºdllï¼‰ã€‚ æ’ä»¶åº“çš„åç§°ä¸ç‰¹å®š...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OpenSceneGraphï¼šæ’ä»¶ç³»ç»Ÿ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438296/"><img src="https://habrastorage.org/webt/py/ks/3w/pyks3wlvjf_zfef-sqocutbnimk.jpeg" alt="å›¾ç‰‡"><br><h1> å¼•è¨€ </h1><br> åœ¨å…ˆå‰çš„è¯¾ç¨‹ä¸­ï¼Œæ›¾ç»æœ‰äººè¯´è¿‡OSGæ”¯æŒé€šè¿‡å…¶è‡ªèº«çš„æ’ä»¶ç³»ç»ŸåŠ è½½å„ç§èµ„æºï¼Œä¾‹å¦‚å…‰æ …å›¾åƒï¼Œå„ç§æ ¼å¼çš„3Dæ¨¡å‹æˆ–å­—ä½“ã€‚  OSGæ’ä»¶æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶ï¼Œå¯æ‰©å±•å¼•æ“çš„åŠŸèƒ½ï¼Œå¹¶åœ¨OSGä¸­å…·æœ‰æ ‡å‡†åŒ–çš„æ¥å£ã€‚ è¯¥æ’ä»¶å®ç°ä¸ºåŠ¨æ€å…±äº«åº“ï¼ˆWindowsä¸Šä¸ºdllï¼Œåœ¨Linuxç­‰ä¸Šä¸ºdllï¼‰ã€‚ æ’ä»¶åº“çš„åç§°ä¸ç‰¹å®šçº¦å®šç›¸å¯¹åº” <br><br><pre><code class="plaintext hljs">osgdb_&lt; &gt;.dll</code> </pre> <br> ä¹Ÿå°±æ˜¯è¯´ï¼Œæ’ä»¶åç§°å§‹ç»ˆåŒ…å«osgdb_å‰ç¼€ã€‚ æ–‡ä»¶æ‰©å±•åå‘Šè¯‰å¼•æ“åº”ä½¿ç”¨å“ªä¸ªæ’ä»¶æ¥ä¸‹è½½å…·æœ‰è¯¥æ‰©å±•åçš„æ–‡ä»¶ã€‚ ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬ç”¨ä»£ç ç¼–å†™å‡½æ•°æ—¶ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Node&gt; model = osgDB::readNodeFile(<span class="hljs-string"><span class="hljs-string">"cessna.osg"</span></span>);</code> </pre><br> å¼•æ“ä¼šçœ‹åˆ°osgæ‰©å±•åå¹¶åŠ è½½åä¸ºosgdb_osg.dllçš„æ’ä»¶ï¼ˆå¦‚æœæ˜¯Linuxï¼Œåˆ™ä¸ºosgdb_osg.soï¼‰ã€‚ æ’ä»¶ä»£ç é€šè¿‡è¿”å›æŒ‡å‘æè¿°cessnaæ¨¡å‹çš„èŠ‚ç‚¹çš„æŒ‡é’ˆæ¥å®Œæˆæ‰€æœ‰è‚®è„çš„å·¥ä½œã€‚ åŒæ ·ï¼Œå°è¯•åŠ è½½PNGå›¾ç‰‡ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg:Image&gt; image = osgDB::readImageFile(<span class="hljs-string"><span class="hljs-string">"picture.png"</span></span>);</code> </pre><br> å°†å¯¼è‡´osgdb_png.dllæ’ä»¶åŠ è½½ï¼Œè¯¥æ’ä»¶å®ç°äº†ä¸€ç§ç®—æ³•ï¼Œè¯¥ç®—æ³•å¯ä»PNGå›¾åƒè¯»å–æ•°æ®å¹¶å°†æ­¤æ•°æ®æ”¾ç½®åœ¨osg :: Imageç±»å‹çš„å¯¹è±¡ä¸­ã€‚ <br><a name="habracut"></a><br> ä½¿ç”¨å¤–éƒ¨èµ„æºè¿›è¡Œçš„æ‰€æœ‰æ“ä½œå‡ç”±osgDBåº“çš„åŠŸèƒ½å®ç°ï¼Œé€šè¿‡è¯¥åŠŸèƒ½ï¼Œæˆ‘ä»¬å§‹ç»ˆå°†ç¤ºä¾‹ä¸ç¤ºä¾‹ä¹‹é—´çš„ç¨‹åºé“¾æ¥åœ¨ä¸€èµ·ã€‚ è¯¥åº“ä¾èµ–äºOSGæ’ä»¶ç³»ç»Ÿã€‚ è¿„ä»Šä¸ºæ­¢ï¼ŒOSGè½¯ä»¶åŒ…åŒ…æ‹¬è®¸å¤šå¯ä¸å¤§å¤šæ•°å›¾åƒæ ¼å¼ï¼Œ3Dæ¨¡å‹å’Œå®è·µä¸­ä½¿ç”¨çš„å­—ä½“ä¸€èµ·ä½¿ç”¨çš„æ’ä»¶ã€‚ æ’ä»¶æ—¢å¯ä»¥è¯»å–ç‰¹å®šæ ¼å¼çš„æ•°æ®ï¼ˆå¯¼å…¥ï¼‰ï¼Œåˆå¯ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å°†æ•°æ®å†™å…¥æ‰€éœ€æ ¼å¼çš„æ–‡ä»¶ï¼ˆå¯¼å‡ºï¼‰ã€‚ å°¤å…¶æ˜¯osgconvå®ç”¨ç¨‹åºï¼Œä½¿æ‚¨å¯ä»¥å°†æ•°æ®ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼ï¼Œä¾‹å¦‚æ’ä»¶ç³»ç»Ÿã€‚ <br><br><pre> <code class="plaintext hljs">$ osgconv cessna.osg cessna.3ds</code> </pre><br> å®ƒå¯ä»¥è½»æ¾è‡ªç„¶åœ°å°†cessna osgæ¨¡å‹è½¬æ¢ä¸º3DSæ ¼å¼ï¼Œç„¶åå¯ä»¥å°†å…¶å¯¼å…¥3Dç¼–è¾‘å™¨ï¼Œä¾‹å¦‚ï¼Œå¯¼å…¥Blenderï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œå®ƒæœ‰ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰©å±•åŠŸèƒ½ï¼Œå¯ç›´æ¥</a>ä¸ºBlender <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨osg</a> ï¼‰ <br><br><img src="https://habrastorage.org/webt/vy/dm/qm/vydmqm2a3evtdqxu2vtf_kknmrw.png"><br><br> è¿™é‡Œæœ‰ä¸€ä»½æ ‡å‡†çš„OSGæ’ä»¶çš„æ­£å¼åˆ—è¡¨ï¼Œå…¶ä¸­æè¿°äº†å®ƒä»¬çš„ç”¨é€”ï¼Œä½†æ˜¯å®ƒå¾ˆé•¿ï¼Œæˆ‘æ‡’å¾—æŠŠå®ƒå¸¦åˆ°è¿™é‡Œã€‚ åœ¨bin / ospPlugins-xyzæ–‡ä»¶å¤¹ä¸­æŸ¥çœ‹è¯¥åº“çš„å®‰è£…è·¯å¾„æ›´åŠ å®¹æ˜“ï¼Œå…¶ä¸­xï¼Œyï¼Œzæ˜¯OSGç‰ˆæœ¬å·ã€‚ ä»æ’ä»¶æ–‡ä»¶çš„åç§°å¯ä»¥å¾ˆå®¹æ˜“åœ°äº†è§£å…¶å¤„ç†çš„æ ¼å¼ã€‚ <br><br> å¦‚æœOSGç”±MinGWç¼–è¯‘å™¨ç¼–è¯‘ï¼Œåˆ™å°†é™„åŠ å‰ç¼€mingw_æ·»åŠ åˆ°æ’ä»¶çš„æ ‡å‡†åç§°ï¼Œå³è¯¥åç§°å°†å¦‚ä¸‹æ‰€ç¤º <br><br><pre> <code class="plaintext hljs">mingw_osgdb_&lt; &gt;.dll</code> </pre><br> åœ¨DEBUGé…ç½®ä¸­ç¼–è¯‘çš„æ’ä»¶ç‰ˆæœ¬åœ¨åç§°æœ«å°¾é™„åŠ äº†åç¼€dï¼Œå³æ ¼å¼ä¸º <br><br><pre> <code class="plaintext hljs">osgdb_&lt; &gt;d.dll</code> </pre><br> æˆ– <br><br><pre> <code class="plaintext hljs">mingw_osgdb_&lt; &gt;d.dll</code> </pre><br> ç»„è£…MinGWæ—¶ã€‚ <br><br><h1>  1.æ’ä»¶ä¼ªåŠ è½½å™¨ </h1><br> ä¸€äº›OSGæ’ä»¶æ‰§è¡Œæ‰€è°“çš„ä¼ªåŠ è½½å™¨çš„åŠŸèƒ½-è¿™æ„å‘³ç€å®ƒä»¬ä¸ä¸ç‰¹å®šçš„æ–‡ä»¶æ‰©å±•åç»‘å®šï¼Œä½†æ˜¯é€šè¿‡åœ¨æ–‡ä»¶åçš„æœ«å°¾æ·»åŠ åç¼€ï¼Œæ‚¨å¯ä»¥æŒ‡å®šåº”ä½¿ç”¨å“ªä¸ªæ’ä»¶æ¥ä¸‹è½½æ­¤æ–‡ä»¶ã€‚ <br><br><pre> <code class="plaintext hljs">$ osgviewer worldmap.shp.ogr</code> </pre><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç£ç›˜ä¸Šæ–‡ä»¶çš„çœŸå®åç§°æ˜¯worldmap.shp-æ­¤æ–‡ä»¶ä»¥ESRI shapefileæ ¼å¼å­˜å‚¨ä¸–ç•Œåœ°å›¾ã€‚ åç¼€.ogrå‘Šè¯‰osgDBåº“ä½¿ç”¨osgdb_ogræ’ä»¶æ¥åŠ è½½è¯¥æ–‡ä»¶ã€‚ å¦åˆ™ï¼Œå°†ä½¿ç”¨osgdb_shpæ’ä»¶ã€‚ <br><br> å¦ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯osgdb_ffmpegæ’ä»¶ã€‚  FFmpegåº“æ”¯æŒ100å¤šç§ä¸åŒçš„ç¼–è§£ç å™¨ã€‚ è¦è¯»å–å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæˆ‘ä»¬åªéœ€åœ¨åª’ä½“æ–‡ä»¶åç§°åæ·»åŠ åç¼€.ffmpegã€‚ <br><br> é™¤æ­¤ä¹‹å¤–ï¼Œä¸€äº›ä¼ªåŠ è½½å™¨è¿˜å…è®¸æˆ‘ä»¬åœ¨åç¼€ä¸­ä¼ é€’è®¸å¤šå½±å“åŠ è½½å¯¹è±¡çŠ¶æ€çš„å‚æ•°ï¼Œæˆ‘ä»¬åœ¨åŠ¨ç”»ç¤ºä¾‹ä¸­å·²ç»é‡åˆ°äº†è¿™ä¸€ç‚¹ã€‚ <br><br><pre> <code class="cpp hljs">node = osgDB::readNodeFile(<span class="hljs-string"><span class="hljs-string">"cessna.osg.0,0,90.rot"</span></span>);</code> </pre><br>  0.90è¡Œå‘osgdb_osgæ’ä»¶æŒ‡ç¤ºäº†åŠ è½½æ¨¡å‹çš„åˆå§‹æ–¹å‘çš„å‚æ•°ã€‚ ä¸€äº›ä¼ªåŠ è½½å™¨éœ€è¦å®Œå…¨ç‰¹å®šçš„å‚æ•°æ‰èƒ½å·¥ä½œã€‚ <br><br><h1>  2.ç”¨äºå¼€å‘ç¬¬ä¸‰æ–¹æ’ä»¶çš„API </h1><br> åœ¨é˜…è¯»å®Œæ‰€æœ‰å†…å®¹åï¼Œå¦‚æœæ‚¨æœ‰æƒ³æ³•ä¸ºOSGç¼–å†™è‡ªå·±çš„æ’ä»¶å¯èƒ½å¹¶ä¸å›°éš¾ï¼Œè¿™å°†ä½¿æ‚¨èƒ½å¤Ÿå¯¼å…¥éæ ‡å‡†æ ¼å¼çš„3Dæ¨¡å‹æˆ–å›¾åƒï¼Œè¿™æ˜¯å®Œå…¨åˆä¹é€»è¾‘çš„ã€‚ è¿™æ˜¯ä¸€ä¸ªçœŸå®çš„æƒ³æ³•ï¼ æ’ä»¶æœºåˆ¶ä»…ç”¨äºæ‰©å±•å¼•æ“çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€æ›´æ”¹OSGæœ¬èº«ã€‚ ä¸ºäº†ç†è§£ç¼–å†™æ’ä»¶çš„åŸºæœ¬åŸç†ï¼Œè®©æˆ‘ä»¬å°è¯•å®ç°ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ã€‚ <br><br> è¯¥æ’ä»¶çš„å¼€å‘æ˜¯ä¸ºäº†æ‰©å±•OSGæä¾›çš„è™šæ‹Ÿè¯»å–/å†™å…¥æ¥å£ã€‚ æ­¤åŠŸèƒ½ç”±osgDB :: ReaderWriterè™šæ‹Ÿç±»æä¾›ã€‚ æ­¤ç±»æä¾›äº†è®¸å¤šç”±æ’ä»¶å¼€å‘äººå‘˜é‡æ–°å®šä¹‰çš„è™šæ‹Ÿæ–¹æ³•ã€‚ <br><table><thead><tr><th> æ–¹æ³• </th><th> å†…å®¹æè¿° </th></tr></thead><tbody><tr><td>  supportExtensionsï¼ˆï¼‰ </td><td> å®ƒæ¥å—ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼šæ–‡ä»¶æ‰©å±•åå’Œæè¿°ã€‚ è¯¥æ–¹æ³•æ€»æ˜¯åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨ã€‚ </td></tr><tr><td>  acceptsExtensionï¼ˆï¼‰ </td><td> å¦‚æœæ’ä»¶æ”¯æŒä½œä¸ºå‚æ•°ä¼ é€’çš„æ‰©å±•åï¼Œåˆ™è¿”å›true </td></tr><tr><td>  fileExistsï¼ˆï¼‰ </td><td> å…è®¸æ‚¨ç¡®å®šç£ç›˜ä¸Šæ˜¯å¦å­˜åœ¨ç»™å®šæ–‡ä»¶ï¼ˆè·¯å¾„ä½œä¸ºå‚æ•°ä¼ é€’ï¼‰ï¼ˆå¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›trueï¼‰ </td></tr><tr><td>  readNodeï¼ˆï¼‰ </td><td> æ¥å—æ–‡ä»¶åå’Œé€‰é¡¹ä½œä¸ºosgDB :: Optionå¯¹è±¡ã€‚ ä»æ–‡ä»¶è¯»å–æ•°æ®çš„åŠŸèƒ½ç”±å¼€å‘äººå‘˜å®ç° </td></tr><tr><td>  writeNodeï¼ˆï¼‰ </td><td> æ¥å—èŠ‚ç‚¹åç§°ï¼Œæ‰€éœ€çš„æ–‡ä»¶åå’Œé€‰é¡¹ã€‚ å°†æ•°æ®å†™å…¥ç£ç›˜çš„åŠŸèƒ½ç”±å¼€å‘äººå‘˜å®ç° </td></tr><tr><td>  readImageï¼ˆï¼‰ </td><td> è¯»å–ç£ç›˜ä½å›¾æ•°æ® </td></tr><tr><td>  writeImageï¼ˆï¼‰ </td><td> å°†ä½å›¾å†™å…¥ç£ç›˜ </td></tr></tbody></table><br>  readNodeï¼ˆï¼‰æ–¹æ³•çš„å®ç°å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æè¿° <br><br><pre> <code class="cpp hljs">osgDB::ReaderWriter::<span class="hljs-function"><span class="hljs-function">ReadResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osgDB::Options *options)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         bool recognizableExtension = ...; bool fileExists = ...; if (!recognizableExtension) return ReadResult::FILE_NOT_HANDLED; if (!fileExists) return ReadResult::FILE_NOT_FOUND; //          osg::Node *root = ...; //       -     . //    -      bool errorInParsing = ...; if (errorInParsing) return ReadResult::ERROR_IN_READING_FILE; return root; }</span></span></code> </pre><br> ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œè¯¥æ–¹æ³•è¿”å›çš„ç±»å‹ä¸æ˜¯osgDB :: ReaderWriter :: ReadResultï¼Œè€Œæ˜¯æŒ‡å‘åœºæ™¯å›¾èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚ æ­¤ç±»å‹æ˜¯è¯»å–ç»“æœå¯¹è±¡ï¼Œå¯ä»¥ç”¨ä½œèŠ‚ç‚¹å®¹å™¨ï¼Œå›¾åƒï¼ŒçŠ¶æ€æšä¸¾å™¨ï¼ˆä¾‹å¦‚FILE_NOT_FOUNDï¼‰ï¼Œå¦ä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ï¼Œç”šè‡³å¯ä»¥ç”¨ä½œé”™è¯¯æ¶ˆæ¯å­—ç¬¦ä¸²ã€‚ å®ƒå…·æœ‰è®¸å¤šç”¨äºå®ç°æ‰€æè¿°åŠŸèƒ½çš„éšå¼æ„é€ å‡½æ•°ã€‚ <br><br> å¦ä¸€ä¸ªæœ‰ç”¨çš„ç±»æ˜¯osgDB :: Optionsã€‚ å®ƒå¯ä»¥å…è®¸æ‚¨ä½¿ç”¨setOptionStringï¼ˆï¼‰å’ŒgetOptionStringï¼ˆï¼‰æ–¹æ³•è®¾ç½®æˆ–è·å–åŠ è½½é€‰é¡¹çš„å­—ç¬¦ä¸²ã€‚ ä¹Ÿå¯ä»¥å°†æ­¤å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ­¤ç±»çš„æ„é€ æ–¹æ³•ã€‚ <br><br> å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡è®¾ç½®åŠ è½½å¯¹è±¡æ—¶ä¼ é€’çš„å‚æ•°å­—ç¬¦ä¸²ä¸­çš„è®¾ç½®æ¥æ§åˆ¶æ’ä»¶çš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    osg::Node* node1 = osgDB::readNodeFile("cow.osg"); //     string osg::Node* node2 = osgDB::readNodeFile("cow.osg", new osgDB::Options(string));</span></span></code> </pre><br><h1>  3. OSGæ’ä»¶ä¸­çš„æ•°æ®æµå¤„ç† </h1><br> åŸºç±»osgDB :: ReaderWriteråŒ…æ‹¬ä¸€ç»„å¤„ç†æ ‡å‡†C ++åº“æä¾›çš„è¾“å…¥/è¾“å‡ºæµçš„æ•°æ®çš„æ–¹æ³•ã€‚ è¿™äº›è¯»/å†™æ–¹æ³•ä¸ä¸Šé¢è®¨è®ºçš„æ–¹æ³•ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œå®ƒä»¬æ¥å—æ–‡ä»¶std :: istreamå’Œè¾“å…¥æµæˆ–std :: ostreamå’Œè¾“å‡ºæµè€Œä¸æ˜¯æ–‡ä»¶åã€‚ ä½¿ç”¨æ–‡ä»¶I / Oæµæ€»æ˜¯æ¯”ä½¿ç”¨æ–‡ä»¶åæ›´å¥½ã€‚ è¦æ‰§è¡Œæ–‡ä»¶è¯»å–æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç•Œé¢è®¾è®¡ï¼š <br><br><pre> <code class="cpp hljs">osgDB::ReaderWriter::<span class="hljs-function"><span class="hljs-function">ReadResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osgDB::Options *options)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ ... osgDB::<span class="hljs-function"><span class="hljs-function">ifstream </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file.c_str(), </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::ios::binary)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!stream) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ReadResult::ERROR_IN_READING_FILE; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> readNode(stream, options); } ... osgDB::ReaderWriter::<span class="hljs-function"><span class="hljs-function">ReadResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::istream &amp;stream, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osgDB::Options *options)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         osg::Node *root = ...; return root; }</span></span></code> </pre><br> å®ç°æ’ä»¶åï¼Œæˆ‘ä»¬åªéœ€æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œå³å¯ä½¿ç”¨æ ‡å‡†å‡½æ•°osgDB :: readNodeFileï¼ˆï¼‰å’ŒosgDB :: readImageFileï¼ˆï¼‰åŠ è½½æ¨¡å‹å’Œå›¾åƒã€‚  OSGå°†æ‰¾åˆ°å¹¶ä¸‹è½½æˆ‘ä»¬ç¼–å†™çš„æ’ä»¶ã€‚ <br><br><h1>  4.æˆ‘ä»¬ç¼–å†™è‡ªå·±çš„æ’ä»¶ </h1><br><br> å› æ­¤ï¼Œæ²¡æœ‰äººä¼šæ‰“æ‰°æˆ‘ä»¬æƒ³å‡ºæˆ‘ä»¬è‡ªå·±çš„æ ¼å¼æ¥å°†æ•°æ®å­˜å‚¨åœ¨ä¸‰ç»´å‡ ä½•ä¸­ï¼Œè€Œæˆ‘ä»¬ä¼šæƒ³å‡ºå®ƒ <br><br>  <strong>å¡é…°èƒº</strong> <br><br><pre> <code class="plaintext hljs">vertex: 1.0 1.0 0.0 vertex: 1.0 -1.0 0.0 vertex: -1.0 -1.0 0.0 vertex: -1.0 1.0 0.0 vertex: 0.0 0.0 2.0 face: 0 1 2 3 face: 0 3 4 face: 1 0 4 face: 2 1 4 face: 3 2 4</code> </pre><br> åœ¨æ–‡ä»¶çš„å¼€å¤´ï¼Œæ˜¯å¸¦æœ‰å…¶åæ ‡çš„é¡¶ç‚¹åˆ—è¡¨ã€‚ é¡¶ç‚¹ç´¢å¼•ä»é›¶å¼€å§‹é¡ºåºæ’åˆ—ã€‚ é¡¶ç‚¹åˆ—è¡¨ä¹‹åæ˜¯â€‹â€‹é¢åˆ—è¡¨ã€‚ æ¯ä¸ªé¢ç”±å½¢æˆé¡¶ç‚¹çš„ä¸€ç³»åˆ—é¡¶ç‚¹ç´¢å¼•å®šä¹‰ã€‚ æ˜¾ç„¶æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚ ä»»åŠ¡æ˜¯ä»ç£ç›˜è¯»å–æ­¤æ–‡ä»¶å¹¶åœ¨å…¶åŸºç¡€ä¸Šå½¢æˆä¸‰ç»´å‡ ä½•ã€‚ <br><br><h1>  5.æ’ä»¶é¡¹ç›®è®¾ç½®ï¼šæ„å»ºè„šæœ¬åŠŸèƒ½ </h1><br> å¦‚æœåœ¨æ„å»ºåº”ç”¨ç¨‹åºä¹‹å‰ï¼Œç°åœ¨å¿…é¡»ç¼–å†™ä¸€ä¸ªåŠ¨æ€åº“ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¼–å†™ä¸€ä¸ªåº“ï¼Œè€Œæ˜¯ç¼–å†™ä¸€ä¸ªæ»¡è¶³æŸäº›è¦æ±‚çš„OSGæ’ä»¶ã€‚ æˆ‘ä»¬å°†é€šè¿‡å¦‚ä¸‹æ‰€ç¤ºçš„é¡¹ç›®æ„å»ºè„šæœ¬å¼€å§‹æ»¡è¶³è¿™äº›è¦æ±‚ <br><br>  <strong>plugin.pro</strong> <br><br><pre> <code class="cmake hljs">TEMPLATE = lib CONFIG += plugin CONFIG += no_plugin_name_prefix <span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span> = osgdb_pmd win32-g++: <span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span> = $$join(<span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span>,,mingw_,) win32 { OSG_LIB_DIRECTORY = $$(OSG_BIN_PATH) OSG_INCLUDE_DIRECTORY = $$(OSG_INCLUDE_PATH) DESTDIR = $$(OSG_PLUGINS_PATH) CONFIG(debug, debug|release) { <span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span> = $$join(<span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span>,,,d) LIBS += -L$$OSG_LIB_DIRECTORY -losgd LIBS += -L$$OSG_LIB_DIRECTORY -losgViewerd LIBS += -L$$OSG_LIB_DIRECTORY -losgDBd LIBS += -L$$OSG_LIB_DIRECTORY -lOpenThreadsd LIBS += -L$$OSG_LIB_DIRECTORY -losgUtild } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { LIBS += -L$$OSG_LIB_DIRECTORY -losg LIBS += -L$$OSG_LIB_DIRECTORY -losgViewer LIBS += -L$$OSG_LIB_DIRECTORY -losgDB LIBS += -L$$OSG_LIB_DIRECTORY -lOpenThreads LIBS += -L$$OSG_LIB_DIRECTORY -losgUtil } INCLUDEPATH += $$OSG_INCLUDE_DIRECTORY } unix { DESTDIR = /usr/lib/osgPlugins-<span class="hljs-number"><span class="hljs-number">3.7</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> CONFIG(debug, debug|release) { <span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span> = $$join(<span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span>,,,d) LIBS += -losgd LIBS += -losgViewerd LIBS += -losgDBd LIBS += -lOpenThreadsd LIBS += -losgUtild } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { LIBS += -losg LIBS += -losgViewer LIBS += -losgDB LIBS += -lOpenThreads LIBS += -losgUtil } } INCLUDEPATH += ./<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> HEADERS += $$files(./<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>/*.h) SOURCES += $$files(./src/*.cpp)</code> </pre><br> æˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°åˆ†æå„ä¸ªç»†å¾®å·®åˆ« <br><br><pre> <code class="cmake hljs">TEMPLATE = lib</code> </pre><br> æ„å‘³ç€æˆ‘ä»¬å°†å»ºç«‹å›¾ä¹¦é¦†ã€‚ ä¸ºäº†é˜²æ­¢åœ¨* nixç³»ç»Ÿä¸­è§£å†³äº†åº“ç‰ˆæœ¬å†²çªçš„é—®é¢˜çš„æƒ…å†µä¸‹ç”Ÿæˆç¬¦å·é“¾æ¥ï¼Œæˆ‘ä»¬å‘æ„å»ºç³»ç»ŸæŒ‡ç¤ºè¯¥åº“å°†æ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œå³å®ƒå°†â€œåŠ¨æ€â€åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ <br><br><pre> <code class="cmake hljs">CONFIG += plugin</code> </pre><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ’é™¤libå‰ç¼€çš„ç”Ÿæˆï¼Œè¯¥libå‰ç¼€åœ¨ä½¿ç”¨gccç³»åˆ—ç¼–è¯‘å™¨æ—¶æ·»åŠ ï¼Œå¹¶ä¸”åœ¨åŠ è½½åº“æ—¶åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸­è€ƒè™‘ <br><br><pre> <code class="cmake hljs">CONFIG += no_plugin_name_prefix</code> </pre><br> è®¾ç½®åº“æ–‡ä»¶çš„åç§° <br><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span> = osgdb_pmd</code> </pre><br> å…¶ä¸­ï¼Œpmdæ˜¯æˆ‘ä»¬å‘æ˜çš„3Dæ¨¡å‹æ ¼å¼çš„æ–‡ä»¶æ‰©å±•åã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å‡ºï¼Œåœ¨MinGWç»„è£…çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»åœ¨åç§°ä¸­æ·»åŠ å‰ç¼€mingw_ <br><br><pre> <code class="cmake hljs">win32-g++: <span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span> = $$join(<span class="hljs-keyword"><span class="hljs-keyword">TARGET</span></span>,,mingw_,)</code> </pre><br> æŒ‡å®šåº“æ„å»ºè·¯å¾„ï¼šå¯¹äºWindows <br><br><pre> <code class="cmake hljs">DESTDIR = $$(OSG_PLUGINS_PATH)</code> </pre><br> å¯¹äºLinux <br><br><pre> <code class="cmake hljs">DESTDIR = /usr/lib/osgPlugins-<span class="hljs-number"><span class="hljs-number">3.7</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br> å¯¹äºLinuxï¼Œä½¿ç”¨è¿™æ ·çš„è·¯å¾„æŒ‡ç¤ºï¼ˆæ— ç–‘æ˜¯æ‹æ–ï¼Œä½†æˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°å…¶ä»–è§£å†³æ–¹æ¡ˆï¼‰ï¼Œæˆ‘ä»¬æˆäºˆæ™®é€šç”¨æˆ·ä½¿ç”¨OSGæ’ä»¶å†™å…¥æŒ‡å®šæ–‡ä»¶å¤¹çš„æƒåˆ©ã€‚ <br><br><pre> <code class="plaintext hljs"># chmod 666 /usr/lib/osgPlugins-3.7.0</code> </pre><br> æ‰€æœ‰å…¶ä»–æ„å»ºè®¾ç½®ä¸ä¹‹å‰çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºç»„è£…ä¸­ä½¿ç”¨çš„è®¾ç½®ç±»ä¼¼ã€‚ <br><br><h1>  6.æ’ä»¶é¡¹ç›®è®¾ç½®ï¼šè°ƒè¯•æ¨¡å¼åŠŸèƒ½ </h1><br> ç”±äºè¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŠ¨æ€åº“ï¼Œå› æ­¤å¿…é¡»æœ‰ä¸€ä¸ªç¨‹åºåœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ è½½è¯¥åº“ã€‚ å®ƒå¯ä»¥æ˜¯ä½¿ç”¨OSGçš„ä»»ä½•åº”ç”¨ç¨‹åºï¼Œåœ¨è¯¥åº”ç”¨ç¨‹åºä¸­å°†è°ƒç”¨è¯¥å‡½æ•° <br><br><pre> <code class="cpp hljs">node = osdDB::readNodeFile(<span class="hljs-string"><span class="hljs-string">"piramide.pmd"</span></span>);</code> </pre><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„æ’ä»¶å°†åŠ è½½ã€‚ ä¸ºäº†ä¸è‡ªå·±ç¼–å†™æ­¤ç±»ç¨‹åºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç°æˆçš„è§£å†³æ–¹æ¡ˆ-æ ‡å‡†osgvieweræŸ¥çœ‹å™¨ï¼Œè¯¥è§£å†³æ–¹æ¡ˆåŒ…å«åœ¨å¼•æ“çš„äº¤ä»˜åŒ…è£…ä¸­ã€‚ å¦‚æœåœ¨æ§åˆ¶å°ä¸­æ‰§è¡Œ <br><br><pre> <code class="plaintext hljs">$ osgviewer piramide.pmd</code> </pre><br> ç„¶åå®ƒå°†è§¦å‘æ’ä»¶ã€‚ åœ¨é¡¹ç›®å¯åŠ¨è®¾ç½®ä¸­ï¼Œå°†osgviewerdçš„è·¯å¾„æŒ‡å®šä¸ºå·¥ä½œç›®å½•ï¼ŒæŒ‡å®špiramide.pmdæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œå¹¶åœ¨osgviewerå‘½ä»¤è¡Œé€‰é¡¹ä¸­æŒ‡å®šç›¸åŒçš„æ–‡ä»¶ <br><br><img src="https://habrastorage.org/webt/v8/9y/xa/v89yxafvygysowtw7aeihf9mgcs.png"><br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œæ’ä»¶å¹¶ç›´æ¥ä»QtCreator IDEå¯¹å…¶è¿›è¡Œè°ƒè¯•ã€‚ <br><br><h1>  6.æˆ‘ä»¬å®ç°æ’ä»¶æ¡†æ¶ </h1><br> è¿™ä¸ªç¤ºä¾‹åœ¨æŸç§ç¨‹åº¦ä¸Šæ¦‚æ‹¬äº†æˆ‘ä»¬ä»å…ˆå‰çš„è¯¾ç¨‹ä¸­å·²ç»è·å¾—çš„æœ‰å…³OSGçš„çŸ¥è¯†ã€‚ ç¼–å†™æ’ä»¶æ—¶ï¼Œæˆ‘ä»¬å¿…é¡» <br><br><ol><li> é€‰æ‹©æ•°æ®ç»“æ„ä»¥å­˜å‚¨ä»æ¨¡å‹æ–‡ä»¶è¯»å–çš„æ¨¡å‹å‡ ä½•ä¿¡æ¯ <br></li><li> è¯»å–å¹¶è§£æï¼ˆè§£æï¼‰æ¨¡å‹æ•°æ®æ–‡ä»¶ <br></li><li> æ ¹æ®ä»æ–‡ä»¶ä¸­è¯»å–çš„æ•°æ®æ­£ç¡®é…ç½®osg :: Drawableå‡ ä½•å¯¹è±¡ <br></li><li> ä¸ºåŠ è½½çš„æ¨¡å‹æ„å»ºåœºæ™¯å­å›¾ <br></li></ol><br> å› æ­¤ï¼ŒæŒ‰ç…§ä¼ ç»Ÿï¼Œæˆ‘å°†æä¾›æ’ä»¶çš„å®Œæ•´æºä»£ç  <br><br><div class="spoiler">  <b class="spoiler_title">osgdb_pmdæ’ä»¶</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/Geometry&gt; #include &lt;osg/Geode&gt; #include &lt;osgDB/FileNameUtils&gt; #include &lt;osgDB/FileUtils&gt; #include &lt;osgDB/Registry&gt; #include &lt;osgUtil/SmoothingVisitor&gt; //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ struct face_t { std::vector&lt;unsigned int&gt; indices; }; //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ struct pmd_mesh_t { osg::ref_ptr&lt;osg::Vec3Array&gt; vertices; osg::ref_ptr&lt;osg::Vec3Array&gt; normals; std::vector&lt;face_t&gt; faces; pmd_mesh_t() : vertices(new osg::Vec3Array) , normals(new osg::Vec3Array) { } osg::Vec3 calcFaceNormal(const face_t &amp;face) const { osg::Vec3 v0 = (*vertices)[face.indices[0]]; osg::Vec3 v1 = (*vertices)[face.indices[1]]; osg::Vec3 v2 = (*vertices)[face.indices[2]]; osg::Vec3 n = (v1 - v0) ^ (v2 - v0); return n * (1 / n.length()); } }; //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ class ReaderWriterPMD : public osgDB::ReaderWriter { public: ReaderWriterPMD(); virtual ReadResult readNode(const std::string &amp;filename, const osgDB::Options *options) const; virtual ReadResult readNode(std::istream &amp;stream, const osgDB::Options *options) const; private: pmd_mesh_t parsePMD(std::istream &amp;stream) const; std::vector&lt;std::string&gt; parseLine(const std::string &amp;line) const; }; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ ReaderWriterPMD::ReaderWriterPMD() { supportsExtension("pmd", "PMD model file"); } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ osgDB::ReaderWriter::ReadResult ReaderWriterPMD::readNode( const std::string &amp;filename, const osgDB::Options *options) const { std::string ext = osgDB::getLowerCaseFileExtension(filename); if (!acceptsExtension(ext)) return ReadResult::FILE_NOT_HANDLED; std::string fileName = osgDB::findDataFile(filename, options); if (fileName.empty()) return ReadResult::FILE_NOT_FOUND; std::ifstream stream(fileName.c_str(), std::ios::in); if (!stream) return ReadResult::ERROR_IN_READING_FILE; return readNode(stream, options); } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ osgDB::ReaderWriter::ReadResult ReaderWriterPMD::readNode( std::istream &amp;stream, const osgDB::Options *options) const { (void) options; pmd_mesh_t mesh = parsePMD(stream); osg::ref_ptr&lt;osg::Geometry&gt; geom = new osg::Geometry; geom-&gt;setVertexArray(mesh.vertices.get()); for (size_t i = 0; i &lt; mesh.faces.size(); ++i) { osg::ref_ptr&lt;osg::DrawElementsUInt&gt; polygon = new osg::DrawElementsUInt(osg::PrimitiveSet::POLYGON, 0); for (size_t j = 0; j &lt; mesh.faces[i].indices.size(); ++j) polygon-&gt;push_back(mesh.faces[i].indices[j]); geom-&gt;addPrimitiveSet(polygon.get()); } geom-&gt;setNormalArray(mesh.normals.get()); geom-&gt;setNormalBinding(osg::Geometry::BIND_PER_PRIMITIVE_SET); osg::ref_ptr&lt;osg::Geode&gt; geode = new osg::Geode; geode-&gt;addDrawable(geom.get()); return geode.release(); } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ pmd_mesh_t ReaderWriterPMD::parsePMD(std::istream &amp;stream) const { pmd_mesh_t mesh; while (!stream.eof()) { std::string line; std::getline(stream, line); std::vector&lt;std::string&gt; tokens = parseLine(line); if (tokens[0] == "vertex") { osg::Vec3 point; std::istringstream iss(tokens[1]); iss &gt;&gt; point.x() &gt;&gt; point.y() &gt;&gt; point.z(); mesh.vertices-&gt;push_back(point); } if (tokens[0] == "face") { unsigned int idx = 0; std::istringstream iss(tokens[1]); face_t face; while (!iss.eof()) { iss &gt;&gt; idx; face.indices.push_back(idx); } mesh.faces.push_back(face); mesh.normals-&gt;push_back(mesh.calcFaceNormal(face)); } } return mesh; } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ std::string delete_symbol(const std::string &amp;str, char symbol) { std::string tmp = str; tmp.erase(std::remove(tmp.begin(), tmp.end(), symbol), tmp.end()); return tmp; } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ std::vector&lt;std::string&gt; ReaderWriterPMD::parseLine(const std::string &amp;line) const { std::vector&lt;std::string&gt; tokens; std::string tmp = delete_symbol(line, '\r'); size_t pos = 0; std::string token; while ( (pos = tmp.find(':')) != std::string::npos ) { token = tmp.substr(0, pos); tmp.erase(0, pos + 1); if (!token.empty()) tokens.push_back(token); } tokens.push_back(tmp); return tokens; } REGISTER_OSGPLUGIN( pmd, ReaderWriterPMD )</span></span></span></span></code> </pre><br></div></div><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç…§é¡¾ä¸€ä¸‹ç”¨äºå­˜å‚¨å‡ ä½•æ•°æ®çš„ç»“æ„ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">face_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; indices; };</code> </pre><br>  -æè¿°ç”±å±äºè¯¥é¢çš„é¡¶ç‚¹çš„ç´¢å¼•åˆ—è¡¨å®šä¹‰çš„é¢ã€‚ æ•´ä¸ªæ¨¡å‹å°†é€šè¿‡è¿™ç§ç»“æ„è¿›è¡Œæè¿° <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pmd_mesh_t</span></span></span><span class="hljs-class"> {</span></span> osg::ref_ptr&lt;osg::Vec3Array&gt; vertices; osg::ref_ptr&lt;osg::Vec3Array&gt; normals; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">face_t</span></span>&gt; faces; <span class="hljs-keyword"><span class="hljs-keyword">pmd_mesh_t</span></span>() : vertices(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Vec3Array) , normals(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Vec3Array) { } osg::<span class="hljs-function"><span class="hljs-function">Vec3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcFaceNormal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">face_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;face)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ osg::Vec3 v0 = (*vertices)[face.indices[<span class="hljs-number"><span class="hljs-number">0</span></span>]]; osg::Vec3 v1 = (*vertices)[face.indices[<span class="hljs-number"><span class="hljs-number">1</span></span>]]; osg::Vec3 v2 = (*vertices)[face.indices[<span class="hljs-number"><span class="hljs-number">2</span></span>]]; osg::Vec3 n = (v1 - v0) ^ (v2 - v0); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n * (<span class="hljs-number"><span class="hljs-number">1</span></span> / n.length()); } };</code> </pre><br> è¯¥ç»“æ„ç”±ç”¨äºå­˜å‚¨æ•°æ®çš„æˆå‘˜å˜é‡ç»„æˆï¼šé¡¶ç‚¹-ç”¨äºå­˜å‚¨å‡ ä½•å¯¹è±¡çš„é¡¶ç‚¹æ•°ç»„ï¼› æ³•çº¿-å¯¹è±¡è¡¨é¢æ³•çº¿çš„æ•°ç»„ï¼› é¢å­”-å¯¹è±¡çš„é¢å­”åˆ—è¡¨ã€‚ ç»“æ„æ„é€ å‡½æ•°ç«‹å³åˆå§‹åŒ–æ™ºèƒ½æŒ‡é’ˆ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">pmd_mesh_t</span></span>() : vertices(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Vec3Array) , normals(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Vec3Array) { }</code> </pre><br> å¦å¤–ï¼Œè¯¥ç»“æ„åŒ…å«ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸æ‚¨è®¡ç®—ä½œä¸ºcalcFaceNormalï¼ˆï¼‰çš„æ³•çº¿å‘é‡çš„å‚æ•°ï¼Œè¯¥å‚æ•°é‡‡ç”¨æè¿°é¢éƒ¨çš„ç»“æ„ã€‚ æˆ‘ä»¬ä¸ä¼šè¯¦ç»†ä»‹ç»æ­¤æ–¹æ³•çš„å®ç°ï¼Œç¨åå°†å¯¹å…¶è¿›è¡Œåˆ†æã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å†³å®šäº†è¦åœ¨å…¶ä¸­å­˜å‚¨å‡ ä½•æ•°æ®çš„ç»“æ„ã€‚ ç°åœ¨è®©æˆ‘ä»¬ç¼–å†™æ’ä»¶çš„æ¡†æ¶ï¼Œå³ï¼Œæˆ‘ä»¬å®ç°osgDB :: ReaderWriterç»§æ‰¿è€…ç±» <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReaderWriterPMD</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> osgDB::ReaderWriter { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ReaderWriterPMD(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> ReadResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osgDB::Options *options)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> ReadResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::istream &amp;stream, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osgDB::Options *options)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pmd_mesh_t</span></span> parsePMD(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::istream &amp;stream) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; parseLine(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;line) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>; };</code> </pre><br> æ­£å¦‚åœ¨å¼€å‘æ’ä»¶çš„APIçš„æè¿°ä¸­æ‰€å»ºè®®çš„é‚£æ ·ï¼Œåœ¨æ­¤ç±»ä¸­ï¼Œæˆ‘ä»¬é‡æ–°å®šä¹‰äº†ä»æ–‡ä»¶è¯»å–æ•°æ®å¹¶å°†å…¶è½¬æ¢ä¸ºåœºæ™¯çš„å­å›¾çš„æ–¹æ³•ã€‚  readNodeï¼ˆï¼‰æ–¹æ³•æœ‰ä¸¤ä¸ªé‡è½½-ä¸€ä¸ªé‡è½½æ–‡ä»¶åä½œä¸ºè¾“å…¥ï¼Œå¦ä¸€ä¸ªé‡è½½æ ‡å‡†è¾“å…¥æµã€‚ ç±»æ„é€ å‡½æ•°å®šä¹‰æ’ä»¶æ”¯æŒçš„æ–‡ä»¶æ‰©å±•å <br><br><pre> <code class="cpp hljs">ReaderWriterPMD::ReaderWriterPMD() { supportsExtension(<span class="hljs-string"><span class="hljs-string">"pmd"</span></span>, <span class="hljs-string"><span class="hljs-string">"PMD model file"</span></span>); }</code> </pre><br>  readNodeï¼ˆï¼‰æ–¹æ³•çš„ç¬¬ä¸€ä¸ªé‡è½½åˆ†ææ–‡ä»¶åå’Œæ–‡ä»¶è·¯å¾„çš„æ­£ç¡®æ€§ï¼Œå°†æ ‡å‡†è¾“å…¥æµä¸æ–‡ä»¶ç›¸å…³è”ï¼Œå¹¶è°ƒç”¨ç¬¬äºŒä¸ªé‡è½½ï¼Œå®Œæˆä¸»è¦å·¥ä½œ <br><br><pre> <code class="cpp hljs">osgDB::ReaderWriter::ReadResult ReaderWriterPMD::readNode( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;filename, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> osgDB::Options *options) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-comment"><span class="hljs-comment">//       std::string ext = osgDB::getLowerCaseFileExtension(filename); // ,      if (!acceptsExtension(ext)) return ReadResult::FILE_NOT_HANDLED; // ,       std::string fileName = osgDB::findDataFile(filename, options); if (fileName.empty()) return ReadResult::FILE_NOT_FOUND; //      std::ifstream stream(fileName.c_str(), std::ios::in); if (!stream) return ReadResult::ERROR_IN_READING_FILE; //      readNode() return readNode(stream, options); }</span></span></code> </pre><br> åœ¨ç¬¬äºŒä¸ªé‡è½½ä¸­ï¼Œæˆ‘ä»¬ä¸ºOSGå®ç°äº†å¯¹è±¡ç”Ÿæˆç®—æ³• <br><br><pre> <code class="cpp hljs">osgDB::ReaderWriter::ReadResult ReaderWriterPMD::readNode( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::istream &amp;stream, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> osgDB::Options *options) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) options; <span class="hljs-comment"><span class="hljs-comment">//   *.pmd       pmd_mesh_t mesh = parsePMD(stream); //    osg::ref_ptr&lt;osg::Geometry&gt; geom = new osg::Geometry; //    geom-&gt;setVertexArray(mesh.vertices.get()); //    for (size_t i = 0; i &lt; mesh.faces.size(); ++i) { //    GL_POLYGON      (  - 0) osg::ref_ptr&lt;osg::DrawElementsUInt&gt; polygon = new osg::DrawElementsUInt(osg::PrimitiveSet::POLYGON, 0); //       for (size_t j = 0; j &lt; mesh.faces[i].indices.size(); ++j) polygon-&gt;push_back(mesh.faces[i].indices[j]); //     geom-&gt;addPrimitiveSet(polygon.get()); } //    geom-&gt;setNormalArray(mesh.normals.get()); //  OpenGL,       geom-&gt;setNormalBinding(osg::Geometry::BIND_PER_PRIMITIVE_SET); //             osg::ref_ptr&lt;osg::Geode&gt; geode = new osg::Geode; geode-&gt;addDrawable(geom.get()); //     return geode.release(); }</span></span></code> </pre><br> åœ¨main.cppæ–‡ä»¶çš„æœ«å°¾ï¼Œè°ƒç”¨REGISTER_OSGPLUGINï¼ˆï¼‰å®ã€‚ <br><br><pre> <code class="cpp hljs">REGISTER_OSGPLUGIN( pmd, ReaderWriterPMD )</code> </pre><br> è¯¥å®ç”Ÿæˆé™„åŠ ä»£ç ï¼Œè¯¥ä»£ç å…è®¸OSGä»¥osgDBåº“çš„å½¢å¼æ„é€ ç±»å‹ä¸ºReaderWriterPMDçš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶æ–¹æ³•ä»¥åŠ è½½ç±»å‹ä¸ºpmdçš„æ–‡ä»¶ã€‚ è¿™æ ·ï¼Œæ’ä»¶æ¡†æ¶å°±å‡†å¤‡å¥½äº†ï¼Œäº‹æƒ…ä»ç„¶ä¸å¤§äº†-å®ç°åŠ è½½å’Œè§£æpmdæ–‡ä»¶ã€‚ <br><br><h1>  7. Parsim 3Dæ¨¡å‹æ–‡ä»¶ </h1><br> ç°åœ¨ï¼Œè¯¥æ’ä»¶çš„æ‰€æœ‰åŠŸèƒ½éƒ½å–å†³äºparsePMDï¼ˆï¼‰æ–¹æ³•çš„å®ç° <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">pmd_mesh_t</span></span> ReaderWriterPMD::parsePMD(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::istream &amp;stream) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">pmd_mesh_t</span></span> mesh; <span class="hljs-comment"><span class="hljs-comment">//    while (!stream.eof()) { //      std::string line; std::getline(stream, line); //     -     std::vector&lt;std::string&gt; tokens = parseLine(line); //    -  if (tokens[0] == "vertex") { //       osg::Vec3 point; std::istringstream iss(tokens[1]); iss &gt;&gt; point.x() &gt;&gt; point.y() &gt;&gt; point.z(); //      mesh.vertices-&gt;push_back(point); } //    -  if (tokens[0] == "face") { //         unsigned int idx = 0; std::istringstream iss(tokens[1]); face_t face; while (!iss.eof()) { iss &gt;&gt; idx; face.indices.push_back(idx); } //      mesh.faces.push_back(face); //     mesh.normals-&gt;push_back(mesh.calcFaceNormal(face)); } } return mesh; }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ParseLineï¼ˆï¼‰æ–¹æ³•è§£æPmdæ–‡ä»¶çš„è¡Œ </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; ReaderWriterPMD::parseLine(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;line) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; tokens; <span class="hljs-comment"><span class="hljs-comment">//   ,        ( Windows) std::string tmp = delete_symbol(line, '\r'); size_t pos = 0; std::string token; //      ,     : //      while ( (pos = tmp.find(':')) != std::string::npos ) { //     (vertex  face   ) token = tmp.substr(0, pos); //         tmp.erase(0, pos + 1); if (!token.empty()) tokens.push_back(token); } //        tokens.push_back(tmp); return tokens; }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤æ–¹æ³•ä¼šå°†å­—ç¬¦ä¸²â€œ vertexï¼š1.0 -1.0 0.0â€è½¬æ¢ä¸ºâ€œ vertexâ€å’Œâ€œ 1.0 -1.0 0.0â€ä¸¤è¡Œçš„åˆ—è¡¨ã€‚</font><font style="vertical-align: inherit;">åœ¨ç¬¬ä¸€è¡Œä¸­ï¼Œæˆ‘ä»¬ç¡®å®šæ•°æ®ç±»å‹-é¡¶ç‚¹æˆ–é¢ï¼Œä»ç¬¬äºŒè¡Œä¸­ï¼Œæˆ‘ä»¬æå–é¡¶ç‚¹åæ ‡ä¸Šçš„æ•°æ®ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç¡®ä¿æ­¤æ–¹æ³•çš„è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦è¾…åŠ©å‡½æ•°delete_symbolï¼ˆï¼‰ï¼Œè¯¥å‡½æ•°ä»å­—ç¬¦ä¸²ä¸­åˆ é™¤ç»™å®šçš„å­—ç¬¦ï¼Œå¹¶è¿”å›ä¸åŒ…å«è¯¥å­—ç¬¦çš„å­—ç¬¦ä¸²</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete_symbol</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;str, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> symbol)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> tmp = str; tmp.erase(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::remove(tmp.begin(), tmp.end(), symbol), tmp.end()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†æ’ä»¶çš„æ‰€æœ‰åŠŸèƒ½å¹¶å¯ä»¥å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚ </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.æµ‹è¯•æ’ä»¶ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ç¼–è¯‘æ’ä»¶å¹¶è¿è¡Œè°ƒè¯•ï¼ˆF5ï¼‰ã€‚</font><font style="vertical-align: inherit;">å°†å¯åŠ¨æ ‡å‡†osgviewerdæŸ¥çœ‹å™¨çš„è°ƒè¯•ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬å°†åˆ†æä¼ é€’ç»™å®ƒçš„piramide.pmdæ–‡ä»¶ï¼ŒåŠ è½½æˆ‘ä»¬çš„æ’ä»¶å¹¶è°ƒç”¨å…¶readNodeï¼ˆï¼‰æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬åšå¯¹äº†æ‰€æœ‰äº‹æƒ…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å¾—åˆ°è¿™æ ·çš„ç»“æœï¼š</font></font><br><br><img src="https://habrastorage.org/webt/s3/5g/-y/s35g-ykmmlet5z8jisj7efkz7je.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº‹å®è¯æ˜ï¼Œæˆ‘ä»¬å‘æ˜çš„3Dæ¨¡å‹æ–‡ä»¶ä¸­çš„é¡¶ç‚¹å’Œé¢åˆ—è¡¨éšè—äº†å››è§’é”¥ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è‡ªå·±è®¡ç®—æ³•çº¿ï¼Ÿ</font><font style="vertical-align: inherit;">åœ¨å…¶ä¸­ä¸€è¯¾ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹è‡ªåŠ¨è®¡ç®—å¹³æ»‘æ³•çº¿çš„æ–¹æ³•</font></font><br><br><pre> <code class="cpp hljs">osgUtil::SmoothingVisitor::smooth(*geom);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­åº”ç”¨æ­¤å‡½æ•°ï¼Œè€Œä¸æ˜¯åˆ†é…è‡ªå·±çš„æ³•çº¿ </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//geom-&gt;setNormalArray(mesh.normals.get()); //geom-&gt;setNormalBinding(osg::Geometry::BIND_PER_PRIMITIVE_SET); osgUtil::SmoothingVisitor::smooth(*geom);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</font></font><br><br><img src="https://habrastorage.org/webt/eb/gd/kt/ebgdktxsplxyqatprxunnwd8r2o.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³•çº¿ä¼šå½±å“ç…§æ˜æ¨¡å‹çš„è®¡ç®—ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¹³æ»‘çš„æ³•çº¿ä¼šå¯¼è‡´é‡‘å­—å¡”ç…§æ˜è®¡ç®—çš„é”™è¯¯ç»“æœã€‚</font><font style="vertical-align: inherit;">å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„è‡ªè¡Œè½¦åº”ç”¨äºæ³•çº¿è®¡ç®—ã€‚</font><font style="vertical-align: inherit;">ä½†æˆ‘è®¤ä¸ºï¼Œè§£é‡Šè¿™ä¸€ç»†å¾®å·®åˆ«è¶…å‡ºäº†æœ¬è¯¾ç¨‹çš„èŒƒå›´ã€‚</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN438296/">https://habr.com/ru/post/zh-CN438296/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN438286/index.html">åœ¨JavaScriptä¸­ä½¿ç”¨æ—¶åŒº</a></li>
<li><a href="../zh-CN438288/index.html">æ— æ‰€ç•æƒ§çš„ä¿æŠ¤ã€‚ Rustçš„å†…å­˜å®‰å…¨æ€§</a></li>
<li><a href="../zh-CN438290/index.html">GGJ-2019çš„äº‹ååˆ†æï¼šå¦‚ä½•è·å¾—æˆåŠŸï¼Œä½†ä»èƒ½ä½¿æ¸¸æˆæˆä¸ºç°å®</a></li>
<li><a href="../zh-CN438292/index.html">ä½¿ç”¨HomePodï¼ŒRaspberry Piå’ŒNode.jsçš„å…¬å¯“è‡ªåŠ¨åŒ–</a></li>
<li><a href="../zh-CN438294/index.html">åœ¨PUBGæ¯”èµ›ä¸­æŸ¥æ‰¾æŠ½æå½©å¸¦</a></li>
<li><a href="../zh-CN438298/index.html">ä¸ºä»€ä¹ˆè¦æ•™å¼€å‘æ˜¯å¦æ›´æœ‰åˆ©å¯å›¾ã€‚ ä¸GeekBrainsçš„å¯¹è¯</a></li>
<li><a href="../zh-CN438302/index.html">æ•°å­—è¿›åŒ–çš„æƒŠäººåˆ›é€ åŠ›</a></li>
<li><a href="../zh-CN438304/index.html">åˆ†åŒ…ï¼Ÿ é…·ä½ å‘½ä¸­</a></li>
<li><a href="../zh-CN438306/index.html">è¾å°„ï¼šå¹³æ—¥æ”¾å°„åŒ–å­¦å®éªŒå®¤</a></li>
<li><a href="../zh-CN438310/index.html">Instagramä½¿ç”¨æœºå™¨å­¦ä¹ åˆ é™¤å‡ç²‰ä¸</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>