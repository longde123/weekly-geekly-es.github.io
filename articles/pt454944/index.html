<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍✈️ 💅🏽 👨🏽‍🎤 Como o formato JPEG funciona 👩🏻‍🤝‍👨🏿 🤶🏼 👩🏻‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As imagens JPEG são encontradas em todos os lugares da nossa vida digital, mas por trás dessa cobertura de consciência há algoritmos que eliminam deta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o formato JPEG funciona</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454944/"><h4>  As imagens JPEG são encontradas em todos os lugares da nossa vida digital, mas por trás dessa cobertura de consciência há algoritmos que eliminam detalhes que não são percebidos pelo olho humano.  O resultado é a mais alta qualidade visual, com o menor tamanho de arquivo - mas como exatamente tudo isso funciona?  Vamos ver o que exatamente nossos olhos não vêem! </h4><br><img src="https://habrastorage.org/webt/xh/7m/8n/xh7m8nokzhgfqixb00fnwcmkthm.jpeg"><br><br>  É fácil ter, como garantido, a capacidade de enviar uma foto a um amigo, e não se preocupar com qual dispositivo, navegador ou sistema operacional ele usa - no entanto, esse nem sempre foi o caso.  No início dos anos 80, os computadores sabiam armazenar e exibir imagens digitais, mas havia muitas idéias concorrentes sobre a melhor maneira de fazer isso.  Era impossível simplesmente enviar uma imagem de um computador para outro e esperar que tudo desse certo. <br><a name="habracut"></a><br>  Para resolver esse problema, em 1986, um comitê de especialistas de todo o mundo foi reunido sob o nome “Joint Photographic Experts Group (JPEG), com base na colaboração da Organização Internacional de Padronização (ISO) e da Comissão Eletrotécnica Internacional (IEC) ) - duas organizações internacionais de normalização, com sede em Genebra (Suíça). <br><br>  Um grupo de pessoas chamado JPEG criou o padrão de compressão de imagem digital JPEG em 1992.  Qualquer pessoa que use a Internet provavelmente encontrará imagens codificadas em JPEG.  Essa é a maneira mais comum de codificar, enviar e armazenar imagens.  De páginas da web a e-mail e redes sociais, o JPEG é usado bilhões de vezes por dia - quase toda vez que assistimos a uma imagem on-line ou a enviamos.  Sem JPEG, a Web seria menos vibrante, mais lenta e provavelmente haveria menos fotos de gatos! <br><br>  Este artigo é sobre como decodificar uma imagem JPEG.  Em outras palavras, sobre o que é necessário para converter dados compactados armazenados em um computador em uma imagem que aparece na tela.  Vale a pena conhecer isso, não apenas porque é importante para entender a tecnologia que usamos diariamente, mas também porque, ao divulgar os níveis de compressão, entendemos melhor a percepção e a visão, bem como os detalhes aos quais nossos olhos são mais sensíveis. <br><br>  Além disso, brincar com imagens dessa maneira é muito interessante. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f8/312/709/4f831270939c4f685405283f4286e867.gif"><br><br><h2>  Olhando dentro de um JPEG </h2><br>  Em um computador, tudo é armazenado como uma sequência de números binários.  Normalmente, esses bits, zeros e uns, são agrupados em oito, formando bytes.  Quando você abre uma imagem JPEG em um computador, algo (navegador, SO, outra coisa) deve decodificar os bytes, restaurando a imagem original na forma de uma lista de cores que podem ser exibidas. <br><br>  Se você baixar esta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">foto</a> fofa de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gato</a> e abri-la em um editor de texto, verá vários caracteres incoerentes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e4/8a0/017/1e48a0017ada1830f50eefc5079410ea.png"><br>  <i>Aqui, uso o Notepad ++ para examinar o conteúdo de um arquivo, pois editores de texto comuns, como o Bloco de Notas do Windows, corromperão o binário após o salvamento e não atenderão mais ao formato JPEG.</i> <br><br>  Quando você abre uma imagem em um editor de texto, confunde o computador, assim como confunde seu cérebro quando esfrega os olhos e começa a ver manchas coloridas! <br><br>  Esses pontos que você vê são conhecidos como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fosfenos</a> e não são o resultado da exposição a um estímulo luminoso ou alucinações geradas pela mente.  Eles ocorrem porque seu cérebro acredita que quaisquer sinais elétricos nos nervos ópticos transmitem informações sobre a luz.  O cérebro precisa fazer essas suposições, porque é impossível saber se o sinal é som, visão ou qualquer outra coisa.  Todos os nervos do corpo transmitem exatamente os mesmos impulsos elétricos.  Ao pressionar os olhos, você envia sinais que não são visuais, mas ativa os receptores oculares que seu cérebro interpreta - nesse caso, incorretamente - como algo visual.  Você é literalmente capaz de ver a pressão! <br><br>  É engraçado pensar em como os computadores se parecem com um cérebro, mas também é uma analogia útil que ilustra quanto o significado dos dados - transmitidos pelo corpo pelos nervos ou armazenados em um computador - depende de sua interpretação.  Todos os dados binários consistem em zeros e uns, componentes básicos que podem transmitir informações de qualquer tipo.  Seu computador geralmente adivinha como interpretá-los usando dicas, como extensões de arquivo.  E agora estamos forçando-o a interpretá-los como texto, pois é isso que o editor de texto espera. <br><br>  Para entender como decodificar JPEG, precisamos ver os próprios sinais originais - dados binários.  Isso pode ser feito usando o editor hexadecimal ou diretamente na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">página da web do artigo original</a> !  Há uma imagem, ao lado da qual todos os bytes da caixa de texto (exceto o cabeçalho) são apresentados em forma decimal.  Você pode alterá-los e o script recodificará e produzirá uma nova imagem rapidamente. <br><br><img src="https://habrastorage.org/webt/0e/tu/az/0etuazw_ujtrjmepdjpaacmg_jo.png"><br><br>  Você pode aprender muito apenas brincando com este editor.  Por exemplo, você pode dizer em que ordem os pixels são armazenados? <br><br>  Neste exemplo, é estranho que a alteração de alguns números não afete a imagem, mas, por exemplo, se você substituir o número 17 por 0 na primeira linha, a foto ficará completamente ruim! <br><br><img src="https://habrastorage.org/webt/ql/47/xz/ql47xznmt7fq29yoynour0fscls.png"><br><br>  Outras alterações, por exemplo, substituir 7 na linha 1988 pelo número 254 alteram a cor, mas apenas os pixels subsequentes. <br><br><img src="https://habrastorage.org/webt/tj/tu/0o/tjtu0o9qppmq2pgv5mpfh02hpzw.png"><br><br>  Talvez o mais estranho seja que alguns números mudem não apenas a cor, mas também a forma da imagem.  Mude 70 na linha 12 para 2 e olhe para a linha superior da imagem para entender o que quero dizer. <br><br><img src="https://habrastorage.org/webt/wr/ui/w3/wruiw3ds_yihzasjgytn8vul1de.png"><br><br>  E não importa qual imagem JPEG você use, você sempre encontrará essas seqüências de xadrez enigmáticas ao editar bytes. <br><br>  Ao jogar com o editor, é difícil entender como a foto é recriada a partir desses bytes, pois a compactação JPEG consiste em três tecnologias diferentes que são aplicadas seqüencialmente nos níveis.  Estudaremos cada um deles separadamente para revelar o comportamento misterioso que observamos. <br><br>  <b>Três níveis de compactação JPEG:</b> <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Redução de amostras de cores</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Transformação discreta e discretização de cosseno</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Comprimentos de série de codificação</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Delta</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Huffman</a> </li></ol><br>  Para que você possa imaginar a escala de compactação, observe que a imagem acima representa 79.819 números, ou seja, cerca de 79 Kb.  Se o armazenássemos sem compactação, seriam necessários três números para cada pixel - para o componente vermelho, verde e azul.  Seriam 917.700 números, ou aprox.  917 Kb.  Como resultado da compactação JPEG, o arquivo resultante diminuiu mais de 10 vezes! <br><br>  De fato, essa imagem pode ser compactada com muito mais força.  Abaixo estão duas imagens lado a lado - a foto à direita foi reduzida para 16 Kb, 57 vezes menor que a versão não compactada! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec8/a0f/b53/ec8a0fb53e28470aafb8fb6b04713de3.png"><br><br>  Se você olhar atentamente, verá que essas imagens não são idênticas.  Ambos são imagens com compactação JPEG, mas a correta é muito menor em volume.  Também parece um pouco pior (observe os quadrados das cores de fundo).  Portanto, o JPEG também é chamado de compactação com perdas;  durante a compactação, a imagem muda e perde alguns detalhes. <br><br><h2>  1. Redução de amostras de cores </h2><br>  Aqui está uma imagem usando apenas o primeiro nível de compactação. <br><br><img src="https://habrastorage.org/webt/bn/jq/j3/bnjqj3gjgcxd3xazrfnepcfwo-s.png"><br>  <i>(Versão interativa - no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> ).</i>  <i>A remoção de um número destrói todas as cores.</i>  <i>No entanto, se você excluir exatamente seis números, isso praticamente não afetará a imagem.</i> <br><br>  Agora os números são um pouco mais fáceis de decifrar.  Essa é uma lista quase simples de cores, na qual cada byte altera exatamente um pixel, mas ao mesmo tempo já tem a metade do tamanho de uma imagem não compactada (que ocuparia cerca de 300 Kb em tamanho reduzido).  Adivinha por que? <br><br>  Você pode ver que esses números não indicam os componentes vermelho, verde e azul padrão, porque se substituirmos todos os números por zeros, obteremos uma imagem verde (e não branca). <br><br><img src="https://habrastorage.org/webt/ij/ar/qj/ijarqjsfiuanba52sxsn-ovh6q0.png"><br><br>  Isso ocorre porque esses bytes indicam Y (brilho), <br><br><img src="https://habrastorage.org/webt/ab/sl/bt/abslbtgj10nk62g7ksdlx0lusck.png"><br><br>  Cb (azul relativo) <br><br><img src="https://habrastorage.org/webt/_s/ao/1c/_sao1c1div5bv1dltl6gahkp86a.png"><br><br>  e Cr (vermelhidão relativa). <br><br><img src="https://habrastorage.org/webt/mp/fz/jt/mpfzjtlicxlsmw3wmbrnqhywinu.png"><br><br>  Por que não usar RGB?  De fato, é assim que a maioria das telas modernas funciona.  Seu monitor pode mostrar qualquer cor, incluindo vermelho, verde e azul com intensidades diferentes para cada pixel.  O branco é obtido ativando os três com brilho total e o preto - desativando-os. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c27/504/f77/c27504f7737bca3efab3468f2a09aacc.png"><br><br>  Também é muito parecido com o trabalho do olho humano.  Os receptores de cores de nossos olhos são chamados de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cones</a> " e são divididos em três tipos, cada um dos quais é mais sensível a vermelho, verde ou azul [os cones do tipo S são sensíveis em azul violeta (S de inglês curto - ondas curtas espectro), tipo M - em verde-amarelo (M do inglês. Médio - onda média) e tipo-L - nas partes amarelo-vermelho (L do inglês. Longa - longa onda) do espectro.  A presença desses três tipos de cones (e hastes sensíveis na parte verde esmeralda do espectro) proporciona uma visão de cores da pessoa.  / aprox.  transl.].  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">As hastes</a> , outro tipo de fotorreceptor em nossos olhos, podem capturar apenas alterações no brilho, mas são muito mais sensíveis.  Aos nossos olhos, existem cerca de 120 milhões de varas e apenas 6 milhões de cones. <br><br>  Portanto, nossos olhos percebem mudanças de brilho muito melhores do que mudanças de cor.  Se você separar a cor do brilho, poderá remover um pouco de cor e ninguém perceberá nada.  A redução da amostragem de cores é o processo de representar os componentes de cores de uma imagem em uma resolução mais baixa que os componentes de brilho.  No exemplo acima, cada pixel possui exatamente um componente Y e cada grupo individual de quatro pixels possui exatamente um componente Cb e um Cr.  Portanto, a imagem contém quatro vezes menos informações sobre cores do que o original. <br><br>  O espaço de cores YCbCr é usado não apenas em JPEG.  Foi originalmente inventado em 1938 para programas de televisão.  Nem todo mundo tem uma TV em cores; portanto, a separação de cores e brilho permitiu que todos recebessem o mesmo sinal, e as TVs sem cores usavam apenas o componente de brilho. <br><br>  Portanto, a exclusão de um número do editor destrói completamente todas as cores.  Os componentes são armazenados como AAAA Cb Cr (de fato, não necessariamente nessa ordem - a ordem de armazenamento é especificada no cabeçalho do arquivo).  A remoção do primeiro número levará ao fato de que o primeiro valor de Cb será percebido como Y, Cr como Cb e, como um todo, ocorrerá um efeito dominó, alternando todas as cores da imagem. <br><br>  A especificação JPEG não obriga a usar o YCbCr.  Porém, na maioria dos arquivos, é usado porque fornece imagens de melhor qualidade após a redução da amostra em comparação com o RGB.  Mas você não precisa aceitar minha palavra.  Veja na tabela abaixo como a redução de amostra de cada componente individual será semelhante em RGB e em YCbCr. <br><br><img src="https://habrastorage.org/webt/9b/fl/ei/9bfleirkdnq8sdwiudks05bdz1o.png"><br>  (Versão interativa - no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> ). <br><br>  A remoção do azul não é tão perceptível quanto o vermelho ou o verde.  Isso ocorre por causa dos seis milhões de cones em seus olhos, cerca de 64% são sensíveis ao vermelho, 32% ao verde e 2% ao azul. <br><br>  A subamostragem do componente Y (canto inferior esquerdo) é melhor visualizada.  Perceptível é mesmo uma ligeira mudança. <br><br>  A conversão de uma imagem de RGB para YCbCr não reduz o tamanho do arquivo, mas facilita a localização de detalhes menos perceptíveis que podem ser removidos.  A compressão com perdas ocorre no segundo estágio.  É baseado na ideia de representar dados de uma forma mais compressível. <br><br><h2>  2. Transformação discreta e discretização de cosseno </h2><br>  Esse nível de compactação determina a maior parte da essência do JPEG.  Depois de converter as cores em YCbCr, os componentes são compactados separadamente, para que possamos nos concentrar no componente Y somente mais tarde. E é assim que os bytes do componente Y se aplicam após a aplicação desse nível. <br><br><img src="https://habrastorage.org/webt/sr/c2/en/src2enhysp480z4qoycrgptdn5m.png"><br>  <i>(Versão interativa - no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> ).</i>  Na versão interativa, clicar em um pixel rola o editor para a linha que o indica.  Tente remover números do final ou adicionar alguns zeros a um número específico. <br><br>  À primeira vista, parece uma compressão muito ruim.  Existem 100.000 pixels na imagem e 102.400 números são necessários para indicar o brilho (componentes Y) - isso é pior do que não compactar nada! <br><br>  No entanto, observe que a maioria desses números é zero.  Além disso, todos esses zeros no final das linhas podem ser excluídos sem alterar a imagem.  Restam cerca de 26.000 números, e isso é quase 4 vezes menos! <br><br>  Nesse nível está o segredo dos padrões de xadrez.  Ao contrário de outros efeitos que vimos, a aparência desses padrões não é uma falha.  Eles são os blocos de construção de toda a imagem.  Cada linha do editor contém exatamente 64 números, coeficientes de transformada discreta de cosseno (DCT) correspondentes a intensidades de 64 padrões únicos. <br><br>  Esses padrões são formados com base no gráfico de cosseno.  Aqui estão alguns deles: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2cc/8da/dd7/2cc8dadd7ca3d6565753fdd8f14a4fcd.png"><br>  <i>8 de 64 probabilidades</i> <br><br>  Abaixo está uma imagem mostrando todos os 64 padrões. <br><br><img src="https://habrastorage.org/webt/z3/8n/ri/z38nrihqi2zbdt2cznzqy3p1bh0.png"><br>  <i>(Versão interativa - no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> ).</i> <br><br>  Esses padrões são de particular importância, pois formam a base das imagens 8x8.  Se você não estiver familiarizado com álgebra linear, isso significa que qualquer imagem 8x8 pode ser obtida a partir desses 64 padrões.  DCT é o processo de dividir imagens em blocos 8x8 e converter cada bloco em uma combinação desses 64 coeficientes. <br><br>  O fato de qualquer imagem poder ser composta por 64 padrões específicos parece mágico.  No entanto, é o mesmo que dizer que qualquer lugar na Terra pode ser descrito por dois números - latitude e longitude [indicando hemisférios / aprox.  transl.].  Costumamos considerar a superfície da Terra bidimensional, por isso precisamos de apenas dois números.  Uma imagem 8x8 tem 64 dimensões, por isso precisamos de 64 números. <br><br>  Ainda não está claro como isso nos ajuda no sentido da compressão.  Se precisarmos de 64 números para representar uma imagem 8x8, por que isso seria melhor do que apenas armazenar 64 componentes de luminância?  Fazemos isso pela mesma razão pela qual transformamos três números RGB em três números YCbCr: isso nos permite remover detalhes invisíveis. <br><br>  É difícil ver exatamente quais detalhes foram removidos nesse estágio, porque o JPEG aplica o DCT a blocos 8x8.  No entanto, ninguém nos proíbe de aplicá-lo a todo o cenário.  Aqui está a aparência do DCT no componente Y quando aplicado a toda a imagem: <br><br><img src="https://habrastorage.org/webt/ab/sl/bt/abslbtgj10nk62g7ksdlx0lusck.png"><br><br>  No final, você pode excluir mais de 60.000 números praticamente sem alterações visíveis na foto. <br><br><img src="https://habrastorage.org/webt/we/mq/ma/wemqmatswqyazpgyxm12k-g7l-s.png"><br><br>  No entanto, observe que, se redefinirmos os cinco primeiros números, a diferença será óbvia. <br><br><img src="https://habrastorage.org/webt/m0/fj/tj/m0fjtjcfr_-6b50duzk3-zvl7gi.png"><br><br>  Os números no início indicam mudanças de baixa frequência na imagem, e nossos olhos os captam melhor.  Os números próximos ao final indicam alterações nas frequências altas que são mais difíceis de perceber.  Para "ver o que não é visível a olho nu", podemos isolar essas partes de alta frequência zerando os primeiros 5000 números. <br><br><img src="https://habrastorage.org/webt/si/gj/w2/sigjw20pylfjmu0rzqjocl6oqv4.png"><br><br>  Vemos todas as áreas da imagem nas quais a maior alteração ocorre de pixel para pixel.  Destacam-se os olhos do gato, o bigode, o cobertor felpudo e as sombras no canto inferior esquerdo.  Você pode ir além limpando os primeiros 10.000 números: <br><br><img src="https://habrastorage.org/webt/eg/vi/9a/egvi9a_wkwv48xktp7jiyajnhuc.png"><br><br>  20.000: <br><br><img src="https://habrastorage.org/webt/y9/fr/ri/y9frrialb_94gnwdd-plq_hcyqc.png"><br><br>  40.000: <br><br><img src="https://habrastorage.org/webt/0d/ce/kr/0dcekrobg9_ir-hqnggr9fjlw4u.png"><br><br>  60.000: <br><br><img src="https://habrastorage.org/webt/uo/8f/qx/uo8fqxadj-snukbdf1dcjgvoux0.png"><br><br>  Essas partes de alta frequência são jpeg e são excluídas durante a fase de compressão.  A conversão de cores em coeficientes DCT é sem perdas.  As perdas são geradas na etapa de discretização, na qual os valores de alta frequência ou quase zero são removidos.  Quando você diminui a qualidade de salvar o JPEG, o programa aumenta o limite para o número de valores excluídos, o que reduz o tamanho do arquivo, mas torna a imagem mais pixelizada.  Portanto, a imagem na primeira seção, que era 57 vezes menor, ficava assim.  Cada bloco 8x8 parecia ter um número muito menor de coeficientes de DCT em comparação com uma versão melhor. <br><br>  Você pode criar um efeito interessante, como a transmissão gradual de imagens.  Você pode exibir uma imagem borrada, que fica mais detalhada à medida que mais e mais coeficientes são baixados. <br><br>  Aqui, apenas por diversão, o que acontece ao usar apenas 24.000 números: <br><br><img src="https://habrastorage.org/webt/vn/sf/xr/vnsfxrqyogsnc4qx9pzsok--rno.png"><br><br>  Ou apenas 5000: <br><br><img src="https://habrastorage.org/webt/oi/y3/u6/oiy3u6saz6kliguv_pm8iucdbqa.png"><br><br>  Muito embaçado, mas como se fosse reconhecível! <br><br><h2>  3. Codificação dos comprimentos das séries, delta e Huffman </h2><br>  Até agora, todos os estágios de compressão foram perdidos.  A última etapa, pelo contrário, fica sem perdas.  Ele não exclui informações, mas reduz significativamente o tamanho do arquivo. <br><br>  Como você pode compactar algo sem descartar informações?  Imagine como descreveríamos um simples retângulo preto de 700 x 437. <br><br>  O JPEG usa 5000 números para isso, mas um resultado muito melhor pode ser alcançado.  Você pode imaginar um esquema de codificação que descreva essa imagem com o mínimo de bytes possível? <br><br>  O esquema mínimo que eu poderia criar usa quatro: três para indicar cores e o quarto - quantos pixels têm essa cor.  A idéia de representar valores repetidos de maneira compactada é chamada de codificação de comprimento de série.  Não possui perdas, pois podemos restaurar os dados codificados em sua forma original. <br><br>  O tamanho de um arquivo JPEG com um retângulo preto é muito maior que 4 bytes - lembre-se de que no nível DCT, a compactação é aplicada a blocos de 8x8 pixels.  Portanto, pelo menos, precisamos de um coeficiente DCT para cada 64 pixels.  Precisamos de um porque, em vez de armazenar um único coeficiente DCT seguido de 63 zeros, a codificação dos comprimentos das séries nos permite armazenar um número e indicar que "todos os outros são zeros". <br><br>  A codificação delta é uma técnica na qual cada byte contém uma diferença de algum valor, em vez de um valor absoluto.  Portanto, editar certos bytes altera a cor de todos os outros pixels.  Por exemplo, em vez de armazenar <br><br>  12 13 14 14 14 13 13 14 <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poderíamos começar com 12 e, em seguida, simplesmente indicar quanto precisamos adicionar ou subtrair para obter o próximo número. E essa sequência na codificação delta assume a forma: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12 1 1 0 0 -1 0 1 Os </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dados convertidos não são obtidos menos que o original, mas já é mais fácil compactá-lo. O uso da codificação delta antes da codificação das séries pode ajudar bastante, mantendo a compactação sem perdas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A codificação delta é uma das poucas técnicas usadas fora dos blocos 8x8. Dos 64 coeficientes DCT, um é simplesmente uma função de onda constante (cor sólida). Representa o brilho médio de cada bloco para os componentes de luminância ou o azul médio para os componentes Cb, e assim por diante. O primeiro valor de cada bloco DCT é chamado de valor DC, e cada valor DC passa por uma codificação delta em relação aos anteriores. Portanto, uma alteração no brilho do primeiro bloco afetará todos os blocos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O último mistério permanece: como a mudança singular estraga completamente toda a cena? Até agora, os níveis de compactação não tinham essas propriedades. A resposta está no cabeçalho JPEG. Os primeiros 500 bytes contêm metadados sobre a imagem - largura, altura etc., e até agora não trabalhamos com eles.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem um cabeçalho, é quase impossível (bem ou muito difícil) decodificar JPEG. Parece que estou tentando descrever a imagem para você e começar a inventar palavras para transmitir minha impressão. A descrição provavelmente será muito concisa, porque posso inventar palavras com exatamente o significado que quero transmitir, mas, para todas as outras, elas não farão sentido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece estúpido, mas é exatamente isso que acontece. Cada imagem JPEG é compactada com códigos específicos. Um dicionário de códigos é armazenado no cabeçalho. Essa técnica é chamada de código Huffman e o dicionário é chamado tabela Huffman. No cabeçalho, a tabela é marcada com dois bytes - 255 e 196. Cada componente de cor pode ter sua própria tabela.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alterações nas tabelas afetarão radicalmente qualquer imagem. Um bom exemplo é alterar 1 em 12 na linha 15. </font></font><br><br><img src="https://habrastorage.org/webt/mz/-c/xd/mz-cxdyzf2haxuj1_tojoatbl7s.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso ocorre porque as tabelas indicam como ler bits individuais. Até agora, trabalhamos apenas com números binários na forma decimal. Mas isso nos oculta o fato de que, se você deseja armazenar o número 1 em um byte, será 00000001, pois cada byte deve ter exatamente oito bits, mesmo que apenas um deles seja necessário. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso é potencialmente um grande desperdício de espaço se você tiver muitos números pequenos. O código de Huffman é uma técnica que nos permite relaxar esse requisito, segundo o qual cada número deve ocupar oito bits. Isso significa que se você vir dois bytes: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">234 115</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso, dependendo da tabela de Huffman, pode ter três números. Para extraí-los, primeiro é necessário dividi-los em bits separados: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11101010 01110011 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, passamos à tabela para entender como agrupá-los. Por exemplo, podem ser os primeiros seis bits (111010) ou 58 no sistema decimal, seguidos de cinco bits (10011) ou 19 e, finalmente, os últimos quatro bits (0011) ou 3. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, é muito difícil entender bytes nesta fase de compressão. Bytes não representam o que parece. Não entrarei em detalhes sobre como trabalhar com a tabela neste artigo, mas </font><font style="vertical-align: inherit;">existem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">materiais </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suficientes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre esse assunto na rede </font><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um dos truques interessantes que você pode fazer se souber separar o cabeçalho do JPEG e armazená-lo separadamente. </font><font style="vertical-align: inherit;">De fato, acontece que apenas você pode ler o arquivo. </font><font style="vertical-align: inherit;">O Facebook está fazendo isso para reduzir ainda mais o tamanho do arquivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que mais você pode fazer é modificar bastante a tabela Huffman. </font><font style="vertical-align: inherit;">Para outros, parecerá uma imagem danificada. </font><font style="vertical-align: inherit;">E somente você saberá a versão mágica de sua correção. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para resumir: o que é necessário para a decodificação JPEG?</font></font> É necessário: <br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extraia as tabelas Huffman do cabeçalho e decodifique os bits. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extraia coeficientes discretos de transformação de cosseno para cada componente de cor e brilho de cada bloco 8x8 executando transformações inversas de codificação de comprimentos e deltas de séries. </font></font></li><li>     ,        88. </li><li>   ,    (    ). </li><li>    YCbCr     RGB. </li><li>    ! </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalho sério para facilitar a visualização de fotos com um gato! </font><font style="vertical-align: inherit;">No entanto, o que eu mais gosto é que você pode ver como a tecnologia JPEG é centrada no ser humano. </font><font style="vertical-align: inherit;">É baseado nas características de nossa percepção, o que nos permite obter uma compressão muito melhor do que as tecnologias convencionais. </font><font style="vertical-align: inherit;">E agora, entendendo como o JPEG funciona, você pode imaginar como essas tecnologias podem ser transferidas para outras áreas. </font><font style="vertical-align: inherit;">Por exemplo, a codificação delta no vídeo pode reduzir bastante o tamanho do arquivo, pois geralmente existem áreas inteiras que não mudam de quadro para quadro (por exemplo, plano de fundo). </font></font><br><br> <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O código usado no artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> está aberto e contém instruções para substituir imagens por você.</font></font></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454944/">https://habr.com/ru/post/pt454944/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454928/index.html">Maneira de ignorar a tela de bloqueio do Windows em sessões RDP</a></li>
<li><a href="../pt454930/index.html">Coleta de lixo na V8: como o novo GC Orinoco funciona</a></li>
<li><a href="../pt454932/index.html">Investimentos e software: 5 terminais de negociação para negociação na bolsa</a></li>
<li><a href="../pt454936/index.html">Vivaldi: o bloqueio de anúncios deve ser a escolha do usuário</a></li>
<li><a href="../pt454940/index.html">Seguro de saúde de viagem: instruções detalhadas</a></li>
<li><a href="../pt454946/index.html">Estados globais: por que e como evitá-los</a></li>
<li><a href="../pt454958/index.html">Um olhar por dentro: pós-graduação na EPFL. Parte 4.1: vida cotidiana</a></li>
<li><a href="../pt454960/index.html">Microbiota. Como os medicamentos afetam as bactérias intestinais</a></li>
<li><a href="../pt454962/index.html">Como as empresas de TI do mundo se protegem dos concorrentes em face dos ex-funcionários?</a></li>
<li><a href="../pt454964/index.html">O uso da visão computacional em pesquisas marítimas ou 12 pessoas no peito de um morto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>