<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äç‚úàÔ∏è üíÖüèΩ üë®üèΩ‚Äçüé§ Como o formato JPEG funciona üë©üèª‚Äçü§ù‚Äçüë®üèø ü§∂üèº üë©üèª‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As imagens JPEG s√£o encontradas em todos os lugares da nossa vida digital, mas por tr√°s dessa cobertura de consci√™ncia h√° algoritmos que eliminam deta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o formato JPEG funciona</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454944/"><h4>  As imagens JPEG s√£o encontradas em todos os lugares da nossa vida digital, mas por tr√°s dessa cobertura de consci√™ncia h√° algoritmos que eliminam detalhes que n√£o s√£o percebidos pelo olho humano.  O resultado √© a mais alta qualidade visual, com o menor tamanho de arquivo - mas como exatamente tudo isso funciona?  Vamos ver o que exatamente nossos olhos n√£o v√™em! </h4><br><img src="https://habrastorage.org/webt/xh/7m/8n/xh7m8nokzhgfqixb00fnwcmkthm.jpeg"><br><br>  √â f√°cil ter, como garantido, a capacidade de enviar uma foto a um amigo, e n√£o se preocupar com qual dispositivo, navegador ou sistema operacional ele usa - no entanto, esse nem sempre foi o caso.  No in√≠cio dos anos 80, os computadores sabiam armazenar e exibir imagens digitais, mas havia muitas id√©ias concorrentes sobre a melhor maneira de fazer isso.  Era imposs√≠vel simplesmente enviar uma imagem de um computador para outro e esperar que tudo desse certo. <br><a name="habracut"></a><br>  Para resolver esse problema, em 1986, um comit√™ de especialistas de todo o mundo foi reunido sob o nome ‚ÄúJoint Photographic Experts Group (JPEG), com base na colabora√ß√£o da Organiza√ß√£o Internacional de Padroniza√ß√£o (ISO) e da Comiss√£o Eletrot√©cnica Internacional (IEC) ) - duas organiza√ß√µes internacionais de normaliza√ß√£o, com sede em Genebra (Su√≠√ßa). <br><br>  Um grupo de pessoas chamado JPEG criou o padr√£o de compress√£o de imagem digital JPEG em 1992.  Qualquer pessoa que use a Internet provavelmente encontrar√° imagens codificadas em JPEG.  Essa √© a maneira mais comum de codificar, enviar e armazenar imagens.  De p√°ginas da web a e-mail e redes sociais, o JPEG √© usado bilh√µes de vezes por dia - quase toda vez que assistimos a uma imagem on-line ou a enviamos.  Sem JPEG, a Web seria menos vibrante, mais lenta e provavelmente haveria menos fotos de gatos! <br><br>  Este artigo √© sobre como decodificar uma imagem JPEG.  Em outras palavras, sobre o que √© necess√°rio para converter dados compactados armazenados em um computador em uma imagem que aparece na tela.  Vale a pena conhecer isso, n√£o apenas porque √© importante para entender a tecnologia que usamos diariamente, mas tamb√©m porque, ao divulgar os n√≠veis de compress√£o, entendemos melhor a percep√ß√£o e a vis√£o, bem como os detalhes aos quais nossos olhos s√£o mais sens√≠veis. <br><br>  Al√©m disso, brincar com imagens dessa maneira √© muito interessante. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f8/312/709/4f831270939c4f685405283f4286e867.gif"><br><br><h2>  Olhando dentro de um JPEG </h2><br>  Em um computador, tudo √© armazenado como uma sequ√™ncia de n√∫meros bin√°rios.  Normalmente, esses bits, zeros e uns, s√£o agrupados em oito, formando bytes.  Quando voc√™ abre uma imagem JPEG em um computador, algo (navegador, SO, outra coisa) deve decodificar os bytes, restaurando a imagem original na forma de uma lista de cores que podem ser exibidas. <br><br>  Se voc√™ baixar esta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">foto</a> fofa de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gato</a> e abri-la em um editor de texto, ver√° v√°rios caracteres incoerentes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e4/8a0/017/1e48a0017ada1830f50eefc5079410ea.png"><br>  <i>Aqui, uso o Notepad ++ para examinar o conte√∫do de um arquivo, pois editores de texto comuns, como o Bloco de Notas do Windows, corromper√£o o bin√°rio ap√≥s o salvamento e n√£o atender√£o mais ao formato JPEG.</i> <br><br>  Quando voc√™ abre uma imagem em um editor de texto, confunde o computador, assim como confunde seu c√©rebro quando esfrega os olhos e come√ßa a ver manchas coloridas! <br><br>  Esses pontos que voc√™ v√™ s√£o conhecidos como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fosfenos</a> e n√£o s√£o o resultado da exposi√ß√£o a um est√≠mulo luminoso ou alucina√ß√µes geradas pela mente.  Eles ocorrem porque seu c√©rebro acredita que quaisquer sinais el√©tricos nos nervos √≥pticos transmitem informa√ß√µes sobre a luz.  O c√©rebro precisa fazer essas suposi√ß√µes, porque √© imposs√≠vel saber se o sinal √© som, vis√£o ou qualquer outra coisa.  Todos os nervos do corpo transmitem exatamente os mesmos impulsos el√©tricos.  Ao pressionar os olhos, voc√™ envia sinais que n√£o s√£o visuais, mas ativa os receptores oculares que seu c√©rebro interpreta - nesse caso, incorretamente - como algo visual.  Voc√™ √© literalmente capaz de ver a press√£o! <br><br>  √â engra√ßado pensar em como os computadores se parecem com um c√©rebro, mas tamb√©m √© uma analogia √∫til que ilustra quanto o significado dos dados - transmitidos pelo corpo pelos nervos ou armazenados em um computador - depende de sua interpreta√ß√£o.  Todos os dados bin√°rios consistem em zeros e uns, componentes b√°sicos que podem transmitir informa√ß√µes de qualquer tipo.  Seu computador geralmente adivinha como interpret√°-los usando dicas, como extens√µes de arquivo.  E agora estamos for√ßando-o a interpret√°-los como texto, pois √© isso que o editor de texto espera. <br><br>  Para entender como decodificar JPEG, precisamos ver os pr√≥prios sinais originais - dados bin√°rios.  Isso pode ser feito usando o editor hexadecimal ou diretamente na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina da web do artigo original</a> !  H√° uma imagem, ao lado da qual todos os bytes da caixa de texto (exceto o cabe√ßalho) s√£o apresentados em forma decimal.  Voc√™ pode alter√°-los e o script recodificar√° e produzir√° uma nova imagem rapidamente. <br><br><img src="https://habrastorage.org/webt/0e/tu/az/0etuazw_ujtrjmepdjpaacmg_jo.png"><br><br>  Voc√™ pode aprender muito apenas brincando com este editor.  Por exemplo, voc√™ pode dizer em que ordem os pixels s√£o armazenados? <br><br>  Neste exemplo, √© estranho que a altera√ß√£o de alguns n√∫meros n√£o afete a imagem, mas, por exemplo, se voc√™ substituir o n√∫mero 17 por 0 na primeira linha, a foto ficar√° completamente ruim! <br><br><img src="https://habrastorage.org/webt/ql/47/xz/ql47xznmt7fq29yoynour0fscls.png"><br><br>  Outras altera√ß√µes, por exemplo, substituir 7 na linha 1988 pelo n√∫mero 254 alteram a cor, mas apenas os pixels subsequentes. <br><br><img src="https://habrastorage.org/webt/tj/tu/0o/tjtu0o9qppmq2pgv5mpfh02hpzw.png"><br><br>  Talvez o mais estranho seja que alguns n√∫meros mudem n√£o apenas a cor, mas tamb√©m a forma da imagem.  Mude 70 na linha 12 para 2 e olhe para a linha superior da imagem para entender o que quero dizer. <br><br><img src="https://habrastorage.org/webt/wr/ui/w3/wruiw3ds_yihzasjgytn8vul1de.png"><br><br>  E n√£o importa qual imagem JPEG voc√™ use, voc√™ sempre encontrar√° essas seq√º√™ncias de xadrez enigm√°ticas ao editar bytes. <br><br>  Ao jogar com o editor, √© dif√≠cil entender como a foto √© recriada a partir desses bytes, pois a compacta√ß√£o JPEG consiste em tr√™s tecnologias diferentes que s√£o aplicadas seq√ºencialmente nos n√≠veis.  Estudaremos cada um deles separadamente para revelar o comportamento misterioso que observamos. <br><br>  <b>Tr√™s n√≠veis de compacta√ß√£o JPEG:</b> <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Redu√ß√£o de amostras de cores</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Transforma√ß√£o discreta e discretiza√ß√£o de cosseno</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Comprimentos de s√©rie de codifica√ß√£o</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Delta</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Huffman</a> </li></ol><br>  Para que voc√™ possa imaginar a escala de compacta√ß√£o, observe que a imagem acima representa 79.819 n√∫meros, ou seja, cerca de 79 Kb.  Se o armazen√°ssemos sem compacta√ß√£o, seriam necess√°rios tr√™s n√∫meros para cada pixel - para o componente vermelho, verde e azul.  Seriam 917.700 n√∫meros, ou aprox.  917 Kb.  Como resultado da compacta√ß√£o JPEG, o arquivo resultante diminuiu mais de 10 vezes! <br><br>  De fato, essa imagem pode ser compactada com muito mais for√ßa.  Abaixo est√£o duas imagens lado a lado - a foto √† direita foi reduzida para 16 Kb, 57 vezes menor que a vers√£o n√£o compactada! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec8/a0f/b53/ec8a0fb53e28470aafb8fb6b04713de3.png"><br><br>  Se voc√™ olhar atentamente, ver√° que essas imagens n√£o s√£o id√™nticas.  Ambos s√£o imagens com compacta√ß√£o JPEG, mas a correta √© muito menor em volume.  Tamb√©m parece um pouco pior (observe os quadrados das cores de fundo).  Portanto, o JPEG tamb√©m √© chamado de compacta√ß√£o com perdas;  durante a compacta√ß√£o, a imagem muda e perde alguns detalhes. <br><br><h2>  1. Redu√ß√£o de amostras de cores </h2><br>  Aqui est√° uma imagem usando apenas o primeiro n√≠vel de compacta√ß√£o. <br><br><img src="https://habrastorage.org/webt/bn/jq/j3/bnjqj3gjgcxd3xazrfnepcfwo-s.png"><br>  <i>(Vers√£o interativa - no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> ).</i>  <i>A remo√ß√£o de um n√∫mero destr√≥i todas as cores.</i>  <i>No entanto, se voc√™ excluir exatamente seis n√∫meros, isso praticamente n√£o afetar√° a imagem.</i> <br><br>  Agora os n√∫meros s√£o um pouco mais f√°ceis de decifrar.  Essa √© uma lista quase simples de cores, na qual cada byte altera exatamente um pixel, mas ao mesmo tempo j√° tem a metade do tamanho de uma imagem n√£o compactada (que ocuparia cerca de 300 Kb em tamanho reduzido).  Adivinha por que? <br><br>  Voc√™ pode ver que esses n√∫meros n√£o indicam os componentes vermelho, verde e azul padr√£o, porque se substituirmos todos os n√∫meros por zeros, obteremos uma imagem verde (e n√£o branca). <br><br><img src="https://habrastorage.org/webt/ij/ar/qj/ijarqjsfiuanba52sxsn-ovh6q0.png"><br><br>  Isso ocorre porque esses bytes indicam Y (brilho), <br><br><img src="https://habrastorage.org/webt/ab/sl/bt/abslbtgj10nk62g7ksdlx0lusck.png"><br><br>  Cb (azul relativo) <br><br><img src="https://habrastorage.org/webt/_s/ao/1c/_sao1c1div5bv1dltl6gahkp86a.png"><br><br>  e Cr (vermelhid√£o relativa). <br><br><img src="https://habrastorage.org/webt/mp/fz/jt/mpfzjtlicxlsmw3wmbrnqhywinu.png"><br><br>  Por que n√£o usar RGB?  De fato, √© assim que a maioria das telas modernas funciona.  Seu monitor pode mostrar qualquer cor, incluindo vermelho, verde e azul com intensidades diferentes para cada pixel.  O branco √© obtido ativando os tr√™s com brilho total e o preto - desativando-os. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c27/504/f77/c27504f7737bca3efab3468f2a09aacc.png"><br><br>  Tamb√©m √© muito parecido com o trabalho do olho humano.  Os receptores de cores de nossos olhos s√£o chamados de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cones</a> " e s√£o divididos em tr√™s tipos, cada um dos quais √© mais sens√≠vel a vermelho, verde ou azul [os cones do tipo S s√£o sens√≠veis em azul violeta (S de ingl√™s curto - ondas curtas espectro), tipo M - em verde-amarelo (M do ingl√™s. M√©dio - onda m√©dia) e tipo-L - nas partes amarelo-vermelho (L do ingl√™s. Longa - longa onda) do espectro.  A presen√ßa desses tr√™s tipos de cones (e hastes sens√≠veis na parte verde esmeralda do espectro) proporciona uma vis√£o de cores da pessoa.  / aprox.  transl.].  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">As hastes</a> , outro tipo de fotorreceptor em nossos olhos, podem capturar apenas altera√ß√µes no brilho, mas s√£o muito mais sens√≠veis.  Aos nossos olhos, existem cerca de 120 milh√µes de varas e apenas 6 milh√µes de cones. <br><br>  Portanto, nossos olhos percebem mudan√ßas de brilho muito melhores do que mudan√ßas de cor.  Se voc√™ separar a cor do brilho, poder√° remover um pouco de cor e ningu√©m perceber√° nada.  A redu√ß√£o da amostragem de cores √© o processo de representar os componentes de cores de uma imagem em uma resolu√ß√£o mais baixa que os componentes de brilho.  No exemplo acima, cada pixel possui exatamente um componente Y e cada grupo individual de quatro pixels possui exatamente um componente Cb e um Cr.  Portanto, a imagem cont√©m quatro vezes menos informa√ß√µes sobre cores do que o original. <br><br>  O espa√ßo de cores YCbCr √© usado n√£o apenas em JPEG.  Foi originalmente inventado em 1938 para programas de televis√£o.  Nem todo mundo tem uma TV em cores; portanto, a separa√ß√£o de cores e brilho permitiu que todos recebessem o mesmo sinal, e as TVs sem cores usavam apenas o componente de brilho. <br><br>  Portanto, a exclus√£o de um n√∫mero do editor destr√≥i completamente todas as cores.  Os componentes s√£o armazenados como AAAA Cb Cr (de fato, n√£o necessariamente nessa ordem - a ordem de armazenamento √© especificada no cabe√ßalho do arquivo).  A remo√ß√£o do primeiro n√∫mero levar√° ao fato de que o primeiro valor de Cb ser√° percebido como Y, Cr como Cb e, como um todo, ocorrer√° um efeito domin√≥, alternando todas as cores da imagem. <br><br>  A especifica√ß√£o JPEG n√£o obriga a usar o YCbCr.  Por√©m, na maioria dos arquivos, √© usado porque fornece imagens de melhor qualidade ap√≥s a redu√ß√£o da amostra em compara√ß√£o com o RGB.  Mas voc√™ n√£o precisa aceitar minha palavra.  Veja na tabela abaixo como a redu√ß√£o de amostra de cada componente individual ser√° semelhante em RGB e em YCbCr. <br><br><img src="https://habrastorage.org/webt/9b/fl/ei/9bfleirkdnq8sdwiudks05bdz1o.png"><br>  (Vers√£o interativa - no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> ). <br><br>  A remo√ß√£o do azul n√£o √© t√£o percept√≠vel quanto o vermelho ou o verde.  Isso ocorre por causa dos seis milh√µes de cones em seus olhos, cerca de 64% s√£o sens√≠veis ao vermelho, 32% ao verde e 2% ao azul. <br><br>  A subamostragem do componente Y (canto inferior esquerdo) √© melhor visualizada.  Percept√≠vel √© mesmo uma ligeira mudan√ßa. <br><br>  A convers√£o de uma imagem de RGB para YCbCr n√£o reduz o tamanho do arquivo, mas facilita a localiza√ß√£o de detalhes menos percept√≠veis que podem ser removidos.  A compress√£o com perdas ocorre no segundo est√°gio.  √â baseado na ideia de representar dados de uma forma mais compress√≠vel. <br><br><h2>  2. Transforma√ß√£o discreta e discretiza√ß√£o de cosseno </h2><br>  Esse n√≠vel de compacta√ß√£o determina a maior parte da ess√™ncia do JPEG.  Depois de converter as cores em YCbCr, os componentes s√£o compactados separadamente, para que possamos nos concentrar no componente Y somente mais tarde. E √© assim que os bytes do componente Y se aplicam ap√≥s a aplica√ß√£o desse n√≠vel. <br><br><img src="https://habrastorage.org/webt/sr/c2/en/src2enhysp480z4qoycrgptdn5m.png"><br>  <i>(Vers√£o interativa - no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> ).</i>  Na vers√£o interativa, clicar em um pixel rola o editor para a linha que o indica.  Tente remover n√∫meros do final ou adicionar alguns zeros a um n√∫mero espec√≠fico. <br><br>  √Ä primeira vista, parece uma compress√£o muito ruim.  Existem 100.000 pixels na imagem e 102.400 n√∫meros s√£o necess√°rios para indicar o brilho (componentes Y) - isso √© pior do que n√£o compactar nada! <br><br>  No entanto, observe que a maioria desses n√∫meros √© zero.  Al√©m disso, todos esses zeros no final das linhas podem ser exclu√≠dos sem alterar a imagem.  Restam cerca de 26.000 n√∫meros, e isso √© quase 4 vezes menos! <br><br>  Nesse n√≠vel est√° o segredo dos padr√µes de xadrez.  Ao contr√°rio de outros efeitos que vimos, a apar√™ncia desses padr√µes n√£o √© uma falha.  Eles s√£o os blocos de constru√ß√£o de toda a imagem.  Cada linha do editor cont√©m exatamente 64 n√∫meros, coeficientes de transformada discreta de cosseno (DCT) correspondentes a intensidades de 64 padr√µes √∫nicos. <br><br>  Esses padr√µes s√£o formados com base no gr√°fico de cosseno.  Aqui est√£o alguns deles: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2cc/8da/dd7/2cc8dadd7ca3d6565753fdd8f14a4fcd.png"><br>  <i>8 de 64 probabilidades</i> <br><br>  Abaixo est√° uma imagem mostrando todos os 64 padr√µes. <br><br><img src="https://habrastorage.org/webt/z3/8n/ri/z38nrihqi2zbdt2cznzqy3p1bh0.png"><br>  <i>(Vers√£o interativa - no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> ).</i> <br><br>  Esses padr√µes s√£o de particular import√¢ncia, pois formam a base das imagens 8x8.  Se voc√™ n√£o estiver familiarizado com √°lgebra linear, isso significa que qualquer imagem 8x8 pode ser obtida a partir desses 64 padr√µes.  DCT √© o processo de dividir imagens em blocos 8x8 e converter cada bloco em uma combina√ß√£o desses 64 coeficientes. <br><br>  O fato de qualquer imagem poder ser composta por 64 padr√µes espec√≠ficos parece m√°gico.  No entanto, √© o mesmo que dizer que qualquer lugar na Terra pode ser descrito por dois n√∫meros - latitude e longitude [indicando hemisf√©rios / aprox.  transl.].  Costumamos considerar a superf√≠cie da Terra bidimensional, por isso precisamos de apenas dois n√∫meros.  Uma imagem 8x8 tem 64 dimens√µes, por isso precisamos de 64 n√∫meros. <br><br>  Ainda n√£o est√° claro como isso nos ajuda no sentido da compress√£o.  Se precisarmos de 64 n√∫meros para representar uma imagem 8x8, por que isso seria melhor do que apenas armazenar 64 componentes de lumin√¢ncia?  Fazemos isso pela mesma raz√£o pela qual transformamos tr√™s n√∫meros RGB em tr√™s n√∫meros YCbCr: isso nos permite remover detalhes invis√≠veis. <br><br>  √â dif√≠cil ver exatamente quais detalhes foram removidos nesse est√°gio, porque o JPEG aplica o DCT a blocos 8x8.  No entanto, ningu√©m nos pro√≠be de aplic√°-lo a todo o cen√°rio.  Aqui est√° a apar√™ncia do DCT no componente Y quando aplicado a toda a imagem: <br><br><img src="https://habrastorage.org/webt/ab/sl/bt/abslbtgj10nk62g7ksdlx0lusck.png"><br><br>  No final, voc√™ pode excluir mais de 60.000 n√∫meros praticamente sem altera√ß√µes vis√≠veis na foto. <br><br><img src="https://habrastorage.org/webt/we/mq/ma/wemqmatswqyazpgyxm12k-g7l-s.png"><br><br>  No entanto, observe que, se redefinirmos os cinco primeiros n√∫meros, a diferen√ßa ser√° √≥bvia. <br><br><img src="https://habrastorage.org/webt/m0/fj/tj/m0fjtjcfr_-6b50duzk3-zvl7gi.png"><br><br>  Os n√∫meros no in√≠cio indicam mudan√ßas de baixa frequ√™ncia na imagem, e nossos olhos os captam melhor.  Os n√∫meros pr√≥ximos ao final indicam altera√ß√µes nas frequ√™ncias altas que s√£o mais dif√≠ceis de perceber.  Para "ver o que n√£o √© vis√≠vel a olho nu", podemos isolar essas partes de alta frequ√™ncia zerando os primeiros 5000 n√∫meros. <br><br><img src="https://habrastorage.org/webt/si/gj/w2/sigjw20pylfjmu0rzqjocl6oqv4.png"><br><br>  Vemos todas as √°reas da imagem nas quais a maior altera√ß√£o ocorre de pixel para pixel.  Destacam-se os olhos do gato, o bigode, o cobertor felpudo e as sombras no canto inferior esquerdo.  Voc√™ pode ir al√©m limpando os primeiros 10.000 n√∫meros: <br><br><img src="https://habrastorage.org/webt/eg/vi/9a/egvi9a_wkwv48xktp7jiyajnhuc.png"><br><br>  20.000: <br><br><img src="https://habrastorage.org/webt/y9/fr/ri/y9frrialb_94gnwdd-plq_hcyqc.png"><br><br>  40.000: <br><br><img src="https://habrastorage.org/webt/0d/ce/kr/0dcekrobg9_ir-hqnggr9fjlw4u.png"><br><br>  60.000: <br><br><img src="https://habrastorage.org/webt/uo/8f/qx/uo8fqxadj-snukbdf1dcjgvoux0.png"><br><br>  Essas partes de alta frequ√™ncia s√£o jpeg e s√£o exclu√≠das durante a fase de compress√£o.  A convers√£o de cores em coeficientes DCT √© sem perdas.  As perdas s√£o geradas na etapa de discretiza√ß√£o, na qual os valores de alta frequ√™ncia ou quase zero s√£o removidos.  Quando voc√™ diminui a qualidade de salvar o JPEG, o programa aumenta o limite para o n√∫mero de valores exclu√≠dos, o que reduz o tamanho do arquivo, mas torna a imagem mais pixelizada.  Portanto, a imagem na primeira se√ß√£o, que era 57 vezes menor, ficava assim.  Cada bloco 8x8 parecia ter um n√∫mero muito menor de coeficientes de DCT em compara√ß√£o com uma vers√£o melhor. <br><br>  Voc√™ pode criar um efeito interessante, como a transmiss√£o gradual de imagens.  Voc√™ pode exibir uma imagem borrada, que fica mais detalhada √† medida que mais e mais coeficientes s√£o baixados. <br><br>  Aqui, apenas por divers√£o, o que acontece ao usar apenas 24.000 n√∫meros: <br><br><img src="https://habrastorage.org/webt/vn/sf/xr/vnsfxrqyogsnc4qx9pzsok--rno.png"><br><br>  Ou apenas 5000: <br><br><img src="https://habrastorage.org/webt/oi/y3/u6/oiy3u6saz6kliguv_pm8iucdbqa.png"><br><br>  Muito emba√ßado, mas como se fosse reconhec√≠vel! <br><br><h2>  3. Codifica√ß√£o dos comprimentos das s√©ries, delta e Huffman </h2><br>  At√© agora, todos os est√°gios de compress√£o foram perdidos.  A √∫ltima etapa, pelo contr√°rio, fica sem perdas.  Ele n√£o exclui informa√ß√µes, mas reduz significativamente o tamanho do arquivo. <br><br>  Como voc√™ pode compactar algo sem descartar informa√ß√µes?  Imagine como descrever√≠amos um simples ret√¢ngulo preto de 700 x 437. <br><br>  O JPEG usa 5000 n√∫meros para isso, mas um resultado muito melhor pode ser alcan√ßado.  Voc√™ pode imaginar um esquema de codifica√ß√£o que descreva essa imagem com o m√≠nimo de bytes poss√≠vel? <br><br>  O esquema m√≠nimo que eu poderia criar usa quatro: tr√™s para indicar cores e o quarto - quantos pixels t√™m essa cor.  A id√©ia de representar valores repetidos de maneira compactada √© chamada de codifica√ß√£o de comprimento de s√©rie.  N√£o possui perdas, pois podemos restaurar os dados codificados em sua forma original. <br><br>  O tamanho de um arquivo JPEG com um ret√¢ngulo preto √© muito maior que 4 bytes - lembre-se de que no n√≠vel DCT, a compacta√ß√£o √© aplicada a blocos de 8x8 pixels.  Portanto, pelo menos, precisamos de um coeficiente DCT para cada 64 pixels.  Precisamos de um porque, em vez de armazenar um √∫nico coeficiente DCT seguido de 63 zeros, a codifica√ß√£o dos comprimentos das s√©ries nos permite armazenar um n√∫mero e indicar que "todos os outros s√£o zeros". <br><br>  A codifica√ß√£o delta √© uma t√©cnica na qual cada byte cont√©m uma diferen√ßa de algum valor, em vez de um valor absoluto.  Portanto, editar certos bytes altera a cor de todos os outros pixels.  Por exemplo, em vez de armazenar <br><br>  12 13 14 14 14 13 13 14 <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poder√≠amos come√ßar com 12 e, em seguida, simplesmente indicar quanto precisamos adicionar ou subtrair para obter o pr√≥ximo n√∫mero. E essa sequ√™ncia na codifica√ß√£o delta assume a forma: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12 1 1 0 0 -1 0 1 Os </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dados convertidos n√£o s√£o obtidos menos que o original, mas j√° √© mais f√°cil compact√°-lo. O uso da codifica√ß√£o delta antes da codifica√ß√£o das s√©ries pode ajudar bastante, mantendo a compacta√ß√£o sem perdas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A codifica√ß√£o delta √© uma das poucas t√©cnicas usadas fora dos blocos 8x8. Dos 64 coeficientes DCT, um √© simplesmente uma fun√ß√£o de onda constante (cor s√≥lida). Representa o brilho m√©dio de cada bloco para os componentes de lumin√¢ncia ou o azul m√©dio para os componentes Cb, e assim por diante. O primeiro valor de cada bloco DCT √© chamado de valor DC, e cada valor DC passa por uma codifica√ß√£o delta em rela√ß√£o aos anteriores. Portanto, uma altera√ß√£o no brilho do primeiro bloco afetar√° todos os blocos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O √∫ltimo mist√©rio permanece: como a mudan√ßa singular estraga completamente toda a cena? At√© agora, os n√≠veis de compacta√ß√£o n√£o tinham essas propriedades. A resposta est√° no cabe√ßalho JPEG. Os primeiros 500 bytes cont√™m metadados sobre a imagem - largura, altura etc., e at√© agora n√£o trabalhamos com eles.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem um cabe√ßalho, √© quase imposs√≠vel (bem ou muito dif√≠cil) decodificar JPEG. Parece que estou tentando descrever a imagem para voc√™ e come√ßar a inventar palavras para transmitir minha impress√£o. A descri√ß√£o provavelmente ser√° muito concisa, porque posso inventar palavras com exatamente o significado que quero transmitir, mas, para todas as outras, elas n√£o far√£o sentido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece est√∫pido, mas √© exatamente isso que acontece. Cada imagem JPEG √© compactada com c√≥digos espec√≠ficos. Um dicion√°rio de c√≥digos √© armazenado no cabe√ßalho. Essa t√©cnica √© chamada de c√≥digo Huffman e o dicion√°rio √© chamado tabela Huffman. No cabe√ßalho, a tabela √© marcada com dois bytes - 255 e 196. Cada componente de cor pode ter sua pr√≥pria tabela.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Altera√ß√µes nas tabelas afetar√£o radicalmente qualquer imagem. Um bom exemplo √© alterar 1 em 12 na linha 15. </font></font><br><br><img src="https://habrastorage.org/webt/mz/-c/xd/mz-cxdyzf2haxuj1_tojoatbl7s.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso ocorre porque as tabelas indicam como ler bits individuais. At√© agora, trabalhamos apenas com n√∫meros bin√°rios na forma decimal. Mas isso nos oculta o fato de que, se voc√™ deseja armazenar o n√∫mero 1 em um byte, ser√° 00000001, pois cada byte deve ter exatamente oito bits, mesmo que apenas um deles seja necess√°rio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© potencialmente um grande desperd√≠cio de espa√ßo se voc√™ tiver muitos n√∫meros pequenos. O c√≥digo de Huffman √© uma t√©cnica que nos permite relaxar esse requisito, segundo o qual cada n√∫mero deve ocupar oito bits. Isso significa que se voc√™ vir dois bytes: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">234 115</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso, dependendo da tabela de Huffman, pode ter tr√™s n√∫meros. Para extra√≠-los, primeiro √© necess√°rio dividi-los em bits separados: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11101010 01110011 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, passamos √† tabela para entender como agrup√°-los. Por exemplo, podem ser os primeiros seis bits (111010) ou 58 no sistema decimal, seguidos de cinco bits (10011) ou 19 e, finalmente, os √∫ltimos quatro bits (0011) ou 3. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, √© muito dif√≠cil entender bytes nesta fase de compress√£o. Bytes n√£o representam o que parece. N√£o entrarei em detalhes sobre como trabalhar com a tabela neste artigo, mas </font><font style="vertical-align: inherit;">existem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">materiais </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suficientes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre esse assunto na rede </font><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um dos truques interessantes que voc√™ pode fazer se souber separar o cabe√ßalho do JPEG e armazen√°-lo separadamente. </font><font style="vertical-align: inherit;">De fato, acontece que apenas voc√™ pode ler o arquivo. </font><font style="vertical-align: inherit;">O Facebook est√° fazendo isso para reduzir ainda mais o tamanho do arquivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que mais voc√™ pode fazer √© modificar bastante a tabela Huffman. </font><font style="vertical-align: inherit;">Para outros, parecer√° uma imagem danificada. </font><font style="vertical-align: inherit;">E somente voc√™ saber√° a vers√£o m√°gica de sua corre√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para resumir: o que √© necess√°rio para a decodifica√ß√£o JPEG?</font></font> √â necess√°rio: <br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extraia as tabelas Huffman do cabe√ßalho e decodifique os bits. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extraia coeficientes discretos de transforma√ß√£o de cosseno para cada componente de cor e brilho de cada bloco 8x8 executando transforma√ß√µes inversas de codifica√ß√£o de comprimentos e deltas de s√©ries. </font></font></li><li>     ,        88. </li><li>   ,    (    ). </li><li>    YCbCr     RGB. </li><li>    ! </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalho s√©rio para facilitar a visualiza√ß√£o de fotos com um gato! </font><font style="vertical-align: inherit;">No entanto, o que eu mais gosto √© que voc√™ pode ver como a tecnologia JPEG √© centrada no ser humano. </font><font style="vertical-align: inherit;">√â baseado nas caracter√≠sticas de nossa percep√ß√£o, o que nos permite obter uma compress√£o muito melhor do que as tecnologias convencionais. </font><font style="vertical-align: inherit;">E agora, entendendo como o JPEG funciona, voc√™ pode imaginar como essas tecnologias podem ser transferidas para outras √°reas. </font><font style="vertical-align: inherit;">Por exemplo, a codifica√ß√£o delta no v√≠deo pode reduzir bastante o tamanho do arquivo, pois geralmente existem √°reas inteiras que n√£o mudam de quadro para quadro (por exemplo, plano de fundo). </font></font><br><br> <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo usado no artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° aberto e cont√©m instru√ß√µes para substituir imagens por voc√™.</font></font></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454944/">https://habr.com/ru/post/pt454944/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454928/index.html">Maneira de ignorar a tela de bloqueio do Windows em sess√µes RDP</a></li>
<li><a href="../pt454930/index.html">Coleta de lixo na V8: como o novo GC Orinoco funciona</a></li>
<li><a href="../pt454932/index.html">Investimentos e software: 5 terminais de negocia√ß√£o para negocia√ß√£o na bolsa</a></li>
<li><a href="../pt454936/index.html">Vivaldi: o bloqueio de an√∫ncios deve ser a escolha do usu√°rio</a></li>
<li><a href="../pt454940/index.html">Seguro de sa√∫de de viagem: instru√ß√µes detalhadas</a></li>
<li><a href="../pt454946/index.html">Estados globais: por que e como evit√°-los</a></li>
<li><a href="../pt454958/index.html">Um olhar por dentro: p√≥s-gradua√ß√£o na EPFL. Parte 4.1: vida cotidiana</a></li>
<li><a href="../pt454960/index.html">Microbiota. Como os medicamentos afetam as bact√©rias intestinais</a></li>
<li><a href="../pt454962/index.html">Como as empresas de TI do mundo se protegem dos concorrentes em face dos ex-funcion√°rios?</a></li>
<li><a href="../pt454964/index.html">O uso da vis√£o computacional em pesquisas mar√≠timas ou 12 pessoas no peito de um morto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>