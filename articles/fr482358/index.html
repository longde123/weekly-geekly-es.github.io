<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôèÔ∏è üßíüèΩ ‚öìÔ∏è Comment fonctionne la panique √† Rust üÖ∞Ô∏è üî¥ üö¥üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fonctionnement de Rust Panic 


 Que se passe-t-il exactement lorsque vous appelez la panic!() ? 
 R√©cemment, j'ai pass√© beaucoup de temps √† √©tudier l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment fonctionne la panique √† Rust</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482358/"><h1 id="kak-rabotaet-panika-v-rust">  Fonctionnement de Rust Panic </h1><br><p> Que se passe-t-il exactement lorsque vous appelez la <code>panic!()</code> ? <br>  R√©cemment, j'ai pass√© beaucoup de temps √† √©tudier les parties de la biblioth√®que standard associ√©es √† cela et il s'est av√©r√© que la r√©ponse est plut√¥t compliqu√©e! </p><br><p>  Je n'ai pas pu trouver de documents expliquant l'image g√©n√©rale de la panique √† Rust, donc √ßa vaut la peine d'√™tre √©crit. </p><a name="habracut"></a><br><p>  (Article sans vergogne: la raison pour laquelle je me suis int√©ress√© √† ce sujet est que <code>@Aaron1011</code> impl√©ment√© la prise en charge du d√©roulement de la pile dans Miri. </p><br><p>  Je voulais voir cela √† Miri depuis des temps imm√©moriaux, et je n'ai jamais eu le temps de le mettre en ≈ìuvre moi-m√™me, donc c'√©tait vraiment g√©nial de voir comment quelqu'un envoie simplement des <code>PR</code> pour soutenir cela √† l'improviste. </p><br><p>  Apr√®s beaucoup de tours de v√©rification du code, il a √©t√© inject√© r√©cemment. </p><br><p>  Il y a encore <a href="https://github.com/rust-lang/miri/issues%3Fq%3Dis%253Aissue%2Bis%253Aopen%2Blabel%253AA-panics">quelques bords rugueux</a> , mais les bases sont bien d√©finies.) </p><br><p>  Le but de cet article est de documenter la structure de haut niveau et les interfaces associ√©es qui entrent en jeu du c√¥t√© Rust. </p><br><p>  Le m√©canisme de d√©roulement de la pile est un probl√®me compl√®tement diff√©rent (dont je ne suis pas autoris√© √† parler). </p><br><p>  <em>Remarque:</em> cet article d√©crit la panique de <a href="https://github.com/rust-lang/rust/commit/7d761fe0462ba0f671a237d0bb35e3579b8ba0e8">ce commit</a> . </p><br><p>  De nombreuses interfaces d√©crites ici sont des composants internes instables de libstd et peuvent changer √† tout moment. </p><br><h2 id="vysokourovnevaya-struktura">  Structure de haut niveau </h2><br><p>  En essayant de comprendre comment fonctionne la panique en lisant le code dans libstd, vous pouvez facilement vous perdre dans le labyrinthe. <br>  Il existe plusieurs niveaux d'indirection qui sont connect√©s uniquement par l'√©diteur de liens, <br>  il y a <a href="https://doc.rust-lang.org/nomicon/panic-handler.html"><code> #[panic_handler]</code></a> et un <a href="">"runtime panic handler"</a> (contr√¥l√© par la <em>strat√©gie de</em> panique d√©finie via <code>-C panic</code> ) et des <a href="https://doc.rust-lang.org/std/panic/fn.set_hook.html">"panic traps"</a> , et il s'av√®re que la panique dans le contexte de <code>#[no_std]</code> n√©cessite un chemin de code compl√®tement diff√©rent ... tr√®s il se passe beaucoup de choses. </p><br><p>  Pire encore, la <a href="">RFC d√©crivant les pi√®ges de panique les</a> appelle le ¬´gestionnaire de panique¬ª, mais le terme a depuis √©t√© red√©fini. </p><br><p>  Je pense que le meilleur endroit pour commencer est avec des interfaces qui contr√¥lent deux directions: </p><br><ul><li><p>  <em>Le gestionnaire de panique d'ex√©cution est</em> utilis√© par libstd pour contr√¥ler ce qui se passe apr√®s que les informations de panique ont √©t√© imprim√©es sur stderr. <br>  Ceci est d√©termin√© par la <em>strat√©gie de</em> panique: soit nous interrompons ( <code>-C panic=abort</code> ), soit nous commen√ßons le d√©roulement de la pile ( <code>-C panic=unwind</code> d√©roulement). <br>  (La gestion de la panique au moment de l'ex√©cution fournit √©galement une impl√©mentation de <a href="https://doc.rust-lang.org/std/panic/fn.catch_unwind.html"><code>catch_unwind</code></a> , mais nous n'en parlerons pas ici.) </p><br></li><li><p>  <em>Le gestionnaire de panique est</em> utilis√© par libcore pour impl√©menter (a) la panique ins√©r√©e par la g√©n√©ration de code (telle que la panique caus√©e par un d√©passement arithm√©tique ou l'indexation de tableaux / tranches en dehors des limites) et (b) <code>core::panic!</code>  macro (c'est une macro <code>panic!</code> dans libcore lui-m√™me et dans le contexte <code>#[no_std]</code> ). </p><br></li></ul><br><p>  Ces deux interfaces sont impl√©ment√©es via des blocs externes: listd / libcore, respectivement, importent simplement une fonction qu'ils d√©l√®guent, et ailleurs dans l'arborescence, cette fonction est impl√©ment√©e. </p><br><p>  L'importation n'est autoris√©e que pendant la liaison;  En regardant localement le code, on ne peut pas dire o√π r√©side l'impl√©mentation r√©elle de l'interface correspondante. <br>  Il n'est pas surprenant que j'ai √©t√© perdu plusieurs fois en cours de route. </p><br><p>  √Ä l'avenir, ces deux interfaces seront tr√®s utiles;  quand vous vous trompez.  La premi√®re chose √† v√©rifier est de savoir si vous avez confondu <em>le</em> gestionnaire de panique et le gestionnaire de panique au <em>moment de</em> l' <em>ex√©cution</em> . <br>  (Et rappelez-vous qu'il existe √©galement des <em>intercepteurs de</em> panique, nous y arriverons.) <br>  √áa m'arrive tout le temps. </p><br><p>  De plus, <code>core::panic!</code>  et <code>std::panic!</code>  <em>pas la</em> m√™me chose;  comme nous le verrons, ils utilisent des chemins de code compl√®tement diff√©rents. </p><br><p>  libcore et libstd impl√©mentent chacun leur propre fa√ßon de provoquer une panique: </p><br><ul><li><p> <code>core::panic!</code>  de libcore est tr√®s petit: il d√©l√®gue imm√©diatement la panique au <em>gestionnaire</em> . </p><br></li><li><p>  libstd <code>std::panic!</code>  (La <code>panic!</code> "normale" <code>panic!</code> in Rust) lance un moteur de panique enti√®rement fonctionnel qui permet une <a href="https://doc.rust-lang.org/std/panic/fn.set_hook.html"><em>interception de</em> panique</a> contr√¥l√©e par l'utilisateur. <br>  Le hook par d√©faut affichera un message de panique dans stderr. <br>  Une fois la fonction d'interception termin√©e, libstd la d√©l√®gue au gestionnaire de panique au <em>moment de</em> l' <em>ex√©cution</em> . </p><br><p>  libstd fournit √©galement <em>un gestionnaire de</em> panique qui appelle le m√™me m√©canisme, donc <code>core::panic!</code>  se termine √©galement ici. </p><br></li></ul><br><p>  Examinons maintenant ces parties plus en d√©tail. </p><br><h2 id="obrabotka-paniki-vo-vremya-vypolneniya-programmy">  G√©rer la panique pendant l'ex√©cution du programme </h2><br><p>  <a href="">L'interface pour l'ex√©cution de panique</a> (repr√©sent√©e par <a href="">ce RFC</a> ) est la fonction <code>__rust_start_panic(payload: usize) -&gt; u32</code> qui est import√©e par libstd et r√©solue plus tard par l'√©diteur de liens. </p><br><p>  L'argument <code>usize</code> ici est en fait <code>*mut &amp;mut dyn core::panic::BoxMeUp</code> - c'est l'endroit o√π <code>*mut &amp;mut dyn core::panic::BoxMeUp</code> ¬´donn√©es utiles¬ª de la panique (informations disponibles lorsqu'elles sont d√©tect√©es). </p><br><p>  <code>BoxMeUp</code> est un d√©tail d'impl√©mentation interne instable, mais en <a href="">regardant ce type,</a> nous voyons qu'il ne fait que boucler <code>dyn Any + Send</code> , qui est le <a href="https://doc.rust-lang.org/std/thread/type.Result.html">type de donn√©es de panique utiles</a> renvoy√©es par <code>catch_unwind</code> et <code>thread::spawn</code> . </p><br><p>  <code>BoxMeUp::box_me_up</code> renvoie <code>Box&lt;dyn Any + Send&gt;</code> , mais en tant que pointeur brut (puisque <code>Box</code> pas disponible dans le contexte o√π ce type est d√©fini);  <code>BoxMeUp::get</code> emprunte simplement le contenu. </p><br><p>  Deux impl√©mentations de cette interface sont fournies dans <a href="https://github.com/rust-lang/rust/tree/7d761fe0462ba0f671a237d0bb35e3579b8ba0e8/src/libpanic_unwind"><code>libpanic_unwind</code></a> : <a href="https://github.com/rust-lang/rust/tree/7d761fe0462ba0f671a237d0bb35e3579b8ba0e8/src/libpanic_unwind"><code>libpanic_unwind</code></a> pour <code>-C panic=unwind</code> (par d√©faut sur la plupart des plates-formes) et <a href="https://github.com/rust-lang/rust/tree/7d761fe0462ba0f671a237d0bb35e3579b8ba0e8/src/libpanic_abort"><code>libpanic_abort</code></a> pour <code>-C panic=abort</code> . </p><br><h2 id="makros-stdpanic"> <code> std::panic!</code> </h2> <br><p>  En plus de l'interface d' <em>ex√©cution de</em> panique, libstd impl√©mente le m√©canisme de panique Rust par d√©faut dans le module interne <a href=""><code>std::panicking</code></a> . </p><br><h4 id="rust_panic_with_hook"> <code>rust_panic_with_hook</code> </h4> <br><p>  La fonction cl√© √† travers laquelle presque tout se passe est <a href=""><code>rust_panic_with_hook</code></a> : </p><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rust_panic_with_hook</span></span></span></span>( payload: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> dyn BoxMeUp, message: <span class="hljs-built_in"><span class="hljs-built_in">Option</span></span>&lt;&amp;fmt::Arguments&lt;<span class="hljs-symbol"><span class="hljs-symbol">'_</span></span>&gt;&gt;, file_line_col: &amp;(&amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">u32</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">u32</span></span>), ) -&gt; !</code> </pre> <br><p>  Cette fonction accepte l'emplacement de la source de la panique, un message facultatif non format√© (voir <a href="https://doc.rust-lang.org/std/fmt/struct.Arguments.html"><code>fmt::Arguments</code></a> Documentation) et des donn√©es utiles. </p><br><p>  Sa t√¢che principale est de d√©clencher ce qu'est l'intercepteur de panique actuel. <br>  Les intercepteurs de panique ont l'argument <a href="https://doc.rust-lang.org/core/panic/struct.PanicInfo.html"><code>PanicInfo</code></a> , nous avons donc besoin de l'emplacement de la source de panique, des informations de format pour le message de panique et des donn√©es utiles. <br>  Cela correspond tr√®s bien √† l'argument <code>rust_panic_with_hook</code> ! <br>  <code>file_line_col</code> et <code>message</code> peuvent √™tre utilis√©s directement pour les deux premiers √©l√©ments;  <code>payload</code> transforme en <code>&amp;(dyn Any + Send)</code> via l'interface <code>BoxMeUp</code> . </p><br><p>  Fait int√©ressant, l'intercepteur de panique <em>standard</em> ignore compl√®tement le <code>message</code> ;  ce que vous voyez, c'est convertir la charge utile en <a href=""><code>&amp;str</code> ou <code>String</code></a> (peu importe ce qui fonctionne). <br>  Vraisemblablement, l'appelant doit s'assurer que le formatage du <code>message</code> , s'il est pr√©sent, produit le m√™me r√©sultat. <br>  (Et ceux dont nous discutons ci-dessous le garantissent.) </p><br><p>  Enfin, <code>rust_panic_with_hook</code> envoy√© au gestionnaire de panique d' <em>ex√©cution</em> actuel. </p><br><p>  Pour le moment, seule la <code>payload</code> est toujours pertinente - et ce qui est important: <code>message</code> (avec une dur√©e de vie de <code>'_</code> indique que des liens de courte dur√©e peuvent √™tre contenus, mais des donn√©es de panique utiles se propageront dans la pile et devraient donc √™tre avec une <code>'static</code> dur√©e <code>'static</code> vie <code>'static</code> ). </p><br><p>  La <code>'static</code> contrainte <code>'static</code> l√†-bas est assez bien cach√©e, mais apr√®s un certain temps, j'ai r√©alis√© que <a href="https://doc.rust-lang.org/std/any/trait.Any.html"><code>Any</code></a> signifie <code>'static</code> (et rappelez-vous que <code>dyn BoxMeUp</code> juste utilis√© pour obtenir <code>Box&lt;dyn Any + Send&gt;</code> ). </p><br><h4 id="tochki-vhoda-v-libstd">  Points d'entr√©e Libstd </h4><br><p>  <code>rust_panic_with_hook</code> est une fonction priv√©e pour <code>std::panicking</code> ;  le module fournit trois points d'entr√©e en plus de cette fonction centrale et un qui la contourne: </p><br><ul><li><p>  <a href="">L'impl√©mentation par d√©faut du gestionnaire de panique</a> qui prend en charge (comme nous le verrons) la panique de <code>core::panic!</code>  et panique int√©gr√©e (par d√©passement arithm√©tique ou indexation de tableau / tranche). <br>  Obtient <a href="https://doc.rust-lang.org/core/panic/struct.PanicInfo.html"><code>PanicInfo</code></a> en entr√©e, et cela devrait transformer cela en arguments pour <code>rust_panic_with_hook</code> . <br>  Curieusement, bien que les composants <code>PanicInfo</code> et les arguments <code>rust_panic_with_hook</code> assez similaires, et il semble qu'ils puissent simplement √™tre transmis, ce n'est <em>pas le cas</em> . <br>  Au lieu de cela, libstd <em>ignore</em> compl√®tement le composant de <code>payload</code> de <code>PanicInfo</code> et d√©finit la <code>payload</code> r√©elle (transmise √† <code>rust_panic_with_hook</code> ) afin qu'il contienne un <a href=""><code> message</code></a> . </p><br><p>  En particulier, cela signifie que le gestionnaire de panique au moment de l' <code>no_std</code> n'a pas d'importance pour les applications <code>no_std</code> . <br>  Il n'entre en jeu que lorsque l'impl√©mentation du gestionnaire de panique dans libstd est utilis√©e. <br>  ( <em>La strat√©gie de</em> panique choisie via <code>-C panic</code> toujours importante, car elle affecte √©galement la g√©n√©ration de code. <br>  Par exemple, avec <code>-C panic=abort</code> code peut devenir plus simple, car vous n'avez pas besoin de prendre en charge le d√©roulement de la pile). </p><br></li><li><p>  <a href=""><code>begin_panic_fmt</code></a> , prenant en charge la version du <a href=""><code>  std::panic!</code></a>  (c'est-√†-dire que cela est utilis√© lorsque vous passez plusieurs arguments √† une macro). <br>  Fondamentalement, il suffit d' <code>PanicInfo</code> arguments de cha√Æne de format dans <code>PanicInfo</code> (avec <a href="">des charges utiles factices</a> ) et d'appeler les gestionnaires de panique par d√©faut dont nous venons de parler. </p><br></li><li><p>  <a href=""><code>begin_panic</code></a> supportant la <a href=""><code> std::panic!</code></a>  avec <a href=""><code>  std::panic!</code></a>  . <br>  Fait int√©ressant, cela utilise un chemin de code compl√®tement diff√©rent de celui des deux autres points d'entr√©e! <br>  En particulier, c'est le seul point d'entr√©e qui vous permet de transf√©rer <em>des donn√©es utiles arbitraires</em> . <br>  Cette charge utile est simplement <a href=""><code>  Box&lt;dyn Any + Send&gt;</code></a> afin qu'elle puisse √™tre transmise √† <code>rust_panic_with_hook</code> , et c'est tout. </p><br><p>  En particulier, un intercepteur de panique qui regarde le champ de <code>message</code> de <code>PanicData</code> <em>ne</em> pourra pas voir le message dans <code>std::panic!("do panic")</code> , mais il <em>peut</em> voir le message dans <code>std::panic!("panic with data: {}", data)</code> car ce dernier passe √† la <code>begin_panic_fmt</code> par <code>begin_panic_fmt</code> . <br>  Cela semble assez g√©nial.  (Mais notez √©galement que <code>PanicData::message()</code> n'est pas encore stable.) </p><br></li><li><p>  <a href=""><code>update_count_then_panic</code></a> s'est av√©r√© √©trange: ce point d'entr√©e prend en charge <a href="https://doc.rust-lang.org/nightly/std/panic/fn.resume_unwind.html"><code>resume_unwind</code></a> et ne provoque <em>pas</em> r√©ellement d'interception de panique. <br>  Au lieu de cela, il est imm√©diatement envoy√© au gestionnaire de panique. <br>  Par exemple, <code>begin_panic</code> permet √† l'appelant de s√©lectionner des donn√©es utiles arbitraires. <br>  Contrairement √† <code>begin_panic</code> , la fonction appelante est responsable de l'emballage et du dimensionnement de la charge utile;  La fonction <code>update_count_then_panic</code> transmet simplement ses arguments presque textuellement au gestionnaire de panique au moment de l'ex√©cution. </p><br></li></ul><br><h2 id="obrabotchik-paniki">  Gestionnaire de panique </h2><br><p> <code>std::panic!</code>  Le m√©canisme est vraiment utile, mais il n√©cessite de placer des donn√©es sur le tas via <code>Box</code> , qui n'est pas toujours disponible. <br>  Pour donner √† libcore un moyen de provoquer la panique, des <a href="">gestionnaires de</a> panique ont √©t√© introduits. <br>  Comme nous l'avons vu, si libstd est disponible, il fournit une impl√©mentation de cette interface <code>core::panic!</code>  panique dans les vues libstd. </p><br><p>  <a href="">L'interface du gestionnaire de panique</a> est la fonction de <code>fn panic(info: &amp;core::panic::PanicInfo) -&gt; !</code>  libcore importe, et cela est r√©solu plus tard par l'√©diteur de liens. <br>  Le type <a href="https://doc.rust-lang.org/core/panic/struct.PanicInfo.html"><code>PanicInfo</code></a> est le m√™me que pour les intercepteurs de panique: il contient l'emplacement de la source de panique, un message de panique et des donn√©es utiles ( <code>dyn Any + Send</code> ). <br>  Le message de panique est pr√©sent√© sous la forme <a href="https://doc.rust-lang.org/std/fmt/struct.Arguments.html"><code>fmt::Arguments</code></a> , c'est-√†-dire une cha√Æne de formatage avec des arguments qui n'ont pas encore √©t√© format√©s. </p><br><h2 id="makros-corepanic"> <code> core::panic!</code> </h2> <br><p>  En plus de l'interface du processeur de panique, libcore fournit une <a href="">API de panique minimale</a> . <br> <a href=""><code>core::panic!</code></a>  la macro cr√©e <code>fmt::Arguments</code> qui est ensuite <a href="">pass√© au gestionnaire de panique</a> . <br>  Le formatage ne se produit pas ici, car cela n√©cessitera l'allocation de m√©moire sur le tas;  C'est pourquoi <code>PanicInfo</code> contient une cha√Æne de format ¬´ <code>PanicInfo</code> ¬ª avec ses arguments. </p><br><p>  Curieusement, le champ de <code>payload</code> de <code>PanicInfo</code> transmis au gestionnaire de panique, toujours d√©fini sur une <a href="">valeur fictive</a> . <br>  Cela explique pourquoi le gestionnaire de panique libstd ignore les donn√©es de charge utile (et cr√©e √† la place de nouvelles donn√©es de charge utile √† partir du <code>message</code> ), mais je me demande pourquoi ce champ fait partie de l'API du gestionnaire de panique. <br>  Une autre cons√©quence de cela est que <a href=""><code>core::panic!("message")</code></a> et <a href=""><code>std::panic!("message")</code></a> (options sans aucun formatage) conduisent en fait √† des paniques tr√®s diff√©rentes: la premi√®re se transforme en <code>fmt::Arguments</code> , transmis via l'interface du gestionnaire de panique, puis libstd cr√©e des donn√©es <code>String</code> utiles en les formatant. <br>  Cependant, ce dernier utilise directement <code>&amp;str</code> comme donn√©es utiles, et le champ de <code>message</code> reste <code>None</code> (comme d√©j√† mentionn√©). </p><br><p>  Certains √©l√©ments de l'API panic dans libcore sont des √©l√©ments de langage car le compilateur ins√®re des appels √† ces fonctions lors de la g√©n√©ration du code: </p><br><ul><li>  Un √©l√©ment <a href=""><code> panic</code></a> est appel√© lorsque le compilateur doit provoquer une panique qui ne n√©cessite aucune mise en forme (par exemple, d√©passement arithm√©tique);  c'est la m√™me fonction qui prend √©galement en charge <a href=""><code>core::panic!</code></a>  avec un argument <a href=""><code>core::panic!</code></a>  . </li><li>  <a href=""><code>  panic_bounds_check</code></a> est appel√© en cas d'√©chec de la v√©rification des limites d'un tableau / d'une tranche; il appelle la m√™me m√©thode que <a href=""><code>core::panic!</code></a>  <a href="">avec formatage</a> . </li></ul><br><h2 id="vyvody">  Conclusions </h2><br><p>  Nous sommes pass√©s par 4 niveaux d'API, dont 2 ont √©t√© redirig√©s via des appels de fonction import√©s et r√©solus par l'√©diteur de liens. <br>  Quel voyage! <br>  Mais nous avons atteint la fin. <br>  J'esp√®re que vous <a href="https://en.wikipedia.org/wiki/Phrases_from_The_Hitchhiker%2527s_Guide_to_the_Galaxy">n'avez pas paniqu√© en</a> cours de route.  ;) </p><br><p>  J'ai mentionn√© des choses incroyables. <br>  Il s'av√®re que tous sont li√©s au fait que les intercepteurs de panique et les processeurs de panique partagent la structure <code>PanicInfo</code> dans leur interface, qui contient <em>un</em> <code>message</code> et une <code>payload</code> √©ventuellement format√©s avec un type effac√©: </p><br><ul><li>  <em>Un intercepteur de</em> panique peut toujours trouver un message d√©j√† format√© dans la <code>payload</code> , donc le <code>message</code> semble inutile pour les intercepteurs. En fait, le <code>message</code> peut ne pas √™tre pr√©sent m√™me si la <code>payload</code> contient un message (par exemple, pour <code>std::panic!("message")</code> ). </li><li>  <em>Le gestionnaire de</em> panique ne recevra jamais r√©ellement de <code>payload</code> , le champ semble donc inutile aux gestionnaires. </li></ul><br><p>  En lisant le <a href="">RFC √† partir de la description du gestionnaire de panique</a> , il semble que le plan √©tait pour <code>core::panic!</code>  prennent √©galement en charge des donn√©es arbitraires utiles, mais jusqu'√† pr√©sent, cela ne s'est pas concr√©tis√©. <br>  N√©anmoins, m√™me avec cette future extension, je pense que nous avons un invariant que lorsque le <code>message</code> est <code>Some</code> , alors soit <code>payload == &amp;NoPayload</code> (donc les donn√©es utiles sont redondantes) ou <code>payload</code> est un message format√© (donc le message est redondant). </p><br><p>  Je me demande s'il y a un cas o√π les <em>deux</em> champs seront utiles et sinon, pouvons-nous encoder cela en leur faisant deux variantes d' <code>enum</code> ? </p><br><p>  Il y a probablement de bonnes raisons contre cette proposition pour la conception actuelle;  ce serait formidable de les obtenir quelque part dans le format de documentation.  :) </p><br><p>  Il y a beaucoup plus √† dire, mais √† ce stade, je vous invite √† suivre les liens vers le code source que j'ai inclus ci-dessus. </p><br><p>  Avec une structure de haut niveau √† l'esprit, vous devriez pouvoir suivre ce code. <br>  Si les gens pensaient que cette critique devrait √™tre plac√©e quelque part pour toujours, je serais heureux de transformer cet article en blog en une sorte de documentation - m√™me si je ne suis pas s√ªr que ce soit un bon endroit. </p><br><p>  Et si vous trouvez des erreurs dans ce que j'ai √©crit, faites-le moi savoir! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482358/">https://habr.com/ru/post/fr482358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482344/index.html">Pr√©parez-vous √† l'introduction d'un classement social en Russie</a></li>
<li><a href="../fr482346/index.html">ASP.NET MVC - travailler avec MySQL via ADO.NET</a></li>
<li><a href="../fr482352/index.html">Comme j'ai jet√© presque 150k dans le vent ou l'histoire de l'installation de la ventilation forc√©e dans l'appartement</a></li>
<li><a href="../fr482354/index.html">ConfigureAwait: Foire aux questions</a></li>
<li><a href="../fr482356/index.html">Utilisation de Windows Server sans explorateur du point de vue d'un utilisateur Windows classique</a></li>
<li><a href="../fr482360/index.html">D√©tective Habra: ils sont amis avec les OVNIS</a></li>
<li><a href="../fr482364/index.html">Choses que vous [peut-√™tre] ne saviez pas sur Java</a></li>
<li><a href="../fr482366/index.html">Ce que les experts en robotique pensent du pilote automatique Tesla</a></li>
<li><a href="../fr482370/index.html">nodejs: gestionnaires de processus et modules ES6</a></li>
<li><a href="../fr482372/index.html">Activer le mode de session am√©lior√© pour les invit√©s Arch Linux dans Hyper-V</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>