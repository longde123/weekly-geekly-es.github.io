<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé≥ üë®üèø‚Äçüî¨ üòé Zwei in einem: Wi-Fi programmierbarer Luftqualit√§tsmonitor und Uhr ‚òòÔ∏è üêÖ üå•Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zu einer Zeit mochte ich den Luftqualit√§tsmonitor aus der Ver√∂ffentlichung von Sergey Silnov, ‚ÄûKompakter Haushaltsluftmonitor (CO2, Temperatur, Luftfe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zwei in einem: Wi-Fi programmierbarer Luftqualit√§tsmonitor und Uhr</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442856/"><p>  Zu einer Zeit mochte ich den Luftqualit√§tsmonitor aus der Ver√∂ffentlichung von Sergey Silnov, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚ÄûKompakter Haushaltsluftmonitor (CO2, Temperatur, Luftfeuchtigkeit, Druck) mit WLAN und mobiler Schnittstelle‚Äú</a> . </p><br><p>  In dem Luftqualit√§tsmonitor (im Folgenden als Monitor bezeichnet) aus dem Projekt von Sergey werden Informationen von Sensoren f√ºr Temperatur, Luftfeuchtigkeit, Druck und CO2-Gehalt in der Luft vom ESP8266-Controller verarbeitet und in mehreren Bildern auf einem monochromen Bildschirm angezeigt.  Dar√ºber hinaus wird auf dem Monitor √ºber das Formular im Browser der Blynk-Dienstidentifikationsschl√ºssel im ESP8266-Speicher gespeichert und die Daten werden automatisch an Blynk gesendet. </p><br><p>  Der Monitor hatte ein ernstes Problem: Er st√ºrzte beim Ein- und Ausschalten oder sogar beim ‚ÄûBlinken‚Äú der Versorgungsspannung des Monitors ab. </p><br><p>  Ich wiederholte das Projekt mit geringf√ºgigen √Ñnderungen, und um das Einfrieren des Monitors zu vermeiden, f√ºgte ich der Schaltung alternative Stromversorgung hinzu.  Einfach wie ein Rechen: Die Relaiswicklung befand sich unter der Spannung des AC / DC-Adapters, und die Relaiskontakte schalteten die Stromversorgung des Adapters auf die Batterien um, als die Spannung im 220-V-Netzwerk verschwand. </p><br><p>  Mein imagin√§rer Erfolg dauerte bis zum ersten langen Ausfall im Haus (das passiert bei uns).  Billige Batterien waren ersch√∂pft, bevor die Spannung in den Steckdosen auftrat, und ich kehrte zum Ausgangspunkt zur√ºck. </p><br><p>  Nachdem ich auf seinen eigenen Rechen getreten war, beschloss ich, nicht nach einfachen L√∂sungen zu suchen. </p><a name="habracut"></a><br><p>  √Ñnderungen / Erg√§nzungen an der Skizze von S. Silnov: </p><br><ul><li>  Der Monitor wird 90 Sekunden nach dem Aus- und Wiedereinschalten der Versorgungsspannung des Monitors automatisch offline geschaltet, wenn zu diesem Zeitpunkt kein WLAN verf√ºgbar ist. </li><li>  Die Grenztemperaturwerte, der CO2-Gehalt, die Luftfeuchtigkeit sowie die Zeitzone und die Winter- / Sommerzeit werden wie der Blynk-Schl√ºssel aus dem Formular im Browser in den ESP8266-Speicher eingegeben. </li><li>  Die √Ñnderung der Grenzwerte wird radikal vereinfacht.  Wenn diese Prozedur fr√ºher √ºber den Code-Compiler ausgef√ºhrt wurde, reicht es jetzt aus, den Datensatz in einem der Formularfelder von "0" auf "1" zu √§ndern.  Diese Arbeit ist nicht einmal f√ºr fortgeschrittene Benutzer machbar geworden. </li><li>  Informationen zur Bedienung des Monitors werden auf dem Farbbildschirm 128 x 128 (1,44 Zoll) in einem Bild angezeigt.  Die Ausgabe von Luftparametern √ºber die Grenzwerte hinaus wird im Rahmen farbig angezeigt. </li><li>  Im Monitor wird der W√§rmeindex (Humindex) berechnet und auf dem Bildschirm angezeigt. </li><li>  Benachrichtigungen werden vom Monitor per E-Mail gesendet, wenn die Temperatur, der CO2-Gehalt oder die Luftfeuchtigkeit au√üerhalb der vom Benutzer festgelegten Schwellenwerte liegen. </li><li>  Der Monitor kann funktionieren, ohne eine Verbindung zum Blynk-Dienst und zur E-Mail-Adresse herzustellen. </li><li>  Dem Monitor wurde eine analoge Echtzeituhr hinzugef√ºgt, die √ºber das Internet mit dem genauen Zeitserver synchronisiert wird. </li></ul><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/dp/hc/ba/dphcba8d2lt2ihdpvatv2m_a0pu.gif"></div><br><p>  Dies ist eine der ungel√∂sten Aufgaben meines Projekts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚ÄûWireless Wi-Fi programmierbarer Raumthermostat mit Luftqualit√§tsmonitor und anderen n√ºtzlichen Funktionen‚Äú</a> .  Ich habe beschlossen, diese Aufgabe als separaten Artikel zu formalisieren, da sich heutzutage viele f√ºr die Luftqualit√§t im Wohnungsbau interessieren. </p><br><h2>  Montage </h2><br><p>  F√ºr die Montage des Ger√§ts ben√∂tigen Sie Komponenten, deren Liste und deren gesch√§tzte Kosten zu den Preisen der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AliExpress-</a> Website in der Tabelle aufgef√ºhrt sind. </p><br><p></p><table border="1"><tbody><tr><td>  <strong>Komponente</strong> </td><td>  <strong>Preis ($)</strong> </td></tr><tr><td>  Wi-Fi-Karte NodeMCU CP2102 ESP8266 </td><td>  2,53 </td></tr><tr><td>  Temperatur- und Feuchtigkeitssensor DHT22 </td><td>  2,34 </td></tr><tr><td>  CO2-Gehaltssensor MH Z-19 </td><td>  18.50 </td></tr><tr><td>  Bildschirm TFTLCD 1.44 "SPI 128x128 </td><td>  2.69 </td></tr><tr><td>  RTC DS3231 Uhr </td><td>  1,00 </td></tr><tr><td>  Montagedr√§hte, andere Kleinigkeiten </td><td>  2.00 </td></tr><tr><td>  <strong><em>Insgesamt (ungef√§hr):</em></strong> </td><td>  <strong><em>30</em></strong> </td></tr></tbody></table><br><p>  Das Gehirn des Monitors ist der ESP8266-Controller auf der Platine des NodeMCU CP2102-Moduls.  Es empf√§ngt Signale von Sensoren, √ºberwacht und erzeugt ein Bildschirmsteuersignal, synchronisiert die Uhr und sendet Informationen an Blynk und per E-Mail. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/qw/zn/q7/qwznq7uggbl-1rmx1esmdtwpopg.png"></a> </p><br><p>  Leider habe ich die Fritzing-Bibliothek f√ºr den 128 x 128-Farbbildschirm mit 1,44 Zoll und einer 8-poligen Pinbelegung nicht gefunden, sodass der Bildschirm √ºber einen 11-poligen Bildschirm verf√ºgt.  Achten Sie bei der Montage nicht auf die Position der Bildschirmausgabe im Verh√§ltnis zu anderen, sondern auf deren Funktionsbelastung. </p><br><p>  F√ºr diejenigen, die keinen Prototyp f√ºr den Schaltplan zusammenbauen m√∂chten, die Verbindungstabelle: </p><br><p></p><table border="1"><tbody><tr><td>  <strong>NodeMCU (GPIO)</strong> </td><td>  <strong>Sensorstift</strong> </td></tr><tr><td>  D0 (GPIO 16) </td><td>  disp_1.44, CS </td></tr><tr><td>  D1 (GPIO 5) </td><td>  DS3231, SCL </td></tr><tr><td>  D2 (GPIO 4) </td><td>  DS3231, SDA </td></tr><tr><td>  D3 (GPIO 0) </td><td>  DHT22, DATA; </td></tr><tr><td>  D4 (GPIO 2) </td><td>  disp_1.44, A0 </td></tr><tr><td>  D5 (GPIO 14) </td><td>  disp_1.44, SCK </td></tr><tr><td>  D6 (GPIO 12) </td><td>  disp_1.44, RST </td></tr><tr><td>  D7 (GPIO 13) </td><td>  disp_1.44, SDA </td></tr><tr><td>  D8 (GPIO 15) </td><td>  GND </td></tr><tr><td>  Tx </td><td>  MH-Z19, Rx </td></tr><tr><td>  Rx </td><td>  MH-Z19, Tx </td></tr><tr><td>  Vin (5 V) </td><td>  disp_1.44, Vcc;  DHT22;  Mh-z19 </td></tr><tr><td>  3,3V </td><td>  disp_1.44, LED;  DS3231, Vcc </td></tr><tr><td>  GND </td><td>  Sensoren, GND </td></tr></tbody></table><br><p>  Wenn Sie im Uhrenmodul eine Batterie anstelle einer Batterie verwenden, vergessen Sie nicht, den Batterieladekreis zu unterbrechen, da sonst die Batterie nach einigen Wochen unter Spannung anschwillt.  Mit einer Taktgenauigkeit von 2 Sekunden pro Jahr sind Sie garantiert. </p><br><p>  Die Spannung des <em>5-V-</em> Monitors kann vom USB-Anschluss des Computers mit einem Standard- <em>USB-</em> Kabel <em>(microUSB)</em> an das <em>NodeMCU esp12-</em> Modul <em>geliefert</em> werden. </p><br><p>  Die Monitorskizze zum Laden in den ESP8266 befindet sich unter dem Spoiler. </p><br><p>  Seien Sie f√ºr alle F√§lle nicht zu faul, um den integrierten I2C-Treiber f√ºr den Arduino ESP8266-Kern zu optimieren.  Anweisungen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Monitorskizze</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* *   :   Wi-Fi       * aqm_32F_14F_P */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;FS.h&gt; #include &lt;Arduino.h&gt; #include &lt;ESP8266WiFi.h&gt; //https://github.com/esp8266/Arduino // Wifi Manager #include &lt;DNSServer.h&gt; #include &lt;ESP8266WebServer.h&gt; #include &lt;WiFiManager.h&gt; //https://github.com/tzapu/WiFiManager //OLED #include &lt;SPI.h&gt; #include &lt;Adafruit_GFX.h&gt; #include &lt;TFT_ILI9163C.h&gt; //clock #include &lt;pgmspace.h&gt; #include &lt;TimeLib.h&gt; #include &lt;ESP8266WiFi.h&gt; #include &lt;WiFiUdp.h&gt; #include &lt;Wire.h&gt; #include &lt;RtcDS3231.h&gt; RtcDS3231&lt;TwoWire&gt; Rtc(Wire); #define countof(a) (sizeof(a) / sizeof(a[0])) //e-mail #include &lt;ESP8266WiFiMulti.h&gt; #include &lt;ESP8266HTTPClient.h&gt; #define USE_SERIAL Serial ESP8266WiFiMulti WiFiMulti; //e-mail, address char address[64] {"e-mail"}; // HTTP requests #include &lt;ESP8266HTTPClient.h&gt; // OTA updates #include &lt;ESP8266httpUpdate.h&gt; // Blynk #include &lt;BlynkSimpleEsp8266.h&gt; // Debounce #include &lt;Bounce2.h&gt; //https://github.com/thomasfredericks/Bounce2 // JSON #include &lt;ArduinoJson.h&gt; //https://github.com/bblanchon/ArduinoJson // Debounce interval in ms #define DEBOUNCE_INTERVAL 10 Bounce hwReset {Bounce()}; // Humidity/Temperature #include &lt;DHT.h&gt; #define DHTPIN 0 //D3 gpio0, DHT22 DATA #define DHTTYPE DHT22 // DHT 22 DHT dht(DHTPIN, DHTTYPE); // Blynk token char blynk_token[33] {"Blynk token"}; // Setup Wifi connection WiFiManager wifiManager; // Network credentials String ssid { "am180206" }; String pass { "vb654321" }; //flag for saving data bool shouldSaveConfig = false; // Sensors data float t {-100}, t_old{-100}; float hic {-1}, hic_old{-1}; int h {-1}, h_old{-1}; int co2 {-1}, co2_old{-1}; char Tmn[5]{}, Tmx[5]{}, Hmn[5]{}, Cmx[7]{}, tZ[5]{}, timeSW[4]{}, formFS[]{"0"}; //  t, h  co2, .  float Tmin, Tmax, Hmin, Cmax, tZone, timeSummerWinter, formatingFS; float trp = 0; int crbn, bl, ml=18000; int md; // : 1 - , 2 -  int blnk; // Color definitions #define BLACK 0x0000 #define BLUE 0x001F #define RED 0xF800 #define GREEN 0x07E0 #define CYAN 0x07FF #define MAGENTA 0xF81F #define YELLOW 0xFFE0 #define WHITE 0xFFFF #define GRAY 0x9999 #define __CS 16 //D0(gpio16)- CS(display) #define __DC 2 //D4 gpio2 - AO(display) #define __RST 12 // D6 gpio12 - RESET(display) //char datestring[20]; char time_r[9]; char date_r[12]; //analog clock uint16_t ccenterx = 64,ccentery = 70;//center x,y of the clock clock const uint16_t cradius = 40;//radius of the clock const float scosConst = 0.0174532925; float sx = 0, sy = 1, mx = 1, my = 0, hx = -1, hy = 0; float sdeg=0, mdeg=0, hdeg=0; uint16_t osx,osy,omx,omy,ohx,ohy; uint16_t x0 = 0, x1 = 0, yy0 = 0, yy1 = 0; //uint32_t targetTime = 0;// for next 1 second timeout uint8_t hh,mm,ss; //containers for current time TFT_ILI9163C display = TFT_ILI9163C(__CS, __DC, __RST); String utf8(String source) { int i,k; String target; unsigned char n; char m[2] = { '0', '\0' }; k = source.length(); i = 0; while (i &lt; k) { n = source[i]; i++; if (n &gt;= 0xC0) { switch (n) { case 0xD0: { n = source[i]; i++; if (n == 0x81) { n = 0xA8; break; } if (n &gt;= 0x90 &amp;&amp; n &lt;= 0xBF) n = n + 0x30; break; } case 0xD1: { n = source[i]; i++; if (n == 0x91) { n = 0xB8; break; } if (n &gt;= 0x80 &amp;&amp; n &lt;= 0x8F) n = n + 0x70; break; } } } m[0] = n; target = target + String(m); } return target; } // NTP Servers: //static const char ntpServerName[] = "us.pool.ntp.org"; static const char ntpServerName[] = "time.nist.gov"; //const int timeZone = 2; // , , , , ,  //const int timeSummer = 1; WiFiUDP Udp; unsigned int localPort = 2390; // local port to listen for UDP packets time_t getNtpTime(); void digitalClockDisplay(); void printDigits(int digits); void sendNTPpacket(IPAddress &amp;address); void readCO2(){ #define mySerial Serial static byte cmd[9] = {0xFF,0x01,0x86,0x00,0x00,0x00,0x00,0x00,0x79}; //  byte response[9]; byte crc = 0; while (mySerial.available())mySerial.read();//  UART   memset(response, 0, 9);//   mySerial.write(cmd,9);//    CO2 mySerial.readBytes(response, 9);// 9    //   crc = 0; for (int i = 1; i &lt;= 7; i++) { crc += response[i]; } crc = ((~crc)+1); { // CRC if ( !(response[0] == 0xFF &amp;&amp; response[1] == 0x86 &amp;&amp; response[8] == crc) ) { Serial.println("CRC error"); } else { //  CO2 co2 = (((unsigned int) response[2])&lt;&lt;8) + response[3]; Serial.println("CO2: " + String(co2) + "ppm"); } } } void sendMeasurements() { float t1 {-100}, hic1 {-1}; float h1 {-1}; // Temperature t1 = dht.readTemperature(); if ((t1 &gt; -1) and (t1 &lt; 100)) t = t1; Serial.println("T: " + String(t) + "*C"); // Humidity h1 = dht.readHumidity(); if ((h1 &gt; -1) and (h1 &lt; 100)) h = h1; Serial.println("H: " + String(h) + "%"); // Humindex hic1 = dht.computeHeatIndex(t, h, false); if (t &gt;= 21.0) hic = hic1; else hic = t; Serial.println("Ti: "+String(hic)+"*C"); // CO2 crbn++; if (crbn &gt; 110) {readCO2(); crbn = 0; Serial.println("CO2: " + String(co2) + "ppm"); } } void drawConnectionDetails() { display.clearScreen(); display.setTextSize(1); display.setCursor(12,24); display.setTextColor(WHITE); display.println(utf8("Connect to WiFi:")); display.setCursor(12,36); display.println(utf8("net: " + String(ssid))); display.setCursor(12,48); display.println(utf8("pass: " + String(pass))); display.setCursor(12,60); display.println(utf8("Open browser:")); display.setCursor(12,72); display.println(utf8("http://192.168.4.1")); display.setCursor(2,84); display.setTextColor(RED); display.println(utf8(" Enter your personal information!")); } void digitalClockDisplay() { // digital clock display of the time Serial.print(hour()); printDigits(minute()); printDigits(second()); Serial.print(" "); Serial.print(day()); Serial.print("."); Serial.print(month()); Serial.print("."); Serial.print(year()); Serial.println(); } void printDigits(int digits) { // utility for digital clock display: prints preceding colon and leading 0 Serial.print(":"); if (digits &lt; 10) Serial.print('0'); Serial.print(digits); } // NTP code const int NTP_PACKET_SIZE = 48; // NTP time is in the first 48 bytes of message byte packetBuffer[NTP_PACKET_SIZE]; //buffer to hold incoming &amp; outgoing packets time_t getNtpTime() { int tZoneI, timeSummerWinterI; tZoneI = (int)tZone; timeSummerWinterI = (int)timeSummerWinterI; IPAddress ntpServerIP; // NTP server's ip address while (Udp.parsePacket() &gt; 0) ; // discard any previously received packets Serial.println("Transmit NTP Request"); // get a random server from the pool WiFi.hostByName(ntpServerName, ntpServerIP); Serial.print(ntpServerName); Serial.print(": "); Serial.println(ntpServerIP); sendNTPpacket(ntpServerIP); uint32_t beginWait = millis(); while (millis() - beginWait &lt; 1500) { int size = Udp.parsePacket(); if (size &gt;= NTP_PACKET_SIZE) { Serial.println("Receive NTP Response"); Udp.read(packetBuffer, NTP_PACKET_SIZE); // read packet into the buffer unsigned long secsSince1900; // convert four bytes starting at location 40 to a long integer secsSince1900 = (unsigned long)packetBuffer[40] &lt;&lt; 24; secsSince1900 |= (unsigned long)packetBuffer[41] &lt;&lt; 16; secsSince1900 |= (unsigned long)packetBuffer[42] &lt;&lt; 8; secsSince1900 |= (unsigned long)packetBuffer[43]; return secsSince1900 - 2208988800UL + tZoneI * SECS_PER_HOUR + timeSummerWinterI * SECS_PER_HOUR; } } Serial.println("No NTP Response :-("); return 0; // return 0 if unable to get the time } // send an NTP request to the time server at the given address void sendNTPpacket(IPAddress &amp;address) { // set all bytes in the buffer to 0 memset(packetBuffer, 0, NTP_PACKET_SIZE); // Initialize values needed to form NTP request // (see URL above for details on the packets) packetBuffer[0] = 0b11100011; // LI, Version, Mode packetBuffer[1] = 0; // Stratum, or type of clock packetBuffer[2] = 6; // Polling Interval packetBuffer[3] = 0xEC; // Peer Clock Precision // 8 bytes of zero for Root Delay &amp; Root Dispersion packetBuffer[12] = 49; packetBuffer[13] = 0x4E; packetBuffer[14] = 49; packetBuffer[15] = 52; // all NTP fields have been given values, now // you can send a packet requesting a timestamp: Udp.beginPacket(address, 123); //NTP requests are to port 123 Udp.write(packetBuffer, NTP_PACKET_SIZE); Udp.endPacket(); } void draw(){ //temperature display.setTextSize(1); display.setCursor(1,6); display.setTextColor(CYAN); display.println(utf8("T: CO2:")); String t_p; t_p = String(t); char t_p_m [12]; t_p.toCharArray(t_p_m, 5); if (t != t_old) { display.fillRect(1,15,48,18,BLACK); display.setTextSize(2); display.setCursor(1,15); display.setTextColor(GREEN); if(t &lt; Tmin) display.setTextColor(RED); if(t &gt; Tmax) display.setTextColor(RED); if ((t &gt; -100) and (t &lt; 100)) display.println(utf8(String(t_p_m))); else display.println(utf8("----"));} //heat index display.setTextSize(1); display.setCursor(2,98); display.setTextColor(CYAN); display.println(utf8("H: Ti:")); String hic_p; hic_p = String(hic); char hic_p_m [12]; hic_p.toCharArray(t_p_m, 5); if (hic != hic_old) { display.fillRect(80,108,48,18,BLACK); display.setTextSize(2); display.setCursor(80,108); display.setTextColor(GREEN); // if(t &lt; Tmin) display.setTextColor(RED); if(hic &gt; 27.0) display.setTextColor(YELLOW); if(hic &gt; 31.0) display.setTextColor(RED); if ((hic &gt; 0) and (hic &lt; 100)) display.println(utf8(String(t_p_m))); else display.println(utf8("----"));} //CO2 if (co2 != co2_old) { display.fillRect(80,15,48,18,BLACK); display.setTextSize(2); display.setCursor(80,15); display.setTextColor(GREEN); if (co2 &gt; Cmax) display.setTextColor(RED); if (co2 &gt; 600) display.setTextColor(CYAN); if ((co2 &gt; -1) and (co2 &lt;= 2000)) display.println(utf8(String(co2))); else display.println(utf8("---")); } //humidity if (h != h_old) { display.fillRect(1,108,49,18,BLACK); display.setTextSize(2); display.setCursor(1,108); display.setTextColor(GREEN); if (h &lt; Hmin) display.setTextColor(RED); if (h &gt; 60) display.setTextColor(RED); if ((h &gt; -1) and (h &lt; 100)) display.println(utf8(String(h))); else display.println(utf8("--")); } //date if (hh==0) display.fillRect(28,1,60,10,BLACK); display.setCursor(28,1); display.setTextSize(1); display.setTextColor(CYAN); display.println(utf8(date_r)); //OFFLINE if (md == 2) { display.fillRect(106,44,18,8,RED); display.setCursor(106,44); display.setTextSize(1); display.setTextColor(CYAN); display.println(" A"); } //OFF BLYNK if (blnk == 1) { display.fillRect(106,44,18,8,RED); display.setCursor(106,44); display.setTextSize(1); display.setTextColor(CYAN); display.println(" B"); } } void synchronClockA() { Rtc.Begin(); Serial.print("IP number assigned by DHCP is "); Serial.println(WiFi.localIP()); Serial.println("Starting UDP"); Udp.begin(localPort); Serial.print("Local port: "); Serial.println(Udp.localPort()); Serial.println("waiting for sync"); setSyncProvider(getNtpTime); //setSyncInterval(300); if(timeStatus() != timeNotSet){ digitalClockDisplay(); Serial.println("here is another way to set rtc"); time_t t = now(); char date_0[12]; snprintf_P(date_0, countof(date_0), PSTR("%s %02u %04u"), monthShortStr(month(t)), day(t), year(t)); Serial.println(date_0); char time_0[9]; snprintf_P(time_0, countof(time_0), PSTR("%02u:%02u:%02u"), hour(t), minute(t), second(t)); Serial.println(time_0); Serial.println("Now its time to set up rtc"); RtcDateTime compiled = RtcDateTime(date_0, time_0); // printDateTime(compiled); Serial.println(""); if (!Rtc.IsDateTimeValid()) { // Common Cuases: // 1) first time you ran and the device wasn't running yet // 2) the battery on the device is low or even missing Serial.println("RTC lost confidence in the DateTime!"); // following line sets the RTC to the date &amp; time this sketch was compiled // it will also reset the valid flag internally unless the Rtc device is // having an issue } Rtc.SetDateTime(compiled); RtcDateTime now = Rtc.GetDateTime(); if (now &lt; compiled) { Serial.println("RTC is older than compile time! (Updating DateTime)"); Rtc.SetDateTime(compiled); } else if (now &gt; compiled) { Serial.println("RTC is newer than compile time. (this is expected)"); } else if (now == compiled) { Serial.println("RTC is the same as compile time! (not expected but all is fine)"); } // never assume the Rtc was last configured by you, so // just clear them to your needed state Rtc.Enable32kHzPin(false); Rtc.SetSquareWavePin(DS3231SquareWavePin_ModeNone); } } void synchronClock() { Rtc.Begin(); // WiFi.begin(lnet, key); wifiManager.autoConnect(ssid.c_str(), pass.c_str()); while (WiFi.status() != WL_CONNECTED) { delay(500); Serial.print("."); } Serial.println(" "); Serial.print("IP number assigned by DHCP is "); Serial.println(WiFi.localIP()); Serial.println("Starting UDP"); Udp.begin(localPort); Serial.print("Local port: "); Serial.println(Udp.localPort()); Serial.println("waiting for sync"); setSyncProvider(getNtpTime); if(timeStatus() != timeNotSet){ digitalClockDisplay(); Serial.println("here is another way to set rtc"); time_t t = now(); char date_0[12]; snprintf_P(date_0, countof(date_0), PSTR("%s %02u %04u"), monthShortStr(month(t)), day(t), year(t)); Serial.println(date_0); char time_0[9]; snprintf_P(time_0, countof(time_0), PSTR("%02u:%02u:%02u"), hour(t), minute(t), second(t)); Serial.println(time_0); Serial.println("Now its time to set up rtc"); RtcDateTime compiled = RtcDateTime(date_0, time_0); Serial.println(""); if (!Rtc.IsDateTimeValid()) { // Common Cuases: // 1) first time you ran and the device wasn't running yet // 2) the battery on the device is low or even missing Serial.println("RTC lost confidence in the DateTime!"); // following line sets the RTC to the date &amp; time this sketch was compiled // it will also reset the valid flag internally unless the Rtc device is // having an issue } Rtc.SetDateTime(compiled); RtcDateTime now = Rtc.GetDateTime(); if (now &lt; compiled) { Serial.println("RTC is older than compile time! (Updating DateTime)"); Rtc.SetDateTime(compiled); } else if (now &gt; compiled) { Serial.println("RTC is newer than compile time. (this is expected)"); } else if (now == compiled) { Serial.println("RTC is the same as compile time! (not expected but all is fine)"); } // never assume the Rtc was last configured by you, so // just clear them to your needed state Rtc.Enable32kHzPin(false); Rtc.SetSquareWavePin(DS3231SquareWavePin_ModeNone); } } void Clock(){ RtcDateTime now = Rtc.GetDateTime(); //Print RTC time to Serial Monitor hh = now.Hour(); mm = now.Minute(); ss = now.Second(); sprintf(date_r, "%d.%d.%d", now.Day(), now.Month(), now.Year()); if (mm &lt; 10) sprintf(time_r, "%d:0%d", hh, mm); else sprintf(time_r, "%d:%d", hh, mm); Serial.println(date_r); Serial.println(time_r); } //analog void drawClockFace(){ display.fillCircle(ccenterx, ccentery, cradius, BLUE); display.fillCircle(ccenterx, ccentery, cradius-4, BLACK); // Draw 12 lines for(int i = 0; i&lt;360; i+= 30) { sx = cos((i-90)*scosConst); sy = sin((i-90)*scosConst); x0 = sx*(cradius)+ccenterx; yy0 = sy*(cradius)+ccentery; x1 = sx*(cradius-8)+ccenterx; yy1 = sy*(cradius-8)+ccentery; display.drawLine(x0, yy0, x1, yy1, 0x0377); } // Draw 4 lines for(int i = 0; i&lt;360; i+= 90) { sx = cos((i-90)*scosConst); sy = sin((i-90)*scosConst); x0 = sx*(cradius+6)+ccenterx; yy0 = sy*(cradius+6)+ccentery; x1 = sx*(cradius-11)+ccenterx; yy1 = sy*(cradius-11)+ccentery; display.drawLine(x0, yy0, x1, yy1, 0x0377); } } //analog static uint8_t conv2d(const char* p) { uint8_t v = 0; if ('0' &lt;= *p &amp;&amp; *p &lt;= '9') v = *p - '0'; return 10 * v + *++p - '0'; } //analog void drawClockHands(uint8_t h,uint8_t m,uint8_t s){ // Pre-compute hand degrees, x &amp; y coords for a fast screen update sdeg = s * 6; // 0-59 -&gt; 0-354 mdeg = m * 6 + sdeg * 0.01666667; // 0-59 -&gt; 0-360 - includes seconds hdeg = h * 30 + mdeg * 0.0833333; // 0-11 -&gt; 0-360 - includes minutes and seconds hx = cos((hdeg-90)*scosConst); hy = sin((hdeg-90)*scosConst); mx = cos((mdeg-90)*scosConst); my = sin((mdeg-90)*scosConst); sx = cos((sdeg-90)*scosConst); sy = sin((sdeg-90)*scosConst); // Erase just old hand positions display.drawLine(ohx, ohy, ccenterx+1, ccentery+1, BLACK); display.drawLine(omx, omy, ccenterx+1, ccentery+1, BLACK); display.drawLine(osx, osy, ccenterx+1, ccentery+1, BLACK); // Draw new hand positions display.drawLine(hx*(cradius-20)+ccenterx+1, hy*(cradius-20)+ccentery+1, ccenterx+1, ccentery+1, WHITE); display.drawLine(mx*(cradius-8)+ccenterx+1, my*(cradius-8)+ccentery+1, ccenterx+1, ccentery+1, WHITE); display.drawLine(sx*(cradius-8)+ccenterx+1, sy*(cradius-8)+ccentery+1, ccenterx+1, ccentery+1, RED); display.fillCircle(ccenterx+1, ccentery+1, 3, RED); // Update old x&amp;y coords osx = sx*(cradius-8)+ccenterx+1; osy = sy*(cradius-8)+ccentery+1; omx = mx*(cradius-8)+ccenterx+1; omy = my*(cradius-8)+ccentery+1; ohx = hx*(cradius-20)+ccenterx+1; ohy = hy*(cradius-20)+ccentery+1; } void FaceClock(){ display.clearScreen(); display.setTextColor(WHITE, BLACK); osx = ccenterx; osy = ccentery; omx = ccenterx; omy = ccentery; ohx = ccenterx; ohy = ccentery; drawClockFace();// Draw clock face } void drawSynchron() { display.clearScreen(); display.setTextSize(2); display.setCursor(2,48); display.setTextColor(WHITE); display.println(utf8(" Clock")); display.setTextSize(1); display.setCursor(2,68); display.setTextColor(WHITE); display.println(utf8("synchronization...")); } void drawWiFi() { display.clearScreen(); display.setTextSize(2); display.setCursor(2,48); display.setTextColor(RED); display.println(utf8("Connection to Wi-Fi")); } void drawBlynk() { display.clearScreen(); display.setTextSize(2); display.setCursor(2,48); display.setTextColor(RED); display.println(utf8("Connection to Blynk")); } void mailer() { // wait for WiFi connection if((WiFiMulti.run() == WL_CONNECTED)) { HTTPClient http; Serial.print("[HTTP] begin...\n"); http.begin("http://skorovoda.in.ua/php/wst41.php?mymail="+String(address)+"&amp;t="+String(t) +"&amp;h="+String(h)+"&amp;co2="+String(co2)+"&amp;ID="+String(ESP.getChipId())); Serial.print("[HTTP] GET...\n"); // start connection and send HTTP header int httpCode = http.GET(); // httpCode will be negative on error if(httpCode &gt; 0) { // HTTP header has been send and Server response header has been handled Serial.printf("[HTTP] GET... code: %d\n", httpCode); // file found at server if(httpCode == HTTP_CODE_OK) { String payload = http.getString(); Serial.println(payload); } } else { Serial.printf("[HTTP] GET... failed, error: %s\n", http.errorToString(httpCode).c_str()); } http.end(); } } //callback notifying the need to save config void saveConfigCallback() { Serial.println("Should save config"); shouldSaveConfig = true; } void factoryReset() { Serial.println("Resetting to factory settings"); wifiManager.resetSettings(); SPIFFS.format(); ESP.reset(); } void printString(String str) { Serial.println(str); } bool loadConfigS() { Blynk.config(address); Serial.print("e-mail: "); Serial.println( address ); Blynk.config(tZ); Serial.print("T_Zone: "); Serial.println( tZ ); Blynk.config(Tmx); Serial.print("T max: "); Serial.println( Tmx ); Blynk.config(Cmx); Serial.print("CO2 max: "); Serial.println( Cmx ); Blynk.config(Tmn); Serial.print("T min: "); Serial.println( Tmn ); Blynk.config(Hmn); Serial.print("H min: "); Serial.println( Hmn ); Blynk.config(timeSW); Serial.print("Time Summer/Winter: "); Serial.println( timeSW ); Blynk.config(formFS); Serial.print("format FS: "); Serial.println( formFS ); Blynk.config(blynk_token, "blynk-cloud.com", 8442); Serial.print("token: " ); Serial.println( blynk_token ); } bool loadConfig() { Serial.println("Load config..."); File configFile = SPIFFS.open("/config.json", "r"); if (!configFile) { Serial.println("Failed to open config file"); return false; } size_t size = configFile.size(); if (size &gt; 1024) { Serial.println("Config file size is too large"); return false; } // Allocate a buffer to store contents of the file. std::unique_ptr&lt;char[]&gt; buf(new char[size]); // We don't use String here because ArduinoJson library requires the input // buffer to be mutable. If you don't use ArduinoJson, you may as well // use configFile.readString instead. configFile.readBytes(buf.get(), size); StaticJsonBuffer&lt;200&gt; jsonBuffer; JsonObject &amp;json = jsonBuffer.parseObject(buf.get()); if (!json.success()) { Serial.println("Failed to parse config file"); return false; } // Save parameters strcpy(blynk_token, json["blynk_token"]); strcpy(address, json["address"]); strcpy(tZ, json["tZ"]); strcpy(Tmx, json["Tmx"]); strcpy(Cmx, json["Cmx"]); strcpy(Tmn, json["Tmn"]); strcpy(Hmn, json["Hmn"]); strcpy(timeSW, json["timeSW"]); strcpy(formFS, json["formFS"]); } void configModeCallback (WiFiManager *wifiManager) { String url {"http://192.168.4.1"}; printString("Connect to WiFi:"); printString("net: " + ssid); printString("pw: "+ pass); printString("Open browser:"); printString(url); printString("to setup device"); drawConnectionDetails(); } void setupWiFi() { //set config save notify callback wifiManager.setSaveConfigCallback(saveConfigCallback); // Custom parameters WiFiManagerParameter custom_blynk_token("blynk_token", "Blynk token", blynk_token, 34); wifiManager.addParameter(&amp;custom_blynk_token); WiFiManagerParameter custom_address("address", "E-mail", address, 64); wifiManager.addParameter(&amp;custom_address); WiFiManagerParameter custom_tZ("tZ", "Time Zone", tZ, 5); wifiManager.addParameter(&amp;custom_tZ); WiFiManagerParameter custom_Tmn("Tmn", "T min", Tmn, 5); wifiManager.addParameter(&amp;custom_Tmn); WiFiManagerParameter custom_Tmx("Tmx", "T max", Tmx, 5); wifiManager.addParameter(&amp;custom_Tmx); WiFiManagerParameter custom_Cmx("Cmx", "C max", Cmx, 7); wifiManager.addParameter(&amp;custom_Cmx); WiFiManagerParameter custom_Hmn("Hmn", "H min", Hmn, 5); wifiManager.addParameter(&amp;custom_Hmn); WiFiManagerParameter custom_timeSW("timeSW", "Time Summer(1)/Winter(0)", timeSW, 4); wifiManager.addParameter(&amp;custom_timeSW); WiFiManagerParameter custom_formFS("formFS", "formating FS", formFS, 4); wifiManager.addParameter(&amp;custom_formFS); wifiManager.setAPCallback(configModeCallback); wifiManager.setTimeout(60); if (!wifiManager.autoConnect(ssid.c_str(), pass.c_str())) { md = 2; Serial.println("mode OffLINE :("); loadConfigS(); } //save the custom parameters to FS if (shouldSaveConfig) { Serial.println("saving config"); DynamicJsonBuffer jsonBuffer; JsonObject &amp;json = jsonBuffer.createObject(); json["blynk_token"] = custom_blynk_token.getValue(); json["address"] = custom_address.getValue(); json["tZ"] = custom_tZ.getValue(); json["Tmx"] = custom_Tmx.getValue(); json["Cmx"] = custom_Cmx.getValue(); json["Tmn"] = custom_Tmn.getValue(); json["Hmn"] = custom_Hmn.getValue(); json["timeSW"] = custom_timeSW.getValue(); json["formFS"] = custom_formFS.getValue(); File configFile = SPIFFS.open("/config.json", "w"); if (!configFile) { Serial.println("failed to open config file for writing"); } json.printTo(Serial); json.printTo(configFile); configFile.close(); //end save } //if you get here you have connected to the WiFi Serial.println("WiFi connected"); Serial.print("IP address: "); Serial.println(WiFi.localIP()); } void connectBlynk(){ if(String(blynk_token)== "Blynk token"){ blnk = 0; Serial.println("! Off Blynk!"); } else { Serial.println("Connecting to blynk..."); while (Blynk.connect() == false) { delay(500); Serial.println("Connecting to blynk..."); } } } void sendToBlynk(){ Blynk.virtualWrite(V1, t); Blynk.virtualWrite(V2, h); Blynk.virtualWrite(V3, co2); Blynk.virtualWrite(V5, hic); } void formatFS(){ SPIFFS.format(); SPIFFS.begin(); } void setup() { Serial.begin(115200); display.begin(); // Init filesystem if (!SPIFFS.begin()) { Serial.println("Failed to mount file system"); ESP.reset(); } md = 1; // Setup WiFi drawWiFi(); //"Connecting to Wi-Fi..." setupWiFi(); if(md == 1){ // Load configuration if (!loadConfig()) { Serial.println("Failed to load config"); // factoryReset(); } else { Serial.println("Config loaded"); } Blynk.config(address); Serial.print("e-mail: "); Serial.println( address ); Blynk.config(tZ); Serial.print("T_Zone: "); Serial.println( tZ ); Blynk.config(Tmx); Serial.print("T max: "); Serial.println( Tmx ); Blynk.config(Cmx); Serial.print("CO2 max: "); Serial.println( Cmx ); Blynk.config(Tmn); Serial.print("T min: "); Serial.println( Tmn ); Blynk.config(Hmn); Serial.print("H min: "); Serial.println( Hmn ); Blynk.config(timeSW); Serial.print("Time Summer/Winter: "); Serial.println( timeSW ); Blynk.config(formFS); Serial.print("format FS: "); Serial.println( formFS ); Blynk.config(blynk_token, "blynk-cloud.com", 8442); Serial.print("token: " ); Serial.println( blynk_token ); Tmax = atof (Tmx); Cmax = atof (Cmx); Tmin = atof (Tmn); Hmin = atof (Hmn); tZone = atof (tZ); timeSummerWinter = atof (timeSW); formatingFS = atof (formFS); drawSynchron(); synchronClock(); connectBlynk(); FaceClock(); if (formatingFS == 1) { formatFS(); } } else if(md == 2) { Tmax = atof (Tmx); Cmax = atof (Cmx); Tmin = atof (Tmn); Hmin = atof (Hmn); tZone = atof (tZ); timeSummerWinter = atof (timeSW); formatingFS = atof (formFS); synchronClockA(); FaceClock(); if (formatingFS == 1) { formatFS(); } } } void loop() { if (md == 2) Serial.println(":( OffLINE"); else if (md == 1) Serial.println(":) OnLINE"); sendMeasurements(); draw(); Clock(); drawClockHands(hh,mm,ss); if (ml &gt;= 480000) ml = 0; //  if ((ml &gt;= 20000) and ((t &gt; Tmax) or (co2 &gt; Cmax) or (t &lt; Tmin) or (h &lt; Hmin))) { mailer(); ml = 0; } Blynk.run(); if (bl &gt; 210){ // 30 sec sendToBlynk(); Serial.println("   Blynk"); bl = 0; } bl++; ml++; delay(100); t_old = t; hic_old = hic; h_old = h; co2_old = co2; Serial.println(" "); }</span></span></span></span></code> </pre> </div></div><br><p>  Wenn mindestens einer der Luftparameter au√üerhalb der festgelegten Schwellenwerte liegt, sendet das Ger√§t ungef√§hr einmal pro Stunde eine E-Mail-Nachricht √ºber den folgenden Inhalt: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sb/s7/e5/sbs7e5g0boyq3gqvnyos8vhgpic.png"></a> </p><br><p>  Nachrichten an E-Mail werden per PHP-Skript gesendet.  Das Skript wird auf meinen Mailserver hochgeladen.  Dies ist erforderlich, wenn Sie Nachrichten von einer anderen Ressource senden m√∂chten. </p><br><div class="spoiler">  <b class="spoiler_title">PHP-Skript</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//  - http://skorovoda.in.ua/php/aqm42.php?mymail=my_login@my.site.net&amp;t=22.2&amp;h=55&amp;co2=666 $EMAIL=0; $TEMPER=0; $vlaga=0; $carbon=0; $device=0; $EMAIL=$_GET["mymail"]; $device=$_GET["ID"]; echo $EMAIL; $TEMPER=$_GET["t"]; $vlaga=$_GET["h"]; $carbon=$_GET["co2"]; $mdate = date("H:i dmy"); echo &lt;&lt;&lt;END &lt;p&gt;: $TEMPER ¬∞&lt;p&gt; &lt;p&gt;: $vlaga %&lt;p&gt; &lt;p&gt;  : $carbon ppm&lt;p&gt; &lt;p&gt;--------------------&lt;p&gt; &lt;p&gt; ‚Ññ: $device&lt;p&gt; END; echo &lt;&lt;&lt;END &lt;p&gt;$mdate&lt;/p&gt; END; mail($EMAIL, "Air Quality Monitor " .$device. " v.051018","       ‚Ññ" .$device. " .        (,     )      . === : ".$TEMPER."¬∞C === ".": ".$vlaga."% === "."  : ".$carbon." ppm === "." ! === , : ".$mdate,"From: my_sensors@air-monitor.info \n") </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> </div></div><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/8w/7n/el/8w7nelwjfe3b2wumssuerp3o3pm.png"></div><br><p>  Schalten Sie den Monitor ein. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/75/wk/lw/75wklw7on-_tir_swognf_fsmoq.png"></div><br><p>  Das Ger√§t hat den Zugangspunkt am180206 angehoben.  Wir finden diesen Punkt in der Liste der verf√ºgbaren Netzwerke und stellen eine Verbindung her, das Passwort wird auf dem Bildschirm angezeigt.  Versuchen Sie, in anderthalb Minuten eine Verbindung zu diesem Punkt herzustellen, da sonst der Monitor automatisch in den Batteriemodus wechselt.  √úber den Offline-Modus - etwas sp√§ter.  √ñffnen Sie dann die Browserseite http://192.168.4.1. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/0x/xs/8d/0xxs8da7p7nxulfkzh3c6k4ysvw.png"></div><br><p>  Klicken Sie auf die Schaltfl√§che <em>WLAN konfigurieren (kein Scan)</em> .  Eine Seite mit dem Formular f√ºr die Thermostateinstellungen wird ge√∂ffnet: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/u6/k_/qn/u6k_qn1o6venw84_jnfvrq5bwe4.png"></div><br><p>  Geben Sie in Form des Namens und des Passworts Ihres Heimnetzwerks, des BLynk-Identifikationsschl√ºssels, Ihrer E-Mail-Adresse, der Zeitzone, der Sommer- / Winterzeit sowie der Schwellenwerte f√ºr Temperatur, Luftfeuchtigkeit und CO2-Gehalt an. </p><br><p>  Lassen Sie sich bei der Auswahl von Schwellenwerten f√ºr Luftparameter von Indikatoren leiten, die ich im Internet gefunden habe: </p><br><p>  1. Angenehme Nachttemperatur im Schlaf 19 ... 21 ¬∞ C, tags√ºber - 22 ... 23 ¬∞ C. </p><br><p>  2. Die optimale relative Luftfeuchtigkeit in der kalten Jahreszeit wird als Luftfeuchtigkeit von 30 ... 45% und in der warmen Jahreszeit von 30 ... 60% angesehen.  Indikatoren f√ºr die maximale maximale Luftfeuchtigkeit: Im Winter sollten sie 60% und im Sommer 65% nicht √ºberschreiten. </p><br><p>  3. Der maximale Kohlendioxidgehalt in den R√§umlichkeiten sollte 1000 ppm nicht √ºberschreiten.  Das empfohlene Niveau f√ºr Schlafzimmer, Kinderzimmer - nicht mehr als 600 ppm.  Die Marke von 1400 ppm f√ºr eine lange Zeit ist die Grenze des zul√§ssigen CO2-Gehalts im Raum.  Wenn mehr vorhanden ist, wird die Luftqualit√§t als niedrig angesehen. </p><br><p>  Das <em>E-Mai-</em> Feld kann leer gelassen werden.  Dann geht die M√∂glichkeit verloren, Briefe per E-Mail √ºber den Austritt von Luftparametern √ºber die Grenzwerte hinaus zu erhalten.  Ohne den eingegebenen Blynk-Schl√ºssel verlieren Sie die F√§higkeit, Informationen √ºber die Luftparameter aus der Ferne zu erhalten.  Der Monitor geht jedoch nicht verloren, wenn die Felder mit den Grenzwerten der Luftparameter leer bleiben. </p><br><p>  F√ºllen Sie ohne zu z√∂gern alle Felder des Formulars mit Zahlen im Gleitkommaformat aus. Die Zeitzone betr√§gt beispielsweise <em>2,0</em> .  Die Skizze sieht die anschlie√üende Konvertierung von Zahlen in das gew√ºnschte Format vor. </p><br><p>  Nach dem Speichern der Einstellungen im ESP8266-Speicher (Schaltfl√§che Speichern) stellt der Monitor eine Verbindung zum Netzwerk her und beginnt mit der Arbeit. </p><br><p>  Betrachten Sie das Bild auf dem Bildschirm. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/nr/d3/b-/nrd3b-zotfdmjlxuo4pxlsg98c0.png"></div><br><p>  Datum, Uhrzeit, gemessene Temperatur, CO2-Gehalt und Luftfeuchtigkeit sind selbsterkl√§rend.  Ich werde kl√§ren, ob die Luftparameter die von Ihnen festgelegten Grenzwerte √ºberschreiten. Die Anzeige auf dem Bildschirm √§ndert dann die Farbe von gr√ºn nach rot. </p><br><p>  Der Buchstabe ‚ÄûB‚Äú auf rotem Hintergrund zeigt an, dass der Monitor ohne Verbindung zu Blynk funktioniert. Wenn der Buchstabe ‚ÄûA‚Äú angezeigt wird, ist die Stromversorgung unterbrochen und zum Zeitpunkt des Auftretens gab es kein WLAN (das Ger√§t wurde offline geschaltet). </p><br><p>  Im Allgemeinen sollte das Erscheinen einer roten Farbe auf dem Bildschirm alarmieren - es gibt Abweichungen von der normalen Funktion des Ger√§ts. </p><br><p>  In der unteren rechten Ecke des Bildschirms sehen wir den W√§rmeindex (Hitzeindex, Humindex). </p><br><p>  <em>‚ÄûHumidex ist eine dimensionslose Gr√∂√üe, die auf dem Taupunkt basiert.</em>  <em>Dieser Index wird in kanadischen Wetterberichten im Sommer h√§ufig verwendet.</em> <em><br></em>  <em>Nach Angaben des Canadian Meteorological Service verursachen Humidex-Werte √ºber 30 Unbehagen, √ºber 40 gro√üe Unannehmlichkeiten und ein Wert √ºber 45 ist gef√§hrlich.</em>  <em>Wenn Humidex 54 erreicht, ist ein Hitzschlag unvermeidlich.</em>  <em>Der Wind ber√ºcksichtigt diesen Index nicht. ‚Äú</em>  (Wikipedia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Humidex</a> ). </p><br><p>  Es sollte klargestellt werden, dass der W√§rmeindex nur f√ºr relativ hohe Temperaturen berechnet wird, wenn die gemessene Lufttemperatur √ºber 21 ¬∞ C liegt.  Im √ºbertragenen Sinne ist der Hitzeindex die wahrgenommene Temperatur an einem hei√üen windstillen Sommertag. <br></p><br><p>  Laut der Tabelle des gleichen Artikels auf Wikipedia wird die gemessene Temperatur von 25 ¬∞ C bei einer Luftfeuchtigkeit von 30% als 24 ¬∞ C, bei 50% - 28 ¬∞ C und bei 90% - 35 ¬∞ C (10 ¬∞ C h√∂her als das Thermometer) empfunden.  In Innenr√§umen kann diese Anzeige durch Anordnen eines Luftzuges oder Einschalten des L√ºfters verringert werden.  Die Klimaanlage schaltet sich automatisch ein, wenn Sie die Temperatur der Klimaanlage auf nicht mehr als 25 ¬∞ C einstellen.  Der W√§rmeindex ist meiner Meinung nach ein relevanterer Parameter f√ºr die Luftqualit√§t als beispielsweise der Druck, den wir in keiner Weise beeinflussen k√∂nnen. </p><br><p>  Der DHT22-Sensor hat wie der DHT11 zusammen mit dem ‚ÄûMinus‚Äú - geringe Genauigkeit der Feuchtemessung ein unbestreitbares ‚ÄûPlus‚Äú: Der Datenbus dieses Sensors enth√§lt Informationen √ºber den W√§rmeindex.  Ich habe dieses ‚ÄûPlus‚Äú genutzt und den W√§rmeindex auf dem Ger√§tebildschirm angezeigt. <br></p><br><p>  Im Internet gibt es viele Beschwerden √ºber die geringe Genauigkeit des DHT22.  F√ºr diejenigen, die entschlossen sind, die Verwendung dieses Sensors in ihren Projekten zu verweigern, bitte ich Sie, sich f√ºr modernere Temperatur- und Feuchtigkeitssensoren HTU21D, Si7021 oder SHT21 zu entscheiden. <br></p><br><p>  Es ist Zeit, die Blynk-App auf Ihrem Smartphone zu starten. </p><br><p>  Richten Sie Ihre Anwendung ein.  Variablen f√ºr Blynk (nicht in der Skizze zu suchen): Temperatur - <em>V1</em> , Luftfeuchtigkeit - <em>V2</em> , CO2-Gehalt - <em>V3</em> , W√§rmeindex - <em>V5</em> . </p><br><p>  Auf meinem Smartphone sieht die Blynk'a-Oberfl√§che folgenderma√üen aus: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/dw/3e/zd/dw3ezdbdzpghvmnmsmt6lsazvia.png"></div><br><p>  Die Grafik zeigt die gemessene Temperatur (gelb), Luftfeuchtigkeit (blau) und Hitzeindex (lila).  Der erste Peak in der Grafik ist die Erw√§rmung des Druck-Feuchtigkeits-Sensors in der Handfl√§che: Die W√§rmeindexkurve befindet sich √ºber der Temperaturkurve.  Der zweite Peak ist die Erw√§rmung des Sensors mit einem Haartrockner.  Die Luftfeuchtigkeit nimmt ab, wenn sich der Sensor mit einem Haartrockner erw√§rmt, und die W√§rmeindexkurve wiederholt sich in einigen Bereichen oder unterhalb der Temperaturlinie.  (siehe Beschriftung). </p><br><p>  Machen Sie sich keine Sorgen, wenn die Temperaturlinie in der Grafik verschwunden ist: Bei Temperaturen unter 21 ¬∞ C wiederholt die W√§rmeindexkurve die gemessene Temperaturkurve. </p><br><p>  Jetzt testen wir den Betrieb des Benachrichtigungssystems per E-Mail.  Geben Sie die http-Adresse aus dem PHP-Skript-Code in die Adressleiste des Browsers ein (im Skript ist die Zeile mit der http-Adresse auskommentiert).  Wenn Sie nicht vergessen haben, Ihre E-Mail-Adresse in den Einstellungen und im Browserfenster anzugeben - Informationen wie in der Abbildung unten -, treten h√∂chstwahrscheinlich keine Probleme beim Empfang von Benachrichtigungen auf.  Der Test ist besonders n√ºtzlich, wenn Sie ein PHP-Skript von meinem Server auf einen anderen √ºbertragen. </p><br><p></p><p><img src="https://habrastorage.org/webt/lq/mc/8q/lqmc8qgoywmrc9t5ogsv3oravhk.png"></p><br><br><h2>  Schlussfolgerungen </h2><br><p>  Ich werde nicht wiederholen, was getan wurde, sondern auf mehrdeutige Punkte eingehen. </p><br><p>  Logisch ist zum Beispiel die Frage "Warum ist die Uhr hier?"  Eine Pfeil√ºberwachung wird ben√∂tigt, um den Bildschirm auszuf√ºllen.  Obwohl derzeit in fast jedem Haushaltsger√§t Digitaluhren eingebaut sind, haben analoge einen Vorteil: Die Zeitskala erleichtert dank des Zifferblatts die Sch√§tzung der Zeit bis zu einem Ereignis.  Ich werde nicht streiten - Sie k√∂nnen ohne Stunden auskommen. </p><br><p>  Woran Sie arbeiten m√ºssen: </p><br><p>  ‚Ä¢ Organisieren Sie √ºber einen langen Zeitraum - mindestens ein Jahr - eine autonome Stromversorgung f√ºr den Monitor aus zwei AA-Batterien. </p><br><p>  ‚Ä¢ Das Aussehen ist keine Diskussion wert - hier hat jeder seine eigene Meinung und M√∂glichkeiten.  Ich mag zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Beispiel die</a> Option <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">avs24rus</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bei der ein 7-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Zoll-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Display in einem Rahmen mit 3D-Druck als Bildschirm verwendet wurde</a> . Sie k√∂nnen einen teuren Rahmen durch einen billigen Rahmen aus einem Baguette ersetzen. Im Standby-Modus k√∂nnen Sie eine Landschaft, ein Portr√§t Ihrer Geliebten oder ein Foto von Kindern anzeigen Original Fotorahmen zus√§tzlich. </p><br><p>  Wenn Sie in Bezug auf die √§sthetische Seite des Problems nicht sehr anspruchsvoll sind, passt vielleicht etwas √Ñhnliches zu Ihnen: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/t9/mc/ad/t9mcadjmxmqqiseaztnhsj_odyw.png"></div><br><p>  <strong>Hinweis</strong>  Urspr√ºnglich war der Monitor als universelles Ger√§t konzipiert, das in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Thermostat eingesetzt werden kann</a> .  Seine Vielseitigkeit hat zu einer ungerechtfertigten Komplikation des Systems gef√ºhrt.  Daher habe ich sp√§ter die M√∂glichkeit der Verwendung der Monitorl√∂sung in einem Thermostat abgelehnt und die Publikation bearbeitet.  Spuren der vorherigen komplexeren Version des Ger√§ts blieben in den Kommentaren. </p><br><p>  Viel Gl√ºck! </p><br><h2>  Meine Lesezeichen zu einem Thema von Habr </h2><br><p>  1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wi-Fi-Thermometer auf ESP8266 + DS18B20 f√ºr nur 4 US-Dollar</a> </p><br><p>  2. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kompakter Heimluftmonitor (CO2, Temperatur, Luftfeuchtigkeit, Druck) mit WLAN und mobiler Schnittstelle</a> </p><br><p>  3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Praktische Erfahrung mit Blynk f√ºr einen CO2-Sensor.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1</a> </p><br><p>  4. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verwenden des SPI Flash-Anzeigespeichers zum Speichern von Grafikressourcen oder zum Anzeigen einer Heimwetterstation</a> </p><br><p>  5. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wir messen die CO2-Konzentration in der Wohnung mit dem MH-Z19</a> </p><br><p>  6. Die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dunkle Seite des MH-Z19</a> </p><br><p>  7. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wir messen die CO2-Konzentration in der Wohnung mit dem MH-Z19</a> </p><br><p>  Zum Schluss danke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@kumekay</a> f√ºr den wertvollen Rat. <br>  Die Ver√∂ffentlichung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚ÄûPraktische Erfahrungen mit der Verwendung von Blynk f√ºr einen CO2-Sensor</a> haben mir geholfen, das Problem der erneuten Eingabe von Variablen in den ESP8622-Speicher zu l√∂sen. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Äú</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1 "</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ a3x</a> .  Tief vielseitiger Artikel! <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442856/">https://habr.com/ru/post/de442856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442840/index.html">Backend United 3: Geliert</a></li>
<li><a href="../de442844/index.html">Kapitan an der Spitze von Kubernetes</a></li>
<li><a href="../de442846/index.html">Unsere Raumfahrtindustrie. Ein Blick auf Branchenprobleme aus der Sicht eines normalen Entwicklers</a></li>
<li><a href="../de442852/index.html">Dell 6000 oder Hallo von 2005</a></li>
<li><a href="../de442854/index.html">Wie haben wir das U-Bahn-Schema von Minsk gemacht?</a></li>
<li><a href="../de442858/index.html">Gibt es in Afrika zu viele Elefanten? Wie friedliches Zusammenleben mit menschlichen Gemeinschaften dabei helfen kann</a></li>
<li><a href="../de442862/index.html">Proof-of-Stake: Einblick</a></li>
<li><a href="../de442864/index.html">Wie alt ist dein Herr?</a></li>
<li><a href="../de442866/index.html">KI, die aus jahrzehntelangen kulinarischen Experimenten trainiert wurde, kreiert neue Gerichte</a></li>
<li><a href="../de442868/index.html">Ein kurzer Ausflug in die K√ºhlsysteme des Rechenzentrums. Vorteile und Nachteile</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>