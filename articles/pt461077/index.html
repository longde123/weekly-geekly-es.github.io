<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüç≥ üôãüèª üé¨ Como s√£o cozidos os pentesters? Teste de entrada para estagi√°rios de seguran√ßa digital üìå üÜô üê©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Summer of Hack 2019 em Seguran√ßa Digital j√° est√° em pleno andamento, o que significa que √© hora de contar como recrutamos pessoas. 



 Sob o corte,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como s√£o cozidos os pentesters? Teste de entrada para estagi√°rios de seguran√ßa digital</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/461077/">  <b>O Summer of Hack 2019</b> em Seguran√ßa Digital j√° est√° em pleno andamento, o que significa que √© hora de contar como recrutamos pessoas. <br><br><img src="https://habrastorage.org/webt/iv/ef/ud/ivefudzwssbwskpfaxaxkczsxvu.jpeg"><br><br>  Sob o corte, material volumoso e interessante sobre como selecionamos jovens especialistas para o est√°gio "Summer of Hack 2019", e especificamente para o Departamento de Auditoria de Seguran√ßa. <br><br>  Considere o que, em nossa opini√£o, um pentester deve saber para fazer seu trabalho com sucesso. <br><br>  Vamos analisar uma s√©rie de tarefas dif√≠ceis que torturamos os caras, inclusive em nome de um deles. <br><a name="habracut"></a><br>  Talvez a parte mais interessante da sele√ß√£o para um est√°gio no departamento de auditoria de seguran√ßa tenha sido o nosso perfil.  Todos os anos, reunimos em todo o departamento e discutimos quais habilidades, em nossa opini√£o, exigem um especialista moderno no campo da seguran√ßa pr√°tica, lembramos as tarefas mais interessantes que precisaram ser resolvidas este ano e escrevemos √°reas de conhecimento sem as quais √© dif√≠cil imaginar um auditor de sucesso.  Quando todas as piadas s√£o contadas e as hist√≥rias s√£o contadas, o resultado final permanece um conjunto de id√©ias. <br><br>  Este ano, fomos guiados pelos seguintes requisitos: <br><br><ul><li>  Conhecimento b√°sico dos aplicativos da Web do dispositivo e ataques a eles; </li><li>  Conhecimento b√°sico dos mecanismos de prote√ß√£o e controle de acesso baseados em navegador (sim, o mesmo SOP e CORS, onde sem eles); </li><li>  Habilidades b√°sicas de leitura de c√≥digo e a capacidade de ver a l√≥gica por tr√°s disso; </li><li>  Compreender o funcionamento das redes de computadores e rotear nelas; </li><li>  Experi√™ncia com sistemas semelhantes ao Linux; </li><li>  A capacidade de n√£o ter medo de tecnologia desconhecida.  A capacidade de pesquisar e sistematizar as informa√ß√µes recebidas; </li><li> E uma pitada de Android (embora n√£o seja necess√°rio, mas esse √© o nosso pequeno capricho). </li></ul><br>  Depois que as perguntas foram desenvolvidas.  Parcialmente, n√≥s os emprestamos das perguntas que fizemos durante as entrevistas, mas mais da metade foi especialmente preparada para este question√°rio.  Nossos especialistas passaram seu tempo pessoal preparando despejos de tr√°fego, discutindo sobre como formular melhor a pergunta e quais vulnerabilidades eram "muito espec√≠ficas, por que atormentar os trainees".  Por esse zelo, n√£o podemos deixar de tirar o chap√©u (branco, √© claro). <br><br>  A an√°lise de cada quest√£o consiste em duas partes.  A primeira parte √© a resposta de um de nossos estagi√°rios - Danila <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Korgik_0</a> Leontyeva (ele √© o autor da publica√ß√£o), e a segunda s√£o os coment√°rios de especialistas que estavam empilhando o question√°rio. <br><br><hr><br>  <i>Ol√° Habr!</i> <i><br><br></i>  <i>Primeiro, uma pequena digress√£o l√≠rica.</i> <i><br></i>  <i>Mais especificamente, "Como descobri o Summ3r 0f h4ck".</i> <i><br></i>  <i>Eu ouvi sobre o an√∫ncio do est√°gio de um discurso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Denis Rybin</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ilya Bulatov</a> na confer√™ncia do RuCTF2019.</i> <i><br><br></i>  <i>Literalmente ap√≥s 4 dias, um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">post</a> foi publicado no habr sobre a abertura de um conjunto de est√°gios.</i> <i><br><br></i>  <i>E √† noite do mesmo dia, abri a tarefa, no departamento de auditoria de seguran√ßa, e mergulhei no trabalho.</i>  <i>Hoje vou compartilhar com o leitor quais dificuldades eu tive que enfrentar e qual op√ß√£o de solu√ß√£o eu poderia oferecer.</i> <br><br><hr><br><h1>  <strong><font color="#cc0000">No. 1.</font></strong>  <strong><font color="#cc0000">C√≥digo fonte php</font></strong> </h1><br>  Examine o c√≥digo.  Descreva quais falhas voc√™ v√™ e como as solucionaria. <br><br><img src="https://habrastorage.org/webt/ne/0x/ku/ne0xkuq_5uz955i1rypa8or5spk.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">An√°lise de trabalho</b> <div class="spoiler_text">  4¬™ linha - use o hash MD5. <br>  Problema - o MD5 pode ser brutalizado em um per√≠odo de tempo razo√°vel usando o hashcat. <br>  Como consertar? <br><br>  Usando algoritmos de hash mais "intensivos em recursos". <br>  Nesse caso, voc√™ deve recusar completamente os cookies do usu√°rio e vincular toda a l√≥gica √† phpsession. <br><br>  5¬™ linha - inje√ß√µes do PostgreSQL. <br>  Como consertar? <br>  Usando declara√ß√£o preparada. <br>  Implementa√ß√£o de declara√ß√£o preparada para verificar o login <br><br><pre><code class="plaintext hljs">$query = "SELECT username FROM login WHERE username=?"; $stmt = $conn-&gt;prepare($query); $stmt-&gt;execute(array($username)); $username = $stmt-&gt;fetchColumn(); if($username == FALSE) { die(" !"); }</code> </pre> <br>  11 line - uma s√©rie de decis√µes mal sucedidas. <br><br><ol><li>  Vida √∫til da sess√£o muito longa.  Um ano inteiro √© muito.  Se o cookie for invadido com √™xito, √© poss√≠vel um longo acesso √† conta do usu√°rio pelo invasor. </li><li>  Sinalizador httpOnly ausente.  Se definido como TRUE, os cookies ser√£o acess√≠veis apenas atrav√©s do protocolo HTTP.  Ou seja, neste caso, os cookies n√£o estar√£o dispon√≠veis para linguagens de script como JavaScript. </li><li>  Sem hash de cookie. </li><li>  Falta de definir o sinalizador seguro.  O sinalizador seguro indica que um cookie deve ser enviado do cliente por uma conex√£o HTTPS segura.  Se definido como TRUE, o cookie do cliente ser√° enviado ao servidor somente se uma conex√£o segura for estabelecida. </li></ol><br>  Como consertar? <br>  Por padr√£o, no php, o tempo de vida da sess√£o √© de apenas 24 minutos, vamos implementar isso. <br>  Defina o sinalizador seguro, httpOnly. <br><br>  Nesse caso, voc√™ deve recusar o cookie de usu√°rio estranho e vincular toda a l√≥gica √† phpsession. <br><br>  18 line - XSS (ingl√™s em scripts entre sites - "script entre sites"). <br>  Como consertar?  Converta todos os caracteres poss√≠veis nas entidades HTML correspondentes. <br><br><pre> <code class="plaintext hljs">$query = htmlentities($query, ENT_QUOTES, "UTF-8");</code> </pre> <br>  Indicaremos explicitamente a codifica√ß√£o para evitar sua substitui√ß√£o por UTF-7. <br><br><pre> <code class="plaintext hljs">header("Content-Type: text/html; charset=utf-8");</code> </pre> <br>  Linha 20 - defeitos do sistema de autentica√ß√£o e armazenamento da sess√£o. <br><br>  Problema - se voc√™ definir o ID do usu√°rio codificado em base64 no usu√°rio do cookie, poder√° efetuar login na conta dele! <br><br>  Como consertar?  Ao autorizar o usu√°rio, registramos a sess√£o no banco de dados e, ao instalar a sess√£o, verificamos sua presen√ßa no banco de dados. <br><br><pre> <code class="plaintext hljs"> $query = "SELECT sessions FROM login WHERE sessions=?"; $stmt = $conn-&gt;prepare($query); $stmt-&gt;execute(array($_COOKIE["user"])); $session = $stmt-&gt;fetchColumn(); if($session == TRUE) { do_login($_COOKIE["user"]); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Coment√°rio de especialista D:</b> <div class="spoiler_text"><blockquote>  A primeira pergunta com a qual o question√°rio encontrou futuros estagi√°rios se referia √†s principais e amplamente conhecidas vulnerabilidades da web.  A √∫nica dificuldade aqui √© a necessidade de v√™-los no c√≥digo fonte em PHP.  No entanto, ningu√©m definiu a tarefa de "ocultar bugs". <br><br>  Aqui est√° uma lista de vulnerabilidades que podem ser detectadas nesta lista em ordem de frequ√™ncia de sua detec√ß√£o: <br><br>  <b>O hash de senha usando o algoritmo MD5 foi</b> observado at√© por candidatos distantes da web.  No entanto, tamb√©m havia nuances interessantes, por exemplo, muitos candidatos usavam termos muito incorretos, tentando descrever os problemas com suas pr√≥prias palavras.  ‚ÄúVulnerabilidades no algoritmo‚Äù, ‚Äúfun√ß√µes unidirecionais‚Äù, ‚Äúa exist√™ncia de colis√µes‚Äù e outras mudan√ßas estranhas entraram em batalha; ap√≥s uma an√°lise mais aprofundada, elas acabam sendo nada mais que um conjunto de grandes palavras que n√£o revelam a ess√™ncia.  Obviamente, aqui fomos a uma reuni√£o e n√£o encontramos falhas nas pessoas que est√£o se preparando para embarcar no caminho para aprender a sabedoria da seguran√ßa da informa√ß√£o.  Para obter uma "compensa√ß√£o", basta mencionar a amea√ßa, que, em caso de comprometimento do banco de dados, os hashes md5 podem ser resolvidos por um invasor em um tempo aceit√°vel e senhas (ou seq√º√™ncias de caracteres equivalentes) podem ser obtidas em texto n√£o criptografado.  E, √© claro, muitos mencionaram a falta de sal e for√ßa bruta com base no uso de mesas arco-√≠ris.  Tamb√©m percebemos esses coment√°rios de maneira positiva, especialmente se o entrevistado explicou por que isso √© uma amea√ßa. <br><br>  <b>Inje√ß√£o potencial de SQL.</b>  √â dif√≠cil adicionar algo;  ao formar uma chamada para o banco de dados, a entrada do usu√°rio de login e senha √© concatenada diretamente com a solicita√ß√£o.  Se for improv√°vel que voc√™ possa manipular o valor da senha nesse est√°gio (um hash √© retirado dele), a introdu√ß√£o de uma inje√ß√£o no nome de usu√°rio n√£o ser√° dif√≠cil para um invasor em potencial. <br><br>  <b>Sa√≠da de informa√ß√µes de depura√ß√£o desnecess√°rias que levam a um ataque XSS.</b>  Ao ler atentamente a listagem, √© poss√≠vel prestar aten√ß√£o √† chamada de eco, que exibe a solicita√ß√£o gerada para o banco de dados nos coment√°rios HTML da p√°gina.  Obviamente, essa conclus√£o de informa√ß√µes adicionais para a p√°gina √© completamente opcional e, provavelmente, simplesmente esquecida pelo desenvolvedor ap√≥s a realiza√ß√£o dos testes.  Essas informa√ß√µes adicionais s√£o muito ben√©ficas para o invasor e permitem uma compreens√£o muito melhor de como o aplicativo funciona.  Infelizmente, por√©m, isso √© apenas metade do problema.  O fato √© que um invasor pode manipular o conte√∫do da vari√°vel de consulta e seu conte√∫do n√£o pode ser filtrado ou escapado antes de ser exibido ao usu√°rio - h√° um poss√≠vel ataque XSS.  No entanto, sua explora√ß√£o pode acabar sendo uma dor de cabe√ßa devido √† fun√ß√£o do strtoupper mal localizada.  O vetor injetado pelo invasor ser√° mai√∫sculo e, se isso n√£o for um problema para as tags HTML, o Javascript ficar√° muito ofendido com essa apela√ß√£o.  Isso pode ser verificado facilmente usando o console do navegador. <br><br><img src="https://habrastorage.org/webt/cg/ev/oy/cgevoykot6pzht0mx5ppeqyxwne.png"><br><br>  Bem, pelo menos, aparentemente, o invasor ter√° que recorrer aos chamados "ataques sem script" ou t√©cnicas sofisticadas para ignorar a filtragem (nesse caso, o JSFUCK faria), para que o fato de um risco √† seguran√ßa n√£o cancele isso. <br><br>  <b>Um erro na l√≥gica do mecanismo de gerenciamento de sess√µes</b> foi a parte mais interessante da tarefa.  Sua descoberta exigia n√£o apenas ler a fonte linha por linha, mas tamb√©m entender a l√≥gica de toda a listagem.  Pode-se sentir que algo est√° errado observando a configura√ß√£o de um cookie contendo o ID do usu√°rio codificado em base64 no bloco de lembrete-me.  Uma an√°lise mais aprofundada da l√≥gica desse mecanismo nos leva ao pensamento: ‚ÄúAcontece que um invasor que conhece ou passa pelo ID pode fazer login em qualquer conta sem inserir um nome de usu√°rio e senha?!‚Äù.  Sim, de fato, um invasor pode gerar independentemente um usu√°rio de cookie do seu lado e atribuir a ele qualquer valor de ID codificado por base64.  O envio de uma solicita√ß√£o com esse cookie sem nome de usu√°rio e senha acionaria a fun√ß√£o do_login e efetuaria login na conta de outra pessoa. <br><br>  A men√ß√£o dessas 4 vulnerabilidades na resposta dos candidatos influenciou diretamente suas pontua√ß√µes. <br><br>  No entanto, muito dependia da qualidade da resposta.  Mencionar maneiras de corrigir a situa√ß√£o, observa√ß√µes sobre fatores adicionais que afetam a viabilidade de um ataque, o uso dos termos certos e a capacidade de estruturar seus pensamentos, coment√°rios sobre fraquezas adicionais ou amea√ßas em potencial - tudo isso aqueceu nossos cora√ß√µes e levou a um aumento na classifica√ß√£o final. <br></blockquote><br></div></div><br><hr><br><h1>  <strong><font color="#cc0000">No. 2.</font></strong>  <strong><font color="#cc0000">Jwt</font></strong> </h1><br>  Ao pesquisar um aplicativo da web, voc√™ descobriu que o aplicativo usa um token JWT como autoriza√ß√£o. <br><br>  Que preocupa√ß√µes de seguran√ßa voc√™ v√™, que tipo de verifica√ß√£o voc√™ faria? <br><br>  Token JWT: <br><br><pre> <code class="plaintext hljs">eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6InNla2EiL CJpYXQiOjE1MTYyMzkwMjIsInJvbGUiOiJub2JvZHkiLCJpc0FkbWluIjoiRmFsc2UiLCJwYX Nzd29yZCI6IjFkMDBjYUgifQ.F7Y1mCAmg5-QFok-rkpLdwe8prCyiKsCyJ-3Z5f7luI</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">An√°lise de trabalho</b> <div class="spoiler_text">  Dan JSON Web Tokens (JWT). <br>  Sua estrutura -&gt; [base64url (HEADER)]. [Base64url (PAYLOAD)]. [Base64url (SIGNATURE)] <br>  [base64url (HEADER)] = eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0 <br>  decodifica√ß√£o base64url -&gt; {"alg": "None", "typ": "JWT"} <br>  Pode-se notar imediatamente o fato de que o algoritmo de assinatura (‚Äúalg‚Äù: ‚ÄúNone‚Äù) da assinatura n√£o √© usado.  Algumas bibliotecas JWT n√£o suportam o algoritmo ‚Äúnone‚Äù, ou seja, o algoritmo de assinatura.  Quando o cabe√ßalho alg √© "none", o lado do servidor n√£o executa a verifica√ß√£o de assinatura. <br>  Ou seja, voc√™ pode gravar qualquer carga √∫til em base64url e sua assinatura n√£o ser√° verificada. <br>  O que nos permite criar um usu√°rio com direitos de administrador. <br><br>  Al√©m disso, o fato de a parte da carga √∫til n√£o usar cabe√ßalhos como aud (define os destinat√°rios para os quais o token JWT se destina) e exp (a vida √∫til do token) simplifica nossas vidas. <br><br>  Carga √∫til estimada <br>  eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6ImhhY2siLCJpYXQiOjE1MTYyMzkwMjIsInJvbGUiOiJub2JvZHkiLCJpc0FkbWluIjoiVHJ1ZSIsInBhc3N3b3JkIjoiaGFjayJ9 <br><br>  carga √∫til da decodifica√ß√£o base64url -&gt; {"sub": "1234567890", "nome": "hack", "iat": 1516239022, "role": "nobody", "isAdmin": "True", "password": "hack ¬ª} <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Coment√°rio de especialista D:</b> <div class="spoiler_text"><blockquote>  No trabalho do auditor, muitas vezes √© necess√°rio lidar com novas tecnologias, e a capacidade de entend√™-las √© muito importante.  Incluindo essa pergunta no question√°rio, assumimos que a maioria dos candidatos mal ouvia falar da tecnologia dos tokens JWT, exceto pelo nome.  Portanto, essa quest√£o, em primeiro lugar, visava a capacidade de pesquisar e analisar informa√ß√µes de fontes p√∫blicas.  Como resultado, uma pessoa que perdeu a emiss√£o do Google a pedido de "JWT" ‚Äã‚Äãe "jwt vulnerability" pode chegar √†s seguintes conclus√µes: <br><br>  1. Esse token n√£o possui um algoritmo de assinatura; portanto, um invasor pode modificar qualquer campo dentro do token, o que n√£o √© assumido pelo conceito de tokens JWT. <br><br>  2. Os campos dentro do token cont√™m a senha do usu√°rio em texto n√£o criptografado; armazenar essas informa√ß√µes no token √©, no m√≠nimo, uma m√° pr√°tica.  Na maioria dos casos, voc√™ pode recusar tal decis√£o e, assim, aumentar seu n√≠vel de seguran√ßa. <br><br>  3. Lembrando a falta de uma assinatura e nossa capacidade de modificar os campos dentro do token, √© l√≥gico supor que alterar o valor de isAdmin possa aumentar nossos privil√©gios para privil√©gios de administrador. <br><br>  4. Outra id√©ia interessante que poucas pessoas mencionadas em sua resposta se refere ao fato da capacidade de transferir entrada do usu√°rio nos campos de um token JWT.  Em uma situa√ß√£o normal, um invasor n√£o pode influenciar os dados no token de forma alguma, o que significa que os desenvolvedores geralmente podem negligenciar a introdu√ß√£o de verifica√ß√µes adicionais no c√≥digo dos manipuladores.  Isso sugere a id√©ia simples: mas vamos tentar realizar ataques cl√°ssicos n√£o atrav√©s dos par√¢metros GET / POST, mas atrav√©s de campos de token.  Isso pode dar um resultado inesperadamente bom.  Essa abordagem criativa, com a justificativa correta de nossas a√ß√µes, foi muito apreciada por n√≥s na avalia√ß√£o de ambos, este e outros assuntos. <br><br>  Muitos candidatos em suas respostas organizaram uma breve recontagem de como o token JWT √© estruturado e, onde √© usado, foi interessante ler e, no entanto, antes de tudo, avaliamos os aspectos da resposta em rela√ß√£o √† seguran√ßa. <br></blockquote><br></div></div><br><hr><br><h1>  <strong><font color="#cc0000">N√∫mero 3.</font></strong>  <strong><font color="#cc0000">CORS / CSRF / IDOR / ???</font></strong> </h1><br><br>  No aplicativo Web, a senha do usu√°rio √© alterada usando a seguinte solicita√ß√£o (consulte a Op√ß√£o 1).  Quais amea√ßas potenciais √† seguran√ßa voc√™ v√™?  Quais verifica√ß√µes voc√™ faria?  A situa√ß√£o mudar√° no caso do seguinte comportamento (consulte a Op√ß√£o 2)?  Explique sua resposta. <br><img src="https://habrastorage.org/webt/mr/b-/se/mrb-seaadzkgqbmqvsq-zcqflyo.jpeg"><br><div class="spoiler">  <b class="spoiler_title">An√°lise de trabalho</b> <div class="spoiler_text">  <b>Op√ß√£o 1</b> <br>  "Quais amea√ßas potenciais √† seguran√ßa voc√™ v√™?" <br><br>  1) Falta de controle de acesso. <br>  Se o usu√°rio - um n√∫mero para o qual a solicita√ß√£o de altera√ß√£o de senha est√° sendo feita n√£o estiver marcado, a senha poder√° ser alterada para qualquer usu√°rio registrado no sistema. <br>  Como consertar?  - Correspond√™ncia de JSESSION do banco de dados e o id-shnik solicitado. <br><br>  2) A capacidade de realizar ataques de CSRF <br>  Atra√≠mos um usu√°rio autorizado a um host controlado por n√≥s e, depois de fazer uma solicita√ß√£o, para example.com em nome da v√≠tima, altere a senha. <br>  Como consertar?  - Adicionando token CSRF. <br><br>  <b>Op√ß√£o 2</b> <br>  "Quais amea√ßas potenciais √† seguran√ßa voc√™ v√™?" <br>  Uma falha na pol√≠tica do CORS. <br>  √â recomend√°vel que voc√™ coloque na lista branca o cabe√ßalho Access-Control-Allow-Origin. <br><br>  Como consertar?  - <br><br>  1) Modificando o arquivo .htaccess <br><br><pre> <code class="plaintext hljs">&lt;ifmodule mod_headers.c&gt; Header always set Access-Control-Allow-Origin: "https://whitelist.domain.ru" Header always set Access-Control-Allow-Methods "PUT" &lt;/ifmodule&gt;</code> </pre><br>  2) PHP <br><br><pre> <code class="plaintext hljs">&lt;?php header('Access-Control-Allow-Origin: ‚Äúhttps://whitelist.domain.ru‚Äù); header('Access-Control-Allow-Methods: PUT'); ?&gt;</code> </pre><br>  "A situa√ß√£o mudar√° com o seguinte comportamento?" <br><br>  Sim  Como no segundo caso, uma solicita√ß√£o PUT √© usada, o que √© importante, pois o uso de uma solicita√ß√£o PUT torna a solicita√ß√£o CORS "dif√≠cil", o que, por sua vez, nos priva completamente da oportunidade de realizar um ataque CSRF + a aus√™ncia de um cabe√ßalho como Acesso-Controle-Permitir-Credenciais: true nos priva a capacidade de enviar no local com outros cabe√ßalhos http e cookies de usu√°rio. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Coment√°rio de especialista I:</b> <div class="spoiler_text"><blockquote>  Vamos considerar, em ordem, quais s√£o os principais problemas vis√≠veis nas consultas fornecidas: <br><br>  1) De fato, como o identificador num√©rico do usu√°rio "10012" √© observado na solicita√ß√£o, o primeiro passo √© verificar se √© poss√≠vel alterar a senha de outro usu√°rio?  Posso <b>especificar o ID de outra pessoa o</b> suficiente? <br>  As vulnerabilidades da classe IDOR s√£o bastante f√°ceis de explorar e geralmente t√™m alta criticidade. <br><br>  2) A solicita√ß√£o para alterar a senha ocorre pelo m√©todo POST, o token CSRF n√£o √© observado e o tipo de conte√∫do √© ‚Äútexto / sem formata√ß√£o‚Äù.  Existe a possibilidade de <b>falsificar uma solicita√ß√£o.</b> <br><br>  Conseq√ºentemente, para alterar a senha da v√≠tima, basta que o invasor os conven√ßa a visitar o link "malicioso". <br><br>  3) Nos cabe√ßalhos de resposta, o servidor <b>revela a vers√£o do software usado</b> .  Isso pode ser chamado de vulnerabilidade, mas √© melhor esconder esses banners - os invasores podem encontrar facilmente as explora√ß√µes conhecidas de 1 dia neles, al√©m do valor do software usado simplificar bastante o planejamento de novos ataques. <br><br>  4) Teremos o maior prazer em ver a frase "O que acontecer√° se <b>mudarmos o formato dos dados de JSON para XML</b> ?" <br><br>  O fato √© que as estruturas modernas s√£o inteligentes, on√≠voras e podem processar dados em diferentes formatos.  E ao analisar XML, muitas vezes √© permitida uma vulnerabilidade XXE perigosa.  Com sua ajuda, o invasor pode "ir" para a rede interna, pode ler arquivos de configura√ß√£o do servidor e, ocasionalmente, executar o RCE. <br><br>  5) Eu tamb√©m queria ver um coment√°rio como "Por que <b>o conhecimento do antigo n√£o √© verificado</b> ao alterar a senha?" <br><br>  Quanto √† ‚ÄúVariante n¬∫ 2‚Äù, h√° uma ‚Äúarmadilha‚Äù nela - os cabe√ßalhos CORS s√£o usados ‚Äã‚Äãaqui e o Tipo de Conte√∫do da solicita√ß√£o j√° est√° definido como ‚Äúapplication / json‚Äù. <br><br>  O erro que a grande maioria dos candidatos cometeu √© a resposta do formul√°rio "-Este √© o asterisco em Allow-Origin, o que significa que voc√™ pode enviar solicita√ß√µes de qualquer site!" <br><br>  N√£o, voc√™ n√£o pode.  Primeiro, o cabe√ßalho Allow-Credentials: True est√° ausente, o que significa que o navegador deve executar a solicita√ß√£o "com cookies", para que a solicita√ß√£o seja an√¥nima, sem uma sess√£o.  E segundo, mesmo que esse cabe√ßalho estivesse presente, o navegador ainda proibiria o envio de cookies - apenas por causa do "asterisco".  A combina√ß√£o deles √© proibida e o navegador √© ignorado. <br></blockquote></div></div><br><hr><br><h1>  <strong><font color="#cc0000">N√∫mero 4.</font></strong>  <strong><font color="#cc0000">Despejo de rede</font></strong> </h1><br>  Imagine que voc√™ entrou na rede interna da empresa e interceptou o tr√°fego cujo despejo est√° anexado abaixo.  Descreva quais ataques voc√™ tentaria realizar e com quais ferramentas? <br><br>  Despejo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">yadi.sk/d/qkLcfwSCzdxcwg</a> <br><br><div class="spoiler">  <b class="spoiler_title">An√°lise de trabalho</b> <div class="spoiler_text">  1) Spoofing LLMNR &lt; <br>  Um invasor na sub-rede local pode ouvir e responder √†s mensagens de difus√£o, alegando que o nome do host solicitado √© seu pr√≥prio endere√ßo IP. <br>  Isso leva ao fato de que o computador cliente solicitante est√° conectado ao computador do invasor e, dependendo do protocolo, pode tentar se autenticar. <br><br>  Os utilit√°rios usados ‚Äã‚Äãs√£o o Intercepter-NG, um projeto no githab VindicateTool. <br><br>  2) abuso de HSRP. <br>  Problem√°tico - quando o par√¢metro "preempt" √© definido como 1, o invasor tem a oportunidade de "bloquear" outros roteadores, devido √† maior prioridade.  Depois de enviar o HSRP para o multicast, o roteador controlado se torna o roteador principal (roteador ativo) na rede e todo o tr√°fego passa por ele.  De fato, chegamos √† implementa√ß√£o de ataques mitm. <br><br>  Para esse vetor de ataque, precisamos saber o grupo e a senha. <br>  No despejo de tr√°fego que nos foi dado, reconhecemos o grupo (√© - 3) e a senha.  A senha no nosso caso √© o padr√£o - cisco. <br><br>  Os utilit√°rios usados ‚Äã‚Äãs√£o yersinia, scapy. <br><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Coment√°rio do especialista X:</b> <div class="spoiler_text"><blockquote>  O objetivo da pergunta era determinar a familiaridade do estagi√°rio com t√©cnicas modernas (e n√£o t√£o) para conduzir ataques do MitM.  Vejamos os cen√°rios poss√≠veis com base em um despejo de tr√°fego existente: <br><br>  <b>1) falsifica√ß√£o de ARP</b> <br>  A falsifica√ß√£o de ARP √© a maneira mais antiga e f√°cil de implementar ataques MitM.  Consiste no envio de uma solicita√ß√£o ARP gratuita ao host A. <br><br>  O endere√ßo IP do host B √© o endere√ßo IP e nosso endere√ßo MAC √© o endere√ßo MAC.  Essa solicita√ß√£o permite modificar a tabela ARP no host A, for√ßando-o a enviar solicita√ß√µes ao nosso dispositivo ao tentar entrar em contato com o host B. O host B geralmente √© o gateway padr√£o. <br><br>  Ferramentas recomendadas: bettercap, arpspoof <br><br>  <b>2) LLMNR, falsifica√ß√£o de NBNS</b> <br>  Resolu√ß√£o de nome de difus√£o seletiva local e servi√ßo de nome NetBIOS s√£o os protocolos usados ‚Äã‚Äãpara resolver nomes de host na rede local.  Diferentemente do protocolo DNS, n√£o h√° servidor dedicado que armazena todas as informa√ß√µes; em vez disso, a solicita√ß√£o √© transmitida a todos os hosts da rede; se o nome do host na solicita√ß√£o corresponder ao nome do host do dispositivo, ele enviar√° uma resposta. <br><br>  Como foi observado corretamente na resposta, o invasor pode responder a essas solicita√ß√µes enviando seu endere√ßo IP na resposta, o que levar√° ao fato de que, no futuro, a v√≠tima entrar√° em contato com o dispositivo do invasor, em vez do dispositivo cujo nome de host apareceu na solicita√ß√£o.  Al√©m disso, um invasor pode solicitar autentica√ß√£o NTLM da v√≠tima, o que faz com que o dispositivo v√≠tima envie um hash NTLM, que pode ser usado ainda mais para for√ßa bruta. <br><br>  Ferramentas recomendadas: Respondente <br><br>  <b>3) falsifica√ß√£o de WPAD</b> <br>  A falsifica√ß√£o WPAD pode ser atribu√≠da a um caso especial de falsifica√ß√£o LLMNR e NBNS.  O protocolo de detec√ß√£o autom√°tica de proxy da Web √© usado para configurar automaticamente um servidor proxy HTTP. <br><br>  O dispositivo envia uma solicita√ß√£o LLMNR / NBNS com o nome do host wpad, recebe o endere√ßo IP correspondente e tenta acessar o arquivo wpad.dat via HTTP, que armazena informa√ß√µes sobre as configura√ß√µes de proxy. <br><br>  Como resultado, um invasor pode executar falsifica√ß√£o de LLMNR / NBNS e fornecer √† v√≠tima seu arquivo wpad.dat; como resultado, todo o tr√°fego HTTP e HTTPS passar√° pelo invasor. <br><br>  Ferramentas recomendadas: Responder, mitm6 <br><br>  <b>4) An√∫ncio do roteador</b> <br>  Como voc√™ pode ver no dump, existem dispositivos com IPv6 habilitado na rede.  Enquanto estiver na rede, voc√™ pode tentar enviar mensagens para o an√∫ncio do roteador IPv6 da v√≠tima para alterar o gateway ou o servidor DNS padr√£o. <br><br>  As mensagens de an√∫ncio de roteador (RA) fazem parte do mecanismo SLAAC (Stateless Address Autoconfiguration), necess√°rio para obter automaticamente endere√ßos IPv6 em uma rede, sem usar um servidor DHCPv6 ou em conjunto com ele.  Isso √© feito enviando periodicamente mensagens de multicast RA para o roteador, que cont√©m o endere√ßo de gateway padr√£o, o prefixo da rede, o endere√ßo do servidor DNS, o prefixo do dom√≠nio. <br><br>  Ferramentas recomendadas: pacote bruto <br><br>  <b>5) falsifica√ß√£o de DHCP</b> <br>  Al√©m disso, em um despejo, as solicita√ß√µes de descoberta de DHCP do mesmo dispositivo s√£o repetidas em alguns intervalos.  Podemos concluir que n√£o h√° servidor DHCP nesta rede e responder √† pr√≥xima solicita√ß√£o de descoberta, indicando a v√≠tima como um gateway padr√£o para o dispositivo. <br><br>  Ferramentas recomendadas: Yersinia <br><br>  <b>6) falsifica√ß√£o de HSRP</b> <br>  Al√©m disso, os pacotes HSRP podem ser vistos no dump.  O protocolo Hot Standby Router pode aumentar a disponibilidade de roteadores que atuam como o gateway padr√£o.          IP-,     -.   Hello -        ,           .           HSRP, ,      ,      HSRP         . <br><br>  : Yersinia <br><br> <b>7) STP-</b> <br> Spanning Tree Protocol      L2-  .    BPDU-,           ,     .          BPDU-,   ,   ,    ,    ,         ,   ,   ,     STP,    ,    . <br><br>  : Yersinia <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ5. NGINX config</font></strong> </h1><br><br>    - nginx.  ,       ? <br><br> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pastebin.com/nYp7uVbB</a> <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   nginx,          : <br> 1)  86 ,   http  X-Managed      secured,  nginx     /management/ <br> 2)        API  70  105 . <br><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  J:</b> <div class="spoiler_text"><blockquote>        ,          .   nginx    ,     web-,       nginx    web-  /.           nginx ,  , ,     . <br><br> ,     ,   ,            .      ,         . ,    ,     . <br><br>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gixy</a> . <br><br> Gixy  4    : <br><br> <b>1) Alias travesal:</b> <br><br>   80     : <br><br><pre> <code class="plaintext hljs">location /static { alias /prod_static/; }</code> </pre><br>     - ,    .  : //host/static../etc/passwd.   -     alias:     ,   /static,   /prod_static/,       : /prod_static/../etc/passwd,      /etc/passwd.    alias traversal  <a href=""></a> <br><br> <b>2) Http Splitting (CRLF injection)</b> <br>    nginx  ,   ,        .       HTTP-. <br> : <a href="https://github.com/yandex/gixy/blob/master/docs/ru/plugins/">github.com/yandex/gixy/blob/master/docs/ru/plugins/httpsplitting.md</a> <br><br> <b>3)   -   </b> <br>   75      ¬´rigin¬ª   .    , -       , ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">production.host.evil.com</a> . <br> : <a href="">github.com/yandex/gixy/blob/master/docs/ru/plugins/origins.md</a> <br><br> <b>4)     add_header</b> <br>  nginx  :      add_header,       , ,    ,  .      CSP      . <br> : <a href="">github.com/yandex/gixy/blob/master/docs/ru/plugins/addheaderredefinition.md</a> <br><hr><br>  ,   gixy,          .       : <br><br> 1)   17     <b>default_type   text/html.</b>     :   ,     ,  nginx    Content-Type,    default_type.   ,         Content-Type: text/html.            HTML-  ,   , , XSS-   . <br><br> <b>2)    POST-</b> <br>  29-30   ,           .  ,   ‚Äú‚Äù POST-.       . !       SSRF  ,     ,   ,     , . <br><br> <b>3)   php-fpm</b> <br>   48  ,  FastCGI-    unix ,    9000.  ,    ,   .   ,      PHP-. <br><br> <b>4) ‚Äú‚Äù CSP</b> <br>  production.host  Content-Security-Policy,    Javascript,    . <br><br> <b>5) ‚Äú‚Äù CORS</b> <br>   76-77   CORS,          ,       cookie  . <br><br> 6)     ,   86   <b>  </b>  .       secured     /managed. <br><br> 7)      ,    ,        ,    -. ,   ,  ,    /user/{userid}  IDOR. <br><br>   ,       ,    ,     . <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ6. Linux Permissions</font></strong> </h1><br>     Linux      ? <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">  ~ ()  Debian <br> C              ( ,      /etc/passwd). <br> ,      ftp  ,     ~. <br><br> : <br> * root@server:~# ls ~ftp <br> * welcome.msg <br>      : <br> * root@server:~# cat ~ftp/welcome.msg <br> * Welcome, archive user %U@%R! <br>   ,    :      : <br> * root@amorale:~# echo ~ftp <br> * /srv/ftp <br><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  K:</b> <div class="spoiler_text"><blockquote>    ,        : <br><br><ul><li>       </li><li>  ACL      </li><li>    </li><li>      </li><li>  capabilities </li></ul><br>   ,      ,   : <br> ‚Äú ,   root‚Äù   . <br><br>      ,     <code>Linux/Unix</code> . <br>    ,        ‚Äú ‚Äù ‚Äî           . <br>   ,     ,    <code>funky_test.txt</code>      <br><br><pre> <code class="plaintext hljs">-rwxrw-rx 1 alice interns 12  4 13:00 funky_test.txt</code> </pre> <br> ,    Linux/Unix   : <br><br><ul><li>  - ‚Äî    ‚Äúrwx‚Äù  alice </li><li>   ‚Äî    ‚Äúrw‚Äù   interns </li><li>    ‚Äî    ‚Äúrx‚Äù  others </li></ul><br>          <code>read, write, execute</code> . <br><br> ,     ‚Äî       ,      : <br><br><ul><li>    ,      read </li><li>    ,      read </li><li>     read </li></ul><br>  ,       <code>read</code>            .      ,      execute  . <br><br>            ,    . <br><br>          , ,    .      : <br><br> 1.          ,       ls. <br><br> 2.      ‚Äî <code>POSIX Access Control Lists</code> . <br><br><h4>    c   . </h4><br><h6>  1 </h6><br> ,   <code>alice</code>     <code>interns</code> .      <code>funny_test.txt</code>    : <br><br><pre> <code class="plaintext hljs">$ whoami alice $ id uid=1001(alice) gid=1001(alice) groups=1001(alice),1002(interns) $ ls -la ----rwx--- 1 alice interns 12  4 13:00 funky_test.txt $ cat funky_test.txt cat: funky_test.txt: Permission denied $</code> </pre><br><h5>  2 </h5><br>   ‚Äî   <code>funky_test.txt</code>  604.    <code>bob</code> ,    <code>interns</code>    : <br><br><pre> <code class="plaintext hljs">$ whoami bob $ id uid=1002(bob) gid=1003(bob) groups=1003(bob),1002(interns) $ ls -la funky_test.txt -rw----r-- 1 alice interns 12  4 13:00 funky_test.txt $ cat funky_test.txt cat: funky_test.txt: Permission denied</code> </pre><br><h5>  </h5><br>    <code>alice</code>       ,  .  , <code>permission_denied</code>    : <br><br><pre> <code class="plaintext hljs">$ id uid=1001(alice) gid=1001(alice) groups=1001(alice),1002(interns) $ ls -la ----rwx--- 1 alice interns 12  4 13:00 funky_test.txt $ chmod 777 funky_test.txt $ ls -la funky_test.txt -rwxrwxrwx 1 alice interns 12  4 13:00 funky_test.txt $ cat funky_test.txt secret_pass</code> </pre><br>      bob    . <br><br><h5>   </h5><br>    ,          ¬´  ¬ª,  : <br><br><ul><li>  ID      <code>effective UID</code> ‚Äî      </li><li>  GID        <code>effective GID</code> ‚Äî      </li><li>      others. </li></ul><br><h5>   </h5><br>  ,      ‚Äî   ,       ‚Äú‚Äù    ,        ,    , : <br><br><ul><li>    ,   ,          <code>others</code>     </li><li>   ,     ,   <code>others</code>     </li></ul><br>           . <br><br><h4> POSIX Access Control Lists </h4><br>      ‚Äî         /.   ,     ACL,  ,       ‚Äú <code>+</code> ‚Äù <br><br>      POSIX ACLs,    ‚Äî     ,            .      ACL,        . <br><br><h5>  Exemplo </h5><br>   .        <code>alice</code>   <code>funky_test.txt</code>  ,   <br><br><pre> <code class="plaintext hljs">-rwxrw-rx 1 alice interns 12  4 13:00 funky_test.txt</code> </pre> <br>      ACL.  <code>getfacl</code> , ,    ACL,   ,     <code>ls</code> . <br><br><pre> <code class="plaintext hljs">$ getfacl funky_test.txt # file: funky_test.txt # owner: alice # group: interns user::rwx group::rw- other::rx</code> </pre><br>   , ACL        .  ,     bob  : <br><br><pre> <code class="plaintext hljs">setfacl -mu:bob:rwx funky_test.txt</code> </pre><br>       ‚Äú <code>+</code> ‚Äù   <br><br><pre> <code class="plaintext hljs">ls -l funky_test.txt -rwxrwxr-x+ 1 alice interns 12  4 13:00 funky_test.txt</code> </pre><br>     : <br><br><pre> <code class="plaintext hljs">getfacl funky_test.txt # file: funky_test.txt # owner: alice # group: interns user::rwx user:bob:rwx group::rw- mask::rwx other::rx</code> </pre><br>  ACL     .  : <br><br><ol><li>     .      <code>effective UID</code>  <code>effective GID</code>  ‚Äî  .        ,       ACL,       .  ,     ,   ,  ,         ,    . </li><li>   ACL  <code>mask</code> ,      ACL    <code>owner, group, others</code> </li></ol><br><h5>   </h5><br>  ,         ,  ,     ‚Äî      . <br><br>   ,  ACL,     , : <br><br><ul><li>        ACL,     ; </li><li>   ,         ACL,     . </li></ul><br></blockquote></div></div><br><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ7. Network Dump II</font></strong> </h1><br>            .  ,        ,   ,       . <br><br>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">yadi.sk/d/e3gNme4MBo6tFQ</a> <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   ‚Äî      . <br>      ,     . <br>   ,     . <br><br><img src="https://habrastorage.org/webt/2t/zn/ip/2tznipywtpqwalr5drvxxr4z0sw.png"><br><br>   ,     SMB-,  ,    ,       .       SMB object list (File -&gt; Export objects -&gt; SMB‚Ä¶ ). <br><br>    ‚Äî     . <br><br><img src="https://habrastorage.org/webt/fe/rt/xy/fertxyt0du3kv3qwcmivz1m6opg.png"><br> <i>(  SMB object list)</i> <br><br><img src="https://habrastorage.org/webt/xo/yd/t-/xoydt-qmcbddrx1lkoqmpplyslg.png"><br> <i>(NotTruePass.jpg)</i> <br><br>     . <br><br>        ‚Äú‚Äù    TCP-‚Ä¶     .    .  :( <br><br>    ,        .    . <br><br><img src="https://habrastorage.org/webt/fd/ch/fc/fdchfcsbkrwxmx08ltr_1qnoozg.png"><br> <i>(  desktop.ini)</i> <br><br>     ‚Äú‚Äù     . ,      NTLM,   ,  ,  NTLM      ‚ÄúPass-the-hash‚Äù.               ¬´-¬ª. <br><br>     ‚Äú‚Äù    : <br><br><pre> <code class="plaintext hljs">1)User - 1 Account: IEUser Domain: WIN7 Host: WIN7 hex dump session key - 49 0c 38 3e f8 eb 63 88 79 0f 62 84 09 84 d2 dc 2) User - 2 Account: winwin Domain: WIN7 Host: WIN7 hex dump session key - 8d f6 1b 35 79 a3 78 d3 2e 81 09 f1 95 4f 71 0a 3) User - 3 Account: 192.192.192.29 Domain: WIN7 Host: WIN7 hex dump session key - c3 19 e0 21 1b e2 63 c6 03 9e e7 38 1b 56 f0 d1</code> </pre><br>            .       MSEDGEWIN10. <br><br>    ‚Äî     : <br><br> 1) SMB Relay. <br>           . <br>      ,   MITM- <br> (.             ). <br><br>      ‚Äî        ,      ,  . <br>      .       ,       . <br><br>    ,  ,  ,     . <br><br> 2) NTLM Relay. <br>         ,  NTLM-. <br><br>         ,   NTLM-. <br><br>          . <br>     ,     ,  ,    . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">  K:</b> <div class="spoiler_text"><blockquote>   ,  ,    : <br><br><ol><li>    (    ) </li><li>        ‚Äî / </li><li>      ,       </li></ol><br>       ,        : <br><br><ol><li>     </li><li>     </li><li>     </li></ol><br>     Wireshark,    <code>Protocol Hierarchy Statistics</code>  <code>Conversations</code> . <br><br> <code>Protocol Hierarchy Statistics</code> ‚Äî           . <br><br><img src="https://habrastorage.org/webt/_3/sy/co/_3sycoln1juvmnzbdlzrug24fgq.png"><br><br> Conversations ‚Äî   ,         . <br><br><img src="https://habrastorage.org/webt/31/xp/r7/31xpr7rmhyghnrctn3acyznwa9w.png"><br><br><img src="https://habrastorage.org/webt/rw/21/_d/rw21_dwv4digkin6kodypnfpl2w.png"><br><br>       : <br><br><ol><li>    (60%) ‚Äî  TCP, ,  , SMB.   Protocol hierarchy  SMB  40%,        TCP,     ,     20%      SMB. </li><li>      192.192.192.128  192.192.192.129.   SMB      . </li></ol><br> <b>  </b> <br><br>    . <br><br>        ‚Äî     SMB. <br><br>        ,    ‚Äî     wireshark ‚Äî  <code>ExportObject</code> . <br>              <code>tcp stream</code> .     ,     ,    <code>tcp stream</code> ,            .           ,      . <br><br>    , ,     ,     ,     .  ,         . <br><br> <b>  .</b> <br>     SMB       . <br><br>    NTLM-     ‚Äúntlmssp‚Äù.    <code>info</code> ,  3    : <br><br><img src="https://habrastorage.org/webt/mm/gn/pj/mmgnpjekpvddsd1f6vdx5ih8hec.png"><br><br> ,        . <br><br><img src="https://habrastorage.org/webt/rk/ix/7m/rkix7mvmxaaxs09m0vvazlblvco.png"><br><br><img src="https://habrastorage.org/webt/tx/zc/hc/txzchc1u7ufdzoqkjxtnrnsvfd0.png"><br><br><img src="https://habrastorage.org/webt/pd/hg/vd/pdhgvdcc_obs9smchhmwidqmawy.png"><br><br>          Net-NTLMv2-,  : <br><br><ul><li> challenge  </li><li> response  </li><li>   </li></ul><br>  <code>Net-NTLMv2</code>       <code>hashcat</code> . <br><br> ,        <code>WIN7\winwin</code>  <code>WIN7\192.192.192.129</code> ‚Äî      ,          .    <code>WIN7\IEUser</code> ‚Äî ,       ,  ,  ,   ,  SMB. <br><br>  <code>Net-NTLM</code>   ,   ,    Wireshark.    ,  PCredz (https://github.com/lgandx/PCredz) <br><br><img src="https://habrastorage.org/webt/jd/gn/zj/jdgnzjzb6pgscawu43bxtf5wc0y.png"><br><br>     <code>IEUser</code> (   )     hashcat. <br><br><img src="https://habrastorage.org/webt/ky/i6/gf/kyi6gfki84pqjj4fgjximusk9qa.png"><br><br> <b>     ,      .</b> <br><br>        6,   ,   <code>SMB/NTLM</code> , <code>DNS</code> . <br><br> ,      ,    <code>NT</code>  <code>LM</code>  <code>NTLMv1 (Net-NTLMv1)</code> , <code>NTLMv2 (Net-NTLMv2)</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">     </a> ). <br><br> -    <code>NT</code>  <code>LM</code>  <code>NTLM</code> ,         <code>NTLM</code>  <code>NTLMv1</code>  <code>NTLMv2</code> . ,           .    . <br><br>     ,  <code>NTLMv1/NTLMv2</code> ‚Äî    challenge-response .        ,    . <br><br>  NT  LM ‚Äî   ‚Äú  ‚Äù ‚Äî        . <br><br>      : <br><br><ul><li> PassTheHash ‚Äî ,        ,     .  Mas     ,  <code>NT</code> .  PassTheHash  NTLMv2  ‚Äî   .        ,      ‚Äú‚Äù  ,       ,    . </li><li> NTLM Relay ‚Äî ,        ,     NTLM.      ,    . </li><li> Spoofing,     Windows: LLMNR, NetBios </li><li>     : MS17-010,    /  ,   . </li></ul><br> <b></b> <br><br>     : <br><br><ul><li>    ( ) </li><li>       </li><li>       ,           </li><li>            eternalBlue </li><li>  NTLM relay </li><li>   NTLM relay    ‚Äî   SMB </li><li>       </li><li>   ,     (ARP-spoofing,  DNS   )  </li></ul><br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ8. SSH Pivoting Tricks</font></strong> </h1><br><img src="https://habrastorage.org/webt/ui/gy/a1/uigya1oqcd1poeuc6whph79ehzw.png"><br>      (10.0.10.0/24),      SSH  Linux- (10.0.20.5)    (10.0.20.0/24).   ,         .     ,         ,     //  Linux-. <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> ,    ,   : <br>    <br> nmap      <br><br>    ? <br><br> : <br><br> 1)  ping. <br>  -&gt; ping -b 10.0.20.255 <br>  ping  ,     ,    . <br>    ,               . <br>           . <br> ,     CentOS 7. <br>        . <br><br><img src="https://habrastorage.org/webt/7y/vu/rn/7yvurntbjwgei1q8rr6yth0kjww.png"><br> <i>(  )</i> <br><br>    ,           .  :( <br><br><img src="https://habrastorage.org/webt/nd/r1/jc/ndr1jchof8-_rzbgh-ru1xg7vh0.png"><br><br> 2)   ARP-  . <br>  -&gt; <br>  Debian ‚Äî arp-scan --interface=/* */ 10.0.0.0/16 <br>  Linux      arp,    ( Debian) -   ,      arp-scan. <br> arp-scan,   ,      ,    . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">  KryaKrya:</b> <div class="spoiler_text"><blockquote>       ,           ,  ,      Pivoting.      ,      ,   ,          ,      ,          . <br><br> ,       ping    ,  ARP- (arp -a),    (route).   ,     netcat (nc -h),  ,      (nc -vnz 10.0.20.3 0-1000).    ,      ,        , , ,   ,   -     bash,   python      . <br><br>     ‚Äî    SSH-,   SOCKS-  SSH,          . <br> ssh -D 1337 user@10.0.20.5 -f -N <br><br>            .     nmap  SOCKS-   proxychains    . <br><br> proxychains nmap 10.0.20.0/24 <br> nmap 10.0.20.0/24 --proxy socks4://10.0.20.5:1337 <br><br>     nmap       - SOCKS-.     SYN- ( nmap    )  SOCKS-,  SOCKS-    TCP-   ,  SYN-      ,    SYN,    SYN ACK.      CONNECT- (-sT),  nmap      SOCKS-. <br><br> nmap -sT 10.0.20.0/24 --proxy socks4://10.0.20.5:1337 <br><br> ,    -  ,         ,        . ,       Linux-,   nmap  -sT  ,     ,     ,      ,    ,    ,        . <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ9. Android SSL pinning bypass</font></strong> </h1><br>      Android.  ,        HTTPS. <br><br> 1) ,           HTTP . <br><br> 2)  ,      SSL-pinning,        ? <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> ¬´,           HTTP-.¬ª <br><br>        . <br>        proxy host   wifi. <br><br>  Android     ,  ,      . <br><br>  ‚Äî    (  )   ‚Äî   ( ,  ). <br>  ,      MITM,   Android 6.0,      ,     . <br><br>       6.0,         . <br><br> ¬´ ,      SSL-pinning,        ?¬ª <br><br>  ,    SSL-pinning. <br><br> SSL-pinning ‚Äî   ,    ,   ¬´¬ª      . <br><br>        HTTPS-,   ,  ¬´¬ª.      ,       . <br><br>   ,      MITM-,    . <br><br>   ,      ,     ,       . <br><br>   ‚Äî  Frida. <br> Frida ‚Äî    Dinamic Instrumentation Toolkit,    ,         . <br> , Frida        Javascript. <br>       Frida     ,    , ,  ¬´True¬ª  ¬´False¬ª,     . <br><br>     Frida: <br><br> 1.      ,      .      -. <br><br> 2.      Frida.        Root. <br><br>      . <br>  APK-           .  ,       ,      . <br>      .     apk  META-INF    . <br><br> ‚Äú‚Äù APK-. <br>       APK   smali   Java,     ,     . <br>     ,    ,     . <br><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  I:</b> <div class="spoiler_text"><blockquote> ,     MITM HTTPS       . <br><br>      ,       Proxy   WiFi.      ProxyDroid,    iptables  . <br><br> ,      Root ,         , ? <br><br>    SSL-Pinning,    , ,  ‚ÄúFrida+Objection‚Äù. ,           :) <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">‚Ññ10.    ?</font></strong> </h1><br>          ,       . <br><br>    ‚Äú ‚Äù. ,      ,  dns-rebinding. <br><br>     .  Obrigado pela aten√ß√£o! <br><br><hr><br> <b>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Digital Security</a></b> <br><br>    ,       . <br>       3  (  -      ).      0  5        2.5,   3.1337. <br><br>      .  ,     50 .        ,          ‚Äú <i>   </i> ‚Äù   -   ) <br><br>         .      29 ,     43.5.         24%    . <br><br>    : <br><br><img src="https://habrastorage.org/webt/fn/iq/fb/fniqfb7brnsnuqx08am8vx7xmtq.png"><br><br> ,         ,       ,    ,     ,              .    ,       ,     .         . <br><br>  ,     , ,  ,                  . <br><br> ,  ,          : <br><br><img src="https://habrastorage.org/webt/wn/z_/p9/wnz_p90qafczlytjrpuddurwkbc.jpeg"><br><br>          (  !),    ,          ,   ,         ‚Äú ‚Äù. <br><br>             -     ,        ,        . ,        ,   Summer of Hack 2019. <br><br>     ,                 .                    . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461077/">https://habr.com/ru/post/pt461077/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461067/index.html">As 65 principais perguntas sobre SQL das entrevistas de emprego para as quais voc√™ deve estar preparado em 2019. Parte I</a></li>
<li><a href="../pt461069/index.html">C√¢meras IP externas Nobelic: testes, tecnologias e recursos dos sistemas de vigil√¢ncia por v√≠deo Ivideon</a></li>
<li><a href="../pt461071/index.html">Otimiza√ß√£o de consultas ao banco de dados no exemplo de servi√ßo B2B para construtores</a></li>
<li><a href="../pt461073/index.html">Conectamos mapas on-line ao navegador no smartphone. Parte 3 - OverpassTurbo</a></li>
<li><a href="../pt461075/index.html">Intelig√™ncia de neg√≥cios. Objetos de TI, componentes, ferramentas</a></li>
<li><a href="../pt461079/index.html">Cidade sem engarrafamentos</a></li>
<li><a href="../pt461081/index.html">O dia em que Dodo parou. Script ass√≠ncrono</a></li>
<li><a href="../pt461083/index.html">Software de grava√ß√£o com a funcionalidade dos utilit√°rios cliente-servidor Windows, parte 02</a></li>
<li><a href="../pt461085/index.html">Alternar idioma no aplicativo Android</a></li>
<li><a href="../pt461087/index.html">Gerando masmorras e cavernas para o meu jogo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>