<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“¡ ğŸ‘‘ ğŸ¤šğŸ½ Badoo Jira API Client: magic in Jira dalam PHP ğŸ‘µğŸ¿ ğŸ‘¨ğŸ¾â€ğŸ« ğŸ¯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jika Anda memasukkan "Jira Badoo" di string pencarian di HabrÃ©, hasilnya akan membutuhkan lebih dari satu halaman: kami menyebutkannya hampir di mana-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Badoo Jira API Client: magic in Jira dalam PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/475840/"> Jika Anda memasukkan "Jira Badoo" di string pencarian di HabrÃ©, hasilnya akan membutuhkan lebih dari satu halaman: kami menyebutkannya hampir di mana-mana, karena itu memainkan peran penting dalam proses kami.  Dan kita masing-masing ingin sedikit berbeda darinya. <br><br><img src="https://habrastorage.org/webt/xy/8u/z0/xy8uz0gbqfd5idb0tokgpsxvdqs.jpeg"><br><br>  Pengembang, yang menerima tugas untuk tinjauan, mengharapkan bahwa cabang diindikasikan dalam tugas, ada tautan ke diff dan log perubahan.  Pengembang yang menulis kode mengharapkan untuk melihat komentar di Jira setelah ulasan.  Penguji, yang menerima tugas setelah mereka, ingin melihat hasil tes dan dapat menjalankan rakitan yang diperlukan tanpa pergi ke antarmuka lain.  Manajer produk umumnya ingin membuat sepuluh tugas pengembangan secara bersamaan dengan menekan satu tombol. <br><br>  Dan semua ini tersedia hari ini dan terjadi secara otomatis.  Kami menerapkan sebagian besar keajaiban dalam PHP menggunakan Jira API yang terus berkembang dan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">webhook</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nya</a> .  Dan hari ini kami ingin berbagi dengan komunitas versi klien kami untuk API ini. <br><br>  Pada awalnya, kami hanya ingin berbicara tentang ide-ide dan pendekatan yang kami gunakan, dan kemudian memutuskan bahwa tidak ada cukup kode untuk artikel seperti itu untuk kejelasan.  Jadi ada versi open-source <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Klien Badoo Jira PHP</a> .  Terima kasih banyak kepada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ShaggyRatte</a> karena membantu deskripsinya.  Dan selamat datang di kat! <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Lebih detail dan konteks.</b> <div class="spoiler_text">  Jika Anda memerlukan detail lebih lanjut tentang apa yang kami lakukan dengan Jira, Anda dapat menemukannya di artikel kami yang lain: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/en/company/badoo/blog/169417</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/en/company/badoo/blog/433540</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/en/company/badoo/blog/424655</a> <br></div></div><br><h2>  Apa yang bisa dia lakukan? </h2><br>  Faktanya, Badoo Jira PHP Client adalah sekumpulan kelas wrapper siap pakai untuk respons Jira API, yang sebagian besar dapat berperilaku seperti ActiveRecord: mereka tahu cara mendapatkan data tentang diri mereka sendiri dan cara memperbaruinya di server, mendukung inisialisasi malas dan caching data di tingkat kode.  Semua entitas Jira yang harus Anda kerjakan selalu dibungkus: <b>Masalah, Status, Prioritas, Changelog, Pengguna, Versi, Komponen</b> , dll. (Hampir semua yang Anda lihat di antarmuka). <br><br>  Selain itu, Badoo Jira PHP Client menyediakan hierarki kelas tunggal untuk semua bidang khusus Jira dan mampu menghasilkan definisi kelas untuk setiap bidang khusus yang Anda butuhkan. <br><br><pre><code class="php hljs">$Issue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Badoo\Jira\Issue(<span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>); $Issue-&gt;addComment(<span class="hljs-string"><span class="hljs-string">'Sample comment text'</span></span>); $Issue-&gt;attachFile(<span class="hljs-string"><span class="hljs-string">'kitten.jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'pretty!'</span></span>, <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($Issue-&gt;getStatus()-&gt;getName() === <span class="hljs-string"><span class="hljs-string">'Open'</span></span>) { $Issue-&gt;step(<span class="hljs-string"><span class="hljs-string">'In Progress'</span></span>); }</code> </pre> <br><pre> <code class="php hljs">$DeveloperField = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Example\CustomFields\Developer($Issue); $DeveloperField-&gt;setValue(<span class="hljs-string"><span class="hljs-string">'username'</span></span>)-&gt;save();</code> </pre><br><pre> <code class="php hljs">$User = \Badoo\Jira\User::get(<span class="hljs-string"><span class="hljs-string">'username'</span></span>); $User-&gt;watchIssue(<span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>); $User-&gt;assign(<span class="hljs-string"><span class="hljs-string">'SMPL-2'</span></span>);</code> </pre><br>  Berkat ini, interaksi dengan API dari PHP menjadi lebih mudah dan nyaman, dan dokumentasi untuk Jira Anda langsung berpindah ke kode, yang memungkinkan Anda menggunakan pelengkapan otomatis dalam IDE untuk banyak tindakan standar. <br><br>  Tetapi hal pertama yang pertama. <br><br><h2>  Fitur API yang kami temui </h2><br>  Ketika kami mulai aktif menggunakan Jira API, itu hanya tersedia melalui protokol SOAP.  Versi REST-nya muncul kemudian, dan kami termasuk pengguna pertama.  Pada saat itu, ada sangat sedikit klien REST yang tersedia untuk umum yang ditulis dalam PHP.  Bahkan lebih sulit untuk menemukan sesuatu yang dapat dengan mudah diintegrasikan ke dalam basis kode kami, secara bertahap berpindah dari SOAP ke REST.  Jadi kami tidak punya pilihan: kami memutuskan untuk terus mengembangkan klien kami sendiri. <br><br>  Jadi kami hidup dengan menyeret dan menjatuhkan semua jenis retas dan kruk dari klien SOAP dan memperoleh yang baru karena kekhasan REST.  Sebagai hasilnya, kami telah mengembangkan beberapa kelas yang sangat berani dengan banyak kode duplikat, dan ada kebutuhan untuk menghapus kekacauan ini. <br><br>  Bidang kebiasaan selalu menjadi tempat paling menyakitkan bagi kami: kami memiliki lebih dari 300 bidang (saat penulisan artikel ini - 338), dan jumlah ini perlahan-lahan bertambah. <br><br><h3>  Pesan kesalahan aneh </h3><br>  Selama sejarah panjang berinteraksi dengan API, kami telah melihat banyak hal berbeda.  Sebagian besar pesan kesalahan sudah memadai, tetapi ada beberapa yang harus Anda susahkan. <br><br>  Misalnya, jika Jira tiba-tiba mengenali robot di pengguna Anda, dia akan mulai menunjukkan padanya captcha.  Dalam hal ini, saat mengakses API, tanpa malu-malu mengabaikan header <i>Accept-Encoding: application / json</i> dan memberi Anda HTML.  Biasanya, klien yang menunggu JSON mungkin tidak siap untuk "halo" ini. <br><br>  Dan berikut ini adalah contoh bekerja dengan bidang khusus: <br><br><img width="600" src="https://habrastorage.org/webt/sc/xt/xe/scxtxekex33vyguynhxr9hjpp_m.png"><br><br>  Saat Anda menulis kode dan "tes sekarang" Anda mengujinya, sangat mudah untuk memahami bahwa customfield_12664 adalah <b>Pengembang</b> .  Dan jika kesalahan seperti itu merayap keluar di suatu tempat di produksi (misalnya, karena seseorang mengubah konfigurasi dan mengubah daftar nilai yang dapat diterima untuk bidang Select), seringkali satu-satunya cara untuk mengidentifikasi bidang adalah dengan masuk ke Jira dan mencari tahu nama dari sana.  Selain itu, dalam antarmuka, ID tidak ditampilkan - hanya nama. <br><br>  Ternyata ketika Anda ingin mengetahui nama bidang yang menyebabkan kesalahan dan memperbaiki konfigurasinya, Anda dapat melakukan ini baik melalui permintaan ke API, atau menggunakan beberapa metode tidak jelas lainnya: mengobrak-abrik kode sumber halaman, membuka pengaturan untuk bidang arbitrer dan mengoreksi URL di bilah alamat, dll. Proses ini tidak dapat disebut nyaman, dan setiap kali terlalu banyak waktu untuk tugas yang begitu sederhana. <br><br>  Tetapi nama-nama bidang yang tidak jelas tidak terbatas pada masalah.  Seperti inilah interaksi dengan API jika Anda membuat kesalahan dalam struktur data untuk memperbarui bidang: <br><br><img width="600" src="https://habrastorage.org/webt/v_/ab/jo/v_abjobegilkmh8tjdoh2sigius.png"><br><img width="600" src="https://habrastorage.org/webt/pr/nr/fg/prnrfg7hbhxtge1pwejzmuvrgsq.png"><br><br><h3>  Banyak format data yang berbeda </h3><br>  Dan jangan lupa bahwa memperbarui bidang dari berbagai jenis memerlukan struktur data yang berbeda. <br><br><pre> <code class="php hljs">$Jira-&gt;issue()-&gt;edit( <span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'customfield_10200'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'denkoren'</span></span>], <span class="hljs-string"><span class="hljs-string">'customfield_10300'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'PHP'</span></span>], <span class="hljs-string"><span class="hljs-string">'customfield_10400'</span></span> =&gt; [[<span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Android'</span></span>], [<span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'iOS'</span></span>]], <span class="hljs-string"><span class="hljs-string">'security'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">100500</span></span>], <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Just text'</span></span>, ], );</code> </pre><br>  Jawaban API untuk mereka tentu saja juga berbeda. <br><br>  Adalah mungkin untuk mengingat ini hanya jika Anda terus-menerus bekerja dengan Jira API dan tidak terganggu untuk waktu yang lama dengan memecahkan masalah lain.  Jika tidak, fitur-fitur ini akan kehabisan memori dalam beberapa minggu.  Selain itu, Anda perlu mengingat jenis bidang yang Anda butuhkan untuk â€œmemberi makanâ€ dengan struktur yang benar.  Ketika Anda memiliki ratusan bidang khusus, Anda sering harus mencari kode tempat masih digunakan, atau naik ke panel admin Jira. <br><br>  Sebelum kami menulis klien kami, Stack Overflow dan Komunitas Atlassian adalah teman terbaik saya tentang memperbarui bidang khusus.  Sekarang informasi ini di-google-kan dengan mudah dan cepat, tetapi kami beralih ke REST API ketika masih cukup baru dan dikembangkan secara aktif: butuh sepuluh menit untuk menemukan permintaan CURL yang sesuai di Google, dan kemudian Anda harus mengurai kurung dengan mata Anda dan mengonversi ke dalam struktur yang benar untuk PHP, yang sering tidak berfungsi pada percobaan pertama. <br><br>  Secara umum, interaksi dengan bidang khusus adalah proses yang reorganisasi diperlukan sejak awal. <br><br><h2>  Terdiri dari apa klien? </h2><br><h3>  Kelas untuk bekerja dengan bidang khusus </h3><br>  Pertama-tama, kami ingin menyingkirkan mengingat struktur data untuk berinteraksi dengan API dan mendapatkan nama bidang yang dapat dibaca saat terjadi kesalahan. <br><br>  Akibatnya, kami membuat hierarki kelas tunggal untuk semua bidang khusus.  Ternyata tiga lapisan: <br><br><ol><li>  Orang tua abstrak yang umum untuk semua orang: <b>\ Badoo \ Jira \ CustomFields \ CustomField</b> . </li><li>  Oleh kelas abstrak untuk setiap jenis bidang: <b>SelectField, UserField, TextField</b> , dll. </li><li>  Berdasarkan kelas untuk setiap bidang spesifik: misalnya, <b>Pengembang</b> atau <b>Peninjau</b> . </li></ol><br>  Kelas-kelas ini dapat ditulis secara independen, atau dapat dibuat secara otomatis menggunakan skrip-generator khusus (kami akan kembali ke sana). <br><img src="https://habrastorage.org/webt/1p/zz/eu/1pzzeucvu78qctdq-12elpstlkm.png"><br><br>  Berkat struktur ini, untuk mengajarkan kode untuk memperbarui nilai bidang kustom Anda dari tipe <b>Select List (pilihan ganda)</b> , cukup membuat kelas PHP yang diwarisi dari <b>SelectField</b> .  Bahkan, setiap bidang Jira kustom berubah menjadi ActiveRecord biasa dalam kode PHP. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> \<span class="hljs-title"><span class="hljs-title">Example</span></span>\<span class="hljs-title"><span class="hljs-title">CustomFields</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Developer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Badoo</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jira</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomFields</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleUserField</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ID = <span class="hljs-string"><span class="hljs-string">'customfield_10200'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> NAME = <span class="hljs-string"><span class="hljs-string">'Developer'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// ,  ,  !</span></span></code> </pre><br><br>  Di kelas yang sama, kami menyimpan informasi tentang bidang: secara default, ini adalah ID, nama bidang, dan daftar nilai yang tersedia, jika terbatas (misalnya, untuk <b>Kotak Centang</b> dan <b>Pilih</b> ). <br><br><div class="spoiler">  <b class="spoiler_title">Contoh bidang di antarmuka Jira dan kelas yang terkait</b> <div class="spoiler_text"><img width="500" src="https://habrastorage.org/webt/ea/dd/bf/eaddbfm0cphjpqionp16hqstxg0.png"><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IssueFor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Badoo</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jira</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomFields</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleSelectField</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ID = <span class="hljs-string"><span class="hljs-string">'customfield_10662'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> NAME = <span class="hljs-string"><span class="hljs-string">'Issue for'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Available field values. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_BI = <span class="hljs-string"><span class="hljs-string">'BI'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_C_C = <span class="hljs-string"><span class="hljs-string">'C\C++'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_HTML_CSS = <span class="hljs-string"><span class="hljs-string">'HTML\CSS'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_JS = <span class="hljs-string"><span class="hljs-string">'JS'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_OTHER = <span class="hljs-string"><span class="hljs-string">'Other'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_PHP = <span class="hljs-string"><span class="hljs-string">'PHP'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_TRANSLATION = <span class="hljs-string"><span class="hljs-string">'Translation'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUES = [ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_BI, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_C_C, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_HTML_CSS, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_JS, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_OTHER, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_PHP, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_TRANSLATION, ]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemsList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::VALUES; } }</code> </pre><br></div></div><br>  Ternyata jenis dokumentasi itu untuk Jira Anda, yang terletak langsung di kode PHP.  Ketika sangat dekat, sangat nyaman dan secara signifikan mempercepat pengembangan, sekaligus mengurangi jumlah kesalahan. <br><br>  Selain itu, pesan kesalahan menjadi lebih jelas: alih-alih tidak mengatakan apa pun, <b>'customfield_12664'</b> macet, misalnya, sesuatu seperti ini: <br><br><pre> <code class="plaintext hljs">Uncaught Badoo\Jira\Exception\CustomField: User 'asdkljfh' not found in Jira. Can't change 'Developer' field value.</code> </pre><br><h3>  Kelas untuk bekerja dengan objek sistem </h3><br>  Jira memiliki banyak data dengan struktur yang kompleks: misalnya, bidang <b>Status</b> dan Sistem <b>Keamanan</b> , tautan antara tugas, pengguna, versi, lampiran (file). <br><br>  Kami juga membungkus mereka dalam kelas: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   $Status = $Issue-&gt;getStatus(); $Status-&gt;getName(); $Status-&gt;getId();</span></span></code> </pre><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// changelog  $History = \Badoo\Jira\Issue\History::forIssue('SMPL-1'); $seconds_in_status = $History-&gt;getTimeInStatus('Open');</span></span></code> </pre><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  Jira $User = new \Badoo\Jira\User('sampleuser'); $User-&gt;assign('SMPL-1');</span></span></code> </pre><br>  Pembungkus seperti itu memberi IDE Anda kemampuan untuk mengetahui data mana yang tersedia dan memungkinkan Anda untuk memformalkan antarmuka fungsi dalam kode Anda secara ketat.  Kami secara aktif menggunakan deklarasi tipe, hampir selalu memungkinkan kami melihat kesalahan bahkan ketika menulis kode berkat penyorotan IDE.  Dan jika Anda masih melewatkan kesalahan, itu akan keluar tepat di tempat pertama kali muncul, dan bukan di mana Anda akhirnya menjatuhkan kode Anda. <br><br>  Masih ada metode statis yang memungkinkan Anda mendapatkan objek dengan cepat dengan beberapa kriteria: <br><br><pre> <code class="php hljs">$users = \Badoo\Jira\User::search(<span class="hljs-string"><span class="hljs-string">'&lt;pattern&gt;'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    login, email  display name $Version = \Badoo\Jira\Version::byName('&lt;project&gt;', '&lt;version name&gt;'); //        $components = \Badoo\Jira\Component::forProject('&lt;project&gt;'); //     </span></span></code> </pre><br>  Metode ini mematuhi aturan umum sehingga mudah ditemukan: <br><ul><li>  <i>:: search ()</i> , jika Anda perlu menemukan objek berdasarkan beberapa bidang: \ Badoo \ Jira \ Issue :: search () mencari tugas menggunakan JQL, di mana Anda dapat menentukan banyak kriteria pencarian, dan \ Badoo \ Jira \ User :: search () mencari pengguna secara bersamaan dengan <i>'name'</i> (login), <i>'email'</i> dan <i>'displayName'</i> (nama yang dirender di web); </li><li>  <i>:: by * ()</i> , jika Anda perlu mendapatkan objek bukan dengan ID, tetapi dengan kriteria lain: \ Badoo \ Jira \ User :: byEmail () mencari pengguna dengan alamat emailnya; </li><li>  <i>:: for * ()</i> mencari semua objek yang terkait dengan sesuatu: \ Badoo \ Jira \ Version :: forProject <br>  memberikan semua versi dari proyek tertentu; </li><li>  <i>:: fromStdClass ()</i> akan membuat objek dari data mentah yang memiliki struktur yang sesuai, tetapi tidak diterima dari API, tetapi, misalnya, dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">webhook</a> : di badan permintaan POST, Jira mengirim JSON dengan informasi berbeda tentang acara tersebut, termasuk badan tugas termasuk semua bidang.  Berdasarkan data ini, Anda dapat membuat objek \ Badoo \ Jira \ Issue dan menggunakannya seperti biasa. </li></ul><br><h3>  Masalah Kelas \ Badoo \ Jira \ </h3><br>  Menurut saya, tangkapan layar PhpStorm berikut ini cukup fasih: <br><br><img width="600" src="https://habrastorage.org/webt/ox/_m/jz/ox_mjzztnjrjtzexiudykocfkwc.png"><br><br>  Pada dasarnya, objek <b>\ Badoo \ Jira \ Issue</b> mengikat semua yang dijelaskan di atas ke dalam satu sistem.  Ia menyimpan semua informasi tentang tugas itu, ia memiliki metode untuk akses cepat ke data yang paling sering digunakan, tugas transfer antar status, dll. <br><br>  Untuk membuat objek dalam kasus yang paling sederhana, cukup mengetahui kunci tugas saja. <br><br><div class="spoiler">  <b class="spoiler_title">Buat objek hanya dengan kunci tugas di saku Anda</b> <div class="spoiler_text"><pre> <code class="php hljs">$Issue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Badoo\Jira\Issue(<span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>);</code> </pre><br></div></div><br>  Anda juga dapat menggunakan dataset yang terfragmentasi.  Misalnya, informasi tautan antara tugas-tugas yang tiba dari API hanya berisi beberapa bidang: id, ringkasan, status, prioritas, dan issuetype.  <b>\ Badoo \ Jira \ Issue</b> memungkinkan Anda mengumpulkan objek dari data ini sehingga dapat segera dikembalikan, dan sisanya, mengakses API. <br><br><div class="spoiler">  <b class="spoiler_title">Buat objek, nilai caching untuk beberapa bidang</b> <div class="spoiler_text"><pre> <code class="php hljs"> $IssueFromLink = \Badoo\Jira\Issue::fromStdClass( $LinkInfo, [ <span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'key'</span></span>, <span class="hljs-string"><span class="hljs-string">'summary'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>, <span class="hljs-string"><span class="hljs-string">'priority'</span></span>, <span class="hljs-string"><span class="hljs-string">'issuetype'</span></span>, ] );</code> </pre><br></div></div><br>  Ini dicapai melalui inisialisasi malas dan caching data dalam kode.  Pendekatan ini sangat nyaman karena Anda hanya dapat menukar objek <b>\ Badoo \ Jira \ Issue</b> dalam kode Anda, terlepas dari kumpulan bidang mana mereka dibuat. <br><br><div class="spoiler">  <b class="spoiler_title">Dapatkan data tugas yang hilang</b> <div class="spoiler_text"><pre> <code class="php hljs">$IssueFromLink-&gt;getSummary(); <span class="hljs-comment"><span class="hljs-comment">//    API,    $IssueFromLink-&gt;getDescription(); //  API    description</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Bagaimana kita menuju ke API</b> <div class="spoiler_text">  Di Jira API, dimungkinkan untuk mendapatkan tidak semua bidang untuk tugas, tetapi hanya bidang yang saat ini diperlukan: misalnya, hanya kunci dan ringkasan.  Namun, kami sengaja tidak pergi ke Jira hanya untuk satu bidang di pengambil.  Pada contoh di atas, getDescription () akan memperbarui informasi tentang semua bidang sekaligus.  Karena <b>\ Badoo \ Jira \ Issue</b> tidak memiliki gagasan sedikit pun tentang apa lagi yang Anda butuhkan selanjutnya, lebih menguntungkan untuk mendapatkan semuanya dari API segera, karena kami tetap pergi ke sana.  Ya, kueri "dapatkan hanya deskripsi" dan kueri "dapatkan semua bidang secara default" untuk beberapa ratus tiket membutuhkan waktu yang berbeda, tetapi untuk satu perbedaan ini tidak begitu terlihat. <br><br><pre> <code class="plaintext hljs">//Time for single field: 0.40271635055542 (second) //Time for all default fields: 0.84159119129181 (second)</code> </pre><br>  Dari angka-angka itu jelas bahwa ketika menerima hanya tiga bidang (satu dalam permintaan), lebih menguntungkan untuk mendapatkan semuanya sekaligus, daripada pergi ke API untuk masing-masing.  Hasil pengukuran ini, pada kenyataannya, tergantung pada konfigurasi Jira dan server yang digunakannya.  Dari tugas ke tugas dan dari pengukuran ke pengukuran, angka-angka berubah dan <b>Waktu untuk semua bidang standar</b> ternyata secara stabil kurang dari tiga <b>Waktu untuk bidang tunggal</b> , dan seringkali bahkan kurang dari dua. <br><br>  Namun, ketika bekerja dengan sejumlah besar tugas, perbedaannya dapat diukur dalam hitungan detik.  Karenanya, ketika Anda tahu bahwa Anda hanya perlu kunci dan deskripsi untuk 500 tiket, kemampuan untuk mendapatkannya dengan satu permintaan efektif tetap ada di metode <b>\ Badoo \ Jira \ Issue :: search ()</b> dan <b>\ Badoo \ Jira \ Issue :: byKeys ()</b> . <br><br></div></div><br>  <b>\ Badoo \ Jira \ Issue</b> - umumnya tentang tugas di beberapa Jira abstrak.  Tetapi Jira Anda (seperti milik kami) tidak abstrak - ia memiliki serangkaian bidang khusus yang sangat spesifik dan alur kerjanya sendiri.  Anda sering menggunakan beberapa bidang dan transisi, jadi tidak nyaman untuk mengikutinya dari jauh.  Oleh karena itu, <b>\ Badoo \ Jira \ Issue</b> dapat dengan mudah diperluas dengan metode sendiri khusus untuk konfigurasi Jira tertentu. <br><br><div class="spoiler">  <b class="spoiler_title">Contoh ekstensi kelas dengan metode untuk mendapatkan bidang kustom dengan cepat</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> \<span class="hljs-title"><span class="hljs-title">Deploy</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Issue</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Badoo</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jira</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Issue</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// â€¦ /** * Get 'Developer' custom field as object */ function getDeveloperField() : \Deploy\CustomFields\Developer { return $this-&gt;getCustomField(\Deploy\CustomFields\Developer::class); } // ... }</span></span></code> </pre><br></div></div><br><br><h3>  Masalah buat permintaan </h3><br>  Membuat tugas di Jira adalah prosedur yang agak rumit.  Ketika Anda melakukan ini melalui antarmuka web, Anda akan diperlihatkan layar khusus (Buat Layar) dengan seperangkat bidang.  Beberapa dari mereka dapat Anda isi hanya karena Anda inginkan, dan beberapa ditandai sebagai wajib.  Pada saat yang sama, Buat Layar dapat menjadi unik untuk setiap proyek dan bahkan untuk berbagai jenis tugas dalam satu proyek.  Jadi ada semua jenis pembatasan pada nilai-nilai bidang dan pada sangat mungkin untuk menetapkan nilai bidang dalam proses pembuatan tugas. <br><br>  Hal yang paling tidak menyenangkan bagi pengembang dalam situasi ini adalah pembatasan ini berlaku untuk API.  Yang terakhir memiliki permintaan khusus ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">create-meta telah</a> tersedia di REST API sejak versi 5.0), yang dengannya Anda bisa mendapatkan daftar pengaturan bidang yang tersedia saat membuat tugas.  Namun, pengembang yang perlu "hanya melakukan hal sederhana sekarang" kemungkinan besar tidak akan repot dengan ini. <br><br>  Akibatnya, itu terjadi seperti ini: karena permintaan untuk membuat tugas bisa sangat besar, kami sering menambahkan data secara bertahap, dan kami menerima kesalahan ketika kami mencoba mengirim semuanya ke Jira.  Setelah itu, saya harus melihat kode untuk semua tempat di mana ada sesuatu yang berubah dalam permintaan, dan untuk upaya yang panjang dan membosankan untuk memahami apa yang sebenarnya salah. <br><br>  Karenanya, kami melakukan <b>\ Badoo \ Jira \ Issue \ CreateRequest</b> .  Ini memungkinkan Anda untuk melihat kesalahan sebelumnya, tepat di tempat Anda mencoba melakukan sesuatu yang salah: berikan bidang semacam nilai melengkung atau ubah bidang yang tidak tersedia.  Misalnya, jika Anda mencoba memberi tahu tugas komponen yang tidak ada dalam proyek, pengecualian akan macet di tempat Anda melakukannya, dan bukan di mana Anda akhirnya mengirim permintaan ke API. <br><br><div class="spoiler">  <b class="spoiler_title">Alur kerja dengan CreateRequest terlihat seperti ini</b> <div class="spoiler_text"><pre> <code class="php hljs">$Request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Badoo\Jira\Issue\CreateRequest(<span class="hljs-string"><span class="hljs-string">'DD'</span></span>, <span class="hljs-string"><span class="hljs-string">'Task'</span></span>, $Client); $Request -&gt;setSummary(<span class="hljs-string"><span class="hljs-string">'summary'</span></span>) -&gt;setDescription(<span class="hljs-string"><span class="hljs-string">'description'</span></span>) -&gt;setFieldValue(<span class="hljs-string"><span class="hljs-string">'For QA'</span></span>, <span class="hljs-string"><span class="hljs-string">'custom field with some comments for QA who will check the issue'</span></span>); $Request-&gt;send();</code> </pre><br></div></div><br><h3>  Bekerja dengan API secara langsung </h3><br>  Set kelas yang dijelaskan di atas mencakup sebagian besar kebutuhan.  Namun, kami sangat sadar bahwa mayoritas jauh dari segalanya.  Oleh karena itu, kami juga memiliki klien kecil untuk bekerja dengan API secara langsung - <b>\ Badoo \ Jira \ REST \ Client</b> . <br><br><div class="spoiler">  <b class="spoiler_title">Wadah Penggunaan Pelanggan</b> <div class="spoiler_text"><pre> <code class="php hljs">$Jira = \Badoo\Jira\REST\Client::instance(); $Jira-&gt;setJiraUrl(<span class="hljs-string"><span class="hljs-string">'https://jira.example.com/'</span></span>); $Jira-&gt;setAuth(<span class="hljs-string"><span class="hljs-string">'user'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>) $IssueInfo = $Jira-&gt;issue()-&gt;get(<span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>);</code> </pre><br></div></div><br><h2>  Generator kelas untuk bidang khusus </h2><br>  Agar nyaman dengan bidang kustom, setiap bidang harus memiliki kelasnya sendiri dalam kode.  Kami membuat sendiri secara manual sesuai kebutuhan, tetapi sebelum mempublikasikan klien kami memutuskan bahwa pendekatan ini mungkin tidak nyaman bagi pengguna baru.  Oleh karena itu, kami membuat generator khusus yang bisa pergi ke Jira API untuk daftar bidang khusus dan membuat kelas templat untuk jenis bidang yang dikenal. <br><br>  Kami percaya bahwa untuk sebagian besar tugas, cukup menggunakan <b>bin / menghasilkan</b> skrip CLI dari repositori kami.  Anda dapat memintanya untuk menceritakan tentang dirinya sendiri melalui opsi <b>--help / -h</b> : <br><br><pre> <code class="bash hljs">./bin/generate --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span></code> </pre><br>  Dalam kasus yang paling sederhana, untuk generasi sudah cukup untuk menentukan URL Jira Anda, pengguna, kata sandinya, namespace untuk kelas-kelas dan direktori tempat meletakkan kode: <br><br><pre> <code class="bash hljs">./bin/generate -u user -p password --jira-url https://jira.mlan --target-dir custom-fields --namespace CustomFields</code> </pre><br>  Kami juga menerapkan kemampuan untuk menambahkan templat kami sendiri dan menghasilkan kelas untuk masing-masing bidang.  Ini dapat ditemukan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> . <br><br><h2>  Kesimpulan </h2><br>  Kami menyukai apa yang kami dapatkan.  Dengan konsep ini - kelas kami sendiri untuk bidang khusus, pembungkus untuk status, versi, pengguna, dll. - kami telah hidup selama lebih dari setahun dan merasa luar biasa.  Sebelum menerbitkan kode, kami bahkan memperluas fungsionalitas dan menambahkan hal-hal luar biasa yang tidak sampai ke tangan Anda dalam waktu lama untuk menggunakan klien bahkan lebih nyaman: misalnya, kami menambahkan kemampuan untuk memperbarui beberapa bidang dalam Masalah dalam satu permintaan dan menulis generator kelas untuk bidang khusus. <br><br>  Menurut pendapat kami, itu ternyata menjadi hal yang baik, yang pasti harus dirasakan untuk memahami apakah itu sesuai dengan tugas dan persyaratan Anda.  Di bawah kita - pas. <br><br>  Tautkan lagi: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/badoo/jira-client</a> . <br><br>  Terima kasih sudah membaca sampai akhir.  Kami berharap kode ini sekarang akan bermanfaat dan menghemat waktu tidak hanya untuk kami. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id475840/">https://habr.com/ru/post/id475840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id475830/index.html">Konsol retro portabel do-it-yourself</a></li>
<li><a href="../id475832/index.html">Ekspresi media CSS lebih dari max-width</a></li>
<li><a href="../id475834/index.html">Scrum tidak akan membantu Anda. Kami mengerti mengapa</a></li>
<li><a href="../id475836/index.html">Wawancara dengan Arthur Khachuyan: bagaimana cara menghitung miliarder di jejaring sosial?</a></li>
<li><a href="../id475838/index.html">MENGUBAH orang. Atau ... ubah Orang. Tentang cara "melepas" proyek transformasi</a></li>
<li><a href="../id475842/index.html">Mengganti URL Tindakan & URI di telepon SIP atau mengelola melalui websockets?</a></li>
<li><a href="../id475848/index.html">Cara kerja Yandex.Market berfungsi dan apa yang akan terjadi jika salah satu server mogok</a></li>
<li><a href="../id475850/index.html">Bagaimana memulai membangun karir di bidang IT, jika Anda belum memiliki pengalaman</a></li>
<li><a href="../id475854/index.html">JDBC pools dan penanganan file yang efisien: Java mitap 3 Desember di St. Petersburg</a></li>
<li><a href="../id475856/index.html">Google App Script, Mikrotik, Telegram dan VPNBook mulai memainkan kuartet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>