<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎊 👨🏼‍💼 🙁 Domotique à faire soi-même ✊🏼 🧝🏾 🚵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mon article sera utile à ceux qui ne pensent qu'à ce type de système, les aidera à décider de le faire eux-mêmes et se concentrera principalement sur ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Domotique à faire soi-même</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455321/">  Mon article sera utile à ceux qui ne pensent qu'à ce type de système, les aidera à décider de le faire eux-mêmes et se concentrera principalement sur les amateurs de fermes collectives.  Au départ, j'écris «automatisation» et non pas une maison intelligente, car à ce stade, il n'y a pas de fonctions intelligentes dans mon système de contrôle, maintenant la tâche était de collecter des données et de gérer les appareils.  Tout devrait changer à l'avenir lorsque des algorithmes apparaîtront qui rendront la maison intelligente.  De mon point de vue, si vous pouvez allumer la lumière depuis un smartphone, cela ne rend pas votre maison intelligente.  Cela devient intelligent lorsque vous avez écrit des scripts qui vous aident, facilitent le contrôle de votre maison et rendent les choses routinières invisibles pour vous.  Par exemple, allumez la lumière sur le porche lorsque le niveau d'éclairage est inférieur à un seuil et éteignez-le deux nuits, n'allumez pas si aujourd'hui ils promettent des précipitations avec une probabilité de plus de 60%, s'il y a du mouvement dans la pièce, allumez les lumières de l'escalier, etc.  Et seulement dans ce cas, il devient «intelligent». <br><a name="habracut"></a><br>  Un peu de paroles.  J'ai toujours voulu avoir une maison à la campagne, pendant longtemps, cela a été décidé, car la construction n'est pas seulement un gros coût financier, mais aussi une grosse dépense de votre temps personnel, qui peut être consacré à votre passe-temps préféré, la famille.  Heureusement, l'un d'eux est le développement de toutes sortes d'appareils inutiles.  Quelque part ailleurs, au stade initial, j'ai décidé par moi-même que cela pouvait être intéressant et, en choisissant un site, j'ai commencé à faire des plans.  Tout d'abord, bien sûr, j'ai dû consacrer beaucoup de temps aux problèmes liés à la construction elle-même, tels que le projet, la recherche de constructeurs et toutes sortes d'autres problèmes.  Mais ensuite, lorsque la boîte était prête, il était temps de penser au système domotique, ce que j'aime et ce que je voulais faire, eh bien, c'est juste étrange pour le programmeur de sortir du canapé pour éteindre la lumière dans la salle de bain. <br><br>  Des études ont commencé sur ce qui est sur le marché et ce que vous pouvez acheter et pré-cultiver vous-même.  En fin de compte, le marché est assez saturé de nombreuses solutions, mais elles en manquaient, alors elles n'avaient pas de solution holistique qui me satisferait (non, bien sûr, il y avait des solutions, mais le coût était de 20 tonnes. Je n'étais pas satisfait) .  Par exemple, Schneider a une bonne solution basée sur KNX, sur laquelle vous pouvez construire l'éclairage, les volets roulants et le contrôle de la ventilation, mais intégrer autre chose que des éléments standard dans le système est presque impossible, en plus vous pouvez oublier l'interface Web et le contrôle google, et l'automatisation des scripts en général pas besoin de parler.  D'un autre côté, il existe suffisamment de solutions sur le marché qui sont à la fois sans fil et amis de Google, et les applications sont prêtes pour eux, mais elles ont beaucoup de nuances qui poussent ces solutions à l'arrière-plan.  Par exemple, la complexité du contrôle d'éclairage simultané à partir d'interrupteurs conventionnels et d'application, c'est souvent impossible du tout, ou s'il est possible de mettre en œuvre des interrupteurs pass-through, mais j'aimerais avoir une maison dans laquelle tout fonctionne sans maison intelligente en cas de crash.  De plus, je ne voulais pas vraiment peser la maison avec une masse de boîtes séparées, je ne comprends toujours pas pourquoi le capteur de mouvement, le monoxyde de carbone et la température ne devraient pas être placés dans un seul cas, même si cela coûterait plus cher, mais je n'aurais pas à suspendre le plafond entier avec certains appareils , et même changer les piles en eux tous les deux ans. <br><br>  En général, avec les mots «programmeur tyzh», j'ai commencé à penser comment j'aurais pris cela tout seul et ce qui est nécessaire pour cela.  En réfléchissant aux différentes applications du système, il est devenu clair qu'avant de faire quelque chose, vous devez réfléchir sérieusement (cela semble évident, mais non, parfois vous voulez faire quelque chose maintenant) parce que mettre le câblage dans les portes et le plâtrer, il n'y a pas de moyen de revenir en arrière . <br><br>  Ayant formé une liste de souhaits, j'ai obtenu les sous-systèmes suivants: <br><br><ul><li>  éclairage domestique </li><li>  roleta </li><li>  contrôle des volets de ventilation </li><li>  capteurs de mouvement, capteurs de lumière, de CO et de température dans les pièces </li><li>  arrosage automatique </li><li>  capteurs de mouvement sur le site </li><li>  alimentation de secours </li></ul><br>  Au départ, je voulais tout rassembler sur les appareils achetés et les regrouper en un seul système, cela semblait être la meilleure option pour le temps / les finances et la fiabilité du système.  Les pensées sont passées d'un sous-système à l'autre, mais aucune solution cohérente n'a été formulée pour aucun des sous-systèmes, des mois ont passé, mais aucune solution n'a été formée, de plus la construction elle-même était distrayante, et même l'hiver a commencé (et c'est le temps des montagnes et du snowboard, et c'est sans tous les compromis, il en était toujours ainsi).  J'ai dû limiter la fuite des pensées et me forcer à travailler un sous-système après l'autre, tout a commencé avec l'éclairage. <br><br>  Jetons un coup d'œil à chacun. <br><br>  <b>Eclairage</b>  D'après l'entrée, la lumière devait fonctionner simultanément à partir des interrupteurs et du système de contrôle (ci-après ACS), et il devrait y avoir la possibilité de réaliser des interrupteurs pass-through.  Pour cela, les canons automoteurs doivent au moins savoir s'il est activé maintenant ou non.  Il y avait plusieurs idées sur la façon de mettre en œuvre cela, mais je me suis installé sur ce schéma - un interrupteur à bouton-poussoir - un relais d'impulsions (Elko MR-41) - une sortie discrète - une entrée discrète.  Une sortie discrète est parallèle à un interrupteur à bouton-poussoir, un contact de relais NO est pour une ampoule, un contact NC est pour une entrée numérique pour l'état. <br><br><img src="https://habrastorage.org/webt/4s/ol/rt/4solrt7wpzujpwuohnj0kbhiapg.jpeg" alt="image"><br><br>  De tout cela, il s'ensuit qu'à chaque point d'éclairage, qui doit être contrôlé à la fois par l'interrupteur et les canons automoteurs, il doit y avoir son propre fil du bouclier, de la même manière que les interrupteurs.  Le schéma de câblage dans le carnet de croquis a vraiment aidé à comprendre l'ampleur de la catastrophe, il y avait beaucoup de fils, mais cela ne devrait pas effrayer une personne qui a décidé d'une maison intelligente.  Je recommande de ne pas être paresseux et de continuer à faire ce schéma, pas nécessairement dans un croquis, à l'avenir, ce travail vous fera gagner beaucoup de temps et vous aidera même après des années où vous devez accrocher une photo et vous vous demanderez s'il y a un fil ou non. <br><br>  <b>Roleta</b> .  La différence avec la lumière est que la charge dans ce cas n'est pas une ampoule mais un moteur électrique, avec tout ce qu'elle implique.  Tout comme avec l'éclairage, je voulais avoir le contrôle à partir d'un interrupteur mécanique ainsi que d'un système de contrôle.  Par conséquent, le circuit s'est avéré comme suit: sortie discrète - contacteur et en parallèle un interrupteur à bouton-poussoir pour chaque sens de rotation. <br><br><img src="https://habrastorage.org/webt/cn/lw/gz/cnlwgz6b_awwpn_xc9k6fmwetvq.jpeg" alt="image"><br><br>  <b>Ventilation</b> .  Tout est simple, je l'ai confié au SPG, et ne prévoyant aucun autre contrôle, je n'ai presque jamais envie d'ouvrir / fermer les gaines de ventilation hors de l'application.  Donc, le circuit - deux sorties discrètes - un simple variateur Belimo LM24-T avec ebay pour 25 $ sans rétroaction. <br><br><img src="https://habrastorage.org/webt/uw/m3/we/uwm3we4zdmxrbjysqscqy9zkz9s.jpeg" alt="image"><br><br>  Voici à quoi ressemble l'actionneur monté sur le volet de ventilation: <br><br><img src="https://habrastorage.org/webt/xn/6j/nr/xn6jnrccrecwbf5mzfs9w7uc1pi.jpeg" alt="image"><br><br>  <b>Capteurs de mouvement, capteurs de</b> lumière, CO et température dans les pièces.  Le marché a maintenant un arbre de tels appareils, mais tout avec une interface propriétaire et les connecter à votre système local est assez difficile, et le problème mentionné ci-dessus est qu'ils essaient de vendre chaque capteur comme un appareil séparé dans son propre boîtier.  La dernière chose que j'aimerais voir est la dispersion de différents appareils au plafond, mais comment pensez-vous qu'ils doivent tous changer de piles et que ça fait peur de le devenir.  En outre, il est toujours possible que le fabricant ferme l'api ouverte de ses appareils et vous force à utiliser uniquement votre application comme Google l'a récemment reçue de nest et votre système entier tombera en morceaux.  Par conséquent, j'ai fabriqué mon appareil sur AVR, en l'appelant une «étiquette de capteur» et je l'ai emballé avec tout ce dont j'avais besoin: un capteur de mouvement avec réglage numérique de la sensibilité, la lumière, la température, des capteurs de monoxyde de carbone, un rétroéclairage contrôlé, ESP8266, RS485 avec isolation galvanique, alimentation 24 V .  Il s'est avéré que c'est un tel appareil, mais en réalité, il doit consacrer un article séparé et ne pas vraiment s'y concentrer dans celui-ci. <br><br><img src="https://habrastorage.org/webt/i-/1g/lh/i-1glhkzoebro6vg4837gtektes.jpeg" alt="image"><br><br><img src="https://habrastorage.org/webt/_5/fb/xe/_5fbxerlagblk6xo52ajmcmqpki.jpeg" alt="image"><br><br>  <b>Arrosage automatique.</b>  Il semblerait que cela soit compliqué, il devrait y avoir le dispositif le plus simple du type à sortie discrète - un solénoïde 24V.  Mais il s'est avéré que toutes les vannes d'irrigation sont en 24 V mais en CA.  J'ai donc dû faire une unité séparée avec un transformateur 24V et une unité de relais, qui 24V DC allume 24V DC. <br><br><img src="https://habrastorage.org/webt/z1/ei/hw/z1eihww133uzr9cde3zzboyeu1e.jpeg" alt="image"><br><br>  <b>Détecteurs de mouvement</b> sur le site.  Pour les capteurs de sécurité, les sorties sont des contacts NO et NC, donc tout est simple ici, des entrées discrètes et tout, mais n'oubliez pas le parafoudre (l'option de parafoudre convient aux panneaux de brassage). <br><br>  <b>Réserver de la nourriture.</b>  Au départ, cela n'était pas prévu, mais avec le temps, il est devenu clair que la perte d'électricité en dehors de la ville n'était pas un état d'urgence, mais un phénomène tout à fait ordinaire.  Et bien que je pense que le système de maison intelligente devrait être conçu de manière à pouvoir être allumé / éteint à tout moment sans conséquences tristes pour elle et la maison, je n'ai pas refusé l'alimentation de secours.  Ayant décidé que puisque j'ai déjà mes capteurs à capteur 24V, lecteurs 24V, je ferai toute l'alimentation ACS 24V.  Il s'est avéré un bon tas de puits moyen de l'alimentation, bien des ups et des batteries, ça fonctionne, vérifié. <br><br><img src="https://habrastorage.org/webt/aj/66/9e/aj669ecgtfoc3tqc31zolwqmbk0.jpeg" alt="image"><br><br>  Après la formation de la solution matérielle, il semblait que dans un système complet, il était possible de procéder aux travaux d'installation de l'unité d'alimentation: pose des câbles d'alimentation, câblage du blindage électrique et câblage de la basse tension.  Il s'est avéré effrayant de nombreux fils, mais du week-end au week-end, il est devenu de plus en plus beau, en conséquence, après un mois, tout a fonctionné et a fonctionné.  Un bonus a été l'occasion de créer un panneau de commande temporaire pour les stores légers et à enrouleur pour les constructeurs. <br><br><img src="https://habrastorage.org/webt/n0/36/wk/n036wkfwgo8yg0usj3xcxtdnv0o.jpeg" alt="image"><br><br><img src="https://habrastorage.org/webt/lb/tt/qk/lbttqktzgqwrf-pzk3-zff4wzl0.jpeg" alt="image"><br><br><img src="https://habrastorage.org/webt/lj/xc/ee/ljxcee-0sxtapkxrbvjz9gj3hcw.jpeg" alt="image"><br><br><img src="https://habrastorage.org/webt/la/3e/ir/la3eir29gc-rtqiqradhhyancf0.jpeg" alt="image"><br><br>  <b>L'étape suivante consistait à planifier le tableau de bord avec les modules de contrôle.</b> <br><br>  Topologie du système: <br><br><img src="https://habrastorage.org/webt/en/mn/ez/enmnezvjyvg0l3fj2wt1euebbj8.jpeg" alt="image"><br><br>  <u>Modules DI / DO.</u>  Il était nécessaire d'estimer la topologie du système, quels modules y sont inclus, sur quels contrôleurs ce qui fonctionne.  Il existe de nombreuses options de mise en œuvre, et toutes seront correctes si elles fonctionnent.  Pour l'avenir, je dirai que je me suis installé sur un système de modules DI / DO achetés, qui contrôle le contrôleur sur Beaglebone noir et le serveur Web sur Raspberry Pi.  Ensuite, vous devez compter toutes les entrées / sorties discrètes et leurs types.  Parce que  il n'y avait aucune envie de développer des modules DI / DO, je viens de regarder le marché déjà prêt pour un prix raisonnable.  Je me suis arrêté aux modules Bélier, en principe, ils couvraient tous mes besoins de gestion: <br><br><ol><li>  MV110-8DF, en tant que module d'entrée discret pour signaux 220V. </li><li>  110-16, pour contrôler l'éclairage, les volets roulants, les vannes de ventilation et d'irrigation. </li><li>  MV110-16DN comme module d'entrée discret pour les signaux des capteurs de mouvement de rue. </li></ol><br>  Ces modules sont connectés au système via l'interface RS485 ModBus, en principe la norme de l'industrie, donc il ne devrait pas y avoir de difficultés avec sa mise en œuvre (vous pouvez écrire vous-même le support des commandes principales ou prendre une bibliothèque prête à l'emploi). <br><br>  <u>Contrôleur</u>  Pour communiquer avec mes modules «sensorortag» situés dans chaque pièce et les modules Aries du tableau de bord, j'avais besoin d'un contrôleur qui pouvait les interroger via l'interface RS485 et avait Ethernet pour communiquer avec le serveur.  J'ai envisagé l'option d'utiliser la carte Wiren, mais ils ont peu de ports RS485 et je voulais faire le contrôleur moi-même.  Le contrôleur souhaite consacrer un article séparé, nous pouvons donc mentionner ici qu'il est fabriqué en noir Beaglebone et dispose de 3 ports RS-485 isolés galvaniquement et d'une alimentation 24V. <br><br>  Le système du contrôleur noir Beaglebone est construit sur la base de Buildroot et amené à l'état d'exécution de la construction - nous obtenons l'image finie pour la carte SD.  Le logiciel Beaglebone black se compose de: noyau de communication, passerelle MQTT et serveur Mosquitto.  Le noyau de communication interroge les ports RS-485, formant un tableau interne de points discrets et analogiques.  La passerelle MQTT convertit les points du contrôleur aux valeurs des rubriques MQTT et les transmet au serveur Mosquitto.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tout est disponible sur ce lien</a> . <br><br>  Tableau de commande et simulateur de signaux (éclairage, stores et ventilation): <br><br><img src="https://habrastorage.org/webt/nc/os/_v/ncos_v2uht5ke4pt2wct_74flgg.jpeg" alt="image"><br><br><img src="https://habrastorage.org/webt/gy/hu/va/gyhuvapp-asvex_g2awlpgs3bbo.jpeg" alt="image"><br><br>  <u>Le logiciel Raspberry Pi</u> est l'assistant domestique.  J'ai été satisfait de ce système, il est très simple, prend en charge de nombreux appareils prêts à l'emploi et vous permet d'écrire vos plugins en python de manière très flexible.  Par exemple, en quelques semaines, j'ai écrit mes propres plug-ins MQTT pour l'éclairage, les volets roulants, les alarmes et divers types de capteurs (éclairage, CO, mouvement, température) et plusieurs types d'automatisation, tout est très flexible et surtout avec un seuil bas pour entrer dans le système.  Home Assistant prend également en charge l'intégration avec Google Home et Alexa.  Vous pouvez vous tourmenter un peu et le configurer vous-même, ou souscrire un abonnement payant à leur service (5 $ par mois), puis le processus de synchronisation de Home Assistant et de Google Home prend deux clics.  En prime, nous obtenons le contrôle vocal, tout en anglais, mais promettons de prendre en charge le russe à peu près.  Cela ressemble à ceci: <br><br><img src="https://habrastorage.org/webt/tf/jw/ud/tfjwudo8if5dj_n8ts3j9lm8vm4.png" alt="image"><br><br>  Dans cet article, je voulais donner un aperçu du système et un exemple d'une mise en œuvre spécifique, et je ne prétends pas à l'exactitude des décisions que j'ai choisies.  Quelqu'un peut dire que c'est un toumach pour la maison, mais quelqu'un peut en bénéficier.  En général, n'ayez pas peur, c'est excitant, il suffit de bien structurer tout et de commencer.  Toutes les idées ne viennent pas immédiatement, elles apparaissent dans le processus de mise en œuvre, vous devrez donc changer, et plus d'une fois.  Ensuite, je prévois d'écrire sur le développement de ma balise de contrôleur et de capteur, qui en tant que programmeur est plus intéressant que tout ce qui est décrit ici. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455321/">https://habr.com/ru/post/fr455321/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455310/index.html">Attaques sur les canaux de contournement: désormais non seulement les PC mais aussi les smartphones sont attaqués (revue analytique)</a></li>
<li><a href="../fr455312/index.html">Additionneur complet un bit sur des puces inhabituelles</a></li>
<li><a href="../fr455314/index.html">Qu'est-ce qu'un réseau de services</a></li>
<li><a href="../fr455316/index.html">Nous modifions la pile Bluetooth pour améliorer le son des casques sans codecs AAC, aptX et LDAC</a></li>
<li><a href="../fr455318/index.html">Quels sont les domaines d'application de l'impression 3D?</a></li>
<li><a href="../fr455325/index.html">Portage d'applications de bureau sur .NET Core</a></li>
<li><a href="../fr455329/index.html">Annonce de l'extension des outils Azure IoT Edge (préversion)</a></li>
<li><a href="../fr455331/index.html">Comment les ordinateurs ont appris à reconnaître incroyablement bien les images</a></li>
<li><a href="../fr455333/index.html">Qui a mis Python dans la mise à jour de Windows 10 de mai 2019?</a></li>
<li><a href="../fr455335/index.html">Petty Petty Joy # 3: Poésie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>