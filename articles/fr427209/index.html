<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèΩ üíÇüèº üîì GeoPuzzle - faites le monde morceau par morceau ‚öìÔ∏è üßõüèº üßõüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je veux parler d'un projet qui s'est d√©velopp√© au cours des deux derni√®res ann√©es. Il s'appelle GeoPuzzle et est un jeu de puzzle sur la carte politiq...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GeoPuzzle - faites le monde morceau par morceau</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427209/"><img src="https://habrastorage.org/webt/yi/rt/rr/yirtrrid9bdhlygy86tfho1fg8g.png" alt="image"><br><br>  Je veux parler d'un projet qui s'est d√©velopp√© au cours des deux derni√®res ann√©es.  Il s'appelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GeoPuzzle</a> et est un jeu de puzzle sur la carte politique du monde.  Le but est de remettre des morceaux du pays √† sa place.  L'id√©e a √©t√© rep√©r√©e dans l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Puzzle Mercator pour les experts en g√©ographie¬ª</a> , qui jouait √©galement des tetris de pays (toujours sous DOS) dans l'enfance, mais je ne me souviens pas du nom du programme.  J'√©tais tellement inspir√© par l'id√©e que je voulais faire un produit complet, int√©ressant non seulement pour les √©coliers, mais aussi pour les experts en g√©ographie.  Le d√©veloppement du projet peut √™tre observ√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> . <br><a name="habracut"></a><br><h2>  Prototype </h2><br>  L'article ¬´Puzzle Mercator pour les experts en g√©ographie¬ª a √©t√© publi√© le 8 f√©vrier 2013, mais apr√®s 4 mois, j'avais un prototype pr√™t, dans lequel les polygones de tous les pays du monde √©taient assembl√©s.  Un peu plus tard, j'ai ajout√© les r√©gions de la Russie et des √âtats am√©ricains et j'ai fait le choix de la position initiale sur la carte pour les polygones al√©atoires.  J'ai d√©crit le processus de d√©veloppement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans mon blog</a> , publi√© le code source sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> .  Et c'est tout - coinc√©.  J'ai eu beaucoup moins de temps libre, ma motivation avait disparu (aucune d√©cision n'a √©t√© prise) et la complexit√© a augment√© de fa√ßon exponentielle.  C'√©tait un projet pour animaux de compagnie, et la t√¢che principale √©tait d'apprendre quelque chose de nouveau, j'√©tais donc un peu perverti par la technologie.  Sur le client, bien s√ªr, javascript (avec lequel je ne travaillais pas beaucoup √† l'√©poque), le script ruby ‚Äã‚Äã(encore une fois un nouveau langage pour moi) √©tait responsable de la pr√©paration des donn√©es, mais sur le serveur il y avait erlang (je voulais essayer quelque chose de purement fonctionnel).  Sortie compl√®te de la zone de confort: il √©tait difficile de travailler directement avec des objets PostGIS, la douleur de convertir des cha√Ænes en erlang, de configurer YAWS √©tait un probl√®me tout √† fait diff√©rent ... pensez pendant quelques ann√©es. <br><br><h2>  GeoPuzzle </h2><br><img src="https://habrastorage.org/webt/k3/rp/5d/k3rp5dfmluyjvoqm0tffbva4b_g.gif" alt="image"><br><br>  Le site a fonctionn√© pendant tout ce temps, les gens y sont m√™me all√©s, mais je voulais vraiment ajouter un petit d√©tail: afficher au moins quelques informations sur le polygone nouvellement d√©couvert.  Ainsi, j'avais pr√©vu de passer les vacances du Nouvel An en 2017 avec b√©n√©fice.  En raison de probl√®mes dans le prototype, j'ai d√©cid√© de tout r√©√©crire et de cr√©er le produit sur quelque chose de familier - Django.  Hors de la bo√Æte, il y a des choses qui ont grandement simplifi√© ma vie, par exemple, le panneau d'administration et le travail avec PostGIS via ORM.  Mais pour commencer, il fallait recr√©er les fonctionnalit√©s qui fonctionnaient d√©j√†.  Cela n'a pris que quelques soir√©es, et la plupart du temps a √©t√© pris en chargeant des donn√©es √† partir de fichiers KML.  Pas tant le processus d'importation lui-m√™me que leur pr√©paration et restauration de mes connaissances sur la fa√ßon de travailler avec eux.  Au fait, j'ai pris des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">polygones</a> sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gadm.org</a> √† ce moment-l√†.  Cela fonctionnait tr√®s bien pour les pays, mais il y avait certains probl√®mes avec la pr√©cision des r√©gions, j'ai donc pris un temps mort pour ce probl√®me. <br><br><div class="spoiler">  <b class="spoiler_title">Quelques mots sur les niveaux administratifs dans les g√©odonn√©es (niveaux).</b> <div class="spoiler_text">  Tous les pays sont divis√©s en plusieurs r√©gions, qui sont divis√©es en parties encore plus petites.  Au total, il y a 12 couches dans une telle hi√©rarchie. <br><br>  Par exemple, pour la Russie: <br><br><ul><li>  Russie (2) -&gt; District f√©d√©ral du Sud (3) -&gt; Territoire de Krasnodar (4) -&gt; District de Vyselkovsky (6) -&gt; Art.  Villages (8) </li><li>  Russie (2) -&gt; District f√©d√©ral du Sud (3) -&gt; Territoire de Krasnodar (4) -&gt; Krasnodar (6) -&gt; District de Prikubansky (9) -&gt; Kopanskaya (10) </li><li>  France (2) -&gt; M√©tropole de France (3) -&gt; R√©gion Normandie (4) -&gt; D√©partement de l'Orne (6) -&gt; canton de Donfron (7) -&gt; commune de Donfron-en-Poiret (8) -&gt; Donfron (9) </li></ul><br>  Les unit√©s territoriales dans diff√©rents pays sont appel√©es √† leur mani√®re, mais pour moi, j'ai d√©duit cette division: Pays (2) -&gt; R√©gion (4) -&gt; District (6).  La division administrative est partie pour plus tard. <br></div></div><br><h2>  D√©veloppement de projet </h2><br>  A cette √©poque, l'application n'√©tait qu'une collection de pages HTML avec un minimum de CSS.  Je voulais v√©rifier rapidement l'id√©e et ne pas m'emb√™ter avec le design.  L'id√©e s'est av√©r√©e r√©alisable et il est temps d'en faire une belle coquille.  Parce que  Je n'ai aucun sens de la beaut√© dans l'interface utilisateur, puis Bootstrap pour m'aider.  Il n'y a pas d'interface, mais il est apparu, et m√™me adapt√© aux appareils mobiles.  Mais ce n'√©tait que la premi√®re √©tape pour mettre de l'ordre dans le frontend. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment vous sentez-vous d'apprendre JavaScript en 2016</a> ?!  Lorsque le code est compil√© dans un autre dialecte, il est mod√©lis√©, coll√© ensemble afin de pouvoir ensuite √™tre d√©coup√© en morceaux.  En tant que backend, j'avais peur, mais la complexit√© de la partie client √©tait suffisamment importante, ce qui impliquait la n√©cessit√© d'utiliser un framework ou une biblioth√®que.  J'ai opt√© pour React pour deux raisons: je n'avais pas besoin de SPA, mais d'un ensemble de composants pour diff√©rentes pages, et je voulais voir rapidement le r√©sultat.  Mais avant de commencer la programmation, vous deviez configurer l'environnement.  Maintenant, je comprends le front-end familier, qui a dit qu'il avait configur√© Webpack pendant 2 jours.  Il s'av√®re que ce n'√©tait pas une blague. <br><br>  A cette √©poque, j'ai succomb√© √† la persuasion et mis en ≈ìuvre la logique de l'application en utilisant Redux.  Ce n'√©tait peut-√™tre pas une erreur, car  autoris√© √† entrer rapidement dans le sujet.  Les r√®gles formelles m'ont permis d'√©crire du code et de m'assurer qu'il fonctionnait sans regarder sous le capot.  Redux utilisant son middleware m'a fait abstraction de l'interaction r√©seau, ce qui m'a permis de v√©rifier les r√©ponses au serveur.  Oui, jusqu'√† pr√©sent, le client a travaill√© seul - une demande ajax a extrait toutes les donn√©es n√©cessaires et v√©rifi√© les r√©ponses par ses propres moyens.  L'utilisateur pourrait tricher en regardant les donn√©es provenant du serveur.  De plus, lors du chargement, les donn√©es ont vol√©, n√©cessaires uniquement apr√®s la bonne r√©ponse.  Apr√®s avoir impl√©ment√© la v√©rification via des sockets Web, le processus est devenu id√©ologiquement plus correct - la r√©ponse v√©rifie le code qui n'est pas disponible pour le client.  Pour l'utilisateur, cela semblait toujours instantan√©: envoyer les points extr√™mes du polygone au serveur, v√©rifier s'ils √©taient entr√©s dans le carr√© avec une erreur, emballer les donn√©es de la bo√Æte d'informations et du polygone d√©taill√© dans json et les transf√©rer au client - tenir en ~ 200 ms. <br><br><img src="https://habrastorage.org/webt/va/s_/kz/vas_kzccg7izp3-lys7pztcfktm.png" alt="image"><br><br>  Apr√®s avoir appris toute la puissance du javascript, il est difficile de s'arr√™ter.  Imm√©diatement, il y a eu des id√©es pour ajouter des animations, des blocs pliants, des clignotements et de nouvelles versions de jeux.  L'un d'eux est le ¬´Quiz¬ª, dans lequel vous devez deviner le pays par son nom, son drapeau, ses armoiries ou sa capitale.  Certes, au cours du processus de test, il s'est av√©r√© que certaines r√©gions n'avaient pas de drapeaux, tandis que d'autres n'avaient pas de capitale, donc certains pays devaient √™tre cach√©s de la liste des pays disponibles.  Dans le m√™me temps, un mode de jeu est apparu sur la carte physique du monde - sans les fronti√®res des pays, pour les vrais pros. <br><br><h2>  Sources de donn√©es ouvertes </h2><br>  Il y a environ 50 000 polygones dans le jeu maintenant, et je tiens √† dire un grand merci √† des projets aussi formidables que Wikipedia et Open Street Map, sans lesquels remplir la base aurait √©t√© impossible.  L'exigence fondamentale √©tait de recevoir et de mettre √† jour des donn√©es √† partir de sources ouvertes, c'est-√†-dire sans modification manuelle, car  Je ne veux pas faire de logique de synchronisation complexe.  En cons√©quence, j'ai obtenu 2 scripts qui peuvent mettre √† jour les bo√Ætes d'informations et les polygones. <br><br><h3>  Wikip√©dia et SPARQL </h3><br><img src="https://habrastorage.org/webt/vh/-l/-9/vh-l-9bii6guq-jufnz3lcxtkia.png" alt="image"><br><br>  Quelle est la plus grande base de donn√©es de pays et r√©gions?  Wikip√©dia!  Au d√©part, je voulais montrer aux utilisateurs l'int√©gralit√© de la bo√Æte d'informations, mais j'ai rapidement abandonn√© cette id√©e.  Oui, il y avait des choses importantes comme les noms, les drapeaux, les capitales et d'autres choses, mais il y avait aussi beaucoup de d√©chets (code t√©l√©phonique, forme de gouvernement, PIB ...).  J'ai essay√© d'analyser d√©j√† collect√©, mais a constat√© qu'ils ont une structure diff√©rente.  Cela s'est av√©r√© √™tre un d√©sastre: les co√ªts de main-d'≈ìuvre pour la mise en ≈ìuvre ont augment√© de nombreuses fois.  Il √©tait temps de s'arr√™ter et de r√©fl√©chir.  Le lendemain, j'ai appris l'existence d'un langage de requ√™te sp√©cial - SPARQL.  En apparence, il ressemble √† SQL - √©galement d√©claratif, avec les mots-cl√©s <code>SELECT</code> , <code>WHERE</code> , <code>ORDER BY</code> , mais il fonctionne d'une mani√®re compl√®tement diff√©rente.  Un petit exemple qui renvoie une liste des √âtats avec leurs capitales en anglais et en russe: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> ?country ?capital ?<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> { ?country wdt:P31 wd:Q3624078 . <span class="hljs-keyword"><span class="hljs-keyword">FILTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> {?country wdt:P31 wd:Q3024240} OPTIONAL { ?country wdt:P36/rdfs:label ?capital } . BIND(lang(?capital) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ?<span class="hljs-keyword"><span class="hljs-keyword">row</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> (?<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = <span class="hljs-string"><span class="hljs-string">'ru'</span></span> || ?<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = <span class="hljs-string"><span class="hljs-string">'en'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ?capital</code> </pre><br>  √áa a l'air sauvage, non?!  V√©rifiez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  J'ai m√™me √©crit une petite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">note sur mon blog</a> pour structurer mon exp√©rience et aider √† entrer dans le sujet, car  il existe peu de documents d√©taill√©s sur Internet.  Vous pouvez apprendre √† lire de telles demandes assez rapidement, mais il m'a fallu tout un week-end pour √©crire quelque chose de significatif.  Beaucoup de "magie" de <code>wd:Q3624078</code> et d'autres attributs.  Vous devez savoir que <code>wdt:P31</code> est une ¬´entit√©¬ª et <code>wd:Q3624078</code> est un ¬´√âtat souverain¬ª.  Les inconnus commencent par un point d'interrogation et la satisfaction de la demande consiste √† rechercher de tels triplets de faits qui satisferaient aux conditions.  Par exemple <code>?country wdt:P31 wd:Q3024240</code> -¬´ rechercher tous les objets qui sont des √©tats historiques ¬ª;  puis le m√™me objet participe √† d'autres triplets <code>?country wdt:P36/rdfs:label ?capital</code> - d'o√π vient le capital. <br><br>  Environ une semaine plus tard, j'avais la premi√®re version du script pr√™te, qui t√©l√©chargeait des informations r√©gionales √† partir de Wikipedia.  Et puis un autre probl√®me est devenu clair - cette fois avec les donn√©es.  Certains svg n'ont pas commenc√© par <code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code> Et n'ont pas √©t√© reconnus par le navigateur comme des images valides.  Heureusement, le fichier source peut √™tre modifi√©.  Il n'y a rien de compliqu√© √† s'inscrire sur wikipedia.org, mais vous vous retrouvez imm√©diatement dans un bain public pour une journ√©e.  Voici leur protection contre les robots.  Donc, le lendemain soir, j'ai gouvern√© XML et j'√©tais content de la simplicit√©, et des drapeaux et des embl√®mes sont apparus sur la carte. <br><br><h3>  Des polygones </h3><br><img src="https://habrastorage.org/webt/gd/g7/t-/gdg7t-ssoht6cbt3kifldfm_bvk.png" alt="image"><br><br>  Si pour des faits nous allons sur Wikipedia, alors pour les g√©odonn√©es - dans l'Open Street Map.  Ce serait cool de r√©cup√©rer une copie locale, d'apprendre la langue des demandes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">contournement</a> , mais je ne peux m√™me pas imaginer combien de temps cela prendrait.  Et vous devez √©galement prendre la hi√©rarchie quelque part ... Heureusement, une personne gentille a d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©solu ce probl√®me pour moi</a> .  Le service fournit m√™me une API pour r√©cup√©rer des informations.  J'ai r√©ussi √† t√©l√©charger √† partir de l√† tous les polygones jusqu'au niveau 6 inclus (quartier) et √† tout remplir dans Postgres, un peu plus de 2 Go sont sortis.  Ce n'√©tait pas sans aventures - certains polygones √©taient si grands (par exemple, le Canada p√®se plus de 100 Mo dans un GeoJSON zipp√©) que le serveur est tomb√© en panne ou n'a pas r√©pondu.  J'ai d√ª contourner ces moments manuellement.  J'ai t√©l√©charg√© tous les enfants et les ai fusionn√©s dans QGIS.  √Ä propos, ceci est un autre exemple d'un projet open source qui m'a beaucoup aid√©. <br><br><h2>  Probl√®mes de Big Data </h2><br>  Donc, j'ai une base de donn√©es avec des donn√©es, je lance le jeu et ... et attends ... encore j'attends ... apparu!  J'ai essay√© de faire glisser le polygone - Il est mort, Jim!  Chrome n'a pas pu g√©rer un tel volume de points et est tomb√©.  La strat√©gie du front ne fonctionne plus, il est temps de r√©fl√©chir.  Le plus √©vident est de r√©duire le d√©tail des polygones.  Empiriquement d√©riv√© d'une formule qui d√©pend de la zone de la figure - elle s'est am√©lior√©e.  Sur un ordinateur qui fonctionne, l'algorithme a fonctionn√© √† la vol√©e, tandis que le serveur est gravement limit√© en ressources.  Connect√© redis, il s'est d√©j√† am√©lior√© sur le serveur.  Mais les polygones tronqu√©s sont bons pour Drag'n'Drop, et lorsqu'ils sont d√©finis au bon endroit, les bordures ne co√Øncident pas avec celles qui dessinent Google maps.  Eh bien, cela peut √™tre contourn√© en appliquant une formule moins agressive pour r√©duire les d√©tails.  Puisqu'il y a d√©j√† 2 caches, pourquoi ne pas essayer de mettre en cache tout ce qui est possible?!  Des infoboxes (en deux langues) ont vol√© vers Redis, les fronti√®res par lesquelles la r√©ponse est calcul√©e, le centre du polygone, ainsi que les pages statiques du site.  En cons√©quence, le jeu a commenc√© √† fonctionner beaucoup plus rapidement et une grande partie de la charge de travail a √©t√© supprim√©e de Postgres, ce qui pourrait th√©oriquement √™tre le goulot d'√©tranglement.  Moins - l'application ne fonctionne pas du tout sans Redis. <br><br><h2>  Premier d√©ploiement </h2><br>  Il est donc temps de montrer le projet √† des amis pour obtenir des commentaires.  Il ne restait plus que peu: g√©n√©rer sitemap.xml, ajouter robots.txt, connecter les m√©triques, ajouter des boutons sociaux.  r√©seaux et ... d√©ployez!  J'ai choisi AWS comme h√©bergement,  esp√©rait s‚Äôins√©rer dans les ressources gratuites fournies.  Et c'est une tr√®s bonne pile pour un projet d√©butant: <br><br><ul><li>  serveur d'applications (t2.micro: 1xCPU, 1 Go de RAM, SSD 20 Go) </li><li>  base de donn√©es (db.t2.micro: 1xCPU, 1 Go de RAM, SSD 20 Go) </li><li>  stockage de fichiers avec CDN (5 Go S3, 50 Go de trafic) </li><li>  serveur de mise en cache (cache.t2.micro: 1xCPU, 0,5 Go de RAM) </li><li>  Elasticsearch + Kibana (t2.small.elasticsearch: 1xCPU, 2 Go de RAM) </li></ul><br>  Ce n'est qu'une liste de ce que j'ai r√©ussi √† utiliser.  En cours de route, j'ai d√©cid√© de dresser mon r√¢teau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sous forme d'articles</a> , mais je suis vite d√©c√©d√©.  Le temps passe d√©cemment, mais il n'est pas clair si quelqu'un en a besoin. <br><br>  En cons√©quence, pour l'ann√©e de service, j'ai pay√© quelque chose de l'ordre de 10 $, et m√™me par stupidit√©.  Mais ici, la p√©riode d'essai a pris fin, et j'ai d√ª d√©m√©nager, car  le co√ªt de possession de toute cette √©conomie a commenc√© √† approcher plusieurs centaines de dollars.  Tarifs compar√©s, et install√©s sur DigitalOcean.  Pour l'instant, j'ai assez de machines avec 2 Go de RAM pour tout (serveur d'applications, base de donn√©es et cache), mais j'ai laiss√© la statique et le CDN sur AWS.  Maintenant, j'ai d√©couvert que DO avait √©galement un CDN et un stockage pour 5 $ / mois, il est donc logique de penser √† d√©placer cette partie √©galement. <br><br><h2>  Transfert vers l'Open Source </h2><br>  Ce soir de janvier, j'ai re√ßu une lettre d'une √©cole danoise.  Son essence se r√©sume au fait qu'ils ont 100 $ et qu'ils veulent me les donner.  Mais il y a une condition - le code source du projet doit √™tre ouvert.  Jusqu'√† ce moment, je n'avais m√™me pas pens√© √† l'Open Source.  Quelques soir√©es ont √©t√© consacr√©es √† la r√©flexion et au choix d'une licence.  En cons√©quence, j'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©charg√© les sources sur Github</a> sous la licence GPLv3 et j'ai re√ßu les 100 $ promis.  Cela a consid√©rablement accru la motivation - mon projet a √©t√© vraiment utile!  Et je me suis pr√©cipit√© vers le prochain objectif - l'√©diteur de jeu.  Pour que chacun puisse cr√©er ses propres puzzles.  Par exemple, ¬´Pays participant √† la Seconde Guerre mondiale¬ª, ¬´Districts du territoire de Krasnodar¬ª, ¬´Pays sans littoral¬ª‚Ä¶ Mais pour cela, l'enregistrement et un compte personnel primitif √©taient n√©cessaires.  En cons√©quence, le d√©veloppement a tra√Æn√© pendant 3 mois.  Pendant ce temps, j'ai √©crit un arbre de r√©gions qui extraire des donn√©es via ajax, connecter la localisation, apprendre √† enregistrer une carte Google en tant qu'image pour g√©n√©rer des aper√ßus et couper redux.  Oui, il m'a aid√© √† g√©rer les donn√©es au tout d√©but, mais maintenant, elles sont plus susceptibles d'interf√©rer.  Je devrais faire glisser des r√©ducteurs pour dessiner des polygones sur la carte, ainsi que du code qui g√©rerait leur mouvement.  Heureusement, la suppression de la liaison √† l'√©tat global n'a pris que quelques jours, et le d√©placement du code vers le code local a m√™me simplifi√© l'application.  Et bien s√ªr, c'est une bonne exp√©rience :) <br><br><h3>  Connexion au service </h3><br>  Il s'av√®re que de nombreux services payants fournissent leurs services gratuitement pour des projets open source.  Je vais lister uniquement ceux que j'ai connect√©s aux miens. <br><br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sentinelle</a> .  Je pense que ce service pour d√©tecter les erreurs est familier √† tout le monde.  Lorsque je viens de d√©ployer le projet, la journalisation consistait √† envoyer une trace de pile au mail.  Cela ne fonctionnait que pour le backend, mais je voulais √©galement garder une trace des bugs sur le frontend.  Et pas en vain - j'ai √©puis√© la limite de messages gratuits en seulement 2 semaines.  La plupart des erreurs se trouvaient dans les entrailles de la biblioth√®que de cartes Google, ce qui √† premi√®re vue est tr√®s √©trange.  Au cours de l'enqu√™te, il s'est av√©r√© que tout √©tait de ma faute.  Les corrections ont dur√© plus d'un mois, mais c'√©tait une pratique tr√®s utile de gestion des erreurs javascript. <br><br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">crowdin.com</a> - localisation.  Je pr√©vois de rendre le projet accessible √† tous.  Y compris que les infoboxes √©taient montr√©es dans sa langue maternelle.  Les remplir √† partir de Wikipedia n'est pas un probl√®me, mais pour des raisons de coh√©rence, j'aimerais √©galement avoir une interface dans la m√™me langue, et jusqu'√† pr√©sent, elle n'a √©t√© traduite qu'en russe et en anglais. <br><br><img src="https://habrastorage.org/webt/rq/c-/e7/rqc-e7xybyag2pgp9iaylqfobp4.png" alt="image"><br><br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CircleCI</a> .  Aucun projet moderne ne peut se passer de CI / CD, de tests et de d√©ploiement automatique.  J'ai choisi CircleCI uniquement parce que j'avais d√©j√† travaill√© avec TravisCI lorsque j'ai √©crit la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que pour travailler avec Yandex.Disk</a> .  J'ai l'impression qu'il convient mieux pour tester des biblioth√®ques, comme  il est facile de d√©finir la matrice des environnements dans lesquels le code doit √™tre test√©.  Mais avec les tests eux-m√™mes, j'ai un probl√®me - il n'y en a pas autant que nous le souhaiterions, bien que l'infrastructure soit d√©j√† pr√™te. <br><br><img src="https://habrastorage.org/webt/39/og/14/39og14nvsqwi9mkruslrydqjhh0.png" alt="image"><br><br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Combinaisons</a> .  Service de visualisation de la couverture du code.  Capable de donner √©galement une √©tiquette √† ins√©rer dans le projet README.md. <br><br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SonarQube</a> .  Moissonneuse pour le contr√¥le de la qualit√© du code.  Il v√©rifie le code selon diverses r√®gles, prend en compte la complexit√© cyclomatique, surveille la couverture par des tests et reconna√Æt m√™me la duplication de code!  Un service tr√®s int√©ressant que je n'ai pas encore eu le temps de bien comprendre. <br><br><img src="https://habrastorage.org/webt/og/lk/gp/oglkgp9ndcldy3r14m5iojv9_xi.png" alt="image"><br><br>  - Les robots Github.  Jusqu'√† pr√©sent, seul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dependabot est</a> connect√©, ce qui met √† jour les d√©pendances. <br><br><img src="https://habrastorage.org/webt/r1/eh/9j/r1eh9jidp-k_nzmyhplghbdpsiq.png" alt="image"><br><br>  Je propose dans les commentaires de partager la liste des services et des bots sur leurs projets. <br><br><h2>  Bugs </h2><br>  L'analyse des bogues et des probl√®mes m√©rite un article s√©par√©.  Il y en avait de dr√¥les, complexes et difficiles √† corriger (par cons√©quent, la Tchoukotka se tient toujours √† sa place).  Actuellement, il y en a un qui d√©range vraiment les utilisateurs.  Lorsqu'une r√©ponse est re√ßue, les polygones sont supprim√©s et recr√©√©s (dans la biblioth√®que react-google-maps), et si √† ce moment l'utilisateur en a fait glisser, la carte Google continue de supposer que le processus n'est pas encore termin√©.  Il semble que dans le processus de glisser-d√©poser, le polygone disparaisse et vous ne pouvez plus en saisir d'autre.  Vous pouvez, bien s√ªr, verrouiller le traitement des r√©ponses dans le processus de glisser-d√©poser, mais cela est garanti pour tuer le jeu multijoueur, sur lequel je travaille actuellement.  J'ai essay√© de trouver un moyen d'interrompre le glisser-d√©poser par programme, mais √† la fin j'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">soulev√© une question sur StackOverflow</a> et un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bug sur Google Maps</a> dans l'espoir qu'ils y pr√™teraient attention.  Jusque-l√†, il a ajout√© un bouton ¬´le jeu est cass√©!¬ª, Qui r√©initialise toute la carte, mais ne r√©initialise pas le r√©sultat. <br><br><h2>  Et ensuite? </h2><br><ol><li>  Conception.  J'avoue qu'avec √ßa, tout est compl√®tement mauvais.  Il est n√©cessaire d'embaucher un concepteur et un concepteur de mise en page, car je ne suis pas moi-m√™me ami avec la mise en page et les mises en page. </li><li>  Mon√©tisation.  Au d√©part, je n'avais rien pr√©vu.  Le projet est d√©di√© √† l'√©ducation de base qui, √† mon avis, devrait √™tre accessible √† tous.  J'ai √©t√© tr√®s inspir√© par une lettre d'une √©cole danoise, mais pr√®s d'un an s'est √©coul√© et pendant cette p√©riode, il n'y a eu qu'un seul transfert de 5 $.  Eh bien, je ne pensais pas que cela pouvait m√™me payer pour le serveur.  Cependant, il a quand m√™me commenc√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">campagne sur Patreon</a> .  Dans le m√™me temps, vous pouvez probablement penser √† introduire des opportunit√©s r√©mun√©r√©es pour les enseignants ou les organisations.  Par exemple, j'ai une exp√©rience d'int√©gration avec Learning Management Systems - un ensemble de plates-formes qui vous permettent de cr√©er des cours et sont tr√®s populaires en Europe et aux √âtats-Unis.  Pour autant que je sache, m√™me si le code source est √©galement sous GPL sur Github, cela ne m'emp√™che pas, en tant qu'auteur, de d√©velopper une version commerciale parall√®le. </li><li>  T√©l√©phones portables.  Je souhaite publier une application pour iOS / Android.  √Ä en juger par la m√©trique Yandex, un quart des utilisateurs essaient de jouer √† partir d'un t√©l√©phone ou d'une tablette, mais il s'av√®re qu'ils ont des difficult√©s. </li><li>  D√©veloppement.  Tout le travail est effectu√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> .  Je veux continuer √† d√©velopper le projet, mais le faire seul est difficile.  Les plans incluent l'ajout de multijoueur, la cr√©ation de balises, de notes et de filtres dans l'atelier, l'ajout de polygones pour une carte physique (montagnes, mers, p√©ninsules).  Il y a encore beaucoup de choses int√©ressantes, donc l'un des objectifs de l'article est de trouver des personnes partageant les m√™mes id√©es.  Une autre option est d'aller √† la fondation, par exemple, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Python Software Foundation</a> et d'obtenir une subvention. </li></ol><br>  Voici ce qui est en ce moment.  Merci d'avoir lu jusqu'au bout!  Vous pouvez jouer ici - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">geopuzzle.org</a> , et regarder le code source sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> . <br><br><blockquote><img src="https://habrastorage.org/webt/jy/sd/rr/jysdrr7tqgfjt50wtcshw89ctho.png" align="left"><h3>  Minute de soins OVNI </h3><br>  Ce mat√©riel peut provoquer des sentiments contradictoires, donc avant d'√©crire un commentaire, rafra√Æchissez quelque chose d'important dans votre m√©moire: <br><br><div class="spoiler">  <b class="spoiler_title">Comment √©crire un commentaire et survivre</b> <div class="spoiler_text"><ul><li>  N'√©crivez pas de commentaires offensants, ne soyez pas personnels. </li><li>  Abstenez-vous d'un langage obsc√®ne et d'un comportement toxique (m√™me sous une forme voil√©e). </li><li>  Pour signaler des commentaires qui enfreignent les r√®gles du site, utilisez le bouton "Signaler" (si disponible) ou le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">formulaire de commentaires</a> . </li></ul><br>  Que faire si: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">moins de karma</a> |  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compte bloqu√©</a> <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Code des auteurs Habr</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habraetiket</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Version compl√®te des r√®gles du site</a> </div></div></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427209/">https://habr.com/ru/post/fr427209/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427195/index.html">Demain, nous commencerons √† vous tuer, ou pourquoi avons-nous besoin d'ing√©nieurs</a></li>
<li><a href="../fr427199/index.html">Connaissance approfondie du trieur √©lectrom√©canique de cartes perfor√©es (excursion au d√©but du XXe si√®cle)</a></li>
<li><a href="../fr427203/index.html">¬´Light Music¬ª: parler de quatre outils √©lectroniques insolites avec photocellules</a></li>
<li><a href="../fr427205/index.html">Habrakvest en l'honneur du 20e anniversaire du groupe Mail.Ru: gagnants et r√©ponses</a></li>
<li><a href="../fr427207/index.html">Les employ√©s de Rockstar se l√®vent pour l'entreprise apr√®s avoir critiqu√© les semaines de travail de 100 heures</a></li>
<li><a href="../fr427211/index.html">Electron est un flash pour ordinateur de bureau</a></li>
<li><a href="../fr427215/index.html">Les microservices doivent grandir, pas commencer par eux</a></li>
<li><a href="../fr427217/index.html">Analyse des performances des serveurs WSGI: deuxi√®me partie</a></li>
<li><a href="../fr427219/index.html">Messagerie diff√©r√©e non bloquante inutile dans MPI: analyse l√©g√®re et tutoriel pour ceux qui sont un peu "dans le sujet"</a></li>
<li><a href="../fr427221/index.html">Ce que j'ai r√©alis√© sur le chemin de mon r√™ve d'intelligence artificielle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>