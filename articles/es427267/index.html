<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÅ üí¥ üëêüèº SNMP + Java: experiencia personal. Escribir un analizador de archivos MIB üè∏ üë®‚Äç‚öïÔ∏è üë®üèø‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SNMP no es el protocolo m√°s f√°cil de usar: los archivos MIB son demasiado largos y confusos, y los OID son simplemente imposibles de recordar. Pero, ¬ø...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SNMP + Java: experiencia personal. Escribir un analizador de archivos MIB</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427267/">  SNMP no es el protocolo m√°s f√°cil de usar: los archivos MIB son demasiado largos y confusos, y los OID son simplemente imposibles de recordar.  Pero, ¬øqu√© pasa si necesita trabajar con SNMP en Java?  Por ejemplo, escriba autotests para verificar la API del servidor SNMP. <br><br>  Por prueba y error, si hay una cantidad bastante escasa de informaci√≥n sobre el tema, todav√≠a descubrimos c√≥mo hacer amigos Java y SNMP. <br><br>  En esta serie de art√≠culos intentar√© compartir la experiencia adquirida con el protocolo.  El primer art√≠culo de la serie estar√° dedicado a la implementaci√≥n del analizador de archivos MIB en Java.  En la segunda parte, hablar√© sobre c√≥mo escribir un cliente SNMP.  En la tercera parte, hablaremos de un ejemplo real de uso de una biblioteca escrita: pruebas autom√°ticas para verificar la interacci√≥n con un dispositivo a trav√©s de SNMP. <br><br><img src="https://habrastorage.org/webt/tv/lq/ai/tvlqaihbpnaqtlie8wr7hulxyhg.jpeg"><br><a name="habracut"></a><br><h2>  Entrada </h2><br>  Todo comenz√≥ con la tarea de escribir autocomprobaciones para verificar el funcionamiento de la grabadora de audio y video a trav√©s de SNMP.  Para complicar la situaci√≥n, no hay mucha informaci√≥n sobre la interacci√≥n con SNMP en Java, especialmente cuando se trata del segmento de Internet en ruso.  Por supuesto, uno podr√≠a mirar hacia C # o Python.  Pero en C #, la situaci√≥n del protocolo es tan complicada como en Java.  Hay un par de buenas bibliotecas en python, pero ya ten√≠amos una infraestructura preparada para las pruebas autom√°ticas API REST de este dispositivo en Java. <br><br>  Al igual que con cualquier otro protocolo de comunicaci√≥n de red, necesit√°bamos un cliente SNMP para trabajar con varios tipos de solicitudes.  Las pruebas autom√°ticas deben poder verificar el √©xito de las solicitudes GET y SET para los par√°metros escalares y de tabla.  Para las tablas, tambi√©n se requer√≠a poder verificar la adici√≥n y eliminaci√≥n de registros, si la tabla misma permite estas operaciones. <br><br>  Pero adem√°s del cliente, la biblioteca ten√≠a que contener una clase para trabajar con archivos MIB.  Esta clase deber√≠a haber podido analizar el archivo MIB para obtener tipos de datos, l√≠mites de valores aceptables, etc., para no codificar lo que siempre puede cambiar. <br><br>  Al buscar bibliotecas adecuadas para Java, no encontramos una sola biblioteca que permitiera trabajar tanto con solicitudes como con archivos MIB.  Por lo tanto, nos decidimos por dos bibliotecas diferentes.  Para el cliente, la elecci√≥n de la org.snmp4j.snmp4j (https://www.snmp4j.org) ampliamente utilizada parec√≠a bastante l√≥gica, y para el analizador de archivos MIB, la elecci√≥n se hizo a la biblioteca net.percederberg.mibble no muy conocida (https: // www. mibble.org).  Si con snmp4j la elecci√≥n era obvia, entonces se eligi√≥ mibble por la disponibilidad de documentaci√≥n suficientemente detallada (aunque en ingl√©s) con ejemplos.  Entonces comencemos. <br><br><h2>  Escribir un analizador de archivos MIB </h2><br>  Todos los que han visto archivos MIB saben que esto es un dolor.  Intentemos solucionar esto con la ayuda de un analizador simple, que facilitar√° en gran medida la b√∫squeda de informaci√≥n de un archivo, reduci√©ndolo a llamar a un m√©todo en particular. <br><br>  Dicho analizador puede usarse como una utilidad separada para trabajar con archivos MIB o incluirse en cualquier otro proyecto bajo SNMP, por ejemplo, cuando se escribe un cliente SNMP o se prueba la automatizaci√≥n. <br><br><h4>  Preparaci√≥n del proyecto </h4><br>  Para facilitar el montaje, utilizamos Maven.  Dependiendo de la biblioteca add net.percederberg.mibble (https://www.mibble.org), lo que nos facilitar√° trabajar con archivos MIB: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>net.percederberg.mibble<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mibble<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.9.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Como no se encuentra en el repositorio central de Maven, agregamos el siguiente c√≥digo a pom.xml: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repository</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>opennms<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>OpenNMS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://repo.opennms.org/maven2/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repository</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Si el proyecto se ensambla utilizando Maven sin errores, todo est√° listo para el trabajo.  Solo queda crear una clase de analizador (llam√©mosla MIBParser) e importar todo lo que necesitamos, a saber: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.percederberg.mibble.*;</code> </pre> <br><h4>  Descargue y valide un archivo MIB </h4><br>  Dentro de la clase solo habr√° un campo: un objeto de tipo net.percederberg.mibble.Mib para almacenar el archivo MIB descargado: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Mib mib;</code> </pre><br>  Para cargar un archivo, escribimos este m√©todo: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Mib </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadMib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MibLoaderException, IOException </span></span>{ MibLoader loader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MibLoader(); Mib mib; file = file.getAbsoluteFile(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { loader.addDir(file.getParentFile()); mib = loader.load(file); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MibLoaderException e) { e.getLog().printTo(System.err); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mib; }</code> </pre><br>  La clase net.percederberg.mibble.MIBLoader valida el archivo que estamos intentando cargar y lanza net.percederberg.mibble.MibLoaderException si encuentra alg√∫n error en √©l, incluidos los errores de importaci√≥n de otros archivos MIB, si no se encuentran en el mismo directorio o no contienen caracteres MIB importados. <br><br>  En el m√©todo loadMib, capturamos todas las excepciones, escribimos sobre ellas en el registro y reenviamos m√°s, porque  En esta etapa, la continuaci√≥n del trabajo es imposible: el archivo no es v√°lido. <br><br>  Llamamos al m√©todo escrito en el constructor del analizador sint√°ctico: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MIBParser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MibLoaderException, IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.exists()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(<span class="hljs-string"><span class="hljs-string">"File not found in location: "</span></span> + file.getAbsolutePath()); mib = loadMib(file.getAbsoluteFile()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mib.isLoaded()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MibLoaderException(file, <span class="hljs-string"><span class="hljs-string">"Not loaded."</span></span>); }</code> </pre><br>  Si el archivo se descarg√≥ y analiz√≥ correctamente, contin√∫e trabajando. <br><br><h4>  M√©todos para recuperar informaci√≥n de un archivo MIB </h4><br>  Usando los m√©todos de la clase net.percederberg.mibble.Mib, puede buscar caracteres individuales de un archivo MIB por nombre u OID llamando a los m√©todos getSymbol (String name) o getSymbolByOid (String oid), respectivamente.  Estos m√©todos devuelven el objeto net.percederberg.mibble.MibSymbol, cuyos m√©todos usaremos para obtener la informaci√≥n necesaria sobre un s√≠mbolo MIB espec√≠fico. <br><br>  Comencemos con los m√©todos m√°s simples y de escritura para obtener el nombre de un s√≠mbolo por su OID y, por el contrario, OID por nombre: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String oid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mib.getSymbolByOid(oid).getName(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ String oid = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; MibSymbol s = mib.getSymbol(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> MibValueSymbol) { oid = ((MibValueSymbol) s).getValue().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((MibValueSymbol) s).isScalar()) oid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OID(oid).append(<span class="hljs-number"><span class="hljs-number">0</span></span>).toDottedString(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> oid; }</code> </pre><br>  Quiz√°s estas son las caracter√≠sticas de un archivo MIB espec√≠fico, con el que necesitaba trabajar, pero por alguna raz√≥n, los par√°metros escalares devolvieron OID sin cero al final, por lo que se agreg√≥ un c√≥digo al m√©todo para obtener OID, que, si el MIB el car√°cter es escalar, simplemente agrega ".0" al OID recibido utilizando el m√©todo append (int index) de la clase net.percederberg.mibble.OID.  Si te funciona sin una muleta, felicidades :) <br><br>  Para obtener el resto de los datos sobre el s√≠mbolo, escribimos un m√©todo auxiliar, donde obtenemos el objeto net.percederberg.mibble.snmp.SnmpObjectType, que contiene toda la informaci√≥n necesaria sobre el s√≠mbolo MIB del que se obtuvo. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> SnmpObjectType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSnmpObjectType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MibSymbol symbol)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (symbol <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> MibValueSymbol) { MibType type = ((MibValueSymbol) symbol).getType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> SnmpObjectType) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (SnmpObjectType) type; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Por ejemplo, podemos obtener el tipo del s√≠mbolo MIB: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getSnmpObjectType(s).getSyntax().getReferenceSymbol() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getSnmpObjectType(s).getSyntax().getName(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getSnmpObjectType(s).getSyntax().getReferenceSymbol().getName(); }</code> </pre><br>  Hay 2 formas de escribir, porque  Para los tipos primitivos, la primera opci√≥n funciona: <br><br><pre> <code class="java hljs">getSnmpObjectType(s).getSyntax().getName();</code> </pre><br>  y para los importados, el segundo: <br><br><pre> <code class="java hljs">getSnmpObjectType(s).getSyntax().getReferenceSymbol().getName();</code> </pre><br>  Puedes obtener el nivel de acceso de un personaje: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getSnmpObjectType(s).getAccess().toString(); }</code> </pre><br>  Valor m√≠nimo v√°lido para un par√°metro num√©rico: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDigitMinValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); String syntax = getSnmpObjectType(s).getSyntax().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Valor m√°ximo permitido de un par√°metro num√©rico: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDigitMaxValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); String syntax = getSnmpObjectType(s).getSyntax().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Longitud m√≠nima permitida de la cadena (depende del tipo de cadena): <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStringMinLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mib.getSymbol(name); String syntax = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getSnmpObjectType(s).getSyntax().toString(); Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>) &amp;&amp; m.find()?Integer.valueOf(Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>))):<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Longitud m√°xima permitida de la cadena (depende del tipo de cadena): <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStringMaxLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); String syntax = getSnmpObjectType(s).getSyntax().toString(); Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>) &amp;&amp; m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Tambi√©n puede obtener los nombres de todas las columnas de la tabla por su nombre: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ArrayList&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTableColumnNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tableName)</span></span></span><span class="hljs-function"> </span></span>{ ArrayList&lt;String&gt; mibSymbolNamesList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); MibValueSymbol table = (MibValueSymbol) mib.findSymbol(tableName, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (table.isTable() &amp;&amp; table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).isTableRow()) { MibValueSymbol[] symbols = table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).getChildren(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (MibValueSymbol mvs : symbols) { mibSymbolNamesList.add(mvs.getName()); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mibSymbolNamesList; }</code> </pre><br>  Primero, de manera est√°ndar, obtenemos un s√≠mbolo MIB por nombre: <br><br><pre> <code class="java hljs">MibValueSymbol table = (MibValueSymbol) mib.findSymbol(tableName, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br>  Luego verificamos si es una tabla y que el s√≠mbolo MIB secundario es una fila de esta tabla y, si la condici√≥n devuelve verdadero, en el bucle pasamos por los elementos secundarios de la fila de la tabla y agregamos el nombre del elemento a la matriz resultante: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (table.isTable() &amp;&amp; table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).isTableRow()) { MibValueSymbol[] symbols = table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).getChildren(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (MibValueSymbol mvs : symbols) { mibSymbolNamesList.add(mvs.getName()); } }</code> </pre><br><h2>  Resumen </h2><br>  Estos m√©todos son suficientes para obtener cualquier informaci√≥n del archivo MIB para cada car√°cter espec√≠fico, conociendo solo su nombre.  Por ejemplo, al escribir un cliente SNMP, puede incluir un analizador de este tipo para que los m√©todos del cliente no acepten OID, sino nombres de s√≠mbolos MIB.  Esto aumentar√° la confiabilidad del c√≥digo, ya que  un error tipogr√°fico en OID puede no conducir al car√°cter al que queremos referirnos.  Y sin OID, sin problemas. <br><br>  La ventaja es la legibilidad del c√≥digo, lo que significa su facilidad de mantenimiento.  Es m√°s f√°cil entender la esencia del proyecto si el c√≥digo funciona con nombres humanos. <br><br>  Otra aplicaci√≥n es la automatizaci√≥n de pruebas.  En los datos de prueba, uno puede obtener valores l√≠mite de par√°metros num√©ricos din√°micamente de un archivo MIB.  Por lo tanto, si los valores l√≠mite de algunos s√≠mbolos MIB en la nueva versi√≥n del componente probado cambian, no tendr√° que cambiar el c√≥digo de prueba autom√°tica. <br><br>  En general, usar un analizador sint√°ctico, trabajar con archivos MIB se vuelve mucho m√°s placentero y dejan de ser tan molestos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es427267/">https://habr.com/ru/post/es427267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es427255/index.html">Cowon D2: Musical Long-Liver</a></li>
<li><a href="../es427257/index.html">Cameron Craig: Siete lecciones aprendidas de 10 a√±os de gesti√≥n de relaciones p√∫blicas de Apple</a></li>
<li><a href="../es427259/index.html">Lo que realmente comprueba la prueba de Turing</a></li>
<li><a href="../es427263/index.html">S√© un ninja de seguridad: grabaci√≥n de seminarios web y nivel de bonificaci√≥n</a></li>
<li><a href="../es427265/index.html">Protobuffers est√°n equivocados</a></li>
<li><a href="../es427269/index.html">Video de Google OKR cinco a√±os despu√©s: una revisi√≥n de la experiencia de Google Ventures en la implementaci√≥n de OKR (2012-2017)</a></li>
<li><a href="../es427271/index.html">Historia y experiencia en el uso de la traducci√≥n autom√°tica. Conferencia de Yandex</a></li>
<li><a href="../es427273/index.html">¬øPuede la inteligencia artificial dejar a los corredores de apuestas sin trabajo?</a></li>
<li><a href="../es427275/index.html">Arquitectura de la informaci√≥n de Internet Parte 3</a></li>
<li><a href="../es427277/index.html">Se encontr√≥ un patr√≥n de difracci√≥n en la distribuci√≥n de primos, similar al de los cuasicristales.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>