<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧒🏾 ♂️ 👨‍👧 OpenVPN dan Direktori Aktif (Kerberos tanpa sertifikat pengguna) ♿️ 💎 🐆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Banyak panduan telah ditulis tentang OpenVPN, termasuk otorisasi melalui Active Directory. Sebagian besar dari mereka mulai menggunakan LDAP, saya tid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OpenVPN dan Direktori Aktif (Kerberos tanpa sertifikat pengguna)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469583/">  Banyak panduan telah ditulis tentang OpenVPN, termasuk otorisasi melalui Active Directory.  Sebagian besar dari mereka mulai menggunakan LDAP, saya tidak menemukan pendekatan menggunakan Kerberos, yang ditulis dalam artikel lengkap.  Namun, sesuatu yang baru tidak akan ditemukan di sini, saya hanya mengkompilasi apa yang telah dilakukan sebelumnya, PAM berfungsi baik dengan Kerberos, dan OpenVPN memiliki plugin PAM asli.  Saya juga memutuskan untuk meninggalkan sertifikat dan kiat pengguna, di mana mereka hanya menyarankan agar semua pengguna mengeluarkan satu sertifikat, mereka tidak cocok untuk saya, jadi solusi lain ditemukan yang bekerja pada semua klien. <br><br><img src="https://habrastorage.org/webt/p3/4c/z3/p34cz3ohasstjrgwkx2zlamhiu8.png"><br><a name="habracut"></a><br><h3>  Sedikit tentang NSS </h3><br>  Dalam kasus saya, saya menggunakan Centos 7 bersamaan dengan sssd.  Namun, tidak ada yang mencegah menggunakan winbind.  Yang utama adalah memiliki mobil di domain dan tiket Kerberos.  Saya tidak akan menulis tentang bagaimana ini dilakukan, karena  Saya tidak akan mengatakan sesuatu yang baru, ada banyak manual bagus di jaringan. <br><br>  Anda perlu mengubah pengaturan <code>/etc/nsswitch.conf</code> jika ini belum pernah dilakukan sebelumnya.  Bergantung pada modul mana yang digunakan, Anda harus memasukkan <abbr title="Sss persis">sss</abbr> atau winbind alih-alih module_name.  Deskripsi parameter dapat dibaca menggunakan <code>man nsswitch.conf</code> . <br><br>  Pengaturan berikut harus memadai: <br><br><pre> <code class="xml hljs">passwd: files module_name shadow: files module_name group: files module_name</code> </pre> <br>  Dalam kasus sssd, kami tidak lupa, antara lain, bahwa di <code>/etc/sssd/sssd.conf</code> di blok [sssd], nss harus disebutkan: <br><br><pre> <code class="xml hljs">services = nss, pam</code> </pre> <br>  Sedangkan untuk winbind, sulit bagi saya untuk mengatakan sesuatu, saya belum menggunakannya. <br><br>  Tujuan utamanya adalah untuk mendapatkan hasil yang benar dari getent.  Periksa apakah mesin dapat menerima informasi tentang pengguna dan grup domain: <br><br><pre> <code class="bash hljs">&gt; getent passwd kanlas kanlas:*:14123583:1257570:Kanlas Kanlasovich:/home/kanlas@example.com:/bin/bash &gt; getent group VPN vpn:*:13821391:kanlas,igor,marina</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Catatan</b> <div class="spoiler_text">  Jika Anda menggunakan sssd dan data pengguna hanya diperoleh dengan nama lengkap (mis. Kanlas@example.com), tambahkan <code>use_fully_qualified_names = False</code> Parameter <code>use_fully_qualified_names = False</code> dalam sssd.conf di blok domain <br></div></div><br><h3>  Konfigurasikan PAM </h3><br>  Sekarang Anda perlu membuat modul PAM Anda sendiri.  Agar tidak menggunakan sistem access.conf, kami akan membuat file terpisah dari mana grup akses akan dibaca.  Saya tidak begitu mahir dalam modul PAM, jadi saya tidak bisa mengatakan apakah semua baris diperlukan dalam contoh di bawah ini.  Secara umum, kami hanya tertarik pada <code>account required pam_listfile.so onerr=fail item=group sense=allow file=/etc/openvpn/auth/access-groups</code> baris yang <code>account required pam_listfile.so onerr=fail item=group sense=allow file=/etc/openvpn/auth/access-groups</code> . <br><br>  Opsi termudah adalah dengan mengambil, misalnya, modul login dan menambahkan baris yang diinginkan.  Yang sudah dilakukan. <br><br>  Kami mendapatkan: <br><br><pre> <code class="xml hljs">#%PAM-1.0 auth [user_unknown=ignore success=ok ignore=ignore default=bad] pam_securetty.so auth substack system-auth auth include postlogin account required pam_listfile.so onerr=fail item=group sense=allow file=/etc/openvpn/auth/access-groups account include system-auth password include system-auth session required pam_selinux.so close session required pam_loginuid.so session optional pam_console.so session required pam_selinux.so open session required pam_namespace.so session optional pam_keyinit.so force revoke session include system-auth session include postlogin -session optional pam_ck_connector.so</code> </pre> <br>  Kami menaruhnya di <code>/etc/pam.d</code> , menamakannya atas kebijakan kami. <br><br>  Di <code>/etc/openvpn/auth/access-groups</code> , ditentukan dalam modul, grup akses akan ditulis di sini, Anda dapat menentukan jalur Anda jika diinginkan.  Anda harus menentukan nama grup (Nama Umum) dengan domain.  Dalam kasus saya, saya menulis <i>VPN@example.com di</i> sana. <br><br>  Masih menjelaskan kepada OpenVPN bahwa perlu menggunakan PAM.  Kami menempatkan baris berikut dalam konfigurasi server: <br><br><pre> <code class="xml hljs">plugin /usr/lib64/openvpn/plugins/openvpn-plugin-auth-pam.so __pam username-as-common-name</code> </pre> <br>  <i><b>Distribusi yang berbeda mungkin memiliki jalur yang berbeda!</b></i>  <i><b>Periksa file berdasarkan jalur, atau gunakan temukan.</b></i> <br><br>  Penggunaan parameter username-as-common-name disebabkan oleh fakta bahwa jika tidak, setelah klien memiliki auth-user-pass, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nama yang ditentukan dalam sertifikat akan dikirim ke server.</a> <br><br>  Di konfigurasi klien, tambahkan baris <br><br><pre> <code class="xml hljs">auth-user-pass</code> </pre> <br>  Pada pengaturan ini selesai, Anda dapat menguji. <br><br><h3>  Kami menghapus sertifikat pengguna </h3><br>  Sekarang kami memiliki otorisasi melalui domain dan sertifikat pengguna tidak berguna, meninggalkannya sepertinya keputusan yang logis.  Tetapi klien seluler memiliki masalah dengan ini, sama sekali tidak menerima konfigurasi seperti itu, sementara yang desktop, meskipun mereka bekerja, mengutuk dengan kejam.  Pertama, kami akan mengkonfigurasi ulang server sehingga tidak lagi memerlukan sertifikat. <br><br><pre> <code class="xml hljs">verify-client-cert none</code> </pre> <br>  Selanjutnya, kita tambahkan ke konfigurasi klien <br><br><pre> <code class="xml hljs">setenv CLIENT_CERT 0</code> </pre> <br>  Itu saja, sekarang pelanggan tidak akan bersumpah pada sertifikat.  Sangat lucu bahwa opsi ini disembunyikan di bagian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tanya jawab untuk iOS</a> .  Saya belum menguji di iOS, tetapi Android, serta MacOS ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">klien beta</a> ) dan Windows menerima pengaturan ini dengan keras.  Hanya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">klien OpenVPN pihak ketiga</a> di Android yang belum bisa melakukan ini (saat artikel ini sedang ditulis, mereka sudah bisa memperbaikinya). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id469583/">https://habr.com/ru/post/id469583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id469569/index.html">Arend - bahasa tipe dependen berbasis HoTT (bagian 1)</a></li>
<li><a href="../id469573/index.html">Linux Piter 2019: apa yang menanti para tamu untuk konferensi Linux skala besar dan mengapa itu tidak boleh dilewatkan</a></li>
<li><a href="../id469575/index.html">Cara memprogram ulang mode tidur: 30 hari setiap pagi saya menyinari lampu hijau terang di mata saya</a></li>
<li><a href="../id469577/index.html">Disk forensik, forensik memori dan log forensik. Kerangka Volatilitas dan Otopsi. Pemecahan masalah dengan r0ot-mi. Bagian 1</a></li>
<li><a href="../id469581/index.html">Analisis Efek Picabu</a></li>
<li><a href="../id469587/index.html">Bukti Kapten merekomendasikan ... atau 100.500 kali tentang teks yang benar</a></li>
<li><a href="../id469589/index.html">Security Week 40: Kerentanan Apple Mobile BootROM</a></li>
<li><a href="../id469591/index.html">Psikologi Board Game: Game dan Temperamen</a></li>
<li><a href="../id469593/index.html">Arsitektur Ruang Kerja Digital Citrix Cloud</a></li>
<li><a href="../id469599/index.html">Pembekalan pengembangan mesin 2D pada WinForms</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>