<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë• ü•å ü§ôüèº An√°lisis del rendimiento de la m√°quina virtual en VMware vSphere. Parte 1: CPU üí¶ üôçüèø üî∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si administra una infraestructura virtual basada en VMware vSphere (o cualquier otra pila de tecnolog√≠a), probablemente escuche quejas de los usuarios...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>An√°lisis del rendimiento de la m√°quina virtual en VMware vSphere. Parte 1: CPU</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/452884/"><img src="https://habrastorage.org/webt/m9/sx/3b/m9sx3brt_zkyowlzywiwyoobc60.png"><br><br>  Si administra una infraestructura virtual basada en VMware vSphere (o cualquier otra pila de tecnolog√≠a), probablemente escuche quejas de los usuarios: "¬°La m√°quina virtual es lenta!".  En esta serie de art√≠culos analizar√© las m√©tricas de rendimiento y explicar√© qu√© y por qu√© se "ralentiza" y c√≥mo asegurarse de que no se "ralentice". <br><br>  Considerar√© los siguientes aspectos de rendimiento de las m√°quinas virtuales: <br><br><ul><li>  CPU </li><li>  RAM </li><li>  DISCO </li><li>  Red </li></ul><br>  Comenzar√© con la CPU. <br><br>  Para el an√°lisis de rendimiento necesitamos: <br><br><ul><li> <b>Los vCenter Performance Counters</b> son contadores de rendimiento cuyos gr√°ficos se pueden ver a trav√©s de vSphere Client.  La informaci√≥n sobre estos contadores est√° disponible en cualquier versi√≥n de cliente (cliente "grueso" en C #, cliente web en Flex y cliente web en HTML5).  En estos art√≠culos, utilizaremos capturas de pantalla del cliente C #, solo porque se ven mejor en miniatura :) </li><li>  <b>ESXTOP</b> es una utilidad que se ejecuta desde la l√≠nea de comandos de ESXi.  Con su ayuda, puede obtener los valores de los contadores de rendimiento en tiempo real o cargar estos valores durante un per√≠odo determinado en un archivo .csv para su posterior an√°lisis.  A continuaci√≥n, le contar√© m√°s sobre esta herramienta y le proporcionar√© algunos enlaces √∫tiles a la documentaci√≥n y art√≠culos relacionados. </li></ul><br><a name="habracut"></a><br><h3>  Poco de teor√≠a </h3><br><img src="https://habrastorage.org/webt/zf/rh/dx/zfrhdxqi6ys3wgdgzs0m5ibk96i.png"><br><br>  En ESXi, un proceso separado es responsable del funcionamiento de cada vCPU (n√∫cleo de m√°quina virtual), el mundo en terminolog√≠a de VMware.  Tambi√©n hay procesos de servicio, pero desde el punto de vista del an√°lisis de rendimiento de VM, son menos interesantes. <br><br>  Un proceso en ESXi puede estar en uno de cuatro estados: <br><br><ul><li>  <b>Ejecutar</b> : el proceso hace un trabajo √∫til. </li><li>  <b>Espere</b> : el proceso no funciona (inactivo) o est√° esperando entrada / salida. </li><li>  <b>Costop</b> es una condici√≥n que ocurre en m√°quinas virtuales multin√∫cleo.  Ocurre cuando el planificador de la CPU del hipervisor (ESXi CPU Scheduler) no puede programar todos los n√∫cleos activos de la m√°quina virtual para que se ejecuten simult√°neamente en los n√∫cleos del servidor f√≠sico.  En el mundo f√≠sico, todos los n√∫cleos de procesador funcionan en paralelo, el sistema operativo invitado dentro de la VM espera un comportamiento similar, por lo que el hipervisor debe ralentizar los n√∫cleos de VM, que tienen la capacidad de terminar el ritmo m√°s r√°pido.  En las versiones modernas de ESXi, el programador de la CPU utiliza un mecanismo llamado co-programaci√≥n relajada: el hipervisor considera la brecha entre el n√∫cleo de la m√°quina virtual m√°s r√°pido y m√°s lento (sesgo). Si los n√∫cleos de VM pasan mucho tiempo en este estado, esto puede causar problemas de rendimiento. </li><li>  <b>Listo</b> : el proceso pasa a este estado cuando el hipervisor no tiene la capacidad de asignar recursos para su ejecuci√≥n.  Los valores altos listos pueden causar problemas de rendimiento de VM. </li></ul><br><h3>  Contadores b√°sicos de rendimiento de CPU de una m√°quina virtual </h3><br>  <b>Uso de CPU,%.</b>  Muestra el porcentaje de uso de CPU para un per√≠odo determinado. <br><br><img src="https://habrastorage.org/webt/ly/ad/rg/lyadrgztwkrkipbfnzllfcjtrq4.png"><br><br>  <b>¬øC√≥mo analizar?</b>  Si la VM utiliza de manera estable la CPU para el 90% o hay picos de hasta el 100%, entonces tenemos problemas.  Los problemas se pueden expresar no solo en el funcionamiento "lento" de la aplicaci√≥n dentro de la VM, sino tambi√©n en la inaccesibilidad de la VM a trav√©s de la red.  Si el sistema de monitoreo muestra que la VM se cae peri√≥dicamente, preste atenci√≥n a los picos en el gr√°fico de Uso de la CPU. <br><br>  Hay una alarma est√°ndar, que muestra la carga de CPU de la m√°quina virtual: <br><br><img src="https://habrastorage.org/webt/6a/pr/b9/6aprb9vc1gwbtioocqpjdm7jzhk.png"><br><br>  <b>Que hacer</b>  Si el uso de la CPU est√° constantemente abrumando a la VM, puede pensar en aumentar el n√∫mero de vCPU (desafortunadamente, esto no siempre ayuda) o transferir las VM a un servidor con procesadores m√°s eficientes. <br><br><h3>  Uso de CPU en Mhz </h3><br>  En los gr√°ficos de uso de vCenter en% solo puede ver la m√°quina virtual completa, no hay gr√°ficos para n√∫cleos individuales (Esxtop tiene valores en% para n√∫cleos).  Para cada n√∫cleo, puede ver Uso en MHz. <br><br>  <b>¬øC√≥mo analizar?</b>  Sucede que la aplicaci√≥n no est√° optimizada para la arquitectura multin√∫cleo: utiliza 100% solo un n√∫cleo, y el resto est√° inactivo sin carga.  Por ejemplo, con la configuraci√≥n de copia de seguridad predeterminada, MS SQL inicia el proceso en un solo n√∫cleo.  Como resultado, la copia de seguridad se ralentiza no debido a la velocidad lenta del disco (esto es de lo que se quej√≥ inicialmente el usuario), sino porque el procesador no puede hacer frente.  El problema se resolvi√≥ cambiando los par√°metros: la copia de seguridad comenz√≥ a ejecutarse en paralelo en varios archivos (respectivamente, en varios procesos). <br><br><img src="https://habrastorage.org/webt/6p/pm/w8/6ppmw8d5vqe2gepkiahzqx9tfms.png"><br>  <i>Un ejemplo de una carga desigual de n√∫cleos.</i> <br><br>  Tambi√©n existe una situaci√≥n (como en el gr√°fico anterior) cuando los n√∫cleos est√°n cargados de manera desigual y algunos de ellos tienen picos del 100%.  Al igual que con la carga de un solo n√∫cleo, la alarma en el uso de la CPU no funcionar√° (est√° en toda la VM), pero habr√° problemas de rendimiento. <br><br>  <b>Que hacer</b>  Si el software en la m√°quina virtual carga los n√∫cleos de manera desigual (usa solo un n√∫cleo o parte de los n√∫cleos), no tiene sentido aumentar su n√∫mero.  En este caso, es mejor mover la VM a un servidor con procesadores m√°s eficientes. <br><br>  Tambi√©n puede intentar verificar la configuraci√≥n de energ√≠a en el BIOS del servidor.  Muchos administradores activan el modo de alto rendimiento en el BIOS y, por lo tanto, desactivan las tecnolog√≠as de ahorro de energ√≠a de los estados C y P.  Los procesadores Intel modernos usan la tecnolog√≠a Turbo Boost, que aumenta la frecuencia de los n√∫cleos de procesadores individuales debido a otros n√∫cleos.  Pero solo funciona con las tecnolog√≠as de ahorro de energ√≠a incluidas.  Si los apagamos, el procesador no puede reducir el consumo de energ√≠a de los n√∫cleos que no est√°n cargados. <br><br>  VMware recomienda no desactivar las tecnolog√≠as de ahorro de energ√≠a en los servidores, sino elegir modos que maximicen la administraci√≥n de energ√≠a para el hipervisor.  Al mismo tiempo, en la configuraci√≥n de energ√≠a del hipervisor, debe seleccionar Alto rendimiento. <br><br>  Si tiene m√°quinas virtuales separadas (o n√∫cleos de m√°quinas virtuales) en su infraestructura que requieren una frecuencia de CPU aumentada, la configuraci√≥n correcta del consumo de energ√≠a puede mejorar significativamente su rendimiento. <br><br><img src="https://habrastorage.org/webt/uq/ov/-o/uqov-ooazq0fetmazbwzhvxlgeg.png"><br><br><h3>  CPU lista (preparaci√≥n) </h3><br>  Si el n√∫cleo de VM (vCPU) est√° en estado Listo, no hace un trabajo √∫til.  Esta condici√≥n ocurre cuando el hipervisor no encuentra un n√∫cleo f√≠sico libre al que se pueda asignar el proceso de vCPU de la m√°quina virtual. <br><br>  <b>¬øC√≥mo analizar?</b>  Por lo general, si los n√∫cleos de la m√°quina virtual est√°n en estado Listo durante m√°s del 10% del tiempo, notar√° problemas de rendimiento.  En pocas palabras, m√°s del 10% del tiempo que una VM espera la disponibilidad de recursos f√≠sicos. <br><br>  En vCenter, puede ver 2 contadores asociados con la CPU Ready: <br><br><ul><li>  Preparaci√≥n </li><li>  Listo </li></ul><br>  Los valores de ambos contadores se pueden ver tanto en toda la VM como en n√∫cleos individuales. <br>  La preparaci√≥n muestra el valor inmediatamente en porcentaje, pero solo en tiempo real (datos de la √∫ltima hora, intervalo de medici√≥n de 20 segundos).  Este contador se usa mejor solo para buscar problemas "en persecuci√≥n". <br><br>  Los valores de contador listos tambi√©n se pueden ver en perspectiva hist√≥rica.  Esto es √∫til para establecer patrones y para un an√°lisis m√°s profundo del problema.  Por ejemplo, si una m√°quina virtual comienza a tener problemas de rendimiento en alg√∫n momento espec√≠fico, puede comparar los intervalos del valor de CPU Ready bloqueado con la carga total en el servidor donde se est√° ejecutando la VM, y tomar medidas para reducir la carga (si DRS no puede hacer frente). <br><br>  Listo, a diferencia de Readiness, no se muestra en porcentajes, sino en milisegundos.  Este es un contador de tipo de Suma, es decir, muestra cu√°nto tiempo estuvo el n√∫cleo de VM en el estado Listo durante el per√≠odo de medici√≥n.  Puede traducir este valor en porcentaje mediante una f√≥rmula simple: <br><br>  (Valor de suma de CPU listo / (intervalo de actualizaci√≥n predeterminado del gr√°fico en segundos * 1000)) * 100 =% de CPU listo <br><br>  Por ejemplo, para las m√°quinas virtuales en el gr√°fico a continuaci√≥n, el valor m√°ximo de Ready para toda la m√°quina virtual es el siguiente: <br><br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mn>4286</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mo stretchy=&quot;false&quot;>(</mo><mn>20</mn><mo>&amp;#x2217;</mo><mn>1000</mn><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2217;</mo><mn>100</mn><mo>=</mo><mn>21</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="29.706ex" height="2.66ex" viewBox="0 -832 12789.9 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-34"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-32" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-38" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-36" x="1501" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-2F" x="2391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-28" x="2892" y="0"></use><g transform="translate(3281,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-2217" x="4504" y="0"></use><g transform="translate(5227,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-30" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-30" x="1501" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-29" x="7229" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-29" x="7618" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-2217" x="8230" y="0"></use><g transform="translate(8953,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-3D" x="10732" y="0"></use><g transform="translate(11788,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/dataline/blog/452884/&amp;usg=ALkJrhhda4xrsMr5_62yExwBzSkOEuas9A#MJMAIN-31" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>4286</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mo stretchy="false">(</mo><mn>20</mn><mo>‚àó</mo><mn>1000</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>‚àó</mo><mn>100</mn><mo>=</mo><mn>21</mn></math></span></span><script type="math/tex" id="MathJax-Element-1"> (4286 / (20 * 1000)) * 100 = 21% (4286 / (20 * 1000)) * 100 = 21% </script><br><br><img src="https://habrastorage.org/webt/oq/ma/1u/oqma1u-x4wdruct6jqgvlak9ia0.png"><br><br>  Al calcular el valor Listo como un porcentaje, debe prestar atenci√≥n a dos puntos: <br><br><ul><li>  El valor de Ready en toda la VM es la suma de Ready en los n√∫cleos. </li><li>  Intervalo de medida.  En tiempo real, son 20 segundos y, por ejemplo, en gr√°ficos diarios, son 300 segundos. </li></ul><br>  Con la resoluci√≥n activa de problemas, estos puntos simples se pueden perder f√°cilmente y se puede dedicar un tiempo valioso a resolver problemas inexistentes. <br><br>  Calculamos Ready en base a los datos del gr√°fico a continuaci√≥n.  (324474 / (20 * 1000)) * 100 = 1622% para toda la VM.  Si nos fijamos en los n√∫cleos, resultar√° no tan aterrador: 1622/64 = 25% por n√∫cleo.  En este caso, detectar un truco es bastante simple: el valor Listo no es realista.  Pero si estamos hablando del 10-20% para toda la VM con varios n√∫cleos, entonces para cada n√∫cleo el valor puede estar dentro del rango normal. <br><br><img src="https://habrastorage.org/webt/_m/qe/cc/_mqeccs8ivn_r-zrogedc_ofw9a.png"><br><br>  <b>Que hacer</b>  Un valor alto de Listo indica que el servidor no tiene suficientes recursos de procesador para el funcionamiento normal de las m√°quinas virtuales.  En esta situaci√≥n, solo queda reducir la suscripci√≥n excesiva en el procesador (vCPU: pCPU).  Obviamente, esto se puede lograr reduciendo los par√°metros de las m√°quinas virtuales existentes o migrando parte de la m√°quina virtual a otros servidores. <br><br><h3>  Co-stop </h3><br>  <b>¬øC√≥mo analizar?</b>  Este contador tambi√©n tiene el tipo de Suma y se traduce en porcentajes como Listo: <br><br>  (Valor de suma de paro de CPU / (intervalo de actualizaci√≥n predeterminado del gr√°fico en segundos * 1000)) * 100 =% de paro de CPU <br><br>  Aqu√≠ tambi√©n debe prestar atenci√≥n a la cantidad de n√∫cleos por VM y al intervalo de medici√≥n. <br>  En el estado costop, el n√∫cleo no hace un trabajo √∫til.  Con la selecci√≥n correcta del tama√±o de la m√°quina virtual y la carga normal en el servidor, el contador de parada simult√°nea debe estar cerca de cero. <br><br><img src="https://habrastorage.org/webt/pz/y8/sr/pzy8sr12hk1z2yosm9devw7knvs.png"><br>  <i>En este caso, la carga es claramente anormal :)</i> <br><br>  <b>Que hacer</b>  Si varias m√°quinas virtuales con una gran cantidad de n√∫cleos se ejecutan en el mismo hipervisor y hay una suscripci√≥n excesiva en la CPU, entonces el contador de detenci√≥n simult√°nea puede crecer, lo que provocar√° problemas con el rendimiento de estas m√°quinas virtuales. <br><br>  Adem√°s, co-stop aumentar√° si se usan subprocesos para n√∫cleos activos de una VM en el mismo n√∫cleo del servidor f√≠sico con hipercadena habilitada.  Tal situaci√≥n puede surgir, por ejemplo, si la VM tiene m√°s n√∫cleos de los que tiene f√≠sicamente en el servidor donde trabaja, o si la configuraci√≥n "preferHT" est√° habilitada para la VM.  Puede leer sobre esta configuraci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Para evitar problemas con el rendimiento de la VM debido a la alta parada simult√°nea, seleccione el tama√±o de la VM de acuerdo con las recomendaciones del fabricante del software que se ejecuta en esta VM y con las capacidades del servidor f√≠sico donde se ejecuta la VM. <br><br>  No agregue kernels en reserva, esto puede causar problemas de rendimiento no solo de la VM en s√≠, sino tambi√©n de sus servidores vecinos. <br><br><h3>  Otras m√©tricas √∫tiles de CPU </h3><br>  <b>Ejecutar</b> : cu√°nto tiempo (ms) para el per√≠odo de medici√≥n de vCPU estuvo en el estado EJECUTAR, es decir, realmente realiz√≥ un trabajo √∫til. <br><br>  <b>Inactivo</b> : cu√°nto tiempo (ms) para el per√≠odo de medici√≥n de vCPU estuvo inactivo.  Los valores altos de inactividad no son un problema, solo vCPU no ten√≠a "nada que hacer". <br><br>  <b>Esperar</b> : cu√°nto tiempo (ms) para el per√≠odo de medici√≥n de vCPU estuvo en el estado Esperar.  Dado que IDLE se incluye en este contador, los valores de espera altos tampoco indican un problema.  Pero si el nivel de espera alto es bajo, entonces la m√°quina virtual estaba esperando que se completaran las operaciones de E / S y esto, a su vez, puede indicar un problema con el rendimiento del disco duro o de algunos dispositivos virtuales de la m√°quina virtual. <br><br>  <b>Limitado m√°ximo</b> : cu√°nto tiempo (ms) para el per√≠odo de medici√≥n de vCPU estuvo en estado Listo debido al l√≠mite de recursos establecido.  Si el rendimiento es inexplicablemente bajo, es √∫til verificar el valor de este contador y el l√≠mite de CPU en la configuraci√≥n de VM.  De hecho, las m√°quinas virtuales pueden tener l√≠mites que desconoce.  Por ejemplo, esto sucede cuando la VM se inclin√≥ desde la plantilla en la que se estableci√≥ el l√≠mite de CPU. <br><br>  <b>Swap wait</b> : cu√°nto tiempo esper√≥ la vCPU para funcionar con VMkernel Swap durante el per√≠odo de medici√≥n.  Si los valores de este contador est√°n por encima de cero, entonces la VM definitivamente tiene problemas de rendimiento.  Hablaremos m√°s sobre SWAP en el art√≠culo sobre contadores de RAM. <br><br><h3>  ESXTOP </h3><br>  Si los contadores de rendimiento en vCenter son buenos para analizar datos hist√≥ricos, entonces el an√°lisis en l√≠nea del problema se realiza mejor en ESXTOP.  Aqu√≠, todos los valores se presentan en forma terminada (no es necesario traducir nada), y el per√≠odo m√≠nimo de medici√≥n es de 2 segundos. <br>  La pantalla "c" activa la pantalla ESXTOP en la CPU y tiene este aspecto: <br><br><img src="https://habrastorage.org/webt/5x/8g/-o/5x8g-ovkxsc4xsuuvvk6guv3t0u.png"><br><br>  Para mayor comodidad, solo puede dejar procesos de m√°quinas virtuales presionando Shift-V. <br>  Para ver las m√©tricas de los n√∫cleos de m√°quinas virtuales individuales, presione "e" y escriba el GID de la m√°quina virtual que le interesa (30919 en la captura de pantalla a continuaci√≥n): <br><br><img src="https://habrastorage.org/webt/tu/fn/jz/tufnjzwauierg5thzwsij3elpca.png"><br><br>  Revise brevemente las columnas que se presentan por defecto.  Se pueden agregar columnas adicionales presionando "f". <br><br>  <b>NWLD (N√∫mero de mundos)</b> : el n√∫mero de procesos en el grupo.  Para expandir el grupo y ver las m√©tricas de cada proceso (por ejemplo, para cada n√∫cleo de una VM multin√∫cleo), presione "e".  Si un grupo tiene m√°s de un proceso, los valores de las m√©tricas para el grupo son iguales a la suma de las m√©tricas para los procesos individuales. <br><br>  <b>% USADO</b> : cu√°ntos ciclos utiliza la CPU del servidor un proceso o grupo de procesos. <br><br>  <b>% RUN</b> : cu√°nto tiempo durante el per√≠odo de medici√≥n el proceso estuvo en el estado RUN, es decir  realiz√≥ un trabajo √∫til.  Se diferencia del% USADO en que no tiene en cuenta el subprocesamiento, el escalado de frecuencia y el tiempo dedicado a las tareas del sistema (% SYS). <br><br>  <b>% SYS</b> : tiempo dedicado a tareas del sistema, por ejemplo: manejo de interrupciones, entrada / salida, funcionamiento de la red, etc. El valor puede ser alto si hay mucha entrada / salida en la VM. <br><br>  <b>% OVRLP</b> : cu√°nto tiempo pas√≥ el n√∫cleo f√≠sico en el que se ejecuta el proceso VM en tareas de otros procesos. <br><br>  Estas m√©tricas est√°n relacionadas de la siguiente manera: <br><br>  % USED =% RUN +% SYS -% OVRLP. <br><br>  Por lo general, la m√©trica% USADO es m√°s informativa. <br><br>  <b>% WAIT</b> : cu√°nto tiempo durante el per√≠odo de medici√≥n estuvo el proceso en el estado Wait.  Incluye inactivo. <br><br>  <b>% IDLE</b> : cu√°nto tiempo estuvo el proceso en estado IDLE durante el per√≠odo de medici√≥n. <br><br>  <b>% SWPWT</b> : cu√°nto tiempo esper√≥ vCPU para la operaci√≥n con VMkernel Swap durante el per√≠odo de medici√≥n. <br><br>  <b>% VMWAIT</b> : cu√°nto tiempo estuvo la vCPU en el estado de espera de un evento (generalmente E / S) durante el per√≠odo de medici√≥n.  No hay un contador similar en vCenter.  Los valores altos indican problemas con la entrada / salida a la VM. <br><br>  % WAIT =% VMWAIT +% IDLE +% SWPWT. <br><br>  Si la VM no usa VMkernel Swap, cuando analice problemas de rendimiento es aconsejable mirar% VMWAIT, ya que esta m√©trica no tiene en cuenta el momento en que la VM no hizo nada (% IDLE). <br><br>  <b>% RDY</b> : cu√°nto tiempo estuvo el proceso en estado Listo durante el per√≠odo de medici√≥n. <br><br>  <b>% CSTP</b> : cu√°nto tiempo estuvo el proceso en el estado posterior durante el per√≠odo de medici√≥n. <br><br>  <b>% MLMTD</b> : cu√°nto tiempo durante el per√≠odo de medici√≥n de vCPU estuvo en estado Listo debido al l√≠mite de recursos establecido. <br><br>  % WAIT +% RDY +% CSTP +% RUN = 100%: el n√∫cleo de VM siempre est√° en uno de estos cuatro estados. <br><br><h3>  CPU en el hipervisor </h3><br>  Tambi√©n hay contadores de rendimiento de CPU para el hipervisor en vCenter, pero no representan nada interesante: es solo la suma de los contadores para todas las m√°quinas virtuales en el servidor. <br>  La forma m√°s conveniente de ver el estado de la CPU en el servidor es en la pesta√±a Resumen: <br><br><img src="https://habrastorage.org/webt/cr/zn/bb/crznbbcz3ifhippyvvrpqaotvps.png"><br><br>  Para el servidor, as√≠ como para la m√°quina virtual, hay una alarma est√°ndar: <br><br><img src="https://habrastorage.org/webt/-v/x0/gz/-vx0gzuta3wskstyrmu8ylixqla.png"><br><br>  Con una alta carga en la CPU del servidor, las m√°quinas virtuales que se ejecutan en √©l comienzan a experimentar problemas de rendimiento. <br><br>  En ESXTOP, los datos de utilizaci√≥n de la CPU del servidor se presentan en la parte superior de la pantalla.  Adem√°s de la carga est√°ndar de la CPU, que no es informativa para los hipervisores, hay tres m√©tricas m√°s: <br><br>  <b>CORE UTIL (%)</b> : carga del n√∫cleo del servidor f√≠sico.  Este contador muestra cu√°nto tiempo el n√∫cleo realiz√≥ el trabajo durante el per√≠odo de medici√≥n. <br><br>  <b>PCPU UTIL (%)</b> : si el hiperprocesamiento est√° habilitado, entonces hay dos subprocesos (PCPU) para cada n√∫cleo f√≠sico.  Esta m√©trica muestra cu√°nto tiempo trabaj√≥ cada subproceso. <br><br>  <b>PCPU USED (%)</b> es lo mismo que PCPU UTIL (%), pero tiene en cuenta la escala de frecuencia (ya sea reduciendo la frecuencia del n√∫cleo para ahorrar energ√≠a o aumentando la frecuencia del n√∫cleo debido a la tecnolog√≠a Turbo Boost) e hiper-threading. <br><br>  PCPU_USED% = PCPU_UTIL% * frecuencia central efectiva / frecuencia central nominal. <br><br><img src="https://habrastorage.org/webt/gk/il/nh/gkilnhtdazgv5nxiwbydkhda-oe.png"><br>  <i>En esta captura de pantalla, para algunos n√∫cleos, debido a la operaci√≥n de Turbo Boost, el valor USADO es m√°s del 100%, ya que la frecuencia del n√∫cleo es m√°s alta que la nominal.</i> <br><br>  Algunas palabras sobre c√≥mo se tiene en cuenta el hiperprocesamiento.  Si los procesos se ejecutan el 100% del tiempo en ambos subprocesos del n√∫cleo f√≠sico del servidor, mientras que el n√∫cleo se ejecuta a la frecuencia nominal, entonces: <br><br><ul><li>  CORE UTIL para el n√∫cleo ser√° 100%, </li><li>  PCPU UTIL para ambos hilos ser√° 100%, </li><li>  PCED UTILIZADO para ambos hilos ser√° del 50%. </li></ul><br>  Si ambos hilos no funcionaron el 100% del tiempo durante el per√≠odo de medici√≥n, entonces, en aquellos per√≠odos en que los hilos trabajaron en paralelo, la PCPU UTILIZADA para n√∫cleos se divide por la mitad. <br><br>  ESXTOP tambi√©n tiene una pantalla con los par√°metros de consumo de energ√≠a del servidor de la CPU.  Aqu√≠ puede ver si el servidor utiliza tecnolog√≠as de ahorro de energ√≠a: estados C y estados P.  Llamado por la tecla p: <br><br><img src="https://habrastorage.org/webt/cd/qv/he/cdqvhelnmce9qeseanbqzl3qsqs.png"><br><br><h3>  Problemas comunes de rendimiento de la CPU </h3><br>  Finalmente, revisar√© por razones t√≠picas de problemas con el rendimiento de la CPU VM y dar√© algunos consejos para resolverlos: <br><br>  <b>No hay suficiente velocidad de reloj central.</b>  Si no hay forma de transferir m√°quinas virtuales a n√∫cleos m√°s eficientes, puede intentar cambiar la configuraci√≥n de energ√≠a para que Turbo Boost funcione de manera m√°s eficiente. <br><br>  <b>Dimensionamiento incorrecto de la VM (demasiados / pocos n√∫cleos).</b>  Si coloca pocos n√∫cleos, habr√° una gran carga en la CPU de VM.  Si es mucho, coge una parada alta. <br><br>  <b>Gran sobresuscripci√≥n en la CPU en el servidor.</b>  Si la m√°quina virtual est√° preparada, reduzca la suscripci√≥n excesiva en la CPU. <br><br>  <b>Topolog√≠a de NUMA incorrecta en m√°quinas virtuales grandes.</b>  La topolog√≠a NUMA que ve la VM (vNUMA) debe coincidir con la topolog√≠a del servidor NUMA (pNUMA).  Los diagn√≥sticos y las posibles soluciones a este problema est√°n escritos, por ejemplo, en el libro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"VMware vSphere 6.5 Host Resources Deep Dive"</a> .  Si no desea profundizar y no tiene restricciones de licencia en el sistema operativo instalado en la VM, realice muchos sockets virtuales en la VM en un n√∫cleo.  No perder√°s mucho :) <br><br>  Eso es todo por la CPU.  Haz preguntas  En la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">siguiente parte</a> hablar√© sobre RAM. <br><br><div class="spoiler">  <b class="spoiler_title">Enlaces utiles</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://virtual-red-dot.info/vm-cpu-counters-vsphere/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://kb.vmware.com/kb/1017926</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.yellow-bricks.com/2012/07/17/why-is-wait-so-high/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://communities.vmware.com/docs/DOC-9279</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/techpaper/performance/whats-new-vsphere65-perf.pdf</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://pages.rubrik.com/host-resources-deep-dive_request.html</a> </div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452884/">https://habr.com/ru/post/452884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452880/index.html">Fugas de datos de usuarios sensacionales para enero - abril de 2019</a></li>
<li><a href="../452882/index.html">Errores del cliente en el primer contacto con Freelancer</a></li>
<li><a href="../452886/index.html">Proyectos de Wiki y nombre de Noosphere en HACKNOWLEGE</a></li>
<li><a href="../452888/index.html">Cerca de M√∫nich comenz√≥ a probar el tiltrotor de cinco asientos de tama√±o completo Lilium Jet</a></li>
<li><a href="../452890/index.html">23 de mayo, 18:30 - transmisi√≥n en vivo de QIWI Kitchen</a></li>
<li><a href="../452892/index.html">¬øC√≥mo puede un no programador mudarse a los Estados Unidos? Instrucciones paso a paso.</a></li>
<li><a href="../452894/index.html">Face Anti-Spoofing o tecnol√≥gicamente reconoce a un tramposo de mil por cara</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>