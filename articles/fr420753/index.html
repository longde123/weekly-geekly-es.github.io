<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìá ‚è© üï∞Ô∏è Frontend de microservice - une approche moderne de la s√©paration du front üë± üîê üïµÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'architecture de microservices est depuis longtemps la norme de facto dans le d√©veloppement de syst√®mes grands et complexes. Il pr√©sente un certain n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Frontend de microservice - une approche moderne de la s√©paration du front</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/netcracker/blog/420753/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ff/bs/ky/ffbskynryldvlmxczvxjwrsxa-a.png" alt="spa trop gras"></div><br><br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'architecture de microservices</a></b> est depuis longtemps la norme de facto dans le d√©veloppement de syst√®mes grands et complexes.  Il pr√©sente un certain nombre d'avantages: c'est une division stricte en modules, une faible connectivit√©, une r√©sistance aux pannes, une sortie progressive en production et une version ind√©pendante des composants. <br><br>  Il est vrai, souvent, en parlant d'architecture de microservices, seule l'architecture de backend est mentionn√©e, et le frontend tel qu'il √©tait, reste monolithique.  Il s'av√®re que nous avons fait un excellent soutien, et l'avant nous tire en arri√®re. <br><br>  Aujourd'hui, je vais vous dire comment nous avons fait le front du microservice dans notre solution SaaS et quels probl√®mes nous avons rencontr√©s. <br><a name="habracut"></a><br><h2>  <font color="#173146">Probl√®me</font> </h2><br>  Au d√©part, le d√©veloppement dans notre entreprise ressemblait √† ceci: il y a de nombreuses √©quipes impliqu√©es dans le d√©veloppement de microservices, chacune d'elles publiant sa propre API.  Et il y a une √©quipe distincte qui d√©veloppe SPA pour l'utilisateur final, en utilisant l'API de diff√©rents microservices.  Avec cette approche, tout fonctionne: les d√©veloppeurs de microservices savent tout sur leur impl√©mentation, et les d√©veloppeurs SPA connaissent toutes les subtilit√©s des interactions des utilisateurs.  Mais il y avait un probl√®me: maintenant chaque front-end devrait conna√Ætre toutes les subtilit√©s de tous les microservices.  Il y a de plus en plus de microservices, de plus en plus de fournisseurs frontaux - et Agile commence √† s'effondrer, √† mesure que la sp√©cialisation au sein de l'√©quipe appara√Æt, c'est-√†-dire que l'interchangeabilit√© et l'universalit√© disparaissent. <br><br>  Nous sommes donc pass√©s √† l'√©tape suivante - le d√©veloppement modulaire.  L'√©quipe frontend √©tait divis√©e en sous-commandes.  Chacun √©tait responsable de sa partie de la demande.  C'est devenu beaucoup mieux, mais au fil du temps, cette approche s'est √©puis√©e pour plusieurs raisons. <br><br><ul><li>  Tous les modules sont h√©t√©rog√®nes, avec leurs propres sp√©cificit√©s.  Pour chaque module, sa propre technologie est mieux adapt√©e.  Dans le m√™me temps, le choix de la technologie est une t√¢che difficile dans les conditions du SPA. </li><li>  Depuis l'application SPA (et dans le monde moderne, cela signifie la compilation en un seul paquet ou au moins un assemblage), seule l'application enti√®re peut √™tre √©mise en m√™me temps.  Le risque de chaque extradition augmente. </li><li>  Il devient plus difficile de g√©rer la d√©pendance.  Diff√©rents modules n√©cessitent des versions de d√©pendance diff√©rentes (√©ventuellement sp√©cifiques).  Quelqu'un n'est pas pr√™t √† passer √† l'API de d√©pendance mise √† jour, et quelqu'un ne peut pas cr√©er de fonctionnalit√© en raison d'un bogue dans l'ancienne branche de d√©pendance. </li><li>  En raison du deuxi√®me point, le cycle de lib√©ration de tous les modules doit √™tre synchronis√©.  Tout le monde attend les retardataires. </li></ul><br><h2>  <font color="#173146">Frontend de coupe</font> </h2><br>  Il y a eu un moment d'accumulation de masse critique, et ils ont d√©cid√© de diviser le frontal en ... microservices frontaux.  D√©finissons ce qu'est un microservice frontal: <br><br><ul><li>  une partie compl√®tement isol√©e de l'interface utilisateur, en aucun cas d√©pendante des autres;  isolement radical;  litt√©ralement d√©velopp√© comme une application autonome; </li><li>  chaque microservice frontal est responsable d'un certain ensemble de fonctions commerciales du d√©but √† la fin, c'est-√†-dire qu'il est enti√®rement fonctionnel en soi; </li><li>  peut √™tre √©crit sur n'importe quelle technologie. </li></ul><br>  Mais nous sommes all√©s plus loin et avons introduit un autre niveau de division. <br><br>
<h3>  <font color="#173146">Concept de fragment</font> </h3><br>  Nous appelons un fragment un bundle compos√© de <code>js + css +  </code> .  En fait, il s'agit d'une partie ind√©pendante de l'interface utilisateur, qui doit se conformer √† un ensemble de r√®gles de d√©veloppement pour pouvoir √™tre utilis√©e dans un SPA g√©n√©ral.  Par exemple, tous les styles doivent √™tre aussi sp√©cifiques que possible pour le fragment.  Aucune tentative ne doit √™tre faite pour interagir directement avec d'autres fragments.  Vous devez avoir une m√©thode sp√©ciale √† laquelle vous pouvez passer l'√©l√©ment DOM o√π le fragment doit √™tre dessin√©. <br><br>  Gr√¢ce au descripteur, nous pouvons enregistrer des informations sur tous les fragments enregistr√©s de l'environnement, puis y avoir acc√®s par ID. <br><br>  Cette approche vous permet de placer deux applications √©crites sur des cadres diff√©rents sur une seule page.  Il permet √©galement d'√©crire du code universel qui vous permettra de charger dynamiquement les fragments n√©cessaires sur la page, de les initialiser et de g√©rer le cycle de vie.  Pour la plupart des cadres modernes, il suffit de suivre les ¬´r√®gles d'hygi√®ne¬ª pour que cela soit possible. <br><br>  Dans les cas o√π le fragment n'a pas la possibilit√© de ¬´cohabiter¬ª avec d'autres sur la m√™me page, il existe un script de secours dans lequel nous dessinons le fragment dans un iframe (la solution aux probl√®mes associ√©s d√©passe le cadre de cet article). <br><br>  Tout ce qu'un d√©veloppeur qui souhaite utiliser un extrait de code existant sur une page doit faire est: <br><br><ol><li>  Connectez le script de plate-forme de microservice √† la page. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//{URL to static cache service}/api/v1/mui-platform/muiPlatform.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li>  Appelez la m√©thode d'ajout d'un fragment √† la page. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.MUI.createFragment( <span class="hljs-comment"><span class="hljs-comment">// fragment name "hello-label", // fragment model { text: "HelloLabelFragment text from run time" }, // fragment position { selector: ".hello-label-placeholder", position: "afterend" }) .then(callback);</span></span></code> </pre><br></li></ol><br>  De plus, pour la communication entre les fragments, il existe un bus construit sur <code>Observable</code> et <code>rxjs</code> .  Il est √©crit sur NativeJS.  De plus, le SDK est livr√© avec des wrappers pour diff√©rents frameworks qui aident √† utiliser ce bus en mode natif.  Un exemple pour Angular 6 est une m√©thode utilitaire qui renvoie <code>rxjs/Observable</code> : <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {fromEvent} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "@netcracker/mui-platform/angular2-factory/modules/shared/utils/event-utils" fromEvent("&lt;event-name&gt;"); fromEvent(EventClassType);</code> </pre><br>  De plus, la plate-forme fournit un ensemble de services qui sont souvent utilis√©s par diff√©rents fragments et sont basiques dans notre infrastructure.  Ce sont des services tels que la localisation / internationalisation, le service d'autorisation, le travail avec les cookies inter-domaines, le stockage local et bien plus encore.  Pour leur utilisation, le SDK fournit √©galement des wrappers pour divers cadres. <br><br><h2>  <font color="#173146">Combiner le frontend</font> </h2><br>  Par exemple, nous pouvons consid√©rer cette approche dans la zone d'administration SPA (elle combine diff√©rents param√®tres possibles de diff√©rents microservices).  Nous pouvons cr√©er le contenu de chaque signet sous forme de fragment distinct, qui sera fourni et d√©velopp√© s√©par√©ment par chaque microservice.  Gr√¢ce √† cela, nous pouvons cr√©er un simple ¬´en-t√™te¬ª qui montrera le microservice correspondant en cliquant sur un signet. <br><br><img src="https://habrastorage.org/webt/uw/su/7x/uwsu7xp8fbiscef1hmkkmyw8bxw.png" alt="image"><br><br><h2>  <font color="#173146">Nous d√©veloppons l'id√©e d'un fragment</font> </h2><br>  Le d√©veloppement d'un signet avec un fragment ne permet pas toujours de r√©soudre tous les probl√®mes possibles.  Il est souvent n√©cessaire de d√©velopper une certaine partie de l'interface utilisateur dans un microservice, qui sera ensuite r√©utilis√©e dans un autre microservice. <br><br>  Et ici, des fragments nous aident aussi!  Puisque tout le fragment a besoin d'un √©l√©ment DOM pour le rendu, nous donnons √† tout microservice une API globale √† travers laquelle il peut placer n'importe quel fragment √† l'int√©rieur de son arborescence DOM.  Pour ce faire, passez simplement l'ID de fragment et le conteneur dans lequel il doit √™tre dessin√©.  Le reste se fera tout seul! <br>  Nous pouvons maintenant construire une ¬´poup√©e gigogne¬ª de n'importe quel niveau d'imbrication et r√©utiliser des pi√®ces enti√®res d'interface utilisateur sans avoir besoin de soutien √† plusieurs endroits. <br><br>  Il arrive souvent que sur une page il y ait plusieurs fragments qui devraient changer leur √©tat lors du changement de certaines donn√©es communes sur la page.  Pour ce faire, ils disposent d'un bus d'√©v√©nements global (NativeJS) √† travers lequel ils peuvent communiquer et r√©pondre aux changements. <br><br><img src="https://habrastorage.org/webt/yn/q7/g-/ynq7g-cvebke-ppttzyrawkfwsw.png" alt="image"><br><br><h3>  <font color="#173146">Services partag√©s</font> </h3><br>  Dans une architecture de microservices, des services centraux apparaissent in√©vitablement, des donn√©es dont tout le monde a besoin.  Par exemple, un service de localisation qui stocke les traductions.  Si chaque microservice commence individuellement √† monter pour ces donn√©es sur le serveur, nous obtenons juste un arbre de requ√™tes lors de l'initialisation. <br><br>  Pour r√©soudre ce probl√®me, nous avons d√©velopp√© des impl√©mentations de services NativeJS qui permettent d'acc√©der √† ces donn√©es.  Cela a permis de ne pas faire de requ√™tes et de donn√©es de cache inutiles.  Dans certains cas, m√™me de sortie de ces donn√©es sur une page en HTML √† l'avance pour se d√©barrasser compl√®tement des demandes. <br><br>  De plus, des wrappers ont √©t√© d√©velopp√©s sur nos services pour diff√©rents frameworks afin de rendre leur utilisation tr√®s naturelle (DI, interface fixe). <br><br><h2>  <font color="#173146">Avantages des microservices frontaux</font> </h2><br>  La chose la plus importante que nous obtenons de la division d'un monolithe en fragments est la possibilit√© de s√©lectionner des technologies pour chaque √©quipe individuellement et une gestion transparente des d√©pendances.  Mais aussi, cela donne: <br><br><ul><li>  domaines de responsabilit√© tr√®s clairement divis√©s; </li><li>  √©mission ind√©pendante: chaque fragment peut avoir son propre cycle de lib√©ration; </li><li>  augmenter la stabilit√© de la solution dans son ensemble, car l'√©mission de fragments individuels n'affecte pas les autres; </li><li>  la possibilit√© de restaurer facilement des fonctionnalit√©s, de les d√©ployer partiellement aupr√®s d'un public; </li><li>  le fragment est facilement plac√© dans la t√™te de chaque d√©veloppeur, ce qui conduit √† une r√©elle </li></ul>  interchangeabilit√© des membres de l'√©quipe;  en outre, chaque frontal peut mieux comprendre toutes les subtilit√©s de l'interaction avec le back-end correspondant. <br><br>  Une solution avec un frontal microseris semble bonne.  En effet, maintenant chaque fragment (microservice) peut d√©cider lui-m√™me comment d√©ployer: si vous avez juste besoin de nginx pour distribuer la statique, un middleware √† part enti√®re pour agr√©ger les demandes de sauvegarde ou de prise en charge des websockets, ou une autre sp√©cificit√© sous la forme d'un protocole de transfert de donn√©es binaires dans http.  De plus, les fragments peuvent choisir leurs propres m√©thodes d'assemblage, m√©thodes d'optimisation, etc. <br><br><h2>  <font color="#173146">Inconv√©nients des microservices frontaux</font> </h2><br>  Vous ne pouvez jamais vous passer d'une mouche dans la pommade. <br><br><ul><li>  L'interaction entre les fragments ne peut pas √™tre assur√©e par des m√©thodes de tubes standard (DI, par exemple). </li><li>  Que faire des d√©pendances partag√©es?  Apr√®s tout, la taille de l'application augmentera √† pas de g√©ant, si elles ne sont pas retir√©es des fragments. </li><li>  Quoi qu'il en soit, un seul devrait √™tre responsable de l'acheminement dans l'application finale. </li><li>  Que faire si l'un des fragments est inaccessible / ne peut pas √™tre dessin√©. </li><li>  On ne sait pas quoi faire du fait que diff√©rents microservices peuvent se trouver sur diff√©rents domaines. </li></ul><br><h2>  <font color="#173146">Conclusion</font> </h2><br>  Notre exp√©rience avec cette approche a prouv√© sa viabilit√©.  La vitesse de sortie des fonctions en production a consid√©rablement augment√©.  Le nombre de d√©pendances implicites entre les parties de l'interface a √©t√© r√©duit √† presque z√©ro.  Nous avons obtenu une interface utilisateur coh√©rente.  Vous pouvez tester des fonctionnalit√©s en toute s√©curit√© sans impliquer un grand nombre de personnes. <br><br>  Malheureusement, dans un article, il est tr√®s difficile de couvrir toute la gamme des probl√®mes et des solutions qui peuvent √™tre trouv√©s sur la fa√ßon de r√©p√©ter une telle architecture.  Mais pour nous, les avantages l'emportent clairement sur les inconv√©nients.  Si Habr s'int√©resse √† r√©v√©ler les d√©tails de la mise en ≈ìuvre de cette approche, nous √©crirons une suite! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420753/">https://habr.com/ru/post/fr420753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420735/index.html">Nous vous invitons √† la finale du marathon Find Yourself in Digital au bureau du groupe Mail.Ru</a></li>
<li><a href="../fr420737/index.html">Mini AI Cup 2 ou presque AgarIO - ce qui pourrait √™tre fait pour gagner</a></li>
<li><a href="../fr420739/index.html">La bo√Æte est toujours dans la poign√©e: pourquoi en 2018 vous devez encore apprendre les langues vous-m√™me</a></li>
<li><a href="../fr420741/index.html">Aide-m√©moire pour les programmeurs ou "nous allons google pour vous"</a></li>
<li><a href="../fr420749/index.html">GitLab pour le projet de livraison continue sur les technologies InterSystems: conteneurs</a></li>
<li><a href="../fr420757/index.html">Concours de programmation: commerce (r√©sultats)</a></li>
<li><a href="../fr420761/index.html">TypeScript 3.0</a></li>
<li><a href="../fr420763/index.html">KDD 2018, deuxi√®me jour, ateliers</a></li>
<li><a href="../fr420765/index.html">Impressions du PDA Gemini. R√©colteuse √† double amor√ßage de poche ou jouet inutile?</a></li>
<li><a href="../fr420767/index.html">Rostelecom exige que Sputnik soit d√©clar√©e en faillite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>