<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ ๐ท ูุตุงุฆุญ ูุญูู Kubernetes: ุชุฎุตูุต ุงูุนูุฏุฉ ูุชุญููู ุชุทุจูู ุงูููุจ ๐ท๐ผ ๐ต๐ป ๐ฉ๐พโ๐ซ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงุณุชูุฑุงุฑูุง ูููุงูุงุชูุง ุงูุนูููุฉ ุญูู ููููุฉ ุฌุนู ุงูุญูุงุฉ ุฃุณูู ูู ุงูุนูู ุงููููู ูุน Kubernetes ุ ูุชุญุฏุซ ุนู ูุตุชูู ูู ุนุงูู ุงูุชุดุบูู: ุชุฎุตูุต ุงูุนูุฏ ุงููุฑุฏูุฉ ูููุงู ูุญุฏุฏุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุตุงุฆุญ ูุญูู Kubernetes: ุชุฎุตูุต ุงูุนูุฏุฉ ูุชุญููู ุชุทุจูู ุงูููุจ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/432748/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/7r/gv/ix/7rgvixbeoe0vyfkw__obak6ow_y.jpeg"><br><br>  ุงุณุชูุฑุงุฑูุง ูููุงูุงุชูุง ุงูุนูููุฉ ุญูู ููููุฉ ุฌุนู ุงูุญูุงุฉ ุฃุณูู ูู ุงูุนูู ุงููููู ูุน Kubernetes ุ ูุชุญุฏุซ ุนู ูุตุชูู ูู ุนุงูู ุงูุชุดุบูู: ุชุฎุตูุต ุงูุนูุฏ ุงููุฑุฏูุฉ ูููุงู ูุญุฏุฏุฉ ูุชูููู php-fpm (ุฃู ุฎุงุฏู ุชุทุจููุงุช ุขุฎุฑ) ููุฃุญูุงู ุงูุซูููุฉ.  ููุง ูู ุงูุณุงุจู ุ ูุง ุชุฏุนู ุงูุญููู ุงูููุถุญุฉ ููุง ุฃููุง ูุซุงููุฉ ุ ูููููุง ุชูุฏู ูููุทุฉ ุงูุทูุงู ูุญุงูุงุชู ุงููุญุฏุฏุฉ ูุฃุณุงุณ ููุชูููุฑ.  ุงูุฃุณุฆูุฉ ูุงูุชุญุณููุงุช ูู ุงูุชุนูููุงุช ูู ููุถุน ุชุฑุญูุจ! <a name="habracut"></a><br><br><h2 style=";text-align:right;direction:rtl">  1. ุชุฎุตูุต ุงูุนูุฏ ุงููุฑุฏูุฉ ูููุงู ูุญุฏุฏุฉ </h2><br>  ูุญู ูุฑูุน ูุฌููุนุฉ Kubernetes ุนูู ุฎูุงุฏู ุงูุชุฑุงุถูุฉ ุฃู ุณุญุจ ุฃู ุฎูุงุฏู ูุนุฏููุฉ ุนุงุฑูุฉ.  ุฅุฐุง ููุช ุจุชุซุจูุช ุฌููุน ุจุฑุงูุฌ ุงููุธุงู ูุชุทุจููุงุช ุงูุนููู ุนูู ููุณ ุงูุนูุฏ ุ ููู ุงููุญุชูู ุฃู ุชูุงุฌู ูุดููุงุช: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุณูุจุฏุฃ ุชุทุจูู ุงูุนููู "ุจุงูุชุณุฑุจ" ูุฌุฃุฉ ูู ุงูุฐุงูุฑุฉ ุ ุนูู ุงูุฑุบู ูู ุฃู ุญุฏูุฏู ูุฑุชูุนุฉ ููุบุงูุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุงูุทูุจุงุช ุงููุนูุฏุฉ ููุฑุฉ ูุงุญุฏุฉ ุฅูู loghouse ุฃู Prometheus ุฃู Ingress * ุชุคุฏู ุฅูู OOM ุ ูุชูุฌุฉ ูุฐูู ูุนุงูู ุชุทุจูู ุงูุนููู ุ </li><li style=";text-align:right;direction:rtl">  ุชุณุฑุจ ููุฐุงูุฑุฉ ุจุณุจุจ ูุฌูุฏ ุฎูู ูู ุจุฑูุงูุฌ ุงููุธุงู ููุชู ุชุทุจูู ุงูุนููู ุ ุนูู ุงูุฑุบู ูู ุฃู ุงูููููุงุช ูุฏ ูุง ุชููู ูุชุตูุฉ ููุทููุง ูุน ุจุนุถูุง ุงูุจุนุถ. </li></ul><br>  <i>* ูู ุจูู ุฃุดูุงุก ุฃุฎุฑู ุ ูุงูุช ุฐุงุช ุตูุฉ ุจุงูุฅุตุฏุงุฑุงุช ุงูุฃูุฏู ูู Ingress ุ ุนูุฏูุง ุธูุฑุช ุนุฏุฏ "ุนูููุงุช ุชุนููู nginx" ูุธุฑูุง ููุนุฏุฏ ุงููุจูุฑ ูู ุงุชุตุงูุงุช websocket ูุนูููุงุช ุฅุนุงุฏุฉ ุงูุชุญููู ุงููุณุชูุฑุฉ ูู nginx ุ ูุงูุชู ุจูุบุช ุงูุขูุงู ูุงุณุชูููุช ูู ูุงุฆู ูู ุงูููุงุฑุฏ.</i> <br><br>  ุงูุญุงูุฉ ุงูุญููููุฉ ูู ูุน ุชุซุจูุช Prometheus ูุน ุนุฏุฏ ูุจูุฑ ูู ุงูููุงููุณ ุ ุญูุซ ุนูุฏ ุนุฑุถ ููุญุฉ ุงูููุงุฏุฉ "ุงูุซูููุฉ" ุ ุญูุซ ูุชู ุชูุฏูู ุนุฏุฏ ูุจูุฑ ูู ุญุงููุงุช ุงูุชุทุจููุงุช ุ ูู ูู ูููุง ูุชู ุฑุณู ุงูุฑุณูู ุงูุจูุงููุฉ ุ ุงุฑุชูุน ุงุณุชููุงู ุงูุฐุงูุฑุฉ ุจุณุฑุนุฉ ุฅูู ~ 15 ุบูุบุงุจุงูุช.  ูุชูุฌุฉู ูุฐูู ุ ูููู ูู "ูุงุชู OOM" ุฃู "ูุฃุชู" ุนูู ุงููุธุงู ุงููุถูู ููุจุฏุฃ ูู ูุชู ุงูุฎุฏูุงุช ุงูุฃุฎุฑู ุ ููุง ุฃุฏู ุจุฏูุฑู ุฅูู "ุณููู ุบูุฑ ููููู ููุชุทุจููุงุช ูู ุงููุฌููุนุฉ".  ูุจุณุจุจ ุชุญููู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุนุงููุฉ ุนูู ุชุทุจูู ุงูุนููู ุ ููู ุงูุณูู ุงูุญุตูู ุนูู ููุช ูุนุงูุฌุฉ ุงุณุชุนูุงู Ingress ุบูุฑ ูุณุชูุฑ ... <br><br>  ุงูุญู ุณุฑุนุงู ูุง ุฏูุน ููุณู: ูุงู ูู ุงูุถุฑูุฑู ุชุฎุตูุต ุฃุฌูุฒุฉ ูุฑุฏูุฉ ููููุงู ุงููุฎุชููุฉ.  ููุฏ ุญุฏุฏูุง 3 ุฃููุงุน ุฑุฆูุณูุฉ ูู ูุฌููุนุงุช ุงูููุงู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <b>ุงูุฌุจูุงุช</b> ุ ุญูุซ ูุถุน Ingresss ููุท ุ ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฎุฏูุงุช ุฃุฎุฑู ูููู ุฃู ุชุคุซุฑ ุนูู ููุช ูุนุงูุฌุฉ ุงูุทูุจุงุช ุ </li><li style=";text-align:right;direction:rtl">  <b>ุนูุฏ ุงููุธุงู</b> ุงูุชู ููุดุฑ ุนูููุง ุดุจูุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">VPN</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">loghouse</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Prometheus</a> ุ Dashboard ุ CoreDNS ุ ุฅูุฎ ุ </li><li style=";text-align:right;direction:rtl">  <b>ุนูุฏ ููุชุทุจููุงุช</b> - ูู ุงููุงูุน ุ ุญูุซ ูุชู ุทุฑุญ ุชุทุจููุงุช ุงูุนููู.  ูููู ุฃูุถูุง ุชุฎุตูุตูุง ููุจูุฆุงุช ุฃู ุงููุธุงุฆู: devุ prodุ perfุ ... </li></ol><br><h3 style=";text-align:right;direction:rtl">  ุงูุญู </h3><br>  ููู ูููุฐ ูุฐุงุ  ูู ุบุงูุฉ ุงูุจุณุงุทุฉ: ุงุซููู ูู ุขููุงุช Kubernetes ุงูุฃุตูู.  ุงูุฃูู ูู <b>nodeSelector</b> ูุชุญุฏูุฏ ุงูุนูุฏุฉ ุงููุทููุจุฉ ุญูุซ ูุฌุจ ุฃู ูุฐูุจ ุงูุชุทุจูู ุ ูุงูุฐู ูุนุชูุฏ ุนูู ุงูุชุณููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุจุชุฉ</a> ุนูู ูู ุนูุฏุฉ. <br><br>  ูู ูุฏููุง ุนูุฏุฉ <code>kube-system-1</code> .  ูุถูู ููุตููุง ุฅุถุงูููุง ุฅูููุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ kubectl label node kube-system-1 node-role/monitoring=</code> </pre> <br>  ... ููู <code>Deployment</code> ุ ุงูุฐู ูุฌุจ ุทุฑุญู ุนูู ูุฐู ุงูุนูุฏุฉ ุ ููุชุจ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">nodeSelector: node-role/monitoring: ""</code> </pre> <br>  ุงูุขููุฉ ุงูุซุงููุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>ุงูุฏูุงูุงุช ูุงูุชุณุงูุญ</b></a> .  ูู ุฎูุงู ูุณุงุนุฏุชูุง ุ ูุดูุฑ ุตุฑุงุญุฉ ุฅูู ุฃูู ูุง ูููู ุฅุทูุงู ุณูู ุงูุญุงููุงุช ุงูุชู ููุง ุชุฃุซูุฑ ุนูู ูุฐู ุงูุตูุฑุฉ ุนูู ูุฐู ุงูุฃุฌูุฒุฉ. <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ููุงู ุขูุฉ <code>kube-frontend-1</code> ูู ูููู ููุท ุจุชุฏููุฑ Ingress.  ุฅุถุงูุฉ ูููุซ ุฅูู ูุฐู ุงูุนูุฏุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ kubectl taint node kube-frontend-1 node-role/frontend=<span class="hljs-string"><span class="hljs-string">""</span></span>:NoExecute</code> </pre> <br>  ... ููู <code>Deployment</code> ูููู ุจุฅูุดุงุก ุงูุชุณุงูุญ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">tolerations: - effect: NoExecute key: node-role/frontend</code> </pre> <br>  ูู ุญุงูุฉ kops ุ ูููู ุฅูุดุงุก ูุฌููุนุงุช ูุซูู ูุฑุฏูุฉ ูููุณ ุงูุงุญุชูุงุฌุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ kops create ig --name cluster_name IG_NAME</code> </pre> <br>  ... ูุชุญุตู ุนูู ุดูุก ูุซู ุชููุฆุฉ ูุฌููุนุฉ ุงููุซููุงุช ูุฐู ูู kops: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: kops/v1alpha2 kind: InstanceGroup metadata: creationTimestamp: 2017-12-07T09:24:49Z labels: dedicated: monitoring kops.k8s.io/cluster: k-dev.k8s name: monitoring spec: image: kope.io/k8s-1.8-debian-jessie-amd64-hvm-ebs-2018-01-14 machineType: m4.4xlarge maxSize: 2 minSize: 2 nodeLabels: dedicated: monitoring role: Node subnets: - eu-central-1c taints: - dedicated=monitoring:NoSchedule</code> </pre> <br>  ูุจุงูุชุงูู ุ ุณุชุถูู ุงูุนูุฏ ูู ูุฌููุนุฉ ุงููุซููุงุช ูุฐู ุชููุงุฆููุง ุชุตููููุง ูุชูููููุง ุฅุถุงูููู. <br><br><h2 style=";text-align:right;direction:rtl">  2. ุชูููู php-fpm ููุฃุญูุงู ุงูุซูููุฉ </h2><br>  ููุงู ูุฌููุนุฉ ูุงุณุนุฉ ูู ุงูุฎูุงุฏู ุงููุณุชุฎุฏูุฉ ูุชุดุบูู ุชุทุจููุงุช ุงูููุจ: php-fpm ุ gunicorn ููุง ุดุงุจู ุฐูู.  ูุนูู ุงุณุชุฎุฏุงููุง ูู Kubernetes ุฃู ููุงู ุงูุนุฏูุฏ ูู ุงูุฃุดูุงุก ุงูุชู ูุฌุจ ุฃู ุชููุฑ ุจูุง ุฏุงุฆููุง: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู <b>ุงูุถุฑูุฑู</b> ุฃู ูููู ุชูุฑูุจูุง <b>ุนุฏุฏ ุงูุนูุงู ุงูุฐูู</b> ูุฑุบุจ ูู ุชุฎุตูุตูู ูู php-fpm ูู ูู ุญุงููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูููููุง ุชุฎุตูุต 10 ุนูุงู ููุนุงูุฌุฉ ุงูุทูุจุงุช ุงููุงุฑุฏุฉ ุ ูุชุฎุตูุต ููุงุฑุฏ ุฃูู ูููุฑุต ูุญุฌู ุจุงุณุชุฎุฏุงู ุนุฏุฏ ูู ุงููุฑูู - ููุฐู ููุงุฑุณุฉ ุฌูุฏุฉ.  ูุซุงู ุขุฎุฑ ูู ุชุฎุตูุต 500 ุนุงูู ููู ุฌุฑุงุจ ููุฏููู 2-3 ูุฑูู ูู ุงูุฅูุชุงุฌ ... ูููู ูุฐู ููุฑุฉ ุณูุฆุฉ ููุบุงูุฉ. </li><li style=";text-align:right;direction:rtl">  <b>ููุฒู ุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช ูููุฏุฑุฉ / ุงูุงุณุชุนุฏุงุฏ</b> ููุชุญูู ูู ุงูุชุดุบูู ุงูุตุญูุญ ููู ุฌุฑุงุจ ููู ุญุงูุฉ "ุชููู" ุงูุจูุฏ ุจุณุจุจ ูุดุงูู ูู ุงูุดุจูุฉ ุฃู ุจุณุจุจ ุงููุตูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุฏ ูููู ููุงู ุฃู ูู ุฎูุงุฑุงุชู ูุณุจุจู).  ูู ูุซู ูุฐู ุงูุญุงูุงุช ุ ุชุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ุฅูุดุงุก ุฌุฑุงุจ ูุดููุฉ. </li><li style=";text-align:right;direction:rtl">  ูู ุงูููู ุชุณุฌูู <b>ุงูุทูุจ</b> ุจุดูู ุตุฑูุญ <b>ูุงูุญุฏ ูู ุงูููุงุฑุฏ</b> ููู ุญุงููุฉ ุญุชู ูุง "ูุชุฏูู" ุงูุชุทุจูู ููุง ูุจุฏุฃ ูู ุฅูุญุงู ุงูุถุฑุฑ ุจุฌููุน ุงูุฎุฏูุงุช ุนูู ูุฐุง ุงูุฎุงุฏู. </li></ul><br><h3 style=";text-align:right;direction:rtl">  ุญููู </h3><br>  ูุณูุก ุงูุญุธ ุ <b>ูุง ุชูุฌุฏ ุฑุตุงุตุฉ ูุถูุฉ</b> ุชุณุงุนุฏู ุนูู ููู ุนุฏุฏ ุงูููุงุฑุฏ (CPU ุ RAM) ุงูุชู ูุฏ ูุญุชุงุฌูุง ุงูุชุทุจูู ุนูู ุงูููุฑ.  ูุชูุซู ุงูุฎูุงุฑ ุงููุญุชูู ูู ูุฑุงูุจุฉ ุงุณุชููุงู ุงูููุงุฑุฏ ูุชุญุฏูุฏ ุงูููู ุงููุซูู ูู ูู ูุฑุฉ.  ูุชุฌูุจ ูุชู OOM ุบูุฑ ุงููุจุฑุฑ ูุฎูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุ ููุง ูุคุซุฑ ุจุดูู ูุจูุฑ ุนูู ุงูุฎุฏูุฉ ุ ููููู ุชูุฏูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃุถู ุงุฎุชุจุงุฑุงุช ุงูุตูุงุจุฉ / ุงูุงุณุชุนุฏุงุฏ ุงูุตุญูุญุฉ ุญุชู ูููููุง ุฃู ูููู ุนูู ูุฌู ุงููููู ุฃู ูุฐู ุงูุญุงููุฉ ุชุนูู ุจุดูู ุตุญูุญ.  ุนูู ุงูุฃุฑุฌุญ ุ ุณุชููู ุตูุญุฉ ุฎุฏูุฉ ุชุชุญูู ูู ุชููุฑ ุฌููุน ุนูุงุตุฑ ุงูุจููุฉ ุงูุชุญุชูุฉ (ุงููุงุฒูุฉ ูุชุดุบูู ุงูุชุทุจูู ูู ุงูุญุงูุธุฉ) ูุชูุฑุฌุน ุฑูุฒ ุงุณุชุฌุงุจุฉ 200 ููุงูู ุ </li><li style=";text-align:right;direction:rtl">  ุญุฏุฏ ุนุฏุฏ ุงูุนูุงู ุงูุฐูู ุณูููููู ุจูุนุงูุฌุฉ ุงูุทูุจุงุช ุจุดูู ุตุญูุญ ุ ุซู ูู ุจุชูุฒูุนูุง ุจุดูู ุตุญูุญ. </li></ul><br>  ุนูู ุณุจูู ุงููุซุงู ุ ูุฏููุง 10 ูุฑูู ุชุชููู ูู ุญุงููุชูู: nginx (ูุฅุฑุณุงู ุงูุฅุญุตุงุฆูุงุช ูุทูุจุงุช ุงููููู ุฅูู ุงููุงุฌูุฉ ุงูุฎูููุฉ) ู php-fpm (ูู ุงููุงูุน ุงููุงุฌูุฉ ุงูุฎูููุฉ ุ ุงูุชู ุชุนุงูุฌ ุงูุตูุญุงุช ุงูุฏููุงููููุฉ).  ุชู ุชูููู ุชุฌูุน php-fpm ูุนุฏุฏ ุซุงุจุช ูู ุงูุนูุงู (10).  ูุจุงูุชุงูู ุ ูู ูุญุฏุฉ ุฒูููุฉ ุ ูููููุง ูุนุงูุฌุฉ 100 ุทูุจ ูุดุท ูููุงุฌูุงุช ุงูุฎูููุฉ.  ุฏุน ูู ุทูุจ ุชุชู ูุนุงูุฌุชู ุจูุงุณุทุฉ PHP ุฎูุงู ุซุงููุฉ ูุงุญุฏุฉ. <br><br>  ูุงุฐุง ูุญุฏุซ ุฅุฐุง ูุตู ุทูุจ ุขุฎุฑ ุฅูู ุฌุฑุงุจ ูุงุญุฏ ูุญุฏุฏ ุ ุญูุซ ุชุชู ุงูุขู ูุนุงูุฌุฉ 10 ุทูุจุงุช ุจุดูู ูุดุท ุงูุขูุ  ูู ูุชููู PHP ูู ูุนุงูุฌุชู ูุณูููู Ingress ุจุฅุฑุณุงูู ูุฅุนุงุฏุฉ ุงููุญุงููุฉ ุฅูู pod ุงูุชุงูู ุฅุฐุง ูุงู ุทูุจ GET.  ุฅุฐุง ูุงู ููุงู ุทูุจ POST ุ ูุณูุชู ุฅุฑุฌุงุน ุฎุทุฃ. <br><br>  ูุฅุฐุง ุฃุฎุฐูุง ูู ุงูุงุนุชุจุงุฑ ุฃูู ุฃุซูุงุก ูุนุงูุฌุฉ ุฌููุน ุงูุทูุจุงุช ุงูุนุดุฑุฉ ุ ุณูู ูุชููู ุดูููุง ูู kubelet (ูุณุจุงุฑ ุงูุซุจุงุช) ุ ุณููุชูู ูุฐุง ุงูุฎุทุฃ ูุณูุจุฏุฃ Kubernetes ูู ุงูุงุนุชูุงุฏ ุจุฃู ููุงู ุฎุทุฃ ูุง ูู ูุฐู ุงูุญุงููุฉ ูููุชููุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ุณุชูุชูู ุฌููุน ุงูุทูุจุงุช ุงูุชู ุชูุช ูุนุงูุฌุชูุง ูู ุงูููุช ุงูุญุงูู ุจุฎุทุฃ (!) ููู ููุช ุฅุนุงุฏุฉ ุชุดุบูู ุงูุญุงููุฉ ุ ุณููุชูู ุฑุตูุฏูุง ุ ููุง ูุณุชูุฒู ุฒูุงุฏุฉ ูู ุทูุจุงุช ุฌููุน ุงูุฅุตุฏุงุฑุงุช ุงูุฎูููุฉ ุงูุฃุฎุฑู. <br><br><h4 style=";text-align:right;direction:rtl">  ุจูุถูุญ </h4><br>  ูููุชุฑุถ ุฃู ูุฏููุง 2 ุญุงุถูุงุช ุชุญุชูู ูู ูููุง ุนูู 10 ูู ุนูุงู php-fpm.  ูููุง ููู ุฑุณู ุจูุงูู ูุนุฑุถ ุงููุนูููุงุช ุฃุซูุงุก "ููุช ุงูุชููู" ุ ุฃู  ุนูุฏูุง ูููู ุงูุดุฎุต ุงููุญูุฏ ุงูุฐู ูุทูุจ php-fpm ูู ูุตุฏุฑ php-fpm (ูุฏููุง ุนุงูู ูุดุท ููู ูุงุญุฏ): <br><br><img src="https://habrastorage.org/webt/zo/hw/ea/zohwea7nsfbofpgvhixp7edc-qk.png"><br><br>  ุงูุขู ุจุฏุก ุงูุชูููุฏ ูุน ุงูุชุฒุงูู 19: <br><br><img src="https://habrastorage.org/webt/my/ba/hp/mybahpcgbfoqzzazbwtzu9dc46a.png"><br><br>  ุงูุขู ุฏุนููุง ูุญุงูู ุฌุนู ุงูุชุฒุงูู ุฃุนูู ููุง ูููููุง ุงูุชุนุงูู ูุนู (20) ... ุฏุนูุง ูููู 23. ุซู ุฌููุน ูุดุบูู php-fpm ูุดุบูููู ุจูุนุงูุฌุฉ ุทูุจุงุช ุงูุนููู: <br><br><img src="https://habrastorage.org/webt/tq/v6/f1/tqv6f1fopruyz8_zittdan1pkho.png"><br><br>  ูู ูุนุฏ Vorkers ูุงูููุง ููุนุงูุฌุฉ ุนููุฉ ุญูููุฉ ุ ูุฐูู ูุฑู ูุฐู ุงูุตูุฑุฉ ูู ููุญุฉ ูุนูููุงุช Kubernetes (ุฃู <code>describe pod</code> ): <br><br><img src="https://habrastorage.org/webt/7z/qo/fw/7zqofwlbjcmxl0qkz2g2rkerece.png"><br><br>  ุงูุขู ุ ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุฃุญุฏ ุงูุจุฑุงูุฌ ุ <b>ูุญุฏุซ ุชุฃุซูุฑ ุงูุงูููุงุฑ</b> : ุชุจุฏุฃ ุงูุทูุจุงุช ูู ุงูุณููุท ุนูู ุงูุฌุฑุงุจ ุงูุซุงูู ุ ููู ุฃูุถูุง ุบูุฑ ูุงุฏุฑ ุนูู ูุนุงูุฌุชูุง ุ ูุธุฑูุง ูุฃููุง ูุชููู ุนุฏุฏูุง ูุจูุฑูุง ูู ุงูุฃุฎุทุงุก ูู ุงูุนููุงุก.  ุจุนุฏ ุงูุชูุงุก ุฃุญูุงุถ ุฌููุน ุงูุญุงููุงุช ุ ูุตุจุญ ุฑูุน ุงูุฎุฏูุฉ ูุดููุฉ - ููุฐุง ูููู ููุท ูู ุฎูุงู ุงูุฒูุงุฏุฉ ุงูุญุงุฏุฉ ูู ุนุฏุฏ ุงููุฑูู ุฃู ุงูุนูุงู. <br><br><h4 style=";text-align:right;direction:rtl">  ุงูุฎูุงุฑ ุงูุฃูู </h4><br>  ูู ุญุงููุฉ ุจูุง PHP ุ ููููู ุชูููู ุจุฑูุชู โโfpm: ูุงุญุฏุฉ ููุนุงูุฌุฉ ุทูุจุงุช ุงูุนููู ุ ูุงูุขุฎุฑ ููุชุญูู ูู "ูุงุจููุฉ ุจูุงุก" ุงูุญุงููุฉ.  ุซู ูู ุญุงููุฉ nginx ุ ุณุชุญุชุงุฌ ุฅูู ุชูููู ููุงุซู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> upstream backend { server 127.0.0.1:9000 max_fails=0; } upstream backend-status { server 127.0.0.1:9001 max_fails=0; }</code> </pre> <br>  ูู ูุง ุชุจูู ูู ุฅุฑุณุงู ุนููุฉ ุญูููุฉ ูููุนุงูุฌุฉ ุฅูู ุงูููุจุน ุชุณูู <code>backend-status</code> . <br><br>  ุงูุขู ูุจุนุฏ ุฅุฌุฑุงุก ุงุฎุชุจุงุฑ liveness ุจุดูู ูููุตู ุ ุณุชุธู ุงูุฃุฎุทุงุก ุชุญุฏุซ ูู ุจุนุถ ุงูุนููุงุก ุ ูููู ุนูู ุงูุฃูู ูุง ุชูุฌุฏ ูุดููุงุช ูุฑุชุจุทุฉ ุจุฅุนุงุฏุฉ ุชุดุบูู pod ููุตู ุจููุฉ ุงูุนููุงุก.  ูุจุงูุชุงูู ุ ุณูููู ุจุชูููู ุนุฏุฏ ุงูุฃุฎุทุงุก ุฅูู ุญุฏ ูุจูุฑ ุ ุญุชู ูู ูู ุชุณุชุทุน ุนูููุงุชูุง ุงูุฎูููุฉ ููุงุฌูุฉ ุงูุญูู ุงูุญุงูู. <br><br>  ูู ุงููุคูุฏ ุฃู ูุฐุง ุงูุฎูุงุฑ ุฃูุถู ูู ูุง ุดูุก ุ ูููู ุณูุฆ ุฃูุถูุง ูุฃูู ูููู ุฃู ูุญุฏุซ ุดูุก ูู ุงููุฌููุนุฉ ุงูุฑุฆูุณูุฉ ุ ูุงูุชู ูู ูุชุนุฑู ุนูู ุงุณุชุฎุฏุงู ุงุฎุชุจุงุฑ ุงูุซุจุงุช. <br><br><h4 style=";text-align:right;direction:rtl">  ุงูุฎูุงุฑ ุงูุซุงูู </h4><br>  ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู ูุญุฏุฉ nginx ุบูุฑ ุงูุดุงุฆุนุฉ ุฌุฏูุง ูุงูุชู ุชุณูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">nginx-limit-upstream</a> .  ุซู ูู PHP ุณูุญุฏุฏ 11 ุนุงููุงู ุ ููู ุงูุญุงููุฉ ูุน nginx ุณูููู ุจุนูู ุชููุฆุฉ ููุงุซูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> limit_upstream_zone limit 32m; upstream backend { server 127.0.0.1:9000 max_fails=0; limit_upstream_conn limit=10 zone=limit backlog=10 timeout=5s; } upstream backend-status { server 127.0.0.1:9000 max_fails=0; }</code> </pre> <br>  ุนูู ูุณุชูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุ ุณูุญุฏุฏ nginx ุนุฏุฏ ุงูุทูุจุงุช ุงูุชู ุณูุชู ุฅุฑุณุงููุง ุฅูู ุงููุงุฌูุฉ ุงูุฎูููุฉ (10).  ููุงู ููุทุฉ ูููุฉ ุชุชูุซู ูู ุฅูุดุงุก ุชุฑุงูู ุฎุงุต: ุฅุฐุง ูุงู ุงูุทูุจ ุงูุญุงุฏู ุนุดุฑ ูู nginx ูุฃุชู ูู ุงูุนููู ุ ูุฑุฃู nginx ุฃู ุชุฌูุน php-fpm ูุดุบูู ุ ูุณูุชู ูุถุน ูุฐุง ุงูุทูุจ ูู backlog ููุฏุฉ 5 ุซูุงูู.  ุฅุฐุง ูู ูุชู ุชุญุฑูุฑ php-fpm ุ ุฎูุงู ูุฐุง ุงูููุช ุ ุนูุฏูุง ููุท ุณูุชู ุชุดุบูู Ingress ุ ููุง ุณูุคุฏู ุฅูู ุฅุนุงุฏุฉ ูุญุงููุฉ ุงูุทูุจ ุฅูู ุฌุฑุงุจ ุขุฎุฑ.  ูุฐุง ููุนู ุงูุตูุฑุฉ ุ ุญูุซ ุณูููู ูุฏููุง ุฏุงุฆููุง ุนุงูู PHP ูุงุญุฏ ูุฌุงูู ููุนุงูุฌุฉ ูููุฐุฌ ุงููุงุนููุฉ - ูููููุง ุชุฌูุจ ุชุฃุซูุฑ ุงูุงูููุงุฑ. <br><br><h4 style=";text-align:right;direction:rtl">  ุฃููุงุฑ ุฃุฎุฑู </h4><br>  ููุญุตูู ุนูู ุฎูุงุฑุงุช ุฃูุซุฑ ุชููุนูุง ูุฌูุงููุง ูุญู ูุฐู ุงููุดููุฉ ุ ูุฌุฏุฑ ุงูุจุญุซ ูู ุงุชุฌุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Envoy</a> ููุธุงุฆุฑูุง. <br><br>  ุจุดูู ุนุงู ุ ูู ุฃุฌู ุฃู ูููู ูุฏู Prometheus ุชูุธูู ูุงุถุญ ููุนูุงู ุ ููุง ุณูุณุงุนุฏ ุจุฏูุฑู ูู ุฅูุฌุงุฏ ุงููุดููุฉ ุจุณุฑุนุฉ (ูุงูุฅุจูุงุบ ุนููุง) ุ ุฃูุตู ุจุดุฏุฉ ุจุชุฒููุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุตุฏุฑูู</a> ุงูุฌุงูุฒูู ูุชุญููู ุงูุจูุงูุงุช ูู ุงูุจุฑูุงูุฌ ุฅูู ุชูุณูู Prometheus. <br><br><h2 style=";text-align:right;direction:rtl">  PS </h2><br>  ุจุฎูุงู ุฏูุฑุฉ ูุตุงุฆุญ ูุญูู K8s: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุตูุญุงุช ุฎุทุฃ ูุฎุตุตุฉ ูู NGINX Ingress</a> "ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููู ุงูููุงุฑุฏ ุงูุนุงููุฉ ูู ูุฌููุนุฉ ูุฅุฏุงุฑุฉ ูููู 2</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุตูู ุฅูู ููุงูุน ุฏูู</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุณุฑูุน ุงูุชูููุฏ ูููุงุนุฏ ุงูุจูุงูุงุช ุงููุจูุฑุฉ.</a> " </li></ul><br>  ุงูุฑุฃ ุฃูุถูุง ูู ูุฏููุชูุง: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฏู ุชููุฑ ุนุงููุฉ ูู Kubernetes</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุฑุงูุจุฉ ู Kubernetes</a> " <i>(ุชูุฑูุฑ ุงููุฑุงุฌุนุฉ ูุงูููุฏูู)</i> ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฌุฑุจุชูุง ูุน Kubernetes ูู ุงููุดุงุฑูุน ุงูุตุบูุฑุฉ</a> " <i>(ุชูุฑูุฑ ููุฏูู ุ ูุงูุฐู ูุชุถูู ููุฏูุฉ ููุฌูุงุฒ ุงูููู Kubernetes)</i> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar432748/">https://habr.com/ru/post/ar432748/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar432736/index.html">ุงุฎุชุจุงุฑ Devops ู JUnit5 ู microservice: ูุธุฑุฉ ุฐุงุชูุฉ ุนูู Heisenbag ูู ููุณูู</a></li>
<li><a href="../ar432740/index.html">"CMS" ุงุณุชูุงุฏูุง ุฅูู ุฌุฏุงูู ุจูุงูุงุช Google ููููุงูุน ุงูุซุงุจุชุฉ</a></li>
<li><a href="../ar432742/index.html">ุถุบุท ููุช ุงูุดุฑูุงุช</a></li>
<li><a href="../ar432744/index.html">DWDM: ุงูุญู ุฃุฑุฎุต ูู ุงููุงูู ุจูุณุจุฉ 30-50ูช (ูุฆุฉ ุงููุคุณุณุงุช)</a></li>
<li><a href="../ar432746/index.html">ููุฏุฉ ุซูุงุซุฉ ุฃูุงู ูู ุงูุนูุงูุฉ ุงููุฑูุฒุฉ ุฃู ูุง ูู ุงูุฎุทุฃ ูู ูุณู ุงูุชูุงุฒู ุจูู ุงูุนูู ูุงูุญูุงุฉ ุนูู Mobius'18ุ</a></li>
<li><a href="../ar432750/index.html">ูุฑุญุฉ Haxe. ุฑูุงูุฉ ูุน ูุบุฉ ุงูุจุฑูุฌุฉ ุงูููููุฉ</a></li>
<li><a href="../ar432752/index.html">ุชู ุงูููู ุฃู ุงูููุนุฉุ ุฃููู ุจุจูุงุก ููุฒู ุจุณุนุฑ ุดูุฉ. 3 ุฌุฒุก. ุงูุฏุงุฏุงุช ุงูุทุงูุฉ</a></li>
<li><a href="../ar432754/index.html">ุชุฎุฒูู ุงูุจูุงูุงุช ูู ุงูุฐุงูุฑุฉ ู ุนูู ุงููุฑุต ุณูู ูุฌูุจ ููุฌูููุฑ</a></li>
<li><a href="../ar432756/index.html">ูุญู ูููุฐ ุฏุนู ุฅููุงููุฉ ุงููุตูู ุฏูู ุชุบููุฑ ุงููููู ุงููุฑุฆู ูุชุทุจูู ุงููุงุชู ุงููุญููู</a></li>
<li><a href="../ar432760/index.html">ูุงููุงุช ูุฌูุงุช ุงููุธุฑ ุงูููุชุฌ ุ ุฃู ุงุณุชุฎุฏุงู ุขุฎุฑ ูุทุฑุงุฒ Word2Vec</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>