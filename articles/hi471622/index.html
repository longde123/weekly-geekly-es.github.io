<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯО┐ ЁЯдЬ ЁЯОж Xamarin.Forms - рдореЗрдЬрдмрд╛рди-рдЖрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдб рдЕрдиреБрдХрд░рдг рдХрд╛ рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг ЁЯРн ЁЯСзЁЯП╛ ЁЯЪС</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рддрдерд╛рдХрдерд┐рдд рд╣реЛрд╕реНрдЯ-рдЖрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдб рдЗрдореНрдпреВрд▓реЗрд╢рди (HCE, рдмреИрдВрдХ рдХрд╛рд░реНрдб рдПрдореБрд▓реЗрд╢рди рдСрди рдж рдлреЛрди) рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдВрдЧреЗред рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг рд╣реИ, рдпрд╣рд╛рдВ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Xamarin.Forms - рдореЗрдЬрдмрд╛рди-рдЖрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдб рдЕрдиреБрдХрд░рдг рдХрд╛ рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471622/"> рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рддрдерд╛рдХрдерд┐рдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реЛрд╕реНрдЯ-рдЖрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдб рдЗрдореНрдпреВрд▓реЗрд╢рди</a> (HCE, рдмреИрдВрдХ рдХрд╛рд░реНрдб рдПрдореБрд▓реЗрд╢рди рдСрди рдж рдлреЛрди) рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдВрдЧреЗред  рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг рд╣реИ, рдпрд╣рд╛рдВ рдореИрдВрдиреЗ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдореБрд▓реЗрдЯрд░ рдФрд░ рд░реАрдбрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдХрдИ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд┐рдпрд╛ред  рд╣рд╛рдВ, рдЖрдкрдХреЛ nfc рдХреЗ рд╕рд╛рде 2 рдЙрдкрдХрд░рдгреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред <br><br>  рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЙрдкрдпреЛрдЧ рдкрд░рд┐рджреГрд╢реНрдп рд╣реИрдВ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд╛рд╕ рд╕рд┐рд╕реНрдЯрдо</a> , рд▓реЙрдпрд▓реНрдЯреА рдХрд╛рд░реНрдб, рдЯреНрд░рд╛рдВрд╕рдкреЛрд░реНрдЯ рдХрд╛рд░реНрдб, рд╕рдВрдЧреНрд░рд╣рд╛рд▓рдп рдореЗрдВ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд╛рд╕рд╡рд░реНрдб рдореИрдиреЗрдЬрд░</a> ред <br><br>  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдХрд╛рд░реНрдб рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдлреЛрди рдкрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдиреНрдЪ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ рдФрд░ рдЖрдкрдХреЗ рдлреЛрди рдХреА рд╕реНрдХреНрд░реАрди рд▓реЙрдХ рд╣реЛ рд╕рдХрддреА рд╣реИред <br><a name="habracut"></a><br>  рдЬрд╝рдорд╛рд░рд┐рди рдПрдВрдбреНрд░реЙрдЗрдб рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд╛рд░реНрдб рдПрдореБрд▓реЗрдЯрд░</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░реАрдбрд░ рдХреЗ</a> рддреИрдпрд╛рд░ рдЙрджрд╛рд╣рд░рдг рд╣реИрдВред <br>  рдЖрдЗрдП рдЗрди рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ 2 Xamarin Forms рдПрдкреНрд▓рд┐рдХреЗрд╢рди, рдПрдХ рдПрдореБрд▓реЗрдЯрд░ рдФрд░ рд░реАрдбрд░ рдмрдирд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ, рдФрд░ рдЙрдирдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░реЗрдВ: <br><br><ol><li>  рд░реАрдбрд░ рд╕реНрдХреНрд░реАрди рдкрд░ рдПрдореБрд▓реЗрдЯрд░ рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ </li><li>  рдПрдореБрд▓реЗрдЯрд░ рд╕реНрдХреНрд░реАрди рдкрд░ рд░реАрдбрд░ рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ </li><li>  рдПрдореБрд▓реЗрдЯрд░ рдХреЛ рдЕрдкреНрд░рдмрдВрдзрд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдФрд░ рд▓реЙрдХ рд╕реНрдХреНрд░реАрди рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП </li><li>  рдПрдореБрд▓реЗрдЯрд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдВ </li><li>  рдПрдХ рдкрд╛рдардХ рдХрд╛ рдкрддрд╛ рдЪрд▓рдиреЗ рдкрд░ рдПрдореБрд▓реЗрдЯрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдиреНрдЪ рдХрд░реЗрдВ </li><li>  nfc рдПрдбреЗрдкреНрдЯрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛ рдФрд░ nfc рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдирд╛ </li></ol><br>  рдпрд╣ рд▓реЗрдЦ рдПрдВрдбреНрд░реЙрдЗрдб рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЖрдИрдУрдПрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрд╡реЗрджрди рднреА рд╣реИ, рддреЛ рдПрдХ рдЕрд▓рдЧ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рд╕рд┐рджреНрдзрд╛рдВрдд рдХреА рдиреНрдпреВрдирддрдоред <br><br>  рдЬреИрд╕рд╛ рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдВрдбреНрд░реЙрдЗрдб рдбреЙрдХреНрдпреВрдореЗрдВрдЯ</a> рдореЗрдВ рд▓рд┐рдЦрд╛ рд╣реИ, рд╕рдВрд╕реНрдХрд░рдг 4.4 (рдХрд┐рдЯрдХреИрдЯ) рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░, рдЖрдИрдПрд╕рдУ-рдбреАрдИрдкреА рдХрд╛рд░реНрдб рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдФрд░ APDU рдХрдорд╛рдВрдб рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИред <br><br>  рдХрд╛рд░реНрдб рдПрдореБрд▓реЗрд╢рди "рдПрдЪрд╕реАрдИ рд╕реЗрд╡рд╛рдУрдВ" рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдиреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдПрдВрдбреНрд░реЙрдЗрдб рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред <br><br>  рдЬрдм рдХреЛрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдПрдирдПрдлрд╕реА рд░реАрдбрд░ рд╕реЗ рдЬреЛрдбрд╝рддрд╛ рд╣реИ, рддреЛ рдПрдВрдбреНрд░реЙрдЗрдб рдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдХрд┐ рдкрд╛рдардХ рдХрд┐рд╕ рдПрдЪрд╕реАрдИ рд╕реЗрд╡рд╛ рд╕реЗ рдЬреБрдбрд╝рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИред  рдЖрдИрдПрд╕рдУ / рдЖрдИрдИрд╕реА 7816-4 рдПрдкреНрд▓реАрдХреЗрд╢рди рдЖрдИрдбреА (рдПрдЖрдИрдбреА) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рдЖрд╡реЗрджрди рдЪрдпрди рд╡рд┐рдзрд┐ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИред <br><br>  рдпрджрд┐ рдмрд╛рдЗрдЯ рд╕рд░рдгрд┐рдпреЛрдВ рдХреА рд╕реБрдВрджрд░ рджреБрдирд┐рдпрд╛ рдореЗрдВ рддрд▓реНрд▓реАрди рдХрд░рдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ, рддреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> APDU рдЖрджреЗрд╢реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рд╣реИред  рдпрд╣ рдЖрд▓реЗрдЦ рдбреЗрдЯрд╛ рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЖрджреЗрд╢реЛрдВ рдХреЗ рдХреЗрд╡рд▓ рдПрдХ рдЬреЛрдбрд╝реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред <br><br><h3>  рдкрд╛рдардХ рдЖрд╡реЗрджрди </h3><br>  рдкрд╛рдардХ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐  рдпрд╣ рд╕рд░рд▓ рд╣реИред <br><br>  рд╣рдо "рдореЛрдмрд╛рдЗрд▓ рдРрдк (Xamarin.Forms)" рдЬреИрд╕реЗ рд╡рд┐рдЬрд╝реБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдореЗрдВ рдПрдХ рдирдИ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛рддреЗ рд╣реИрдВ, рдлрд┐рд░ "рдмреНрд▓реИрдВрдХ" рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ "рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо" рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдХреЗрд╡рд▓ "рдПрдВрдбреНрд░реЙрдЗрдб" рдЪреЗрдХрдорд╛рд░реНрдХ рдЫреЛрдбрд╝ рджреЗрдВред <br><br>  Android рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдп рдХрд░рдиреЗ рд╣реЛрдВрдЧреЗ: <br><br><ul><li>  CardReader рд╡рд░реНрдЧ - рдЗрд╕рдореЗрдВ рдХрдИ рд╕реНрдерд┐рд░рд╛рдВрдХ рдФрд░ OnTagDiscovered рд╡рд┐рдзрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИ </li><li>  MainActivity - рдЖрд╡реЗрджрди рдХреЛ рдЫреЛрдЯрд╛ рдХрд░рддреЗ рд╕рдордп рд░реАрдбрд░ рдХреЛ рдЪрд╛рд▓реВ / рдмрдВрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП CardReader рд╡рд░реНрдЧ, рд╕рд╛рде рд╣реА OnPause рдФрд░ OnResume рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЖрд░рдВрднреАрдХрд░рдгред </li><li>  AndroidManifest.xml - nfc рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпрд╛рдВ </li></ul><br>  рдФрд░ App.xaml.cs рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреНрд░реЙрд╕-рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ: <br><br><ul><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреА рд╡рд┐рдзрд┐ </li></ul><br><h4>  рдХрд╛рд░реНрдбрд┐рдпрд░ рдХреНрд▓рд╛рд╕ </h4><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.Nfc; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.Nfc.Tech; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ApduServiceReaderApp.Droid.Services</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CardReader</span></span> : <span class="hljs-title"><span class="hljs-title">Java</span></span>.<span class="hljs-title"><span class="hljs-title">Lang</span></span>.<span class="hljs-title"><span class="hljs-title">Object</span></span>, <span class="hljs-title"><span class="hljs-title">NfcAdapter</span></span>.<span class="hljs-title"><span class="hljs-title">IReaderCallback</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ISO-DEP command HEADER for selecting an AID. // Format: [Class | Instruction | Parameter 1 | Parameter 2] private static readonly byte[] SELECT_APDU_HEADER = new byte[] { 0x00, 0xA4, 0x04, 0x00 }; // AID for our loyalty card service. private static readonly string SAMPLE_LOYALTY_CARD_AID = "F123456789"; // "OK" status word sent in response to SELECT AID command (0x9000) private static readonly byte[] SELECT_OK_SW = new byte[] { 0x90, 0x00 }; public async void OnTagDiscovered(Tag tag) { IsoDep isoDep = IsoDep.Get(tag); if (isoDep != null) { try { isoDep.Connect(); var aidLength = (byte)(SAMPLE_LOYALTY_CARD_AID.Length / 2); var aidBytes = StringToByteArray(SAMPLE_LOYALTY_CARD_AID); var command = SELECT_APDU_HEADER .Concat(new byte[] { aidLength }) .Concat(aidBytes) .ToArray(); var result = isoDep.Transceive(command); var resultLength = result.Length; byte[] statusWord = { result[resultLength - 2], result[resultLength - 1] }; var payload = new byte[resultLength - 2]; Array.Copy(result, payload, resultLength - 2); var arrayEquals = SELECT_OK_SW.Length == statusWord.Length; if (Enumerable.SequenceEqual(SELECT_OK_SW, statusWord)) { var msg = Encoding.UTF8.GetString(payload); await App.DisplayAlertAsync(msg); } } catch (Exception e) { await App.DisplayAlertAsync("Error communicating with card: " + e.Message); } } } public static byte[] StringToByteArray(string hex) =&gt; Enumerable.Range(0, hex.Length) .Where(x =&gt; x % 2 == 0) .Select(x =&gt; Convert.ToByte(hex.Substring(x, 2), 16)) .ToArray(); } }</span></span></code> </pre> <br>  Nfc рдПрдбреЗрдкреНрдЯрд░ рдХреЗ рд░реАрдб рдореЛрдб рдореЗрдВ, рдЬрдм рдХрд╛рд░реНрдб рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ OnTagDiscovered рдореЗрдердб рдХрд╣рд╛ рдЬрд╛рдПрдЧрд╛ред  рдЗрд╕рдореЗрдВ, IsoDep рдПрдХ рдРрд╕рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рд╣рдо рдореИрдк рдХреЗ рд╕рд╛рде рдХрдорд╛рдВрдб рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдХрд░реЗрдВрдЧреЗ (isoDep.Transceive (рдХрдорд╛рдВрдб))ред  рдХрдорд╛рдВрдб рдмрд╛рдЗрдЯ рд╕рд░рдгрд┐рдпрд╛рдБ рд╣реИрдВред <br><br>  рдХреЛрдб рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдПрдореБрд▓реЗрдЯрд░ рдХреЛ рдПрдХ рдЕрдиреБрдХреНрд░рдо рднреЗрдЬрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ SELECT_APDU_HEADER рд╣реЗрдбрд░, рдмрд╛рдЗрдЯреНрд╕ рдореЗрдВ рд╣рдорд╛рд░реЗ AID рдХреА рд▓рдВрдмрд╛рдИ рдФрд░ рд╕реНрд╡рдпрдВ AID рд╢рд╛рдорд┐рд▓ рд╣реИ: <br><br><pre> <code class="plaintext hljs">0 164 4 0 // SELECT_APDU_HEADER 5 //  AID   241 35 69 103 137 // SAMPLE_LOYALTY_CARD_AID (F1 23 45 67 89)</code> </pre><br><h4>  MainActivity Reader </h4><br>  рдпрд╣рд╛рдБ рдЖрдкрдХреЛ рдкрд╛рдардХ рдХреНрд╖реЗрддреНрд░ рдШреЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CardReader cardReader;</code> </pre><br>  рдФрд░ рджреЛ рд╕рд╣рд╛рдпрдХ рддрд░реАрдХреЗ: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EnableReaderMode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nfc = NfcAdapter.GetDefaultAdapter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nfc != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) nfc.EnableReaderMode(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, cardReader, READER_FLAGS, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DisableReaderMode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nfc = NfcAdapter.GetDefaultAdapter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nfc != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) nfc.DisableReaderMode(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre><br>  рдСрдирдХреНрд░рд┐рдПрдЯ () рд╡рд┐рдзрд┐ рдореЗрдВ, рдкрд╛рдардХ рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░реЗрдВ рдФрд░ рд░реАрдб рдореЛрдб рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCreate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bundle savedInstanceState</span></span></span><span class="hljs-function">)</span></span> { ... cardReader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CardReader(); EnableReaderMode(); LoadApplication(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> App()); }</code> </pre><br>  рдФрд░, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЫреЛрдЯрд╛ / рдЦреЛрд▓рддреЗ рд╕рдордп рд░реАрдбрд┐рдВрдЧ рдореЛрдб рдХреЛ рд╕рдХреНрд╖рдо / рдЕрдХреНрд╖рдо рдХрд░реЗрдВ: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPause</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnPause(); DisableReaderMode(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnResume</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnResume(); EnableReaderMode(); }</code> </pre><br><h4>  App.xaml.cs </h4><br>  рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдереИрддрд┐рдХ рд╡рд┐рдзрд┐: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DisplayAlertAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> msg</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Device.InvokeOnMainThreadAsync(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Current.MainPage.DisplayAlert(<span class="hljs-string"><span class="hljs-string">"message from service"</span></span>, msg, <span class="hljs-string"><span class="hljs-string">"ok"</span></span>));</code> </pre><br><h4>  AndroidManifest.xml </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Android рдкреНрд░рд▓реЗрдЦрди</a> рдХрд╣рддрд╛ рд╣реИ рдХрд┐ рдЕрдкрдиреЗ рдЖрд╡реЗрджрди рдореЗрдВ nfc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░реЗрдВ, рдЖрдкрдХреЛ AndroidManifest.xml рдореЗрдВ рдЗрди рддрддреНрд╡реЛрдВ рдХреЛ рдШреЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.NFC"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-sdk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">/&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-sdk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"14"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-feature</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.hardware.nfc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  рдЙрд╕реА рд╕рдордп, рдпрджрд┐ рдЖрдкрдХрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди nfc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдЖрд╡рд╢реНрдпрдХ рдлрд╝рдВрдХреНрд╢рди рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдЙрдкрдпреЛрдЧ-рд╕реБрд╡рд┐рдзрд╛ рддрддреНрд╡ рдХреЛ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдСрдкрд░реЗрд╢рди рдХреЗ рджреМрд░рд╛рди nfc рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдкрд╛рдардХ рдХреЗ рд▓рд┐рдП рдмрд╕ рдЗрддрдирд╛ рд╣реАред <br><br><h3>  рдПрдореБрд▓реЗрдЯрд░ рдЖрд╡реЗрджрди </h3><br>  рдлрд┐рд░ рд╕реЗ, "рдореЛрдмрд╛рдЗрд▓ рдРрдк (Xamarin.Forms)" рдЬреИрд╕реЗ рд╡рд┐рдЬрд╝реБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдореЗрдВ рдПрдХ рдирдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ, рдлрд┐рд░ "рдмреНрд▓реИрдВрдХ" рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ "рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо" рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдХреЗрд╡рд▓ "рдПрдВрдбреНрд░реЙрдЗрдб" рдЪреЗрдХрдорд╛рд░реНрдХ рдЫреЛрдбрд╝ рджреЗрдВред <br><br>  Android рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ, рдирд┐рдореНрди рдХрд╛рд░реНрдп рдХрд░реЗрдВ: <br><br><ul><li>  рдХрд╛рд░реНрдбрд╕реН рд╕реЗрд╡рд╛ рд╡рд░реНрдЧ - рдпрд╣рд╛рдБ рдЖрдкрдХреЛ рд╕реНрдерд┐рд░рд╛рдВрдХ рдФрд░ ProcessCommandApdu () рд╡рд┐рдзрд┐, рд╕рд╛рде рд╣реА SendMessageToActivity () рд╡рд┐рдзрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </li><li>  рд╕рд╣рд╛рдпрддрд╛_рд╕реВрдЪреА.xml рдореЗрдВ рд╕реЗрд╡рд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг </li><li>  рдореИрдиреНтАНрдпреВрдПрдХреНтАНрдЯрд┐рд╡рд┐рдЯреА рдореЗрдВ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рд╡рд╛рд▓рд╛ рддрдВрддреНрд░ </li><li>  рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдиреНрдЪ (рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ) </li><li>  AndroidManifest.xml - nfc рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпрд╛рдВ </li></ul><br>  рдФрд░ App.xaml.cs рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреНрд░реЙрд╕-рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ: <br><br><ul><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреА рд╡рд┐рдзрд┐ </li></ul><br><h4>  рдХрд╛рд░реНрдбрд╕реЗрд╡рд╛ рд╡рд░реНрдЧ </h4><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.App; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.Content; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.Nfc.CardEmulators; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.OS; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ApduServiceCardApp.Droid.Services</span></span> { [Service(Exported = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, Enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, Permission = <span class="hljs-string"><span class="hljs-string">"android.permission.BIND_NFC_SERVICE"</span></span>), IntentFilter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-string"><span class="hljs-string">"android.nfc.cardemulation.action.HOST_APDU_SERVICE"</span></span> }, Categories = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-string"><span class="hljs-string">"android.intent.category.DEFAULT"</span></span> }), MetaData(<span class="hljs-string"><span class="hljs-string">"android.nfc.cardemulation.host_apdu_service"</span></span>, Resource = <span class="hljs-string"><span class="hljs-string">"@xml/aid_list"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CardService</span></span> : <span class="hljs-title"><span class="hljs-title">HostApduService</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ISO-DEP command HEADER for selecting an AID. // Format: [Class | Instruction | Parameter 1 | Parameter 2] private static readonly byte[] SELECT_APDU_HEADER = new byte[] { 0x00, 0xA4, 0x04, 0x00 }; // "OK" status word sent in response to SELECT AID command (0x9000) private static readonly byte[] SELECT_OK_SW = new byte[] { 0x90, 0x00 }; // "UNKNOWN" status word sent in response to invalid APDU command (0x0000) private static readonly byte[] UNKNOWN_CMD_SW = new byte[] { 0x00, 0x00 }; public override byte[] ProcessCommandApdu(byte[] commandApdu, Bundle extras) { if (commandApdu.Length &gt;= SELECT_APDU_HEADER.Length &amp;&amp; Enumerable.SequenceEqual(commandApdu.Take(SELECT_APDU_HEADER.Length), SELECT_APDU_HEADER)) { var hexString = string.Join("", Array.ConvertAll(commandApdu, b =&gt; b.ToString("X2"))); SendMessageToActivity($"Recieved message from reader: {hexString}"); var messageToReader = "Hello Reader!"; var messageToReaderBytes = Encoding.UTF8.GetBytes(messageToReader); return messageToReaderBytes.Concat(SELECT_OK_SW).ToArray(); } return UNKNOWN_CMD_SW; } public override void OnDeactivated(DeactivationReason reason) { } private void SendMessageToActivity(string msg) { Intent intent = new Intent("MSG_NAME"); intent.PutExtra("MSG_DATA", msg); SendBroadcast(intent); } } }</span></span></code> </pre><br>  рд░реАрдбрд░ рд╕реЗ APDU рдХрдорд╛рдВрдб рдорд┐рд▓рдиреЗ рдкрд░, ProcessCommandApdu рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдХрдорд╛рдВрдб рдХреЛ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдПрдХ рд╕рд░рдгреА рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╕рдВрджреЗрд╢ SELECT_APDU_HEADER рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рд╣рд╛рдВ, рддреЛ рдкрд╛рдардХ рдХреЛ рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд▓рд┐рдЦреЗрдВред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдПрдХ рд╡рд┐рдирд┐рдордп рдХрдИ рдЪрд░рдгреЛрдВ рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд╕рд╡рд╛рд▓-рдЬрд╡рд╛рдм рд╕рд╡рд╛рд▓-рдЬрд╡рд╛рдм, рдЖрджрд┐ред <br><br>  рд╡рд░реНрдЧ рд╕реЗ рдкрд╣рд▓реЗ, рд╕реЗрд╡рд╛ рд╡рд┐рд╢реЗрд╖рддрд╛ Android рд╕реЗрд╡рд╛ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреА рд╣реИред  рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╕рдордп, xamarin рдЗрд╕ рд╡рд┐рд╡рд░рдг рдХреЛ AndroidManifest.xml рдореЗрдВ рдРрд╕реЗ рддрддреНрд╡ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИ: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'md51c8b1c564e9c74403ac6103c28fa46ff.CardService'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">permission</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'android.permission.BIND_NFC_SERVICE'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'true'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">exported</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'true'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'android.nfc.cardemulation.host_apdu_service'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">resource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'@res/0x7F100000'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'android.nfc.cardemulation.action.HOST_APDU_SERVICE'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'android.intent.category.DEFAULT'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h4>  рд╕рд╣рд╛рдпрддрд╛_рд╕реВрдЪреА.xml рдореЗрдВ рд╕реЗрд╡рд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг </h4><br>  Xml рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ, рд╕рд╣рд╛рдпрддрд╛_рд╕реВрдЪреА рдмрдирд╛рдПрдБред Xml рдлрд╝рд╛рдЗрд▓: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host-apdu-service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/service_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:requireDeviceUnlock</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">aid-group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/card_title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:category</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"other"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">aid-filter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"F123456789"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">aid-group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host-apdu-service</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  рдЗрд╕рдХрд╛ рд╕рдВрджрд░реНрдн рдХрд╛рд░реНрдбрд╕реЗрд╡рд╛ рд╡рд░реНрдЧ рдореЗрдВ рд╕реЗрд╡рд╛ рд╡рд┐рд╢реЗрд╖рддрд╛ рдореЗрдВ рд╣реИ - рд╕рдВрд╕рд╛рдзрди = "@ xml / рд╕рд╣рд╛рдпрддрд╛_рд╕реВрдЪреА" <br>  рдпрд╣рд╛рдВ рд╣рдордиреЗ рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ AID рд╕реЗрдЯ рдХрд┐рдпрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдкрд╛рдардХ рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдЧрд╛ рдФрд░ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИDeviceUnlock = "рдЭреВрдареА" рддрд╛рдХрд┐ рдХрд╛рд░реНрдб рдПрдХ рдЕрдирд▓реЙрдХ рд╕реНрдХреНрд░реАрди рдХреЗ рд╕рд╛рде рдкрдврд╝рд╛ рдЬрд╛рдПред <br><br>  рдХреЛрдб рдореЗрдВ 2 рд╕реНрдерд┐рд░рд╛рдВрдХ рд╣реИрдВ: <code>@string/service_name</code> рдФрд░ <code>@string/card_title</code> ред  рд╡реЗ рдорд╛рди / strings.xml рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдШреЛрд╖рд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВ: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"card_title"</span></span></span><span class="hljs-tag">&gt;</span></span>My Loyalty Card<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"service_name"</span></span></span><span class="hljs-tag">&gt;</span></span>My Company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h4>  рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХрд╛ рддрдВрддреНрд░: </h4><br>  рдЗрд╕ рд╕реЗрд╡рд╛ рдХрд╛ MainActivity рд╕реЗ рдХреЛрдИ рд╕рдВрдмрдВрдз рдирд╣реАрдВ рд╣реИ, рдЬреЛ рдХрд┐ APDU рдЖрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд╕рдордп рд╢реБрд░реВ рднреА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдмреНрд░реЙрдбрдХрд╛рд╕реНрдЯрд╕реАрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдб рд╕реЗрд╡рд╛ рд╕реЗ рдореЗрдирдРрдХреНрдЯрд┐рд╡рд┐рдЯреА рддрдХ рд╕рдВрджреЗрд╢ рднреЗрдЬрддреЗ рд╣реИрдВ: <br><br>  рдХрд╛рд░реНрдбрд╕реЗрд╡рд╛ рд╕реЗ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреА рд╡рд┐рдзрд┐: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendMessageToActivity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> msg</span></span></span><span class="hljs-function">)</span></span> { Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(<span class="hljs-string"><span class="hljs-string">"MSG_NAME"</span></span>); intent.PutExtra(<span class="hljs-string"><span class="hljs-string">"MSG_DATA"</span></span>, msg); SendBroadcast(intent); }</code> </pre><br>  рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛: <br>  MessageReceiver рд╡рд░реНрдЧ рдмрдирд╛рдПрдБ: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.Content; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ApduServiceCardApp.Droid.Services</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MessageReceiver</span></span> : <span class="hljs-title"><span class="hljs-title">BroadcastReceiver</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnReceive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Context context, Intent intent</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message = intent.GetStringExtra(<span class="hljs-string"><span class="hljs-string">"MSG_DATA"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> App.DisplayAlertAsync(message); } } }</code> </pre><br>  рдореИрд╕реЗрдЬрдРрдХреНрдЯрд┐рд╡ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCreate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bundle savedInstanceState</span></span></span><span class="hljs-function">)</span></span> { ... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> receiver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageReceiver(); RegisterReceiver(receiver, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntentFilter(<span class="hljs-string"><span class="hljs-string">"MSG_NAME"</span></span>)); LoadApplication(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> App()); }</code> </pre><br><h4>  App.xaml.cs </h4><br>  рдПрдХ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рдардХ рд╡рд┐рдзрд┐ рдХреЗ рд╕рдорд╛рди рд╣реА: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DisplayAlertAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> msg</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Device.InvokeOnMainThreadAsync(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Current.MainPage.DisplayAlert(<span class="hljs-string"><span class="hljs-string">"message from service"</span></span>, msg, <span class="hljs-string"><span class="hljs-string">"ok"</span></span>));</code> </pre><br><h4>  AndroidManifest.xml </h4><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-feature</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.hardware.nfc.hce"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-feature</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FEATURE_NFC_HOST_CARD_EMULATION"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.NFC"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.BIND_NFC_SERVICE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-sdk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">/&gt;</span></span>  14</code> </pre><br>  рдлрд┐рд▓рд╣рд╛рд▓, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирд┐рдореНрди рдХрд╛рд░реНрдп рд╣реИрдВ: <br><br><ul><li>  рд░реАрдбрд░ рд╕реНрдХреНрд░реАрди рдкрд░ рдПрдореБрд▓реЗрдЯрд░ рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ </li><li>  рдПрдореБрд▓реЗрдЯрд░ рд╕реНрдХреНрд░реАрди рдкрд░ рд░реАрдбрд░ рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ </li><li>  рдПрдореБрд▓реЗрдЯрд░ рдХреЛ рдЪрд▓ рд░рд╣реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕реНрдХреНрд░реАрди рдмрдВрдж рд╣реЛрдиреЗ рдХреЗ рд╕рд╛рдеред </li></ul><br>  рдЕрдЧрд▓рд╛ред <br><br><h4>  рдПрдореБрд▓реЗрдЯрд░ рдирд┐рдпрдВрддреНрд░рдг </h4><br>  рдореИрдВ Xamarin.Essentials рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реВрдВрдЧрд╛ред <br><br>  рдЖрдЗрдП рдРрд╕рд╛ рдХрд░рддреЗ рд╣реИрдВ: рдЬрдм рд╣рдо рдПрдореБрд▓реЗрдЯрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВрдЧреЗ: <br><br><pre> <code class="cs hljs">Xamarin.Essentials.Preferences.Set(<span class="hljs-string"><span class="hljs-string">"key1"</span></span>, Guid.NewGuid().ToString());</code> </pre><br>  рдФрд░ ProcessCommandApdu рд╡рд┐рдзрд┐ рдореЗрдВ рд╣рдо рдЗрд╕ рдореВрд▓реНрдп рдХреЛ рд╣рд░ рдмрд╛рд░ рдлрд┐рд░ рд╕реЗ рд▓реЗрдВрдЧреЗ: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messageToReader = <span class="hljs-string"><span class="hljs-string">$"Hello Reader! - </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Xamarin.Essentials.Preferences.Get(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"key1"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">, </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"key1 not found"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">"</span></span>;</code> </pre><br>  рдЕрдм рд╣рд░ рдмрд╛рд░ рдЬрдм рдЖрдк рдПрдореБрд▓реЗрдЯрд░ рдПрдкреНрд▓реАрдХреЗрд╢рди рдХреЛ рд░рд┐рд╕реНрдЯрд╛рд░реНрдЯ (рдХрдо рд╕реЗ рдХрдо рдирд╣реАрдВ) рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдПрдХ рдирдИ рдЧрд╛рдЗрдб рджреЗрдЦрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: <br><br><pre> <code class="plaintext hljs">Hello Reader! - 76324a99-b5c3-46bc-8678-5650dab0529d</code> </pre> <br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдПрдореБрд▓реЗрдЯрд░ рдЪрд╛рд▓реВ / рдмрдВрдж рдХрд░реЗрдВ: <br><br><pre> <code class="cs hljs">Xamarin.Essentials.Preferences.Set(<span class="hljs-string"><span class="hljs-string">"IsEnabled"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre><br>  рдФрд░ ProcessCommandApdu рд╡рд┐рдзрд┐ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> IsEnabled = Xamarin.Essentials.Preferences.Get(<span class="hljs-string"><span class="hljs-string">"IsEnabled"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsEnabled) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UNKNOWN_CMD_SW; <span class="hljs-comment"><span class="hljs-comment">// 0x00, 0x00</span></span></code> </pre><br>  рдпрд╣ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ, рд▓реЗрдХрд┐рди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдиреНрдп рд╣реИрдВ</a> ред <br><br><h4>  рдПрдХ рдкрд╛рдардХ рдХрд╛ рдкрддрд╛ рдЪрд▓рдиреЗ рдкрд░ рдПрдореБрд▓реЗрдЯрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рдирд╛ </h4><br>  рдпрджрд┐ рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдПрдореБрд▓реЗрдЯрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЦреЛрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ ProcessCommandApdu рд╡рд┐рдзрд┐ рдореЗрдВ рд▓рд╛рдЗрди рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="cs hljs">StartActivity(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(MainActivity));</code> </pre><br>  рдпрджрд┐ рдЖрдкрдХреЛ рдЖрд╡реЗрджрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЗрд╕ рддрд░рд╣: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> activity = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(MainActivity)); intent.PutExtra(<span class="hljs-string"><span class="hljs-string">"MSG_DATA"</span></span>, <span class="hljs-string"><span class="hljs-string">"data for application"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.StartActivity(activity);</code> </pre><br>  рдЖрдк рдСрдирдХреНрд░реАрдЯ рд╡рд┐рдзрд┐ рдореЗрдВ MainActivity class рдореЗрдВ рдЙрддреНрддреАрд░реНрдг рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="cs hljs">... LoadApplication(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> App()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Intent.Extras != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message = Intent.Extras.GetString(<span class="hljs-string"><span class="hljs-string">"MSG_DATA"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> App.DisplayAlertAsync(message); }</code> </pre><br><h4>  Nfc рдПрдбреЗрдкреНрдЯрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛ рдФрд░ nfc рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдирд╛ </h4><br>  рдпрд╣ рдЦрдВрдб рдкрд╛рдардХ рдФрд░ рдПрдореБрд▓реЗрдЯрд░ рджреЛрдиреЛрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИред <br><br>  Android рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ NfcHelper рдмрдирд╛рдПрдВ рдФрд░ рдЗрд╕реЗ MainPage рдкреЗрдЬ рдХреЛрдб рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП DependencyService рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.App; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.Content; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Android.Nfc; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ApduServiceCardApp.Services; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Xamarin.Forms; [assembly: Dependency(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ApduServiceCardApp.Droid.Services.NfcHelper))] <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ApduServiceCardApp.Droid.Services</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NfcHelper</span></span> : <span class="hljs-title"><span class="hljs-title">INfcHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> NfcAdapterStatus </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetNfcAdapterStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> adapter = NfcAdapter.GetDefaultAdapter(Forms.Context <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Activity); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adapter == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? NfcAdapterStatus.NoAdapter : adapter.IsEnabled ? NfcAdapterStatus.Enabled : NfcAdapterStatus.Disabled; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GoToNFCSettings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(Android.Provider.Settings.ActionNfcSettings); intent.AddFlags(ActivityFlags.NewTask); Android.App.Application.Context.StartActivity(intent); } } }</code> </pre><br>  рдЕрдм рдХреНрд░реЙрд╕-рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ, INfcHelper рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ApduServiceCardApp.Services</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">INfcHelper</span></span> { <span class="hljs-function"><span class="hljs-function">NfcAdapterStatus </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetNfcAdapterStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GoToNFCSettings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> NfcAdapterStatus { Enabled, Disabled, NoAdapter } }</code> </pre><br>  рдФрд░ рдпрд╣ рд╕рдм MainPage.xaml.cs рдХреЛрдб рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnAppearing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnAppearing(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> CheckNfc(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckNfc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nfcHelper = DependencyService.Get&lt;INfcHelper&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> status = nfcHelper.GetNfcAdapterStatus(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (status) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NfcAdapterStatus.Enabled: <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> App.DisplayAlertAsync(<span class="hljs-string"><span class="hljs-string">"nfc enabled!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NfcAdapterStatus.Disabled: nfcHelper.GoToNFCSettings(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NfcAdapterStatus.NoAdapter: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> App.DisplayAlertAsync(<span class="hljs-string"><span class="hljs-string">"no nfc adapter found!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br><h4>  рдЧрд┐рдЯрд╣рдм рд▓рд┐рдВрдХ </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдореБрд▓реЗрдЯрд░</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд╛рдардХ</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi471622/">https://habr.com/ru/post/hi471622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi471608/index.html">рдЯрдХрд░рд╛рд╡ рд╕реЗ рдмрдЪрд╛рд╡ рдкреНрд░рдгрд╛рд▓реА: рднрд╛рдЧ 1. рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд▓рд┐рдП рдЯреАрдХреЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рдзрд╛рди</a></li>
<li><a href="../hi471610/index.html">Prolog рдкрд░ REST рд╕рд░реНрд╡рд░, рдпрд╣ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ?</a></li>
<li><a href="../hi471614/index.html">рд░рд╕реНрдЯрдЕрдк 1.20.0 рд░рд┐рд▓реАрдЬ: рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди, рдЕрдкрдбреЗрдЯ рдореЗрдВ рд╕реБрдзрд╛рд░ рдФрд░ рдбреЙрдХреНрдЯрд░ рдХрдорд╛рдВрдб</a></li>
<li><a href="../hi471618/index.html">рдкрд╛рдпрдерди (рдмрдврд╝рд╛рд╡рд╛) рд╕реЗ рд╕реА / рд╕реА ++</a></li>
<li><a href="../hi471620/index.html">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдореЗрдВ рддреИрдирд╛рддреА рдХреА рд░рдгрдиреАрддрд┐рдпрд╛рдВ: рд░реЛрд▓рд┐рдВрдЧ, рд░реАрдХреНрд░рд┐рдПрдЯ, рдмреНрд▓реВ / рдЧреНрд░реАрди, рдХреИрдирд░реА, рдбрд╛рд░реНрдХ (рдП / рдмреА рдЯреЗрд╕реНрдЯрд┐рдВрдЧ)</a></li>
<li><a href="../hi471624/index.html">рд╕рд╣реА рдпреВрдЖрдИ / рдпреВрдПрдХреНрд╕ рдбрд┐рдЬрд╛рдЗрди рдХреЗ рд╕рд╛рде рдПрдХ рдкреНрд░рд╕реНрддреБрддрд┐ рджреЗ рд░рд╣рд╛ рд╣реИ</a></li>
<li><a href="../hi471626/index.html">рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдР: рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рд░рд▓ рд╢рдмреНрдж</a></li>
<li><a href="../hi471628/index.html">рдореИрдВрдиреЗ 15 рд╣рдЬрд╛рд░ рд╡рд┐рд░рд╛рд╕рдд рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдПрдХрд▓-рд╣рд╛рде рд╕реЗ рд░рд┐рдлрд▓реЗрдХреНрдЯ рдХрд┐рдпрд╛ред рдпрд╣ рдореЗрд░реЗ рдЬреАрд╡рди рдХрд╛ рд╕рдмрд╕реЗ рдмреБрд░рд╛ рджреЛ рд╕рдкреНрддрд╛рд╣ рдерд╛</a></li>
<li><a href="../hi471630/index.html">рдирд┐рд╖рд┐рджреНрдз рдЖрдирдВрдж: рдХрд┐рди рджреЗрд╢реЛрдВ рдореЗрдВ рдкреЛрд░реНрдирд╣рдм рдЕрд╡рд░реБрджреНрдз рд╣реИ рдФрд░ рдХреНрдпреЛрдВ</a></li>
<li><a href="../hi471634/index.html">рдХрд┐рд╕реА рдХрдВрдкрдиреА рдореЗрдВ рдИрдореЗрд▓ рдорд╛рд░реНрдХреЗрдЯрд┐рдВрдЧ рдХреИрд╕реЗ рдмрдирд╛рдПрдВ рдФрд░ рд╕рдорд╕реНрдпрд╛рдУрдВ рд╕реЗ рдХреИрд╕реЗ рдмрдЪреЗрдВ: 6 рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдХрджрдо</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>