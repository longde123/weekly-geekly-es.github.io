<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ ğŸ•µğŸ¼ ğŸ¤°ğŸ¼ åœ¨Unityä¸­ç¼–å†™ç€è‰²å™¨ã€‚ GrabPassï¼ŒPerRendererData ğŸ‘Œ ğŸ‘©ğŸ» ğŸ’¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä½ å¥½ æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨Unityä¸­ç¼–å†™ç€è‰²å™¨çš„ç»éªŒã€‚ è®©æˆ‘ä»¬ä»2Dä¸­çš„â€œä½ç§»/æŠ˜å°„â€ç€è‰²å™¨å¼€å§‹ï¼Œè€ƒè™‘ç”¨äºç¼–å†™å®ƒçš„åŠŸèƒ½ï¼ˆGrabPassï¼ŒPerRendererDataï¼‰ï¼Œå¹¶æ³¨æ„å¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚ 

 è¯¥ä¿¡æ¯å¯¹äºé‚£äº›å¯¹ç€è‰²å™¨æœ‰å¤§è‡´äº†è§£å¹¶å°è¯•åˆ›å»ºå®ƒä»¬çš„äººå¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯ä»–ä»¬ä¸ç†Ÿæ‚‰Unityæä¾›çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ä¸...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Unityä¸­ç¼–å†™ç€è‰²å™¨ã€‚ GrabPassï¼ŒPerRendererData</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427357/"> ä½ å¥½ æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨Unityä¸­ç¼–å†™ç€è‰²å™¨çš„ç»éªŒã€‚ è®©æˆ‘ä»¬ä»2Dä¸­çš„â€œä½ç§»/æŠ˜å°„â€ç€è‰²å™¨å¼€å§‹ï¼Œè€ƒè™‘ç”¨äºç¼–å†™å®ƒçš„åŠŸèƒ½ï¼ˆGrabPassï¼ŒPerRendererDataï¼‰ï¼Œå¹¶æ³¨æ„å¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚ <br><br> è¯¥ä¿¡æ¯å¯¹äºé‚£äº›å¯¹ç€è‰²å™¨æœ‰å¤§è‡´äº†è§£å¹¶å°è¯•åˆ›å»ºå®ƒä»¬çš„äººå¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯ä»–ä»¬ä¸ç†Ÿæ‚‰Unityæä¾›çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ä¸çŸ¥é“è¯¥ä½¿ç”¨å“ªä¸€ä¾§ã€‚ çœ‹ä¸€ä¸‹ï¼Œä¹Ÿè®¸æˆ‘çš„ç»éªŒå¯ä»¥å¸®åŠ©æ‚¨è§£å†³ã€‚ <br><br><img src="https://habrastorage.org/webt/7p/cy/pr/7pcyprnckvacvecylqvlu-8g68m.gif"><br><a name="habracut"></a><br> è¿™æ˜¯æˆ‘ä»¬è¦å®ç°çš„ç»“æœã€‚ <br><br><img src="https://habrastorage.org/webt/u5/wo/ll/u5woll2fo6nibjmd0lrgvszxvxk.gif" alt="å›¾ç‰‡"><br><br><h2> å‡†å¤‡å·¥ä½œ </h2><br> é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç€è‰²å™¨ï¼Œå°†ç®€å•åœ°ç»˜åˆ¶æŒ‡å®šçš„ç²¾çµã€‚ ä»–å°†æˆä¸ºæˆ‘ä»¬è¿›ä¸€æ­¥æ“çºµçš„åŸºç¡€ã€‚ å°†ä¼šæ·»åŠ ä¸€äº›å†…å®¹ï¼Œç›¸åä¼šåˆ é™¤ä¸€äº›å†…å®¹ã€‚ å®ƒä¸æ ‡å‡†â€œ Sprites-Defaultâ€ä¸åŒï¼Œå› ä¸ºç¼ºå°‘ä¸€äº›ä¸ä¼šå½±å“ç»“æœçš„æ ‡ç­¾å’Œæ“ä½œã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç”¨äºæ¸²æŸ“ç²¾çµçš„ç€è‰²å™¨ä»£ç </b> <div class="spoiler_text"><pre><code class="hljs pgsql">Shader "Displacement/Displacement_Wave" { Properties { [PerRendererData] _MainTex ("Main Texture", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Color ("Color" , Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) } SubShader { Tags { "RenderType" = "Transparent" "Queue" = "Transparent" } Cull <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> Blend SrcAlpha OneMinusSrcAlpha Pass { CGPROGRAM #pragma vertex vert #pragma fragment frag #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "UnityCG.cginc" struct appdata { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : POSITION; float2 uv : TEXCOORD0; <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; }; struct v2f { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : SV_POSITION; float2 uv : TEXCOORD0; <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; }; fixed4 _Color; sampler2D _MainTex; v2f vert (appdata v) { v2f o; o.uv = v.uv; o.color = v.color; o.vertex = UnityObjectToClipPos(v.vertex); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> o; } fixed4 frag (v2f i) : SV_Target { fixed4 texColor = tex2D(_MainTex, i.uv)*i.color; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> texColor; } ENDCG } } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">ç²¾çµæ˜¾ç¤º</b> <div class="spoiler_text"> èƒŒæ™¯å®é™…ä¸Šæ˜¯é€æ˜çš„ï¼Œæ•…æ„å˜æš—äº†ã€‚ <br><br><img src="https://habrastorage.org/webt/7l/yu/in/7lyuingedtk8frmquebh2m0kgdy.jpeg" alt="å›¾ç‰‡"><br></div></div><br> äº§ç”Ÿçš„å·¥ä»¶ã€‚ <br><br><img src="https://habrastorage.org/webt/yl/ir/9i/ylir9i7bz4ibkkbhag61q8v95ak.jpeg" alt="å›¾ç‰‡"><br><br><h2> æŠ¢é€š </h2><br> ç°åœ¨ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯æ›´æ”¹å±å¹•ä¸Šçš„å½“å‰å›¾åƒï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è·å–å›¾åƒã€‚  <i>GrabPass</i>æ®µè½å°†å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸€é—®é¢˜ã€‚ æ­¤æ®µè½å°†ä»¥<i>_GrabTexture</i>çº¹ç†æ•è·å±å¹•å›¾åƒã€‚ çº¹ç†å°†ä»…åŒ…å«åœ¨ä½¿ç”¨æ­¤ç€è‰²å™¨çš„å¯¹è±¡è¿›è¡Œæ¸²æŸ“ä¹‹å‰ç»˜åˆ¶çš„å†…å®¹ã€‚ <br><br> é™¤äº†çº¹ç†æœ¬èº«ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰«æçš„åæ ‡æ‰èƒ½ä»ä¸­è·å–åƒç´ é¢œè‰²ã€‚ ä¸ºæ­¤ï¼Œå‘ç‰‡æ®µç€è‰²å™¨æ•°æ®æ·»åŠ å…¶ä»–çº¹ç†åæ ‡ã€‚ è¿™äº›åæ ‡æœªè¿›è¡Œå½’ä¸€åŒ–ï¼ˆå€¼ä¸åœ¨0åˆ°1çš„èŒƒå›´å†…ï¼‰ï¼Œå¹¶ä¸”æè¿°äº†ç‚¹åœ¨ç›¸æœºç©ºé—´ï¼ˆæŠ•å½±ï¼‰ä¸­çš„ä½ç½®ã€‚ <br><br><pre> <code class="hljs pgsql">struct v2f { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : SV_POSITION; float2 uv : <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; <span class="hljs-type"><span class="hljs-type">float4</span></span> grabPos : TEXCOORD1; };</code> </pre> <br> å¹¶åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å¡«å……å®ƒä»¬ã€‚ <br><br><pre> <code class="hljs">o.grabPos = ComputeGrabScreenPos (o.vertex);</code> </pre> <br> ä¸ºäº†ä»<i>_GrabTexture</i>è·å–é¢œè‰²ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨éè§„èŒƒåŒ–çš„åæ ‡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³• <br><br><pre> <code class="hljs lisp">tex2Dproj(<span class="hljs-name"><span class="hljs-name">_GrabTexture</span></span>, i.grabPos)</code> </pre> <br> ä½†æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨ä¸åŒçš„æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨é€è§†åˆ’åˆ†ï¼ˆå³ å°†æ‰€æœ‰å…¶ä»–å…ƒç´ éƒ½åˆ†æˆwåˆ†é‡ã€‚ <br><br><pre> <code class="hljs lisp">tex2D(<span class="hljs-name"><span class="hljs-name">_GrabTexture</span></span>, i.grabPos.xy/i.grabPos.w)</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">wåˆ†é‡</b> <div class="spoiler_text"> ä»…å½“ä½¿ç”¨é€è§†å›¾æ—¶ï¼Œæ‰æœ‰å¿…è¦å°†wåˆ†é‡åˆ†ä¸ºå‡ éƒ¨åˆ†ï¼Œåœ¨æ­£äº¤æŠ•å½±ä¸­ï¼Œå®ƒå§‹ç»ˆä¸º1ã€‚å®é™…ä¸Šï¼Œ <b>w</b>å­˜å‚¨äº†æŒ‡å‘ç›¸æœºçš„è·ç¦»å€¼ã€‚ ä½†æ˜¯å®ƒä¸æ˜¯depth- <b>z</b> ï¼Œå…¶å€¼åº”åœ¨0åˆ°1çš„èŒƒå›´å†…ã€‚ä½¿ç”¨depthæ˜¯å€¼å¾—å•ç‹¬è®¨è®ºçš„è¯é¢˜ï¼Œå› æ­¤æˆ‘ä»¬å°†è¿”å›åˆ°ç€è‰²å™¨ã€‚ </div></div><br> é€è§†åˆ’åˆ†ä¹Ÿå¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”å·²ç»å‡†å¤‡å¥½çš„æ•°æ®å¯ä»¥ä¼ è¾“åˆ°ç‰‡æ®µç€è‰²å™¨ã€‚ <br><br><pre> <code class="hljs mel">v2f vert (appdata v) { v2f o; o.uv = v.uv; o.<span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = v.<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; o.vertex = UnityObjectToClipPos(v.vertex); o.grabPos = ComputeScreenPos (o.vertex); o.grabPos /= o.grabPos.w; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> o; }</code> </pre> <br> åˆ†åˆ«æ·»åŠ ä¸€ä¸ªç‰‡æ®µç€è‰²å™¨ã€‚ <br><br><pre> <code class="hljs matlab">fixed4 frag (v2f <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>) : SV_Target { fixed4 = grabColor = tex2d(_GrabTexture, <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>.grabPos.xy); fixed4 texColor = tex2D(_MainTex, <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>.uv)*<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>.color; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> grabColor; }</code> </pre> <br> å…³é—­æŒ‡å®šçš„æ··åˆæ¨¡å¼ï¼Œå› ä¸º ç°åœ¨ï¼Œæˆ‘ä»¬æ­£åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­å®ç°æ··åˆæ¨¡å¼ã€‚ <br><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//Blend SrcAlpha OneMinusSrcAlpha Blend Off</span></span></code> </pre><br> å¹¶æŸ¥çœ‹<i>GrabPass</i>çš„ç»“æœã€‚ <br><br><img src="https://habrastorage.org/webt/mh/ex/b_/mhexb_lek_zyrgsto6p0ki4rmoi.jpeg" alt="å›¾ç‰‡"><br><br> ä¼¼ä¹ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚ ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªè½»å¾®çš„åç§»ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†å˜é‡çš„å€¼æ·»åŠ åˆ°çº¹ç†åæ ‡ã€‚ è¿™æ ·æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å˜é‡ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„<i>_DisplacementPower</i>å±æ€§ã€‚ <br><br><pre> <code class="hljs powershell">Properties { <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">PerRendererData</span></span></span><span class="hljs-function">] _</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainTex</span></span></span></span> (<span class="hljs-string"><span class="hljs-string">"Main Texture"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _Color (<span class="hljs-string"><span class="hljs-string">"Color"</span></span> , Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _DisplacementPower (<span class="hljs-string"><span class="hljs-string">"Displacement Power"</span></span> , Float) = <span class="hljs-number"><span class="hljs-number">0</span></span> } SubShader { Pass { ... float _DisplacementPower; ... } }</code> </pre> <br> å†æ¬¡ï¼Œæ›´æ”¹ç‰‡æ®µç€è‰²å™¨ã€‚ <br><br><pre> <code class="hljs lisp">fixed4 grabColor = tex2d(<span class="hljs-name"><span class="hljs-name">_GrabTexture</span></span>, i.grabPos.xy + _DisplaccementPower)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br> æ¬§æ™®è·³å’Œç»“æœï¼ å›¾åƒæœ‰ç§»ä½ã€‚ <br><br><img src="https://habrastorage.org/webt/ky/yl/9w/kyyl9w51dqeap4_wvxws1nod4fg.jpeg"><br><br> æˆåŠŸå®Œæˆè½¬æ¢åï¼Œæ‚¨å¯ä»¥è¿›è¡Œæ›´å¤æ‚çš„å˜å½¢ã€‚ æˆ‘ä»¬ä½¿ç”¨é¢„å…ˆå‡†å¤‡çš„çº¹ç†ï¼Œè¯¥çº¹ç†å°†åœ¨æŒ‡å®šç‚¹å­˜å‚¨ä½ç§»åŠ›ã€‚ åœ¨xè½´ä¸Šä¸ºåç§»å€¼çš„çº¢è‰²ï¼Œåœ¨yè½´ä¸Šä¸ºç»¿è‰²ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç”¨äºå˜å½¢çš„çº¹ç†</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/0f/fu/-e/0ffu-ezmyhr9lb3qofn9d99ese8.png"><br><img src="https://habrastorage.org/webt/ld/mf/no/ldmfnoicn2b7e7cmsbpeml716hs.png"><br></div></div><br> è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ æ·»åŠ ä¸€ä¸ªæ–°å±æ€§ä»¥å­˜å‚¨çº¹ç†ã€‚ <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">_DisplacementTex</span></span> (<span class="hljs-string"><span class="hljs-string">"Displacement Texture"</span></span>, 2D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {}</code> </pre> <br> å’Œä¸€ä¸ªå˜é‡ã€‚ <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sampler2D</span></span> _DisplacementTex;</code> </pre> <br> åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­ï¼Œæˆ‘ä»¬ä»çº¹ç†è·å–åç§»å€¼ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°çº¹ç†åæ ‡ã€‚ <br><br><pre> <code class="hljs lisp">fixed4 displPos = tex2D(<span class="hljs-name"><span class="hljs-name">_DisplacementTex</span></span>, i.uv)<span class="hljs-comment"><span class="hljs-comment">; float2 offset = (displPos.xy*2 - 1) * _DisplacementPower * displPos.a; fixed4 grabColor = tex2D (_GrabTexture, i.grabPos.xy + offset);</span></span></code> </pre><br> ç°åœ¨ï¼Œæ›´æ”¹<i>_DisplacementPower</i>å‚æ•°çš„å€¼ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥ç§»åŠ¨åŸå§‹å›¾åƒï¼Œè¿˜å¯ä»¥ä½¿åŸå§‹å›¾åƒå¤±çœŸã€‚ <br><br><img src="https://habrastorage.org/webt/tu/pu/w3/tupuw3jqxaztn2jl19mdyhtvzwi.gif"><br><br><h3> å åŠ å±‚ </h3><br> ç°åœ¨å±å¹•ä¸Šåªæœ‰ç©ºé—´çš„æ‰­æ›²ï¼Œè€Œæˆ‘ä»¬ä¸€å¼€å§‹æ˜¾ç¤ºçš„ç²¾çµå°±ä¸å­˜åœ¨äº†ã€‚ æˆ‘ä»¬å°†å…¶æ”¾å›åŸå¤„ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¤šç§é¢œè‰²ã€‚ é‡‡å–å…¶ä»–æ–¹å¼ï¼Œä¾‹å¦‚å åŠ æ··åˆæ¨¡å¼ã€‚ å…¶å…¬å¼å¦‚ä¸‹ï¼š <br><br><img src="https://habrastorage.org/webt/wd/qr/z7/wdqrz7rv0skaotpofwwu4owvyxy.jpeg"><br><br> å…¶ä¸­Sæ˜¯åŸå§‹å›¾åƒï¼ŒCæ˜¯æ ¡æ­£å›¾åƒï¼Œå³æˆ‘ä»¬çš„å­ç”»é¢Ræ˜¯ç»“æœã€‚ <br><br> å°†æ­¤å…¬å¼è½¬ç§»åˆ°æˆ‘ä»¬çš„ç€è‰²å™¨ã€‚ <br><br><pre> <code class="hljs mel">fixed4 <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0.5</span></span> ? <span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>*texColor : <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>*(<span class="hljs-number"><span class="hljs-number">1</span></span>-texColor)*(<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>);</code> </pre><br> åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨æ¡ä»¶è¿ç®—ç¬¦æ˜¯ä¸€ä¸ªç›¸å½“ä»¤äººå›°æƒ‘çš„è¯é¢˜ã€‚ åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ‰€ä½¿ç”¨çš„å¹³å°å’Œå›¾å½¢APIã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¡ä»¶è¯­å¥ä¸ä¼šå½±å“æ€§èƒ½ã€‚ ä½†æ˜¯ï¼Œæ€»æ˜¯å€¼å¾—é€€åã€‚ å¯ä»¥ä½¿ç”¨æ•°å­¦å’Œå¯ç”¨æ–¹æ³•æ›¿æ¢æ¡ä»¶è¿ç®—ç¬¦ã€‚ æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹æ„é€  <br><br><pre> <code class="hljs swift"><span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = step ( y, x); r = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> * a + (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) * b;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">æ­¥è¿›åŠŸèƒ½</b> <div class="spoiler_text"> å¦‚æœ<b>x</b>å¤§äºæˆ–ç­‰äº<b>yï¼Œ</b>åˆ™stepå‡½æ•°å°†è¿”å›1ã€‚ å¦‚æœ<b>x</b>å°äº<b>yï¼Œ</b> <b>åˆ™ä¸º</b> 0ã€‚ <br><br> ä¾‹å¦‚ï¼Œå¦‚æœ<b>x</b> = 1ï¼Œè€Œ<b>y</b> = 0.5ï¼Œåˆ™<b>c</b>çš„ç»“æœå°†ä¸º1ã€‚ <br>  r = 1 * a + 0 * b <br> å› ä¸º ä¹˜ä»¥0å¾—åˆ°0ï¼Œåˆ™ç»“æœå°†åªæ˜¯açš„å€¼ã€‚ <br> å¦åˆ™ï¼Œå¦‚æœ<b>c</b>ä¸º0ï¼Œ <br>  r = 0 * a + 1 * b <br> æœ€ç»ˆç»“æœå°†æ˜¯<b>b</b> ã€‚ <br></div></div><br> ä¸º<i>è¦†ç›–</i>æ¨¡å¼é‡å†™é¢œè‰²ã€‚ <br><br><pre> <code class="hljs mel">fixed s = step(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); fixed4 <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = s * (<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> * texColor) + (<span class="hljs-number"><span class="hljs-number">1</span></span> - s) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> - texColor) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>));</code> </pre> <br> ç¡®ä¿è€ƒè™‘ç²¾çµçš„é€æ˜æ€§ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨ä¸¤ç§é¢œè‰²ä¹‹é—´ä½¿ç”¨çº¿æ€§æ’å€¼ã€‚ <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = lerp(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> ,texColor.a);</code> </pre> <br> å®Œæ•´ç‰‡æ®µç€è‰²å™¨ä»£ç ã€‚ <br><br><pre> <code class="hljs mel">fixed4 frag (v2f i) : SV_Target { fixed4 displPos = tex2D(_DisplacementTex, i.uv); float2 offset = (displPos.xy*<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) * _DisplacementPower * displPos.a; fixed4 texColor = tex2D(_MainTex, i.uv + offset)*i.<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; fixed4 <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> = tex2D (_GrabTexture, i.grabPos.xy + offset); fixed s = step(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); fixed4 <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = s * (<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> * texColor) + (<span class="hljs-number"><span class="hljs-number">1</span></span> - s) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> - texColor) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = lerp(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> ,texColor.a); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; }</code> </pre> <br> å’Œæˆ‘ä»¬å·¥ä½œçš„ç»“æœã€‚ <br><br><img src="https://habrastorage.org/webt/ea/au/xy/eaauxypqmxxrbcjrkl4swnctjeg.gif"><br><br><h3>  GrabPassåŠŸèƒ½ </h3><br> ä¸Šé¢å·²ç»æåˆ°<i>GrabPass</i>ä¼ é€’<i>{}</i>å°†å±å¹•çš„å†…å®¹æ•è·åˆ°<i>_GrabTexture</i>çº¹ç†ä¸­ã€‚ åŒæ—¶ï¼Œæ¯æ¬¡è°ƒç”¨æ­¤æ®µè½æ—¶ï¼Œçº¹ç†çš„å†…å®¹éƒ½ä¼šæ›´æ–°ã€‚ <br> é€šè¿‡æŒ‡å®šå°†æ•è·å±å¹•å†…å®¹çš„çº¹ç†åç§°ï¼Œå¯ä»¥é¿å…ä¸æ–­æ›´æ–°ã€‚ <br><pre> <code class="hljs objectivec">GrabPass{<span class="hljs-string"><span class="hljs-string">"_DisplacementGrabTexture"</span></span>}</code> </pre> <br> ç°åœ¨ï¼Œä»…åœ¨æ¯å¸§GrabPassä¼ é€’çš„ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ›´æ–°çº¹ç†çš„å†…å®¹ã€‚ å¦‚æœæœ‰<i>å¾ˆå¤š</i>ä½¿ç”¨<i>GrabPass {}çš„</i>å¯¹è±¡ï¼Œåˆ™å¯ä»¥èŠ‚çœèµ„æºã€‚ ä½†æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡é‡å ï¼Œåˆ™ä¼ªå½±å°†å¾ˆæ˜æ˜¾ï¼Œå› ä¸ºä¸¤ä¸ªå¯¹è±¡å°†ä½¿ç”¨ç›¸åŒçš„å›¾åƒã€‚ <br><br> ä½¿ç”¨GrabPass {â€œ _ DisplacementGrabTextureâ€}ã€‚ <br><br><img src="https://habrastorage.org/webt/9n/uv/n9/9nuvn9st0v_t9l7rwxspbmy8iww.jpeg"><br><br> ä½¿ç”¨GrabPass {}ã€‚ <br><br><img src="https://habrastorage.org/webt/sl/ai/4a/slai4akjk0suyfp43gptuyp3pfw.jpeg"><br><br><h2> åŠ¨ç”»åˆ¶ä½œ </h2><br> ç°åœ¨æ˜¯æ—¶å€™ä½¿æˆ‘ä»¬çš„æ•ˆæœåŠ¨èµ·æ¥äº†ã€‚ æˆ‘ä»¬å¸Œæœ›éšç€çˆ†ç‚¸æ³¢çš„å¢é•¿è€Œå¹³ç¨³åœ°å‡å°å˜å½¢åŠ›ï¼Œä»¥æ¨¡æ‹Ÿå…¶æ¶ˆå¤±ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹ææ–™çš„å±æ€§ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">åŠ¨ç”»è„šæœ¬</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Wave</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _elapsedTime; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer _renderer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Duration; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AnimationCurve ScaleProgress; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 ScalePower; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AnimationCurve PropertyProgress; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> PropertyPower; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AnimationCurve AlphaProgress; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _renderer = GetComponent&lt;SpriteRenderer&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _elapsedTime = <span class="hljs-number"><span class="hljs-number">0f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_elapsedTime &lt; Duration) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> progress = _elapsedTime / Duration; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scale = ScaleProgress.Evaluate(progress) * ScalePower; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> property = PropertyProgress.Evaluate(progress) * PropertyPower; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> alpha = AlphaProgress.Evaluate(progress); transform.localScale = scale; _renderer.material.SetFloat(<span class="hljs-string"><span class="hljs-string">"_DisplacementPower"</span></span>, property); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> color = _renderer.color; color.a = alpha; _renderer.color = color; _elapsedTime += Time.deltaTime; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _elapsedTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">åŠå…¶è®¾ç½®</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cs/sm/9f/cssm9fqvoequsovfl8wlff72rxu.jpeg"><br></div></div><br> åŠ¨ç”»çš„ç»“æœã€‚ <br><br><img src="https://habrastorage.org/webt/5j/sm/ic/5jsmicvf7jepmp-adecch-jlwb8.gif"><br><br><h2>  Perrendereræ•°æ® </h2><br> è¯·æ³¨æ„ä¸‹é¢çš„è¡Œã€‚ <br><br><pre> <code class="cs hljs">_renderer.material.SetFloat(<span class="hljs-string"><span class="hljs-string">"_DisplacementPower"</span></span>, property);</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ä»…åœ¨æ›´æ”¹æè´¨çš„å±æ€§ä¹‹ä¸€ï¼Œè€Œä¸”è¿˜åˆ›å»ºäº†æºæè´¨çš„å‰¯æœ¬ï¼ˆä»…åœ¨æ­¤æ–¹æ³•çš„ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼‰å¹¶å·²ç»å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ è¿™æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©ï¼Œä½†æ˜¯å¦‚æœèˆå°ä¸Šæœ‰å¤šä¸ªå¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œä¸€åƒä¸ªï¼‰ï¼Œé‚£ä¹ˆåˆ›å»ºå¦‚æ­¤å¤šçš„å‰¯æœ¬å°†ä¸ä¼šå¸¦æ¥ä»»ä½•å¥½å¤„ã€‚ æœ‰ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©-è¿™æ˜¯åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨<i>[PerRendererData]</i>å±æ€§ï¼Œåœ¨è„šæœ¬ä¸­ä½¿ç”¨<i>MaterialPropertyBlock</i>å¯¹è±¡ã€‚ <br><br> ä¸ºæ­¤ï¼Œå°†ä¸€ä¸ªå±æ€§æ·»åŠ åˆ°ç€è‰²å™¨ä¸­çš„<i>_DisplacementPower</i>å±æ€§ã€‚ <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">PerRendererData</span></span></span><span class="hljs-function">] _</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DisplacementPower</span></span></span></span> (<span class="hljs-string"><span class="hljs-string">"Displacement Power"</span></span> , Range(-.<span class="hljs-number"><span class="hljs-number">1</span></span>,.<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br> ä¹‹åï¼Œè¯¥å±æ€§å°†ä¸å†æ˜¾ç¤ºåœ¨æ£€æŸ¥å™¨ä¸­ï¼Œå› ä¸º ç°åœ¨ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ˜¯å•ç‹¬çš„ï¼Œå®ƒå°†è®¾ç½®å€¼ã€‚ <br><br><img src="https://habrastorage.org/webt/ni/g4/zu/nig4zujdlflr1xjm_ry-cwulane.jpeg"><br><br> æˆ‘ä»¬è¿”å›åˆ°è„šæœ¬å¹¶å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MaterialPropertyBlock _propertyBlock; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _renderer = GetComponent&lt;SpriteRenderer&gt;(); _propertyBlock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaterialPropertyBlock(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... <span class="hljs-comment"><span class="hljs-comment">//_renderer.material.SetFloat("_DisplacementPower", property); _renderer.GetPropertyBlock(_propertyBlock); _propertyBlock.SetFloat("_DisplacementPower", property); _renderer.SetPropertyBlock(_propertyBlock); ... }</span></span></code> </pre> <br> ç°åœ¨ï¼Œè¦æ›´æ”¹å±æ€§ï¼Œæˆ‘ä»¬å°†æ›´æ–°å¯¹è±¡çš„<i>MaterialPropertyBlock</i>è€Œä¸åˆ›å»º<i>ææ–™</i>çš„å‰¯æœ¬ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å…³äºSpriteRenderer</b> <div class="spoiler_text"> è®©æˆ‘ä»¬åœ¨ç€è‰²å™¨ä¸­æŸ¥çœ‹è¿™ä¸€è¡Œã€‚ <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">PerRendererData</span></span></span><span class="hljs-function">] _</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainTex</span></span></span></span> (<span class="hljs-string"><span class="hljs-string">"Main Texture"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {}</code> </pre> <br>  <i>SpriteRenderer</i>ä¸spritesç±»ä¼¼åœ°<i>å·¥ä½œ</i> ã€‚ å®ƒå°†ä½¿ç”¨<i>MaterialPropertyBlock</i>å°†<i>_MainTex</i>å±æ€§è®¾ç½®<i>ä¸ºå…¶</i>å€¼ã€‚ å› æ­¤ï¼Œåœ¨æ£€æŸ¥å™¨ä¸­ï¼Œä¸ä¼šä¸ºæè´¨æ˜¾ç¤º<i>_MainTex</i>å±æ€§ï¼Œåœ¨<i>SpriteRenderer</i>ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†æ‰€éœ€çš„çº¹ç†ã€‚ åŒæ—¶ï¼Œèˆå°ä¸Šå¯ä»¥æœ‰è®¸å¤šä¸åŒçš„ç²¾çµï¼Œä½†æ˜¯åªæœ‰ä¸€ç§æè´¨å¯ä»¥ç”¨äºæ¸²æŸ“ï¼ˆå¦‚æœæ‚¨è‡ªå·±ä¸æ›´æ”¹çš„è¯ï¼‰ã€‚ <br></div></div><br><h3>  PerRendererDataåŠŸèƒ½ </h3><br> æ‚¨å¯ä»¥ä»å‡ ä¹ä¸æ¸²æŸ“ç›¸å…³çš„æ‰€æœ‰ç»„ä»¶ä¸­è·å–<i>MaterialPropertyBlock</i> ã€‚ ä¾‹å¦‚ï¼Œ <i>SpriteRenderer</i> ï¼Œ <i>ParticleRenderer</i> ï¼Œ <i>MeshRenderer</i>å’Œå…¶ä»–<i>Renderer</i>ç»„ä»¶ã€‚ ä½†æ˜¯æ€»æ˜¯æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œè¿™æ˜¯<i>CanvasRenderer</i> ã€‚ ä½¿ç”¨æ­¤æ–¹æ³•æ— æ³•è·å–å’Œæ›´æ”¹å±æ€§ã€‚ å› æ­¤ï¼Œå¦‚æœä½¿ç”¨UIç»„ä»¶ç¼–å†™2Dæ¸¸æˆï¼Œåˆ™åœ¨ç¼–å†™ç€è‰²å™¨æ—¶ä¼šé‡åˆ°æ­¤é—®é¢˜ã€‚ <br><br><h2> æ—‹è½¬è§’åº¦ </h2><br> æ—‹è½¬å›¾åƒæ—¶ä¼šäº§ç”Ÿä¸æ„‰å¿«çš„æ•ˆæœã€‚ åœ¨åœ†æ³¢çš„ä¾‹å­ä¸­ï¼Œè¿™ä¸€ç‚¹å°¤å…¶æ˜æ˜¾ã€‚ <br><br> å³è½¬ï¼ˆ90åº¦ï¼‰æ—¶ï¼Œæ³¢æµªä¼šäº§ç”Ÿå¦ä¸€ä¸ªå¤±çœŸã€‚ <br><br><img src="https://habrastorage.org/webt/ns/gy/2e/nsgy2effgwcv8d0kavaltwd2ofi.jpeg"><br><br> çº¢è‰²è¡¨ç¤ºä»çº¹ç†çš„åŒä¸€ç‚¹è·å¾—çš„çŸ¢é‡ï¼Œä½†æ˜¯è¯¥çº¹ç†çš„æ—‹è½¬ä¸åŒã€‚ åç§»å€¼ä¿æŒä¸å˜ï¼Œä¸è€ƒè™‘æ—‹è½¬ã€‚ <br><br> ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<i>unity_ObjectToWorld</i>è½¬æ¢<i>çŸ©é˜µ</i> ã€‚ è¿™å°†æœ‰åŠ©äºå°†æˆ‘ä»¬çš„å‘é‡ä»å±€éƒ¨åæ ‡é‡æ–°è®¡ç®—ä¸ºä¸–ç•Œåæ ‡ã€‚ <br><br><pre> <code class="hljs pgsql">float2 <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> = (displPos.xy*<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) * _DisplacementPower * displPos.a; <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> = mul( unity_ObjectToWorld, <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>);</code> </pre> <br> ä½†æ˜¯çŸ©é˜µè¿˜åŒ…å«å¯¹è±¡æ¯”ä¾‹å°ºä¸Šçš„æ•°æ®ï¼Œå› æ­¤åœ¨æŒ‡å®šå˜å½¢å¼ºåº¦æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘å¯¹è±¡æœ¬èº«çš„æ¯”ä¾‹å°ºã€‚ <br><br><pre> <code class="cs hljs">_propertyBlock.SetFloat(<span class="hljs-string"><span class="hljs-string">"_DisplacementPower"</span></span>, property/transform.localScale.x);</code> </pre> <br> å³æ³¢ä¹Ÿæ—‹è½¬äº†90åº¦ï¼Œä½†æ˜¯ç°åœ¨å¯ä»¥æ­£ç¡®è®¡ç®—å¤±çœŸäº†ã€‚ <br><br><img src="https://habrastorage.org/webt/g4/hc/gu/g4hcguat4nxvgm0b2jyylrqvlze.jpeg"><br><br><h2> å¤¹ </h2><br> æˆ‘ä»¬çš„çº¹ç†å…·æœ‰è¶³å¤Ÿçš„é€æ˜åƒç´ ï¼ˆå°¤å…¶æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨<i>Rect</i>ç½‘æ ¼ç±»å‹ï¼‰ã€‚ ç€è‰²å™¨å¤„ç†å®ƒä»¬ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ²¡æœ‰æ„ä¹‰ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°è¯•å‡å°‘ä¸å¿…è¦çš„è®¡ç®—ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<i>clipï¼ˆxï¼‰</i>æ–¹æ³•ä¸­æ–­é€æ˜åƒç´ çš„å¤„ç†ã€‚ å¦‚æœä¼ é€’ç»™å®ƒçš„å‚æ•°å°äºé›¶ï¼Œåˆ™ç€è‰²å™¨å°†ç»“æŸã€‚ ä½†æ˜¯ç”±äºalphaå€¼ä¸èƒ½å°äº0ï¼Œå› æ­¤æˆ‘ä»¬å°†ä»ä¸­å‡å»ä¸€ä¸ªå°å€¼ã€‚ ä¹Ÿå¯ä»¥å°†å…¶ç½®äºå±æ€§ï¼ˆ <i>Cutout</i> ï¼‰ä¸­ï¼Œå¹¶ç”¨äºå‰ªåˆ‡å›¾åƒçš„é€æ˜éƒ¨åˆ†ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å•ç‹¬çš„å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬åªä½¿ç”¨æ•°å­—<b>0.01</b> ã€‚ <br><br> å®Œæ•´ç‰‡æ®µç€è‰²å™¨ä»£ç ã€‚ <br><br><pre> <code class="hljs mel">fixed4 frag (v2f i) : SV_Target { fixed4 displPos = tex2D(_DisplacementTex, i.uv); float2 offset = (displPos.xy * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) * _DisplacementPower * displPos.a; offset = mul( unity_ObjectToWorld,offset); fixed4 texColor = tex2D(_MainTex, i.uv + offset)*i.<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">clip</span></span>(texColor.a - <span class="hljs-number"><span class="hljs-number">0.01</span></span>); fixed4 <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> = tex2D (_GrabTexture, i.grabPos.xy + offset); fixed s = step(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); fixed4 <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = s * <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> * texColor + (<span class="hljs-number"><span class="hljs-number">1</span></span> - s) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> - texColor) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = lerp(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> ,texColor.a); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; }</code> </pre> <br>  PSï¼šç€è‰²å™¨å’Œè„šæœ¬çš„æºä»£ç æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">git</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é“¾æ¥</a> ã€‚ è¯¥é¡¹ç›®è¿˜å…·æœ‰ç”¨äºå˜å½¢çš„å°å‹çº¹ç†ç”Ÿæˆå™¨ã€‚ å¸¦æœ‰åŸºåº§çš„æ°´æ™¶æ˜¯ä»èµ„äº§-2Dæ¸¸æˆå¥—ä»¶ä¸­å–å‡ºçš„ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN427357/">https://habr.com/ru/post/zh-CN427357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN427347/index.html">è¿ç§»åˆ°Google Cloud Platformï¼ˆGoogle Cloud Platform-GCPï¼‰</a></li>
<li><a href="../zh-CN427349/index.html">åŸºäºå»‰ä»·CH340ä¸­æ–‡è½¬æ¢å™¨çš„æ–°å‹tinyAVRç³»åˆ—ç¼–ç¨‹å™¨</a></li>
<li><a href="../zh-CN427351/index.html">å®‰å…¨å‘¨40ï¼šCMS Drupalç­‰ä¸­çš„æ¼æ´</a></li>
<li><a href="../zh-CN427353/index.html">æ— äººæœºå±•ç¤ºï¼šæˆ‘ä»¬å¦‚ä½•åè°ƒä¸€ç¾¤é£èˆçš„ç›´å‡æœº</a></li>
<li><a href="../zh-CN427355/index.html">CJMæ±‡ç¼–ï¼Œå…³é”®è‰ºæœ¯æŒ‡å¯¼æŠ€èƒ½å’Œç”¨æˆ·ç†è§£</a></li>
<li><a href="../zh-CN427359/index.html">ECSï¼ŒCï¼ƒä½œä¸šç³»ç»Ÿå’ŒSRPå¦‚ä½•æ›´æ”¹æ¶æ„</a></li>
<li><a href="../zh-CN427361/index.html">FPGAçš„çª—å£è¿‡æ»¤åŠŸèƒ½</a></li>
<li><a href="../zh-CN427363/index.html">LoRaWANåœ¨å†œä¸šä¼ä¸šä¸­çš„å®æ–½ã€‚ æœ‰å…³å»ºè®¾ï¼Œå¯åŠ¨å’Œè§£å†³æ–¹æ¡ˆçš„ä¸€åˆ‡</a></li>
<li><a href="../zh-CN427365/index.html">RedSlermå…³äºç›‘è§†çš„æŠ¥å‘Šï¼ˆMonitï¼ŒZabbixï¼‰</a></li>
<li><a href="../zh-CN427367/index.html">é»‘å¸½ç¾å›½ä¼šè®®ã€‚ å¥½è±åé»‘å®¢å¦‚ä½•ä½¿ç”¨ç›‘æ§æ‘„åƒå¤´ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>