<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåö üéÄ üë®‚Äç‚öñÔ∏è Grundlegendes zum Kontextpaket in Golang üéÅ üõçÔ∏è üë®üèº‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Kontextpaket in Go ist n√ºtzlich f√ºr Interaktionen mit APIs und langsamen Prozessen, insbesondere in Systemen mit Produktionsqualit√§t, die Webanfor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Grundlegendes zum Kontextpaket in Golang</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/nixys/blog/461723/"><p><img src="https://habrastorage.org/getpro/habr/post_images/2f4/49e/54b/2f449e54b5540578a8ead5599e9e7f0e.jpg" alt="Bild"></p><br><p>  Das Kontextpaket in Go ist n√ºtzlich f√ºr Interaktionen mit APIs und langsamen Prozessen, insbesondere in Systemen mit Produktionsqualit√§t, die Webanforderungen verarbeiten.  Mit ihrer Hilfe k√∂nnen Goroutinen √ºber die Notwendigkeit informiert werden, ihre Arbeit abzuschlie√üen. </p><br><p>  Im Folgenden finden Sie eine kleine Anleitung, die Ihnen bei der Verwendung dieses Pakets in Ihren Projekten hilft, sowie einige der Best Practices und Fallstricke. </p><br><p>  <em>(Hinweis Lane: Der Kontext wird in vielen Paketen verwendet, z. B. bei der Arbeit mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Docker.</a> )</em> </p><a name="habracut"></a><br><h2 id="pered-tem-kak-nachat">  Bevor Sie anfangen </h2><br><p>  Um Kontexte verwenden zu k√∂nnen, m√ºssen Sie verstehen, was Goroutine und Kan√§le sind.  Ich werde versuchen, sie kurz zu betrachten.  Wenn Sie bereits mit ihnen vertraut sind, gehen Sie direkt zum Abschnitt Kontext. </p><br><h3 id="gorutina">  Gorutin </h3><br><p>  Die offizielle Dokumentation besagt, dass "Gorutin ein leichter Strom der Ausf√ºhrung ist."  Goroutinen sind leichter als Threads, daher ist ihre Verwaltung relativ weniger ressourcenintensiv. </p><br><p>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sandkasten</a> </p><br><pre><code class="plaintext hljs">package main import "fmt" // ,   Hello func printHello() { fmt.Println("Hello from printHello") } func main() { //   //       go func(){fmt.Println("Hello inline")}() //     go printHello() fmt.Println("Hello from main") }</code> </pre> <br><p>  Wenn Sie dieses Programm ausf√ºhren, werden Sie sehen, dass nur <code>Hello from main</code> gedruckt wird.  Tats√§chlich beginnen beide Goroutinen, aber die Hauptenden enden fr√ºher.  Die Goroutinen brauchen also einen Weg, um <code>main</code> √ºber das Ende ihrer Hinrichtung zu informieren, und damit sie darauf wartet.  Hier helfen uns Kan√§le. </p><br><h3 id="kanaly-channels">  Kan√§le </h3><br><p>  Kan√§le sind eine Art der Kommunikation zwischen Goroutinen.  Sie werden verwendet, wenn Sie Ergebnisse, Fehler oder andere Informationen von einer Goroutine auf eine andere √ºbertragen m√∂chten.  Es gibt verschiedene Arten von Kan√§len, z. B. empf√§ngt ein Kanal vom Typ <code>int</code> Ganzzahlen und ein Kanal vom Typ <code>error</code> empf√§ngt Fehler usw. </p><br><p>  Angenommen, wir haben einen Kanal vom Typ <code>int</code> .  Wenn Sie etwas an den Kanal senden m√∂chten, lautet die Syntax <code>ch &lt;- 1</code> .  Sie k√∂nnen etwas aus dem Kanal wie folgt erhalten: <code>var := &lt;- ch</code> , d.h.  Nehmen Sie den Wert aus dem Kanal und speichern Sie ihn in der Variablen <code>var</code> . </p><br><p>  Der folgende Code zeigt, wie Sie mithilfe der Kan√§le best√§tigen, dass die Goroutinen ihre Arbeit abgeschlossen und ihre Werte an <code>main</code> . </p><br><p>  <em>Hinweis: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wartende Gruppen</a> k√∂nnen auch f√ºr die Synchronisierung verwendet werden. In diesem Artikel habe ich jedoch Kan√§le f√ºr Codebeispiele ausgew√§hlt, da wir sie sp√§ter im Kontextabschnitt verwenden werden.</em> </p><br><p>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sandkasten</a> </p><br><pre> <code class="plaintext hljs">package main import "fmt" //       int   func printHello(ch chan int) { fmt.Println("Hello from printHello") //     ch &lt;- 2 } func main() { //  .       make //       : // ch := make(chan int, 2),       . ch := make(chan int) //  .  ,    . //       go func(){ fmt.Println("Hello inline") //     ch &lt;- 1 }() //     go printHello(ch) fmt.Println("Hello from main") //      //     ,    i := &lt;- ch fmt.Println("Received ",i) //      //    ,      &lt;- ch }</code> </pre> <br><h2 id="kontekst-context">  Kontext </h2><br><p>  Mit dem Kontextpaket in go k√∂nnen Sie Daten in einer Art ‚ÄûKontext‚Äú an Ihr Programm √ºbergeben.  Der Kontext, wie eine Zeit√ºberschreitung, eine Frist oder ein Kanal, signalisiert ein Herunterfahren und die R√ºckgabe von Anrufen. </p><br><p>  Wenn Sie beispielsweise eine Webanforderung stellen oder einen Systembefehl ausf√ºhren, empfiehlt es sich, eine Zeit√ºberschreitung f√ºr Systeme mit Produktionsqualit√§t zu verwenden.  Wenn die API, auf die Sie zugreifen, langsam ist, ist es unwahrscheinlich, dass Sie Anforderungen in Ihrem System akkumulieren m√∂chten, da dies zu einer erh√∂hten Auslastung und einer verringerten Leistung bei der Verarbeitung Ihrer eigenen Anforderungen f√ºhren kann.  Das Ergebnis ist ein Kaskadeneffekt. </p><br><p>  Und hier kann der Timeout- oder Deadline-Kontext genau richtig sein. </p><br><h3 id="sozdanie-konteksta">  Kontexterstellung </h3><br><p>  Mit dem Kontextpaket k√∂nnen Sie den Kontext auf folgende Weise erstellen und erben: </p><br><p>  <strong>context.Background () ctx Kontext</strong> </p><br><p>  Diese Funktion gibt einen leeren Kontext zur√ºck.  Es sollte nur auf einer hohen Ebene verwendet werden (im Haupt- oder im Anforderungshandler der h√∂chsten Ebene).  Es kann verwendet werden, um andere Kontexte zu erhalten, die wir sp√§ter diskutieren werden. </p><br><pre> <code class="plaintext hljs">ctx, cancel := context.Background()</code> </pre> <br><p>  <em>Hinweis</em>  <em>trans.: Es gibt eine Ungenauigkeit im Originalartikel, das richtige Beispiel f√ºr die Verwendung von <code>context.Background</code> ist der folgende:</em> </p><br><pre> <code class="plaintext hljs">ctx := context.Background()</code> </pre> <br><p>  <strong>context.TODO () ctx Kontext</strong> </p><br><p>  Diese Funktion erstellt auch einen leeren Kontext.  Und es sollte auch nur auf hoher Ebene verwendet werden, entweder wenn Sie nicht sicher sind, welchen Kontext Sie verwenden sollen, oder wenn die Funktion noch nicht den gew√ºnschten Kontext empf√§ngt.  Dies bedeutet, dass Sie (oder jemand, der den Code unterst√ºtzt) planen, der Funktion sp√§ter Kontext hinzuzuf√ºgen. </p><br><pre> <code class="plaintext hljs">ctx, cancel := context.TODO()</code> </pre> <br><p>  <em>Hinweis</em>  <em>trans.: Der Originalartikel enth√§lt eine Ungenauigkeit, das richtige Beispiel f√ºr die Verwendung von <code>context.TODO</code> wie folgt:</em> </p><br><pre> <code class="plaintext hljs">ctx := context.TODO()</code> </pre> <br><p>  Interessanterweise werfen Sie einen Blick auf den <a href="">Code</a> , er ist absolut der gleiche wie der Hintergrund.  Der einzige Unterschied besteht darin, dass Sie in diesem Fall die statischen Analysetools verwenden k√∂nnen, um die G√ºltigkeit der Kontext√ºbertragung zu √ºberpr√ºfen. Dies ist ein wichtiges Detail, da diese Tools dazu beitragen, potenzielle Fehler fr√ºhzeitig zu erkennen und in die CI / CD-Pipeline aufgenommen werden k√∂nnen. </p><br><p>  <a href="">Von hier aus</a> : </p><br><pre> <code class="plaintext hljs">var ( background = new(emptyCtx) todo = new(emptyCtx) )</code> </pre> <br><p>  <strong>context.WithValue (√ºbergeordneter Kontext, Schl√ºssel, val-Schnittstelle {}) (ctx-Kontext, Abbrechen CancelFunc)</strong> </p><br><p>  <em>Hinweis</em>  <em>Lane: Es gibt eine Ungenauigkeit im Originalartikel, die korrekte Signatur f√ºr den <code>context.WithValue</code> wird wie folgt lauten:</em> </p><br><pre> <code class="plaintext hljs">context.WithValue(parent Context, key, val interface{}) Context</code> </pre> <br><p>  Diese Funktion nimmt einen Kontext und gibt einen daraus abgeleiteten Kontext zur√ºck, in dem der Wert <code>val</code> <code>key</code> und den gesamten Kontextbaum durchl√§uft.  Das hei√üt, sobald Sie einen <code>WithValue</code> Kontext erstellen, <code>WithValue</code> jeder abgeleitete Kontext diesen Wert. </p><br><p>  Es wird nicht empfohlen, kritische Parameter mithilfe von Kontextwerten zu √ºbergeben. Stattdessen sollten Funktionen diese explizit in der Signatur √ºbernehmen. </p><br><pre> <code class="plaintext hljs">ctx := context.WithValue(context.Background(), key, "test")</code> </pre> <br><p>  <strong>context.WithCancel (√ºbergeordneter Kontext) (ctx-Kontext, Abbrechen von CancelFunc)</strong> </p><br><p>  Hier wird es etwas interessanter.  Diese Funktion erstellt einen neuen Kontext aus dem an sie √ºbergebenen √ºbergeordneten Element.  Das √ºbergeordnete Element kann der Hintergrundkontext oder der Kontext sein, der als Argument an die Funktion √ºbergeben wird. </p><br><p>  Der abgeleitete Kontext und die R√ºckg√§ngig-Funktion werden zur√ºckgegeben.  Nur die Funktion, die es erstellt, sollte die Funktion aufrufen, um den Kontext abzubrechen.  Sie k√∂nnen die R√ºckg√§ngig-Funktion an andere Funktionen √ºbergeben, wenn Sie m√∂chten. Dies wird jedoch dringend empfohlen.  In der Regel wird diese Entscheidung aufgrund eines Missverst√§ndnisses der Kontextstornierung getroffen.  Aus diesem Grund k√∂nnen von diesem √ºbergeordneten Element generierte Kontexte das Programm beeinflussen, was zu einem unerwarteten Ergebnis f√ºhrt.  Kurz gesagt, es ist besser, NIEMALS eine Abbruchfunktion zu √ºbergeben. </p><br><pre> <code class="plaintext hljs">ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(2 * time.Second))</code> </pre> <br><p>  <em>Hinweis</em>  <em>Lane: Im Originalartikel hat der Autor anscheinend f√§lschlicherweise den <code>context.WithCancel</code> <code>context.WithDeadline</code> . <code>context.WithCancel</code> gab ein Beispiel mit <code>context.WithDeadline</code> .</em>  <em>Das richtige Beispiel f√ºr <code>context.WithCancel</code> w√§re:</em> </p><br><pre> <code class="plaintext hljs">ctx, cancel := context.WithCancel(context.Background())</code> </pre> <br><p>  <strong>context.WithDeadline (√ºbergeordneter Kontext, d time.Time) (ctx-Kontext, Abbrechen von CancelFunc)</strong> </p><br><p>  Diese Funktion gibt einen abgeleiteten Kontext von ihrem √ºbergeordneten Kontext zur√ºck, der nach einer Frist oder einem Aufruf der Abbruchfunktion abgebrochen wird.  Sie k√∂nnen beispielsweise einen Kontext erstellen, der zu einem bestimmten Zeitpunkt automatisch abgebrochen und an untergeordnete Funktionen weitergegeben wird.  Wenn dieser Kontext nach Ablauf der Frist abgebrochen wird, sollten alle Funktionen, die diesen Kontext haben, durch Benachrichtigung benachrichtigt werden. </p><br><pre> <code class="plaintext hljs">ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(2 * time.Second))</code> </pre> <br><p>  <strong>context.WithTimeout (√ºbergeordneter Kontext, timeout time.Duration) (ctx-Kontext, Abbrechen von CancelFunc)</strong> </p><br><p>  Diese Funktion √§hnelt dem Kontext.WithDeadline.  Der Unterschied besteht darin, dass die Zeitdauer als Eingabe verwendet wird.  Diese Funktion gibt einen abgeleiteten Kontext zur√ºck, der beim Aufruf der Abbruchfunktion oder nach einer bestimmten Zeit abgebrochen wird. </p><br><pre> <code class="plaintext hljs">ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(2 * time.Second))</code> </pre> <br><p>  <em>Hinweis</em>  <em>Lane: Im Originalartikel hat der Autor anscheinend f√§lschlicherweise den <code>context.WithTimeout</code> <code>context.WithDeadline</code> . <code>context.WithTimeout</code> gab ein Beispiel mit <code>context.WithDeadline</code> .</em>  <em>Das richtige Beispiel f√ºr den <code>context.WithTimeout</code> w√§re dies:</em> </p><br><pre> <code class="plaintext hljs">ctx, cancel := context.WithTimeout(context.Background(), 2 * time.Second)</code> </pre> <br><h3 id="priyom-i-ispolzovanie-kontekstov-v-vashih-funkciyah">  Empfang und Verwendung von Kontexten in Ihren Funktionen </h3><br><p>  Nachdem wir nun wissen, wie Kontexte erstellt werden (Hintergrund und TODO) und wie Kontexte generiert werden (WithValue, WithCancel, Deadline und Timeout), wollen wir diskutieren, wie sie verwendet werden. </p><br><p>  Im folgenden Beispiel k√∂nnen Sie sehen, dass die Funktion, die den Kontext verwendet, die Goroutine startet und erwartet, dass sie den Kontext zur√ºckgibt oder abbricht.  Die select-Anweisung hilft uns zu bestimmen, was zuerst passiert, und die Funktion zu beenden. </p><br><p>  Nach dem Schlie√üen des Kanals Done <code>&lt;-ctx.Done()</code> wird der Fall <code>case &lt;-ctx.Done():</code> ausgew√§hlt.  Sobald dies geschieht, sollte die Funktion die Arbeit unterbrechen und sich auf eine R√ºckkehr vorbereiten.  Dies bedeutet, dass Sie alle offenen Verbindungen schlie√üen, Ressourcen freigeben und von der Funktion zur√ºckkehren m√ºssen.  Es gibt Zeiten, in denen die Freigabe von Ressourcen die R√ºckgabe verz√∂gern kann, z. B. h√§ngt die Bereinigung.  Sie m√ºssen dies ber√ºcksichtigen. </p><br><p>  Das Beispiel, das diesem Abschnitt folgt, ist ein vollst√§ndig abgeschlossenes Go-Programm, das Zeit√ºberschreitungen und R√ºckg√§ngig-Funktionen veranschaulicht. </p><br><pre> <code class="plaintext hljs">// ,  -      // ,   -    func sleepRandomContext(ctx context.Context, ch chan bool) { //  (. .:  )    //     // ,    defer func() { fmt.Println("sleepRandomContext complete") ch &lt;- true }() //   sleeptimeChan := make(chan int) //       //     go sleepRandom("sleepRandomContext", sleeptimeChan) //  select        select { case &lt;-ctx.Done(): //   ,    //  ,     -   //    ,    ( ) //    -  , //    ,   //         fmt.Println("Time to return") case sleeptime := &lt;-sleeptimeChan: //   ,       fmt.Println("Slept for ", sleeptime, "ms") } }</code> </pre> <br><h3 id="primer">  Beispiel </h3><br><p>  Wie wir gesehen haben, k√∂nnen Sie mithilfe von Kontexten mit Fristen und Zeit√ºberschreitungen arbeiten und auch die Abbruchfunktion aufrufen, um allen Funktionen mithilfe eines abgeleiteten Kontexts klar zu machen, dass Sie Ihre Arbeit abschlie√üen und die R√ºckgabe ausf√ºhren m√ºssen.  Betrachten Sie ein Beispiel: </p><br><p>  Hauptfunktion: </p><br><ul><li>  Erstellt einen Abbruchfunktionskontext </li><li>  Ruft die Abbruchfunktion nach einer beliebigen Zeit√ºberschreitung auf </li></ul><br><p>  <code>doWorkContext</code> Funktion: </p><br><ul><li>  Erstellt einen abgeleiteten Kontext mit einer Zeit√ºberschreitung </li><li>  Dieser Kontext wird abgebrochen, wenn die Hauptfunktion cancelFunction aufruft, das Timeout abl√§uft oder doWorkContext seine cancelFunction aufruft. </li><li>  F√ºhrt Goroutine aus, um eine langsame Aufgabe auszuf√ºhren, wobei der resultierende Kontext √ºbergeben wird </li><li>  Wartet darauf, dass die Goroutinen abgeschlossen sind oder der Kontext von main gel√∂scht wird, je nachdem, was zuerst eintritt </li></ul><br><p>  <code>sleepRandomContext</code> Funktion: </p><br><ul><li>  Startet Goroutine, um eine langsame Aufgabe auszuf√ºhren </li><li>  Wartet, bis die Goroutine fertig ist, oder </li><li>  Wartet darauf, dass der Kontext von der Hauptfunktion abgebrochen wird, Timeout oder ruft seine eigene cancelFunction auf </li></ul><br><p>  <code>sleepRandom</code> Funktion: </p><br><ul><li>  Schl√§ft zuf√§llig ein </li></ul><br><p>  In diesem Beispiel wird der Ruhemodus verwendet, um eine zuf√§llige Verarbeitungszeit zu simulieren. In der Realit√§t k√∂nnen Sie jedoch Kan√§le verwenden, um diese Funktion √ºber den Beginn der Reinigung zu signalisieren und auf die Best√§tigung des Kanals zu warten, dass die Reinigung abgeschlossen ist. </p><br><p>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sandbox</a> (Es sieht so aus, als ob die zuf√§llige Zeit, die ich in der Sandbox verwende, praktisch unver√§ndert ist. Versuchen Sie dies auf Ihrem lokalen Computer, um die Zuf√§lligkeit zu sehen.)</em> </p><br><p>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> </p><br><pre> <code class="plaintext hljs">package main import ( "context" "fmt" "math/rand" "Time" ) //   func sleepRandom(fromFunction string, ch chan int) { //    defer func() { fmt.Println(fromFunction, "sleepRandom complete") }() //    //   , // ¬´¬ª      seed := time.Now().UnixNano() r := rand.New(rand.NewSource(seed)) randomNumber := r.Intn(100) sleeptime := randomNumber + 100 fmt.Println(fromFunction, "Starting sleep for", sleeptime, "ms") time.Sleep(time.Duration(sleeptime) * time.Millisecond) fmt.Println(fromFunction, "Waking up, slept for ", sleeptime, "ms") //   ,     if ch != nil { ch &lt;- sleeptime } } // ,       // ,   -    func sleepRandomContext(ctx context.Context, ch chan bool) { //  (. .:  )    //     // ,    defer func() { fmt.Println("sleepRandomContext complete") ch &lt;- true }() //   sleeptimeChan := make(chan int) //       //     go sleepRandom("sleepRandomContext", sleeptimeChan) //  select        select { case &lt;-ctx.Done(): //   ,    //  ,    doWorkContext  // doWorkContext  main  cancelFunction //  ,     -   //    ,    ( ) //    -  , //    ,   //         fmt.Println("sleepRandomContext: Time to return") case sleeptime := &lt;-sleeptimeChan: //   ,       fmt.Println("Slept for ", sleeptime, "ms") } } //  ,         //       //   ,      main func doWorkContext(ctx context.Context) { //          - //  150  //  ,   ,   150  ctxWithTimeout, cancelFunction := context.WithTimeout(ctx, time.Duration(150)*time.Millisecond) //         defer func() { fmt.Println("doWorkContext complete") cancelFunction() }() //       //         , //      ,    ch := make(chan bool) go sleepRandomContext(ctxWithTimeout, ch) //  select      select { case &lt;-ctx.Done(): //   ,           //     ,   main   cancelFunction fmt.Println("doWorkContext: Time to return") case &lt;-ch: //   ,       fmt.Println("sleepRandomContext returned") } } func main() { //   background ctx := context.Background() //     ctxWithCancel, cancelFunction := context.WithCancel(ctx) //      //        defer func() { fmt.Println("Main Defer: canceling context") cancelFunction() }() //     - //   ,        go func() { sleepRandom("Main", nil) cancelFunction() fmt.Println("Main Sleep complete. canceling context") }() //   doWorkContext(ctxWithCancel) }</code> </pre> <br><h3 id="podvodnye-kamni">  Fallstricke </h3><br><p>  Wenn die Funktion den Kontext verwendet, stellen Sie sicher, dass Stornierungsbenachrichtigungen ordnungsgem√§√ü behandelt werden.  Beispielsweise schlie√üt <code>exec.CommandContext</code> nicht, bis der Befehl alle vom Prozess ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> ) erstellten Gabeln abgeschlossen hat, d. H., Dass das Abbrechen des Kontexts nicht sofort von der Funktion zur√ºckkehrt, wenn Sie mit cmd.Wait () warten. bis alle Gabeln des externen Befehls die Verarbeitung abgeschlossen haben. </p><br><p>  Wenn Sie ein Timeout oder eine Frist mit einer maximalen Laufzeit verwenden, funktioniert dies m√∂glicherweise nicht wie erwartet.  In solchen F√§llen ist es besser, Timeouts mithilfe von <code>time.After</code> zu implementieren. </p><br><h3 id="luchshie-praktiki">  Best Practices </h3><br><ol><li>  context.Background sollte nur auf der h√∂chsten Ebene als Wurzel aller abgeleiteten Kontexte verwendet werden. </li><li>  context.TODO sollte verwendet werden, wenn Sie nicht sicher sind, was Sie verwenden sollen, oder wenn die aktuelle Funktion in Zukunft den Kontext verwenden wird. </li><li>  Es wird empfohlen, den Kontext zu l√∂schen. Das L√∂schen und Beenden dieser Funktionen kann jedoch einige Zeit dauern. </li><li>  context.Value sollte so sparsam wie m√∂glich verwendet werden und nicht zum √úbergeben optionaler Parameter verwendet werden.  Dies macht die API unverst√§ndlich und kann zu Fehlern f√ºhren.  Solche Werte sollten als Argumente √ºbergeben werden. </li><li>  Speichern Sie Kontexte nicht in einer Struktur, sondern √ºbergeben Sie sie explizit in Funktionen, vorzugsweise als erstes Argument. </li><li>  √úbergeben Sie niemals einen Null-Kontext als Argument.  Verwenden Sie im Zweifelsfall TODO. </li><li>  Die <code>Context</code> verf√ºgt nicht √ºber eine Abbruchmethode, da nur die Funktion, die den Kontext erzeugt, ihn abbrechen sollte. </li></ol><br><h3 id="ot-perevodchika">  Vom √úbersetzer </h3><br><p>  In unserem Unternehmen verwenden wir das Context-Paket aktiv bei der Entwicklung von Serveranwendungen f√ºr den internen Gebrauch.  Solche Anwendungen f√ºr das normale Funktionieren erfordern jedoch zus√§tzlich zum Kontext zus√§tzliche Elemente, wie z. </p><br><ul><li>  Protokollierung </li><li>  Signalverarbeitung zum Beenden, Neuladen und Protokollieren der Anwendung </li><li>  Arbeiten Sie mit PID-Dateien </li><li>  Arbeiten Sie mit Konfigurationsdateien </li><li>  Usw </li></ul><br><p>  Aus diesem Grund haben wir uns irgendwann entschlossen, alle unsere Erfahrungen zusammenzufassen, und Hilfspakete erstellt, die das Schreiben von Anwendungen (insbesondere Anwendungen mit APIs) erheblich vereinfachen.  Wir haben unsere Entwicklungen √∂ffentlich zug√§nglich gemacht und jeder kann sie nutzen.  Im Folgenden finden Sie einige Links zu Paketen, die zur L√∂sung solcher Probleme hilfreich sind: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nxs-go-appctx</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nxs-go-conf</a> </li></ul><br><p>  Lesen Sie auch andere Artikel in unserem Blog: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Drei einfache Tricks zum Reduzieren von Docker-Bildern</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stateful Backups in Kubernetes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sichern einer gro√üen Anzahl heterogener Webprojekte</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Telegrammbot f√ºr Redmine.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wie Sie das Leben f√ºr sich und die Menschen vereinfachen k√∂nnen</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de461723/">https://habr.com/ru/post/de461723/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de461713/index.html">4 M√∂glichkeiten zum Speichern von Cloud-Backups</a></li>
<li><a href="../de461715/index.html">Angst und Abscheu als Techdir</a></li>
<li><a href="../de461717/index.html">So komprimieren Sie bis zu 90% der Speicherung von Sicherungen im Objektspeicher</a></li>
<li><a href="../de461719/index.html">Open Source-L√∂sung f√ºr die Berichtsautomatisierung</a></li>
<li><a href="../de461721/index.html">Neue Cluster-Analysemethode</a></li>
<li><a href="../de461725/index.html">DataGrip 2019.2: Verbindungsmanagement, Datensuche, Filterung in der Navigation</a></li>
<li><a href="../de461727/index.html">Cisco Small Business Solutions: Ein gutes Netzwerk ist nicht unbedingt teuer</a></li>
<li><a href="../de461729/index.html">Verwenden von Jailbreaking zum Extrahieren von Daten: Risiken und Konsequenzen</a></li>
<li><a href="../de461731/index.html">DPKI: Beseitigung der Nachteile einer zentralisierten PKI durch Blockchain</a></li>
<li><a href="../de461733/index.html">Englisch lernen: 9 amerikanische Redewendungen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>