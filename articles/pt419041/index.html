<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí§ üë®üèø‚Äçüîß üíÖüèø Os nove ancinhos do Elasticsearch em que pisei ü§òüèª ‚öíÔ∏è üî™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúUma pessoa treinada tamb√©m est√° pisando em um ancinho. 
 Mas, por outro lado, onde est√° a caneta. 

 O Elasticsearch √© uma √≥tima ferramenta, mas cada...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Os nove ancinhos do Elasticsearch em que pisei</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/419041/"><img src="https://habrastorage.org/webt/ap/2k/jc/ap2kjcsehhaliahrmgg6a3r27xw.jpeg" alt="Ilustra√ß√£o de Anton Gudim"><br><br><br>  <i>‚ÄúUma pessoa treinada tamb√©m est√° pisando em um ancinho.</i> <i><br></i>  <i>Mas, por outro lado, onde est√° a caneta.</i> <br><br>  O Elasticsearch √© uma √≥tima ferramenta, mas cada ferramenta requer n√£o apenas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ajuste</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">manuten√ß√£o</a> , mas tamb√©m aten√ß√£o aos detalhes.  Alguns s√£o insignificantes e jazem na superf√≠cie, enquanto outros est√£o escondidos t√£o fundo que levar√° mais de um dia para procurar, nem uma d√∫zia de x√≠caras de caf√© e nem um quil√¥metro de nervos.  Neste artigo, vou falar sobre nove ancinhos maravilhosos nas configura√ß√µes el√°sticas em que pisei. <br><a name="habracut"></a><br>  Vou organizar o rake em ordem decrescente de evid√™ncia.  Das que podem ser previstas e contornadas na fase de cria√ß√£o e entrada de um cluster no estado de produ√ß√£o, √†s muito estranhas que trazem mais experi√™ncia (e estrelas nos olhos). <br><br><h2>  N√≥s de dados devem ser os mesmos </h2><br>  ‚ÄúO cluster est√° executando na velocidade do n√≥ de dados mais lento‚Äù - um axioma agonizado.  Mas h√° outro ponto √≥bvio que n√£o est√° relacionado ao desempenho: o el√°stico pensa n√£o no espa√ßo em disco, mas nos fragmentos, e tenta distribu√≠-los uniformemente entre os n√≥s de dados.  Se alguns dos n√≥s de dados tiverem mais espa√ßo que outros, ser√° in√∫til permanecer ocioso. <br><br><h2>  Deprecation.log </h2><br>  Pode acontecer que algu√©m n√£o use os meios mais modernos de enviar dados para o el√°stico, que n√£o pode definir o Tipo de Conte√∫do ao executar consultas.  Nesta lista, por exemplo, heka, ou quando os logs deixarem os dispositivos por seus meios internos).  Nesse caso, descontinua√ß√£o.  o log come√ßa a crescer a uma taxa alarmante e, para cada solicita√ß√£o, as seguintes linhas aparecem nele: <br><br><pre><code class="hljs markdown">[<span class="hljs-string"><span class="hljs-string">2018-07-07T14:10:26,659</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">WARN </span></span>][<span class="hljs-string"><span class="hljs-string">oedrRestController</span></span>] Content type detection for rest requests is deprecated. Specify the content type using the [<span class="hljs-string"><span class="hljs-string">Content-Type</span></span>] header. [<span class="hljs-string"><span class="hljs-string">2018-07-07T14:10:26,670</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">WARN </span></span>][<span class="hljs-string"><span class="hljs-string">oedrRestController</span></span>] Content type detection for rest requests is deprecated. Specify the content type using the [<span class="hljs-string"><span class="hljs-string">Content-Type</span></span>] header. [<span class="hljs-string"><span class="hljs-string">2018-07-07T14:10:26,671</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">WARN </span></span>][<span class="hljs-string"><span class="hljs-string">oedrRestController</span></span>] Content type detection for rest requests is deprecated. Specify the content type using the [<span class="hljs-string"><span class="hljs-string">Content-Type</span></span>] header. [<span class="hljs-string"><span class="hljs-string">2018-07-07T14:10:26,673</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">WARN </span></span>][<span class="hljs-string"><span class="hljs-string">oedrRestController</span></span>] Content type detection for rest requests is deprecated. Specify the content type using the [<span class="hljs-string"><span class="hljs-string">Content-Type</span></span>] header. [<span class="hljs-string"><span class="hljs-string">2018-07-07T14:10:26,677</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">WARN </span></span>][<span class="hljs-string"><span class="hljs-string">oedrRestController </span></span>] Content type detection for rest requests is deprecated. Specify the content type using the [Content-Type] header.</code> </pre> <br>  As solicita√ß√µes ocorrem, em m√©dia, a cada 5 a 10 ms - e sempre que uma nova linha √© adicionada ao log.  Isso afeta negativamente o desempenho do subsistema de disco e aumenta o iowait.  O Deprecation.log pode ser desativado, mas n√£o √© muito razo√°vel.  Para coletar logs el√°sticos nele, mas n√£o para o lixo, desabilito apenas os logs da classe oedrRestController. <br><br>  Para fazer isso, inclua a seguinte constru√ß√£o em logs4j2.properties: <br><br><pre> <code class="hljs pgsql">logger.restcontroller.name = org.elasticsearch.deprecation.rest.RestController logger.restcontroller.<span class="hljs-keyword"><span class="hljs-keyword">level</span></span> = error</code> </pre><br>  Ele elevar√° os logs dessa classe para o n√≠vel de erro e eles n√£o cair√£o mais no deprecation.log. <br><br><h2>  .kibana </h2><br>  Como √© um processo t√≠pico de instala√ß√£o de cluster?  Colocamos os n√≥s, combinamos em um cluster, colocamos o x-pack (quem precisa dele) e, claro, o Kibana.  Come√ßamos, verificamos que tudo est√° funcionando e o Kibana v√™ o cluster e continuamos a configurar.  O problema √© que, em um cluster rec√©m-instalado, o modelo padr√£o √© mais ou menos assim: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"order"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"template"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"settings"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"number_of_shards"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"number_of_replicas"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"mappings"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"aliases"</span></span>: {} }</code> </pre> <br>  E o √≠ndice .kibana, onde todas as configura√ß√µes s√£o armazenadas, √© criado em uma √∫nica c√≥pia. <br><br>  Houve um caso em que, devido a uma falha de hardware, um dos n√≥s de dados no cluster foi morto.  Ele chegou rapidamente a um estado consistente, gerando r√©plicas de fragmentos de n√≥s de dados vizinhos, mas, felizmente, foi nesse n√≥ de dados que o √∫nico fragmento com o √≠ndice .kibana foi localizado.  A situa√ß√£o √© impass√≠vel - o cluster est√° ativo, em condi√ß√µes de trabalho, e Kibana est√° no status vermelho, e meu telefone √© interrompido por telefonemas de funcion√°rios que precisam urgentemente de seus registros. <br><br>  Tudo isso √© resolvido simplesmente.  At√© agora, nada caiu: <br><br><pre> <code class="hljs objectivec">XPUT .kibana/_settings { <span class="hljs-string"><span class="hljs-string">"index"</span></span>: { <span class="hljs-string"><span class="hljs-string">"number_of_replicas"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;__&gt;"</span></span> } }</code> </pre> <br><h2>  XMX / XMS </h2><br>  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> diz "N√£o mais que 32 GB", e com raz√£o.  Mas tamb√©m √© correto que voc√™ n√£o precise instalar nas configura√ß√µes de servi√ßo <br><pre> <code class="hljs powershell"><span class="hljs-literal"><span class="hljs-literal">-Xms32g</span></span> <span class="hljs-literal"><span class="hljs-literal">-Xmx32g</span></span></code> </pre> <br>  Como ele j√° tem mais de 32 gigabytes, e aqui encontramos uma nuance interessante de Java trabalhando com mem√≥ria.  Acima de um certo limite, o Java deixa de usar ponteiros compactados e come√ßa a consumir uma quantidade excessiva de mem√≥ria.  Verificar se os ponteiros compactados usam uma m√°quina Java executando o Elasticsearch √© muito simples.  Examinamos o log de servi√ßo: <br><br><pre> <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">07</span></span>-<span class="hljs-number"><span class="hljs-number">29</span></span><span class="hljs-type"><span class="hljs-type">T15</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>,<span class="hljs-number"><span class="hljs-number">041</span></span>][<span class="hljs-type"><span class="hljs-type">INFO</span></span>][<span class="hljs-type"><span class="hljs-type">oeeNodeEnvironment</span></span>][<span class="hljs-type"><span class="hljs-type">log</span></span>-<span class="hljs-type"><span class="hljs-type">elastic</span></span>-<span class="hljs-type"><span class="hljs-type">hot3</span></span>] heap size [<span class="hljs-number"><span class="hljs-number">31.6</span></span><span class="hljs-type"><span class="hljs-type">gb</span></span>], compressed ordinary object pointers [<span class="hljs-type"><span class="hljs-type">true</span></span>]</code> </pre> <br>  A quantidade de mem√≥ria que n√£o deve ser excedida depende, inter alia, da vers√£o do Java usada.  Para calcular o volume exato no seu caso, consulte a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> . <br><br>  Agora eu instalei em todos os n√≥s de dados do elastic: <br><br><pre> <code class="hljs powershell"><span class="hljs-literal"><span class="hljs-literal">-Xms32766m</span></span> <span class="hljs-literal"><span class="hljs-literal">-Xmx32766m</span></span></code> </pre> <br>  Parece ser um fato banal, e a documenta√ß√£o est√° bem descrita, mas encontro regularmente instala√ß√µes do Elasticsearch onde perdi esse ponto e Xms / Xmx est√° definido como 32g. <br><br><h2>  / var / lib / elasticsearch </h2><br>  Esse √© o caminho padr√£o para armazenar dados na elasticsearch.  yml: <br><br><pre> <code class="hljs kotlin">path.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/elasticsearch</code> </pre> <br>  Normalmente, eu monto uma grande matriz RAID e aqui est√° o porqu√™: especificamos o ES de v√°rias maneiras para armazenar dados, por exemplo, assim: <br><br><pre> <code class="hljs kotlin">path.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/elasticsearch/data1, /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/elasticsearch/data2</code> </pre> <br>  Diferentes discos ou matrizes de ataque s√£o montados nos dados1 e dados2.  Mas o el√°stico n√£o se equilibra e n√£o distribui a carga entre esses caminhos.  Primeiro, ele preenche uma se√ß√£o e come√ßa a escrever em outra, para que a carga no armazenamento seja desigual.  Sabendo disso, tomei uma decis√£o inequ√≠voca - combinei todos os discos no RAID0 / 1 e montei-o no caminho especificado em path.data. <br><br><h2>  processadores dispon√≠veis </h2><br>  E n√£o, n√£o me refiro a processadores em n√≥s de entrada agora.  Se voc√™ observar as propriedades de um n√≥ em execu√ß√£o (por meio da API _nodes), poder√° ver algo assim: <br><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"os"</span></span>. { <span class="hljs-string"><span class="hljs-string">"refresh_interval_in_millis"</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Linux"</span></span>, <span class="hljs-string"><span class="hljs-string">"arch"</span></span>: <span class="hljs-string"><span class="hljs-string">"amd64"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"4.4.0-87-generic"</span></span>, <span class="hljs-string"><span class="hljs-string">"available_processors"</span></span>: <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-string"><span class="hljs-string">"allocated_processors"</span></span>: <span class="hljs-number"><span class="hljs-number">28</span></span> }</code> </pre> <br>  Pode-se observar que o n√≥ est√° sendo executado em um host com 28 n√∫cleos, e o el√°stico determinou corretamente seu n√∫mero e iniciou tudo.  Mas se houver mais de 32 n√∫cleos, √†s vezes acontece assim: <br><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"os"</span></span>: { <span class="hljs-string"><span class="hljs-string">"refresh_interval_in_millis"</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Linux"</span></span>, <span class="hljs-string"><span class="hljs-string">"arch"</span></span>: <span class="hljs-string"><span class="hljs-string">"amd64"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"4.4.0-116-generic"</span></span>, <span class="hljs-string"><span class="hljs-string">"available_processors"</span></span>: <span class="hljs-number"><span class="hljs-number">72</span></span>, <span class="hljs-string"><span class="hljs-string">"allocated_processors"</span></span>: <span class="hljs-number"><span class="hljs-number">32</span></span> }</code> </pre> <br>  Voc√™ precisa for√ßar o n√∫mero de processadores dispon√≠veis para o servi√ßo - isso tem um bom efeito no desempenho do n√≥. <br><br><pre> <code class="hljs">processors: 72</code> </pre> <br><h2>  thread_pool.bulk.queue_size </h2><br>  Na se√ß√£o thread_pool.bulk.rejected do √∫ltimo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo, havia</a> essa m√©trica - a contagem do n√∫mero de falhas nas solicita√ß√µes para adicionar dados. <br><br>  Escrevi que o crescimento desse indicador √© um sinal muito ruim, e os desenvolvedores recomendam n√£o configurar pools de encadeamentos, mas adicionar novos n√≥s ao cluster - supostamente, isso resolve problemas de desempenho.  Mas as regras s√£o necess√°rias para quebr√°-las √†s vezes.  E nem sempre √© poss√≠vel "resolver o problema com o ferro", portanto, uma das medidas para combater falhas em solicita√ß√µes em massa √© aumentar o tamanho dessa fila. <br><br>  Por padr√£o, as configura√ß√µes da fila s√£o assim: <br><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"thread_pool"</span></span>: { <span class="hljs-string"><span class="hljs-string">"bulk"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"fixed"</span></span>, <span class="hljs-string"><span class="hljs-string">"min"</span></span>: <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-string"><span class="hljs-string">"max"</span></span>: <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-string"><span class="hljs-string">"queue_size"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span> } }</code> </pre> <br>  O algoritmo √© o seguinte: <br><br><ol><li>  Coletamos estat√≠sticas sobre o tamanho m√©dio da fila durante o dia (o valor instant√¢neo √© armazenado em thread_pool.bulk.queue); </li><li>  Aumente cuidadosamente o tamanho da fila para tamanhos ligeiramente maiores que o tamanho m√©dio da fila ativa - porque ocorre uma falha quando √© excedida; </li><li>  Aumentamos o tamanho da piscina - isso n√£o √© necess√°rio, mas aceit√°vel. </li></ol><br>  Para fazer isso, adicione algo assim √†s configura√ß√µes do host (√© claro que voc√™ ter√° seus pr√≥prios valores): <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">thread_pool</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bulk</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.size</span></span>: 32 <span class="hljs-selector-tag"><span class="hljs-selector-tag">thread_pool</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bulk</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.queue_size</span></span>: 500</code> </pre> <br>  E depois de reiniciar o n√≥, monitoraremos definitivamente o consumo de carga, E / S, mem√≥ria.  e tudo o que √© poss√≠vel reverter as configura√ß√µes, se necess√°rio. <br><br>  <i>Importante: essas configura√ß√µes fazem sentido apenas nos n√≥s que trabalham no recebimento de novos dados.</i> <br><br><h2>  Cria√ß√£o de √çndice Preliminar </h2><br>  Como eu disse no primeiro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo da</a> s√©rie, usamos o Elasticsearch para armazenar os logs de todos os microsservi√ßos.  A linha inferior √© simples - um √≠ndice armazena os logs de um componente em um dia. <br><br>  A partir disso, segue-se que todos os dias novos √≠ndices s√£o criados pelo n√∫mero de microsservi√ßos - portanto, mais cedo todas as noites, o el√°stico cai no clinch por cerca de 8 minutos, enquanto uma centena de novos √≠ndices √© criada, v√°rias centenas de novos fragmentos, o cronograma de carregamento do disco sai da prateleira, as filas crescem para enviar logs para o el√°stico nos hosts, e o Zabbix floresceu com alertas como uma √°rvore de Natal. <br><br>  Para evitar isso, era senso comum escrever um script Python para pr√©-criar √≠ndices.  O script funciona assim: ele encontra os √≠ndices para hoje, extrai seus mapeamentos e cria novos √≠ndices com os mesmos mapeamentos, mas para o dia seguinte.  √â executado no cron, executado durante aquelas horas em que o Elastic √© o menos carregado.  O script usa a biblioteca elasticsearch e est√° dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> . <br><br><h2>  P√°ginas enormes transparentes dos pais </h2><br>  Uma vez que descobrimos que os n√≥s el√°sticos que operam a recep√ß√£o de dados come√ßaram a ficar sob carga durante o hor√°rio de pico.  E com sintomas muito estranhos: o uso de todos os n√∫cleos do processador cai para zero, mas, no entanto, o servi√ßo fica travado na mem√≥ria, escuta adequadamente a porta, n√£o faz nada, n√£o responde √†s solicita√ß√µes e depois de algum tempo sai do cluster.  O servi√ßo n√£o responde √† reinicializa√ß√£o do systemctl.  Somente a boa e velha matan√ßa -9 ajuda. <br><br>  Isso n√£o √© percebido pelas ferramentas de monitoramento padr√£o; nos gr√°ficos, at√© o momento do outono, a imagem regular, nos registros de servi√ßo - fica vazia.  O despejo de mem√≥ria da m√°quina java neste momento tamb√©m n√£o foi poss√≠vel. <br><br>  Mas, como eles dizem, "somos profissionais, ent√£o, depois de algum tempo, pesquisamos a solu√ß√£o no Google".  Um problema semelhante foi abordado no t√≥pico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">discuss.elastic.co</a> e acabou sendo um bug do kernel relacionado a p√°ginas enormes e transparentes.  Tudo foi resolvido desativando o thp no kernel usando o pacote sysfsutils. <br><br>  Verificar se voc√™ tem p√°ginas enormes transparentes ativadas √© simples: <br><br><pre> <code class="hljs powershell">cat /sys/kernel/mm/transparent_hugepage/enabled always madvise [<span class="hljs-type"><span class="hljs-type">never</span></span>]</code> </pre> <br>  Se [sempre] estiver l√°, voc√™ estar√° potencialmente em risco. <br><br><h2>  Conclus√£o </h2><br>  Este √© o rake principal (de fato, havia, √© claro, mais), que por algum tempo eu andei por um ano e meio como administrador do cluster do Elasticsearch.  Espero que essas informa√ß√µes sejam √∫teis na jornada dif√≠cil e misteriosa para o cluster ideal do Elasticsearch. <br><br>  Obrigado pela ilustra√ß√£o, Anton Gudim - ainda h√° muito de bom em seu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instagram</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419041/">https://habr.com/ru/post/pt419041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419027/index.html">Seguran√ßa da informa√ß√£o de pagamentos banc√°rios sem dinheiro. Parte 6 - An√°lise do Crime Banc√°rio</a></li>
<li><a href="../pt419029/index.html">Fortnite se tornou um fen√¥meno social. Os pais est√£o cada vez mais contratando treinadores para seus filhos e brincando com eles</a></li>
<li><a href="../pt419033/index.html">Uma pequena observa√ß√£o sobre o t√≥pico de execu√ß√£o do vue.js no cluster kubernetes</a></li>
<li><a href="../pt419035/index.html">Livro ‚ÄúHead First Agile. Gerenciamento flex√≠vel de projetos ‚Äù</a></li>
<li><a href="../pt419037/index.html">Implementa√ß√£o de PPPOS no stm32f4-discovery</a></li>
<li><a href="../pt419043/index.html">O esquivo problema de temporiza√ß√£o de quadros</a></li>
<li><a href="../pt419047/index.html">Reddit hackeado, vazou banco de dados com senhas e e-mail para 2005-2007</a></li>
<li><a href="../pt419049/index.html">GeekBrains lan√ßa maratona educacional on-line gratuita ‚ÄúEncontre-se na Digital‚Äù</a></li>
<li><a href="../pt419051/index.html">Como Flant ajuda iniciantes</a></li>
<li><a href="../pt419053/index.html">Testando a tecnologia de cache Adaptec RAID</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>