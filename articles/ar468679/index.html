<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ป ๐ โ๏ธ ุฃุจุฌุฏูุงุช ุงูุฃูู ูู Kubernetes: ุงููุตุงุฏูุฉ ุ ุฅุฐู ุ ุงูุชุฏููู โ ๐ง ๐ค</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุนุงุฌูุงู ุฃู ุขุฌูุงู ุ ูุซูุฑ ุชุดุบูู ุฃู ูุธุงู ูุณุฃูุฉ ุงูุฃูุงู: ุถูุงู ุงููุตุงุฏูุฉ ุ ููุตู ุงูุญููู ุ ููุฑุงุฌุนุฉ ุงูุญุณุงุจุงุช ูุบูุฑูุง ูู ุงูููุงู. ุชู ุจุงููุนู ุฅูุดุงุก ุงูุนุฏูุฏ ูู ุงูุญููู ู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃุจุฌุฏูุงุช ุงูุฃูู ูู Kubernetes: ุงููุตุงุฏูุฉ ุ ุฅุฐู ุ ุงูุชุฏููู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/468679/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ao/pp/ke/aoppkeeufk5-tv1rmtmtw9oce7a.png"><br><br>  ุนุงุฌูุงู ุฃู ุขุฌูุงู ุ ูุซูุฑ ุชุดุบูู ุฃู ูุธุงู ูุณุฃูุฉ ุงูุฃูุงู: ุถูุงู ุงููุตุงุฏูุฉ ุ ููุตู ุงูุญููู ุ ููุฑุงุฌุนุฉ ุงูุญุณุงุจุงุช ูุบูุฑูุง ูู ุงูููุงู.  ุชู ุจุงููุนู ุฅูุดุงุก <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุนุฏูุฏ ูู ุงูุญููู</a> ูู Kubernetes ุงูุชู ูููููุง ุชุญููู ุงูุงูุชุซุงู ูููุนุงููุฑ ุญุชู ูู ุงูุจูุฆุงุช ุงูุชู ุชุชุทูุจ ุงููุซูุฑ ูู ุงููุชุทูุจุงุช ... ูุชูุฑุณ ููุณ ุงูููุงุฏ ูุฌูุงูุจ ุงูุฃูุงู ุงูุฃุณุงุณูุฉ ุงููููุฐุฉ ูู ุฅุทุงุฑ ุงูุขููุงุช ุงููุฏูุฌุฉ ูู K8.  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุณูููู ูููุฏูุง ูุฃููุฆู ุงูุฐูู ูุจุฏุฃูู ูู ุงูุชุนุฑู ุนูู Kubernetes ุ ูููุทุฉ ุงูุทูุงู ูุฏุฑุงุณุฉ ุงููุถุงูุง ุงูุฃูููุฉ. <a name="habracut"></a><br><br><h2 style=";text-align:right;direction:rtl">  ุงููุตุงุฏูุฉ </h2><br>  Kubernetes ูุฏูู ููุนุงู ูู ุงููุณุชุฎุฏููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <i>ุญุณุงุจุงุช ุงูุฎุฏูุฉ</i> - ุงูุญุณุงุจุงุช ุงูุชู ูุฏูุฑูุง Kubernetes API ุ </li><li style=";text-align:right;direction:rtl">  <i>ุงููุณุชุฎุฏููู</i> - <i>ุงููุณุชุฎุฏููู</i> "ุงูุนุงุฏููู" ุงูุฐูู ุชุณูุทุฑ ุนูููู ุฎุฏูุงุช ุฎุงุฑุฌูุฉ ูุณุชููุฉ. </li></ul><br>  ุงููุฑู ุงูุฑุฆูุณู ุจูู ูุฐู ุงูุฃููุงุน ูู ุฃูู ุจุงููุณุจุฉ ูุญุณุงุจุงุช ุงูุฎุฏูุฉ ุ ุชูุฌุฏ ูุงุฆูุงุช ุฎุงุตุฉ ูู Kubernetes API (ูุทูู ุนูููุง <code>ServiceAccounts</code> ) ูุฑุชุจุทุฉ ุจูุณุงุญุฉ ุงุณู ููุฌููุนุฉ ูู ุจูุงูุงุช ุงูุชุฎููู ุงููุฎุฒูุฉ ูู ูุชูุฉ ูู ูุงุฆูุงุช ูู ุงูููุน Secrets.  ุงููุฏู ูู ูุคูุงุก ุงููุณุชุฎุฏููู (ุญุณุงุจุงุช ุงูุฎุฏูุฉ) ูู ุงูููุงู ุงูุฃูู ูู ุฅุฏุงุฑุฉ ุญููู ุงููุตูู ุฅูู ุนูููุงุช Kubernetes API ุงูุชู ุชุนูู ูู ูุชูุฉ Kubernetes. <br><br>  ูุง ูููู ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ุฅุฏุฎุงูุงุช ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Kubernetes: ูุฌุจ ุฅุฏุงุฑุชูุง ุจูุงุณุทุฉ ุขููุงุช ุฎุงุฑุฌูุฉ.  ููู ูุฎุตุตุฉ ููุฃุดุฎุงุต ุฃู ุงูุนูููุงุช ุงูุชู ุชุนูุด ุฎุงุฑุฌ ุงููุชูุฉ. <br><br>  ูุฑุชุจุท ูู ุทูุจ ููุฏู ุฅูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุฅูุง ุจุญุณุงุจ ุงูุฎุฏูุฉ ุฃู ุจุงููุณุชุฎุฏู ุ ุฃู ูุนุชุจุฑ ูุฌููููุง. <br><br>  ุชุดูู ุจูุงูุงุช ูุตุงุฏูุฉ ุงููุณุชุฎุฏู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <i>ุงุณู ุงููุณุชุฎุฏู</i> - ุงุณู ุงููุณุชุฎุฏู (ุญุณุงุณ ูุญุงูุฉ ุงูุฃุญุฑู!) ุ </li><li style=";text-align:right;direction:rtl">  <i>UID</i> ุนุจุงุฑุฉ ุนู ุณูุณูุฉ ุชุนุฑูู ูููุณุชุฎุฏู ูููู ูุฑุงุกุชูุง ุจูุงุณุทุฉ ุงูุขูุฉ ููู "ุฃูุซุฑ ุงุชุณุงููุง ููุฑูุฏุฉ ูู ุงุณู ุงููุณุชุฎุฏู" ุ </li><li style=";text-align:right;direction:rtl">  <i>ุงููุฌููุนุงุช</i> - ูุงุฆูุฉ ุจุงููุฌููุนุงุช ุงูุชู ููุชูู ุฅูููุง ุงููุณุชุฎุฏู ุ </li><li style=";text-align:right;direction:rtl">  ุญููู ุฅุถุงููุฉ - ูููู ุงุณุชุฎุฏุงููุง ูู ูุจู ุขููุฉ ุงูุชุฑุฎูุต. </li></ul><br>  ูููู ุฃู ูุณุชุฎุฏู Kubernetes ุนุฏุฏูุง ูุจูุฑูุง ูู ุขููุงุช ุงููุตุงุฏูุฉ: ุดูุงุฏุงุช X509 ูุฑููุฒ Bearer ููููุงุก ุงููุตุงุฏูุฉ ู HTTP Basic Auth.  ุจุงุณุชุฎุฏุงู ูุฐู ุงูุขููุงุช ุ ูููู ุชูููุฐ ุนุฏุฏ ูุจูุฑ ูู ูุฎุทุทุงุช ุงูุชูููุถ: ูู ููู ุซุงุจุช ุจูููุงุช ูุฑูุฑ ุฅูู OpenID OAuth2. <br><br>  ุนูุงูุฉ ุนูู ุฐูู ุ ููุณูุญ ุจูุฎุทุทุงุช ุงูุชุฑุฎูุต ุงููุชุนุฏุฏุฉ ูู ููุณ ุงูููุช.  ุจุดูู ุงูุชุฑุงุถู ุ ูุณุชุฎุฏู ุงููุชูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฑููุฒ ุญุณุงุจ ุงูุฎุฏูุฉ - ูุญุณุงุจุงุช ุงูุฎุฏูุฉ ุ </li><li style=";text-align:right;direction:rtl">  X509 - ูููุณุชุฎุฏููู. </li></ul><br>  ุฅู ูุณุฃูุฉ ุฅุฏุงุฑุฉ ServiceAccounts ุชุชุฌุงูุฒ ูุทุงู ูุฐู ุงูููุงูุฉ ุ ููููู ุฃูุตู ุจุงูุจุฏุก ูู ูุนุฑูุฉ ุงููุฒูุฏ ุญูู ูุฐู ุงููุดููุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุตูุญุฉ ุงููุซุงุฆู ุงูุฑุณููุฉ</a> .  ุณููุธุฑ ุจูุฒูุฏ ูู ุงูุชูุตูู ูู ูุณุฃูุฉ ุนูู ุดูุงุฏุงุช X509. <br><br><h3 style=";text-align:right;direction:rtl">  ุดูุงุฏุงุช ูููุณุชุฎุฏููู (X.509) </h3><br>  ุชุชุถูู ุงูุทุฑููุฉ ุงูููุงุณูููุฉ ููุนูู ูุน ุงูุดูุงุฏุงุช: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฌูู ุงูููุชุงุญ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mkdir -p ~/mynewuser/.certs/ openssl genrsa -out ~/.certs/mynewuser.key 2048</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุฌูู ุทูุจ ุงูุดูุงุฏุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">openssl req -new -key ~/.certs/mynewuser.key -out ~/.certs/mynewuser.csr -subj <span class="hljs-string"><span class="hljs-string">"/CN=mynewuser/O=company"</span></span></code> </pre> </li><li style=";text-align:right;direction:rtl">  ูุนุงูุฌุฉ ุทูุจ ุงูุดูุงุฏุฉ ุจุงุณุชุฎุฏุงู ููุงุชูุญ CA ููุธุงู ุงููุฌููุนุฉ Kubernetes ุ ูุงูุญุตูู ุนูู ุดูุงุฏุฉ ูุณุชุฎุฏู (ููุญุตูู ุนูู ุดูุงุฏุฉ ุ ุชุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ุญุณุงุจ ูุฏูู ุญู ุงููุตูู ุฅูู ููุชุงุญ ูุฑุฌุน ุดูุงุฏุฉ ูุธุงู ุงููุฌููุนุฉ Kubernetes ุ ุงูููุฌูุฏ ูู <code>/etc/kubernetes/pki/ca.key</code> ุจุดูู ุงูุชุฑุงุถู): <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">openssl x509 -req -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ~/.certs/mynewuser.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out ~/.certs/mynewuser.crt -days 500</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ููู ุงูุชูููู: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุตู ูุธุงู ุงููุฌููุนุฉ (ุญุฏุฏ ุนููุงู ููููุน ููู ุดูุงุฏุฉ ุงููุฑุฌุน ุงููุตุฏู (CA) ูุชุซุจูุช ูุธุงู ุงููุฌููุนุฉ ุงููุญุฏุฏ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-cluster kubernetes --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.100.200:6443</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุฃู - ุฅุฐุง <b>ูู ููู</b> ุงูุฎูุงุฑ ุงูููุตู ุจู - ููููู ุญุฐู ุดูุงุฏุฉ ุงูุฌุฐุฑ (ุซู ูู ูุชุญูู kubectl ูู ุตุญุฉ ูุชูุฉ api-server): <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-cluster kubernetes --insecure-skip-tls-verify=<span class="hljs-literal"><span class="hljs-literal">true</span></span> --server=https://192.168.100.200:6443</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ูุณุชุฎุฏู ุฅูู ููู ุงูุชูููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-credentials mynewuser --client-certificate=.certs/mynewuser.crt --client-key=.certs/mynewuser.key</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ุงูุณูุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-context mynewuser-context --cluster=kubernetes --namespace=target-namespace --user=mynewuser</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุชุนููู ุงูุณูุงู ุงูุงูุชุฑุงุถู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl config use-context mynewuser-context</code> </pre> </li></ul></li></ul><br>  ุจุนุฏ ุงูุชูุงุนุจ ุฃุนูุงู ุ ุณูุชู ุฅูุดุงุก ุชูููู ุงููููุฐุฌ ูู ููู <code>.kube/config</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: v1 clusters: - cluster: certificate-authority: /etc/kubernetes/pki/ca.crt server: https://192.168.100.200:6443 name: kubernetes contexts: - context: cluster: kubernetes namespace: target-namespace user: mynewuser name: mynewuser-context current-context: mynewuser-context kind: Config preferences: {} users: - name: mynewuser user: client-certificate: /home/mynewuser/.certs/mynewuser.crt client-key: /home/mynewuser/.certs/mynewuser.key</code> </pre> <br>  ูุชุณููู ููู ุงูุชูููู ุจูู ุงูุญุณุงุจุงุช ูุงูุฎูุงุฏู ุ ูู ุงููููุฏ ุชุญุฑูุฑ ููู ุงูููุงุชูุญ ุงูุชุงููุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <code>certificate-authority</code> </li> <li style=";text-align:right;direction:rtl"> <code>client-certificate</code> </li> <li style=";text-align:right;direction:rtl"> <code>client-key</code> </li> </ul><br>  ููููุงู ุจุฐูู ุ ููููู ุชุดููุฑ ุงููููุงุช ุงููุดุงุฑ ุฅูููุง ูููุง ุจุงุณุชุฎุฏุงู base64 ูุชุณุฌูููุง ูู ุงูุชูููู ุนู ุทุฑูู ุฅุถุงูุฉ ุจูุงูุงุช ูุงุญูุฉ ุฅูู ุงุณู ุงูููุงุชูุญ ุ ุฃู  ุงูุญุตูู ุนูู <code>certificate-authority-data</code> ุ ุงูุฎ <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุดูุงุฏุงุช ูุน kubeadm </h3><br>  ูุน ุฅุตุฏุงุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes 1.15 ุ ุฃุตุจุญ</a> ุงูุนูู ูุน ุงูุดูุงุฏุงุช ุฃุณูู ูุซูุฑูุง ุจูุถู ุฅุตุฏุงุฑ alpha ุงูุฎุงุต ุจุฏุนูู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃุฏุงุฉ kubeadm</a> .  ุนูู ุณุจูู ุงููุซุงู ุ ุฅููู ูุง ูุฏ ูุจุฏู ุนููู ุงูุขู ุฅูุดุงุก ููู ุงูุชูููู ุจุงุณุชุฎุฏุงู ููุงุชูุญ ุงููุณุชุฎุฏู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubeadm alpha kubeconfig user --client-name=mynewuser --apiserver-advertise-address 192.168.100.200</code> </pre> <br>  <i><b>ููุญูุธุฉ</b> : ูููู ุนุฑุถ <i>ุนููุงู ุงูุฅุนูุงู</i> ุงููุทููุจ ูู ุชููุฆุฉ ุฎุงุฏู api ุ ูุงูุฐู ููุน ูู <code>/etc/kubernetes/manifests/kube-apiserver.yaml</code> ุงูุชุฑุงุถููุง.</i> <br><br>  ุณูุชู ุฅุฎุฑุงุฌ ุงูุชูููู ุงููุงุชุฌ ุฅูู stdout.  ูุฌุจ ุญูุธู ูู <code>~/.kube/config</code> ูุญุณุงุจ ุงููุณุชุฎุฏู ุฃู ูู ุงูููู ุงููุญุฏุฏ ูู <code>KUBECONFIG</code> ุงูุจูุฆุฉ <code>KUBECONFIG</code> . <br><br><h3 style=";text-align:right;direction:rtl">  ุญูุฑ ุฃุนูู </h3><br>  ุจุงููุณุจุฉ ูุฃููุฆู ุงูุฐูู ูุฑุบุจูู ูู ููู ุงููุถุงูุง ุงูููุตููุฉ ุจุฏูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู ูููุตู</a> ุนู ุงูุนูู ูุน ุงูุดูุงุฏุงุช ูู ูุซุงุฆู Kubernetes ุงูุฑุณููุฉ ุ </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู ุฌูุฏ ูู Bitnami</a> ุ ูุงูุฐู ูุชูุงูู ูุณุฃูุฉ ุงูุดูุงุฏุงุช ูู ุงููุงุญูุฉ ุงูุนูููุฉ. </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู</a> ุงููุตุงุฏูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุนุงูุฉ</a> ูู Kubernetes. </li></ul><br><h2 style=";text-align:right;direction:rtl">  ุชุฑุฎูุต </h2><br>  ููุณ ูุฏู ุงูุญุณุงุจ ุงููุตุงุฏู ุฅุฐู ุงูุชุตุฑู ูู ูุชูุฉ ุจุดูู ุงูุชุฑุงุถู.  Kubernetes ูุฏูู ุขููุฉ ุชุฑุฎูุต ูููุญ ุงูุฃุฐููุงุช. <br><br>  ูุจู ุงูุฅุตุฏุงุฑ 1.6 ุ ุงุณุชุฎุฏู Kubernetes ููุน ูุตุงุฏูุฉ ูุณูู <b>ABAC</b> (ุงูุชุญูู ูู ุงููุตูู ุงููุณุชูุฏ ุฅูู ุงูุณูุงุช).  ูููู ุงูุงุทูุงุน ุนูู ุงูุชูุงุตูู ุงููุชุนููุฉ ุจู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู ุงูุฑุณููุฉ</a> .  ูุนุชุจุฑ ูุฐุง ุงูููุฌ ุญุงูููุง ูุฏูููุง ุ ููู ูุง ูุฒุงู ุจุฅููุงูู ุงุณุชุฎุฏุงูู ูู ููุณ ุงูููุช ุงูุฐู ุชุณุชุฎุฏู ููู ุฃููุงุน ุงูุชุฑุฎูุต ุงูุฃุฎุฑู. <br><br>  ุชุณูู ุงูุทุฑููุฉ ุงููุนููุฉ (ูุงูุฃูุซุฑ ูุฑููุฉ) ูุชูุณูู ุญููู ุงููุตูู ุฅูู ูุธุงู ุงููุฌููุนุฉ <b>RBAC</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุญูู ูู ุงููุตูู ุงููุณุชูุฏ ุฅูู ุงูุฏูุฑ</a> ).  ุชู ุงูุฅุนูุงู ุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุซุจุงุชู</a> ููุฐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes 1.8</a> .  ุชุทุจู RBAC ูููุฐุฌ ุญููู ูุญุธุฑ ุฃู ุดูุก ุบูุฑ ูุณููุญ ุจู ุตุฑุงุญุฉ. <br>  <b>ูุชูููู RBAC</b> ุ ุชุญุชุงุฌ ุฅูู ุชุดุบูู Kubernetes api-server ูุน <code>--authorization-mode=RBAC</code> .  ูุชู ุชุนููู ุงููุนููุงุช ูู ุงูุจูุงู ูุน ุชูููู ุฎุงุฏู api ุ ูุงูุฐู ููุน ุงูุชุฑุงุถููุง ุนูู ุงููุณุงุฑ <code>/etc/kubernetes/manifests/kube-apiserver.yaml</code> ุ ูู ูุณู <code>command</code> .  ููุน ุฐูู ุ ูุชู ุชูููู RBAC ุจุงููุนู ุงูุชุฑุงุถููุง ุ ูุฐูู ูู ุงููุญุชูู ุฃูุง ุชููู ุจุดุฃู ูุฐุง: ููููู ุงูุชุญูู ูู ุฐูู ูู ุฎูุงู ูููุฉ <code>authorization-mode</code> (ูู <code>kube-apiserver.yaml</code> ุงููุฐููุฑ <code>kube-apiserver.yaml</code> ).  ุจุงูููุงุณุจุฉ ุ ูู ุจูู ููููุง ูุฏ ูููู ููุงู ุฃููุงุน ุฃุฎุฑู ูู ุงูุชุฎููู ( <code>node</code> ุ <code>webhook</code> ุ <code>always allow</code> ) ุ ููููุง <code>webhook</code> ุฎุงุฑุฌ ูุทุงู ุงููุงุฏุฉ. <br><br>  ุจุงูููุงุณุจุฉ ุ ููุฏ ูุดุฑูุง ุจุงููุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงููุง</a> ูุญุชูู ุนูู ูุตุฉ ููุตูุฉ ุฅูู ุญุฏ ูุง ุญูู ูุจุงุฏุฆ ูููุฒุงุช ุงูุนูู ูุน RBAC ุ ูุฐูู ุณุฃูุชุตุฑ ุนูู ุณุฑุฏ ููุฌุฒ ููุฃุณุงุณูุงุช ูุงูุฃูุซูุฉ. <br><br>  ุชูุณุชุฎุฏู ููุงูุงุช ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุชุงููุฉ ููุชุญูู ูู ุงููุตูู ุฅูู Kubernetes ุนุจุฑ RBAC: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>Role</code> ู <code>ClusterRole</code> ุฃุฏูุงุฑ ุชุตู ุงูุงูุชูุงุฒุงุช: </li><li style=";text-align:right;direction:rtl">  ูุชูุญ ูู <code>Role</code> ูุตู ุงูุญููู ุถูู ูุณุงุญุฉ ุงูุงุณู ุ </li><li style=";text-align:right;direction:rtl">  <code>ClusterRole</code> - ุฏุงุฎู ุงููุชูุฉ ุ ุจูุง ูู ุฐูู ุงููุงุฆูุงุช ุงูุฎุงุตุฉ ุจุงููุชูุฉ ูุซู ุงูุนูุฏ ุ ุนูุงููู url ุบูุฑ ุงููุชุนููุฉ ุจุงูููุงุฑุฏ (ุนูู ุณุจูู ุงููุซุงู ุ ูุง ุชุชุนูู ุจููุงุฑุฏ Kubernetes - ุนูู ุณุจูู ุงููุซุงู ุ <code>/version</code> ุ <code>/logs</code> ุ <code>/api*</code> ) ุ </li><li style=";text-align:right;direction:rtl">  <code>RoleBinding</code> and <code>ClusterRoleBinding</code> - ูุนูู ุนูู ุฑุจุท <code>Role</code> and <code>ClusterRole</code> ุจูุณุชุฎุฏู ุฃู ูุฌููุนุฉ ูุณุชุฎุฏููู ุฃู ServiceAccount. </li></ul><br>  ููุชุตุฑ ุฏูุฑ ุงูููุงูุงุช ูุชุฌููุฏ ุงูุฃุฏูุงุฑ ุนูู ูุณุงุญุฉ ุงูุงุณู ุ ุฃู  ูุฌุจ ุฃู ูููู ุฏุงุฎู ููุณ ูุณุงุญุฉ ุงูุงุณู.  ููุน ุฐูู ุ ูููู ุฃู ูุดูุฑ RoleBinding ุฅูู ClusterRole ุ ูุงูุฐู ูุณูุญ ูู ุจุฅูุดุงุก ูุฌููุนุฉ ูู ุงูุฃุฐููุงุช ุงูููุงุณูุฉ ูุงูุชุญูู ูู ุงููุตูู ุฅูููุง. <br><br>  ุชุตู ุงูุฃุฏูุงุฑ ุงูุญููู ุจุงุณุชุฎุฏุงู ูุฌููุนุงุช ุงูููุงุนุฏ ุงูุชู ุชุญุชูู ุนูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฌููุนุงุช ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช - ุฑุงุฌุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู ุงูุฑุณููุฉ</a> ูู apiGroups ูุฅุฎุฑุงุฌ ููุงุฑุฏ <code>kubectl api-resources</code> . </li><li style=";text-align:right;direction:rtl">  ุงูููุงุฑุฏ ( <i>ุงูููุงุฑุฏ</i> : <code>pod</code> ุ <code>namespace</code> ุ <code>deployment</code> ุ ุฅูุฎ) ุ </li><li style=";text-align:right;direction:rtl">  ุงูุฃูุนุงู ( <i>ุงูุฃูุนุงู</i> : <code>set</code> ุ <code>update</code> ุ ููุง ุฅูู ุฐูู). </li><li style=";text-align:right;direction:rtl">  ุฃุณูุงุก ุงูููุงุฑุฏ (ุฃุณูุงุก <code>resourceNames</code> ) - ููุญุงูุฉ ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ุชูููุฑ ุงููุตูู ุฅูู ููุฑุฏ ูุนูู ุ ูููุณ ูุฌููุน ุงูููุงุฑุฏ ูู ูุฐุง ุงูููุน. </li></ul><br>  ูููู ุงูุงุทูุงุน ุนูู ููุงูุดุฉ ุฃูุซุฑ ุชูุตููุงู ููุชุฑุฎูุต ูู Kubernetes ุนูู ุตูุญุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู ุงูุฑุณููุฉ</a> .  ุจุฏูุงู ูู ุฐูู (ุฃู ุจุงูุฃุญุฑู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู) ุณุฃูุฏู ุฃูุซูุฉ ุชูุถุญ ุนูููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุฃูุซูุฉ ุงูููุงู RBAC </h3><br>  <code>Role</code> ุจุณูุท ูุณูุญ ูู ุจุงูุญุตูู ุนูู ูุงุฆูุฉ ูุญุงูุธุงุช ุงูุจุฑุงูุฌ ููุฑุงูุจุชูุง ูู <code>target-namespace</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: namespace: target-namespace name: pod-reader rules: - apiGroups: [""] resources: ["pods"] verbs: ["get", "watch", "list"]</code> </pre> <br>  ูุซุงู ุนูู <code>ClusterRole</code> ุ ูุงูุฐู ูุชูุญ ูู ุงูุญุตูู ุนูู ูุงุฆูุฉ ูุญุงูุฉ ุงููุฑูู ููุฑุงูุจุชูุง ูู ุฌููุน ุฃูุญุงุก ุงููุชูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: #  "namespace" ,   ClusterRole    name: pod-reader rules: - apiGroups: [""] resources: ["pods"] verbs: ["get", "watch", "list"]</code> </pre> <br>  ูุซุงู <code>RoleBinding</code> ุ ูุงูุฐู ูุณูุญ ูููุณุชุฎุฏู <code>mynewuser</code> "ูุฑุงุกุฉ" pods ูู <code>my-namespace</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: read-pods namespace: target-namespace subjects: - kind: User name: mynewuser #     ! apiGroup: rbac.authorization.k8s.io roleRef: kind: Role #    โRoleโ  โClusterRoleโ name: pod-reader #  Role,      namespace, #   ClusterRole,   #    apiGroup: rbac.authorization.k8s.io</code> </pre> <br><h2 style=";text-align:right;direction:rtl">  ุชุฏููู ุงูุฃุญุฏุงุซ </h2><br>  ูู ุงููุงุญูุฉ ุงูุชุฎุทูุทูุฉ ุ ูููู ุชูุซูู ุจููุฉ Kubernetes ุนูู ุงููุญู ุงูุชุงูู: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/617/793/499/6177934998b4bf1c5c8816c75beaef3f.png" alt="ุตูุฑุฉ"><br><br>  ุงููููู ุงูุฑุฆูุณู ูู Kubernetes ุ ุงููุณุคูู ุนู ูุนุงูุฌุฉ ุงูุทูุจุงุช ุ ูู <b>api-server</b> .  ุชูุฑ ุฌููุน ุงูุนูููุงุช ุนูู ุงููุชูุฉ ูู ุฎูุงููุง.  ุงูุฑุฃ ุงููุฒูุฏ ุนู ูุฐู ุงูุขููุงุช ุงูุฏุงุฎููุฉ ูู ุงูููุงูุฉ " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงุฐุง ูุญุฏุซ ูู Kubernetes ุนูุฏูุง ูุจุฏุฃ ุชุดุบูู kubectlุ</a>  ". <br><br>  ูุนุฏ ุชุฏููู ุงููุธุงู ููุฒุฉ ูููุฉ ูู Kubernetes ุ ุญูุซ ูุชู ุฅููุงู ุชุดุบููู ุงูุชุฑุงุถููุง.  ูุณูุญ ูู ุจุชุณุฌูู ุฌููุน ุงูููุงููุงุช ุฅูู Kubernetes API.  ููุง ููููู ุฃู ุชุฎูู ุจุณูููุฉ ุ ูู ุฎูุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฐู ุ ูุชู ุชูููุฐ ุฌููุน ุงูุฅุฌุฑุงุกุงุช ุงููุชุนููุฉ ุจูุฑุงูุจุฉ ูุชุบููุฑ ุญุงูุฉ ุงููุฌููุนุฉ.  ูููู ุงูุนุซูุฑ ุนูู ูุตู ุฌูุฏ ูููุฒุงุชู (ูุงููุนุชุงุฏ) ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู</a> K8s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฑุณููุฉ</a> .  ุจุนุฏ ุฐูู ุ ุณุฃุญุงูู ุชูุฏูู ุงูููุถูุน ุจูุบุฉ ุฃุจุณุท. <br><br>  ูุฐูู ุ <b>ูุชูููู ุงูุชุฏููู</b> ุ ูุญุชุงุฌ ุฅูู ุชูุฑูุฑ ุซูุงุซุฉ ูุนููุงุช ูุทููุจุฉ ุฅูู ุงูุญุงููุฉ ูู ุฎุงุฏู api ุ ููุฑุฏ ุงููุฒูุฏ ุญูู ุงูููุถุญ ุฃุฏูุงู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <code>--audit-policy-file=/etc/kubernetes/policies/audit-policy.yaml</code> </li> <li style=";text-align:right;direction:rtl"> <code>--audit-log-path=/var/log/kube-audit/audit.log</code> </li> <li style=";text-align:right;direction:rtl"> <code>--audit-log-format=json</code> </li> </ul><br>  ุจุงูุฅุถุงูุฉ ุฅูู ูุฐู ุงููุนููุงุช ุงูุซูุงุซุฉ ุงูุถุฑูุฑูุฉ ุ ููุงู ุงูุนุฏูุฏ ูู ุงูุฅุนุฏุงุฏุงุช ุงูุฅุถุงููุฉ ุงููุชุนููุฉ ุจุงูุชุฏููู: ูู ุชุฏููุฑ ุงูุณุฌู ุฅูู ุฃูุตุงู webhook.  ูุซุงู ูุนููุงุช ุฏูุฑุงู ุงูุณุฌู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <code>--audit-log-maxbackup=10</code> </li> <li style=";text-align:right;direction:rtl"> <code>--audit-log-maxsize=100</code> </li> <li style=";text-align:right;direction:rtl"> <code>--audit-log-maxage=7</code> </li> </ul><br>  ููููุง ูู ูุชูุงูููุง ุจูุฒูุฏ ูู ุงูุชูุงุตูู - ููููู ุงูุนุซูุฑ ุนูู ุฌููุน ุงูุชูุงุตูู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู kube-apiserver</a> . <br><br>  ููุง ุฐูุฑูุง ุณุงุจููุง ุ ูุชู ุชุนููู ุฌููุน ุงููุนููุงุช ูู ุงูุจูุงู ูุน ุชูููู ุฎุงุฏู api (ุงูุชุฑุงุถููุง <code>/etc/kubernetes/manifests/kube-apiserver.yaml</code> ) ุ ูู ูุณู <code>command</code> .  ุฏุนูุง ูุนูุฏ ุฅูู ุงููุนููุงุช ุงูุซูุงุซุฉ ุงููุทููุจุฉ ูุชุญููููุง: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>audit-policy-file</code> - ุงููุณุงุฑ ุฅูู ููู YAML ูุน ูุตู ุณูุงุณุฉ ุงูุชุฏููู.  ุณูุนูุฏ ุฅูู ูุญุชููุงุชู ุ ููููู ุฃูุงุญุธ ุงูุขู ุฃูู ูุฌุจ ุฃู ูููู ุงูููู ูุชุงุญูุง ูููุฑุงุกุฉ ุจูุงุณุทุฉ ุนูููุฉ ุฎุงุฏู api.  ูุฐูู ุ ูู ุงูุถุฑูุฑู ุชุซุจูุชู ุฏุงุฎู ุงูุญุงููุฉ ุ ุญูุซ ููููู ุฅุถุงูุฉ ุงูุชุนูููุฉ ุงูุจุฑูุฌูุฉ ุงูุชุงููุฉ ุฅูู ุงูุฃูุณุงู ุงูููุงุณุจุฉ ูู ุงูุชูููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> volumeMounts: - mountPath: /etc/kubernetes/policies name: policies readOnly: true volumes: - hostPath: path: /etc/kubernetes/policies type: DirectoryOrCreate name: policies</code> </pre> </li><li style=";text-align:right;direction:rtl">  <code>audit-log-path</code> - ุงููุณุงุฑ ุฅูู ููู ุงูุณุฌู.  ูุฌุจ ุฃู ูููู ุงููุณุงุฑ ุฃูุถูุง ูุชุงุญูุง ูุนูููุฉ ุฎุงุฏู api ุ ูุจุงูุชุงูู ุ ูุฅููุง ูุตู ุทุฑููุฉ ุชุฑููุจู ุจุงููุซู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> volumeMounts: - mountPath: /var/log/kube-audit name: logs readOnly: false volumes: - hostPath: path: /var/log/kube-audit type: DirectoryOrCreate name: logs</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุดูู ุณุฌู ุงูุชุฏููู - ุดูู ุณุฌู ุงูุชุฏููู.  ุจุดูู ุงูุชุฑุงุถู ุ ูุฐุง <code>json</code> ุ ููู ุชูุณูู ุงููุต ุงููุฏูู ูุชุงุญ ุฃูุถูุง. </li></ol><br><h3 style=";text-align:right;direction:rtl">  ุณูุงุณุฉ ุงูุชุฏููู </h3><br>  ุงูุขู ุญูู ุงูููู ุงููุฐููุฑ ูุน ูุตู ุณูุงุณุฉ ุงูุชุณุฌูู.  ุงูููููู ุงูุฃูู ูุณูุงุณุฉ ุงูุชุฏููู ูู <code>level</code> ุ <b>ููุณุชูู ุงูุชุณุฌูู</b> .  ูู ุนูู ุงููุญู ุงูุชุงูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>None</code> - ูุง ุชูู ุจุชุณุฌูู ุงูุฏุฎูู ุ </li><li style=";text-align:right;direction:rtl">  <code>Metadata</code> - ุณุฌู ุทูุจ ุงูุจูุงูุงุช ุงููุตููุฉ: ุงููุณุชุฎุฏู ุ ููุช ุงูุทูุจ ุ ุงูููุฑุฏ ุงููุณุชูุฏู (pod ุ ูุณุงุญุฉ ุงูุงุณู ุ ููุง ุฅูู ุฐูู) ุ ููุน ุงูุฅุฌุฑุงุก (ุงููุนู) ุ ููุง ุฅูู ุฐูู ุ </li><li style=";text-align:right;direction:rtl">  <code>Request</code> - ุณุฌู ุงูุจูุงูุงุช ุงููุตููุฉ ููุต ุงูุทูุจ ุ </li><li style=";text-align:right;direction:rtl">  <code>RequestResponse</code> - <code>RequestResponse</code> ุงูุจูุงูุงุช ุงููุตููุฉ ุ <code>RequestResponse</code> ุงูุทูุจ ูุฌุณู ุงูุงุณุชุฌุงุจุฉ. </li></ul><br>  ูุง ูููู ุงููุณุชููุงู ุงูุฃุฎูุฑุงู ( <code>Request</code> ู <code>RequestResponse</code> ) ุจุชุณุฌูู ุงูุทูุจุงุช ุงูุชู ูู ุชุตู ุฅูู ุงูููุงุฑุฏ (ุงุณุชุฏุนุงุกุงุช ููุง ูุณูู ุนูุงููู url ุจุฎูุงู ุงูููุงุฑุฏ). <br><br>  ุฃูุถูุง ุ ุชูุฑ ุฌููุน ุงูุทูุจุงุช <b>ุจุนุฏุฉ ูุฑุงุญู</b> : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>RequestReceived</code> - ุงููุฑุญูุฉ ุงูุชู ูุชู ูููุง ุงุณุชูุงู ุงูุทูุจ ูู ูุจู ุงููุนุงูุฌ ููู ูุชู ูููู ุจุนุฏ ุนูู ุทูู ุณูุณูุฉ ูู ุงูููุงุถููู ุ </li><li style=";text-align:right;direction:rtl">  <code>ResponseStarted</code> - ุชู ุฅุฑุณุงู ุฑุคูุณ ุงูุงุณุชุฌุงุจุฉ ุ ูููู ูุจู ุฅุฑุณุงู ูุต ุงูุงุณุชุฌุงุจุฉ.  ุชู ุฅูุดุงุคู ููุงุณุชุนูุงูุงุช ุงูุทูููุฉ (ูุซู <code>watch</code> ) ุ </li><li style=";text-align:right;direction:rtl">  <code>ResponseComplete</code> - ุชู ุฅุฑุณุงู ูุต ุงูุงุณุชุฌุงุจุฉ ุ ููู ูุชู ุฅุฑุณุงู ุงููุฒูุฏ ูู ุงููุนูููุงุช ุ </li><li style=";text-align:right;direction:rtl">  <code>Panic</code> - ูุชู ุฅูุดุงุก ุงูุฃุญุฏุงุซ ุนูุฏ ุงูุชุดุงู ุญุงูุฉ ุงูุทูุงุฑุฆ. </li></ul><br>  ููููู ุงุณุชุฎุฏุงู <code>omitStages</code> ูุชุฎุทู ุฃู ูุฑุงุญู. <br><br>  ูู ููู ุงูุณูุงุณุฉ ุ ูููููุง ูุตู ุนุฏุฉ ุฃูุณุงู ุจูุณุชููุงุช ูุฎุชููุฉ ูู ุงูุชุณุฌูู.  ุณูุชู ุชุทุจูู ูุงุนุฏุฉ ุงููุทุงุจูุฉ ุงูุฃููู ุงูููุฌูุฏุฉ ูู ูุตู ุงูุณูุงุณุฉ. <br><br>  ูุฑุงูุจ ุงูุจุฑูุงูุฌ ุงูุฎูู kubelet ุงูุชุบููุฑ ุงูุธุงูุฑ ูู ุฎูุงู ุชูููู api-server ุ ูุฅุฐุง ุชู ุงูุชุดุงู ุฃู ุดูุก ุ ูุฅูู ูุนูุฏ ุชุดุบูู ุงูุญุงููุฉ ุจุฎุงุฏู api.  ูููู ููุงู ุชูุงุตูู ูููุฉ: <b>ุณูู ูุชุฌุงูููู ุงูุชุบููุฑุงุช ูู ููู ุงูุณูุงุณุฉ</b> .  ุจุนุฏ ุฅุฌุฑุงุก ุชุบููุฑุงุช ุนูู ููู ุงูุณูุงุณุฉ ุ ุณุชุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ุชุดุบูู api-server ูุฏูููุง.  ูุธุฑูุง ูุฃู api-server ูุนูู <code>kubectl delete</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุซุงุจุชุฉ</a> ุ ูุฅู ุฃูุฑ <code>kubectl delete</code> ูุนูุฏ ุชุดุบููู.  ุณูุชุนูู ุนููู <code>docker stop</code> ูุฏูููุง ุนูู kube-masters ุญูุซ ุชู ุชุบููุฑ ุณูุงุณุฉ ุงูุชุฏููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">docker stop $(docker ps | grep k8s_kube-apiserver | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span>)</code> </pre> <br>  ุนูุฏ ุชูููู ุงูุชุฏููู ุ ูู ุงูููู ุฃู ุชุชุฐูุฑ ุฃู <b>kube-apiserver ูู ุญูู ุฃุนูู</b> .  ุนูู ูุฌู ุงูุฎุตูุต ุ ูุฒุฏุงุฏ ุงุณุชููุงู ุงูุฐุงูุฑุฉ ูุชุฎุฒูู ุณูุงู ุงูุทูุจุงุช.  ูุจุฏุฃ ุงูุชุณุฌูู ููุท ุจุนุฏ ุฅุฑุณุงู ุฑุฃุณ ุงูุงุณุชุฌุงุจุฉ.  ุฃูุถุง ุ ูุนุชูุฏ ุงูุญูู ุนูู ุชูููู ุณูุงุณุฉ ุงูุชุฏููู. <br><br><h3 style=";text-align:right;direction:rtl">  ุฃูุซูุฉ ุงูุณูุงุณุฉ </h3><br>  ุฏุนูุง ูุญูู ุจููุฉ ูููุงุช ุงูุณูุงุณุฉ ุจุงุณุชุฎุฏุงู ุงูุฃูุซูุฉ. <br><br>  ุฅููู ููู <code>policy</code> ุจุณูุท ูุชุณุฌูู ูู ุดูุก ุนูู ูุณุชูู <code>Metadata</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: audit.k8s.io/v1 kind: Policy rules: - level: Metadata</code> </pre> <br>  ููููู ุชุญุฏูุฏ ูุงุฆูุฉ ุงููุณุชุฎุฏููู ( <code>Users</code> ู <code>ServiceAccounts</code> ) ููุฌููุนุงุช ุงููุณุชุฎุฏููู ูู ุงูุณูุงุณุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุชุฌุงูู ุจูุง ูุณุชุฎุฏูู ุงููุธุงู ุ ูููููุง ูุณุฌู ูู ุดูุก ุขุฎุฑ ุนูู ูุณุชูู <code>Request</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: audit.k8s.io/v1 kind: Policy rules: - level: None userGroups: - "system:serviceaccounts" - "system:nodes" users: - "system:anonymous" - "system:apiserver" - "system:kube-controller-manager" - "system:kube-scheduler" - level: Request</code> </pre> <br>  ูู ุงููููู ุฃูุถูุง ูุตู ุงููุฏู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุณุงุญุฉ ( <code>namespaces</code> )ุ </li><li style=";text-align:right;direction:rtl">  ุงูุฃูุนุงู ( <i>ุงูุฃูุนุงู</i> : <code>get</code> ุ <code>update</code> ุ <code>delete</code> and others)ุ </li><li style=";text-align:right;direction:rtl">  ุงูููุงุฑุฏ ( <i>ุงูููุงุฑุฏ</i> ุ ููู: <code>pod</code> ุ <code>configmaps</code> ุ ุฅูุฎ) ููุฌููุนุงุช ุงูููุงุฑุฏ ( <code>apiGroups</code> ). </li></ul><br>  <b>ุงูุชุจู!</b>  ูููู ุงูุญุตูู ุนูู ูุฌููุนุงุช ุงูููุงุฑุฏ ูุงูููุงุฑุฏ (ูุฌููุนุงุช API ุ ุฃู apiGroups) ุ ููุฐูู ุฅุตุฏุงุฑุงุชูุง ุงููุซุจุชุฉ ูู ุงููุชูุฉ ุ ุจุงุณุชุฎุฏุงู ุงูุฃูุงูุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl api-resources kubectl api-versions</code> </pre> <br>  ูุชู ุชูููุฑ ุณูุงุณุฉ ุงูุชุฏููู ุงูุชุงููุฉ ูุฏููู ุนูู ุฃูุถู ุงูููุงุฑุณุงุช ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู Alibaba Cloud</a> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: audit.k8s.io/v1beta1 kind: Policy #    RequestReceived omitStages: - "RequestReceived" rules: #   ,     : - level: None users: ["system:kube-proxy"] verbs: ["watch"] resources: - group: "" #  api group   ,    #   Kubernetes,  โcoreโ resources: ["endpoints", "services"] - level: None users: ["system:unsecured"] namespaces: ["kube-system"] verbs: ["get"] resources: - group: "" # core resources: ["configmaps"] - level: None users: ["kubelet"] verbs: ["get"] resources: - group: "" # core resources: ["nodes"] - level: None userGroups: ["system:nodes"] verbs: ["get"] resources: - group: "" # core resources: ["nodes"] - level: None users: - system:kube-controller-manager - system:kube-scheduler - system:serviceaccount:kube-system:endpoint-controller verbs: ["get", "update"] namespaces: ["kube-system"] resources: - group: "" # core resources: ["endpoints"] - level: None users: ["system:apiserver"] verbs: ["get"] resources: - group: "" # core resources: ["namespaces"] #     read-only URLs: - level: None nonResourceURLs: - /healthz* - /version - /swagger* #   ,     โโ: - level: None resources: - group: "" # core resources: ["events"] #   Secret, ConfigMap  TokenReview    , #         - level: Metadata resources: - group: "" # core resources: ["secrets", "configmaps"] - group: authentication.k8s.io resources: ["tokenreviews"] #   get, list  watch   ;    - level: Request verbs: ["get", "list", "watch"] resources: - group: "" # core - group: "admissionregistration.k8s.io" - group: "apps" - group: "authentication.k8s.io" - group: "authorization.k8s.io" - group: "autoscaling" - group: "batch" - group: "certificates.k8s.io" - group: "extensions" - group: "networking.k8s.io" - group: "policy" - group: "rbac.authorization.k8s.io" - group: "settings.k8s.io" - group: "storage.k8s.io" #        API - level: RequestResponse resources: - group: "" # core - group: "admissionregistration.k8s.io" - group: "apps" - group: "authentication.k8s.io" - group: "authorization.k8s.io" - group: "autoscaling" - group: "batch" - group: "certificates.k8s.io" - group: "extensions" - group: "networking.k8s.io" - group: "policy" - group: "rbac.authorization.k8s.io" - group: "settings.k8s.io" - group: "storage.k8s.io" #         - level: Metadata</code> </pre> <br><br>  ูุซุงู ุฌูุฏ ุขุฎุฑ ูุณูุงุณุฉ ุงูุชุฏููู ูู <a href="">ููู ุงูุชุนุฑูู ุงููุณุชุฎุฏู ูู ุงูุญููุฉ ุงูุนุงูููุฉ ููุชุนููู</a> . <br><br>  ููุงุณุชุฌุงุจุฉ ุงูุณุฑูุนุฉ ูุฃุญุฏุงุซ ุงูุชุฏููู ุ ูู ุงููููู <b>ูุตู webhook</b> .  ุชู ุงููุดู ุนู ูุฐู ุงููุดููุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู ุงูุฑุณููุฉ</a> ุ ุณุฃุชุฑููุง ุฎุงุฑุฌ ูุทุงู ูุฐู ุงูููุงูุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงููุชุงุฆุฌ </h2><br>  ุชููุฑ ูุฐู ุงูููุงูุฉ ูุธุฑุฉ ุนุงูุฉ ุญูู ุขููุงุช ุงูุฃูุงู ุงูุฃุณุงุณูุฉ ูู ูุฌููุนุงุช Kubernetes ุงูุชู ุชุชูุญ ูู ุฅูุดุงุก ุญุณุงุจุงุช ูุณุชุฎุฏู ูุฎุตุตุฉ ููุดุงุฑูุฉ ุญููููุง ูุชุณุฌูู ุฅุฌุฑุงุกุงุชูุง.  ุขูู ุฃู ุชููู ูููุฏุฉ ูุฃููุฆู ุงูุฐูู ููุงุฌููู ูุซู ูุฐู ุงูุฃุณุฆูุฉ ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุฃู ุจุงููุนู ูู ุงูููุงุฑุณุฉ.  ุฃูุตู ุฃูุถูุง ุจุฃู ุชูุธุฑ ุฅูู ูุงุฆูุฉ ุงูููุงุฏ ุงูุฃุฎุฑู ุญูู ููุถูุน ุงูุฃูู ูู Kubernetes ุ ุงููุฏุฑุฌุฉ ูู "PS" - ุฑุจูุง ูููุง ุจูููุง ุณุชุฌุฏ ุงูุชูุงุตูู ุงููุงุฒูุฉ ุญูู ุงููุถุงูุง ุฐุงุช ุงูุตูุฉ ุจู. <br><br><h2 style=";text-align:right;direction:rtl">  PS </h2><br>  ุงูุฑุฃ ุฃูุถูุง ูู ูุฏููุชูุง: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">33+ ุฃุฏูุงุช ุฃูุงู Kubernetes</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฏูุฉ ูุณูุงุณุงุช ุดุจูุฉ Kubernetes ููุชุฎุตุตู ุงูุฃูู</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููู RBAC ูู Kubernetes</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">9 ุฃูุถู ุงูููุงุฑุณุงุช ุงูุฃูููุฉ ูู Kubernetes</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">11 ุทุฑููุฉ (ูุง) ุชุตุจุญ ุถุญูุฉ ุงููุฑุตูุฉ Kubernetes</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar468679/">https://habr.com/ru/post/ar468679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar468657/index.html">ุฑูุตุงุช ูุน ุงูุฏุนู: ุฃููุงุน ูุฃุดูุงู ุงูุฏุนู. ุฏุนู ุงููุธู ุงูุนุงููุฉ ูู ุงููุนุฑูุฉ</a></li>
<li><a href="../ar468663/index.html">ููุฌ ุงูููุงูุฉ End2 ูู ููุงู ุงูุชุนุฑู ุนูู ุงูููุงู ุงูุชููุงุฆู</a></li>
<li><a href="../ar468665/index.html">ูููู ูู ุญุงู ุงูููุช ูุดุฑุงุก ุงูุฑูุ</a></li>
<li><a href="../ar468673/index.html">ูุฑุดุฉ ุนูู "ุถูุงู ุฃูู ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ" - 3 ุฃูุชูุจุฑ ุ ุณุงูุช ุจุทุฑุณุจุฑุบ</a></li>
<li><a href="../ar468677/index.html">ุงูุฅุนูุงู ุนู ุงููุงุชู ุงูุฐูู Xiaomi Mi Mix Alpha</a></li>
<li><a href="../ar468683/index.html">ูุธุฑูุฉ ูููุงุฑุณุฉ ุชูุญูุฏ ุฎุฏูุงุช ุฏููุฑ</a></li>
<li><a href="../ar468687/index.html">ูููู ุจุชุญููู ุงููุจุงุฏุฑุงุช ุงูุฌุฏูุฏุฉ ููุจูู ุงููุฑูุฒู ูุชูุธูู ุณูู ุงูุฃูุฑุงู ุงููุงููุฉ: 3 ูุฌููุนุงุช ูู ุงููุณุชุซูุฑูู ุ ูููุฏ ูููุจุชุฏุฆูู</a></li>
<li><a href="../ar468689/index.html">ุชุณุฌูู ุฃุนูุงู ุชูููููุฌูุง ุงููุนูููุงุช ูู ุณูุบุงููุฑุฉ: ูุงุฐุง ุนูู ุฃู ุฃูุนูุ</a></li>
<li><a href="../ar468691/index.html">ุจุฑุงูุฌ ุชุดุบูู ุงูุฌูุงุช ุงูุฎุงุฑุฌูุฉ ุงูุฎุทุฑุฉ ุนูู ูุธุงูู ุฃู LOLDrivers</a></li>
<li><a href="../ar468693/index.html">ููู ุงูุฃุชูุชุฉ ูุฏูุฑ ููุธูู ููู ูุงุฑุช</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>