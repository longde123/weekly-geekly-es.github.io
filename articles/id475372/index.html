<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎩 🥜 🙇🏾 Domain front-end berdasarkan TLS 1.3 👧🏼 📉 ☝🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendahuluan 

 Sistem penyaringan konten perusahaan modern dari produsen terkemuka seperti Cisco, BlueCoat, FireEye memiliki banyak kesamaan dengan re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Domain front-end berdasarkan TLS 1.3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475372/"><h3>  Pendahuluan </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bn/0p/mv/bn0pmvrdjnyzw-hr4glj5lekpmk.png"></div><br>  Sistem penyaringan konten perusahaan modern dari produsen terkemuka seperti Cisco, BlueCoat, FireEye memiliki banyak kesamaan dengan rekan-rekan mereka yang lebih kuat - sistem DPI yang sedang dilaksanakan secara intensif di tingkat nasional.  Inti dari pekerjaan keduanya adalah untuk mencari lalu lintas Internet yang masuk dan keluar dan, berdasarkan daftar hitam / putih, membuat keputusan untuk melarang koneksi Internet.  Dan karena keduanya mengandalkan prinsip yang sama dalam dasar-dasar pekerjaan mereka, cara untuk mengelak dari mereka juga akan memiliki banyak kesamaan. <br><br>  Salah satu teknologi yang memungkinkan mem-bypass DPI dan sistem korporat secara efisien adalah teknologi yang menghadap ke depan.  Esensinya terletak pada kenyataan bahwa kita pergi ke sumber daya yang diblokir, bersembunyi di balik domain publik lainnya, dengan reputasi yang baik, yang jelas tidak akan diblokir oleh sistem apa pun, misalnya google.com. <br><br>  Banyak artikel telah ditulis tentang teknologi ini dan banyak contoh telah diberikan.  Namun, DNS-over-HTTPS dan teknologi terenkripsi-SNI, serta teknologi yang baru-baru ini dibahas, serta versi baru protokol TLS 1.3, memberikan kesempatan untuk mempertimbangkan varian lain dari domain yang menghadap ke depan. <br><a name="habracut"></a><br><h3>  Kami berurusan dengan teknologi </h3><br>  Pertama, mari kita putuskan sedikit tentang konsep dasar sehingga setiap orang memiliki pemahaman tentang siapa adalah siapa dan mengapa semua ini diperlukan.  Kami menyebutkan mekanisme eSNI, yang karyanya akan dibahas nanti.  Mekanisme eSNI (Indikasi Nama Server terenkripsi) adalah versi SNI yang aman, hanya tersedia untuk protokol TLS 1.3.  Poin utamanya adalah mengenkripsi, termasuk informasi tentang ke domain mana permintaan dikirimkan. <br><br>  Sekarang mari kita lihat bagaimana mekanisme eSNI bekerja dalam praktiknya. <br><br>  Katakanlah kita memiliki sumber daya Internet yang diblokir oleh solusi DPI modern (ambil, misalnya, pelacak torrent yang terkenal - rutracker.nl).  Ketika kami mencoba mengakses situs pelacak torrent, kami melihat rintisan standar penyedia yang sumbernya diblokir: <br><br><img src="https://habrastorage.org/webt/hj/rt/kd/hjrtkdnlahnohjgs-tq-jzfctnu.png"><br><br>  Di situs web ILV, domain ini memang tercantum dalam daftar berhenti: <br><br><img src="https://habrastorage.org/webt/4g/2m/k0/4g2mk0d4ks6xzbvmvv0za-vt16y.png"><br><br>  Ketika Anda meminta whois, Anda dapat melihat bahwa domain itu sendiri "tersembunyi" di belakang penyedia cloud Cloudflare. <br><br><img src="https://habrastorage.org/webt/my/wa/ki/mywakijkqem9a32jtmwyb0tcwfs.png"><br><br>  Tetapi tidak seperti "spesialis" dari ILV, karyawan yang lebih mengerti secara teknis dari langsung menuju (atau diajarkan oleh pengalaman pahit dari regulator terkenal kami) tidak secara bodoh melarang situs dengan alamat IP, tetapi memasukkan nama domain dalam daftar berhenti.  Ini mudah untuk diverifikasi jika Anda melihat domain lain yang bersembunyi di balik alamat IP yang sama, kunjungi salah satunya dan melihat bahwa akses tidak diblokir: <br><br><img src="https://habrastorage.org/webt/dk/j2/gk/dkj2gkveuqcbwkbumlrebfznt8u.png"><br><br>  Tetapi bagaimana itu bisa terjadi?  Bagaimana penyedia DPI mengetahui domain mana yang digunakan browser saya, karena semua komunikasi dilakukan melalui protokol https, dan kami sepertinya tidak melihat substitusi sertifikat https dari langsung menuju?  Apakah dia peramal atau dia diikuti oleh saya? <br><br>  Mari kita coba menjawab pertanyaan ini dengan melihat lalu lintas melalui wireshark <br><br><img src="https://habrastorage.org/webt/c1/k2/9e/c1k29ehqnytwfvw8udk-m6mkv6q.png"><br><br>  Tangkapan layar menunjukkan bahwa pertama browser menerima alamat IP server melalui DNS, lalu ada handshake TCP standar dengan server tujuan, dan kemudian browser mencoba membuat koneksi ssl ke server.  Untuk melakukan ini, ia mengirimkan paket Hello Client SSL, yang berisi nama domain sumber dalam teks yang jelas.  Bidang ini diperlukan oleh server cloudflare front-end untuk merutekan koneksi dengan benar.  Di sinilah penyedia DPI menangkap kami, memutuskan koneksi kami.  Pada saat yang sama, kami tidak menerima rintisan dari penyedia, dan kami melihat kesalahan peramban standar seolah-olah situs itu terputus atau tidak berfungsi: <br><br><img src="https://habrastorage.org/webt/tn/8h/fa/tn8hfavie40wl2qqiogrdqrxptw.png"><br><br>  Sekarang mari kita aktifkan mekanisme eSNI di browser, seperti yang dijelaskan dalam instruksi untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://miketabor.com/enable-dns-over-">Firefox</a> : <br>  Untuk melakukan ini, kami membuka halaman konfigurasi Firefox <b>tentang: config</b> dan aktifkan pengaturan berikut: <br><br><pre><code class="plaintext hljs">network.trr.mode = 2; network.trr.uri = https://mozilla.cloudflare-dns.com/dns-query network.security.esni.enabled = true</code> </pre> <br>  Setelah itu, kami akan memeriksa kebenaran pengaturan di situs web cloudflare menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> dan mencoba fokus dengan pelacak torrent kami lagi. <br><br><img src="https://habrastorage.org/webt/p6/o3/o-/p6o3o-zt1k8yqi4ht_rcrxugyfg.png"><br><br>  Voila.  Pelacak favorit kami dibuka tanpa VPN atau proksi.  Sekarang mari kita lihat tempat pembuangan lalu lintas di wireshark, apa yang terjadi. <br><br><img src="https://habrastorage.org/webt/ll/az/gj/llazgjig0xbha6ndnlvj0nqvziw.png"><br><br>  Kali ini, paket halo klien ssl tidak secara eksplisit berisi domain tujuan, melainkan bidang baru yang muncul dalam paket - encrypted_server_name - ini adalah tempat nilai rutracker.nl terkandung, dan hanya server cloudflare front-end yang dapat mendekripsi bidang ini.  Dan jika demikian, maka penyedia DPI tidak punya pilihan selain mencuci tangan dan mengizinkan lalu lintas tersebut.  Tetapi tidak ada opsi lain dengan enkripsi. <br><br>  Jadi, bagaimana teknologi ini bekerja di browser - kami melihat.  Sekarang mari kita coba menerapkannya untuk hal-hal yang lebih spesifik dan menarik.  Dan sebagai permulaan, kami akan mengajarkan ikal yang sama untuk menggunakan eSNI untuk bekerja dengan TLS 1.3, dan pada saat yang sama kita akan melihat bagaimana domain front-end berbasis eSNI itu sendiri bekerja. <br><br><h3>  Domain Front End dengan eSNI </h3><br>  Karena fakta bahwa curl menggunakan pustaka openssl standar untuk menghubungkan melalui https, pertama-tama, kita perlu memberikan dukungan eSNI di sana.  Belum ada dukungan untuk eSNI di cabang master openssl, jadi kami perlu mengunduh cabang openssl khusus, kompilasi dan instal. <br><br>  Kami mengkloning repositori dari github dan mengkompilasi seperti biasa: <br><br><pre> <code class="plaintext hljs">$ git clone https://github.com/sftcd/openssl $ cd openssl $ ./config $ make $ cd esnistuff $ make</code> </pre><br>  Selanjutnya, kami mengkloning repositori dengan curl dan mengkonfigurasi kompilasi menggunakan pustaka openssl kami yang telah dirakit: <br><br><pre> <code class="plaintext hljs">$ cd $HOME/code $ git clone https://github.com/niallor/curl.git curl-esni $ cd curl-esni $ export LD_LIBRARY_PATH=/opt/openssl $ ./buildconf $ LDFLAGS="-L/opt/openssl" ./configure --with-ssl=/opt/openssl --enable-esni --enable-debug</code> </pre><br>  Penting untuk menunjukkan dengan benar semua direktori di mana openssl berada (dalam kasus kami, itu adalah / opt / openssl /) dan pastikan bahwa proses konfigurasi berjalan tanpa kesalahan. <br><br>  Jika konfigurasi berhasil, kita akan melihat baris: <br><br>  <b>PERINGATAN: esni ESNI diaktifkan tetapi ditandai EKSPERIMENTAL.</b>  <b>Gunakan dengan hati-hati!</b> <br><br><pre> <code class="plaintext hljs">$ make</code> </pre> <br>  Setelah berhasil membangun paket, kami akan menggunakan file bash openssl khusus untuk mengonfigurasi dan menjalankan curl.  Salin ke direktori dengan curl untuk kenyamanan: <br><br><pre> <code class="plaintext hljs">cp /opt/openssl/esnistuff/curl-esni</code> </pre> <br>  dan menjalankan permintaan https pengujian ke server cloudflare, sementara secara bersamaan menulis paket DNS dan TLS ke Wireshark. <br><br><pre> <code class="plaintext hljs">$ ESNI_COVER="www.hello-rkn.ru" ./curl-esni https://cloudflare.com/</code> </pre> <br>  Dalam respons server, selain banyak informasi debug dari openssl dan curl, kami mendapatkan respons HTTP dengan kode 301 dari cloudflare. <br><br><pre> <code class="plaintext hljs">HTTP/1.1 301 Moved Permanently &lt; Date: Sun, 03 Nov 2019 13:12:55 GMT &lt; Transfer-Encoding: chunked &lt; Connection: keep-alive &lt; Cache-Control: max-age=3600 &lt; Expires: Sun, 03 Nov 2019 14:12:55 GMT &lt; Location: https://www.cloudflare.com/</code> </pre><br>  yang menunjukkan bahwa permintaan kami berhasil dikirim ke server tujuan, didengar dan diproses. <br><br>  Sekarang mari kita lihat tempat pembuangan lalu lintas di wireshark, mis.  apa yang dilihat penyedia DPI dalam kasus ini. <br><br><img src="https://habrastorage.org/webt/sp/va/-o/spva-ogjvtwlfyiea9vg4n8qbla.png"><br><br>  Dapat dilihat bahwa ikal pertama beralih ke server DNS untuk kunci eSNI publik untuk server cloudflare - Permintaan DNS TXT ke _esni.cloudflare.com (paket No. 13).  Kemudian, menggunakan perpustakaan openssl, curl mengirim permintaan TLS 1.3 ke server cloudflare di mana bidang SNI dienkripsi dengan kunci publik yang diperoleh pada langkah sebelumnya (paket No. 22).  <b>Namun, selain bidang eSNI, sebagai bagian dari paket SSL-halo, bidang juga disisipkan dengan SNI biasa - terbuka, yang dapat kami tentukan dalam urutan apa pun (dalam hal ini - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.hello-rkn.ru</a> ).</b> <br><br>  Bidang SNI terbuka ini tidak diperhitungkan saat diproses oleh server cloudflare dan hanya merupakan penyamaran bagi penyedia DPI.  Server cloudflare menerima paket ssl-hello kami, mendekripsi eSNI, mengekstraksi SNI asli dari sana dan mengolahnya seolah-olah tidak ada yang terjadi (ia melakukan segalanya persis seperti yang direncanakan selama pengembangan eSNI). <br><br>  Satu-satunya hal dalam hal ini, Anda dapat berpegang teguh pada DPI - permintaan DNS utama di _esni.cloudflare.com.  Tapi kami membuat permintaan DNS terbuka hanya untuk menunjukkan bagaimana mekanisme ini bekerja dari dalam. <br><br>  Untuk akhirnya menjatuhkan tanah dari bawah DPI, kami menggunakan mekanisme DNS-over-HTTPS yang telah disebutkan.  Penjelasan kecil - DOH - protokol yang memungkinkan Anda untuk melindungi diri dari seorang pria di serangan tengah dengan mengirimkan permintaan DNS melalui HTTPS. <br><br>  Kami akan mengeksekusi permintaan lagi, tetapi kali ini kami akan mendapatkan kunci eSNI publik menggunakan protokol https, bukan DNS: <br><br><pre> <code class="plaintext hljs">ESNI_COVER="www.hello-rkn.ru" DOH_URL=https://mozilla.cloudflare-dns.com/dns-query ./curl-esni https://cloudflare.com/</code> </pre> <br>  Permintaan traffic traffic disajikan dalam tangkapan layar di bawah ini: <br><br><img src="https://habrastorage.org/webt/qz/0m/ky/qz0mky5bwnmguhwleqennudeupc.png"><br><br>  Terlihat bahwa pertama curl mengakses server mozilla.cloudflare-dns.com menggunakan protokol DoH (koneksi https ke server 104.16.249.249) untuk mendapatkan nilai kunci publik untuk enkripsi SNI dari mereka, dan kemudian ke server tujuan, bersembunyi di bawah domain. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.hello-rkn.ru</a> . <br><br>  Selain DoH resolver mozilla.cloudflare-dns.com yang ditentukan di atas, kita dapat menggunakan layanan DoH populer lainnya, misalnya, dari perusahaan jahat yang terkenal. <br>  Kami melaksanakan permintaan berikut: <br><br><pre> <code class="plaintext hljs">ESNI_COVER="www.kremlin.ru" DOH_URL=https://dns.google/dns-query ./curl-esni https://rutracker.nl/</code> </pre> <br>  Dan kami mendapatkan jawabannya: <br><br><pre> <code class="plaintext hljs">&lt; HTTP/1.1 301 Moved Permanently &lt; Date: Sun, 03 Nov 2019 14:10:22 GMT &lt; Content-Type: text/html &lt; Transfer-Encoding: chunked &lt; Connection: keep-alive &lt; Set-Cookie: __cfduid=da0144d982437e77b0b37af7d00438b1a1572790222; expires=Mon, 02-Nov-20 14:10:22 GMT; path=/; domain=.rutracker.nl; HttpOnly; Secure &lt; Location: https://rutracker.nl/forum/index.php &lt; CF-Cache-Status: DYNAMIC &lt; Expect-CT: max-age=604800, report-uri="https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct" &lt; Server: cloudflare &lt; CF-RAY: 52feee696f42d891-CPH</code> </pre><br><img src="https://habrastorage.org/webt/dk/xk/b-/dkxkb-cudflzhgaxaebb1xhd9bw.png"><br><br>  Dalam kasus ini, kami beralih ke rutracker.nl server yang diblokir, menggunakan resolver dns.google DoH (tidak ada kesalahan ketik, sekarang perusahaan terkenal memiliki domain tingkat pertama sendiri) dan menutup diri dengan domain lain, yang dilarang keras oleh semua DPI untuk memblokir takut akan hukuman mati.  Menurut jawaban Anda dapat memahami bahwa permintaan kami berhasil diproses. <br><br>  Sebagai pemeriksaan tambahan bahwa penyedia DPI menanggapi SNI terbuka, yang kami sampaikan sebagai penutup - kami dapat melaksanakan permintaan ke rutracker.nl di belakang beberapa sumber daya terlarang lainnya, misalnya, pelacak torrent "baik" lainnya: <br><br><pre> <code class="plaintext hljs">$ ESNI_COVER="rutor.info" DOH_URL=https://dns.google/dns-query ./curl-esni https://rutracker.nl/</code> </pre> <br>  Kami tidak akan menerima respons dari server, karena  permintaan kami akan diblokir oleh sistem DPI. <br><br><h3>  Kesimpulan kecil untuk bagian pertama </h3><br>  Jadi, kami dapat menunjukkan kesehatan eSNI menggunakan openssl dan curl dan menguji operasi front-end berbasis domain berdasarkan eSNI.  Dengan cara yang sama, kita dapat mengadaptasi alat favorit kita menggunakan pustaka openssl untuk bekerja "di bawah penutup" dari domain lain.  Lebih lanjut tentang ini di artikel kami berikutnya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id475372/">https://habr.com/ru/post/id475372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id475354/index.html">Selamat Hari Spesialis Keamanan</a></li>
<li><a href="../id475358/index.html">Analisis gaji di sektor TI Armenia plus lowongan terbuka di perusahaan-perusahaan TI TOP10</a></li>
<li><a href="../id475366/index.html">Droidcon London 2019: tren baru dan laporan paling menarik</a></li>
<li><a href="../id475368/index.html">Cara menghitung efektivitas iklan</a></li>
<li><a href="../id475370/index.html">Algoritma Kahan: Cara Mendapatkan Perbedaan Produk yang Tepat</a></li>
<li><a href="../id475378/index.html">“Kami tidak dapat menyerahkan hak data pribadi kepada perusahaan besar” - mantan pemimpin redaksi Wired UK tentang masa depan teknologi</a></li>
<li><a href="../id475386/index.html">Perhatian, FAS: bagaimana tidak melanggar UU Periklanan. Memo Pengiklan</a></li>
<li><a href="../id475388/index.html">Minggu Keamanan 46: mikrofon, laser, dan keamanan mesin yang terlatih</a></li>
<li><a href="../id475390/index.html">Cara membuat aplikasi web pertama Anda menggunakan Go</a></li>
<li><a href="../id475392/index.html">Mengapa menggunakan python -m pip</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>