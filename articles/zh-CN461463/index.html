<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ³ ğŸ–¼ï¸ ğŸ”› ä¼ä¸šå…¬å¸çš„ä¸šåŠ¡æµç¨‹ï¼šæŠ•æœºä¸ç°å®ã€‚ å¸¦Rçš„æ£šç¯ ğŸ”£ ğŸŒ° ğŸŒ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å…³äºâ€œæ•°å­—å­ªç”Ÿâ€æ¦‚å¿µæ—¥ç›Šå¼•èµ·äººä»¬å…³æ³¨çš„ä¸šåŠ¡æµç¨‹æŒ–æ˜çš„ç®€çŸ­æ–‡ç« ã€‚ ç”±äºè¯¥ä¸»é¢˜çš„å‘¨æœŸæ€§å‡ºç°ï¼Œæˆ‘è®¤ä¸ºåˆ†äº«è§£å†³æ–¹æ¡ˆçš„æ–¹æ³•æ˜¯é€‚å½“çš„ã€‚ 
 é—®é¢˜é™ˆè¿° 


 æƒ…å†µéå¸¸ç®€å•ã€‚ 


- æœ‰å…¬å¸Xï¼ˆYï¼ŒZï¼Œ...ï¼‰ã€‚ 
- è¯¥å…¬å¸æ‹¥æœ‰ç”±å„ç§ITç³»ç»Ÿè‡ªåŠ¨åŒ–çš„ä¸šåŠ¡æµç¨‹ã€‚ 
- æœ‰ä¸€äº›ä¸šåŠ¡åˆ†æå¸ˆä¸ºè¿™äº›æµç¨‹ç»˜åˆ¶äº†bpmnå›¾...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä¼ä¸šå…¬å¸çš„ä¸šåŠ¡æµç¨‹ï¼šæŠ•æœºä¸ç°å®ã€‚ å¸¦Rçš„æ£šç¯</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461463/"><p> å…³äºâ€œæ•°å­—å­ªç”Ÿâ€æ¦‚å¿µæ—¥ç›Šå¼•èµ·äººä»¬å…³æ³¨çš„ä¸šåŠ¡æµç¨‹æŒ–æ˜çš„ç®€çŸ­æ–‡ç« ã€‚ ç”±äºè¯¥ä¸»é¢˜çš„å‘¨æœŸæ€§å‡ºç°ï¼Œæˆ‘è®¤ä¸ºåˆ†äº«è§£å†³æ–¹æ¡ˆçš„æ–¹æ³•æ˜¯é€‚å½“çš„ã€‚ </p><br><h1 id="postanovka-zadachi"> é—®é¢˜é™ˆè¿° </h1><br><p> æƒ…å†µéå¸¸ç®€å•ã€‚ </p><br><ul><li> æœ‰å…¬å¸Xï¼ˆYï¼ŒZï¼Œ...ï¼‰ã€‚ </li><li> è¯¥å…¬å¸æ‹¥æœ‰ç”±å„ç§ITç³»ç»Ÿè‡ªåŠ¨åŒ–çš„ä¸šåŠ¡æµç¨‹ã€‚ </li><li> æœ‰ä¸€äº›ä¸šåŠ¡åˆ†æå¸ˆä¸ºè¿™äº›æµç¨‹ç»˜åˆ¶äº†bpmnå›¾ã€‚ æ›´å…·ä½“åœ°è¯´ï¼Œä»–ä»¬è‡ªå·±å¯¹è¿™äº›è¿‡ç¨‹çš„å¤–è§‚çš„â€œ bpmnæƒ³æ³•â€ã€‚ </li><li> ä¸šåŠ¡ç”¨æˆ·å¸Œæœ›å¯¹è¿™äº›è¿‡ç¨‹è¿›è¡ŒæŸç§å½¢å¼çš„è¡¨ç¤ºï¼ˆKPIï¼‰ã€‚ </li></ul><br><p> å¦‚ä½•å¾—å‡ºçœŸç›¸å¹¶è®¡ç®—è¿™äº›æŒ‡æ ‡ï¼Ÿ </p><br><p> å®ƒæ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä»¥å‰å‡ºç‰ˆç‰©</a>çš„å»¶ç»­ã€‚ <a name="habracut"></a></p><br>
<h1 id="formuliruem-zadachu-v-ponyatnyh-dlya-kompyutera-trebovaniyah"> æˆ‘ä»¬æ ¹æ®è®¡ç®—æœºå‹å¥½çš„è¦æ±‚åˆ¶å®šä»»åŠ¡ </h1><br><p> åŸºæœ¬å‡è®¾ï¼š </p><br><ul><li> æœ‰ä¸€ä¸ªçº¯åº¦ï¼Œå®Œæ•´æ€§å’Œä¸€è‡´æ€§å„å¼‚çš„ä¸´æ—¶äº‹ä»¶æ—¥å¿—ï¼ˆITç³»ç»Ÿçš„å„ç§æ—¥å¿—ï¼Œcdr \ xdrï¼Œåªæ˜¯æ•°æ®åº“ä¸­çš„äº‹ä»¶è®°å½•ï¼‰ã€‚ </li><li>  ITç³»ç»Ÿå……å½“çŠ¶æ€æœºï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„è¡Œä¸ºä»¥åŠå…¶ä¸­çš„ç¨‹åºå‘˜æ‰€åˆ¶å®šçš„ä¸šåŠ¡é€»è¾‘åœ¨ä¸åŒçŠ¶æ€ä¹‹é—´â€œèµ°åŠ¨â€ã€‚ </li><li> ç”¨æˆ·äº¤äº’ä»¥äº‹åŠ¡å½¢å¼è¿›è¡Œã€‚ </li></ul><br><p> ç‰©ç†ä¸–ç•Œæ›´æ­£ï¼š </p><br><ul><li> å¯¹ITç³»ç»Ÿè¿›è¡Œçš„æ›´æ”¹æ•°é‡å¦‚æ­¤ä¹‹å¤§ï¼Œä»¥è‡³äºä¸šåŠ¡åˆ†æå¸ˆçš„bpmnå›¾å‡ ä¹ä¸ç°å®æ— å…³ã€‚ </li><li> æ•°æ®å¯èƒ½æ˜¯éå¸¸éç»“æ„åŒ–çš„ï¼ˆä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºæ—¥å¿—ï¼‰ã€‚ </li><li>  â€œäº¤æ˜“â€æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µã€‚ äº‹ä»¶è®°å½•æœ¬èº«ä»…åŒ…å«æ­¤çŠ¶æ€ä¸­å›ºæœ‰çš„å±æ€§ï¼Œå¹¶ä¸”æ²¡æœ‰ç«¯åˆ°ç«¯äº‹åŠ¡æ ‡è¯†ç¬¦ã€‚ </li><li> æ¯å¤©çš„è®°å½•æ•°ä¸º<strong>æ•°åï¼Œå‡ ç™¾ï¼Œå‡ äº¿æ¡</strong> ã€‚ </li></ul><br><h1 id="reshenie-postavil-poschital"> é›†æ•°è§£å†³æ–¹æ¡ˆ </h1><br><p> è¦è§£å†³æ­¤ç±»é—®é¢˜ï¼Œæœ‰å¿…è¦ï¼š </p><br><ul><li> é‡å»ºäº¤æ˜“ </li><li> é‡å»ºçœŸå®çš„ä¸šåŠ¡æµç¨‹ </li><li> è¿›è¡Œè®¡ç®—ï¼› </li><li> ä»¥äººç±»å¯è¯»çš„æ ¼å¼ç”Ÿæˆç»“æœã€‚ </li></ul><br><p> æ‚¨å¯ä»¥å¼€å§‹å¯»æ‰¾ä¾›åº”å•†è§£å†³æ–¹æ¡ˆå¹¶æ”¯ä»˜æ•°ç™¾ä¸‡ç¾å…ƒã€‚ ä½†æ˜¯æˆ‘ä»¬æ‰‹ä¸­æœ‰R.å®ƒå¯ä»¥è®©æˆ‘ä»¬å®Œç¾åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ç®€è¦è€ƒè™‘å¦‚ä¸‹ã€‚ </p><br><p> ä¸€åˆ‡ä¼¼ä¹éƒ½å¾ˆç®€å•ï¼ŒRå…·æœ‰ä¸€ç»„è‰¯å¥½çš„ä¸€è‡´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">bupaR</a>è½¯ä»¶åŒ…ã€‚ ä½†æ˜¯ï¼Œè¯è†ä¸­æœ‰è‹è‡å­˜åœ¨ï¼Œå®ƒä¼šæ¯’åŒ–ä¸€åˆ‡ã€‚ åœ¨å¯æ¥å—çš„æ—¶é—´å†…è®¾ç½®æ­¤æ—¶é—´åªèƒ½åº”ä»˜å°‘é‡äº‹ä»¶ï¼ˆæ•°åä¸‡è‡³æ•°ç™¾ä¸‡ï¼‰ã€‚ <br> å¯¹äºå¤§æ‰¹é‡ï¼Œå¿…é¡»ä½¿ç”¨å…¶ä»–æ–¹æ³•ã€‚ </p><br><h1 id="dobavlyaem-skorosti"> å¢åŠ é€Ÿåº¦ï¼ </h1><br><h2 id="emuliruem-vhodnoy-nabor-dannyh"> æ¨¡æ‹Ÿè¾“å…¥æ•°æ®é›† </h2><br><p> ä¸ºäº†æ¼”ç¤ºæƒ³æ³•ï¼Œæœ‰å¿…è¦å½¢æˆæŸç§æµ‹è¯•æ•°æ®é›†ã€‚ è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªè”é‚¦å•†åº—çš„ç¤ºä¾‹ä½œä¸ºæ•°å­¦æ¨¡å‹çš„ç‰©ç†æ¥æºçš„ä¾‹å­ï¼Œå¹¸è¿çš„æ˜¯ï¼Œè¿™å¯¹æ¯ä¸ªäººéƒ½æ˜¯å¯ä»¥ç†è§£çš„ã€‚ å°½ç®¡å–å¾—äº†åŒæ ·çš„æˆåŠŸï¼Œä½†å®ƒå¯ä»¥æ˜¯è‡ªåŠ¨æŸœå‘˜æœºï¼Œå‘¼å«ä¸­å¿ƒï¼Œå…¬å…±äº¤é€šï¼Œä¾›æ°´ç­‰ã€‚ </p><br><ul><li> æœ‰å„ç§è§„æ¨¡çš„å•†åº—ï¼ˆå°ï¼Œä¸­å’Œå¤§ï¼‰ã€‚ </li><li> åœ¨å•†åº—ä¸­ï¼Œæœ‰æ”¶é“¶å°ï¼ˆPOSç»ˆç«¯ï¼‰ã€‚ </li><li> å•†åº—ç¼–å·å¯ä»¥æ˜¯å­—æ¯æ•°å­—ï¼›ç»ˆç«¯ç¼–å·å¯ä»¥æ˜¯æ•°å­—ã€‚ </li><li> è´­ç‰©è€…å»å•†åº—è´­ç‰©æ—¶ç”¨å¡ä»˜æ¬¾ã€‚ </li><li>  posç»ˆç«¯ä¸å¡å’Œé“¶è¡Œçš„äº¤äº’ä½œç”¨ç”±ä¸€ç»„çŠ¶æ€ä»¥åŠå®ƒä»¬ä¹‹é—´çš„è½¬æ¢è§„åˆ™æ¥æè¿°ã€‚ </li><li> äº¤æ˜“æˆåŠŸï¼Œå¤±è´¥ï¼Œå»¶æœŸä¸”ä¸å®Œæ•´ï¼ˆä¾‹å¦‚ï¼Œé“¶è¡Œä¸å¯ç”¨ï¼‰ã€‚ </li><li> äº‹åŠ¡æœ‰è¶…æ—¶ã€‚ </li></ul><br><p> é‡‡ç”¨ä»¥ä¸‹ä¸€ç»„ä¸šåŠ¡äº¤æ˜“æ¨¡å¼ï¼š </p><br><pre><code class="plaintext hljs">"INIT-REQUEST-RESPONSE-SUCCESS" "INIT-REQUEST-RESPONSE-ERROR" "INIT-REQUEST-RESPONSE-DEFFERED" "INIT-REQUEST" "INIT"</code> </pre> <br><p> ä¸ºäº†æ¼”ç¤ºè¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå°æ ·æœ¬ï¼Œä½†æ˜¯åœ¨æ•°åäº¿æ¡è®°å½•ä¸Šéƒ½å¯ä»¥æ­£å¸¸å·¥ä½œï¼ˆå¯¹äºæ²¡æœ‰è¶…æ·±åº¦ä¼˜åŒ–çš„è¿™ç§å·ï¼Œåœ¨<strong>æ€§èƒ½</strong>éå¸¸ä¸­ç­‰çš„å•å°æœåŠ¡å™¨ä¸Šï¼Œ <strong>ç‰¹å¾æ—¶é—´ä»…ä»¥æ•°ç™¾ç§’ä¸ºå•ä½</strong>è¿›è¡Œ<strong>æµ‹é‡</strong> ï¼‰ã€‚ </p><br><p> å¤§æ‰¹é‡ç›´æ¥æ‰°æµæ¿ï¼š </p><br><ul><li> åœ¨è®¸å¤šåœ°æ–¹ï¼Œ <code>tidyverse</code>æ„å‘³ç€<code>tidyverse</code>æ‰¾ä¸åˆ°ç­”æ¡ˆï¼› </li><li> ç”šè‡³ä¼˜åŒ–å¾®æ­¥éƒ½æ˜¯æœ‰ç”¨çš„ï¼Œå¹¶ä¸”å¯ä»¥åšå‡ºé‡å¤§è´¡çŒ®ã€‚ </li></ul><br><div class="spoiler">  <b class="spoiler_title">æ ·æœ¬ä»¿çœŸä»£ç </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">library(tidyverse) library(datapasta) library(tictoc) library(data.table) library(stringi) library(anytime) library(rTRNG) data.table::setDTthreads(0) #      data.table data.table::getDTthreads() #     set.seed(46572) RcppParallel::setThreadOptions(numThreads = parallel::detectCores() - 1) #   --   -,     #  5   -, 2  --   bo_pattern &lt;- tibble::tribble( #  ,    ,    ~pattern, ~prob, ~mean_duration, "INIT-REQUEST-RESPONSE-SUCCESS", 0.7, 5, "INIT-REQUEST-RESPONSE-ERROR", 0.15, 5, "INIT-REQUEST-RESPONSE-DEFFERED", 0.07, 8, "INIT-REQUEST", 0.05, 2, "INIT", 0.03, 0.5 ) #    +     checkmate::assertTRUE(sum(bo_pattern$prob) == 1) df &lt;- bo_pattern %&gt;% separate_rows(pattern) %&gt;% #   mutate(coeff = sum(prob)) %&gt;% group_by(pattern) %&gt;% #    summarise(event_prob = sum(prob/coeff)*100) %&gt;% ungroup() checkmate::assertTRUE(sum(df$event_prob) == 100) #   3  :  (4 ),  (12 ),  (30 ) df1 &lt;- tribble( ~type, ~n_pos, ~n_store, "small", 4, 10, "medium", 12, 5, "large", 30, 2 ) %&gt;% #       mutate(store = map2(row_number(), n_store, ~sample(x = .x * 1000 + 1:.y, size = .y, replace = FALSE))) %&gt;% unnest(store) %&gt;% #       mutate(pos = map(n_pos, ~sample(x = .x, size = .x, replace = FALSE))) %&gt;% unnest(pos) %&gt;% mutate(pattern = sample(bo_pattern$pattern, n(), replace = TRUE, prob = bo_pattern$prob)) tic("Generate transactions") #     ,      #         ,       df2 &lt;- df1 %&gt;% #         select(-matches("duration")) %&gt;% left_join(bo_pattern, by = "pattern") %&gt;% #   sample_frac(size = 200, replace = TRUE) %&gt;% mutate(duration = rnorm(n(), mean = mean_duration, sd = mean_duration * .25)) %&gt;% select(-prob, -mean_duration) %&gt;% #   ,      &gt;  #    30  filter(duration &gt; 0.5 &amp; duration &lt; 30) %&gt;% #    POS       mutate(session_id = row_number()) %&gt;% #     ,       separate_rows(pattern) %&gt;% rename(event = pattern) toc() tic("Generate time markers, data.table way") samples_tbl &lt;- data.table::as.data.table(df2) %&gt;% # setkey(session_id, duration, physical = FALSE) %&gt;% #           # 1-       , ,      5  # .[, ticks := base::sort(runif(.N, 5, 5 + duration)), by = .(session_id, duration)] %&gt;% #          match.arg   base::order!! #     #       0  1     #     # .[, tshift := runif(.N, 0, 1)] %&gt;% #    trng     (    ) # ,           .[, trand := runif_trng(.N, 0, 1, parallelGrain = 100L) * duration] %&gt;% #      ,      # .[, ticks := sort(tshift), by = .(session_id)] %&gt;% #  ,     session_id,   ,     .[, t_idx := session_id + trand / max(trand)/10] %&gt;% #         # session_id            .  .[, tshift := (sort(t_idx) - session_id) * 10 * max(trand)] %&gt;% #   ,     POS     (60 ) .[event == "INIT", tshift := tshift + runif_trng(.N, 0, 60, parallelGrain = 100L)] %&gt;% #     .[, `:=`(duration = NULL, trand = NULL, t_idx = NULL, n_store = NULL, n_pos = NULL, timestamp = as.numeric(anytime("2019-03-11 08:00:00 MSK")))] %&gt;% #     ,   01.03.2019     .[, timestamp := timestamp + cumsum(tshift), by = .(store, pos)] %&gt;% #      .[timestamp &lt;= as.numeric(anytime("2019-04-11 23:00:00 MSK")), ] %&gt;% #           .[, timestamp := anytime(timestamp, tz = "Europe/Moscow")] %&gt;% as_tibble() %&gt;% select(store, pos, event, timestamp, session_id) toc()</code> </pre> </div></div><br><p> ä¸ºäº†ä¿è¯å®éªŒçš„çº¯æ´æ€§ï¼Œæˆ‘ä»¬åªä¿ç•™é‡è¦å‚æ•°å¹¶æ··åˆæ‰€æœ‰å†…å®¹ã€‚ åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œä»ç„¶æœ‰å¿…è¦éšæœºä¸¢å¼ƒéƒ¨åˆ†ç‰‡æ®µï¼ˆå¯èƒ½åœ¨å•ç‹¬çš„æ—¶é—´å—ä¸­ï¼‰ï¼Œä»è€Œæ¨¡æ‹Ÿæ¥æ”¶æ•°æ®æ—¶çš„æŸå¤±ã€‚ </p><br><pre> <code class="plaintext hljs">#   log_tbl &lt;- samples_tbl %&gt;% select(store, pos, state = event, timestamp_msk = timestamp) %&gt;% sample_n(n()) #   log_tbl %&gt;% mutate(timegroup = lubridate::ceiling_date(timestamp_msk, unit = "10 mins")) %&gt;% ggplot(aes(timegroup)) + # geom_bar(width = 0.7*600) + geom_bar(colour = "white", size = 1.3) + theme_bw()</code> </pre> <br><p><img src="https://habrastorage.org/webt/lu/ik/kz/luikkzek29sujmfr3ggbbiabuh8.png"></p><br><p> æˆ‘ä»¬ç”¨å›¾ç‰‡è¯´æ˜æµç¨‹å›¾ </p><br><p><img src="https://habrastorage.org/webt/3g/i1/j3/3gi1j3yiclbsbu-knj8vuv7cas4.png" alt="å¯¹åŸå§‹`data.frame`çš„è®¡ç®—"></p><br><p> å’ŒçŠ¶æ€åˆ†å¸ƒ <br><img src="https://habrastorage.org/webt/5h/rw/uu/5hrwuuvmrqcgbsretr65g98epyy.png" alt="ä½¿ç”¨`bupaR`è¿›è¡Œå¯è§†åŒ–"></p><br><p> è½»å¾®çš„æ³¢åŠ¨æ˜¯ç”±äºè¿™æ ·çš„äº‹å®ï¼Œå³åœ¨è¡¨çš„å¼€å¤´è€ƒè™‘äº†è¯¥è¡¨ï¼ˆè¯¥è¡¨å·²åŒ…å«åœ¨ä»£ç ä¸­ï¼‰ï¼Œè€Œåœ¨<code>bupaR::process_map</code>çš„æœ«å°¾èµ·ä½œç”¨æ—¶ï¼Œä¸€äº›ä¸ç¬¦åˆç§¯åˆ†çº¦æŸçš„éšæœºç”Ÿæˆçš„æ•°æ®è¢«è¿‡æ»¤å…ƒç´ åˆ‡æ–­äº†ã€‚ </p><br><h2 id="rekonstrukciya-tranzakciy"> äº¤æ˜“é‡æ„ </h2><br><p> å½“æ‚¨å¿…é¡»æ”¶é›†/åˆ†è§£/æ¯”è¾ƒæ—¶é—´åºåˆ—æ—¶ï¼Œé€šå¸¸æä¾›çš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ†ç»„å’Œæ¯”è¾ƒå‘¨æœŸã€‚ åœ¨å…·æœ‰100ä¸ªæ¡ç›®çš„æ¼”ç¤ºä¸­ï¼Œæ­¤åŠ æ³•å°†èµ·ä½œç”¨ï¼Œä½†æ•°ç™¾ä¸‡ä¸ªåˆ—è¡¨å°†ä¸èµ·ä½œç”¨ã€‚ ä¸ºäº†å®Œæˆæ­¤ä»»åŠ¡ï¼Œæ‚¨éœ€è¦å®šä½æ—¶é—´æŸå¤±ç‚¹ï¼ˆå†…éƒ¨å¾ªç¯ï¼Œä¸­é—´å­˜å‚¨å™¨åˆ†é…å’Œå¤åˆ¶ï¼‰ï¼Œå¹¶å°è¯•å°†å…¶å‡å°‘åˆ°æœ€å°ã€‚ </p><br><p> ç»“æœï¼Œè¯¥é—®é¢˜å¯ä»¥å‡å°‘åˆ°åè¡Œã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">äº¤æ˜“é‡æ„ç </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">clean_dt &lt;- as.data.table(log_tbl) %&gt;% #     INIT .[, start := (state == "INIT")] %&gt;% #  session_id      ,  #             .[, event_date := lubridate::as_date(timestamp_msk)] %&gt;% .[, date_str := format(.BY[[1]], "%y%m%d"), by = event_date] %&gt;% #            # timestamp_msk    setorder(store, pos, timestamp_msk) %&gt;% #     --              .[, session_id := paste(date_str, store, pos, cumsum(start), sep = "_")] %&gt;% #        ( 30 ) # .[, time_shift := timestamp_msk - shift(timestamp_msk), by = .(store, pos)] %&gt;% #        ,   INIT .[, time_locf := cummax(as.numeric(timestamp_msk) * as.numeric(start)), by = .(store, pos)] %&gt;% .[, time_shift := as.numeric(timestamp_msk) - time_locf] %&gt;% #   ,       30  .[, lost_chain := time_shift &gt; 30] %&gt;% # .[, time_shift := as.numeric(!start) * as.numeric(timestamp_msk - shift(timestamp_msk, fill = 0))] %&gt;% # INIT    # .[, time_accu := cumsum(time_shift)] %&gt;% .[, date_str := NULL] #          #    tidyverse  ,      dt &lt;- as.data.table(clean_dt) %&gt;% #     !!! .[lost_chain != TRUE] %&gt;% #        1-    .[order(timestamp_msk, store, pos)] %&gt;% .[, bp_pattern := stri_join(state, collapse = "-"), by = session_id] #     as_tibble(dt) %&gt;% distinct(session_id, bp_pattern) %&gt;% count(session_id, sort = TRUE)</code> </pre> </div></div><br><p> å‡ ç§’é’Ÿåï¼Œæˆ‘ä»¬ä¾¿æœ‰äº†ä¸šåŠ¡æµç¨‹çš„é‡æ„å›¾ã€‚ </p><br><p> è€Œä¸”ï¼ˆå®é™…ä¸Šï¼Œè°ä¼šæƒ³åˆ°çš„ï¼ï¼ï¼‰äº‹å®è¯æ˜ï¼Œç”±äºä¸šåŠ¡åˆ†æäººå‘˜è¯´æœäº†æ‰€æœ‰äººï¼ŒITç³»ç»Ÿä¸­è‡ªåŠ¨åŒ–çš„ä¸šåŠ¡æµç¨‹çš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒï¼ˆæˆ–æ ¹æœ¬æ²¡æœ‰ï¼‰ã€‚  â€œè¿‡ç¨‹æ‰€æœ‰è€…â€çš„å¥‡è¿¹å’Œè®ºæ®å°†ä¼´éšç€å¯¹æœ€ç»ˆå›¾æ™¯çš„ç ”ç©¶ã€‚ </p><br><h1 id="aktivno-primenyaem-tryuki"> ç§¯æè¿ç”¨æŠ€å·§ </h1><br><p> å½“è®¡ç®—é€Ÿåº¦å˜å¾—å¾ˆé‡è¦æ—¶ï¼Œç¼–å†™å·¥ä½œä»£ç æ˜¯ä¸å¤Ÿçš„ã€‚ æœ‰å¿…è¦æ³¨æ„å„ä¸ªå±‚æ¬¡ã€‚ è¿˜æœ‰è®¸å¤šç®—æ³•æŠ€å·§å¯ä»¥æ˜¾ç€å‡å°‘æ‰§è¡Œæ—¶é—´ã€‚ </p><br><p> ç‰¹åˆ«æ˜¯ï¼Œåœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æåŠä»¥ä¸‹å†…å®¹ï¼š </p><br><ol><li> å¯¹äºä¸»è¦å¤„ç†ï¼Œä»…<code>data.table</code> ï¼ˆé€Ÿåº¦ï¼Œåœ¨é“¾æ¥ä¸Šå·¥ä½œï¼‰ï¼Œ+è´Ÿè´£å†…éƒ¨æŸ¥è¯¢ä¼˜åŒ–ã€‚ </li><li>  <code>POSIXct</code>å¯ä»¥åŒ…å«æ¯«ç§’ï¼ˆå°½ç®¡æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œä½†å¯ä»¥ä½¿ç”¨<code>options(digits.secs=X)</code>è¿›è¡Œæ›´æ­£ï¼‰ï¼Œæˆ‘ä»¬å°†å…¶éšè—åœ¨æ­¤å¤„ï¼Œè¿™æ ·å¯ä»¥æ›´è½»æ¾åœ°è¿›è¡Œæ¯”è¾ƒå’Œæ’åºã€‚ </li><li> é¿å…åœ¨ç»„å†…è¿›è¡Œç‰©ç†åˆ†ç±»ï¼ æ•´ä¸ªå‘é‡çš„å•ä¸ªç‰©ç†æ’åºå¯ç¡®ä¿å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„æ’åºã€‚ </li><li> é¿å…åœ¨ç»„å†…è¿›è¡Œè®¡ç®—ã€‚ æˆ‘ä»¬å°è¯•å¯¹æºæ•°æ®è¿›è¡Œæ‰€æœ‰å¯èƒ½çš„æ“ä½œï¼ˆæˆ‘ä»¬åº”ç”¨çŸ¢é‡åŒ–ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨çš„å‘ç¥¨ï¼‰ã€‚ </li><li> æˆ‘ä»¬ä½¿ç”¨äº‹åŠ¡è¶…æ—¶æ¥å¤„ç†æ—¶é—´é—´éš”ã€‚ </li><li>  locfï¼ˆæœ€åä¸€æ¬¡è¿›è¡Œç»“è½¬ï¼‰æ–¹æ³•å¾ˆæ…¢ã€‚ è¦åœ¨æ—¶é—´è½´ä¸Šä¼ é€’å±æ€§ï¼Œè¯·ä½¿ç”¨<code>cumsum</code> ï¼Œ <code>cummax</code> ã€‚ </li><li> è´¹æ—¶çš„æ“ä½œï¼Œä¾‹å¦‚POSIX-&gt;å­—ç¬¦ä¸²è½¬æ¢ï¼Œå¸¸è§„æœç´¢ç­‰ã€‚ æˆ‘ä»¬ä¸æ˜¯é€ä¸ªå…ƒç´ åœ°åšï¼Œè€Œæ˜¯åœ¨å·ç§¯ä¸Šåšã€‚ å†…éƒ¨ç´¢å¼•å’Œè½¬æ¢å­—æ®µåˆ†ç»„çš„å¼€é”€æ— æ¯”å°ã€‚ </li><li> æˆ‘ä»¬ç§¯æä½¿ç”¨å¤šçº¿ç¨‹ï¼ˆåŒ…æ‹¬å†…éƒ¨æ•°æ®åŒ…ï¼‰ã€‚ </li><li> ä¸è¦å¿½è§†å¾®ä¼˜åŒ–ã€‚ ä¾‹å¦‚ï¼Œ <code>stri_c</code>æ¯”<code>paste0</code>å¿«<code>paste0</code> ã€‚ </li></ol><br><pre> <code class="plaintext hljs">#  1 log &lt;- getLog(fileName) bench::mark( paste0 = paste0(log$value, collapse = "\n"), stringi = stri_c(log$value, collapse = "\n") ) # # A tibble: 2 x 13 # expression min median `itr/sec` mem_alloc `gc/sec` n_itr n_gc total_time # &lt;bch:expr&gt; &lt;bch:&gt; &lt;bch:&gt; &lt;dbl&gt; &lt;bch:byt&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;bch:tm&gt; # 1 paste0 58ms 59.1ms 16.9 496KB 0 9 0 533ms # 2 stringi 16.9ms 17.5ms 57.1 0B 0 29 0 508ms</code> </pre> <br><p> å…ˆå‰çš„æ–‡ç« - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç‘å£«jsonå¤„ç†åˆ€</a> ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461463/">https://habr.com/ru/post/zh-CN461463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461453/index.html">æ‹œç§‘åŠªå°”å†é™©è®°ï¼šç«ç®­ï¼Œå®‡èˆªå‘˜ï¼Œè”ç›ŸMS-13çš„å‘å°„å’Œå¤ªç©ºäº’è”ç½‘</a></li>
<li><a href="../zh-CN461455/index.html">ã€Šå“ˆå‹ƒå‘¨åˆŠã€‹ç¬¬11æœŸ/ä¸ºä»€ä¹ˆæˆ‘ä»¬ç°åœ¨éœ€è¦å¤§å­¦ï¼Œä»€ä¹ˆæ˜¯â€œçœŸæ­£çš„â€å·¥ä½œï¼ŒGalaxy Foldæœ€ç»ˆç¡®å®š</a></li>
<li><a href="../zh-CN461457/index.html">å“ªäº›å› ç´ å¯ä»¥é¢„æµ‹Steamä¸Šæ¸¸æˆçš„æˆåŠŸï¼Ÿ</a></li>
<li><a href="../zh-CN461459/index.html">ç³»ç»Ÿç®¡ç†å‘˜æ—¥å¿«ä¹</a></li>
<li><a href="../zh-CN461461/index.html">å¤‡ä»½åœ¨äº‘æ—¶ä»£è“¬å‹ƒå‘å±•ï¼Œä½†ç£å¸¦å·è½´å¹¶æ²¡æœ‰è¢«é—å¿˜ã€‚ ä¸Veeamçš„å¯¹è¯</a></li>
<li><a href="../zh-CN461465/index.html">æµ‹é‡æŒ‡å—</a></li>
<li><a href="../zh-CN461467/index.html">ä¸ºGoåº”ç”¨ç¨‹åºåˆ›å»ºMakefileçš„ç¤ºä¾‹</a></li>
<li><a href="../zh-CN461469/index.html">ä»¥æ¯åˆ†é’Ÿ1000ä¸ªå­—çš„é€Ÿåº¦æ”¶å¬ä»£ç æ˜¯ä»€ä¹ˆæ„Ÿè§‰</a></li>
<li><a href="../zh-CN461471/index.html">.NET-ç”¨äºå¤„ç†å¤šçº¿ç¨‹å’Œå¼‚æ­¥çš„å·¥å…·-ç¬¬2éƒ¨åˆ†</a></li>
<li><a href="../zh-CN461473/index.html">å›¾ä¸Šçš„è°ƒè¯•ç®—æ³•-ç°åœ¨å¸¦æœ‰å›¾ç‰‡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>