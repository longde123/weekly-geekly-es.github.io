<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüé§ üòá ‚úçüèø Pr√©chargement des polices ‚ôøÔ∏è ü§∑üèª üë©‚Äçüëß‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'auteur de l'article, dont nous publions la traduction aujourd'hui, souhaite expliquer pourquoi il pr√©charge les polices m√™me s'il ne le devrait pas....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pr√©chargement des polices</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/470870/">  L'auteur de l'article, dont nous publions la traduction aujourd'hui, souhaite expliquer pourquoi il pr√©charge les polices m√™me s'il ne le devrait pas. <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/2r/jy/xq/2rjyxqifqzb06x5rhh1zj-y28ao.png"></a> <br>  Lorsqu'il a cr√©√© le site sur lequel l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">original de</a> ce mat√©riel a √©t√© publi√©, il n'utilisait aucune de ses propres polices.  Cela affecterait in√©vitablement les performances du site, mais pas beaucoup.  L'auteur de l'article dit qu'il s'est efforc√© de cr√©er un site Web rapide.  Cependant, √† la fin, il a √©t√© d√©cid√© d'utiliser une police sp√©ciale pour les titres de page et en m√™me temps essayer de faire en sorte que cette solution affecte le moins possible les performances du projet. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Pour commencer</font> </h2><br>  Pour commencer, j'ai d√©cid√© de rendre le fichier de police le plus petit possible.  J'ai donc cr√©√© un sous-ensemble de cette police.  En d'autres termes, je n'ai s√©lectionn√© dans la police que les caract√®res n√©cessaires aux mots du titre. <br><br>  En cons√©quence, j'ai obtenu un fichier tr√®s compact, dont la taille √©tait inf√©rieure √† 2 Ko.  De plus, je l'ai plac√© au m√™me endroit que tous les autres √©l√©ments du site, ce qui m'a permis de me d√©barrasser des d√©pendances tierces et du temps pass√© √† me connecter √† un autre domaine. <br><br>  Et enfin, le lien vers le fichier de police a √©t√© plac√© dans le code CSS int√©gr√© √† la page, en haut du code HTML, et non dans le fichier CSS externe. <br><br>  Cela signifie que le navigateur peut d√©tecter et t√©l√©charger le fichier de police sans avoir √† t√©l√©charger une feuille de style externe.  C'est d'ailleurs une raison courante pour laquelle les polices se chargent plus tard que n√©cessaire. <br><br><h2>  <font color="#3AC1EF">Surprise</font> </h2><br>  √âtant donn√© que des polices sp√©ciales sont n√©cessaires pour afficher du texte, le navigateur doit les traiter comme des ressources hautement prioritaires. <br><br>  En cons√©quence, je m'attendais √† ce que le fichier de police se charge tr√®s rapidement.  Les pages de ma ressource √©taient, en tout cas, assez ¬´l√©g√®res¬ª, donc j'ai pens√© que rien ne devait emp√™cher le chargement du fichier de police. <br><br>  Lorsque j'ai analys√© le site, j'ai √©t√© l√©g√®rement choqu√©. <br><br>  Donc, en regardant le site √† l'aide des outils de d√©veloppement Chrome et en l'examinant dans Webpagetest, j'ai constat√© que la police haute priorit√© √©tait charg√©e apr√®s les images - des ressources de faible priorit√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9e/b69/42b/a9eb6942be47a8350a3419a54e7382ef.png"></div><br>  <i><font color="#999999">Les images sont t√©l√©charg√©es avant le t√©l√©chargement des polices</font></i> <br><br>  Cela me semblait compl√®tement absurde. <br><br>  Je savais avec certitude que le navigateur, avant de t√©l√©charger la police, peut attendre jusqu'√† ce qu'il d√©couvre que la police est n√©cessaire pour afficher la page.  Mais l'√©l√©ment dans lequel ma police a √©t√© utilis√©e √©tait situ√© tout en haut de la page, √† l'int√©rieur de la <code>&lt;header&gt;</code> , bien plus haut que les balises contenant des images qui ont √©t√© charg√©es avant le t√©l√©chargement de la police.  L'√©l√©ment correspondant se trouvait non seulement dans le code de la page, mais √©galement dans l'arborescence DOM. <br><br><h2>  <font color="#3AC1EF">Pr√©chargement des polices comme solution au probl√®me</font> </h2><br>  L'attribut de <code>preload</code> indique au navigateur qu'il doit pr√©charger la ressource correspondante n√©cessaire pour afficher la page actuelle. <br><br>  L'utilisation de cet attribut est un bon moyen de t√©l√©charger rapidement des ressources importantes qui seraient autrement d√©couvertes par le navigateur ult√©rieurement. <br><br>  Les fichiers de polices sont un excellent exemple d'utilisation de ce m√©canisme.  Si le lien vers le fichier de police est cr√©√© dans une feuille de style externe, le navigateur ne d√©tectera pas la police tant qu'il n'aura pas charg√© cette feuille de style. <br><br>  L'utilisation de l'attribut de <code>preload</code> appliqu√© aux fichiers de polices indique au navigateur qu'il aura besoin des polices appropri√©es lorsqu'il affichera la page. <br>  De plus, ce m√©canisme est tr√®s facile √† impl√©menter en utilisant l'√©l√©ment <code>&lt;link&gt;</code> . <br><br><pre> <code class="plaintext hljs">&lt;link rel="preload" href="myfont.woff2" as="font" type="font/woff2" crossorigin&gt;</code> </pre> <br>  Alternativement, vous pouvez ajouter la directive de pr√©charge √† l'en-t√™te de r√©ponse (bien que, sauf indication contraire, certains serveurs ou CDN peuvent interpr√©ter cette conception comme une demande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.cloudflare.com/website-optimization/">lanc√©e</a> par le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.cloudflare.com/website-optimization/">serveur</a> pour transf√©rer des ressources vers le client). <br><br>  Je ne m'attendais pas √† ce que sur ce site je doive utiliser des m√©canismes de pr√©chargement des ressources.  Mon code CSS est tr√®s modeste, je l'ai int√©gr√© dans le code HTML de la page, afin que les pages soient affich√©es plus rapidement par les navigateurs lors de la premi√®re visite sur le site.  √âtant donn√© que ma police ne d√©pendait pas du chargement d'un fichier CSS externe, le navigateur aurait en tout cas d√ª le d√©tecter tr√®s t√¥t et sans ¬´conseils¬ª sur le pr√©chargement. <br><br>  Cependant, j'ai d√©couvert que le pr√©chargement de la police conduisait √† la restauration de la justice, au fait que le fichier de police √©tait maintenant charg√© avant le t√©l√©chargement des fichiers image. <br><br>  Voici le diagramme en cascade de Webpagetest - J'ai mis en √©vidence les endroits o√π le travail avec le fichier de police est affich√©.  En haut de la figure, le pr√©chargement n'est pas utilis√©.  En bas - utilis√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b8c/d2e/789/b8cd2e789c21ffe4d26175ef0bbd1711.png"></div><br>  <i><font color="#999999">Pr√©chargement et utilisation du fichier de police.</font></i> <br><br>  Il serait peut-√™tre plus utile de consid√©rer le storyboard du processus de chargement de page (ici, pour plus de clart√©, une imitation d'une connexion tr√®s lente a √©t√© utilis√©e). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/451/efc/532/451efc532263db4aa64740322d011bef.png"></div><br>  <i><font color="#999999">Dans le storyboard sup√©rieur, le pr√©chargement n'est pas utilis√©.</font></i>  <i><font color="#999999">En bas - utilis√©</font></i> <br><br>  En passant, je note que j'ai utilis√© la poign√©e <code>font-display: fallback</code> .  Autrement dit, le titre a √©t√© initialement affich√© √† l'aide de la police de sauvegarde au cas o√π ma police se chargerait lentement.  Cependant, pour ce test, j'ai d√©sactiv√© cette fonctionnalit√©, car sinon, il serait tr√®s difficile de distinguer les √©tapes de chargement de la page. <br><br><h2>  <font color="#3AC1EF">Pourquoi cela a-t-il fonctionn√©?</font> </h2><br>  Afin d'afficher une page Web, le navigateur doit cr√©er l'arborescence DOM et l'arborescence CSSOM, qui sont ensuite utilis√©es pour cr√©er l'arborescence de rendu. <br><br>  Il <code>preload</code> que l'utilisation de l'√©l√©ment <code>&lt;link&gt;</code> avec l'attribut <code>preload</code> pour t√©l√©charger la police permet au navigateur de commencer √† cr√©er CSSOM avant la fin du DOM. <br><br>  Vous pouvez le voir dans les images suivantes, qui montrent une exploration du processus de chargement de page √† l'aide des outils de d√©veloppement Chrome. <br><br>  Voici √† quoi ressemble l'utilisation de mat√©riaux de page sans utiliser la pr√©charge.  Tout d'abord, le DOM est cr√©√© et l'image est charg√©e, puis CSSOM est cr√©√© et la police est charg√©e. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70e/d87/be1/70ed87be14271c5d93563d18161eaba7.png"></div><br>  <i><font color="#999999">Travailler avec la page sans utiliser la pr√©charge</font></i> <br><br>  Et voici la m√™me chose, mais avec l'utilisation du pr√©chargement.  Ici, le navigateur commence √† cr√©er CSSOM, commence √† t√©l√©charger la police, puis il cr√©e le DOM et commence √† t√©l√©charger les images. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c75/ea3/101/c75ea31011fe25c4527c7b6c64f86b2e.png"></div><br>  <i><font color="#999999">Utilisation de la page √† l'aide de la pr√©charge</font></i> <br><br><h2>  <font color="#3AC1EF">Existe-t-il des alternatives au pr√©chargement?</font> </h2><br>  Supposons que je ne puisse pas utiliser l'attribut de <code>preload</code> pour augmenter la priorit√© du fichier de police.  Que pouvais-je faire alors?  Comment pouvez-vous r√©duire la priorit√© des images? <br><br>  Par curiosit√©, j'ai essay√© de mettre en ≈ìuvre l'id√©e ci-dessus et j'ai ajout√© l'attribut <code>loading="lazy"</code> aux √©l√©ments d√©crivant les images.  Dans Chrome 76 (le seul navigateur qui le supportait au moment de la r√©daction), cela devrait r√©duire la priorit√© des images en dehors de la zone visible d'origine de la page. <br><br>  Tester cette id√©e avec des outils de d√©veloppement a montr√© que cela conduit au t√©l√©chargement des polices plus t√¥t.  Peut-√™tre que cela m√©rite d'√™tre rappel√©, car le niveau de prise en charge du navigateur pour les m√©canismes de chargement paresseux augmente avec le temps. <br><br><h2>  <font color="#3AC1EF">Diff√©rents navigateurs se comportent diff√©remment</font> </h2><br>  J'ai test√© le projet dans plusieurs navigateurs diff√©rents et sur plusieurs appareils.  Lors des tests, j'ai d√©couvert que iOS Safari (iPhone 8) pr√©sente le m√™me comportement que Chrome.  √Ä savoir, les polices, par d√©faut, sont charg√©es apr√®s les images, mais l'utilisation de l'attribut de <code>preload</code> permet de corriger la situation. <br><br>  Le probl√®me du chargement tardif des polices s'est √©galement produit dans Firefox, mais l'attribut de <code>preload</code> n'est pas encore pris en charge par ce navigateur par d√©faut, donc l'utilisation de l'attribut de <code>preload</code> lors de l'affichage d'un site dans Firefox n'a rien chang√©. <br><br>  Dans Edge, les polices se chargent √©galement plus tard que souhait√©.  Il y avait un sentiment que l'utilisation de Webload Pagetest en utilisant l'attribut de <code>preload</code> ne fonctionnait que partiellement.  √Ä savoir, il me semblait que cela ressemblait √† un t√©l√©chargement de police double.  Une fois charg√© plus t√¥t, la deuxi√®me fois plus tard. <br><br>  Dans le paragraphe pr√©c√©dent, j'ai √©voqu√© le fait que "j'avais une sensation", et que je "semblais".  Le fait est que lorsque j'ai essay√© de tester ce comportement √† l'aide de ma propre version d'Edge, les t√©l√©chargements ¬´doubles¬ª ont disparu.  Maintenant, j'ai le sentiment que l'utilisation de l'attribut de <code>preload</code> pas le chargement des polices.  Cette diff√©rence dans le comportement de la page est peut-√™tre le r√©sultat de la correction d'une erreur dans Edge, bien que si tel est le cas, l'erreur a √©t√© corrig√©e au prix de la modification du m√©canisme de pr√©chargement des ressources. <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Ici, nous avons expliqu√© pourquoi le pr√©chargement des polices ne fait pas de mal m√™me si les liens vers leurs fichiers sont cr√©√©s dans le code CSS int√©gr√© √† la page. <br><br>  Les navigateurs ne se comportent pas toujours comme nous le souhaitons ou comme nous nous y attendons.  Mais nous avons des outils qui aident √† influencer le comportement des navigateurs, √† les incliner dans la direction dont nous avons besoin. <br><br>  Je pensais que le pr√©chargement des polices sur mon site est compl√®tement inutile.  De tout ce dont j'ai parl√©, j'ai appris une le√ßon importante pour moi.  Elle consiste dans le fait que vous ne devez jamais rien supposer. <br><br>  En fin de compte, je peux dire que le pr√©chargement des polices est un excellent moyen d'acc√©l√©rer la sortie de texte sur les pages Web. <br><br>  <b>Chers lecteurs!</b>  Utilisez-vous des m√©canismes de pr√©chargement de polices dans vos projets Web? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470870/">https://habr.com/ru/post/fr470870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470852/index.html">Traitement de 40 To de code √† partir de 10 millions de projets sur un serveur d√©di√© avec Go pour 100 $</a></li>
<li><a href="../fr470856/index.html">Telegram GRAM Wallet: conditions d'utilisation</a></li>
<li><a href="../fr470858/index.html">Antiquit√©s: r√©f√©rence du 386e processeur et des ann√©es 90 fringantes</a></li>
<li><a href="../fr470864/index.html">√Ä propos des plaisirs de passer au panneau et pas seulement</a></li>
<li><a href="../fr470868/index.html">Temps de premier octet: qu'est-ce que c'est et pourquoi est-il important</a></li>
<li><a href="../fr470872/index.html">Mesures de performances pour la recherche d'applications Web incroyablement rapides</a></li>
<li><a href="../fr470874/index.html">Optimiser le chargement de JavaScript sur Wikipedia</a></li>
<li><a href="../fr470876/index.html">Cr√©ez des constructions de syntaxe JavaScript personnalis√©es √† l'aide de Babel. Partie 1</a></li>
<li><a href="../fr470878/index.html">Cr√©ez des constructions de syntaxe JavaScript personnalis√©es √† l'aide de Babel. 2e partie</a></li>
<li><a href="../fr470880/index.html">M√©canique du jeu. Aventure, le concept de l'orthophonie z√©ro et convaincante</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>