<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ŒğŸ» ğŸ˜— ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ¿ Yandex: rumah pintar dewasa ğŸ§˜ğŸ¾ ğŸ¤° ğŸ†”</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Baru-baru ini, Yandex meluncurkan sistem rumah pintar. Kami ditawari untuk membeli perangkat Wi-Fi yang murah: adaptor di stopkontak, bola lampu, dan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Yandex: rumah pintar dewasa</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465537/"><img src="https://habrastorage.org/webt/rs/l_/lm/rsl_lmpzna0pj3o9ahxzsawpsn0.png"><br><br>  Baru-baru ini, Yandex meluncurkan sistem rumah pintar.  Kami ditawari untuk membeli perangkat Wi-Fi yang murah: adaptor di stopkontak, bola lampu, dan remote control IR.  Sangat menarik bahwa pengembang perangkat "pintar" memiliki kesempatan untuk menciptakan keterampilan "rumah pintar" mereka, ini akan memungkinkan Anda untuk menghubungkan perangkat ke sistem Yandex dan mengelola suara mereka melalui Alice.  Semakin banyak merek baru muncul di daftar keterampilan.  Alice sangat memahami ucapan Rusia, yang menjadikannya pemimpin yang tak perlu dipersoalkan di antara para asisten suara di pasar Rusia. <br>  Namun, tidak semuanya lancar ... <br><a name="habracut"></a><br>  Pertama minus: pada dasarnya, semua sistem yang diusulkan "mendung".  Keandalan mereka terkadang diragukan, karena kinerja mereka secara langsung tergantung pada kualitas koneksi dengan server pabrikan.  Dan ketika Anda mematikan Internet, perangkat sepenuhnya berubah menjadi "labu". <br><br>  Kedua minus: sistem scripting.  Bagian penting dari rumah pintar adalah skrip.  Dan di sini mereka sangat primitif: Jika "frasa ini dan itu," maka aktifkan "perangkat ini dan ini."  Bagi rumah pintar saya, ini terlalu sedikit. <br><br>  Kontra tidak berakhir di sana, tetapi sisanya lebih cenderung terhubung dengan ketidakdewasaan sistem.  Tim pengembang Yandex terus secara aktif menambahkan berbagai fitur, dan bug untuk diedit, yang karenanya banyak terima kasih! <br><br>  Setelah mempelajari dokumentasi, saya memutuskan untuk membuat keterampilan Yandex UD dan menghubungkan pengontrol rumah pintar untuk itu.  Ini akan memungkinkan Anda untuk tidak bergantung pada server cloud, mengimplementasikan skrip apa pun secara lokal pada pengontrol dan pada saat yang sama mengontrol sistem dengan suara melalui Alice.  Untuk ini, saya menulis plugin "yandex2mqtt" di Node.js. <br><br><h4>  Sedikit teori </h4><br>  - Alice, nyalakan lampu. <br>  Setelah kalimat ini, keajaiban terjadi dan lampu menyala.  Tapi apa yang ada di balik layar?  Mari kita cari tahu cara kerjanya. <br><br>  Stasiun Yandex, setelah mendengar perintah yang dikenalnya, mengirimkan data ke server Yandex, yang sebelumnya kami tentukan alamat pengontrol kami.  Server memproses informasi dan mengarahkannya ke controller dalam bentuk Post-request.  Pada controller, API perantara (dalam kasus kami, ini adalah plugin yandex2mqtt) memproses permintaan dan mengalihkannya ke topik MQTT.  Selanjutnya, skrip diproses dalam program Node-Red. <br><br>  Node-Red memutuskan apa yang harus dilakukan selanjutnya.  Jika disediakan oleh skrip, ia mengirim perintah untuk menyalakan lampu di topik MQTT yang sesuai.  Driver wb-mqtt-serial merespons dengan mengirimkan perintah Modbus ke modul relai, yang mengalihkan relai.  Dan akhirnya, lampu menyala!  Ya, jalannya tidak dekat, tetapi beberapa fraksi dari pass kedua untuk pengguna. <br><br>  Mari kita lihat lebih dekat pada plugin yandex2mqtt.  Hal pertama yang diperlukan Yandex agar keterampilannya berfungsi adalah layanan oAuth untuk bundling akun dalam aplikasi Yandex.  Setelah Yandex menerima token otorisasi dari layanan oAuth, ia meminta daftar perangkat.  Plugin yandex2mqtt merespons dengan daftar perangkat dengan semua properti dalam format json.  Kemudian mereka muncul dalam daftar perangkat yang tersedia untuk kontrol (dalam apa yang disebut quasar).  Sekarang, jika Anda memberi tahu Alice untuk mengaktifkan beberapa perangkat dari daftar, Yandex akan mengirim permintaan Posting dengan data perangkat yang ia ingin nyalakan ke controller.  Sebagai tanggapan, plugin mengkonfirmasi inklusi dan menulis status baru ke topik mqtt yang ditentukan dalam pengaturan plugin yang sama.  Jika perangkat mengubah statusnya tanpa partisipasi Yandex, maka plug-in, melihat data baru dalam topik mqtt, akan mengirimkannya ke Yandex ketika meminta status, yang sekarang terjadi hanya jika Anda masuk ke perangkat itu sendiri di quasar.  Dalam kasus lain, Yandex tidak memilih status. <br>  Sekarang saya akan berbicara tentang beberapa properti perangkat Yandex UD. <br><br><h4>  Jenis perangkat </h4><br>  Untuk tampilan yang benar di "quasar" dan definisi perintah yang lebih tepat oleh Alice, Yandex menyarankan untuk menetapkan berbagai jenis perangkat ke perangkat.  Total tipe 10: <br><br><ul><li>  <b>devices.types.light</b> - Setiap lampu, lampu, bola lampu, dll. </li><li>  <b>devices.types.socket</b> - Outlet </li><li>  <b>devices.types.switch</b> - Beralih </li><li>  <b>devices.types.thermostat</b> - Thermostat </li><li>  <b>devices.types.thermostat.ac</b> - Penyejuk udara </li><li>  <b>devices.types.media_device</b> - Perangkat media </li><li>  <b>devices.types.media_device.tv</b> - TV </li><li>  <b>devices.types.cooking</b> - Peralatan dapur </li><li>  <b>devices.types.cooking.kettle</b> - Maker </li><li>  <b>devices.types.other</b> - Segala sesuatu yang tidak sesuai dengan paragraf sebelumnya. </li></ul><br><h5>  Kemampuan </h5><br>  Selain itu, setiap perangkat harus memiliki setidaknya satu <b>kemampuan</b> . <br><br>  Secara total, Yandex UD memiliki 5 jenis keterampilan.  Setiap skill memiliki fungsi yang berbeda <b>(contoh)</b> , dan beberapa skill memiliki beberapa fungsi seperti itu, yang menambah fleksibilitas ketika mengkonfigurasi perangkat. <br><br>  <b>Kemampuan:</b> <br><br>  1. <b>devices.capabilities.on_off</b> - Hidupkan dan matikan. <br><br>  contoh: <br><br><ul><li>  pada </li></ul><br>  2. <b>devices.capabilities.color_setting</b> - Manajemen warna. <br><br>  contoh: <br><br><ul><li>  rgb </li><li>  hsv </li><li>  suhu_k </li></ul><br>  3. <b>devices.capabilities.mode - Beralih mode.</b> <br><br>  contoh: <br><br><ul><li>  termostat </li><li>  fan_speed </li></ul><br>  4. <b>devices.capabilities.range - Kontrol rentang.</b> <br><br>  contoh: <br><br><ul><li>  kecerahan </li><li>  suhu </li><li>  volume </li><li>  saluran </li></ul><br>  5. <b>devices.capabilities.toggle - Bisukan.</b> <br><br>  contoh: <br><br><ul><li>  bisu </li></ul><br><br>  Dengan kombinasi yang tepat dari semua properti perangkat, Alice mengerti tanpa masalah semua perintah untuk mengelola Smart Home yang diberikan kepadanya.  Di sini, tentu saja, ada beberapa kesulitan dengan menggabungkan keterampilan.  Dokumentasi jelas tidak menunjukkan keterampilan mana yang dapat digabungkan dan mana yang tidak.  Tetapi "metode pencarian ilmiah" akan membantu kita dalam hal ini. <br><br>  Jadi, misalnya, saya menemukan bahwa pendingin ruangan mengandung empat keterampilan: <br><br>  Jenis perangkat: <br><br>  <b>devices.types.thermostat.ac</b> <br><br>  Jenis Keterampilan: <br><br>  <b>devices.capabilities.on_off</b> <br><br>  contoh: <br><br><ul><li>  pada </li></ul><br>  <b>devices.capabilities.range</b> <br>  contoh: <br><br><ul><li>  suhu </li></ul><br>  <b>devices.capabilities.mode</b> <br>  contoh: <br><br><ul><li>  termostat </li></ul><br>  <b>devices.capabilities.mode</b> <br>  contoh: <br><br><ul><li>  fan_speed </li></ul><br>  Saya tidak akan menjelaskan properti yang tersisa, semuanya cukup sederhana di sana. <br><br>  Untuk membuatnya bekerja, Anda perlu: <br><br><ul><li>  <b>Pengendali</b> </li><li>  <b>Domain apa saja</b> </li><li>  <b>Sertifikat SSL</b> </li><li>  <b>Node.js</b> </li><li>  <b>Plugin Yandex2mqtt</b> </li><li>  <b>Broker MQTT</b> </li><li>  <b>Node-red</b> </li></ul><br><h3>  Pengendali </h3><br>  Apartemen "pintar" saya dikendalikan oleh Wiren Board 6. Tetapi Anda dapat menggunakan pengontrol Linux lainnya yang akan menarik Node.js dan Node-Red.  Misalnya, Raspberry pi atau PC. <br><br><h4>  Domain </h4><br>  Tentu saja, diinginkan untuk memiliki alamat IP putih dan membeli domain, tetapi ini tidak perlu.  Anda dapat menggunakan DDNS - misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.noip.com</a> . <br><br>  Semuanya sederhana di sini: daftar, buat nama host gratis, masukkan alamat IP Anda.  Beberapa router memiliki pengaturan DDNS khusus di mana Anda dapat memasukkan data noip.com.  Router akan secara otomatis mengirim alamat IP ketika diubah.  Jika tidak ada pengaturan seperti itu di router, Anda dapat menginstal program noip pada controller dan menambahkannya ke autorun.  Program ini akan melakukan hal yang sama persis seperti router dengan pengaturan DDNS khusus - perbarui alamat ip Anda di database noip.com <br><br>  Dengan demikian, kami memiliki alamat statis yang mengalihkan semua permintaan ke controller kami. <br><br><h4>  Port 443 dan 80 </h4><br>  Sekarang hampir semua orang di rumah memiliki router.  Selain fungsinya yang jelas, ini juga menjadi penghalang jaringan lokal dari tamu yang tidak diinginkan dari luar.  Tetapi dalam kasus-kasus tertentu, kita memerlukan akses ke jaringan internal dari luar.  Pembuat router membayangkan ini dan menambahkan fitur NAT (Network Address Translation). <br><br>  Saya tidak akan menjelaskan momen pengaturan router, karena berbeda untuk setiap produsen.  Cara melakukannya, baca instruksi untuk router Anda.  Google kata kunci: Port Forwarding, Port Mapping, NAT. <br><br>  Diperlukan untuk meneruskan port untuk akses ke yandex2mqtt (bisa berupa apa saja, saya memilih 443) dan port 80 (hanya diperlukan untuk menerima sertifikat SSL. Setelah menerima sertifikat, port 80 dapat ditutup). <br><br><h4>  Sertifikat SSL </h4><br>  Segera letakkan semua titik pada "dan": sertifikat yang ditandatangani sendiri tidak akan berfungsi. <br>  Sebagian besar pendaftar domain (misalnya, reg.ru) memberi pelanggan mereka sertifikat SSL gratis untuk domain utama (www.domainanda.ru).  Jika Anda membeli domain khusus untuk Alice, maka Anda dapat menggunakan sertifikat SSL yang disediakan. <br><br>  Jika Anda tidak memiliki domain sendiri, atau Anda memiliki subdomain lain yang dialokasikan untuk Alice (misalnya, alice.yourdomain.ru), maka Anda perlu mendapatkan sertifikat untuk subdomain ini, atau untuk alamat yang disediakan oleh layanan DDNS. <br><br>  Untuk melakukan ini, saya mengusulkan untuk menggunakan layanan gratis untuk memperoleh sertifikat SSL dari letsencrypt.org. <br><br>  Untuk mendapatkan sertifikat, Anda harus menginstal program certbot, menjalankan dan menentukan semua data yang diminta.  Pada saat yang sama, port 80 harus bebas dan dapat diakses dari luar. Saya menyarankan Anda untuk hati-hati mempelajari instruksi dari letsencrypt. <br><br><div class="spoiler">  <b class="spoiler_title">Instal dan konfigurasikan certbot</b> <div class="spoiler_text"><pre><code class="bash hljs">apt-get update apt-get install certbot</code> </pre> <br><br>  Hentikan layanan pengawas dan nginx. <br><br><pre> <code class="bash hljs">service watchdog stop service nginx stop</code> </pre> <br>  Kami meneruskan port ke-80 di router. <br><br>  Jalankan program certbot: <br><br><pre> <code class="bash hljs">certbot certonly --standalone</code> </pre> <br>  Setelah memulai program akan mengajukan beberapa pertanyaan sederhana. <br><br>  1. Email Anda.  Cukup masukkan alamat dan tekan enter <br><br><img src="https://habrastorage.org/webt/mn/gf/si/mngfsiaatuo6txsrtc6wyyz4v_o.png"><br><br>  2. Anda diminta untuk membaca perjanjian pengguna.  Jika Anda setuju dengan semuanya, cukup masukkan "A", yang berarti Setuju, yaitu, saya setuju. <br><br><img src="https://habrastorage.org/webt/y8/zz/to/y8zztosybjouwmncxuawmbq-55c.png"><br><br>  3. Program meminta izin untuk mengirim alamat email Anda ke pengembang.  Masukkan N. <br><br><img src="https://habrastorage.org/webt/pn/y_/yw/pny_ywp5pjfj7gupd09m3hnbmg4.png"><br><br>  4. Masukkan domain Anda di mana Anda ingin menerima sertifikat (Anda dapat memasukkan yang sebelumnya kami terima di noip).  Di sini saya memberikan contoh input yang salah.  Http: // awalan tidak diperlukan. <br><br><img src="https://habrastorage.org/webt/mt/bj/py/mtbjpyenb63jqv3gvtd_oyh9qze.png"><br><br>  Jika Anda melakukan semuanya dengan benar, Anda akan melihat yang berikut: <br><br><img src="https://habrastorage.org/webt/ug/7c/kf/ug7ckfuvos8bkgfgzvaepqvu48s.png"><br><br>  Ini berarti bahwa sertifikat tersebut berhasil diterima.  Ingat jalur ke sertifikat dan kunci, itu akan diperlukan saat mengkonfigurasi plugin yandex2mqtt.  Untuk keamanan, tutup port 80 di pengaturan router, itu tidak lagi berguna. <br><br>  Kami mengaktifkan layanan pengawas dan nginx. <br><br><pre> <code class="bash hljs">service nginx start service watchdog start</code> </pre> <br>  Sertifikat dari letsencrypt dikeluarkan selama <b>3</b> bulan.  <b>Jangan lupa perbarui.</b> <br><br></div></div><br><h4>  Node.js dan plugin yandex2mqtt </h4><br><div class="spoiler">  <b class="spoiler_title">Instalasi</b> <div class="spoiler_text">  Mengkonfigurasi repositori node.js <br><br><pre> <code class="bash hljs">curl -sL https://deb.nodesource.com/setup_10.x | bash -</code> </pre> <br>  Selanjutnya, instal atau perbarui semua komponen yang diperlukan <br><br><pre> <code class="bash hljs">apt-get install -y nodejs git make g++ gcc build-essential</code> </pre> <br>  Setelah instalasi berhasil, salin repositori yandex2mqtt ke controller. <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/munrexio/yandex2mqtt.git /mnt/data/root/yandex2mqtt</code> </pre> <br>  Kami menetapkan hak. <br><br><pre> <code class="bash hljs">chown -R root:root /mnt/data/root/yandex2mqtt</code> </pre> <br>  Kami pergi ke folder. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /mnt/data/root/yandex2mqtt</code> </pre> <br>  Kami memulai instalasi. <br><br><pre> <code class="bash hljs">npm install</code> </pre> <br>  Instalasi selesai. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Mulai otomatis</b> <div class="spoiler_text">  <b>Buat unit systemd:</b> <br><br>  Buka folder <b>/ etc / systemd / system /</b> pada controller dan buat file bernama <b>yandex2mqtt.service</b> .  Salin yang berikut ke dalamnya: <br><br><pre> <code class="bash hljs">[Unit] Description=yandex2mqtt After=network.target [Service] ExecStart=/usr/bin/npm start WorkingDirectory=/mnt/data/root/yandex2mqtt StandardOutput=inherit StandardError=inherit Restart=always User=root [Install] WantedBy=multi-user.target</code> </pre> <br>  Setelah itu simpan perubahan dan tutup file. <br><br>  Untuk mengaktifkan unit, masukkan perintah di konsol: <br><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> yandex2mqtt.service</code> </pre> <br><br>  Sekarang Anda dapat memulai dan menghentikan plugin dengan perintah <br><br><pre> <code class="bash hljs">service yandex2mqtt start service yandex2mqtt stop service yandex2mqtt restart</code> </pre> <br></div></div><br>  <b>Pengaturan:</b> <br><br>  Semua pengaturan plug-in yang diperlukan ada di file <b>/mnt/data/root/yandex2mqtt/config.js</b> <br>  Edit file ini sesuai dengan parameter Anda. <br>  Sertifikat SSL harus berupa <b>rantai penuh</b> . <br><br>  Setelah konfigurasi, jalankan yandex2mqtt dengan perintah: <br><br><pre> <code class="bash hljs">service yandex2mqtt start</code> </pre> <br>  Setelah mengatur dan memulai jembatan, saya menyarankan Anda untuk memeriksa sertifikat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs ini</a> . <br><br>  Cukup masukkan domain Anda yang akan Anda gunakan untuk mengakses Alice.  Untuk operasi yang tepat, sertifikat harus lulus semua cek.  Kalau tidak, tidak akan ada yang berhasil. <br><br><h4>  Keahlian Yandex UD </h4><br><div class="spoiler">  <b class="spoiler_title">Penciptaan keterampilan</b> <div class="spoiler_text">  1. Buka halaman <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dialogs.yandex.ru/developer</a> <br>  2. Masuk dengan akun Anda. <br>  3. Klik "buat dialog" <br>  4. Pilih â€œRumah Pintarâ€ <br>  5. Masukkan parameter yang diperlukan: <br><br><ul><li>  <b>Nama</b> - <b>Nama apa</b> saja. </li><li>  <b>URL Titik Akhir</b> - alamat jenis domain <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">/ penyedia Anda</a></b> , di mana alih-alih <b>â€œ</b> domain Andaâ€ adalah alamat dari noip atau domain Anda yang menerima sertifikat ssl. </li></ul><br><img src="https://habrastorage.org/webt/6w/sn/oc/6wsnoczljzsap2fdrldsgi47qr8.png" width="400"><br><br><ul><li>  <b>Privasi</b> - pilih <b>"Jangan tampilkan di katalog" (Diperlukan! Jika tidak, keterampilan tidak akan lulus moderasi instan)</b> </li><li>  <b>Nama dan Email pengembang</b> - tunjukkan rincian Anda. </li><li>  <b>Deskripsi</b> - teks apa pun </li><li>  <b>Ikon</b> - ikon apa saja. </li></ul><br><img src="https://habrastorage.org/webt/70/7q/pv/707qpvhwz4bp8-g7anzd6yocavw.png" width="400"><br><br>  6. Bundel akun: <br><br><img src="https://habrastorage.org/webt/z4/vg/ep/z4vgep4de2sngw6byx34eo5s5te.png" width="400"><br><br>  Klik "tambah baru" <br><ul><li>  Dua poin pertama - <b>tentukan data dari config.js / klien</b> : </li></ul><br>  1. <b>Pengidentifikasi aplikasi</b> adalah clientId <br><br>  2. <b>Rahasia aplikasi</b> - clientSecret <br><br><ul><li>  <b>URL Otorisasi</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">domain / dialog / otorisasi Anda</a> </li><li>  <b>URL Token</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">domain</a> Anda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">/ oauth / token</a> </li><li>  <b>URL pembaruan token</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">domain Anda / oauth / token</a> </li></ul><br><img src="https://habrastorage.org/webt/im/pg/zi/impgzifephas4rycqhvyll0_7uq.png" width="400"><br><br>  7. Simpan keterampilan <br><br><img src="https://habrastorage.org/webt/fj/ud/xy/fjudxydpqb3mwv5ksihpr277j2u.png" width="400"><br><br>  8. Klik "Moderasi" <br><br><img src="https://habrastorage.org/webt/a2/ah/ji/a2ahjiezupvml9wo3a1pboif3pc.png"><br><br>  9. Klik "Terbitkan" <br><br><img src="https://habrastorage.org/webt/7a/jv/83/7ajv8394tns4icumhxj1qqp-eea.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Menambahkan perangkat ke Yandex UD.</b> <div class="spoiler_text">  1. Buka aplikasi Yandex di telepon <br><br><img src="https://habrastorage.org/webt/ki/fk/t6/kifkt6ims4epu1zm2hsa2z3bef0.jpeg" width="230"><br><br>  2. Di menu, pilih Perangkat / Smart Home <br><br><img src="https://habrastorage.org/webt/up/ec/ee/upeceeae_jjtrocticjinlinxmq.jpeg" width="230"><br><br>  3. Klik â€œTambah perangkatâ€ <br><br><img src="https://habrastorage.org/webt/-c/yn/k3/-cynk3sjwga2frnsung0wp8mtre.jpeg" width="230"><br><br>  4. Pilih keahlian Anda <br><br><img src="https://habrastorage.org/webt/ew/4h/jd/ew4hjdahl4eunc4kvygka1eftrs.jpeg" width="230"><br><br>  5. Klik "Gabungkan Akun" <br><br><img src="https://habrastorage.org/webt/ov/k7/hk/ovk7hkqe6oe0j7jvkw6eghcnycy.jpeg" width="230"><br><br>  6. Halaman otorisasi akan terbuka <br><br>  <i>Masukkan login dan kata sandi (atur file config.js di blok pengguna)</i> <br><br><img src="https://habrastorage.org/webt/ly/lr/gw/lylrgwlzw5wcuy1c4wov6ez-2fm.jpeg" width="230"><br><br>  7. Klik "Izinkan". <br><br><img src="https://habrastorage.org/webt/y2/pu/tn/y2putnokvnlac9h4tuypa1sny9y.jpeg" width="230"><br><br>  8. Klik "Perbarui daftar perangkat" <br><br><img src="https://habrastorage.org/webt/cq/qd/gw/cqqdgwhp-zhmq5_ax3zbgohgrt4.jpeg" width="230"><br></div></div><br>  Sekarang Alice dapat diberikan perintah untuk mengelola perangkat yang ditambahkan.  Tim yang sesuai akan datang ke topik yang ditunjukkan oleh mqtt. <br><br>  Masih mengikat beberapa tindakan untuk topik ini. <br><br><h4>  Node-red </h4><br>  Node-Red dipilih untuk sistem otomasi.  Ini adalah alat pemrograman visual yang hebat.  Prosedur instalasi dan konfigurasi dapat dilihat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Proses mengatur dan mengotomatisasi rumah pintar akan menarik seluruh artikel, atau bahkan dua.  Dan sudah ada banyak artikel semacam itu.  Sebagai gantinya - contoh kecil menggunakan plugin, cara menyalakan suara bola lampu. <br><br>  Untuk kenyamanan, kami membuat perangkat virtual pada pengontrol Wiren Board 6 di antarmuka web. <br>  Di mesin aturan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">wb-rules</a> Anda harus memasukkan <br><br><pre> <b><code class="javascript hljs">defineVirtualDevice(<span class="hljs-string"><span class="hljs-string">"yandex"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"yandex controls"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cells</span></span>: { <span class="hljs-attr"><span class="hljs-attr">light1</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"switch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, } });</code></b> </pre> <b><br></b> <br><img src="https://habrastorage.org/webt/3t/mn/qh/3tmnqhsdi1vnkdd_wr4ucnsvusc.jpeg"><br><br>  <b>Kami akan menulis</b> topik MQTT perangkat virtual ini di <b>config.js</b> untuk tipe keterampilan "aktif" dari perangkat "Light": <br><br><pre> <code class="json hljs"> devices: [ //_______________   ______________// { name: '', room: '', type: 'devices.types.light', mqtt: [ { type: 'on', set: '/devices/yandex/controls/light1/on', //   stat: '/devices/yandex/controls/light1' //   }, ], capabilities: [ { type: 'devices.capabilities.on_off', retrievable: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, state: { instance: 'on', value: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }, ] }, //_______________   _______________// ]</code> </pre><br>  Sekarang, dengan kalimat "Alice, nyalakan / matikan Lampu", perangkat virtual beralih. <br><br>  Mari kita pergi ke Node-Red, yang diinstal sesuai dengan instruksi. <br><br>  Untuk pekerjaan yang mudah dengan Wiren Board 6, Anda juga dapat menggunakan â€œnodeâ€ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">node-red-contrib-wirenboard tambahan</a> . <br><br>  Modul ekspansi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">WBE2R-R-ZIGBEE</a> dipasang di controller, yang memungkinkan untuk terhubung ke lampu pintar IKeevskaya dari seri TRODFRY menggunakan protokol ZigBee. <br><br>  Sekarang terserah kecil.  Lemparkan beberapa blok ke ruang kerja Node-Red, hubungkan dengan "string" dan klik Deploy. <br><br><img src="https://habrastorage.org/webt/ev/p8/zn/evp8zn84umdssgxcecq9rmosgm8.jpeg"><br><br>  Bola lampu ikeevsky terhubung melalui plugin zigbee2mqtt, oleh karena itu dalam mqtt topik bola harus dikirim json untuk kontrol.  Untuk melakukan ini, kami akan menyisipkan fungsi sederhana antara perangkat virtual WB dan topik mqtt bulb. <br><br><img src="https://habrastorage.org/webt/y1/e6/9h/y1e69hfghaemcayotpvugppiqz8.jpeg"><br><br>  Klik Menyebarkan.  Kami periksa. <br><br>  Alice, nyalakan Lampu! <br><br>  Jadi, hari ini kami belajar bagaimana menghubungkan Alice ke sistem otomasi.  Mungkin dalam beberapa kasus terlalu rumit, lebih mudah untuk membeli bola lampu wi-fi biasa, dan itu sudah cukup.  Tetapi jika Anda berencana untuk membangun rumah yang benar-benar cerdas untuk diri sendiri, maka cara-cara sederhana tidak dapat dilakukan di sini.  Tetapi apakah itu layak atau tidak, semua orang akan memutuskan sendiri.  Terima kasih atas perhatian anda! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id465537/">https://habr.com/ru/post/id465537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id465525/index.html">Laporan seluler tentang Oracle BI EE 12c - satu, dua, tiga. Metodologi dari Kursus Oracle BI EE 12c CAD</a></li>
<li><a href="../id465527/index.html">Perjalanan panjang dari RFC 4357 ke RFC 8645 atau cara mengelola kunci enkripsi</a></li>
<li><a href="../id465529/index.html">Penangguhan lebih dari pemblokiran</a></li>
<li><a href="../id465531/index.html">Membongkar daftar bersarang dari kedalaman yang tidak terbatas</a></li>
<li><a href="../id465535/index.html">Siapa yang mengimplementasikan IPv6, dan apa yang menghambat perkembangannya</a></li>
<li><a href="../id465539/index.html">766 km - rekor jangkauan baru untuk LoRaWAN</a></li>
<li><a href="../id465541/index.html">Dari Perusahaan ke SMB: Kami berbagi pengalaman kami dalam mengadaptasi solusi perusahaan untuk usaha kecil dan menengah dengan monetisasi menggunakan model SaaS</a></li>
<li><a href="../id465545/index.html">Di sisi berbeda negara: bagaimana Facebook digoreng di Kongres AS, sementara Telegram bertarung dengan FSB</a></li>
<li><a href="../id465547/index.html">Panduan SQL: Cara Menulis Pertanyaan dengan Lebih Baik (Bagian 1)</a></li>
<li><a href="../id465551/index.html">September Digest Event TI (Bagian Satu)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>