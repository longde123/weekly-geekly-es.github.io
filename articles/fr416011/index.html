<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî© ü•ñ ‚õµÔ∏è Mod√®le BIF: code frontal propre et travail pratique avec les donn√©es du serveur ‚úä üë®‚Äçüéì üßë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le mat√©riel, dont nous publions la traduction aujourd'hui, se concentrera sur ce qu'il faut faire dans une situation o√π les donn√©es re√ßues du serveur ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mod√®le BIF: code frontal propre et travail pratique avec les donn√©es du serveur</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/416011/">  Le mat√©riel, dont nous publions la traduction aujourd'hui, se concentrera sur ce qu'il faut faire dans une situation o√π les donn√©es re√ßues du serveur ne ressemblent pas aux besoins du client.  √Ä savoir, nous examinerons d'abord un probl√®me typique de ce type, puis nous analyserons plusieurs fa√ßons de le r√©soudre. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/7dc/108/edd/7dc108edd1850ed1da6eb12f865f93a5.jpg" alt="image"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Le probl√®me de l'API serveur d√©faillante</font> </h2><br>  Prenons un exemple conditionnel bas√© sur plusieurs projets r√©els.  Supposons que nous d√©veloppons un nouveau site Web pour une organisation qui existe depuis un certain temps.  Elle a d√©j√† des points de terminaison REST, mais ils ne sont pas tout √† fait con√ßus pour ce que nous allons cr√©er.  Ici, nous devons acc√©der au serveur uniquement pour authentifier l'utilisateur, obtenir des informations √† son sujet et t√©l√©charger une liste des notifications non consult√©es de cet utilisateur.  Par cons√©quent, nous nous int√©ressons aux points de terminaison suivants de l'API serveur: <br><br><ul><li> <code>/auth</code> : autorise l'utilisateur et retourne un jeton d'acc√®s. </li><li>  <code>/profile</code> : renvoie les informations utilisateur de base. </li><li>  <code>/notifications</code> : permet d'obtenir des notifications utilisateur non lues. </li></ul><br>  Imaginez que notre application ait toujours besoin de recevoir toutes ces donn√©es dans une seule unit√©, c'est-√†-dire que, id√©alement, ce serait bien si au lieu de trois points de terminaison nous n'en avions qu'un seul. <br>  Cependant, nous sommes confront√©s √† beaucoup plus de probl√®mes que trop de points finaux.  En particulier, nous parlons du fait que les donn√©es que nous recevons ne semblent pas de la meilleure fa√ßon. <br><br>  Par exemple, le point de terminaison <code>/profile</code> √©t√© cr√©√© dans les temps anciens, il n'√©tait pas √©crit en JavaScript, par cons√©quent, les noms des propri√©t√©s dans les donn√©es qui lui sont retourn√©es semblent inhabituels pour une application JS: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"Profiles"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"David"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Gilbertson"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [       {         <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,         <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [           <span class="hljs-string"><span class="hljs-string">"/images/david.png"</span></span>         ]       }     ],     <span class="hljs-attr"><span class="hljs-attr">"Last_Login"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-01-01"</span></span>   } ] }</code> </pre> <br>  En g√©n√©ral - rien de bon. <br><br>  Certes, si vous regardez ce que le point de terminaison <code>/notifications</code> produit, les donn√©es ci-dessus de <code>/profile</code> sembleront plut√¥t int√©ressantes: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"msg-1234"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"1529739612"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Alice"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Guthbertson"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Enhanced"</span></span>: <span class="hljs-string"><span class="hljs-string">"True"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [         {           <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,           <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [             <span class="hljs-string"><span class="hljs-string">"/images/alice.png"</span></span>           ]         }       ]     },     <span class="hljs-attr"><span class="hljs-attr">"message_summary"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hey I like your hair, it re"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hey I like your hair, it really goes nice with your eyes"</span></span>   },   <span class="hljs-attr"><span class="hljs-attr">"msg-5678"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"1529731234"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bob"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Smelthsen"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [         {           <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,           <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [             <span class="hljs-string"><span class="hljs-string">"/images/smelth.png"</span></span>           ]         }       ]     },     <span class="hljs-attr"><span class="hljs-attr">"message_summary"</span></span>: <span class="hljs-string"><span class="hljs-string">"I'm launching my own cryptocu"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"I'm launching my own cryptocurrency soon and many thanks for you to look at and talk about"</span></span>   } } }</code> </pre> <br>  Ici, la liste des messages est un objet, pas un tableau.  De plus, il y a des donn√©es utilisateur ici, qui sont tout aussi inconfortablement agenc√©es que dans le cas du point d'extr√©mit√© <code>/profile</code> .  Et - voici une surprise - la propri√©t√© <code>timestamp</code> contient le nombre de secondes depuis le d√©but de 1970. <br><br>  Si je devais dessiner un sch√©ma de l'architecture de ce syst√®me incroyablement g√™nant dont nous venons de parler, il ressemblerait √† celui illustr√© dans la figure ci-dessous.  La couleur rouge est utilis√©e pour les parties de ce circuit qui correspondent √† des donn√©es mal pr√©par√©es pour d'autres travaux. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e1/6c4/42f/8e16c442f3af8ad8ca702875e25207e0.png"><br>  <i><font color="#999999">Sch√©ma du syst√®me</font></i> <br><br>  Dans ces circonstances, nous ne pouvons pas nous efforcer de r√©parer l'architecture de ce syst√®me.  Vous pouvez simplement charger les donn√©es de ces trois API et utiliser ces donn√©es dans l'application.  Par exemple, si vous devez afficher le nom d'utilisateur complet sur la page, nous devrons combiner les propri√©t√©s <code>Christian_Name</code> et <code>Surname</code> . <br><br>  Ici, je voudrais faire une remarque concernant les noms.  L‚Äôid√©e de diviser le nom complet d‚Äôune personne en nom et pr√©nom personnels est caract√©ristique des pays occidentaux.  Si vous d√©veloppez quelque chose con√ßu pour une utilisation internationale, essayez de consid√©rer le nom complet de la personne comme une cha√Æne indivisible et ne faites aucune hypoth√®se sur la fa√ßon de diviser cette cha√Æne en parties plus petites afin d'utiliser ce qui s'est pass√© dans des endroits o√π besoin de bri√®vet√© ou souhaitez faire appel √† l'utilisateur dans un style informel. <br><br>  Revenons √† nos structures de donn√©es imparfaites.  Le premier probl√®me √©vident que l'on peut voir ici s'exprime dans la n√©cessit√© de combiner des donn√©es disparates dans le code d'interface utilisateur.  Elle consiste dans le fait que nous devrons peut-√™tre r√©p√©ter cette action √† plusieurs endroits.  Si vous ne devez le faire qu'occasionnellement, le probl√®me n'est pas si grave, mais si vous en avez besoin souvent, c'est bien pire.  En cons√©quence, il y a des ph√©nom√®nes ind√©sirables caus√©s par l'inad√©quation de la fa√ßon dont les donn√©es re√ßues du serveur sont organis√©es et comment elles sont utilis√©es dans l'application. <br><br>  Le deuxi√®me probl√®me est la complexit√© du code utilis√© pour former l'interface utilisateur.  Je pense qu'un tel code devrait √™tre, d'une part, aussi simple que possible, et d'autre part - aussi clair que possible.  Plus vous devez effectuer de transformations de donn√©es internes sur le client, plus sa complexit√© et son code complexe sont les endroits o√π les erreurs se cachent g√©n√©ralement. <br><br>  Le troisi√®me probl√®me concerne les types de donn√©es.  √Ä partir des extraits de code ci-dessus, vous pouvez voir que, par exemple, les identifiants de message sont des cha√Ænes et les identifiants utilisateur sont des nombres.  D'un point de vue technique, tout va bien, mais de telles choses peuvent confondre le programmeur.  Regardez aussi la pr√©sentation des dates!  Mais qu'en est-il du d√©sordre dans la partie des donn√©es qui se rapporte √† l'image de profil?  Apr√®s tout, tout ce dont nous avons besoin est une URL menant au fichier correspondant, et non quelque chose √† partir duquel nous devrons cr√©er cette URL nous-m√™mes, pataugeant dans la jungle des structures de donn√©es imbriqu√©es. <br><br>  Si nous traitons ces donn√©es, les transmettons au code de l'interface utilisateur, puis, en analysant les modules, nous ne pouvons pas imm√©diatement comprendre exactement avec quoi nous travaillons.  La conversion de la structure de donn√©es interne et de son type lorsque vous travaillez avec elles cr√©e une charge suppl√©mentaire pour le programmeur.  Mais sans toutes ces difficult√©s, il est tout √† fait possible de le faire. <br><br>  En fait, en option, il serait possible d'impl√©menter un syst√®me de type statique pour r√©soudre ce probl√®me, mais un typage strict n'est pas capable, uniquement par le fait de sa pr√©sence, de rendre bon le mauvais code. <br><br>  Maintenant que vous pouvez voir la gravit√© du probl√®me auquel nous sommes confront√©s, parlons des moyens de le r√©soudre. <br><br><h2>  <font color="#3AC1EF">Solution n ¬∞ 1: changer l'API du serveur</font> </h2><br>  Si le p√©riph√©rique g√™nant de l'API existante n'est pas dict√© par des raisons importantes, rien ne vous emp√™che de cr√©er une nouvelle version mieux adapt√©e aux besoins du projet et de localiser cette nouvelle version, par exemple, √† <code>/v2</code> .  Cette approche peut peut-√™tre √™tre consid√©r√©e comme la solution la plus efficace aux probl√®mes ci-dessus.  Le sch√©ma d'un tel syst√®me est pr√©sent√© dans la figure ci-dessous, la structure de donn√©es qui correspond parfaitement aux besoins du client est surlign√©e en vert. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c59/59d/c18/c5959dc18590ec9bce0368e4b9ba1967.png"><br>  <i><font color="#999999">La nouvelle API serveur qui produit exactement ce dont le c√¥t√© client du syst√®me a besoin</font></i> <br><br>  Commen√ßant √† d√©velopper un nouveau projet, dont l'API laisse √† d√©sirer, je suis toujours int√©ress√© par la possibilit√© de mettre en ≈ìuvre l'approche qui vient d'√™tre d√©crite.  Cependant, parfois, le p√©riph√©rique API, bien que peu pratique, a des objectifs importants, ou changer l'API serveur n'est tout simplement pas possible.  Dans ce cas, je recourt √† l'approche suivante. <br><br><h2>  <font color="#3AC1EF">Solution n ¬∞ 2: mod√®le BFF</font> </h2><br>  C'est un bon vieux mod√®le BFF ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Backend-For-the-Frontend</a> ).  En utilisant ce mod√®le, vous pouvez r√©sumer √† partir des points de terminaison REST universels complexes et donner au frontal exactement ce dont il a besoin.  Voici une repr√©sentation sch√©matique d'une telle solution. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea5/484/437/ea5484437a08ed68db006b5194dd9a9b.png"><br>  <i><font color="#999999">Application du mod√®le BFF</font></i> <br><br>  Le sens de l'existence de la couche BFF est de satisfaire les besoins du frontend.  Peut-√™tre qu'il utilisera des points de terminaison REST suppl√©mentaires, ou des services GraphQL, ou des sockets Web, ou toute autre chose.  Son objectif principal est de faire tout son possible pour la commodit√© du c√¥t√© client de l'application. <br><br>  Mon architecture pr√©f√©r√©e est NodeJS BFF, √† l'aide de laquelle les d√©veloppeurs frontaux peuvent faire ce dont ils ont besoin, cr√©ant de superbes API pour les applications clientes qu'ils d√©veloppent.  Id√©alement, le code correspondant se trouve dans le m√™me r√©f√©rentiel que le code du frontal lui-m√™me, ce qui simplifie le partage de code, par exemple, pour v√©rifier les donn√©es envoy√©es, √† la fois sur le client et sur le serveur. <br><br>  De plus, cela signifie que les t√¢ches n√©cessitant des modifications de la partie client de l'application et de son API serveur sont effectu√©es dans un r√©f√©rentiel.  Un peu comme on dit, mais sympa. <br><br>  Cependant, BFF n'est pas toujours utilis√©.  Et ce fait nous am√®ne √† une autre solution au probl√®me de l'utilisation pratique de mauvaises API de serveur. <br><br><h2>  <font color="#3AC1EF">Solution n ¬∞ 3: mod√®le BIF</font> </h2><br>  Le mod√®le BIF (Backend In the Frontend) utilise la m√™me logique qui peut √™tre appliqu√©e √† l'aide de BFF (combinant plusieurs API et nettoyage de donn√©es), mais cette logique se d√©place du c√¥t√© client.  En fait, cette id√©e n'est pas nouvelle, elle aurait pu √™tre vue il y a vingt ans, mais une telle approche peut aider √† travailler avec des API serveur mal organis√©es, c'est pourquoi nous en parlons.  Voici √† quoi √ßa ressemble. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/185/102/d39/185102d39436b6119ead19f230eb8196.png"><br>  <i><font color="#999999">Application du mod√®le BIF</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñç Qu'est-ce qu'un BIF?</font> </h3><br>  Comme on peut le voir dans la section pr√©c√©dente, le BIF est un mod√®le, c'est-√†-dire une approche pour comprendre le code et son organisation.  Son utilisation n'entra√Æne pas la n√©cessit√© de supprimer toute logique du projet.  Il s√©pare simplement la logique d'un type (modification des structures de donn√©es) de la logique d'un autre type (la formation de l'interface utilisateur).  Cela ressemble √† l'id√©e d'une ¬´s√©paration des responsabilit√©s¬ª, que tout le monde entend. <br><br>  Ici, je voudrais noter que, bien que cela ne puisse pas √™tre qualifi√© de catastrophe, j'ai souvent d√ª voir des impl√©mentations BIF analphab√®tes.  Par cons√©quent, il me semble que beaucoup seront int√©ress√©s d'entendre une histoire sur la fa√ßon de mettre correctement en ≈ìuvre ce mod√®le. <br><br>  Le code BIF doit √™tre consid√©r√© comme un code qui peut √™tre une fois pris et transf√©r√© au serveur Node.js, apr√®s quoi tout fonctionnera de la m√™me mani√®re qu'auparavant.  Ou m√™me le transf√©rer dans un package NPM priv√©, qui sera utilis√© dans plusieurs projets front-end dans le cadre d'une entreprise, ce qui est tout simplement incroyable. <br><br>  Rappelez-vous que nous avons discut√© ci-dessus des principaux probl√®mes qui surviennent lorsque vous travaillez avec une API de serveur d√©faillante.  Parmi eux se trouve un appel trop fr√©quent √† l'API et le fait que les donn√©es retourn√©es par eux ne r√©pondent pas aux besoins du frontend. <br><br>  Nous d√©composerons la solution √† chacun de ces probl√®mes en blocs de code s√©par√©s, chacun √©tant plac√© dans son propre fichier.  Par cons√©quent, la couche BIF de la partie cliente de l'application se composera de deux fichiers.  De plus, un fichier de test leur sera joint. <br><br><h3>  <font color="#3AC1EF">‚ñç Combinaison d'appels API</font> </h3><br>  Faire beaucoup d'appels aux API du serveur dans notre code client n'est pas un probl√®me si s√©rieux.  Cependant, je voudrais l'abstraire, pour permettre de r√©pondre √† une seule ¬´requ√™te¬ª (du code de l'application √† la couche BIF), et obtenir exactement ce qui est n√©cessaire en r√©ponse. <br><br>  Bien s√ªr, dans notre cas, il n'est pas possible de faire trois requ√™tes HTTP au serveur, mais l'application n'a pas besoin de le savoir. <br><br>  L'API de ma couche BIF est repr√©sent√©e comme des fonctions.  Par cons√©quent, lorsque l'application a besoin de donn√©es sur l'utilisateur, elle appellera la fonction <code>getUser()</code> , qui lui renverra ces donn√©es.  Voici √† quoi ressemble cette fonction: <br><br><pre> <code class="hljs powershell">import parseUserData from <span class="hljs-string"><span class="hljs-string">'./parseUserData'</span></span>; import fetchJson from <span class="hljs-string"><span class="hljs-string">'./fetchJson'</span></span>; export const getUser = async () =&gt; { const auth = await fetchJson(<span class="hljs-string"><span class="hljs-string">'/auth'</span></span>); const [ <span class="hljs-type"><span class="hljs-type">profile</span></span>, <span class="hljs-type"><span class="hljs-type">notifications</span></span> ] = await Promise.all([   <span class="hljs-type"><span class="hljs-type">fetchJson</span></span>(`/<span class="hljs-type"><span class="hljs-type">profile</span></span>/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">auth.userId</span></span>}`, <span class="hljs-type"><span class="hljs-type">auth.jwt</span></span>),   <span class="hljs-type"><span class="hljs-type">fetchJson</span></span>(`/<span class="hljs-type"><span class="hljs-type">notifications</span></span>/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">auth.userId</span></span>}`, <span class="hljs-type"><span class="hljs-type">auth.jwt</span></span>), ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parseUserData(auth, profile, notifications); };</code> </pre> <br>  Ici, tout d'abord, une demande est faite au service d'authentification pour obtenir un jeton, qui peut √™tre utilis√© pour autoriser l'utilisateur (nous ne parlerons pas ici des m√©canismes d'authentification, mais notre objectif principal est le BIF). <br><br>  Apr√®s avoir re√ßu le jeton, vous pouvez ex√©cuter simultan√©ment deux demandes qui re√ßoivent des donn√©es de profil utilisateur et des informations sur les notifications non lues. <br><br>  Soit dit en passant, regardez √† quel point la construction <code>async/await</code> belle lorsque vous travaillez avec elle en utilisant <code>Promise.all</code> et en utilisant une affectation destructrice. <br><br>  Donc, c'√©tait la premi√®re √©tape, nous avons ici r√©sum√© le fait que l'acc√®s au serveur comprend trois requ√™tes.  Cependant, l'affaire n'a pas encore √©t√© faite.  √Ä savoir, faites attention √† l'appel √† la fonction <code>parseUserData()</code> , qui, comme vous pouvez en juger par son nom, <code>parseUserData()</code> les donn√©es re√ßues du serveur.  Parlons d'elle. <br><br><h3>  <font color="#3AC1EF">‚ñç Nettoyage des donn√©es</font> </h3><br>  Je veux imm√©diatement faire une recommandation qui, je crois, peut s√©rieusement affecter un projet qui n'avait pas de couche BIF auparavant, en particulier un nouveau projet.  Essayez de ne pas penser √† ce que vous obtenez du serveur pendant un certain temps.  Concentrez-vous plut√¥t sur les donn√©es dont votre application a besoin. <br><br>  En outre, il est pr√©f√©rable de ne pas essayer, lors de la conception de l'application, de prendre en compte ses √©ventuels besoins futurs, par exemple, li√©s √† 2021.  Essayez simplement de faire fonctionner l'application exactement comme elle le devrait aujourd'hui.  Le fait est que l'enthousiasme excessif pour la planification et les tentatives de pr√©dire l'avenir sont la principale raison de la complication injustifi√©e des projets logiciels. <br><br>  Revenons donc √† nos affaires.  Nous savons maintenant √† quoi ressemblent les donn√©es re√ßues des trois API de serveur, et nous savons ce qu'elles devraient devenir apr√®s analyse. <br><br>  Il semble que ce soit l'un de ces rares cas o√π l'utilisation du TDD a vraiment du sens.  Par cons√©quent, nous allons √©crire un grand test long pour la fonction <code>parseUserData()</code> : <br><br><pre> <code class="hljs powershell">import parseUserData from <span class="hljs-string"><span class="hljs-string">'./parseUserData'</span></span>; it(<span class="hljs-string"><span class="hljs-string">'should parse the data'</span></span>, () =&gt; { const authApiData = {   userId: <span class="hljs-number"><span class="hljs-number">1234</span></span>,   jwt: <span class="hljs-string"><span class="hljs-string">'the jwt'</span></span>, }; const profileApiData = {   Profiles: [     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>,       <span class="hljs-type"><span class="hljs-type">Christian_Name</span></span>: <span class="hljs-string"><span class="hljs-string">'David'</span></span>,       <span class="hljs-type"><span class="hljs-type">Surname</span></span>: <span class="hljs-string"><span class="hljs-string">'Gilbertson'</span></span>,       <span class="hljs-type"><span class="hljs-type">Photographs</span></span>: [         {           <span class="hljs-type"><span class="hljs-type">Size</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium'</span></span>,           <span class="hljs-type"><span class="hljs-type">URLS</span></span>: [             <span class="hljs-string"><span class="hljs-string">'/images/david.png'</span></span>,           ],         },       ],       <span class="hljs-type"><span class="hljs-type">Last_Login</span></span>: <span class="hljs-string"><span class="hljs-string">'2018-01-01'</span></span>     },   ], }; const notificationsApiData = {   <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: {     <span class="hljs-string"><span class="hljs-string">'msg-1234'</span></span>: {       timestamp: <span class="hljs-string"><span class="hljs-string">'1529739612'</span></span>,       user: {         Christian_Name: <span class="hljs-string"><span class="hljs-string">'Alice'</span></span>,         Surname: <span class="hljs-string"><span class="hljs-string">'Guthbertson'</span></span>,         Enhanced: <span class="hljs-string"><span class="hljs-string">'True'</span></span>,         Photographs: [           {             <span class="hljs-type"><span class="hljs-type">Size</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium'</span></span>,             <span class="hljs-type"><span class="hljs-type">URLS</span></span>: [               <span class="hljs-string"><span class="hljs-string">'/images/alice.png'</span></span>             ]           }         ]       },       message_summary: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it re'</span></span>,       message: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it really goes nice with your eyes'</span></span>     },     <span class="hljs-string"><span class="hljs-string">'msg-5678'</span></span>: {       timestamp: <span class="hljs-string"><span class="hljs-string">'1529731234'</span></span>,       user: {         Christian_Name: <span class="hljs-string"><span class="hljs-string">'Bob'</span></span>,         Surname: <span class="hljs-string"><span class="hljs-string">'Smelthsen'</span></span>,       },       message_summary: <span class="hljs-string"><span class="hljs-string">'I\'</span></span>m launching my own cryptocu<span class="hljs-string"><span class="hljs-string">',       message: '</span></span>I\<span class="hljs-string"><span class="hljs-string">'m launching my own cryptocurrency soon and many thanks for you to look at and talk about'</span></span>     },   }, }; const parsedData = parseUserData(authApiData, profileApiData, notificationsApiData); expect(parsedData).toEqual({   jwt: <span class="hljs-string"><span class="hljs-string">'the jwt'</span></span>,   id: <span class="hljs-string"><span class="hljs-string">'1234'</span></span>,   name: <span class="hljs-string"><span class="hljs-string">'David Gilbertson'</span></span>,   photoUrl: <span class="hljs-string"><span class="hljs-string">'/images/david.png'</span></span>,   notifications: [     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-string"><span class="hljs-string">'msg-1234'</span></span>,       <span class="hljs-built_in"><span class="hljs-built_in">dateTime</span></span>: <span class="hljs-type"><span class="hljs-type">expect.any</span></span>(<span class="hljs-type"><span class="hljs-type">Date</span></span>),       <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Alice Guthbertson'</span></span>,       <span class="hljs-type"><span class="hljs-type">premiumMember</span></span>: <span class="hljs-type"><span class="hljs-type">true</span></span>,       <span class="hljs-type"><span class="hljs-type">photoUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/images/alice.png'</span></span>,       <span class="hljs-type"><span class="hljs-type">message</span></span>: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it really goes nice with your eyes'</span></span>     },     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-string"><span class="hljs-string">'msg-5678'</span></span>,       <span class="hljs-built_in"><span class="hljs-built_in">dateTime</span></span>: <span class="hljs-type"><span class="hljs-type">expect.any</span></span>(<span class="hljs-type"><span class="hljs-type">Date</span></span>),       <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Bob Smelthsen'</span></span>,       <span class="hljs-type"><span class="hljs-type">premiumMember</span></span>: <span class="hljs-type"><span class="hljs-type">false</span></span>,       <span class="hljs-type"><span class="hljs-type">photoUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/images/placeholder.jpg'</span></span>,       <span class="hljs-type"><span class="hljs-type">message</span></span>: <span class="hljs-string"><span class="hljs-string">'I\'</span></span><span class="hljs-type"><span class="hljs-type">m</span></span> <span class="hljs-type"><span class="hljs-type">launching</span></span> <span class="hljs-type"><span class="hljs-type">my</span></span> <span class="hljs-type"><span class="hljs-type">own</span></span> <span class="hljs-type"><span class="hljs-type">cryptocurrency</span></span> <span class="hljs-type"><span class="hljs-type">soon</span></span> <span class="hljs-type"><span class="hljs-type">and</span></span> <span class="hljs-type"><span class="hljs-type">many</span></span> <span class="hljs-type"><span class="hljs-type">thanks</span></span> <span class="hljs-type"><span class="hljs-type">for</span></span> <span class="hljs-type"><span class="hljs-type">you</span></span> <span class="hljs-type"><span class="hljs-type">to</span></span> <span class="hljs-type"><span class="hljs-type">look</span></span> <span class="hljs-type"><span class="hljs-type">at</span></span> <span class="hljs-type"><span class="hljs-type">and</span></span> <span class="hljs-type"><span class="hljs-type">talk</span></span> <span class="hljs-type"><span class="hljs-type">about</span></span><span class="hljs-string"><span class="hljs-string">'     },   ], }); });</span></span></code> </pre> <br>  Et voici le code de la fonction elle-m√™me: <br><br><pre> <code class="hljs powershell">const getPhotoFromProfile = profile =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> profile.Photographs[<span class="hljs-number"><span class="hljs-number">0</span></span>].URLS[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'/images/placeholder.jpg'</span></span>; //   } }; const getFullNameFromProfile = profile =&gt; `${profile.Christian_Name} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{profile.Surname}`; export default <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseUserData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(authApiData, profileApiData, notificationsApiData)</span></span></span></span> { const profile = profileApiData.Profiles[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const result = {   jwt: authApiData.jwt,   id: authApiData.userId.toString(), // ID        name: getFullNameFromProfile(profile),   photoUrl: getPhotoFromProfile(profile),   notifications: [], //      ,     }; Object.entries(notificationsApiData.data).forEach(([<span class="hljs-type"><span class="hljs-type">id</span></span>, <span class="hljs-type"><span class="hljs-type">notification</span></span>]) =&gt; {   result.notifications.push({     id,     dateTime: new Date(Number(notification.timestamp) * <span class="hljs-number"><span class="hljs-number">1000</span></span>), // ,   ,   ,     Unix,         name: getFullNameFromProfile(notification.user),     photoUrl: getPhotoFromProfile(notification.user),     message: notification.message,     premiumMember: notification.user.Enhanced === <span class="hljs-string"><span class="hljs-string">'True'</span></span>,   }) }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  Je voudrais noter que lorsqu'il est possible de rassembler en un seul endroit deux cents lignes de code charg√©es de modifier les donn√©es dispers√©es avant cela tout au long de l'application, cela cr√©e un sentiment merveilleux.  Maintenant, tout cela est dans un fichier, des tests unitaires sont √©crits pour ce code, et tous les moments ambigus sont fournis avec des commentaires. <br><br>  J'ai dit plus t√¥t que BFF est mon approche pr√©f√©r√©e pour combiner et effacer des donn√©es, mais il y a un domaine dans lequel BIF est sup√©rieur √† BFF.  √Ä savoir, les donn√©es re√ßues du serveur peuvent inclure des objets JavaScript qui ne prennent pas en charge JSON, tels que des objets <code>Date</code> ou <code>Map</code> (c'est peut-√™tre l'une des fonctionnalit√©s JavaScript les plus sous-utilis√©es).  Par exemple, dans notre cas, nous devons convertir la date provenant du serveur (exprim√©e en secondes, pas en millisecondes) en un objet JS de type <code>Date</code> . <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Si vous pensez que votre projet a quelque chose en commun avec celui sur lequel nous avons examin√© les probl√®mes des API infructueuses, analysez son code en vous posant les questions suivantes sur l'utilisation des donn√©es du serveur sur le client: <br><br><ul><li>  Devez-vous combiner des propri√©t√©s qui ne sont jamais utilis√©es s√©par√©ment (par exemple, le nom et le pr√©nom de l'utilisateur)? </li><li>  Le code JS doit-il fonctionner avec des noms de propri√©t√© form√©s d'une mani√®re qui n'est pas accept√©e dans JS (quelque chose comme PascalCase)? </li><li>  Quels sont les types de donn√©es des diff√©rents identifiants?  Peut-√™tre que parfois ce sont des cha√Ænes, parfois des nombres? </li><li>  Comment les dates sont-elles pr√©sent√©es dans votre projet?  Peut-√™tre que parfois ce sont des objets <code>Date</code> JS pr√™ts √† √™tre utilis√©s dans l'interface, et parfois des nombres, voire des cha√Ænes? </li><li>  Devez-vous souvent v√©rifier l'existence des propri√©t√©s ou v√©rifier si une entit√© est un tableau avant de commencer √† √©num√©rer les √©l√©ments de cette entit√© pour former un fragment de l'interface utilisateur sur sa base?  Se pourrait-il que cette entit√© ne soit pas un tableau, m√™me vide? </li><li>  Devez-vous trier ou filtrer les tableaux lors de la formation de l'interface, qui, id√©alement, devrait d√©j√† √™tre correctement tri√©e et filtr√©e? </li><li>  S'il s'av√®re que, lors de la v√©rification de l'existence des propri√©t√©s, aucune propri√©t√© n'est recherch√©e, devez-vous passer √† l'utilisation de certaines valeurs par d√©faut (par exemple, utiliser l'image standard lorsqu'il n'y a pas de photo d'utilisateur dans les donn√©es re√ßues du serveur)? </li><li>  Les propri√©t√©s sont-elles uniform√©ment nomm√©es?  Arrive-t-il que la m√™me entit√© puisse avoir des noms diff√©rents, ce qui est probablement d√ª √† l'utilisation conjointe, relativement parlant, des ¬´anciennes¬ª et des ¬´nouvelles¬ª API serveur? </li><li>  Devez-vous, avec des donn√©es utiles, transf√©rer quelque part des donn√©es qui ne sont jamais utilis√©es, uniquement parce qu'elles proviennent de l'API du serveur?  Ces donn√©es inutilis√©es interf√®rent-elles avec le d√©bogage? </li></ul><br>  Si vous pouvez r√©pondre positivement √† une ou deux questions de cette liste, alors vous ne devriez peut-√™tre pas r√©parer quelque chose qui fonctionne d√©j√† correctement. <br><br>  Cependant, si vous, en lisant ces questions, d√©couvrez dans chacun d'eux les probl√®mes de votre projet, si le p√©riph√©rique de votre code est inutilement compliqu√© √† cause de tout cela, s'il est difficile √† percevoir et √† tester, s'il contient des erreurs difficiles √† d√©tecter, regardez le mod√®le BIF. <br><br>  En fin de compte, je tiens √† dire que lors de l'introduction de la couche BIF dans les applications existantes, les choses sont plus faciles car cela peut se faire par √©tapes, par petites √©tapes.  Disons que la premi√®re version de la fonction de pr√©paration des donn√©es, appelons-la <code>parseData()</code> , peut simplement, sans modifications, retourner ce qui vient √† son entr√©e.  Ensuite, vous pouvez d√©placer progressivement la logique du code responsable de la cr√©ation de l'interface utilisateur vers cette fonction. <br><br>  <b>Chers lecteurs!</b>     ,          BIF? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416011/">https://habr.com/ru/post/fr416011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416001/index.html">Messages d'un site en VK - simple et efficace - PHP + CUrl</a></li>
<li><a href="../fr416003/index.html">Rendu de fichier HTML: un chapitre du livre ReactPHP for Beginners de Skyeng</a></li>
<li><a href="../fr416005/index.html">16 React Tools pour les d√©veloppeurs d'interfaces</a></li>
<li><a href="../fr416007/index.html">√Ä peu pr√®s compliqu√©. Le d√©but de la cr√©ation d'une "maison intelligente" sans fil. Bas√© sur la technologie Linux, les logiciels Z-Wave et MajorDoMo</a></li>
<li><a href="../fr416009/index.html">Essayez les excr√©ments de lapin, c'est vigoureux, √ßa va attraper - extraits en pharmacologie</a></li>
<li><a href="../fr416013/index.html">Comment commencer √† investir et √©conomiser de l'argent: les experts de Dow Jones ont nomm√© les cinq principales erreurs des traders d√©butants</a></li>
<li><a href="../fr416015/index.html">Jouer avec les threads dans Node.JS 10.5.0</a></li>
<li><a href="../fr416017/index.html">Nous collectons l'analyse de cohorte / analyse des flux sur l'exemple d'Excel</a></li>
<li><a href="../fr416019/index.html">Quelle est la qualit√© de l'√©cosyst√®me open source de R pour r√©soudre les probl√®mes commerciaux?</a></li>
<li><a href="../fr416021/index.html">D√©velopper votre propre framework et la croissance professionnelle d'un programmeur JS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>