<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â˜ğŸ¾ ğŸ¥ ğŸŒ— Node.jså¼€å‘äººå‘˜å·¥å…·ã€‚ Webå¥—æ¥å­—ä¸Šçš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ ğŸ¢ âš–ï¸ ğŸšï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ææ€–çš„æ•…äº‹ç»å¸¸è®²è¿°WebsocketæŠ€æœ¯ï¼Œä¾‹å¦‚ï¼ŒWebæµè§ˆå™¨ä¸æ”¯æŒWebsocketæŠ€æœ¯ï¼Œæˆ–è€…æä¾›å•†/ç®¡ç†å‘˜æŠ‘åˆ¶Websocketæµé‡-å› æ­¤æ— æ³•åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¼€å‘äººå‘˜å¹¶ä¸æ€»æ˜¯èƒ½åƒå…¶ä»–ä»»ä½•æŠ€æœ¯ä¸€æ ·é¢„è§åˆ°websocketæŠ€æœ¯æ‰€å…·æœ‰çš„é™·é˜±ã€‚ è‡³äºæ‰€è°“çš„é™åˆ¶ï¼Œæˆ‘é©¬ä¸Šè¯´ï¼Œä»Šå¤©æœ‰96.8ï¼…çš„ç½‘...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Node.jså¼€å‘äººå‘˜å·¥å…·ã€‚ Webå¥—æ¥å­—ä¸Šçš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459978/">ææ€–çš„æ•…äº‹ç»å¸¸è®²è¿°WebsocketæŠ€æœ¯ï¼Œä¾‹å¦‚ï¼ŒWebæµè§ˆå™¨ä¸æ”¯æŒWebsocketæŠ€æœ¯ï¼Œæˆ–è€…æä¾›å•†/ç®¡ç†å‘˜æŠ‘åˆ¶Websocketæµé‡-å› æ­¤æ— æ³•åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¼€å‘äººå‘˜å¹¶ä¸æ€»æ˜¯èƒ½åƒå…¶ä»–ä»»ä½•æŠ€æœ¯ä¸€æ ·é¢„è§åˆ°websocketæŠ€æœ¯æ‰€å…·æœ‰çš„é™·é˜±ã€‚ è‡³äºæ‰€è°“çš„é™åˆ¶ï¼Œæˆ‘é©¬ä¸Šè¯´ï¼Œä»Šå¤©æœ‰96.8ï¼…çš„ç½‘ç»œæµè§ˆå™¨æ”¯æŒwebsocketæŠ€æœ¯ã€‚ æ‚¨å¯ä»¥è¯´å‰©ä½™3.2ï¼…çš„ç”¨æˆ·è¿‡å¤šï¼Œè¿™æ˜¯æ•°ç™¾ä¸‡çš„ç”¨æˆ·ã€‚ æˆ‘å®Œå…¨åŒæ„ä½ çš„çœ‹æ³•ã€‚ æ¯”è¾ƒè€Œè¨€ï¼Œåªæœ‰æ‰€æœ‰å·²çŸ¥çš„ä¿¡æ¯ã€‚ æ¯ä¸ªäººéƒ½åœ¨Ajaxä¸­ä½¿ç”¨äº†å¤šå¹´çš„åŒä¸€ä¸ªXmlHttpRequestï¼Œå®ƒæ”¯æŒ97.17ï¼…çš„Webæµè§ˆå™¨ï¼ˆä¸å¤šï¼Œå¯¹å§ï¼Ÿï¼‰ï¼Œå¹¶ä¸”é€šå¸¸å¯ä»¥è·å–93.08ï¼…çš„Webæµè§ˆå™¨ã€‚ ä¸websocketä¸åŒï¼Œåœ¨ä½¿ç”¨AjaxæŠ€æœ¯æ—¶ï¼Œè¿™ç§ç™¾åˆ†æ¯”ï¼ˆç”šè‡³æ›´ä½ï¼‰ç”šè‡³æ²¡æœ‰åœæ­¢å¾ˆé•¿æ—¶é—´ã€‚ å› æ­¤ï¼Œç›®å‰åœ¨é•¿è½®è¯¢ä¸Šä½¿ç”¨å›é€€æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ å¦‚æœä»…ç”±äºä¸æ”¯æŒwebsocketçš„Webæµè§ˆå™¨ä¸ä¸æ”¯æŒXmlHttpRequestçš„Webæµè§ˆå™¨ç›¸åŒï¼Œå¹¶ä¸”å®é™…ä¸Šä¸ä¼šå‘ç”Ÿä»»ä½•å›é€€ã€‚ <br><br> ç¬¬äºŒä¸ªææ€–æ•…äº‹ï¼Œç¦æ­¢å…¬å¸ç½‘ç»œçš„æä¾›å•†æˆ–ç®¡ç†å‘˜ä½¿ç”¨websocketï¼Œè¿™ä¹Ÿæ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºç°åœ¨æ¯ä¸ªäººéƒ½ä½¿ç”¨httpsåè®®ï¼Œå¹¶ä¸”æ— æ³•ç†è§£websocketè¿æ¥æ˜¯æ‰“å¼€çš„ï¼ˆä¸ç ´åhttpsï¼‰ã€‚ <br><br> è‡³äºçœŸæ­£çš„é™åˆ¶å’Œå…‹æœè¿™äº›é™åˆ¶çš„æ–¹æ³•ï¼Œæˆ‘å°†åœ¨æœ¬æ–‡ä¸­ä»¥å¼€å‘åº”ç”¨ç¨‹åºçš„Webç®¡ç†åŒºåŸŸä¸ºä¾‹è¿›è¡Œä»‹ç»ã€‚ <br><a name="habracut"></a><br> å› æ­¤ï¼Œå¦ç‡åœ°è¯´ï¼ŒWebæµè§ˆå™¨ä¸­çš„WebSocketå¯¹è±¡å…·æœ‰ä¸€ç»„éå¸¸ç®€æ´çš„æ–¹æ³•ï¼šsendï¼ˆï¼‰å’Œcloseï¼ˆï¼‰ä»¥åŠä»EventTargetå¯¹è±¡ç»§æ‰¿çš„addEventListenerï¼ˆï¼‰ï¼ŒremoveEventListenerï¼ˆï¼‰å’ŒdispatchEventï¼ˆï¼‰æ–¹æ³•ã€‚ å› æ­¤ï¼Œå¼€å‘äººå‘˜å¿…é¡»ï¼ˆé€šå¸¸ï¼‰æˆ–ç‹¬ç«‹ï¼ˆå‡ ä¹ä¸å¯èƒ½ï¼‰ä½¿ç”¨åº“æ¥è§£å†³å‡ ä¸ªé—®é¢˜ã€‚ <br><br> è®©æˆ‘ä»¬ä»æœ€å®¹æ˜“ç†è§£çš„ä»»åŠ¡å¼€å§‹ã€‚ ä¸æœåŠ¡å™¨çš„è¿æ¥ä¼šå®šæœŸä¸­æ–­ã€‚ é‡æ–°è¿æ¥éå¸¸å®¹æ˜“ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨è¿˜è®°å¾—æ­¤æ—¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘å‡ºçš„æ¶ˆæ¯ä»åœ¨ç»§ç»­ï¼Œåˆ™ä¸€åˆ‡éƒ½ä¼šç«‹å³å˜å¾—å¤æ‚å¾—å¤šã€‚ é€šå¸¸ï¼Œå¦‚æœæœªæä¾›ç”¨äºæ¥æ”¶æ¶ˆæ¯çš„ç¡®è®¤æœºåˆ¶ï¼Œåˆ™æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼›å¦‚æœæä¾›äº†ç¡®è®¤æœºåˆ¶ï¼Œåˆ™æ¶ˆæ¯å¯èƒ½ä¼šé‡æ–°å‘é€ï¼ˆç”šè‡³å¤šæ¬¡ï¼‰ï¼Œä½†å¤±è´¥å‘ç”Ÿåœ¨æ¥æ”¶åç«‹å³ç¡®è®¤æ¶ˆæ¯ä¹‹å‰ã€‚ <br><br> å¦‚æœæ‚¨éœ€è¦ä¿è¯æ¶ˆæ¯ä¼ é€’å’Œ/æˆ–æ²¡æœ‰é‡å¤çš„æ¶ˆæ¯ä¼ é€’ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç‰¹æ®Šåè®®æ¥å®ç°æ­¤ç›®çš„ï¼Œä¾‹å¦‚AMQPå’ŒMQTTï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥ä¸websocketä¼ è¾“ä¸€èµ·ä½¿ç”¨ã€‚ ä½†æ˜¯ä»Šå¤©æˆ‘ä»¬ä¸ä¼šè€ƒè™‘å®ƒä»¬ã€‚ <br><br> å¤§å¤šæ•°ç”¨äºwebsocketçš„åº“éƒ½æ”¯æŒç¨‹åºå‘˜é€æ˜åœ°é‡æ–°è¿æ¥åˆ°æœåŠ¡å™¨ã€‚ ä½¿ç”¨è¿™æ ·çš„åº“æ€»æ˜¯æ¯”å¼€å‘å®ç°æ›´å¯é ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦å®ç°ç”¨äºå‘é€å’Œæ¥æ”¶å¼‚æ­¥æ¶ˆæ¯çš„åŸºç¡€ç»“æ„ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨â€œè£¸â€ onmessageäº‹ä»¶å¤„ç†ç¨‹åºï¼Œè€Œæ— éœ€é™„åŠ ç»‘å®šï¼Œè¿™æ˜¯ä¸€é¡¹ä¸è´¹åŠ›çš„ä»»åŠ¡ã€‚ è¿™æ ·çš„åŸºç¡€ç»“æ„å¯ä»¥æ˜¯ä¾‹å¦‚è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰ã€‚  id idæ˜¯å¼•å…¥åˆ°json-rpcè§„èŒƒä¸­çš„ï¼Œä¸“é—¨ç”¨äºWebsocketä¼ è¾“ï¼Œå®ƒå…è®¸æ‚¨å°†å®¢æˆ·ç«¯çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ˜ å°„åˆ°WebæœåŠ¡å™¨çš„å“åº”æ¶ˆæ¯ã€‚ ä¸æ‰€æœ‰å…¶ä»–å¯èƒ½æ€§ç›¸æ¯”ï¼Œæˆ‘æ›´å¸Œæœ›ä½¿ç”¨æ­¤åè®®ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è¿˜æ²¡æœ‰åœ¨node.jsçš„æœåŠ¡å™¨éƒ¨åˆ†æ‰¾åˆ°è¯¥åè®®çš„æˆåŠŸå®ç°ã€‚ <br><br> æœ€åï¼Œæ‚¨éœ€è¦å®ç°æ‰©å±•ã€‚ å›æƒ³ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ä¼šå®šæœŸå‘ç”Ÿã€‚ å¦‚æœä¸€å°æœåŠ¡å™¨çš„åŠŸèƒ½å¯¹æˆ‘ä»¬æ¥è¯´ä¸å¤Ÿç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å†å¢åŠ å‡ å°æœåŠ¡å™¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ–­å¼€è¿æ¥åï¼Œå°†æ— æ³•ä¿è¯ä¸åŒä¸€æœåŠ¡å™¨çš„è¿æ¥ã€‚ é€šå¸¸ï¼ŒredisæœåŠ¡å™¨æˆ–redisæœåŠ¡å™¨ç¾¤é›†ç”¨äºåè°ƒå¤šä¸ªwebsocketæœåŠ¡å™¨ã€‚ <br><br> è€Œä¸”ï¼Œä¸å¹¸çš„æ˜¯ï¼Œæ— è®ºå¦‚ä½•ï¼Œè¿Ÿæ—©æˆ‘ä»¬éƒ½ä¼šé‡åˆ°ç³»ç»Ÿæ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºåœ¨åŒæ—¶æ‰“å¼€çš„websocketè¿æ¥æ•°é‡ï¼ˆä¸å°†å…¶ä¸æ€§èƒ½æ··æ·†ï¼‰ä¸­ï¼Œnode.jsçš„åŠŸèƒ½å¤§å¤§ä½äºæ¶ˆæ¯é˜Ÿåˆ—å’Œä»£ç†ä¹‹ç±»çš„ä¸“ç”¨æœåŠ¡å™¨ã€‚ åœ¨æŸä¸ªå…³é”®ç‚¹ä¹‹åï¼Œéœ€è¦é€šè¿‡redisæœåŠ¡å™¨ç¾¤é›†åœ¨websocketæœåŠ¡å™¨çš„æ‰€æœ‰å®ä¾‹ä¹‹é—´è¿›è¡Œäº¤å‰äº¤æ¢ï¼Œè¿™ä¸ä¼šæ˜¾ç€å¢åŠ æ‰“å¼€è¿æ¥çš„æ•°é‡ã€‚ è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸“é—¨çš„æœåŠ¡å™¨ï¼Œä¾‹å¦‚AMQPå’ŒMQTTï¼Œå®ƒä»¬å¯ä»¥å·¥ä½œï¼ŒåŒ…æ‹¬é€šè¿‡websocketä¼ è¾“ã€‚ ä½†æ˜¯ä»Šå¤©æˆ‘ä»¬ä¸ä¼šè€ƒè™‘å®ƒä»¬ã€‚ <br><br> ä»åˆ—å‡ºçš„ä»»åŠ¡åˆ—è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨websocketæ—¶è¿›è¡Œå¾ªç¯éå¸¸è€—æ—¶ï¼Œå¦‚æœæ‚¨éœ€è¦å°†è§£å†³æ–¹æ¡ˆæ‰©å±•åˆ°å¤šä¸ªwebsocketæœåŠ¡å™¨ï¼Œç”šè‡³æ˜¯ä¸å¯èƒ½çš„ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘å»ºè®®è€ƒè™‘ä½¿ç”¨websocketå®ç°å·¥ä½œçš„å‡ ç§æµè¡Œçš„åº“ã€‚ <br><br> æˆ‘å°†ç«‹å³ä»è€ƒè™‘ä¸­æ’é™¤é‚£äº›ä»…åœ¨è¿‡æ—¶çš„ä¼ è¾“æ–¹å¼ä¸Šå®ç°å›é€€çš„åº“ï¼Œå› ä¸ºä»Šå¤©è¯¥åŠŸèƒ½å·²ä¸ç›¸å…³ï¼Œè€Œå®ç°æ›´å¹¿æ³›åŠŸèƒ½çš„åº“é€šå¸¸ä¹Ÿå¯ä»¥åœ¨è¿‡æ—¶çš„ä¼ è¾“æ–¹å¼ä¸Šå®ç°å›é€€ã€‚ <br><br> æˆ‘å°†ä»æœ€å—æ¬¢è¿çš„åº“-socket.ioå¼€å§‹ã€‚ ç°åœ¨æ‚¨å¯ä»¥å¬åˆ°è¿™æ ·çš„æ„è§ï¼ˆå¾ˆå¯èƒ½æ˜¯å…¬å¹³çš„ï¼‰ï¼šå°±èµ„æºè€Œè¨€ï¼Œæ­¤åº“é€Ÿåº¦æ…¢ä¸”æ˜‚è´µã€‚ æœ€æœ‰å¯èƒ½çš„æ˜¯ï¼Œå®ƒçš„å·¥ä½œé€Ÿåº¦æ¯”æœ¬åœ°websocketæ…¢ã€‚ ä½†æ˜¯ï¼Œä»ä»Šå¤©çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒæ˜¯æœ€å‘è¾¾çš„å›¾ä¹¦é¦†ã€‚ è€Œä¸”ï¼Œå†æ¬¡ä½¿ç”¨websocketæ—¶ï¼Œä¸»è¦çš„é™åˆ¶å› ç´ ä¸æ˜¯é€Ÿåº¦ï¼Œè€Œæ˜¯ä¸å”¯ä¸€å®¢æˆ·ç«¯åŒæ—¶æ‰“å¼€çš„è¿æ¥æ•°ã€‚ é€šè¿‡ä¸å®¢æˆ·ç«¯è¿æ¥åˆ°ä¸“ç”¨æœåŠ¡å™¨ï¼Œå·²ç»å¯ä»¥æœ€å¥½åœ°è§£å†³æ­¤é—®é¢˜ã€‚ <br><br> å› æ­¤ï¼Œå½“ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥å¹¶ä½¿ç”¨æœåŠ¡å™¨æˆ–RedisæœåŠ¡å™¨ç¾¤é›†è¿›è¡Œæ‰©å±•æ—¶ï¼Œsoket.ioå¯å®ç°å¯é çš„æ¢å¤ã€‚ å®é™…ä¸Šï¼Œsocket.ioå®ç°äº†è‡ªå·±çš„æ¶ˆæ¯åè®®ï¼Œè¯¥åè®®ä½¿æ‚¨æ— éœ€ç»‘å®šç‰¹å®šçš„ç¼–ç¨‹è¯­è¨€å³å¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°æ¶ˆæ¯ä¼ é€’ã€‚ <br><br>  socket.ioä¸€ä¸ªæœ‰è¶£çš„åŠŸèƒ½æ˜¯äº‹ä»¶å¤„ç†çš„ç¡®è®¤ï¼Œå…¶ä¸­å¯ä»¥å°†ä»»æ„å¯¹è±¡ä»æœåŠ¡å™¨è¿”å›åˆ°å®¢æˆ·ç«¯ï¼Œè¿™å…è®¸è¿›è¡Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆå°½ç®¡å®ƒä¸ç¬¦åˆjson-rpcæ ‡å‡†ï¼‰ã€‚ <br><br> å¦å¤–ï¼Œåˆæ­¥åœ°ï¼Œæˆ‘ç ”ç©¶äº†å¦å¤–ä¸¤ä¸ªæœ‰è¶£çš„åº“ï¼Œä¸‹é¢å°†å¯¹å…¶è¿›è¡Œç®€è¦è®¨è®ºã€‚ <br><br>  Fayeå›¾ä¹¦é¦†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">faye.jcoglan.com</a> ã€‚ å®ƒå®ç°äº†åœ¨CometDé¡¹ç›®ä¸­å¼€å‘çš„Bayeuxåè®®ï¼Œå¹¶å®ç°äº†æ¶ˆæ¯åˆ°æ¶ˆæ¯é€šé“çš„è®¢é˜…/åˆ†å‘ã€‚ è¯¥é¡¹ç›®è¿˜æ”¯æŒä½¿ç”¨æœåŠ¡å™¨æˆ–RedisæœåŠ¡å™¨ç¾¤é›†è¿›è¡Œæ‰©å±•ã€‚ å°è¯•æ‰¾åˆ°å®ç°RPCçš„æ–¹æ³•çš„å°è¯•å¤±è´¥ï¼Œå› ä¸ºå®ƒä¸é€‚åˆBayeuxåè®®æ–¹æ¡ˆã€‚ <br><br> åœ¨socketcluster <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">socketcluster.io</a>é¡¹ç›®ä¸­ï¼Œé‡ç‚¹æ˜¯æ‰©å±•WebsocketæœåŠ¡å™¨ã€‚ åŒæ—¶ï¼Œä¸å‰é¢æåˆ°çš„ä¸¤ä¸ªåº“ä¸€æ ·ï¼ŒwebsocketæœåŠ¡å™¨é›†ç¾¤ä¸æ˜¯åŸºäºredisæœåŠ¡å™¨åˆ›å»ºçš„ï¼Œè€Œæ˜¯åŸºäºnode.jsåˆ›å»ºçš„ã€‚ åœ¨è¿™æ–¹é¢ï¼Œåœ¨éƒ¨ç½²é›†ç¾¤æ—¶ï¼Œæœ‰å¿…è¦å¯åŠ¨ä¸€ä¸ªç›¸å½“å¤æ‚çš„ä»£ç†å’Œå·¥ä½œè€…åŸºç¡€ç»“æ„ã€‚ <br><br> ç°åœ¨è®©æˆ‘ä»¬ç»§ç»­åœ¨socket.ioä¸Šå®ç°RPCã€‚ å¦‚å‰æ‰€è¿°ï¼Œè¯¥åº“å·²ç»å®ç°äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢å¯¹è±¡çš„åŠŸèƒ½ï¼š <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = io({ <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/ws'</span></span>, <span class="hljs-attr"><span class="hljs-attr">transports</span></span>: [<span class="hljs-string"><span class="hljs-string">'websocket'</span></span>] }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> remoteCall = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { socket.emit(<span class="hljs-string"><span class="hljs-string">'remote-call'</span></span>, data, (response) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.error) { reject(response); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { resolve(response); } }); });</code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>).createServer(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> io = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>)(server, { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/ws'</span></span> }); io.on(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, (socket) =&gt; { socket.on(<span class="hljs-string"><span class="hljs-string">'remote-call'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (data, callback) =&gt; { handleRemoteCall(socket, data, callback); }); }); server.listen(<span class="hljs-number"><span class="hljs-number">5000</span></span>, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'dashboard backend listening on *:5000'</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> handleRemoteCall = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">socket, data, callback</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response =... callback(response) }</code> </pre><br> è¿™æ˜¯ä¸€èˆ¬æ–¹æ¡ˆã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä¸ç‰¹å®šåº”ç”¨ç¨‹åºç›¸å…³çš„æ¯ä¸ªéƒ¨åˆ†ã€‚ ä¸ºäº†æ„å»ºç®¡ç†é¢æ¿ï¼Œæˆ‘ä½¿ç”¨äº†react-adminåº“<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/marmelab/react-admin</a> ã€‚ ä¸è¯¥åº“ä¸­æœåŠ¡å™¨çš„æ•°æ®äº¤æ¢æ˜¯ä½¿ç”¨æ•°æ®æä¾›ç¨‹åºå®ç°çš„ï¼Œè¯¥æ•°æ®æä¾›ç¨‹åºå…·æœ‰éå¸¸æ–¹ä¾¿çš„æ–¹æ¡ˆï¼Œå‡ ä¹æ˜¯ä¸€ç§æ ‡å‡†ã€‚ ä¾‹å¦‚ï¼Œè¦è·å–åˆ—è¡¨ï¼Œè¯¥æ–¹æ³•ç§°ä¸ºï¼š <br><br><pre> <code class="javascript hljs">dataProvider( <span class="hljs-string"><span class="hljs-string">'GET_LIST'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, { <span class="hljs-attr"><span class="hljs-attr">pagination</span></span>: { <span class="hljs-attr"><span class="hljs-attr">page</span></span>: {int}, <span class="hljs-attr"><span class="hljs-attr">perPage</span></span>: {int} }, <span class="hljs-attr"><span class="hljs-attr">sort</span></span>: { <span class="hljs-attr"><span class="hljs-attr">field</span></span>: {string}, <span class="hljs-attr"><span class="hljs-attr">order</span></span>: {string} }, <span class="hljs-attr"><span class="hljs-attr">filter</span></span>: { <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span> } }</code> </pre><br> å¼‚æ­¥å“åº”ä¸­çš„æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼š <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: [  ], <span class="hljs-attr"><span class="hljs-attr">total</span></span>:      }</code> </pre><br> å½“å‰ï¼Œé’ˆå¯¹å„ç§æœåŠ¡å™¨å’Œæ¡†æ¶ï¼ˆä¾‹å¦‚Firebaseï¼Œspring bootï¼Œgraphqlç­‰ï¼‰çš„ååº”ç®¡ç†æ•°æ®æä¾›ç¨‹åºå®ç°æ•°é‡æƒŠäººã€‚ åœ¨RPCçš„æƒ…å†µä¸‹ï¼Œå®ç°æ˜¯æœ€ç®€æ´çš„ï¼Œå› ä¸ºè¯¥å¯¹è±¡å·²ä»¥å…¶åŸå§‹å½¢å¼ä¼ è¾“åˆ°äº†sendå‡½æ•°è°ƒç”¨ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = io({ <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/ws'</span></span>, <span class="hljs-attr"><span class="hljs-attr">transports</span></span>: [<span class="hljs-string"><span class="hljs-string">'websocket'</span></span>] }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> (action, collection, payload = {}) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { socket.emit(<span class="hljs-string"><span class="hljs-string">'remote-call'</span></span>, {action, collection, payload}, (response) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.error) { reject(response); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { resolve(response); } }); });</code> </pre><br> ä¸å¹¸çš„æ˜¯ï¼Œå¿…é¡»åœ¨æœåŠ¡å™¨ç«¯åšæ›´å¤šçš„å·¥ä½œã€‚ ä¸ºäº†ç»„ç»‡å¤„ç†è¿œç¨‹è°ƒç”¨çš„åŠŸèƒ½çš„æ˜ å°„ï¼Œå¼€å‘äº†ç±»ä¼¼äºexpress.jsçš„è·¯ç”±å™¨ã€‚ è¯¥å®ç°ä»…ä¾èµ–äºç­¾åï¼ˆå¥—æ¥å­—ï¼Œæœ‰æ•ˆè´Ÿè½½ï¼Œå›è°ƒï¼‰è€Œä¸æ˜¯ä¸­é—´ä»¶ï¼ˆreqï¼Œresï¼Œnextï¼‰ç­¾åã€‚ ç»“æœï¼Œæˆ‘ä»¬éƒ½å¾—åˆ°äº†é€šå¸¸çš„ä»£ç ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Router = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./router'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> router = Router(); router.use(<span class="hljs-string"><span class="hljs-string">'GET_LIST'</span></span>, (socket, payload, callback) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> limit = <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(payload.pagination.perPage); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> offset = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Number</span></span></span></span><span class="hljs-function"><span class="hljs-params">(payload.pagination.page</span></span></span><span class="hljs-function">) - 1) * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{data: users.slice(offset, offset + limit </span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">total</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">users</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">length</span></span></span><span class="hljs-function">}); }); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">router</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">use</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'GET_ONE'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (socket, payload, callback</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: users[payload.id]}); }); router.use(<span class="hljs-string"><span class="hljs-string">'UPDATE'</span></span>, (socket, payload, callback) =&gt; { users[payload.id] = payload.data <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: users[payload.id] }); }); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = router; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> users = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10000</span></span>; i++) { users.push({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: i, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">`name of </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${i}</span></span></span><span class="hljs-string">`</span></span>}); }</code> </pre><br> è·¯ç”±å™¨å®ç°çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨é¡¹ç›®å­˜å‚¨åº“ä¸­</a>æ‰¾åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ã€‚</a> <br><br> å‰©ä¸‹çš„å°±æ˜¯ä¸ºAdminç»„ä»¶åˆ†é…ä¸€ä¸ªæä¾›ç¨‹åºï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Admin, Resource, EditGuesser } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-admin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UserList <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./UserList'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dataProvider <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./wsProvider'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> &lt;Admin dataProvider={dataProvider}&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Resource</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"users"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">list</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{UserList}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">edit</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{EditGuesser}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Admin</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> App;</code> </pre><br><br> æœ‰ç”¨çš„é“¾æ¥ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.www.infoq.com/articles/Web-Sockets-Proxy-Servers</a> <br><br>  apapacy@gmail.com <br>  2019å¹´7æœˆ14æ—¥ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN459978/">https://habr.com/ru/post/zh-CN459978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN459964/index.html">8ç§ç®€å•çš„UIæŠ€å·§ï¼Œæ— éœ€å€ŸåŠ©åŠ¨ç”»å³å¯ä½¿åŸå‹è®¾è®¡åŠ¨æ€åŒ–</a></li>
<li><a href="../zh-CN459968/index.html">å¤±è¸ªçš„é©¬æ¥è¥¿äºšæ³¢éŸ³å…¬å¸çœŸæ­£å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆç¬¬3/3éƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN459970/index.html">æ‰¿è¯ºå…¨éƒ¨è§£å†³</a></li>
<li><a href="../zh-CN459972/index.html">Dockerå¼€å‘ã€‚ å½“åœ°ç¯å¢ƒã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN459976/index.html">é€‚ç”¨äºNGINXçš„æ–°Nemesida WAFå…è´¹ç‰ˆæœ¬</a></li>
<li><a href="../zh-CN459980/index.html">é«˜ç§‘æŠ€å°¼æ—¥åˆ©äºšå­—æ¯</a></li>
<li><a href="../zh-CN459982/index.html">ç½—æ–¯æ—åˆ†æä»ªã€‚ å¦‚ä½•å¿«é€Ÿå‡†ç¡®åœ°ç¼–å†™ä»£ç </a></li>
<li><a href="../zh-CN459984/index.html">ä½¿ç”¨GitLabå’ŒAnsibleå°†åŸºç¡€è®¾æ–½æ„å»ºä¸ºä»£ç </a></li>
<li><a href="../zh-CN459988/index.html">ç‹—åƒäº†ç¥ç»ç½‘ç»œ</a></li>
<li><a href="../zh-CN459990/index.html">æ²‰æµ¸åœ¨ç§»åŠ¨ä¸­-Facebookçš„LibraåŒºå—é“¾ç¼–ç¨‹è¯­è¨€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>