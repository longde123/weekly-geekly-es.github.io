<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😍 👨‍👩‍👧‍👦 🙏🏿 Waterius: Transfer pembacaan air ke telepon melalui Wi-Fi (4 tahun dengan baterai) 🚣 ☦️ 👩🏽‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suatu kali saya bosan mengambil pembacaan meter air. Itu mungkin untuk menyelesaikan magnet di dekat konter dan menenangkan ini, tetapi saya menemukan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Waterius: Transfer pembacaan air ke telepon melalui Wi-Fi (4 tahun dengan baterai)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418573/"><img src="https://habrastorage.org/webt/cu/cm/id/cucmidscnzwyjeto65obezfzjgw.jpeg"><br><br>  Suatu kali saya bosan mengambil pembacaan meter air.  Itu mungkin untuk menyelesaikan magnet di dekat konter dan menenangkan ini, tetapi saya menemukan jalan ini tidak sportif. <br><br>  Jalan saya sulit dan penuh hiasan.  Tetapi hasilnya adalah perangkat yang mentransmisikan pembacaan air melalui Wi-Fi ke telepon.  Sederhana dan intuitif untuk digunakan dan dikonfigurasi untuk setidaknya seorang siswa sekolah, setidaknya <s>untuk</s> warga negara senior.  Dan akrab dengan kata "Arduino" - juga mudah dibuat.  Perangkat ini dapat berjalan dengan baterai selama empat tahun (lebih lama dari hubungan dengan mantan Anda bertahan).  Ini juga merupakan proyek terbuka pertama dengan karakteristik seperti itu.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Saya menulis</a> analog pabrik, mereka sedikit, dan baik-baik saja dengan mereka. <br><br>  Jadi, kita punya uang dan keinginan besar, tapi jujur ​​untuk menyederhanakan hidup kita tanpa melanggar KUHP.  Dan agar tidak ada satu pun dari 220V Anda, server dan banyak tombol!  Kami melihat bacaan pada smartphone di aplikasi Blynk atau layanan serupa. <br><br>  Sekarang duduklah di kursi, makan lebih banyak roti Prancis lembut ini dan minum teh.  Lihat foto-foto indah dan dengarkan kisah saya tentang apa yang harus dipertimbangkan ketika membuat perangkat yang berdiri sendiri.  Tapi pertama-tama, deskripsi singkat tentang Waterius. <br><a name="habracut"></a><br><h3>  Persyaratan </h3><br><ul><li>  counter dengan kawat (UPD2: <s>output "kontak kering"</s> ) </li><li>  Router Wi-Fi dengan internet </li></ul><br><h3>  Karakteristik </h3><br><ul><li>  Daya: 3 baterai AA </li><li>  waktu kerja 4 tahun atau lebih </li><li>  2 meter air </li><li>  satu tombol untuk mengkonfigurasi </li><li>  memori non-volatile untuk indikasi dan pengaturan jaringan </li></ul><br><h3>  Transfer Harian Wi-Fi </h3><br><ul><li>  bacaan saat ini </li><li>  konsumsi air per hari </li><li>  tegangan suplai </li><li>  email  huruf (isi dan judul dapat diubah) </li></ul><br><br>  Dukungan yang diimplementasikan untuk server TCP dan aplikasi Blynk.  Tambahkan <s>HTTP</s> , <s>MQTT</s> , Modbus TCP, Cayenne, IFTTT, dll.  (Di sini diberikan tempat untuk manifestasi kejeniusan kreatif Anda). <br><br>  UPD2: jenius kreatif belum meluncurkan HTTPS, MQTT <br><br><h2>  Kustomisasi </h2><br>  Ketika tombol Waterius diklik, tombol ini menghidupkan titik akses Wi-Fi.  Hubungkan, isi formulir, membungkuk ke timur tiga kali dan ucapkan "terima kasih" kepada pengembang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">WiFiManager</a> .  Anda bisa secara mental. <br><br><img width="750" src="https://habrastorage.org/webt/du/9k/jn/du9kjni_1m0qlxthmhvagpl1fvg.jpeg" alt="Menyiapkan Waterius menggunakan Wifimanager"><br><br><h2>  Menghibur Elektronik </h2><br>  Sebuah hamburan elemen radio untuk pertemuan Waterius <br><br><img src="https://habrastorage.org/webt/g3/or/q4/g3orq43vvb6jmy2ow3m04n1dldg.jpeg"><br><br>  Satu-satunya cara untuk mencapai unit konsumsi mikro-ampere sambil menghitung pulsa adalah dengan menggunakan mikrokontroler ekonomis, bukan apa yang Anda pikirkan.  Waterius heart - Attiny85 mikrokontroler (analog - MSP430, STM8L).  Itu dijahit tanpa masalah dengan papan Arduino dengan tangan tumbuh di atas pinggang.  Attiny85 beroperasi pada frekuensi 1 MHz dari generator internal dan menghitung pulsa, secara berkala memeriksa 2 input untuk hubungan pendek dan sebuah tombol.  Tidur saat ini <a href="">4 μA pada 3V</a> .  Sebuah dongeng. <br><br>  Sebagai Wi-Fi saya menggunakan ESP8266-01.  Konsumsi selama operasi 75mA, pulsa hingga 250mA.  Dua mikrokontroler berkomunikasi di bus i2c.  Ketepatan pilihan dikonfirmasi oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proyek stasiun cuaca</a> .  ESP8266 selalu dalam mimpi: pin EN ditarik ke GND melalui resistor.  Arus konsumsi kurang dari 10 μA (saya menemukan contoh dengan 0 μA).  Sekali sehari, Attiny85 menghadirkan HIGH, ESP8266 bangun, menerima bacaan dari Attiny85, menghubungkan ke rumah Wi-Fi dan mengirimkan data dalam ~ 4 detik - yang, menurut penelitian oleh para ilmuwan Inggris, jauh lebih cepat daripada yang biasanya Anda dapatkan dengan alat penghitung ini secara manual. <br><br><img align="right" src="https://habrastorage.org/webt/y6/ov/aa/y6ovaaeka77kd0inlhivxv3cd_k.jpeg">  <i>Foto menunjukkan ESP yang baik, konsumsi melonjak 7-11μA.</i>  <i>Biasanya angkanya 19-23μA.</i> <br><br>  Jenis tidur lainnya tidak akan bekerja untuk Waterius, setidaknya taburkan dengan melatonin ke suara lagu pengantar tidur: Tidur nyenyak tak terbatas dengan wake-up instan pada reset eksternal menghabiskan 20 μA dan cocok untuk pengiriman data yang sering.  Pilihan paling ekonomis: matikan ESP8266 sepenuhnya, tetapi Anda akan memerlukan transistor efek medan yang takut pada listrik statis, itu saja. <br><br>  Tombol pengaturan terletak di jalur SCL.  Semua pin Attiny85 sedang sibuk!  Untuk alasan ini, Waterius tidak mendukung output meter Namur dan tidak memiliki sensor kebocoran. <br>  LED terhubung ke pin TX dari ESP dan menyala ketika ESP sedang berjalan.  Sambungkan adaptor TTL-USB untuk melihat log (meskipun menarik!).  Pada awal pengembangan, saya berpikir bahwa untuk mengindikasikan kesalahan, Anda perlu mengedipkan LED, tetapi Anda akan mengaturnya - ini hanya akan memperumit kode. <br>  Jika Anda berhasil terhubung ke router Wi-Fi setelah 3-10 detik, LED akan mati, dan jika terus menyala, sambungkan kembali ponsel Anda ke Waterius.  Teknologi canggih, nanoteknologi, prestasi NASA, ajaran Cina kuno. <br><br>  Kita masing-masing tahu: fitur perangkat berdaya rendah adalah kerentanannya terhadap interferensi elektromagnetik.  Oleh karena itu, saya beralih ke insinyur elektronik yang akrab dan mempelajari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sastra</a> (+ kursus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Murata yang</a> paling indah).  Semua pin pada ESP dan Attiny ditarik ke kekuasaan atau GND.  Kapasitor daya terpasang.  Tanah "kotor" meter terhubung ke "bersih" satu melalui resistor 300 ohm, dan output sendiri melalui resistor 3k3.  Semua orang pasti begitu! <br><br><h3>  Perumahan </h3><br>  Kami mengambil botol plastik ... lelucon.  Saya menggunakan kompartemen untuk 4 baterai AA.  Sebuah lubang dipotong pada penutup untuk konektor, di samping untuk LED dan tombol. <br><br><img src="https://habrastorage.org/webt/yl/dt/e2/yldte2s4juxluytorqdld8eumrs.jpeg"><br><br>  Anda dapat menggunakan kotak persimpangan (dengan printer 3D dan perdukunan lainnya, coba sendiri jika tidak). <br><br>  In <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> adalah papan satu lapis untuk LUT dan papan dua lapis untuk produksi pabrik.  Waterius dapat dibuat bahkan oleh anak sekolah!  Benar, jika dia tidak memiliki hoverboard dan tidak pernah memutar spinner. <br><br>  Papan ideal tidak langsung berfungsi.  Prototipe pertama terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/wd/3c/tw/wd3ctw183ioynjkuqnxhszttjee.jpeg"><br><br>  Tetapi versi keempat, yang dibangun, hampir "sempurna": <br><br><img src="https://habrastorage.org/webt/t3/uw/m4/t3uwm48xqxlcuef8u1nrgq3clkm.jpeg"><br><br>  Saya tidak bisa menolak dan memesan sebungkus papan di Resonite.  Ini tinggi! <br><br><img src="https://habrastorage.org/webt/ok/hm/-n/okhm-nnvs0vnjlpdqiiezw_tts0.jpeg"><br><br><h3>  Nutrisi </h3><br>  Dalam Waterius ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">3V MCP1700</a> stabilizer dengan konsumsi minimum yang sangat rendah (beberapa μA).  Tiga baterai alkaline AA 1.5V <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">akan dapat dilepaskan</a> hampir sepenuhnya ke 3.2 V. Plus, Attiny85 akan memiliki tegangan yang stabil (dan <a href="">frekuensinya</a> akan kurang <a href="">mengambang</a> , yang berdengung, meskipun ini tidak penting dalam proyek ini). <br><br>  Rangkaian ini akan bekerja tanpa stabilizer dari dua baterai AA.  Attiny85 harus membeli versi V (daya hingga 1.8V).  ESP bekerja "di Internet" hingga 2.5V.  Kami akan dapat menggunakan 40% dari kapasitas baterai (jangan percaya - lihat pengujian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">A. Nadezhin</a> ).  Jika Anda membeli dua baterai lithium AA 1.5V 3 Ah, Waterius akan bekerja hingga 10 tahun pada suhu rendah, dan di sana - Anda lihat - dan kami akan membangun komunisme. <br><br>  Kurangnya alat tidak memungkinkan saya untuk mengukur konsumsi Waterius secara akurat.  Dia telah bekerja di rumah selama 45 hari, mengirimkan bacaan setiap 30 menit (untuk mempercepat pembuangan).  Tegangan suplai turun 0,17V dari 4,68V ke 4,51V (UPD: 100 hari 4,38V, UPD2: 313 hari 3,9V).  Jika ini berlangsung, baterai akan bertahan selama 1,5 tahun.  Mengirim bacaan sekali sehari 3 kali lebih ekonomis, jadi 4 tahun bekerja.  Ya, saya tahu tentang baterai self-discharge.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lembar data energizer</a> dan umur simpan pada paket mengatakan itu tidak kuat. <br><br>  Berikut ini adalah perhitungan konsumsi baterai dan biaya komponen untuk yang paling penasaran ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tabel Google</a> ). <br><br><h2>  Detail programer (bagi mereka yang tidak lelah) </h2><br>  Implementasi penghitungan pulsa pada interupsi tidak cocok, karena  air dapat dimatikan pada saat saklar buluh ditutup (zona ~ 3L), dan arus akan mengalir melalui resistor pull-up.  Diperlukan perlindungan dari pantulan kontak: sirkuit mikro atau penundaan kode.  Saya menerapkan jajak pendapat berkala setiap 250 ms dan nilai tambah (kata yang indah, kan?) Hanya dengan penutupan berulang.  Tidak ada yang perlu disolder, meskipun jika Anda benar-benar ingin, maka Anda bisa. <br><br>  Untuk melindungi dari pemuatan ulang Attiny, saya menyimpan semua nilai dalam memori EEPROM-nya.  Untuk melampaui batas 100k entri, saya menulis <a href="">buffer cincin</a> dengan tanda dering untuk sel saat ini.  Sekarang saya tidur nyenyak, itulah yang saya inginkan untuk Anda.  Kode menyediakan untuk masuknya logging untuk debugging.  Hubungkan TTL-USB ke konektor meteran kedua. <br><br><h2>  Ekspor data </h2><br>  Awalnya saya menulis bot Telegram, tetapi Roskomnadzor memblokir Telegram.  Saya harus meninggalkan keputusan ini agar tidak memulai server proxy dan tidak mengganggu.  Menggunakan Blynk ternyata menjadi optimal (pengembang yang tak kenal takut berjuang dengan kunci).  Ini adalah <a href="">kode QR proyek</a> .  Selain dia, proyek Cayenne memiliki aplikasi telepon. <br><br>  Pengiriman otomatis ke Mosvodokanal tidak dilaksanakan, karena  proyek nirlaba, tapi apa tahun-tahun kita.  Atau punyamu.  Saya tidak memiliki sarana untuk memelihara server saya dan "melegitimasi" prosedur pengiriman, tetapi Anda bertanya-tanya dari teman, tiba-tiba ... Saya akan senang atas bantuan dan pikiran bebas Anda. <br><br>  Moskow mengirimkan kesaksian melalui SMS, yang berarti bahwa server web cukup untuk menerima data Waterius dan halaman dengan SMS ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> ).  Pakar Moskow dari program Fiddler, yang menggunakan aplikasi layanan Negara Moskow, harus tertarik pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">skrip Python</a> saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">untuk</a> mengirimkan bacaan air. <br><br><h2>  Pengembangan </h2><br>  Salah satu rem utama ketika membuat produk baru adalah perfeksionisme, seperti yang Anda tahu.  Tidak perlu membuat fungsi baru tanpa memeriksa apakah konsumen membutuhkannya.  Kode sederhana lebih mudah untuk dikembangkan. <br><br>  Jalan menuju perfeksionisme terletak melalui <br><br><ul><li>  Memutakhirkan ESP dan Firmware Attiny melalui Internet </li><li>  UPD2: <s>dukungan untuk HTTPS atau enkripsi</s> </li><li>  server tempat pengguna dapat mengunduh skripnya untuk mengirim pembacaan air. </li><li>  menggunakan STM8L / MSP430 (mereka lebih ekonomis dan lebih banyak pin) </li><li>  UPD2: <s>pemeriksaan visual keberadaan kontak dengan meter ketika terhubung</s> </li><li>  indikasi periode pengiriman email  surat </li><li>  UPD2: <s>dukungan</s> balik <s>untuk keluaran</s> Namur </li><li>  sensor kebocoran (UPD2: dilakukan saat reset) </li><li>  kontrol derek </li><li>  dukungan meteran listrik </li></ul><br><h2>  Ucapan Terima Kasih </h2><br>  Terima kasih kepada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ivan Kovalenko</a> dan Ivan Ganzha untuk saran tentang teknik listrik, Aigul, E. Lapin  untuk pendekatan yang tepat untuk kehidupan dan ayah untuk fakta bahwa saya tidak hanya dapat memprogram, tetapi juga solder, dan untuk Anda - atas perhatian Anda! <br><br><img src="https://habrastorage.org/webt/bi/rs/dg/birsdgh0skpa69dhb-q2mltxffs.jpeg"><br><br>  Saya akan senang dengan saran, kumpulan permintaan dan kritik! <br><br>  Lakukan pemanasan pada solder!  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Proyek Github</a> <br><br>  UPD2 05/07/2019: Terima kasih kepada semua orang yang membantu proyek ini! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id418573/">https://habr.com/ru/post/id418573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id418561/index.html">Mesin negara dalam layanan MVP. Kuliah Yandex</a></li>
<li><a href="../id418563/index.html">Intisari materi menarik untuk pengembang seluler # 263 (23 Juli - 29 Juli)</a></li>
<li><a href="../id418565/index.html">Dalam perjalanan ke cakupan kode 100% dengan tes di Go menggunakan sql-dumper sebagai contoh</a></li>
<li><a href="../id418567/index.html">Dell akan berhenti menjadi perusahaan swasta dan untuk pertama kalinya dalam 5 tahun akan menempatkan saham di bursa saham</a></li>
<li><a href="../id418569/index.html">Satelit baru - bug baru: Sensor inframerah satelit GOES-17 tidak sejuk</a></li>
<li><a href="../id418575/index.html">"Jangan lepas landas": 6 gadget audio yang tidak biasa</a></li>
<li><a href="../id418577/index.html">Kelola bookmark Anda dengan tag - untuk menyenangkan diri sendiri dan kolega Anda</a></li>
<li><a href="../id418579/index.html">Bagaimana perpustakaan lingkungan virtual bekerja</a></li>
<li><a href="../id418581/index.html">React Basics (buku teks, edisi ke-2)</a></li>
<li><a href="../id418585/index.html">Membangun peta lintas negara dari robot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>