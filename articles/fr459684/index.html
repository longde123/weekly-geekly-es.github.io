<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔜 🐕 🏗️ Carte du métro de Moscou et du monde entier pour Android 👂🏿 👂 👩🏾‍🤝‍👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CHAPITRE 1. Ambition 
 Fin février 2018 



 En tant que partisans de l'idéologie du logiciel libre et du marché libre, nous pensons que le monopole e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Carte du métro de Moscou et du monde entier pour Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/involta/blog/459684/"><h3>  CHAPITRE 1. Ambition </h3><br>  <i>Fin février 2018</i> <br><br><img src="https://habrastorage.org/webt/lt/tg/uh/lttguhdjo8ap9vv_i4egmb-7-ma.png"><br><br>  En tant que partisans de l'idéologie du logiciel libre et du marché libre, nous pensons que le monopole est mauvais. <br><br>  Un grand nombre de personnes ont besoin d'une navigation pratique et rapide dans le métro.  Il est étrange qu'il n'y ait pas un seul concurrent valable pour l'application Yandex.Metro.  Nous avons décidé de le créer nous-mêmes, en le faisant pendant notre temps libre comme passe-temps. <br><br>  Equipe: à différents moments de 2 à 4 personnes. <br><br>  L'histoire ne couvre que l'application Android, car elle a été lancée en premier et tous les mécanismes de base y ont été exécutés.  Bien sûr, la version iOS est actuellement disponible. <br><br><h3>  CHAPITRE 2. La route dans l'obscurité </h3><br>  <i>Mars - juin 2018.</i> <br><br>  Besoin d'une carte.  Nous prenons SVG, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">poussons</a> dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SVGView</a> , tout va bien.  Ment terriblement, mais nous sommes joyeux.  Comment dessiner des itinéraires séparés?  Personne ne le sait. <br><br>  Dans le format SVG, il n'y a aucune information sur la superposition, si un élément appartient à une ligne, ou toute autre information qui est absolument nécessaire pour construire un itinéraire.  Nous sommes donc arrivés à utiliser une base de données pour stocker tous les éléments pour le rendu. <br><br>  De plus, nous avions besoin que l'application s'exécute le plus rapidement possible.  L'utilisation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebView</a> disparaît immédiatement, vous avez besoin d'une surface GL.  Nous avons décidé de l'essayer avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SurfaceView</a> (une surface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ouverte</a> qui peut être utilisée comme toile) - ce n'est pas ça.  Il peut apporter des modifications en lui-même, clignotant en noir, car il est simplement mal implémenté et ne peut pas supporter plus la charge que le rendu d'un cube 20x20.  Il peut augmenter et disparaître une fois.  Nous avions besoin d'une solution différente, mais qui ne serait pas si loin de SurfaceView, car elle nous convenait parfaitement sur l'interface. <br><br><img src="https://habrastorage.org/webt/ln/gp/cm/lngpcmo0m8odexmxrwgo9e6wqqk.png" alt="image"><br>  <i>En bref sur les bugs des pilotes Android</i> <br><a name="habracut"></a><br>  Nous avons essayé une implémentation sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TextureView</a> .  Et, oh dieux, la plupart des problèmes ont disparu.  Malgré le fait que TextureView est une SurfaceView sur les stéroïdes, elle est normalement implémentée sans bugs magiques et crises d'épilepsie de l'adaptateur vidéo. <br><br>  Nous avons encore des erreurs de synchronisation des flux et d'ajustement des vues sous la forme d'erreurs de segmentation illisibles, mais c'était mieux qu'un point noir clignotant.  Par conséquent, toute utilisation de View pas comme elle devrait être, oblige à redéfinir presque toutes les méthodes de View elle-même.  Cela était particulièrement problématique avec TextureView car ce composant se compose de 2 parties: Vue et Surface.  Ils ne peuvent pas vivre les uns sans les autres, mais en même temps, ils ne peuvent tout simplement pas envoyer l'événement de mort de Surface dans la vue, c'est pourquoi vous devez effectuer des vérifications manuelles après presque chaque action. <br><br>  Les problèmes ont commencé quand nous avons dû augmenter la vue.  Canvas dessine tout pixel par pixel, donc si nous spécifions une taille de 400x400, alors les éléments de 0 à 400 seront visibles, mais pas à l'extérieur.  400 est très petit, en réalité nous avons besoin d'une carte d'environ 5000x5600 pixels sur de bons appareils.  Mais comment adapter 5000x5600 sur un écran 1920x1080 (16: 9)? <br><br>  Nous créons une carte de toile avec une taille et une échelle qui augmenteront avec la résolution d'écran et diminueront avec une diminution de la résolution d'écran.  Ainsi, nous avons résolu le problème des cartes très grandes et dessinées de manière tortueuse sur des appareils avec un grand écran et des cartes trop petites sur de petits écrans. <br><br>  Lorsque nous avons commencé à tester la carte, il s'est avéré que sur les téléphones ayant la même résolution, la carte s'affiche différemment.  Eh bien, comme autrement: sur l'un, il est affiché, sur le second un point blanc / noir.  Les journaux mènent à un traqueur de bogues Qualcomm à un bogue avec des puces Adreno 330/300 avec le statut 'wontfix'.  Super <br><br>  La seule façon de vaincre ce bug est de sous-estimer la taille de la carte sur les téléphones avec une certaine puce vidéo afin qu'il n'y ait pas de carré blanc à la place de la carte.  Mais comment connaître le modèle de la puce vidéo?  Nous devons créer une GLSurfaceView avec une taille de 1x1 pixel lors du démarrage de l'application, obtenir des informations sur la puce vidéo de celle-ci et ensuite dessiner une carte. <br><br>  "- Mais c'est une béquille."  Oui, c'est une béquille.  C'est une béquille d'une échelle galactique, mais c'est mieux que de couper un grand nombre d'appareils et d'espérer que Qualcomm corrigera le bug de ses pilotes et enverra la mise à jour à tous les OEM afin que nous puissions utiliser la carte sur les téléphones avec ces pilotes tordus.  Grâce à nos utilisateurs, nous avons pu trouver une solution qui fonctionne sur tous les appareils. <br><br><img src="https://habrastorage.org/webt/q7/id/bi/q7idbi3gu4yrpgt6wnwulawnjua.png" alt="image"><br>  <i>Nous avons construit, construit et finalement construit!</i> <br><br>  Une tâche très intéressante était également la superposition d'éléments.  Étant donné que la branche rouge doit être dessinée au-dessus du vert, du vert au-dessus du bleu, du jaune au-dessus du rouge, etc., nous avons entré les numéros de calque et notre application (à première vue simple) est devenue similaire à Adobe Photoshop :) <br><br>  Décidé comment dessiner des itinéraires.  Il fallait maintenant décider comment trouver le meilleur parmi eux.  Pour trouver tous les chemins entre les sommets, nous utilisons l'algorithme Floyd-Warshall, pour trouver le chemin le plus court, nous utilisons l'algorithme Dijkstra, pour des chemins alternatifs l'algorithme Yen.  Toute personne intéressée par les détails, posez des questions dans les commentaires. <br><br><h3>  CHAPITRE 3. La route au soleil </h3><br>  <i>Juin - décembre 2018</i> <br><br>  À ce stade, nous savions déjà quoi faire.  Améliorez le produit.  Nous avons dessiné de nouvelles cartes, ajouté de nouvelles langues, corrigé des bogues, accéléré le travail, amélioré les fonctionnalités, rassemblé les commentaires des utilisateurs et n'avons pas dépensé un centime pour promouvoir l'application. <br><br>  Le 15 juin, nous avons déployé notre application pour la publication, en la complétant par une carte du métro de Saint-Pétersbourg.  Sur cette carte, nous avons décidé de désigner des réservoirs et des ponts.  Un peu plus tard, Yandex a montré une refonte avec une disposition de cartes similaire.  Pas mal, pensons-nous. <br><br><img src="https://habrastorage.org/webt/lt/cc/ru/ltccruhk789nwccr8yp4xorpos0.jpeg" alt="image"><br><br>  Au total, nous avons ajouté 10 villes: Saint-Pétersbourg, Barcelone, Prague, Bakou, Kazan, Kiev, Minsk, Nizhny Novgorod, Samara, Novossibirsk.  En développant une carte du métro de Paris et de New York, les plans - le monde entier. <br><br>  En juillet, un backend a été déployé pour mettre à jour les informations de la station et mettre à jour rapidement les cartes. <br><br>  En septembre, nous avions déjà un produit solide qui pouvait être porté aux masses.  Dans le même temps, nous avons rencontré le développeur de l'application "Metro et MCC - diagrammes de stations" Nikolai.  Dans son application, il a assemblé des diagrammes de stations qui vous permettent de naviguer rapidement et de trouver la sortie souhaitée.  Très cool, mais cette application ne permettait pas de construire un itinéraire et avait une conception dépassée.  Et donc, pour un large public, il s'est avéré plus faible que Yandex.Metro. <br>  Nous avons accepté de mettre en œuvre des conceptions de stations dans notre application, et la direction de l'entreprise a soutenu et financé l'idée.  C'est devenu un tueur de fonctionnalités.  Nos utilisateurs étaient ravis. <br><br>  <i>Janvier - mars 2019</i> <br><br>  Après avoir mené environ 10 expériences avec la page d'application dans Google Play et dépensé 18 (!) Mille roubles en marketing, nous avons placé les applications dans le top 3 de Google Play à la demande du «métro» et du «métro de Moscou». <br><br>  En mars, la version iOS de l'application a été publiée, qui a également été classée avec succès dans le top 5 des magasins d'applications à la demande du métro de Moscou. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Télécharger Android: métro de Moscou - diagrammes de stations, itinéraires, sorties</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Télécharger iOS: plans du métro de Moscou + stations</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459684/">https://habr.com/ru/post/fr459684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459670/index.html">Aller à Amsterdam</a></li>
<li><a href="../fr459672/index.html">Souligner en Python</a></li>
<li><a href="../fr459674/index.html">Threat Intelligence Epic Saga</a></li>
<li><a href="../fr459680/index.html">Suite à Highload ++ Siberia 2019 - 8 tâches Oracle</a></li>
<li><a href="../fr459682/index.html">Qualité des données en stockage</a></li>
<li><a href="../fr459688/index.html">L'urbanisme en Chine: moins de hipsters, plus de science et d'informatique</a></li>
<li><a href="../fr459692/index.html">Comment nous avons découvert des modifications matérielles qui contredisent les principes chimiques établis</a></li>
<li><a href="../fr459694/index.html">Museum DataArt. Déballez et lancez Radio 86RK</a></li>
<li><a href="../fr459696/index.html">Restauration de photos basée sur l'IA</a></li>
<li><a href="../fr459698/index.html">Comment forcer Oracle BI 12c à créer autant de variables de session qu'un programmeur en a besoin?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>