<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘ŠğŸ¾ ğŸ”£ ğŸ‘« è±¡é™æ ‘å’Œç¢°æ’è¯†åˆ« ğŸ§›ğŸ» ğŸµï¸ ğŸŒš</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿™ä¸ªæ˜ŸæœŸå¾ˆçŸ­æš‚ï¼Œåœ¨æ˜ŸæœŸä¸€å’Œæ˜ŸæœŸäºŒï¼Œæˆ‘ç»§ç»­ç ”ç©¶2Dç…§æ˜ç³»ç»Ÿ ã€‚ æˆ‘å‰©ä¸‹çš„æ—¶é—´éƒ½èŠ±åœ¨äº†å››å‰æ ‘çš„å®ç°ä¸Šã€‚ 

 åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†åˆ†äº«æˆ‘çš„å®ç°å’Œåœ¨å…¶è®¾è®¡è¿‡ç¨‹ä¸­å‡ºç°çš„æƒ³æ³•ã€‚ 

 é¦–å…ˆï¼Œæˆ‘éœ€è¦è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆå†³å®šå®æ–½è±¡é™æ ‘ã€‚ 

 å››å‰æ ‘æ˜¯ä¸€ç§ç©ºé—´åˆ†åŒºæ•°æ®ç»“æ„ ã€‚ ä¸å…¶ä»–æ•°æ®ç»“æ„ç›¸æ¯”ï¼Œå®ƒçš„ä¸»è¦ä¼˜ç‚¹æ˜¯é€‚åº”æ€§å¼ºã€‚ åœ¨æ’...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è±¡é™æ ‘å’Œç¢°æ’è¯†åˆ«</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473066/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/59e/237/20a/59e23720a19b3109d80e62c6d2d539a0.gif" alt="å›¾ç‰‡"></div><br> è¿™ä¸ªæ˜ŸæœŸå¾ˆçŸ­æš‚ï¼Œåœ¨æ˜ŸæœŸä¸€å’Œæ˜ŸæœŸäºŒï¼Œæˆ‘ç»§ç»­ç ”ç©¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2Dç…§æ˜ç³»ç»Ÿ</a> ã€‚ æˆ‘å‰©ä¸‹çš„æ—¶é—´éƒ½èŠ±åœ¨äº†å››å‰æ ‘çš„å®ç°ä¸Šã€‚ <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†åˆ†äº«æˆ‘çš„å®ç°å’Œåœ¨å…¶è®¾è®¡è¿‡ç¨‹ä¸­å‡ºç°çš„æƒ³æ³•ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘éœ€è¦è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆå†³å®šå®æ–½è±¡é™æ ‘ã€‚ <br><br> å››å‰æ ‘æ˜¯ä¸€ç§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç©ºé—´åˆ†åŒºæ•°æ®ç»“æ„</a> ã€‚ ä¸å…¶ä»–æ•°æ®ç»“æ„ç›¸æ¯”ï¼Œå®ƒçš„ä¸»è¦ä¼˜ç‚¹æ˜¯é€‚åº”æ€§å¼ºã€‚ åœ¨æ’å…¥ï¼Œåˆ é™¤å’Œæœç´¢æ—¶ï¼Œå®ƒæä¾›äº†è‰¯å¥½çš„æ€§èƒ½ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®ç»å¸¸å˜åŒ–çš„åŠ¨æ€ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨è¯¥æ ‘ã€‚ è€Œä¸”ï¼Œè¿™ç§ç»“æ„å¾ˆå®¹æ˜“ç†è§£å’Œå®ç°ã€‚ <br><br> å¦‚æœç©ºé—´åˆ†åŒºæ˜¯æ‚¨çš„æ–°è¯é¢˜ï¼Œé‚£ä¹ˆæˆ‘å»ºè®®é˜…è¯»Robert Nistromçš„è¿™ç¯‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« </a> ã€‚ å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³è±¡é™æ ‘çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡</a>æˆ–æœ¬æ–‡ã€‚ <br><a name="habracut"></a><br> åœ¨æˆ‘çš„æ¸¸æˆä¸­ï¼Œä½¿ç”¨å››å‰æ ‘å¯ç«‹å³å¸¦æ¥æ”¶ç›Šï¼š <br><br><ul><li> å½“æ£€æµ‹åˆ°ç¢°æ’æ—¶ï¼Œè±¡é™æ ‘æ¯”è›®åŠ›æ³•ï¼ˆæµ‹è¯•æ‰€æœ‰å¯¹ï¼‰è¦æœ‰æ•ˆå¾—å¤šã€‚ ä½†è¿™ä¸æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡ä¸­</a>ç ”ç©¶å„ç§æŠ€æœ¯å’ŒåŸºå‡†ã€‚ ä½†æ˜¯ï¼Œå¯¹äºæˆ‘çš„ç‰©ç†å¼•æ“çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä½¿ç”¨å®ƒã€‚ ä¹Ÿè®¸ä»¥åï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œæˆ‘ä¼šé€‰æ‹©ä¸€ç§æ›´ä¸“ä¸šçš„ç®—æ³•ã€‚ </li><li> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœºæ™¯å›¾ä¸­ï¼Œ</a>æ‰§è¡Œè£å‰ªæ—¶ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨å››å‰æ ‘æœç´¢æ‰€æœ‰å¯è§èŠ‚ç‚¹ã€‚ </li><li> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç…§æ˜ç³»ç»Ÿä¸­ï¼Œ</a>æ‚¨å¯ä»¥ä½¿ç”¨å››å‰æ ‘æ¥æŸ¥æ‰¾ä¸å…‰æºçš„å¯è§å¤šè¾¹å½¢ç›¸äº¤çš„å¢™ã€‚ </li><li> åœ¨AIç³»ç»Ÿä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å››å‰æ ‘æ¥æœç´¢æ‰€æœ‰æ¥è¿‘æœ¬è´¨çš„å¯¹è±¡æˆ–æ•Œäººã€‚ </li><li> ä¾æ­¤ç±»æ¨... </li></ul><br> å¦‚æ‚¨æ‰€è§ï¼Œè±¡é™æ ‘éå¸¸é€šç”¨ã€‚ å®ƒä»¬å°†æ˜¯æ‚¨å·¥å…·ç®±ä¸­å¾ˆå¥½çš„è¡¥å……ã€‚ <br><br> æ–‡ç« ä¸­æ˜¾ç¤ºçš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a>ä¸Š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰¾åˆ°</a> ã€‚ <br><br><h1> åˆæ­¥å‡†å¤‡ </h1><br> åœ¨è¯¦ç»†è¯´æ˜å››å‰æ ‘ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›ç”¨äºå‡ ä½•å›¾å…ƒçš„<code>Vector2</code> ï¼šç”¨äºå®šä¹‰ç‚¹çš„<code>Vector2</code>ç±»å’Œç”¨äºå®šä¹‰çŸ©å½¢çš„<code>Box</code>ç±»ã€‚ ä¸¤è€…éƒ½æ˜¯æ ·æ¿ã€‚ <br><br><h2> çŸ¢é‡2 </h2><br>  <a href=""><code>Vector2</code></a>ç±»<a href=""><code>Vector2</code></a>ç®€å•ã€‚ å®ƒä»…åŒ…å«æ„é€ å‡½æ•°ä»¥åŠ<code>+</code>å’Œ<code>/</code>è¿ç®—ç¬¦ã€‚ è¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vector2</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: T x; T y; <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> Vector2&lt;T&gt;(TX = <span class="hljs-number"><span class="hljs-number">0</span></span>, TY = <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> : x(X), y(Y) { } <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> Vector2&lt;T&gt;&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>+=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vector2&lt;T&gt;&amp; other) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { x += other.x; y += other.y; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> Vector2&lt;T&gt;&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>/=(T t) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { x /= t; y /= t; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> Vector2&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>+(Vector2&lt;T&gt; lhs, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vector2&lt;T&gt;&amp; rhs) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { lhs += rhs; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lhs; } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> Vector2&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>/(Vector2&lt;T&gt; vec, T t) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { vec /= t; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vec; }</code> </pre> <br><h2> åŒ…è£…ç›’ </h2><br>  <a href=""><code>Box</code></a>ç±»å¹¶ä¸å¤æ‚ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Box</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: T left; T top; T width; <span class="hljs-comment"><span class="hljs-comment">// Must be positive T height; // Must be positive constexpr Box(T Left = 0, T Top = 0, T Width = 0, T Height = 0) noexcept : left(Left), top(Top), width(Width), height(Height) { } constexpr Box(const Vector2&lt;T&gt;&amp; position, const Vector2&lt;T&gt;&amp; size) noexcept : left(position.x), top(position.y), width(size.x), height(size.y) { } constexpr T getRight() const noexcept { return left + width; } constexpr T getBottom() const noexcept { return top + height; } constexpr Vector2&lt;T&gt; getTopLeft() const noexcept { return Vector2&lt;T&gt;(left, top); } constexpr Vector2&lt;T&gt; getCenter() const noexcept { return Vector2&lt;T&gt;(left + width / 2, top + height / 2); } constexpr Vector2&lt;T&gt; getSize() const noexcept { return Vector2&lt;T&gt;(width, height); } constexpr bool contains(const Box&lt;T&gt;&amp; box) const noexcept { return left &lt;= box.left &amp;&amp; box.getRight() &lt;= getRight() &amp;&amp; top &lt;= box.top &amp;&amp; box.getBottom() &lt;= getBottom(); } constexpr bool intersects(const Box&lt;T&gt;&amp; box) const noexcept { return !(left &gt;= box.getRight() || getRight() &lt;= box.left || top &gt;= box.getBottom() || getBottom() &lt;= box.top); } };</span></span></code> </pre> <br> å®ƒåŒ…å«ä¸€äº›æœ‰ç”¨çš„å¸æ°”å‰‚ã€‚ <br><br> æ›´æœ‰è¶£çš„æ˜¯ï¼Œå®ƒåŒ…å«ç”¨äºæ£€æŸ¥çŸ©å½¢æ˜¯å¦åœ¨å¦ä¸€ä¸ªçŸ©å½¢å†…çš„containsæ–¹æ³•å’Œç”¨äºæ£€æŸ¥çŸ©å½¢æ˜¯å¦ä¸å¦ä¸€ä¸ªçŸ©å½¢ç›¸äº¤çš„<code>intersects</code>æ–¹æ³•ã€‚ <br><br> å½“æ’å…¥å’Œåˆ é™¤æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>contains</code> ï¼›åœ¨è¯†åˆ«ç›¸äº¤æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç›¸äº¤ã€‚ <br><br><h1> å››å‰æ ‘ </h1><br> è¿™æ˜¯<a href=""><code>Quadtree</code></a>ç±»çš„<a href=""><code>Quadtree</code></a> ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> GetBox, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Equal = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::equal_to&lt;T&gt;, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Float = <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; class Quadtree { <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_convertible_v&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">invoke_result_t</span></span>&lt;GetBox, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;&gt;, Box&lt;Float&gt;&gt;, <span class="hljs-string"><span class="hljs-string">"GetBox must be a callable of signature Box&lt;Float&gt;(const T&amp;)"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_convertible_v&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">invoke_result_t</span></span>&lt;Equal, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;, <span class="hljs-string"><span class="hljs-string">"Equal must be a callable of signature bool(const T&amp;, const T&amp;)"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_arithmetic_v&lt;Float&gt;); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Quadtree(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Box&lt;Float&gt;&amp; box, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GetBox&amp; getBox = GetBox(), <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Equal&amp; equal = Equal()) : mBox(box), mRoot(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_unique&lt;Node&gt;()), mGetBox(getBox), mEqual(equal) { } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> Threshold = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>(<span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> MaxDepth = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Node</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;Node&gt;, <span class="hljs-number"><span class="hljs-number">4</span></span>&gt; children; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T&gt; values; }; Box&lt;Float&gt; mBox; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;Node&gt; mRoot; GetBox mGetBox; Equal mEqual; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isLeaf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Node* node)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(node-&gt;children[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } };</code> </pre> <br> å¦‚æ‚¨æ‰€è§ï¼Œ <code>Quadtree</code>æ˜¯æ¨¡æ¿ç±»ã€‚ è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†ç±»ç”¨äºå„ç§ç›®çš„ï¼Œè¿™æ˜¯æˆ‘åœ¨å¼€å§‹æ—¶è°ˆåˆ°çš„ã€‚ <br><br> æ¨¡æ¿é€‰é¡¹ï¼š <br><br><ul><li>  <code>T</code> ï¼šå°†åŒ…å«åœ¨å››å‰æ ‘ä¸­çš„å€¼çš„ç±»å‹ã€‚  <code>T</code>åº”è¯¥æ˜¯ä¸€ä¸ªç®€å•çš„ç±»ï¼Œå› ä¸ºå®ƒå°†å­˜å‚¨åœ¨å››å‰æ ‘ä¸­ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™åº”è¯¥æ˜¯æŒ‡é’ˆæˆ–å°å‹ç®€å•æ•°æ®ç»“æ„ï¼ˆPODï¼‰ã€‚ </li><li>  <code>GetBox</code> ï¼šå°†åœ¨è¾“å…¥å¤„æ¥æ”¶å€¼å¹¶è¿”å›ä¸€ä¸ªçŸ©å½¢çš„è¢«è°ƒç”¨å¯¹è±¡çš„ç±»å‹ã€‚ </li><li>  <code>Equal</code> ï¼šæ£€æŸ¥ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰çš„è¢«è°ƒç”¨å¯¹è±¡çš„ç±»å‹ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„ç›¸ç­‰è¿ç®—ç¬¦ã€‚ </li><li>  <code>Float</code> ï¼šè®¡ç®—ä¸­ä½¿ç”¨çš„ç®—æœ¯ç±»å‹ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>float</code> ã€‚ </li></ul><br> åœ¨ç±»å®šä¹‰çš„å¼€å¤´ï¼Œæœ‰ä¸‰ä¸ªé™æ€æ–­è¨€ç”¨äºæ£€æŸ¥æ¨¡æ¿å‚æ•°çš„æœ‰æ•ˆæ€§ã€‚ <br><br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹èŠ‚ç‚¹çš„å®šä¹‰ã€‚ ä¸€ä¸ªèŠ‚ç‚¹ä»…å­˜å‚¨æŒ‡å‘å…¶å››ä¸ªå­èŠ‚ç‚¹çš„æŒ‡é’ˆä»¥åŠå…¶ä¸­åŒ…å«çš„å€¼çš„åˆ—è¡¨ã€‚ æˆ‘ä»¬ä¸ä¼šåœ¨å…¶ä¸­å­˜å‚¨å…¶è¾¹ç•Œæ¡†æˆ–æ·±åº¦ï¼Œå®ƒä»¬ä¼šå³æ—¶è®¡ç®—å‡ºæ¥ã€‚ <br><br> æˆ‘å¯¹è¿™ä¸¤ç§æ–¹æ³•è¿›è¡Œäº†åŸºå‡†æµ‹è¯•ï¼ˆä¿ç•™å…·æœ‰æ·±åº¦çš„çŸ©å½¢è€Œæ²¡æœ‰ä¿ç•™çŸ©å½¢ï¼‰ï¼Œå¹¶ä¸”åœ¨è¿›è¡ŒåŠ¨æ€è®¡ç®—æ—¶æœªå‘ç°ä»»ä½•æ€§èƒ½ä¸‹é™ã€‚ è€Œä¸”ï¼Œå®ƒèŠ‚çœäº†ä¸€ç‚¹å†…å­˜ã€‚ <br><br> ä¸ºäº†èƒ½å¤Ÿå°†å†…éƒ¨èŠ‚ç‚¹ä¸å·¥ä½œè¡¨åŒºåˆ†å¼€ï¼Œ <code>isLeaf</code>æ–¹æ³•ã€‚ å®ƒåªæ˜¯æ£€æŸ¥ç¬¬ä¸€ä¸ªå­©å­ä¸ä¸ºç©ºã€‚ ç”±äºnullè¦ä¹ˆæ˜¯æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œè¦ä¹ˆéƒ½ä¸æ˜¯ï¼Œå› æ­¤ä»…æ£€æŸ¥ç¬¬ä¸€ä¸ªå°±è¶³å¤Ÿäº†ã€‚ <br><br> ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>Quadtree</code>æˆå‘˜<code>Quadtree</code> ï¼š <br><br><ul><li>  <code>mBox</code>æ˜¯ä¸€ä¸ªå…¨å±€è¾¹ç•Œæ¡†ã€‚ æ’å…¥å››å‰æ ‘çš„æ‰€æœ‰å€¼éƒ½å¿…é¡»åŒ…å«åœ¨å…¶ä¸­ã€‚ </li><li>  <code>mRoot</code>æ˜¯å››å‰æ ‘çš„æ ¹ã€‚ </li><li>  <code>mGetBox</code>æ˜¯è¢«è°ƒç”¨çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥å¯¹è±¡ä»å€¼ä¸­è·å–çŸ©å½¢ã€‚ </li><li>  <code>mEqual</code>æ˜¯è¢«è°ƒç”¨çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥éªŒè¯ä¸¤ä¸ªå€¼çš„ç›¸ç­‰æ€§ã€‚ </li></ul><br> æ„é€ å‡½æ•°åªéœ€è®¾ç½®<code>mBox</code> ï¼Œ <code>mGetBox</code>å’Œ<code>mEqual</code> ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹ã€‚ <br><br> æˆ‘ä»¬å°šæœªè®¨è®ºçš„æœ€åä¸¤ä¸ªå‚æ•°æ˜¯<code>Threshold</code>å’Œ<code>MaxDepth</code> ã€‚  <code>Threshold</code>æ˜¯èŠ‚ç‚¹é™¤ä»¥ä¹‹å‰å¯ä»¥åŒ…å«çš„æœ€å¤§å€¼æ•°ã€‚  <code>MaxDepth</code>æ˜¯èŠ‚ç‚¹çš„æœ€å¤§æ·±åº¦ï¼Œæˆ‘ä»¬å°†åœæ­¢å°è¯•æ‹†åˆ†<code>MaxDepth</code>ä¸Šçš„èŠ‚ç‚¹ï¼Œå› ä¸ºå¦‚æœæ‹†åˆ†è¿‡å¤šï¼Œåˆ™ä¼šå½±å“æ€§èƒ½ã€‚ æˆ‘ä¸ºè¿™äº›å¸¸æ•°æä¾›äº†é€‚åˆå¤§å¤šæ•°æƒ…å†µçš„åˆç†å€¼ã€‚ æ‚¨å¯ä»¥å°è¯•é’ˆå¯¹æ‚¨çš„é…ç½®ä¼˜åŒ–å®ƒä»¬ã€‚ <br><br> ç°åœ¨æˆ‘ä»¬å‡†å¤‡å¼€å§‹æ›´å¤šæœ‰è¶£çš„æ“ä½œã€‚ <br><br><h1> æ’å…¥å’Œåˆ é™¤ </h1><br> åœ¨æ˜¾ç¤ºæ’å…¥ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è®¨è®ºå“ªäº›èŠ‚ç‚¹å°†åŒ…å«å€¼ã€‚ æœ‰ä¸¤ç§ç­–ç•¥ï¼š <br><br><ul><li> å€¼ä»…å­˜å‚¨åœ¨å¶å­ä¸­ã€‚ ç”±äºå€¼çš„è¾¹ç•Œæ¡†å¯ä»¥ä¸å¤šä¸ªå¶å­äº¤äº’ï¼Œå› æ­¤è¯¥å€¼å°†å­˜å‚¨åœ¨æ‰€æœ‰è¿™äº›å¶å­ä¸­ã€‚ </li><li> å€¼å¯ä»¥å­˜å‚¨åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸­ã€‚ æˆ‘ä»¬å°†å€¼å­˜å‚¨åœ¨å®Œå…¨åŒ…å«å…¶è¾¹ç•Œæ¡†çš„æœ€å°èŠ‚ç‚¹ä¸­ã€‚ </li></ul><br> å¦‚æœè¾¹ç•ŒçŸ©å½¢å¾ˆå°å¹¶ä¸”å¤§å°è¿‘ä¼¼ç›¸åŒï¼Œåˆ™åœ¨å¯»æ‰¾ç›¸äº¤ç‚¹æ—¶ç¬¬ä¸€ç§ç­–ç•¥ä¼šæ›´æœ‰æ•ˆã€‚ ä½†æ˜¯ï¼Œå¦‚æœå­˜åœ¨è¾ƒå¤§çš„çŸ©å½¢ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°æ€§èƒ½ä¸‹é™çš„ç®€å¹¶æƒ…å†µã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ’å…¥ä¸€ä¸ªçŸ©å½¢åœ¨å…¨å±€è¾¹ç•Œæ¡†ä¸­çš„å€¼ï¼Œå®ƒå°†è¢«æ·»åŠ åˆ°æ‰€æœ‰å¶å­ä¸­ã€‚ è€Œä¸”ï¼Œå¦‚æœæˆ‘ä»¬ä¸ºè¿™äº›å€¼æ’å…¥<code>Threshold</code>å€¼ï¼Œåˆ™æ‰€æœ‰èŠ‚ç‚¹å°†è¢«åˆ†å‰²ï¼Œç›´åˆ°è¾¾åˆ°<code>MaxDepth</code>ä¸”å€¼ä¸åœ¨æ‰€æœ‰å¶å­ä¸­ä¸ºæ­¢ã€‚ å› æ­¤ï¼Œå››å‰æ ‘å°†åŒ…å« <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>t</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x9608;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x503C;</mo></mrow></mrow><mtext mathcolor=&quot;red&quot;>\&amp;#x4E58;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x4EE5;</mo></mrow><msup><mn>4</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>t</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>M</mi><mi>a</mi><mi>x</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi></mrow></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="29.313ex" height="3.021ex" viewBox="0 -987.6 12620.8 1300.8" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-74" x="1650" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-74" x="2012" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-74" x="2373" y="0"></use><g transform="translate(2735,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">é˜ˆ</text><g transform="translate(829,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">å€¼</text></g></g><g fill="red" stroke="red" transform="translate(4394,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">ä¹˜</text></g></g><g transform="translate(5725,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">ä»¥</text></g><g transform="translate(6555,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMAIN-34" x="0" y="0"></use><g transform="translate(500,404)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-74" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-65" x="715" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-78" x="1181" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-74" x="1754" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-74" x="2115" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-74" x="2477" y="0"></use><g transform="translate(2007,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-4D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-61" x="1051" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-78" x="1581" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-44" x="2153" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-65" x="2982" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-70" x="3448" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-74" x="3952" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/473066/&amp;usg=ALkJrhh_nm-wd_8i6XjNIPeSVpN4gn4LWQ#MJMATHI-68" x="4313" y="0"></use></g></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>t</mi><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo>é˜ˆ</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>å€¼</mo></mrow></mrow><mtext mathcolor="red">\ä¹˜</mtext><mrow class="MJX-TeXAtom-ORD"><mo>ä»¥</mo></mrow><msup><mn>4</mn><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>t</mi><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>M</mi><mi>a</mi><mi>x</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi></mrow></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-1"> \ texttt {é˜ˆå€¼} \ä¹˜ä»¥4 ^ {\ texttt {MaxDepth}} </script> æ„æ€ï¼Œè¿™â€¦â€¦å¾ˆå¤šã€‚ <br><br> æ­¤å¤–ï¼Œé‡‡ç”¨ç¬¬ä¸€ç§ç­–ç•¥æ—¶ï¼Œæ’å…¥å’Œåˆ é™¤æ“ä½œä¼šç¨æ…¢ä¸€äº›ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»æ’å…¥ï¼ˆæˆ–åˆ é™¤ï¼‰ä¸è¯¥å€¼ç›¸äº¤çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘å°†ä½¿ç”¨ç¬¬äºŒç§ç­–ç•¥ï¼Œå…¶ä¸­æ²¡æœ‰ç®€å¹¶çš„æ¡ˆä¾‹ã€‚ ç”±äºæˆ‘è®¡åˆ’åœ¨å„ç§æƒ…å†µä¸‹ä½¿ç”¨å››å‰æ ‘ï¼Œå› æ­¤ä¼šæ›´åŠ æ–¹ä¾¿ã€‚ å¦å¤–ï¼Œæ­¤ç­–ç•¥æ›´é€‚ç”¨äºåŠ¨æ€ä¸Šä¸‹æ–‡ï¼Œåœ¨è¯¥ä¸Šä¸‹æ–‡ä¸­ï¼Œä¾‹å¦‚ï¼Œåœ¨ç§»åŠ¨å®ä½“çš„ç‰©ç†å¼•æ“ä¸­ï¼Œæ‰§è¡Œäº†è®¸å¤šæ’å…¥å’Œåˆ é™¤æ“ä½œä»¥æ›´æ–°å€¼ã€‚ <br><br> ä¸ºäº†æ‰¾å‡ºè¦åœ¨å“ªä¸ªèŠ‚ç‚¹ä¸­æ’å…¥æˆ–åˆ é™¤å€¼ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªè¾…åŠ©å‡½æ•°ã€‚ <br><br> ç¬¬ä¸€ä¸ªæ˜¯<code>computeBox</code> ï¼Œå®ƒé€šè¿‡çˆ¶èŠ‚ç‚¹çš„çŸ©å½¢åŠå…¶è±¡é™çš„ç´¢å¼•æ¥è®¡ç®—å­èŠ‚ç‚¹çš„çŸ©å½¢ã€‚ <br><br><pre> <code class="cpp hljs">Box&lt;Float&gt; computeBox(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Box&lt;Float&gt;&amp; box, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> origin = box.getTopLeft(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> childSize = box.getSize() / <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;Float&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (i) { <span class="hljs-comment"><span class="hljs-comment">// North West case 0: return Box&lt;Float&gt;(origin, childSize); // Norst East case 1: return Box&lt;Float&gt;(Vector2&lt;Float&gt;(origin.x + childSize.x, origin.y), childSize); // South West case 2: return Box&lt;Float&gt;(Vector2&lt;Float&gt;(origin.x, origin.y + childSize.y), childSize); // South East case 3: return Box&lt;Float&gt;(origin + childSize, childSize); default: assert(false &amp;&amp; "Invalid child index"); return Box&lt;Float&gt;(); } }</span></span></code> </pre> <br> ç¬¬äºŒä¸ª<code>getQuadrant</code>è¿”å›å€¼æ‰€åœ¨çš„è±¡é™ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getQuadrant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Box&lt;Float&gt;&amp; nodeBox, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Box&lt;Float&gt;&amp; valueBox)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> center = nodeBox.getCenter(); <span class="hljs-comment"><span class="hljs-comment">// West if (valueBox.getRight() &lt; center.x) { // North West if (valueBox.getBottom() &lt; center.y) return 0; // South West else if (valueBox.top &gt;= center.y) return 2; // Not contained in any quadrant else return -1; } // East else if (valueBox.left &gt;= center.x) { // North East if (valueBox.getBottom() &lt; center.y) return 1; // South East else if (valueBox.top &gt;= center.y) return 3; // Not contained in any quadrant else return -1; } // Not contained in any quadrant else return -1; }</span></span></code> </pre> <br> å¦‚æœæœªåŒ…å«åœ¨ä»»ä½•è±¡é™ä¸­ï¼Œåˆ™è¿”å›<code>-1</code> ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡è€ƒè™‘æ’å…¥å’Œåˆ é™¤æ–¹æ³•ã€‚ <br><br><h2> æ’å…¥ </h2><br>  <code>add</code>æ–¹æ³•åªæ˜¯è°ƒç”¨ä¸€ä¸ªç§æœ‰å¸®åŠ©å™¨æ–¹æ³•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value)</span></span></span><span class="hljs-function"> </span></span>{ add(mRoot.get(), <span class="hljs-number"><span class="hljs-number">0</span></span>, mBox, value); }</code> </pre> <br> è¿™æ˜¯è¾…åŠ©æ–¹æ³•ä»£ç ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node* node, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> depth, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Box&lt;Float&gt;&amp; box, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value)</span></span></span><span class="hljs-function"> </span></span>{ assert(node != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); assert(box.contains(mGetBox(value))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isLeaf(node)) { <span class="hljs-comment"><span class="hljs-comment">// Insert the value in this node if possible if (depth &gt;= MaxDepth || node-&gt;values.size() &lt; Threshold) node-&gt;values.push_back(value); // Otherwise, we split and we try again else { split(node, box); add(node, depth, box, value); } } else { auto i = getQuadrant(box, mGetBox(value)); // Add the value in a child if the value is entirely contained in it if (i != -1) add(node-&gt;children[static_cast&lt;std::size_t&gt;(i)].get(), depth + 1, computeBox(box, i), value); // Otherwise, we add the value in the current node else node-&gt;values.push_back(value); } }</span></span></code> </pre> <br> æœ€åˆï¼Œæœ‰ä¸¤ä¸ªå‡è®¾å¯ä»¥éªŒè¯æˆ‘ä»¬æ²¡æœ‰åšä»»ä½•ä¸åˆé€»è¾‘çš„äº‹æƒ…ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬æ²¡æœ‰åœ¨ä¸åŒ…å«è¾¹ç•Œæ¡†çš„èŠ‚ç‚¹ä¸­æ’å…¥å€¼ã€‚ <br><br> ç„¶åï¼Œå¦‚æœèŠ‚ç‚¹æ˜¯ä¸€ä¸ªå·¥ä½œè¡¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æ’å…¥ä¸€ä¸ªæ–°å€¼ï¼Œå³ æˆ‘ä»¬å°šæœªè¾¾åˆ°<code>MaxDepth</code>æˆ–<code>Threshold</code> ï¼Œæ‰§è¡Œæ’å…¥ã€‚ å¦åˆ™ï¼Œæˆ‘ä»¬å…±äº«æ­¤èŠ‚ç‚¹ï¼Œç„¶åé‡è¯•ã€‚ <br><br> å¦‚æœèŠ‚ç‚¹åœ¨å†…éƒ¨ï¼Œåˆ™æˆ‘ä»¬å°†è®¡ç®—åŒ…å«è¯¥å€¼è¾¹ç•Œæ¡†çš„è±¡é™ã€‚ å¦‚æœå®ƒå®Œå…¨åŒ…å«åœ¨å­èŠ‚ç‚¹ä¸­ï¼Œåˆ™è¿›è¡Œé€’å½’è°ƒç”¨ã€‚ å¦åˆ™ï¼Œè¯·æ’å…¥è¯¥èŠ‚ç‚¹ã€‚ <br><br> è¿™æ˜¯åˆ†ç¦»è¿‡ç¨‹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">split</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node* node, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Box&lt;Float&gt;&amp; box)</span></span></span><span class="hljs-function"> </span></span>{ assert(node != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); assert(isLeaf(node) &amp;&amp; <span class="hljs-string"><span class="hljs-string">"Only leaves can be split"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Create children for (auto&amp; child : node-&gt;children) child = std::make_unique&lt;Node&gt;(); // Assign values to children auto newValues = std::vector&lt;T&gt;(); // New values for this node for (const auto&amp; value : node-&gt;values) { auto i = getQuadrant(box, mGetBox(value)); if (i != -1) node-&gt;children[static_cast&lt;std::size_t&gt;(i)]-&gt;values.push_back(value); else newValues.push_back(value); } node-&gt;values = std::move(newValues); }</span></span></code> </pre> <br> æˆ‘ä»¬åˆ›å»ºå››ä¸ªå­èŠ‚ç‚¹ï¼Œç„¶åå¯¹äºçˆ¶èŠ‚ç‚¹çš„æ¯ä¸ªå€¼ï¼Œæˆ‘ä»¬å†³å®šåº”å°†å€¼å­˜å‚¨åœ¨å“ªä¸ªèŠ‚ç‚¹ï¼ˆå­èŠ‚ç‚¹æˆ–çˆ¶èŠ‚ç‚¹ï¼‰ä¸­ã€‚ <br><br><h2> åˆ æ‰ </h2><br>  <code>remove</code>æ–¹æ³•è¿˜ç®€å•åœ°è°ƒç”¨ä¸€ä¸ªè¾…åŠ©æ–¹æ³•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value)</span></span></span><span class="hljs-function"> </span></span>{ remove(mRoot.get(), <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, mBox, value); }</code> </pre> <br> è¿™æ˜¯å¸®åŠ©ç¨‹åºæ–¹æ³•ä»£ç ï¼Œå®ƒä¸æ’å…¥ä»£ç éå¸¸ç›¸ä¼¼ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node* node, Node* parent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Box&lt;Float&gt;&amp; box, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value)</span></span></span><span class="hljs-function"> </span></span>{ assert(node != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); assert(box.contains(mGetBox(value))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isLeaf(node)) { <span class="hljs-comment"><span class="hljs-comment">// Remove the value from node removeValue(node, value); // Try to merge the parent if (parent != nullptr) tryMerge(parent); } else { // Remove the value in a child if the value is entirely contained in it auto i = getQuadrant(box, mGetBox(value)); if (i != -1) remove(node-&gt;children[static_cast&lt;std::size_t&gt;(i)].get(), node, computeBox(box, i), value); // Otherwise, we remove the value from the current node else removeValue(node, value); } }</span></span></code> </pre> <br> å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå·¥ä½œè¡¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä»å½“å‰èŠ‚ç‚¹çš„å€¼åˆ—è¡¨ä¸­åˆ é™¤è¯¥å€¼ <br> å¹¶å°è¯•å°†æ­¤èŠ‚ç‚¹ä¸å§å¦¹èŠ‚ç‚¹åŠå…¶çˆ¶èŠ‚ç‚¹åˆå¹¶ã€‚ å¦åˆ™ï¼Œæˆ‘ä»¬ç¡®å®šè¯¥å€¼çš„è¾¹ç•Œæ¡†ä½äºå“ªä¸ªè±¡é™ä¸­ã€‚ å¦‚æœå®ƒå®Œå…¨åŒ…å«åœ¨å­èŠ‚ç‚¹ä¸­ï¼Œåˆ™æˆ‘ä»¬è¿›è¡Œé€’å½’è°ƒç”¨ã€‚ å¦åˆ™ï¼Œä»å½“å‰èŠ‚ç‚¹çš„å€¼ä¸­åˆ é™¤ã€‚ <br><br> ç”±äºæˆ‘ä»¬ä¸åœ¨ä¹èŠ‚ç‚¹ä¸­å­˜å‚¨çš„å€¼çš„é¡ºåºï¼Œå› æ­¤åœ¨æ“¦é™¤æ—¶ï¼Œæˆ‘ä¼šè¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼šæˆ‘åªæ›´æ”¹äº†æœ€åä¸€ä¸ªå€¼ï¼Œç„¶åå°†å…¶åˆ é™¤ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node* node, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Find the value in node-&gt;values auto it = std::find_if(std::begin(node-&gt;values), std::end(node-&gt;values), [this, &amp;value](const auto&amp; rhs){ return mEqual(value, rhs); }); assert(it != std::end(node-&gt;values) &amp;&amp; "Trying to remove a value that is not present in the node"); // Swap with the last element and pop back *it = std::move(node-&gt;values.back()); node-&gt;values.pop_back(); }</span></span></code> </pre> <br> æˆ‘ä»¬è¿˜éœ€è¦çœ‹ä¸€ä¸‹<code>tryMerge</code> ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tryMerge</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node* node)</span></span></span><span class="hljs-function"> </span></span>{ assert(node != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); assert(!isLeaf(node) &amp;&amp; <span class="hljs-string"><span class="hljs-string">"Only interior nodes can be merged"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> nbValues = node-&gt;values.size(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; child : node-&gt;children) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isLeaf(child.get())) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; nbValues += child-&gt;values.size(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nbValues &lt;= Threshold) { node-&gt;values.reserve(nbValues); <span class="hljs-comment"><span class="hljs-comment">// Merge the values of all the children for (const auto&amp; child : node-&gt;children) { for (const auto&amp; value : child-&gt;values) node-&gt;values.push_back(value); } // Remove the children for (auto&amp; child : node-&gt;children) child.reset(); } }</span></span></code> </pre> <br>  <code>tryMerge</code>éªŒè¯æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æ˜¯å¶å­ï¼Œå¹¶ä¸”å…¶å€¼çš„æ€»æ•°å’Œå­èŠ‚ç‚¹çš„å€¼å‡å°äºé˜ˆå€¼ã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™æˆ‘ä»¬å°†æ‰€æœ‰å€¼ä»å­èŠ‚ç‚¹å¤åˆ¶åˆ°å½“å‰èŠ‚ç‚¹å¹¶åˆ é™¤å­èŠ‚ç‚¹ã€‚ <br><br><h1> äº¤å‰å£æœç´¢ </h1><br><h2> çŸ©å½¢ç›¸äº¤ </h2><br> æœ€åï¼Œæˆ‘ä»¬å¾—åˆ°äº†æœ€æœ‰è¶£çš„ä¸œè¥¿ï¼šå¯»æ‰¾ç›¸äº¤ç‚¹ã€‚ ç¬¬ä¸€ç§ä½¿ç”¨æ–¹æ³•æ˜¯è·å–ä¸ç»™å®šçŸ©å½¢ç›¸äº¤çš„æ‰€æœ‰å€¼ã€‚ ä¾‹å¦‚ï¼Œéœ€è¦æ‰§è¡Œè£å‰ªã€‚ <br><br> è¿™å°†<code>query</code>æ¥<code>query</code> ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T&gt; query(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Box&lt;Float&gt;&amp; box) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> values = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T&gt;(); query(mRoot.get(), mBox, box, values); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> values; }</code> </pre> <br> åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åªéœ€é€‰æ‹©<code>std::vector</code> ï¼Œå®ƒå°†åŒ…å«ä¸è¾¹ç•Œæ¡†ç›¸äº¤çš„å€¼ï¼Œç„¶åè°ƒç”¨helperæ–¹æ³•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">query</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node* node, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Box&lt;Float&gt;&amp; box, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Box&lt;Float&gt;&amp; queryBox, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;T&gt;&amp; values)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ assert(node != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); assert(queryBox.intersects(box)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; value : node-&gt;values) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (queryBox.intersects(mGetBox(value))) values.push_back(value); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isLeaf(node)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> i = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); i &lt; node-&gt;children.size(); ++i) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> childBox = computeBox(box, <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(i)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (queryBox.intersects(childBox)) query(node-&gt;children[i].get(), childBox, queryBox, values); } } }</code> </pre> <br> é¦–å…ˆï¼Œæˆ‘ä»¬å°†å­˜å‚¨åœ¨å½“å‰èŠ‚ç‚¹ä¸­ä¸æ‰€è¯·æ±‚çŸ©å½¢ç›¸äº¤çš„æ‰€æœ‰å€¼ç›¸åŠ ã€‚ ç„¶åï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹åœ¨å†…éƒ¨ï¼Œåˆ™å¯¹è¾¹ç•ŒçŸ©å½¢ä¸è¯·æ±‚çš„çŸ©å½¢ç›¸äº¤çš„æ¯ä¸ªå­èŠ‚ç‚¹è¿›è¡Œé€’å½’è°ƒç”¨ã€‚ <br><br><h2> æ‰€æœ‰æˆå¯¹ç›¸äº¤ </h2><br> ç¬¬äºŒä¸ªå—æ”¯æŒçš„ç”¨ä¾‹æ˜¯æœç´¢ç›¸äº¤çš„è±¡é™æ ‘ä¸­å­˜å‚¨çš„æ‰€æœ‰å€¼å¯¹ã€‚ è¿™åœ¨åˆ›å»ºç‰©ç†å¼•æ“æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ å¯ä»¥ä½¿ç”¨<code>query</code>æ–¹æ³•è§£å†³æ­¤é—®é¢˜ã€‚ å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰å€¼çš„è¾¹ç•Œæ¡†ä¸Šè°ƒç”¨<code>query</code> ã€‚ ä½†æ˜¯ï¼Œé€šè¿‡ä¸ºä¸€å¯¹ä»…æ·»åŠ ä¸€ä¸ªäº¤å‰ç‚¹å¯ä»¥æ›´æœ‰æ•ˆåœ°å®Œæˆæ­¤æ“ä½œï¼ˆé€šè¿‡<code>query</code>æˆ‘ä»¬å°†å‘ç°å®ƒä»¬ä¸¤æ¬¡ï¼‰ã€‚ <br><br> è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ç›¸äº¤åªèƒ½å‘ç”Ÿ <br><br><ul><li> ä¸€ä¸ªèŠ‚ç‚¹ä¸­å­˜å‚¨çš„ä¸¤ä¸ªå€¼ä¹‹é—´ </li></ul><br> æˆ– <br><br><ul><li> åœ¨èŠ‚ç‚¹ä¸­å­˜å‚¨çš„å€¼å’Œæ­¤èŠ‚ç‚¹çš„åä»£ä¸­å­˜å‚¨çš„å¦ä¸€ä¸ªå€¼ä¹‹é—´ã€‚ </li></ul><br> å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦æ£€æŸ¥ä»¥ä¸‹é¡¹ä¹‹é—´çš„äº¤é›†ï¼š <br><br><ul><li> å€¼å’Œä»¥ä¸‹å€¼å­˜å‚¨åœ¨åŒä¸€èŠ‚ç‚¹ä¸­ </li></ul><br> å’Œ <br><br><ul><li> å€¼å’Œå­˜å‚¨åœ¨åä»£ä¸­çš„å€¼ã€‚ </li></ul><br> å› æ­¤ï¼Œæˆ‘ä»¬ç»å¯¹ä¸ä¼šä¸¤æ¬¡æŠ¥å‘Šâ€‹â€‹åŒä¸€è·¯å£ã€‚ <br><br> è¿™æ˜¯<code>findAllIntersections</code>ä»£ç ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::pair&lt;T, T&gt;&gt; findAllIntersections() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> intersections = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::pair&lt;T, T&gt;&gt;(); findAllIntersections(mRoot.get(), intersections); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> intersections; }</code> </pre> <br> åŒæ ·ï¼Œæˆ‘ä»¬åªéœ€åˆ†é…<code>std::vector</code>æ¥å­˜å‚¨äº¤é›†å¹¶è°ƒç”¨helperå‡½æ•°ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAllIntersections</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node* node, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::pair&lt;T, T&gt;&gt;&amp; intersections)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Find intersections between values stored in this node // Make sure to not report the same intersection twice for (auto i = std::size_t(0); i &lt; node-&gt;values.size(); ++i) { for (auto j = std::size_t(0); j &lt; i; ++j) { if (mGetBox(node-&gt;values[i]).intersects(mGetBox(node-&gt;values[j]))) intersections.emplace_back(node-&gt;values[i], node-&gt;values[j]); } } if (!isLeaf(node)) { // Values in this node can intersect values in descendants for (const auto&amp; child : node-&gt;children) { for (const auto&amp; value : node-&gt;values) findIntersectionsInDescendants(child.get(), value, intersections); } // Find intersections in children for (const auto&amp; child : node-&gt;children) findAllIntersections(child.get(), intersections); } }</span></span></code> </pre> <br> åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œæ£€æŸ¥å­˜å‚¨åœ¨å½“å‰èŠ‚ç‚¹ä¸­çš„å€¼ä¹‹é—´çš„äº¤é›†ã€‚ ç„¶åï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯å†…éƒ¨èŠ‚ç‚¹ï¼Œåˆ™<code>findIntersectionInDescendants</code>æ£€æŸ¥æ­¤èŠ‚ç‚¹ä¸­å­˜å‚¨çš„å€¼ä¸å…¶åä»£ä¸­å­˜å‚¨çš„å€¼ä¹‹é—´çš„äº¤é›†ã€‚ æœ€åï¼Œæˆ‘ä»¬è¿›è¡Œé€’å½’è°ƒç”¨ã€‚ <br><br>  <code>findIntersectionsInDescendants</code>é€’å½’æŸ¥æ‰¾ç»™å®šå€¼ä¸å­æ ‘ä¸­å­˜å‚¨çš„æ‰€æœ‰å€¼ä¹‹é—´çš„äº¤ç‚¹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findIntersectionsInDescendants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node* node, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::pair&lt;T, T&gt;&gt;&amp; intersections)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Test against the values stored in this node for (const auto&amp; other : node-&gt;values) { if (mGetBox(value).intersects(mGetBox(other))) intersections.emplace_back(value, other); } // Test against values stored into descendants of this node if (!isLeaf(node)) { for (const auto&amp; child : node-&gt;children) findIntersectionsInDescendants(child.get(), value, intersections); } }</span></span></code> </pre> <br> ä»…æ­¤è€Œå·²ï¼ æˆ‘é‡å¤ä¸€éï¼Œæ‰€æœ‰ä»£ç éƒ½å‘å¸ƒåœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Š</a> ã€‚ <br><br><h1> æœ‰ç”¨çš„èµ„æº </h1><br> å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³ç¢°æ’è¯†åˆ«å’Œåˆ†åŒºæ•°æ®ç»“æ„çš„æ›´å¤šä¿¡æ¯ï¼Œå»ºè®®é˜…è¯»Christer Erickson <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®æ—¶ç¢°æ’æ£€æµ‹çš„ä¹¦</a> ã€‚ ä¹¦ä¸­æ·±åˆ»åœ°æ­ç¤ºäº†è®¸å¤šä¸»é¢˜ï¼ŒåŒæ—¶ï¼Œæœ¬ä¹¦ä»¥ä¸€ç§éå¸¸æ˜“æ‡‚çš„è¯­è¨€ç¼–å†™ã€‚ æ­¤å¤–ï¼Œå„ç« å¯ä»¥å•ç‹¬é˜…è¯»ã€‚ è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒèµ„æ–™ã€‚ <br><br><h1> ç»“è®º </h1><br> è¿™æ ·å°±å®Œæˆäº†ç¢°æ’è¯†åˆ«çš„å·¥ä½œã€‚ ä½†æ˜¯ï¼Œå®ƒåªæ˜¯ç‰©ç†å¼•æ“çš„ä¸€åŠã€‚ ååŠéƒ¨åˆ†æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§£å†³å†²çªçš„æ–¹æ³•</a> ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN473066/">https://habr.com/ru/post/zh-CN473066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN473056/index.html">çˆ±ä¸½ä¸å¦‚ä½•ä»ç…§ç‰‡ä¸­è¯†åˆ«å›½å®¶ã€‚ Yandexç ”ç©¶</a></li>
<li><a href="../zh-CN473058/index.html">Sergey Sinitsynï¼šâ€œ OSMä¸ä»…ä»…æ˜¯ç»˜åˆ¶æˆ¿å±‹æˆ–è½¨é“ã€‚ è¿™äº›éƒ½æ˜¯æ›´å¤šçš„æ•…äº‹ï¼â€</a></li>
<li><a href="../zh-CN473060/index.html">å›¢é˜Ÿä¸­çš„éæ­£å¼å…³ç³»ï¼šä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•ç®¡ç†å®ƒä»¬</a></li>
<li><a href="../zh-CN473062/index.html">ä¸ä»…é€‚ç”¨äºMozilla Firefoxçš„ä¸»è§‚user.js</a></li>
<li><a href="../zh-CN473064/index.html">å·´è¾¾ç»´äºšçš„çœ¼æ³ªï¼Œæ±½è½¦å’Œå¤§çŒ©çŒ©ç»ç’ƒï¼šå…³äºæŸäº›ç±»å‹çš„å¼ºåŒ–ç»ç’ƒ</a></li>
<li><a href="../zh-CN473070/index.html">Redux-ä¸éœ€è¦ï¼ åœ¨Reactä¸­æ›¿æ¢ä¸ºuseContextå’ŒuseReducerï¼Ÿ</a></li>
<li><a href="../zh-CN473072/index.html">Gazpromneftå¦‚ä½•ä¸ºä¼ä¸šå®¢æˆ·åˆ›å»ºæ•°å­—è·¯å¾„</a></li>
<li><a href="../zh-CN473074/index.html">ä»€ä¹ˆæ˜¯APSï¼Ÿä¸ºä»€ä¹ˆå®ƒæ²¡æœ‰â€œæŒ‰ç…§æˆ‘ä»¬æƒ³è¦çš„æ–¹å¼åˆ¶å®šç”Ÿäº§è®¡åˆ’â€¦â€¦â€</a></li>
<li><a href="../zh-CN473078/index.html">ä½¿ç”¨microconfig.ioè½»æ¾ç®¡ç†å¾®æœåŠ¡é…ç½®</a></li>
<li><a href="../zh-CN473082/index.html">æˆ‘ä»¬å¦‚ä½•ç¼–å†™å¾®æœåŠ¡ä»¥åŠä¸ºä½•ä¸å¿«é€Ÿåšå¾®æœåŠ¡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>