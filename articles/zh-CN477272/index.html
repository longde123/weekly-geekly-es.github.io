<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍓 🚴🏾 🕓 首次介绍AssemblyScript 🦌 ⏹️ 🏣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="对WebAssembly （Wasm）技术的支持已在最近的浏览器中出现。 但是，这项技术可以很好地扩展Web的功能，使其成为能够支持通常被视为桌面的此类应用程序的平台。 

 掌握WebAssembly对于Web开发人员而言可能是一项艰巨的任务。 但是， AssemblyScript编译器可以改善这...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>首次介绍AssemblyScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/477272/"> 对<a href="https://webassembly.org/">WebAssembly</a> （Wasm）技术的支持已在最近的浏览器中出现。 但是，这项技术可以很好地扩展Web的功能，使其成为能够支持通常被视为桌面的此类应用程序的平台。 <br><br> 掌握WebAssembly对于Web开发人员而言可能是一项艰巨的任务。 但是， <a href="https://assemblyscript.org/">AssemblyScript</a>编译器可以改善这种情况。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/p4/91/pwp491ryabgnwblabon5slwooey.jpeg"></div><br> 该文章的作者（我们将在今天翻译该文章）首先讨论WebAssembly为什么是一项非常有前途的技术，然后再看看AssemblyScript如何帮助发挥Wasm的潜力。 <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">网络组装</font> </h2><br>  WebAssembly可以称为浏览器的低级语言。 它使开发人员能够创建可编译为JavaScript之外的代码。 这使网页中包含的程序几乎可以与各种平台的本机应用程序一样快地运行。 此类程序在有限的安全环境中运行。 <br><br> 负责开发所有领先的浏览器（Chrome，Firefox，Safari和Edge）的团队的代表参与了WebAssembly标准的创建。 他们在2017年初商定了系统<a href="https://lists.w3.org/Archives/Public/public-webassembly/2017Feb/0002.html">架构</a> 。 现在，以上所有浏览器都支持WebAssembly。 实际上，该技术可以在<a href="https://caniuse.com/">大约87％的</a>浏览器中使用。 <br><br>  WebAssembly代码以二进制格式存在。 这意味着此类代码比类似的JavaScript代码小，并且加载速度更快。 此外，Wasm代码可以<a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format">文本格式显示</a> ，以便人们可以阅读和编辑它。 <br><br> 当WebAssembly标准首次出现时，一些开发人员认为它很可能取代JavaScript并成为Web的主要语言。 但是，最好将WebAssembly看作是一种与现有Web平台很好地集成的新工具。 这是他的<a href="https://webassembly.org/docs/high-level-goals/">首要目标之一</a> 。 <br><br>  WebAssembly不会代替已经使用了很长时间并且成功使用该语言的JavaScript，而是为Web开发人员提供了新的有趣机会。 的确，Wasm代码无法直接访问DOM，因此大多数现有的Web项目将继续使用JavaScript。 经过多年的开发和优化，这种语言已经相当快了。  WebAssembly有其自己的<a href="https://webassembly.org/docs/use-cases/">应用程序</a> ： <br><br><ul><li> 游戏类 </li><li> 科学计算，可视化，模拟。 </li><li>  CAD应用程序。 </li><li> 编辑图像和视频。 </li></ul><br>  Wasm的所有这些用途通常与它们各自的应用程序被视为台式机结合在一起。 但是由于WebAssembly可以使您达到接近本机的性能水平，因此现在可以使用Web平台实现许多类似的应用程序。 <br><br>  WebAssembly可以利用现有的Web项目。  <a href="https://www.figma.com/">Figma</a>项目就是一个例子。 由于使用了Wasm，该项目的加载时间大大缩短了。 如果网站使用执行繁重计算的代码，则为了提高该网站的性能，仅将此类代码替换为WebAssembly类似物是有意义的。 <br><br> 您可能要尝试在自己的项目中使用WebAssembly。 可以立即学习并<a href="https://blog.scottlogic.com/2018/04/26/webassembly-by-hand.html">在上面</a>写<a href="https://blog.scottlogic.com/2018/04/26/webassembly-by-hand.html">上</a>这种语言。 但是，尽管如此，WebAssembly最初是作为其他语言的<a href="https://github.com/appcypher/awesome-wasm-langs">编译目标</a>而开发的。 它的<a href="https://webassembly.org/docs/c-and-c%2B%2B/">设计</a>具有对C和C ++的良好支持。  Wasm <a href="">实验支持</a>出现在Go 1.11中。 在<a href="https://www.rust-lang.org/what/wasm">Rust中</a>编写Wasm应用程序需要付出很多努力。 <br><br> 但是，Web开发人员完全有可能不想仅仅使用WebAssembly就学习C，C ++，Go或Rust。 他们做什么？ 这个问题的答案可以给出AssemblyScript。 <br><br><h2>  <font color="#3AC1EF">AssemblyScript</font> </h2><br>  AssemblyScript是将TypeScript代码转换为WebAssembly代码的编译器。  TypeScript是Microsoft开发的一种语言。 这是JavaScript的超集，具有改进的类型支持和其他一些功能。  TypeScript已成为一种相当<a href="https://insights.stackoverflow.com/survey/2019">流行的</a>语言。 应当注意，AssemblyScript只能将有限的TypeScript构造集转换为Wasm。 这意味着，即使不熟悉TypeScript的人也可以以足以编写AssemblyScript可以理解的代码的水平快速学习该语言。 <br><br> 此外，鉴于TypeScript与JavaScript非常相似，我们可以说AssemblyScript技术使Web开发人员可以轻松地将Wasm模块集成到他们的项目中，而无需学习一种全新的语言。 <br><br><h2>  <font color="#3AC1EF">例子</font> </h2><br> 让我们编写第一个AssemblyScript模块。 我们现在要讨论的所有代码都可以在<a href="https://github.com/dguo/assemblyscript-demo">GitHub</a>上<a href="https://github.com/dguo/assemblyscript-demo">找到</a> 。 为了<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly">支持</a> WebAssembly，我们至少需要<a href="https://nodejs.org/">Node.js</a> 8。 <br><br> 创建一个新目录，初始化npm项目并安装AssemblyScript： <br><br><pre><code class="javascript hljs">mkdir assemblyscript-demo cd assemblyscript-demo npm init npm install --save-dev github:AssemblyScript/assemblyscript</code> </pre> <br> 请注意，必须直接从项目的<a href="https://github.com/AssemblyScript/assemblyscript">GitHub存储库中</a>安装AssemblyScript。  AssemblyScript尚未在npm中发布，因为开发人员<a href="https://github.com/AssemblyScript/assemblyscript/issues/442">尚未考虑将</a>其准备好广泛使用。 <br><br> 我们将使用<code>asinit</code>包含的<code>asinit</code>命令创建辅助文件： <br><br><pre> <code class="javascript hljs">npx asinit .</code> </pre> <br> 现在， <code>package.json</code>的<code>scripts</code>部分应采用以下形式： <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>  } }</code> </pre> <br> 位于项目根文件夹中的<code>index.js</code>文件将如下所示： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> compiled = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Module(fs.readFileSync(__dirname + <span class="hljs-string"><span class="hljs-string">"/build/optimized.wasm"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imports = {  <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {    abort(_msg, _file, line, column) {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);    }  } }; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>, <span class="hljs-string"><span class="hljs-string">"exports"</span></span>, {  <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Instance(compiled, imports).exports });</code> </pre> <br> 这使您可以使用<a href="https://nodejs.org/api/modules.html">require</a>命令在代码中包含WebAssembly模块。 即-与连接常规JavaScript模块相同。 <br><br>  <code>assembly</code>文件夹包含<code>index.ts</code>文件。 它具有根据AssemblyScript规则编写的源代码。 自动生成的样板代码是添加两个数字的简单功能： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a: i32, b: i32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i32</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }</code> </pre> <br> 也许您希望类似功能的签名看起来像<code>add(a: number, b: number): number</code> 。 因此，它看起来是否是用普通的TypeScript编写的。 但是在这里， <code>i32</code>类型代替<code>number</code>类型。 发生这种情况是因为AssemblyScript代码将特定的<a href="https://docs.assemblyscript.org/basics/types">WebAssembly类型</a>用于整数和浮点数，而不是TypeScript中的通用<a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">数字</a>类型。 <br><br> 让我们组装项目： <br><br><pre> <code class="javascript hljs">npm run asbuild</code> </pre> <br> 以下文件应出现在<code>build</code>文件夹中： <br><br><pre> <code class="javascript hljs">optimized.wasm optimized.wasm.map optimized.wat untouched.wasm untouched.wasm.map untouched.wat</code> </pre> <br> 有装配的优化版本和常规版本。 程序集的每个版本都会为我们提供一个二进制.wasm文件，一个<a href="https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map">map map</a> .wasm.map以及.wat文件中二进制代码的文本表示形式。  Wasm代码的测试演示文稿是供程序员使用的，但我们什至不会查看此文件。 实际上，使用AssemblyScript的原因之一是它消除了使用Wasm代码的需要。 <br><br> 现在让我们在REPL模式下运行Node.js，并确保可以将已编译的Wasm模块以与任何常规JS模块相同的方式使用： <br><br><pre> <code class="javascript hljs">$ node Welcome to Node.js v12<span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>. Type <span class="hljs-string"><span class="hljs-string">".help"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. &gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).add; <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt; add(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre> <br> 通常，这是在Node.js中使用WebAssembly技术所需的全部。 <br><br><h2>  <font color="#3AC1EF">为项目配备观察者脚本</font> </h2><br> 为了在开发过程中对其进行更改时自动重建模块，建议使用<a href="https://github.com/Qard/onchange">onchange</a>软件包。 事实是AssemblyScript <a href="https://github.com/AssemblyScript/assemblyscript/issues/624">还没有</a>自己的系统来监视文件更改。 安装onchange软件包： <br><br><pre> <code class="javascript hljs">npm install --save-dev onchange</code> </pre> <br> 将<code>asbuild:watch</code>脚本添加到<code>package.json</code> 。  <code>-i</code> <a href="https://github.com/Qard/onchange">标志</a>包含在命令中，以便在调用脚本之前（在发生任何事件之前）构建过程开始一次。 <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange -i 'assembly/**/*' -- npm run asbuild"</span></span>  } }</code> </pre> <br> 现在，不再运行<code>asbuild</code>命令，而是运行<code>asbuild:watch</code>一次。 <br><br><h2>  <font color="#3AC1EF">性能表现</font> </h2><br> 我们将编写一个简单的测试，以评估Wasm代码的性能水平。  WebAssembly的主要范围是解决密集使用处理器的任务。 例如，这些是某种“繁重”的计算。 让我们创建一个函数，确定某个数字是否为质数。 <br><br> 相似功能的基本JS实现如下所示。 它的布置非常简单，它通过蛮力检查数字，但是出于我们的目的，它很适合，因为它执行了大量的计算。 <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br> 为AssemblyScript编译器编写的类似函数看起来几乎相同。 主要区别在于代码中存在类型注释： <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x: u32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i: u32 = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br> 为了分析代码的性能，我们将使用<a href="https://benchmarkjs.com/">Benchmark.js</a>包。 安装它： <br><br><pre> <code class="javascript hljs">npm install --save-dev benchmark</code> </pre> <br> 创建<code>benchmark.js</code>文件： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Benchmark = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'benchmark'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assemblyScriptIsPrime = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).isPrime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> suite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Benchmark.Suite; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startNumber = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stopNumber = <span class="hljs-number"><span class="hljs-number">10000</span></span>; suite.add(<span class="hljs-string"><span class="hljs-string">'AssemblyScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        assemblyScriptIsPrime(i);    } }).add(<span class="hljs-string"><span class="hljs-string">'JavaScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        isPrime(i);    } }).on(<span class="hljs-string"><span class="hljs-string">'cycle'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(event.target)); }).on(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fastest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'fastest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> slowest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'slowest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> difference = (fastest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) - slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>)) / slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) * <span class="hljs-number"><span class="hljs-number">100</span></span>;    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fastest.map(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'name'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> is ~</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${difference.toFixed(</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">% faster.`</span></span>); }).run();</code> </pre> <br> 这是在计算机上运行<code>node benchmark</code>命令后获得的信息： <br><br><pre> <code class="javascript hljs">AssemblyScript isPrime x <span class="hljs-number"><span class="hljs-number">74.00</span></span> ops/sec ±<span class="hljs-number"><span class="hljs-number">0.43</span></span>% (<span class="hljs-number"><span class="hljs-number">76</span></span> runs sampled) JavaScript isPrime x <span class="hljs-number"><span class="hljs-number">61.56</span></span> ops/sec ±<span class="hljs-number"><span class="hljs-number">0.30</span></span>% (<span class="hljs-number"><span class="hljs-number">64</span></span> runs sampled) AssemblyScript isPrime is ~<span class="hljs-number"><span class="hljs-number">20.2</span></span>% faster.</code> </pre> <br> 如您所见，该算法的AssemblyScript实现比JS实现快20％。 但是，请注意，此测试是一个微<a href="https://stackoverflow.com/a/2842707/1481479">基准</a>测试。 不要过分依赖其结果。 <br><br> 为了找到AssemblyScript项目性能研究的更可靠结果，我建议您看一下<a href="https://jtiscione.github.io/webassembly-wave/index.html">该</a>基准和<a href="https://jtiscione.github.io/webassembly-wave/index.html">本</a>基准。 <br><br><h2>  <font color="#3AC1EF">在网页上使用Wasm模块</font> </h2><br> 让我们在网页上使用Wasm模块。 我们首先创建一个具有以下内容的<code>index.html</code>文件： <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt;    &lt;head&gt;        &lt;meta charset="utf-8" /&gt;        &lt;title&gt;AssemblyScript isPrime demo&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;form id="prime-checker"&gt;            &lt;label for="number"&gt;Enter a number to check if it is prime:&lt;/label&gt;            &lt;input name="number" type="number" /&gt;            &lt;button type="submit"&gt;Submit&lt;/button&gt;        &lt;/form&gt;        &lt;p id="result"&gt;&lt;/p&gt;        &lt;script src="demo.js"&gt;&lt;/script&gt;    &lt;/body&gt; &lt;/html&gt;</code> </pre> <br> 现在创建<code>demo.js</code>文件，其代码如下所示。 有<a href="https://developers.google.com/web/updates/2018/04/loading-wasm">许多</a>加载WebAssembly模块的方法。 最有效的方法是使用<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiateStreaming">WebAssembly.instantiateStreaming</a>函数以流模式编译和初始化它们。 请注意，我们将需要重新定义<a href="https://docs.assemblyscript.org/details/debugging">中止</a>函数，如果未执行某些<a href="https://docs.assemblyscript.org/basics/environment">语句</a> ，则会调用该函数。 <br><br><pre> <code class="javascript hljs">(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> importObject = {        <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {            abort(_msg, _file, line, column) {                <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);            }        }    };    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> WebAssembly.instantiateStreaming(        fetch(<span class="hljs-string"><span class="hljs-string">"build/optimized.wasm"</span></span>),        importObject    );    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isPrime = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.instance.exports.isPrime;    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#result"</span></span>);    <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#prime-checker"</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>, event =&gt; {        event.preventDefault();        result.innerText = <span class="hljs-string"><span class="hljs-string">""</span></span>;        <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> number = event.target.elements.number.value;        result.innerText = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${number}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${isPrime(number) ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'not '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">prime.`</span></span>;    }); })();</code> </pre> <br> 接下来，安装<a href="https://github.com/nbluis/static-server">静态服务器</a>软件包。 由于要使用<code>WebAssembly.instantiateStreaming</code>函数，必须使用<code>application/wasm</code> MIME类型为模块提供服务，因此我们需要服务器。 <br><br><pre> <code class="javascript hljs">npm install --save-dev <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>-server</code> </pre> <br> 将适当的脚本添加到<code>package.json</code> ： <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"serve-demo"</span></span>: <span class="hljs-string"><span class="hljs-string">"static-server"</span></span>  } }</code> </pre> <br> 现在， <code>npm run serve-demo</code>命令并在浏览器中打开本地主机URL。 如果在表格中输入某个数字，则可以确定它是否简单。 现在，在开发AssemblyScript方面，从编写代码到在Node.js和网页上使用它，我们已经走了很长一段路。 <br><br><h2>  <font color="#3AC1EF">总结</font> </h2><br>  WebAssembly以及AssemblyScript无法以某种方式神奇地加速任何站点。 但是Wasm从来没有承担过绝对加速所有任务的任务。 该技术的卓越之处在于它为新型应用打开了通往网络的道路。 <br><br> 关于AssemblyScript，可以说类似的话。 这项技术简化了许多开发人员对WebAssembly的访问。 当使用接近JavaScript的语言创建代码时，它允许使用WebAssembly的功能来解决复杂的计算问题。 <br><br>  <b>亲爱的读者们！</b> 您如何评估在项目中使用AssemblyScript的前景？ <br><br><div style="text-align:center;"> <a href="https://ruvds.com/vps_start/"><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN477272/">https://habr.com/ru/post/zh-CN477272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN477256/index.html">明年，在联盟号运载火箭上首次正式发布OneWeb，以及在Angara运载火箭上启动</a></li>
<li><a href="../zh-CN477262/index.html">Promobot公司的Android。 侧面图</a></li>
<li><a href="../zh-CN477264/index.html">挖掘机变成了能够独立挖沟的自主机器人</a></li>
<li><a href="../zh-CN477266/index.html">上周第390期（2019年11月18日至24日）来自前端世界的新鲜材料摘要</a></li>
<li><a href="../zh-CN477268/index.html">在github上搜索解决方案优化</a></li>
<li><a href="../zh-CN477274/index.html">您如何摆脱未使用的CSS代码？ 第一部分</a></li>
<li><a href="../zh-CN477276/index.html">您如何摆脱未使用的CSS代码？ 第二部分</a></li>
<li><a href="../zh-CN477278/index.html">前端测试</a></li>
<li><a href="../zh-CN477282/index.html">分析Go项目代码并解决内存分配问题</a></li>
<li><a href="../zh-CN477284/index.html">为什么JavaScript需要严格模式？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>