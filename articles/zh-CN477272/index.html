<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“ ğŸš´ğŸ¾ ğŸ•“ é¦–æ¬¡ä»‹ç»AssemblyScript ğŸ¦Œ â¹ï¸ ğŸ£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¯¹WebAssembly ï¼ˆWasmï¼‰æŠ€æœ¯çš„æ”¯æŒå·²åœ¨æœ€è¿‘çš„æµè§ˆå™¨ä¸­å‡ºç°ã€‚ ä½†æ˜¯ï¼Œè¿™é¡¹æŠ€æœ¯å¯ä»¥å¾ˆå¥½åœ°æ‰©å±•Webçš„åŠŸèƒ½ï¼Œä½¿å…¶æˆä¸ºèƒ½å¤Ÿæ”¯æŒé€šå¸¸è¢«è§†ä¸ºæ¡Œé¢çš„æ­¤ç±»åº”ç”¨ç¨‹åºçš„å¹³å°ã€‚ 

 æŒæ¡WebAssemblyå¯¹äºWebå¼€å‘äººå‘˜è€Œè¨€å¯èƒ½æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ ä½†æ˜¯ï¼Œ AssemblyScriptç¼–è¯‘å™¨å¯ä»¥æ”¹å–„è¿™...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>é¦–æ¬¡ä»‹ç»AssemblyScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/477272/"> å¯¹<a href="https://webassembly.org/">WebAssembly</a> ï¼ˆWasmï¼‰æŠ€æœ¯çš„æ”¯æŒå·²åœ¨æœ€è¿‘çš„æµè§ˆå™¨ä¸­å‡ºç°ã€‚ ä½†æ˜¯ï¼Œè¿™é¡¹æŠ€æœ¯å¯ä»¥å¾ˆå¥½åœ°æ‰©å±•Webçš„åŠŸèƒ½ï¼Œä½¿å…¶æˆä¸ºèƒ½å¤Ÿæ”¯æŒé€šå¸¸è¢«è§†ä¸ºæ¡Œé¢çš„æ­¤ç±»åº”ç”¨ç¨‹åºçš„å¹³å°ã€‚ <br><br> æŒæ¡WebAssemblyå¯¹äºWebå¼€å‘äººå‘˜è€Œè¨€å¯èƒ½æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ ä½†æ˜¯ï¼Œ <a href="https://assemblyscript.org/">AssemblyScript</a>ç¼–è¯‘å™¨å¯ä»¥æ”¹å–„è¿™ç§æƒ…å†µã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/p4/91/pwp491ryabgnwblabon5slwooey.jpeg"></div><br> è¯¥æ–‡ç« çš„ä½œè€…ï¼ˆæˆ‘ä»¬å°†åœ¨ä»Šå¤©ç¿»è¯‘è¯¥æ–‡ç« ï¼‰é¦–å…ˆè®¨è®ºWebAssemblyä¸ºä»€ä¹ˆæ˜¯ä¸€é¡¹éå¸¸æœ‰å‰é€”çš„æŠ€æœ¯ï¼Œç„¶åå†çœ‹çœ‹AssemblyScriptå¦‚ä½•å¸®åŠ©å‘æŒ¥Wasmçš„æ½œåŠ›ã€‚ <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">ç½‘ç»œç»„è£…</font> </h2><br>  WebAssemblyå¯ä»¥ç§°ä¸ºæµè§ˆå™¨çš„ä½çº§è¯­è¨€ã€‚ å®ƒä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåˆ›å»ºå¯ç¼–è¯‘ä¸ºJavaScriptä¹‹å¤–çš„ä»£ç ã€‚ è¿™ä½¿ç½‘é¡µä¸­åŒ…å«çš„ç¨‹åºå‡ ä¹å¯ä»¥ä¸å„ç§å¹³å°çš„æœ¬æœºåº”ç”¨ç¨‹åºä¸€æ ·å¿«åœ°è¿è¡Œã€‚ æ­¤ç±»ç¨‹åºåœ¨æœ‰é™çš„å®‰å…¨ç¯å¢ƒä¸­è¿è¡Œã€‚ <br><br> è´Ÿè´£å¼€å‘æ‰€æœ‰é¢†å…ˆçš„æµè§ˆå™¨ï¼ˆChromeï¼ŒFirefoxï¼ŒSafariå’ŒEdgeï¼‰çš„å›¢é˜Ÿçš„ä»£è¡¨å‚ä¸äº†WebAssemblyæ ‡å‡†çš„åˆ›å»ºã€‚ ä»–ä»¬åœ¨2017å¹´åˆå•†å®šäº†ç³»ç»Ÿ<a href="https://lists.w3.org/Archives/Public/public-webassembly/2017Feb/0002.html">æ¶æ„</a> ã€‚ ç°åœ¨ï¼Œä»¥ä¸Šæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒWebAssemblyã€‚ å®é™…ä¸Šï¼Œè¯¥æŠ€æœ¯å¯ä»¥åœ¨<a href="https://caniuse.com/">å¤§çº¦87ï¼…çš„</a>æµè§ˆå™¨ä¸­ä½¿ç”¨ã€‚ <br><br>  WebAssemblyä»£ç ä»¥äºŒè¿›åˆ¶æ ¼å¼å­˜åœ¨ã€‚ è¿™æ„å‘³ç€æ­¤ç±»ä»£ç æ¯”ç±»ä¼¼çš„JavaScriptä»£ç å°ï¼Œå¹¶ä¸”åŠ è½½é€Ÿåº¦æ›´å¿«ã€‚ æ­¤å¤–ï¼ŒWasmä»£ç å¯ä»¥<a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format">æ–‡æœ¬æ ¼å¼æ˜¾ç¤º</a> ï¼Œä»¥ä¾¿äººä»¬å¯ä»¥é˜…è¯»å’Œç¼–è¾‘å®ƒã€‚ <br><br> å½“WebAssemblyæ ‡å‡†é¦–æ¬¡å‡ºç°æ—¶ï¼Œä¸€äº›å¼€å‘äººå‘˜è®¤ä¸ºå®ƒå¾ˆå¯èƒ½å–ä»£JavaScriptå¹¶æˆä¸ºWebçš„ä¸»è¦è¯­è¨€ã€‚ ä½†æ˜¯ï¼Œæœ€å¥½å°†WebAssemblyçœ‹ä½œæ˜¯ä¸€ç§ä¸ç°æœ‰Webå¹³å°å¾ˆå¥½åœ°é›†æˆçš„æ–°å·¥å…·ã€‚ è¿™æ˜¯ä»–çš„<a href="https://webassembly.org/docs/high-level-goals/">é¦–è¦ç›®æ ‡ä¹‹ä¸€</a> ã€‚ <br><br>  WebAssemblyä¸ä¼šä»£æ›¿å·²ç»ä½¿ç”¨äº†å¾ˆé•¿æ—¶é—´å¹¶ä¸”æˆåŠŸä½¿ç”¨è¯¥è¯­è¨€çš„JavaScriptï¼Œè€Œæ˜¯ä¸ºWebå¼€å‘äººå‘˜æä¾›äº†æ–°çš„æœ‰è¶£æœºä¼šã€‚ çš„ç¡®ï¼ŒWasmä»£ç æ— æ³•ç›´æ¥è®¿é—®DOMï¼Œå› æ­¤å¤§å¤šæ•°ç°æœ‰çš„Webé¡¹ç›®å°†ç»§ç»­ä½¿ç”¨JavaScriptã€‚ ç»è¿‡å¤šå¹´çš„å¼€å‘å’Œä¼˜åŒ–ï¼Œè¿™ç§è¯­è¨€å·²ç»ç›¸å½“å¿«äº†ã€‚  WebAssemblyæœ‰å…¶è‡ªå·±çš„<a href="https://webassembly.org/docs/use-cases/">åº”ç”¨ç¨‹åº</a> ï¼š <br><br><ul><li> æ¸¸æˆç±» </li><li> ç§‘å­¦è®¡ç®—ï¼Œå¯è§†åŒ–ï¼Œæ¨¡æ‹Ÿã€‚ </li><li>  CADåº”ç”¨ç¨‹åºã€‚ </li><li> ç¼–è¾‘å›¾åƒå’Œè§†é¢‘ã€‚ </li></ul><br>  Wasmçš„æ‰€æœ‰è¿™äº›ç”¨é€”é€šå¸¸ä¸å®ƒä»¬å„è‡ªçš„åº”ç”¨ç¨‹åºè¢«è§†ä¸ºå°å¼æœºç»“åˆåœ¨ä¸€èµ·ã€‚ ä½†æ˜¯ç”±äºWebAssemblyå¯ä»¥ä½¿æ‚¨è¾¾åˆ°æ¥è¿‘æœ¬æœºçš„æ€§èƒ½æ°´å¹³ï¼Œå› æ­¤ç°åœ¨å¯ä»¥ä½¿ç”¨Webå¹³å°å®ç°è®¸å¤šç±»ä¼¼çš„åº”ç”¨ç¨‹åºã€‚ <br><br>  WebAssemblyå¯ä»¥åˆ©ç”¨ç°æœ‰çš„Webé¡¹ç›®ã€‚  <a href="https://www.figma.com/">Figma</a>é¡¹ç›®å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ ç”±äºä½¿ç”¨äº†Wasmï¼Œè¯¥é¡¹ç›®çš„åŠ è½½æ—¶é—´å¤§å¤§ç¼©çŸ­äº†ã€‚ å¦‚æœç½‘ç«™ä½¿ç”¨æ‰§è¡Œç¹é‡è®¡ç®—çš„ä»£ç ï¼Œåˆ™ä¸ºäº†æé«˜è¯¥ç½‘ç«™çš„æ€§èƒ½ï¼Œä»…å°†æ­¤ç±»ä»£ç æ›¿æ¢ä¸ºWebAssemblyç±»ä¼¼ç‰©æ˜¯æœ‰æ„ä¹‰çš„ã€‚ <br><br> æ‚¨å¯èƒ½è¦å°è¯•åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨WebAssemblyã€‚ å¯ä»¥ç«‹å³å­¦ä¹ å¹¶<a href="https://blog.scottlogic.com/2018/04/26/webassembly-by-hand.html">åœ¨ä¸Šé¢</a>å†™<a href="https://blog.scottlogic.com/2018/04/26/webassembly-by-hand.html">ä¸Š</a>è¿™ç§è¯­è¨€ã€‚ ä½†æ˜¯ï¼Œå°½ç®¡å¦‚æ­¤ï¼ŒWebAssemblyæœ€åˆæ˜¯ä½œä¸ºå…¶ä»–è¯­è¨€çš„<a href="https://github.com/appcypher/awesome-wasm-langs">ç¼–è¯‘ç›®æ ‡</a>è€Œå¼€å‘çš„ã€‚ å®ƒçš„<a href="https://webassembly.org/docs/c-and-c%2B%2B/">è®¾è®¡</a>å…·æœ‰å¯¹Cå’ŒC ++çš„è‰¯å¥½æ”¯æŒã€‚  Wasm <a href="">å®éªŒæ”¯æŒ</a>å‡ºç°åœ¨Go 1.11ä¸­ã€‚ åœ¨<a href="https://www.rust-lang.org/what/wasm">Rustä¸­</a>ç¼–å†™Wasmåº”ç”¨ç¨‹åºéœ€è¦ä»˜å‡ºå¾ˆå¤šåŠªåŠ›ã€‚ <br><br> ä½†æ˜¯ï¼ŒWebå¼€å‘äººå‘˜å®Œå…¨æœ‰å¯èƒ½ä¸æƒ³ä»…ä»…ä½¿ç”¨WebAssemblyå°±å­¦ä¹ Cï¼ŒC ++ï¼ŒGoæˆ–Rustã€‚ ä»–ä»¬åšä»€ä¹ˆï¼Ÿ è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¯ä»¥ç»™å‡ºAssemblyScriptã€‚ <br><br><h2>  <font color="#3AC1EF">AssemblyScript</font> </h2><br>  AssemblyScriptæ˜¯å°†TypeScriptä»£ç è½¬æ¢ä¸ºWebAssemblyä»£ç çš„ç¼–è¯‘å™¨ã€‚  TypeScriptæ˜¯Microsoftå¼€å‘çš„ä¸€ç§è¯­è¨€ã€‚ è¿™æ˜¯JavaScriptçš„è¶…é›†ï¼Œå…·æœ‰æ”¹è¿›çš„ç±»å‹æ”¯æŒå’Œå…¶ä»–ä¸€äº›åŠŸèƒ½ã€‚  TypeScriptå·²æˆä¸ºä¸€ç§ç›¸å½“<a href="https://insights.stackoverflow.com/survey/2019">æµè¡Œçš„</a>è¯­è¨€ã€‚ åº”å½“æ³¨æ„ï¼ŒAssemblyScriptåªèƒ½å°†æœ‰é™çš„TypeScriptæ„é€ é›†è½¬æ¢ä¸ºWasmã€‚ è¿™æ„å‘³ç€ï¼Œå³ä½¿ä¸ç†Ÿæ‚‰TypeScriptçš„äººä¹Ÿå¯ä»¥ä»¥è¶³ä»¥ç¼–å†™AssemblyScriptå¯ä»¥ç†è§£çš„ä»£ç çš„æ°´å¹³å¿«é€Ÿå­¦ä¹ è¯¥è¯­è¨€ã€‚ <br><br> æ­¤å¤–ï¼Œé‰´äºTypeScriptä¸JavaScriptéå¸¸ç›¸ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥è¯´AssemblyScriptæŠ€æœ¯ä½¿Webå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°å°†Wasmæ¨¡å—é›†æˆåˆ°ä»–ä»¬çš„é¡¹ç›®ä¸­ï¼Œè€Œæ— éœ€å­¦ä¹ ä¸€ç§å…¨æ–°çš„è¯­è¨€ã€‚ <br><br><h2>  <font color="#3AC1EF">ä¾‹å­</font> </h2><br> è®©æˆ‘ä»¬ç¼–å†™ç¬¬ä¸€ä¸ªAssemblyScriptæ¨¡å—ã€‚ æˆ‘ä»¬ç°åœ¨è¦è®¨è®ºçš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨<a href="https://github.com/dguo/assemblyscript-demo">GitHub</a>ä¸Š<a href="https://github.com/dguo/assemblyscript-demo">æ‰¾åˆ°</a> ã€‚ ä¸ºäº†<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly">æ”¯æŒ</a> WebAssemblyï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦<a href="https://nodejs.org/">Node.js</a> 8ã€‚ <br><br> åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œåˆå§‹åŒ–npmé¡¹ç›®å¹¶å®‰è£…AssemblyScriptï¼š <br><br><pre><code class="javascript hljs">mkdir assemblyscript-demo cd assemblyscript-demo npm init npm install --save-dev github:AssemblyScript/assemblyscript</code> </pre> <br> è¯·æ³¨æ„ï¼Œå¿…é¡»ç›´æ¥ä»é¡¹ç›®çš„<a href="https://github.com/AssemblyScript/assemblyscript">GitHubå­˜å‚¨åº“ä¸­</a>å®‰è£…AssemblyScriptã€‚  AssemblyScriptå°šæœªåœ¨npmä¸­å‘å¸ƒï¼Œå› ä¸ºå¼€å‘äººå‘˜<a href="https://github.com/AssemblyScript/assemblyscript/issues/442">å°šæœªè€ƒè™‘å°†</a>å…¶å‡†å¤‡å¥½å¹¿æ³›ä½¿ç”¨ã€‚ <br><br> æˆ‘ä»¬å°†ä½¿ç”¨<code>asinit</code>åŒ…å«çš„<code>asinit</code>å‘½ä»¤åˆ›å»ºè¾…åŠ©æ–‡ä»¶ï¼š <br><br><pre> <code class="javascript hljs">npx asinit .</code> </pre> <br> ç°åœ¨ï¼Œ <code>package.json</code>çš„<code>scripts</code>éƒ¨åˆ†åº”é‡‡ç”¨ä»¥ä¸‹å½¢å¼ï¼š <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>  } }</code> </pre> <br> ä½äºé¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­çš„<code>index.js</code>æ–‡ä»¶å°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> compiled = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Module(fs.readFileSync(__dirname + <span class="hljs-string"><span class="hljs-string">"/build/optimized.wasm"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imports = {  <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {    abort(_msg, _file, line, column) {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);    }  } }; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>, <span class="hljs-string"><span class="hljs-string">"exports"</span></span>, {  <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Instance(compiled, imports).exports });</code> </pre> <br> è¿™ä½¿æ‚¨å¯ä»¥ä½¿ç”¨<a href="https://nodejs.org/api/modules.html">require</a>å‘½ä»¤åœ¨ä»£ç ä¸­åŒ…å«WebAssemblyæ¨¡å—ã€‚ å³-ä¸è¿æ¥å¸¸è§„JavaScriptæ¨¡å—ç›¸åŒã€‚ <br><br>  <code>assembly</code>æ–‡ä»¶å¤¹åŒ…å«<code>index.ts</code>æ–‡ä»¶ã€‚ å®ƒå…·æœ‰æ ¹æ®AssemblyScriptè§„åˆ™ç¼–å†™çš„æºä»£ç ã€‚ è‡ªåŠ¨ç”Ÿæˆçš„æ ·æ¿ä»£ç æ˜¯æ·»åŠ ä¸¤ä¸ªæ•°å­—çš„ç®€å•åŠŸèƒ½ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a: i32, b: i32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i32</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }</code> </pre> <br> ä¹Ÿè®¸æ‚¨å¸Œæœ›ç±»ä¼¼åŠŸèƒ½çš„ç­¾åçœ‹èµ·æ¥åƒ<code>add(a: number, b: number): number</code> ã€‚ å› æ­¤ï¼Œå®ƒçœ‹èµ·æ¥æ˜¯å¦æ˜¯ç”¨æ™®é€šçš„TypeScriptç¼–å†™çš„ã€‚ ä½†æ˜¯åœ¨è¿™é‡Œï¼Œ <code>i32</code>ç±»å‹ä»£æ›¿<code>number</code>ç±»å‹ã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºAssemblyScriptä»£ç å°†ç‰¹å®šçš„<a href="https://docs.assemblyscript.org/basics/types">WebAssemblyç±»å‹</a>ç”¨äºæ•´æ•°å’Œæµ®ç‚¹æ•°ï¼Œè€Œä¸æ˜¯TypeScriptä¸­çš„é€šç”¨<a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">æ•°å­—</a>ç±»å‹ã€‚ <br><br> è®©æˆ‘ä»¬ç»„è£…é¡¹ç›®ï¼š <br><br><pre> <code class="javascript hljs">npm run asbuild</code> </pre> <br> ä»¥ä¸‹æ–‡ä»¶åº”å‡ºç°åœ¨<code>build</code>æ–‡ä»¶å¤¹ä¸­ï¼š <br><br><pre> <code class="javascript hljs">optimized.wasm optimized.wasm.map optimized.wat untouched.wasm untouched.wasm.map untouched.wat</code> </pre> <br> æœ‰è£…é…çš„ä¼˜åŒ–ç‰ˆæœ¬å’Œå¸¸è§„ç‰ˆæœ¬ã€‚ ç¨‹åºé›†çš„æ¯ä¸ªç‰ˆæœ¬éƒ½ä¼šä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªäºŒè¿›åˆ¶.wasmæ–‡ä»¶ï¼Œä¸€ä¸ª<a href="https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map">map map</a> .wasm.mapä»¥åŠ.watæ–‡ä»¶ä¸­äºŒè¿›åˆ¶ä»£ç çš„æ–‡æœ¬è¡¨ç¤ºå½¢å¼ã€‚  Wasmä»£ç çš„æµ‹è¯•æ¼”ç¤ºæ–‡ç¨¿æ˜¯ä¾›ç¨‹åºå‘˜ä½¿ç”¨çš„ï¼Œä½†æˆ‘ä»¬ä»€è‡³ä¸ä¼šæŸ¥çœ‹æ­¤æ–‡ä»¶ã€‚ å®é™…ä¸Šï¼Œä½¿ç”¨AssemblyScriptçš„åŸå› ä¹‹ä¸€æ˜¯å®ƒæ¶ˆé™¤äº†ä½¿ç”¨Wasmä»£ç çš„éœ€è¦ã€‚ <br><br> ç°åœ¨è®©æˆ‘ä»¬åœ¨REPLæ¨¡å¼ä¸‹è¿è¡ŒNode.jsï¼Œå¹¶ç¡®ä¿å¯ä»¥å°†å·²ç¼–è¯‘çš„Wasmæ¨¡å—ä»¥ä¸ä»»ä½•å¸¸è§„JSæ¨¡å—ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ï¼š <br><br><pre> <code class="javascript hljs">$ node Welcome to Node.js v12<span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>. Type <span class="hljs-string"><span class="hljs-string">".help"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. &gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).add; <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt; add(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre> <br> é€šå¸¸ï¼Œè¿™æ˜¯åœ¨Node.jsä¸­ä½¿ç”¨WebAssemblyæŠ€æœ¯æ‰€éœ€çš„å…¨éƒ¨ã€‚ <br><br><h2>  <font color="#3AC1EF">ä¸ºé¡¹ç›®é…å¤‡è§‚å¯Ÿè€…è„šæœ¬</font> </h2><br> ä¸ºäº†åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯¹å…¶è¿›è¡Œæ›´æ”¹æ—¶è‡ªåŠ¨é‡å»ºæ¨¡å—ï¼Œå»ºè®®ä½¿ç”¨<a href="https://github.com/Qard/onchange">onchange</a>è½¯ä»¶åŒ…ã€‚ äº‹å®æ˜¯AssemblyScript <a href="https://github.com/AssemblyScript/assemblyscript/issues/624">è¿˜æ²¡æœ‰</a>è‡ªå·±çš„ç³»ç»Ÿæ¥ç›‘è§†æ–‡ä»¶æ›´æ”¹ã€‚ å®‰è£…onchangeè½¯ä»¶åŒ…ï¼š <br><br><pre> <code class="javascript hljs">npm install --save-dev onchange</code> </pre> <br> å°†<code>asbuild:watch</code>è„šæœ¬æ·»åŠ åˆ°<code>package.json</code> ã€‚  <code>-i</code> <a href="https://github.com/Qard/onchange">æ ‡å¿—</a>åŒ…å«åœ¨å‘½ä»¤ä¸­ï¼Œä»¥ä¾¿åœ¨è°ƒç”¨è„šæœ¬ä¹‹å‰ï¼ˆåœ¨å‘ç”Ÿä»»ä½•äº‹ä»¶ä¹‹å‰ï¼‰æ„å»ºè¿‡ç¨‹å¼€å§‹ä¸€æ¬¡ã€‚ <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange -i 'assembly/**/*' -- npm run asbuild"</span></span>  } }</code> </pre> <br> ç°åœ¨ï¼Œä¸å†è¿è¡Œ<code>asbuild</code>å‘½ä»¤ï¼Œè€Œæ˜¯è¿è¡Œ<code>asbuild:watch</code>ä¸€æ¬¡ã€‚ <br><br><h2>  <font color="#3AC1EF">æ€§èƒ½è¡¨ç°</font> </h2><br> æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼Œä»¥è¯„ä¼°Wasmä»£ç çš„æ€§èƒ½æ°´å¹³ã€‚  WebAssemblyçš„ä¸»è¦èŒƒå›´æ˜¯è§£å†³å¯†é›†ä½¿ç”¨å¤„ç†å™¨çš„ä»»åŠ¡ã€‚ ä¾‹å¦‚ï¼Œè¿™äº›æ˜¯æŸç§â€œç¹é‡â€çš„è®¡ç®—ã€‚ è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œç¡®å®šæŸä¸ªæ•°å­—æ˜¯å¦ä¸ºè´¨æ•°ã€‚ <br><br> ç›¸ä¼¼åŠŸèƒ½çš„åŸºæœ¬JSå®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚ å®ƒçš„å¸ƒç½®éå¸¸ç®€å•ï¼Œå®ƒé€šè¿‡è›®åŠ›æ£€æŸ¥æ•°å­—ï¼Œä½†æ˜¯å‡ºäºæˆ‘ä»¬çš„ç›®çš„ï¼Œå®ƒå¾ˆé€‚åˆï¼Œå› ä¸ºå®ƒæ‰§è¡Œäº†å¤§é‡çš„è®¡ç®—ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br> ä¸ºAssemblyScriptç¼–è¯‘å™¨ç¼–å†™çš„ç±»ä¼¼å‡½æ•°çœ‹èµ·æ¥å‡ ä¹ç›¸åŒã€‚ ä¸»è¦åŒºåˆ«åœ¨äºä»£ç ä¸­å­˜åœ¨ç±»å‹æ³¨é‡Šï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x: u32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i: u32 = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br> ä¸ºäº†åˆ†æä»£ç çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a href="https://benchmarkjs.com/">Benchmark.js</a>åŒ…ã€‚ å®‰è£…å®ƒï¼š <br><br><pre> <code class="javascript hljs">npm install --save-dev benchmark</code> </pre> <br> åˆ›å»º<code>benchmark.js</code>æ–‡ä»¶ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Benchmark = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'benchmark'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assemblyScriptIsPrime = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).isPrime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> suite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Benchmark.Suite; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startNumber = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stopNumber = <span class="hljs-number"><span class="hljs-number">10000</span></span>; suite.add(<span class="hljs-string"><span class="hljs-string">'AssemblyScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        assemblyScriptIsPrime(i);    } }).add(<span class="hljs-string"><span class="hljs-string">'JavaScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        isPrime(i);    } }).on(<span class="hljs-string"><span class="hljs-string">'cycle'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(event.target)); }).on(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fastest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'fastest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> slowest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'slowest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> difference = (fastest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) - slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>)) / slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) * <span class="hljs-number"><span class="hljs-number">100</span></span>;    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fastest.map(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'name'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> is ~</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${difference.toFixed(</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">% faster.`</span></span>); }).run();</code> </pre> <br> è¿™æ˜¯åœ¨è®¡ç®—æœºä¸Šè¿è¡Œ<code>node benchmark</code>å‘½ä»¤åè·å¾—çš„ä¿¡æ¯ï¼š <br><br><pre> <code class="javascript hljs">AssemblyScript isPrime x <span class="hljs-number"><span class="hljs-number">74.00</span></span> ops/sec Â±<span class="hljs-number"><span class="hljs-number">0.43</span></span>% (<span class="hljs-number"><span class="hljs-number">76</span></span> runs sampled) JavaScript isPrime x <span class="hljs-number"><span class="hljs-number">61.56</span></span> ops/sec Â±<span class="hljs-number"><span class="hljs-number">0.30</span></span>% (<span class="hljs-number"><span class="hljs-number">64</span></span> runs sampled) AssemblyScript isPrime is ~<span class="hljs-number"><span class="hljs-number">20.2</span></span>% faster.</code> </pre> <br> å¦‚æ‚¨æ‰€è§ï¼Œè¯¥ç®—æ³•çš„AssemblyScriptå®ç°æ¯”JSå®ç°å¿«20ï¼…ã€‚ ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œæ­¤æµ‹è¯•æ˜¯ä¸€ä¸ªå¾®<a href="https://stackoverflow.com/a/2842707/1481479">åŸºå‡†</a>æµ‹è¯•ã€‚ ä¸è¦è¿‡åˆ†ä¾èµ–å…¶ç»“æœã€‚ <br><br> ä¸ºäº†æ‰¾åˆ°AssemblyScripté¡¹ç›®æ€§èƒ½ç ”ç©¶çš„æ›´å¯é ç»“æœï¼Œæˆ‘å»ºè®®æ‚¨çœ‹ä¸€ä¸‹<a href="https://jtiscione.github.io/webassembly-wave/index.html">è¯¥</a>åŸºå‡†å’Œ<a href="https://jtiscione.github.io/webassembly-wave/index.html">æœ¬</a>åŸºå‡†ã€‚ <br><br><h2>  <font color="#3AC1EF">åœ¨ç½‘é¡µä¸Šä½¿ç”¨Wasmæ¨¡å—</font> </h2><br> è®©æˆ‘ä»¬åœ¨ç½‘é¡µä¸Šä½¿ç”¨Wasmæ¨¡å—ã€‚ æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹å†…å®¹çš„<code>index.html</code>æ–‡ä»¶ï¼š <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt;    &lt;head&gt;        &lt;meta charset="utf-8" /&gt;        &lt;title&gt;AssemblyScript isPrime demo&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;form id="prime-checker"&gt;            &lt;label for="number"&gt;Enter a number to check if it is prime:&lt;/label&gt;            &lt;input name="number" type="number" /&gt;            &lt;button type="submit"&gt;Submit&lt;/button&gt;        &lt;/form&gt;        &lt;p id="result"&gt;&lt;/p&gt;        &lt;script src="demo.js"&gt;&lt;/script&gt;    &lt;/body&gt; &lt;/html&gt;</code> </pre> <br> ç°åœ¨åˆ›å»º<code>demo.js</code>æ–‡ä»¶ï¼Œå…¶ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ æœ‰<a href="https://developers.google.com/web/updates/2018/04/loading-wasm">è®¸å¤š</a>åŠ è½½WebAssemblyæ¨¡å—çš„æ–¹æ³•ã€‚ æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiateStreaming">WebAssembly.instantiateStreaming</a>å‡½æ•°ä»¥æµæ¨¡å¼ç¼–è¯‘å’Œåˆå§‹åŒ–å®ƒä»¬ã€‚ è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†éœ€è¦é‡æ–°å®šä¹‰<a href="https://docs.assemblyscript.org/details/debugging">ä¸­æ­¢</a>å‡½æ•°ï¼Œå¦‚æœæœªæ‰§è¡ŒæŸäº›<a href="https://docs.assemblyscript.org/basics/environment">è¯­å¥</a> ï¼Œåˆ™ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚ <br><br><pre> <code class="javascript hljs">(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> importObject = {        <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {            abort(_msg, _file, line, column) {                <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);            }        }    };    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> WebAssembly.instantiateStreaming(        fetch(<span class="hljs-string"><span class="hljs-string">"build/optimized.wasm"</span></span>),        importObject    );    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isPrime = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.instance.exports.isPrime;    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#result"</span></span>);    <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#prime-checker"</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>, event =&gt; {        event.preventDefault();        result.innerText = <span class="hljs-string"><span class="hljs-string">""</span></span>;        <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> number = event.target.elements.number.value;        result.innerText = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${number}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${isPrime(number) ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'not '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">prime.`</span></span>;    }); })();</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œå®‰è£…<a href="https://github.com/nbluis/static-server">é™æ€æœåŠ¡å™¨</a>è½¯ä»¶åŒ…ã€‚ ç”±äºè¦ä½¿ç”¨<code>WebAssembly.instantiateStreaming</code>å‡½æ•°ï¼Œå¿…é¡»ä½¿ç”¨<code>application/wasm</code> MIMEç±»å‹ä¸ºæ¨¡å—æä¾›æœåŠ¡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æœåŠ¡å™¨ã€‚ <br><br><pre> <code class="javascript hljs">npm install --save-dev <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>-server</code> </pre> <br> å°†é€‚å½“çš„è„šæœ¬æ·»åŠ åˆ°<code>package.json</code> ï¼š <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"serve-demo"</span></span>: <span class="hljs-string"><span class="hljs-string">"static-server"</span></span>  } }</code> </pre> <br> ç°åœ¨ï¼Œ <code>npm run serve-demo</code>å‘½ä»¤å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æœ¬åœ°ä¸»æœºURLã€‚ å¦‚æœåœ¨è¡¨æ ¼ä¸­è¾“å…¥æŸä¸ªæ•°å­—ï¼Œåˆ™å¯ä»¥ç¡®å®šå®ƒæ˜¯å¦ç®€å•ã€‚ ç°åœ¨ï¼Œåœ¨å¼€å‘AssemblyScriptæ–¹é¢ï¼Œä»ç¼–å†™ä»£ç åˆ°åœ¨Node.jså’Œç½‘é¡µä¸Šä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å·²ç»èµ°äº†å¾ˆé•¿ä¸€æ®µè·¯ã€‚ <br><br><h2>  <font color="#3AC1EF">æ€»ç»“</font> </h2><br>  WebAssemblyä»¥åŠAssemblyScriptæ— æ³•ä»¥æŸç§æ–¹å¼ç¥å¥‡åœ°åŠ é€Ÿä»»ä½•ç«™ç‚¹ã€‚ ä½†æ˜¯Wasmä»æ¥æ²¡æœ‰æ‰¿æ‹…è¿‡ç»å¯¹åŠ é€Ÿæ‰€æœ‰ä»»åŠ¡çš„ä»»åŠ¡ã€‚ è¯¥æŠ€æœ¯çš„å“è¶Šä¹‹å¤„åœ¨äºå®ƒä¸ºæ–°å‹åº”ç”¨æ‰“å¼€äº†é€šå¾€ç½‘ç»œçš„é“è·¯ã€‚ <br><br> å…³äºAssemblyScriptï¼Œå¯ä»¥è¯´ç±»ä¼¼çš„è¯ã€‚ è¿™é¡¹æŠ€æœ¯ç®€åŒ–äº†è®¸å¤šå¼€å‘äººå‘˜å¯¹WebAssemblyçš„è®¿é—®ã€‚ å½“ä½¿ç”¨æ¥è¿‘JavaScriptçš„è¯­è¨€åˆ›å»ºä»£ç æ—¶ï¼Œå®ƒå…è®¸ä½¿ç”¨WebAssemblyçš„åŠŸèƒ½æ¥è§£å†³å¤æ‚çš„è®¡ç®—é—®é¢˜ã€‚ <br><br>  <b>äº²çˆ±çš„è¯»è€…ä»¬ï¼</b> æ‚¨å¦‚ä½•è¯„ä¼°åœ¨é¡¹ç›®ä¸­ä½¿ç”¨AssemblyScriptçš„å‰æ™¯ï¼Ÿ <br><br><div style="text-align:center;"> <a href="https://ruvds.com/vps_start/"><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN477272/">https://habr.com/ru/post/zh-CN477272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN477256/index.html">æ˜å¹´ï¼Œåœ¨è”ç›Ÿå·è¿è½½ç«ç®­ä¸Šé¦–æ¬¡æ­£å¼å‘å¸ƒOneWebï¼Œä»¥åŠåœ¨Angaraè¿è½½ç«ç®­ä¸Šå¯åŠ¨</a></li>
<li><a href="../zh-CN477262/index.html">Promobotå…¬å¸çš„Androidã€‚ ä¾§é¢å›¾</a></li>
<li><a href="../zh-CN477264/index.html">æŒ–æ˜æœºå˜æˆäº†èƒ½å¤Ÿç‹¬ç«‹æŒ–æ²Ÿçš„è‡ªä¸»æœºå™¨äºº</a></li>
<li><a href="../zh-CN477266/index.html">ä¸Šå‘¨ç¬¬390æœŸï¼ˆ2019å¹´11æœˆ18æ—¥è‡³24æ—¥ï¼‰æ¥è‡ªå‰ç«¯ä¸–ç•Œçš„æ–°é²œææ–™æ‘˜è¦</a></li>
<li><a href="../zh-CN477268/index.html">åœ¨githubä¸Šæœç´¢è§£å†³æ–¹æ¡ˆä¼˜åŒ–</a></li>
<li><a href="../zh-CN477274/index.html">æ‚¨å¦‚ä½•æ‘†è„±æœªä½¿ç”¨çš„CSSä»£ç ï¼Ÿ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN477276/index.html">æ‚¨å¦‚ä½•æ‘†è„±æœªä½¿ç”¨çš„CSSä»£ç ï¼Ÿ ç¬¬äºŒéƒ¨åˆ†</a></li>
<li><a href="../zh-CN477278/index.html">å‰ç«¯æµ‹è¯•</a></li>
<li><a href="../zh-CN477282/index.html">åˆ†æGoé¡¹ç›®ä»£ç å¹¶è§£å†³å†…å­˜åˆ†é…é—®é¢˜</a></li>
<li><a href="../zh-CN477284/index.html">ä¸ºä»€ä¹ˆJavaScriptéœ€è¦ä¸¥æ ¼æ¨¡å¼ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>