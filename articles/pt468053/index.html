<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•™ üóÇÔ∏è üöå Machine Learning para sua ca√ßa plana. Parte 1 ü§û üî¶ üëµüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voc√™ j√° procurou um apartamento? Deseja adicionar algum aprendizado de m√°quina e tornar um processo mais interessante? 



 Hoje, consideraremos a apl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Machine Learning para sua ca√ßa plana. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468053/"><p>  Voc√™ j√° procurou um apartamento?  Deseja adicionar algum aprendizado de m√°quina e tornar um processo mais interessante? </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="Apartamentos em Ecaterimburgo"></div><a name="habracut"></a><br><p>  Hoje, consideraremos a aplica√ß√£o do Machine Learning para encontrar um plano ideal. </p><br><h2 id="introduction">  1. Introdu√ß√£o </h2><br><p> Antes de tudo, quero esclarecer esse momento e explicar o que significa "um apartamento ideal".  √â um apartamento com um conjunto de caracter√≠sticas diferentes como "√°rea", "distrito", "n√∫mero de varandas" e assim por diante.  E para esses recursos do apartamento, esperamos um pre√ßo espec√≠fico.  Parece uma fun√ß√£o que usa v√°rios par√¢metros e retorna um n√∫mero.  Ou talvez uma caixa preta que ofere√ßa alguma m√°gica. </p><br><p>  Mas ... h√° um grande "mas", √†s vezes voc√™ pode enfrentar um apartamento muito caro por causa de um conjunto de raz√µes, como uma boa posi√ß√£o geogr√°fica.  Al√©m disso, existem distritos de maior prest√≠gio no centro de uma cidade e distritos fora da cidade.  Ou ... √†s vezes as pessoas querem vender seus apartamentos porque se mudam para outro ponto da Terra.  Em outras palavras, existem muitos fatores que podem afetar o pre√ßo.  Parece familiar? </p><br><h2 id="little-stepaside">  Pequeno passo de lado </h2><br><p>  Antes de continuar, deixe-me fazer uma pequena digress√£o l√≠rica. <br>  Morei em Yekaterinburg (a cidade entre a Europa e a √Åsia, uma das cidades que realizou o Campeonato Mundial de Futebol em 2018) por 5 anos. </p><br><p>  Eu estava apaixonado por essas selvas de concreto.  E eu odiava aquela cidade no inverno e nos transportes p√∫blicos.  √â uma cidade em crescimento e todos os meses h√° milhares e milhares de apartamentos a serem vendidos. </p><br><p>  Sim, √© uma cidade superlotada e polu√≠da.  Ao mesmo tempo - √© um bom lugar para analisar um mercado imobili√°rio.  Recebi muitos an√∫ncios de apartamentos da Internet.  E usarei essas informa√ß√µes para uma extens√£o adicional. </p><br><p>  Al√©m disso, tentei visualizar diferentes ofertas no mapa de Ecaterimburgo.  Sim, √© a imagem do habracut, feita no Kepler.gl </p><br><p><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="imagem"></p><br><p>  Existem mais de 2 mil apartamentos de 1 quarto que foram vendidos em julho de 2019 em Ecaterimburgo.  Eles tinham um pre√ßo diferente, de menos de um milh√£o a quase 14 milh√µes de rublos. </p><br><p>  Esses pontos se referem √† sua posi√ß√£o geogr√°fica.  A cor dos pontos no mapa representa o pre√ßo, quanto menor o pre√ßo pr√≥ximo √† cor azul, maior o pre√ßo pr√≥ximo ao vermelho.  Voc√™ pode considerar isso como uma analogia com cores frias e quentes, a cor mais quente √© o maior pre√ßo. <br>  Por favor, lembre-se daquele momento, quanto mais vermelha √© a cor, maior √© o valor de alguma coisa.  A mesma id√©ia funciona para o azul, mas na dire√ß√£o do pre√ßo mais baixo. </p><br><p>  Agora voc√™ est√° tendo uma vis√£o <em>geral</em> da imagem e o tempo para analisar est√° chegando. </p><br><h3 id="goal">  Objetivo </h3><br><p>  O que eu queria quando morei em Ecaterimburgo?  Procurei um apartamento suficientemente bom ou, se falarmos em termos de ML - queria construir um modelo que me recomendasse a compra. </p><br><p>  Por um lado, se um flat for muito caro, o modelo deve recomendar a espera pela diminui√ß√£o do pre√ßo, mostrando o pre√ßo esperado para esse flat. <br>  Por outro lado - se um pre√ßo √© bom o suficiente, de acordo com o estado do mercado - talvez eu deva considerar essa oferta. </p><br><p>  Claro, n√£o h√° nada ideal e eu estava pronto para aceitar um erro nos c√°lculos.  Normalmente, para esse tipo de tarefa, use erro m√©dio de previs√£o e eu estava pronto para um erro de 10%.  Por exemplo, se voc√™ tiver 2 a 3 milh√µes de rublos russos, poder√° ignorar erros entre 200 e 300 mil, poder√° pagar.  Como me pareceu. </p><br><h2 id="preparing">  Preparar </h2><br><p>  Como mencionei antes, havia muitos apartamentos, vamos examin√°-los de perto. <br>  importar pandas como pd </p><br><pre><code class="python hljs">df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'flats.csv'</span></span>) df.shape</code> </pre> <br><p><img src="https://habrastorage.org/webt/qx/_0/qg/qx_0qgrsiuprxgsbno2ccihjdia.png" alt="imagem"></p><br><p>  2310 apartamentos por um m√™s, podemos extrair algo √∫til disso.  Que tal uma vis√£o geral geral dos dados? </p><br><pre> <code class="python hljs">df.describe()</code> </pre> <br><p><img src="https://habrastorage.org/webt/is/pi/tj/ispitjyk3gpg-cbkhwfwnrayloa.png" alt="imagem"><br>  N√£o h√° algo extraordin√°rio - longitude, latitude, pre√ßo de um apartamento (o r√≥tulo " <em>custo</em> ") e assim por diante.  Sim, naquele momento usei " <em>custo</em> " em vez de " <em>pre√ßo</em> ", espero que n√£o leve a mal-entendidos, considere-os como iguais. </p><br><h2 id="cleaning">  Limpeza </h2><br><p>  Todo registro tem o mesmo significado?  Alguns deles s√£o apartamentos representados como um cub√≠culo, voc√™ pode trabalhar l√°, mas n√£o gostaria de morar l√°.  S√£o pequenos quartos apertados, n√£o um apartamento de verdade.  Vamos remov√™-los. </p><br><pre> <code class="python hljs">df = df[df.total_area &gt;= <span class="hljs-number"><span class="hljs-number">20</span></span>]</code> </pre> <br><p>  O pre√ßo previsto do apartamento vem das quest√µes mais antigas da economia e de √°reas afins.  N√£o havia nada relacionado ao termo "ML" e as pessoas tentavam adivinhar o pre√ßo com base em metros quadrados / p√©s. <br>  Ent√£o, olhamos para essas colunas / etiquetas e tentamos obter a distribui√ß√£o delas. </p><br><pre> <code class="python hljs">numerical_fields = [<span class="hljs-string"><span class="hljs-string">'total_area'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> numerical_fields: mask = ~np.isnan(df[col]) sns.distplot(df[col][mask], color=<span class="hljs-string"><span class="hljs-string">"r"</span></span>,label=col) plot.show()</code> </pre> <br><p><img src="https://habrastorage.org/webt/w2/kj/eq/w2kjeqg-gr-qzcum6hcgqnoz6eo.png" alt="imagem"></p><br><p>  Bem ... n√£o h√° nada de especial, parece uma distribui√ß√£o normal.  Talvez n√≥s precisamos ir mais fundo? </p><br><pre> <code class="python hljs">sns.pairplot(df[numerical_fields])</code> </pre> <br><p><img src="https://habrastorage.org/webt/df/fw/lg/dffwlggd_vemlbfl96qdw-0h3fw.png" alt="imagem"></p><br><p>  Opa ... Algo errado est√° a√≠.  Limpe os valores discrepantes nesses campos e tente analisar nossos dados novamente. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#Remove outliers df = df[abs(df.total_area - df.total_area.mean()) &lt;= (3 * df.total_area.std())] df = df[abs(df.cost - df.cost.mean()) &lt;= (3 * df.cost.std())] #Redraw our data sns.pairplot(df[numerical_fields])</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/uu/zp/ok/uuzpokfgmae_4d2bxqvsmp53jns.png" alt="imagem"></p><br><p>  Os outliers desapareceram e agora parece melhor. </p><br><h2 id="transformation">  Transforma√ß√£o </h2><br><p>  O r√≥tulo "ano", que √© apontado para um ano de constru√ß√£o, deve ser transformado em algo mais informativo.  Que seja a era da constru√ß√£o, em outras palavras, como uma casa espec√≠fica √© antiga. </p><br><pre> <code class="python hljs">df[<span class="hljs-string"><span class="hljs-string">'age'</span></span>] = <span class="hljs-number"><span class="hljs-number">2019</span></span> -df[<span class="hljs-string"><span class="hljs-string">'year'</span></span>]</code> </pre> <br><p>  Vamos dar uma olhada no resultado. </p><br><pre> <code class="python hljs">df.head()</code> </pre> <br><p><img src="https://habrastorage.org/webt/wq/j_/h-/wqj_h-w8jwshp3fi0ofyhhuanca.png" alt="imagem"></p><br><p>  Existem todos os tipos de dados, categ√≥ricos, valores nanom√©tricos, descri√ß√£o de texto e algumas informa√ß√µes geogr√°ficas (longitude e latitude).  Deixemos de lado os √∫ltimos, porque nesse est√°gio eles s√£o in√∫teis.  Voltaremos a eles mais tarde. </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">"lon"</span></span>,<span class="hljs-string"><span class="hljs-string">"lat"</span></span>,<span class="hljs-string"><span class="hljs-string">"description"</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h3 id="categorical-data">  Dados categ√≥ricos </h3><br><p>  Geralmente, para dados categ√≥ricos, as pessoas usam diferentes tipos de codifica√ß√£o ou coisas como o CatBoost, que oferecem uma oportunidade de trabalhar com eles, como nas vari√°veis ‚Äã‚Äãnum√©ricas. <br>  Mas, poder√≠amos usar algo mais l√≥gico e mais intuitivo?  Agora √© hora de tornar nossos dados mais compreens√≠veis sem perder o significado deles. </p><br><h3 id="districts">  Distritos </h3><br><p>  Bem, existem mais de vinte distritos poss√≠veis, podemos adicionar mais de 20 vari√°veis ‚Äã‚Äãadicionais em nosso modelo?  Claro que poder√≠amos, mas ... dever√≠amos?  Somos pessoas e poder√≠amos comparar as coisas, n√£o √©? <br>  Primeiro de tudo - nem todo distrito √© equivalente a outro.  No centro da cidade, os pre√ßos de um metro quadrado s√£o mais altos, mais longe do centro da cidade - ela passa a diminuir.  Parece l√≥gico?  Podemos usar isso? <br>  Sim, definitivamente poder√≠amos combinar qualquer distrito com um coeficiente espec√≠fico e, quanto mais distrito, mais baratos os apartamentos. </p><br><p>  Depois de corresponder a cidade e usar outro mapa de servi√ßo da web (ArcGIS Online), mudou e tem uma vis√£o semelhante <br><img src="https://habrastorage.org/webt/ji/a6/sw/jia6swan_kxipvxp4y2p1ycfqk4.png" alt="imagem"></p><br><p>  Eu usei a mesma ideia que para a visualiza√ß√£o de flat.  O distrito mais "prestigioso" e "caro" colorido em vermelho e menos azul.  A temperatura da cor, voc√™ se lembra disso? <br>  Al√©m disso, devemos fazer alguma manipula√ß√£o sobre nosso quadro de dados. </p><br><pre> <code class="python hljs">district_map = {<span class="hljs-string"><span class="hljs-string">'alpha'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'beta'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, ... <span class="hljs-string"><span class="hljs-string">'delta'</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>, ... <span class="hljs-string"><span class="hljs-string">'epsilon'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} df.district = df.district.str.lower() df.replace({<span class="hljs-string"><span class="hljs-string">"district"</span></span>: district_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  A mesma abordagem ser√° usada para descrever a qualidade interna do apartamento.  √Äs vezes, precisa de algum reparo, √†s vezes plana √© muito bem e pronta para viver.  E em outros casos, voc√™ deve gastar dinheiro adicional para melhorar a apar√™ncia (trocar torneiras, pintar paredes).  Tamb√©m pode haver coeficientes de uso. </p><br><pre> <code class="python hljs">repair = {<span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-number"><span class="hljs-number">0.6</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-number"><span class="hljs-number">0.7</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>} df.repair.fillna(<span class="hljs-string"><span class="hljs-string">'D'</span></span>, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.replace({<span class="hljs-string"><span class="hljs-string">"repair"</span></span>: repair}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  A prop√≥sito, sobre paredes.  Claro, tamb√©m influencia no pre√ßo do apartamento.  O material moderno √© melhor que o antigo, o tijolo √© melhor que o concreto.  Paredes de madeira √© um momento bastante controverso, talvez seja uma boa escolha para o campo, mas n√£o t√£o bom para a vida urbana. </p><br><p>  Usamos a mesma abordagem de antes, al√©m de sugerir linhas que n√£o sabemos de nada.  Sim, √†s vezes as pessoas n√£o fornecem todas as informa√ß√µes sobre seu apartamento.  Al√©m disso, com base na hist√≥ria, podemos tentar adivinhar o material das paredes.  Em um per√≠odo espec√≠fico de tempo (por exemplo, o per√≠odo de lideran√ßa de Khrushchev) - conhecemos o material t√≠pico para a constru√ß√£o. </p><br><pre> <code class="python hljs">walls_map = {<span class="hljs-string"><span class="hljs-string">'brick'</span></span>: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, ... <span class="hljs-string"><span class="hljs-string">'concrete'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-string"><span class="hljs-string">'block'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, ... <span class="hljs-string"><span class="hljs-string">'monolith'</span></span>: <span class="hljs-number"><span class="hljs-number">0.9</span></span>, <span class="hljs-string"><span class="hljs-string">'wood'</span></span>: <span class="hljs-number"><span class="hljs-number">0.4</span></span>} mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2010</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'monolith'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2000</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'concrete'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">1990</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> df.replace({<span class="hljs-string"><span class="hljs-string">"walls"</span></span>: walls_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'year'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Al√©m disso, h√° informa√ß√µes sobre a varanda.  Na minha humilde opini√£o - a varanda √© uma coisa realmente √∫til, ent√£o eu n√£o pude evitar pensar nisso. <br>  Infelizmente, existem alguns valores nulos.  Se o autor de um an√∫ncio tivesse verificado informa√ß√µes sobre ele, ter√≠amos informa√ß√µes mais realistas. <br>  Bem, se n√£o houver informa√ß√µes, isso significa "n√£o h√° varanda". </p><br><pre> <code class="python hljs">df.balcony.fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>,inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Depois disso, lan√ßamos colunas com informa√ß√µes sobre o ano de constru√ß√£o (temos uma boa alternativa para isso).  Al√©m disso, removemos a coluna com informa√ß√µes sobre o tipo de constru√ß√£o, pois possui muitos valores de NaN e n√£o encontrei nenhuma oportunidade de preencher essas lacunas.  E eliminamos todas as linhas com NaN que temos. </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'type_house'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df = df.astype(np.float64) df.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h2 id="checking">  Verificando </h2><br><p>  Ent√£o ... usamos uma abordagem n√£o padr√£o e substitu√≠mos os valores categ√≥ricos pela representa√ß√£o num√©rica.  E agora terminamos com uma transforma√ß√£o de nossos dados. <br>  Uma parte dos dados foi descartada, mas, em geral, √© um conjunto de dados bastante bom.  Vamos olhar para a correla√ß√£o entre vari√°veis ‚Äã‚Äãindependentes. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_correlation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(df)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"whitegrid"</span></span>) corr = df.corr() * <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-comment"><span class="hljs-comment"># Select upper triangle of correlation matrix mask = np.zeros_like(corr, dtype=np.bool) mask[np.triu_indices_from(mask)] = True # Set up the matplotlib figure f, ax = plt.subplots(figsize=(15, 11)) # Generate a custom diverging colormap cmap = sns.diverging_palette(220, 10) # Draw the heatmap with the mask and correct aspect ratio sns.heatmap(corr, mask=mask, cmap=cmap, center=0, linewidths=1, cbar_kws={"shrink": .7}, annot=True, fmt=".2f") plot.show() # df[columns] = scale(df[columns]) return df df1 = show_correlation(df.drop(columns=['cost']))</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/ht/dv/ir/htdvirxheiytace3nmaujf3wet8.png" alt="imagem"></p><br><p>  Erm ... ficou muito interessante. <br>  <strong>Correla√ß√£o positiva</strong> <br>  <em>√Årea total - varandas</em> .  Porque n√£o  Se o nosso apartamento for grande, haver√° uma varanda. <br>  <strong>Correla√ß√£o negativa</strong> <br>  <em>√Årea total - idade</em> .  Quanto mais novo √© plano, maior √© a √°rea para morar.  Parece l√≥gico, os novos s√£o mais espa√ßosos e planos do que os mais antigos. <br>  <em>Idade - varanda</em> .  Quanto mais velho for plano, menos varandas ter√°.  Parece uma correla√ß√£o atrav√©s de outra vari√°vel.  Talvez seja um tri√¢ngulo Idade-Varanda-√Årea em que uma vari√°vel exerce influ√™ncia impl√≠cita em outra.  Coloque isso em espera por um tempo. <br>  <em>Idade - distrito.</em>  O apartamento mais antigo √© a grande probabilidade que ser√° colocada nos distritos de maior prest√≠gio.  Poderia estar relacionado a pre√ßos mais altos perto do centro? </p><br><p>  Al√©m disso, pudemos ver a correla√ß√£o com a vari√°vel dependente </p><br><pre> <code class="python hljs">plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>)) corr = df.corr()*<span class="hljs-number"><span class="hljs-number">100.0</span></span> sns.heatmap(corr[[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]], cmap= sns.diverging_palette(<span class="hljs-number"><span class="hljs-number">220</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), center=<span class="hljs-number"><span class="hljs-number">0</span></span>, linewidths=<span class="hljs-number"><span class="hljs-number">1</span></span>, cbar_kws={<span class="hljs-string"><span class="hljs-string">"shrink"</span></span>: <span class="hljs-number"><span class="hljs-number">.7</span></span>}, annot=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, fmt=<span class="hljs-string"><span class="hljs-string">".2f"</span></span>)</code> </pre> <br><p><img src="https://habrastorage.org/webt/o7/ax/m1/o7axm1zph-x3eterypsfcod38zo.png" alt="imagem"></p><br><p>  Aqui vamos n√≥s ... </p><br><p>  A correla√ß√£o muito forte entre a √°rea de apartamento e pre√ßo.  Se voc√™ quer ter um lugar maior para morar, isso exigir√° mais dinheiro. <br>  Existe uma correla√ß√£o negativa entre os pares " <em>idade / custo</em> " e " <em>distrito / custo</em> ".  Um apartamento em uma casa mais nova, menos acess√≠vel que a antiga.  E no campo os apartamentos s√£o mais baratos. <br>  De qualquer forma, parece claro e compreens√≠vel, ent√£o decidi seguir em frente. </p><br><h2 id="model">  Modelo </h2><br><p>  Para tarefas relacionadas ao pre√ßo do plano de previs√£o normalmente, use regress√£o linear.  De acordo com uma correla√ß√£o significativa de um est√°gio anterior, poder√≠amos tentar us√°-lo tamb√©m.  √â um cavalo de trabalho que √© adequado para muitas tarefas. <br>  Prepare nossos dados para as pr√≥ximas a√ß√µes </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split y = df.cost X = df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]) X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number"><span class="hljs-number">0.2</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">42</span></span>)</code> </pre> <br><p>  Al√©m disso, criamos algumas fun√ß√µes simples para previs√£o e avalia√ß√£o do resultado.  Vamos fazer a nossa primeira tentativa de prever o pre√ßo! </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y_test, model)</span></span></span><span class="hljs-function">:</span></span> y = model.predict(X) score = round((r2_score(y_test, y) * <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>) print(<span class="hljs-string"><span class="hljs-string">f'Score on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{score}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, regressor)</span></span></span><span class="hljs-function">:</span></span> model = regressor.fit(X, y) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.linear_model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LinearRegression regressor = LinearRegression() model = train_model(X_train, y_train, regressor) predict(X_test, y_test, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/ak/v3/_a/akv3_antf7wwaxndcpjwx90rvju.png" alt="imagem"></p><br><p>  Bem ... 76,67% de precis√£o.  √â um n√∫mero grande ou n√£o?  De acordo com o meu ponto de vista, n√£o √© ruim.  Al√©m disso, √© um bom ponto de partida.  Obviamente, n√£o √© o ideal e existe um potencial de melhoria. </p><br><p>  Ao mesmo tempo - tentamos prever apenas uma parte dos dados.  Que tal aplicar a mesma estrat√©gia para outros dados?  Sim, hora da valida√ß√£o cruzada. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_cross_validation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, model)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KFold, cross_val_score regressor_name = model.__class__.__name__ fold = KFold(n_splits=<span class="hljs-number"><span class="hljs-number">10</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">0</span></span>) scores_on_this_split = cross_val_score(estimator=model, X=X, y=y, cv=fold, scoring=<span class="hljs-string"><span class="hljs-string">'r2'</span></span>) scores_on_this_split = np.round(scores_on_this_split * <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) mean_accuracy = scores_on_this_split.mean() print(<span class="hljs-string"><span class="hljs-string">f'Crossvaladaion accuracy on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{mean_accuracy}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mean_accuracy do_cross_validation(X, y, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/yn/uf/3y/ynuf3yr9ew4kgjrvnb-nifevbnq.png" alt="imagem"></p><br><p>  O resultado da valida√ß√£o cruzadaAgora, levamos outro resultado.  73 √© menor que 76. Mas tamb√©m √© um bom candidato at√© o momento em que teremos um melhor.  Al√©m disso, significa que uma regress√£o linear funciona bastante est√°vel em nosso conjunto de dados. </p><br><p>  E agora √© a hora do √∫ltimo passo. </p><br><p>  Veremos a melhor caracter√≠stica da regress√£o linear - <strong>interpretabilidade</strong> . <br>  Essa fam√≠lia de modelos, ao contr√°rio dos modelos mais complexos, tem maior capacidade de compreens√£o.  Existem apenas alguns n√∫meros com coeficientes e voc√™ pode colocar seus n√∫meros na equa√ß√£o, fazer algumas contas simples e obter um resultado. </p><br><p>  Vamos tentar interpretar nosso modelo </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">estimate_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(model)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"white"</span></span>, context=<span class="hljs-string"><span class="hljs-string">"talk"</span></span>) f, ax = plot.subplots(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), sharex=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) sns.barplot(x=model.coef_, y=X.columns, palette=<span class="hljs-string"><span class="hljs-string">"vlag"</span></span>, ax=ax) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(model.coef_.astype(int)): ax.text(v + <span class="hljs-number"><span class="hljs-number">3</span></span>, i + <span class="hljs-number"><span class="hljs-number">.25</span></span>, str(v), color=<span class="hljs-string"><span class="hljs-string">'black'</span></span>) ax.set_title(<span class="hljs-string"><span class="hljs-string">f"Coefficients"</span></span>) estimate_model(regressor)</code> </pre> <br><p><img src="https://habrastorage.org/webt/1j/bc/_a/1jbc_apacascsr3cakmwz4qbnu8.png" alt="Os coeficientes do nosso modelo"></p><br><p>  A imagem parece bastante l√≥gica.  <em>Varanda / Paredes / √Årea / Repara√ß√£o</em> d√£o uma contribui√ß√£o <strong>positiva</strong> a um pre√ßo fixo. <br>  Quanto mais plano, maior a <strong>contribui√ß√£o negativa</strong> .  Tamb√©m aplic√°vel para a idade.  O apartamento mais antigo √© o pre√ßo mais baixo ser√°. </p><br><p>  Ent√£o, foi uma jornada fascinante. <br>  Come√ßamos do zero, usamos a abordagem at√≠pica para transforma√ß√£o de dados com base no ponto de vista humano (n√∫meros em vez de vari√°veis ‚Äã‚Äãfict√≠cias), vari√°veis ‚Äã‚Äãverificadas e sua rela√ß√£o entre si.  Depois disso, constru√≠mos nosso modelo simples, usado a valida√ß√£o cruzada para testar seus.  E como a cereja no topo do bolo - observe as caracter√≠sticas internas do modelo, o que nos d√° confian√ßa sobre o nosso caminho. </p><br><p>  Mas!  N√£o √© o fim de nossa jornada, mas apenas uma pausa.  Vamos tentar mudar nosso modelo no futuro e talvez (apenas talvez) aumente a precis√£o da previs√£o. </p><br><p>  <strong>Obrigado pela leitura!</strong> </p><br><blockquote>  A segunda parte est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">l√°</a> <br></blockquote><p>  PS Os dados de origem e o notebook Ipython est√£o localizados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">l√°</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468053/">https://habr.com/ru/post/pt468053/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468041/index.html">An√∫ncio da interface da web do Kubernetes Web View (e uma breve vis√£o geral de outras UIs da web para o Kubernetes)</a></li>
<li><a href="../pt468043/index.html">Como criar um kit de interface do usu√°rio que est√° √† venda. Etapas do desenvolvimento de um sistema de design comercial</a></li>
<li><a href="../pt468047/index.html">Trabalhando com hierarquias no lsFusion</a></li>
<li><a href="../pt468049/index.html">Usando o werf para implementar gr√°ficos Helm complexos</a></li>
<li><a href="../pt468051/index.html">VDS com Windows Server licenciado por 100 rublos: mito ou realidade?</a></li>
<li><a href="../pt468057/index.html">Desenvolvimento de sistema operacional Unix-like - Multitarefa e chamadas de sistema (7)</a></li>
<li><a href="../pt468059/index.html">Minha segunda semana com o Haiku: muitos diamantes escondidos e surpresas agrad√°veis, al√©m de alguns problemas</a></li>
<li><a href="../pt468061/index.html">Cron no Linux: hist√≥rico, uso e dispositivo</a></li>
<li><a href="../pt468063/index.html">Angulareact</a></li>
<li><a href="../pt468065/index.html">Modelos de gerenciamento de produtos mentais para todos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>