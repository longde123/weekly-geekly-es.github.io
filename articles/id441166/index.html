<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥… ğŸ â›©ï¸ Kami mendapatkan kata sandi utama dari pengelola kata sandi yang terkunci 1 Kata sandi 4 ğŸ‘¨â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ ğŸ‘©ğŸ¼â€ğŸš€ ğŸ¤¸ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alat baru, metode lama. Kami merekayasa balik dan menemukan kesalahan fatal 1Password. 

 Semua orang menyukai pengelola kata sandi. Mereka hebat kare...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami mendapatkan kata sandi utama dari pengelola kata sandi yang terkunci 1 Kata sandi 4</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441166/">  <b>Alat baru, metode lama.</b>  <b>Kami merekayasa balik dan menemukan kesalahan fatal 1Password.</b> <br><br>  Semua orang menyukai pengelola kata sandi.  Mereka hebat karena banyak alasan.  Secara pribadi, saya memiliki lebih dari 200 entri di manajer.  Dengan begitu banyak data rahasia di satu tempat, penting untuk memahami sejauh mana kerusakan jika catatan Anda dikompromikan, baik itu malware, eksploitasi atau hanya komputer yang tidak dijaga selama beberapa menit.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Washington Post</a> baru-baru ini menerbitkan sebuah artikel berdasarkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">penelitian</a> kami.  Artikel ini membantu membuat orang sadar bahwa tidak semua pengelola kata sandi sama. <br><br>  Saya sangat yakin bahwa pengelola kata sandi yang terkunci dilindungi dengan baik.  Jika seseorang mendapatkan akses ke komputer saya, maka maksimum dapat mengandalkan banyak byte acak, karena informasi tersebut dapat dipercaya dihapus dari memori. <br><a name="habracut"></a><br>  Ini berlaku untuk 1Password 4 (Perhatikan bahwa versi terbaru adalah yang ketujuh hari ini).  Sebelum beralih ke beberapa tahun yang lalu, saya memeriksa bahwa benar-benar tidak ada kata sandi yang jelas ketika manajer dalam keadaan terkunci.  Jadi dalam kasus kompromi, penyerang harus berurusan dengan penyimpanan terenkripsi. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/527/994/2ed/5279942edfcbb8687d113731500b6953.png"></div><br>  <i><font color="gray">Lemari besi terkunci!</font></i> <br><br>  Dalam kondisi ini, tidak ada entri kata sandi atau kata sandi master.  Sangat masuk akal dan benar, dan 1Password 4 lulus tes ini.  Atau tidak? <br><br>  Untuk menghilangkan detail yang membosankan, saya akan katakan segera: kami dapat memulihkan kata sandi utama dari instance yang terkunci di 1Password 4, seperti yang ditunjukkan di bawah ini. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ad/2c0/d81/0ad2c0d817dd2dc75a942e5b2bd5b974.gif"><br>  <i><font color="gray">Buka kunci 1Password 4 dan pulihkan kata sandi utama Anda</font></i> <br><br>  Animasi menunjukkan bahwa 1Password 4 pertama kali dibuka dengan cara normal, dan kemudian dikunci.  Setelah itu, kami menjalankan utilitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">multipass</a> kami, yang berhasil memulihkan kata sandi.  Utilitas mengeksploitasi pemrosesan yang salah dari bidang input kata sandi di 1Password 4 untuk mengembalikan buffer kata sandi master yang dikaburkan, menghapusnya, secara otomatis membuka kunci 1Password 4, dan akhirnya menampilkan kata sandi master di konsol. <br><br><h1>  Detail yang membosankan </h1><br>  Langkah pertama dalam mengevaluasi manajer kata sandi adalah memeriksa kata sandi master yang jelas dalam memori.  Ini dimungkinkan di hex editor apa pun yang dapat berinteraksi dengan ruang memori proses.  Misalnya, editor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">HxD</a> gratis.  Gunakan untuk membuka ruang memori 1Password 4. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38d/87b/b48/38d87bb48b7c4b87f39e44a990cd3f74.png"></div><br><br>  Kami segera jatuh ke area pertama yang dapat dibaca dari ruang memori 1Password 4. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef4/e95/f2d/ef4e95f2d092a6f236ba53fdfd090787.png"></div><br>  <i><font color="gray">Contoh representasi memori HxD</font></i> <br><br>  Belum ada yang istimewa.  Tetapi Anda dapat melakukan pencarian.  Misalnya, seperti apa situasinya jika Anda mengetikkan kata sandi di jendela buka 1Password 4, tetapi jangan klik tombol "Buka Kunci": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6c/d9c/08b/e6cd9c08bee8130e7775a51bd7a91ad0.png"></div><br>  <i><font color="gray">Brankas terkunci 1 Kata sandi 4 dengan kata sandi master yang dimasukkan di bidang</font></i> <br><br>  Tentunya kata sandi ada di suatu tempat di memori? <br><br>  Kami membuka HxD, tetapi mencari baris dengan kata sandi master kami ("Z3Superpass #") tidak membuahkan hasil. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b41/066/2c0/b410662c04b7e3d642f05ef94eacc7da.png"></div><br><br>  Tampaknya 1Password entah bagaimana mengenkripsi atau mengaburkan formulir saat dimasukkan.  Jika prosedur ini bekerja dengan benar, maka semuanya baik-baik saja. <br><br><h1>  Menyelam lebih dalam </h1><br>  Untuk mengetahui mengapa kata sandi utama tidak dapat ditemukan dalam memori ketika kata sandi itu jelas ada di kotak dialog buka kunci, Anda harus menemukan kode yang berinteraksi dengannya.  Ada beberapa cara.  Anda dapat melacak pemrosesan acara keyboard dan mouse dengan melokalisasi 'GetMessage', 'PeekMessage', 'GetWindowText', atau Windows API lain yang biasanya menangani input pengguna.  Jadi kami menemukan buffer tempat penekanan tombol direkam, dan melaluinya kami pergi ke rutin enkripsi / kebingungan.  Tetapi ini adalah proses yang panjang dan rawan kesalahan, terutama dengan kerangka kerja besar yang terkadang mengelola memori dengan sangat aneh, jadi Anda harus membuat banyak salinan dan konversi untuk melacak buffer. <br><br>  Sebagai gantinya, kami menggunakan alat Imager Thread kami sendiri, yang dirancang untuk merekayasa balik protokol kepemilikan "aneh" di tingkat aplikasi.  Ini akan membantu Anda menentukan di mana di memori 1Password 4 berinteraksi dengan kata sandi utama kami.  Alat "secara otomatis" mengidentifikasi area kode dalam 1Password 4 yang berinteraksi dengan kata sandi yang dikaburkan (itu hanya menyoroti instruksi yang berinteraksi dengan data yang menarik untuk analisis lebih lanjut).  Hasilnya terlihat seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6b/c11/157/b6bc1115787869abc9ba25719b7c060a.gif"><br>  <i><font color="gray">Imager Thread menemukan kode 1Password 4 yang berinteraksi dengan kata sandi master yang tidak fokus</font></i> <br><br>  Karena kata sandi utama disimpan dalam memori dalam bentuk yang dikaburkan, alat harus terlebih dahulu menunjukkan di mana kebingungan terjadi. <br><br>  Sebuah fragmen dari hasil pertama menunjukkan bahwa penampilan pertama dari kata sandi utama disertai dengan transisi kode dari alamat 0x7707A75D ke 0x701CFA10. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49b/f32/d7a/49bf32d7a1f5b0bf01f12f7d47685dea.png"></div><br>  <i><font color="gray">Entri terperinci di Thread Imager menyoroti transisi kode dari 0x7707A75D ke 0x701CFA10, sementara register EAX dan ECX merujuk ke buffer dengan kata sandi master</font></i> <br><br>  Meneliti tempat ini 0x7707A75D di debugger (x64dbg) mengkonfirmasi teori kami.  Memang, untuk pertama kalinya, string 'Z3superpass #' terjadi ketika fungsi decoding 'RtlRunDecodeUnicodeString' dari pustaka ntdll.dll berakhir. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/173/cd8/1bb/173cd81bba5c294f9e21c139610ee290.png"><br><br>  Setelah sedikit analisis, jelas bahwa kedua fungsi ini digunakan untuk mengaburkan kata sandi: 'RtlRunEncodeUnicodeString' dan 'RtlRunDecodeUnicodeString'.  Jadi kata sandi utama disembunyikan dari penyalinan primitif dari memori, itulah sebabnya kami sebelumnya tidak dapat menemukannya di hex editor. <br><br>  Jika Anda mempelajari buffer yang disandikan di akhir fungsi RtlRunEncodeUnicodeString, maka baris terenkripsi dengan kata sandi master terlihat seperti ini: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d47/547/aec/d47547aecf337b3c33206ddbe3bbad97.png"></div><br>  <i><font color="gray">Kata Sandi Utama Terenkripsi</font></i> <br><br>  Setelah RtlRunDecodeUnicodeString 'itu diterjemahkan: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/204/85b/b2b/20485bb2b8b6f40b6509db04bcedf5b1.png"></div><br>  <i><font color="gray">Kata Sandi Utama Terdekripsi</font></i> <br><br>  Menariknya, area ini disimpan di alamat yang sama 0x00DFA790 dan kami benar-benar dapat mengamati perubahannya ketika memasukkan kata sandi di jendela buka kunci 1Password 4: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cf/d32/83f/3cfd3283fef38c3e5ef0a62630b4372b.gif"></div><br><br><h1>  Kerentanan </h1><br>  'RtlRunEncodeUnicodeString' dan 'RtlRunDecodeUnicodeString' adalah fungsi sederhana yang memodifikasi string dengan operasi XOR sederhana.  Ini tidak terlalu buruk: tampaknya merupakan metode standar untuk menutupi semua kontrol pengeditan Windows asli dengan set flag 'ES_PASSWORD'. <br><br>  Masalahnya adalah bahwa setelah membuka kunci 1Password 4, kata sandi utama yang dienkripsi tidak dihapus dari memori. <br><br>  Lebih buruk lagi, itu tetap ada dalam memori bahkan setelah 1Password 4. Terkunci, yaitu kita memiliki penyimpanan kata sandi yang terkunci, tetapi dengan kata sandi utama yang dienkripsi dalam memori. <br><br>  Dan lebih buruk lagi, karena kita berinteraksi dengan kotak dialog input kata sandi master, area memori yang sama digunakan kembali dengan nilai XOR yang sama, yang memberi kita akses mudah ke buffer yang disandikan untuk membuat exploit. <br><br><h1>  Tantangan </h1><br>  Untuk membuat exploit yang andal untuk 1Password 4, Anda perlu mendapatkan gambaran yang lebih jelas tentang bagaimana kata sandi master diproses oleh alur kerja program.  Dengan menggunakan alat-alat yang disebutkan di atas, kami membangun diagram data keluaran (lihat gambar di bawah). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/453/5e4/763/4535e476369c9114c5fd62f1ec7480c6.png"><br><br>  Diagram ini memudahkan untuk memahami di mana dan perpustakaan mana yang terlibat untuk mengidentifikasi area dalam memori di mana Anda dapat mengambil kata sandi master dengan andal. <br><br><h1>  Eksploitasi </h1><br>  Apa yang kita miliki saat ini?  Kami memiliki penyimpanan yang terkunci, dan di suatu tempat di memori tersimpan kata sandi yang tidak jelas, karena program tidak membersihkan memori dengan benar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a77/ac0/8f1/a77ac08f195de46d8e546b1f43ab1415.png"></div><br><br>  Untuk mengambilnya, Anda harus memanggil prosedur di 1 Kata Kunci 4, yang menginisiasi 'RtlRunEncodeUnicodeString' dan 'RtlRunDecodeUnicodeString'.  Dengan demikian, ini akan menunjukkan lokasi buffer memori dengan kata sandi utama yang disandikan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d47/547/aec/d47547aecf337b3c33206ddbe3bbad97.png"></div><br>  <i><font color="gray">Area memori dengan kata sandi utama yang dikaburkan</font></i> <br><br>  Tanpa buffer ini, orang harus terjun ke jurang prosedur internal dan kontrol Windows dan mekanisme manajemen memori terkait.  Mungkin analisis ini membuatnya mudah untuk menemukan penyangga, tetapi kami tidak melakukannya. <br><br>  Tampaknya satu-satunya cara untuk memanggil 'RtlRunEncodeUnicodeString' dan 'RtlRunDecodeUnicodeString' adalah dengan memasukkan kata sandi utama dalam karakter di kotak dialog.  Jadi kita mendapatkan buffer yang diinginkan.  Tapi kita tidak tahu panjang kata sandinya. <br><br>  Kami memecahkan masalah ini dengan mencegat kode yang mengakses karakter pertama buffer kami, memblokir upaya untuk berubah.  Rutin ini ada di loop pesan kontrol di comctl32, yang menangani kontrol buffer elemen yang sesuai.  Memanggil 'memmove' dengan offset 0x70191731 menimpa buffer dengan karakter yang dimasukkan: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/676/8a9/351/6768a9351ed39fe85a98ca9d01368586.png"></div><br>  <i><font color="gray">(Efek samping: garis yang disorot (kuning) memperbarui seluruh kata sandi)</font></i> <br><br>  Sekarang kami akhirnya mendapatkan semua yang kami butuhkan untuk membuat exploit.  Langkah-langkah berikut akan memungkinkan kami untuk mengekstrak kata sandi utama: <br><br><ol><li>  Kaitkan 'memmove' untuk mencegah menimpa byte pertama dari kata sandi utama. <br></li><li>  Kaitkan 'RtlRunEncodeUnicodeString' untuk mendapatkan lokasi buffer kata sandi utama yang dikaburkan. <br></li><li>  Kaitkan 'RtlRunDecodeUnicodeString' untuk mengakses buffer yang dikaburkan yang diperoleh pada langkah sebelumnya. <br></li><li>  Memasukkan karakter di bidang entri kata sandi dan menolak langkah 1 (menyimpan seluruh kata sandi master), mengarahkan ulang langkah 2 ke langkah 3 untuk memecahkan kode sandi utama yang dikaburkan. </li></ol><br>  Untuk melakukan semua tindakan ini, buat DLL dengan kode penangan untuk semua kait ini.  Pustaka tertanam dalam proses 1Password 4, mengirimkan satu karakter ke kotak dialog kata sandi utama, dengan meluncurkan memmove, langkah-langkah RtlRunEncodeUnicodeString dan RtlRunDecodeUnicodeString yang dapat kita intersep - dan melakukan sihir kita untuk memulihkan kata sandi master yang dikaburkan.  Sebagian besar keajaiban terjadi di DetourRtlRunEncodeUnicodeString, ini adalah kait untuk fungsi 'RtlRunEncodeUnicodeString', ditunjukkan di bawah ini: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c5/652/36e/2c565236ec1efb158e586bd603d0a908.png"></div><br><br>  Yang membawa kita ke hasil akhir: membuka kunci repositori 1Password 4 yang terkunci dari versi apa pun menggunakan prosedur buggy yang digunakan oleh Windows API: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ad/2c0/d81/0ad2c0d817dd2dc75a942e5b2bd5b974.gif"><br><br><h1>  Ringkasan </h1><br>  Ketika kami pertama kali menyelidiki bagian dalam 1Password 4, kami berharap untuk memenuhi beberapa jenis sistem keamanan yang kompleks dan berharap bahwa semua informasi sensitif akan dihapus dari memori, seperti yang terjadi dalam prosedur PBKDF2 dan area lain di mana kata sandi master digunakan.  Entri yang sesuai juga dihapus.  Namun, karena pengawasan, bidang input kata sandi dianggap sebagai kontrol Windows API standar dengan kata sandi tersembunyi, yang merusak keamanan 1Password 4. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id441166/">https://habr.com/ru/post/id441166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id441150/index.html">Pengantar protokol HTTP pertama dengan menulis server Web Java paling sederhana</a></li>
<li><a href="../id441152/index.html">Cara meminimalkan kesalahan saat berintegrasi dengan layanan eksternal: pengalaman broker online</a></li>
<li><a href="../id441154/index.html">Sebelas Mutiara Tersembunyi di Jawa 11</a></li>
<li><a href="../id441158/index.html">Bagaimana etika menjadi masalah Lembah Silikon termahal, dan filsafat menjadi solusi paling praktis</a></li>
<li><a href="../id441160/index.html">Cara belajar menentukan kapan mengatakan tidak</a></li>
<li><a href="../id441168/index.html">Saluran Data QUIC: Langkah Pertama</a></li>
<li><a href="../id441172/index.html">Bagaimana pasar pencetakan 3D tumbuh pada tahun 2018 dan apa artinya untuk bisnis</a></li>
<li><a href="../id441174/index.html">OOP sudah mati, umur panjang OOP</a></li>
<li><a href="../id441180/index.html">Berawan dengan Peluang Periklanan Non-Nonaktif di Langit Berbintang</a></li>
<li><a href="../id441182/index.html">Pendekatan mesin-sinestetik untuk mendeteksi serangan jaringan DDoS. Bagian 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>