<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤·ğŸ» ğŸ¦ ğŸ‡ ä½¿ç”¨3proxyå’Œiptables / netfilterè¿›è¡Œé€æ˜ä»£ç†çš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ–è€…å¦‚ä½•â€œé€šè¿‡ä»£ç†é‡Šæ”¾æ‰€æœ‰å†…å®¹â€ ğŸ’¨ ğŸ§œğŸ¿ ğŸ™ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³æ­ç¤ºé€æ˜ä»£ç†çš„å¯èƒ½æ€§ï¼Œé€æ˜ä»£ç†å…è®¸æ‚¨ç»å¯¹åœ°é€šè¿‡å¤–éƒ¨ä»£ç†æœåŠ¡å™¨é‡å®šå‘å…¨éƒ¨æˆ–éƒ¨åˆ†æµé‡ã€‚ 

 å½“æˆ‘å¼€å§‹è§£å†³æ­¤é—®é¢˜æ—¶ï¼Œæˆ‘é‡åˆ°äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³å®ƒçš„å®ç°å­˜åœ¨ä¸€ä¸ªé‡å¤§é—®é¢˜-HTTPSåè®®ã€‚ åœ¨è¿‡å»çš„å¥½æ—¥å­é‡Œï¼Œé€æ˜çš„HTTPä»£ç†æ²¡æœ‰ç‰¹åˆ«çš„é—®é¢˜ï¼Œä½†æ˜¯å½“ä»£ç†HTTPSæ—¶ï¼Œæµè§ˆå™¨ä¼šæŠ¥å‘Šå¯¹åè®®çš„å¹²æ‰°ï¼Œè¿™å°±...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨3proxyå’Œiptables / netfilterè¿›è¡Œé€æ˜ä»£ç†çš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ–è€…å¦‚ä½•â€œé€šè¿‡ä»£ç†é‡Šæ”¾æ‰€æœ‰å†…å®¹â€</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460469/">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³æ­ç¤ºé€æ˜ä»£ç†çš„å¯èƒ½æ€§ï¼Œé€æ˜ä»£ç†å…è®¸æ‚¨ç»å¯¹åœ°é€šè¿‡å¤–éƒ¨ä»£ç†æœåŠ¡å™¨é‡å®šå‘å…¨éƒ¨æˆ–éƒ¨åˆ†æµé‡ã€‚ <br><br> å½“æˆ‘å¼€å§‹è§£å†³æ­¤é—®é¢˜æ—¶ï¼Œæˆ‘é‡åˆ°äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³å®ƒçš„å®ç°å­˜åœ¨ä¸€ä¸ªé‡å¤§é—®é¢˜-HTTPSåè®®ã€‚ åœ¨è¿‡å»çš„å¥½æ—¥å­é‡Œï¼Œé€æ˜çš„HTTPä»£ç†æ²¡æœ‰ç‰¹åˆ«çš„é—®é¢˜ï¼Œä½†æ˜¯å½“ä»£ç†HTTPSæ—¶ï¼Œæµè§ˆå™¨ä¼šæŠ¥å‘Šå¯¹åè®®çš„å¹²æ‰°ï¼Œè¿™å°±æ˜¯å¹¸ç¦çš„ç»ˆç»“ã€‚ <br><br> åœ¨ç»™ä»£ç†æœåŠ¡å™¨çš„ä¸€èˆ¬è¯´æ˜ä¸­ï¼ŒSquidç”šè‡³æä¾›ç”Ÿæˆè‡ªå·±çš„è¯ä¹¦å¹¶å°†å…¶å®‰è£…ç»™å®¢æˆ·ç«¯çš„åŠŸèƒ½ï¼Œè¿™<s>å®Œå…¨</s>æ˜¯<s>æ¯«æ— æ„ä¹‰çš„</s> ï¼Œè‡³å°‘æ˜¯ä¸åˆç†çš„ï¼Œçœ‹èµ·æ¥åƒæ˜¯MITMæ”»å‡»ã€‚ æˆ‘çŸ¥é“Squidå·²ç»çŸ¥é“å¦‚ä½•åšè¿™æ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯æœ¬æ–‡æ˜¯å…³äºä½¿ç”¨å¤‡å—æ¨å´‡çš„3APA3Aä¸­çš„3proxyçš„ä¸€ç§è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»”ç»†ç ”ç©¶ä»æºä»£ç æ„å»º3proxyçš„è¿‡ç¨‹ï¼Œå…¶é…ç½®ï¼Œä½¿ç”¨NATçš„å®Œå…¨å’Œé€‰æ‹©æ€§ä»£ç†ï¼Œåˆ°å¤šä¸ªå¤–éƒ¨ä»£ç†æœåŠ¡å™¨çš„é€šé“åˆ†é…ä»¥åŠè·¯ç”±å™¨å’Œé™æ€è·¯ç”±çš„ä½¿ç”¨ã€‚ æˆ‘ä»¬ä½¿ç”¨Debian 9 x64ä½œä¸ºæ“ä½œç³»ç»Ÿã€‚ è®©æˆ‘ä»¬å¼€å§‹å§ï¼ <br><a name="habracut"></a><br><h3> å®‰è£…3proxyå¹¶å¯åŠ¨å¸¸è§„ä»£ç†æœåŠ¡å™¨ </h3><br>  1.å®‰è£…ifconfigï¼ˆä»net-toolsè½¯ä»¶åŒ…ä¸­ï¼‰ <br> <code>apt-get install net-tools</code> <br>  2.å®‰è£…Midnigth Commander <br> <code>apt-get install mc</code> <br>  3.æˆ‘ä»¬ç°åœ¨æœ‰2ä¸ªç•Œé¢ï¼š <br>  enp0s3-å¤–éƒ¨ï¼Œå¯ä»¥åœ¨Internetä¸ŠæŸ¥çœ‹ <br>  enp0s8-å†…éƒ¨ï¼Œåº”æŸ¥çœ‹å±€åŸŸç½‘ <br> åœ¨å…¶ä»–åŸºäºDebiançš„å‘è¡Œç‰ˆä¸­ï¼Œæ¥å£é€šå¸¸ç§°ä¸ºeth0å’Œeth1ã€‚ <br> <code>ifconfig -a</code> <br> <br><div class="spoiler">  <b class="spoiler_title">ä»‹é¢</b> <div class="spoiler_text">  enp0s3ï¼šæ ‡å¿—= 4163 &lt;UPï¼Œå¹¿æ’­ï¼Œè¿è¡Œï¼Œå¤šæ’­&gt; mtu 1500 <br>  inet 192.168.23.11ç½‘ç»œæ©ç 255.255.255.0å¹¿æ’­192.168.23.255 <br>  inet6 fe80 :: a00ï¼š27ffï¼šfec2ï¼šbae4 prefixlen 64 scopeid 0x20 ether 08ï¼š00ï¼š27ï¼šc2ï¼šbaï¼še4 txqueuelen 1000ï¼ˆä»¥å¤ªç½‘ï¼‰ <br>  RXæ•°æ®åŒ…6412å­—èŠ‚8676619ï¼ˆ8.2 MiBï¼‰ <br>  RXé”™è¯¯0æ‰çº¿0è¶…é™0å¸§0 <br>  TXæ•°æ®åŒ…1726å­—èŠ‚289128ï¼ˆ282.3 KiBï¼‰ <br>  TXé”™è¯¯0æ‰çº¿0è¶…é™0è½½æ³¢0å†²çª0 <br><br>  enp0s8ï¼šæ ‡å¿—= 4098 &lt;å¹¿æ’­ï¼Œå¤šæ’­&gt; mtu 1500 <br> ä»¥å¤ªç½‘08ï¼š00ï¼š27ï¼š79ï¼ša7ï¼še3 txqueuelen 1000ï¼ˆä»¥å¤ªç½‘ï¼‰ <br>  RXæ•°æ®åŒ…0å­—èŠ‚0ï¼ˆ0.0 Bï¼‰ <br>  RXé”™è¯¯0æ‰çº¿0è¶…é™0å¸§0 <br>  TXå°åŒ…0ä½å…ƒç»„0ï¼ˆ0.0 Bï¼‰ <br>  TXé”™è¯¯0æ‰çº¿0è¶…é™0è½½æ³¢0å†²çª0 <br><br>  loï¼šæ ‡å¿—= 73 &lt;UPï¼ŒLOOPBACKï¼ŒRUNNING&gt; mtu 65536 <br>  inet 127.0.0.1ç½‘ç»œæ©ç 255.0.0.0 <br>  inet6 :: 1 prefixlen 128 scopeid 0x10å¾ªç¯txqueuelen 1ï¼ˆæœ¬åœ°å›é€ï¼‰ <br>  RXæ•°æ®åŒ…0å­—èŠ‚0ï¼ˆ0.0 Bï¼‰ <br>  RXé”™è¯¯0æ‰çº¿0è¶…é™0å¸§0 <br>  TXå°åŒ…0ä½å…ƒç»„0ï¼ˆ0.0 Bï¼‰ <br>  TXé”™è¯¯0æ‰çº¿0è¶…é™0è½½æ³¢0å†²çª0 <br><br>  enp0s8æ¥å£å½“å‰æœªä½¿ç”¨ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨ä»£ç†NATæˆ–NATé…ç½®æ—¶ï¼Œå°†å¯ç”¨å®ƒã€‚ ç„¶åï¼Œå°†é™æ€IPåˆ†é…ç»™å®ƒæ˜¯åˆä¹é€»è¾‘çš„ã€‚ <br><br>  4.ç»§ç»­å®‰è£…3proxy <br><br>  4.1å®‰è£…ç”¨äºä»æºä»£ç ç¼–è¯‘3proxyçš„åŸºæœ¬è½¯ä»¶åŒ… <br><br> <code>root@debian9:~# apt-get install build-essential libevent-dev libssl-dev -y</code> <br> <br>  4.2ã€‚ åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä»¥ä¸‹è½½å¸¦æœ‰æºæ–‡ä»¶çš„æ¡£æ¡ˆ <br><br> <code>root@debian9:~# mkdir -p /opt/proxy</code> <br> <br>  4.3ã€‚ æˆ‘ä»¬å»è¿™ä¸ªæ–‡ä»¶å¤¹ <br><br> <code>root@debian9:~# cd /opt/proxy <br></code> <br><br>  4.4ã€‚ ç°åœ¨ä¸‹è½½æœ€æ–°çš„3proxyè½¯ä»¶åŒ…ã€‚ åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸º0.8.12ï¼ˆ04/18/2018ï¼‰ä»3proxyå®˜æ–¹ç½‘ç«™ä¸‹è½½ <br><br> <code>root@debian9:/opt/proxy# wget https://github.com/z3APA3A/3proxy/archive/0.8.12.tar.gz <br></code> <br><br>  4.5ã€‚ è§£å‹ä¸‹è½½çš„æ¡£æ¡ˆ <br><br> <code>root@debian9:/opt/proxy# tar zxvf 0.8.12.tar.gz</code> <br> <br>  4.6ã€‚ è½¬åˆ°è§£å‹ç›®å½•ä»¥æ„å»ºç¨‹åº <br><br> <code>root@debian9:/opt/proxy# cd 3proxy-0.8.12</code> <br> <br>  4.7ã€‚ æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦åœ¨å¤´æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æœåŠ¡å™¨å®Œå…¨æ˜¯åŒ¿åçš„ï¼ˆå®ƒç¡®å®æœ‰æ•ˆï¼Œæ£€æŸ¥äº†æ‰€æœ‰å†…å®¹ï¼Œipå®¢æˆ·ç«¯è¢«éšè—äº†ï¼‰ <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# nano +29 src/proxy.h</code> <br> <br> æ·»åŠ ä¸€è¡Œ <br><br> <code>#define ANONYMOUS 1 <br></code> <br> æŒ‰Ctrl + xï¼Œç„¶åæŒ‰Enterä»¥ä¿å­˜æ›´æ”¹ã€‚ <br><br>  4.8ã€‚ è®©æˆ‘ä»¬æ¥æ„å»ºç¨‹åº <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# make -f Makefile.Linux</code> <br> <br><div class="spoiler">  <b class="spoiler_title">åˆ¶ä½œæ—¥å¿—</b> <div class="spoiler_text">  make [2]ï¼šç¦»å¼€ç›®å½•'/opt/proxy/3proxy-0.8.12/src/plugins/TransparentPlugin' <br>  make [1]ï¼šç¦»å¼€ç›®å½•'/opt/proxy/3proxy-0.8.12/src' <br></div></div><br> æ²¡æœ‰é”™è¯¯ï¼Œç»§ç»­ã€‚ <br><br>  4.9ã€‚ åœ¨ç³»ç»Ÿä¸­å®‰è£…ç¨‹åº <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# make -f Makefile.Linux install</code> <br> <br>  4.10ã€‚ è½¬åˆ°æ ¹ç›®å½•å¹¶æ£€æŸ¥ç¨‹åºçš„å®‰è£…ä½ç½®ã€‚ <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# cd ~/ <br> root@debian9:~# whereis 3proxy</code> <br>  3proxyï¼š/ usr /æœ¬åœ°/ bin / 3proxy / usr /æœ¬åœ°/ etc / 3proxy <br><br>  4.11ã€‚ åˆ›å»ºç”¨äºé…ç½®æ–‡ä»¶çš„æ–‡ä»¶å¤¹å¹¶ç™»å½•ç”¨æˆ·çš„ä¸»ç›®å½• <br><br> <code>root@debian9:~# mkdir -p /home/joke/proxy/logs</code> <br> <br>  4.12ã€‚ è½¬åˆ°é…ç½®åº”ä½äºçš„ç›®å½• <br><br> <code>root@debian9:~# cd /home/joke/proxy/</code> <br> <br>  4.13ã€‚ åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¹¶åœ¨é‚£é‡Œå¤åˆ¶é…ç½® <br><br> <code>root@debian9:/home/joke/proxy# cat &gt; 3proxy.conf</code> <br> <br><div class="spoiler">  <b class="spoiler_title">3proxy.conf</b> <div class="spoiler_text"> å®ˆæŠ¤ç¨‹åº <br>  pidfile / home /ç¬‘è¯/proxy/3proxy.pid <br>  nserver 8.8.8.8 <br>  nscache 65536 <br> ç”¨æˆ·æµ‹è¯•ä»ªï¼šCLï¼š1234 <br> è¶…æ—¶1 5 30 60 180 1800 16 60 <br> æ—¥å¿—/home/joke/proxy/logs/3proxy.log D <br>  logformatâ€œ-+ _Lï¼…tã€‚ï¼…ã€‚ï¼…N.ï¼…pï¼…Eï¼…Uï¼…Cï¼šï¼…cï¼…Rï¼šï¼…rï¼…Oï¼…Iï¼…hï¼…Tâ€ <br> æ—‹è½¬3 <br> è®¤è¯å¼º <br> é½å¹³ <br> å…è®¸æµ‹è¯•äººå‘˜ <br> è¢œå­-p3128 <br> ä»£ç†-p8080 <br></div></div><br> è¦ä¿å­˜ï¼Œè¯·æŒ‰Ctrl + Z <br><br>  4.14ã€‚ åˆ›å»ºä¸€ä¸ªpidæ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨å¯åŠ¨æ—¶æ²¡æœ‰é”™è¯¯ã€‚ <br><br> <code>root@debian9:/home/joke/proxy# cat &gt; 3proxy.pid</code> <br> <br> è¦ä¿å­˜ï¼Œè¯·æŒ‰Ctrl + Z <br><br>  4.15ã€‚ å¯åŠ¨ä»£ç†æœåŠ¡å™¨ï¼ <br><br> <code>root@debian9:/home/joke/proxy# 3proxy /home/joke/proxy/3proxy.conf</code> <br> <br>  4.16ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨ä¾¦å¬ç«¯å£ <br><br> <code>root@debian9:~/home/joke/proxy# netstat -nlp</code> <br> <br><div class="spoiler">  <b class="spoiler_title">netstatæ—¥å¿—</b> <div class="spoiler_text"> æ´»åŠ¨çš„Internetè¿æ¥ï¼ˆä»…æœåŠ¡å™¨ï¼‰ <br>  Proto Recv-Q Send-Qæœ¬åœ°åœ°å€å¤–éƒ¨åœ°å€çŠ¶æ€PID /ç¨‹åºåç§° <br>  tcp 0 0 0.0.0.0:8080 0.0.0.0:* LISTEN 504/3ä»£ç† <br>  tcp 0 0 0.0.0.0:22 0.0.0.0:*ç›‘å¬338 / sshd <br>  tcp 0 0 0.0.0.0lla128 0.0.0.0:*ç›‘å¬504/3ä»£ç† <br>  tcp6 0 0 ::: 22 ::: *å¬338 / sshd <br>  udp 0 0 0.0.0.0:68 0.0.0.0:* 352 / dhclient <br></div></div><br> æ­£å¦‚é…ç½®ä¸­æ‰€å†™ï¼ŒWebä»£ç†ä¾¦å¬ç«¯å£8080ï¼Œè€ŒSocks5ä»£ç†ä¾¦å¬3128ã€‚ <br><br>  4.17ã€‚ è¦åœ¨é‡æ–°å¼•å¯¼åå¯åŠ¨ä»£ç†æœåŠ¡ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°cronä¸­ã€‚ <br><br> <code>root@debian9:/home/joke/proxy# crontab -e</code> <br> <br> æ·»åŠ ä¸€è¡Œ <br><br> <code>@reboot /usr/local/bin/3proxy /home/joke/proxy/3proxy.conf</code> <br> <br> æŒ‰Enteré”®ï¼Œå› ä¸ºcronåº”è¯¥çœ‹åˆ°è¡Œå°¾å­—ç¬¦å¹¶ä¿å­˜æ–‡ä»¶ã€‚ <br><br> åº”è¯¥æœ‰ä¸€æ¡æœ‰å…³å®‰è£…æ–°crontabçš„æ¶ˆæ¯ã€‚ <br><br>  crontabï¼šå®‰è£…æ–°çš„crontab <br><br>  4.18ã€‚ æˆ‘ä»¬å°†é‡æ–°å¯åŠ¨ç³»ç»Ÿï¼Œå¹¶å°è¯•é€šè¿‡æµè§ˆå™¨è¿æ¥åˆ°ä»£ç†ã€‚ ä¸ºäº†è¿›è¡ŒéªŒè¯ï¼Œæˆ‘ä»¬å°†Firefoxæµè§ˆå™¨ï¼ˆç”¨äºWebä»£ç†ï¼‰å’ŒFoxyProxyé™„åŠ ç»„ä»¶ç”¨äºå…·æœ‰èº«ä»½éªŒè¯çš„socks5ã€‚ <br><br> <code>root@debian9:/home/joke/proxy# reboot</code> <br> <br>  4.19ã€‚ é‡æ–°å¯åŠ¨åæ£€æŸ¥ä»£ç†åï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ—¥å¿—ã€‚ è¿™æ ·å°±å®Œæˆäº†ä»£ç†è®¾ç½®ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">3ä¸ªä»£ç†æ—¥å¿—</b> <div class="spoiler_text">  1542573996.018 PROXY.8080 00000æµ‹è¯•ä»ª192.168.23.10:50915 217.12.15.54ced43 1193 6939 0 CONNECT_ads.yahoo.com:443_HTTP/1.1 <br>  1542574289.634 SOCK5.3128 00000æµ‹è¯•ä»ª192.168.23.10/101193 54.192.13.69:443 0 0 0 CONNECT_normandy.cdn.mozilla.net:443 <br></div></div><br><h3> é…ç½®å¹¶è¿è¡Œé€æ˜ä»£ç†NATé…ç½® </h3><br> åœ¨æ­¤é…ç½®ä¸­ï¼Œå†…éƒ¨ç½‘ç»œä¸Šçš„æ‰€æœ‰è®¾å¤‡å°†é€šè¿‡è¿œç¨‹ä»£ç†æœåŠ¡å™¨åœ¨Internetä¸Šé€æ˜åœ°å·¥ä½œã€‚ ç»å¯¹æ‰€æœ‰çš„tcpè¿æ¥éƒ½å°†é‡å®šå‘åˆ°ä¸€ä¸ªæˆ–å‡ ä¸ªï¼ˆç¡®å®æ‰©å¤§äº†é€šé“å®½åº¦ï¼Œé…ç½®ç¤ºä¾‹ä¸º2ï¼ï¼‰ä»£ç†æœåŠ¡å™¨ã€‚  DNSå°†ä½¿ç”¨3proxyï¼ˆdnsprï¼‰çš„åŠŸèƒ½ã€‚  UDPä¸ä¼šå¤–å‡ºï¼Œå› ä¸ºæˆ‘ä»¬å°šæœªä½¿ç”¨è½¬å‘æœºåˆ¶ï¼ˆåœ¨Linuxå†…æ ¸ä¸­é»˜è®¤ä¸ºç¦ç”¨ï¼‰ã€‚ <br><br>  1.æ˜¯æ—¶å€™å¯ç”¨enp0s8æ¥å£äº† <br><br> <code>root@debian9:~# nano /etc/network/interfaces</code> <br> <br><div class="spoiler">  <b class="spoiler_title">/ etc / network / interfacesæ–‡ä»¶</b> <div class="spoiler_text">  ï¼ƒæ­¤æ–‡ä»¶æè¿°äº†ç³»ç»Ÿä¸Šå¯ç”¨çš„ç½‘ç»œæ¥å£ <br>  ï¼ƒä»¥åŠå¦‚ä½•æ¿€æ´»å®ƒä»¬ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æ¥å£ï¼ˆ5ï¼‰ã€‚ <br><br> æº/etc/network/interfaces.d/* <br><br>  ï¼ƒç¯å›ç½‘ç»œæ¥å£ <br> è‡ªåŠ¨æœç´¢ <br>  iface lo inetå›é€ <br><br>  ï¼ƒä¸»ç½‘ç»œæ¥å£ <br>  allow-hotplug enp0s3 <br>  iface enp0s3 inet dhcp <br><br>  ï¼ƒè¾…åŠ©ç½‘ç»œæ¥å£ <br>  allow-hotplug enp0s8 <br>  iface enp0s8 ineté™æ€ <br> åœ°å€192.168.201.254 <br> ç½‘ç»œæ©ç 255.255.255.0 <br></div></div><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºenp0s8æ¥å£åˆ†é…äº†é™æ€åœ°å€192.168.201.254å’Œæ©ç 255.255.255.0 <br> ä¿å­˜é…ç½®Ctrl + Xå¹¶é‡æ–°å¯åŠ¨ <br><br> <code>root@debian9:~# reboot</code> <br> <br>  2.æ£€æŸ¥æ¥å£ <br><br> <code>root@debian9:~# ifconfig</code> <br> <br><div class="spoiler">  <b class="spoiler_title">ifconfigæ—¥å¿—</b> <div class="spoiler_text">  enp0s3ï¼šæ ‡å¿—= 4163 &lt;UPï¼Œå¹¿æ’­ï¼Œè¿è¡Œï¼Œå¤šæ’­&gt; mtu 1500 <br>  inet 192.168.23.11ç½‘ç»œæ©ç 255.255.255.0å¹¿æ’­192.168.23.255 <br>  inet6 fe80 :: a00ï¼š27ffï¼šfec2ï¼šbae4 prefixlen 64 scopeid 0x20 ether 08ï¼š00ï¼š27ï¼šc2ï¼šbaï¼še4 txqueuelen 1000ï¼ˆä»¥å¤ªç½‘ï¼‰ <br>  RXæ•°æ®åŒ…61å­—èŠ‚7873ï¼ˆ7.6 KiBï¼‰ <br>  RXé”™è¯¯0æ‰çº¿0è¶…é™0å¸§0 <br>  TXæ•°æ®åŒ…65å­—èŠ‚10917ï¼ˆ10.6 KiBï¼‰ <br>  TXé”™è¯¯0æ‰çº¿0è¶…é™0è½½æ³¢0å†²çª0 <br><br>  enp0s8ï¼šæ ‡å¿—= 4163 &lt;UPï¼Œå¹¿æ’­ï¼Œè¿è¡Œï¼Œå¤šæ’­&gt; mtu 1500 <br>  inet 192.168.201.254ç½‘ç»œæ©ç 255.255.255.0å¹¿æ’­192.168.201.255 <br>  inet6 fe80 :: a00ï¼š27ffï¼šfe79ï¼ša7e3 prefixlen 64 scopeid 0x20 ether 08ï¼š00ï¼š27ï¼š79ï¼ša7ï¼še3 txqueuelen 1000ï¼ˆä»¥å¤ªç½‘ï¼‰ <br>  RXæ•°æ®åŒ…0å­—èŠ‚0ï¼ˆ0.0 Bï¼‰ <br>  RXé”™è¯¯0æ‰çº¿0è¶…é™0å¸§0 <br>  TXæ•°æ®åŒ…8å­—èŠ‚648ï¼ˆ648.0 Bï¼‰ <br>  TXé”™è¯¯0æ‰çº¿0è¶…é™0è½½æ³¢0å†²çª0 <br><br>  loï¼šæ ‡å¿—= 73 &lt;UPï¼ŒLOOPBACKï¼ŒRUNNING&gt; mtu 65536 <br>  inet 127.0.0.1ç½‘ç»œæ©ç 255.0.0.0 <br>  inet6 :: 1 prefixlen 128 scopeid 0x10å¾ªç¯txqueuelen 1ï¼ˆæœ¬åœ°å›é€ï¼‰ <br>  RXæ•°æ®åŒ…0å­—èŠ‚0ï¼ˆ0.0 Bï¼‰ <br>  RXé”™è¯¯0æ‰çº¿0è¶…é™0å¸§0 <br>  TXå°åŒ…0ä½å…ƒç»„0ï¼ˆ0.0 Bï¼‰ <br>  TXé”™è¯¯0æ‰çº¿0è¶…é™0è½½æ³¢0å†²çª0 <br><br>  3.äº‹å®è¯æ˜ï¼Œç°åœ¨ï¼Œæ‚¨éœ€è¦é…ç½®3proxyè¿›è¡Œé€æ˜ä»£ç†ã€‚ <br><br> <code>root@debian9:~# cd /home/joke/proxy/ <br> root@debian9:/home/joke/proxy# cat &gt; 3proxytransp.conf</code> <br> <br><div class="spoiler">  <b class="spoiler_title">é€æ˜ä»£ç†æœåŠ¡å™¨ï¼ƒ1çš„ç¤ºä¾‹é…ç½®</b> <div class="spoiler_text"> å®ˆæŠ¤ç¨‹åº <br>  pidfile / home /ç¬‘è¯/proxy/3proxy.pid <br>  nserver 8.8.8.8 <br>  nscache 65536 <br> è¶…æ—¶1 5 30 60 180 1800 16 60 <br> æ—¥å¿—/home/joke/proxy/logs/3proxy.log D <br>  logformatâ€œ-+ _Lï¼…tã€‚ï¼…ã€‚ï¼…N.ï¼…pï¼…Eï¼…Uï¼…Cï¼šï¼…cï¼…Rï¼šï¼…rï¼…Oï¼…Iï¼…hï¼…Tâ€ <br> æ—‹è½¬3 <br> é½å¹³ <br> è®¤è¯iponly <br>  dnspr <br> å…è®¸* <br> çˆ¶çº§1000è¢œå­5 IP_EXTERNAL_PROXY 3128æµ‹è¯•ä»ª1234 <br> æ’ä»¶/opt/proxy/3proxy-0.8.12/src/TransparentPlugin.ld.so transparent_plugin <br>  tcppm -i0.0.0.0 888 127.0.0.1 11111 <br></div></div><br>  4.ç°åœ¨ï¼Œä½¿ç”¨æ–°é…ç½®è¿è¡Œ3proxy <br> <code>root@debian9:/home/joke/proxy# /usr/local/bin/3proxy /home/joke/proxy/3proxytransp.conf</code> <br> <br>  5.å†æ¬¡æ·»åŠ crontab <br> <code>root@debian9:/home/joke/proxy# crontab -e <br> @reboot /usr/local/bin/3proxy /home/joke/proxy/3proxytransp.conf</code> <br> <br>  6.è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„ä»£ç†ç°åœ¨æ­£åœ¨å¬ä»€ä¹ˆ <br> <code>root@debian9:~# netstat -nlp <br></code> <br><br><div class="spoiler">  <b class="spoiler_title">netstatæ—¥å¿—</b> <div class="spoiler_text"> æ´»åŠ¨çš„Internetè¿æ¥ï¼ˆä»…æœåŠ¡å™¨ï¼‰ <br>  Proto Recv-Q Send-Qæœ¬åœ°åœ°å€å¤–éƒ¨åœ°å€çŠ¶æ€PID /ç¨‹åºåç§° <br>  tcp 0 0 0.0.0.0:22 0.0.0.0:*ç›‘å¬349 / sshd <br>  tcp 0 0 0.0.0.0:888 0.0.0.0:*ç›‘å¬354/3ä»£ç† <br>  tcp6 0 0 ::: 22 ::: *ç›‘å¬349 / sshd <br>  udp 0 0 0.0.0.0:53 0.0.0.0:* 354/3ä»£ç† <br>  udp 0 0 0.0.0.0:68 0.0.0.0:* 367 / dhclient <br></div></div><br>  7.ç°åœ¨ï¼Œä»£ç†å·²å‡†å¤‡å¥½æ¥å—ç«¯å£888ä¸Šçš„ä»»ä½•TCPè¿æ¥ï¼Œç«¯å£53ä¸Šçš„DNSï¼Œä»¥ä¾¿å¯ä»¥å°†å®ƒä»¬é‡å®šå‘åˆ°è¿œç¨‹socks5-Googleä»£ç†å’ŒDNS 8.8.8.8ã€‚ æˆ‘ä»¬ä»ç„¶éœ€è¦é…ç½®netfilterï¼ˆiptablesï¼‰å’ŒDHCPè§„åˆ™æ¥å‘å¸ƒåœ°å€ã€‚ <br><br>  8.å®‰è£…iptables-persistentè½¯ä»¶åŒ…å’Œdhcpd <br><br> <code>root@debian9:~# apt-get install iptables-persistent isc-dhcp-server</code> <br> <br>  9.ç¼–è¾‘dhcpdå¯åŠ¨æ–‡ä»¶ <br> <code>root@debian9:~# nano /etc/dhcp/dhcpd.conf</code> <br> <br><div class="spoiler">  <b class="spoiler_title">dhcpd.conf</b> <div class="spoiler_text">  ï¼ƒdhcpd.conf <br>  ï¼ƒ <br>  ï¼ƒISC dhcpdçš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ <br>  ï¼ƒ <br><br>  ï¼ƒæ‰€æœ‰æ”¯æŒçš„ç½‘ç»œé€šç”¨çš„é€‰é¡¹å®šä¹‰... <br> é€‰é¡¹åŸŸåâ€œ example.orgâ€ï¼› <br> é€‰é¡¹åŸŸåæœåŠ¡å™¨ns1.example.orgï¼Œns2.example.orgï¼› <br><br> é»˜è®¤ç§Ÿèµæ—¶é—´600ï¼› <br> æœ€å¤§ç§Ÿèµæ—¶é—´7200; <br><br>  ddns-update-style none; <br><br>  ï¼ƒå¦‚æœæ­¤DHCPæœåŠ¡å™¨æ˜¯æœ¬åœ°çš„å®˜æ–¹DHCPæœåŠ¡å™¨ <br>  ï¼ƒç½‘ç»œï¼Œæƒå¨æŒ‡ä»¤åº”ä¸åŠ æ³¨é‡Šã€‚ <br><br> æƒå¨ <br><br>  ï¼ƒå†…éƒ¨å­ç½‘çš„é…ç½®ç•¥æœ‰ä¸åŒã€‚ <br> å­ç½‘192.168.201.0ç½‘ç»œæ©ç 255.255.255.0 { <br> èŒƒå›´192.168.201.10 192.168.201.250; <br> é€‰é¡¹åŸŸåæœåŠ¡å™¨192.168.201.254; <br> å¯é€‰è·¯ç”±å™¨192.168.201.254; <br> é€‰é¡¹å¹¿æ’­åœ°å€192.168.201.255; <br> é»˜è®¤ç§Ÿèµæ—¶é—´600ï¼› <br> æœ€å¤§ç§Ÿèµæ—¶é—´7200; <br>  } <br></div></div><br>  11.é‡æ–°å¯åŠ¨å¹¶æ£€æŸ¥ç«¯å£67ä¸Šçš„æœåŠ¡ <br> <code>root@debian9:~# reboot <br> root@debian9:~# netstat -nlp</code> <br> <br><div class="spoiler">  <b class="spoiler_title">netstatæ—¥å¿—</b> <div class="spoiler_text"> æ´»åŠ¨çš„Internetè¿æ¥ï¼ˆä»…æœåŠ¡å™¨ï¼‰ <br>  Proto Recv-Q Send-Qæœ¬åœ°åœ°å€å¤–éƒ¨åœ°å€çŠ¶æ€PID /ç¨‹åºåç§° <br>  tcp 0 0 0.0.0.0:22 0.0.0.0:*ç›‘å¬389 / sshd <br>  tcp 0 0 0.0.0.0:888 0.0.0.0:*ç›‘å¬310/3ä»£ç† <br>  tcp6 0 0 ::: 22 ::: *å¬389 / sshd <br>  udp 0 0 0.0.0.0:20364 0.0.0.0:* 393 / dhcpd <br>  udp 0 0 0.0.0.0:53 0.0.0.0:* 310/3ä»£ç† <br>  udp 0 0 0.0.0.0:67 0.0.0.0:* 393 / dhcpd <br>  udp 0 0 0.0.0.0:68 0.0.0.0:* 405 / dhclient <br>  udp6 0 0 ::: 31728 ::: * 393 / dhcpd <br> åŸå§‹0 0 0.0.0.0:1 0.0.0.0:* 393 / dhcpd <br><br></div></div><br>  12.ä»ç„¶å¯ä»¥å°†æ‰€æœ‰tcpè¯·æ±‚é‡å®šå‘åˆ°ç«¯å£888å¹¶å°†è§„åˆ™ä¿å­˜åœ¨iptablesä¸­ <br><br> <code>root@debian9:~# iptables -t nat -A PREROUTING -s 192.168.201.0/24 -p tcp -j REDIRECT --to-ports 888</code> <br> <br> <code>root@debian9:~# iptables-save &gt; /etc/iptables/rules.v4</code> <br> <br>  13.è¦æ‰©å±•é€šé“å¸¦å®½ï¼Œå¯ä»¥ä¸€æ¬¡ä½¿ç”¨å¤šä¸ªä»£ç†æœåŠ¡å™¨ã€‚ æ€»æ•°åº”ä¸º1000ã€‚å»ºç«‹ä¸æŒ‡å®šä»£ç†æœåŠ¡å™¨çš„æ–°è¿æ¥çš„æ¦‚ç‡ä¸º0.2ã€0.2ã€0.2ã€0.2ã€0.1ã€0.1ã€‚ <br><br> æ³¨æ„ï¼šå¦‚æœæˆ‘ä»¬æœ‰Webä»£ç†ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ç¼–å†™connectè€Œä¸æ˜¯socks5ï¼Œå¦‚æœæ˜¯socks4ï¼Œåˆ™éœ€è¦ç¼–å†™connectï¼ˆsocks4ä¸æ”¯æŒç™»å½•/å¯†ç æˆæƒï¼ï¼‰ <br><br><div class="spoiler">  <b class="spoiler_title">é€æ˜ä»£ç†æœåŠ¡å™¨é…ç½®ç¤ºä¾‹ï¼ƒ2</b> <div class="spoiler_text"> å®ˆæŠ¤ç¨‹åº <br>  pidfile / home /ç¬‘è¯/proxy/3proxy.pid <br>  nserver 8.8.8.8 <br>  nscache 65536 <br> éº¦å…‹æ–¯åº·500 <br> è¶…æ—¶1 5 30 60 180 1800 16 60 <br> æ—¥å¿—/home/joke/proxy/logs/3proxy.log D <br>  logformatâ€œ-+ _Lï¼…tã€‚ï¼…ã€‚ï¼…N.ï¼…pï¼…Eï¼…Uï¼…Cï¼šï¼…cï¼…Rï¼šï¼…rï¼…Oï¼…Iï¼…hï¼…Tâ€ <br> æ—‹è½¬3 <br> é½å¹³ <br> è®¤è¯iponly <br>  dnspr <br> å…è®¸* <br><br> çˆ¶200è¢œå­5 IP_EXT_EXT_PROXYï¼ƒ1 3128æµ‹è¯•ä»ª1234 <br> çˆ¶200è¢œå­5 IP_EXT_EXT_PROXYï¼ƒ2 3128æµ‹è¯•ä»ª1234 <br> çˆ¶200è¢œå­5 IP_EXT_EXT_PROXYï¼ƒ3 3128æµ‹è¯•ä»ª1234 <br> çˆ¶200è¢œå­5 IP_EXT_EXT_PROXYï¼ƒ4 3128æµ‹è¯•ä»ª1234 <br> çˆ¶100è¢œå­5 IP_EXT_EXT_PROXYï¼ƒ5 3128æµ‹è¯•ä»ª1234 <br> çˆ¶100è¢œå­5 IP_EXT_EXT_PROXYï¼ƒ6 3128æµ‹è¯•ä»ª1234 <br><br> æ’ä»¶/opt/proxy/3proxy-0.8.12/src/TransparentPlugin.ld.so transparent_plugin <br>  tcppm -i0.0.0.0 888 127.0.0.1 11111 <br></div></div><br><h3> é…ç½®å¹¶è¿è¡ŒNAT +é€æ˜ä»£ç†é…ç½® </h3><br> åœ¨æ­¤é…ç½®ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é€šå¸¸çš„NATæœºåˆ¶ï¼Œå¯¹å•ä¸ªåœ°å€æˆ–å­ç½‘è¿›è¡Œé€‰æ‹©æ€§æˆ–å®Œå…¨é€æ˜çš„ä»£ç†ã€‚ å†…éƒ¨ç½‘ç»œçš„ç”¨æˆ·å°†ä½¿ç”¨æŸäº›æœåŠ¡/å­ç½‘ï¼Œç”šè‡³ä¸ä¼šæ„è¯†åˆ°ä»–ä»¬é€šè¿‡ä»£ç†å·¥ä½œã€‚ æ‰€æœ‰httpsè¿æ¥éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæ— éœ€ç”Ÿæˆ/æ›¿æ¢è¯ä¹¦ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬ç¡®å®šè¦ä»£ç†çš„å­ç½‘/æœåŠ¡ã€‚ å‡è®¾å¤–éƒ¨ä»£ç†ä½äºè¿è¡Œpandora.comä¹‹ç±»çš„æœåŠ¡çš„ä½ç½®ã€‚ ç°åœ¨å®ƒä»ç„¶å¯ä»¥ç¡®å®šå…¶å­ç½‘/åœ°å€ã€‚ <br><br>  1.å¹³ <br><br> <code>root@debian9:~# ping pandora.com</code> <br>  PING pandora.comï¼ˆ208.85.40.20ï¼‰56ï¼ˆ84ï¼‰ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚ <br><br>  2.æˆ‘ä»¬è¾“å…¥Google BGP 208.85.40.20 <br><br> è½¬åˆ°ç½‘ç«™<a href="">bgp.he.net/net/208.85.40.0/24#_netinfo</a> <br> æ‚¨å¯ä»¥çœ‹åˆ°æˆ‘æ­£åœ¨å¯»æ‰¾çš„å­ç½‘æ˜¯AS40428 Pandora Mediaï¼ŒInc <br><br>  <a href="">bgp.he.net/net/208.85.40.0/24#_netinfo</a> <br><br> æ‰“å¼€v4å‰ç¼€ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">bgp.he.net/AS40428#_prefixes</a> <br><br> è¿™æ˜¯æ‰€éœ€çš„å­ç½‘ï¼ <br><br>  199.116.161.0/24 <br>  199.116.162.0/24 <br>  199.116.164.0/23 <br>  199.116.164.0/24 <br>  199.116.165.0/24 <br>  208.85.40.0/24 <br>  208.85.41.0/24 <br>  208.85.42.0/23 <br>  208.85.42.0/24 <br>  208.85.43.0/24 <br>  208.85.44.0/24 <br>  208.85.46.0/23 <br>  208.85.46.0/24 <br>  208.85.47.0/24 <br><br>  3.ä¸ºäº†å‡å°‘å­ç½‘æ•°é‡ï¼Œå¿…é¡»æ‰§è¡Œèšåˆã€‚ è½¬åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ip-calculator.ru/aggregate</a>å¹¶åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>å¤åˆ¶æˆ‘ä»¬çš„åˆ—è¡¨ã€‚ ç»“æœæ˜¯-6ä¸ªå­ç½‘è€Œä¸æ˜¯14ä¸ªå­ç½‘ã€‚ <br><br>  199.116.161.0/24 <br>  199.116.162.0/24 <br>  199.116.164.0/23 <br>  208.85.40.0/22 <br>  208.85.44.0/24 <br>  208.85.46.0/23 <br><br>  4.æ¸…é™¤iptablesè§„åˆ™ <br><br> <code>root@debian9:~# iptables -F <br> root@debian9:~# iptables -X <br> root@debian9:~# iptables -t nat -F <br> root@debian9:~# iptables -t nat -X</code> <br> <br> å¯ç”¨è½¬å‘å’ŒNAT <br><br> <code>root@debian9:~# echo 1 &gt; /proc/sys/net/ipv4/ip_forward <br> root@debian9:~# iptables -A FORWARD -i enp0s3 -o enp0s8 -j ACCEPT <br> root@debian9:~# iptables -A FORWARD -i enp0s8 -o enp0s3 -j ACCEPT <br> root@debian9:~# iptables -t nat -A POSTROUTING -o enp0s3 -s 192.168.201.0/24 -j MASQUERADE</code> <br> <br> ä¸ºäº†ä½¿è½¬å‘åœ¨é‡æ–°å¯åŠ¨åå§‹ç»ˆå¤„äºæ‰“å¼€çŠ¶æ€ï¼Œè¯·æ›´æ”¹æ–‡ä»¶ <br><br> <code>root@debian9:~# nano /etc/sysctl.conf</code> <br> <br> å¹¶å–æ¶ˆæ³¨é‡Šçº¿ <br><br>  net.ipv4.ip_forward = 1 <br><br>  Ctrl + Xä¿å­˜æ–‡ä»¶ <br><br>  5.æˆ‘ä»¬å°†pandora.comå­ç½‘åŒ…è£…åœ¨ä»£ç†ä¸­ <br><br> <code>root@debian9:~# iptables -t nat -A PREROUTING -s 192.168.201.0/24 -d 199.116.161.0/24,199.116.162.0/24,199.116.164.0/23,208.85.40.0/22,208.85.44.0/24,208.85.46.0/23 -p tcp -j REDIRECT --to-ports 888</code> <br> <br>  6.ä¿å­˜è§„åˆ™ <br><br> <code>root@debian9:~# iptables-save &gt; /etc/iptables/rules.v4</code> <br> <br><h3> é€šè¿‡è·¯ç”±å™¨é…ç½®é…ç½®å’Œè¿è¡Œé€æ˜ä»£ç† </h3><br> åœ¨æ­¤é…ç½®ä¸­ï¼Œé€æ˜ä»£ç†æœåŠ¡å™¨å¯ä»¥æ˜¯ç‹¬ç«‹çš„PCæˆ–å®¶åº­/å…¬å¸è·¯ç”±å™¨åé¢çš„è™šæ‹Ÿæœºã€‚ åœ¨è·¯ç”±å™¨æˆ–è®¾å¤‡ä¸Šæ³¨å†Œé™æ€è·¯ç”±å°±è¶³å¤Ÿäº†ï¼Œæ•´ä¸ªå­ç½‘å°†ä½¿ç”¨ä»£ç†ï¼Œè€Œæ— éœ€ä»»ä½•å…¶ä»–è®¾ç½®ã€‚ <br><br> é‡è¦ï¼ æˆ‘ä»¬çš„ç½‘å…³å¿…é¡»ä»è·¯ç”±å™¨æ¥æ”¶é™æ€IPï¼Œæˆ–è€…å°†å…¶é…ç½®ä¸ºé™æ€æœ¬èº«ã€‚ <br><br>  1.é…ç½®é™æ€ç½‘å…³åœ°å€ï¼ˆenp0s3é€‚é…å™¨ï¼‰ <br><br> <code>root@debian9:~# nano /etc/network/interfaces</code> <br> <br><div class="spoiler">  <b class="spoiler_title">/ etc / network / interfacesæ–‡ä»¶</b> <div class="spoiler_text">  ï¼ƒæ­¤æ–‡ä»¶æè¿°äº†ç³»ç»Ÿä¸Šå¯ç”¨çš„ç½‘ç»œæ¥å£ <br>  ï¼ƒä»¥åŠå¦‚ä½•æ¿€æ´»å®ƒä»¬ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æ¥å£ï¼ˆ5ï¼‰ã€‚ <br><br> æº/etc/network/interfaces.d/* <br><br>  ï¼ƒç¯å›ç½‘ç»œæ¥å£ <br> è‡ªåŠ¨æœç´¢ <br>  iface lo inetå›é€ <br><br>  ï¼ƒä¸»ç½‘ç»œæ¥å£ <br>  allow-hotplug enp0s3 <br>  iface enp0s3 ineté™æ€ <br> åœ°å€192.168.23.2 <br> ç½‘ç»œæ©ç 255.255.255.0 <br> ç½‘å…³192.168.23.254 <br><br>  ï¼ƒè¾…åŠ©ç½‘ç»œæ¥å£ <br>  allow-hotplug enp0s8 <br>  iface enp0s8 ineté™æ€ <br> åœ°å€192.168.201.254 <br> ç½‘ç»œæ©ç 255.255.255.0 <br></div></div><br>  2.å…è®¸192.168.23.0/24å­ç½‘ä¸­çš„è®¾å¤‡ä½¿ç”¨ä»£ç† <br><br> <code>root@debian9:~# iptables -t nat -A PREROUTING -s 192.168.23.0/24 -d 199.116.161.0/24,199.116.162.0/24,199.116.164.0/23,208.85.40.0/22,208.85.44.0/24,208.85.46.0/23 -p tcp -j REDIRECT --to-ports 888</code> <br> <br>  3.ä¿å­˜è§„åˆ™ <br> <code>root@debian9:~# iptables-save &gt; /etc/iptables/rules.v4</code> <br> <br>  4.æˆ‘ä»¬å°†åœ¨è·¯ç”±å™¨ä¸Šæ³¨å†Œå­ç½‘ <br><br><div class="spoiler">  <b class="spoiler_title">è·¯ç”±å™¨ç½‘ç»œåˆ—è¡¨</b> <div class="spoiler_text">  199.116.161.0 255.255.255.0 192.168.23.2 <br>  199.116.162.0 255.255.255.0 192.168.23.2 <br>  199.116.164.0 255.255.254.0 192.168.23.2 <br>  208.85.40.0 255.255.252.0 192.168.23.2 <br>  208.85.44.0 255.255.255.0 192.168.23.2 <br>  208.85.46.0 255.255.254.0 192.168.23.2 <br></div></div><br><h3> ä½¿ç”¨çš„ææ–™/èµ„æº </h3><br>  1. 3proxy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3proxy.ruç¨‹åº</a>çš„å®˜æ–¹ç½‘ç«™ <br><br>  2.æ¥æº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.proxyçš„</a>å®‰è£…è¯´æ˜ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç½‘å€</a>ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.ekzorchik.ru/2015/02/how-to-take-your-socks-proxy</a> <br><br>  3. github <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/z3APA3A/3proxy/issues/274</a>ä¸Šçš„3proxyå¼€å‘äººå‘˜åˆ†æ”¯ <br><br></div></div></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460469/">https://habr.com/ru/post/zh-CN460469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460459/index.html">é…ç½®æ–‡ä»¶htaccess</a></li>
<li><a href="../zh-CN460461/index.html">æ¨¡æ‹Ÿç›®æ ‡æ”»å‡»ä½œä¸ºå®‰å…¨è¯„ä¼°ã€‚ çº¢é˜Ÿç½‘ç»œè¯´æ˜</a></li>
<li><a href="../zh-CN460463/index.html">GALILEO-GNSSç¨‹åºå‘˜ç‰ˆæœ¬å‘ç”Ÿäº†ä»€ä¹ˆ</a></li>
<li><a href="../zh-CN460465/index.html">æ•°å­—é˜´å½±-æœ‰æ•ˆå¸®åŠ©é™ä½æ•°å­—é£é™©</a></li>
<li><a href="../zh-CN460467/index.html">æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾å£°éŸ³ä¸­çš„æ±½è½¦æ•…éšœï¼šæˆ‘ä»¬å‘¼åè¿›è¡Œä¸€äº›æœºå™¨å­¦ä¹ ï¼Œä»¥å‘ç°å‘åŠ¨æœºä¸­çš„å¼‚å¸¸æƒ…å†µ</a></li>
<li><a href="../zh-CN460471/index.html">ç®¡ç†é¢æ¿é”™è¯¯æˆ–Laravel Orchidå¼€å‘ç»éªŒ</a></li>
<li><a href="../zh-CN460473/index.html">ç™½å™ªå£°ç»˜åˆ¶ä¸€ä¸ªé»‘è‰²æ­£æ–¹å½¢</a></li>
<li><a href="../zh-CN460475/index.html">é¥æ§ç§»åŠ¨æ•‘ç”Ÿåœˆ</a></li>
<li><a href="../zh-CN460479/index.html">æ³°è¿ªç†Šä¼¼ä¹è´Ÿæ‹…å¾ˆé‡</a></li>
<li><a href="../zh-CN460481/index.html">æ— é£æ‰‡æ€§èƒ½è®¡ç®—æœºMIC-7000</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>