<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçü§ù‚Äçüë®üèæ üîä üèüÔ∏è Pensamento funcional. Parte 11: Final üë®‚Äçüë©‚Äçüëß‚Äçüë¶ üêÆ üç©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje estamos finalizando nossa s√©rie de artigos sobre programa√ß√£o funcional. Acabou 11 partes. Eu acredito que isso √© uma conquista. Neste artigo, imp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pensamento funcional. Parte 11: Final</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/433412/"><p>  Hoje estamos finalizando nossa s√©rie de artigos sobre programa√ß√£o funcional.  Acabou 11 partes.  Eu acredito que isso √© uma conquista.  Neste artigo, implementamos uma calculadora simples de pilha (tamb√©m conhecida como "nota√ß√£o polonesa reversa").  A implementa√ß√£o √© quase completamente constru√≠da em fun√ß√µes, com apenas um tipo especial e geralmente sem compara√ß√£o com a amostra, portanto, este √© um excelente campo de teste para os conceitos abordados em nossa s√©rie. </p><br><p><img src="https://habrastorage.org/webt/7j/cd/7x/7jcd7xzdvnhpyxuebjvbzb1uiqs.jpeg"></p><br><p>  Quero agradecer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>@kleidemos</em></a> separadamente.  Foi ele quem atuou como principal tradutor e gerente de toda a s√©rie de artigos.  Obrigada </p><br><ul><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Primeira parte</a></strong> </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Segunda parte</a></strong> </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Terceira parte</a></strong> </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Quarta parte</a></strong> </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Quinta parte</a></strong> </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sexta parte</a></strong> </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">S√©tima parte</a></strong> </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Oitava parte</a></strong> </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nona parte</a></strong> </li><li>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">D√©cimo</a></strong> <a name="habracut"></a></li></ul><br><hr><br><p>  Se voc√™ n√£o estiver familiarizado com essa calculadora, ela funcionar√° da seguinte maneira: n√∫meros s√£o empurrados para a pilha e opera√ß√µes, como adi√ß√£o e multiplica√ß√£o, selecionam n√∫meros da parte superior da pilha e, em seguida, retornam o resultado da opera√ß√£o. </p><br><p>  Esquema de computa√ß√£o simples na pilha: </p><br><br><p>  Antes de projetar esse sistema, considere como ele ser√° usado.  Seguindo uma sintaxe semelhante √† quarta, atribuiremos a cada a√ß√£o um r√≥tulo apropriado para que, no exemplo acima, voc√™ possa escrever algo como: </p><br><pre><code class="plaintext hljs">EMPTY ONE THREE ADD TWO MUL SHOW</code> </pre> <br><p>  Talvez seja imposs√≠vel obter exatamente essa sintaxe, mas vamos tentar chegar o mais pr√≥ximo poss√≠vel disso. </p><br><h2>  Tipo de dados da pilha </h2><br><p>  Primeiro, voc√™ precisa definir a estrutura de dados para a pilha.  Para simplificar, voc√™ pode usar uma lista de n√∫meros de ponto flutuante. </p><br><pre> <code class="plaintext hljs">type Stack = float list</code> </pre> <br><p>  Mas √© melhor agrup√°-lo em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tipo de uni√£o de caso √∫nico</a> para tornar o tipo mais visual, assim: </p><br><pre> <code class="plaintext hljs">type Stack = StackContents of float list</code> </pre> <br><p>  Por que √© melhor fazer exatamente isso, voc√™ pode ler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Agora crie uma nova pilha usando <code>StackContents</code> como construtor: </p><br><pre> <code class="plaintext hljs">let newStack = StackContents [1.0;2.0;3.0]</code> </pre> <br><p>  Para extrair conte√∫do de uma pilha existente, use o padr√£o correspondente a <code>StackContents</code> : </p><br><pre> <code class="plaintext hljs">let (StackContents contents) = newStack //  "contents"   // float list = [1.0; 2.0; 3.0]</code> </pre> <br><h2>  Empurre a fun√ß√£o </h2><br><p>  Em seguida, precisamos de uma maneira de colocar n√∫meros nessa pilha.  Para fazer isso, basta adicionar um novo valor ao topo da lista usando " <code>::</code> ". </p><br><p>  Exemplo de fun√ß√£o: </p><br><pre> <code class="plaintext hljs">let push x aStack = let (StackContents contents) = aStack let newContents = x::contents StackContents newContents</code> </pre> <br><p>  Esse recurso possui v√°rios recursos que vale a pena discutir. </p><br><p>  Primeiro, voc√™ deve prestar aten√ß√£o ao fato de que a estrutura da <code>list</code> √© imut√°vel, o que significa que a fun√ß√£o deve pegar uma pilha existente e retornar uma nova.  Isso n√£o √© apenas uma altera√ß√£o em uma pilha existente.  De fato, todas as fun√ß√µes neste exemplo ter√£o um formato semelhante: </p><br><pre> <code class="plaintext hljs">Input: Stack   -  Output:  Stack</code> </pre> <br><p>  Em segundo lugar, por que os par√¢metros est√£o nessa ordem?  Por que a pilha deve ir primeiro ou por √∫ltimo?  Na se√ß√£o sobre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">design de fun√ß√µes com aplica√ß√£o parcial,</a> foi dito que o par√¢metro de mudan√ßa mais frequente deveria durar.  Em breve ser√° poss√≠vel verificar se essas recomenda√ß√µes est√£o sendo seguidas. </p><br><p>  Finalmente, a fun√ß√£o pode ser mais concisa, combinando com o padr√£o no pr√≥prio par√¢metro da fun√ß√£o, em vez de <code>let</code> o corpo da fun√ß√£o. </p><br><p>  A vers√£o reescrita: </p><br><pre> <code class="plaintext hljs">let push x (StackContents contents) = StackContents (x::contents)</code> </pre> <br><p>  Muito melhor! </p><br><p>  A prop√≥sito, veja sua assinatura graciosa: </p><br><pre> <code class="plaintext hljs">val push : float -&gt; Stack -&gt; Stack</code> </pre> <br><p>  Como mencionado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">anteriormente</a> , a assinatura nos diz muito. <br>  Nesse caso, eu poderia adivinhar o que essa fun√ß√£o faz, apenas por sua assinatura, sem nem mesmo saber que √© chamada de "push". <br>  Esse √© outro motivo pelo qual foi uma boa id√©ia ter nomes de tipo expl√≠citos.  Se a pilha fosse apenas uma lista de n√∫meros de ponto flutuante, a fun√ß√£o n√£o seria t√£o auto-documentada. </p><br><p>  De uma forma ou de outra, verifique: </p><br><pre> <code class="plaintext hljs">let emptyStack = StackContents [] let stackWith1 = push 1.0 emptyStack let stackWith2 = push 2.0 stackWith1</code> </pre> <br><p>  Works great! </p><br><h2>  Empilhar sobrescrito superior usando push </h2><br><p>  Com esta fun√ß√£o simples, voc√™ pode definir facilmente uma opera√ß√£o que envia um n√∫mero espec√≠fico √† pilha. </p><br><pre> <code class="plaintext hljs">let ONE stack = push 1.0 stack let TWO stack = push 2.0 stack</code> </pre> <br><p>  Mas espere um minuto!  Voc√™ v√™ que o par√¢metro da <code>stack</code> √© mencionado nos dois lados da express√£o?  De fato, n√£o √© necess√°rio mencion√°-lo duas vezes.  Em vez disso, voc√™ pode omitir o par√¢metro e escrever uma fun√ß√£o com aplica√ß√£o parcial: </p><br><pre> <code class="plaintext hljs">let ONE = push 1.0 let TWO = push 2.0 let THREE = push 3.0 let FOUR = push 4.0 let FIVE = push 5.0</code> </pre> <br><p>  Agora √© √≥bvio que, se a fun√ß√£o <code>push</code> tivesse uma ordem diferente de par√¢metros, a <code>stack</code> teria que ser mencionada duas vezes. </p><br><p>  Tamb√©m vale a pena definir uma fun√ß√£o que cria uma pilha vazia: </p><br><pre> <code class="plaintext hljs">let EMPTY = StackContents []</code> </pre> <br><p>  Verifique as fun√ß√µes recebidas: </p><br><pre> <code class="plaintext hljs">let stackWith1 = ONE EMPTY let stackWith2 = TWO stackWith1 let stackWith3 = THREE stackWith2</code> </pre> <br><p>  Essas pilhas intermedi√°rias s√£o irritantes?  √â poss√≠vel se livrar deles?  Claro!  Observe que as fun√ß√µes ONE, DOIS e TR√äS t√™m a mesma assinatura: </p><br><pre> <code class="plaintext hljs">Stack -&gt; Stack</code> </pre> <br><p>  Ent√£o, eles est√£o perfeitamente conectados!  A sa√≠da de uma fun√ß√£o pode ser inserida no seguinte: </p><br><pre> <code class="plaintext hljs">let result123 = EMPTY |&gt; ONE |&gt; TWO |&gt; THREE let result312 = EMPTY |&gt; THREE |&gt; ONE |&gt; TWO</code> </pre> <br><h2>  Sair da pilha </h2><br><p>  Com a adi√ß√£o √† pilha calculada, mas e a fun√ß√£o <code>pop</code> ? </p><br><p>  Ao recuperar da pilha, √© obviamente necess√°rio retornar o topo da pilha, mas √© exatamente isso? </p><br><p>  Em um estilo orientado a objetos, a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">resposta √© sim</a> .  Mas, no caso de OOP, a pilha seria alterada nos bastidores, para que o item superior fosse removido. </p><br><p>  No entanto, em um estilo funcional, a pilha √© imut√°vel.  H√° apenas uma maneira de remover o elemento superior - crie uma <em>nova pilha</em> sem esse elemento.  Para que o chamador tenha acesso √† nova pilha reduzida, ela deve ser retornada junto com o elemento superior. </p><br><p>  Em outras palavras, a fun√ß√£o <code>pop</code> deve retornar <em>dois</em> valores, o elemento top e a nova pilha.  A maneira mais simples de fazer isso no F # √© simplesmente usar uma tupla. </p><br><p>  Implementa√ß√£o: </p><br><pre> <code class="plaintext hljs">///     ///          let pop (StackContents contents) = match contents with | top::rest -&gt; let newStack = StackContents rest (top,newStack)</code> </pre> <br><p>  A fun√ß√£o resultante tamb√©m √© muito simples. </p><br><p>  Como antes, o <code>contents</code> extra√≠do diretamente do par√¢metro. </p><br><p>  Em seguida, o conte√∫do do <code>contents</code> verificado usando a <code>match..with</code> com a express√£o. </p><br><p>  Em seguida, o elemento superior √© separado do restante da lista, uma nova pilha √© criada com base nos elementos restantes e, finalmente, tudo isso √© retornado como um par de tupla. </p><br><p>  Tente executar este c√≥digo e veja o que acontece.  Voc√™ receber√° um erro de compila√ß√£o! <br>  O compilador detectou um caso que n√£o foi resolvido - o que acontece se a pilha estiver vazia? </p><br><p>  Voc√™ tem que decidir como lidar com isso. </p><br><ul><li>  Op√ß√£o 1: retorne o status especial "Sucesso" ou "Erro", como foi feito na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">postagem da s√©rie "por que usar F #?"</a>  . </li><li>  Op√ß√£o 2: lan√ßar uma exce√ß√£o. </li></ul><br><p>  Normalmente, prefiro usar um estado especial para o erro, mas, nesse caso em particular, preferi lan√ßar uma exce√ß√£o.  Vers√£o corrigida do <code>pop</code> com manipula√ß√£o de caixa vazia: </p><br><pre> <code class="plaintext hljs">let pop (StackContents contents) = match contents with | top::rest -&gt; let newStack = StackContents rest (top,newStack) | [] -&gt; failwith "Stack underflow"</code> </pre> <br><p>  Verifique: </p><br><pre> <code class="plaintext hljs">let initialStack = EMPTY |&gt; ONE |&gt; TWO let popped1, poppedStack = pop initialStack let popped2, poppedStack2 = pop poppedStack</code> </pre> <br><p>  e teste de exce√ß√£o: </p><br><pre> <code class="plaintext hljs">let _ = pop EMPTY</code> </pre> <br><h2>  Fun√ß√µes aritm√©ticas </h2><br><p>  Agora que a adi√ß√£o e a exclus√£o est√£o em vigor, voc√™ pode come√ßar a trabalhar com as fun√ß√µes "adicionar" e "multiplicar": </p><br><pre> <code class="plaintext hljs">let ADD stack = let x,s = pop stack //   let y,s2 = pop s //    let result = x + y //   push result s2 //     let MUL stack = let x,s = pop stack //   let y,s2 = pop s //    let result = x * y //   push result s2 //    </code> </pre> <br><p>  Teste on-line: </p><br><pre> <code class="plaintext hljs">let add1and2 = EMPTY |&gt; ONE |&gt; TWO |&gt; ADD let add2and3 = EMPTY |&gt; TWO |&gt; THREE |&gt; ADD let mult2and3 = EMPTY |&gt; TWO |&gt; THREE |&gt; MUL</code> </pre> <br><p>  Isso funciona! </p><br><h3>  Tempo de refatora√ß√£o ... </h3><br><p>  Obviamente, uma quantidade significativa de c√≥digo √© duplicada nessas duas fun√ß√µes.  Como podemos consertar isso? </p><br><p>  Ambas as fun√ß√µes extraem dois valores da pilha, aplicam uma certa fun√ß√£o bin√°ria a eles e empurram o resultado de volta para a pilha.  Voc√™ pode enviar o c√≥digo geral para a fun√ß√£o bin√°ria, que assume uma fun√ß√£o matem√°tica com dois par√¢metros: </p><br><pre> <code class="plaintext hljs">let binary mathFn stack = //    let y,stack' = pop stack //     let x,stack'' = pop stack' //  let z = mathFn xy //      push z stack''</code> </pre> <br><p>  <em>Observe que nesta implementa√ß√£o, vers√µes diferentes do objeto "mesmo" s√£o marcadas com um n√∫mero diferente de aspas.</em>  <em>Isso ocorre porque os sufixos num√©ricos podem facilmente causar confus√£o.</em> </p><br><p>  Pergunta: por que os par√¢metros t√™m exatamente essa ordem, em vez de <code>mathFn</code> vir depois da <code>stack</code> ? </p><br><p>  Agora que voc√™ possui uma fun√ß√£o <code>binary</code> , √© muito mais f√°cil definir ADD e outras fun√ß√µes: </p><br><p>  Primeira tentativa de implementar o ADD usando <code>binary</code> : </p><br><pre> <code class="plaintext hljs">let ADD aStack = binary (fun xy -&gt; x + y) aStack</code> </pre> <br><p>  Mas voc√™ pode se livrar do lambda, porque  representa a defini√ß√£o <em>exata</em> da fun√ß√£o <code>+</code> : </p><br><pre> <code class="plaintext hljs">let ADD aStack = binary (+) aStack</code> </pre> <br><p>  Novamente, um aplicativo parcial pode ser usado para ocultar o par√¢metro da pilha.  Defini√ß√£o final: </p><br><pre> <code class="plaintext hljs">let ADD = binary (+)</code> </pre> <br><p>  Defini√ß√£o de outras fun√ß√µes matem√°ticas: </p><br><pre> <code class="plaintext hljs">let SUB = binary (-) let MUL = binary (*) let DIV = binary (../)</code> </pre> <br><p>  Experimente on-line: </p><br><pre> <code class="plaintext hljs">let div2by3 = EMPTY |&gt; THREE|&gt; TWO |&gt; DIV let sub2from5 = EMPTY |&gt; TWO |&gt; FIVE |&gt; SUB let add1and2thenSub3 = EMPTY |&gt; ONE |&gt; TWO |&gt; ADD |&gt; THREE |&gt; SUB</code> </pre> <br><p>  Da mesma forma, voc√™ pode criar uma fun√ß√£o auxiliar para opera√ß√µes un√°rias </p><br><pre> <code class="plaintext hljs">let unary f stack = let x,stack' = pop stack push (fx) stack'</code> </pre> <br><p>  E defina algumas fun√ß√µes un√°rias: </p><br><pre> <code class="plaintext hljs">let NEG = unary (fun x -&gt; -x) let SQUARE = unary (fun x -&gt; x * x)</code> </pre> <br><p>  Modo interativo: </p><br><pre> <code class="plaintext hljs">let neg3 = EMPTY |&gt; THREE|&gt; NEG let square2 = EMPTY |&gt; TWO |&gt; SQUARE</code> </pre> <br><h2>  Juntando tudo |  Juntando tudo </h2><br><p>  Nos requisitos iniciais, foi mencionado que gostar√≠amos de poder mostrar os resultados, por isso vale a pena definir a fun√ß√£o SHOW. </p><br><pre> <code class="plaintext hljs">let SHOW stack = let x,_ = pop stack printfn "The answer is %f" x stack //      </code> </pre> <br><p>  Observe que, neste caso, a nova vers√£o da pilha recebida via <code>pop</code> √© ignorada.  O resultado final √© a pilha original, como se nunca tivesse mudado. </p><br><p>  Por fim, voc√™ pode escrever o exemplo a seguir nos requisitos originais </p><br><pre> <code class="plaintext hljs">EMPTY |&gt; ONE |&gt; THREE |&gt; ADD |&gt; TWO |&gt; MUL |&gt; SHOW</code> </pre> <br><h3>  Seguir em frente </h3><br><p>  √â divertido, mas o que mais voc√™ pode fazer? </p><br><p>  Voc√™ pode definir v√°rias fun√ß√µes adicionais: </p><br><pre> <code class="plaintext hljs">///      let DUP stack = //    let x,_ = pop stack //      push x stack ///      let SWAP stack = let x,s = pop stack let y,s' = pop s push y (push x s') ///    let START = EMPTY</code> </pre> <br><p>  Usando essas fun√ß√µes adicionais, voc√™ pode escrever alguns exemplos elegantes: </p><br><pre> <code class="plaintext hljs">START |&gt; ONE |&gt; TWO |&gt; SHOW START |&gt; ONE |&gt; TWO |&gt; ADD |&gt; SHOW |&gt; THREE |&gt; ADD |&gt; SHOW START |&gt; THREE |&gt; DUP |&gt; DUP |&gt; MUL |&gt; MUL // 27 START |&gt; ONE |&gt; TWO |&gt; ADD |&gt; SHOW // 3 |&gt; THREE |&gt; MUL |&gt; SHOW // 9 |&gt; TWO |&gt; SWAP |&gt; DIV |&gt; SHOW // 9 div 2 = 4.5</code> </pre> <br><h2>  Usando composi√ß√£o em vez de pipelining </h2><br><p>  Mas isso n√£o √© tudo.  De fato, existe outra maneira interessante de representar essas fun√ß√µes. </p><br><p>  Como observado anteriormente, todos eles t√™m a mesma assinatura: </p><br><pre> <code class="plaintext hljs">Stack -&gt; Stack</code> </pre> <br><p>  Como entrada e sa√≠da s√£o do mesmo tipo, essas fun√ß√µes tamb√©m podem ser combinadas usando o operador de composi√ß√£o <code>&gt;&gt;</code> , e n√£o apenas atrav√©s de operadores em pipeline. </p><br><p>  Alguns exemplos: </p><br><pre> <code class="plaintext hljs">//    let ONE_TWO_ADD = ONE &gt;&gt; TWO &gt;&gt; ADD START |&gt; ONE_TWO_ADD |&gt; SHOW //    let SQUARE = DUP &gt;&gt; MUL START |&gt; TWO |&gt; SQUARE |&gt; SHOW //     let CUBE = DUP &gt;&gt; DUP &gt;&gt; MUL &gt;&gt; MUL START |&gt; THREE |&gt; CUBE |&gt; SHOW //   let SUM_NUMBERS_UPTO = DUP // n &gt;&gt; ONE &gt;&gt; ADD // n+1 &gt;&gt; MUL // n(n+1) &gt;&gt; TWO &gt;&gt; SWAP &gt;&gt; DIV // n(n+1) / 2 START |&gt; THREE |&gt; SQUARE |&gt; SUM_NUMBERS_UPTO |&gt; SHOW</code> </pre> <br><p>  Em cada um desses exemplos, uma nova fun√ß√£o √© definida usando uma composi√ß√£o de outras fun√ß√µes.  Este √© um bom exemplo de uma abordagem "combinat√≥ria" para criar funcionalidades. </p><br><h2>  Transportadores vs. Composi√ß√£o </h2><br><p>  Vimos duas maneiras diferentes de usar nosso modelo;  usando transportadores e composi√ß√£o.  Mas qual a diferen√ßa?  E por que um deve ser preferido em detrimento de outro? </p><br><p>  A diferen√ßa √© que os pipelines s√£o, em certo sentido, uma opera√ß√£o de "transforma√ß√£o em tempo real".  No momento do uso do pipeline, as opera√ß√µes s√£o executadas imediatamente, atrav√©s da transfer√™ncia de uma pilha espec√≠fica. </p><br><p>  Por outro lado, a composi√ß√£o √© algo como um "plano" que queremos implementar, construindo fun√ß√µes a partir de um conjunto de componentes sem aplica√ß√£o direta. </p><br><p>  Por exemplo, voc√™ pode criar um "plano" para calcular o quadrado de um n√∫mero por meio de uma combina√ß√£o de pequenas opera√ß√µes: </p><br><pre> <code class="plaintext hljs">let COMPOSED_SQUARE = DUP &gt;&gt; MUL</code> </pre> <br><p>  N√£o posso dar o equivalente com base em pipelines. </p><br><pre> <code class="plaintext hljs">let PIPED_SQUARE = DUP |&gt; MUL</code> </pre> <br><p>  Isso resultar√° em um erro de compila√ß√£o.  Eu preciso de alguma inst√¢ncia de pilha espec√≠fica para a express√£o funcionar: </p><br><pre> <code class="plaintext hljs">let stackWith2 = EMPTY |&gt; TWO let twoSquared = stackWith2 |&gt; DUP |&gt; MUL</code> </pre> <br><p>  E mesmo neste caso, posso obter uma resposta apenas para essa entrada espec√≠fica, e n√£o um plano de c√°lculo generalizado com base em qualquer entrada, como no exemplo de <code>COMPOSED_SQUARE</code> . </p><br><p>  Outra maneira de criar um "plano" √© passar explicitamente o lambda para fun√ß√µes mais primitivas: </p><br><pre> <code class="plaintext hljs">let LAMBDA_SQUARE = unary (fun x -&gt; x * x)</code> </pre> <br><p>  Essa √© uma maneira mais expl√≠cita (e provavelmente mais r√°pida), mas todas as vantagens e clareza da abordagem composicional s√£o perdidas. </p><br><p>  Em geral, se poss√≠vel, voc√™ deve procurar uma abordagem de composi√ß√£o! </p><br><h2>  C√≥digo completo </h2><br><p>  C√≥digo completo para todos os exemplos acima: </p><br><pre> <code class="plaintext hljs">// ============================================== //  // ============================================== type Stack = StackContents of float list // ============================================== //   // ============================================== ///     let push x (StackContents contents) = StackContents (x::contents) ///        ///       let pop (StackContents contents) = match contents with | top::rest -&gt; let newStack = StackContents rest (top,newStack) | [] -&gt; failwith "Stack underflow" // ============================================== //  () // ============================================== //     //      //     let binary mathFn stack = let y,stack' = pop stack let x,stack'' = pop stack' let z = mathFn xy push z stack'' //    //      //     let unary f stack = let x,stack' = pop stack push (fx) stack' // ============================================== //  () // ============================================== ///      let SHOW stack = let x,_ = pop stack printfn "The answer is %f" x stack //      ///    let DUP stack = let x,s = pop stack push x (push xs) ///      let SWAP stack = let x,s = pop stack let y,s' = pop s push y (push x s') ///    let DROP stack = let _,s = pop stack //   s //   // ============================================== // ,    // ============================================== //  // ------------------------------- let EMPTY = StackContents [] let START = EMPTY //  // ------------------------------- let ONE = push 1.0 let TWO = push 2.0 let THREE = push 3.0 let FOUR = push 4.0 let FIVE = push 5.0 //   // ------------------------------- let ADD = binary (+) let SUB = binary (-) let MUL = binary (*) let DIV = binary (../) let NEG = unary (fun x -&gt; -x) // ============================================== // ,     // ============================================== let SQUARE = DUP &gt;&gt; MUL let CUBE = DUP &gt;&gt; DUP &gt;&gt; MUL &gt;&gt; MUL let SUM_NUMBERS_UPTO = DUP // n &gt;&gt; ONE &gt;&gt; ADD // n+1 &gt;&gt; MUL // n(n+1) &gt;&gt; TWO &gt;&gt; SWAP &gt;&gt; DIV // n(n+1) / 2</code> </pre> <br><h2>  Conclus√£o </h2><br><p>  Temos uma calculadora simples baseada em pilha.  Vimos como, come√ßando com algumas opera√ß√µes primitivas ( <code>push</code> , <code>pop</code> , <code>binary</code> , <code>unary</code> ) e outras, √© poss√≠vel criar uma DSL completa, f√°cil de implementar e usar. </p><br><p>  Como voc√™ pode imaginar, este exemplo foi baseado na linguagem Forth.  Eu recomendo o livro gratuito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Thinking Forth"</a> , que fala n√£o apenas sobre a linguagem Forth, mas tamb√©m sobre outros m√©todos ( <em>n√£o</em> orientados a objetos!) Para decompor tarefas que s√£o igualmente aplic√°veis ‚Äã‚Äã√† programa√ß√£o funcional em geral. </p><br><p>  Eu tive a id√©ia para este artigo no blog lindo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ashley Feniello</a> .  Se voc√™ quiser se aprofundar na emula√ß√£o de uma linguagem baseada em pilha baseada em F #, comece com ela.  <em>Divirta-se!</em> </p><br><h1>  Recursos Adicionais </h1><br><p>  Existem muitos tutoriais para F #, incluindo materiais para quem vem com experi√™ncia em C # ou Java.  Os links a seguir podem ser √∫teis √† medida que voc√™ avan√ßa no F #: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia F #</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">F # para divers√£o e lucro</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">F # Wiki</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aprenda X em Y Minutos: F #</a> </li></ul><br><p>  V√°rias outras maneiras <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de come√ßar a aprender F #</a> tamb√©m <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">s√£o</a> descritas. </p><br><p>  Finalmente, a comunidade F # √© muito amig√°vel para iniciantes.  H√° um bate-papo muito ativo no Slack, suportado pela F # Software Foundation, com salas para iniciantes nas quais voc√™ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pode participar livremente</a> .  √â altamente recomend√°vel que voc√™ fa√ßa isso! </p><br><p>  N√£o se esque√ßa de visitar o site da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">comunidade de l√≠ngua russa F #</a> !  Se voc√™ tiver alguma d√∫vida sobre o aprendizado de um idioma, teremos prazer em discuti-los nas salas de bate-papo: </p><br><ul><li>  room <code>#ru_general</code> no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">F # Software Foundation Slack Chat</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chat em telegrama</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conversar em gitter</a> </li><li>  room #en_general no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">F # Software Foundation Slack Chat</a> </li></ul><br><h2>  Sobre autores de tradu√ß√£o </h2><br><p>  Traduzido por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>@kleidemos</em></a> <br><img src="https://habrastorage.org/getpro/habr/post_images/f95/c6d/92c/f95c6d92c5b1126b093792a43955aa43.png" width="56" height="56">  As mudan√ßas de tradu√ß√£o e editoriais foram feitas pelos esfor√ßos da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">comunidade de desenvolvedores de F # de l√≠ngua russa</a> .  Agradecemos tamb√©m a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>@schvepsss</em></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>@shwars</em></a> pela prepara√ß√£o deste artigo para publica√ß√£o. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433412/">https://habr.com/ru/post/pt433412/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433402/index.html">Pensamento funcional. Parte 8</a></li>
<li><a href="../pt433404/index.html">Tutorial Reagir Parte 3: Arquivos de Componentes, Estrutura do Projeto</a></li>
<li><a href="../pt433406/index.html">Pensamento funcional. Parte 9</a></li>
<li><a href="../pt433408/index.html">Manipula√ß√£o eficiente de mem√≥ria no Node.js</a></li>
<li><a href="../pt433410/index.html">Pensamento funcional. Parte 10</a></li>
<li><a href="../pt433414/index.html">Testando o PRTG Network Monitor e compara√ß√£o com o Zabbix</a></li>
<li><a href="../pt433420/index.html">Resultados ZeroNights 2018</a></li>
<li><a href="../pt433424/index.html">√â poss√≠vel carregar um n√≠vel intransit√°vel no Super Mario Maker?</a></li>
<li><a href="../pt433428/index.html">De onde vem a criatividade: an√°lise da atividade das ondas alfa do c√©rebro durante testes RAT</a></li>
<li><a href="../pt433430/index.html">Caixa Mecool KM9 para Android no novo SoC Amlogic S905X2 com 4 GB de RAM e Android TV 8.1 - entenda e perdoe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>