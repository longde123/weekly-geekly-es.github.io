<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â›¹ğŸ½ â›¹ğŸ¿ ğŸ£ GLSL: Pusat atau Centroid? Atau saat shader menyerang ğŸ’ ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ¾ ğŸ¤¹ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Memodifikasi shader untuk game yang akan datang, saya mengalami artefak yang tidak menyenangkan yang hanya memanifestasikan dirinya ketika perangkat k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GLSL: Pusat atau Centroid? Atau saat shader menyerang</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434046/">  Memodifikasi shader untuk game yang akan datang, saya mengalami artefak yang tidak menyenangkan yang hanya memanifestasikan dirinya ketika perangkat keras MSAA dihidupkan.  Pada tangkapan layar lanskap Anda dapat melihat beberapa piksel terlalu terang.  Nilai warna di beberapa dari mereka begitu besar sehingga setelah mekar, mereka berubah menjadi "hantu" multi-warna. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ta/gx/zy/tagxzyrj4t5z9godohkp1fgteya.png" alt="gambar"></div><br>  Saya membawa kepada Anda terjemahan sebuah artikel yang menjelaskan secara rinci alasan fenomena ini dan cara mengatasinya. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/526/948/f51/526948f51e45bbb855518c2cdf292d0e.jpg" alt="gambar"></div><br>  <i>Gambar 1 - Gambar yang benar (kiri) dan salah (kanan).</i>  <i>Perhatikan bilah kuning di tepi kiri gambar "salah".</i>  <i>Meskipun variabel myMixer bervariasi dari 0 hingga 1, entah bagaimana itu melampaui kisaran ini dalam gambar "salah".</i> <br><br>  Pertimbangkan shader fragmen sederhana dengan transformasi non-linear sederhana: <br><br><pre><code class="plaintext hljs">smooth in float myMixer; //      . //  sqrt    . void main( void ) { const vec3 blue = vec3( 0.0, 0.0, 1.0 ); const vec3 yellow = vec3( 1.0, 1.0, 0.0 ); float a = sqrt( myMixer ); //    myMixer &lt; 0.0 vec3 color = mix( blue, yellow, a ); //   gl_FragColor = vec4( color, 1.0 ); }</code> </pre> <br>  Dari mana asal garis kuning di gambar yang salah?  Untuk lebih memahami apa yang salah, mari kita lihat kasus di mana semuanya bekerja dengan benar (hampir) selalu. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83d/1fe/6fd/83d1fe6fdaaffaf185291655c0808542.png" alt="gambar"></div><br>  <i>Ini adalah rasterisasi klasik dengan satu sampel.</i>  <i>Kotak abu-abu adalah piksel, dan titik-titik kuning adalah pusat piksel yang terletak di koordinat jendela setengah bilangan bulat (secara default, koordinat piksel kiri bawah dalam gl_FragCoord adalah (0,5, 0,5) - <i>trans.</i> ).</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e5/854/0c1/3e58540c1bf747df60150e88d564d4a0.png" alt="gambar"></div><br>  <i>Pada gambar di atas, garis potong memisahkan setengah ruang primitif.</i>  <i>Di atas dan di sebelah kiri baris ini, variabel myMixer positif, dan di bawah dan di sebelah kanan negatif.</i> <br><br>  Rasterisasi satu sampel klasik mengklasifikasikan piksel dengan menjadi bagian dari primitif, dan membuat fragmen hanya untuk piksel yang pusatnya terletak di dalam primitif.  Dalam contoh ini, enam fragmen akan diproduksi, ditampilkan di kiri atas.  Piksel yang ditandai dalam warna yang dibungkam tidak termasuk dalam primitif.  Fragmen tidak akan dihasilkan untuk mereka. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83f/b9b/37f/83fb9b37f2e978f18643f111af0e2eb8.png" alt="gambar"></div><br>  <i>Hijau menunjukkan titik di mana shader fragmen akan dihitung.</i>  <i>Nilai myMixer akan dihitung untuk pusat setiap piksel.</i>  <i>Perhatikan bahwa titik-titik hijau di atas dan di sebelah kiri garis, sehingga nilai myMixer di dalamnya akan positif.</i>  <i>Semua data input yang terkait dengan simpul (variabel bervariasi atau keluar / masuk) juga akan diinterpolasi pada titik-titik ini.</i> <br><br>  Shader sederhana kami tidak menggunakan turunan (eksplisit atau implisit, misalnya, ketika mengambil sampel dari tekstur dengan level mip), tetapi turunan dFdx (horizontal) dan dFdy (vertikal) ditandai dengan panah.  Di dalam primitif, mereka didefinisikan dengan cukup baik dan teratur. <br><br>  Untuk meringkas: dalam satu pilihan, fragmen dihasilkan <i>hanya</i> jika pusat pixel jatuh "di dalam" primitif, data fragmen dihitung untuk pusat pixel, interpolasi data vertex dan perhitungan shader dilakukan hanya di dalam primitif.  Semuanya baik dan "benar."  (Hampir selalu. Untuk saat ini, mari kita hilangkan ketidakakuratan beberapa turunan pada piksel di sepanjang perbatasan primitif). <br><br>  Jadi, semuanya (hampir) sangat baik di rasterisasi dengan satu pilihan.  Tapi apa yang salah ketika multisampling dinyalakan? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/acc/eee/dc2/acceeedc234b34993f3e284dd6a2dd81.png" alt="gambar"></div><br>  <i>Ini adalah rasterisasi multisampling klasik.</i>  <i>Kotak abu-abu menunjukkan piksel.</i>  <i>Titik kuning adalah pusat piksel dalam koordinat setengah bilangan bulat.</i>  <i>Pada titik biru, pengambilan sampel terjadi.</i>  <i>Contoh ini menunjukkan diagram sederhana dari dua sampel yang diputar.</i>  <i>Semua argumen dapat digeneralisasi untuk jumlah sampel yang sewenang-wenang.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f10/7f0/1bb/f107f01bb4df32a980543cb70e6b8e5c.png" alt="gambar"></div><br>  <i>Garis masih memisahkan setengah ruang primitif.</i>  <i>Di atas dan di sebelah kiri, nilai myMixer positif.</i>  <i>Lebih rendah dan ke kanan - negatif.</i> <br><br>  Saat rasterisasi dengan multisampling, pengklasifikasi piksel akan menghasilkan fragmen jika <i>setidaknya satu</i> sampel piksel berada di dalam primitif. <br><br>  Dalam contoh ini, 10 fragmen akan dihasilkan, ditunjukkan pada setengah bidang kiri atas.  Perhatikan empat fragmen yang ditambahkan di sepanjang wajah, di mana satu sampel jatuh di dalam primitif, meskipun pusat berada di luar.  Piksel di luar primitif masih ditandai redup. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3e/842/b67/f3e842b67809ec9efe1c8e0ff837ee7c.png" alt="gambar"></div><br>  <i>Apa yang akan terjadi ketika menghitung di tengah piksel?</i> <br><br>  Shader akan dihitung dalam titik-titik hijau <i>dan</i> merah untuk masing-masing fragmen.  Data terkait myMixer dihitung di tengah setiap piksel.  Di titik hijau, nilai-nilai ini akan positif, karena mereka berada di atas dan di sebelah kiri perbatasan.  Titik merah di luar primitif, karena nilai-nilai myMixer di dalamnya negatif.  Pada titik merah, data terkait diekstrapolasi bukan interpolasi. <br><br>  Di shader kami, nilai sqrt (myMixer) tidak didefinisikan dengan myMixer negatif.  Bahkan ketika nilai myMixer yang direkam oleh vertex shader terletak pada interval dari nol hingga satu, dalam fragmen shader myMixer dapat melampaui interval ini karena ekstrapolasi.  Jadi, dengan myMixer negatif, hasil shader fragmen tidak didefinisikan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f4/31d/854/8f431d8540787d70ae2fb27aede04f9f.png" alt="gambar"></div><br>  <i>Kami masih mempertimbangkan menghitung shader di tengah-tengah piksel, panah pada gambar menunjukkan dFdx dan dFdy.</i>  <i>Pada fragmen internal poligon, mereka didefinisikan dengan cukup baik karena semua perhitungan dilakukan di pusat piksel yang terletak pada interval yang sama.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e02/f36/8fa/e02f368fae459f51896de647a98f23ab.png" alt="gambar"></div><br>  <i>Apa yang akan terjadi ketika menghitung titik selain pusat piksel?</i> <br><br>  Poin hijau adalah titik di mana shader akan dihitung.  Nilai terkait myMixer dihitung dalam <u>centroid</u> setiap piksel. <br><br>  Sentroid suatu piksel adalah pusat gravitasi dari persimpangan kuadrat piksel dan interior primitif.  Untuk piksel yang tertutup sepenuhnya, centroid adalah pusatnya.  Untuk piksel yang tertutup sebagian, centroid biasanya berbeda dari pusat. <br><br>  Standar OpenGL memungkinkan implementasi untuk memilih titik arbitrer di persimpangan primitif dan piksel, bukan centroid yang ideal.  Misalnya, itu bisa menjadi titik pengambilan sampel. <br><br>  Dalam contoh ini, jika pusat terletak di dalam primitif, data titik dihitung untuk pusat.  Kalau tidak, mereka dihitung pada salah satu titik sampel yang terletak di dalam primitif.  Ini terjadi selama empat piksel di sepanjang perbatasan.  Semua titik hijau terletak di atas dan di sebelah kiri perbatasan, sehingga nilai di dalamnya selalu diinterpolasi dan tidak pernah diekstrapolasi. <br><br>  Mengapa tidak selalu menghitung centroid shader?  Secara umum, ini lebih mahal daripada komputasi di pusat.  Namun, ini bukan faktor utama. <br><br>  Ini semua tentang menghitung turunan.  Perhatikan tanda panah di antara titik-titik hijau.  Jarak antara keduanya tidak sama untuk pasangan titik yang berbeda.  Selain itu, y tidak konstan untuk dFdx, dan x tidak konstan untuk dFdy.  <i>Derivatif kurang akurat ketika dihitung dalam centroid</i> . <br><br>  Ini adalah kompromi, dan karena itu OpenGL, dimulai dengan GLSL 1.20, menawarkan pengembang shader pilihan antara pusat dan centroid menggunakan kualifikasi centroid: <br><br><pre> <code class="plaintext hljs">centroid in float myMixer; //  centroid  smooth //      . //  sqrt    . void main( void ) { const vec3 blue = vec3( 0.0, 0.0, 1.0 ); const vec3 yellow = vec3( 1.0, 1.0, 0.0 ); float a = sqrt( myMixer ); //    myMixer &lt; 0.0 vec3 color = mix( blue, yellow, a ); //   gl_FragColor = vec4( color, 1.0 ); }</code> </pre><br>  Kapan Anda harus menggunakan centroid? <br><br><ol><li>  Ketika nilai ekstrapolasi dapat menyebabkan hasil yang tidak jelas.  Perhatikan fungsi bawaan, deskripsi yang mengatakan "hasilnya tidak didefinisikan jika ..." </li><li>  Ketika nilai ekstrapolasi digunakan dengan fungsi yang sangat non-linier atau terputus-putus.  Ini termasuk fungsi langkah atau perhitungan suar, terutama ketika eksponen cukup besar. </li></ol><br>  Kapan sebaiknya Anda tidak menggunakan centroid? <br><br><ol><li>  Jika Anda membutuhkan turunan yang tepat.  Derivatif dapat berupa eksplisit (panggilan dFdx) atau implisit, misalnya, sampel dari tekstur dengan tingkat mip atau dengan penyaringan anisotropik.  Dalam spesifikasi GLSL, turunan dalam centroid dianggap sangat tidak dapat digunakan sehingga dinyatakan tidak terdefinisi.  Dalam kasus seperti itu, cobalah untuk menulis: <br><br><pre> <code class="plaintext hljs">centroid in float myMixer; //  ! smooth in float myCenterMixer; //     .</code> </pre><br></li><li>  Jika grid diberikan di mana sebagian besar batas primitif bersifat internal dan selalu didefinisikan dengan baik.  Contoh paling sederhana adalah setrip 100 segitiga (TRIANGLE_STRIP), di mana hanya segitiga pertama dan terakhir yang dapat diekstrapolasi.  Kualifikasi centroid akan menghasilkan interpolasi pada dua segitiga ini dengan biaya kehilangan akurasi dan kontinuitas pada 98 segitiga yang tersisa. </li><li>  Jika Anda tahu bahwa artefak dapat muncul dari fungsi yang tidak terbatas, nonlinier, atau terputus-putus, tetapi dalam praktiknya artefak ini hampir tidak terlihat.  Jika shader <i>tidak</i> menyerang - jangan perbaiki! </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id434046/">https://habr.com/ru/post/id434046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id434018/index.html">Dapatkan Sertifikat Pengembang Android Google Associate</a></li>
<li><a href="../id434036/index.html">Selamat dan akhiri - kotak surat di domain portal Qip.ru telah pindah ke Yandex</a></li>
<li><a href="../id434038/index.html">Penjualan kendaraan listrik plug-in di China untuk November 2018</a></li>
<li><a href="../id434040/index.html">Intisari ITMO University: berbicara tentang proyek universitas, keberhasilan dan prestasi lulusan kami</a></li>
<li><a href="../id434044/index.html">Otentikasi Dua Faktor (2FA) Tahan Phishing</a></li>
<li><a href="../id434048/index.html">Facebook mengembangkan cryptocurrency untuk WhatsApp</a></li>
<li><a href="../id434050/index.html">Java Enterprise vs Android pada tahun 2019 - apa yang harus dipilih untuk pemula?</a></li>
<li><a href="../id434052/index.html">Konferensi BLACK HAT. Cara membuat ponsel mata-mata. Bagian 1</a></li>
<li><a href="../id434054/index.html">Konferensi BLACK HAT. Cara membuat ponsel mata-mata. Bagian 2</a></li>
<li><a href="../id434056/index.html">Anda perlu tahu di mana harus meletakkan nol</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>