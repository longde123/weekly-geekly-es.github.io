<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥ ğŸ¤œğŸ¾ ğŸ”– åŸºäºä»Yandex.Metrica Logs APIè·å¾—çš„æ•°æ®ï¼Œä»¥Rè¯­è¨€æ„é€ è¡Œä¸ºæ¸ é“ ğŸ’¦ ğŸ˜§ â£ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åˆ†æé”€å”®æ¸ é“æ˜¯äº’è”ç½‘è¥é”€ï¼ˆå°¤å…¶æ˜¯ç”µå­å•†åŠ¡ï¼‰çš„å…¸å‹ä»»åŠ¡ã€‚ æœ‰äº†å®ƒçš„å¸®åŠ©ï¼Œæ‚¨å¯ä»¥ï¼š 


- æ‰¾å‡ºæ‚¨å¤±å»æ½œåœ¨å®¢æˆ·çš„è´­ä¹°æ­¥éª¤ã€‚ 
- åœ¨æ‰©å±•è´­ä¹°è·¯å¾„çš„æ¯ä¸ªæ­¥éª¤çš„æƒ…å†µä¸‹ï¼Œæ¨¡æ‹Ÿé¢å¤–æ”¶å…¥æµå…¥çš„æ•°é‡ã€‚ 
- è¯„ä¼°åœ¨å„ç§å¹¿å‘Šå¹³å°ä¸Šè´­ä¹°çš„æµé‡çš„è´¨é‡ã€‚ 
- ä¸ºæ¯ä¸ªç»ç†è¯„ä¼°å¤„ç†ä¼ å…¥åº”ç”¨ç¨‹åºçš„è´¨é‡ã€‚ 


 åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åŸºäºä»Yandex.Metrica Logs APIè·å¾—çš„æ•°æ®ï¼Œä»¥Rè¯­è¨€æ„é€ è¡Œä¸ºæ¸ é“</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462279/"><p> åˆ†æé”€å”®æ¸ é“æ˜¯äº’è”ç½‘è¥é”€ï¼ˆå°¤å…¶æ˜¯ç”µå­å•†åŠ¡ï¼‰çš„å…¸å‹ä»»åŠ¡ã€‚ æœ‰äº†å®ƒçš„å¸®åŠ©ï¼Œæ‚¨å¯ä»¥ï¼š </p><br><ul><li> æ‰¾å‡ºæ‚¨å¤±å»æ½œåœ¨å®¢æˆ·çš„è´­ä¹°æ­¥éª¤ã€‚ </li><li> åœ¨æ‰©å±•è´­ä¹°è·¯å¾„çš„æ¯ä¸ªæ­¥éª¤çš„æƒ…å†µä¸‹ï¼Œæ¨¡æ‹Ÿé¢å¤–æ”¶å…¥æµå…¥çš„æ•°é‡ã€‚ </li><li> è¯„ä¼°åœ¨å„ç§å¹¿å‘Šå¹³å°ä¸Šè´­ä¹°çš„æµé‡çš„è´¨é‡ã€‚ </li><li> ä¸ºæ¯ä¸ªç»ç†è¯„ä¼°å¤„ç†ä¼ å…¥åº”ç”¨ç¨‹åºçš„è´¨é‡ã€‚ </li></ul><br><p> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•ä»Yandex Metrics Logs APIè¯·æ±‚Rè¯­è¨€çš„æ•°æ®ï¼Œå¹¶åŸºäºå®ƒä»¬æ„å»ºå’Œå¯è§†åŒ–æ¸ é“ã€‚ </p><br><p> Rè¯­è¨€çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å­˜åœ¨å¤§é‡æ‰©å±•å…¶åŸºæœ¬åŠŸèƒ½çš„è½¯ä»¶åŒ…ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»<code>rym</code> ï¼Œ <code>funneljoin</code>å’Œ<code>ggplot2</code> ã€‚ </p><br><p> ä½¿ç”¨<code>rym</code>æˆ‘ä»¬ä»Logs APIåŠ è½½æ•°æ®ï¼Œä½¿ç”¨<code>funneljoin</code>æ„å»ºè¡Œä¸ºæ¼æ–—ï¼Œå¹¶ä½¿ç”¨<code>ggplot2</code>å¯è§†åŒ–ç»“æœã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/903/ac7/75e/903ac775e293295d418a628a673f73d6.jpg" alt="å›¾ç‰‡"></p><a name="habracut"></a><br><h1 id="soderzhanie"> ç›®å½•å†…å®¹ </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»Logs API Yandex Metricsè¯·æ±‚æ•°æ®</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rymè½¯ä»¶åŒ…å®‰è£…</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨rymåŒ…ä½¿ç”¨Logs API Yandex Metrics</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Yandex Metrics APIä¸­çš„æˆæƒ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»Yandex Metrica APIè¯·æ±‚æ•°æ®</a> </li></ul></li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¼æ–—æ„å»ºfunneljoinåŒ…</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…funneljoin</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»Logs APIæ¥æ”¶çš„åå¤„ç†æ•°æ®</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¸ é“ç±»å‹</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¨‹åºæ­¥éª¤</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¸ é“å¯è§†åŒ–</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€šç”¨æ¼æ–—çš„å¯è§†åŒ–</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€šè¿‡æµé‡æ¸ é“è¿›è¡Œæ¸ é“å¯è§†åŒ–</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">èšè‹¯ä¹™çƒ¯</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»“è®º</a> </li></ul><br><h1 id="zapros-dannyh-iz-logs-api-yandeks-metriki"> ä»Logs API Yandex Metricsè¯·æ±‚æ•°æ® </h1><br><p> è°ä¸çŸ¥é“è¿™é‡Œçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Logs APIæ˜¯</a>æ¥è‡ªYandexå®˜æ–¹å¸®åŠ©çš„æŠ¥ä»·ã€‚ </p><br><blockquote>  Logs APIå…è®¸æ‚¨æ¥æ”¶Yandex.Metricaæ”¶é›†çš„éèšåˆæ•°æ®ã€‚ è¯¥APIé€‚ç”¨äºå¸Œæœ›ç‹¬ç«‹å¤„ç†ç»Ÿè®¡æ•°æ®å¹¶ä½¿ç”¨å®ƒä»¬æ¥è§£å†³ç‹¬ç‰¹åˆ†æé—®é¢˜çš„æœåŠ¡ç”¨æˆ·ã€‚ </blockquote><p> è¦ä½¿ç”¨Rä¸­çš„Yandex.Metrica Logs APIï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>rym</code>åŒ…ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">rymè½¯ä»¶åŒ…çš„æœ‰ç”¨é“¾æ¥</b> <div class="spoiler_text"><p> å‚è€ƒæ–‡çŒ®ï¼š </p><br><ul><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rymè½¯ä»¶åŒ…æ–‡æ¡£</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CRANä¸Šçš„Rymè½¯ä»¶åŒ…é¡µé¢</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Šçš„Rymè½¯ä»¶åŒ…é¡µé¢</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rymè½¯ä»¶åŒ…ç½‘ç»œç ”è®¨ä¼š</a></em> </li></ul></div></div><br><p>  <code>rym</code> -Rè½¯ä»¶åŒ…ï¼Œå®ƒæ˜¯ç”¨äºä¸Yandex Metrica APIè¿›è¡Œäº¤äº’çš„æ¥å£ã€‚ å…è®¸æ‚¨ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Management</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">APIï¼ŒReporting</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">APIï¼Œç¬¦åˆGore APIçš„Google Analyticsï¼ˆåˆ†æï¼‰v3</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Logs API</a> ã€‚ </p><br><h2 id="ustnovka-paketa-rym">  Rymè½¯ä»¶åŒ…å®‰è£… </h2><br><p> è¦ä½¿ç”¨Rä¸­çš„ä»»ä½•è½¯ä»¶åŒ…ï¼Œå¿…é¡»é¦–å…ˆå®‰è£…å’Œä¸‹è½½ã€‚ ä½¿ç”¨<code>install.packages()</code>å‘½ä»¤å®‰è£…ä¸€æ¬¡è½¯ä»¶åŒ…ã€‚ å¿…é¡»ä½¿ç”¨<code>library()</code>å‡½æ•°åœ¨Rä¸­çš„æ¯ä¸ªæ–°å·¥ä½œä¼šè¯ä¸­è¿æ¥è½¯ä»¶åŒ…ã€‚ </p><br><p> è¦å®‰è£…å¹¶è¿æ¥<code>rym</code>è½¯ä»¶åŒ…<code>rym</code>ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š </p><br><pre> <code class="plaintext hljs">install.packages("rym") library(rym)</code> </pre> <br><h2 id="rabota-s-logs-api-yandeks-metriki-s-pomoschyu-paketa-rym"> ä½¿ç”¨rymåŒ…ä½¿ç”¨Logs API Yandex Metrics </h2><br><p> ä¸ºäº†å»ºç«‹è¡Œä¸ºæ¸ é“ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½æ‚¨ç½‘ç«™ä¸Šæ‰€æœ‰è®¿é—®çš„è¡¨æ ¼ï¼Œå¹¶å‡†å¤‡æ•°æ®ä»¥è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚ </p><br><h3 id="avtorizaciya-v-api-yandeks-metriki">  Yandex Metrics APIä¸­çš„æˆæƒ </h3><br><p> ä½¿ç”¨APIâ€‹â€‹å§‹äºæˆæƒã€‚ åœ¨<code>rym</code>è½¯ä»¶åŒ…ä¸­<code>rym</code>æˆæƒè¿‡ç¨‹æ˜¯éƒ¨åˆ†è‡ªåŠ¨çš„ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨å…¶ä»»ä½•åŠŸèƒ½æ—¶å¼€å§‹ã€‚ </p><br><p> é¦–æ¬¡è®¿é—®APIæ—¶ï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°æµè§ˆå™¨ï¼Œä»¥ç¡®è®¤è®¿é—®<code>rym</code>è½¯ä»¶åŒ…çš„YandexæŒ‡æ ‡çš„<code>rym</code> ã€‚ ç¡®è®¤åï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°å°†ä¸ºæ‚¨ç”Ÿæˆæˆæƒç¡®è®¤ä»£ç çš„é¡µé¢ã€‚ å¿…é¡»å°†å…¶å¤åˆ¶å¹¶ç²˜è´´åˆ°Ræ§åˆ¶å°ä¸­ï¼Œä½œä¸ºå¯¹<code>"Enter authorize code:"</code>è¯·æ±‚çš„å“åº”ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥é€šè¿‡å¯¹è¯·æ±‚<code>"Do you want save API credential in local file ..."</code>å›ç­”<code>y</code>æˆ–<code>yes</code> ï¼Œå°†<code>"Do you want save API credential in local file ..."</code> ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨APIæ—¶ï¼Œæ‚¨å°†ä¸éœ€è¦é€šè¿‡æµè§ˆå™¨é‡æ–°è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶ä¸”å°†ä»æœ¬åœ°æ–‡ä»¶ä¸­åŠ è½½å‡­æ®ã€‚ </p><br><h3 id="zapros-dannyh-iz-api-yandeks-metriki"> ä»Yandex Metrica APIè¯·æ±‚æ•°æ® </h3><br><p> æˆ‘ä»¬ä»Yandex Metrics APIè¯¢é—®çš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¯ç”¨è®¡æ•°å™¨å’Œå·²é…ç½®ç›®æ ‡çš„åˆ—è¡¨ã€‚ è¿™æ˜¯ä½¿ç”¨<code>rym_get_counters()</code>å’Œ<code>rym_get_goals()</code>å‡½æ•°å®Œæˆçš„ã€‚ </p><br><pre> <code class="plaintext hljs">#   library(rym) #    counters &lt;- rym_get_counters(login = " ") #    goals &lt;- rym_get_goals("0000000", #    login = " ")</code> </pre> <br><p> ä½¿ç”¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ï¼Œç”¨æ‚¨çš„Yandexç”¨æˆ·åæ›¿æ¢<code>" "</code> ï¼Œåœ¨è¯¥åç§°ä¸‹æ‚¨å¯ä»¥ä½¿ç”¨æ‰€éœ€çš„YandexæŒ‡æ ‡ã€‚ è€Œ<code>"0000000"</code>ä¸ºæ‚¨éœ€è¦çš„è®¡æ•°å™¨ç¼–å·ã€‚ æ‚¨å¯ä»¥åœ¨å·²åŠ è½½çš„<em>è®¡æ•°å™¨</em>è¡¨ä¸­çœ‹åˆ°å¯ç”¨çš„è®¡æ•°å™¨ç¼–å·ã€‚ </p><br><p> å¯ç”¨è®¡æ•°å™¨è¡¨- <em>è®¡æ•°å™¨</em>å…·æœ‰ä»¥ä¸‹å½¢å¼ï¼š </p><br><pre> <code class="plaintext hljs"># A tibble: 2 x 9 id status owner_login name code_status site permission type gdpr_agreement_accepted &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; 1 11111111 Active site.ru1 Aerosus CS_NOT_FOUND site.ru edit simple 0 2 00000000 Active site.ru Aerosus RU CS_OK site.ru edit simple 1</code> </pre> <br><p>  <em>id</em>å­—æ®µæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„YandexæŒ‡æ ‡è®¡æ•°å™¨çš„æ•°é‡ã€‚ </p><br><p>  <em>ç›®æ ‡</em>è¡¨å¦‚ä¸‹ï¼š </p><br><pre> <code class="plaintext hljs"># A tibble: 4 x 5 id name type is_retargeting conditions &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;fct&gt; 1 47873638    url 0 type:contain, url:site.ru/checkout/cart/ 2 47873764    url 0 type:contain, url:site.ru/onestepcheckout/ 3 47874133     url 0 type:contain, url:/checkout/onepage/success 4 50646283     action 0 type:exact, url:click_phone</code> </pre> <br><p> å³ åœ¨æˆ‘ä½¿ç”¨çš„è®¡æ•°å™¨ä¸­ï¼Œé…ç½®äº†ä»¥ä¸‹æ“ä½œï¼š </p><br><ul><li> å»ç¯®å­ </li><li> è½¬åˆ°ä»˜æ¬¾ </li><li> æ„Ÿè°¢é¡µé¢è®¢è´­ </li><li> ç‚¹å‡»ç”µè¯æŒ‰é’® </li></ul><br><p> å°†æ¥ï¼Œä¸ºäº†è¿›è¡Œæ•°æ®è½¬æ¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>tidyverse</code>åº“ä¸­åŒ…å«çš„è½¯ä»¶åŒ…ï¼š <code>tidyr</code> ï¼Œ <code>dplyr</code> ã€‚ å› æ­¤ï¼Œåœ¨ä½¿ç”¨ä»¥ä¸‹ä»£ç ç¤ºä¾‹ä¹‹å‰ï¼Œè¯·å®‰è£…å¹¶è¿æ¥è¿™äº›è½¯ä»¶åŒ…æˆ–æ•´ä¸ª<code>tidyverse</code>åº“ã€‚ </p><br><pre> <code class="plaintext hljs"># install.packages("tidyverse") # library(tidyverse) install.packages(c("dplyr", "tidyr")) library(dplyr) library(tidyr)</code> </pre> <br><p>  <code>rym_get_logs()</code>å‡½æ•°å…è®¸æ‚¨ä»YandexæŒ‡æ ‡Logs APIæŒ‡æ ‡è¯·æ±‚æ•°æ®ã€‚ </p><br><pre> <code class="plaintext hljs">#      logs &lt;- rym_get_logs(counter = "0000000", date.from = "2019-04-01", date.to = "2019-06-30", fields = "ym:s:visitID, ym:s:clientID, ym:s:date, ym:s:goalsID, ym:s:lastTrafficSource, ym:s:isNewUser", login = " ") %&gt;% mutate(ym.s.date = as.Date(ym.s.date), ym.s.clientID = as.character(ym.s.clientID))</code> </pre> <br><p>  <code>rym_get_logs()</code>å‡½æ•°çš„ä¸»è¦å‚æ•°ä¸ºï¼š </p><br><ul><li> è®¡æ•°å™¨-æ‚¨ä»ä¸­è¯·æ±‚æ—¥å¿—çš„è®¡æ•°å™¨ç¼–å·ï¼› </li><li>  date.from-å¼€å§‹æ—¥æœŸï¼› </li><li>  date.to-ç»“æŸæ—¥æœŸï¼› </li><li> å­—æ®µ-æ‚¨è¦åŠ è½½çš„å­—æ®µåˆ—è¡¨ï¼› </li><li>  login-Yandexç™»å½•ï¼Œå¯ä»¥ä½¿ç”¨<em>counterä¸­</em>æŒ‡å®šçš„<em>è®¡æ•°å™¨</em> ã€‚ </li></ul><br><p> å› æ­¤ï¼Œæˆ‘ä»¬ä»Logs APIè¯·æ±‚äº†è®¿é—®æ•°æ®ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å‡ åˆ—ï¼š </p><br><ul><li>  ymï¼šsï¼švisitID-è®¿é—®ID </li><li>  ymï¼šsï¼šclientID-ç½‘ç«™ä¸Šçš„ç”¨æˆ·ID </li><li>  ymï¼šsï¼šæ—¥æœŸ-è®¿é—®æ—¥æœŸ </li><li>  ymï¼šsï¼šç›®æ ‡ID-æ­¤è®¿é—®æœŸé—´å®ç°çš„ç›®æ ‡çš„æ ‡è¯†ç¬¦ </li><li>  ymï¼šsï¼šlastTrafficSource-æµé‡æ¥æº </li><li>  ymï¼šsï¼šisNewUser-é¦–æ¬¡è®¿é—®è€… </li></ul><br><blockquote> æœ‰å…³å¯ç”¨å­—æ®µçš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…Logs API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¸®åŠ©</a> ã€‚ </blockquote><p> æ¥æ”¶åˆ°çš„æ•°æ®è¶³ä»¥ä½¿æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªæ¸ é“ï¼Œä¸æ­¤ç›¸å…³çš„æ˜¯Logs APIçš„å·¥ä½œå·²ç»å®Œæˆï¼Œç„¶åæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€æ­¥-å¯¹ä¸‹è½½æ•°æ®è¿›è¡Œåå¤„ç†ã€‚ </p><br><h1 id="postroenie-voronok-paket-funneljoin"> æ¼æ–—æ„å»ºfunneljoinåŒ… </h1><br><blockquote> æœ¬èŠ‚æä¾›çš„å¤§éƒ¨åˆ†ä¿¡æ¯å¯ä»funneljoin READMEåŒ…ä¸­è·å¾—ï¼Œè¯¥åŒ…å¯é€šè¿‡<a href="">å‚è€ƒè·å–</a> ã€‚ </blockquote><p>  <code>funneljoin</code>ç›®æ ‡æ˜¯ç®€åŒ–ç”¨æˆ·è¡Œä¸ºçš„æ¸ é“åˆ†æã€‚ ä¾‹å¦‚ï¼Œæ‚¨çš„ä»»åŠ¡æ˜¯æŸ¥æ‰¾è®¿é—®æ‚¨çš„ç½‘ç«™ç„¶åè¿›è¡Œæ³¨å†Œçš„ç”¨æˆ·ï¼Œå¹¶æ‰¾å‡ºä»é¦–æ¬¡è®¿é—®åˆ°æ³¨å†Œä¹‹é—´ç»è¿‡äº†å¤šå°‘æ—¶é—´ã€‚ æˆ–è€…ï¼Œæ‚¨éœ€è¦æ‰¾åˆ°ä¸¤å¤©å†…æŸ¥çœ‹è¿‡äº§å“å¡å¹¶å°†å…¶æ·»åŠ åˆ°è´­ç‰©ç¯®ä¸­çš„ç”¨æˆ·ã€‚  <code>funneljoin</code>è½¯ä»¶åŒ…å’Œ<code>after_join()</code>å‡½æ•°æœ‰åŠ©äºè§£å†³æ­¤ç±»é—®é¢˜ã€‚ </p><br><p>  <strong>å‚æ•°<code>after_join()</code> ï¼š</strong> </p><br><ul><li>  x-ä¸€ç»„æ•°æ®ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼ˆåœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œè®¿é—®ç«™ç‚¹ï¼Œåœ¨ç¬¬äºŒä¸ªä¸­æŸ¥çœ‹äº§å“å¡ï¼‰çš„ä¿¡æ¯ã€‚ </li><li>  y-åŒ…å«æœ‰å…³ç¬¬äºŒä¸ªäº‹ä»¶å®Œæˆçš„ä¿¡æ¯çš„æ•°æ®é›†ï¼ˆåœ¨ç¬¬ä¸€ä¸ªæ³¨å†Œç¤ºä¾‹ä¸­ï¼Œåœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼Œå°†äº§å“æ·»åŠ åˆ°è´­ç‰©ç¯®ä¸­ï¼‰ã€‚ </li><li>  by_time-åŒ…å«æœ‰å…³è¡¨<em>x</em>å’Œ<em>yä¸­</em>äº‹ä»¶å‘ç”Ÿæ—¥æœŸçš„ä¿¡æ¯çš„åˆ—ã€‚ </li><li>  by_user-è¡¨<em>x</em>å’Œ<em>yä¸­</em>å…·æœ‰ç”¨æˆ·æ ‡è¯†çš„åˆ—ã€‚ </li><li> æ¨¡å¼-ç”¨äºè¿æ¥çš„æ–¹æ³•ï¼šâ€œå†…éƒ¨â€ï¼Œâ€œå®Œæ•´â€ï¼Œâ€œåâ€ï¼Œâ€œåŠâ€ï¼Œâ€œå³â€ï¼Œâ€œå·¦â€ã€‚ ç›¸åï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨<code>after_mode_join</code> ï¼ˆä¾‹å¦‚ï¼Œç”¨<code>after_inner_join</code>ä»£æ›¿<code>after_join (..., mode = "inner")</code> ï¼‰ã€‚ </li><li>  type-ç”¨äºå®šä¹‰äº‹ä»¶å¯¹çš„åºåˆ—çš„ç±»å‹ï¼Œä¾‹å¦‚â€œ first-firstâ€ï¼Œâ€œ last-firstâ€ï¼Œâ€œ any-firstafterâ€ã€‚ åœ¨â€œæ¸ é“ç±»å‹â€éƒ¨åˆ†ä¸­ä»‹ç»äº†æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ </li><li>  max_gap / min_gapï¼ˆå¯é€‰ï¼‰-æŒ‰ç¬¬ä¸€äº‹ä»¶å’Œç¬¬äºŒäº‹ä»¶ä¹‹é—´çš„æœ€å¤§å’Œæœ€å°æŒç»­æ—¶é—´è¿›è¡Œè¿‡æ»¤ã€‚ </li><li>  gap_colï¼ˆå¯é€‰ï¼‰-æ˜¯å¦è¿”å›äº‹ä»¶ä¹‹é—´å…·æœ‰æ—¶é—´å·®çš„æ•°å­—å¼<em>.gap</em>åˆ—ã€‚ é»˜è®¤å€¼ä¸ºFALSEã€‚ </li></ul><br><h2 id="ustanovka-funneljoin"> å®‰è£…funneljoin </h2><br><p> åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œ <code>funneljoin</code>è½¯ä»¶åŒ…å°šæœªåœ¨CRANä¸Šå‘å¸ƒï¼Œå› æ­¤æ‚¨å¯ä»¥ä»GitHubå®‰è£…å®ƒã€‚ è¦ä»GitHubå®‰è£…è½¯ä»¶åŒ…ï¼Œæ‚¨å°†éœ€è¦ä¸€ä¸ªé™„åŠ çš„è½¯ä»¶åŒ…<code>devtools</code> ã€‚ </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("robinsones/funneljoin")</code> </pre> <br><h2 id="postobrabotka-dannyh-poluchennyh-iz-logs-api"> ä»Logs APIæ¥æ”¶çš„åå¤„ç†æ•°æ® </h2><br><p> ä¸ºäº†æ›´è¯¦ç»†åœ°ç ”ç©¶æ¸ é“æ„å»ºåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»Logs APIè·å¾—çš„æ•°æ®è½¬æ¢ä¸ºæ‰€éœ€çš„å½¢å¼ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œæœ€æ–¹ä¾¿çš„æ•°æ®å¤„ç†æ–¹å¼æ˜¯<code>tidyr</code>å’Œ<code>dplyr</code> ã€‚ </p><br><p> é¦–å…ˆï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š </p><br><ol><li> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <em>æ—¥å¿—</em>è¡¨çš„ä¸€è¡ŒåŒ…å«æœ‰å…³ä¸€æ¬¡è®¿é—®çš„ä¿¡æ¯ï¼Œè€Œ<em>ym.s.goalsID</em>åˆ—æ˜¯<code>[0,1,0,...]</code>æ ¼å¼çš„æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«åœ¨æ­¤è®¿é—®æœŸé—´å®ç°çš„ç›®æ ‡çš„æ ‡è¯†ç¬¦ã€‚ ä¸ºäº†ä½¿æ•°ç»„å…·æœ‰é€‚åˆè¿›ä¸€æ­¥å·¥ä½œçš„å½¢å¼ï¼Œæœ‰å¿…è¦ä»ä¸­åˆ é™¤å¤šä½™çš„å­—ç¬¦ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸ºæ–¹æ‹¬å·ã€‚ </li><li> æœ‰å¿…è¦é‡æ–°è®¾ç½®è¡¨æ ¼çš„æ ¼å¼ï¼Œä»¥ä¾¿ä¸€è¡ŒåŒ…å«æœ‰å…³è®¿é—®æœŸé—´å®ç°çš„ä¸€ä¸ªç›®æ ‡çš„ä¿¡æ¯ã€‚ å³ å¦‚æœåœ¨ä¸€æ¬¡è®¿é—®ä¸­å®ç°äº†ä¸‰ä¸ªç›®æ ‡ï¼Œåˆ™æ­¤è®¿é—®å°†åˆ†ä¸ºä¸‰è¡Œï¼Œå¹¶ä¸”<em>ym.s.goalsID</em>åˆ—ä¸­çš„æ¯ä¸€è¡Œå°†ä»…åŒ…å«ä¸€ä¸ªç›®æ ‡çš„æ ‡è¯†ç¬¦ã€‚ </li><li> å°†å¸¦æœ‰ç›®æ ‡åˆ—è¡¨çš„è¡¨é™„åŠ åˆ°æ—¥å¿—è¡¨ä¸­ï¼Œä»¥å‡†ç¡®äº†è§£æ¯æ¬¡è®¿é—®æœŸé—´å®ç°äº†å“ªäº›ç›®æ ‡ã€‚ </li><li> å°†å…·æœ‰ç›®æ ‡åç§°çš„<em>åç§°</em>åˆ—é‡å‘½åä¸º<em>events</em> ã€‚ </li></ol><br><p> ä»¥ä¸Šæ‰€æœ‰æ“ä½œéƒ½æ˜¯ä½¿ç”¨ä»¥ä¸‹ä»£ç å®ç°çš„ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">ä»Logs APIæ¥æ”¶çš„æ•°æ®çš„åå¤„ç†ä»£ç </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#      logs_goals &lt;- logs %&gt;% mutate(ym.s.goalsID = str_replace_all(ym.s.goalsID, #     "\\[|\\]", "") %&gt;% str_split(",")) %&gt;% #     unnest(cols = c(ym.s.goalsID)) %&gt;% mutate(ym.s.goalsID = as.integer(ym.s.goalsID)) %&gt;% #  id     left_join(goals, by = c("ym.s.goalsID" = "id")) %&gt;% #      rename(events = name) #     events</code> </pre> </div></div><br><p> å¯¹ä»£ç çš„å°è§£é‡Šã€‚  <code>%&gt;%</code>è¿ç®—ç¬¦ç§°ä¸ºç®¡é“ï¼Œä½¿ä»£ç æ›´æ˜“è¯»å’Œç´§å‡‘ã€‚ å®é™…ä¸Šï¼Œå®ƒé‡‡ç”¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°çš„ç»“æœï¼Œå¹¶å°†å…¶ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚ å› æ­¤ï¼Œè·å¾—äº†ä¸€ç§ä¼ é€å¸¦ï¼Œå®ƒä½¿æ‚¨ä¸ä¼šå› å­˜å‚¨ä¸­é—´ç»“æœçš„å¤šä½™å˜é‡è€Œé˜»å¡RAMã€‚ </p><br><p>  <code>str_replace_all</code>å‡½æ•°åˆ é™¤<em>ym.s.goalsID</em>åˆ—ä¸­çš„æ–¹æ‹¬å·ã€‚  <code>str_split</code>å°†<em>ym.s.goalsID</em>åˆ—ä¸­çš„ç›®æ ‡æ ‡è¯†ç¬¦æ‹†åˆ†ä¸ºå•ç‹¬çš„å€¼ï¼Œå¹¶ä¸”<code>unnest</code>å°†å®ƒä»¬æ‹†åˆ†ä¸ºå•ç‹¬çš„è¡Œï¼Œä»è€Œå¤åˆ¶æ‰€æœ‰å…¶ä»–åˆ—çš„å€¼ã€‚ </p><br><p> ä½¿ç”¨<code>mutate</code>æˆ‘ä»¬å°†ç›®æ ‡æ ‡è¯†ç¬¦è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ã€‚ </p><br><p>  <code>left_join</code> <em>ç›®æ ‡</em>è¡¨<code>left_join</code>åˆ°ç»“æœï¼Œè¯¥è¡¨å­˜å‚¨æœ‰å…³å·²é…ç½®ç›®æ ‡çš„ä¿¡æ¯ã€‚ ä½¿ç”¨å½“å‰è¡¨ä¸­çš„<em>ym.s.goalsID</em>åˆ—å’Œ<em>ç›®æ ‡</em>è¡¨ä¸­çš„<em>id</em>åˆ—ä½œä¸ºé”®ã€‚ </p><br><p> æœ€åï¼Œ <code>rename</code>å‡½æ•°å°†<em>åç§°</em>åˆ—<code>rename</code>å‘½åä¸º<em>events</em> ã€‚ </p><br><p> ç°åœ¨ï¼Œ <em>logs_goals</em>è¡¨å…·æœ‰è¿›ä¸€æ­¥å·¥ä½œæ‰€éœ€çš„<em>å¤–è§‚</em> ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸‰ä¸ªæ–°è¡¨ï¼š </p><br><ul><li>  first_visits-æ‰€æœ‰æ–°ç”¨æˆ·çš„ç¬¬ä¸€æ¬¡ä¼šè¯çš„æ—¥æœŸ </li><li> è´­ç‰©è½¦-å°†äº§å“æ·»åŠ åˆ°è´­ç‰©ç¯®çš„æ—¥æœŸ </li><li> è®¢å•-è®¢å• </li></ul><br><div class="spoiler">  <b class="spoiler_title">è¡¨åˆ›å»ºä»£ç </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#      first_visits &lt;- logs_goals %&gt;% filter(ym.s.isNewUser == 1 ) %&gt;% #     select(ym.s.clientID, #   clientID ym.s.date) #   date #       cart &lt;- logs_goals %&gt;% filter(events == "  ") %&gt;% select(ym.s.clientID, ym.s.date) #   orders &lt;- logs_goals %&gt;% filter(events == "   ") %&gt;% select(ym.s.clientID, ym.s.date)</code> </pre> </div></div><br><p> æ¯ä¸ªæ–°è¡¨éƒ½æ˜¯å¯¹åœ¨æœ€åä¸€æ­¥ä¸­è·å¾—çš„ä¸»<em>logs_goals</em>è¡¨è¿›è¡Œè¿‡æ»¤çš„ç»“æœã€‚ è¿‡æ»¤æ˜¯é€šè¿‡<code>filter</code>åŠŸèƒ½æ‰§è¡Œçš„ã€‚ </p><br><p> è¦æ„å»ºæ¸ é“ï¼Œå¯¹äºæˆ‘ä»¬<em>è€Œè¨€</em> ï¼Œ <em>åªéœ€</em>åœ¨æ–°è¡¨ä¸­ä¿ç•™æœ‰å…³ç”¨æˆ·IDå’Œäº‹ä»¶æ—¥æœŸçš„ä¿¡æ¯å³å¯ï¼Œè¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨<em>ym.s.clientID</em>å’Œ<em>ym.s.date</em>åˆ—ä¸­ã€‚ ä½¿ç”¨<code>select</code>åŠŸèƒ½é€‰æ‹©æ‰€éœ€çš„åˆ—ã€‚ </p><br><h2 id="tipy-voronok"> æ¸ é“ç±»å‹ </h2><br><p>  <em>type</em>å‚æ•°æ¥å—<code>first</code> ï¼Œ <code>last</code> ï¼Œ <code>any</code>å’Œ<code>lastbefore</code>ä¸<code>first</code> ï¼Œ <code>last</code> ï¼Œ <code>any</code>å’Œ<code>firstafter</code> <code>any</code> <code>firstafter</code> ã€‚ ä»¥ä¸‹æ˜¯å¯ä»¥ä½¿ç”¨çš„æœ€æœ‰ç”¨ç»„åˆçš„ç¤ºä¾‹ï¼š </p><br><ul><li>  <code>first-first</code> ï¼šè·å–æ¯ä¸ªç”¨æˆ·æœ€æ—©çš„<em>x</em>å’Œ<em>y</em>äº‹ä»¶ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦è·å–<strong>é¦–æ¬¡</strong>è®¿é—®çš„æ—¥æœŸå’Œ<strong>é¦–æ¬¡</strong>è´­ä¹°çš„æ—¥æœŸï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·ä½¿ç”¨æ¼æ–—ç±»å‹<code>first-first</code> ã€‚ </li></ul><br><pre> <code class="plaintext hljs">#    first-first first_visits %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "first-first")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 42 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1552251706539589249 2019-04-18 2019-05-15 2 1554193975665391000 2019-04-02 2019-04-15 3 1554317571426012455 2019-04-03 2019-04-04 4 15544716161033564779 2019-04-05 2019-04-08 5 1554648729526295287 2019-04-07 2019-04-11 6 1554722099539384487 2019-04-08 2019-04-17 7 1554723388680198551 2019-04-08 2019-04-08 8 15547828551024398507 2019-04-09 2019-05-13 9 1554866701619747784 2019-04-10 2019-04-10 10 1554914125524519624 2019-04-10 2019-04-10 # ... with 32 more rows</code> </pre> <br><p> æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªè¡¨ï¼Œå…¶ä¸­æœ‰1è¡ŒåŒ…å«æœ‰å…³ç”¨æˆ·é¦–æ¬¡è®¿é—®è¯¥ç½‘ç«™çš„æ—¥æœŸä»¥åŠå…¶ç¬¬ä¸€æ¬¡è®¢è´­æ—¥æœŸçš„æ•°æ®ã€‚ </p><br><ul><li>  <code>first-firstafter</code> ï¼šè·å–æœ€æ—©çš„<em>x</em> ï¼Œç„¶åç¬¬ä¸€ä¸ª<em>y</em>åœ¨ç¬¬ä¸€ä¸ª<em>xä¹‹å</em> ã€‚ ä¾‹å¦‚ï¼ŒæŸä¸ªç”¨æˆ·åå¤è®¿é—®æ‚¨çš„ç½‘ç«™ï¼Œåœ¨è®¿é—®è¿‡ç¨‹ä¸­ï¼Œä»–å°†äº§å“æ·»åŠ åˆ°è´­ç‰©ç¯®ä¸­ï¼Œå¦‚æœæ‚¨éœ€è¦è·å–å°†ç¬¬<strong>ä¸€ä¸ª</strong>äº§å“æ·»åŠ åˆ°è´­ç‰©ç¯®ä¸­çš„æ—¥æœŸä»¥åŠ<strong>æœ€æ¥è¿‘</strong>è¯¥è®¢å•çš„è®¢å•æ—¥æœŸï¼Œè¯·ä½¿ç”¨<code>first-firstafter</code>æ¼æ–—ç±»å‹ã€‚ </li></ul><br><pre> <code class="plaintext hljs">cart %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "first-firstafter")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 49 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1551433754595068897 2019-04-02 2019-04-05 2 1552251706539589249 2019-05-15 2019-05-15 3 1552997205196001429 2019-05-23 2019-05-23 4 1553261825377658768 2019-04-11 2019-04-11 5 1553541720631103579 2019-04-04 2019-04-05 6 1553761108775329787 2019-04-16 2019-04-16 7 1553828761648236553 2019-04-03 2019-04-03 8 1554193975665391000 2019-04-13 2019-04-15 9 1554317571426012455 2019-04-04 2019-04-04 10 15544716161033564779 2019-04-08 2019-04-08 # ... with 39 more rows</code> </pre> <br><ul><li>  <code>lastbefore-firstafter</code> ï¼šç¬¬ä¸€ä¸ª<em>xï¼Œ</em>ç„¶åæ˜¯<em>yï¼Œ</em>ç„¶åæ˜¯ä¸‹ä¸€ä¸ª<em>x</em> ã€‚ ä¾‹å¦‚ï¼Œç”¨æˆ·é‡å¤è®¿é—®äº†æ‚¨çš„ç½‘ç«™ï¼Œå…¶ä¸­ä¸€äº›ä¼šè¯ä»¥è´­ä¹°ç»“æŸã€‚ å¦‚æœæ‚¨éœ€è¦åœ¨è´­ä¹°ä¹‹å‰è·å–ä¸Šæ¬¡ä¼šè¯çš„æ—¥æœŸåŠå…¶åçš„è´­ä¹°æ—¥æœŸï¼Œè¯·ä½¿ç”¨æ¸ é“ç±»å‹<code>lastbefore-firstafter</code> ã€‚ </li></ul><br><pre> <code class="plaintext hljs">first_visits %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "lastbefore-firstafter")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 50 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1551433754595068897 2019-04-05 2019-04-05 2 1552251706539589249 2019-05-15 2019-05-15 3 1552251706539589249 2019-05-16 2019-05-16 4 1552997205196001429 2019-05-23 2019-05-23 5 1553261825377658768 2019-04-11 2019-04-11 6 1553541720631103579 2019-04-05 2019-04-05 7 1553761108775329787 2019-04-16 2019-04-16 8 1553828761648236553 2019-04-03 2019-04-03 9 1554193975665391000 2019-04-15 2019-04-15 10 1554317571426012455 2019-04-04 2019-04-04 # ... with 40 more rows</code> </pre> <br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ”¶åˆ°äº†ä¸€å¼ è¡¨æ ¼ï¼Œå…¶ä¸­ä¸€è¡ŒåŒ…å«æ¯ç¬”è®¢å•å®Œæˆå‰æœ€åä¸€ç§äº§å“è¢«æ·»åŠ åˆ°è´­ç‰©ç¯®ä¸­çš„æ—¥æœŸä»¥åŠè®¢å•æœ¬èº«çš„æ—¥æœŸã€‚ </p><br><ul><li>  <code>any-firstafter</code> ï¼šè·å¾—æ‰€æœ‰<em>x</em>å’Œå…¶åçš„ç¬¬ä¸€ä¸ª<em>y</em> ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·é‡å¤è®¿é—®äº†æ‚¨çš„ç«™ç‚¹ï¼Œåœ¨æ¯æ¬¡è®¿é—®æœŸé—´ï¼Œä»–éƒ½å‘è´­ç‰©ç¯®ä¸­æ·»åŠ äº†å„ç§äº§å“ï¼Œå¹¶å®šæœŸå‘æ‰€æœ‰æ·»åŠ çš„äº§å“ä¸‹è®¢å•ã€‚ å¦‚æœæ‚¨éœ€è¦è·å–æ‰€æœ‰æ·»åŠ åˆ°è´­ç‰©ç¯®ä¸­çš„å•†å“çš„æ—¥æœŸä»¥åŠè®¢è´­æ—¥æœŸï¼Œè¯·ä½¿ç”¨æ¼æ–—ç±»å‹<code>any-firstafter</code> ã€‚ </li></ul><br><pre> <code class="plaintext hljs">cart %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "any-firstafter")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 239 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1551433754595068897 2019-04-02 2019-04-05 2 1551433754595068897 2019-04-02 2019-04-05 3 1551433754595068897 2019-04-03 2019-04-05 4 1551433754595068897 2019-04-03 2019-04-05 5 1551433754595068897 2019-04-03 2019-04-05 6 1551433754595068897 2019-04-05 2019-04-05 7 1551433754595068897 2019-04-05 2019-04-05 8 1551433754595068897 2019-04-05 2019-04-05 9 1551433754595068897 2019-04-05 2019-04-05 10 1551433754595068897 2019-04-05 2019-04-05 # ... with 229 more rows</code> </pre> <br><ul><li>  any-anyï¼šå°†æ‰€æœ‰<em>x</em>å’Œæ‰€æœ‰<em>y</em>æ”¾åœ¨æ¯ä¸ª<em>x</em>æ—è¾¹ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¸Œæœ›æ¥æ”¶åˆ°è¯¥ç½‘ç«™çš„æ‰€æœ‰è®¿é—®çš„åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…æ‹¬æ¯ä¸ªç”¨æˆ·çš„æ‰€æœ‰åç»­è®¢å•ã€‚ </li></ul><br><pre> <code class="plaintext hljs">first_visits %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "any-any")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 122 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1552251706539589249 2019-04-18 2019-05-15 2 1552251706539589249 2019-04-18 2019-05-15 3 1552251706539589249 2019-04-18 2019-05-15 4 1552251706539589249 2019-04-18 2019-05-16 5 1554193975665391000 2019-04-02 2019-04-15 6 1554193975665391000 2019-04-02 2019-04-25 7 1554317571426012455 2019-04-03 2019-04-04 8 15544716161033564779 2019-04-05 2019-04-08 9 1554648729526295287 2019-04-07 2019-04-11 10 1554722099539384487 2019-04-08 2019-04-17 # ... with 112 more rows</code> </pre> <br><h3 id="shagi-po-voronke"> ç¨‹åºæ­¥éª¤ </h3><br><p> ä¸Šé¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†ä½¿ç”¨<code>after_inner_join()</code>å‡½æ•°ï¼Œåœ¨æ‰€æœ‰äº‹ä»¶éƒ½ç”±å•ç‹¬çš„è¡¨åˆ†éš”å¼€çš„æƒ…å†µä¸‹ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®<em>first_visits</em> ï¼Œ <em>cart</em>å’Œ<em>orders</em>è¡¨<code>after_inner_join()</code> ï¼Œä½¿ç”¨å®ƒå¾ˆæ–¹ä¾¿ã€‚ </p><br><p> ä½†æ˜¯Logs APIå¯ä»¥ä¸ºæ‚¨æä¾›æœ‰å…³ä¸€ä¸ªè¡¨ä¸­æ‰€æœ‰äº‹ä»¶çš„ä¿¡æ¯ï¼Œå¹¶ä¸”<code>funnel_start()</code>å’Œ<code>funnel_step()</code>å‡½æ•°å°†æ˜¯åˆ›å»ºä¸€ç³»åˆ—æ“ä½œçš„æ›´ä¾¿æ·æ–¹æ³•ã€‚  <code>funnel_start</code>å¸®åŠ©è®¾ç½®æ¸ é“çš„ç¬¬ä¸€æ­¥ï¼Œå¹¶é‡‡ç”¨äº”ä¸ªå‚æ•°ï¼š </p><br><ul><li>  tbl-äº‹ä»¶è¡¨ï¼› </li><li>  moment_type-æ¸ é“ä¸­çš„ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼› </li><li>  moment-åŒ…å«äº‹ä»¶åç§°çš„åˆ—çš„åç§°ï¼› </li><li>  tstamp-å¸¦æœ‰äº‹ä»¶å‘ç”Ÿæ—¥æœŸçš„åˆ—çš„åç§°ï¼› </li><li>  user-å¸¦æœ‰ç”¨æˆ·æ ‡è¯†ç¬¦çš„åˆ—çš„åç§°ã€‚ </li></ul><br><pre> <code class="plaintext hljs">logs_goals %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = "   ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 52 x 2 ym.s.clientID `ym.s.date_   ` &lt;chr&gt; &lt;date&gt; 1 1556018960123772801 2019-04-24 2 1561216372134023321 2019-06-22 3 1556955573636389438 2019-05-04 4 1559220890220134879 2019-05-30 5 1553261825377658768 2019-04-11 6 1561823182372545402 2019-06-29 7 1556047887455246275 2019-04-23 8 1554722099539384487 2019-04-17 9 1555420652241964245 2019-04-17 10 1553541720631103579 2019-04-05 # ... with 42 more rows</code> </pre> <br><p>  <code>funnel_start</code>è¿”å›ä¸€ä¸ªåŒ…å«<em>ym.s.clientI</em>å’Œ<em>ym.s.date_</em>åˆ—çš„è¡¨<code>ym.s.date_   </code> ï¼ˆåˆ—åç§°ä»¥åŠæ—¥æœŸï¼Œ_å’Œäº‹ä»¶åç§°ï¼‰ã€‚ </p><br><p> å¯ä»¥ä½¿ç”¨<code>funnel_step()</code>å‡½æ•°æ·»åŠ ä»¥ä¸‹æ­¥éª¤ã€‚ åœ¨<code>funnel_start</code>æˆ‘ä»¬å·²ç»æŒ‡å®šäº†æ‰€æœ‰å¿…éœ€åˆ—çš„æ ‡è¯†ç¬¦ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦ä½¿ç”¨<em>moment_type</em>å‚æ•°æŒ‡å®šå“ªä¸ªäº‹ä»¶å°†æ˜¯æ¼æ–—ä¸­çš„<em>ä¸‹ä¸€æ­¥</em> ï¼Œå¹¶ä¸”è¿æ¥<em>ç±»å‹</em>æ˜¯<em>type</em> ï¼ˆä¾‹å¦‚<code>"first-first"</code> ï¼Œ <code>"first-any"</code> ï¼‰ã€‚ </p><br><pre> <code class="plaintext hljs">logs_goals %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = "  ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID") %&gt;% funnel_step(moment_type = "   ", type = "first-last")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 319 x 3 ym.s.clientID `ym.s.date_  ` `ym.s.date_   ` &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1550828847886891355 2019-04-01 NA 2 1551901759770098825 2019-04-01 NA 3 1553595703262002507 2019-04-01 NA 4 1553856088331234886 2019-04-01 NA 5 1554044683888242311 2019-04-01 NA 6 1554095525459102609 2019-04-01 NA 7 1554100987632346537 2019-04-01 NA 8 1551433754595068897 2019-04-02 2019-04-05 9 1553627918798485452 2019-04-02 NA 10 155418104743178061 2019-04-02 NA # ... with 309 more rows</code> </pre> <br><p> ä½¿ç”¨<code>funnel_step</code>æ‚¨å¯ä»¥ä½¿ç”¨ä»»æ„æ•°é‡çš„æ­¥éª¤æ¥æ„å»ºæ¸ é“ã€‚ åœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ï¼Œè¦ä¸ºæ¯ä¸ªç”¨æˆ·æ„å»ºä¸€ä¸ªå®Œæ•´çš„æ¸ é“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">ç”¨äºä¸ºæ¯ä¸ªç”¨æˆ·æ„å»ºå®Œæ•´æ¸ é“çš„ä»£ç </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#         #     events - " " logs_goals &lt;- logs_goals %&gt;% filter(ym.s.isNewUser == 1 ) %&gt;% mutate(events = " ") %&gt;% bind_rows(logs_goals) #     logs_goals %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = " ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID") %&gt;% funnel_step(moment_type = "  ", type = "first-last") %&gt;% funnel_step(moment_type = "  ", type = "first-last") %&gt;% funnel_step(moment_type = "   ", type = "first-last")</code> </pre> </div></div><br><p> ç°åœ¨ï¼Œè›‹ç³•ä¸Šçš„æ¨±æ¡ƒæ˜¯<code>summarize_funnel()</code> ã€‚ è¯¥åŠŸèƒ½å¯è®©æ‚¨æ˜¾ç¤ºä»ä¸Šä¸€æ­¥åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ­¥éª¤çš„ç”¨æˆ·ç™¾åˆ†æ¯”ï¼Œä»¥åŠä»ç¬¬ä¸€æ­¥åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ­¥éª¤çš„ç”¨æˆ·ç™¾åˆ†æ¯”ã€‚ </p><br><pre> <code class="plaintext hljs">my_funnel &lt;- logs_goals %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = " ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID") %&gt;% funnel_steps(moment_type = c("  ", "  ", "   "), type = "first-last") %&gt;% summarize_funnel()</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 4 x 4 moment_type nb_step pct_cumulative pct_step &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; 1   18637 1 NA 2    1589 0.0853 0.0853 3    689 0.0494 0.579 4     34 0.0370 0.749</code> </pre> <br><p> <code>nb_step</code> â€”   ,   , <code>pct_cumulative</code> â€”      ,  <code>pct_step</code> â€”    . </p><br><h1 id="vizualizaciya-voronki">   </h1><br><p>    <em>my_funnel</em>   ,        <code>ggplot2</code> . </p><br><p> <code>ggplot2</code> â€”       R,      .     ,      ,  . </p><br><p>  <code>ggplot2</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a> ,     2005 .    ,    photoshop,  ,       . </p><br><h3 id="vizualizaciya-obschey-voronki">    </h3><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># install.packages("ggplot2") library(ggplot2) my_funnel %&gt;% mutate(padding = (sum(my_funnel$nb_step) - nb_step) / 2) %&gt;% gather(key = "variable", value = "val", -moment_type) %&gt;% filter(variable %in% c("nb_step", "padding")) %&gt;% arrange(desc(variable)) %&gt;% mutate(moment_type = factor(moment_type, levels = c("   ", "  ", "  ", " "))) %&gt;% ggplot( aes(x = moment_type) ) + geom_bar(aes(y = val, fill = variable), stat='identity', position='stack') + scale_fill_manual(values = c('coral', NA) ) + geom_text(data = my_funnel, aes(y = sum(my_funnel$nb_step) / 2, label = paste(round(round(pct_cumulative * 100,2)), '%')), colour='tomato4', fontface = "bold") + coord_flip() + theme(legend.position = 'none') + labs(x='moment', y='volume')</code> </pre> </div></div><br><p>         : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/260/763/bcf/260763bcf4c60a84ab713d2931e95ebe.png" alt=" "></p><br><p>     . </p><br><ol><li>         <em>my_funnel</em> . </li><li> <code>ggplot</code> â€”      ,    ,     ,    X     <em>moment_type</em> . </li><li> <code>geom_bar</code> â€”  â€”  ,            <code>aes</code> . </li><li> <code>scale_fill_manual</code> â€”    ,         ,    . </li><li> <code>geom_text</code> â€”   ,   %    . </li><li> <code>coord_flip</code> â€”   ,     . </li><li> <code>theme</code> â€”      : ,   ..           . </li><li> <code>labs</code> â€”     . </li></ol><br><h3 id="vizualizaciya-voronki-v-razreze-kanalov-trafika">       </h3><br><p>     ,   ,  ,      ,    . </p><br><p>           <code>lapply</code> ,       R.        ,      ,        <code>bind_rows</code> . </p><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#        first_visits &lt;- rename(first_visits, firstSource = ym.s.lastTrafficSource) #          logs_goals &lt;- select(first_visits, ym.s.clientID, firstSource) %&gt;% left_join(logs_goals, ., by = "ym.s.clientID") #     my_multi_funnel &lt;- lapply(c("ad", "organic", "direct"), function(source) { logs_goals %&gt;% filter(firstSource == source) %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = " ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID") %&gt;% funnel_steps(moment_type = c("  ", "  ", "   "), type = "first-last") %&gt;% summarize_funnel() %&gt;% mutate(firstSource = source) }) %&gt;% bind_rows() #  </code> </pre></div></div><br><pre> <code class="plaintext hljs"># A tibble: 12 x 5 moment_type nb_step pct_cumulative pct_step firstSource &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 1   14392 1 NA ad 2    154 0.0107 0.0107 ad 3    63 0.00438 0.409 ad 4     14 0.000973 0.222 ad 5   3372 1 NA organic 6    68 0.0202 0.0202 organic 7    37 0.0110 0.544 organic 8     13 0.00386 0.351 organic 9   607 1 NA direct 10    49 0.0807 0.0807 direct 11    21 0.0346 0.429 direct 12     8 0.0132 0.381 direct</code> </pre> <br><p>     <em>my_multi_funnel</em> ,        . </p><br><div class="spoiler"> <b class="spoiler_title">       </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#    my_multi_funnel %&gt;% mutate(padding = ( 1 - pct_cumulative) / 2 ) %&gt;% gather(key = "variable", value = "val", -moment_type, -firstSource) %&gt;% filter(variable %in% c("pct_cumulative", "padding")) %&gt;% arrange(desc(variable)) %&gt;% mutate(moment_type = factor(moment_type, levels = c("   ", "  ", "  ", " ")), variable = factor(variable, levels = c("pct_cumulative", "padding"))) %&gt;% ggplot( aes(x = moment_type) ) + geom_bar(aes(y = val, fill = variable), stat='identity', position='stack') + scale_fill_manual(values = c('coral', NA) ) + geom_text(data = my_multi_funnel_df, aes(y = 1 / 2, label =paste(round(round(pct_cumulative * 100, 2)), '%')), colour='tomato4', fontface = "bold") + coord_flip() + theme(legend.position = 'none') + labs(x='moment', y='volume') + facet_grid(. ~ firstSource)</code> </pre> </div></div><br><p>      : <br><img src="https://habrastorage.org/getpro/habr/post_images/12d/9a7/631/12d9a7631235b42f1081d996fa7eec62.png" alt="   "></p><br><p>     ? </p><br><ol><li>   <code>first_visits</code>    <code>ym.s.lastTrafficSource</code>  <code>firstSource</code> . </li><li>   <code>left_join</code>          <em>ym.s.clientID</em> .                 <code>firstSource</code> . </li><li>   <code>lapply</code>        ad, organic  direct.         <code>bind_rows</code> . </li><li>      <code>facet_grid(. ~ firstSource)</code> ,         <code>firstSource</code> . </li></ol><br><h1 id="ps"> èšè‹¯ä¹™çƒ¯ </h1><br><p>    .       <strong>PS</strong>      ,       R.           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">R4marketing</a> ,          R        . </p><br><p>    : </p><br><ul><li> ; </li><li> ; </li><li> ; </li><li>         R. </li></ul><br><h1 id="zaklyuchenie"> ç»“è®º </h1><br><p>  ,    ,        R     : </p><br><ol><li>             .; </li><li>   R    RStudio; </li><li>   <code>rym</code> , <code>funneljoin</code>  <code>ggplot2</code> ; </li><li>    <code>rym</code>   <code>rym_get_logs()</code>    .; </li><li>    <code>funneljoin</code>      . </li><li>      <code>ggplot2</code> . </li></ol><br><p>           ,     Logs API  ,      : CRM, 1   . ,         :  ,    -. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN462279/">https://habr.com/ru/post/zh-CN462279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN462269/index.html">çº¦ç¿°Â·ç½—æ¢…ç½—ï¼ˆJohn Romeroï¼‰ä¸ä¸–ç•Œæœ«æ—¥ï¼š80å¹´ä»£æ¸¸æˆå¼€å‘</a></li>
<li><a href="../zh-CN462271/index.html">iOSä¸­çš„é”å®šä»£ç ï¼šAppleå¦‚ä½•ä»é˜²å¾¡ä¸­çš„é˜²å¾¡è½¬å‘å®ˆå«å•ä¸€è¾¹ç•Œ</a></li>
<li><a href="../zh-CN462273/index.html">ä½¿ç”¨digisparkç®¡ç†æ‚¨çš„ç¬”è®°æœ¬ç”µè„‘æ”¯æ¶</a></li>
<li><a href="../zh-CN462275/index.html">æ¨å‡ºé€‚ç”¨äºJavaçš„PVS-Studioé™æ€åˆ†æå™¨</a></li>
<li><a href="../zh-CN462277/index.html">æŠ€æœ¯å‘å¸ƒMail.ru Group 2019</a></li>
<li><a href="../zh-CN462283/index.html">æ§åˆ¶é¢æ¿ä¸Šçš„GAZ-66ç©å…·ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN462293/index.html">å¿«é€Ÿå¼€å‘æŠ€æœ¯å¦‚ä½•æˆä¸ºä»¤äººä¸å¿«çš„æ¼æ´çš„æ¥æº</a></li>
<li><a href="../zh-CN462295/index.html">ç›®å½•å¤§å°ä¸å€¼å¾—æˆ‘ä»¬åŠªåŠ›</a></li>
<li><a href="../zh-CN462297/index.html">ã€Šå“ˆä¼¯å‘¨åˆŠã€‹ç¬¬12æœŸ/ OneWebï¼Œç¦æ­¢èšé›†è€…çš„ç«™ç‚¹ï¼ŒITéƒ¨é—¨çš„å·¥èµ„ï¼Œâ€œäº²çˆ±çš„ï¼Œæˆ‘ä»¬æ€æ­»äº†äº’è”ç½‘â€åœ¨ä¿„ç½—æ–¯è”é‚¦æ˜¯ä¸å…è®¸çš„</a></li>
<li><a href="../zh-CN462299/index.html">åœ¨.NETä¸­å››èˆäº”å…¥</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>