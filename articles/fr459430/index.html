<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüé® üîú üèåÔ∏è Application mobile avec g√©n√©ration automatique de formulaires: notre cas ‚ö´Ô∏è üòÖ üö∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les applications mobiles ne sont pas toujours simples et concises, comme nous les d√©veloppeurs l'adorons. D'autres applications sont cr√©√©es pour r√©sou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Application mobile avec g√©n√©ration automatique de formulaires: notre cas</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/459430/">  Les applications mobiles ne sont pas toujours simples et concises, comme nous les d√©veloppeurs l'adorons.  D'autres applications sont cr√©√©es pour r√©soudre des probl√®mes complexes d'utilisateurs et contiennent de nombreux √©crans et scripts.  Par exemple, des applications pour effectuer des tests, des questionnaires et des enqu√™tes - partout o√π vous devez remplir de nombreux formulaires au cours du processus.  Cette application sera discut√©e dans cet article. <br><br><img src="https://habrastorage.org/webt/qb/xy/ue/qbxyueqa7hvl4dy8wvzubhb5fxs.png"><br><br>  Nous avons commenc√© √† d√©velopper une application mobile pour les agents qui effectuent l'enregistrement sur place des polices d'assurance.  Ils remplissent de grands formulaires dans l'application avec des donn√©es clients: informations sur la voiture, les propri√©taires, les conducteurs, etc.  Bien que chaque formulaire ait ses propres sections, cellules et structure et que chaque √©l√©ment du questionnaire n√©cessite un type de donn√©es unique (cha√Æne, date, document joint), les formulaires d'√©cran √©taient assez similaires.  Mais l'essentiel est leur nombre ... Personne ne veut s'engager √† plusieurs reprises dans la visualisation et le traitement des m√™mes √©l√©ments. <br><br>  Pour √©viter les nombreuses heures de travail manuel sur la cr√©ation de formulaires, vous devez appliquer un peu d'ing√©niosit√© et beaucoup de construction dynamique de l'interface utilisateur.  Dans cet article, nous voulons partager comment nous avons r√©solu ce probl√®me. <br><a name="habracut"></a><br>  Pour une solution √©l√©gante au probl√®me, nous avons utilis√© le m√©canisme de g√©n√©ration d'objets - ViewModels, qui sont utilis√©s pour cr√©er des formulaires personnalis√©s √† l'aide de tableaux. <br><br><img src="https://habrastorage.org/webt/v3/s7/st/v3s7st-jaihcsxnxmybcn2n7gjw.png"><br><br>  Dans le travail normal, pour chaque table individuelle que le d√©veloppeur souhaite voir √† l'√©cran, une classe ViewModel distincte doit √™tre cr√©√©e.  Il d√©finit la composante visuelle de la table.  Nous avons d√©cid√© d'aller un niveau plus haut et de g√©n√©rer dynamiquement des ViewModels et des mod√®les, en utilisant une simple description de la structure √† travers les champs Enum. <br><br><h3>  Comment √ßa marche </h3><br>  Tout a commenc√© avec enum.  Pour chaque profil, nous cr√©ons une √©num√©ration unique - ce sont nos sections du profil.  L'une de ses m√©thodes consiste √† renvoyer le tableau de cellules dans cette section. <br><br>  Les cellules du tableau seront √©galement √©num√©r√©es avec des fonctions suppl√©mentaires qui d√©criront les propri√©t√©s des cellules.  Dans de telles fonctions, nous d√©finissons le nom de la cellule, la valeur initiale.  Param√®tres ajout√©s ult√©rieurement tels que <br><br><ul><li>  v√©rification de l'affichage: certaines cellules doivent √™tre masqu√©es, </li><li>  liste des cellules ¬´parents¬ª: cellules dont d√©pend la valeur, la validation ou l'affichage de cette cellule, </li><li>  type de cellule: cellules simples avec valeurs, cellules en switch, cellules avec fonction d'ajout d'√©l√©ments, etc. </li></ul><br>  Nous souscrivons toutes les sections au protocole g√©n√©ral QuestionnaireSectionCellType afin d'exclure la liaison √† une section sp√©cifique, nous ferons de m√™me avec toutes les cellules du tableau (QuestionnaireCellType). <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuestionnaireSectionCellType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> title: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sectionCellTypes: [<span class="hljs-type"><span class="hljs-type">QuestionnaireCellType</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuestionnaireCellType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> title: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialValue: <span class="hljs-type"><span class="hljs-type">Any?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isHidden: <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parentFields: [<span class="hljs-type"><span class="hljs-type">QuestionnaireCellType</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } ‚Ä¶ }</code> </pre> <br>  Un tel mod√®le sera tr√®s facile √† remplir.  Nous parcourons simplement toutes les sections, dans chaque section, nous parcourons un tableau de cellules et les ajoutons au tableau de mod√®les. <br><br>  Sur l'exemple de l'√©cran du preneur d'assurance (√©num√©ration des sections - InsurantSectionType): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InsurantModel</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseModel</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuestionnaireCellType</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() initParameters() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initParameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-type"><span class="hljs-type">InsurantSectionType</span></span>.allCases.forEach { type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> type.sectionCellTypes.forEach { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> valueModel = <span class="hljs-type"><span class="hljs-type">ValueModel</span></span>(type: $<span class="hljs-number"><span class="hljs-number">0</span></span>, parentFields: $<span class="hljs-number"><span class="hljs-number">0</span></span>.parentFields, value: $<span class="hljs-number"><span class="hljs-number">0</span></span>.initialValue) { valueModels.append(valueModel) } } } } }</code> </pre> <br>  C'est fait!  Nous avons maintenant un tableau avec les valeurs initiales.  Ajoutez des m√©thodes pour lire la valeur avec la cl√© QuestionnaireCellType et l'enregistrer dans l'√©l√©ment de tableau souhait√©. <br><br>  Certains mod√®les peuvent avoir des champs facultatifs, nous avons donc ajout√© un tableau avec des cl√©s facultatives.  Lors de la validation du mod√®le, ces cl√©s peuvent ne pas contenir de valeurs, mais le mod√®le sera consid√©r√© comme rempli. <br><br>  De plus, pour plus de commodit√©, toutes les valeurs du ValueModel nous souscrivent au protocole commun StringRepresentable pour limiter la liste des valeurs possibles et ajouter une m√©thode pour afficher la valeur dans la cellule. <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringRepresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stringValue: <span class="hljs-type"><span class="hljs-type">String?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } }</code> </pre> <br>  La fonctionnalit√© s'est d√©velopp√©e et de nombreuses autres propri√©t√©s et m√©thodes sont apparues dans les mod√®les: nettoyage du mod√®le (les valeurs initiales doivent √™tre d√©finies dans certains mod√®les), prise en charge d'un tableau dynamique de valeurs (valeur: tableau), etc. <br><br>  Cette approche s'est av√©r√©e tr√®s pratique pour le stockage dans la base de donn√©es √† l'aide de Realm.  Pour remplir le questionnaire, il est possible de s√©lectionner un mod√®le compl√©t√© pr√©c√©demment enregistr√©.  Pour √©tendre la politique CTP, l'agent n'aura plus besoin de remplir les documents de l'utilisateur, les pilotes attach√©s par lui et les donn√©es TCP pour le nouveau.  Au lieu de cela, vous pouvez simplement le r√©utiliser pour remplir celui existant. <br><br>  Pour modifier ou compl√©ter des tableaux, il vous suffit de trouver le ViewModel li√© √† un √©cran particulier, de trouver l'√©num√©ration n√©cessaire responsable de l'affichage du bloc souhait√© et d'ajouter ou de corriger plusieurs cas.  Tout, la table prendra la forme n√©cessaire! <br><br>  Remplir le formulaire avec des valeurs de test √©tait √©galement tr√®s pratique et rapide.  De cette fa√ßon, vous pouvez g√©n√©rer rapidement des donn√©es de test.  Et si vous ajoutez un fichier s√©par√© avec les donn√©es initiales, d'o√π le programme prendra la valeur dans chaque champ sp√©cifique du questionnaire, alors m√™me un d√©butant peut g√©n√©rer des questionnaires pr√™ts √† l'emploi sans entrer et d√©monter le reste du code, √† l'exception d'un fichier sp√©cifique. <br><br><h3>  D√©pendances </h3><br>  Une t√¢che distincte que nous avons r√©solue au cours du processus de d√©veloppement est la gestion des d√©pendances.  Certains √©l√©ments du questionnaire √©taient interconnect√©s.  Ainsi, le num√©ro de document ne peut pas √™tre rempli sans choisir le type de ce document lui-m√™me, le num√©ro de maison ne peut pas √™tre indiqu√© sans indiquer la ville et la rue, etc. <br><br><img src="https://habrastorage.org/webt/oc/vi/hb/ocvihbnjpzq20kwxwgmoarphdy4.png"><br><br>  Nous avons mis √† jour les valeurs du questionnaire en effa√ßant tous les champs d√©pendants (Par exemple, en supprimant ou en changeant le type d'un document, nous effa√ßons le champ ¬´num√©ro de document¬ª): <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateValueModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value: StringRepresentable?, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type: QuestionnaireCellType)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> model = valueModels.first(<span class="hljs-keyword"><span class="hljs-keyword">where</span></span>: { $<span class="hljs-number"><span class="hljs-number">0</span></span>.type.<span class="hljs-built_in"><span class="hljs-built_in">equal</span></span>(to: type) }) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } model.value = value clearRelativeValues(type: type) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearRelativeValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: QuestionnaireCellType)</span></span></span></span> { <span class="hljs-number"><span class="hljs-number">_</span></span> = valueModels.<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> { $<span class="hljs-number"><span class="hljs-number">0</span></span>.parentFields.<span class="hljs-built_in"><span class="hljs-built_in">contains</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">where</span></span>: { $<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">equal</span></span>(to: type) }) } .compactMap { $<span class="hljs-number"><span class="hljs-number">0</span></span>.type } .compactMap { updateValueModel(value: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: $<span class="hljs-number"><span class="hljs-number">0</span></span>) } }</code> </pre><br><h3>  Pi√®ges que nous avons d√ª r√©soudre pendant le d√©veloppement et comment nous avons r√©ussi </h3><br>  Il est clair que cette m√©thode est pratique pour les √©crans ayant la m√™me fonctionnalit√© (en remplissant les champs), mais pas si pratique si des √©l√©ments ou des fonctions uniques apparaissent sur un √©cran s√©par√© qui ne sont pas sur d'autres √©crans.  Dans notre candidature, ce sont: <br><br><ul><li>  Un √©cran avec la puissance du moteur, qui devait √™tre g√©n√©r√© s√©par√©ment, c'est pourquoi il diff√©rait en fonctionnalit√©s.  Sur cet √©cran, la demande devrait dispara√Ætre et la valeur du serveur est automatiquement remplac√©e.  J'ai d√ª lui cr√©er s√©par√©ment une classe qui serait charg√©e d'afficher, de charger, de valider, de charger depuis le serveur et de substituer une valeur dans un champ vide, sans d√©ranger l'utilisateur si ce dernier d√©cide d'entrer sa propre valeur. </li><li>  L'√©cran du num√©ro d'enregistrement, dans lequel le seul est le commutateur, ce qui affecte l'affichage ou le masquage du champ de texte.  Pour ce cas, une condition suppl√©mentaire devait √™tre effectu√©e, qui d√©terminerait par programme les cas avec la position du commutateur activ√©e comme valeur vide. </li><li>  Des listes dynamiques, comme une liste de pilotes qui devaient √™tre stock√©s et li√©s √† un formulaire, qui sont √©galement sortis du concept. </li><li>  Types uniques de validation des donn√©es.  Cela pourrait √™tre beaucoup de masques m√©lang√©s √† des regex'ami.  Et la validation de la date pour divers domaines, o√π la validation diff√©rait consid√©rablement (restrictions sur les valeurs minimum / maximum), etc. </li><li>  Les √©crans de saisie des donn√©es sont constitu√©s de cellules collectionView.  (Cela √©tait requis par la conception!) Pour cette raison, l'affichage des fen√™tres modales n√©cessitait un contr√¥le pr√©cis sur l'index s√©lectionn√©.  J'ai d√ª v√©rifier les champs disponibles pour le remplissage et exclure de la liste ceux que l'utilisateur ne devrait pas voir. </li><li>  Pour afficher correctement les donn√©es dans le tableau, il a fallu apporter des modifications aux m√©thodes de mod√©lisation de certains √©crans.  Les cellules telles que le nom et l'adresse sont affich√©es dans le tableau comme un seul √©l√©ment, mais n√©cessitent plusieurs √©crans contextuels pour √™tre enti√®rement remplis. </li></ul><br><h3>  Conclusion </h3><br>  Cette exp√©rience nous a permis chez True Engineering de mettre en ≈ìuvre rapidement une application mobile facile √† entretenir.  La polyvalence vous permet de g√©n√©rer rapidement des tableaux avec diff√©rents types de donn√©es d'entr√©e: nous avons r√©alis√© 20 fen√™tres en seulement une semaine.  Cette approche acc√©l√®re √©galement le processus de test des applications.  Dans un avenir proche, nous r√©utiliserons l'usine finie pour g√©n√©rer rapidement de nouvelles tables et de nouvelles fonctionnalit√©s. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459430/">https://habr.com/ru/post/fr459430/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459416/index.html">√âcriture d'une API pour les composants React, partie 5: il suffit d'utiliser la composition</a></li>
<li><a href="../fr459420/index.html">Le r√¢teau le plus courant lors de l'utilisation de printf dans des programmes pour microcontr√¥leurs</a></li>
<li><a href="../fr459422/index.html">Nous √©crivons API pour les composants React, partie 6: nous cr√©ons la communication entre les composants</a></li>
<li><a href="../fr459426/index.html">Comment le design de Yandex.Avto a √©t√© cr√©√©</a></li>
<li><a href="../fr459428/index.html">Intel Quartus Prime - tout ce dont vous avez besoin pour travailler avec Intel FPGA</a></li>
<li><a href="../fr459432/index.html">RD-180: les √âtats-Unis peuvent-ils fabriquer des moteurs-fus√©es?</a></li>
<li><a href="../fr459434/index.html">React Hook Router Une alternative moderne aux routeurs React</a></li>
<li><a href="../fr459438/index.html">Les donn√©es sont encore plus importantes</a></li>
<li><a href="../fr459442/index.html">5 syst√®mes de gestion d'√©v√©nements de s√©curit√© open source</a></li>
<li><a href="../fr459444/index.html">Modifications r√©centes de la pile Linux IO du point de vue DBA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>