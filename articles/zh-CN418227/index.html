<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔟 👁‍🗨 👈 麻省理工学院的课程“计算机系统安全”。 讲座7：本机客户端沙盒，第3部分 🤨 🎩 🧥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="麻省理工学院。 讲座课程＃6.858。 “计算机系统的安全性。” Nikolai Zeldovich，James Mickens。 2014年 
 计算机系统安全是一门有关开发和实施安全计算机系统的课程。 讲座涵盖了威胁模型，危害安全性的攻击以及基于最新科学研究的安全技术。 主题包括操作系统（OS）...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>麻省理工学院的课程“计算机系统安全”。 讲座7：本机客户端沙盒，第3部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418227/"><h3> 麻省理工学院。 讲座课程＃6.858。  “计算机系统的安全性。”  Nikolai Zeldovich，James Mickens。  2014年 </h3><br> 计算机系统安全是一门有关开发和实施安全计算机系统的课程。 讲座涵盖了威胁模型，危害安全性的攻击以及基于最新科学研究的安全技术。 主题包括操作系统（OS）安全性，功能，信息流管理，语言安全性，网络协议，硬件安全性和Web应用程序安全性。 <br><br> 第1课：“简介：威胁模型” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第2</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第3部分</a> <br> 第2课：“控制黑客攻击”， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第2</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第3部分</a> <br> 第3讲：“缓冲区溢出：漏洞利用和保护” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第2</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第3部分</a> <br> 讲座4：“特权分离”， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第2</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第3部分</a> <br> 讲座5：“安全系统从何而来？” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第2部分</a> <br> 讲座6：“机会” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第2</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第3部分</a> <br> 讲座7：“本地客户端沙箱” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第2</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第3部分</a> <a name="habracut"></a><br><br> 规则<b>C4</b>有一个警告。 您不能在程序末尾“跳转”。 您可以跳到的最后一件事是最后一条指令。 因此，该规则可确保在“引擎”流程中执行程序时不会出现差异。 <br><br> 规则<b>C5</b>指出，不能有大于32个字节的指令。 在讨论指令大小到32个字节的多重性时，我们考虑了该规则的特定版本，否则您可以跳入指令的中间并造成系统调用问题，系统调用可以“隐藏”在那里。 <br><br> 规则<b>C6</b>指出，所有可用的指令都可以从一开始就进行反汇编。 因此，这确保了我们看到每条指令，并且可以检查程序运行时运行的所有指令。 <br><br> 规则<b>C7</b>指出，所有直接跳跃都是正确的。 例如，您直接跳转到指示目标的那部分指令，尽管它不是32的倍数，但它仍然是从左到右应用反汇编的正确指令。 <br><br><img src="https://habrastorage.org/webt/1-/3i/vl/1-3ivlo26n7llpnkbkvzgzm-tci.jpeg"><br><br>  <b>观众：</b> <b>C5</b>和<b>C3有</b>什么区别？ <br><br>  <b>教授：</b>我认为<b>C5</b>表示如果我有一个多字节指令，它就不能越过相邻地址的边界。 假设我有一条指令流，并且有一个地址32和一个地址64。因此，一条指令不能越过32字节的边界倍数，也就是说，它一定不能以小于64的地址开头并以大于64的地址结尾。 <br><br><img src="https://habrastorage.org/webt/di/oc/l5/diocl5ztxk3kmc1ol0mmm_badik.jpeg"><br><br> 这就是规则<b>C5</b>所说的。 因为否则，在完成乘法运算的跳转32之后，您可以进入另一条指令的中间，在那儿不知道发生了什么。 <br><br> 规则<b>C3</b>与跳跃这一方面的禁止类似。 它指出，每当您跳跃时，跳跃的长度必须是32的倍数。 <br><br>  <b>C5</b>还声称，地址范围中的任何值（是32的倍数）都是安全的指令。 <br><br> 在阅读了这些规则的清单之后，我感到mixed贬不一，因为我无法评估这些规则是否足够，也就是说，清单是最小的还是完整的。 <br> 因此，让我们考虑一下您必须完成的作业。 我认为，实际上，在沙箱中执行一些复杂的指令时， <b>Native Client</b>的操作有错误。 我相信他们没有正确的长度编码，这可能会导致某些错误，但是我不记得确切的错误是什么。 <br><br> 假设沙盒验证器错误地获取某种指令的长度。 在这种情况下会发生什么不好的事情？ 您将如何使用此单据？ <br><br>  <b>受众：</b>例如，您可以隐藏系统调用或return语句<b>ret</b> 。 <br><br>  <b>教授：</b>是的。 假设您写下了一些漂亮的<b>AND</b>语句版本。 验证程序有可能被误认为它的长度为6个字节，而实际长度为5个字节。 <br><br><img src="https://habrastorage.org/webt/2z/ak/mg/2zakmgsficxcsi5tqkqnb-r_tj4.jpeg"><br><br> 会发生什么？ 验证器认为该指令的长度为6个字节，并且后​​面还有另一条有效指令。 但是处理器在启动代码时使用指令的实际长度，即5个字节。 结果，我们在<b>AND</b>语句的末尾有一个空闲字节，我们可以在其中插入系统调用并利用它来发挥我们的优势。 如果我们在此处插入一个<b>CD</b>字节，它将就像另一条指令的开头。 接下来，我们将在下一个6字节的跨度中放入一些内容，它就像一条以<b>CD</b>字节开头的指令，尽管实际上它是<b>AND</b>指令的一部分。 之后，我们可以进行系统调用并从沙箱中“退出”。 <br><br> 因此，本<b>机客户端</b>验证器必须将其操作与<b>CPU</b>的操作同步，即准确地“猜测”处理器将如何解释每个指令。 而且这应该在沙箱的每个级别上，这都是很难实现的。 <br><br> 实际上，本<b>机客户端中</b>还存在其他有趣的错误。 其中之一是在跳入“ <b>可信服务运行时”时</b>错误地清理了处理器环境。 我想我们稍后再讨论。 但是， <b>可信服务运行时</b>将基本上与旨在运行不可信模块的同一组<b>CPU</b>寄存器一起工作。 因此，如果处理器忘记清除某些内容或重新启动，则可以通过将不可靠的模块视为受信任的应用程序，并执行不应执行的操作或开发人员不打算执行的操作，来欺骗运行时。 <br><br> 那么我们现在在哪里？ 目前，我们了解了如何分解所有指令以及如何防止执行禁止的指令。 现在，让我们看看我们如何在<b>Native Client</b>模块中存储代码以及数据的内存和链接。 <br><br> 出于性能方面的考虑， <b>Native Client</b>家伙开始使用硬件支持来确保存储内存和链接实际上不会造成很多开销。 但是在考虑他们使用的硬件支持之前，我想听听建议，如果没有硬件支持，我该怎么做？ 我们能否仅提供对机器先前设置的范围内所有内存进程的访问？ <br><br>  <b>受众：</b>您可以使用指令清除所有高位。 <br><br><img src="https://habrastorage.org/webt/h1/b7/yg/h1b7ygdlwrvvs7y7ywxitmabec8.jpeg"><br><br>  <b>教授：</b>是的，没错。 实际上，我们看到这里有此<b>AND</b>指令，例如，每次跳转到某个地方时，它都会清除低位。 但是，如果我们想将所有可能的代码保持在256 MB以下，我们可以简单地将第一个属性<b>f</b>替换为<b>0</b>并获得<b>$ 0x0fffffe0</b>而不是<b>$ 0xffffffe0</b> 。 这将清除低位并设置256 MB的上限。 <br><br> 因此，这正是您所提供的功能，确保每次跳转时您的内存都在256 MB之内。 而且，我们正在进行拆卸的事实也使我们有可能验证所有直接跳跃均在可及范围之内。 <br><br> 他们之所以不对自己的代码执行此操作，是因为在<b>x86</b>平台上，您可以非常有效地对<b>AND</b>进行编码，其中所有高位均为1。这将导致存在一个3字节的<b>AND</b>指令和一个2字节的指令为跳跃。 因此，我们有3字节的额外开销。 但是，如果您需要一个非单位的高位，例如<b>0</b>而不是<b>f</b> ，那么您突然会有一个5字节的指令。 因此，我认为在这种情况下，他们担心开销。 <br><br>  <b>受众：</b>是否存在一些指令来增加您要获取的版本的说明？ 也就是说，您可以说您的指令可能存在持续的偏差或类似现象？ <br><br>  <b>教授：</b>我是这样认为的。 您可能会禁止跳转到某个复杂地址公式的指令，并且仅支持直接跳转到该值的指令，并且该值始终为<b>AND</b> 。 <br><br>  <b>受众：</b>与...相比，访问内存更重要。 <br><br>  <b>教授：</b>是的，因为那只是代码。 对于在<b>x86</b>平台上访问内存，有许多奇怪的方法可以访问特定的内存位置。 通常，您必须首先计算内存位置，然后添加一个附加的<b>AND，</b>然后才进行访问。 我认为这是他们担心由于使用此工具包而导致性能下降的真正原因。 <br><br> 在<b>x86</b>平台上，或至少在本文所述的32位平台上，它们使用硬件支持，而不是限制引用不可信模块的代码和地址数据。 <br><br> 在弄清楚如何在沙箱中使用<b>NaCl</b>模块之前，让我们看一下它的外观。 这种硬件称为分段。 它甚至在<b>x86</b>平台获得交换文件之前就出现了。 在<b>x86</b>平台上，在此过程中存在受支持的硬件表。 我们称其为段描述符表。 它是一束段，从0到任意大小的表的末尾。 这类似于<b>Unix上的</b>文件描述符，不同之处在于每个条目包含2个值：基数<b>基数</b>和长度。 <br><br> 该表告诉我们，我们有一对段，每当引用一个特定段时，从某种意义上讲，这意味着我们正在谈论的是一段内存，该内存开始于<b>基</b>址的<b>基</b>址，并持续整个长度<b>length</b> 。 <br><br><img src="https://habrastorage.org/webt/bc/5z/ly/bc5zlyp2hzg0aa6nn9nfsbbzwoe.jpeg"><br><br> 这有助于我们在<b>x86</b>平台上保持内存的边界，因为访问内存的每条指令均引用该表中的特定段。 <br><br> 例如，当我们执行<b>mov（％eax），（％ebx）时</b> ，也就是说，我们将内存值从<b>EAX</b>寄存器中存储的指针移动到<b>EBX</b>寄存器中存储的另一个指针，程序知道起始和结束地址是什么鉴于，并将该值保存在第二个地址中。 <br><br> 但是实际上，在<b>x86</b>平台上，当我们谈论内存时，有一个隐含的东西称为段描述符，类似于<b>Unix中的</b>文件描述符。 这只是描述符表中的索引，除非另有说明，否则每个操作代码都包含一个默认段。 <br><br> 因此，执行<b>mov（％eax）时</b> ，它引用<b>％ds</b>或数据段寄存器，该段是处理器中的特殊寄存器。 如果我没记错的话，它是一个指向此描述符表的16位整数。 <br><br> 同样， <b>（％ebx）</b> -引用相同的<b>％ds</b>段选择器。 实际上，在<b>x86中，</b>我们有6个代码选择器组： <b>CS，DS，ES，FS，GS</b>和<b>SS</b> 。  <b>CS调用选择器</b>隐式用于接收指令。 因此，如果您的指令指针指向某物，则它指的是选择<b>CS</b>段选择器的那个。 <br><br><img src="https://habrastorage.org/webt/li/vq/nz/livqnzyn6jk6muyb93siboedkik.jpeg"><br><br> 大多数数据引用隐式使用<b>DS</b>或<b>ES</b> ， <b>FS</b>和<b>GS</b>表示一些特殊的东西，并且<b>SS</b>始终用于堆栈操作。 而且，如果您执行<b>push＆pop</b> ，那么它们隐式地来自此段选择器。 这是一个相当古老的机制，但是在这种特殊情况下却非常有用。 <br><br> 如果访问某个地址，例如在选择器<b>％ds：addr中</b> ，则硬件会将其重定向到使用表<b>adrr + T [％ds] .base的操作</b> 。 这意味着它将从同一张表中获取模块长度地址。 因此，每次访问内存时，它都有一个以描述符表条目形式存在的段选择器数据库，并且它将使用您指定的地址并将其与相应段的长度进行匹配。 <br><br>  <b>听众：</b>那么为什么不使用它来保护缓冲区？ <br><br>  <b>教授：</b>是的，这是一个好问题！ 我们可以用它来防止缓冲区溢出吗？ 例如，对于我们拥有的每个缓冲区，您可以在此处放置缓冲区基数，并在此处放置缓冲区大小。 <br><br>  <b>听众：</b>如果您不需要在编写表格之前将其放在桌子上怎么办？ 您不需要经常出现。 <br><br>  <b>教授：</b>是的。 因此，我认为这种方法不经常用于防止缓冲区溢出的原因是，此表中的条目数在第16度不能超过2，因为描述符长16位，但实际上实际上，还有其他一些位用于其他用途。 因此，实际上您只能在该表的记录的13次幂中放置2。 因此，如果您的代码中的数据数组的大小大于2 <sup>13</sup> ，则该表可能会溢出。 <br><br> 另外，对于编译器直接管理该表会很奇怪，因为通常使用系统调用来操纵它。 您无法直接写入此表，首先需要对操作系统进行系统调用，然后操作系统会将记录放入此表中。 因此，我认为大多数编译器将根本不想处理这种复杂的内存缓冲区管理系统。 <br><br><img src="https://habrastorage.org/webt/rp/sa/hb/rpsahbydh4eumva5z7st5cfuc2a.jpeg"><br><br> 顺便说一句， <b>Multex</b>使用了这种方法：它有2 <sup>18个</sup>不同段的记录，2 <sup>18个</sup>可能的偏移量的记录。 每个公共库片段或内存片段都是单独的段。 他们都检查范围，因此不能在可变的水平上使用。 <br><br>  <b>受众：</b>据推测，不断需要使用内核会减慢该过程。 <br><br>  <b>教授：</b>是的，没错。 因此，由于在堆栈上突然创建新缓冲区时，我们需要进行系统调用以添加它，因此会产生开销。 <br><br> 那么这些元素中有多少实际上使用了细分机制？ 您可以猜测它是如何工作的。 我认为，默认情况下， <b>x86中的</b>所有这些段的基数均等于0，长度为2到32。因此，您可以访问所需的整个内存范围。 因此，对于<b>NaCl，</b>它们将基数编码为0，并将长度设置为256 MB。 然后，它们指向此记录中256 MB区域的6个段选择器的所有寄存器。 因此，无论何时设备访问内存，它都会以256 MB的偏移量对其进行修改。 因此，更改模块的能力将限制为256 MB。 <br><br> 我认为您现在已经了解了该硬件的支持方式及其工作方式，因此最终可以使用这些段选择器。 <br> 那么，如果我们仅执行该计划，会出什么问题呢？ 我们可以跳出不受信任模块中的细分选择器吗？ 我认为需要注意的一件事是这些寄存器就像常规寄存器一样，您可以将值移入和移出它们。 因此，必须确保不受信任的模块不会使这些段选择器寄存器失真。 因为描述符表中的某处可能有一条记录，它也是基数为0且长度最多为2 <sup>32</sup>的进程的源段描述符。 <br><br><img src="https://habrastorage.org/webt/vg/k-/sv/vgk-svh5b3xlsnke_meuehgaira.jpeg"><br><br> 因此，如果不可靠的模块能够更改<b>CS</b>或<b>DS</b>或<b>ES</b>或这些选择器中的任何一个，以便它们开始指向覆盖您所有地址空间的原始操作系统，则可以建立到该段的内存链接，并“跳出沙盒。 <br><br> 因此，本<b>机客户端</b>必须向此禁止列表添加更多说明。 我认为他们禁止所有指令，例如<b>mov％ds，es</b>等。 因此，一旦进入沙箱，就无法更改引用它的某些事物所引用的段。 在<b>x86</b>平台上<b>，</b>用于更改段描述符表的指令具有特权，但可以更改<b>ds，es</b>本身等。 该表完全没有特权。 <br><br>  <b>观众：</b>您可以初始化表格，以便在所有未使用的插槽中放置零长度吗？ <br><br>  <b>教授：</b>是的。 您可以为没有闲置插槽的表设置长度。 事实证明，您确实需要这个包含0和2 <sup>32的</sup>附加插槽，因为<b>受信任的运行时</b>环境应该在此段中启动并获得对整个内存范围的访问。 因此，此条目对于受信任的<b>运行时</b>环境起作用是必需的。 <br><br> 受众：为了改变表格输出的长度，需要做什么？ <br> 教授：您必须具有root特权。  <b>Linux</b>实际上为本地描述符表提供了一个名为<b>Modify_ldt（）</b>的系统，该系统允许任何进程修改其自己的表，也就是说，实际上每个进程都有一个表。 但是在<b>x86</b>平台上，这更加复杂，既有全局表又有本地表。 可以更改特定过程的本地表。 <br><br> 现在，让我们尝试找出如何从本<b>机客户端</b>执行过程中跳转或跳出沙盒。 跳出我们意味着什么？ <br><br><img src="https://habrastorage.org/webt/8t/lb/yj/8tlbyjy5erf0s-x7stz29ca1qae.jpeg"><br><br> 因此，我们需要运行此受信任的代码，并且该受信任的代码“存在”于256 MB限制之上。 要跳到那里，我们将必须撤消<b>Native Client已</b>安装的所有保护。 基本上，他们归结为更改这六个选择器。 我认为我们的验证器不会对256 MB以上的限制应用相同的规则，因此这非常简单。 <br><br> 但是，然后我们需要以某种方式跳入<b>受信任的运行时运行时</b> ，并将段选择器重新安装到该巨型段的正确值，从而覆盖整个进程的地址空间-此范围为0到2 <sup>32</sup> 。 他们称<b>原生客户端中</b>存在的此类机制为“蹦床” <b>蹦床</b>和“跳板” <b>跳板</b> 。 它们生活在低64k模块中。 最酷的是，这些“蹦床”和“跳跃”是位于过程空间下部64k中的代码段。 这意味着这个不可靠的模块可以跳转到那里，因为它是一个有效的代码地址，在32位的限制内和256 MB之内。 这样您就可以跳上蹦床。 <br><br>    <b>Native Client</b>    «» - .  ,  <b>Native Client</b>       «»,   trampoline      <b>trusted runtime</b> .         ,    <b>DS, CS</b>   ,       . <br><br>  ,        ,   -  <b>malo</b>   ,    «»,  «»  32-  . <br><br> ,     4096 + 32        ,     .   , ,   <b>mov %ds, 7</b> ,       <b>ds</b> ,   7         0  2 <sup>32</sup> .    <b>CS</b>       <b>trusted service runtime</b> ,     256 . <br><br><img src="https://habrastorage.org/webt/cr/fx/xj/crfxxjwdpg1tcflmflesmj_8obq.jpeg"><br><br>  ,     ,     ,         <b>trusted service runtime</b> ,    .            ,   .      DS ,   ,      ,     ,    -       . <br><br> ,        ? ,          «»? ,    ? <br><br> <b>:</b>    64. <br><br> <b>:</b> , ,          .         malo,       64,     32 .        ,       ,  ,     . <br><br>   ,        32-  ,       .  , ,        32 ,     32-    ,    .       «»    <b>trusted runtime</b>   32  . <br><br><img src="https://habrastorage.org/webt/hq/zy/tj/hqzytj99szvgxayslg6aqmwlmrk.jpeg"><br><br>      .     ,     ,     <b>DS, CS</b>   .    ,       256-  ,    <b>trusted runtime</b> ,      .                 . <br><br>         «»,      <b>trusted runtime</b>   256     <b>Native Client</b> . «»   <b>DS</b> , ,  <b>mov %ds, 7</b> ,        ,  <b>trusted runtime</b>    .     .     ,        «»,       - . <br><br>      <b>halt</b>    32-   «».        «»,   .      <b>trusted service runtime</b>      ,   1    . <br><br><img src="https://habrastorage.org/webt/50/am/cy/50amcyeulmago9zmrdvmjrsipvg.jpeg"><br><br>       <b>trusted service runtime</b> ,     ,        . <br><br> <b>:</b>   «»    ? <br><br> <b>:</b> «»     0  256   .        64-     ,    ,       «»,    - -.     <b>Native Client</b>       . <br><br> <b>:</b>          ? <br><br> <b>:</b> ,         ?  ,      «»?   ? <br><br> <b>:</b>    ,   ? <br><br> <b>:</b>  ,            -  <b>%eax</b> ,  <b>trusted runtime</b> : «,      »!      <b>EAX</b> ,    <b>mov</b> ,  «»      <b>EAX</b> ,        <b>trusted runtime</b> .   ,       «»? <br><br> <b>:</b> ,        ,         .   … <br><br> <b>:</b> ,   ,       —  ,       ,            0  2 <sup>32</sup> .   .         «»,                256 . <br><br>  ,      «»,          .  , «»    ,    .    ,   «»   . <br><br> <b>:</b>    «»   256 ? <br><br> <b>:</b>  ,      .    ,       <b>CS</b>         -  .     «»,       <b>halt</b> ,   mov,    <b>CS</b> ,        ,       256 . <br><br>  ,         ,    «».  ,       <b>DS</b> ,  ,  <b>CS</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳到某个地方。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也许，如果您尝试过，可以提出一些</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令序列，这些指令</font><font style="vertical-align: inherit;">可以在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Native Client</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块的地址空间范围之外执行此</font><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，下周见，并讨论网络安全。</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/I0Psvvky-44" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该课程的完整版本可</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此处获得</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">感谢您与我们在一起。</font></font>你喜欢我们的文章吗？ 想看更多有趣的资料吗？ 通过下订单或将其推荐给您的朋友来支持我们，为我们为您开发<b>的入门级​​服务器的独特模拟，为Habr用户</b>提供<b>30％的折扣：</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">关于VPS（KVM）E5-2650 v4（6核）的全部真相10GB DDR4 240GB SSD 1Gbps从$ 20还是如何划分服务器？</a>  （RAID1和RAID10提供选件，最多24个内核和最大40GB DDR4）。 <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS（KVM）E5-2650 v4（6核）10GB DDR4 240GB SSD 1Gbps至12月免费，</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在六个月内付款时，您可以</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订购</font><font style="vertical-align: inherit;">。</font></font><br><br>  <b>戴尔R730xd便宜2倍？</b> 仅<b>在荷兰和美国，</b>我们有<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2台Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100电视（249美元起）</a> ！</b> 阅读有关<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何构建基础架构大厦的信息。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用价格为9000欧元的Dell R730xd E5-2650 v4服务器的上等课程？</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN418227/">https://habr.com/ru/post/zh-CN418227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN418217/index.html">麻省理工学院的课程“计算机系统安全”。 讲座6：“机会”，第1部分</a></li>
<li><a href="../zh-CN418219/index.html">麻省理工学院的课程“计算机系统安全”。 讲座6：机会，第2部分</a></li>
<li><a href="../zh-CN418221/index.html">麻省理工学院的课程“计算机系统安全”。 讲座6：“机会”，第3部分</a></li>
<li><a href="../zh-CN418223/index.html">麻省理工学院的课程“计算机系统安全”。 讲座7：本机客户端沙盒，第1部分</a></li>
<li><a href="../zh-CN418225/index.html">麻省理工学院的课程“计算机系统安全”。 讲座7：本机客户端沙箱第2部分</a></li>
<li><a href="../zh-CN418229/index.html">麻省理工学院的课程“计算机系统安全”。 讲座8：网络安全模型，第1部分</a></li>
<li><a href="../zh-CN418233/index.html">BMW助记符用于查找边界值</a></li>
<li><a href="../zh-CN418235/index.html">编排的传奇故事或如何根据服务模式使用数据库建立服务中的业务交易</a></li>
<li><a href="../zh-CN418237/index.html">在Neo中的SAP Cloud平台上开发多租户应用程序，第2部分：授权和身份验证</a></li>
<li><a href="../zh-CN418239/index.html">智能手机48百万像素</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>