<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÜòÔ∏è üë©üèº‚Äç‚öïÔ∏è üëì Hallo Welt f√ºr den Empfang von Daten von einem Bluetooth (BLE) -Ger√§t √ºber C # üéñÔ∏è ‚¨ÜÔ∏è üìü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag. 

 Vor ein paar Wochen hatte ich das Problem, dass es einfach keinen normalen und modernen Artikel zum ersten Empfang von Daten mit Bluetoo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hallo Welt f√ºr den Empfang von Daten von einem Bluetooth (BLE) -Ger√§t √ºber C #</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423893/">  Guten Tag. <br><br>  Vor ein paar Wochen hatte ich das Problem, dass es einfach keinen normalen und modernen Artikel zum <u>ersten Empfang von Daten mit Bluetooth gibt</u> .  Und ich musste daran basteln, um zu verstehen, wo ich anfangen soll und wie ich es √ºberhaupt machen soll.  Und damit die Leute meine Fehler nicht wiederholen, finden Sie hier einen kurzen Aufsatz dar√ºber, wie das geht. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2w/rn/sg/2wrnsgxlvrbxisf6_zpf-psqlp0.png"></div><br><a name="habracut"></a><br>  Aber zuerst ein paar pathetische Worte, f√ºr die dies im Allgemeinen notwendig ist.  Die moderne Welt taucht zunehmend in die Ideologie des Internet der Dinge ein.  Jetzt interagiert alles miteinander, ein K√ºhlschrank mit Herd, ein B√ºgeleisen mit Staubsauger usw.  Durch das EKG in der Apple Watch wurde viel L√§rm erzeugt, aber moderne Blutdruckmessger√§te, Herzfrequenzmesser und Thermometer k√∂nnen seit langem Daten √ºber Bluetooth √ºbertragen.  Und das alles muss irgendwie mit einem einzigen Netzwerk verbunden sein.  Und das Schl√ºsselelement in diesem Netzwerk ist, was auch immer man sagen mag, ein Computer.  In diesem Zusammenhang ergab sich die Aufgabe, Daten von einem bestimmten Ger√§t √ºber Bluetooth zu empfangen. <br><br>  Zun√§chst einmal, was wir bereits hatten und was die Suche nach einer L√∂sung versch√§rfte.  Und wir hatten eine Anwendung in <i>.Net Core geschrieben</i> .  Was das Wesentliche der Anwendung ist, ist unwichtig. Der Einfachheit halber nehmen wir an, dass wir nur eine Konsole auf <i>.Net Core haben</i> .  Nun, das Ger√§t wird der Buchstabe <b>N genannt.</b> <br><br>  Die ersten Versuche, etwas zu finden, das mit Bluetooth √ºber C # funktioniert, f√ºhren zur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">32-Fu√ü-</a> Bibliothek. <br><br>  In NuGet-Paketen klingt es wie <i>32feet.NET</i> . <br><br>  √úbrigens findet sie in ihrer neuesten Produktausgabe sogar Bluetooth-Ger√§te, aber nicht den BLE-Standard [wie sich viel sp√§ter herausstellte].  Zum Beispiel wurde derselbe OnePlus 5T stabil durchsucht, das erforderliche Ger√§t <b>N jedoch</b> nicht.  Parallel dazu wurde in der offiziellen Antwort des Autors festgestellt, dass seine Bibliothek im Prinzip nicht mit BLE interagiert und es keinen Sinn macht, es zu versuchen.  Obwohl es auf Github eine vorl√§ufige Version von <i>InTheHand.Devices.Bluetooth gibt</i> , die BLE unterst√ºtzen sollte, wurde alles so stark ge√§ndert und es gibt √ºberhaupt keine Dokumentation, dass es nicht einmal funktioniert hat, das Projekt mit Ideen aus <i>32feet.NET</i> zu kompilieren. <br><br>  Neue Forschungsergebnisse f√ºhrten mich zu mehr Standardl√∂sungen, n√§mlich der <i>Universal Windows Platform</i> ( <i>UWP</i> ).  Bei der Entwicklung dieser Plattform hat <i>Microsoft</i> , das von der Idee der Vielseitigkeit und einer einzigen Anwendung f√ºr Computer und Telefon √ºberzeugt ist, versucht, mit Bluetooth zu interagieren.  Und hier funktioniert einfach alles gut, aber ... Wir haben ein Projekt zu <i>.Net Core</i> ... und es gibt nichts zu tun. <br><br>  Ich muss <i>sofort</i> sagen <i>,</i> dass wir keine L√∂sungen f√ºr die Interaktion von <i>UWP-</i> Bibliotheken mit <i>.Net Core finden konnten</i> und das Projekt auf <i>4.7.1</i> umgestellt werden musste <i>.</i>  ist der Nutzen nicht schwer.  Es gab zwar √úberlegungen, das Projekt auf <i>.Net Core</i> zu <i>belassen</i> und beispielsweise einen separaten Windows-Dienst mit Daten√ºbertragung √ºber Named Pipes (Named Pipe) zu erstellen oder einen <i>WCF-</i> Dienst zu <i>er√∂ffnen</i> und eine Interaktion mit ihm herzustellen, aber in unserem Fall war dies nicht sinnvoll. <br><br><hr><br>  Am Ende haben wir also vor dem Start: <br><br><ul><li>  Projekt am <i>4.7.1.</i> </li><li>  Win10 wurde auf <i>Version 10.0.17134 Build 17134</i> aktualisiert <i>.</i> </li></ul><br>  Zuerst m√ºssen Sie ein paar Bibliotheken mit Stiften verbinden, n√§mlich <br><br><ul><li>  "Windows von der universellen Windows-Plattform" <br>  <i>C: \ Programme (x86) \ Windows Kits \ 10 \ UnionMetadata \ 10.0.17134.0 \ Windows.winmd</i> </li><li>  "System.Runtime.WindowsRuntime" <br>  <i>C: \ Programme (x86) \ Referenzassemblies \ Microsoft \ Framework \ .NETCore \ v4.5 \ System.Runtime.WindowsRuntime.dll</i> </li></ul><br>  Und eigentlich alles, dann geht die Arbeit mit dem Ger√§t selbst problemlos durch die Dokumentation. <br>  Interagieren Sie mit BLE √ºber die BluetoothLEAdvertisementWatcher-Klasse <br>  Wir d√ºrfen jedoch nicht vergessen, dass ohne die API des Ger√§ts selbst etwas Sinnvolles nicht funktioniert. <br><br>  Hier ist mein Beispielcode zum Abrufen von Daten von einem Ger√§t. <br><br>  Dieser Code soll sicherstellen, dass das Ger√§t bereits hinzugef√ºgt (verbunden) wurde. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BluetoothObserver</span></span> { BluetoothLEAdvertisementWatcher Watcher { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Watcher = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BluetoothLEAdvertisementWatcher() { ScanningMode = BluetoothLEScanningMode.Active }; Watcher.Received += Watcher_Received; Watcher.Stopped += Watcher_Stopped; Watcher.Start(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isFindDevice { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watcher_Received</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BluetoothLEAdvertisementWatcher sender, BluetoothLEAdvertisementReceivedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFindDevice) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (args.Advertisement.LocalName.Contains(<span class="hljs-string"><span class="hljs-string">"deviceName"</span></span>)) { isFindDevice = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; BluetoothLEDevice bluetoothLeDevice = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> BluetoothLEDevice.FromBluetoothAddressAsync(args.BluetoothAddress); GattDeviceServicesResult result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> bluetoothLeDevice.GetGattServicesAsync(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.Status == GattCommunicationStatus.Success) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> services = result.Services; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> services) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!service.Uuid.ToString().StartsWith(<span class="hljs-string"><span class="hljs-string">"serviceName"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } GattCharacteristicsResult characteristicsResult = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> service.GetCharacteristicsAsync(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (characteristicsResult.Status == GattCommunicationStatus.Success) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> characteristics = characteristicsResult.Characteristics; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> characteristic <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> characteristics) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!characteristic.Uuid.ToString().StartsWith(<span class="hljs-string"><span class="hljs-string">"characteristicName"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } GattCharacteristicProperties properties = characteristic.CharacteristicProperties; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (properties.HasFlag(GattCharacteristicProperties.Indicate)) { characteristic.ValueChanged += Characteristic_ValueChanged; GattWriteResult status = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> characteristic.WriteClientCharacteristicConfigurationDescriptorWithResultAsync(GattClientCharacteristicConfigurationDescriptorValue.Indicate); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (properties.HasFlag(GattCharacteristicProperties.Read)) { GattReadResult gattResult = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> characteristic.ReadValueAsync(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gattResult.Status == GattCommunicationStatus.Success) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reader = DataReader.FromBuffer(gattResult.Value); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] input = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[reader.UnconsumedBufferLength]; reader.ReadBytes(input); <span class="hljs-comment"><span class="hljs-comment">// input } } } } } } } } private void Characteristic_ValueChanged(GattCharacteristic sender, GattValueChangedEventArgs args) { var reader = DataReader.FromBuffer(args.CharacteristicValue); byte[] input = new byte[reader.UnconsumedBufferLength]; reader.ReadBytes(input); // input } private void Watcher_Stopped(BluetoothLEAdvertisementWatcher sender, BluetoothLEAdvertisementWatcherStoppedEventArgs args) { ; } }</span></span></code> </pre> <br>  Vielen Dank f√ºr Ihre Aufmerksamkeit. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423893/">https://habr.com/ru/post/de423893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de423879/index.html">Ist es einfach, dem alten Framework neue Funktionen hinzuzuf√ºgen? Mehl der Wahl am Beispiel der Entwicklung von SObjectizer</a></li>
<li><a href="../de423881/index.html">Was waren die Schwei√üer f√ºr Optik (Teil zwei)</a></li>
<li><a href="../de423885/index.html">Eine Einladung zu einer Lichtshow und ein kleiner Insider von der zuk√ºnftigen Circle of Light-Plattform in Moskau</a></li>
<li><a href="../de423889/index.html">Meine Entt√§uschung √ºber Software</a></li>
<li><a href="../de423891/index.html">Ausdrucksb√§ume f√ºr die Unternehmensentwicklung</a></li>
<li><a href="../de423895/index.html">Sie brauchen keinen Anwalt. Das ist aber nicht sicher</a></li>
<li><a href="../de423897/index.html">N√ºtzliche Tipps zur Verwendung des HyperLynx DDR-Assistenten f√ºr die QDR4-Analyse</a></li>
<li><a href="../de423901/index.html">Wenn Geschwindigkeit und Skalierung ben√∂tigt werden: Server von verteilten iOS-Ger√§ten</a></li>
<li><a href="../de423903/index.html">Eintauchen in AD: Wir analysieren erweiterte Angriffe auf Microsoft Active Directory und wie sie erkannt werden</a></li>
<li><a href="../de423905/index.html">Die Entwickler blieben unbekannt. Yandex Vortrag</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>