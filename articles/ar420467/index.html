<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฑ โช ๐ฅ ุจุฑูุงูุฌ ุชุถููู C ++ ูุฌููุน ุฃูุธูุฉ ุงูุชุดุบูู ูู ุงูููุช ุงููุนูู ูู CortexM4 โฌ๏ธ ๐ ๐ฉ๐พโ๐พ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุฏ ุชุญุฏุซุช ุจุงููุนู ุนู ููููุฉ ุงุณุชุฎุฏุงู FreeRtos ูููุดุงุฑูุน ุงูููุชูุจุฉ ุจูุบุฉ C ++ ูู ุงูููุงูุฉ STM32 ู C ++ ู FreeRTOS. ุงูุชูููุฉ ูู ุงูุตูุฑ. ุงูุฌุฒุก ุงูุฃูู ููุฐ ุฐูู ุงูุญูู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุจุฑูุงูุฌ ุชุถููู C ++ ูุฌููุน ุฃูุธูุฉ ุงูุชุดุบูู ูู ุงูููุช ุงููุนูู ูู CortexM4</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420467/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/s0/2o/ve/s02ovegatxm9x39z6c8x_5fydki.png" alt="ุงูุตูุฑุฉ"><br><br>  ููุฏ ุชุญุฏุซุช ุจุงููุนู ุนู ููููุฉ ุงุณุชุฎุฏุงู FreeRtos ูููุดุงุฑูุน ุงูููุชูุจุฉ ุจูุบุฉ C ++ ูู ุงูููุงูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">STM32 ู C ++ ู FreeRTOS.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชูููุฉ ูู ุงูุตูุฑ.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก ุงูุฃูู</a>  ููุฐ ุฐูู ุงูุญูู ุ ููุน ูุฑูุฑ 3 ุณููุงุช ุ ููุฏ ูุจุฑุช ูู ุงูุนูุฑ ุ ูููุฏุช ูุฌููุนุฉ ูู ุงูุงุชุตุงูุงุช ุงูุนุตุจูุฉ ุ ูุฐูู ูุฑุฑุช ุฃู ุฃุฒุนุฒุน ุงูุฃูุงู ุงููุฏููุฉ ูู ุฃุฌู ุงุณุชุนุงุฏุฉ ูุฐู ุงูุงุชุตุงูุงุช ูุฅูุชุณุงุญ ุงูู RTOS ุงูุดููุฑ "ุฃู".  ูุฐู ุจุงูุทุจุน ููุชุฉ ุ ูุถุนุช ุนูุฏุง "ุงูุฌููุน" ุจูู ุนูุงูุชู ุงูุชุจุงุณ ุ ูููู ููุงู ุจุนุถ ุงูุญูููุฉ ูู ูู ููุชุฉ. <br><a name="habracut"></a><br>  ุฅุฐู ุ ูุง ูู ุงููููุฉ ูููุงุฐุง ูู ุฐุงุช ุตูุฉ ุนูู ุงูุฅุทูุงูุ  ูู ุงูููุช ุงูุญุงูู ุ ููุงู ููููู ูุธุงู ุชุดุบูู ูุฎุชูู ููุชูุจ ุจูุบุฉ C - ูุง ุฃุฑูุฏ ุฃู ุฃุฎุชุงุฑ ููู ุฐูู ุ ูุฏููุน ุ ูุฌุงูู ุ ุตุบูุฑ ุ ูุจูุฑ ... ูููู ุจุงููุณุจุฉ ูููุดุงุฑูุน ุงูุชู ุฃุดุงุฑู ูููุง ุ ููุณุช ููุงู ุญุงุฌุฉ ุฅูู ูู ูุฐู ุงูุดุฑุงุฆุญ ูู ุฃูุธูุฉ ุงูุชุดุบูู ุงููุฎุชููุฉ ุ ูุงููุธุงุฆู ุงูุฃุณุงุณูุฉ ูุซู ุงููููุฉ ูุงููุฉ ูุงูุฃุญุฏุงุซ ูุฅุดุนุงุฑ ุงููููุฉ ูุงููุณู ุงูุญุฑุฌ ููุงุฆูุงุช ุงููุฒุงููุฉ ูุงูุฃุดุงุฑุงุช (ุนูู ุงูุฑุบู ูู ุฃููู ุฃุญุงูู ุนุฏู ุงุณุชุฎุฏุงููุง) ูุงูุตููู.  ููู ูุฐุง ูุทููุจ ุจุดูู ุจุณูุท ุฅูู ุญุฏ ูุง ุ ุฏูู ุฃู ุฒุฎุฑูุฉ. <br><br>  ูู ุฑุฃูู ุ ูุฅู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>OSRV MAX</b></a> ุงููุญูู ุ ุงูููุชูุจ ุจูุบุฉ C ++ ุ ููุงุณุจ ุชูุงููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>ููุดุงุฑูุนู</b></a> ููุณุฑูู ุงุณุชุฎุฏุงูู. <br><br>  ููู ุงููุดููุฉ ูู ุฃู ุฃุฌูุฒุชูุง ูุฌุจ ุฃู ุชุชูุงูู ูุน ูุนูุงุฑ IEC_61508 ุ ุฃุญุฏ ูุชุทูุจุงุชู ูู <i>ุชุทุจูู E.29 ููููุชุจุฉ ุงููุณุชูุฏูุฉ ุงููุซุจุชุฉ</i> .  ุญุณููุง ุ ุฃู ุจูููุงุช ุจุณูุทุฉ ุ ุฅุฐุง <u>ุตูุนุช ุฌูุงุฒูุง ููู</u> ุจูุณุชูู <u>SIL3</u> ุ ููุฑุฌู ุงุณุชุฎุฏุงู ููุชุจุงุช ุชุชูุงูู ูุน ูุฐุง ุงููุณุชูู ููุชู ุงุฎุชุจุงุฑูุง ุจูุฑูุฑ ุงูููุช. <br><br>  ูููุง ูุชุนูู ุจูููุชูุง ุ ูุฐุง ูุนูู ุฃูู ูู ุงููููู ุงุณุชุฎุฏุงู <b>MAX MAX RTOS</b> ููุซู ูุฐู ุงูุฃุฌูุฒุฉ ุ ูููู ูู ูุชู ุฅุถุงูุฉ ููุงุท ุงูููุซูููุฉ.  ูุฐูู ุ ูุตูุน ูุตูุนู RTOS ุฅุตุฏุงุฑุงุช ุฎุงุตุฉ ูู ุฃูุธูุฉ ุงูุชุดุบูู ุงูุฎุงุตุฉ ุจูู ูุงูุชู ุชุชูุงูู ูุน ูุนุงููุฑ IEC_61508 ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุญุชูู <i>FreeRTOS ุนูู</i> ุงุณุชูุณุงุฎ <i>SafeRTOS</i> ุ ููุญุชูู <i>embOs ุนูู</i> ูุณุฎุฉ <i>ุขููุฉ ูู embos</i> ุ ูุจุงูุทุจุน ูุฅู ุงูุดุฑูุงุช ุงููุตูุนุฉ ุชุญูู ุฃููุงููุง ุฌูุฏุฉ ุฌุฏูุง ูู ูุฐุง ุ ูุฃู ุงูุชุฑุงุฎูุต ูุฃูุธูุฉ ุงูุชุดุบูู ูุฐู ุชููู ุนุฏุฉ ุขูุงู ุ ุฃู ุญุชู ุนุดุฑุงุช ุงูู ุฏููุงุฑ. <br><br>  ุจุงูููุงุณุจุฉ ุ ูุซุงู ุฌูุฏ ูู ูุชุฑุฌู IAR ุ ุงูุชุฑุฎูุต ุงูุฐู ูููู ุญูุงูู 1500 ุฏููุงุฑ ุ ููู ุฅุตุฏุงุฑุงุช IAR ุงููุนุชูุฏุฉ ุชููู ุจุงููุนู ุญูุงูู 10000 ุฏููุงุฑ ุ ุนูู ุงูุฑุบู ูู ุฃููู ุฑุงุฌุนุช ูู ุงูุนุฏูุฏ ูู ุงููุดุงุฑูุน - ููู ุงูุฅุฎุฑุงุฌ ููุฅุตุฏุงุฑ ุจุฏูู ุดูุงุฏุฉ ููุน ุดูุงุฏุฉ ูุชุทุงุจู ุชูุงููุง.  ุญุณููุง ุ ุฃูุช ุชููู ุฃูู ุจุญุงุฌุฉ ุฅูู ุงูุฏูุน ููุงุจู ุงูุณูุงู. <br><br>  ูุฐูู ุ ุงุณุชุฎุฏููุง ุฃููุงู <i>ูุธุงู ุชุดุบูู ูุงุญุฏ</i> ุ ุซู ุจุฏุฃุช ุจุงุณุชุฎุฏุงู <i>FreeRTOS</i> ูุงุญุชูุงุฌุงุชู ุ ุซู ุงูุชูููุง ุฅูู ูุธุงู <i>ุขุฎุฑ</i> ุ ุจุดูู ุนุงู ุ ูุงู ุนูููุง ุจุงุณุชูุฑุงุฑ ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูููุงุฆูุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุฃูุฏ ุฃู ุชุจุฏู ุฌูููุฉ ูุจุณูุทุฉ ุ ุจุญูุซ ูููู ูุฃู ุดุฎุต ุฃู ูููู ูู ุฎูุงู ุงูุฑูุฒ ูุง ูุญุฏุซ ุ ุซู ุณูููู ุฏุนู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูููุฉ ุจุณูุทุฉ ููุทูุงุจ ูุงูููุงุฑุณูู ุ ูุณูุชููู ุงููุนูููู ูู ููุงุตูุฉ ุงูุนูู ุนูู ุงูุฃุฌูุฒุฉ ุงููุจุชูุฑุฉ ุ ุจุฏูุงู ูู ููู ูููุฉ ุงููุนูุฑููุฉ .  ุจุดูู ุนุงู ุ ุฃุฑูุฏ ุฃู ุฃุฑู ุดูุฆูุง ูุซู ูุฐุง ูุชุญุฌุฑูุง: <br><br><img src="https://habrastorage.org/webt/rc/2z/_k/rc2z_kzdcpu6isdhwojtbbi4wac.png" alt="ุงูุตูุฑุฉ"><br><br>  ุญุณูุง ุ ุฃู ููุฐุง ... <br><br><img src="https://habrastorage.org/webt/f7/li/48/f7li48lkaylpglvyjr-tiekmxai.png" alt="ุงูุตูุฑุฉ"><br><br>  ูุฐูู ุ ูุฑุฑุช ุฃู ุฃูุชุจ <i>ุบูุงููุง</i> ููุงุณุจ ูู ูู <i>FreeRTOS ุ</i> ููููู <i>embOS ุ</i> ุญุณููุง ุ ููู ุดุฎุต ุขุฎุฑ ุฃูุถูุง :) ูุจุฏุงูุฉ ุญุฏุฏุช ูุง ุงุญุชุงุฌู ูุชุญููู ุงูุณุนุงุฏุฉ ุงููุงููุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูููุงู </li><li style=";text-align:right;direction:rtl">  ุฃูุณุงู ุญุฑุฌุฉ </li><li style=";text-align:right;direction:rtl">  ุงูุฃุญุฏุงุซ ูุฅุฎุทุงุฑ ุงููููุฉ </li><li style=";text-align:right;direction:rtl">  ุงูุฅุดุงุฑุงุช ูุงูููุชูุณุงุช </li><li style=";text-align:right;direction:rtl">  ููุงุฆู ุงูุงูุชุธุงุฑ </li></ul><br>  ูุฌุจ ุฃู ูููู ุงูุบูุงู <u>SIL3</u> ุฃูุฏููููุฌููุง ุ ูููุฑุถ ูุฐุง ุงููุณุชูู ุงููุซูุฑ ูู ุฌููุน ุฃููุงุน ุงูุฃุดูุงุก ุงูููุตู ุจูุง ุงูุนุงููุฉ ุ ูุฅุฐุง <u>ุงุชุจุนุชูุง</u> ุชูุงููุง ุ ููุฏ ุงุชุถุญ ุฃูู ูู ุงูุฃูุถู ุนุฏู ูุชุงุจุฉ ุงูุฑูุฒ ุนูู ุงูุฅุทูุงู. <br><br>  ููู ุญูููุฉ ุฃู ุงููุนูุงุฑ ูุญูู ูุฌููุนุฉ ูู ุงูููุงุนุฏ ุ ุฃู ุจุงูุฃุญุฑู ุงูุชูุตูุงุช ุ ูุง ูุนูู ุฃูู ูุง ูููู ุงูุชูุงููุง - ููููู ุฐูู ุ ูููู ุนููู ุงุชุจุงุน ุฃูุจุฑ ุนุฏุฏ ูููู ูู ุงูุชูุตูุงุช ููุญุตูู ุนูู ุงููุฒูุฏ ูู ุงูููุงุท.  ูุฐูู ุ ูุฑุฑุช ุจุนุถ ุงููููุฏ ุงููุงูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <b>ูุง ูุญุฏุงุช ูุงูุฑู</b> ุ ุญุณูุง ุ ุจุงุณุชุซูุงุก ุงูุญูุงูุฉ ุถุฏ ุงูุชุถููู ุงููุฒุฏูุฌ ููููุงุช ุงูุฑุฃุณ.  ูุญุฏุงุช ุงููุงูุฑู ุดุฑูุฑุฉ ุ ุฅุฐุง ุญุณุจุช ููุฏุงุฑ ุงูููุช ุงูุฐู ุชู ูุถุงุคู ูู ุงูุจุญุซ ุนู ุงูุฃุฎุทุงุก ุงููุชุนููุฉ ุจูุญุฏุงุช ุงููุงูุฑู ุ ููุฏ ุงุชุถุญ ุฃู ุงูููู ููุณ ูุฏูููุง ุฌุฏูุง ุ ูููุฏุงุฑ ูุง ูููู ูุนูู ุฎูุงู ูุฐุง ุงูููุช ุ ุฑุจูุง ูููู ูู ุงูุฃูุถู ุญุธุฑูุง ุนูู ุงููุณุชูู ุงูุชุดุฑูุนู ุ ุญูุซ ุฃู ุงูุณููู ููุนุช ุฃู ุงุญุตู ุนูู ููุงูุฃุฉ ููู ูุงูุฑู ุชูุชุจู </li><li style=";text-align:right;direction:rtl">  <b>ูุง ุชุณุชุฎุฏู ุงููุคุดุฑุงุช</b> ุจุงูุทุจุน ูููุง ุฃููู ุฐูู.  ูููู ูููุฑุก ุฃู ูุญุงูู ุนุฏู ุงุณุชุฎุฏุงููุง ุนูู ุงูุฅุทูุงู ุ ูููู ูุง ุชุฒุงู ููุงู ุฃูุงูู ุจุฏูููุง ูุง ุชูุฌุฏ ุทุฑููุฉ.  ุนูู ุฃู ุญุงู ุ ูุง ููุจุบู ููุณุชุฎุฏู ุงูุบูุงู ุ ุฅู ุฃููู ุ ุฃู ูุนุฑู ูุง ูู ุงููุคุดุฑ ุ ูุฃูู ูู ูุณูุน ุนููุง ุฅูุง ูู ุฌุฏู ุ ูุฃูู ุงูุขู ูุนูู ููุท ูุน ุงูุฑูุงุจุท </li><li style=";text-align:right;direction:rtl">  <b>ุนุฏู ุงุณุชุฎุฏุงู ุชุฎุตูุต ุงูุฐุงูุฑุฉ ุงูุฏููุงููููุฉ</b> - ูู ุดูุก ูุงุถุญ ุ ููุท ุจุงุณุชุฎุฏุงู ูููุฉ ุชุคุฏู ุ ุฃููุงู ุ ุฅูู ุงูุญุงุฌุฉ ุฅูู ุญุฌุฒ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ููุฐุง ุงููููุฉ ุ ูุซุงูููุง ุ ูุน ุงูุงุณุชุฎุฏุงู ุงููุชูุฑุฑ ูููููุฉ ุ ูุชู ุฅูุบุงุก ุชุฌุฒุฆุชูุง ููุชู ุฅูุดุงุก ูุงุฆูุงุช ุฌุฏูุฏุฉ ุนูููุง ููุชุฑุฉ ุฃุทูู ูุฃุทูู ููุชุฑุฉ ุฃุทูู.  ูุฐูู ุ ูู <i>ุงููุงูุน ุ</i> ููุช ุจุชูููู <i>FreeRTOS</i> ููุท ุนูู ุงูุฐุงูุฑุฉ ุงููุฎุตุตุฉ ุจุดูู ุซุงุจุช ุนู ุทุฑูู ุชุนููู <i>configSUPPORT_STATIC_ALLOCATION 1</i> .  ูููู ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงูุนูู ูู ุงููุถุน ุงูุงูุชุฑุงุถู.  ูุจุดูู ุงูุชุฑุงุถู ุ ูุณุชุฎุฏู <i>FreeRTOS</i> ุงูุฐุงูุฑุฉ ุงููุฎุตุตุฉ ุฏููุงูููููุง ูุฅูุดุงุก ุนูุงุตุฑ ูุธุงู ุงูุชุดุบูู ุ ุซู ูู ููุท ุจุถุจุท <i>configSUPPORT_STATIC_ALLOCATION 0</i> ุ ู <br>  <i>configSUPPORT_DYNAMIC_ALLOCATION 1</i> ููุง ุชูุณ ุฑุจุท ุชูุตูู ุชุทุจูู mallocs ู calloc ุงูุฎุงุต ุจู ูู ูุฏูุฑ ุงูุฐุงูุฑุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุฐุง ุงูููู ูู FreeRtos / portable / MemMang / heap_1.c.  ูููู ุถุน ูู ุงุนุชุจุงุฑู ุฃูู ุณูุชุนูู ุนููู ุชุฎุตูุต ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุน ุงุญุชูุงุทู ููุฌููุนุฉ ุ ุญูุซ ูู ุชุชููู ูู ุญุณุงุจ ููุฏุงุฑ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงููุทููุจ ุจุงูุถุจุท ุ ูุน ุฌููุน ุงูุฅุนุฏุงุฏุงุช (ูู ูุถุน ุงูุฎููู ุ ููููุฉ ูุคูุช ุงูุจุฑูุงูุฌ ููุฏ ุงูุชุดุบูู ุ ููููุชู ุ ูููุงุฆู ุงูุงูุชุธุงุฑ ุ ูุญุฌู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูููููุชุงุช 10 ู ูุฐุง ุ ุฏุนูุง ูููู ุฃููุง ุจุงูุชุฃููุฏ ููุณุช ุงูุฅุนุฏุงุฏุงุช ุงููุซูู) ุงูุชู ุนููุช ุนูุฏูุง ุฎุตุตุช ุงูุฐุงูุฑุฉ ุนูู ุงููุญู ุงูุชุงูู: <br><blockquote style=";text-align:right;direction:rtl">  357 7 ุจุงูุช ูู ุฐุงูุฑุฉ ุงูููุฏ ูููุฑุงุกุฉ ููุท <br>  535 ุจุงูุช ูู ุฐุงูุฑุฉ ุงูุจูุงูุงุช ูููุฑุงุกุฉ ููุท <br>  6ุ053 ุจุงูุช ูู ุฐุงูุฑุฉ ุจูุงูุงุช ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ </blockquote><br>  ุชุฎุตูุต ุงูุฐุงูุฑุฉ ุงูุซุงุจุชุฉ ูู "ุตุบูุฑ" ุฃูุซุฑ ุฅุญูุงูุง: <br><blockquote style=";text-align:right;direction:rtl">  7ุ329 ุจุงูุช ูู ุฐุงูุฑุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูููุฑุงุกุฉ ููุท <br>  535 ุจุงูุช ูู ุฐุงูุฑุฉ ุงูุจูุงูุงุช ูููุฑุงุกุฉ ููุท <br>  3ุ877 ุจุงูุช ูู ุฐุงูุฑุฉ ุจูุงูุงุช ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ </blockquote><br>  ูุฏ ุชุนุชูุฏ ุ "ุฑุงุฆุน ... ููุณู" ุ ููููุง ุงูุขู ุบูุฑ ููุชููู ุจุงูุณุคุงู ุงูุฐู ุชูุช ุตูุงุบุชู ูู ุงูููุงูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"ููุฏ ุฎุตุตุช ูุง ูุตู ุฅูู 3 ููููุจุงูุช ููุธุงู ุงูุชุดุบูู ูุฃุทููุช 3 ููุงู ููุท ูุน ููุฏุณ 128B ุ ููุณุจุจ ูุง ูุง ุชูุฌุฏ ุจุงููุนู ุฐุงูุฑุฉ ูุงููุฉ ููุฑุงุจุน"</a> ุ ูู ูุฐู ุงูุญุงูุฉ ุ ููุช ุจุฐูู ุนู ูุตุฏ ุ ููุชูุถูุญ ุ ูุฅุธูุงุฑ ุงููุฑู ุจูู ุชุฎุตูุต ุงูุฐุงูุฑุฉ ุงูุฏููุงูููู ูุงูุซุงุจุช ูุน ููุณ ุงูุฅุนุฏุงุฏุงุช. <br></li><li style=";text-align:right;direction:rtl">  <b>ูุง ุชููู ุฃููุงุน</b> ุ ุฅู ุฃููู.  ุฃููุงุน ุงูุธูุงู ูุฃููุงุน ุฃุฎุฑู ูู ุญุฏ ุฐุงุชูุง ุชุนูู ุญูููุฉ ุฃู ุดูุฆูุง ูุง ุฎุทุฃ ูู ุงูุชุตููู ุ ูููู ูุงูุนุงุฏุฉ ุ ูุง ูุฒุงู ุนููู ูู ุจุนุถ ุงูุฃุญูุงู ุทุฑุญู ููุฑุงุญุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ูุฌุจ ุฃู ูููู ุงูุชุนุฏุงุฏ ุฅูู ุฃุนุฏุงุฏ ุตุญูุญุฉ) ุ ูุฃุญูุงููุง ูุง ููููู ุงูุงุณุชุบูุงุก ุนูู ูุฐุง ุ ูููู ูุฌุจ ุชุฌูุจ ุฐูู. </li><li style=";text-align:right;direction:rtl">  <b>ุงูุจุณุงุทุฉ ูุงูุฑุงุญุฉ</b> .  ุจุงููุณุจุฉ ููุณุชุฎุฏู ุงูุบูุงู ุ ูุฌุจ ุฅุฎูุงุก ุฌููุน ุงูุตุนูุจุงุช ุ ุญุชู ูุง ุชููู ุญูุงุชู ููุทูุฉ ุ ููุง ูุฑูุฏ ุชุนููุฏูุง ุจุนุฏ - ููุฏ ุฃูุดุฃ ุงููููุฉ ุ ููุฐ ูู ูุง ูู ูุทููุจ ููู ุ ุจุฏุฃูุง ูุชุฑููุง ููุงุณุชูุชุงุน ุจุงูุญูุงุฉ. </li></ul><br>  ุณูุจุฏุฃ ูู ูุฐุง ุ ูุฐุง ูุถุนูุง ูุฃููุณูุง ูููุฉ ุฅูุดุงุก ูููุฉ (ุงุชุถุญ ูุจุงุดุฑุฉ ูู ุณูุณูุฉ "ููููุน ุงูุญุธุฑ"). <br><br><h2 style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุงูููุงู </h2><br>  ูู ุฎูุงู ุงูุจุญุซ ุงูุทููู ุ ุนููุงุก ุจุฑูุทุงูููู ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุญูููุฉ ุงููุงููุฉ ุนู RTOS ูู Colin Walls. ุงููุงุฏุฉ ุฑูู 4. ุงูููุงู ุ ูุชุจุฏูู ุงูุณูุงู ูุงูุงููุทุงุนุงุช</a> ) (ุจุงูููุงุณุจุฉ ุ ุฅุฐุง ูู ุชูู ุชุนุฑู ุ ุชู ุงุฎุชุฑุงุน ูุฌูุน ARM ูู ูุจู ุนุงูู ุจุฑูุทุงูู ุ ููู ุฃูุฑ ูู ุฃูุงุฌุฃ ุจู ุฃูุถูุง ูุฑุฉ ูุงุญุฏุฉ :)) ุ ูููุฐุง ุงูุชุดู ุงูุนููุงุก ุงูุจุฑูุทุงูููู ุฃูู ุจุงููุณุจุฉ ูุบุงูุจูุฉ "ูู" RTOS ุ ูุฅู ุงููููุฉ ููุง <i>ุงุณู</i> ุ ุฃู <i>ุชูุฏูุณ</i> ุ <i>ุฃู ุญุฌู ุชูุฏูุณ</i> ุ ุฃู <i>"ูุญุฏุฉ ุชุญูู"</i> ุ <i>ุฃู ูุนุฑู ุฃู ูุคุดุฑ ุฅูู "ูุญุฏุฉ ุชุญูู"</i> ุ ุฃู <i>ุฃููููุฉ</i> ุ ุฃู <i>ูุธููุฉ ูุชู ุชูููุฐูุง ูู ุงููููุฉ</i> .  ูุฐุง ูู ุดูุก ุ ููุงู ูู ุงููููู ุญุดุฑู ููู ูู ูุตู ุฏุฑุงุณู ุ ูููู ูุงู ูู ุงูุตุญูุญ ุฅุฐุง ูุชุจูุง ูุธุงู ุชุดุบูู ูุนู ุ ููููุง ูููุง ุจุนูู ุบูุงู ุ ูุฐูู ูุง ููุฌุฏ ูุนูู ูู ุชุฎุฒูู ูู ูุฐู ุงูุฃุดูุงุก ูู ุบูุงู ุ ูู ูุฐุง ุณูุชู ูู ุฃุฌูู ุจูุงุณุทุฉ ูุธุงู <u>SIL3</u> ุงูุฃูุฏููููุฌู ูุฎุชุชู.  ูู ุงููุงูุน ุ ูุญู ุจุญุงุฌุฉ ููุท ุฅูู <i>ูุธููุฉ ูุชู ุชูููุฐูุง ูู ุงููููุฉ</i> <i>ููููู ูุฎุฒู "ูุญุฏุฉ ุงูุชุญูู"</i> ุ ูุงูุชู ูุชู ุชุนุจุฆุชูุง ุนูุฏ ุฅูุดุงุก <i>ุงููููุฉ ููุนุฑู ุงููููุฉ</i> .  ูุฐูู ุ ูููู ุฃู ุชุจุฏู ูุฆุฉ ุงููููุฉ ุ ุฏุนูุง ูุณูููุง <i>ุงูููุถูุน ุ</i> ุจุณูุทุฉ ููุบุงูุฉ: <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thread</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: tTaskHandle taskHandle ; tTaskContext context ; } ;</code> </pre> <br>  ุฃุฑูุฏ ููุท ุฃู ุฃุนูู ูุฆุฉ ูููุชู ุญูุซ ูููููู ุชูููุฐ ูู ูุง ูู ูุทููุจ ุซู ุชูุฑูุฑ ุงููุคุดุฑ ุฅูู ูุงุฆู ูุฐู ุงููุฆุฉ ุฅูู ุงูุบูุงู ุ ููุง ุณูุคุฏู ุฅูู ุฅูุดุงุก ูููุฉ ุจุงุณุชุฎุฏุงู RTOS API ุญูุซ ุณูุชู ุชุดุบูู ุทุฑููุฉ <i>ุงูุชูููุฐ ()</i> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTask</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Thread { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//do something.. } } ; using tMyTaskStack = std::array&lt;OsWrapper::tStack, static_cast&lt;tU16&gt;(OsWrapper::StackDepth::minimal)&gt; ; inline static tMyTaskStack Stack; //!C++17 } ; MyTask myDesiredTask int main() { Rtos::CreateThread(myTask, MyTask::Stack.data(), "myTask") ; }</span></span></code> </pre> <br>  ูู "ูู" RTOS ุ ูู ุฃุฌู ุฅูุดุงุก ุงููููุฉ ุ ูู ุงูุถุฑูุฑู ุชูุฑูุฑ ุงููุคุดุฑ ุฅูู ุฏุงูุฉ ุณูุชู ุชุดุบูููุง ุจูุงุณุทุฉ ุงููุฌุฏูู.  ูู ุญุงูุชูุง ุ ูุฐู ูู ุงูุฏุงูุฉ <i>Execute ()</i> ุ ููู ูุง ูููููู ุชูุฑูุฑ ูุคุดุฑ ุฅูู ูุฐู ุงูุทุฑููุฉ ุ ูุฃููุง ููุณุช ุซุงุจุชุฉ.  ูุฐูู ุ ููุธุฑ ูู ููููุฉ ุฅูุดุงุก ูููุฉ ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฃูุธูุฉ ุชุดุบูู "ุฌููุน" ูููุงุญุธ ุฃูู ูููููุง ุฅูุดุงุก ูููุฉ ุจุชูุฑูุฑ ูุนููุฉ ุฅูู ูุธููุฉ ุงููููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ <i>ูุชุถููู ูุง</i> ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OS_TASK_CreateEx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( OS_TASK* pTask, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* pName, OS_PRIO Priority, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (*pRoutine)(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * pVoid ), </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> OS_STACKPTR *pStack, OS_UINT StackSize, OS_UINT TimeSlice, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* pContext)</span></span></span></span>;</code> </pre><br>  <b>void * pContext</b> - ูุฐุง ูู ููุชุงุญ ุงูุญู.  ุฏุนูุง ูุญุตู ุนูู ุทุฑููุฉ ุซุงุจุชุฉ ุ ููู ูุคุดุฑ ุณููุฑุฑู ููุคุดุฑ ุฅูู ุฃุณููุจ ูุณูู ุจูุงุณุทุฉ ุงููุฌุฏูู ุ ูููุนููุฉ ุ ุณููุฑุฑ ูุคุดุฑูุง ุฅูู ูุงุฆู ูู ููุน <i>Thread</i> ุญูุซ ูููููุง ุงุณุชุฏุนุงุก ุงูุฃุณููุจ <i>Execute ()</i> ูุจุงุดุฑุฉ.  ูุฐู ูู ุงููุญุธุฉ ุงูุชู ูุง ุชูุฌุฏ ูููุง ุทุฑููุฉ ุจุฏูู ูุคุดุฑ ูุฅููุงุก ููุฃููุงุน ุ ูููู ุณูุชู ุฅุฎูุงุก ูุฐุง ุงูุฑูุฒ ุนู ุงููุณุชุฎุฏู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *pContext )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;Thread*&gt;(pContext)-&gt;Execute() ; }</code> </pre> <br>  ุนูู ุณุจูู ุงููุซุงู  ูุซู ุฎูุงุฑุฒููุฉ ุงูุนูููุฉ ุ ูุจุฏุฃ ุงููุฌุฏูู ุทุฑููุฉ <i>ุงูุชุดุบูู</i> ุ ููุชู ุชูุฑูุฑ ูุคุดุฑ ุฅูู ูุงุฆู ูู ููุน ูุคุดุฑ <i>ุงูุชุฑุงุจุท</i> ุฅูู ุฃุณููุจ <i>ุงูุชุดุบูู</i> .  ูุณุชุฏุนู ุงูุฃุณููุจ <i>Run</i> ูุจุงุดุฑุฉ ุงูุฃุณููุจ <i>Execute ()</i> ุ ููู ูุงุฆู ูุนูู ููุฆุฉ <i>Thread</i> ุ ููู ูุฌุฑุฏ ุชูููุฐ ูููููุฉ. <br><br>  ุชู ุญู ุงููุดููุฉ ุชูุฑูุจูุง ุ ูุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ุชูููุฐ ุงูุฃุณุงููุจ.  ุชุญุชูู ุฌููุน ุฃูุธูุฉ ุงูุชุดุบูู ุนูู ูุงุฌูุงุช ุจุฑูุฌุฉ ุชุทุจููุงุช ูุฎุชููุฉ ุ ูุฐูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุชูููุฐ ูุธููุฉ ุฅูุดุงุก ุงูููุงู ูู <i>embOS ุ</i> ูุฌุจ ุนููู ุงุณุชุฏุนุงุก ุทุฑููุฉ <i>OS_TASK_CreateEx (..)</i> <i>ุงูุจุงุทูุฉ ุ ูุจุงููุณุจุฉ</i> ูู <i>FreeRTOS</i> ูู ูุถุน ุชุฎุตูุต ุงูุฐุงูุฑุฉ ุงูุฏููุงููููุฉ ุ ููุฐู ูู <i>xTaskCreate (..)</i> ูุนูู ุงูุฑุบู ูู ุฃู ููุง ููุณ ุงูุฌููุฑ ููุณ ุ ูููู ุจูุงุก ุงูุฌููุฉ ูุงููุนููุงุช ูุฎุชููุฉ.  ููููุง ูุง ูุฑูุฏ ุชุดุบูู ุงููููุงุช ููุชุงุจุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ููู ุทุฑููุฉ ูู ุทุฑู ุงููุตู ูู ูู ูุฑุฉ ููุธุงู ุชุดุบูู ุฌุฏูุฏ ุ ูุฐูู ูุญุชุงุฌ ุฅูู ูุถุน ูุฐุง ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ูู ููู ูุงุญุฏ ู ... ุชูููุฐู ุนูู ุดูู ูุญุฏุงุช ูุงูุฑู.  ุฑุงุฆุน ุ ูููู ุชููู ุ ููุฏ ููุนุช ูุญุฏุงุช ุงููุงูุฑู ูููุณู - ุฃุญุชุงุฌ ุฅูู ููุฌ ูุฎุชูู. <br><br>  ุฃุจุณุท ุดูุก ุญุฏุซ ูู ูุงู ุฅูุดุงุก ููู ูููุตู ููู ูุธุงู ุชุดุบูู ูุน ูุธุงุฆู ูุถููุฉ.  ุฅุฐุง ุฃุฑุฏูุง ุงุณุชุฎุฏุงู ุฃู ูุธุงู ุชุดุบูู ุขุฎุฑ ุ ูุณูุญุชุงุฌ ููุท ุฅูู ุชูููุฐ ูู ูู ูุฐู ุงููุธุงุฆู ุจุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ููุธุงู ุงูุชุดุบูู ูุฐุง.  ุชู <b>ุชุญููู</b> ููู <b>rtosFreeRtos.cpp</b> ุงูุชุงูู <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"rtos.hpp"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//For FreeRTOS functions prototypes #include &lt;FreeRTOS.h&gt; //For xTaskCreate #include &lt;task.h&gt; namespace OsWrapper { void wCreateThread(Thread &amp; thread, const char * pName, ThreadPriority prior,const tU16 stackDepth, tStack *pStack) { #if (configSUPPORT_STATIC_ALLOCATION == 1) if (pStack != nullptr) { thread.handle = xTaskCreateStatic(static_cast&lt;TaskFunction_t&gt;(Rtos::Run), pName, stackDepth, &amp;thread, static_cast&lt;uint32_t&gt;(prior), pStack, &amp;thread.taskControlBlock); } #else thread.handle = (xTaskCreate(static_cast&lt;TaskFunction_t&gt;(Rtos::Run), pName, stackDepth, &amp;thread, static_cast&lt;uint32_t&gt;(prior), &amp;thread.handle) == pdTRUE) ? thread.handle : nullptr ; #endif }</span></span></span></span></code> </pre><br>  ูุฏ ูุจุฏู ููู embOS <b>rtosEmbOS.cpp</b> ูู <b>ููุณู</b> ุชูุงููุง <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"rtos.hpp"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//For embOS functions prototypes #include &lt;rtos.h&gt; namespace OsWrapper { void wCreateThread(Thread &amp;thread, const char * pName, ThreadPriority prior,const tU16 stackDepth, tStack *pStack) { constexpr OS_UINT timeSliceNull = 0 ; if (pStack != nullptr) { OS_CreateTaskEx(&amp;(thread.handle), pName, static_cast&lt;OS_PRIO&gt;(prior), Rtos::Run, pStack, ((stackSize == 0U) ? sizeof(pStack) : stackSize), timeSliceNull, &amp;thread) ; } }</span></span></span></span></code> </pre> <br>  ุชุฎุชูู ุฃููุงุน ุฃูุธูุฉ ุงูุชุดุบูู ุงููุฎุชููุฉ ุฃูุถูุง ุ ุฎุงุตุฉ ูููู ุณูุงู ุงููููุฉ ุ ูุฐูู ุฏุนููุง ููุดุฆ ููู rtosdefs.hpp ุจุงุณุชุฎุฏุงู ุงูุฃุณูุงุก ุงููุณุชุนุงุฑุฉ ุงููุฌูุนุฉ ุงูุฎุงุตุฉ ุจูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;FreeRTOS.h&gt; //For TaskHandle_t namespace OsWrapper { using tTaskContext = StaticTask_t; using tTaskHandle = TaskHandle_t; using tStack = StackType_t ; }</span></span></span></span></code> </pre><br>  ุจุงููุณุจุฉ ุฅูู <i>EmbOS ุ</i> ูุฏ ูุจุฏู ูุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;rtos.h&gt; //For OS_TASK namespace OsWrapper { using tTaskContext = OS_TASK; using tTaskHandle = OS_TASK; using tStack = tU16 //   void,      tU16 ; }</span></span></span></span></code> </pre><br>  ูุชูุฌุฉ ูุฐูู ุ ูุฅุฌุฑุงุก ุชุนุฏููุงุช ุชุญุช ุฃู RTOS ุฃุฎุฑู ุ ูููู ุฅุฌุฑุงุก ุชุบููุฑุงุช ููุท ูู ูุฐูู ุงูููููู rtosdefs.cpp ู rtos.cpp.  ุงูุขู ุชุจุฏู ูุตูู <i>ุงูุฎูุท</i> ู <i>Rtos</i> ูุซู ุงูุตูุฑ c <br><br><img src="https://habrastorage.org/webt/gp/wq/zl/gpwqzlgnristquzlrcdbxyfm9ro.png" alt="ุงูุตูุฑุฉ"><br><br><h2 style=";text-align:right;direction:rtl">  ุชุดุบูู ุฃูุธูุฉ ุงูุชุดุบูู ูุฅููุงุก ุงููููุฉ </h2><br>  ุจุงููุณุจุฉ ุฅูู Cortex M4 ุ ุชุณุชุฎุฏู ุฌููุน ุฃูุธูุฉ ุงูุชุดุบูู "3" ููุงุทุนุงุช ุ <i>ููุคูุช ุนูุงูุฉ ุงููุธุงู</i> ุ <i>ูุงุณุชุฏุนุงุก ุฎุฏูุฉ ุงููุธุงู ุนุจุฑ ุชุนูููุงุช SWI</i> ุ <i>ูุทูุจ ูุนูู ูููุงุทุนุงุช ุฎุฏูุฉ ุงููุธุงู</i> ุ ูุงูุชู ุชู ุงุฎุชุฑุงุนูุง ุจุดูู ุฃุณุงุณู ููุธุงู RTOS.  ุชุณุชุฎุฏู ุจุนุถ ุฃูุธูุฉ RTOS ุฃูุถูุง ููุงุทุนุงุช ุงููุธุงู ุงูุฃุฎุฑู ุ ูููููุง ุณุชููู ูุงููุฉ ููุนุธู ุฃูุธูุฉ ุชุดุบูู "ุฌููุน".  ูุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ูุณูููู ูู ุงููููู ุงูุฅุถุงูุฉ ุ ูุฐุง ุญุฏุฏ ููุท ุซูุงุซุฉ ูุนุงูุฌุงุช ููุฐู ุงูููุงุทุนุงุช ูููู ุชุจุฏุฃ RTOS ุ ูุญุชุงุฌ ุฅูู ุทุฑููุฉ ุจุฏุก ุฃุฎุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleSvcInterrupt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleSvInterrupt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleSysTickInterrupt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>;</code> </pre><br>  ุฃูู ูุง ุฃุญุชุงุฌู ูุงูุฐู ูุง ูููููู ุงูุนูุด ุจุฏููู ุ ูุง ุฃุญูู ุจู ูู ุขููุฉ ุงูุฅุฎุทุงุฑ ุจุงูููุงู.  ุจุดูู ุนุงู ุ ุฃุญุจ ุงูุจุฑูุฌุฉ ุงูุชู ุชุนุชูุฏ ุนูู ุงูุฃุญุฏุงุซ ุ ูุฐุง ุฃุญุชุงุฌ ุฅูู ุชูููุฐ ุบูุงู ุณุฑูุน ูุฅุจูุงุบ ุงูููุงู. <br><br>  ูู ุดูุก ุชุจูู ุฃูู ุจุณูุท ููุบุงูุฉ ุ ุฃู ูุธุงู ุชุดุบูู ููููู ุงูููุงู ุจุฐูู ุ ุญุณููุง ุ ุฑุจูุง ุจุงุณุชุซูุงุก <i>uc-OS-II</i> ู <i>III</i> ุ ุนูู ุงูุฑุบู ูู ุฃููู ุฑุจูุง ูู ุฃูุฑุฃู ุฌูุฏูุง ุ ูููู ูู ุฑุฃูู ุ ูุฅู ุขููุฉ ุงูุฃุญุฏุงุซ ุตุนุจุฉ ุจุดูู ุนุงู ุ ูููู ุญุณููุง ุ "ูู ุดูุก" ูู ุงูุจุงูู ูููููู ุจุงูุชุฃููุฏ. <br><br>  ูุฅุนูุงู ุงููููุฉ ุ ูุง ุนููู ุณูู ุฅุฑุณุงู ุงูุญุฏุซ ููุณ ุฅูู ุงููุฑุงุบ ุ ูููู ุนูู ูุฌู ุงูุชุญุฏูุฏ ุฅูู ุงููููุฉ ุ ููุฐุง ุ ูุฌุจ ุฃู ูููู ูุทุฑููุฉ ุงูุฅุนูุงู ูุคุดุฑ ุฅูู ุณูุงู ุงููููุฉ ุฃู ูุนุฑู ุงููููุฉ.  ุฃููู ููุท ุจุชุฎุฒูููุง ูู ูุฆุฉ <i>Thread</i> ุ ููุง ูุนูู ุฃูู ูุฌุจ ุฃูุถูุง ุฃู ูููู ููุฆุฉ Thread ุทุฑููุฉ ุชูุจูู.  ูุฌุจ ุฃู ุชููู ููุงู ุทุฑููุฉ ูุงูุชุธุงุฑ ุชูุจูู.  ูู ุงูููุช ููุณู ุ ูุถูู ุทุฑููุฉ <i>ุงูุณููู (..)</i> ุ ุงูุชู ุชููู ุชูููุฐ ุงููููุฉ ุงูุงุณุชุฏุนุงุก ูุคูุชูุง.  ุงูุขู ูุจุฏู ููุง ุงููุตููู ููุง ููู: <br><br><img src="https://habrastorage.org/webt/ie/r_/35/ier_35fgsut4a_gf_ismmm91tuk.png" alt="ุงูุตูุฑุฉ"><br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">rtos.hpp</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/******************************************************************************* * Filename : Rtos.hpp * * Details : Rtos class is used to create tasks, work with special Rtos * functions and also it contains a special static method Run. In this method * the pointer on Thread should be pass. This method is input point as * the task of Rtos. In the body of the method, the method of concrete Thread * will run. *******************************************************************************/</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> __RTOS_HPP #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __RTOS_HPP #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"thread.hpp"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// for Thread #include "../../Common/susudefs.hpp" #include "FreeRtos/rtosdefs.hpp" namespace OsWrapper { extern void wCreateThread(Thread &amp;, const char *, ThreadPriority, const tU16, tStack *) ; extern void wStart() ; extern void wHandleSvcInterrupt() ; extern void wHandleSvInterrupt() ; extern void wHandleSysTickInterrupt() ; extern void wEnterCriticalSection(); extern void wLeaveCriticalSection(); class Rtos { public: static void CreateThread(Thread &amp;thread , tStack * pStack = nullptr, const char * pName = nullptr, ThreadPriority prior = ThreadPriority::normal, const tU16 stackDepth = static_cast&lt;tU16&gt;(StackDepth::minimal)) ; static void Start() ; static void HandleSvcInterrupt() ; static void HandleSvInterrupt() ; static void HandleSysTickInterrupt() ; friend void wCreateThread(Thread &amp;, const char *, ThreadPriority, const tU16, tStack *); private: //cstat !MISRAC++2008-7-1-2 To prevent reinterpet_cast in the CreateTask static void Run(void *pContext ) { static_cast&lt;Thread*&gt;(pContext)-&gt;Execute() ; } } ; } ; #endif // __RTOS_HPP</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฎูุท. hpp</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/******************************************************************************* * Filename : thread.hpp * * Details : Base class for any Taskis which contains the pure virtual * method Execute(). Any active classes which will have a method for running as * a task of RTOS should inherit the Thread and override the Execute() method. * For example: * class MyTask : public OsWrapper::Thread * { * public: * virtual void Execute() override { * while(true) { * //do something.. * } * } ; * *******************************************************************************/</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> __THREAD_HPP #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __THREAD_HPP #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FreeRtos/rtosdefs.hpp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../../Common/susudefs.hpp"</span></span></span><span class="hljs-meta"> namespace OsWrapper { extern void wSleep(const tTime) ; extern void wSleepUntil(tTime &amp;, const tTime) ; extern tTime wGetTicks() ; extern void wSignal(tTaskHandle const &amp;, const tTaskEventMask) ; extern tTaskEventMask wWaitForSignal(const tTaskEventMask, tTime) ; constexpr tTaskEventMask defaultTaskMaskBits = 0b010101010 ; enum class ThreadPriority { clear = 0, lowest = 10, belowNormal = 20, normal = 30, aboveNormal = 80, highest = 90, priorityMax = 255 } ; enum class StackDepth: tU16 { minimal = 128U, medium = 256U, big = 512U, biggest = 1024U }; class Thread { public: virtual void Execute() = 0 ; inline tTaskHandle GetTaskHanlde() const { return handle; } static void Sleep(const tTime timeOut = 1000ms) { wSleep(timeOut) ; }; inline void Signal(const tTaskEventMask mask = defaultTaskMaskBits) { wSignal(handle, mask); }; inline tTaskEventMask WaitForSignal(tTime timeOut = 1000ms, const tTaskEventMask mask = defaultTaskMaskBits) { return wWaitForSignal(mask, timeOut) ; } friend void wCreateThread(Thread &amp;, const char *, ThreadPriority, const tU16, tStack *); private: tTaskHandle handle ; tTaskContext context ; } ; } ; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// __THREAD_HPP</span></span></span></span></code> </pre><br></div></div><br>  ุจุฏุฃุช ูู ุชูููุฐู ุ ูููุง ูุงูุช ุงููุดููุฉ ุงูุฃููู ูู ุงูุชุธุงุฑู ุ ุงุชุถุญ ุฃู ูุธุงู ุงูุชุดุบูู "ุฃู" ูุณุชุฏุนู ูุธุงุฆูู ูู ุงูููุงุทุนุงุช ุจุทุฑู ูุฎุชููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุญุชูู <i>FreeRTOS</i> ุนูู ุชุทุจููุงุช ุฎุงุตุฉ ููุธุงุฆู ุชูููุฐูุง ูู ุงูููุงุทุนุงุช ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงูุช ููุงู ูุธููุฉ <i>xTaskNotify (..)</i> ุ ููุง ููููู ุงุณุชุฏุนุงุกูุง ูู ููุงุทุนุฉ ุ ููููู ุจุญุงุฌุฉ ุฅูู ุงุณุชุฏุนุงุก <i>xTaskNotifyFromISR (..)</i> . <br>  ุจุงููุณุจุฉ ุฅูู <i>embos ุ</i> ุฅุฐุง ููุช ุจุงุณุชุฏุนุงุก ุฃู ูุธููุฉ ูู ููุงุทุนุฉ ุ ูุฑุฌู ุงุณุชุฎุฏุงู <i>OS_InInterrupt ()</i> ุนูุฏ ุฅุฏุฎุงู ููุงุทุนุฉ ู <i>OS_LeaveInterrupt ()</i> ุนูุฏ ุงูุฎุฑูุฌ.  ุงุถุทุฑุฑุช ุฅูู ุฅูุดุงุก ูุตู <i>InterruptEntry</i> ุ ุงูุฐู ูุญุชูู ููุท ุนูู ูููุดุฆ ููุฏูุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> OsWrapper { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wEnterInterrupt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wLeaveInterrupt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InterruptEntry</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InterruptEntry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ wEnterInterrupt() ; } <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> ~InterruptEntry() { wLeaveInterrupt() ; } } ; } ;</code> </pre> <br>  ููููู ุงุณุชุฎุฏุงูู ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Button::HandleInterrupt() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OsWrapper::InterruptEntry ie; EXTI-&gt;PR = EXTI_PR_PR13 ; myDesiredTask.Signal(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> myDesiredTask::Execute() { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (WaitForSignal(<span class="hljs-number"><span class="hljs-number">100000</span></span>ms) == defaultTaskMaskBits) { GPIOC-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ; } } } ;</code> </pre> <br>  ูู ุงููุงุถุญ ุ ุจุงููุณุจุฉ ูู <i>FreeRTOS ุ ุณูููู</i> ูู ูู ุงููููุดุฆ ูุงููุฏููุฑ ูุงุฑุบูุง.  <i>ูููุฅุฎุทุงุฑ</i> ุ ููููู ุงุณุชุฎุฏุงู ุงููุธููุฉ <i>xTaskNotifyFromISR (..)</i> ุ ุงูุชู ุชุนุชุจุฑ ููุงููุง ุตุบูุฑูุง ุ ุจุบุถ ุงููุธุฑ ุนู ุงูููุงู ุงูุฐู ูุชู ุงุณุชุฏุนุงุคู ููู ุ ููููู ูู ุชูุนู ุฐูู ูู ุฃุฌู ุงูุนุงูููุฉ.  ููููู ุจุงูุทุจุน ุฅูุดุงุก ุทุฑู ูููุตูุฉ ููุงุชุตุงู ูู ุงูููุงุทุนุงุช ุ ูููู ุงูุขู ูุฑุฑุช ุฃู ุฃูุนู ุฐูู ุนูู ูุณุชูู ุงูุนุงูู. <br>  ูููู ุชูููุฐ ููุณ ุงูุญููุฉ ุงูุชู ูุชู ุฅุฌุฑุงุคูุง ูุน <i>InterruptEntry</i> ุจุงููุณู ุงูุญุฑุฌ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> OsWrapper{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CriticalSection</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CriticalSection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ wEnterCriticalSection() ; } <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> ~CriticalSection() { wLeaveCriticalSection() ; } } ; } ;</code> </pre> <br>  ุงูุขู ููุท ุฃุถู ุชูููุฐ ุงููุธุงุฆู ุจุงุณุชุฎุฏุงู <i>FreeRtos</i> API ุฅูู ุงูููู ููู ุจุชุดุบูู ุงููุญุต ุ ุนูู ุงูุฑุบู ูู ุฃูู ูุง ููููู ุชุดุบููู ุ ูุฐุง ููู ุงููุงุถุญ ุฃูู ุณูุนูู :) <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">rtosFreeRtos.cpp</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/******************************************************************************* * Filename : rtosFreeRtos.cpp * * Details : This file containce implementation of functions of concrete * FreeRTOS to support another RTOS create the same file with the * same functions but another name&lt; for example rtosEmbOS.cpp and * implement these functions using EmbOS API. * *******************************************************************************/</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../thread.hpp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../mutex.hpp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../rtos.hpp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../../../Common/susudefs.hpp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"rtosdefs.hpp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../event.hpp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;limits&gt; namespace OsWrapper { /***************************************************************************** * Function Name: wCreateThread * Description: Creates a new task and passes a parameter to the task. The * function should call appropriate RTOS API function to create a task. * * Assumptions: RTOS API create task function should get a parameter to pass the * paramete to task. * Some RTOS does not use pStack pointer so it should be set to nullptr * * Parameters: [in] thread - refernce on Thread object * [in] pName - name of task * [in] prior - task priority * [in] stackDepth - size of Stack * [in] pStack - pointer on task stack * Returns: No ****************************************************************************/ void wCreateThread(Thread &amp; thread, const char * pName, ThreadPriority prior, const tU16 stackDepth, tStack *pStack) { #if (configSUPPORT_STATIC_ALLOCATION == 1) if (pStack != nullptr) { thread.handle = xTaskCreateStatic(static_cast&lt;TaskFunction_t&gt;(Rtos::Run), pName, stackDepth, &amp;thread, static_cast&lt;uint32_t&gt;(prior), pStack, &amp;thread.context); } #else thread.handle = (xTaskCreate(static_cast&lt;TaskFunction_t&gt;(Rtos::Run), pName, stackDepth, &amp;thread, static_cast&lt;uint32_t&gt;(prior), &amp;thread.handle) == pdTRUE) ? thread.handle : nullptr ; #endif } /***************************************************************************** * Function Name: wStart() * Description: Starts the RTOS scheduler * * Assumptions: No * Parameters: No * Returns: No ****************************************************************************/ void wStart() { vTaskStartScheduler() ; } /***************************************************************************** * Function Name: wHandleSvcInterrupt() * Description: Handle of SVC Interrupt. The function should call appropriate * RTOS function to handle the interrupt * * Assumptions: No * Parameters: No * Returns: No ****************************************************************************/ void wHandleSvcInterrupt() { vPortSVCHandler() ; } /***************************************************************************** * Function Name: wHandleSvInterrupt() * Description: Handle of SV Interrupt. The function should call appropriate * RTOS function to handle the interrupt * * Assumptions: No * Parameters: No * Returns: No ****************************************************************************/ void wHandleSvInterrupt() { xPortPendSVHandler() ; } /***************************************************************************** * Function Name: wHandleSysTickInterrupt() * Description: Handle of System Timer Interrupt. The function should call * appropriate RTOS function to handle the interrupt * * Assumptions: No * Parameters: No * Returns: No ****************************************************************************/ void wHandleSysTickInterrupt() { xPortSysTickHandler() ; } /***************************************************************************** * Function Name: wSleep() * Description: Suspends the calling task for a specified period of time, * or waits actively when called from main() * * Assumptions: No * Parameters: [in] timeOut - specifies the time interval in system ticks * Returns: No ****************************************************************************/ void wSleep(const tTime timeOut) { vTaskDelay(timeOut) ; } /***************************************************************************** * Function Name: wEnterCriticalSection() * Description: Basic critical section implementation that works by simply * disabling interrupts * * Assumptions: No * Parameters: No * Returns: No ****************************************************************************/ void wEnterCriticalSection() { taskENTER_CRITICAL() ; } /***************************************************************************** * Function Name: wLeaveCriticalSection() * Description: Leave critical section implementation that works by simply * enabling interrupts * * Assumptions: No * Parameters: No * Returns: No ****************************************************************************/ void wLeaveCriticalSection() { taskEXIT_CRITICAL() ; } /**************************************************************************** * Function Name: wEnterInterrupt() * Description: Some RTOS requires to inform the kernel that interrupt code * is executing * * Assumptions: No * Parameters: No * Returns: No ****************************************************************************/ void wEnterInterrupt() { } /**************************************************************************** * Function Name: wLeaveInterrupt() * Description: Some RTOS requires to inform that the end of the interrupt r * outine has been reached; executes task switching within ISR * * Assumptions: No * Parameters: No * Returns: No ****************************************************************************/ void wLeaveInterrupt() { } /**************************************************************************** * Function Name: wSignal() * Description: Signals event(s) to a specified task * * Assumptions: No * Parameters: [in] taskHandle - Reference to the task structure * [in] mask - The event bit mask containing the event bits, * which shall be signaled. * Returns: No ****************************************************************************/ void wSignal(tTaskHandle const &amp;taskHandle, const tTaskEventMask mask) { BaseType_t xHigherPriorityTaskWoken = pdFALSE ; xTaskNotifyFromISR(taskHandle, mask, eSetBits, &amp;xHigherPriorityTaskWoken) ; portYIELD_FROM_ISR( xHigherPriorityTaskWoken ) ; } /**************************************************************************** * Function Name: wWaitForSignal() * Description: Waits for the specified events for a given time, and clears * the event memory when the function returns * * Assumptions: No * Parameters: [in] mask - The event bit mask containing the event bits, * which shall be waited for * [in] timeOut - Maximum time in system ticks waiting for events * to be signaled. * Returns: Set bits ****************************************************************************/ tTaskEventMask wWaitForSignal(const tTaskEventMask mask, tTime timeOut) { uint32_t ulNotifiedValue = 0U ; xTaskNotifyWait( 0U, std::numeric_limits&lt;uint32_t&gt;::max(), &amp;ulNotifiedValue, timeOut); return (ulNotifiedValue &amp; mask) ; } /**************************************************************************** * Function Name: wCreateEvent() * Description: Create an Event object * * Assumptions: No * Parameters: [in] event - reference on tEvent object * * Returns: Handle of created Event ****************************************************************************/ tEventHandle wCreateEvent(tEvent &amp;event) { #if (configSUPPORT_STATIC_ALLOCATION == 1) return xEventGroupCreateStatic(&amp;event); #else return xEventGroupCreate(); #endif } /**************************************************************************** * Function Name: wDeleteEvent() * Description: Create an Event object * * Assumptions: No * Parameters: [in] eventHandle - reference on tEventHandle object * * Returns: No ****************************************************************************/ void wDeleteEvent(tEventHandle &amp;eventHandle) { vEventGroupDelete(eventHandle); } /**************************************************************************** * Function Name: wSignalEvent() * Description: Sets an resumes tasks which are waiting at the event object * * Assumptions: No * Parameters: [in] event - reference on eventHandle object * [in] mask - The event bit mask containing the event bits, * which shall be signaled * * Returns: No ****************************************************************************/ void wSignalEvent(tEventHandle const &amp;eventHandle, const tEventBits mask) { BaseType_t xHigherPriorityTaskWoken = pdFALSE; xEventGroupSetBitsFromISR(eventHandle, mask, &amp;xHigherPriorityTaskWoken) ; portYIELD_FROM_ISR(xHigherPriorityTaskWoken) ; } /**************************************************************************** * Function Name: wWaitEvent() * Description: Waits for an event and suspends the task for a specified time * or until the event has been signaled. * * Assumptions: No * Parameters: [in] event - Reference on eventHandle object * [in] mask - The event bit mask containing the event bits, * which shall be signaled * [in] timeOut - Maximum time in RTOS system ticks until the * event must be signaled. * [in] mode - Indicate mask bit behaviour * * Returns: Set bits ****************************************************************************/ tEventBits wWaitEvent(tEventHandle const &amp;eventHandle, const tEventBits mask, const tTime timeOut, OsWrapper::EventMode mode) { BaseType_t xWaitForAllBits = pdFALSE ; if (mode == OsWrapper::EventMode::waitAnyBits) { xWaitForAllBits = pdFALSE; } return xEventGroupWaitBits(eventHandle, mask, pdTRUE, xWaitForAllBits, timeOut) ; } /**************************************************************************** * Function Name: wCreateMutex() * Description: Create an mutex. Mutexes are used for managing resources by * avoiding conflicts caused by simultaneous use of a resource. The resource * managed can be of any kind: a part of the program that is not reentrant, a * piece of hardware like the display, a flash prom that can only be written to * by a single task at a time, a motor in a CNC control that can only be * controlled by one task at a time, and a lot more. * * Assumptions: No * Parameters: [in] mutex - Reference on tMutex structure * [in] mode - Indicate mask bit behaviour * * Returns: Mutex handle ****************************************************************************/ tMutexHandle wCreateMutex(tMutex &amp;mutex) { #if (configSUPPORT_STATIC_ALLOCATION == 1) return xSemaphoreCreateMutexStatic(&amp;mutex) ; #else return xSemaphoreCreateMutex(); #endif } /**************************************************************************** * Function Name: wDeleteMutex() * Description: Delete the mutex. * * Assumptions: No * Parameters: [in] mutex - handle of mutex * * Returns: Mutex handle ****************************************************************************/ void wDeleteMutex(tMutexHandle &amp;handle) { vSemaphoreDelete(handle) ; } /**************************************************************************** * Function Name: wLockMutex() * Description: Claim the resource * * Assumptions: No * Parameters: [in] handle - handle of mutex * [in] timeOut - Maximum time until the mutex should be available * * Returns: true if resource has been claimed, false if timeout is expired ****************************************************************************/ bool wLockMutex(tMutexHandle const &amp;handle, tTime timeOut) { return static_cast&lt;bool&gt;(xSemaphoreTake(handle, timeOut)) ; } /**************************************************************************** * Function Name: wUnLockMutex() * Description: Releases a mutex currently in use by a task * * Assumptions: No * Parameters: [in] handle - handle of mutex * * Returns: No ****************************************************************************/ void wUnLockMutex(tMutexHandle const &amp;handle) { BaseType_t xHigherPriorityTaskWoken = pdFALSE ; xSemaphoreGiveFromISR(handle, &amp;xHigherPriorityTaskWoken) ; portYIELD_FROM_ISR( xHigherPriorityTaskWoken ) ; } /**************************************************************************** * Function Name: wSleepUntil() * Description: Suspends the calling task until a specified time, or waits * actively when called from main() * * Assumptions: No * Parameters: [in] last - Refence to a variable that holds the time at which * the task was last unblocked. The variable must be initialised * with the current time prior to its first use * [in] timeOut - Time to delay until, the task will be unblocked * at time * * Returns: No ****************************************************************************/ void wSleepUntil(tTime &amp; last, const tTime timeOut) { vTaskDelayUntil( &amp;last, timeOut) ; } /**************************************************************************** * Function Name: wGetTicks() * Description: Returns the current system time in ticks as a native integer * value * * Assumptions: No * Parameters: No * * Returns: Current system time in ticks ****************************************************************************/ tTime wGetTicks() { return xTaskGetTickCount(); } }</span></span></span></span></code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/4a/sm/mm/4asmmm71hosjm510maad5hcadrm.png" alt="ุงูุตูุฑุฉ"><br><br><h2 style=";text-align:right;direction:rtl">  ููุงุตู ุชุญุณูู ุงููููุฉ </h2><br>  ุฃุถููุง ุงููููุฉ ุงูุขู ูู ูุง ุชุญุชุงุฌู ุชูุฑูุจูุง ุ ุฃุถููุง ุทุฑููุฉ Sleep ().  ุชููู ูุฐู ุงูุทุฑููุฉ ุจุฅููุงู ุงููููุฉ ูุคูุชูุง ููุชุฑุฉ ูุญุฏุฏุฉ.  ูู ูุนุธู ุงูุญุงูุงุช ุ ูููู ูุฐุง ูุงูููุง ุ ูููู ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ููุช ูุญุฏุฏ ุจูุถูุญ ุ ูุฅู Sleep () ูููู ุฃู ูุณุจุจ ูู ูุดุงูู.  ุนูู ุณุจูู ุงููุซุงู ุ ุชุฑูุฏ ุฅุฌุฑุงุก ุจุนุถ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ูููุถ ูุคุดุฑ LED ูุงูููุงู ุจุฐูู ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท ูู 100 ูููู ุซุงููุฉ <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MyTask::Execute() { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { DoCalculation(); <span class="hljs-comment"><span class="hljs-comment">//It takes about 10ms Led1.Toggle() ; Sleep(100ms) ; } }</span></span></code> </pre><br>  ุณูููุถ ูุฐุง ุงูุฑูุฒ ุนูู ูุคุดุฑ LED ูู 110 ูููู ุซุงููุฉ.  ููููู ุชุฑูุฏ ูุฑุฉ ูุงุญุฏุฉ ูู 100 ูููู ุซุงููุฉ ุ ููููู ุญุณุงุจ ููุช ุงูุญุณุงุจ ุชูุฑูุจูุง ููุถุน ูุถุน ุงูุณููู (90 ูููู ุซุงููุฉ).  ูููู ูุงุฐุง ูู ูุงู ููุช ุงูุญุณุงุจ ูุนุชูุฏ ุนูู ูุนููุงุช ุงูุฅุฏุฎุงู ุ ููู ูููู ุงููููุถ ุญุชููุง ุนูู ุงูุฅุทูุงู.  ููุซู ูุฐู ุงูุญุงูุงุช ูู ุฃูุธูุฉ ุชุดุบูู "ูุงูุฉ" ุ ููุงู ุทุฑู ุฎุงุตุฉ ูุซู DelayUntil ().  ูุนูู ุนูู ูุฐุง ุงููุจุฏุฃ - ุชุญุชุงุฌ ุฃููุงู ุฅูู ุชุฐูุฑ ุงููููุฉ ุงูุญุงููุฉ ูุนุฏุงุฏ ุงูุชุฌุฒุฆุฉ ููุธุงู ุงูุชุดุบูู ุ ุซู ุฅุถุงูุฉ ุฅูู ูุฐู ุงููููุฉ ุนุฏุฏ ุนูุงูุงุช ุงูุชุฌุฒุฆุฉ ุงูุชู ุชุญุชุงุฌ ุฅูู ุฅููุงู ุงููููุฉ ูุคูุชูุง ุ ุจูุฌุฑุฏ ุฃู ูุตู ุนุฏุงุฏ ุงูุชุฌุฒุฆุฉ ุฅูู ูุฐู ุงููููุฉ ุ ูุชู ุฅูุบุงุก ุชุฃููู ุงููููุฉ.  ูุจุงูุชุงูู ุ ุณูุชู ููู ุงููููุฉ ุชูุงููุง ุจุงููููุฉ ุงูุชู ุชุญุฏุฏูุง ูุณูููุถ ูุคุดุฑ LED ุชูุงููุง ูู 100 ูููู ุซุงููุฉ ุ ุจุบุถ ุงููุธุฑ ุนู ูุฏุฉ ุงูุญุณุงุจ. <br>  ูุชู ุชูููุฐ ูุฐู ุงูุขููุฉ ุจุดูู ูุฎุชูู ูู ุฃูุธูุฉ ุงูุชุดุบูู ุงููุฎุชููุฉ ุ ูููู ูุฏููุง ุฎูุงุฑุฒููุฉ ูุงุญุฏุฉ.  ููุชูุฌุฉ ูุฐูู ุ ุณูุชู ุชุจุณูุท ุงูุขููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงููููุฐุฉ ุนูู FreeRTOS ุ ุฅูู ุงูุญุงูุฉ ุงูููุถุญุฉ ูู ุงูุตูุฑุฉ ุงูุชุงููุฉ: <br><br><img src="https://habrastorage.org/webt/tg/n1/hb/tgn1hba-pczt2p5b0dzy0kut-ua.png" alt="ุงูุตูุฑุฉ"><br><br>  ููุง ุชุฑูู ุ ูุฅู ูุฑุงุกุฉ ุงูุญุงูุฉ ุงูุฃูููุฉ ูุนุฏุงุฏ ุงููุฑุงุฏ ููุธุงู ุงูุชุดุบูู ุชุญุฏุซ ูุจู ุงูุฏุฎูู ูู ุญููุฉ ูุง ููุงุฆูุฉ ุ ููุญู ุจุญุงุฌุฉ ุฅูู ุงูุชูุตู ุฅูู ุดูุก ูุชูููุฐ ุฐูู.  ูุฃุชู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุจ</a> ุชุตููู ููุฅููุงุฐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุทุฑููุฉ ุงููุงูุจ</a> .    ,         ,    ,      ,      Execute(),     , ..    .     ,        (   ),      . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thread</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">friend</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rtos</span></span></span><span class="hljs-class"> ;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ lastWakeTime = wGetTicks() ; Execute(); } ... tTime lastWakeTime = <span class="hljs-number"><span class="hljs-number">0</span></span>ms ; ... }</code> </pre> <br>     Run  Rtos,      Execute(),   Run()  Thread.      Rtos ,       Run()   Thread. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *pContext )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;Thread*&gt;(pContext)-&gt;Run() ; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุฏ ุงููุญูุฏ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฃุณููุจ SleepUntil ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู </font><font style="vertical-align: inherit;">ุฃูู ูุง ูููู ุชุทุจููู ุจุงูุงูุชุฑุงู ูุน ุงูุทุฑู ุงูุฃุฎุฑู ุงูุชู ุชููุน ุงููููุฉ. </font><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุฐูู ุ ูุญู ูุดููุฉ ุงูุนูู ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุงูุทุฑู ุงูุฃุฎุฑู ุงูุชู ุชุญุธุฑ ุงููููุฉ ุ ุณูููู ูู ุงููููู ุฅุถุงูุฉ ุทุฑููุฉ ุชุญุฏูุซ ุนุฏุงุฏ ุงูุชุฌุฒุฆุฉ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุชุฐูุฑ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูููุธุงู ุ </font><i><font style="vertical-align: inherit;">ูุงุณุชุฏุนุงุคู</font></i><font style="vertical-align: inherit;"> ูุจู </font><i><font style="vertical-align: inherit;">SleepUntil ()</font></i><font style="vertical-align: inherit;"> ุ ูููู ูู ุงูููุช ุงูุญุงูู ูุญู ููุท ูุถุน ูุฐุง ุงููุงุฑู ุงูุฏููู ูู ุงูุงุนุชุจุงุฑ. </font><font style="vertical-align: inherit;">ุชุธูุฑ ูุณุฎุฉ ูุชุทุฑูุฉ ูู ุงููุฆุงุช ูู ุงูุตูุฑุฉ ุงูุชุงููุฉ:</font></font><br><img src="https://habrastorage.org/webt/aw/nx/ts/awnxtsvd-odgyfaagkl3egc_tvs.png" alt="ุงูุตูุฑุฉ"><br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฎูุท. hpp</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/******************************************************************************* * Filename : thread.hpp * * Details : Base class for any Taskis which contains the pure virtual * method Execute(). Any active classes which will have a method for running as * a task of RTOS should inherit the Thread and override the Execute() method. * For example: * class MyTask : public OsWrapper::Thread * { * public: * virtual void Execute() override { * while(true) { * //do something.. * } * } ; * * Author : Sergey Kolody *******************************************************************************/</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> __THREAD_HPP #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __THREAD_HPP #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FreeRtos/rtosdefs.hpp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../../Common/susudefs.hpp"</span></span></span><span class="hljs-meta"> namespace OsWrapper { extern void wSleep(const tTime) ; extern void wSleepUntil(tTime &amp;, const tTime) ; extern tTime wGetTicks() ; extern void wSignal(tTaskHandle const &amp;, const tTaskEventMask) ; extern tTaskEventMask wWaitForSignal(const tTaskEventMask, tTime) ; constexpr tTaskEventMask defaultTaskMaskBits = 0b010101010 ; enum class ThreadPriority { clear = 0, lowest = 10, belowNormal = 20, normal = 30, aboveNormal = 80, highest = 90, priorityMax = 255 } ; enum class StackDepth: tU16 { minimal = 128U, medium = 256U, big = 512U, biggest = 1024U }; class Thread { public: virtual void Execute() = 0 ; inline tTaskHandle GetTaskHanlde() const { return handle; } static void Sleep(const tTime timeOut = 1000ms) { wSleep(timeOut) ; }; void SleepUntil(const tTime timeOut = 1000ms) { wSleepUntil(lastWakeTime, timeOut); }; inline void Signal(const tTaskEventMask mask = defaultTaskMaskBits) { wSignal(handle, mask); }; inline tTaskEventMask WaitForSignal(tTime timeOut = 1000ms, const tTaskEventMask mask = defaultTaskMaskBits) { return wWaitForSignal(mask, timeOut) ; } friend void wCreateThread(Thread &amp;, const char *, ThreadPriority, const tU16, tStack *); friend class Rtos ; private: tTaskHandle handle ; tTaskContext context ; tTime lastWakeTime = 0ms ; void Run() { lastWakeTime = wGetTicks() ; Execute(); } } ; } ; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// __THREAD_HPP</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rtos.hpp</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/******************************************************************************* * Filename : Rtos.hpp * * Details : Rtos class is used to create tasks, work with special Rtos * functions and also it contains a special static method Run. In this method * the pointer on Thread should be pass. This method is input point as * the task of Rtos. In the body of the method, the method of concrete Thread * will run. *******************************************************************************/</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> __RTOS_HPP #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __RTOS_HPP #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"thread.hpp"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// for Thread #include "../../Common/susudefs.hpp" #include "FreeRtos/rtosdefs.hpp" namespace OsWrapper { extern void wCreateThread(Thread &amp;, const char *, ThreadPriority, const tU16, tStack *) ; extern void wStart() ; extern void wHandleSvcInterrupt() ; extern void wHandleSvInterrupt() ; extern void wHandleSysTickInterrupt() ; extern void wEnterCriticalSection(); extern void wLeaveCriticalSection(); class Rtos { public: static void CreateThread(Thread &amp;thread , tStack * pStack = nullptr, const char * pName = nullptr, ThreadPriority prior = ThreadPriority::normal, const tU16 stackDepth = static_cast&lt;tU16&gt;(StackDepth::minimal)) ; static void Start() ; static void HandleSvcInterrupt() ; static void HandleSvInterrupt() ; static void HandleSysTickInterrupt() ; friend void wCreateThread(Thread &amp;, const char *, ThreadPriority, const tU16, tStack *); friend class Thread ; private: //cstat !MISRAC++2008-7-1-2 To prevent reinterpet_cast in the CreateTask static void Run(void *pContext ) { static_cast&lt;Thread*&gt;(pContext)-&gt;Run() ; } } ; } ; #endif // __RTOS_HPP</span></span></span></span></code> </pre><br></div></div><br><br><h2 style=";text-align:right;direction:rtl">  ุงูุฃุญุฏุงุซ </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐูู ูุชู ุฅูุดุงุก ุงููููุฉ ุ ููู ุงููููู ุฅุฑุณุงู ุญุฏุซ ุฅูููุง ุ ููููู ุฃุฑูุฏ ุชูููุฐ ุญุฏุซ ูุง ูููู ุฅุฑุณุงูู ุฅูู ูููุฉ ูุนููุฉ ุ ูููู ุฅูู ุฃู ูุดุชุฑู ููุฑุฑ ุงูุชุธุงุฑ ูุฐุง ุงูุญุฏุซ. </font><font style="vertical-align: inherit;">ุชุญุฏุซ ุชูุฑูุจูุง ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุชูููุฐ ุบูุงู ุนูู ุงูุญุฏุซ.</font></font><br><br>         ,     ,        ,    ,     ,         ,     ,             . ,          .      ,      ,     ,            ,        . <br><br><img src="https://habrastorage.org/webt/gv/na/8k/gvna8ktlrzvrposxbpwhzpn0keq.png"><br><br>    : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">OsWrapper::Event event{<span class="hljs-number"><span class="hljs-number">10000</span></span>ms, <span class="hljs-number"><span class="hljs-number">3</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//  ,    10000ms,    0    1. void SomeTask::Execute() { while(true) { using OsWrapper::operator""ms ; Sleep(1000ms); event.Signal() ; //      0   1. Sleep(1000ms); event.SetMaskBits(4) //    2. event.Signal() ; //      2. } } ; void AnotherTask::Execute() { while(true) { using namespace::OsWrapper ; //,      ,    10000ms if ((event.Wait() &amp; defaultTaskMaskBits) != 0) { GPIOC-&gt;ODR ^= (1 &lt;&lt; 5) ; } } } ;</span></span></code> </pre><br><br><h2 style=";text-align:right;direction:rtl"> ,    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุจุฏุงูุฉ ุ ุนูุฏูุง ููุช ุฃูุชุจ ูุฐู ุงูููุงูุฉ ุ ูู ุฃูู ุจุชูููุฐูุง ุจุนุฏ ุ ูููู ููุง ูุนุฏุช ุ ููุช ุจุชุทููุฑ ูููุงุช ุงููุฒุงููุฉ ูุตูุงุฏูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุ ูููู ุงููุตุฏุฑ ููุง: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub OsWrapper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูุซุงู ุนูู ุงุณุชุฎุฏุงู ุตูุฏูู ุจุฑูุฏ ููุง ููู:</font></font><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">OsWrapper::MailBox&lt;tU32, <span class="hljs-number"><span class="hljs-number">10</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    10   int void ReceiveTask::Execute() { tU32 item; while(true) { using OsWrapper::operator""ms ; if (queue.Get(item, 10000ms)) { //    GPIOC-&gt;ODR ^= (1 &lt;&lt; 9); } } } ; void SendTask::Execute() { tU32 item = 0U; while(true) { queue.Put(item); item ++; SleepUntil(1000ms); } } ;</span></span></code> </pre><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููููุฉ ุงุณุชุฎุฏุงู ูู ูุฐู ุงูุฃุนูุงู </font></font></h2><br>  ,       ,     ,   :  <i>LedTask</i> ,     2  ,    2     <i>myTask</i> ,   10  ,    ,    .          2 .      ,     <i>event</i> .      ,     :) <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> OsWrapper::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>ms ; OsWrapper::Event event{<span class="hljs-number"><span class="hljs-number">10000</span></span>ms, <span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTask</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OsWrapper::Thread { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.Wait() != <span class="hljs-number"><span class="hljs-number">0</span></span>) { GPIOC-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">9</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> tMyTaskStack = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>&lt;OsWrapper::tStack, <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;tU16&gt;(OsWrapper::StackDepth::minimal)&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> tMyTaskStack Stack; <span class="hljs-comment"><span class="hljs-comment">//C++17   IAR 8.30 } ; class LedTask : public OsWrapper::Thread { public: virtual void Execute() override { while(true) { GPIOC-&gt;ODR ^= (1 &lt;&lt; 5) ; using OsWrapper::operator""ms ; SleepUntil(2000ms); event.Signal() ; } } using tLedStack = std::array&lt;OsWrapper::tStack, static_cast&lt;tU16&gt;(OsWrapper::StackDepth::minimal)&gt; ; inline static tLedStack Stack; //C++17   IAR 8.30 } ; MyTask myTask; LedTask ledTask; int main() { using namespace OsWrapper ; Rtos::CreateThread(myTask, MyTask::Stack.data(), "myTask", ThreadPriority::lowest, MyTask::Stack.size()) ; Rtos::CreateThread(ledTask, LedTask::Stack.data()) ; Rtos::Start(); return 0; }</span></span></code> </pre> <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุฎูุงุตุฉ </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฌุฑุค ุนูู ุงูุชุนุจูุฑ ุนู ูุฌูุฉ ูุธุฑู ุงูุฐุงุชูุฉ ููุณุชูุจู ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ูููุชุญูู ุงูุฏููู. ุฃุนุชูุฏ ุฃู C ++ ูุงุฏู ูุณูุธูุฑ ุนุงุฌูุงู ุฃู ุขุฌูุงู ุงููุฒูุฏ ูุงููุฒูุฏ ูู ุฃูุธูุฉ ุงูุชุดุบูู ุงูุชู ุชููุฑ ูุงุฌูุฉ C ++. ูุญุชุงุฌ ุงููุตูุนูู ุงูุขู ุฅูู ุฅุนุงุฏุฉ ูุชุงุจุฉ ุฃู ูู ูู ุดูุก ูู C ++. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฌูุฉ ุงููุธุฑ ูุฐู ุ ุฃูุฏ ุฃู ุฃูุตู ุจุงุณุชุฎุฏุงู RTOS ุงูููุชูุจ ุจูุบุฉ C ++ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงููุดุงุฑ ุฅููู ุฃุนูุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTOS MAX</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูู ูู ุงูููุช ูููู ุฃู ูููุฑ ูู ุ ูุง ููููู ุญุชู ุฃู ุชุชุฎูู ุ ูุฃูู ูุง ุชุฒุงู ููุงู ููุฒุงุช ูุฑูุฏุฉ ูุซู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุณุงุฆู ุชูุงุนู ุงูููุงู ุ ุชุนูู ุนูู ูููุฑูููุชุฑููุฑ ูุฎุชููุฉ. ุฅุฐุง ูุงูุช ูุฏููุง ุฃูุถูุง ุดูุงุฏุฉ ุฃูุงู ุ ููู ูููู ููุงู ุญู ุฃูุถู.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ูู ุบุถูู ุฐูู ุ ูุณุชุฎุฏู ูุนุธููุง ุฃูุธูุฉ ุชุดุบูู Sishna ุงูุชูููุฏูุฉ ุ ููููู ุงุณุชุฎุฏุงู ุงูุบูุงู ูุจุฏุงูุฉ ุฃูููุฉ ููุงูุชูุงู ุฅูู ูุณุชูุจู ุณุนูุฏ ุจุงุณุชุฎุฏุงู C ++ :) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ ููุช ุจุชุฌููุน ูุดุฑูุน ุงุฎุชุจุงุฑ ุตุบูุฑ ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clion</font></font></a> .     ,           ,      IAR toolchain,   ,  ,   elf ,   hex , ,      GDB.     โ   ,     ,      ,    2 ,      ,   ,    ,      .     ,     Clion.     ,   IAR toolchain ,  . <br><br>      IAR       8.30.1,        .   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">XNUCLEO-F411RE</a> ,  ST-Link.   ,  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Clion</a> โ   ,    :) <br><br><img src="https://habrastorage.org/webt/tx/m_/e8/txm_e8pms1viazgy6cypd-kjj3q.png" alt="ุงูุตูุฑุฉ"><br><br>   <i>IAR</i>    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  IAR 8.30.1</a>    ,    ,      github,   ,        ,               FreeRtos. <br><br>  Z.Y.      GitHub <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar420467/">https://habr.com/ru/post/ar420467/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar420457/index.html">ูุธุฑุฉ ุนุงูุฉ ุนูู ุจุฑูุงูุฌ Simplify3D 3D Printing Software</a></li>
<li><a href="../ar420459/index.html">ุฃููููุฉ ูุน ุนุฏุงุฏ ูู ุดุฑูุท ุงูุฃุฏูุงุช ุงูุนููู: ูุซุงู ููุฌููุนุฉ ูุชููุนุฉ ูู ุงูุฃุณุงููุจ ููููุฉ ูุงุญุฏุฉ</a></li>
<li><a href="../ar420461/index.html">10 ุงูุชุจุงุณุงุช ูู ูุตูููู ุณูุฆูู</a></li>
<li><a href="../ar420463/index.html">ุชุณุชุญู ICO ูู ุงูุงูุฎูุงุถ ุ ููู ูุฏููู ูุฑุตุฉ ููุชุบููุฑ</a></li>
<li><a href="../ar420465/index.html">ูุชุบูุฑุงุช Nginx ูุน njs: ุจุณูุทุฉ ูุบูุฑ ูุคููุฉ ูุนุจุฑ JavaScript</a></li>
<li><a href="../ar420469/index.html">ููุฒุงุช ุงุณุชุฎุฏุงู Druid ุนูู ุณุจูู ุงููุซุงู ูู ุฒููุงุก ุงูุฏุฑุงุณุฉ</a></li>
<li><a href="../ar420471/index.html">ุซูุงุซุฉ ุชูุงุฑูุฑ ุชูููุฉ RIT 2018 ูู Plesk</a></li>
<li><a href="../ar420473/index.html">ูุชุจ ูููุฏูุฑูู ุงูุชูููุฐููู ุงููุจุชุฏุฆูู ุฃู ููุงุฐุง ูู ุงูููู ุฌุฏูุง ุงููุฑุงุกุฉ</a></li>
<li><a href="../ar420475/index.html">ููุงุฑูุฉ ุจูู ูุงูููุงุช ุงููุทุน ุจุงูููุฒุฑ Raylogic 11G ู Raylogic V12</a></li>
<li><a href="../ar420477/index.html">ูุฑุงุฌุนุฉ HyperX Cloud Stinger Core: ุณูุงุนุฉ ุฑุฃุณ ุฎูููุฉ ุงููุฒู ููููุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>