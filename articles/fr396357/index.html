<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÉüèº üî∞ ü§ù Scanner laser √† ing√©nierie inverse Leuze RS4 üöµüèø üö∂üèΩ üí∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Plus t√¥t, j'ai parl√© de l'ing√©nierie inverse d'un capteur de distance laser . Cette fois, nous parlerons d'un appareil plus complexe - un scanner lase...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Scanner laser √† ing√©nierie inverse Leuze RS4</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/396357/"><img src="https://habrastorage.org/files/09a/d9e/f75/09ad9ef7519d415f9d003991043d22b1.jpg" align="right"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus t√¥t, j'ai parl√© de l'ing√©nierie inverse d'un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capteur de distance laser</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cette fois, nous parlerons d'un appareil plus complexe - un scanner laser Leuze RS4. </font><font style="vertical-align: inherit;">Comme le capteur, ce scanner m'est venu dans un √©tat cass√©, j'ai donc d√ª commencer √† le restaurer et, dans le processus, √† am√©liorer certaines de ses caract√©ristiques et, en fait, √† le refaire dans un autre appareil.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce que ce scanner laser?</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leuze RS4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un scanner de s√©curit√© laser, c'est-√†-dire qu'il est con√ßu pour emp√™cher les personnes d'entrer dans les zones dangereuses de l'usine, pour √©viter les collisions des v√©hicules de production, etc. Il a des caract√©ristiques assez d√©centes - port√©e maximale: 15 / 50m (selon le mode de fonctionnement ), la pr√©cision de la mesure de la distance dans toute la plage de mesure est de 5 mm, la r√©solution angulaire est de 0,36 degr√©s, la vitesse de balayage est de 25 tr / min (25000 mesures / s).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que ce scanner est positionn√© pr√©cis√©ment comme un dispositif de s√©curit√© - c'est-√†-dire qu'il stocke l'emplacement des zones d'alarme et d'avertissement en m√©moire, et lorsqu'un objet entre dans ces zones, l'une des cl√©s s'ouvre dans le scanner. Pour configurer l'emplacement des zones, le scanner peut √™tre connect√© √† un ordinateur et observer l'emplacement des obstacles sur l'√©cran. Il existe m√™me un package ROS qui vous permet de recevoir des donn√©es de ce scanner.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai obtenu un scanner sans √©tui, d√©mont√© dans ses composants. Le scanner s'est √©cras√© en raison d'un fort coup port√© au corps; dans quoi exactement il a cess√© de fonctionner, je ne comprenais toujours pas - peut-√™tre que l'optique √©tait mal align√©e, le contact dans l'un des connecteurs s'est √©teint, ou le capteur de l'encodeur s'est d√©plac√©, ou autre chose. J'ai essay√© d'assembler toutes les pi√®ces ensemble, le scanner a √©t√© vu dans le logiciel natif, mais l'analyse n'a pas commenc√©. Je n'ai donc qu'une seule fa√ßon de le d√©marrer: restaurer le circuit du scanner aussi compl√®tement que possible et √©crire mon propre micrologiciel de microcontr√¥leur de scanner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemblaient les pi√®ces: </font><font style="vertical-align: inherit;">
ici, elles devraient √™tre situ√©es dans le bo√Ætier (photo de la documentation, on peut voir que le design et l'√©lectronique sont l√©g√®rement diff√©rents):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/52c/f37/092/52cf370928ab5d8ee92ff63432d49fbb.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/77f/2b8/395/77f2b839587cb43a293ea58c34270b1c.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre partie importante du scanner est le miroir de balayage (surlign√© en bleu sur la photo ci-dessus) install√© en son centre: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/16d/5db/5c6/16d5db5c60f0e710e0485fab2236e510.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagramme sch√©matique du scanner: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/74e/9e5/8bd/74e9e58bdd529e60b5a823df47fdc6db.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme le montre le diagramme, l'ensemble de l'√©lectronique du scanner se compose de modules s√©par√©s (cartes) connect√©s par des connecteurs et des boucles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe de nombreux modules - module d'alimentation (DC-DC), module d'interface, module processeur, module photod√©tecteur (APD), module laser. De plus, il y a aussi un module d'encodeur et deux cartes en forme de fer √† cheval, ce qui semblait √† premi√®re vue √©trange. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, il convient de leur pr√™ter attention:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/957/fd1/ab6/957fd1ab64924ab5285c3442bae9e0fe.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De toute √©vidence, l'une des cartes contient des LED et la seconde contient des photodiodes. Au d√©but, je pensais que c'√©tait une sorte d'encodeur, ou une sorte de m√©canisme pour v√©rifier le rayonnement laser. Cependant, plus tard, apr√®s avoir lu la documentation du scanner et avoir examin√© les photographies en d√©tail, j'ai r√©alis√© qu'il s'agissait d'un syst√®me de surveillance de l'√©tat de la surface de la vitre de protection du scanner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des trous pour les LED sont visibles sur la photo: </font></font><br>
<br>
<img src="https://habrastorage.org/files/d08/12c/0e5/d0812c0e54544f7d9d6439be016575c7.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mesurant le niveau du signal provenant des photodiodes, vous pouvez estimer le niveau de transmission du verre de protection. De toute √©vidence, ce syst√®me n'est pas critique pour le scanner, donc je n'ai pas utilis√© ces cartes √† l'avenir. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le module processeur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la partie la plus difficile du scanner. Voici √† quoi ressemble l'√©lectronique du module de deux c√¥t√©s:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/170/eb3/716/170eb3716ee18ad64d9e8ea5abf453d6.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la premi√®re fois que j'ai regard√© la carte, j'ai imm√©diatement r√©alis√© que le scanner utilise la m√©thode du temps de vol pour mesurer la distance (TOF) - la puce avec le plus grand marquage s'est av√©r√©e √™tre " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACAM TDC-GPX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", dont j'avais d√©j√† entendu parler. TDC - "Time-to-Digital Converter", c'est-√†-dire une puce sp√©cialis√©e con√ßue pour mesurer des intervalles de temps avec une tr√®s grande pr√©cision, c'est elle qui est utilis√©e pour mesurer le temps de "vol" d'une impulsion laser. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un microcontr√¥leur Infineon C167 avec une puce de m√©moire FLASH externe (qui a plu) et ASIC (qui a √©norm√©ment boulevers√©) √©tait √©galement √† bord. Plus en d√©tail sur ce module, je le dirai ci-dessous. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module de puissance</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient un convertisseur DC-DC √† isolation galvanique personnalis√© avec plusieurs tensions de sortie et plusieurs condensateurs: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/7c9/30a/1f5/7c930a1f510a7df150eb89654c4c82dd.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tension d'alimentation du convertisseur est de 24V. Sa principale caract√©ristique est qu'il fournit une haute tension (~ 230 V), qui est n√©cessaire pour le fonctionnement du laser et du photod√©tecteur, √† un petit connecteur s√©par√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il fournit √©galement les tensions suivantes au connecteur principal: + 5V, -5V, ~ 15V, isol√©es galvaniquement du reste + 5V pour l'interface RS232. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie optique du scanner</font></font></b><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/b2c/f7d/4af/b2cf7d4af2cf9f75fe2659845d9887fb.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä premi√®re vue, il n‚Äôest pas tr√®s clair o√π se trouvent les optiques du scanner. Dans ce cas, une petite fen√™tre avec un miroir au centre de la photo sert √† √©mettre le faisceau laser, et une grande surface brillante autour de celle-ci est la surface du filtre de lumi√®re d'interf√©rence install√© devant la lentille du photod√©tecteur. Ce filtre ne transmet que le rayonnement dont la longueur d'onde est proche de la longueur d'onde laser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici comment cela appara√Æt dans la documentation du scanner: </font></font><br>
<br>
<img src="https://habrastorage.org/files/a6a/58d/c01/a6a58dc01c2a434398d2e8e4b35ccd3b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
l'objectif lui-m√™me est mont√© √† l'int√©rieur d'un bo√Ætier en plastique noir, il est donc probl√©matique de le voir. A l'extr√©mit√© de ce bo√Ætier, contrairement √† ce qui est vu sur la photo ci-dessus, le </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">module laser</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">photod√©tecteur sont</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fixes </font><font style="vertical-align: inherit;">: </font><b><font style="vertical-align: inherit;">Module laser</font></b></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/17a/c09/dcf/17ac09dcf9e6e59b2383d155d932e7a3.jpg" alt="image"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vue du module laser (certains des d√©tails sont marqu√©s par moi lors du dessin du circuit): </font><font style="vertical-align: inherit;">
Comme vous pouvez le voir, le circuit de ce module est assez simple, donc j'ai pu restaurer compl√®tement son circuit: </font><font style="vertical-align: inherit;">
Une grande partie ronde sur la carte est un √©metteur laser sp√©cialis√©. </font><font style="vertical-align: inherit;">Malheureusement, il n'y avait aucune marque dessus, donc aucune documentation n'a pu √™tre trouv√©e dessus. </font><font style="vertical-align: inherit;">
√Ä partir de la description sur le scanner, vous pouvez trouver - ¬´Longueur d'onde de la lumi√®re laser - 905 nm¬ª, ¬´Classe laser - 1¬ª, ¬´Dur√©e d'impulsion - 0,003 ¬µs¬ª, ¬´Fr√©quence de r√©p√©tition - 25 kHz¬ª. </font><font style="vertical-align: inherit;">
Ce qu'il √©tait possible de comprendre en restaurant le circuit du module et en analysant son fonctionnement:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/c28/71a/a61/c2871aa619e574fe9cb8f01b7c3e21db.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/2d7/2c5/176/2d72c51767c4c239419dbcf2d35ff249.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'√©metteur laser est aliment√© en permanence avec une tension d'alimentation de 143 V, limit√©e par des diodes zener.</font></font></li>
<li>       ,    ¬´3¬ª .   ,     ,     .</li>
<li>   ,        ,    .        ( )    ¬´¬ª .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout le contr√¥le laser est effectu√© sur une seule ligne - "LASER_PULSE". La plupart du temps sur la ligne doit √™tre de haut niveau. Lorsqu'une impulsion n√©gative est appliqu√©e, le d√©clencheur DD1 est remis √† 0 sur son bord d'attaque et sur le bord de fuite, le d√©clencheur commence √† ¬´attendre¬ª le signal de la photodiode et le laser d√©marre. Lorsqu'un signal provenant de la photodiode appara√Æt, le d√©clencheur passe √† 1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez remarquer deux fils coaxiaux √† l'aide des connecteurs connect√©s au module. Ils sont utilis√©s pour transmettre le signal diff√©rentiel du d√©clencheur √† la puce TDC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce module contient √©galement cinq LED. Le module processeur les contr√¥le. </font><font style="vertical-align: inherit;">
Module </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">photod√©tecteur</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le module lui-m√™me ressemble √† ceci: </font><font style="vertical-align: inherit;">
Photographie du photod√©tecteur lui-m√™me √† proximit√©:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/a91/704/ae2/a91704ae269a7ce0761135bf935d1de8.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/444/bb5/671/444bb5671b8daa4ba612f2e35b331ada.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le signe de haute tension dans le coin de la carte montre clairement qu'une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">photodiode √† avalanche (APD)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">utilis√©e ici </font><font style="vertical-align: inherit;">- ils n√©cessitent une tension assez √©lev√©e pour fonctionner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, il n'y avait aucun marquage visible sur le corps du photod√©tecteur. Par l'embl√®me sur la photodiode elle-m√™me (au centre), il √©tait seulement possible de d√©terminer qu'elle √©tait fabriqu√©e par </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacific Silicon Sensor (First Sensor)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, il n'y avait plus d'informations sur lui, peut-√™tre qu'il est fait sur mesure. On peut voir sur la photo que ce photod√©tecteur est un hybride, c'est-√†-dire contient un amplificateur int√©gr√© - il est clairement visible au-dessus de la photodiode. De toute √©vidence, l'amplificateur et la photodiode ont besoin de puissance - ils sont aliment√©s par les bornes inf√©rieures (les condensateurs leur sont soud√©s). Un grand myst√®re √©tait le petit d√©tail √† gauche de la photodiode, √† laquelle se trouvent trois conducteurs. D'autres recherches ont montr√© qu'il s'agit d'un capteur thermique analogique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce module est beaucoup plus compliqu√© que le pr√©c√©dent, il utilise une carte de circuit imprim√© multicouche - au moins 4 couches, avec la plupart des lignes de signaux situ√©es sur la couche externe de la carte, ce qui facilite grandement son analyse. Dans ce module, j'ai restaur√© environ 80% du circuit, le reste n'√©tait pas vraiment n√©cessaire pour moi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le circuit r√©sultant du module photod√©tecteur: </font><font style="vertical-align: inherit;">
Au sommet du circuit se trouve une source lin√©aire haute tension r√©glable pour une photodiode √† avalanche. Il peut g√©n√©rer une tension stable d'au moins 150 V. Cette source est contr√¥l√©e par le DA1 DAC (LTC1451).</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/5d6/508/5ea/5d65085eade00ed5135fbf19a85bb783.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme le scanner est bas√© sur un t√©l√©m√®tre puls√©, la t√¢che principale du module photod√©tecteur est de d√©tecter rapidement un signal laser suffisamment faible r√©fl√©chi par un obstacle. √âtant donn√© que le niveau du signal lumineux est tr√®s faible, il ne peut √™tre d√©tect√© qu'√† l'aide d'une phototodiode √† avalanche, qui a son propre gain. Dans ce cas, le signal de la photodiode est en outre amplifi√© par un amplificateur int√©gr√© int√©gr√© au photod√©tecteur. Du fait que l'amplificateur est int√©gr√© dans le corps du photod√©tecteur, l'influence des interf√©rences sur le signal utile est r√©duite. Le signal g√©n√©r√© par le photod√©tecteur (OUT_B) est transmis √† une certaine puce DA4, qui, apparemment, est un autre amplificateur haute fr√©quence. Apr√®s cela, le signal est transmis √† l'entr√©e directe du comparateur √† grande vitesse D1 (MAX9601).Le signal de r√©f√©rence du diviseur de r√©sistance (environ 50 mV) est envoy√© √† l'entr√©e inverse de ce comparateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le signal en sortie du comparateur est diff√©rentiel, il est transmis via un fil coaxial directement √† la carte module processeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, le signal de la sortie de l'amplificateur DA4 est transmis √† une sorte de d√©tecteur de cr√™te, qui ¬´se souvient¬ª du niveau maximum de l'impulsion re√ßue. Je n'ai pas commenc√© √† restaurer le circuit de ce noeud, et n'ai puis√© sur le circuit que son √©tage de sortie (puce U1), dont le signal est √©galement transmis au module processeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une des parties du scanner qui est moins claire pour moi est le transistor Q3 install√© √† la sortie de l'amplificateur RF. A en juger par les circuits, il est n√©cessaire de permettre l'att√©nuation du signal √† la sortie de l'amplificateur. Ce transistor peut √™tre contr√¥l√© √† l'aide d'un signal provenant de la carte processeur (ligne 10 - ¬´digi¬ª).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez remarquer que la carte a une puce EEPROM. Toutes les sorties de signaux de cette puce sont connect√©es √† la carte processeur. Apparemment, dans ce microcircuit, certains param√®tres ont √©t√© stock√©s, uniques pour chaque carte photod√©tecteur, et enregistr√©s dans celui-ci lors du test de la carte. En particulier, il peut s'agir d'une courbe de la d√©pendance du gain APD sur la tension d'alimentation, de la d√©pendance de la tension en sortie du capteur de temp√©rature sur sa temp√©rature, et d'autres caract√©ristiques similaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez voir que la puissance du photod√©tecteur peut √™tre contr√¥l√©e en r√©glant certains niveaux sur les lignes CLK, CS, CS2 connect√©es au DAC et √† l'EEPROM.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La carte contient plusieurs circuits con√ßus pour surveiller son √©tat. Vous pouvez contr√¥ler le niveau de tension de l'APD, sa temp√©rature (ligne 7) et le seuil du comparateur. Ces tensions sont converties par des amplificateurs op√©rationnels DA3-DA5 et transmises √† la carte du module processeur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revenons au</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
module </font><b><font style="vertical-align: inherit;">processeur</font></b><font style="vertical-align: inherit;"> Ce module est le plus complexe de tous, il contient un grand nombre de microcircuits multi-sorties, la carte de circuit imprim√© est √† nouveau √† quatre couches, et la plupart des lignes de signal sont s√©par√©es dans les couches internes, ce qui complique consid√©rablement la restauration du circuit. </font><font style="vertical-align: inherit;">
Tr√®s souvent, il s'est av√©r√© que les pistes passaient d'un autre c√¥t√© de la planche. Afin de rechercher rapidement o√π une certaine piste est connect√©e, j'ai d√ª utiliser un tel pinceau, connect√© √† un multim√®tre (en mode num√©rotation):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/170/eb3/716/170eb3716ee18ad64d9e8ea5abf453d6.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/281/d5d/e1c/281d5de1cb6b8e4c16daf6d4f1690f99.jpg" alt="image"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai restaur√© environ 70% du r√©gime - le reste dont je n'avais pas vraiment besoin. Sch√©ma fonctionnel du module processeur: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/08d/3f6/60f/08d3f660f31927fd38ae94b82a953714.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sch√©ma r√©sultant du module processeur: </font><font style="vertical-align: inherit;">
Malgr√© le fait que j'appelle ce module ¬´module processeur¬ª partout, il est en r√©alit√© bas√© sur le </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">microcontr√¥leur Infineon SAK-C167CR-L33M</font></a><font style="vertical-align: inherit;"> . Il a 144 broches et est construit sur l'architecture C166 assez ancienne. Ce microcontr√¥leur ne poss√®de pas sa propre m√©moire non volatile - il est n√©cessaire de lui connecter une m√©moire externe via un bus parall√®le. √Ä ces fins, le scanner dispose d'une puce de m√©moire Flash M29F400B (512K x 8 / 256K x 16). De plus, deux puces RAM sont connect√©es au microcontr√¥leur - IS61C6416AL-12 (64K x 16) et K6R4016C1D (256K x 16).</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/f5d/fef/0a7/f5dfef0a7e036ce6af8872997538b420.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez voir que le bus d'adresse est connect√© √† tous les microcircuits de m√©moire avec un d√©calage d'un bit - les lignes de m√©moire A0 sont connect√©es √† la ligne A1 du microcontr√¥leur. Cela est d√ª au fait que les adresses sont d√©finies sur le bus d'adresses en octets, mais le contr√¥leur et la m√©moire sont en 16 bits. Pour que le contr√¥leur √©crive des octets uniques dans la RAM sans affecter les octets voisins dans un mot de 16 bits, les puces de m√©moire ont des lignes sp√©ciales UBn, LBn. Cette solution est tr√®s courante dans les appareils avec des bus parall√®les et est d√©crite en d√©tail dans la documentation du contr√¥leur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais une autre solution dans le module processeur n'est pas devenue compl√®tement claire pour moi. Si vous regardez la puce de m√©moire flash U1, vous remarquerez que la ligne A14 de la puce est connect√©e √† la terre. La ligne de bus d'adresse du contr√¥leur A15 correspondante n'est pas du tout connect√©e √† la puce. Le r√©sultat est que le contr√¥leur n'a acc√®s qu'√† la moiti√© de la m√©moire Flash. Une situation compl√®tement similaire avec la puce RAM2 (DD3). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec la puce RAM1 (DD2), la situation est quelque peu diff√©rente - la ligne de contr√¥leur A15 n'y est pas non plus connect√©e, mais en m√™me temps toutes les entr√©es d'adresse de cette puce sont connect√©es au bus d'adresse, de sorte que le contr√¥leur a acc√®s √† toute la m√©moire de la puce.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, vous devez faire attention au n≈ìud sur les √©l√©ments logiques DX1, DX2, DD4. </font><font style="vertical-align: inherit;">Ce sont ces microcircuits qui d√©terminent lequel des microcircuits de m√©moire est s√©lectionn√© par le microcontr√¥leur. </font><font style="vertical-align: inherit;">On peut voir qu'ils sont contr√¥l√©s par les signaux suivants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WRn - signal d'enregistrement, niveau actif - faible. </font><font style="vertical-align: inherit;">Sur cette ligne, le microcontr√¥leur d√©finit un niveau bas lorsque vous devez √©crire des donn√©es dans la m√©moire RAM externe</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A15 est la m√™me ligne de bus de donn√©es qui n'est connect√©e directement √† aucune des puces de m√©moire.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSn0 est un signal de s√©lection de puce sp√©cialis√©, le niveau actif est faible. </font><font style="vertical-align: inherit;">Cette ligne est connect√©e au d√©codeur d'adresse int√©gr√© au contr√¥leur. </font><font style="vertical-align: inherit;">Apr√®s une r√©initialisation, le contr√¥leur est bas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM2_CE - connect√© au GPIO du contr√¥leur avec un ascenseur au sol.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La logique de fonctionnement de ce n≈ìud est bien d√©crite par le tableau: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/f49/171/c32/f49171c3210acdcfbac396e81b568a46.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, selon l'√©tat de la ligne RAM2_CE, le microcontr√¥leur fonctionnera soit avec la m√©moire Flash soit avec le microcircuit RAM2 (DD3), et les espaces d'adressage pour eux co√Øncident. Il est √† noter que la capacit√© m√©moire de ces microcircuits est la m√™me. Peut-√™tre que cela est fait pour simplifier la mise √† jour du firmware de l'appareil. Il existe une autre option - la RAM install√©e est 3 fois plus rapide que la m√©moire Flash, donc apr√®s le d√©marrage, le contr√¥leur peut copier le contenu de FLASH vers RAM2, apr√®s quoi le programme est ex√©cut√© √† partir de celui-ci. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais le niveau √©lev√© de la ligne A15 d√©termine clairement que le contr√¥leur fonctionnera avec la puce RAM (DD2). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, il s'av√®re que la m√©moire FLASH et RAM1 alternent dans l'espace d'adressage du contr√¥leur:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/130/d7a/ee6/130d7aee659a1839be0296586fe25024.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La zone de RAM d√©j√† rencontr√©e est surlign√©e en rouge - en y acc√©dant, le contr√¥leur aura en r√©alit√© acc√®s aux donn√©es situ√©es aux adresses (0x8000-0xFFFF). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuration du compilateur n'est pas anodine et, comme je l'ai mentionn√© ci-dessus, la moiti√© de Flash / RAM2 est perdue. La raison pour laquelle les d√©veloppeurs du scanner n'ont pas bascul√© entre les puces FLASH et RAM en utilisant la ligne sp√©cialis√©e CSnX du contr√¥leur n'est pas claire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai d√©j√† mentionn√©, le contr√¥leur utilis√© n'a pas de m√©moire flash, et donc de bits de fusible. Afin de configurer certains param√®tres du contr√¥leur: largeur et adresse du bus de donn√©es, les param√®tres PLL sont des r√©sistances d√©roulantes connect√©es au bus de donn√©es. Le contr√¥leur lui-m√™me poss√®de des r√©sistances Pull-Up int√©gr√©es de haute r√©sistance (&gt; 100 KOhm) connect√©es √† l'ensemble du bus. Ainsi, en raison de r√©sistances externes, une certaine combinaison de signaux est √©tablie sur le bus, que le contr√¥leur lit lorsqu'il est allum√©. Il d√©termine les param√®tres de contr√¥leur n√©cessaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, nous parlons des r√©sistances R3-R6. La configuration s√©lectionn√©e des r√©sistances est coh√©rente avec les connexions de signal de bus r√©sultantes et fournit une vitesse d'horloge du contr√¥leur de 33 MHz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le signal impulsionnel du codeur miroir est envoy√© √† l'entr√©e du temporisateur "T2IN" du microcontr√¥leur via l'√©l√©ment logique OR D6. La deuxi√®me entr√©e de cette puce est connect√©e au GPIO du contr√¥leur, ce qui vous permet de d√©sactiver la fourniture d'impulsions √† l'entr√©e de la minuterie. Pourquoi une telle solution est n√©cessaire, et pourquoi il est impossible de d√©sactiver la minuterie par programme, je ne comprends toujours pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez maintenant faire attention √† la puce TDC (DD1). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le scanner poss√®de une puce TDC-GPX - la plus ¬´avanc√©e¬ª de toutes les gammes ACAM. Pr√©cision revendiqu√©e de la mesure des intervalles de temps jusqu'√† 10 ps RMS. Le microcircuit poss√®de 8 canaux d'entr√©e de lignes LVTTL et 2 canaux de LVECL (diff√©rentiel).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce scanner, pour obtenir la pr√©cision maximale de la mesure du temps, ce sont les entr√©es LVECL qui sont utilis√©es pour recevoir les signaux du module laser et du module photod√©tecteur √† l'aide de quatre c√¢bles coaxiaux. Les signaux du module laser sont envoy√©s aux entr√©es du DStart / DStartN et d√©marrent le d√©compte du temps. Les signaux du module photod√©tecteur sont envoy√©s aux entr√©es DStop1 / DStop1N, DStop2 / DStop2N et arr√™tent le d√©compte du temps. Comme le montre le diagramme, les signaux d'arr√™t sont appliqu√©s imm√©diatement √† deux canaux TDC, avec une polarit√© inverse. De ce fait, il est possible de mesurer non seulement la dur√©e du "vol" de l'impulsion lumineuse, mais √©galement la largeur de l'impulsion re√ßue.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le TDC-GPX poss√®de un bus de donn√©es 28 bits, mais il peut √™tre commut√© en mode 16 bits, ce qui est utilis√© dans le scanner. Le bus d'adresse est √† 4 bits, il est √©galement d√©cal√© de 1 bit, comme pour les puces m√©moire. Les puces DD8, DD9, U2 sont utilis√©es pour g√©n√©rer des signaux de contr√¥le de la puce et faire correspondre les niveaux - le microcontr√¥leur fonctionne √† partir de 5 V et le TDC - √† partir de 3,3 V. En g√©n√©ral, le syst√®me d'alimentation TDC est assez complexe, il y a m√™me un ajustement automatique de la tension d'alimentation. En raison de sa complexit√©, je n'ai pas commenc√© √† dessiner son diagramme - je soup√ßonne qu'il n'est pas tr√®s diff√©rent d'une fiche technique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La programmation du microcontr√¥leur et du TDC sera discut√©e plus loin.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai mentionn√© plus t√¥t, une puce ASIC personnalis√©e avec les inscriptions ¬´LEUZE98¬ª et ¬´WATCHDOG¬ª est install√©e sur la carte. Ce que c'est est inconnu. On peut voir qu'un oscillateur √† cristal de 20 MHz est connect√© √† ce microcircuit. Apr√®s avoir pu programmer le microcontr√¥leur, je me suis assur√© que l'ASIC n'interf√®re pas avec son fonctionnement et je n'ai pas restaur√© le sch√©ma de connexion de l'ASIC. Autant que je sache, cette puce communique avec le contr√¥leur via un bus parall√®le. Il est possible que ce soit l'ASIC qui g√©n√®re le signal de r√©initialisation RESETn, qui r√©initialise le contr√¥leur et le TDC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√©anmoins, il √©tait n√©cessaire de traiter certaines cha√Ænes plus en d√©tail.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est av√©r√© que le signal de commande laser "LASER_PULSE" peut √™tre g√©n√©r√© √† la fois par le microcontr√¥leur et l'ASIC en utilisant un n≈ìud sur les transistors T1, T2. Dans ce cas, lorsqu'il est activ√©, l'ASIC ouvre le transistor T1, de sorte que le contr√¥leur ne peut pas contr√¥ler le laser. Pour cette raison, j'ai d√ª retirer la r√©sistance R24 - et le laser a commenc√© √† √™tre normalement contr√¥l√© par le contr√¥leur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le signal de commande du moteur du miroir line_motor1 provenait √©galement de l'ASIC (via la diode D2). Pour cette raison, j'ai d√ª couper la piste sur la carte et connecter ce signal directement √† la sortie libre du contr√¥leur GPIO - P3.15.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus √©trange est que la ligne CS2 connect√©e au DAC install√© sur le circuit imprim√© du module photod√©tecteur s'est √©galement av√©r√©e √™tre connect√©e √† l'ASIC. Pour cette raison, le contr√¥leur n'a pas pu r√©gler ind√©pendamment la tension d'alimentation APD et allumer l'amplificateur APD. Cela a peut-√™tre √©t√© fait pour augmenter la fiabilit√© du scanner - un param√®tre DAC incorrect peut entra√Æner une d√©faillance de l'APD. J'ai √©galement d√ª connecter cette ligne √† la broche GPIO libre du contr√¥leur P3.4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est bien connu que c'est l'ASIC qui contr√¥le les trois LED mont√©es sur le module laser. Deux autres LED affichant l'√©tat du scanner (la pr√©sence d'un obstacle dans la zone de travail) sont contr√¥l√©es √† partir du contr√¥leur - lignes LN1, LN2. Ces lignes vont √©galement √† la carte du module d'interface.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que le scanner peut fonctionner dans les syst√®mes de s√©curit√©, la carte processeur dispose d'un grand nombre de n≈ìuds pour diagnostiquer son √©tat. </font><font style="vertical-align: inherit;">Le processeur (et √©ventuellement ASIC) peut d√©tecter l'inclusion d'un laser (√† l'aide de la puce U3), contr√¥ler le niveau de plusieurs tensions d'alimentation, la tension d'alimentation APD, la temp√©rature APD et le seuil du comparateur sur la carte photod√©tecteur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison du fait que la tension de r√©f√©rence de l'ADC du contr√¥leur est de 4,1 V, une partie des tensions mesur√©es est r√©duite √† l'aide de diviseurs de r√©sistance - ils peuvent √™tre vus dans le diagramme √† droite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, il vaut la peine de regarder de plus pr√®s la m√©thode de g√©n√©ration du </font><font style="vertical-align: inherit;">signal "digi" </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inhabituel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que j'ai mentionn√© plus t√¥t dans la description du module photod√©tecteur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le diagramme ci-dessous montre les n≈ìuds du module processeur (en bas) et du module photod√©tecteur (en haut):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/44d/9b6/e35/44d9b6e356033cbfe9f892c5b9838622.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les fl√®ches indiquent la connexion des modules √† l'aide de fils. Ci-dessous, je d√©crirai le fonctionnement de ces n≈ìuds, si je comprends bien. Dans le module photod√©tecteur, le signal de la sortie APD est amplifi√© par la puce DA4, apr√®s quoi il est transf√©r√© au comparateur D1. Si le niveau du signal √† l'entr√©e du comparateur est sup√©rieur √† 50 mV, alors un niveau haut est r√©gl√© √† la sortie du comparateur. Le signal de la sortie du comparateur est transmis au module processeur. Tout d'abord, il entre dans l'entr√©e TDC, qui compte le temps depuis le d√©but de l'impulsion laser. Mais en plus, ce signal est envoy√© √† l'entr√©e d'horloge du DD-trigger DD1. Une unit√© logique est toujours fournie √† l'entr√©e du signal de d√©clenchement, et le d√©clencheur lui-m√™me peut √™tre remis √† z√©ro √† l'aide de la ligne GPIO du contr√¥leur BASE5. Ainsi, le fonctionnement du comparateur conduit √† un d√©clencheur instantan√© "1". Ce d√©clencheur a une sortie diff√©rentielle,dont le signal est envoy√© √† l'entr√©e de la puce D3, qui la convertit au format LVTTL. Ce signal est envoy√© √† l'entr√©e ¬´digi¬ª du module photod√©tecteur. Comme je l'ai mentionn√© pr√©c√©demment, √† mon avis, l'apparition de ce signal conduit √† un affaiblissement du niveau du signal √† l'entr√©e du comparateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La question principale est pourquoi est-ce n√©cessaire et pourquoi est-il si difficile √† mettre en ≈ìuvre? Pourquoi √©tait-il impossible de faire les deux n≈ìuds sur la carte du module photod√©tecteur? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne peux qu'exprimer mes hypoth√®ses. Peut-√™tre que le signal doit √™tre att√©nu√© afin d'√©viter la transition du comparateur ou du d√©tecteur d'amplitude √† la saturation. Peut-√™tre - pour r√©duire la dur√©e de l'impulsion re√ßue. Pour les deux n≈ìuds, il ne pouvait tout simplement pas y avoir de place sur la carte photod√©tecteur. Une autre option est √©galement possible - le signal ne doit √™tre affaibli qu'apr√®s avoir eu le temps d'atteindre le PMH via des fils coaxiaux, ce qui justifie une conception aussi complexe. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©tude a montr√© qu'avant de d√©marrer une nouvelle impulsion laser, il est n√©cessaire de r√©initialiser le d√©clencheur, sinon les impulsions ne sont pas accept√©es. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module d'interface</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, je n'ai pas trouv√© une bonne photo de ce module. Il n'y a que celui-ci: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/394/165/79a/39416579aee7e4e226a1dbc9225386f0.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c'est sur ce module que sont install√©s les deux seuls connecteurs, auxquels vous pouvez vous connecter en dehors du scanner. L'un d'eux est RS-232 / RS-422, selon le second, l'alimentation est fournie au scanner, les signaux de commande sont fournis et un circuit de s√©curit√© est connect√© ici. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce module contient des convertisseurs UART-RS232 / RS485 et des optocoupleurs d'isolement galvanique (ils sont install√©s sur une petite carte s√©par√©e illustr√©e √† droite), les touches d'alimentation du circuit de s√©curit√©, les circuits d'entr√©e des lignes de commande du t√©l√©m√®tre, un circuit de commande du moteur, un convertisseur de signal codeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module de puissance et le module processeur, ainsi que le module codeur et le moteur miroir sont connect√©s √† ce module (√† l'aide des connecteurs en bas du module, ils ne sont pas visibles sur la photo).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sch√©ma partiel du module d'interface: </font><font style="vertical-align: inherit;">
je n'ai restaur√© qu'une partie du circuit de ce module (environ 20%), car je n'√©tais pas int√©ress√© par les cl√©s et les lignes d'entr√©e n√©cessaires pour assurer la s√©curit√©. Et il y en a pas mal, la documentation mentionne la limite de courant sur le circuit de s√©curit√©, la surveillance des courts-circuits et d'autres fonctionnalit√©s.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/6cb/b3b/711/6cbb3b71160b4d70462c898dac6263a5.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un peu bizarrement fait contr√¥ler la vitesse de rotation du moteur du miroir. Le contr√¥le de la vitesse est mis en ≈ìuvre en modifiant la tension du moteur - avec cela, tout est clair. Mais l'ajustement de cette tension elle-m√™me s'effectue √† l'aide d'une certaine cha√Æne d'int√©gration sur un amplificateur op√©rationnel. Afin d'augmenter la tension, le contr√¥leur met 0 sur la ligne line_mot1 pour la baisser - 1. √âvidemment, sans r√©troaction constante de l'encodeur, le moteur s'arr√™te ou acc√©l√®re √† la vitesse maximale √† travers le contr√¥leur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est av√©r√© que la puce du convertisseur UART-RS232 LTC1387 est assez lente - √† une vitesse de 500 kbit / s, les donn√©es ont √©t√© d√©form√©es. Pour cette raison, j'ai d√ª retirer une petite carte avec cette puce et connecter le convertisseur USB-UART directement √† la carte du module d'interface.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant que j'ai parl√© de la conception de tous les modules, il vaut la peine d'√©laborer sur le processus de r√©tro-ing√©nierie lui-m√™me.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lorsque j'ai commenc√© √† m'occuper de l'√©lectronique du scanner, j'avais le plus peur qu'un laser ou un photod√©tecteur puisse √™tre endommag√© √† la suite d'un impact. Dans le m√™me temps, je n'√©tais pas s√ªr de pouvoir lancer le module processeur - le microcontr√¥leur inconnu et l'ASIC √©taient g√™n√©s. J'ai donc tout d'abord restaur√© le circuit du module laser, puis le module photod√©tecteur. Apr√®s avoir pu comprendre le circuit de ces modules et d√©terminer le but de tous les contacts sur leurs connecteurs, il a √©t√© possible de passer au module processeur. En dernier recours, si je ne pouvais pas le d√©marrer, j'ai eu l'id√©e de faire un analogue de ce module sur des microcircuits STM32 + TDC-GP2.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âvidemment, pour v√©rifier le module, vous devez ex√©cuter votre propre programme sur le microcontr√¥leur Infineon SAK-C167CR qui y est install√©. Encore une fois, il convient de se rappeler que ce contr√¥leur n'a pas de m√©moire Flash int√©gr√©e. De plus, comme il s'est av√©r√©, le contr√¥leur n'a pas d'interfaces de d√©bogage sp√©cialis√©es (y compris JTAG). Avec un degr√© de probabilit√© √©lev√©, le firmware est √©crit sur un flash externe dans le programmateur en usine. Cependant, comme il s'est av√©r√©, tout n'est pas si mal - le contr√¥leur a un chargeur de d√©marrage (¬´Bootstrap Loader¬ª), fonctionnant sur UART. Ce chargeur de d√©marrage est stock√© dans la ROM de d√©marrage int√©gr√©e du contr√¥leur, il doit donc se trouver dans mon contr√¥leur. Et cela fonctionne de mani√®re assez particuli√®re - pour l'activer au d√©marrage, vous devez d√©finir la ligne de bus de donn√©es P0L.4 sur faible,apr√®s quoi le contr√¥leur commence √† attendre que l'octet 0x00 de l'h√¥te apparaisse. Apr√®s avoir accept√© cet octet, le chargeur de d√©marrage d√©termine automatiquement le taux de transfert et commence √† attendre 32 octets de donn√©es qu'il copie dans la RAM interne du contr√¥leur. Une fois les donn√©es re√ßues, le contr√¥leur d√©marre l'ex√©cution du programme re√ßu (16 mots du contr√¥leur).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, dans ces 32 octets, vous devez pousser un autre chargeur (¬´pr√©chargeur¬ª), qui recevra le chargeur principal ¬´Chargeur externe¬ª de l'h√¥te, et commencera son ex√©cution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, j'ai eu de la chance - pour ce processeur, il existe d√©j√† un programme FLASHit pr√™t √† l'emploi qui peut effectuer toutes les op√©rations mentionn√©es automatiquement. Le chargeur int√©gr√© a beaucoup de fonctionnalit√©s - avec lui, vous pouvez d√©terminer automatiquement le mod√®le de m√©moire Flash install√©e, modifier et afficher le contenu des registres du contr√¥leur, vous pouvez voir l'√©tat des canaux ADC.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai pas trouv√© de tampons de test sur la carte connect√©e √† la ligne P0L.4 du contr√¥leur, donc pour d√©marrer le chargeur de d√©marrage, j'ai d√ª souder une broche sp√©ciale sur cette ligne. J'ai coll√© la broche au bo√Ætier de l'une des puces RAM. Pour d√©marrer le chargeur de d√©marrage, vous devez connecter cette broche √† la terre via une r√©sistance de 8 kŒ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir connect√© la carte √† l'ordinateur et mis le module processeur sous tension, le microcontr√¥leur est vraiment apparu dans FLASHit. Apr√®s cela, j'ai √©crit un petit programme en Keil qui a commut√© l'une des broches du contr√¥leur et l'ai √©crit en Flash. Le programme a bien fonctionn√©, l'ASIC n'a pas interf√©r√© (j'avais peur d'une sorte de m√©canisme de surveillance int√©gr√© ou de conflits dans les bus), pour que je puisse continuer.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, j'ai restaur√© le circuit du module processeur, ce qui m'a permis de v√©rifier le fonctionnement de tous les modules de l'assemblage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re fois que j'ai v√©rifi√© le fonctionnement du module laser - comme je l'ai √©crit plus t√¥t, pour d√©marrer l'impulsion laser, il √©tait n√©cessaire d'appliquer un seul signal √† ce module. Le laser a fonctionn√© - ses flashs √©taient visibles √† l'aide de l'appareil photo d'un t√©l√©phone portable. De plus, √† l'aide d'un oscilloscope, j'ai v√©rifi√© que le module forme normalement des impulsions de d√©marrage (r√©f√©rence). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vint ensuite la v√©rification du module photod√©tecteur. Ici, je devais v√©rifier le fonctionnement du DAC, de l'unit√© de g√©n√©ration de tension de photodiode √† avalanche et de l'unit√© de contr√¥le de puissance de l'amplificateur √† photod√©tecteur. Tous ont gagn√©, ce qui a permis de v√©rifier le fonctionnement du t√©l√©m√®tre lui-m√™me. Pour ce faire, j'ai assembl√© ses modules sous la forme voulue par les d√©veloppeurs:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/462/307/8fe/4623078fe14cf75b455d285680f2ece8.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la photo, les cinq modules principaux sont assembl√©s autour du syst√®me optique. Ici, au lieu de mon propre miroir rotatif, j'ai install√© un miroir ordinaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, j'ai d√©pos√© √©crit un programme de contr√¥le laser pour UART, mis en place la photodiode. Du coup, quand j'ai d√©marr√© le laser √† l'entr√©e du comparateur, j'ai vraiment pu d√©tecter des impulsions avec un oscilloscope dont l'amplitude d√©pendait clairement du type d'obstacle devant le miroir! Le comparateur a √©galement bien fonctionn√©. La derni√®re partie importante du test est rest√©e - la v√©rification des performances TDC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La puce TDC-GPX install√©e dans le scanner a une conception assez compliqu√©e et peut fonctionner dans un grand nombre de modes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La figure ci-dessous montre son diagramme structurel:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/ab4/c21/6f6/ab4c216f68fe6e7785f763fd7619dc67.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, la puce contient 8 canaux distincts, c'est-√†-dire qu'elle peut recevoir jusqu'√† 8 signaux d'arr√™t. Si les canaux sont diff√©rentiels, seuls deux signaux d'arr√™t plus un signal de d√©marrage peuvent √™tre analys√©s. Dans ce cas, la puce vous permet de combiner les canaux de mesure, augmentant ainsi la pr√©cision de mesure des intervalles de temps:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/a22/968/689/a22968689e8450060a016c0db84b9bad.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honn√™tement, je n'ai pas aim√© la documentation de cette puce. Beaucoup de choses y sont d√©crites de mani√®re plut√¥t superficielle, les exemples de code sont incompr√©hensibles. La partie de la fiche consacr√©e √† l'ajustement de la r√©solution temporelle est remplie d'une sorte de ¬´nombres migratoires¬ª. Il n'y a pas non plus de ¬´note d'application¬ª normale sur la puce. De plus, dans le scanner lui-m√™me, je n'ai pas pu d√©tecter la connexion des lignes EF1 / EF1 au contr√¥leur. C'est √† partir de ces lignes que l'on peut d√©terminer que le microcircuit a fini de mesurer le temps. √Ä cause de tout cela, le d√©marrage du TDC m'a pris beaucoup de temps, mais en cons√©quence, tout a fonctionn√© comme il se doit - lorsque le laser a d√©marr√©, le TDC a fonctionn√©, et les r√©sultats du TDC d√©pendaient clairement de la distance √† l'obstacle. Ainsi, le t√©l√©m√®tre laser puls√© a commenc√© √† fonctionner. Il reste √† transformer toute la structure en un scanner laser r√©alisable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re √©tape dont j'avais besoin pour effectuer le r√©glage - le t√©l√©m√®tre assembl√© a cess√© de "voir" les obstacles apr√®s quelques m√®tres. Le syst√®me optique avait l'air intact, mais j'ai d√ª retirer les cartes du syst√®me optique, de sorte que la lumi√®re r√©fl√©chie n'√©tait pas pr√©cis√©ment focalis√©e par l'objectif sur le photod√©tecteur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant l'alignement, j'ai √©crit un programme pour le contr√¥leur, qui non seulement d√©terminait les distances, mais mesurait √©galement l'amplitude du signal g√©n√©r√© par le d√©tecteur de cr√™te √† l'aide de l'ADC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ensemble du processus d'ajustement a √©t√© r√©duit √† des mouvements fluides du photod√©tecteur et des cartes laser, et √† la recherche de leur position √† laquelle l'amplitude du signal est maximale. √Ä la suite de l'ajustement, l'amplitude du signal re√ßu a √©t√© consid√©rablement am√©lior√©e.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous devez pr√™ter attention √† certaines caract√©ristiques du traitement des donn√©es inh√©rentes aux t√©l√©m√®tres √† impulsions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le signal g√©n√©r√© par le photod√©tecteur a une forme analogique. Pour le convertir sous forme num√©rique, qui est ensuite trait√©e par le TDC, un comparateur est utilis√©, configur√© pour commuter si le signal d'entr√©e d√©passe un certain seuil. En cons√©quence, en raison de la forme complexe du signal d'entr√©e, lors du changement de l'amplitude du signal, une erreur se produit lors de la d√©termination des intervalles de temps:</font></font><br>
<br>
<img src="https://img-fotki.yandex.ru/get/198361/14557097.6/0_10da03_2cd9184c_orig.bmp" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme le montre le graphique, un signal avec une amplitude inf√©rieure sera d√©tect√© avec retard. Pour r√©soudre ce probl√®me, il existe plusieurs m√©thodes, √† la fois mat√©rielles et logicielles. J'ai d√©cid√© d'utiliser l'option la plus simple - la correction des r√©sultats de mesure en fonction de l'amplitude du signal. Dans le m√™me temps, j'ai d√ª collecter des statistiques sur les changements dans les r√©sultats de mesure du temps des changements dans l'amplitude du signal. Afin de changer l'amplitude du signal sans changer ses autres param√®tres, j'ai utilis√© des tampons en papier sur la lentille, ce qui a r√©duit le flux lumineux incident sur la photodiode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le r√©sultat a √©t√© cette d√©pendance: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/0db/eee/642/0dbeee642afc3de178445fe45d3e2044.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la base de cette d√©pendance, j'ai form√© une table de correction, dont les donn√©es sont utilis√©es par le programme du contr√¥leur pour d√©terminer la distance √† l'objet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©tape suivante consiste √† d√©marrer le moteur miroir et l'encodeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus t√¥t, j'ai d√©j√† cit√© une photo d'un miroir: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/16d/5db/5c6/16d5db5c60f0e710e0485fab2236e510.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
le moteur du miroir est sans balais, tr√®s similaire √† ceux utilis√©s dans les ventilateurs plus froids. Trois fils en sortent - 2 d'entre eux sont de l'alimentation, un autre est un signal de vitesse d'impulsion. Tous ces fils sont connect√©s au module d'interface, tandis que le signal de vitesse g√©n√©r√© par le moteur n'est pas utilis√© - le contr√¥le est bas√© sur les donn√©es du codeur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir sur la photo, un disque transparent avec des √©tiquettes pour l'encodeur est fix√© sur l'axe du moteur. Vous pouvez remarquer qu'il y a une marque z√©ro sur le disque.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'encodeur √©tait mont√© sur une petite carte et compl√®tement recouvert d'un √©cran m√©tallique, de sorte que son marquage ne pouvait pas √™tre d√©termin√©. Cependant, en fonction de sa taille et de son brochage, j'ai d√©cid√© qu'il s'agissait d'un encodeur en quadrature HEDS-9040: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e13/b8a/134/e13b8a134252c787ef4fee9ae23161ae.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
quatre fils sont pass√©s de la carte d'encodeur au module d'interface, mais il s'est av√©r√© que seuls trois d'entre eux ont √©t√© utilis√©s - deux alimentations et un signal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si je comprends bien, des d√©clencheurs Schmitt et une logique ont √©t√© install√©s sur la carte, combinant les donn√©es des canaux A, B et index (signal de marque z√©ro). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemblent le signal produit par la carte d'encodeur et le signal d'index pris directement de l'encodeur.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/fef/43c/dd1/fef43cdd10c0302e460b266ba4a5124b.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme on peut le voir, pendant le signal d'index, les impulsions du codeur sont supprim√©es. Il s'est av√©r√© que la carte de l'encodeur a g√©n√©r√© 500 impulsions par tour, mais la minuterie du contr√¥leur T2, √† laquelle la ligne de l'encodeur est connect√©e, peut fonctionner simultan√©ment sur les deux bords des impulsions, ce qui donne 1000 interruptions par tour du miroir. Cette valeur correspond √† la r√©solution angulaire d√©clar√©e du scanner √† 0,36 degr√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai r√©gl√© la minuterie T2 sur "Mode capture", ce qui me permet de mesurer le temps entre les interruptions de l'encodeur. Le temps obtenu est utilis√© pour d√©tecter la position "z√©ro" du miroir, et pour stabiliser la vitesse de rotation du moteur. Dans le m√™me temps, le nombre d'interruptions est compt√©, ce qui vous permet de d√©terminer la position du miroir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois que l'encodeur a fonctionn√© et que j'ai r√©ussi √† d√©marrer le contr√¥le du r√©gime moteur, il a √©t√© possible d'assembler compl√®tement le scanner. En raison de la forme complexe des cartes et de l'optique, la conception s'est av√©r√©e plut√¥t √©labor√©e: </font><font style="vertical-align: inherit;">
il n'a pas √©t√© facile d'assembler une telle conception - la pr√©cision de l'agencement des pi√®ces individuelles est tr√®s importante pour le scanner. Si l'axe du miroir ne co√Øncidait pas avec l'axe optique de la partie t√©l√©m√®tre, cela pourrait conduire au fait que le plan de balayage serait fortement incurv√© ou inclin√©.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/16f/05e/cdd/16f05ecddefcb0016348678d7f587d8b.jpg" alt="image"></a><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/2e6/71b/812/2e671b81234a099cbbe91cd55f9060c7.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la mesure de la distance exacte aux objets, il est important d'avoir une sorte d'objet ¬´de r√©f√©rence¬ª, dont la distance est connue avec pr√©cision. Connaissant le "temps de vol", vous pouvez d√©terminer avec pr√©cision le temps correspondant √† la distance z√©ro. En raison des changements de temp√©rature des composants du scanner, ce temps peut changer, ce temps doit donc √™tre surveill√© en permanence. Pour r√©soudre ce probl√®me, j'ai install√© une plaque noircie sp√©ciale dans le scanner: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/fcd/d14/a3b/fcdd14a3bbc74d42b8e75a734530e66d.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plaque est noircie afin que la lumi√®re r√©fl√©chie ne "aveugle" pas le photod√©tecteur. √Ä en juger par les instructions, des √©l√©ments r√©fl√©chissants sombres et lumineux ont √©galement √©t√© install√©s dans la conception originale du scanner. Ils ont √©t√© utilis√©s pour surveiller le fonctionnement de la partie t√©l√©m√®tre du scanner, et tr√®s probablement, ils ont √©galement √©t√© utilis√©s pour l'√©talonnage.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la photo ci-dessus, l'encodeur mont√© sur la carte est √©galement clairement visible. Il s'est av√©r√© que l'encodeur devait √™tre positionn√© tr√®s pr√©cis√©ment par rapport au disque, et il y avait beaucoup de probl√®mes avec cela - m√™me un petit d√©calage de l'encodeur entra√Ænait la perte d'impulsions, en particulier celles d'index. Il est possible que le scanner ait cess√© de fonctionner apr√®s avoir heurt√© le corps pr√©cis√©ment en raison de probl√®mes avec l'encodeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, il a √©t√© possible d'obtenir une vitesse de balayage allant jusqu'√† 20 tours par seconde. Avec une tension APD de 135 V, des distances allant jusqu'√† 10 √† 15 m sont normalement d√©tect√©es. √Ä une tension de 145 V et avec un filtrage de signal suppl√©mentaire, il est possible de mesurer des distances jusqu'√† 30 m (m√™me si je ne suis pas s√ªr que ce soit s√ªr pour un photod√©tecteur).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que la vitesse de transmission maximale dans le scanner d'origine est de 115200 bit / s, ce qui vous permet de transf√©rer toutes les donn√©es uniquement √† une vitesse d'environ 11 tours par seconde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai mentionn√©, dans mon firmware, je transf√®re des donn√©es √† une vitesse de 500 kbit / s, ce qui peut augmenter consid√©rablement le nombre de scans transmis par seconde. C'est √† cause de la limite de vitesse UART que je n'ai pas augment√© la vitesse de balayage aux 25 tours par seconde d'origine. Je note que dans la conception originale du scanner, les donn√©es sont trait√©es dans le scanner lui-m√™me, de sorte que la faible vitesse de transfert de donn√©es n'affecte pas particuli√®rement quoi que ce soit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que le scanner fonctionne d√©sormais sans bo√Ætier, il a √©t√© possible d'augmenter la zone de num√©risation √† 208 degr√©s contre 190 dans la conception d'origine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Visualisation des donn√©es re√ßues du scanner:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/ac1/8ae/f90/ac18aef90d3f6f6b083e373c0c80e144.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De toute √©vidence, le scanner devrait remplir certaines fonctions utiles, j'ai donc d√©cid√© de v√©rifier son fonctionnement dans ROS dans SLAM, et de comparer les r√©sultats avec les r√©sultats d'un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scanner laser maison</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour ce faire, je l'ai install√© sur Roomba, sur lequel un scanner fait maison √©tait pr√©c√©demment install√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vue du scanner Leuze install√© sur Roomba (le miroir tourne pour qu'il </font><font style="vertical-align: inherit;">
apparaisse </font><font style="vertical-align: inherit;">flou): </font><font style="vertical-align: inherit;">√Ä la suite de l'op√©ration hector_slam, nous avons r√©ussi √† obtenir une telle carte d'appartement (les murs sont affich√©s en jaune): </font><font style="vertical-align: inherit;">
Puisque l'aspirateur se d√©place au niveau du sol, il `` voit '' principalement les meubles. </font><font style="vertical-align: inherit;">
Mais une telle carte est obtenue si l'aspirateur est simplement port√© en main au niveau de la ceinture: </font><font style="vertical-align: inherit;">
dans ce cas, les murs de l'appartement sont ¬´visibles¬ª plus souvent.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/dc1/c58/f5a/dc1c58f5a2ecf6eba47a9f880d3aefbc.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/4fd/a8e/83d/4fda8e83dee18c10bfbd178f39a8b8e6.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/4f4/3d8/ec3/4f43d8ec31a8f1a0a546f9d85c76cee7.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si l'on compare la qualit√© des cartes, il est clair que les lignes du scanner maison sont plus ¬´bruyantes¬ª. Cela est d√ª au fait qu'avec un scanner maison qui utilise le principe de triangulation de fonctionnement, la pr√©cision augmente consid√©rablement avec l'augmentation de la distance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, malgr√© la tr√®s bonne qualit√© de num√©risation, ce scanner n'est pas adapt√© √† un robot autonome - il a des dimensions et une consommation √©lectrique trop importantes (environ 7,2 W).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O√π puis-je utiliser un tel scanner? Plus t√¥t, lorsque je discutais d'un scanner fait maison, on me posait souvent des questions sur la possibilit√© de faire un scanner 3D, et il est temps de le faire! Une vitesse de num√©risation assez √©lev√©e est utile ici. Bien s√ªr, par r√©solution, un tel scanner ne peut pas √™tre compar√© √† des scanners qui utilisent le principe de triangulation de la mesure de distance (avec une ligne laser ou un projecteur (SLS)), mais ils peuvent scanner de grands espaces - locaux, sections de rue. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de refaire un scanner 2D en 3D, vous devez lui fournir la possibilit√© de tourner le long d'un autre axe. J'ai d√©cid√© de faire mon scanner en utilisant le m√™me principe de balayage de faisceau que dans le scanner de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">articles. Pour ce faire, j'ai plac√© le scanner Leuze ¬´couch√©¬ª de sorte que son plan de balayage soit perpendiculaire au sol. Ensuite, il √©tait n√©cessaire de r√©aliser une rotation lente et en douceur de l'ensemble du scanner autour de l'axe. La principale difficult√© - le scanner doit tourner sans battements ni distorsions, ce qui entra√Ænera une distorsion des scans. Comme il s'est av√©r√©, √† la maison, il est difficile de fabriquer un ensemble de roulements qui peut fournir une rotation aussi pr√©cise. Par cons√©quent, j'ai d√©cid√© d'utiliser la t√™te VHS du magn√©tophone comme unit√© de roulement - elle contient deux roulements, est fabriqu√©e avec une tr√®s grande pr√©cision et est capable de supporter le poids du scanner. La conception r√©sultante est entra√Æn√©e par un moteur pas √† pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le scanner 3D assembl√© ressemble √† ceci: </font><font style="vertical-align: inherit;">
Vue du scanner mont√© sur un tr√©pied:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/60d/967/07c/60d96707cb26b50daca5c06bcbee64e5.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/167/77d/118/16777d118478b27a1b5ae56d449304d3.jpg" alt="image"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la gauche se trouve une batterie 12 V, qui est √©galement un contrepoids. Comme le scanner Leuze n√©cessite 24 V pour fonctionner, j'ai d√ª installer un convertisseur DC / DC √©l√©vateur assembl√© sur la base de la puce XL6009 du scanner. Le moteur pas √† pas du scanner est contr√¥l√© par un module sur l'A4988 et l'Arduino, qui permet une rotation √† une vitesse donn√©e. Le scanner Leuze (via l'adaptateur USB-UART) et l'Arduino sont connect√©s via un concentrateur USB avec un fil √† un ordinateur qui capture les donn√©es. Dans la forme actuelle, la rotation du miroir du scanner et la rotation de l'ensemble du scanner ne sont pas synchronis√©es - la vitesse de rotation du scanner est choisie de sorte que lorsqu'il est tourn√© de 0,36 degr√©s, le miroir ait le temps de faire au moins trois tours. Comme il n'y a pas de synchronisation de vitesse, j'ai d√ª transmettre des informations de position de synchronisation de l'Arduino au scanner Leuze.Ceci est mis en ≈ìuvre tout simplement - lorsque Arduino fait pivoter le scanner tous les 0,36 degr√©s, il modifie le niveau du signal sur l'un des terminaux. Ce signal est transmis au module processeur du scanner (au connecteur inutilis√© du capteur d'√©tat de la vitre de protection). Des informations sur l'√©tat de ce signal sont transmises au d√©but de chaque envoi de scanner - ainsi le programme auto-√©crit pour le PC qui contr√¥le le scanner re√ßoit des informations sur le mouvement du scanner et d√©termine l'angle de rotation.re√ßoit des informations sur le mouvement du scanner et d√©termine l'angle de rotation.re√ßoit des informations sur le mouvement du scanner et d√©termine l'angle de rotation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une seule num√©risation 3D g√©n√©r√©e par le scanner contient environ 350'000 points. </font><font style="vertical-align: inherit;">Bien s√ªr, c'est nettement moins que celui des scanners professionnels, mais tout de m√™me assez bon, surtout si vous collez plusieurs scans ensemble. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple est un scan unique d'une pi√®ce: </font><font style="vertical-align: inherit;">
Un exemple est un scan d'une pi√®ce coll√©e √† partir de plusieurs: La </font><font style="vertical-align: inherit;">
partie scann√©e de l'entr√©e: Une </font><font style="vertical-align: inherit;">
vid√©o montrant les r√©sultats du scanner r√©sultant:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/152/e40/f46/152e40f4695ab5321aa7de9f0bf00f45.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/37c/376/a36/37c376a366c09c7b5c94cca47992d5f1.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/592/ebd/33d/592ebd33da93487d27e38a2ca030025e.png" alt="image"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3SnqrfDCc70" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code source du programme contr√¥leur sur Github</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr396357/">https://habr.com/ru/post/fr396357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr396343/index.html">Les √©toiles explosent-elles finalement?</a></li>
<li><a href="../fr396345/index.html">Impression d'entreprise: bien plus de probl√®mes qu'il n'y para√Æt</a></li>
<li><a href="../fr396347/index.html">Contr√¥le de la climatisation via Wi-Fi</a></li>
<li><a href="../fr396349/index.html">"Un ami de mon ami a dit ...". R√©v√©ler les ragots et les mythes sur les SSD</a></li>
<li><a href="../fr396353/index.html">Bouton tactile avec r√©tro-√©clairage de la Chine pour l'artisanat de bricolage</a></li>
<li><a href="../fr396359/index.html">SoftBank ach√®te ARM Holdings pour 24 milliards de livres sterling</a></li>
<li><a href="../fr396361/index.html">Le propri√©taire de Tesla Model S affirme que le pilote automatique de sa voiture √©lectrique a sauv√© le pi√©ton de la mort</a></li>
<li><a href="../fr396363/index.html">Windows 10 a exactement un an</a></li>
<li><a href="../fr396365/index.html">HyperX Alloy FPS - La fiabilit√© avant tout</a></li>
<li><a href="../fr396367/index.html">Les codes SMS d'autorisation de t√©l√©gramme continuent d'intercepter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>