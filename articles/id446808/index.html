<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ‘©ğŸ¼â€ğŸ¤ â›¹ï¸ Kompiler saya untuk Lisp ğŸˆ¹ ğŸ‘†ğŸ¾ ğŸ˜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya sangat senang mengumumkan penyelesaian kompiler pertama saya untuk bahasa pemrograman! Malcc adalah kompilator Lisp AOT tambahan yang ditulis dal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kompiler saya untuk Lisp</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446808/">  Saya sangat senang mengumumkan penyelesaian kompiler pertama saya untuk bahasa pemrograman!  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Malcc</a> adalah kompilator Lisp <abbr title="Sebelum waktunya">AOT</abbr> tambahan yang ditulis dalam C.</b> <br><br>  Secara singkat saya akan berbicara tentang perkembangannya selama bertahun-tahun dan apa yang saya pelajari dalam proses itu.  Judul artikel alternatif: "Cara menulis kompiler dalam sepuluh tahun atau kurang." <br><br>  (Pada akhirnya ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">TL; DR</a> , jika Anda tidak peduli dengan latar belakang). <br><a name="habracut"></a><br><h1>  Demo penyusun </h1><br><pre><code class="plaintext hljs">tim ~/pp/malcc master 0 â†’ ./malcc Mal [malcc] user&gt; (println "hello world") hello world nil user&gt; (+ 1 2) 3 user&gt; (def! fib2 (fn* (n) (let* (f (fn* (n1 n2 c) (if (= cn) n2 (f n2 (+ n1 n2) (+ c 1))))) (f 0 1 1)))) &lt;lambda&gt; user&gt; (fib2 25) 75025 user&gt; ^D% tim ~/pp/malcc master 0 â†’ ./malcc examples/hello.mal hello world tim ~/pp/malcc master 0 â†’ ./malcc --compile examples/hello.mal hello gcc -g -I ./tinycc -I . -o hello hello.c ./reader.c ./printer.c ./hashmap.c ./types.c ./util.c ./env.c ./core.c ./tinycc/libtcc.a -ledit -lgc -lpcre -ldl tim ~/pp/malcc master 0 â†’ ./hello hello world tim ~/pp/malcc master 0 â†’</code> </pre> <br><h1>  Kegagalan yang berhasil </h1><br>  Selama hampir sepuluh tahun, saya bermimpi menulis kompiler.  Saya selalu terpesona oleh karya bahasa pemrograman, terutama kompiler.  Meskipun aku membayangkan kompiler itu sebagai sihir gelap dan mengerti bahwa mustahil bagi manusia biasa sepertiku untuk membuatnya dari awal. <br><br>  Tetapi saya masih mencoba dan belajar sepanjang jalan! <br><br><h1>  Pertama, penerjemah </h1><br>  Pada 2011, saya mulai mengerjakan penerjemah sederhana untuk bahasa fiksi Airball (airball dapat diterjemahkan sebagai â€œmuffâ€).  Dengan nama Anda dapat mengevaluasi tingkat ketidakpastian saya bahwa itu akan berhasil.  Itu adalah program Ruby yang cukup sederhana yang mem-parsing kode dan berjalan melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pohon sintaksis abstrak</a> (AST).  Ketika penerjemah masih bekerja, saya menamainya menjadi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lydia</a> dan menulis ulang untuk C agar lebih cepat. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b4/902/4ee/6b49024ee04e02ae1b56776aa5ed05bc.png"><br><br>  Saya ingat sintaksis Lydia tampak sangat cerdas bagi saya!  Saya masih menikmati kesederhanaannya. <br><br>  Meskipun Lydia jauh dari kompiler yang sempurna, itu mengilhami saya untuk terus bereksperimen.  Namun, saya masih tersiksa oleh pertanyaan, bagaimana cara membuat kompiler bekerja: <i>apa yang harus dikompilasi?</i>  <i>apakah saya perlu belajar assembler?</i> <br><br><h1>  Kedua, kompiler bytecode dan interpreter </h1><br>  Sebagai langkah berikutnya, pada tahun 2014, saya mulai mengerjakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">skema-vm</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mesin virtual</a> untuk Skema yang ditulis dalam Ruby.  Saya berpikir bahwa mesin virtual dengan stack dan bytecode sendiri akan menjadi tahap transisi dari seorang interpreter dengan AST pass dan kompiler penuh.  Dan karena Skema <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">didefinisikan secara formal</a> , tidak perlu menemukan apa pun. <br><br>  Saya telah bermain-main dengan skema-vm selama lebih dari tiga tahun dan telah belajar banyak tentang kompilasi.  Pada akhirnya, saya menyadari bahwa saya tidak dapat menyelesaikan proyek ini.  Kode berubah menjadi kekacauan nyata, tetapi tidak ada akhir yang terlihat.  Tanpa seorang mentor atau pengalaman, saya sepertinya berkeliaran di kegelapan.  Ternyata, <i>spesifikasi</i> bahasa tidak sama dengan <i>manual</i> untuk itu.  Pelajaran yang dipetik! <br><br>  Pada akhir 2017, saya menunda skema-vm untuk mencari sesuatu yang lebih baik. <br><br><h1>  Bertemu dengan Mal </h1><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/386/7e7/183/3867e7183f1ec919f168fcfefc2ec6b3.png"></a> <br><br>  Suatu waktu di tahun 2018, saya bertemu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mal</a> , seorang penerjemah Lisp gaya Clojure. <br><br>  Mal ditemukan oleh Joel Martin sebagai alat pelatihan.  Sejak itu, lebih dari 75 implementasi dalam berbagai bahasa telah dikembangkan!  Ketika saya melihat implementasi ini, saya menyadari bahwa mereka banyak membantu: jika saya macet, maka saya bisa mencari tip di versi Ruby atau Python.  Akhirnya, setidaknya seseorang berbicara dalam bahasa saya! <br><br>  Saya juga berpikir bahwa jika saya bisa menulis juru bahasa untuk Mal, saya bisa mengulangi langkah yang sama - dan membuat kompiler untuk Mal. <br><br><h1>  Mal penerjemah di Rust </h1><br>  Pertama, saya mulai mengembangkan penerjemah sesuai dengan <a href="">panduan</a> .  Pada saat itu, saya secara aktif mempelajari Rust (saya akan meninggalkannya untuk artikel lain), jadi saya menulis implementasi Mal saya sendiri di Rust: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mal-rust</a> .  Lihat di sini untuk lebih lanjut tentang percobaan ini. <br><br>  <b>Itu adalah kesenangan yang sempurna!</b>  Saya tidak tahu bagaimana harus berterima kasih atau memuji Joel karena membuat panduan hebat untuk Mal.  Setiap langkah dijelaskan <i>secara terperinci</i> , ada diagram alur, kode semu, dan <b>tes</b> !  Semua yang dibutuhkan pengembang untuk membuat bahasa pemrograman dari awal hingga akhir. <br><br>  Menjelang akhir tutorial, saya berhasil menjalankan implementasi Mal saya untuk Mal, ditulis dalam Mal, di atas implementasi Rust saya.  (dua tingkat kedalaman, wow).  Ketika dia bekerja untuk pertama kalinya, saya melompat ke atas kursi dengan gembira! <br><br><h1>  Kompiler Mal C </h1><br>  Segera setelah saya membuktikan kelayakan dari karat, saya segera mulai meneliti bagaimana menulis kompiler.  Kompilasi ke assembler?  Bisakah saya mengkompilasi kode mesin secara langsung? <br><br>  Saya melihat assembler x86 ditulis dalam Ruby.  Dia menggelitik saya, tetapi pemikiran untuk bekerja dengan assembler membuat saya berhenti. <br><br>  Pada satu titik, saya menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">komentar</a> ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di Hacker News</a> , yang menyebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tiny C Compiler</a> sebagai "kompilasi backend."  Sepertinya ide yang bagus! <br><br>  TinyCC memiliki file uji yang menunjukkan <a href="">cara menggunakan libtcc</a> untuk mengkompilasi kode C. Dari program C. Ini adalah titik awal untuk "hello world". <br><br>  Kembali lagi ke panduan Mal, mengingat pengetahuan saya tentang C, dalam beberapa bulan bebas malam dan akhir pekan, saya bisa menulis kompilator Mal.  Itu adalah kenikmatan nyata. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/187/2e2/99e/1872e299effaaea82a3716cd48cdf27a.png"></a> <br><br>  Jika Anda terbiasa berkembang melalui pengujian, maka evaluasi ketersediaan satu set tes pendahuluan.  Tes mengarah pada implementasi kerja. <br><br>  Saya tidak bisa mengatakan banyak tentang proses ini, kecuali saya ulangi: manual Mal adalah harta nyata.  Di setiap langkah, saya tahu persis apa yang harus dilakukan! <br><br><h1>  Kesulitan </h1><br>  Melihat ke belakang, berikut adalah beberapa kesulitan ketika menulis kompiler Mal, di mana saya harus bermain-main: <br><br><ol><li>  Macro harus mengkompilasi dengan cepat dan siap untuk dieksekusi pada waktu kompilasi.  Ini sedikit membingungkan. <br></li><li>  Penting untuk menyediakan "lingkungan" (pohon hash / array asosiatif / kamus dengan variabel dan nilai-nilai mereka) baik untuk kode kompiler dan untuk kode akhir dari program yang dikompilasi.  Ini memungkinkan Anda untuk mendefinisikan makro pada waktu kompilasi. <br></li><li>  Karena lingkungan tersedia pada waktu kompilasi, pada awalnya Malcc menangkap kesalahan yang <i>tidak terdefinisi</i> selama kompilasi (akses ke variabel yang tidak didefinisikan), dan di beberapa tempat ini melanggar harapan suite uji.  Pada akhirnya, untuk lulus tes, saya mematikan fitur ini.  Akan sangat bagus untuk menambahkannya kembali sebagai flag tambahan dari kompiler, karena dengan cara ini Anda dapat menangkap banyak kesalahan sebelumnya. </li><li>  Saya menyusun kode C dengan menulis dalam tiga baris struktur: <ul><li>  <code>top</code> : kode tingkat atas - inilah fungsinya </li><li>  <code>decl</code> : deklarasi dan inisialisasi variabel yang digunakan dalam tubuh </li><li>  <code>body</code> : tubuh di mana pekerjaan utama dilakukan </li></ul></li><li>  Sepanjang hari saya bertanya-tanya apakah saya bisa menulis pengumpul sampah saya sendiri, tetapi saya memutuskan untuk meninggalkan latihan ini untuk nanti.  Perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pengumpulan sampah Boehm-Demers-Weiser</a> mudah disambungkan dan tersedia di banyak platform. <br></li><li>  Penting untuk melihat kode yang ditulis oleh kompiler Anda.  Setiap kali kompiler menemukan variabel lingkungan <code>DEBUG</code> , ia mengembalikan kode C yang dikompilasi di mana kesalahan dapat dilihat. </li></ol><br><h1>  Apa yang akan saya lakukan sebaliknya </h1><br><ol><li>  Menulis kode C dan berusaha menjaga lekukan itu tidak mudah, maka saya tidak akan menolak otomatisasi.  Tampaknya bagi saya bahwa beberapa kompiler menulis kode jelek, dan kemudian perpustakaan khusus "menghiasi" sebelum mengeluarkannya.  Itu perlu dipelajari! <br></li><li>  Menambahkan ke baris selama pembuatan kode agak berantakan.  Anda dapat mempertimbangkan untuk membuat AST dan kemudian mengubahnya ke baris terakhir dari kode C. Ini harus membawa kode dalam urutan dan memberikan harmoni. </li></ol><br><a name="1"></a><h1>  Sekarang saran </h1><br>  Saya suka itu butuh hampir satu dekade untuk kompiler.  Tidak benar  Setiap langkah di jalan adalah memori yang menyenangkan tentang bagaimana saya secara bertahap menjadi programmer yang lebih baik. <br><br>  Tetapi ini tidak berarti bahwa saya "selesai".  Masih ada ratusan metode dan alat yang perlu Anda pelajari untuk merasa seperti penulis kompiler yang sebenarnya.  Tetapi saya dapat dengan yakin mengatakan: "Saya melakukannya." <br><br>  Inilah keseluruhan proses dalam bentuk ringkas, cara membuat kompilator Lisp Anda sendiri: <br><br><ol><li>  Pilih bahasa di mana Anda merasa nyaman.  Anda tidak ingin secara bersamaan mempelajari bahasa baru dan bagaimana menulis bahasa baru lainnya. <br></li><li>  Dengan mengikuti <a href="">panduan Mal,</a> tulislah seorang penerjemah. <br></li><li>  Bersukacitalah! <br></li><li>  Ikuti instruksi lagi, tetapi alih-alih mengeksekusi kode, tulis kode yang mengeksekusi kode.  (Bukan hanya "refactoring" penerjemah yang ada. Anda harus mulai dari awal, meskipun copy-paste tidak dilarang). </li></ol><br>  Saya percaya bahwa metode ini dapat digunakan dengan bahasa pemrograman apa pun yang dikompilasi menjadi file yang dapat dieksekusi.  Misalnya, Anda dapat: <br><br><ol><li>  Tuliskan penerjemah Bahasa Mal saat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pergi</a> . </li><li>  Ubah kode Anda menjadi: <br><ul><li>  buat baris kode Go dan tulis ke file; </li><li>  kompilasi file yang dihasilkan ini dengan <code>go build</code> . </li></ul></li></ol><br>  Idealnya, lebih baik mengontrol kompiler Go sebagai pustaka, tetapi ini juga merupakan cara untuk membuat kompiler! <br><br>  Dengan bantuan pemandu Mal dan kecerdikan Anda, Anda dapat melakukan semua ini.  Jika saya bisa, maka Anda bisa! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446808/">https://habr.com/ru/post/id446808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446794/index.html">Kami bekerja dengan Wordstat dengan benar. Panduan lengkap</a></li>
<li><a href="../id446796/index.html">Sirkuit tidak standar: indikator tujuh segmen pada ATtiny13</a></li>
<li><a href="../id446798/index.html">Kepergian seorang insinyur elektronik dari Apple menyebabkan kegemparan di antara para spekulan saham. Bagaimana menjadi seperti dia?</a></li>
<li><a href="../id446802/index.html">Refill Dot Cartridges - Sangat Menarik</a></li>
<li><a href="../id446806/index.html">Latar Belakang: "Runet Autonomous" - apa itu dan siapa yang membutuhkannya</a></li>
<li><a href="../id446810/index.html">Jika Anda memiliki sebungkus rokok di saku Anda ...</a></li>
<li><a href="../id446812/index.html">Mobilitas dan keramahan lingkungan: bagaimana troli modern dapat naik tanpa troli</a></li>
<li><a href="../id446816/index.html">OOP, "Holy Trinity" dan SOLID: sedikit pengetahuan tentang mereka</a></li>
<li><a href="../id446818/index.html">Venus, Bulan, selanjutnya di mana-mana: wawancara dengan Pavel Shubin</a></li>
<li><a href="../id446820/index.html">Webinar - Otentikasi dan ES di lingkungan VDI menggunakan thin client Dell dan dongle JaCarta</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>