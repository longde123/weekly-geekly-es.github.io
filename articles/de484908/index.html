<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ» ğŸ§œğŸ¾ ğŸ‘©ğŸ¼â€âœˆï¸ HighLoad ++, Eugene Kuzovlev (EcommPay IT): Was tun, wenn eine Minute Ausfallzeit 100.000 US-Dollar kostet? ğŸ‘¨ğŸ½â€ğŸ¤ ğŸš¿ ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alle reden von Entwicklungs- und Testprozessen, Mitarbeiterschulung und zunehmender Motivation, aber es gibt nur wenige Prozesse, bei denen eine Minut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Eugene Kuzovlev (EcommPay IT): Was tun, wenn eine Minute Ausfallzeit 100.000 US-Dollar kostet?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/484908/"> Alle reden von Entwicklungs- und Testprozessen, Mitarbeiterschulung und zunehmender Motivation, aber es gibt nur wenige Prozesse, bei denen eine Minute Ausfallzeit Platz kostet.  Was ist zu tun, wenn Sie Finanztransaktionen unter einem engen SLA durchfÃ¼hren?  Wie kÃ¶nnen Sie die ZuverlÃ¤ssigkeit und Fehlertoleranz Ihrer Systeme erhÃ¶hen und die Entwicklung und das Testen erlÃ¤utern? <br><br><img src="https://habrastorage.org/webt/dz/-p/tn/dz-ptnygkaqhxsm07hgsfil2fxq.jpeg"><br><br>  Die nÃ¤chste HighLoad ++ Konferenz findet am 6. und 7. April 2020 in St. Petersburg statt.  Details und Tickets <a href="http://bit.ly/2sSxgBx">hier</a> .  9. November, 18:00 Uhr.  HighLoad ++ Moskau 2018, Delhi + Calcutta Hall.  Abstracts und <a href="http://www.highload.ru/moscow/2018/abstracts/4226">PrÃ¤sentation</a> . <a name="habracut"></a><br><br>  <b>Evgeny Kuzovlev (im Folgenden als die EG bezeichnet):</b> - Freunde, hallo!  Ich heiÃŸe Kuzovlev Evgeny.  Ich bin von EcommPay, eine spezielle Abteilung ist EcommPay IT, eine IT-Abteilung einer Unternehmensgruppe.  Und heute werden wir Ã¼ber Ausfallzeiten sprechen - wie man sie vermeidet, wie man ihre Folgen minimiert, wenn man sie nicht vermeiden kann.  Das Thema lautet: "Was tun, wenn eine Minute Ausfallzeit 100.000 US-Dollar kostet?"  FÃ¼r uns sind die Zahlen in der Zukunft vergleichbar. <br><br><h3>  Was macht EcommPay IT? </h3><br>  Wer sind wir  Warum stehe ich vor dir?  Warum darf ich Ihnen hier etwas sagen?  Und worÃ¼ber werden wir hier ausfÃ¼hrlicher sprechen? <br><br><img src="https://habrastorage.org/webt/id/bv/so/idbvsod8gah5mhw25b4pnidb8d4.jpeg"><br><br>  Die EcommPay-Unternehmensgruppe ist ein internationaler Erwerber.  Wir verarbeiten Zahlungen weltweit - in Russland, Europa, SÃ¼dostasien (auf der ganzen Welt).  Wir haben 9 BÃ¼ros mit insgesamt 500 Mitarbeitern, von denen etwas weniger als die HÃ¤lfte IT-Spezialisten sind.  Alles, was wir tun, alles, womit wir Geld verdienen, haben wir selbst gemacht. <br><br>  Wir haben alle unsere Produkte (und wir haben viele davon - im Bereich der groÃŸen IT-Produkte haben wir ungefÃ¤hr 16 verschiedene Komponenten) selbst geschrieben.  wir schreiben uns selbst, wir entwickeln uns.  Und im Moment fÃ¼hren wir ungefÃ¤hr eine Million Transaktionen pro Tag durch (Millionen - wahrscheinlich wird es richtig sein, das zu sagen).  Wir sind ein junges Unternehmen genug - wir sind erst etwa sechs Jahre alt. <br><br>  Vor 6 Jahren war es so ein Startup, als die Jungs mit dem GeschÃ¤ft kamen.  Sie waren durch eine Idee verbunden (es gab nichts anderes als eine Idee) und wir rannten los.  Wie jedes Startup liefen wir schneller ... FÃ¼r uns war Geschwindigkeit wichtiger als QualitÃ¤t. <br><br>  Irgendwann hÃ¶rten wir auf: Wir stellten fest, dass wir nicht mehr mit dieser Geschwindigkeit und QualitÃ¤t leben konnten, und wir mussten in erster Linie QualitÃ¤t machen.  Zu diesem Zeitpunkt haben wir beschlossen, eine neue Plattform zu schreiben, die richtig, skalierbar und zuverlÃ¤ssig ist.  Sie haben angefangen, diese Plattform zu schreiben (sie haben angefangen zu investieren, zu entwickeln, zu testen), aber irgendwann haben sie gemerkt, dass Entwicklung und Testen kein neues Niveau an ServicequalitÃ¤t ermÃ¶glichen. <br><br>  Sie stellen ein neues Produkt her, Sie stellen es fÃ¼r die Produktion bereit, aber irgendwo stimmt etwas nicht.  Und heute werden wir darÃ¼ber sprechen, wie wir ein neues qualitatives Niveau erreichen (wie wir es erlangt haben, Ã¼ber unsere Erfahrung), die Entwicklung und das Testen aus dem Bild herausnehmen;  Wir werden darÃ¼ber sprechen, was fÃ¼r eine Nutzung verfÃ¼gbar ist - was die Nutzung fÃ¼r sich allein leisten kann, was sie zum Testen anbieten kann, um die QualitÃ¤t zu beeintrÃ¤chtigen. <br><br><h3>  Ausfallzeiten.  Die Gebote der Ausbeutung. </h3><br>  Der wichtigste Eckpfeiler, Ã¼ber den wir heute sprechen werden, sind immer die Ausfallzeiten.  Furchterregendes Wort.  Wenn wir eine Ausfallzeit hatten, ist bei uns alles schlecht.  Wir rennen, um zu erhÃ¶hen, die Administratoren halten den Server - Gott bewahre, es fÃ¤llt nicht, wie in diesem Lied.  DarÃ¼ber werden wir heute sprechen. <br><br><img src="https://habrastorage.org/webt/7w/nd/t8/7wndt8zz0lal9gvkglnu8zcc-fw.jpeg"><br><br>  Als wir begannen, unsere Herangehensweisen zu Ã¤ndern, bildeten wir 4 Gebote.  Sie sind auf meinen Folien dargestellt: <br><br>  Diese Gebote sind einfach genug: <br><br><img src="https://habrastorage.org/webt/kr/vd/zr/krvdzr268yzpyvwaf3_4fgatwrg.jpeg"><br><br><ul><li>  Identifizieren Sie das Problem schnell. </li><li>  Werde es noch schneller los. </li><li>  ErklÃ¤ren Sie den Grund (spÃ¤ter fÃ¼r Entwickler). </li><li>  Und AnsÃ¤tze standardisieren. </li></ul><br>  Ich mache Sie auf Punkt 2 aufmerksam. Wir beseitigen das Problem, aber lÃ¶sen es nicht.  Zu entscheiden ist das zweite Mal.  Das Wichtigste fÃ¼r uns ist, dass der Benutzer vor diesem Problem geschÃ¼tzt ist.  Es wird in einer bestimmten isolierten Umgebung existieren, aber diese Umgebung wird nicht damit in Kontakt kommen.  TatsÃ¤chlich werden wir diese vier Problemgruppen durchgehen (einige detaillierter, andere weniger detailliert). Ich werde Ihnen sagen, was wir verwenden, welche Art von Erfahrung wir beim LÃ¶sen haben. <br><br><h3>  Fehlerbehebung: wann und was tun mit ihnen? </h3><br>  Aber wir werden auÃŸer Betrieb gehen, wir beginnen mit Punkt 2 - wie kann das Problem schnell behoben werden?  Es gibt ein Problem - wir mÃ¼ssen es beheben.  "Was sollen wir damit machen?" Ist die Hauptfrage.  Und als wir darÃ¼ber nachdachten, wie wir das Problem beheben kÃ¶nnen, haben wir einige Anforderungen entwickelt, denen die Fehlerbehebung folgen sollte. <br><br><img src="https://habrastorage.org/webt/oq/ch/1z/oqch1zstieolkejut_t01rbzokw.jpeg"><br><br>  Um diese Anforderungen zu formulieren, haben wir uns die Frage gestellt: â€Und wann haben wir Probleme?â€œ.  Wie sich herausstellte, treten die Probleme in vier FÃ¤llen auf: <br><br><img src="https://habrastorage.org/webt/ks/kw/zm/kskwzmylqshsejm96u-bxngu1uq.jpeg"><br><br><ul><li>  Hardware-StÃ¶rung. </li><li>  Ausfall externer Dienste. </li><li>  Ã„nderung der Softwareversion (gleiches Deployment). </li><li>  Explosives Lastwachstum. </li></ul><br>  Wir werden nicht Ã¼ber die ersten beiden reden.  Eine HardwarestÃ¶rung ist ganz einfach zu beheben: Sie sollten alles duplizieren lassen.  Wenn es sich um DatentrÃ¤ger handelt - DatentrÃ¤ger mÃ¼ssen in RAID zusammengestellt werden, wenn es sich um einen Server handelt - der Server muss dupliziert werden, wenn Sie Ã¼ber eine Netzwerkinfrastruktur verfÃ¼gen - Sie mÃ¼ssen eine zweite Kopie der Netzwerkinfrastruktur erstellen, dh, Sie mÃ¼ssen sie kopieren und duplizieren.  Und wenn bei Ihnen etwas ausfÃ¤llt, wechseln Sie zu KapazitÃ¤tsreserven.  Es ist schwer, hier mehr zu sagen. <br><br>  Das zweite Problem ist der Ausfall externer Dienste.  FÃ¼r die meisten ist das System Ã¼berhaupt kein Problem, aber fÃ¼r uns nicht.  Da wir Zahlungen verarbeiten, sind wir ein solcher Aggregator, der zwischen dem Benutzer (der seine Kartendaten eingibt) und Banken, Zahlungssystemen ("Visa", "MasterCard", "World") derselben steht.  Unsere externen Dienstleistungen (Zahlungssysteme, Banken) fallen tendenziell aus.  Weder wir noch Sie (wenn Sie solche Dienste in Anspruch nehmen) kÃ¶nnen dies beeinflussen. <br><br>  Was ist dann zu tun?  Es gibt zwei MÃ¶glichkeiten.  Wenn Sie kÃ¶nnen, mÃ¼ssen Sie diesen Dienst zunÃ¤chst auf irgendeine Weise duplizieren.  Wenn wir kÃ¶nnen, Ã¼bertragen wir beispielsweise Verkehr von einem Dienst zu einem anderen: Wir verarbeiten beispielsweise Karten Ã¼ber die Sberbank, die Sberbank hat Probleme - wir Ã¼bertragen Verkehr [bedingt] an Raiffeisen.  Das zweite, was wir tun kÃ¶nnen, ist, das Versagen externer Dienste schnell zu bemerken, und deshalb werden wir im nÃ¤chsten Teil des Berichts Ã¼ber die Reaktionsgeschwindigkeit sprechen. <br><br>  TatsÃ¤chlich kÃ¶nnen wir von diesen vier speziell die Ã„nderung von Softwareversionen beeinflussen, um MaÃŸnahmen zu ergreifen, die zu einer Verbesserung im Kontext von Bereitstellungen und im Kontext von explosivem Lastwachstum fÃ¼hren.  Eigentlich haben wir es geschafft.  Hier nochmal eine kleine Bemerkung ... <br><br>  Von diesen vier Problemen sind einige sofort gelÃ¶st, wenn Sie eine Wolke haben.  Wenn Sie sich in den Microsoft Azhur, Ozone Clouds befinden und unsere Clouds von Yandex oder Mail verwenden, wird zumindest eine Hardwarefehlfunktion zu ihrem Problem, und im Kontext einer Hardwarefehlfunktion wird sofort alles zum Guten. <br><br>  Wir sind ein kleines Unternehmen, das nicht dem Standard entspricht.  Hier spricht jeder von Kubernets, von Wolken - wir haben weder Kubernets noch Wolken.  Aber wir haben in vielen Rechenzentren Racks mit Eisen, und wir sind gezwungen, von diesem Eisen zu leben, wir sind gezwungen, fÃ¼r alles zu antworten.  Deshalb werden wir uns in diesem Zusammenhang unterhalten.  Also, Ã¼ber die Probleme.  Die ersten beiden sind nicht in Klammern. <br><br><h3>  Softwareversion Ã¤ndern.  Grundlagen </h3><br>  Unsere Entwickler haben keinen Zugang zur Produktion.  Warum so?  Wir sind jedoch einfach von PCI DSS zertifiziert, und unsere Entwickler haben einfach nicht das Recht, in die "Prod" zu steigen.  Das war's, Punkt.  Absolut.  Daher endet die Entwicklungsverantwortung genau zu dem Zeitpunkt, an dem die Entwicklung den Build an das Release Ã¼bergeben hat. <br><br><img src="https://habrastorage.org/webt/ze/bp/su/zebpsueilk7pvkhrsqwn-0nrfko.jpeg"><br><br>  Unsere zweite Basis, die wir haben und die uns auch sehr hilft, ist der Mangel an einzigartigem, undokumentiertem Wissen.  Ich hoffe du machst das selbe.  Denn wenn dies nicht der Fall ist, werden Sie Probleme haben.  Probleme entstehen, wenn dieses einzigartige, undokumentierte Wissen nicht zur richtigen Zeit am richtigen Ort vorhanden ist.  Angenommen, Sie haben eine Person, die weiÃŸ, wie man eine bestimmte Komponente einsetzt - es gibt keine Person, sie ist im Urlaub oder sie wurde krank - das ist alles, Sie haben Probleme. <br><br>  Und die dritte Basis, zu der wir gekommen sind.  Wir sind durch Schmerz, Blut und TrÃ¤nen zu ihm gekommen - wir sind zu dem Schluss gekommen, dass jeder unserer Builds Fehler enthÃ¤lt, auch wenn er fehlerfrei ist.  Wir haben das fÃ¼r uns selbst entschieden: Wenn wir etwas bereitstellen, wenn wir etwas in das Produkt rollen, haben wir einen Build mit Fehlern.  Wir haben uns die Anforderungen gebildet, die unser System erfÃ¼llen muss. <br><br><h3>  Softwareversions-Ã„nderungsanforderungen </h3><br>  Es gibt drei dieser Anforderungen: <br><br><img src="https://habrastorage.org/webt/ou/qm/ma/ouqmmajckkplivqpqoiuwsvs3hs.jpeg"><br><br><ul><li>  Wir mÃ¼ssen die Bereitstellung schnell zurÃ¼cksetzen. </li><li>  Wir mÃ¼ssen die Auswirkungen einer nicht erfolgreichen Bereitstellung minimieren. </li><li>  Und wir mÃ¼ssen in der Lage sein, schnell parallel zu bleiben. <br>  In dieser Reihenfolge!  Warum?  Denn vor allem bei der Bereitstellung der neuen Version ist die Geschwindigkeit unwichtig, aber es ist wichtig, dass Sie bei einem Fehler schnell ein Rollback durchfÃ¼hren und minimale Auswirkungen haben.  Wenn Sie jedoch eine Reihe von Versionen in der Produktion haben, fÃ¼r die sich herausstellte, dass ein Fehler vorliegt (wie bei Schnee auf Ihrem Kopf gab es keine Bereitstellung, aber der Fehler ist enthalten), ist die Geschwindigkeit der nachfolgenden Bereitstellung fÃ¼r Sie wichtig.  Was haben wir getan, um diese Anforderungen zu erfÃ¼llen?  Wir haben auf eine solche Methodik zurÃ¼ckgegriffen: <br><br><img src="https://habrastorage.org/webt/bx/xn/9h/bxxn9hd10bckeqbycqanabweery.jpeg"><br><br>  Es ist bekannt, dass wir nicht einmal erfunden haben - das ist Blue / Green Deploy.  Was ist das?  Sie benÃ¶tigen eine Kopie fÃ¼r jede Servergruppe, auf der Ihre Anwendungen installiert sind.  Die Kopie ist "warm": Es ist kein Datenverkehr vorhanden, dieser Datenverkehr kann jedoch jederzeit an diese Kopie gesendet werden.  Diese Kopie enthÃ¤lt die vorherige Version.  Und zum Zeitpunkt der Bereitstellung rollen Sie den Code in eine inaktive Kopie aus.  Schalten Sie dann einen Teil des Datenverkehrs (oder alles) auf die neue Version um.  Um den Verkehrsfluss von der alten auf die neue Version zu Ã¤ndern, mÃ¼ssen Sie nur eine Aktion ausfÃ¼hren: Sie mÃ¼ssen den Balancer im Upstream Ã¤ndern, die Richtung Ã¤ndern - von einem Upstream zum anderen.  Dies ist sehr praktisch und lÃ¶st das Problem des schnellen Umschaltens und schnellen Rollbacks. <br><br>  Hier lautet die LÃ¶sung fÃ¼r die zweite Frage Minimierung: Sie kÃ¶nnen nur einen Teil Ihres Datenverkehrs in eine neue Zeile mit einem neuen Code einfÃ¼gen (beispielsweise 2%).  Und diese 2% - sie sind nicht 100%!  Wenn Sie wÃ¤hrend einer nicht erfolgreichen Bereitstellung 100% des Datenverkehrs verloren haben - dies ist beÃ¤ngstigend, wenn Sie 2% des Datenverkehrs verloren haben - ist dies unangenehm, aber es ist nicht beÃ¤ngstigend.  DarÃ¼ber hinaus werden Benutzer dies hÃ¶chstwahrscheinlich nicht einmal bemerken, da in einigen FÃ¤llen (nicht allen) derselbe Benutzer durch DrÃ¼cken von F5 zu einer anderen Arbeitsversion weitergeleitet wird. <br><br><h3>  Blau / GrÃ¼n entfalten.  Routing </h3><br>  DarÃ¼ber hinaus ist nicht alles so einfach â€Blue / Green Deployâ€œ ... Alle unsere Komponenten kÃ¶nnen in drei Gruppen unterteilt werden: <br><br><ul><li>  Dies ist das Frontend (Zahlungsseiten, die unsere Kunden sehen); </li><li>  Verarbeitungskern; </li><li>  ein Adapter fÃ¼r die Arbeit mit Zahlungssystemen (Banken, MasterCard, Visa ...). </li></ul><br>  Und es gibt eine Nuance - die Nuance ist das Routing zwischen den Zeilen.  Wenn Sie einfach 100% des Datenverkehrs schalten, haben Sie diese Probleme nicht.  Wenn Sie jedoch 2% wechseln mÃ¶chten, beginnen die Fragen: â€Wie geht das?â€œ Das Einfachste auf der Stirn: Sie kÃ¶nnen Round Robin in Nginx nach dem Zufallsprinzip auswÃ¤hlen und haben 2% Ã¼brig, 98%. - nach rechts.  Das ist aber nicht immer passend. <br><br>  Hier interagiert der Benutzer beispielsweise in mehr als einer Anforderung mit dem System.  Dies ist normal: 2, 3, 4, 5 Abfragen - Ihre Systeme sind mÃ¶glicherweise identisch.  Und wenn es fÃ¼r Sie wichtig ist, dass alle Benutzeranforderungen in die gleiche Zeile wie die erste Anforderung eingehen, oder (im zweiten Moment) alle Benutzeranforderungen nach dem Wechsel in eine neue Zeile eingehen (er kÃ¶nnte vor dem Wechsel frÃ¼her mit dem System arbeiten), - dann passt diese zufÃ¤llige Verteilung nicht zu dir.  Dann gibt es folgende MÃ¶glichkeiten: <br><br><img src="https://habrastorage.org/webt/hs/3f/fq/hs3ffqgbcy8wu3lzopom58r6tlm.jpeg"><br><br>  Die erste Option, die einfachste - basierend auf den Grundparametern des Clients (IP Hash).  Sie haben eine IP und teilen diese von rechts nach links.  Dann funktioniert der zweite von mir beschriebene Fall fÃ¼r Sie, wenn eine Bereitstellung stattgefunden hat, der Benutzer bereits mit Ihrem System arbeiten konnte und ab dem Zeitpunkt der Bereitstellung werden alle Anforderungen an eine neue Zeile weitergeleitet (z. B. an dieselbe). <br><br>  Wenn dies aus irgendeinem Grund nicht zu Ihnen passt und Sie Anforderungen an die Leitung senden mÃ¼ssen, an die die primÃ¤re, vertraute Anforderung des Benutzers gesendet wurde, haben Sie zwei MÃ¶glichkeiten: <br>  Die erste Option: Sie kÃ¶nnen bezahltes Nginx + nehmen.  Es gibt einen Sticky-Session-Mechanismus, der auf erste Anforderung des Benutzers eine Sitzung fÃ¼r den Benutzer freigibt und an einen bestimmten Upstream bindet.  Alle nachfolgenden Benutzeranforderungen wÃ¤hrend der gesamten Sitzungsdauer werden an den Upstream weitergeleitet, an dem die Sitzung eingerichtet wurde. <br><br>  Das hat uns nicht gepasst, da wir schon Nginx Normal hatten.  Nginx + zu wechseln ist nicht so teuer, es war nur ein bisschen schmerzhaft fÃ¼r uns und nicht sehr richtig.  Zum Beispiel hat "Sticks Sessions" nicht funktioniert, weil "Sticks Sessions" keine MÃ¶glichkeit bieten, auf der Basis von "Eli-or" zu routen.  Dort kÃ¶nnen Sie festlegen, was wir als "Sticky Sessions" bezeichnen, zum Beispiel nach IP oder nach IP und nach Cookie oder nach Post-Parameter, aber "Eli-or" ist dort schon komplizierter. <br><br>  Daher kamen wir zur vierten Option.  Wir haben Nginx auf "Steroide" angewendet (dies ist offen) - dies ist das gleiche Nginx, das zusÃ¤tzlich das EinfÃ¼gen von letzten Skripten unterstÃ¼tzt.  Sie kÃ¶nnen ein letztes Skript schreiben, dieses "Ã¶ffnen", und dieses letzte Skript wird ausgefÃ¼hrt, wenn eine Benutzeranforderung eintrifft. <br><br>  Und wir haben in der Tat ein solches Skript geschrieben, uns "openrest" gesetzt und in diesem Skript 6 verschiedene Parameter fÃ¼r die Verkettung von "Or" sortiert.  AbhÃ¤ngig von der VerfÃ¼gbarkeit dieses oder jenes Parameters wissen wir, dass der Benutzer zu einer Seite oder zu einer anderen, zu einer Zeile oder zu einer anderen gekommen ist. <br><br><h3>  Blau / GrÃ¼n entfalten.  Vor- und Nachteile </h3><br>  NatÃ¼rlich kÃ¶nnten Sie es wahrscheinlich etwas einfacher machen (verwenden Sie die gleichen "Sticky Sessions"), aber wir haben immer noch eine solche Nuance, dass nicht nur der Benutzer mit uns im Rahmen einer Abwicklung einer Transaktion interagiert ... Aber Zahlungssysteme interagieren auch mit uns: Nachdem wir die Transaktion bearbeitet haben (durch Senden einer Anfrage an das Zahlungssystem), erhalten wir einen RÃ¼ckruf. <br>  Und wenn wir in unserer Schaltung die IP-Adresse des Benutzers in allen Anfragen Ã¼berspringen und Benutzer basierend auf der IP-Adresse trennen kÃ¶nnen, werden wir nicht dasselbe "Visa" sagen: "Leute, wir sind so ein Retro-Unternehmen, wir sind ein bisschen international (auf der Website und im Internet) Of Russia) ... Und bitte geben Sie die IP-Adresse des Benutzers in ein zusÃ¤tzliches Feld ein, Ihr Protokoll ist standardisiert! â€œ  Klares GeschÃ¤ft, werden sie nicht zustimmen. <br><br><img src="https://habrastorage.org/webt/he/5o/-w/he5o-wivis5fucv4e7_1wn1qz3y.jpeg"><br><br>  Deshalb passte es fÃ¼r uns nicht - wir machten openresty.  Dementsprechend haben wir mit dem Routing folgendes erhalten: <br><br>  Das Blue / Green Deploy hat die Vorteile, Ã¼ber die ich gesprochen habe, und die Nachteile. <br><br>  Nachteil zwei: <br><br><ul><li>  Sie mÃ¼ssen sich um das Routing kÃ¼mmern. </li><li>  Der zweite Hauptnachteil sind die Kosten. </li></ul><br>  Sie benÃ¶tigen doppelt so viele Server, Sie benÃ¶tigen doppelt so viele Betriebsressourcen, Sie mÃ¼ssen doppelt so viel Aufwand aufwenden, um den gesamten Zoo zu warten. <br><br>  Zu den Vorteilen gehÃ¶rt Ã¼brigens noch etwas, das ich noch nicht erwÃ¤hnt habe: Sie haben eine Reserve fÃ¼r den Fall einer LadungserhÃ¶hung.  Wenn Sie einen explosiven Anstieg der Auslastung verzeichnen und eine groÃŸe Anzahl von Benutzern auf Sie zugegriffen haben, fÃ¼gen Sie einfach die zweite Zeile in die 50- bis 50-Verteilung ein - und Sie haben sofort 2 Server in Ihrem Cluster, bis Sie das Problem gelÃ¶st haben, dass Sie noch Server haben. <br><br><h3>  Wie erstelle ich eine schnelle Bereitstellung? </h3><br>  Wir haben darÃ¼ber gesprochen, wie das Problem der Minimierung und des schnellen Rollbacks gelÃ¶st werden kann, aber die Frage bleibt: "Wie kann eine schnelle Bereitstellung erfolgen?" <br><br><img src="https://habrastorage.org/webt/vy/8l/xo/vy8lxokper6luvftog4okdvgbh4.jpeg"><br><br>  Hier ist kurz und einfach. <br><br><ul><li>  Sie mÃ¼ssen ein CD-System haben (Continuous Delivery) - ohne es nirgendwo.  Wenn Sie einen Server haben, kÃ¶nnen Sie mit Stiften stecken bleiben.  Wir haben natÃ¼rlich ungefÃ¤hr anderthalbtausend Server und 1.500 Griffe - wir kÃ¶nnen eine Abteilung in der GrÃ¶ÃŸe dieses Raums einrichten, um sie dann einzusetzen. </li><li>  Die Bereitstellung sollte parallel erfolgen.  Wenn Sie eine konsistente Bereitstellung haben, ist alles schlecht.  Ein Server ist normal, Sie werden den ganzen Tag anderthalbtausend Server bereitstellen. </li><li>  Auch dies ist zur Beschleunigung wahrscheinlich nicht mehr erforderlich.  Beim Desploey baut man normalerweise das Projekt auf.  Haben Sie ein Webprojekt, gibt es einen Front-End-Teil (Sie erstellen dort ein Webpaket, npm sammelt so etwas), und dieser Vorgang ist im Grunde kurzlebig - 5 Minuten, aber diese 5 Minuten kÃ¶nnen kritisch sein.  Daher tun wir dies beispielsweise nicht: Wir haben diese 5 Minuten entfernt und Artefakte bereitgestellt. <br><br>  Was ist ein Artefakt?  Ein Artefakt ist ein zusammengebauter Bau, in dem das gesamte Montageteil bereits fertiggestellt wurde.  Wir speichern dieses Artefakt in der Aufbewahrung von Artefakten.  Wir haben zwei solcher Speicher gleichzeitig verwendet - es war Nexus und jetzt jFrog Artifactory.) Wir haben den Nexus ursprÃ¼nglich verwendet, weil wir damit begonnen haben, diesen Ansatz in Java-Anwendungen zu Ã¼ben (er passte gut dazu).  Dann platzieren sie den Teil der von PHP geschriebenen Anwendungen dort;  und der Nexus war nicht mehr geeignet, weshalb wir uns fÃ¼r jFrog Artefactory entschieden haben, das fast alles verfÃ¤lschen kann.  Wir sind sogar auf die Tatsache gekommen, dass wir in dieser Speicherung von Artefakten unsere eigenen BinÃ¤rpakete speichern, die wir fÃ¼r Server sammeln. </li></ul><br><h3>  Explosives Lastwachstum </h3><br>  Wir sprachen Ã¼ber das Ã„ndern der Softwareversion.  Das nÃ¤chste, was wir haben, ist explosives Lastwachstum.  Hier verstehe ich wohl, dass das explosive Wachsen der Ladung nicht ganz das Richtige ist ... <br><br>  Wir haben ein neues System geschrieben - es ist serviceorientiert, modisch schÃ¶n, Ã¼berall Arbeiter, Ã¼berall Warteschlangen, Ã¼berall AsynchronitÃ¤t.  Und in solchen Systemen kÃ¶nnen Daten unterschiedlich flieÃŸen.  Bei der ersten Transaktion kann der 1., 3., 10. Mitarbeiter beteiligt sein, bei der zweiten Transaktion der 2., 4., 5. Mitarbeiter.  Nehmen wir heute an, Sie haben morgens einen Datenstrom, der die ersten drei Worker verwendet, und abends Ã¤ndert sich der Datenstrom dramatisch, und alle anderen drei Worker werden verwendet. <br><br>  Und hier stellt sich heraus, dass Sie die Mitarbeiter irgendwie skalieren mÃ¼ssen, Ihre Dienste irgendwie skalieren mÃ¼ssen, aber gleichzeitig das Aufblasen von Ressourcen verhindern mÃ¼ssen. <br><br><img src="https://habrastorage.org/webt/wg/1t/kr/wg1tkrnswlv954eaws3dj1ije_a.jpeg"><br><br>  Wir haben die Anforderungen fÃ¼r uns selbst festgelegt.    :    Service discovery,  â€“       ,    â€“   .  ,      ,    .   Â«Â»,   Â«Â»,    . <br><br>     ?    .       70  .      Â«Â»,  Â«Â» ,  ,        .    100   Â«Â»,        100     .         .  ,    â€“  24/7   ,      ,    ,  70   ,  . <br><br>     Â«Â»,     IP     Scale-Nomad â€“ ScaleNo,    :                 .  ,  : Â«  ?Â»     â€“  ,   . <br><br>        ,       ,  ,     ,    ,       â€“  , .     3-5  â€“   . <br><br><img src="https://habrastorage.org/webt/8z/ja/m0/8zjam0uickgtjt67yl6grtzfmao.jpeg"><br><br>  Wie funktioniert es  !  :       :   ,  â€“   ,   â€“  ,  â€“  . <br><br>  ,     .         45  â€“     .       2         ,     (    â€“ ,   ).     â€“    ,  5-10 ,    . <br><br>     Â«Â»,      ,  Â«Â»      .  ,    ,    â€“       .     .    â„– 2 â€“ Â«    Â». <br><br><h3> .    ? </h3><br>    â€“ Â«   ?Â» !      .      ? <br><br><img src="https://habrastorage.org/webt/md/xm/op/mdxmopdox-kznqvid9b4uesleeg.jpeg"><br><br>  ! <br><br><ul><li>           . </li><li>       ,   ,     . </li><li>   â€“   .      ,     ,   -  . </li></ul><br>  , ,     .   .  ,    .    Â« Â».       : <br><br><img src="https://habrastorage.org/webt/8w/1z/w4/8w1zw4dq1rwsz7e7dg7tp53wbke.jpeg"><br><br>   Â«Â»    Â«Â»,     . Â«Â»     . Â«Â»  Â«Â»      ,      ,   â€“  Â«Â»  Â«Â»,  â€“ Â«Â»  Â«Â»  Telegraf. <br><br>      New Relic.  ,   .     ,    .       1,5  ,    , : Â«     Â».    ,  ,     .    Â«-Â» ,    15     Â«-Â».    . <br><br>    ,     â€“  Debugger.     Â«Â»,       ,  ,    Â«Â».  Was ist das?  ,     15-30    ,  Â« Â» ,      . <br><br> ,    ( ) â€“      ,    .   ,    Â«Â» â€“ ,   Â«Â» .       â€“     ,  ,  ,     . <br><br><h3>     ? </h3><br>     ?     ? <br><br><img src="https://habrastorage.org/webt/8c/qe/tn/8cqetn3kfyedayuv9fwc8qpx4vq.jpeg"><br><br><ul><li> Response time / RPS   â€“   .   ,    -  . </li><li>      . </li><li>  . </li><li>   . </li></ul><br>   â€“ Â«Â», Â«Â» .       ,    - ,      .     â€“   (        ).    -    5-10-15  â€“ ,     (  ). <br><br>      â€“     : <br><br><img src="https://habrastorage.org/webt/73/xa/jg/73xajgyfx9xahrr_9hl3ysaapgw.jpeg"><br><br>    â€“ 6 ,     â€“       .    â€“ RPS, RTS.  â€“    Â«Â».   Â«Â»     ,  -       â€¦      ,    . <br><br> ,      â€“       .    OpenTracing â€“ , , ,     ;    .  OpenTracing-   ,       .     ,       , .  ,      ,   . <br><br><img src="https://habrastorage.org/webt/42/nw/5h/42nw5hrsai8-i8t3bnsclajtklw.jpeg"><br><br>   ,         3  â€“    .     ,   ,    20-30 . <br><br>     ,   â€“   . <br><br>  ,  ,     ,        ,   .   ,    . <br><br><img src="https://habrastorage.org/webt/d8/pz/1v/d8pz1vfzv9otccv6dsa-crqiuuu.jpeg"><br><br>      ? ,  :     (,  Â«Â»);   , .         ,   ,  â€¦      â€“        -.   ,   : Â«        Â»? <br><br>   â€¦       -,   ( )    ,      .    :       â€“ ,      ,     ( ).    ,    -        .     !      .         . <br><br>      ,    . <br><br><h3>     </h3><br>   ,    â€“   ,    ,  ,     ,      ,    -   . ,   ,   . <br><br><img src="https://habrastorage.org/webt/e2/kb/jz/e2kbjzy9w7wvv6kicbniocak4ac.jpeg"><br><br>      (  â€“ ),       ELK Stack â€“    .  -, ,   ELK,      ,       ELK.    . <br><br><img src="https://habrastorage.org/webt/_f/8a/3i/_f8a3ibc2i7os5pp3xot6m9_gxo.jpeg"><br><br>   .  ,    ,  ,     ,   Â«Â»,   id-       ( ).        .  Warum?    ,      ,      .      ,     â€“   OpenTracing,    . <br><br>     ,      ,      â€“  Â«Â» (Zipkin)  Â«Â» (Jaeger). Â«Â» â€“      ,   Â«Â».  Â«Â»  ,  ,     ,      ,   .  Â«Â»  . <br><br>   Â«Â»:   ,    Api ( Api  PHP   , ,    â€“   ,    ),     . Â«Â», â€“  ,    .    ?     : <br><br><img src="https://habrastorage.org/webt/uq/x2/mu/uqx2muumblbudpbjnuittfrsdkk.jpeg"><br><br>  Â«Â»     span'.  ,    ,           (1-2-3 â€“      ,   ).      ,        . ,          Error.     Error    ,      .    ,    span: <br><br><img src="https://habrastorage.org/webt/3e/is/fk/3eisfkpsc9mkuipyg-5iaob2d-y.jpeg"><br><br>     .       ,       ,   .        :    â€“  ,   ,            . <br><br> ,    .    ,    .      ,      Â«Â»   PHP â€“   , welcome to use,  : <br><br><img src="https://habrastorage.org/webt/q7/vi/pc/q7vipcgfujbggn_zt64r3h7foay.jpeg"><br><br>     â€“     OpenTracing Api,   php-extention,          .      .     ,   .   :     ,    extention up to you. <br><br><h3>   </h3><br>    .   â€“   .   ?    : <br><br><img src="https://habrastorage.org/webt/3h/ka/zo/3hkazonrypgjcuakfff1yrutxlc.jpeg"><br><br>    Â«Â»?        , !  Â«Â»       ,    ,        ,      .     ? <br><br><img src="https://habrastorage.org/webt/b7/h6/qa/b7h6qavqwtn9fm9bam0jbg07nym.jpeg"><br><br><ul><li>     .      ,  .    60   ,        .     , ,         â€“ ,   . </li><li>    .          ,     ,        RnD-.       ,      (,    ) ,    ,   . </li><li>     ,   â€“ ,     .       . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben Toleranzen. </font><font style="vertical-align: inherit;">Beispielsweise berÃ¼cksichtigen wir keine Ausfallzeiten, wenn innerhalb von zwei Minuten 2% des Datenverkehrs verloren gehen. </font><font style="vertical-align: inherit;">Dies fÃ¤llt grundsÃ¤tzlich nicht in unsere Statistik. </font><font style="vertical-align: inherit;">Wenn mehr in Prozent oder Zeit, zÃ¤hlen wir bereits.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wir schreiben immer post mortem. </font><font style="vertical-align: inherit;">Was auch immer mit uns passiert, jede Situation, in der es sich am Produktionsstandort unangemessen verhielt, spiegelt sich im Potsortem wider. </font><font style="vertical-align: inherit;">Ein Post-Mortem ist ein Dokument, in dem Sie aufschreiben, was mit Ihnen geschehen ist, den genauen Zeitpunkt, zu dem Sie das Problem behoben haben, und (dies ist ein obligatorischer Block!), Wie Sie verhindern, dass dies in Zukunft geschieht. </font><font style="vertical-align: inherit;">Dies ist fÃ¼r die nachfolgende Analyse notwendig.</font></font></li></ul><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Was sind Ausfallzeiten zu beachten? </font></font></h3><br><img src="https://habrastorage.org/webt/ad/8v/ye/ad8vyesevuqquvkj4rtf15hggd8.jpeg"><br><br>  Was hat das alles gebracht? <br><br>  Dies fÃ¼hrte dazu, dass unser StabilitÃ¤tsindikator in den letzten 6 Monaten (wir hatten bestimmte StabilitÃ¤tsprobleme, dies passte weder unseren Kunden noch uns) 99,97 betrug.  Wir kÃ¶nnen sagen, dass dies nicht sehr viel ist.  Ja, wir haben etwas anzustreben.  Etwa die HÃ¤lfte dieses Indikators ist sozusagen die StabilitÃ¤t, nicht unsere, sondern unsere Webanwendungs-Firewall, die vor uns steht und als Service verwendet wird, fÃ¼r Kunden jedoch keine Rolle spielt. <br><br>  Wir lernten nachts zu schlafen.  Endlich!  Vor sechs Monaten wussten wir nicht wie.  Und zu diesem Ergebnis mÃ¶chte ich noch eine Bemerkung machen.  Letzte Nacht gab es einen wunderbaren Bericht Ã¼ber ein Kontrollsystem fÃ¼r Kernreaktoren.  Wenn Leute, die dieses System geschrieben haben, mich hÃ¶ren, vergessen Sie bitte, was ich zu â€2% ist keine Ausfallzeitâ€œ gesagt habe.  2% sind fÃ¼r Sie Ausfallzeiten, auch wenn Sie zwei Minuten Zeit haben "! <br><br>  Das ist alles!  Deine Fragen. <br><br><img src="https://habrastorage.org/webt/us/ih/xg/usihxgshbsygnv59b5detm4js5m.jpeg"><br><br><h3>  Informationen zu Balancern und zur Datenbankmigration </h3><br>  Frage des Publikums (im Folgenden - B): - Guten Abend.  Vielen Dank fÃ¼r einen solchen Admin-Bericht!  Die Frage ist kurz zum Thema Ihrer Balancer.  Sie haben erwÃ¤hnt, dass Sie WAF haben, das heiÃŸt, wie ich es verstehe, Sie verwenden eine Art externen Balancer ... <br><br>  <b>:</b> - Nein, wir nutzen unsere Dienste als Balancer.  In diesem Fall ist WAF fÃ¼r uns ausschlieÃŸlich ein DDoS-Schutztool. <br><br>  <b>F:</b> - KÃ¶nnten Sie ein paar Worte zu Balancern sagen? <br><br>  <b>EK:</b> - Wie gesagt, das ist eine Gruppe von Servern in openresty.  Wir haben jetzt 5 Gruppen von redundanten, die ausschlieÃŸlich antworten ... das heiÃŸt, ein Server, auf dem ausschlieÃŸlich OpenResty ausgefÃ¼hrt wird und der nur den Datenverkehr Ã¼berwacht.  Um zu verstehen, wie viel wir halten: Wir haben jetzt einen regelmÃ¤ÃŸigen Verkehrsfluss - das sind mehrere hundert Megabits.  Sie schaffen es, sie fÃ¼hlen sich gut, sie belasten nicht einmal. <br><br>  <b>F:</b> - Auch eine einfache Frage.  Es gibt eine blau / grÃ¼ne Bereitstellung.  Und was machen Sie zum Beispiel mit Migrationen aus der Datenbank? <br><br>  <b>EK:</b> - Gute Frage!  Schauen Sie, wir in der blau / grÃ¼nen Bereitstellung haben separate Zeilen fÃ¼r jede Zeile.  Das heiÃŸt, wenn wir Ã¼ber die Ereignislinien sprechen, die vom Arbeiter zum Arbeiter Ã¼bertragen werden, gibt es separate Linien fÃ¼r die blaue Linie und die grÃ¼ne Linie.  Wenn wir Ã¼ber die Datenbank selbst sprechen, haben wir sie absichtlich eingegrenzt, da wir alles fast in eine Linie bringen kÃ¶nnten, wir haben nur einen Stapel von Transaktionen in der Datenbank.  Und wir haben einen einzigen Transaktionsstapel fÃ¼r alle Zeilen.  Bei einer Datenbank in diesem Kontext: Wir geben sie nicht fÃ¼r Blau und GrÃ¼n frei, da beide Versionen des Codes wissen sollten, was mit der Transaktion geschieht. <br><br>  Freunde, ich habe immer noch einen so kleinen Preis, der Sie anspornt - ein Buch.  Und ich muss sie fÃ¼r die beste Frage geben. <br><br>  <b>F:</b> - Hallo.  Danke fÃ¼r den Bericht.  Die Frage ist das.  Sie Ã¼berwachen Zahlungen, Sie Ã¼berwachen Dienste, mit denen Sie kommunizieren ... Aber wie Ã¼berwachen Sie, dass eine Person auf Ihre Zahlungsseite gelangt ist, eine Zahlung geleistet hat und das Projekt ihr Geld gutgeschrieben hat?  Das heiÃŸt, wie kÃ¶nnen Sie Ã¼berwachen, ob der HÃ¤ndler verfÃ¼gbar ist, und Ihren RÃ¼ckruf annehmen? <br><br>  <b>:</b> - "HÃ¤ndler" ist fÃ¼r uns in diesem Fall genau die gleiche externe Dienstleistung wie das Zahlungssystem.  Wir Ã¼berwachen die Reaktionsgeschwindigkeit des "Kaufmanns". <br><br><h3>  Informationen zur DatenbankverschlÃ¼sselung </h3><br>  <b>F:</b> - Hallo.  Ich habe eine kleine Frage.  Sie haben vertrauliche PCI-DSS-Daten.  Ich wollte wissen, wie Sie PANs in Warteschlangen speichern, in die Sie werfen mÃ¼ssen?  Verwenden Sie eine VerschlÃ¼sselung?  Und ab hier stellt sich die folgende zweite Frage: Auf PCI DSS muss die Datenbank bei Ã„nderungen (Entlassung von Administratoren usw.) regelmÃ¤ÃŸig neu verschlÃ¼sselt werden - wie geschieht dies mit der Barrierefreiheit? <br><br><img src="https://habrastorage.org/webt/0z/oh/29/0zoh293lif-ioxouzt79ui9j98a.jpeg"><br><br>  <b>EK:</b> - Wunderbare Frage!  Erstens speichern wir keine PANs in den Warteschlangen.  Wir haben grundsÃ¤tzlich kein Recht, PAN im Klartext zu speichern. Daher verwenden wir einen speziellen Dienst (wir nennen ihn â€Kademonâ€œ) - dies ist ein Dienst, der nur eines tut: Er empfÃ¤ngt eine Nachricht und sendet eine verschlÃ¼sselte Nachricht.  Und wir speichern alles mit dieser verschlÃ¼sselten Nachricht.  Dementsprechend liegt die SchlÃ¼ssellÃ¤nge fÃ¼r uns unter Kilobyte, so dass es direkt seriÃ¶s und zuverlÃ¤ssig ist. <br><br>  <b>F:</b> - BenÃ¶tigen Sie jetzt 2 Kilobyte? <br><br>  <b>EK:</b> - Es scheint, als wÃ¤re es gestern 256 gewesen ... Nun, wo sonst ?! <br><br>  Dementsprechend ist dies der erste.  Und zweitens unterstÃ¼tzt die vorhandene LÃ¶sung den Prozess der NeuverschlÃ¼sselung - es gibt zwei Paare von "Cakes" (SchlÃ¼sseln), die "Decks" zum VerschlÃ¼sseln geben (SchlÃ¼ssel sind SchlÃ¼ssel, dek sind Derivate von SchlÃ¼sseln, die verschlÃ¼sseln).  Und im Falle der Einleitung des Verfahrens (es findet regelmÃ¤ÃŸig von 3 Monaten bis Â± einigen Monaten statt) laden wir ein neues Paar â€Kuchenâ€œ hoch und lassen die Daten neu verschlÃ¼sseln.  Wir haben separate Dienste, die alle Daten herausreiÃŸen und auf neue Weise verschlÃ¼sseln.  Die Daten werden neben der SchlÃ¼sselkennung gespeichert, mit der sie verschlÃ¼sselt sind.  Dementsprechend lÃ¶schen wir den alten SchlÃ¼ssel, sobald wir Daten mit neuen SchlÃ¼sseln verschlÃ¼sselt haben. <br><br><h3>  Manchmal mÃ¼ssen Sie manuell bezahlen ... </h3><br>  <b>F:</b> - Das heiÃŸt, wenn fÃ¼r eine Operation eine RÃ¼ckgabe erfolgt ist, wird diese mit dem alten SchlÃ¼ssel entschlÃ¼sselt? <br><br>  <b>EG:</b> - Ja. <br><br>  <b>F:</b> - Dann noch eine kleine Frage.  Bei einem Ausfall, Sturz oder Vorfall muss die Transaktion im manuellen Modus verschoben werden.  Es gibt so eine Situation. <br><br>  <b>EK:</b> - Ja, das tut es. <br><br>  <b>F:</b> - Woher bekommen Sie diese Daten?  Oder gehst du selbst mit Stiften in diesen Laden? <br><br>  <b>EK:</b> - Nein, natÃ¼rlich - wir haben eine Art Backoffice-System, das eine Schnittstelle fÃ¼r unseren Support enthÃ¤lt.  Wenn wir nicht wissen, in welchem â€‹â€‹Status sich die Transaktion befindet (z. B., obwohl das Zahlungssystem nicht mit einer ZeitÃ¼berschreitung geantwortet hat), wissen wir nicht von vornherein, dh, wir weisen den endgÃ¼ltigen Status nur mit vollem Vertrauen zu.  In diesem Fall geben wir die Transaktion fÃ¼r die manuelle Verarbeitung in einen Sonderstatus.  Sobald der Support morgens am nÃ¤chsten Tag die Information erhÃ¤lt, dass solche Transaktionen im Zahlungssystem verbleiben, werden sie manuell in dieser Schnittstelle verarbeitet. <br><br><img src="https://habrastorage.org/webt/um/1e/qe/um1eqefsegdtcvv8gczvx2qe54o.jpeg"><br><br>  <b>F:</b> - Ich habe ein paar Fragen.  Eine davon ist die Fortsetzung der PCI-DSS-Zone: Wie erhalten Sie ihre Loop-Protokolle?  Eine solche Frage, weil der Entwickler alles in die Protokolle setzen kÃ¶nnte!  Zweite Frage: Wie rollen Sie Hotfixes aus?  Stifte in der Datenbank sind eine Option, aber mÃ¶glicherweise gibt es kostenlose Hotfixes - wie wird dort vorgegangen?  Und die dritte Frage bezieht sich wahrscheinlich auf RTO, RPO.  Ihre VerfÃ¼gbarkeit betrug 99,97, fast vier Neunen, aber meines Wissens haben Sie ein zweites Rechenzentrum, ein drittes Rechenzentrum und ein fÃ¼nftes Rechenzentrum ... Wie gehen Sie mit ihrer Synchronisation, Replikation und allem anderen um? <br><br>  <b>EK:</b> - Fangen wir mit dem ersten an.  Die erste Frage zu den Protokollen war?  Wenn wir Protokolle schreiben, haben wir eine Ebene, die alle vertraulichen Daten maskiert.  Sie schaut auf die Maske und die Zusatzfelder.  Dementsprechend werden unsere Protokolle mit bereits maskierten Daten und einer PCI-DSS-Schleife ausgegeben.  Dies ist eine der regulÃ¤ren Aufgaben, die der Testabteilung zugewiesen sind.  Sie sind verpflichtet, jede Aufgabe, einschlieÃŸlich der von ihnen erstellten Protokolle, zu Ã¼berprÃ¼fen. Dies ist eine der regulÃ¤ren Aufgaben bei der CodeÃ¼berprÃ¼fung, um zu Ã¼berprÃ¼fen, ob der Entwickler etwas nicht geschrieben hat.  Die spÃ¤tere ÃœberprÃ¼fung erfolgt regelmÃ¤ÃŸig durch die Informationssicherheitsabteilung etwa einmal pro Woche: Protokolle werden selektiv fÃ¼r den letzten Tag erstellt und von Testservern durch einen speziellen Scanner-Analysator gefÃ¼hrt, um dies zu Ã¼berprÃ¼fen. <br>  Ãœber Hotfixes.  Dies ist in unserem Bereitstellungsplan enthalten.  Wir haben einen separaten Punkt Ã¼ber Hotfixes.  Wir glauben, dass wir Hotfixes rund um die Uhr bereitstellen, wenn wir sie benÃ¶tigen.  Sobald die Version zusammengestellt ist, sobald sie ausgefÃ¼hrt wird und sobald wir das Artefakt haben, rufen wir den Systemadministrator vom Support an und er wird es in dem Moment bereitstellen, in dem es notwendig ist. <br><br>  Ãœber die "vier Neunen".  Die Nummer, die wir jetzt haben, wurde tatsÃ¤chlich erreicht und wir haben sie in einem anderen Rechenzentrum gesucht.  Jetzt haben wir ein zweites Rechenzentrum, und wir beginnen, zwischen ihnen zu routen, und die Frage des datenÃ¼bergreifenden Replikationszentrums ist wirklich eine nicht triviale Frage.  Wir haben versucht, es mit verschiedenen Mitteln rechtzeitig zu lÃ¶sen: Wir haben versucht, dieselbe "Tarantel" zu verwenden - es hat bei uns nicht funktioniert, sage ich gleich.  Daher kamen wir zu der Tatsache, dass wir die Reihenfolge der "Sensation" manuell vornehmen.  Wir haben jede Anwendung tatsÃ¤chlich im asynchronen Modus der notwendigen Synchronisation "change - done" - Laufwerke zwischen Rechenzentren. <br><br>  <b>F:</b> - Wenn Sie eine zweite haben, warum nicht eine dritte?  Weil noch niemand ein gespaltenes Gehirn hat ... <br><br>  <b>:</b> - Und wir haben kein gespaltenes Gehirn.  Da jede Anwendung einen Multimaster steuert, spielt es fÃ¼r uns keine Rolle, an welches Zentrum die Anfrage gerichtet wurde.  Wir sind bereit fÃ¼r die Tatsache, dass wir im Falle eines Absturzes eines Rechenzentrums (wir legen darauf) und mitten in einer Benutzeranforderung, die auf ein zweites Rechenzentrum umgestellt wird, bereit sind, diesen Benutzer wirklich zu verlieren.  aber es werden Einheiten sein, absolute Einheiten. <br><br>  <b>F:</b> - Guten Abend.  Danke fÃ¼r den Bericht.  Sie haben Ã¼ber Ihren Debugger gesprochen, der einige Testtransaktionen in der Produktion steuert.  ErzÃ¤hlen Sie uns doch etwas Ã¼ber Testtransaktionen!  Wie tief geht es? <br><br>  <b>EG:</b> - Es durchlÃ¤uft den gesamten Zyklus des gesamten Bauteils.  Es gibt keine Unterschiede zwischen der Testtransaktion und der Kampftransaktion fÃ¼r die Komponente.  Und aus logischer Sicht handelt es sich nur um ein separates Projekt im System, bei dem nur Testtransaktionen verfolgt werden. <br><br>  <b>F:</b> - Und wo schneidest du es ab?  Also schickte Core ... <br><br>  <b>:</b> - Wir stehen in diesem Fall fÃ¼r <b>Testtransaktionen</b> hinter "Kor" ... Wir haben so etwas wie Routing: "Kor" weiÃŸ, an welches Zahlungssystem gesendet werden soll - wir senden an ein gefÃ¤lschtes Zahlungssystem, das einfach eine http-Antwort gibt und das ist alles . <br><br>  <b>F:</b> - Bitte sagen Sie mir, hatten Sie den Antrag in einem groÃŸen Monolithen geschrieben oder haben Sie ihn auf einige Dienste oder sogar Mikrodienste zugeschnitten? <br><br>  <b>:</b> - Wir haben keinen Monolithen, natÃ¼rlich haben wir eine serviceorientierte Anwendung.  Wir haben einen Witz, dass wir einen Service von Monolithen haben - sie sind wirklich ziemlich groÃŸ.  Das Aufrufen von Microservices in dieser Sprache Ã¤ndert nichts am Wort, aber dies sind die Services, in denen verteilte Maschinenarbeiter arbeiten. <br><br><h3>  Wenn der Dienst auf dem Server beeintrÃ¤chtigt ist ... </h3><br>  <b>F:</b> - Dann habe ich folgende Frage.  Selbst wenn es sich um einen Monolithen handelte, sagten Sie immer noch, dass Sie viele dieser Instant-Server haben, alle verarbeiten die Daten im Prinzip und die Frage lautet: â€Wenn einer der Instant-Server oder die Anwendung kompromittiert ist, ist eine bestimmte Verbindung gefÃ¤hrdet Haben sie irgendeine Art von Zugangskontrolle?  Welcher von ihnen kann was?  An wen kann man sich wenden, fÃ¼r welche Daten? <br><br><img src="https://habrastorage.org/webt/3j/qn/pt/3jqnpt1dfzhas9kn5de1qb6x1lq.jpeg"><br><br>  <b>EK:</b> - Ja natÃ¼rlich.  Die Sicherheitsanforderungen sind sehr ernst.  Erstens haben wir offenen Datenverkehr, und die HÃ¤fen sind nur die, auf denen wir den Verkehr im Voraus antizipieren.  Wenn die Komponente Ã¼ber 5-4-3-2 mit der Datenbank kommuniziert (z. B. "Muskul"), sind nur 5-4-3-2 und andere Ports fÃ¼r diese geÃ¶ffnet. Andere Verkehrsrichtungen sind nicht verfÃ¼gbar.  AuÃŸerdem mÃ¼ssen wir verstehen, dass wir in der Produktion ungefÃ¤hr 10 verschiedene Sicherheitsschleifen haben.  Und selbst wenn die Anwendung auf irgendeine Weise kompromittiert wurde, kann ein Angreifer nicht auf die Serververwaltungskonsole zugreifen, da dies eine weitere Netzwerksicherheitszone ist. <br><br>  <b>F:</b> - Und in diesem Zusammenhang interessiert es mich mehr, wenn Sie VertrÃ¤ge mit Dienstleistungen abgeschlossen haben - was kÃ¶nnen sie tun, Ã¼ber welche â€Aktionenâ€œ sie miteinander in Kontakt treten kÃ¶nnen ... Und im normalen Ablauf fragen einige bestimmte Dienstleistungen welche eine Reihe, eine Liste von "Aktion" auf einem anderen.  Sie scheinen sich in einer normalen Situation nicht an andere zu wenden, und sie haben andere Verantwortungsbereiche.  Wenn einer von ihnen kompromittiert ist, kann er dann die "Aktion" dieses Dienstes ausfÃ¼hren? <br><br>  <b>EK:</b> - Ich verstehe.  Wenn im Normalfall mit einem anderen Server die Kommunikation generell erlaubt war, dann ja.  Im Rahmen des SLA-Vertrags wird nicht Ã¼berwacht, dass Ihnen nur die ersten 3 "Aktionen" und 4 "Aktionen" nicht gestattet sind.  Dies ist fÃ¼r uns wahrscheinlich Ã¼berflÃ¼ssig, da wir im Prinzip ein 4-stufiges Schutzsystem fÃ¼r Stromkreise haben.  Wir verteidigen lieber mit Konturen als auf der Ebene der Innenseiten. <br><br><h3>  So funktionieren Visa, MasterCard und Sberbank </h3><br>  <b>F:</b> - Ich mÃ¶chte kurz erlÃ¤utern, wie ein Benutzer von einem Rechenzentrum zu einem anderen gewechselt wird.  Soweit ich weiÃŸ, arbeiten "Visa" und "MasterCard" mit dem binÃ¤ren Synchronprotokoll 8583, es gibt Mischungen.  Und ich wollte wissen, jetzt meine ich Umstellung - geht es direkt um "Visa" und "MasterCard" oder um Zahlungssysteme, um Abwicklungen? <br><br>  <b>EK:</b> - Es liegt an den Mischungen.  Mixe haben wir in einem Rechenzentrum. <br><br>  <b>F:</b> - Haben Sie grob gesagt einen Verbindungspunkt? <br><br>  <b>:</b> - "Vise" und "MasterCard" - ja.  Nur weil â€Visaâ€œ und â€MasterCardâ€œ ernsthafte Investitionen in die Infrastruktur erfordern, um separate VertrÃ¤ge abzuschlieÃŸen und beispielsweise ein zweites Mix-Paar zu erhalten.  Sie sind im Rahmen eines Rechenzentrums reserviert, aber wenn, Gott bewahre, das Rechenzentrum, in dem die Mischungen fÃ¼r die Verbindung mit "Visa" und "MasterCard" tot sind, dann haben wir eine Verbindung mit "Visa" und "MasterCard" verloren ... <br><br>  <b>F:</b> - Wie kÃ¶nnen sie reserviert werden?  Ich weiÃŸ, dass "Visa" grundsÃ¤tzlich nur eine Verbindung zulÃ¤sst! <br><br>  <b>EK:</b> - Sie selbst liefern AusrÃ¼stung.  In jedem Fall haben wir GerÃ¤te erhalten, die intern redundant sind. <br><br>  <b>F:</b> - Das heiÃŸt, das Rack von Connects Orange? .. <br><br>  <b>EG:</b> - Ja. <br><br>  <b>F:</b> - Aber wie in diesem Fall: Wenn Ihr Rechenzentrum verschwindet, sollten Sie es weiter verwenden?  Oder hÃ¶rt der Verkehr einfach auf? <br><br>  <b>EG:</b> - Nein.  In diesem Fall schalten wir den Verkehr einfach auf einen anderen Kanal um, was fÃ¼r uns natÃ¼rlich teurer und fÃ¼r die Kunden teurer wird.  Der Verkehr wird aber nicht Ã¼ber unsere direkte Verbindung zum "Visa", "MasterCard", sondern Ã¼ber die herkÃ¶mmliche "Sberbank" (sehr Ã¼bertrieben) gefÃ¼hrt. <br><br>  Es tut mir sehr leid, wenn ich Sberbank-Mitarbeiter verletzt habe.  Laut unserer Statistik fÃ¤llt die Sberbank jedoch am hÃ¤ufigsten von russischen Banken ab.  In weniger als einem Monat ist bei der Sberbank nichts abgefallen. <br><br><img src="https://habrastorage.org/webt/u2/pm/rp/u2pmrpkbplsfx65dstp-lsstwcw.jpeg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6YB1kMnzyRs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Ein bisschen Werbung :) </h3><br>  Vielen Dank fÃ¼r Ihren Aufenthalt bei uns.  MÃ¶gen Sie unsere Artikel?  MÃ¶chten Sie weitere interessante Materialien sehen?  UnterstÃ¼tzen Sie uns, indem Sie eine Bestellung aufgeben oder Ihren Freunden <a href="https://ua-hosting.company/cloudvps/nl">Cloud-basiertes VPS fÃ¼r Entwickler ab 4,99 US-Dollar</a> empfehlen, ein <b>einzigartiges Analogon zu Einstiegsservern, das wir fÃ¼r Sie erfunden haben:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">Die ganze Wahrheit Ã¼ber VPS (KVM) E5-2697 v3 (6 Kerne) 10 GB DDR4 480 GB SSD 1 Gbit / s ab 19 Dollar oder wie teilt man den Server?</a>  (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verfÃ¼gbar). <br><br>  <b>Dell R730xd 2-mal billiger im Equinix Tier IV-Rechenzentrum in Amsterdam?</b>  Nur wir haben <b><a href="https://ua-hosting.company/serversnl">2 x Intel TetraDeca-Core Xeon 2 x E5-2697v3 2,6 GHz 14C 64 GB DDR4 4 x 960 GB SSD 1 Gbit / s 100 TV ab 199 US-Dollar</a> in den Niederlanden!</b>  <b><b>Dell R420 - 2x E5-2430 2,2 GHz 6C 128 GB DDR3 2x960 GB SSD 1 Gbit / s 100 TB - ab 99 US-Dollar!</b></b>  Lesen Sie mehr Ã¼ber <a href="https://habr.com/company/ua-hosting/blog/329618/">das Erstellen von Infrastruktur-Bldg.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">Klasse mit Dell R730xd E5-2650 v4 Servern fÃ¼r 9.000 Euro fÃ¼r einen Cent?</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484908/">https://habr.com/ru/post/de484908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484898/index.html">Guter Grund, um Ihre AbhÃ¤ngigkeiten zu testen: AGPL-Edition</a></li>
<li><a href="../de484900/index.html">Website-Rendering 101</a></li>
<li><a href="../de484902/index.html">Auf Gleichungen hÃ¶heren Grades</a></li>
<li><a href="../de484904/index.html">Ein Jahr ohne Splunk - wie ein amerikanisches Unternehmen den Markt fÃ¼r Maschinendatenanalyse in Russland verÃ¤nderte und wen es zurÃ¼cklieÃŸ</a></li>
<li><a href="../de484906/index.html">Verteiltes Team und Teamleiter auf Remote</a></li>
<li><a href="../de484910/index.html">Paul Graham: Hasser</a></li>
<li><a href="../de484918/index.html">Inkrementelle Annotation zur Beschleunigung von Gradle-Builds</a></li>
<li><a href="../de484920/index.html">Wie kÃ¶nnen Sie verstehen, dass Sie ein FrÃ¤smaschinenbediener sind?</a></li>
<li><a href="../de484930/index.html">Lassen Sie uns wie Profis schnell codieren</a></li>
<li><a href="../de484932/index.html">Die doppelte Natur der Softwareanforderungen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>