<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€â¤ï¸â€ğŸ‘¨ ğŸ™‚ ğŸ§šğŸ¾ ä½¿ç”¨IPEYEäº‘ç›‘æ§æœåŠ¡è¿›è¡Œå†…éƒ¨å»¶æ—¶æ‹æ‘„ ğŸ—» ğŸ“³ ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ€è¿‘ï¼Œæ¯å¤©éƒ½ä¼šå‡ºç°ä¸€é¡¹ä»»åŠ¡ï¼Œä¸ä¸€å¯¹è¿æ¥åˆ°IPEYEçš„ç›‘æ§æ‘„åƒæœºå½¢æˆå»¶æ—¶ã€‚ å¦‚æœæ‚¨å¯¹PythonçŸ¥è¯†æœ€å°‘çš„äººå¦‚ä½•å¤„ç†æ„Ÿå…´è¶£ï¼Œæˆ–è€…æ‚¨æƒ³å‘æˆ‘æŒ‡å‡ºæˆ‘çš„é”™è¯¯ï¼Œè¯·æ¬¢è¿... 

 å‰è¨€ 
 æˆ‘çˆ¶äº²å†³å®šæ¬å®¶å¹¶åœ¨å¦ä¸€ä¸ªåœ°åŒºç›–æˆ¿å­ã€‚ ä»–è¯·æˆ‘å¸®åŠ©è¿›è¡Œè§†é¢‘ç›‘æ§ã€‚ è¾“å…¥æ•°æ®ï¼š 



- æ²¡æœ‰æŠ€æœ¯å®¤ã€‚ 
- è®¾å¤‡å¯èƒ½è¢«ç›—ã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨IPEYEäº‘ç›‘æ§æœåŠ¡è¿›è¡Œå†…éƒ¨å»¶æ—¶æ‹æ‘„</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475154/"> æœ€è¿‘ï¼Œæ¯å¤©éƒ½ä¼šå‡ºç°ä¸€é¡¹ä»»åŠ¡ï¼Œä¸ä¸€å¯¹è¿æ¥åˆ°IPEYEçš„ç›‘æ§æ‘„åƒæœºå½¢æˆå»¶æ—¶ã€‚ å¦‚æœæ‚¨å¯¹PythonçŸ¥è¯†æœ€å°‘çš„äººå¦‚ä½•å¤„ç†æ„Ÿå…´è¶£ï¼Œæˆ–è€…æ‚¨æƒ³å‘æˆ‘æŒ‡å‡ºæˆ‘çš„é”™è¯¯ï¼Œè¯·æ¬¢è¿... <br><a name="habracut"></a><br><h2> å‰è¨€ </h2><br> æˆ‘çˆ¶äº²å†³å®šæ¬å®¶å¹¶åœ¨å¦ä¸€ä¸ªåœ°åŒºç›–æˆ¿å­ã€‚ ä»–è¯·æˆ‘å¸®åŠ©è¿›è¡Œè§†é¢‘ç›‘æ§ã€‚ è¾“å…¥æ•°æ®ï¼š <br><br><ul><li> æ²¡æœ‰æŠ€æœ¯å®¤ã€‚ </li><li> è®¾å¤‡å¯èƒ½è¢«ç›—ã€‚ </li><li> éœ€è¦é«˜è´¨é‡çš„å›¾ç‰‡ã€‚ </li><li> æ‘„åƒæœºå¿…é¡»åœ¨å®¤å¤–ã€‚ </li><li> æ‚¨åªéœ€è¦2å°æ‘„åƒæœºã€‚ </li><li> æˆ‘çœŸçš„æƒ³è¦å¸¦å˜ç„¦çš„PTZæ‘„åƒæœºã€‚ </li><li> æˆ‘æƒ³è¦ä¸€ä¸ªç§»åŠ¨åº”ç”¨ç¨‹åºã€‚ </li></ul><br> åœ¨æŸ¥çœ‹äº†å“ç‰Œè®¾å¤‡å•†åº—çš„ä»·æ ¼åï¼Œå†³å®šè´­ä¹°å¸¦é˜¿é‡Œæ‰€æœ‰é¢åŒ…çš„noname PoEæ‘„åƒæœºã€‚ è¿™äº›ç›¸æœºè¶³å¤Ÿä¾¿å®œ-å¤§çº¦æ¯ä¸ª5åƒä¸ªã€‚ <br><br> æˆ‘ä¸æƒ³å°†DVRæ”¾ç½®åœ¨æ–½å·¥ç°åœºï¼Œå› æ­¤å†³å®šä½¿ç”¨äº‘è§£å†³æ–¹æ¡ˆã€‚ æ‘„åƒæœºåˆ°è¾¾åï¼Œæˆ‘è¯•å›¾ç»“äº¤å…·æœ‰ä¸åŒæœåŠ¡çš„æœ‹å‹ï¼Œä»¥ä¾¿ä¸€åˆ‡æ­£å¸¸ï¼ŒåŒ…æ‹¬PTZã€‚ åœ¨æˆ‘å°è¯•è¿‡çš„æ‰€æœ‰æœåŠ¡ä¸­ï¼Œç»“æœå‘ç°åªæœ‰IPEYEæ‰ä½¿ä¸­å›½ç›¸æœºæˆä¸ºæœ‹å‹ã€‚ <br> è¿™å°†ç»“æŸä»‹ç»ã€‚ æˆ‘è®¤ä¸ºç°åœ¨æ¯ä¸ªäººéƒ½å¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆè¦è¿›è¡Œæœ‰å…³æ­¤æœåŠ¡çš„å¯¹è¯ã€‚ <br><br><h2>  IPEYEçš„ç»éªŒ </h2><br> æœåŠ¡å³æœåŠ¡ã€‚ æ‰¿è¯ºçš„ä¸€åˆ‡éƒ½å®ç°äº†ã€‚ æŠ€æœ¯æ”¯æŒä¼šå›ç­”é—®é¢˜ã€‚ å…³é”®æ˜¯æ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªæŒ‡å‘rstpæµçš„é“¾æ¥ï¼Œæ‰­è½¬PTZè®¾ç½®ï¼Œä¸€åˆ‡éƒ½ä¼šæ­£å¸¸è¿›è¡Œã€‚  Androidç§»åŠ¨åº”ç”¨ç¨‹åºæœ‰æ•ˆã€‚ å¯ä»¥ä¸ºå…¶ç›¸æœºåˆ›å»ºè®¿å®¢ç”¨æˆ·ï¼Œå¹¶å‘æ¯ä¸ªäº²æˆšæˆäºˆè®¿é—®æƒé™ã€‚  Vivaldiä¸­çš„Webç•Œé¢æœ‰æ—¶ä¼šå‡ºç°æ•…éšœï¼›åœ¨Chromeä¸­ï¼Œæ­¤ç±»æ•…éšœä¸å¤ªå¸¸è§ã€‚ æµè§ˆæ¡£æ¡ˆæœ‰ç‚¹æ²‰é—·ã€‚ <br> å¯ä»¥ä¸‹è½½ç›¸æœºä¸­çš„æ¡£æ¡ˆï¼Œä½†æ˜¯æœ€å¤šå¯ä»¥è¿›è¡Œ3ä¸ªå°æ—¶çš„ä¸‹è½½ã€‚ è¯¥è¿‡ç¨‹éå¸¸è€—æ—¶ã€‚ <br><br> ä¸€åˆ‡ä¼¼ä¹éƒ½å¾ˆå¥½ï¼Œä½†æ‚¨å†…å¿ƒæ·±å¤„æ„Ÿåˆ°æœ‰äº›ä¸å¯¹åŠ²ã€‚ å¹¶ä¸”æ²¡æœ‰è¶³å¤Ÿçš„å­˜æ¡£æ·±åº¦ã€‚ æ‚¨å¯ä»¥å¢åŠ æ·±åº¦ï¼Œä½†æœ€æ˜‚è´µçš„é€‰æ‹©-12ä¸ªæœˆï¼Œä¸€å°æ‘„åƒæœºçš„è´¹ç”¨ä¸ºæ¯å¹´25,000å¢å¸ƒï¼ˆé€šè¿‡æ£€æµ‹è®°å½•æ—¶ï¼‰ã€‚ <br><br><h2> è®©æˆ‘ä»¬æƒ³å‡ºäº›ä»€ä¹ˆå—ï¼Ÿ </h2><br> é‚£æ˜¯æˆ‘çˆ¶äº²é—®æˆ‘çš„é—®é¢˜ã€‚ æˆ‘çˆ¶äº²æƒ³æŠ“ä½å»ºç­‘çš„æ‰€æœ‰é˜¶æ®µã€‚ <br> è§£å†³æ­¤é—®é¢˜æœ‰å“ªäº›é€‰æ‹©ï¼Ÿ æ‚¨å¯ä»¥æ¯å¤©è®¿é—®Webç•Œé¢ï¼Œå¹¶ä»æ¯ä¸ªæ‘„åƒæœºå¯¼å‡ºå‡ æ®µè§†é¢‘ã€‚ è°æ¥æ‰§è¡Œè¿™æ ·æ²‰é—·çš„ä»»åŠ¡ï¼Ÿ æ²¡æœ‰äººï¼ ä¸€å¤©å‡ æ¬¡æ‰“å¼€å¹¿æ’­æ‘„åƒæœºå¹¶æ‹æ‘„å±å¹•æˆªå›¾ï¼Ÿ å¥½å§ï¼Œè¿˜æœ‰ç²¾ç¥é”™ä¹±ã€‚ å°†æ¡£æ¡ˆæ·±åº¦å¢åŠ åˆ°1å¹´ï¼Ÿ å¥½å§ï¼Œä¸€ä¸ªéå¸¸ä¾¿å®œçš„è§£å†³æ–¹æ¡ˆã€‚  Googleå‘Šè¯‰æˆ‘ï¼Œæ­¤æœåŠ¡å·²ç»å†…ç½®äº†TimeLapseå‡½æ•°ï¼Œä½†æ˜¯åˆ†è¾¨ç‡å¾ˆä½ï¼Œæ‚¨æ— æ³•ä¸‹è½½å®ƒä»¥å¤‡å°†æ¥ä½¿ç”¨ï¼š:( <br>  <b>UPDï¼š</b>åŸå§‹æ¸¸æˆä¸­æ—¶å…‰å€’æµå¯ä»¥ä¸‹è½½ã€‚ ä¸ºæ­¤ï¼Œè¯·åœ¨Webç•Œé¢ä¸­æ‰“å¼€å»¶æ—¶ã€‚ ä½¿ç”¨å¼€å‘äººå‘˜å·¥å…·ï¼Œæ£€æŸ¥ç½‘é¡µå¹¶æ‰¾åˆ°æŒ‡å‘æˆ‘ä»¬æ–‡ä»¶çš„é“¾æ¥ã€‚ è¿ç»“æ ¼å¼ï¼š <br>  sr &lt;server_number&gt; .ipeye.ru / api / v1 / stream / &lt;uuid&gt; / nvr / timelapse / 0 / &lt;unixtimestamp&gt; /100/video.mjpeg <br><br> å†³å®šå†™ä¸€äº›ä¸œè¥¿ä»¥æŸç§æ–¹å¼ä¿å­˜ç›¸æœºçš„å±å¹•æˆªå›¾å¹¶å½¢æˆæœ€ç»ˆçš„è§†é¢‘ã€‚ <br><br><h3> å…è´£å£°æ˜ </h3><br> è¯¥ä½œå“çš„ä½œè€…ä¸æ˜¯ç¨‹åºå‘˜ï¼Œä¹Ÿä¸æ‰“ç®—æˆä¸ºä¸€ä¸ªç¨‹åºå‘˜ã€‚  OOPåˆæ­¥äº†è§£åŸºç¡€çŸ¥è¯†ã€‚ æ•æ·ç­‰ æ²¡æœ‰ç ”ç©¶ã€‚ ä¸€ä¸ªæœˆå‰ï¼Œä»–è§‚çœ‹äº†æœ‰å…³pythonçš„ç®€çŸ­è§†é¢‘è¯¾ç¨‹ï¼Œå¹¶å†³å®šä½¿ç”¨å®ƒæ¥è§£å†³å½“å‰é—®é¢˜ã€‚ <br><br><h2>  API </h2><br> å¾ˆé«˜å…´å‘ç°IPEYEæœåŠ¡æ˜¯å…¬å¼€å¯ç”¨çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">API</a> ã€‚ è¯¥APIä»…æä¾›ç”¨äºPHPçš„ç¤ºä¾‹ï¼Œä½†äº‹å®è¯æ˜å®ƒå¾ˆæœ‰ç”¨ã€‚ <br><br> åŸºäºæˆ‘çš„è®¡ç®—æœºä»æœªå…³é—­çš„äº‹å®ï¼Œå¼€å‘å‡ºä»¥ä¸‹æ¦‚å¿µï¼š <br><br><ol><li>  Windows Scheduleræ¯30åˆ†é’Ÿè¿è¡Œä¸€æ¬¡è„šæœ¬ã€‚ </li><li> é€šè¿‡APIçš„è„šæœ¬ç¡®å®šäº†æˆ‘çš„ç›¸æœºçš„uuidã€‚ </li><li> é€šè¿‡APIçš„è„šæœ¬ä»ç›¸æœºæ¥æ”¶ç…§ç‰‡å¹¶å°†å…¶ä¿å­˜åˆ°ç›®å½•ä¸­ã€‚ </li><li> è¯¥è„šæœ¬æ¯å¤©ä¸€æ¬¡ä¸ºæ¯ä¸ªæ‘„åƒæœºç”Ÿæˆä¸€ä¸ªè§†é¢‘æ–‡ä»¶ã€‚ </li><li> åŒ…å«æºç…§ç‰‡å’Œæœ€ç»ˆè§†é¢‘çš„ç›®å½•å·²ç»‘å®šåˆ°äº‘å¹¶å…±äº«ã€‚ </li><li> äº²æˆšæƒ³è¦è§‚çœ‹æ¸¸æˆä¸­æ—¶å…‰å€’æµå¹¶æŒ‰éœ€è¦æ“ä½œæ–‡ä»¶æ—¶ã€‚ </li></ol><br> ä¸ºäº†ä½¿ç”¨APIâ€‹â€‹ï¼Œæˆ‘ç¼–å†™äº†ä¸¤ä¸ªå‡½æ•°ï¼šè®°å½•å’Œæ‰§è¡Œå¯¹APIæœåŠ¡å™¨çš„è¯·æ±‚ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">writeLogï¼ˆï¼‰</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(logdata)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogEnable == <span class="hljs-number"><span class="hljs-number">1</span></span>: log_time = datetime.now() log_time = log_time.isoformat(timespec=<span class="hljs-string"><span class="hljs-string">'seconds'</span></span>) log_file = open(log_file_path, <span class="hljs-string"><span class="hljs-string">"a+"</span></span>) log_file.write(log_time + <span class="hljs-string"><span class="hljs-string">": "</span></span> + str(logdata) + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) log_file.close <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">getApiResponseï¼ˆï¼‰</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getApiResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(method, api_uri)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> method == <span class="hljs-string"><span class="hljs-string">"GET"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: r = requests.get(api_url + api_uri, timeout = api_timeout) r.raise_for_status() <span class="hljs-comment"><span class="hljs-comment">#   HTTP    except requests.exceptions.Timeout: writeLog("Error. Timeout. Request Uri:" + api_uri) except requests.exceptions.TooManyRedirects: writeLog("Error. TooManyRedirects or bad URL. Request Uri:" + api_uri) except requests.exceptions.RequestException as e: writeLog("Error. Fatal error: " + str(e) + " Request Uri:" + api_uri) sys.exit(1) except requests.exceptions.HTTPError as e: writeLog("Error. HTTP error: " + str(e) + " Request Uri:" + api_uri) if method == "POST": try: r = requests.post(api_url + api_uri, timeout = api_timeout) r.raise_for_status() #   HTTP    except requests.exceptions.Timeout: writeLog("Error. Timeout. Request Uri:" + api_uri) except requests.exceptions.TooManyRedirects: writeLog("Error. TooManyRedirects or bad URL. Request Uri:" + api_uri) except requests.exceptions.RequestException as e: writeLog("Error. Fatal error: " + str(e) + " Request Uri:" + api_uri) sys.exit(1) except requests.exceptions.HTTPError as e: writeLog("Error. HTTP error: " + str(e) + " Request Uri:" + api_uri) return r</span></span></code> </pre><br></div></div><br> æ ¹æ®APIï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®/ devices / allå¹¶è·å–æ‰€æœ‰çº¿ç¨‹ä¸Šçš„ä¿¡æ¯ã€‚ å¦‚æœæ‚¨ç›¸ä¿¡APIæ–‡æ¡£ï¼Œæˆ‘ç«‹å³æ„Ÿåˆ°å›°æƒ‘ï¼Œä¸éœ€è¦æˆæƒ...å½“æˆ‘è¯¢é—®/ devices / allæ—¶ï¼Œå‡ºç°é”™è¯¯ï¼š <blockquote> è‡´å‘½é”™è¯¯ï¼š401å®¢æˆ·ç«¯é”™è¯¯ï¼šæœªç»æˆæƒçš„ç½‘å€ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">api.ipeye.ru</a> ï¼š8111 /è®¾å¤‡/å…¨éƒ¨ </blockquote> æˆ‘ä¿®æ”¹äº†getApiResponseå‡½æ•°ä»¥ä¼ é€’æˆ‘çš„å‡­æ®ï¼Œä½†åŒæ—¶æ”¶åˆ°401é”™è¯¯ã€‚æˆ‘æ²¡æœ‰åˆ—å‡ºè¯¥å‡½æ•°ï¼Œå› ä¸º å°†æ¥æ²¡æœ‰ç”¨ã€‚ <br><br> æˆ‘ä¸å¾—ä¸è”ç³»æŠ€æœ¯æ”¯æŒã€‚ æ”¯æŒå›¢é˜Ÿè§£é‡Šè¯´ï¼Œä¸ºäº†é€šè¿‡æˆæƒä½¿ç”¨APIâ€‹â€‹ï¼Œæ‚¨å¿…é¡»é¦–å…ˆä¸IPEYEè¾¾æˆåè®®å¹¶é…ç½®WebæœåŠ¡å™¨ã€‚ ä»€ä¹ˆæ ·çš„ç½‘ç»œæœåŠ¡å™¨ä»¥åŠä¸ºä»€ä¹ˆä¸å‘æˆ‘è§£é‡Šï¼Œä½†æ˜¯åŒæ—¶ï¼Œä»–ä»¬ä¹Ÿæš—ç¤ºäº†åœ¨ä½•å¤„å¯ä»¥è·å–uuidç›¸æœºå¹¶æœªç»æˆæƒè®¿é—®APIã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¯¹åº”æ”¯æŒ</b> <div class="spoiler_text"><blockquote> æˆ‘ï¼šä¸‹åˆå¥½ã€‚ æ˜¯å¦å¯ä»¥ä½¿ç”¨APIâ€‹â€‹ï¼Ÿ æˆ‘åœ¨ç½‘ç»œç•Œé¢ä¸­æ‰¾ä¸åˆ°uuidç›¸æœºã€‚ å½“æˆ‘è¯¢é—®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">api.ipeye.ru</a>æ—¶ï¼Œæˆ‘æƒ³è·å–æˆ‘çš„ç›¸æœºåˆ—è¡¨ï¼š8111 /è®¾å¤‡/é™¤æˆ‘çš„ç”¨æˆ·å/å¯†ç é“¾æ¥ä¹‹å¤–çš„æ‰€æœ‰é“¾æ¥å‡æ— æ•ˆã€‚ <br><br>  IPEYEï¼šä½œä¸ºç™»å½•å/å¯†ç ï¼Œä½¿ç”¨äº†APIç”¨æˆ·çš„æˆæƒæ•°æ®ï¼Œæˆ‘ä»¬ä»¥åˆåŒæ–¹å¼æä¾›è®¿é—®æƒé™ã€‚ <br><br> å› æ­¤ï¼Œæ‚¨å°†çœ‹åˆ°çš„æ‘„åƒæœºåˆ—è¡¨ä¸æ˜¯æ‚¨çš„ç™»å½•åï¼Œè€Œæ˜¯ç”¨æˆ·APIçš„æ‰€æœ‰æ‘„åƒæœºã€‚ <br><br> æˆ‘ï¼šè®¿é—®ä¸¤å°æ‘„åƒæœºçš„APIéœ€è¦èŠ±è´¹å¤šå°‘é’±ï¼Ÿ <br><br>  IPEYEï¼šé‚£é‡Œçš„ä¸€åˆ‡éƒ½æ›´åŠ å¤æ‚ï¼Œæ‚¨å°†éœ€è¦å¯åŠ¨æ‚¨çš„ç½‘ç«™å¹¶ä½¿ç”¨æˆ‘ä»¬çš„APIå‘å…¶ä¸­æ·»åŠ ç›¸æœºï¼Œç„¶åç»§ç»­ä½¿ç”¨å®ƒä»¬ã€‚ <br> é…å¤‡2å°æ‘„åƒæœºå€¼å¾—å—ï¼Ÿ <br><br> æˆ‘ï¼šé€šå¸¸ï¼Œä¸ºäº†ç†è§£ï¼Œæˆ‘ä»…éœ€è¦è®¿é—®APIæ‰èƒ½è‡ªåŠ¨ä»ç›¸æœºä¸‹è½½å±å¹•æˆªå›¾ã€‚ ä¸ºäº†è¿›ä¸€æ­¥å½¢æˆæ—¶é—´æµé€ã€‚ <br><br>  IPEYEï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">api.ipeye.ru / docï¼ƒAppDeviceJPEGOnline</a>ä¸é€‚åˆä»€ä¹ˆï¼Ÿ <br><br> æˆ‘ï¼šåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°ç›¸æœºçš„UUIDï¼Ÿ <br><br>  IPEYEï¼šä¾‹å¦‚ï¼Œä»æµè§ˆå™¨çš„åœ°å€æ ä¸­ã€‚ ç›¸åŒçš„UUIDä½œä¸ºdevcodeå‚æ•°å‡ºç°åœ¨â€œç«™ç‚¹ä»£ç â€ä¸­ã€‚ <br><br></blockquote><br></div></div><br> å¹²æ®‹æ¸£ä¸­æœ‰ä»€ä¹ˆï¼Ÿ å®é™…ä¸Šï¼Œå¦‚æœæ‚¨æŸ¥çœ‹GETå‚æ•°ï¼Œåˆ™å¯ä»¥åœ¨æ‚¨çš„å¸æˆ·ä¸­æ‰¾åˆ°uuidç›¸æœºã€‚ æœ‰ä¸€ä¸ªæ–¹æ³•/è®¾å¤‡/ jpeg /åœ¨çº¿/ï¼šuuid /ï¼šæ‹æ‘„å±å¹•å¿«ç…§çš„åç§°ï¼Œæœ‰uuidï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ç›¸æœºçš„åç§°ã€‚ <br><br> æˆ‘åˆ›å»ºäº†ä¸€ä¸ªåŠŸèƒ½æ¥ä¿å­˜æµä¸­çš„å›¾åƒã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">saveJpegFromStreamï¼ˆï¼‰</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveJpegFromStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uuid, name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># api_uri = "/device/thumb/online/" + uuid + "/1920/" + name api_uri = "/device/jpeg/online/" + uuid + "/" + name writeLog("Trying save Stream screenshot for camera: " + name) response = getApiResponse("GET", api_uri) content_type = response.headers.get('content-type') if content_type is None: writeLog("Nothing to save") return False if 'text' in content_type.lower() or 'html' in content_type.lower(): writeLog("Received text data: " + response.content.decode("utf-8")) return False else: filename = dirToSave + "\\" + name + "-" + today.strftime("%Y-%m-%d-%H-%M-%S") + ".jpg" screenshot = open(filename, "wb") screenshot.write(response.content) screenshot.close() writeLog("File saved as: " + filename) return True</span></span></code> </pre><br></div></div><br> æˆ‘æå‡ºäº†è¦æ±‚ï¼Œå¹¶äº†è§£æœ‰äº›ä¸å¯¹åŠ²â€¦â€¦æˆ‘ä»¬æ”¶åˆ°äº†æ–‡ä»¶ã€‚ å›¾ç‰‡æ¥è‡ªæˆ‘çš„ç›¸æœºï¼Œä½†å¤§å°å¯ç–‘-66Kbã€‚ æˆ‘çœ‹ä¸€ä¸‹å±æ€§å¹¶äº†è§£608 * 342ç»ä¸æ˜¯1920 * 1080ã€‚ å½“æˆ‘è¯·æ±‚/ device / thumb / online / uuid / 1920 / nameæ—¶ï¼Œæˆ‘å¾—åˆ°çš„æ–‡ä»¶ä¸º1920 * 1080ï¼Œä½†è¿™åªæ˜¯å‰ä¸€ä¸ªæ–‡ä»¶608 * 342æ‰©å±•åˆ°æ‰€éœ€çš„æ¯”ä¾‹ã€‚ å½“ç„¶ï¼Œè¿™ç§æƒ…å†µå¹¶ä¸é€‚åˆæˆ‘ã€‚ <br><br> åŒæ ·åœ¨å®éªŒæœŸé—´ï¼Œå‘ç°æ²¡æœ‰æ£€æŸ¥æˆ–ä»¥ä»»ä½•æ–¹å¼ä½¿ç”¨nameå‚æ•°ã€‚ æ‚¨å¯ä»¥å‘é€ä»»ä½•æ‚¨æƒ³è¦çš„ã€‚ <br><br> ä¹‹åï¼Œæˆ‘å¾—å‡ºç»“è®ºï¼Œæœ€æœ‰ç”¨çš„å‘½ä»¤/ device / url / rtsp /æ˜¯è·å¾—æŒ‡å‘RTSPæµçš„é“¾æ¥ã€‚ æˆ‘ä¸å¾—ä¸æ±‚åŠ©äºGoogleï¼Œå› ä¸º å°šä¸äº†è§£å¦‚ä½•ä½¿ç”¨RTSPã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">getStreamRTSPï¼ˆï¼‰</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStreamRTSP</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uuid, name)</span></span></span><span class="hljs-function">:</span></span> api_uri = <span class="hljs-string"><span class="hljs-string">"/device/url/rtsp/"</span></span> + uuid writeLog(<span class="hljs-string"><span class="hljs-string">"Trying get stream RTSP link for "</span></span> + name + <span class="hljs-string"><span class="hljs-string">" "</span></span> + uuid) response = json.loads(getApiResponse(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, api_uri).text) writeLog(<span class="hljs-string"><span class="hljs-string">"Stream RTSP link for "</span></span> + name + <span class="hljs-string"><span class="hljs-string">": "</span></span> + str(response[<span class="hljs-string"><span class="hljs-string">"message"</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str(response[<span class="hljs-string"><span class="hljs-string">"message"</span></span>])</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">saveJpegFromRTSP</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveJpegFromRTSP</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name, rtspLink)</span></span></span><span class="hljs-function">:</span></span> writeLog(<span class="hljs-string"><span class="hljs-string">"Trying save RTSP screenshot for camera: "</span></span> + name) rtspClient = cv2.VideoCapture(rtspLink) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rtspClient.isOpened(): _,frame = rtspClient.read() rtspClient.release() <span class="hljs-comment"><span class="hljs-comment">#       if _ and frame is not None: filename = dirToSave + "\\" + name + "-" + today.strftime("%Y-%m-%d-%H-%M-%S") + ".jpg" cv2.imwrite(filename, frame) writeLog("File saved as: " + filename) return True else: writeLog("Can't read RTSP stream") return False</span></span></code> </pre><br></div></div><br> åœ¨ä¸Šé¢ç¼–å†™äº†å‡ ä¸ªå‡½æ•°åï¼Œæˆ‘æ„è¯†åˆ°å¯¹äºåˆå§‹ä»»åŠ¡æ ¹æœ¬ä¸éœ€è¦ä½¿ç”¨APIâ€‹â€‹ :)æˆ‘ç›´æ¥é“¾æ¥åˆ°æ‘„åƒæœºçš„rtspæµï¼Œä½¿ç”¨æœ€åä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘å¯ä»¥ä»æ‘„åƒæœºæ•è·å›¾åƒã€‚ ä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰åœ¨è¿™ä¸€æ­¥å¼€å§‹æ”¹å˜è¿™ä¸ªæ¦‚å¿µã€‚ <br><br> ä½¿ç”¨APIâ€‹â€‹æ—¶ï¼Œæœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼šIPEYEæœåŠ¡å™¨åˆå§‹åŒ–æµçš„é€Ÿåº¦æ¯”æ‘„åƒæœºå¿«å¾—å¤šï¼Œå¹¶ä¸”rtspæ‘„åƒæœºæµå¯ä»¥è¢«é˜²ç«å¢™å…³é—­ã€‚ <br><br><h2>  jpg2mp4 </h2><br> æœ€åä¸€æ­¥æ˜¯å°†ä¸€å°æ‘„åƒæœºçš„æ‰€æœ‰å›¾åƒæ·»åŠ åˆ°è§†é¢‘ä¸­ã€‚ æˆ‘é€‰æ‹©mp4vç¼–è§£ç å™¨ï¼Œå› ä¸º  MEGAå…è®¸æ‚¨åœ¨Webç•Œé¢ä¸­æ’­æ”¾è¿™äº›è§†é¢‘æ–‡ä»¶ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">makeVideoFileï¼ˆï¼‰</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeVideoFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name)</span></span></span><span class="hljs-function">:</span></span> height = <span class="hljs-number"><span class="hljs-number">1080</span></span> width = <span class="hljs-number"><span class="hljs-number">1920</span></span> <span class="hljs-comment"><span class="hljs-comment"># video = cv2.VideoWriter(dirToSave + "\\Video" + name + ".avi", cv2.VideoWriter_fourcc(*'DIVX'), 1,(width,height)) video = cv2.VideoWriter(dirToSave + "\\Video" + name + ".mp4", cv2.VideoWriter_fourcc(*'mp4v'), 1,(width,height)) files = os.listdir(dirToSave) screenshots = list(filter(lambda x: x.startswith(name + "-"), files)) for screenshot in screenshots: origImage = cv2.imread(dirToSave + "\\" + screenshot) #  ,    ,      -   ...   #  ,        FullHD ?           API heightOrig, widthOrig, channelsOrig = origImage.shape if height != heightOrig or width != widthOrig: img = cv2.resize(origImage, (width, height)) video.write(img) else: video.write(origImage) cv2.destroyAllWindows() video.release()</span></span></code> </pre><br></div></div><br> ä¾›å‚è€ƒï¼š45ä¸ªjpgæ–‡ä»¶ï¼Œè§†é¢‘æ ¼å¼çš„æ€»å®¹é‡ä¸º37.3 MBï¼Œå ç”¨16.9 MBã€‚ <br><br> æ„Ÿè°¢æ‚¨é˜…è¯»æˆ‘çš„ç¬¬ä¸€ç¯‡å…¬å¼€æ–‡ç« ã€‚ æˆ‘è¯•å›¾ä»¥æ•…äº‹çš„å½¢å¼æè¿°ä¸€åˆ‡ï¼Œè€Œä¸æ˜¯ç®€å•åœ°åšï¼Œå› ä¸ºæˆ‘ä¸æƒ³åœ¨å‡ºè·¯æ—¶æ‹¿åˆ°æ¯ç‡¥çš„æ–‡ç« ã€‚ <br><br> æˆ‘ä¼šå¾ˆé«˜å…´å‘è¡¨è¯„è®ºï¼Œå› ä¸ºæˆ‘ä¸åˆ°ä¸€ä¸ªæœˆå‰é‡åˆ°äº†pythonã€‚ <br><br> å¸¦æœ‰æ‰©å±•æ³¨é‡Šçš„å®Œæ•´è„šæœ¬å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github</a>ä¸Šæ‰¾åˆ°ã€‚ æ­¤å¤–ï¼Œè¯¥è„šæœ¬è€ƒè™‘äº†æ—¶åŒºçš„å·®å¼‚ï¼Œå¹¶ä¸”ç¼–å†™äº†æ‰€æœ‰å…¶ä½™åŠŸèƒ½ä»¥å¿«é€Ÿç¼©æ”¾åˆ°ä¸åŒæ•°é‡çš„æ‘„åƒæœºã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN475154/">https://habr.com/ru/post/zh-CN475154/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN475134/index.html">é«˜ç§‘æŠ€æ¬ºè¯ˆçš„å¦ä¸€ç§æ–¹å¼</a></li>
<li><a href="../zh-CN475138/index.html">æœ‰ç›Šåœ°ä½¿ç”¨Raspberry Piçš„5ç§æ–¹æ³• ç¬¬äºŒéƒ¨åˆ†</a></li>
<li><a href="../zh-CN475142/index.html">ç¡çœ ï¼Œæ”¾æ¾å’ŒéŸ³ä¹ï¼šä¸“ä¸šè¿åŠ¨å‘˜å¦‚ä½•å…‹æœç–²åŠ³ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åš</a></li>
<li><a href="../zh-CN475144/index.html">å°†Laravelåˆ†ä¸ºç»„ä»¶</a></li>
<li><a href="../zh-CN475146/index.html">ä¸€æ¬¡æ•°æ®æ¢å¤å°è¯•çš„ç—›è‹¦æˆ–æ‚ ä¹…çš„å†å²</a></li>
<li><a href="../zh-CN475158/index.html">Playme P570 Monoè¯„è®ºï¼šç®€è€Œè¨€ä¹‹</a></li>
<li><a href="../zh-CN475162/index.html">åœ¨ç°ä»£C ++ä»£ç ä¸­ä½¿ç”¨X-Macro</a></li>
<li><a href="../zh-CN475164/index.html">è®¨è®ºï¼šäº’è”ç½‘ä¾èµ–å¼€æº-è¯„è®ºå®¶æœ‰å“ªäº›è®ºç‚¹</a></li>
<li><a href="../zh-CN475170/index.html">åœ¨React.JSä¸Šåˆ›å»ºæ•°æ®é©±åŠ¨çš„åº”ç”¨ç¨‹åºçš„åŸºæœ¬æ¨¡å¼é—®é¢˜</a></li>
<li><a href="../zh-CN475172/index.html">æœ‰ç›Šåœ°ä½¿ç”¨Raspberry Piçš„5ç§æ–¹æ³• ç¬¬ä¸‰éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>