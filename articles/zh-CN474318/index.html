<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ› ğŸ¥˜ ğŸ¤ ä»€ä¹ˆæ˜¯è™šæ‹Ÿè¡¨è¡¨ï¼Ÿ ğŸ‘¨ğŸ¾â€ğŸ³ ğŸ“° ğŸ§¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨Slackä¸Šï¼Œæˆ‘é‡åˆ°äº†C ++é¦–å­—æ¯ç¼©ç•¥è¯è¯æ±‡è¡¨çš„æ–°é¦–å­—æ¯ç¼©ç•¥è¯ ï¼šâ€œ VTTâ€ã€‚ Godbolt ï¼š 



test.o: In function `MyClass': test.cc:3: undefined reference to `VTT for MyClass'  
 åœ¨æœ¬æ–‡ä¸­ï¼Œâ€œ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä»€ä¹ˆæ˜¯è™šæ‹Ÿè¡¨è¡¨ï¼Ÿ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474318/"> åœ¨Slackä¸Šï¼Œæˆ‘é‡åˆ°äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">C ++é¦–å­—æ¯ç¼©ç•¥è¯è¯æ±‡è¡¨</a>çš„æ–°é¦–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­—æ¯ç¼©ç•¥è¯</a> ï¼šâ€œ VTTâ€ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Godbolt</a> ï¼š <br><br><pre><code class="plaintext hljs">test.o: In function `MyClass': test.cc:3: undefined reference to `VTT for MyClass'</code> </pre> <br> åœ¨æœ¬æ–‡ä¸­ï¼Œâ€œ VTTâ€æ˜¯æŒ‡â€œè™šæ‹Ÿè¡¨è¡¨â€ã€‚ è¿™æ˜¯åˆ›å»ºä¸€äº›æœ¬èº«ä»è™šæ‹ŸåŸºç±»ç»§æ‰¿çš„åŸºç±»æ—¶ä½¿ç”¨çš„è¾…åŠ©æ•°æ®ç»“æ„ï¼ˆåœ¨Itanium C ++ ABIä¸­ï¼‰ã€‚  VTTéµå¾ªä¸è™šæ‹Ÿâ€‹â€‹è¡¨ï¼ˆvtableï¼‰å’Œç±»å‹ä¿¡æ¯ï¼ˆtypeinfoï¼‰ç›¸åŒçš„å¸ƒå±€è§„åˆ™ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨é‡åˆ°ä¸Šè¿°é”™è¯¯ï¼Œåˆ™å¯ä»¥åœ¨ç²¾ç¥ä¸Šç”¨â€œ vtableâ€ä»£æ›¿â€œ VTTâ€å¹¶å¼€å§‹è°ƒè¯•ã€‚  ï¼ˆå¾ˆå¯èƒ½æ‚¨æœªå®šä¹‰è¯¥ç±»çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é”®åŠŸèƒ½</a> ï¼‰ã€‚ ä¸ºäº†äº†è§£ä¸ºä»€ä¹ˆéœ€è¦VTTæˆ–ç±»ä¼¼çš„ç»“æ„ï¼Œè®©æˆ‘ä»¬ä»åŸºç¡€å¼€å§‹ã€‚ <br><a name="habracut"></a><br><h3> éè™šæ‹Ÿç»§æ‰¿çš„è®¾è®¡é¡ºåº </h3><br> å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªç»§æ‰¿å±‚æ¬¡ç»“æ„æ—¶ï¼ŒåŸºç±»æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»æœ€åŸºæœ¬çš„å¼€å§‹</a>æ„é€ çš„ã€‚ è¦æ„é€ Charlieï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆæ„é€ å…¶çˆ¶ç±»MrsBucketå’ŒMrBucketï¼Œä»¥é€’å½’æ–¹å¼æ¥æ„é€ MrBucketï¼Œé¦–å…ˆå¿…é¡»æ„é€ å…¶çˆ¶ç±»GrandmaJosephineå’ŒGrandpaJoeã€‚ <br><br> åƒè¿™æ ·ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> :</span></span> A {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class"> :</span></span> C {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class"> :</span></span> B, D {}; <span class="hljs-comment"><span class="hljs-comment">//     // ABCDE</span></span></code> </pre> <br><h3> è™šæ‹ŸåŸºç±»çš„è®¾è®¡é¡ºåº </h3><br> ä½†æ˜¯è™šæ‹Ÿç»§æ‰¿ä¼šæ··æ·†æ‰€æœ‰ä¿¡æ¯ï¼ ä½¿ç”¨è™šæ‹Ÿç»§æ‰¿ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰è±å½¢çš„å±‚æ¬¡ç»“æ„ï¼Œå…¶ä¸­ä¸¤ä¸ªä¸åŒçš„çˆ¶ç±»å¯ä»¥å…±äº«ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">G</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">M</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> G {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> G {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class"> :</span></span> M, F {}; <span class="hljs-comment"><span class="hljs-comment">//     // GMFE</span></span></code> </pre> <br> åœ¨æœ€åä¸€èŠ‚ä¸­ï¼Œæ¯ä¸ªæ„é€ å‡½æ•°è´Ÿè´£è°ƒç”¨å…¶åŸºç±»çš„æ„é€ å‡½æ•°ã€‚ ä½†æ˜¯ç°åœ¨æˆ‘ä»¬æœ‰äº†è™šæ‹Ÿç»§æ‰¿ï¼Œå¹¶ä¸”æ„é€ å‡½æ•°Må’ŒFå¿…é¡»ä»¥æŸç§æ–¹å¼çŸ¥é“ä¸å¿…æ„é€ Gï¼Œå› ä¸ºå®ƒå¾ˆå¸¸è§ã€‚ å¦‚æœåœ¨è¿™ç§æƒ…å†µä¸‹Må’ŒFè´Ÿè´£æ„é€ åŸºç¡€å¯¹è±¡ï¼Œåˆ™å…¬å…±åŸºç¡€å¯¹è±¡å°†è¢«æ„é€ ä¸¤æ¬¡ï¼Œè¿™ä¸æ˜¯å¾ˆå¥½ã€‚ <br><br> ä¸ºäº†ä½¿ç”¨è™šæ‹Ÿç»§æ‰¿å­å¯¹è±¡ï¼ŒItanium C ++ ABIå°†æ¯ä¸ªæ„é€ å‡½æ•°åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šåŸºç¡€å¯¹è±¡æ„é€ å‡½æ•°å’Œå®Œæ•´å¯¹è±¡æ„é€ å‡½æ•°ã€‚ åŸºç¡€å¯¹è±¡çš„æ„é€ å‡½æ•°è´Ÿè´£æ„é€ æ‰€æœ‰éè™šæ‹Ÿç»§æ‰¿å­å¯¹è±¡ï¼ˆåŠå…¶å­å¯¹è±¡ï¼Œå¹¶å°†å…¶vptrå®‰è£…åœ¨å…¶vtableä¸Šï¼Œå¹¶åœ¨C ++ä»£ç ä¸­ä»¥å¤§æ‹¬å·è¿è¡Œä»£ç ï¼‰ã€‚ æ¯æ¬¡åˆ›å»ºå®Œæ•´çš„C ++å¯¹è±¡æ—¶éƒ½ä¼šè°ƒç”¨è¯¥å®Œæ•´å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œè¯¥æ„é€ å‡½æ•°è´Ÿè´£æ„é€ æ´¾ç”Ÿå¯¹è±¡çš„è™šæ‹Ÿç»§æ‰¿çš„æ‰€æœ‰å­å¯¹è±¡ï¼Œç„¶åè¿›è¡Œå…¶ä½™å·¥ä½œã€‚ <br><br> è€ƒè™‘ä¸Šä¸€èŠ‚ä¸­çš„ABCDEç¤ºä¾‹ä¸ä»¥ä¸‹ç¤ºä¾‹ä¹‹é—´çš„åŒºåˆ«ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> A {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> C {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class"> :</span></span> B, D {}; <span class="hljs-comment"><span class="hljs-comment">//     // ACBDE</span></span></code> </pre> <br> å®Œæ•´å¯¹è±¡Eçš„æ„é€ å‡½æ•°é¦–å…ˆè°ƒç”¨è™šæ‹Ÿå­å¯¹è±¡Aå’ŒCçš„åŸºç¡€å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼› ç„¶åè°ƒç”¨åŸºæœ¬éè™šæ‹Ÿç»§æ‰¿å¯¹è±¡Bå’ŒDçš„æ„é€ å‡½æ•°ï¼ŒBå’ŒDä¸å†åˆ†åˆ«è´Ÿè´£æ„é€ Aå’ŒCã€‚ <br><br><h3> è®¾è®¡vtableè¡¨ </h3><br> å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰ä¸€äº›è™šæ‹Ÿæ–¹æ³•çš„ç±»ï¼Œä¾‹å¦‚ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Godbolt</a> ï¼‰ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cat</span></span></span><span class="hljs-class"> {</span></span> Cat() { poke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>(<span class="hljs-string"><span class="hljs-string">"meow"</span></span>); } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Lion</span></span></span><span class="hljs-class"> :</span></span> Cat { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> roar = <span class="hljs-string"><span class="hljs-string">"roar"</span></span>; Lion() { poke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override </span></span>{ roar += <span class="hljs-string"><span class="hljs-string">'!'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>(roar.c_str()); } };</code> </pre> <br> æ„é€ Lionæ—¶ï¼Œé¦–å…ˆè¦æ„é€ åŸºæœ¬çš„Catå­å¯¹è±¡ã€‚  Catçš„æ„é€ å‡½æ•°è°ƒç”¨pokeï¼ˆï¼‰ã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªCatå¯¹è±¡-æˆ‘ä»¬å°šæœªåˆå§‹åŒ–åˆ¶ä½œLionå¯¹è±¡æ‰€éœ€çš„æˆå‘˜æ•°æ®ã€‚ å¦‚æœCatæ„é€ å‡½æ•°è°ƒç”¨Lion :: pokeï¼ˆï¼‰ï¼Œåˆ™å¯ä»¥å°è¯•æ›´æ”¹std :: string roarçš„æœªåˆå§‹åŒ–æˆå‘˜ï¼Œä»è€Œå¾—åˆ°UBã€‚ å› æ­¤ï¼ŒC ++æ ‡å‡†è¦æ±‚æˆ‘ä»¬åœ¨Catæ„é€ å‡½æ•°ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œå¯¹pokeï¼ˆï¼‰è™šæ‹Ÿæ–¹æ³•çš„è°ƒç”¨åº”è°ƒç”¨Cat :: pokeï¼ˆï¼‰ï¼Œè€Œä¸æ˜¯Lion :: pokeï¼ˆï¼‰ï¼ <br><br> æ²¡é—®é¢˜ ç¼–è¯‘å™¨åªæ˜¯é€šè¿‡å°†å¯¹è±¡çš„vptrè®¾ç½®ä¸ºCatå¯¹è±¡çš„vtableæ¥ä½¿Cat :: Catï¼ˆï¼‰ï¼ˆåŸºç¡€å¯¹è±¡çš„ç‰ˆæœ¬å’Œå®Œæ•´å¯¹è±¡çš„ç‰ˆæœ¬ï¼‰å¼€å§‹ã€‚  Lion :: Lionï¼ˆï¼‰å°†è°ƒç”¨Cat :: Catï¼ˆï¼‰ï¼Œç„¶åå°†vptré‡ç½®ä¸ºLionä¸­Catå¯¹è±¡çš„vtableè¡¨çš„æŒ‡é’ˆï¼Œç„¶åå†è¿è¡Œæ‹¬å·ä¸­çš„ä»£ç ã€‚ æ²¡é—®é¢˜ï¼ <br><br><h3> è™šæ‹Ÿç»§æ‰¿åç§» </h3><br> è®©çŒ«å®é™…ä¸Šç»§æ‰¿è‡ªåŠ¨ç‰©ã€‚ ç„¶åï¼Œç”¨äºCatçš„vtableä¸ä»…å­˜å‚¨Catè™šæ‹Ÿæˆå‘˜å‡½æ•°çš„å‡½æ•°æŒ‡é’ˆï¼Œè€Œä¸”è¿˜å­˜å‚¨Catå†…éƒ¨çš„Animalè™šæ‹Ÿå­å¯¹è±¡çš„åç§»é‡ã€‚  ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¤©å“ª</a> ã€‚ï¼‰ <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Animal</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *data = <span class="hljs-string"><span class="hljs-string">"hi"</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cat</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Animal { Cat() { <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>(data); } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nermal</span></span></span><span class="hljs-class"> :</span></span> Cat {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Garfield</span></span></span><span class="hljs-class"> :</span></span> Cat { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> padding; };</code> </pre> <br>  Catæ„é€ å‡½æ•°æŸ¥è¯¢æˆå‘˜Animal ::æ•°æ®ã€‚ å¦‚æœæ­¤Catå¯¹è±¡æ˜¯Nermalå¯¹è±¡çš„åŸºç¡€å­å¯¹è±¡ï¼Œåˆ™å…¶æˆå‘˜æ•°æ®ä½äºvptråé¢çš„åç§»é‡8å¤„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœCatå¯¹è±¡æ˜¯Garfieldå¯¹è±¡çš„åŸºç¡€å­å¯¹è±¡ï¼Œåˆ™æˆå‘˜æ•°æ®ä½äºvptrå’ŒGarfield :: paddingä¹‹åçš„åç§»é‡16ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒItanium ABIå°†è™šæ‹ŸåŸºç¡€å¯¹è±¡çš„åç§»é‡å­˜å‚¨åœ¨Catå¯¹è±¡çš„vtableä¸­ã€‚  Cat-in-Nermalçš„vtableä¿ç•™ä»¥ä¸‹äº‹å®ï¼šåŠ¨ç‰©ï¼ˆåŸºç¡€Catå­å¯¹è±¡ï¼‰å­˜å‚¨åœ¨åç§»é‡8å¤„ï¼›  Cat-in-Garfieldçš„vtableä¿ç•™ä»¥ä¸‹äº‹å®ï¼šåŠ¨ç‰©ï¼ˆåŸºç¡€Catå­å¯¹è±¡ï¼‰å­˜å‚¨åœ¨åç§»é‡16å¤„ã€‚ <br><br> ç°åœ¨ï¼Œå°†å…¶ä¸ä¸Šä¸€èŠ‚ç»“åˆã€‚ ç¼–è¯‘å™¨å¿…é¡»ç¡®ä¿Cat :: Catï¼ˆï¼‰ï¼ˆåŸºç¡€å¯¹è±¡ç‰ˆæœ¬å’Œå®Œæ•´å¯¹è±¡ç‰ˆæœ¬ï¼‰éƒ½å¯ä»¥é€šè¿‡åœ¨ç±»å‹ä¸ºCat-in-Nermalçš„vtableä¸Šæˆ–åœ¨Cat-in-Garfieldçš„vtableä¸Šå®‰è£…vptræ¥å¯åŠ¨ï¼Œå…·ä½“å–å†³äºç±»å‹æœ€è¡ç”Ÿçš„è®¾æ–½ï¼ ä½†æ˜¯å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ <br><br> æ´¾ç”Ÿç¨‹åº¦æœ€é«˜çš„å¯¹è±¡çš„å®Œæ•´å¯¹è±¡çš„æ„é€ å‡½æ•°å¿…é¡»é¢„å…ˆè®¡ç®—åœ¨æ„é€ å¯¹è±¡æ—¶ä»–å¸Œæœ›åŸºç¡€å­å¯¹è±¡çš„vptrå¼•ç”¨å“ªä¸ªè¡¨vtableï¼Œç„¶åæ´¾ç”Ÿåº¦æœ€å¤§çš„å¯¹è±¡çš„å®Œæ•´å¯¹è±¡çš„æ„é€ å‡½æ•°å¿…é¡»å°†æ­¤ä¿¡æ¯ä¼ é€’ç»™åŸºç¡€å­å¯¹è±¡çš„åŸºç¡€å¯¹è±¡çš„æ„é€ å‡½æ•°ä½œä¸ºéšè—å‚æ•°ï¼ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹Cat :: Catï¼ˆï¼‰ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Godbolt</a> ï¼‰çš„ç”Ÿæˆä»£ç ï¼š <br><br><pre> <code class="cpp hljs">_ZN3CatC1Ev: #    Cat movq $_ZTV3Cat+<span class="hljs-number"><span class="hljs-number">24</span></span>, (%rdi) <span class="hljs-meta"><span class="hljs-meta"># this-&gt;vptr = &amp;vtable-for-Cat; retq _ZN3CatC2Ev: #     Cat movq (%rsi), %rax # fetch a value from rsi movq %rax, (%rdi) # this-&gt;vptr = *rsi; retq</span></span></code> </pre> <br> åŸºç¡€å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸ä»…æ¥å—ï¼…rdiä¸­çš„æ­¤éšè—å‚æ•°ï¼Œè¿˜æ¥å—ï¼…rsiä¸­çš„éšè—VTTå‚æ•°ï¼ åŸºç¡€å¯¹è±¡æ„é€ å‡½æ•°ä»ï¼ˆï¼…rsiï¼‰åŠ è½½åœ°å€ï¼Œå¹¶å°†è¯¥åœ°å€å­˜å‚¨åœ¨Catå¯¹è±¡çš„vtableä¸­ã€‚ <br><br> è°ƒç”¨åŸºæœ¬Catå¯¹è±¡çš„æ„é€ å‡½æ•°çš„äººéƒ½æœ‰è´£ä»»é¢„æµ‹åº”åœ¨vpträ¸­å†™å…¥å“ªä¸ªCat :: Catï¼ˆï¼‰åœ°å€ï¼Œå¹¶å°†ï¼ˆï¼…rsiï¼‰ä¸­çš„æŒ‡é’ˆè®¾ç½®ä¸ºè¯¥åœ°å€ã€‚ <br><br><h3> ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å¦ä¸€ç§èº«ä»½ï¼Ÿ </h3><br> è€ƒè™‘å®Œæ•´çš„Nermalå¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚ <br><br><pre> <code class="cpp hljs">_ZN3CatC2Ev: #    <span class="hljs-function"><span class="hljs-function">Cat </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">movq</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsi)</span></span></span><span class="hljs-function">, %rax #    rsi movq %rax, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rdi)</span></span></span><span class="hljs-function"> </span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta"># this-&gt;vptr = *rsi; retq _ZN6NermalC1Ev: #    Nermal pushq %rbx movq %rdi, %rbx movl $_ZTT6Nermal+8, %esi # %rsi = &amp;VTT-for-Nermal callq _ZN3CatC2Ev #     Cat movq $_ZTV6Nermal+24, (%rbx) # this-&gt;vptr = &amp;vtable-for-Nermal popq %rbx retq _ZTT6Nermal: .quad _ZTV6Nermal+24 # vtable-for-Nermal .quad _ZTC6Nermal0_3Cat+24 # construction-vtable-for-Cat-in-Nermal</span></span></span></span></code> </pre> <br> ä¸ºä»€ä¹ˆ_ZTC6Nermal0_3Cat + 24ä½äºæ•°æ®éƒ¨åˆ†ä¸­ï¼Œå¹¶ä¸”å…¶åœ°å€ä¼ é€’ç»™ï¼…rsiï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ é€’_ZTC6Nermal0_3Cat + 24ï¼Ÿ <br><br><pre> <code class="cpp hljs">#   ? _ZN3CatC2Ev: #     Cat movq %rsi, (%rdi) <span class="hljs-meta"><span class="hljs-meta"># this-&gt;vptr = rsi; retq _ZN6NermalC1Ev: #     Nermal pushq %rbx movq %rdi, %rbx movl $_ZTC6Nermal0_3Cat+24, %esi # %rsi = &amp;construction-vtable-for-Cat-in-Nermal callq _ZN3CatC2Ev #     Cat movq $_ZTV6Nermal+24, (%rbx) # this-&gt;vptr = &amp;vtable-for-Nermal popq %rbx retq</span></span></code> </pre> <br> è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥å…·æœ‰å¤šä¸ªç»§æ‰¿çº§åˆ«ï¼ åœ¨æ¯ä¸ªç»§æ‰¿çº§åˆ«ï¼ŒåŸºç¡€å¯¹è±¡çš„æ„é€ å‡½æ•°éƒ½åº”è®¾ç½®vptrï¼Œç„¶åå¯èƒ½å°†æ§åˆ¶æƒè¿›ä¸€æ­¥æ²¿é“¾å‘ä¸‹ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªåŸºç¡€æ„é€ å‡½æ•°ï¼Œåè€…å¯ä»¥å°†vptrsè®¾ç½®ä¸ºå…¶ä»–å€¼ã€‚ è¿™æ„å‘³ç€æŒ‡å‘vtableçš„åˆ—è¡¨æˆ–æŒ‡é’ˆè¡¨ã€‚ <br><br> è¿™æ˜¯ä¸€ä¸ªå…·ä½“ç¤ºä¾‹ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Godbolt</a> ï¼‰ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VB</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> member_of_vb = <span class="hljs-number"><span class="hljs-number">42</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Grandparent</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> VB { Grandparent() {} }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parent</span></span></span><span class="hljs-class"> :</span></span> Grandparent { Parent() {} }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Gretel</span></span></span><span class="hljs-class"> :</span></span> Parent { Gretel() : VB{<span class="hljs-number"><span class="hljs-number">1000</span></span>} {} }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hansel</span></span></span><span class="hljs-class"> :</span></span> Parent { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> padding; Hansel() : VB{<span class="hljs-number"><span class="hljs-number">2000</span></span>} {} };</code> </pre> <br>  GrandparentåŸºæœ¬æ„é€ å‡½æ•°å¯¹è±¡å¿…é¡»å°†å…¶vptrè®¾ç½®ä¸ºGrandparent-å…¶ä»–ï¼Œè¿™æ˜¯æ´¾ç”Ÿç¨‹åº¦æœ€é«˜çš„ç±»ã€‚  ParentåŸºç¡€å¯¹è±¡çš„æ„é€ å‡½æ•°å¿…é¡»é¦–å…ˆä½¿ç”¨é€‚å½“çš„ï¼…rsiè°ƒç”¨Grandparent :: Grandparentï¼ˆï¼‰ï¼Œç„¶åå°†vptrè®¾ç½®ä¸ºParentï¼Œè¿™æ˜¯æ´¾ç”Ÿç¨‹åº¦æœ€é«˜çš„ç±»ã€‚ ä¸ºGretelå®æ–½æ­¤æ–¹æ³•ï¼š <br><br><pre> <code class="cpp hljs">Gretel::Gretel() [  ]: pushq %rbx movq %rdi, %rbx movl $<span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>(%rdi) <span class="hljs-meta"><span class="hljs-meta"># imm = 0x3E8 movl $VTT for Gretel+8, %esi callq Parent::Parent() [  ] movq $vtable for Gretel+24, (%rbx) popq %rbx retq VTT for Gretel: .quad vtable for Gretel+24 .quad construction vtable for Parent-in-Gretel+24 .quad construction vtable for Grandparent-in-Gretel+24</span></span></code> </pre> <br> æ‚¨å¯ä»¥åœ¨Godboltä¸­çœ‹åˆ°ï¼ŒParentç±»çš„åŸºç¡€å¯¹è±¡çš„æ„é€ å‡½æ•°é¦–å…ˆè°ƒç”¨ï¼…rsi + 8çš„Grandparent :: Grandparentï¼ˆï¼‰ï¼Œç„¶åå°†å…¶è‡ªå·±çš„vptrè®¾ç½®ä¸ºï¼ˆï¼…rsiï¼‰ã€‚ å› æ­¤ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨çš„äº‹å®æ˜¯ï¼Œå¯ä»¥è¯´ï¼ŒGretelç²¾å¿ƒé“ºè®¾äº†ä¸€æ¡é¢åŒ…å±‘è·¯å¾„ï¼Œåœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¥¹çš„æ‰€æœ‰åŸºå±‚éƒ½éµå¾ªäº†è¿™ä¸€è·¯å¾„ã€‚ <br><br> ææ„å‡½æ•°ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Godbolt</a> ï¼‰ä¸­ä½¿ç”¨äº†ç›¸åŒçš„VTTã€‚ æ®æˆ‘æ‰€çŸ¥ï¼ŒVTTè¡¨çš„ç©ºè¡Œä»æœªä½¿ç”¨è¿‡ã€‚  Gretelæ„é€ å‡½æ•°å°†Gretel + 24çš„vtableåŠ è½½åˆ°vpträ¸­ï¼Œä½†ä»–çŸ¥é“æ­¤åœ°å€æ˜¯é™æ€çš„ï¼Œå› æ­¤ä¸éœ€è¦ä»VTTåŠ è½½ã€‚ æˆ‘è®¤ä¸ºä¿ç•™è¡¨çš„é›¶è¡Œä»…å‡ºäºå†å²åŸå› ã€‚  ï¼ˆå½“ç„¶ï¼Œç¼–è¯‘å™¨ä¸èƒ½åªæ˜¯å°†å…¶ä¸¢å¼ƒï¼Œå› ä¸ºè¿™å°†è¿åItanium ABIï¼Œå¹¶ä¸”ä¸å¯èƒ½é“¾æ¥åˆ°éµå¾ªItanium-ABIçš„æ—§ä»£ç ï¼‰ã€‚ <br><br> å°±æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬æŸ¥çœ‹äº†ä¸€ä¸ªè™šæ‹Ÿè¡¨æˆ–VTTè¡¨ã€‚ <br><br><h3> è¿›ä¸€æ­¥èµ„æ–™ </h3><br> æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°VTTä¿¡æ¯ï¼š <br><br>  StackOverflowï¼šâ€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»€ä¹ˆæ˜¯è¯¾ç¨‹çš„VTTï¼Ÿ</a>  â€ <br>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=http://web.archive.org/web/20190930143149/">GCC C ++ç¼–è¯‘å™¨v4.0.1ä¸­å…³äºå¤šé‡ç»§æ‰¿çš„VTableæ³¨æ„</a> â€ï¼ˆMorgan Detersï¼Œ2005å¹´ï¼‰ <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Itanium C ++ ABIçš„</a> â€œ VTTè®¢å•â€éƒ¨åˆ† <br><br> æœ€åï¼Œæˆ‘å¿…é¡»é‡ç”³VTTæ˜¯Itanium C ++ ABIçš„åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨Linuxï¼ŒOSXç­‰ä¸Šä½¿ç”¨ã€‚  Windowsä¸Šä½¿ç”¨çš„MSVC ABIæ²¡æœ‰VTTï¼Œå¹¶ä¸”å¯¹è™šæ‹Ÿç»§æ‰¿ä½¿ç”¨å®Œå…¨ä¸åŒçš„æœºåˆ¶ã€‚ æˆ‘ï¼ˆåˆ°ç›®å‰ä¸ºæ­¢ï¼‰å¯¹MSVC ABIå‡ ä¹ä¸€æ— æ‰€çŸ¥ï¼Œä½†ä¹Ÿè®¸æœ‰ä¸€å¤©æˆ‘ä¼šå‘ç°æ‰€æœ‰å†…å®¹å¹¶æ’°å†™æœ‰å…³å®ƒçš„æ–‡ç« ï¼ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN474318/">https://habr.com/ru/post/zh-CN474318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN474306/index.html">ä½¿æŒ‡å‘ï¼Œç„¦ç‚¹å’Œæ´»åŠ¨çŠ¶æ€çš„æ ·å¼ä¸åŒã€‚</a></li>
<li><a href="../zh-CN474308/index.html">ç”¨Pythonç¼–å†™çš„HTTP APIçš„ç±»å‹ï¼šInstagramä½“éªŒ</a></li>
<li><a href="../zh-CN474310/index.html">CSSä¸­æœ‰éšæœºæ•°å—ï¼Ÿ</a></li>
<li><a href="../zh-CN474312/index.html">åœ¨Windows Server Coreä¸Šå®‰è£…GUI</a></li>
<li><a href="../zh-CN474316/index.html">è‡ªåˆ¶ç”µåŠ¨æ±½è½¦-ç¬¬1éƒ¨åˆ†ã€‚ä¸€åˆ‡ä»å¤´å¼€å§‹ï¼Œæˆ‘å¦‚ä½•åœ¨YouTubeä¸Šè·å¾—1,000,000æ¬¡è§‚çœ‹</a></li>
<li><a href="../zh-CN474320/index.html">DDDç¤¾åŒºå±æœº</a></li>
<li><a href="../zh-CN474322/index.html">ScalaConf 2019-John Preacherï¼Œåœ£æ¯å’ŒHaskellæ•™æˆ</a></li>
<li><a href="../zh-CN474324/index.html">å¤ªé˜³ä¸ºä»€ä¹ˆç»•åœ°çƒå…¬è½¬</a></li>
<li><a href="../zh-CN474326/index.html">äº†è§£CIå’ŒCDä¹‹é—´çš„åŒºåˆ«ï¼šâ€œå¦‚æœæŸäº‹å¯¼è‡´ç–¼ç—›ï¼Œè¯·å¤šåšç‚¹äº‹æƒ…â€</a></li>
<li><a href="../zh-CN474330/index.html">ï¼ƒ320ç§»åŠ¨å¼€å‘äººå‘˜çš„æœ‰è¶£ææ–™æ‘˜è¦ï¼ˆ10æœˆ28æ—¥è‡³11æœˆ3æ—¥ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>