<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‡ğŸ¾ ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ ğŸ“© è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚ ç¬¬äºŒéƒ¨åˆ† ğŸŒ° ğŸ’˜ ğŸšµğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿™æ˜¯æœ¬æ–‡çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œæè¿°äº†ç”¨äºå¤„ç†ç³»ç»Ÿç›®å½•çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼špg_classï¼Œpg_attributeï¼Œpg_constraintsç­‰ã€‚ 

 æœ¬æ–‡çš„è¿™ä¸€éƒ¨åˆ†è®¨è®ºè¿”å›çº¦æŸå’Œç´¢å¼•ç‰¹å¾çš„å‡½æ•°ã€‚ 

 æœ¬æ–‡çš„å‰åŠéƒ¨åˆ†æä¾›äº†æœ‰å…³åŠŸèƒ½å®ç°çš„è¯„è®ºã€‚ ç¬¬äºŒä¸ªæ˜¯å‡½æ•°çš„æºä»£ç ã€‚ å¯¹äºåªå¯¹æºæ–‡æœ¬æ„Ÿå…´è¶£çš„è¯»è€…ï¼Œæˆ‘ä»¬å»ºè®®ç«‹å³...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚ ç¬¬äºŒéƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415897/"> è¿™æ˜¯æœ¬æ–‡çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œæè¿°äº†ç”¨äºå¤„ç†ç³»ç»Ÿç›®å½•çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼špg_classï¼Œpg_attributeï¼Œpg_constraintsç­‰ã€‚ <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zc/rx/ta/zcrxta08dnfat5cqpgid4lyq7by.png"></div><br> æœ¬æ–‡çš„è¿™ä¸€éƒ¨åˆ†è®¨è®º<b>è¿”å›çº¦æŸå’Œç´¢å¼•ç‰¹å¾çš„</b>å‡½æ•°ã€‚ <br><a name="habracut"></a><br> æœ¬æ–‡çš„å‰åŠéƒ¨åˆ†æä¾›äº†æœ‰å…³åŠŸèƒ½å®ç°çš„è¯„è®ºã€‚ ç¬¬äºŒä¸ªæ˜¯å‡½æ•°çš„æºä»£ç ã€‚ å¯¹äºåªå¯¹æºæ–‡æœ¬æ„Ÿå…´è¶£çš„è¯»è€…ï¼Œæˆ‘ä»¬å»ºè®®ç«‹å³ç»§ç»­é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é™„å½•</a> ã€‚ <br><p>  <b>å¦è¯·å‚é˜…</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†</a> ;</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸‰éƒ¨åˆ†</a> ã€‚</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ€åï¼ˆç¬¬å››éƒ¨åˆ†ï¼‰</a> ã€‚</b> <br><br></p><h3>  admtf_Table_Constraintesæ•°æ®åº“è¡¨é™åˆ¶åˆ—è¡¨åŠå…¶ç‰¹å¾ </h3><br><a name="tfTableC_def"></a><br><p>  admtf_Table_Constrainteså‡½æ•°è¿”å›æ•°æ®åº“è¡¨åŠå…¶ç‰¹å¾çš„çº¦æŸåˆ—è¡¨ï¼ˆCONSTRAINTï¼‰ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å’Œä¸‹è½½æºä»£ç </a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™æ˜¯ä¸ä½¿ç”¨æ¸¸æ ‡çš„å‡½æ•°çš„ç‰ˆæœ¬</a> ã€‚ </p><br><br> è¯¥å‡½æ•°å°†æºè¡¨çš„åç§°ï¼ˆ <b>a_TableName</b> ï¼‰å’Œåœ¨å…¶ä¸­åˆ›å»ºè¡¨çš„æ–¹æ¡ˆçš„åç§°ï¼ˆ <b>a_SchemaName</b> ï¼‰ä½œä¸ºå‚æ•°ã€‚ <br><br><p> ç‰¹å®šçº¦æŸçš„æè¿°æ˜¯<b>pg_class</b>ä¸­çš„è®°å½•ï¼ˆå°†å…¶æè¿°ä¸ºç‰©ç†å…³ç³»ï¼‰ä¸<b>pg_constraint</b>ä¸­çš„è®°å½•ï¼ˆåŒ…å«æœ‰å…³çº¦æŸçš„ç‰¹å®šç‰¹å¾çš„æ•°æ®ï¼‰çš„ç»„åˆã€‚ </p><br><br><img src="https://habrastorage.org/webt/q8/xc/ll/q8xcllhdjgtvndtzraq2ofsssti.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­æ“ä½œå‘˜çš„æºä»£ç </b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tbl.OID,con.conname,con.contype,con.conkey,reftbl.OID, reftbl.relname,con.confkey,con.consrc <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint con <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.connamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.conrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class reftbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.confrelid=reftbl.oid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.contype <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>,con.conname;</code> </pre> <br></div></div><br><p> ä»<b>pg_constraint</b>ç›®å½•<b>æ¡ç›®ä¸­</b>æ£€ç´¢ä¸»è¦æ•°æ®ï¼ˆé™åˆ¶çš„åç§°å’Œç±»å‹ï¼‰ã€‚ æ¯ä¸ªçº¦æŸçš„ç‰¹å¾éƒ½ä»åŒä¸€ç›®å½•ä¸­æå–ï¼Œä»¥OIDè¡¨ï¼ˆ <b>conrelid</b> ï¼Œ <b>confrelid</b> ï¼‰æˆ–å‚ä¸çº¦æŸçš„å±æ€§åºåˆ—å·æ•°ç»„ï¼ˆ <b>conkey</b> ï¼Œ <b>confkey</b> ï¼‰çš„å½¢å¼è¡¨ç¤ºã€‚ </p><br><br><p> è¯¥å‡½æ•°ä»¥è¡¨åå’Œå±æ€§çš„å½¢å¼è¿”å›çº¦æŸç‰¹å¾ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡åç§°ï¼ˆOIDï¼‰ä»<b>pg_class</b>ç›®å½•<b>æ¡ç›®</b>ä¸­æå–è¡¨åï¼Œå¹¶é€šè¿‡è¡¨æ ‡è¯†ç¬¦å’Œå±æ€§åºåˆ—å·ä»<b>pg_attribute</b>ç›®å½•<b>æ¡ç›®</b>ä¸­æå–å±æ€§åã€‚ å› ä¸º ç”±äºåºåˆ—å·ä»¥æ•°ç»„ï¼ˆåˆ—è¡¨ï¼‰çš„å½¢å¼å­˜å‚¨åœ¨ä¸»ç›®å½•ä¸­ï¼Œå› æ­¤åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨å¾ªç¯æ¥å½¢æˆå±æ€§åç§°åˆ—è¡¨ã€‚ </p><br><p> è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªç‰¹æ®Šç‰¹å¾-ç”¨äºæ£€æŸ¥è¡¨æ¡ç›®ä¸­å­—æ®µå€¼çš„è§„åˆ™ï¼ˆCHECKé™åˆ¶ï¼‰ã€‚ è¯¥ç‰¹å¾ä½œä¸ºæ–‡æœ¬å€¼å­˜å‚¨åœ¨<b>pg_constraint</b>ç›®å½•çš„<b>consrc</b>å­—æ®µä¸­ã€‚ </p><br>  <strong>è¡¨7.æ‰§è¡Œå‡½æ•°admtf_Table_Constraintesï¼ˆâ€œ publicâ€ï¼Œâ€œ Streetâ€ï¼‰çš„ç»“æœã€‚</strong> <br><img src="https://habrastorage.org/webt/gd/x6/ny/gdx6ny5rnukyvjntf4bjirkwlye.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­è¡¨æ ¼çš„æ–‡æœ¬ç‰ˆæœ¬</b> <div class="spoiler_text"><table width="80" border="1"><tbody><tr><th width="15"> èŒç§° </th><th width="5"> å‹å¼ </th><th width="20"> æºè¡¨å±æ€§ </th><th width="10"> å¤–éƒ¨è¡¨çš„åç§° </th><th width="15"> å¤–éƒ¨è¡¨çš„å±æ€§ </th><th width="15"> éªŒè¯è§„åˆ™ </th></tr><tr><td width="15">  xpkstreet </td><td width="5">  p </td><td width="20">  wcrccodeï¼Œlocalityidï¼Œstreetid </td><td width="10"></td><td width="15"></td><td width="15"></td></tr><tr><td width="15">  fk_street_locality </td><td width="5">  ËšF </td><td width="20">  wcrccodeï¼Œlocalityid </td><td width="10"> åœ°åŒº </td><td width="15">  wcrccodeï¼Œlocalityid </td><td width="15"></td></tr><tr><td width="15">  fk_street_streettype </td><td width="5">  ËšF </td><td width="20">  streettypeacrm </td><td width="10"> è¡—é“å‹ </td><td width="15">  streettypeacrm </td><td width="15"></td></tr><tr><td width="15">  ck_street_streetname </td><td width="5">  Ã§ </td><td width="20"> è¡—é“å </td><td width="10"></td><td width="15"></td><td width="15">  ï¼ˆï¼ˆè¡—é“åç§°ï¼‰::æ–‡æœ¬ï¼ã€œ*'[az]'::æ–‡æœ¬ï¼‰ </td></tr><tr><td width="15">  ck_street_streettypeacrm </td><td width="5">  Ã§ </td><td width="20">  streettypeacrm </td><td width="10"></td><td width="15"></td><td width="15">  ï¼ˆï¼ˆstreettypeacrmï¼‰:: bpcharï¼ã€œ*'[az]'::æ–‡æœ¬ï¼‰ </td></tr></tbody></table><br></div></div><br><a name="tfTableC_woc_def"></a><br><h4> æ²¡æœ‰å…‰æ ‡çš„ç‰ˆæœ¬ </h4><br><p> æˆ‘é¢„è§åˆ°è¯¥å‡½æ•°ä¸»ç‰ˆæœ¬ä¸­æœ‰å…³æ¸¸æ ‡ä½¿ç”¨çš„é—®é¢˜å’Œè¯„è®ºã€‚ </p><br><p> æˆ‘ä¸ä¼šå›ç­”-å£å‘³å’Œé¢œè‰²æ²¡æœ‰åŒå¿—ã€‚ ä½†æ˜¯æˆ‘ä¼šç»™å‡ºä¸€ä¸ªæ²¡æœ‰å…‰æ ‡çš„å‡½æ•°ç‰ˆæœ¬ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸ä½¿ç”¨å…‰æ ‡çš„å‡½æ•°å®ç°ç‰ˆæœ¬å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å’Œä¸‹è½½</a> ã€‚ </p><br><p> ä¸»è¦å›°éš¾åœ¨äºæ ¹æ®è¡¨ä¹‹ä¸€çš„æ•°ç»„çš„å±æ€§ç±»å‹ä¸­çš„å€¼æ¥ç»„ç»‡è¡¨çš„è”æ¥ï¼ˆJOINï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¤ç±»æ•°ç»„ä¸º<b>conkey</b>å’Œ<b>confkey</b> ã€‚ </p><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.conname,c.contype,c.conkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[], GENERATE_SUBSCRIPTS(c.conkey, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.conname=<span class="hljs-string"><span class="hljs-string">'fk_street_locality'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span>;</code> </pre><br><p> ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒPostgrSQLåŒ…å«ä¸€äº›å‡½æ•°ï¼Œè¿™äº›å‡½æ•°è¿”å›æŒ‡å‘æ•°ç»„å…ƒç´ çš„æŒ‡é’ˆçš„å€¼è¡¨ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°†ä½¿ç”¨<b>generate_subscripts</b>å‡½æ•°ã€‚ å®ƒä¸ä»…ä¼šç”Ÿæˆå¤§é‡æŒ‡å‘ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒçš„æ•°ç»„ä½ç½®çš„æŒ‡é’ˆï¼Œè€Œä¸”è¿˜ä¼šæ ¹æ®æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡å°†åŒ…å«è¯¥æ•°ç»„çš„ä¸€æ¡è®°å½•å˜æˆå‡ æ¡è®°å½•ã€‚ è¯¥è¡¨çš„æ¯ä¸ªè®°å½•éƒ½åŒ…å«ä¸€ä¸ªå”¯ä¸€å€¼-æ•°ç»„çš„ä½ç½®ã€‚ </p><br><br>  <strong>è¡¨8.ä½¿ç”¨<b>generate_subscripts</b>ä¼ æ’­åŸå§‹å­—ç¬¦ä¸²ã€‚</strong> <br><br><table width="95" border="1"><tbody><tr><th width="15"> é™åˆ¶åç§° </th><th width="5"> å‹å¼ </th><th width="10"> å±æ€§ç¼–å·æ•°ç»„ </th><th width="10"> æŒ‡å‘æ•°ç»„ä½ç½®çš„æŒ‡é’ˆ </th></tr><tr><td width="15">  fk_street_locality </td><td width="5">  ËšF </td><td width="10">  {1,2} </td><td width="10">  1ä¸ª </td></tr><tr><td width="15">  fk_street_locality </td><td width="5">  ËšF </td><td width="10">  {1,2} </td><td width="10">  2 </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/0t/yn/9_/0tyn9__z3p-g8knkavap0aluta8.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­æ“ä½œå‘˜çš„æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> con.conname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ConstraintName,con.contype::<span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ConstraintType, STRING_AGG(attr.attname, <span class="hljs-string"><span class="hljs-string">', '</span></span><span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.No) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_ConstraintKeyNames, reftbl.relname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RefTableName, STRING_AGG(rattr.attname,<span class="hljs-string"><span class="hljs-string">', '</span></span><span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.No) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_RefTableKeyNames, con.consrc <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ConstraintSource <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.oid, c.conrelid,c.confrelid,c.conname,c.contype, c.conkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],c.consrc, c.confkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[], generate_subscripts(c.conkey, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint c) con <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.conrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute <span class="hljs-keyword"><span class="hljs-keyword">attr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> attr.attrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> attr.attnum=con.conkey[con.No] <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class reftbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.confrelid=reftbl.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute rattr <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rattr.attrelid=reftbl.oid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rattr.attnum=con.confkey[con.No] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableName) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.conname,con.contype,reftbl.relname,con.consrc <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.contype <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>,con.conname;</code> </pre><br></div></div><br><p> é€šè¿‡åœ¨<b>attr.attrelid = tbl.oid AND attr.attnum = con.conkey [con.No]</b>çš„æ¡ä»¶ä¸‹ä»<b>è¡¨ä¸­</b>æå–å±æ€§åç§°ï¼Œå¯ä»¥å°†è¯¥è¡¨è¿æ¥åˆ°<b>pg_attribute</b>å±æ€§<b>ç›®å½•</b> ã€‚ <br> ç°åœ¨å‰©ä¸‹çš„å·¥ä½œæ˜¯é€šè¿‡å¯¹è®°å½•è¿›è¡Œåˆ†ç»„æ¥åˆ é™¤ä¸å¿…è¦çš„è®°å½•ï¼Œå¹¶ä»å±æ€§åç§°ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ </p><br><p> ä½¿ç”¨èšé›†å‡½æ•°<b>STRING_AGG</b>æ‰§è¡Œåˆ›å»ºè¡Œï¼Œåœ¨è¯¥å‡½æ•°ä¸­å¿…é¡»æŒ‡å®šæ’åºé€‰é¡¹ï¼ˆORDER BYï¼‰ï¼Œå¦åˆ™å±æ€§çš„é¡ºåºå¯èƒ½ä¸ç´¢å¼•ä¸­å±æ€§çš„å£°æ˜é¡ºåº<b>ä¸ä¸€è‡´</b> ã€‚ </p><br><br><p> ä¸¤ä¸ªåŠŸèƒ½ç‰ˆæœ¬çš„æ‰§è¡Œæ—¶é—´ä¸€è‡´ã€‚ åœ¨ç»“æœè¡¨ä¸­è¾“å‡ºæ•°æ®èŠ±è´¹äº†20æ¯«ç§’ã€‚ </p><br><h3>  Admtf_Table_Indexesæ•°æ®åº“è¡¨ç´¢å¼•çš„åŠŸèƒ½åˆ—è¡¨åŠå…¶ç‰¹å¾ </h3><br><a name="tfTableI_def"></a><br><p>  admtf_Table_Indexeså‡½æ•°è¿”å›æ•°æ®åº“è¡¨åŠå…¶ç‰¹å¾çš„ç´¢å¼•åˆ—è¡¨ï¼ˆINDEXï¼‰ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å’Œä¸‹è½½æºä»£ç </a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™æ˜¯ä¸ä½¿ç”¨æ¸¸æ ‡çš„å‡½æ•°çš„ç‰ˆæœ¬</a> ã€‚ </p><br> è¯¥å‡½æ•°å°†æºè¡¨çš„åç§°ï¼ˆ <b>a_TableName</b> ï¼‰å’Œåœ¨å…¶ä¸­åˆ›å»ºè¡¨çš„æ–¹æ¡ˆçš„åç§°ï¼ˆ <b>a_SchemaName</b> ï¼‰ä½œä¸ºå‚æ•°ã€‚ <br><img src="https://habrastorage.org/webt/fb/wv/jm/fbwvjmsipergemhoi8u1dyf8z3m.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­æ“ä½œå‘˜çš„æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tbl.oid,inxcls.relname,inxam.amname,inx.indisunique,inx.indisprimary, inx.indkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],inx.indoption::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],inxam.amcanorder <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_index inx <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class inxcls <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inx.indexrelid=inxcls.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace inxnsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inxcls.relnamespace=inxnsp.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_am inxam <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inxcls.relam=inxam.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inx.indrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> inxam.amname, inxcls.relname;</code> </pre><br></div></div><br><p> å•ä¸ªç´¢å¼•çš„æè¿°æ˜¯<b>pg_class</b>ä¸­çš„è®°å½•ï¼ˆå°†å…¶æè¿°ä¸ºç‰©ç†å…³ç³»ï¼‰å’Œ<b>pg_index</b>ä¸­çš„è®°å½•ï¼ˆåŒ…å«æœ‰å…³ç´¢å¼•çš„ç‰¹å®šç‰¹å¾çš„æ•°æ®ï¼‰çš„ç»„åˆã€‚ å¦å¤–ï¼Œæœ‰å…³ç´¢å¼•è®¿é—®æ–¹æ³•çš„ä¿¡æ¯å­˜å‚¨åœ¨pg_amç³»ç»Ÿç›®å½•ä¸­ã€‚ </p><br><pre> <code class="sql hljs">CASE inxam.amcanorder WHEN true THEN CASE inx.indoption[inx.No] &amp; 1 WHEN 1 THEN ' DESC' ELSE ' ASC' <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre><br><p>  <b>æå–</b>ç´¢å¼•å”¯ä¸€æ€§<b>çš„</b>å±æ€§ï¼ˆ <b>indisunique</b> ï¼‰ï¼Œæ ¹æ®ä¸»é”®çš„æè¿°ï¼ˆ <b>indisprimary</b> ï¼‰æ„é€ ç´¢å¼•çš„æ ‡å¿—ä»¥åŠè¡¨å±æ€§çš„åºåˆ—å·æ•°ç»„ï¼Œå¹¶æ ¹æ®è¿™äº›å€¼ä»<b>pg_index</b>ç›®å½•<b>æ¡ç›®</b>ä¸­æå–ç´¢å¼•ï¼ˆ <b>indkey</b> ï¼‰çš„å€¼å’Œæ’åºå±æ€§å€¼çš„é¡ºåºçš„æ ‡å¿—åœ¨ç´¢å¼•ï¼ˆ <b>indoption</b> ï¼‰ä¸­ã€‚ </p><br><p> ä»æè¿°<b>pg_am</b>ç´¢å¼•çš„è®¿é—®æ–¹æ³•çš„ç›®å½•æ¡ç›®ä¸­ï¼Œ <b>æå–</b>ç´¢å¼•ä¸­åŒ…å«çš„æ•°æ®çš„é€‚ç”¨æ€§å±æ€§ï¼ˆ <b>amcanorder</b> ï¼‰å’Œç´¢å¼•ï¼ˆ <b>amname</b> ï¼‰çš„è®¿é—®æ–¹æ³•çš„åç§°æˆ–ç±»å‹ã€‚ </p><p></p><p> æ¢å¥è¯è¯´ï¼Œamcanorderå±æ€§æŒ‡ç¤ºæ˜¯å¦å¯ä»¥ä¸ºç´¢å¼•ä¸­åŒ…å«çš„å±æ€§çš„å€¼å»ºç«‹æ’åºé¡ºåºã€‚ å¦‚æœ<b>amcanorder = true</b> ï¼Œåˆ™å¯ä»¥æŒ‡å®šæ’åºé¡ºåºï¼Œå¦åˆ™å¯ä»¥ä¸æŒ‡å®šã€‚ ä»åŒä¸€å›¾ä¸­<b>å¯ä»¥çœ‹åˆ°indoption</b>æ•°ç»„çš„å€¼çš„å«ä¹‰-å¦‚æœè¯¥å€¼çš„äºŒè¿›åˆ¶å½¢å¼çš„å³ä½åŒ…å«1Bï¼Œåˆ™ç›¸åº”å±æ€§çš„å€¼æŒ‰é™åºæ’åºï¼Œå¦åˆ™-å‡åºã€‚ </p><br><p> åŒ…å«åœ¨ç´¢å¼•ä¸­çš„å±æ€§åç§°åˆ—è¡¨ä»¥åŠå±æ€§å€¼é¡ºåºçš„ç¬¦å·æ˜¯ä½¿ç”¨å¾ªç¯åœ¨å‡½æ•°å†…éƒ¨å½¢æˆçš„ã€‚ </p><br><br>  <strong>è¡¨9.æ‰§è¡Œadmtf_Table_Indexeså‡½æ•°ï¼ˆâ€œ publicâ€ï¼Œâ€œ Streetâ€ï¼‰çš„ç»“æœã€‚</strong> <strong><br></strong> <br><img src="https://habrastorage.org/webt/u0/ft/uz/u0ftuzwae5ew1anmkqwjgvqlrbg.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­è¡¨æ ¼çš„æ–‡æœ¬ç‰ˆæœ¬</b> <div class="spoiler_text"><table width="95" border="1"><tbody><tr><th width="15"> ç´¢å¼•åç§° </th><th width="5"> æ–¹æ³• </th><th width="5">  ï¼Ÿ ç‹¬ç‰¹çš„ </th><th width="5">  ï¼Ÿ ä¸»é”® </th><th width="20"> ç´¢å¼•ä¸­çš„å±æ€§ </th></tr><tr><td width="15">  xie1street </td><td width="5"> æ ‘ </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="20">  wcrccode ASCï¼Œlocalidid ASCï¼Œstreettypeacrm ASCï¼Œè¡—é“åç§°ASC </td></tr><tr><td width="15">  xie2stree </td><td width="5"> æ ‘ </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="20">  wcrccode ASCï¼Œlocalidid ASCï¼Œè¡—é“åç§°ASC </td></tr><tr><td width="15">  xie3street </td><td width="5"> æ ‘ </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="20"> è¡—é“åç§°ASC </td></tr><tr><td width="15">  xie9street </td><td width="5"> æ ‘ </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="20">  wcrccode ASCï¼Œlocalidid ASCï¼Œè¡—é“åç§°DESC </td></tr><tr><td width="15">  xpkstreet </td><td width="5"> æ ‘ </td><td width="5">  Å¤ </td><td width="5">  Å¤ </td><td width="20">  wcrccode ASCï¼Œlocalidid ASCï¼Œstreetid ASC </td></tr><tr><td width="15">  xts1street </td><td width="5"> æœæ¾å­é…’ </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="20">  streettsvector </td></tr><tr><td width="15">  xts2street </td><td width="5"> æœæ¾å­é…’ </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="5">  streettsvector </td></tr></tbody></table><br></div></div><br><h4> æ²¡æœ‰å…‰æ ‡çš„ç‰ˆæœ¬ </h4><br><p> åˆ›å»ºæ²¡æœ‰æ¸¸æ ‡çš„å‡½æ•°ç‰ˆæœ¬çš„æ–¹æ³•ä¸ä¸Šä¸€èŠ‚æ‰€è¿°å®Œå…¨ç›¸åŒï¼š </p><br><ul><li> ä½¿ç”¨generate_subscriptså¤åˆ¶è®°å½•ï¼› </li><li> éšåçš„è®°å½•åˆ†ç»„ï¼› </li><li> ä½¿ç”¨STRING_AGGå‡½æ•°å’ŒORDER BYé€‰é¡¹åˆ›å»ºç´¢å¼•å±æ€§åˆ—è¡¨ã€‚ </li></ul><br><img src="https://habrastorage.org/webt/7f/3y/bm/7f3ybmq5e8bd7auydle70utg8-k.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­æ“ä½œå‘˜çš„æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> inxcls.relname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_IndexName ,inxam.amname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_IndexType, inx.indisunique <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_isUnique,inx.indisprimary <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_isPrimary, STRING_AGG(attr.attname|| <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> inxam.amcanorder <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> inx.indoption[inx.No] &amp; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">' DESC'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">' ASC'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>, c_Delimiter <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> inx.No) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> i.indrelid, i.indexrelid,i.indisunique,i.indisprimary, i.indkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],i.indoption::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[], generate_subscripts(i.indkey, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_index i) inx <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class inxcls <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inx.indexrelid=inxcls.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_am inxam <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inxcls.relam=inxam.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inx.indrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute <span class="hljs-keyword"><span class="hljs-keyword">attr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> attr.attrelid=tbl.OID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> attr.attnum=inx.indkey[inx.No] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableName) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> inxcls.relname,inxam.amname,inx.indisunique,inx.indisprimary <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> inxcls.relname;</code> </pre><br></div></div><br><br><p> ä¸¤ä¸ªåŠŸèƒ½ç‰ˆæœ¬çš„æ‰§è¡Œæ—¶é—´ä¸€è‡´ï¼Œæˆ‘èŠ±äº†20æ¯«ç§’å°†ç»“æœè¡¨ä¸­çš„æ•°æ®è¾“å‡ºã€‚ </p><br><p> å› æ­¤ï¼Œæˆ‘å°†ä¸å†äº§ç”Ÿå‡½æ•°ç‰ˆæœ¬ï¼Œå› ä¸º é‚£äº›å¸Œæœ›å¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œå¥½<b>è¿›è¡Œæ›´æ”¹</b>æˆ–<b>ä¸æˆ‘è”ç³»çš„äººï¼Œæˆ‘å°†å…è´¹å‘é€ä¿®æ”¹åçš„ç‰ˆæœ¬</b> ã€‚ </p><p>  <b>å¦è¯·å‚è§æœ¬æ–‡çš„</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸‰</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬å››</a>éƒ¨åˆ†ã€‚ </p><br><a name="Script2"></a><br><h2> é™„å½•1.è„šæœ¬ </h2><br><a name="tfTableC"></a><br><h3> åˆ›å»ºadmtf_Table_Constrainteså‡½æ•° </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰å…³åŠŸèƒ½æºä»£ç çš„æ³¨é‡Šï¼Œè¯·å‚è§æ­¤å¤„ã€‚</a> <br><div class="spoiler">  <b class="spoiler_title">å‡½æ•°æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Constraintes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Constraintes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_ConstraintName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_ConstraintType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_ConstraintKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,r_RefTableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_RefTableKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,r_ConstraintSource <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_Scale <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_ConstraintRec RECORD; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_ConstraintOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_ConstraintKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_ConstraintName name; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_ConstraintType name; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_isUnique BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_isPrimary BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*      Primary KEY */</span></span> v_AttributeNum INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_AttributeName name; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_ConstraintKeyNames TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_RefTableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID ,     */</span></span> v_RefTableName name;<span class="hljs-comment"><span class="hljs-comment">/*  ,     */</span></span> v_RefTableKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_RefTableKeyNames TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     ,    */</span></span> v_ConstraintSource TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     CHECK*/</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN FOR v_ConstraintRec IN SELECT con.oid AS ConstraintOID ,tbl.OID AS TableOID, con.conname AS ConstraintName, con.contype AS ConstraintType, con.conkey AS ConstraintKeyNos, reftbl.OID AS RefTableOID, reftbl.relname AS RefTableName, con.confkey AS RefTableKeyNos, con.consrc AS ConstraintSource FROM pg_constraint con INNER JOIN pg_class tbl ON con.conrelid=tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid LEFT OUTER JOIN pg_class reftbl ON con.confrelid=reftbl.oid WHERE LOWER(nsp.nspname)=LOWER(a_SchemaName) AND LOWER(tbl.relname)=LOWER(a_TableName) ORDER BY con.contype DESC,con.conname LOOP v_ConstraintOID:=v_ConstraintRec.ConstraintOID; v_TableOID:=v_ConstraintRec.TableOID; v_ConstraintName:=v_ConstraintRec.ConstraintName; v_ConstraintType:=v_ConstraintRec.ConstraintType; v_ConstraintKeyNos:=v_ConstraintRec.ConstraintKeyNos; v_RefTableOID:=v_ConstraintRec.RefTableOID; v_RefTableName:=v_ConstraintRec.RefTableName; v_RefTableKeyNos:=v_ConstraintRec.RefTableKeyNos; v_ConstraintSource:=v_ConstraintRec.ConstraintSource; v_ConstraintKeyNames:=''; FOREACH v_AttributeNum IN ARRAY v_ConstraintKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_TableOID AND attr.attnum=v_AttributeNum; v_ConstraintKeyNames:=v_ConstraintKeyNames|| CASE WHEN v_ConstraintKeyNames='' THEN '' ELSE c_Delimiter END ||v_AttributeName; END LOOP; v_RefTableKeyNames:=''; IF v_RefTableKeyNos IS NOT NULL THEN FOREACH v_AttributeNum IN ARRAY v_RefTableKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_RefTableOID AND attr.attnum=v_AttributeNum; v_RefTableKeyNames:=v_RefTableKeyNames|| CASE WHEN v_RefTableKeyNames='' THEN '' ELSE c_Delimiter END ||v_AttributeName; END LOOP; END IF; RETURN QUERY SELECT v_ConstraintName,v_ConstraintType,v_ConstraintKeyNames, v_RefTableName,v_RefTableKeyNames, v_ConstraintSource; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Constraintes(a_SchemaName NAME, a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Constraintes (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /********************************************************************************************************/ /*      */ /********************************************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Constraintes (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_ConstraintName VARCHAR(256),r_ConstraintType VARCHAR(256),r_ConstraintKeyNames Text,r_RefTableName VARCHAR(256),r_RefTableKeyNames Text,r_ConstraintSource Text) AS $BODY$ DECLARE --****************************************************************************************************** BEGIN RETURN QUERY SELECT tc.r_ConstraintName::VARCHAR(256), tc.r_ConstraintType::VARCHAR(256),tc.r_ConstraintKeyNames::TEXT, tc.r_RefTableName::VARCHAR(256),tc.r_RefTableKeyNames::TEXT, tc.r_ConstraintSource::TEXT FROM admtf_Table_Constraintes(a_SchemaName::NAME,a_TableName::NAME) tc; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Constraintes(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Constraintes('public'::VARCHAR(256),'Street'::VARCHAR(256)); SELECT * FROM admtf_Table_Constraintes('public'::name,'Street'::name);</span></span></code> </pre><br></div></div><br><a name="tfTableC_woc"></a><br><h3> åˆ›å»ºæ²¡æœ‰æ¸¸æ ‡çš„admtf_Table_Constraintesç‰ˆæœ¬ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰å…³åŠŸèƒ½æºä»£ç çš„æ³¨é‡Šï¼Œè¯·å‚è§æ­¤å¤„ã€‚</a> <br><div class="spoiler">  <b class="spoiler_title">å‡½æ•°æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Constraintes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Constraintes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_ConstraintName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_ConstraintType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_ConstraintKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,r_RefTableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_RefTableKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,r_ConstraintSource <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_Scale <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_ConstraintRec RECORD; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_ConstraintOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_ConstraintKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_ConstraintName name; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_ConstraintType name; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_isUnique BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_isPrimary BOOLEAN;<span class="hljs-comment"><span class="hljs-comment">/*      Primary KEY */</span></span> v_AttributeNum INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_AttributeName name; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_ConstraintKeyNames TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_RefTableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID ,     */</span></span> v_RefTableName name;<span class="hljs-comment"><span class="hljs-comment">/*  ,     */</span></span> v_RefTableKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_RefTableKeyNames TEXT;<span class="hljs-comment"><span class="hljs-comment">/*     ,    */</span></span> v_ConstraintSource TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     CHECK*/</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN FOR v_ConstraintRec IN SELECT con.oid AS ConstraintOID , tbl.OID AS TableOID, con.conname AS ConstraintName, con.contype AS ConstraintType, con.conkey AS ConstraintKeyNos, reftbl.OID AS RefTableOID, reftbl.relname AS RefTableName, con.confkey AS RefTableKeyNos, con.consrc AS ConstraintSource FROM pg_constraint con INNER JOIN pg_class tbl ON con.conrelid=tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid LEFT OUTER JOIN pg_class reftbl ON con.confrelid=reftbl.oid WHERE LOWER(nsp.nspname)=LOWER(a_SchemaName) AND LOWER(tbl.relname)=LOWER(a_TableName) ORDER BY con.contype DESC,con.conname LOOP v_ConstraintOID:=v_ConstraintRec.ConstraintOID; v_TableOID:=v_ConstraintRec.TableOID; v_ConstraintName:=v_ConstraintRec.ConstraintName; v_ConstraintType:=v_ConstraintRec.ConstraintType; v_ConstraintKeyNos:=v_ConstraintRec.ConstraintKeyNos; v_RefTableOID:=v_ConstraintRec.RefTableOID; v_RefTableName:=v_ConstraintRec.RefTableName; v_RefTableKeyNos:=v_ConstraintRec.RefTableKeyNos; v_ConstraintSource:=v_ConstraintRec.ConstraintSource; v_ConstraintKeyNames:=''; FOREACH v_AttributeNum IN ARRAY v_ConstraintKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_TableOID AND attr.attnum=v_AttributeNum; v_ConstraintKeyNames:=v_ConstraintKeyNames|| CASE WHEN v_ConstraintKeyNames='' THEN '' ELSE c_Delimiter END ||v_AttributeName; END LOOP; v_RefTableKeyNames:=''; IF v_RefTableKeyNos IS NOT NULL THEN FOREACH v_AttributeNum IN ARRAY v_RefTableKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_RefTableOID AND attr.attnum=v_AttributeNum; v_RefTableKeyNames:=v_RefTableKeyNames|| CASE WHEN v_RefTableKeyNames='' THEN '' ELSE c_Delimiter END ||v_AttributeName; END LOOP; END IF; RETURN QUERY SELECT v_ConstraintName,v_ConstraintType,v_ConstraintKeyNames, v_RefTableName,v_RefTableKeyNames, v_ConstraintSource; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Constraintes(a_SchemaName NAME, a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Constraintes (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /********************************************************************************************************/ /*      */ /********************************************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Constraintes (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_ConstraintName VARCHAR(256),r_ConstraintType VARCHAR(256),r_ConstraintKeyNames Text,r_RefTableName VARCHAR(256),r_RefTableKeyNames Text,r_ConstraintSource Text) AS $BODY$ DECLARE --****************************************************************************************************** BEGIN RETURN QUERY SELECT tc.r_ConstraintName::VARCHAR(256), tc.r_ConstraintType::VARCHAR(256), tc.r_ConstraintKeyNames::TEXT, tc.r_RefTableName::VARCHAR(256), tc.r_RefTableKeyNames::TEXT, tc.r_ConstraintSource::TEXT FROM admtf_Table_Constraintes(a_SchemaName::NAME,a_TableName::NAME) tc; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Constraintes(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Constraintes('public'::VARCHAR(256),'Street'::VARCHAR(256)); SELECT * FROM admtf_Table_Constraintes('public'::name,'Street'::name);</span></span></code> </pre><br></div></div><br><a name="tfTableI"></a><br><h3> åˆ›å»ºadmtf_Table_Indexeså‡½æ•° </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰å…³åŠŸèƒ½æºä»£ç çš„æ³¨é‡Šï¼Œè¯·å‚è§æ­¤å¤„ã€‚</a> <br><div class="spoiler">  <b class="spoiler_title">å‡½æ•°æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Indexes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Indexes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_IndexName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_IndexType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_isUnique <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,r_isPrimary <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>, r_IndexKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_IndexKind <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>:=<span class="hljs-string"><span class="hljs-string">'i'</span></span>; v_IndexRec RECORD; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_Scale INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_IndexOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_IndexKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_IndexName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_IndexAMName NAME; <span class="hljs-comment"><span class="hljs-comment">/*    ( ) */</span></span> v_isUnique BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_isPrimary BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*      Primary KEY */</span></span> v_AttributeNum INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_AttributeName NAME; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_IndexKeyNames TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN FOR v_IndexRec IN SELECT inxcls.oid AS IndexOID,tbl.oid AS TableOID, inxcls.relname AS IndexName,inxam.amname AS IndexAMName, inx.indisunique AS isUnique,inx.indisprimary isPrimary, inx.indkey::SMALLINT[] AS IndexKeyNos FROM pg_index inx INNER JOIN pg_class inxcls ON inx.indexrelid=inxcls.oid INNER JOIN pg_am inxam ON inxcls.relam=inxam.oid INNER JOIN pg_class tbl ON inx.indrelid=tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid WHERE LOWER(nsp.nspname)=LOWER(a_SchemaName) AND inxcls.relkind=c_IndexKind AND tbl.relname=LOWER(a_TableName) ORDER BY inxam.amname, inxcls.relname LOOP v_IndexOID:=v_IndexRec.IndexOID; v_TableOID:=v_IndexRec.TableOID; v_IndexName:=v_IndexRec.IndexName; v_IndexAMName:=v_IndexRec.IndexAMName; v_isUnique:=v_IndexRec.isUnique; v_isPrimary:=v_IndexRec.isPrimary; v_IndexKeyNos:=v_IndexRec.IndexKeyNos; v_IndexKeyNames:=''; FOREACH v_AttributeNum IN ARRAY v_IndexKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_TableOID AND attr.attnum=v_AttributeNum; v_IndexKeyNames:=v_IndexKeyNames|| CASE WHEN v_IndexKeyNames='' THEN '' ELSE c_Delimiter||' ' END || v_AttributeName; END LOOP; RETURN QUERY SELECT v_IndexName,v_IndexAMName,v_isUnique, v_isPrimary,v_IndexKeyNames; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Indexes(a_SchemaName NAME, a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Indexes (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /********************************************************************************************************/ /*      */ /********************************************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Indexes (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_IndexName VARCHAR(256),r_IndexType VARCHAR(256),r_isUnique BOOLEAN,r_isPrimary BOOLEAN, r_IndexKeyNames TEXT) AS $BODY$ DECLARE --****************************************************************************************************** BEGIN RETURN QUERY SELECT ti.r_IndexName::VARCHAR(256), ti.r_IndexType::VARCHAR(256), ti.r_isUnique::BOOLEAN, ti.r_isPrimary::BOOLEAN, ti.r_IndexKeyNames::TEXT FROM admtf_Table_Indexes(a_SchemaName::NAME,a_TableName::NAME) ti; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Indexes(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Indexes('public'::NAME,'Street'::NAME); SELECT * FROM admtf_Table_Indexes('public'::VARCHAR(256),'Street'::VARCHAR(256));</span></span></code> </pre><br></div></div><br><a name="tfTableI_woc"></a><br><h3> åˆ›å»ºæ²¡æœ‰æ¸¸æ ‡çš„admtf_Table_Indexesç‰ˆæœ¬ </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Indexes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Indexes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_IndexName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_IndexType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_isUnique <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,r_isPrimary <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>, r_IndexKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_IndexKind <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>:=<span class="hljs-string"><span class="hljs-string">'i'</span></span>; c_Delimiter CONSTANT VARCHAR(2):=', '; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN RETURN QUERY SELECT inxcls.relname AS r_IndexName, inxam.amname AS r_IndexType, inx.indisunique AS r_isUnique, inx.indisprimary r_isPrimary, STRING_AGG(attr.attname||CASE inxam.amcanorder WHEN true THEN CASE inx.indoption[inx.No] &amp; 1 WHEN 1 THEN ' DESC' ELSE ' ASC' END ELSE '' END, c_Delimiter ORDER BY inx.No) FROM (SELECT i.indrelid, i.indexrelid,i.indisunique, i.indisprimary,i.indkey::SMALLINT[], i.indoption::SMALLINT[], generate_subscripts(i.indkey, 1) as No FROM pg_index i) inx INNER JOIN pg_class inxcls ON inx.indexrelid=inxcls.oid INNER JOIN pg_am inxam ON inxcls.relam=inxam.oid INNER JOIN pg_class tbl ON inx.indrelid=tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid INNER JOIN pg_attribute attr ON attr.attrelid=tbl.OID AND attr.attnum=inx.indkey[inx.No] WHERE LOWER(nsp.nspname)=LOWER(a_SchemaName) AND inxcls.relkind=c_IndexKind AND tbl.relname=LOWER(a_TableName) GROUP BY inxcls.relname,inxam.amname,inx.indisunique,inx.indisprimary ORDER BY inxcls.relname; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Indexes(a_SchemaName NAME, a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Indexes (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /********************************************************************************************************/ /*      */ /********************************************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Indexes (a_SchemaName VARCHAR(256) default 'public', /*    */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_IndexName VARCHAR(256),r_IndexType VARCHAR(256),r_isUnique BOOLEAN,r_isPrimary BOOLEAN, r_IndexKeyNames TEXT) AS $BODY$ DECLARE --****************************************************************************************************** BEGIN RETURN QUERY SELECT ti.r_IndexName::VARCHAR(256), ti.r_IndexType::VARCHAR(256), ti.r_isUnique::BOOLEAN, ti.r_isPrimary::BOOLEAN, ti.r_IndexKeyNames::TEXT FROM admtf_Table_Indexes(a_SchemaName::NAME,a_TableName::NAME) ti; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Indexes(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Indexes('public'::NAME,'Street'::NAME); SELECT * FROM admtf_Table_Indexes('public'::VARCHAR(256),'Street'::VARCHAR(256));</span></span></code> </pre><br></div></div><br><h3> å¦è¯·å‚é˜… </h3><br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     PostgreSQL.  </a> ;</b> <br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     PostgreSQL.  </a> .</b> <br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     PostgreSQL. ( )</a> .</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN415897/">https://habr.com/ru/post/zh-CN415897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN415881/index.html">JSçš„å·¥ä½œæ–¹å¼ï¼šShadow DOMæŠ€æœ¯å’ŒWebç»„ä»¶</a></li>
<li><a href="../zh-CN415887/index.html">ä»€ä¹ˆæ ·çš„èœ˜è››æœºå™¨äººé£è¶Šä½“è‚²åœºå¹¶å°„å‡»è¶³çƒã€‚ é‡‡è®¿Robycamçš„åˆ›é€ è€…</a></li>
<li><a href="../zh-CN415891/index.html">æœ‰å“ªäº›ç»­é›†æ¸¸æˆå¾ˆæ£’ï¼Ÿ</a></li>
<li><a href="../zh-CN415893/index.html">å¦‚ä½•ä½¿åœ¨Linux / Dockerä¸Šè¿è¡Œçš„Javaæµç¨‹ç®€å•æ˜äº†</a></li>
<li><a href="../zh-CN415895/index.html">ç¼–ç¨‹ä¸­æœ€é‡è¦çš„æ¨¡å¼</a></li>
<li><a href="../zh-CN415899/index.html">Office 365 Outlookæ‰¾åˆ°æœªè®°å½•çš„APIï¼Œå…¶ä¸­åŒ…å«è¯¦ç»†çš„ç”¨æˆ·æ´»åŠ¨æ—¥å¿—</a></li>
<li><a href="../zh-CN415901/index.html">è”é‚¦å§”å‘˜ä¼šå§”å‘˜ä¼šæ”¯æŒä¸ºæ‰€æœ‰ç™½è‰²ç”µè¯åˆ›å»ºIMEIåŸºåœ°çš„æƒ³æ³•</a></li>
<li><a href="../zh-CN415903/index.html">æ¬¢è¿å‚åŠ 7æœˆ7æ—¥å¤å­£çš„DIYorDIEèšä¼š</a></li>
<li><a href="../zh-CN415905/index.html">å¦‚ä½•ç§æ¤å¥åº·çš„äº§å“ï¼ˆJunoç¤ºä¾‹ï¼‰</a></li>
<li><a href="../zh-CN415907/index.html">å¦‚ä½•åœ¨ä¸å†’å…¬å¸å½¢è±¡é£é™©çš„å‰æä¸‹è§£é›‡å‘˜å·¥</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>