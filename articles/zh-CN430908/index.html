<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍⚖️ 🖌️ 🛀🏽 功率转换器控制模块：开发和组装 ⚠️ 👩🏾‍🎤 🥡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="复杂的现代转换器（例如在线UPS）在DSP / MK或ASIC的控制下运行已不是什么秘密。 电力电子DSP的主要供应商是两家公司-德州仪器（TI）和英飞凌（Infineon），但今天我们将重点关注意法半导体（STM）的产品-STM32F334系列。 该MK线旨在控制电驱动器并构建功率转换器：PFC，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>功率转换器控制模块：开发和组装</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430908/"> 复杂的现代转换器（例如在线UPS）在DSP / MK或ASIC的控制下运行已不是什么秘密。 电力电子DSP的主要供应商是两家公司-德州仪器（TI）和英飞凌（Infineon），但今天我们将重点关注意法半导体（STM）的产品-STM32F334系列。 该MK线旨在控制电驱动器并构建功率转换器：PFC，逆变器，开关电源，UPS等。 <br><br> 当然，F334系列无法承受TMS320F28335等热门解决方案的“功能”，但它具有一个重要优势-成本。 最老的石头STM32F334R8T6的价格为5美元，具有板载必要的外围设备（HRPWM，ADC，比较器）和性能，以构建足够强大的转换器（数十kW），并具有良好的可靠性和耐故障性。 <br><br> 对于电子开发人员来说，与他一起工作的DSP / MK周围的生态系统非常重要：文档，调试工具，代码示例和硬件。  TI拥有所有这些，是的-价格昂贵，是的-很难购买，但这就是为什么电力驱动和能源领域的大多数现代解决方案都花费TMS320的原因。 由于某种原因，ST公司忽略了F334系列，尽管像任何STM32上都有高质量的文档，但是没有硬件示例带有完整代码和调试板的情况（不考虑F3348-Disco玩具）。 好吧-我们将纠正此缺陷。 <br><br> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上一篇文章中，</a>我谈到了我的项目“开发人员套件”，甚至还演示了其中一个组件-电源模块。 今天，我将讨论第二个模块（总共3个），该模块使您可以实现任何转换器拓扑，同时成本比竞争对手便宜几倍。 该项目当然是开放的，所有源代码都可以在本文结尾处找到。 <br><br> <a href=""><img src="https://habrastorage.org/webt/9g/c7/oi/9gc7oiynuaziphnssxpsk-5qu88.jpeg"></a> <br><a name="habracut"></a><br><h2> 主意 </h2><br> 我不是第一个考虑使用通用模块的人，在此基础上，您可以构建具有不同拓扑变体的各种转换器。 这种方法使您可以在所有场合使用一块板，并且最重要的是-减少了代码量，因为模块是相同的，一旦配置并忘记了。 <br><br> 现在，让我们看几个其他人/公司如何实施此想法的示例。 我仅举两个例子： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TMS320F28379D控制卡</a> -价格160美元。 生态系统非常好，有调试复杂的系统，但是价格昂贵……如果您在繁荣的研发中心工作，并且决定自己创建UPS或在公司工作更容易，它就很小了？ 是的，模块要花160美元才能刻录，在我看来，每个人都会后悔的； </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">VectorCARD K1921VK01T</a>是一个出色的解决方案， <s>研究机构和军事工业园区的</s>人们都为国产石材感到欣喜，有一个以chastotnik形式，带有ti模块的模拟（引脚对引脚）形式的调试系统，但价格为19,000卢布。 对于苛刻的国内工业和军事工业来说，它很便宜，但对于其余的来说，价格却不高。 </li></ul><br> 因此，我想做的是...一个可以同时用作调试工具和小系列组件的模块。 从这里我积累了一些要求： <br><br><ul><li>  HRPWM和快速ADC的存在 </li><li> 板载RS-485 </li><li> 具有输出到显示连接器的UART（与Nextion兼容） </li><li> 在逻辑上实现硬件保护 </li><li>  12V电源，可将一个“ AC / DC至12V”模块用于“大脑”和电源部分驱动器 </li><li> 其价格至少比TMS320F28379D控制卡的价格低3倍，即最高为50美元 </li><li> 散热器温度传感器输入 </li><li> 几个GPIO，例如继电器拉 </li><li> 输入和输出同步信号，以便多个设备可以并行工作 </li></ul><br> 结果，我们得到了这样的结构图： <br><br><img src="https://habrastorage.org/webt/03/2z/wa/032zwaxrxeunuf8she5zuzqs_yu.png"><br><br> 应当立即指出，我还设法显着降低了模块的成本。 我订购了5个板的组件，这些组件的成本约为70美元，即每个模块14美元。 在这里，真相是一个窍门-这是所有组件的成本，但没有印刷电路板。 算术很简单：在4层中订购5个板的成本为80-100美元，也就是说，每个模块又要14-20美元，这不是人道吗？ 数量为100块时，电路板的成本已经是1.5美元/块，因此在可预见的将来，我计划订购100-200块电路板（我会看到它会变得更便宜），那些希望有机会购买比14美元便宜许多倍的电路板的人。 那些需要20-30板或100美元的人不会打扰您，您已经可以自己订购，因为这里也会准备好非洲菊。 <br><br><h2> 发展历程 </h2><br> 模块的电路没有什么复杂和不可理解的，一开始我建议您打开电路图，以便了解其含义，然后我将讨论上面的框图如何变成现成的解决方案。 您可以在此处下载该图<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-PDF</a> 。 <br><br><ul><li> 该模块具有1个“主连接器”，其中12 V电源，几个GPIO，一个附加UART（突然要固定ESP），RS-485和用于同步设备的输入/输出连接到12针； </li><li> 有5个频道，所有频道都完全相同。 互补的高结果PWM（HRPWM）对可让您控制半桥，并输出到每个通道。 另外，还有2个ADC通道用于实现电流和电压反馈，并在蛋糕上大放异彩-错误输入（故障）。 例如，功率单元发生短路，比较器检测到电流过大并发出日志。  1表示发生事故，因此在此输入上加“ 1”会中断设备的操作； </li><li> 来自故障输入的错误信号到达2个位置：到达微控制器的BKIN输入，并通过逆变器到达AND逻辑元件的输入。  BKIN输入也是一种硬件保护，即使MK挂起，它也将关闭PWM生成，但是我想安全起见，并添加了更多逻辑以确保肯定会中断信号。 </li><li> 在模块上，单独的CWF-4连接器显示SWD接口以方便调试，并提供UART和电源以将显示或与其他模块的通信连接到第二个连接器。  Nextion显示器现在很流行，因此设计了用于它们的连接器，并且我还用相似的通信方法（UART，+ 5D，GND）来制作HMI面板。 </li><li> 该评估板包含用于RS485接口的PHY，并带有终端电阻和ESD保护。 之所以选择该接口，是因为它在任何地方，因为它是行业标准。 例如，您要将逆变器与柴油机结合使用，那么发送/接收命令将很方便。 是的，在任何PLC中也都有RS485； </li><li> 我还安装了一个小的非易失性存储器来存储设置或其他有用的东西。 </li></ul><br> 该电路图最终变成了一块尺寸为115x40 mm的4层印刷电路板。 原则上，您可以将版本分为2层，但是尺寸会增加。 对于我来说，重要的是获得不超过40毫米的宽度，以便在安装到PBD连接器中后，总高度为47-50毫米-电解电容器的尺寸为35x50毫米。 该板看起来如下： <br><br><img src="https://habrastorage.org/webt/uz/jx/3i/uzjx3iusy9jdule7wgi4jqbwpam.png"><br><br> 不幸的是，当我订购这些板卡时，我用黑色的口罩代替了绿色的口罩，这是该修订版的主要惨败。）谁不知道模块的插入方式，建议在这里查看： <br><br><img src="https://habrastorage.org/webt/gr/xb/fv/grxbfvxy7dy2xlm2ravmfxsa0q8.png"><br><img src="https://habrastorage.org/webt/l4/0x/uu/l40xuui5cgg_bbv-7gfuxccokvk.png"><br><br> 在第一张图片中，您还可以注意到某个带有多个连接器的板，尤其是没有组件的板。 这就像一个“主板”，可以更方便地进行原型制作。  BH-10连接器（IDC-10）分配相同的5个控制通道+通讯接口显示在接线盒上，并安装了电源连接器。 所有这些使您不必集体耕作一堆电线。  “主板”是单独订购的，因此它们将稍后发布，并且在经过验证后将提供可用资源。 <br><br><h2> 组装方式 </h2><br> 至于先前的模块，则从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PCBway</a>订购PCB，为这些人员提供了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">空</a>板和另一个模板。 后者极大地简化了我的生活并节省了时间，在1小时内组装了5块带有200多个组件的电路板。 订购后两周，快递员给我带来了这样的魅力： <br><br> <a href=""><img src="https://habrastorage.org/webt/xa/wi/sx/xawisxqwzw5abcj-ukog6hjqujc.jpeg"></a> <br> <a href=""><img src="https://habrastorage.org/webt/r-/nf/hj/r-nfhjbb16thnuhgt-zmep52xkk.jpeg"></a> <br><br> 是的，我没有按订购表格更改口罩，但是显​​然我感觉这很<s>烫手，把手</s>上浸有浸金，所以我不会感到难过。 这对我的任务不是很关键，但是由于触点的出色平面性，即使炉子的温度分布不是非常理想，焊锡膏也可以更均匀地施加，并且各个部件不会粘到侧面。 <br><br> 模板订购时带有铝型材框架，如 我有一台丝网印刷机，但是没有框架，无法将其固定在那里。 如果您没有打印机，那么订购时将没有边框：您可以粘贴（需要花几分钟的时间）并且仍然可以省钱，因为 不带框架的模板的重量约为400 g，带框架的模板的重量为1.8 kg。 由于这种重量，您将立即以快递方式收到，因为 邮件携带的重量不超过2公斤，仅EMS且您需要多付30-40美元，因此请记住。 模具本身看起来像这样： <br><br><img src="https://habrastorage.org/webt/fi/k5/8j/fik58jmpi_0uhw2ckugbitgz7ac.jpeg"><br><br> 现在，您需要将电路板安装在打印机中并粘贴。 这里有一些技巧。 首先，如果您在速卖通上取糊状，那么只有500克罐装，这是罐中质量最好的（显然他们正确地存储了）。 其次，将糊状物放在冰箱中。 第三，使用完模板后，请务必将其从浆糊中洗掉，用普通的海绵和一滴清洁剂（最好是仙女）会产生奇迹，然后干燥模板并将其干燥后包裹在保鲜膜中（如果您未使用一周以上）。 将粘贴在板上： <br><br><img src="https://habrastorage.org/webt/rs/s9/ca/rss9cakfsxvz27c2w5ap3yye0-w.jpeg"><br><br> 应用后，我们得到以下工件： <br><br> <a href=""><img src="https://habrastorage.org/webt/zx/ip/9-/zxip9-lyzimjnlrjotr70zbco5w.jpeg"></a> <br><br> 在这个阶段，我要放心：我删除了STM32F334R8T6微控制器下LQFP-64机箱的粘贴。 事实是，我可以在某个地方拧紧电源系统，并且+ 12V可能会在MK上燃烧并烧毁，但我不想花5美元破坏石头。 因此，除了微控制器，连接器和蜂鸣器外，我在此阶段焊接所有东西。 检查电压+ 3.3V和+ 5V后，我将手动安装它们。 现在最无聊的阶段是安装组件，但是我打算尽快购买一个取放机器，我只会喝咖啡）） <br><br> <a href=""><img src="https://habrastorage.org/webt/ci/vc/mm/civcmm38nxv2qugip9c7wfh9jkw.jpeg"></a> <br><br> 组件已安装，现在我们将它们发送到烤箱： <br><br><img src="https://habrastorage.org/webt/do/nb/qt/donbqt4cduxndyanfyd-azxncfq.jpeg"><br><br> 现在仍然需要检查输出dc / dc上的电压水平，如果一切正常，然后用烙铁/吹风机焊接其余组件，然后去掉助焊剂残留物，以得到以下结果： <br><br> <a href=""><img src="https://habrastorage.org/webt/9g/c7/oi/9gc7oiynuaziphnssxpsk-5qu88.jpeg"></a> <br><br> 我们与一名程序员联系，例如，一个中国口哨st-link，但我强烈建议您购买具有电流隔离功能的坚固st-link v.2-ISOL。 一切都与具有备份的管理员一样： <i>“有些人已经烧掉了笔记本电脑并开始使用隔离器，而其他人尚未开始使用隔离器</i> 。 <i>”</i> 如果本地st-link上的价格标签令您感到恐惧，也就是说，可以选择在Ali上与中国哨子和绝缘子模块一起购买，它们通常在ADuM-ah上实现。 为了在调试器连接时不被引脚折磨，我做了一根软线来连接这些特定的模块，现在在连接时我绝对不会出错： <br><br><img src="https://habrastorage.org/webt/38/l5/im/38l5imu1afhppadaxmrtfwiark4.jpeg"><br><br> 剩下的工作是检查模块是否准备就绪，是否可以读取MK，以便可以安全地开始编写代码。 为此，您可以安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">STM32CubeProgrammer</a>实用程序。 我们打开它，应该定义调试器，如果您在右上角看到它的ID，然后单击“ <b>连接”，</b>并且如果一切都正确安装，那么我们将看到微控制器，内核，一系列MK本身的ID（我有F334）： <br><br><img src="https://habrastorage.org/webt/mq/x4/yf/mqx4yftzg-htftrzbce4ml0qp9c.png"><br><br> 仅此而已！ 该模块已准备就绪，可以运行和开发各种转换器。 <br><br><h2> 源代码 </h2><br><br><ul><li> 电路图<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-PDF</a> </li><li> 组件列表（BOM） <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-Excel</a> </li><li>  PCB Gerber文件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-RAR</a> </li><li>  STM32CubeMX的带引脚的项目-IOC </li></ul><br><h2> 结论 </h2><br> 现在有2个模块需要开发，这足以组装转换器。 当然会有第三个模块，但是没有HMI，您就可以生活，而那些有意愿的人可以在他们的口袋里购买下一代产品。 在下一篇文章中，已经有可能组装一个成熟的转换器，以实现他们在评论中急切要求的P和PI调节器。 为了获得明显的结果，后续文章将讨论特定的拓扑：它们的分析，计算，原型设计，代码，最有可能的是我将以最简单，最常见的降压和升压拓扑开始。 <br><br> 我还要感谢来自<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PCBway的</a>人员，他们为任何质量优异的复杂电路板提供了帮助。 多亏了他们，该项目才得以积极开展，在几个月的时间里，我设法完成了前几年无法实施的工作。 <br><br><img src="https://habrastorage.org/webt/3z/fa/oz/3zfaozlc2uyqwdccjpqpdtsvc6e.png"><br><br> 我希望这篇文章对您来说很有趣，如果您对buck拓扑有任何疑问，那么您可以在评论或PM中表达他们的观点，当我写下一篇文章时，我将尝试回答这些问题，从而使材料更加有用。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN430908/">https://habr.com/ru/post/zh-CN430908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN430894/index.html">情况：品牌在播客广告上花费越来越多的钱-我们理解为什么</a></li>
<li><a href="../zh-CN430896/index.html">Linux Foundation已为GraphQL和Ceph建立了资金-为什么需要它们，以及对它们的期望</a></li>
<li><a href="../zh-CN430900/index.html">历史上的第一台激光：那是什么</a></li>
<li><a href="../zh-CN430902/index.html">精灵在记忆中。 在Linux RAM中运行ELF</a></li>
<li><a href="../zh-CN430906/index.html">妈妈晚上平静地入睡-我们为Raspbian'a收集OpenCV</a></li>
<li><a href="../zh-CN430910/index.html">富布赖特奖学金：如何以及为什么？</a></li>
<li><a href="../zh-CN430912/index.html">我们给骗子带来干净的水：面试不是雇佣关系。 自然地</a></li>
<li><a href="../zh-CN430914/index.html">黑市价格分析的个人数据和突破</a></li>
<li><a href="../zh-CN430916/index.html">二氧化碳检测仪MT8057S。 由非仿真者参与的非审查</a></li>
<li><a href="../zh-CN430918/index.html">简而言之，关于Flutter：基础知识</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>