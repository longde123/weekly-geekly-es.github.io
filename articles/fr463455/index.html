<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚯 🌋 👱🏿 Des milliers de choses à corriger en Java à partir de la première version: une grande interview avec Sergey Kuksenko d'Oracle 🤲🏼 🏙️ 💗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sergey Kuksenko est un ingénieur de performance qui a déjà vu Java version 1.0. Pendant ce temps, il a réussi à participer au développement d'applicat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Des milliers de choses à corriger en Java à partir de la première version: une grande interview avec Sergey Kuksenko d'Oracle</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/463455/"><p><img src="https://habrastorage.org/webt/df/kc/6_/dfkc6_bq7r5jfxx7vr1awxr-mf8.jpeg"></p><br><p>  Sergey Kuksenko est un ingénieur de performance qui a déjà vu Java version 1.0.  Pendant ce temps, il a réussi à participer au développement d'applications mobiles, clientes, serveur et machines virtuelles.  Depuis 2005, Java est engagé dans la performance et travaille actuellement chez Oracle pour améliorer les performances du JDK.  L'un des conférenciers les plus populaires chez Joker et JPoint. </p><br><p>  Cet habrapost est une grande interview avec Sergey, consacrée aux sujets suivants: </p><br><ul><li>  Culte de la performance; </li><li>  Quand et ce qui doit être optimisé, la conception initiale de la langue et de la bibliothèque; </li><li>  Domaines prometteurs pour une optimisation supplémentaire; </li><li>  Comment participer au développement et ce qui peut être brisé par les optimisations; </li><li>  Astuces du compilateur, placement des registres; </li><li>  Est-il possible d'assembler un chat à partir de viande hachée; </li><li>  Lorsque les tests fonctionnent pendant cinq jours consécutifs et toute autre routine domestique; </li><li>  Comment devenir ingénieur de performance; </li><li>  Préparer un rapport pour le prochain Joker. <a name="habracut"></a></li></ul><br><h2 id="o-kulte-proizvoditelnosti">  À propos du culte de la productivité </h2><br><p>  <strong>Oleg:</strong> Vous êtes notre ancien conférencier, et ce n'est pas notre première interview.  Dites-moi un peu, qui êtes-vous maintenant, que faites-vous? </p><br><p>  <strong>Sergey:</strong> Je suis le même qu'il y a de nombreuses années, et je fais la même chose.  Je travaille dans l'équipe Java Performance et suis responsable des performances des machines Oracle Java, OpenJDK. </p><br><p>  <strong>Oleg:</strong> Alors j'ai une question un peu troll: ici vous êtes un ingénieur de performance, et vos rapports portent sur toutes sortes de performances.  Ne pensez-vous pas que le problème de performances est quelque peu surestimé?  Tout le monde se précipite avec elle, mais est-ce même nécessaire? </p><br><p>  <strong>Sergey:</strong> C'est une bonne question.  Tout dépend de l'autre.  Ce type d'attention du public peut être considéré comme excessif.  La productivité des entreprises, en revanche, c'est de l'argent. </p><br><p>  C'est le vrai argent que les gens dépensent en matériel, sur une sorte de cloud sur Amazon.  Si vous ne traitez pas vos demandes assez rapidement - c'est tout, vous perdez des clients, perdez de l'argent, perdez tout le reste.  Par conséquent, la demande de performance, bien sûr, est toujours là.  La question est de savoir à quel point c'est important dans chaque cas.  Je ne parle pas du trading haute fréquence. </p><br><p>  <strong>Oleg:</strong> Au fait, pensez-vous que Java convient à cela? </p><br><p>  <strong>Sergey:</strong> Avez-vous eu l'occasion de rencontrer une personne comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Peter Lawrey</a> ? </p><br><p>  <strong>Oleg:</strong> Qui est le PDG de Chronicle Software, les développeurs d'OpenHFT? </p><br><p>  <strong>Sergey:</strong> Ceci est un ami très célèbre de Londres qui voyage beaucoup lors de conférences.  Ils travaillent à Java dans le trading haute fréquence, ils vivent très bien. </p><br><p>  <strong>Oleg: Le font</strong> -ils sur Java ou s'appelle-t-il du code natif de Java?  Pourtant, il y a une différence. </p><br><p>  <strong>Sergey:</strong> Je ne sais pas à ce niveau, il ne l'a pas dit.  En principe, si vous le souhaitez, tout ce qui est nécessaire peut être réalisé en Java lui-même. </p><br><p>  <strong>Oleg:</strong> Intéressant.  Si vous prenez, par exemple, une communauté de pythonistes, ils ont beaucoup moins de culte de la productivité.  Comment se fait-il que c'est exactement ce qui se passe dans notre communauté?  Peut-être <em>avez</em> - <em>vous</em> provoqué le culte de la performance avec vos rapports?  Vous, Shipilev, Pangin, Ivanov et ainsi de suite. </p><br><p> <strong>Sergey:</strong> Je ne sais pas comment c'est arrivé.  Le culte de la productivité à la conférence russe est beaucoup plus élevé qu'à la conférence américaine.  Peut-être que cela reflète le public lui-même.  Chez nous, les gens veulent être plus engagés dans la productivité, c'est intéressant pour eux.  Et en Amérique, ils veulent faire plus pour ce qu'ils paient plus.  Mais c'est une hypothèse, une conjecture.  Il en est ainsi. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/MvJJgR6nxXQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kogda-i-chto-nuzhno-optimizirovat">  Quand et ce qui doit être optimisé </h2><br><p>  <strong>Oleg:</strong> Vous avez dit qu'il y avait toujours une demande de performance.  À quel moment devez-vous commencer à penser à la performance?  Quand le tonnerre frappera-t-il? </p><br><p>  <strong>Sergey:</strong> C'est une question abstraite générale.  Il vaut mieux se tourner à nouveau vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le discours</a> d’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Alexey Shipilev</a> de l’une des conférences précédentes, où il a assez bien peint tout cela. </p><br><p>  <strong>Oleg:</strong> Oui, je me souviens de la "courbe du nom Sh". </p><br><p>  <strong>Sergey:</strong> Vous devez faire de la performance tout de suite, mais en fonction de quel niveau.  Il n'est pas nécessaire d'écrire des repères immédiatement.  Il est connu, par exemple, que la restriction banale du niveau d'architecture API entre Set as a set et SortedSet nous impose déjà des restrictions algorithmiques fondamentales. </p><br><p>  Si nous avons poussé un SortedSet dans l'API (bien que personne n'ait besoin de ce tri), puis qu'il se soit répandu sur tout notre système, alors cette chose devra être retirée douloureusement et durement. </p><br><p>  La question part du niveau même de conception - c'est une question de restrictions minimales.  Les plus petites restrictions possibles doivent être utilisées pour que vous puissiez jouer avec elles plus tard.  Par exemple, lorsque j'ai tordu divers morceaux de Java, des mots extrêmement mauvais me sont venus à l'esprit.  Je voudrais faire quelque chose avec l'une des classes de base, mais je ne peux rien faire, car l'API est corrigée, vous ne pouvez plus la changer, elle a déjà rampé.  Mais pour faire un tour et un overclocking, vous devez masquer certains détails. </p><br><p>  Étude de cas: j'avais l'habitude de m'accroupir autour de la classe java.math.BigDecimal.  Il y avait une grande demande de différents côtés pour le disperser d'une manière ou d'une autre.  Il y a un cas assez bon et spécial lorsque notre BigDecimal n'est pas «Big», c'est juste Decimal, et vous devez les lire. </p><br><p>  Maintenant, bien sûr, un emballage approprié a été créé pour cela.  Mais s'il n'y avait pas de constructeur public sortant de BigDecimal, mais quelques méthodes et usines statiques, vous pourriez créer un résumé BigDecimal et cracher deux implémentations différentes qui fonctionnaient selon leurs besoins.  Mais cela est impossible, car le constructeur ressort.  Pour cette raison, vous devez déjà effectuer une vérification d'exécution inutile à l'intérieur, ce qui vous permet de suivre un chemin rapide dans certains cas. </p><br><p>  <strong>Oleg: En résulte-</strong> t-il que lors du développement d'une bibliothèque standard, il vaut la peine d'abandonner les concepteurs et de faire des constructeurs partout? </p><br><p>  <strong>Sergey:</strong> Il se fait tard. </p><br><p>  <strong>Oleg:</strong> Si ce n'était pas trop tard, serait-ce une bonne idée? </p><br><p>  <strong>Sergey:</strong> Elle donnerait plus de marge de manœuvre.  Regardez: nous écrivons nouveau, et ce nouveau se tient en dehors du constructeur.  On obtient deux opérations: d'abord on crée un objet, puis on appelle le constructeur qui le remplit.  Et parfois, il serait très utile de cacher la création même de l'objet et de créer le mauvais objet que nous avons à l'extérieur.  Il s'agit d'une restriction de langage, l'original, des premiers jours de Java. </p><br><p>  <strong>Oleg:</strong> Eh bien, maintenant, tout le monde utilise des cadres DI qui vous permettent de tordre les proxys comme vous le souhaitez et d'ajouter quoi que ce soit, en contournant cette limitation.  Dans la conception originale du langage, pourriez-vous ajouter quelque chose comme ça, le conteneur d'injection de dépendance intégré? </p><br><p>  <strong>Sergey:</strong> J'ai une opinion très précise sur la conception initiale de la langue.  Si vous vous souvenez de l'histoire de Java 1.0, il en est ressorti une pression temporelle assez sérieuse, tout devait être fait rapidement. </p><br><p>  Il y a des milliers de choses que j'aimerais personnellement corriger depuis la toute première version.  Mais je crains que même si un sur mille est choisi, un-deux-trois, et qu'ils auraient commencé à être fabriqués au moment du premier Java, alors Java ne serait pas sorti.  Ceci est un exemple standard selon lequel le meilleur est l'ennemi du bien. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/9E6DKrxOLHo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chto-eschyo-mozhno-optimizirovat-v-java">  Quoi d'autre peut être optimisé en Java </h2><br><p>  <strong>Oleg:</strong> Les gens ordinaires ne peuvent réparer quelque chose que dans leur projet, et vous, en tant qu'ingénieurs de performance chez JDK, affectez immédiatement des centaines de milliers de projets.  La question se pose: au cours de plus de 20 ans de développement Java, y a-t-il eu des domaines dans le JDK où l'intervention d'ingénieurs principaux peut avoir un effet notable?  Et dans quelle mesure cet «effet perceptible» est-il perceptible? </p><br><p>  <strong>Sergey:</strong> Premièrement, maintenant Java ne fonctionne plus du tout sur le matériel qui, disons, il y a 10 ans.  Le fer maintenant et le fer il y a 10 ans sont deux grandes différences, et il est conseillé de faire différentes optimisations. </p><br><p>  Deuxièmement, il est, bien sûr, merveilleux quand un ingénieur de la performance s'assoit et accélère quelque chose, obtient des nombres énormes, rend compte à ses supérieurs, frappe de l'argent pour un bonus après ces overclockings.  Mais une énorme quantité de travail est en cours sur de nouveaux projets.  Une fonctionnalité est ajoutée, et la tâche de l'ingénieur de performance n'est pas d'overclocker la fonctionnalité, mais de s'assurer que tout va bien dans cette fonctionnalité.  Ou si ce n'est pas ok, alors trouvez une sorte de correction. </p><br><p>  <strong>Oleg:</strong> Comment pouvez-vous en être sûr?  Vous ne vérifiez pas le code officiellement.  Qu'est-ce qu'un "assurez-vous"? </p><br><p>  <strong>Sergey:</strong> S'assurer que tout va bien du point de vue de la performance est l'opinion subjective d'un ingénieur de la performance qui rédigera un rapport et dira que «tout est normal dans cette fonction».  Selon la taille de la fonctionnalité, cela implique parfois beaucoup d'action, parfois beaucoup d'efforts différents.  En partant du fait que vous avez juste besoin de vous asseoir bêtement, de regarder ce qui se fait là-bas, de comparer cette zone, de conduire des repères, de voir ce qui se passe à la sortie et de prendre une décision raisonnable et éclairée. </p><br><p>  <strong>Oleg:</strong> Et du point de vue des performances et des nouvelles fonctionnalités - Java va-t-il généralement de l'avant?  Y a-t-il quelque chose là-dedans?  Parce que notre matériel n'a pas beaucoup changé, par exemple, si nous parlons d'Intel. </p><br><p>  <strong>Sergey:</strong> Pour quelle période cela n'a-t-il pas changé? </p><br><p>  <strong>Oleg:</strong> Par exemple, les 10 dernières années. </p><br><p>  <strong>Sergey:</strong> Oui, y a-t-il un AVX-512 sur le matériel il y a dix ans? </p><br><p>  <strong>Oleg:</strong> Non.  Lui, probablement, n'est pas toujours présent dans le moderne? </p><br><p>  <strong>Sergey:</strong> Certainement pas.  Nous l'avons dans notre laboratoire, mais tout est occupé par des compilateurs.  Ils se défoncent jusqu'à présent, donc je n'ai pas regardé. </p><br><p>  <strong>Oleg:</strong> La prise en charge AVX-512 peut-elle être considérée comme un exemple de fonctionnalité typique? </p><br><p>  <strong>Sergey:</strong> Probablement possible.  Que dois-je faire exactement: nous avons eu une grande couche de travail sur le fait qu'il existe des exigences modernes pour ajouter de nouveaux algorithmes cryptographiques.  C'est une chose où les algorithmes de cryptographie vieux de dix ans ne peuvent tout simplement pas être utilisés.  Nous avons besoin de nouveaux algorithmes, de clés plus grandes.  Et l'ajout de nouveaux algorithmes cryptographiques se produit, je dirais, en permanence. </p><br><p>  <strong>Oleg: Accélèrent</strong> -ils en quelque sorte le matériel? </p><br><p>  <strong>Sergey:</strong> Tout dépend des algorithmes spécifiques.  Il existe des algorithmes très bien accélérés.  Soit dit en passant, il y a 10 ans, cela n'aurait pas fonctionné sur le matériel Intel, mais environ 5-6 la façon dont les bonnes instructions sont apparues, jusqu'aux unités AES avec accélérations.  Tout cela a été mis en œuvre avec un intervalle de temps minimum. </p><br><p>  <strong>Oleg:</strong> Qu'en est-il du GPU, sont-ils également capables de multiplier les matrices? </p><br><p>  <strong>Sergey:</strong> À propos du GPU - une conversation séparée.  Nous avons pour cela un projet au Panama dans lequel tous ces travaux sont effectués, et un jour il atteindra la ligne principale de Java avec tous les goodies. </p><br><p>  <strong>Oleg:</strong> J'ai quelques connaissances qui sont engagées, conditionnellement, en mathématiques financières.  À partir d'un certain moment, ils passent toujours en C ++ pour l'informatique et affirment qu'il est très gênant d'utiliser toutes ces optimisations et ce matériel à partir de la plate-forme gérée.  Cela peut-il être amélioré? </p><br><p>  <strong>Sergey:</strong> Nous avons également une grande demande à ce sujet et il y a un certain nombre d'exigences internes.  Par exemple, pour améliorer quelque chose dans le domaine de l'apprentissage automatique.  En règle générale, il s'agit d'une multiplication de matrice banale, qui peut être rejetée sur le GPU.  Le travail est en cours, disons-le. </p><br><p>  Nous avons deux grands projets parapluie: Valhalla et Panama, qui devraient collecter des fonctionnalités comme le GPU.  À la jonction de Valhalla et de Panama se trouve une API vectorielle qui fonctionne avec nos instructions SIMD / SSE / AVX directement à partir du code Java, et Valhalla lui-même avec des types en ligne est un grand pas dans cette direction. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/M4URPKrbr0A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chto-mozhno-slomat-optimizaciey-kak-pouchastvovat-v-razrabotke">  Ce qui peut être brisé par l'optimisation, comment participer au développement </h2><br><p>  <strong>Oleg:</strong> Les parapluies que vous avez mentionnés sont similaires les uns aux autres.  Est-il possible qu'un projet en affecte un autre, y compris en termes de code et de profil de performance?  Par exemple, avez-vous refactorisé quelque chose et le malheureux Ron Presler, versant des larmes, fixe ses tests dans un coin du soir? </p><br><p>  <strong>Sergey:</strong> Cela arrive tout le temps.  Un exemple concret est l'API Vector.  Pour que l'API Vector fonctionne correctement, nos vecteurs natifs doivent éventuellement devenir des types de valeur, ou comme on l'appelle maintenant en Java, des types en ligne.  Vous pouvez faire un contournement dans le hotspot et l'implémenter d'une manière ou d'une autre, mais je veux avoir une solution générale.  D'un autre côté, la caractéristique clé des types en ligne est précisément de ne pas se soucier de la disposition de ces données, et la disposition de ces données est extrêmement importante pour l'API Vector. </p><br><p>  Parce qu'il correspond en fait directement à l'AVX-512 et tout ça.  Il est clair que vous devez faire quelques squats, quelques optimisations, qui, d'une part, feront du type en ligne un type normal, mais qui auront une disposition matérielle.  Naturellement, des intersections se produisent.  Si vous regardez les groupes de personnes qui déplacent le Panama et déplacent Valhalla, ils se croisent plus de la moitié. </p><br><p>  <strong>Oleg:</strong> Purement organisationnel, ici vous avez un projet, une sorte de problème de performance, mais il est à la jonction de plusieurs projets.  Que faire ensuite?  Comment résoudre ça?  Il s'avère que c'est déjà un compromis entre les projets et les personnes, et non entre certaines tâches abstraites. </p><br><p>  <strong>Sergey:</strong> Tout est très simple ici: s'il s'agit d'un problème de performances avec une fonctionnalité qui vient d'être conçue, vous devez vous adresser aux personnes qui conçoivent et dire: «Tellement et ainsi, qu'allons-nous faire?  Faisons-le différemment. "  La discussion commence et le problème est résolu. </p><br><p>  Si le code existe déjà, il fonctionne déjà.  Dans le cas idéal, vous résolvez ce problème ou, si vous ne pouvez pas le résoudre complètement, vous lâchez le prototype, puis vous revenez au propriétaire du code et dites: "Voici le prototype, que ferons-nous?"  De plus, nous résolvons ce problème spécifiquement pour chaque cas. </p><br><p>  <strong>Oleg:</strong> Nous avons ici des personnes intéressées qui ne peuvent pas participer à ce processus, ce sont des utilisateurs finaux. </p><br><p>  <strong>Sergey:</strong> Ils ne peuvent pas participer suffisamment pour ne pas être payés pour leurs salaires chez Oracle.  Si vous n'avez pas besoin d'un salaire, venez chez OpenJDK et participez. </p><br><p>  <strong>Oleg: À</strong> quel point est-ce réel?  OpenJDK a des putains de génies comme vous, et où les gens ordinaires sont, et où vous êtes.  Disons que quelque chose ralentit pour moi, que dois-je faire et comment? </p><br><p>  <strong>Sergey:</strong> Si vous ne connaissez pas le problème, il s'agit d'une question distincte, si quelqu'un va chercher une solution pour vous, c'est une question en tant que domaine, exemple, etc.  Même si vous ne connaissez pas le problème, il est peut-être logique d'écrire dans OpenJDK et de demander.  Si c'est quelque chose que quelqu'un clique immédiatement dans la tête, les gens l'attraperont.  Si cela n'intéresse personne, il restera sans réponse. </p><br><p>  <strong>Oleg:</strong> Supposons que je connaisse le problème et que je sache même ce qui doit être corrigé. </p><br><p>  <strong>Sergey:</strong> Si vous connaissez le problème, vous venez chez OpenJDK, signez tous les morceaux de papier nécessaires, offrez un patch, il est révisé et versé. </p><br><p>  <strong>Oleg:</strong> C'est aussi simple que ça? </p><br><p>  <strong>Sergey:</strong> Eh bien, oui, un peu de bureaucratie, attendez un peu.  Hier, Tagir ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">lany</a> ) a récupéré une petite correction que j'ai abandonnée.  Il veut juste être amené à la fin.  Il a commencé à y penser par lui-même.  Il dit: "Merde, qu'est-ce que c'est, j'ai tout fait, mis en page, personne ne passe en revue."  Eh bien oui, personne ne passe en revue.  Nous sommes en juillet, la moitié du bureau Java est en vacances.  Ils sortiront de vacances et le feront. </p><br><p>  <strong>Oleg: Les</strong> vacances aux USA sont à peu près les mêmes dates que d'habitude en Russie? </p><br><p>  <strong>Sergey:</strong> Non, le système de vacances aux États-Unis est complètement différent de celui de la Russie.  Premièrement, ils sont nettement plus petits.  Aux États-Unis également, le système de vacances est lié aux écoles.  Lorsque vous avez des enfants en vacances - puis en vacances.  Dès que les vacances commencent, toute l'Amérique commence à bouger.  Et comme les cours se terminent ici à la mi-juin et commencent à la mi-août, ce delta pour les vacances n'est pas si grand - seulement deux mois. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ulWWSKr0Ce0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kompilyatornye-tryuki-razmeschenie-registrov">  Astuces du compilateur, placement du registre </h2><br><p>  <strong>Oleg:</strong> Est-il déjà arrivé que vous optimisiez quelque chose à la maison, et après cela, les utilisateurs devaient écrire du code différemment?  Relativement parlant, si l'opération de sélection d'une sous-chaîne utilisait une plage et en fait maintenant une copie complète, cette refactorisation change la façon dont vous écrivez le code. </p><br><p>  <strong>Sergey:</strong> Certainement, mais je ne vais pas donner d'exemples précis maintenant.  La question est de savoir ce que les gens fixent lorsqu'ils écrivent du code.  S'ils ont besoin d'extraire les performances maximales, et pour cela, ils font toutes sortes d'astuces spécifiques au compilateur, ils doivent être préparés pour que le compilateur évolue au fil du temps, et ils devront constamment modifier leur code en fonction de l'état actuel du compilateur.  Et c'est super. </p><br><p>  Supposons que, soudainement, après 20 ans, Graal devienne le compilateur principal de HotSpot - alors ces pauvres gars devront tout réécrire.  Cela ne se produit que si vous avez assumé une telle tâche technique - suivre les changements dans le compilateur.  Il est beaucoup plus simple d'écrire le code correct sans liens directs, avec des implémentations générales plus ou moins normales. </p><br><p>  Soit dit en passant, sur les compilateurs - pas seulement sur les compilateurs Java, mais en général.  Il y a la loi de Moore, qui n'est pas une loi, mais juste une observation empirique que le nombre de transistors double tous les ans et demi. </p><br><p>  Et il existe exactement la même loi (loi de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Proebsting</a> ) selon laquelle les performances du code sans modification augmentent de 4% tous les un an et demi à deux ans.  Ces 4% sont ce que les utilisateurs finaux obtiennent gratuitement uniquement grâce à l'évolution des compilateurs.  Pas du matériel, à savoir des compilateurs. </p><br><p>  <strong>Oleg:</strong> Je me demande d'où viennent ces pourcentages.  Est-ce une sorte d'inefficacité initiale?  Mais un jour, ce stock d'inefficacités prendra fin. </p><br><p>  <strong>Sergey:</strong> Non, c'est juste une question de développement technologique.  J'ai quitté les compilateurs lorsque j'ai commencé à travailler sur les performances.  Mais une fois que j'étais fiancée, et la plus grande découverte pour moi a été faite en 2005 ou 2006.  Je l'ai découvert du tout en 2008 parce que je n'avais pas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lu l'article</a> à temps. </p><br><p>  Une tâche très importante de toute génération de code est l'allocation des registres.  Il est connu qu'en général, ce problème est NP-complet.  Il est très difficile de le résoudre, et donc tous les compilateurs essaient de piloter une sorte d'algorithme approximatif avec différents degrés de qualité. </p><br><p>  Et voici un article où les gars prouvent que dans certains cas qui couvrent un grand nombre de compilateurs et un grand nombre de représentations internes avec certaines restrictions, un algorithme polynomial exact existe pour la tâche d'allocation d'allocation de registre.  Hourra, allons-y! </p><br><p>  Cela s'est produit en 2005, les compilateurs réalisés plus tôt ne le savaient pas. </p><br><p>  <strong>Oleg:</strong> Vous pouvez maintenant créer un nouvel allocateur pour Java? </p><br><p>  <strong>Sergey:</strong> Maintenant qu'il existe une solution théorique, elle peut être réécrite.  Je ne suis pas entré dans les détails, mais je sais que les gars d'Excelsior ont implémenté l'algorithme. </p><br><p>  <strong>Oleg:</strong> Nous avons récemment fait une interview avec Cliff Click, et il a parlé de l'allocateur de génie incroyablement complexe et fou qu'il a écrit pour Java.  Vous ne voulez pas en écrire un autre? </p><br><p>  <strong>Sergey:</strong> Non. </p><br><p>  <strong>Oleg:</strong> Y a <strong>-</strong> t-il quelque chose de normal? </p><br><p>  <strong>Sergey:</strong> Non, il n'est pas normal.  De mon point de vue utilitaire, je dirai que je regarde en assembleur et parfois je vois: "Eh bien, oui, ici les registres ont mal tourné".  Si je recourt à botter nos compilateurs, et que nous réécrivons l'allocateur, qu'allons-nous obtenir?  Nous obtiendrons un gain, mais je ne le verrai probablement pas, sauf dans les exemples où j'ai vu l'allocation inefficace des registres.  Tant qu'il n'y a pas de gros échecs dans ce domaine, il y a toujours quelque chose à faire et à gagner plus de gains. </p><br><p>  <strong>Oleg:</strong> Y a-t-il des domaines de travail dans le JDK où tout le compilateur du compartiment moteur ou la magie des performances fait surface?  Vous dites que vous devez écrire du code normal normal et tout ira bien, mais cela semble suspect. </p><br><p>  <strong>Sergey:</strong> Tout ira bien jusqu'à ce que vous ayez besoin d'un super duper.  Si vous en avez besoin très rapidement, soyez prêt à toujours le réécrire.  Pour le moment, si vous prenez une grande application abstraite, dans l'ensemble, telle qu'elle est écrite - ne joue généralement pas de rôle en termes de performances. </p><br><p>  D'une part, dès que le garbage collector est déclenché, il mange ses 10-20%, d'autre part, l'architecture de l'application commence à apparaître.  L'énorme problème que j'ai vu dans le tas d'applications est qu'elles transfèrent des données.  On a pris les données d'ici, on les a transférées là-bas, on y a fait des transformations.  En général, tout programme fait exactement cela.  Il transfère les données d'un endroit à un autre d'une manière ou d'une autre.  Mais si vous avez trop de changements dans le programme, le compilateur n'aidera pas. </p><br><p>  <strong>Oleg:</strong> Vous pouvez essayer de suivre des choses simples, comme: ce morceau de mémoire change de propriétaire et se déplace entre les objets dans cette direction. </p><br><p>  <strong>Sergey:</strong> Non, c'est un problème de conception.  Mais je ne change pas seulement, mais je change avec des modifications, je fais quelque chose avec eux.  Le plus grand avantage dans les applications réelles et massives peut être obtenu si vous y réfléchissez: y a-t-il tellement de changements nécessaires.  Au lieu de dix, faire sept est déjà bon. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/kxgo7Y4cdA8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JRBWBJ6S4aU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <em>(Il pourrait sembler que la même vidéo a été accidentellement dupliquée ici. En fait, tout est plus simple, Habr a mis en cache la mauvaise image de YouTube)</em> </p><br><h2 id="sobiraem-koshku-iz-farsha">  Nous collectons un chat à partir de viande hachée </h2><br><p>  <strong>Oleg:</strong> Nous venons d'avoir une conférence Hydra sur l'informatique distribuée.  Et tant de gens se soucient beaucoup de choses comme un modèle de coût, déterminant le coût de chaque opération <strong>-</strong> très granulaire, très précis.  Les gens veulent vraiment écrire toutes les instructions, additionner le coût de chacune d'entre elles et voir combien de barres votre code prendra.  Je me demande comment cette approche fonctionne dans la réalité moderne.    ,   ? </p><br><p> <strong>:</strong> ,      .  ,    .         ,   .  ,     .   ,    ,      ,        .           ? </p><br><p> <strong>:</strong> : «    ». </p><br><p> <strong>:</strong>  , .   ,     .    ,   ?   .   —   ,      .   ,   , -   ,    . </p><br><p> <strong>:</strong>       ,      ? </p><br><p> <strong>:</strong>     ,     ?   ,     .         ? </p><br><p> <strong>:</strong> , -  ? </p><br><p> <strong>:</strong>   ,          — ,   .   -  .   ?    ,      ,   ,        ,   . ,           . </p><br><p> <strong>:</strong>    . </p><br><p> <strong>:</strong>      ,       1 .   ,      ,   .     , -  ,  -  . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/O8oN4KSZEXE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/i0Jr2l3jrDA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="pyat-dney-na-testy-i-drugie-zadachi-performance-inzhenera">        performance- </h2><br><p> <strong>:</strong>     OpenJDK    .        ? C++    .       —   -? </p><br><p> <strong>:</strong> ,  ,  .     .     OpenJDK  15 .      15    . </p><br><p> <strong>:</strong>   ,      ,       .          . </p><br><p> <strong>:</strong>   !       ,    ,   .     ,    ,  , , ,         .  ,       .     :   ,  ,   (  ,     ),      —   .      ,   ,      . </p><br><p> <strong>:</strong> ,      ? </p><br><p> <strong>:</strong> , ,       Java. </p><br><p> <strong>:</strong>   ? </p><br><p> <strong>:</strong> , ,    Valhalla. </p><br><p> <strong>:</strong>    -  ,  ,  —   ,      ?     ?               . </p><br><p> <strong>:</strong>    ,  .   —       .    ,   ,    ,    .  ,  , .      .    2-3 ,      ,      ,       ,  — ,   . </p><br><p> , ,   inline-,        Java        Joker.    .  ,    Java-   ,    runtime-.     red flag: runtime-    0.         ?  ,      out of order- — . </p><br><p>     ,   . ,   .     ?             .       .  baseline,   ,       5-6 ,          —     .  ,    ,  -  2    —     -    .   3%   - ,     .  3%  ? </p><br><p> <strong>:</strong>    ,      ? </p><br><p> <strong>:</strong>     ,     .     performance-,     . ,             ,   — . </p><br><p>        ,    ,  .   performance- —     ,    - performance-  -       ,   .  ,   ,     . </p><br><p> ,    ,   ,   ,   performance- —  class libraries    hotspot,     . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cz93lTJW-do" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kak-voyti-v-performance">  «»  performance </h2><br><p> <strong>:</strong> , -     performance-,     . ,      ,       ? </p><br><p> <strong>:</strong>    .     ?    ,    performance-         performance-. </p><br><p>  ,      :  ,       ,   Oracle, Twitter, Netflix  ,    -   .          ,              —    .  ,     performance-    ,   . </p><br><p>     -  ,   ,    performance-  ,      ?     ,   ,    . </p><br><p>     ,   performance- —    .    :          - performance review,        , , ,  ,  .     —  performance   . </p><br><p>    : « ,  ...»,        ,     —  . ,  -     — ,   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a> ,    . </p><br><h2 id="podgotovka-k-joker">   Joker </h2><br><p> <strong>:</strong>    Joker  .   ? </p><br><p> <strong>:</strong>  inline-,     . </p><br><p> <strong>:</strong>  ,    value-? </p><br><p> <strong>:</strong> ,       ,    .          .   ,    .   value   Java-   .    value,  value,   by value, -  by value,       value type.     ,         . </p><br><p>      .  ,   ,   ,  Rémi Forax -        ,    inline-. ,   ,      Kotlin inline-   ,     value- Java,    . </p><br><p>      .         value-,     ,  , mvt (minimum value types),     LW 1.     LW 2 —  ,         .  , ,        ,    .   ,      ,  , ,  performance-  ,   ,       ,   ,   . </p><br><p> <strong>:</strong>    ,               - -? </p><br><p> <strong>:</strong>  , -     .   , ,   ,   ,   invokedynamic  . </p><br><p> <strong>:</strong>  ,    , ,   ,  . </p><br><p> <strong>:</strong>    ,    ,    ,            .  — ,   ,    .   ,     ? </p><br><p> <strong>:</strong>   , ,  ,    . </p><br><p> <strong>:</strong>  .    , ,   inline-       generic-     ,       inline-.        ,        . </p><br><p> <strong>:</strong>     ,  -    ? </p><br><p> <strong>:</strong>    :     inline- LW2   .    value-,     generic,       . </p><br><blockquote>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«   Java -?        Valhalla»</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Joker</a> ,    - 25-26  2019 .  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463455/">https://habr.com/ru/post/fr463455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463439/index.html">Ordinateur de contrôle embarqué Apollo: jauge et analyse technique de la mémoire sur plusieurs cœurs cousus</a></li>
<li><a href="../fr463441/index.html">Échantillonneur. Utilitaire de console pour visualiser le résultat des commandes shell</a></li>
<li><a href="../fr463443/index.html">JMeter - Swiss Tester Knife (Partie 2)</a></li>
<li><a href="../fr463445/index.html">9 types de solutions logicielles de collaboration pour la gestion d'équipes agiles</a></li>
<li><a href="../fr463447/index.html">Astra Linux 1.6 (Smolensk). Le système est-il prêt à fonctionner avec des utilisateurs ordinaires? Exemples de béquilles</a></li>
<li><a href="../fr463459/index.html">Erreurs cachées avec les transitions d'élément partagé</a></li>
<li><a href="../fr463461/index.html">Ce qui est et ce qui n'est pas dans Go. Partie 1</a></li>
<li><a href="../fr463463/index.html">Méthode pour créer un effet DRAG et DROP</a></li>
<li><a href="../fr463465/index.html">Le livre «JavaScript expressif. Programmation web moderne. 3e édition</a></li>
<li><a href="../fr463469/index.html">Chat Schrodinger sans boîte: le problème du consensus dans les systèmes distribués</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>