<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöØ üåã üë±üèø Des milliers de choses √† corriger en Java √† partir de la premi√®re version: une grande interview avec Sergey Kuksenko d'Oracle ü§≤üèº üèôÔ∏è üíó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sergey Kuksenko est un ing√©nieur de performance qui a d√©j√† vu Java version 1.0. Pendant ce temps, il a r√©ussi √† participer au d√©veloppement d'applicat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Des milliers de choses √† corriger en Java √† partir de la premi√®re version: une grande interview avec Sergey Kuksenko d'Oracle</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/463455/"><p><img src="https://habrastorage.org/webt/df/kc/6_/dfkc6_bq7r5jfxx7vr1awxr-mf8.jpeg"></p><br><p>  Sergey Kuksenko est un ing√©nieur de performance qui a d√©j√† vu Java version 1.0.  Pendant ce temps, il a r√©ussi √† participer au d√©veloppement d'applications mobiles, clientes, serveur et machines virtuelles.  Depuis 2005, Java est engag√© dans la performance et travaille actuellement chez Oracle pour am√©liorer les performances du JDK.  L'un des conf√©renciers les plus populaires chez Joker et JPoint. </p><br><p>  Cet habrapost est une grande interview avec Sergey, consacr√©e aux sujets suivants: </p><br><ul><li>  Culte de la performance; </li><li>  Quand et ce qui doit √™tre optimis√©, la conception initiale de la langue et de la biblioth√®que; </li><li>  Domaines prometteurs pour une optimisation suppl√©mentaire; </li><li>  Comment participer au d√©veloppement et ce qui peut √™tre bris√© par les optimisations; </li><li>  Astuces du compilateur, placement des registres; </li><li>  Est-il possible d'assembler un chat √† partir de viande hach√©e; </li><li>  Lorsque les tests fonctionnent pendant cinq jours cons√©cutifs et toute autre routine domestique; </li><li>  Comment devenir ing√©nieur de performance; </li><li>  Pr√©parer un rapport pour le prochain Joker. <a name="habracut"></a></li></ul><br><h2 id="o-kulte-proizvoditelnosti">  √Ä propos du culte de la productivit√© </h2><br><p>  <strong>Oleg:</strong> Vous √™tes notre ancien conf√©rencier, et ce n'est pas notre premi√®re interview.  Dites-moi un peu, qui √™tes-vous maintenant, que faites-vous? </p><br><p>  <strong>Sergey:</strong> Je suis le m√™me qu'il y a de nombreuses ann√©es, et je fais la m√™me chose.  Je travaille dans l'√©quipe Java Performance et suis responsable des performances des machines Oracle Java, OpenJDK. </p><br><p>  <strong>Oleg:</strong> Alors j'ai une question un peu troll: ici vous √™tes un ing√©nieur de performance, et vos rapports portent sur toutes sortes de performances.  Ne pensez-vous pas que le probl√®me de performances est quelque peu surestim√©?  Tout le monde se pr√©cipite avec elle, mais est-ce m√™me n√©cessaire? </p><br><p>  <strong>Sergey:</strong> C'est une bonne question.  Tout d√©pend de l'autre.  Ce type d'attention du public peut √™tre consid√©r√© comme excessif.  La productivit√© des entreprises, en revanche, c'est de l'argent. </p><br><p>  C'est le vrai argent que les gens d√©pensent en mat√©riel, sur une sorte de cloud sur Amazon.  Si vous ne traitez pas vos demandes assez rapidement - c'est tout, vous perdez des clients, perdez de l'argent, perdez tout le reste.  Par cons√©quent, la demande de performance, bien s√ªr, est toujours l√†.  La question est de savoir √† quel point c'est important dans chaque cas.  Je ne parle pas du trading haute fr√©quence. </p><br><p>  <strong>Oleg:</strong> Au fait, pensez-vous que Java convient √† cela? </p><br><p>  <strong>Sergey:</strong> Avez-vous eu l'occasion de rencontrer une personne comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Peter Lawrey</a> ? </p><br><p>  <strong>Oleg:</strong> Qui est le PDG de Chronicle Software, les d√©veloppeurs d'OpenHFT? </p><br><p>  <strong>Sergey:</strong> Ceci est un ami tr√®s c√©l√®bre de Londres qui voyage beaucoup lors de conf√©rences.  Ils travaillent √† Java dans le trading haute fr√©quence, ils vivent tr√®s bien. </p><br><p>  <strong>Oleg: Le font</strong> -ils sur Java ou s'appelle-t-il du code natif de Java?  Pourtant, il y a une diff√©rence. </p><br><p>  <strong>Sergey:</strong> Je ne sais pas √† ce niveau, il ne l'a pas dit.  En principe, si vous le souhaitez, tout ce qui est n√©cessaire peut √™tre r√©alis√© en Java lui-m√™me. </p><br><p>  <strong>Oleg:</strong> Int√©ressant.  Si vous prenez, par exemple, une communaut√© de pythonistes, ils ont beaucoup moins de culte de la productivit√©.  Comment se fait-il que c'est exactement ce qui se passe dans notre communaut√©?  Peut-√™tre <em>avez</em> - <em>vous</em> provoqu√© le culte de la performance avec vos rapports?  Vous, Shipilev, Pangin, Ivanov et ainsi de suite. </p><br><p> <strong>Sergey:</strong> Je ne sais pas comment c'est arriv√©.  Le culte de la productivit√© √† la conf√©rence russe est beaucoup plus √©lev√© qu'√† la conf√©rence am√©ricaine.  Peut-√™tre que cela refl√®te le public lui-m√™me.  Chez nous, les gens veulent √™tre plus engag√©s dans la productivit√©, c'est int√©ressant pour eux.  Et en Am√©rique, ils veulent faire plus pour ce qu'ils paient plus.  Mais c'est une hypoth√®se, une conjecture.  Il en est ainsi. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/MvJJgR6nxXQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kogda-i-chto-nuzhno-optimizirovat">  Quand et ce qui doit √™tre optimis√© </h2><br><p>  <strong>Oleg:</strong> Vous avez dit qu'il y avait toujours une demande de performance.  √Ä quel moment devez-vous commencer √† penser √† la performance?  Quand le tonnerre frappera-t-il? </p><br><p>  <strong>Sergey:</strong> C'est une question abstraite g√©n√©rale.  Il vaut mieux se tourner √† nouveau vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le discours</a> d‚Äô <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Alexey Shipilev</a> de l‚Äôune des conf√©rences pr√©c√©dentes, o√π il a assez bien peint tout cela. </p><br><p>  <strong>Oleg:</strong> Oui, je me souviens de la "courbe du nom Sh". </p><br><p>  <strong>Sergey:</strong> Vous devez faire de la performance tout de suite, mais en fonction de quel niveau.  Il n'est pas n√©cessaire d'√©crire des rep√®res imm√©diatement.  Il est connu, par exemple, que la restriction banale du niveau d'architecture API entre Set as a set et SortedSet nous impose d√©j√† des restrictions algorithmiques fondamentales. </p><br><p>  Si nous avons pouss√© un SortedSet dans l'API (bien que personne n'ait besoin de ce tri), puis qu'il se soit r√©pandu sur tout notre syst√®me, alors cette chose devra √™tre retir√©e douloureusement et durement. </p><br><p>  La question part du niveau m√™me de conception - c'est une question de restrictions minimales.  Les plus petites restrictions possibles doivent √™tre utilis√©es pour que vous puissiez jouer avec elles plus tard.  Par exemple, lorsque j'ai tordu divers morceaux de Java, des mots extr√™mement mauvais me sont venus √† l'esprit.  Je voudrais faire quelque chose avec l'une des classes de base, mais je ne peux rien faire, car l'API est corrig√©e, vous ne pouvez plus la changer, elle a d√©j√† ramp√©.  Mais pour faire un tour et un overclocking, vous devez masquer certains d√©tails. </p><br><p>  √âtude de cas: j'avais l'habitude de m'accroupir autour de la classe java.math.BigDecimal.  Il y avait une grande demande de diff√©rents c√¥t√©s pour le disperser d'une mani√®re ou d'une autre.  Il y a un cas assez bon et sp√©cial lorsque notre BigDecimal n'est pas ¬´Big¬ª, c'est juste Decimal, et vous devez les lire. </p><br><p>  Maintenant, bien s√ªr, un emballage appropri√© a √©t√© cr√©√© pour cela.  Mais s'il n'y avait pas de constructeur public sortant de BigDecimal, mais quelques m√©thodes et usines statiques, vous pourriez cr√©er un r√©sum√© BigDecimal et cracher deux impl√©mentations diff√©rentes qui fonctionnaient selon leurs besoins.  Mais cela est impossible, car le constructeur ressort.  Pour cette raison, vous devez d√©j√† effectuer une v√©rification d'ex√©cution inutile √† l'int√©rieur, ce qui vous permet de suivre un chemin rapide dans certains cas. </p><br><p>  <strong>Oleg: En r√©sulte-</strong> t-il que lors du d√©veloppement d'une biblioth√®que standard, il vaut la peine d'abandonner les concepteurs et de faire des constructeurs partout? </p><br><p>  <strong>Sergey:</strong> Il se fait tard. </p><br><p>  <strong>Oleg:</strong> Si ce n'√©tait pas trop tard, serait-ce une bonne id√©e? </p><br><p>  <strong>Sergey:</strong> Elle donnerait plus de marge de man≈ìuvre.  Regardez: nous √©crivons nouveau, et ce nouveau se tient en dehors du constructeur.  On obtient deux op√©rations: d'abord on cr√©e un objet, puis on appelle le constructeur qui le remplit.  Et parfois, il serait tr√®s utile de cacher la cr√©ation m√™me de l'objet et de cr√©er le mauvais objet que nous avons √† l'ext√©rieur.  Il s'agit d'une restriction de langage, l'original, des premiers jours de Java. </p><br><p>  <strong>Oleg:</strong> Eh bien, maintenant, tout le monde utilise des cadres DI qui vous permettent de tordre les proxys comme vous le souhaitez et d'ajouter quoi que ce soit, en contournant cette limitation.  Dans la conception originale du langage, pourriez-vous ajouter quelque chose comme √ßa, le conteneur d'injection de d√©pendance int√©gr√©? </p><br><p>  <strong>Sergey:</strong> J'ai une opinion tr√®s pr√©cise sur la conception initiale de la langue.  Si vous vous souvenez de l'histoire de Java 1.0, il en est ressorti une pression temporelle assez s√©rieuse, tout devait √™tre fait rapidement. </p><br><p>  Il y a des milliers de choses que j'aimerais personnellement corriger depuis la toute premi√®re version.  Mais je crains que m√™me si un sur mille est choisi, un-deux-trois, et qu'ils auraient commenc√© √† √™tre fabriqu√©s au moment du premier Java, alors Java ne serait pas sorti.  Ceci est un exemple standard selon lequel le meilleur est l'ennemi du bien. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/9E6DKrxOLHo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chto-eschyo-mozhno-optimizirovat-v-java">  Quoi d'autre peut √™tre optimis√© en Java </h2><br><p>  <strong>Oleg:</strong> Les gens ordinaires ne peuvent r√©parer quelque chose que dans leur projet, et vous, en tant qu'ing√©nieurs de performance chez JDK, affectez imm√©diatement des centaines de milliers de projets.  La question se pose: au cours de plus de 20 ans de d√©veloppement Java, y a-t-il eu des domaines dans le JDK o√π l'intervention d'ing√©nieurs principaux peut avoir un effet notable?  Et dans quelle mesure cet ¬´effet perceptible¬ª est-il perceptible? </p><br><p>  <strong>Sergey:</strong> Premi√®rement, maintenant Java ne fonctionne plus du tout sur le mat√©riel qui, disons, il y a 10 ans.  Le fer maintenant et le fer il y a 10 ans sont deux grandes diff√©rences, et il est conseill√© de faire diff√©rentes optimisations. </p><br><p>  Deuxi√®mement, il est, bien s√ªr, merveilleux quand un ing√©nieur de la performance s'assoit et acc√©l√®re quelque chose, obtient des nombres √©normes, rend compte √† ses sup√©rieurs, frappe de l'argent pour un bonus apr√®s ces overclockings.  Mais une √©norme quantit√© de travail est en cours sur de nouveaux projets.  Une fonctionnalit√© est ajout√©e, et la t√¢che de l'ing√©nieur de performance n'est pas d'overclocker la fonctionnalit√©, mais de s'assurer que tout va bien dans cette fonctionnalit√©.  Ou si ce n'est pas ok, alors trouvez une sorte de correction. </p><br><p>  <strong>Oleg:</strong> Comment pouvez-vous en √™tre s√ªr?  Vous ne v√©rifiez pas le code officiellement.  Qu'est-ce qu'un "assurez-vous"? </p><br><p>  <strong>Sergey:</strong> S'assurer que tout va bien du point de vue de la performance est l'opinion subjective d'un ing√©nieur de la performance qui r√©digera un rapport et dira que ¬´tout est normal dans cette fonction¬ª.  Selon la taille de la fonctionnalit√©, cela implique parfois beaucoup d'action, parfois beaucoup d'efforts diff√©rents.  En partant du fait que vous avez juste besoin de vous asseoir b√™tement, de regarder ce qui se fait l√†-bas, de comparer cette zone, de conduire des rep√®res, de voir ce qui se passe √† la sortie et de prendre une d√©cision raisonnable et √©clair√©e. </p><br><p>  <strong>Oleg:</strong> Et du point de vue des performances et des nouvelles fonctionnalit√©s - Java va-t-il g√©n√©ralement de l'avant?  Y a-t-il quelque chose l√†-dedans?  Parce que notre mat√©riel n'a pas beaucoup chang√©, par exemple, si nous parlons d'Intel. </p><br><p>  <strong>Sergey:</strong> Pour quelle p√©riode cela n'a-t-il pas chang√©? </p><br><p>  <strong>Oleg:</strong> Par exemple, les 10 derni√®res ann√©es. </p><br><p>  <strong>Sergey:</strong> Oui, y a-t-il un AVX-512 sur le mat√©riel il y a dix ans? </p><br><p>  <strong>Oleg:</strong> Non.  Lui, probablement, n'est pas toujours pr√©sent dans le moderne? </p><br><p>  <strong>Sergey:</strong> Certainement pas.  Nous l'avons dans notre laboratoire, mais tout est occup√© par des compilateurs.  Ils se d√©foncent jusqu'√† pr√©sent, donc je n'ai pas regard√©. </p><br><p>  <strong>Oleg:</strong> La prise en charge AVX-512 peut-elle √™tre consid√©r√©e comme un exemple de fonctionnalit√© typique? </p><br><p>  <strong>Sergey:</strong> Probablement possible.  Que dois-je faire exactement: nous avons eu une grande couche de travail sur le fait qu'il existe des exigences modernes pour ajouter de nouveaux algorithmes cryptographiques.  C'est une chose o√π les algorithmes de cryptographie vieux de dix ans ne peuvent tout simplement pas √™tre utilis√©s.  Nous avons besoin de nouveaux algorithmes, de cl√©s plus grandes.  Et l'ajout de nouveaux algorithmes cryptographiques se produit, je dirais, en permanence. </p><br><p>  <strong>Oleg: Acc√©l√®rent</strong> -ils en quelque sorte le mat√©riel? </p><br><p>  <strong>Sergey:</strong> Tout d√©pend des algorithmes sp√©cifiques.  Il existe des algorithmes tr√®s bien acc√©l√©r√©s.  Soit dit en passant, il y a 10 ans, cela n'aurait pas fonctionn√© sur le mat√©riel Intel, mais environ 5-6 la fa√ßon dont les bonnes instructions sont apparues, jusqu'aux unit√©s AES avec acc√©l√©rations.  Tout cela a √©t√© mis en ≈ìuvre avec un intervalle de temps minimum. </p><br><p>  <strong>Oleg:</strong> Qu'en est-il du GPU, sont-ils √©galement capables de multiplier les matrices? </p><br><p>  <strong>Sergey:</strong> √Ä propos du GPU - une conversation s√©par√©e.  Nous avons pour cela un projet au Panama dans lequel tous ces travaux sont effectu√©s, et un jour il atteindra la ligne principale de Java avec tous les goodies. </p><br><p>  <strong>Oleg:</strong> J'ai quelques connaissances qui sont engag√©es, conditionnellement, en math√©matiques financi√®res.  √Ä partir d'un certain moment, ils passent toujours en C ++ pour l'informatique et affirment qu'il est tr√®s g√™nant d'utiliser toutes ces optimisations et ce mat√©riel √† partir de la plate-forme g√©r√©e.  Cela peut-il √™tre am√©lior√©? </p><br><p>  <strong>Sergey:</strong> Nous avons √©galement une grande demande √† ce sujet et il y a un certain nombre d'exigences internes.  Par exemple, pour am√©liorer quelque chose dans le domaine de l'apprentissage automatique.  En r√®gle g√©n√©rale, il s'agit d'une multiplication de matrice banale, qui peut √™tre rejet√©e sur le GPU.  Le travail est en cours, disons-le. </p><br><p>  Nous avons deux grands projets parapluie: Valhalla et Panama, qui devraient collecter des fonctionnalit√©s comme le GPU.  √Ä la jonction de Valhalla et de Panama se trouve une API vectorielle qui fonctionne avec nos instructions SIMD / SSE / AVX directement √† partir du code Java, et Valhalla lui-m√™me avec des types en ligne est un grand pas dans cette direction. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/M4URPKrbr0A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chto-mozhno-slomat-optimizaciey-kak-pouchastvovat-v-razrabotke">  Ce qui peut √™tre bris√© par l'optimisation, comment participer au d√©veloppement </h2><br><p>  <strong>Oleg:</strong> Les parapluies que vous avez mentionn√©s sont similaires les uns aux autres.  Est-il possible qu'un projet en affecte un autre, y compris en termes de code et de profil de performance?  Par exemple, avez-vous refactoris√© quelque chose et le malheureux Ron Presler, versant des larmes, fixe ses tests dans un coin du soir? </p><br><p>  <strong>Sergey:</strong> Cela arrive tout le temps.  Un exemple concret est l'API Vector.  Pour que l'API Vector fonctionne correctement, nos vecteurs natifs doivent √©ventuellement devenir des types de valeur, ou comme on l'appelle maintenant en Java, des types en ligne.  Vous pouvez faire un contournement dans le hotspot et l'impl√©menter d'une mani√®re ou d'une autre, mais je veux avoir une solution g√©n√©rale.  D'un autre c√¥t√©, la caract√©ristique cl√© des types en ligne est pr√©cis√©ment de ne pas se soucier de la disposition de ces donn√©es, et la disposition de ces donn√©es est extr√™mement importante pour l'API Vector. </p><br><p>  Parce qu'il correspond en fait directement √† l'AVX-512 et tout √ßa.  Il est clair que vous devez faire quelques squats, quelques optimisations, qui, d'une part, feront du type en ligne un type normal, mais qui auront une disposition mat√©rielle.  Naturellement, des intersections se produisent.  Si vous regardez les groupes de personnes qui d√©placent le Panama et d√©placent Valhalla, ils se croisent plus de la moiti√©. </p><br><p>  <strong>Oleg:</strong> Purement organisationnel, ici vous avez un projet, une sorte de probl√®me de performance, mais il est √† la jonction de plusieurs projets.  Que faire ensuite?  Comment r√©soudre √ßa?  Il s'av√®re que c'est d√©j√† un compromis entre les projets et les personnes, et non entre certaines t√¢ches abstraites. </p><br><p>  <strong>Sergey:</strong> Tout est tr√®s simple ici: s'il s'agit d'un probl√®me de performances avec une fonctionnalit√© qui vient d'√™tre con√ßue, vous devez vous adresser aux personnes qui con√ßoivent et dire: ¬´Tellement et ainsi, qu'allons-nous faire?  Faisons-le diff√©remment. "  La discussion commence et le probl√®me est r√©solu. </p><br><p>  Si le code existe d√©j√†, il fonctionne d√©j√†.  Dans le cas id√©al, vous r√©solvez ce probl√®me ou, si vous ne pouvez pas le r√©soudre compl√®tement, vous l√¢chez le prototype, puis vous revenez au propri√©taire du code et dites: "Voici le prototype, que ferons-nous?"  De plus, nous r√©solvons ce probl√®me sp√©cifiquement pour chaque cas. </p><br><p>  <strong>Oleg:</strong> Nous avons ici des personnes int√©ress√©es qui ne peuvent pas participer √† ce processus, ce sont des utilisateurs finaux. </p><br><p>  <strong>Sergey:</strong> Ils ne peuvent pas participer suffisamment pour ne pas √™tre pay√©s pour leurs salaires chez Oracle.  Si vous n'avez pas besoin d'un salaire, venez chez OpenJDK et participez. </p><br><p>  <strong>Oleg: √Ä</strong> quel point est-ce r√©el?  OpenJDK a des putains de g√©nies comme vous, et o√π les gens ordinaires sont, et o√π vous √™tes.  Disons que quelque chose ralentit pour moi, que dois-je faire et comment? </p><br><p>  <strong>Sergey:</strong> Si vous ne connaissez pas le probl√®me, il s'agit d'une question distincte, si quelqu'un va chercher une solution pour vous, c'est une question en tant que domaine, exemple, etc.  M√™me si vous ne connaissez pas le probl√®me, il est peut-√™tre logique d'√©crire dans OpenJDK et de demander.  Si c'est quelque chose que quelqu'un clique imm√©diatement dans la t√™te, les gens l'attraperont.  Si cela n'int√©resse personne, il restera sans r√©ponse. </p><br><p>  <strong>Oleg:</strong> Supposons que je connaisse le probl√®me et que je sache m√™me ce qui doit √™tre corrig√©. </p><br><p>  <strong>Sergey:</strong> Si vous connaissez le probl√®me, vous venez chez OpenJDK, signez tous les morceaux de papier n√©cessaires, offrez un patch, il est r√©vis√© et vers√©. </p><br><p>  <strong>Oleg:</strong> C'est aussi simple que √ßa? </p><br><p>  <strong>Sergey:</strong> Eh bien, oui, un peu de bureaucratie, attendez un peu.  Hier, Tagir ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">lany</a> ) a r√©cup√©r√© une petite correction que j'ai abandonn√©e.  Il veut juste √™tre amen√© √† la fin.  Il a commenc√© √† y penser par lui-m√™me.  Il dit: "Merde, qu'est-ce que c'est, j'ai tout fait, mis en page, personne ne passe en revue."  Eh bien oui, personne ne passe en revue.  Nous sommes en juillet, la moiti√© du bureau Java est en vacances.  Ils sortiront de vacances et le feront. </p><br><p>  <strong>Oleg: Les</strong> vacances aux USA sont √† peu pr√®s les m√™mes dates que d'habitude en Russie? </p><br><p>  <strong>Sergey:</strong> Non, le syst√®me de vacances aux √âtats-Unis est compl√®tement diff√©rent de celui de la Russie.  Premi√®rement, ils sont nettement plus petits.  Aux √âtats-Unis √©galement, le syst√®me de vacances est li√© aux √©coles.  Lorsque vous avez des enfants en vacances - puis en vacances.  D√®s que les vacances commencent, toute l'Am√©rique commence √† bouger.  Et comme les cours se terminent ici √† la mi-juin et commencent √† la mi-ao√ªt, ce delta pour les vacances n'est pas si grand - seulement deux mois. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ulWWSKr0Ce0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kompilyatornye-tryuki-razmeschenie-registrov">  Astuces du compilateur, placement du registre </h2><br><p>  <strong>Oleg:</strong> Est-il d√©j√† arriv√© que vous optimisiez quelque chose √† la maison, et apr√®s cela, les utilisateurs devaient √©crire du code diff√©remment?  Relativement parlant, si l'op√©ration de s√©lection d'une sous-cha√Æne utilisait une plage et en fait maintenant une copie compl√®te, cette refactorisation change la fa√ßon dont vous √©crivez le code. </p><br><p>  <strong>Sergey:</strong> Certainement, mais je ne vais pas donner d'exemples pr√©cis maintenant.  La question est de savoir ce que les gens fixent lorsqu'ils √©crivent du code.  S'ils ont besoin d'extraire les performances maximales, et pour cela, ils font toutes sortes d'astuces sp√©cifiques au compilateur, ils doivent √™tre pr√©par√©s pour que le compilateur √©volue au fil du temps, et ils devront constamment modifier leur code en fonction de l'√©tat actuel du compilateur.  Et c'est super. </p><br><p>  Supposons que, soudainement, apr√®s 20 ans, Graal devienne le compilateur principal de HotSpot - alors ces pauvres gars devront tout r√©√©crire.  Cela ne se produit que si vous avez assum√© une telle t√¢che technique - suivre les changements dans le compilateur.  Il est beaucoup plus simple d'√©crire le code correct sans liens directs, avec des impl√©mentations g√©n√©rales plus ou moins normales. </p><br><p>  Soit dit en passant, sur les compilateurs - pas seulement sur les compilateurs Java, mais en g√©n√©ral.  Il y a la loi de Moore, qui n'est pas une loi, mais juste une observation empirique que le nombre de transistors double tous les ans et demi. </p><br><p>  Et il existe exactement la m√™me loi (loi de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Proebsting</a> ) selon laquelle les performances du code sans modification augmentent de 4% tous les un an et demi √† deux ans.  Ces 4% sont ce que les utilisateurs finaux obtiennent gratuitement uniquement gr√¢ce √† l'√©volution des compilateurs.  Pas du mat√©riel, √† savoir des compilateurs. </p><br><p>  <strong>Oleg:</strong> Je me demande d'o√π viennent ces pourcentages.  Est-ce une sorte d'inefficacit√© initiale?  Mais un jour, ce stock d'inefficacit√©s prendra fin. </p><br><p>  <strong>Sergey:</strong> Non, c'est juste une question de d√©veloppement technologique.  J'ai quitt√© les compilateurs lorsque j'ai commenc√© √† travailler sur les performances.  Mais une fois que j'√©tais fianc√©e, et la plus grande d√©couverte pour moi a √©t√© faite en 2005 ou 2006.  Je l'ai d√©couvert du tout en 2008 parce que je n'avais pas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lu l'article</a> √† temps. </p><br><p>  Une t√¢che tr√®s importante de toute g√©n√©ration de code est l'allocation des registres.  Il est connu qu'en g√©n√©ral, ce probl√®me est NP-complet.  Il est tr√®s difficile de le r√©soudre, et donc tous les compilateurs essaient de piloter une sorte d'algorithme approximatif avec diff√©rents degr√©s de qualit√©. </p><br><p>  Et voici un article o√π les gars prouvent que dans certains cas qui couvrent un grand nombre de compilateurs et un grand nombre de repr√©sentations internes avec certaines restrictions, un algorithme polynomial exact existe pour la t√¢che d'allocation d'allocation de registre.  Hourra, allons-y! </p><br><p>  Cela s'est produit en 2005, les compilateurs r√©alis√©s plus t√¥t ne le savaient pas. </p><br><p>  <strong>Oleg:</strong> Vous pouvez maintenant cr√©er un nouvel allocateur pour Java? </p><br><p>  <strong>Sergey:</strong> Maintenant qu'il existe une solution th√©orique, elle peut √™tre r√©√©crite.  Je ne suis pas entr√© dans les d√©tails, mais je sais que les gars d'Excelsior ont impl√©ment√© l'algorithme. </p><br><p>  <strong>Oleg:</strong> Nous avons r√©cemment fait une interview avec Cliff Click, et il a parl√© de l'allocateur de g√©nie incroyablement complexe et fou qu'il a √©crit pour Java.  Vous ne voulez pas en √©crire un autre? </p><br><p>  <strong>Sergey:</strong> Non. </p><br><p>  <strong>Oleg:</strong> Y a <strong>-</strong> t-il quelque chose de normal? </p><br><p>  <strong>Sergey:</strong> Non, il n'est pas normal.  De mon point de vue utilitaire, je dirai que je regarde en assembleur et parfois je vois: "Eh bien, oui, ici les registres ont mal tourn√©".  Si je recourt √† botter nos compilateurs, et que nous r√©√©crivons l'allocateur, qu'allons-nous obtenir?  Nous obtiendrons un gain, mais je ne le verrai probablement pas, sauf dans les exemples o√π j'ai vu l'allocation inefficace des registres.  Tant qu'il n'y a pas de gros √©checs dans ce domaine, il y a toujours quelque chose √† faire et √† gagner plus de gains. </p><br><p>  <strong>Oleg:</strong> Y a-t-il des domaines de travail dans le JDK o√π tout le compilateur du compartiment moteur ou la magie des performances fait surface?  Vous dites que vous devez √©crire du code normal normal et tout ira bien, mais cela semble suspect. </p><br><p>  <strong>Sergey:</strong> Tout ira bien jusqu'√† ce que vous ayez besoin d'un super duper.  Si vous en avez besoin tr√®s rapidement, soyez pr√™t √† toujours le r√©√©crire.  Pour le moment, si vous prenez une grande application abstraite, dans l'ensemble, telle qu'elle est √©crite - ne joue g√©n√©ralement pas de r√¥le en termes de performances. </p><br><p>  D'une part, d√®s que le garbage collector est d√©clench√©, il mange ses 10-20%, d'autre part, l'architecture de l'application commence √† appara√Ætre.  L'√©norme probl√®me que j'ai vu dans le tas d'applications est qu'elles transf√®rent des donn√©es.  On a pris les donn√©es d'ici, on les a transf√©r√©es l√†-bas, on y a fait des transformations.  En g√©n√©ral, tout programme fait exactement cela.  Il transf√®re les donn√©es d'un endroit √† un autre d'une mani√®re ou d'une autre.  Mais si vous avez trop de changements dans le programme, le compilateur n'aidera pas. </p><br><p>  <strong>Oleg:</strong> Vous pouvez essayer de suivre des choses simples, comme: ce morceau de m√©moire change de propri√©taire et se d√©place entre les objets dans cette direction. </p><br><p>  <strong>Sergey:</strong> Non, c'est un probl√®me de conception.  Mais je ne change pas seulement, mais je change avec des modifications, je fais quelque chose avec eux.  Le plus grand avantage dans les applications r√©elles et massives peut √™tre obtenu si vous y r√©fl√©chissez: y a-t-il tellement de changements n√©cessaires.  Au lieu de dix, faire sept est d√©j√† bon. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/kxgo7Y4cdA8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JRBWBJ6S4aU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <em>(Il pourrait sembler que la m√™me vid√©o a √©t√© accidentellement dupliqu√©e ici. En fait, tout est plus simple, Habr a mis en cache la mauvaise image de YouTube)</em> </p><br><h2 id="sobiraem-koshku-iz-farsha">  Nous collectons un chat √† partir de viande hach√©e </h2><br><p>  <strong>Oleg:</strong> Nous venons d'avoir une conf√©rence Hydra sur l'informatique distribu√©e.  Et tant de gens se soucient beaucoup de choses comme un mod√®le de co√ªt, d√©terminant le co√ªt de chaque op√©ration <strong>-</strong> tr√®s granulaire, tr√®s pr√©cis.  Les gens veulent vraiment √©crire toutes les instructions, additionner le co√ªt de chacune d'entre elles et voir combien de barres votre code prendra.  Je me demande comment cette approche fonctionne dans la r√©alit√© moderne.    ,   ? </p><br><p> <strong>:</strong> ,      .  ,    .         ,   .  ,     .   ,    ,      ,        .           ? </p><br><p> <strong>:</strong> : ¬´    ¬ª. </p><br><p> <strong>:</strong>  , .   ,     .    ,   ?   .   ‚Äî   ,      .   ,   , -   ,    . </p><br><p> <strong>:</strong>       ,      ? </p><br><p> <strong>:</strong>     ,     ?   ,     .         ? </p><br><p> <strong>:</strong> , -  ? </p><br><p> <strong>:</strong>   ,          ‚Äî ,   .   -  .   ?    ,      ,   ,        ,   . ,           . </p><br><p> <strong>:</strong>    . </p><br><p> <strong>:</strong>      ,       1 .   ,      ,   .     , -  ,  -  . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/O8oN4KSZEXE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/i0Jr2l3jrDA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="pyat-dney-na-testy-i-drugie-zadachi-performance-inzhenera">        performance- </h2><br><p> <strong>:</strong>     OpenJDK    .        ? C++    .       ‚Äî   -? </p><br><p> <strong>:</strong> ,  ,  .     .     OpenJDK  15 .      15    . </p><br><p> <strong>:</strong>   ,      ,       .          . </p><br><p> <strong>:</strong>   !       ,    ,   .     ,    ,  , , ,         .  ,       .     :   ,  ,   (  ,     ),      ‚Äî   .      ,   ,      . </p><br><p> <strong>:</strong> ,      ? </p><br><p> <strong>:</strong> , ,       Java. </p><br><p> <strong>:</strong>   ? </p><br><p> <strong>:</strong> , ,    Valhalla. </p><br><p> <strong>:</strong>    -  ,  ,  ‚Äî   ,      ?     ?               . </p><br><p> <strong>:</strong>    ,  .   ‚Äî       .    ,   ,    ,    .  ,  , .      .    2-3 ,      ,      ,       ,  ‚Äî ,   . </p><br><p> , ,   inline-,        Java        Joker.    .  ,    Java-   ,    runtime-.     red flag: runtime-    0.         ?  ,      out of order- ‚Äî . </p><br><p>     ,   . ,   .     ?             .       .  baseline,   ,       5-6 ,          ‚Äî     .  ,    ,  -  2    ‚Äî     -    .   3%   - ,     .  3%  ? </p><br><p> <strong>:</strong>    ,      ? </p><br><p> <strong>:</strong>     ,     .     performance-,     . ,             ,   ‚Äî . </p><br><p>        ,    ,  .   performance- ‚Äî     ,    - performance-  -       ,   .  ,   ,     . </p><br><p> ,    ,   ,   ,   performance- ‚Äî  class libraries    hotspot,     . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cz93lTJW-do" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kak-voyti-v-performance">  ¬´¬ª  performance </h2><br><p> <strong>:</strong> , -     performance-,     . ,      ,       ? </p><br><p> <strong>:</strong>    .     ?    ,    performance-         performance-. </p><br><p>  ,      :  ,       ,   Oracle, Twitter, Netflix  ,    -   .          ,              ‚Äî    .  ,     performance-    ,   . </p><br><p>     -  ,   ,    performance-  ,      ?     ,   ,    . </p><br><p>     ,   performance- ‚Äî    .    :          - performance review,        , , ,  ,  .     ‚Äî  performance   . </p><br><p>    : ¬´ ,  ...¬ª,        ,     ‚Äî  . ,  -     ‚Äî ,   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a> ,    . </p><br><h2 id="podgotovka-k-joker">   Joker </h2><br><p> <strong>:</strong>    Joker  .   ? </p><br><p> <strong>:</strong>  inline-,     . </p><br><p> <strong>:</strong>  ,    value-? </p><br><p> <strong>:</strong> ,       ,    .          .   ,    .   value   Java-   .    value,  value,   by value, -  by value,       value type.     ,         . </p><br><p>      .  ,   ,   ,  R√©mi Forax -        ,    inline-. ,   ,      Kotlin inline-   ,     value- Java,    . </p><br><p>      .         value-,     ,  , mvt (minimum value types),     LW 1.     LW 2 ‚Äî  ,         .  , ,        ,    .   ,      ,  , ,  performance-  ,   ,       ,   ,   . </p><br><p> <strong>:</strong>    ,               - -? </p><br><p> <strong>:</strong>  , -     .   , ,   ,   ,   invokedynamic  . </p><br><p> <strong>:</strong>  ,    , ,   ,  . </p><br><p> <strong>:</strong>    ,    ,    ,            .  ‚Äî ,   ,    .   ,     ? </p><br><p> <strong>:</strong>   , ,  ,    . </p><br><p> <strong>:</strong>  .    , ,   inline-       generic-     ,       inline-.        ,        . </p><br><p> <strong>:</strong>     ,  -    ? </p><br><p> <strong>:</strong>    :     inline- LW2   .    value-,     generic,       . </p><br><blockquote>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´   Java -?        Valhalla¬ª</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Joker</a> ,    - 25-26  2019 .  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463455/">https://habr.com/ru/post/fr463455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463439/index.html">Ordinateur de contr√¥le embarqu√© Apollo: jauge et analyse technique de la m√©moire sur plusieurs c≈ìurs cousus</a></li>
<li><a href="../fr463441/index.html">√âchantillonneur. Utilitaire de console pour visualiser le r√©sultat des commandes shell</a></li>
<li><a href="../fr463443/index.html">JMeter - Swiss Tester Knife (Partie 2)</a></li>
<li><a href="../fr463445/index.html">9 types de solutions logicielles de collaboration pour la gestion d'√©quipes agiles</a></li>
<li><a href="../fr463447/index.html">Astra Linux 1.6 (Smolensk). Le syst√®me est-il pr√™t √† fonctionner avec des utilisateurs ordinaires? Exemples de b√©quilles</a></li>
<li><a href="../fr463459/index.html">Erreurs cach√©es avec les transitions d'√©l√©ment partag√©</a></li>
<li><a href="../fr463461/index.html">Ce qui est et ce qui n'est pas dans Go. Partie 1</a></li>
<li><a href="../fr463463/index.html">M√©thode pour cr√©er un effet DRAG et DROP</a></li>
<li><a href="../fr463465/index.html">Le livre ¬´JavaScript expressif. Programmation web moderne. 3e √©dition</a></li>
<li><a href="../fr463469/index.html">Chat Schrodinger sans bo√Æte: le probl√®me du consensus dans les syst√®mes distribu√©s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>