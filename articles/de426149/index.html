<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈂️ ✨ 🛌🏼 Das Python-Installationsprogramm für Android zum Selbermachen wird von TeamCity erstellt 👩‍🏭 🌦️ 🏸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Publikum 


 QS-Ingenieure, Tester für mobile Anwendungen, Automatisierung. 
 Das Problem 


 Während des Testens von Anwendungen für Android (nic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Das Python-Installationsprogramm für Android zum Selbermachen wird von TeamCity erstellt</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/426149/"><p><img src="https://habrastorage.org/webt/qm/bs/gf/qmbsgfgzsgr25hphoc3tva3ccru.png"></p><br><h4 id="auditoriya">  Das Publikum </h4><br><p>  QS-Ingenieure, Tester für mobile Anwendungen, Automatisierung. </p><br><h4 id="problema">  Das Problem </h4><br><p>  Während des Testens von Anwendungen für Android (nicht nur, sondern weiter werden wir nur über diese Plattform sprechen) müssen Sie viele Baugruppen des getesteten Produkts / der getesteten Produkte installieren.  Dieser Prozess erfordert Zeit und Mühe, was effizienter ist, um Fehler zu finden. </p><br><p>  In diesem Artikel werden wir uns eine vorhandene Lösung ansehen, unsere eigene in Python schreiben und sie vergleichen. </p><a name="habracut"></a><br><h4 id="gotovoe-reshenie">  Schlüsselfertige Lösung </h4><br><p>  Die derzeit vielleicht beliebteste Lösung für dieses Problem ist der Crashlytics-Dienst, zu dem auch das Beta-Installationsprogramm gehört. </p><br><p>  Betrachten Sie einen typischen Anwendungsinstallationsprozess mit Crashlytics Beta: </p><br><ul><li>  Wir finden das Beta-Symbol (1) → tippen Sie auf (2) = die Anwendung startet. </li><li>  Wir finden das gewünschte Projekt (3) → tippen Sie auf (4) = ein Bildschirm mit einer Liste von Baugruppen wird geöffnet. </li><li>  Suchen Sie die gewünschte Baugruppe (5) → Tippen Sie auf „Herunterladen“ (6) = Die Installationsdatei wird auf das Gerät heruntergeladen. </li><li>  Ein Bildschirm mit einem Vorschlag zur Installation der Anwendung wird angezeigt → Tippen Sie auf „Installieren“ (7) = Der Installationsbildschirm wird angezeigt. </li><li>  Suchen Sie die installierte Anwendung (8) → Tippen Sie auf (9) = Die Anwendung wird gestartet.  bereit zum Testen. </li></ul><br><p>  Um einen Anwendungsbuild mit Crashlytics Beta zu installieren und auszuführen, müssen Sie insgesamt mindestens neun Aktionen ausführen.  Wir werden uns auf diese Indikatoren konzentrieren und versuchen, ein Installationsprogramm zu erstellen, das weniger Aktionen erfordert, um ähnliche Probleme zu lösen. </p><br><h4 id="kastomnoe-reshenie">  Kundenspezifische Lösung </h4><br><p>  Wir wählen Python als Programmiersprache, weil es für unsere Aufgabe geeignet und sehr beliebt ist, auch bei QS-Ingenieuren. <br>  Für die Interaktion mit Android verwenden wir adb, das Teil des Standard-Android-SDK ist. <br>  Dateien herunterladen - Wget. <br>  In unserem Fall werden Baugruppen in TeamCity ausgeführt. </p><br><p>  Fahren wir nun mit dem Schreiben von Code fort. </p><br><p>  Zunächst importieren wir das <em>Unterprozessmodul</em> in das Projekt. Es ist erforderlich, die Befehle <em>wget</em> und <em>adb</em> auszuführen. </p><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> subprocess</code> </pre> <br><p>  Fügen Sie die erforderlichen Einstellungen für Wget hinzu. </p><br><pre> <code class="python hljs">settings = {<span class="hljs-string"><span class="hljs-string">'user'</span></span>: <span class="hljs-string"><span class="hljs-string">'—user=__teamcity'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>: <span class="hljs-string"><span class="hljs-string">'—password=__teamcity'</span></span>, <span class="hljs-string"><span class="hljs-string">'way'</span></span>: <span class="hljs-string"><span class="hljs-string">'____'</span></span>}</code> </pre> <br><p>  Wir werden Anwendungen anhand der Build-Nummer installieren und dem Skript beibringen, nach diesem Parameter zu fragen. </p><br><pre> <code class="python hljs">number = input(<span class="hljs-string"><span class="hljs-string">' № : '</span></span>)</code> </pre> <br><p>  Nehmen wir an, wir müssen zwei Baugruppen gleichzeitig installieren: Test und Kampf.  Wir werden sie von TeamCity herunterladen.  Dazu lernen wir den vollständigen Pfad zu den Dateien, indem wir die Serviceseite öffnen und die Baugruppe in den Artefakten finden.  Die URL vor der Montage sieht ungefähr so ​​aus: </p><br><pre> <code class="python hljs">https://teamcity.mysite.com/repository/app/_/_/myapp-_-_.apk</code> </pre> <br><p>  In der Adresse sehen Sie anstelle der Baugruppennummer die ID, z. B. / 1234: id /.  Hier geben wir nicht die ID, sondern die Baugruppennummer an. </p><br><p>  Wir werden eine Funktion zum Herunterladen der angegebenen Baugruppen schreiben. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">download</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type_b)</span></span></span><span class="hljs-function">:</span></span> url = <span class="hljs-string"><span class="hljs-string">'http://teamcity.mysite.com/repository/app/{0}/{1}/myapp-{0}-{1}.apk'</span></span>.format(number, type_b) <span class="hljs-comment"><span class="hljs-comment">#    — ,  ,    —   , #     —  subprocess.check_output(['wget', '-N', '--cache=off', '--progress=bar', settings['user'], settings['password'], '-P', settings['way'], url])</span></span></code> </pre> <br><p>  Wir werden eine Funktion zum Installieren und Ausführen von Anwendungen schreiben.  Entfernen Sie zuerst zuvor installierte Baugruppen.  Vergessen Sie nicht, dass das Skript mit einem Fehler endet, wenn sich mindestens eine Anwendung nicht auf dem Gerät befindet.  Um dies zu vermeiden, werden wir Fehler ignorieren. </p><br><p>  In diesem imaginären Beispiel zwei Pakete: </p><br><ul><li>  com.myapp.prod </li><li>  com.myapp.test </li></ul><br><p>  Startaktivitäten: </p><br><ul><li>  com.myapp.prod/com.myapp.StartActivity </li><li>  com.myapp.test / com.myapp.StartActivity </li></ul><br><p>  Ihre Paket- und Aktivitätsnamen sind unterschiedlich. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">install</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type_b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-comment"><span class="hljs-comment">#   ,  package name subprocess.check_output(['adb', 'uninstall', 'com.myapp.{0}'.format(type_b)]) except: #     —  . pass finally: #    subprocess.check_output(['adb', 'install', '{0}/myapp-{1}-{2}.apk'.format(settings['way'], number, type_b)]) #   ,  activity name subprocess.check_output(['adb', 'shell', 'am', 'start', 'com.myapp.{0}/com.myapp.StartActivity'.format(type_b)]) print('(^_^)  ({0}-{1})   .'.format(number, type_b))</span></span></code> </pre> <br><p>  Alle notwendigen Funktionen sind geschrieben.  Jetzt können sie angewendet werden. <br>  Darüber hinaus fügen wir einen Handler für den Fall hinzu, dass sich die angegebene Assembly nicht in TeamCity befindet. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-comment"><span class="hljs-comment">#  ,     download('prod') #  ,     download('test') except Exception: #    —     number = input('¯\_(ツ)_/¯   .\n  №: ') else: print(' …') #      install('prod') #      install('test') #    —       print('! (_8(|)\n') break</span></span></code> </pre> <br><p>  Das Skript ist fertig.  Wir speichern es zum Beispiel unter dem Namen installer.py <br>  Fügen Sie einen Alias ​​hinzu, z. B. den <em>Alias ​​inst = 'python ~ / scripts / installer.py'.</em> </p><br><h4 id="proverka">  Überprüfen Sie </h4><br><p>  Um eine Assembly mit Crashlytics Beta zu installieren, müssen Sie 9 Aktionen ausführen.  Zum Vergleich messen wir diesen Indikator im Skript. </p><br><ul><li>  Wir starten das Skript mit dem Befehl inst (1) = Es wird ein Vorschlag zum Festlegen der Build-Nummer angezeigt. </li><li>  Stellen Sie die Baugruppennummer (2) ein = alte Baugruppen werden gelöscht;  Laden Sie neue herunter, installieren Sie sie und starten Sie sie.  Die Anwendung ist zum Testen bereit. </li></ul><br><h4 id="rezultat">  Ergebnis </h4><br><p>  Beta (1 Build) - 9 Aktionen (ohne Löschen alter Builds). <br>  Ihr eigenes Skript (so viele Assemblys wie Sie möchten) - 2 Aktionen. </p><br><p>  Ein zusätzlicher Vorteil der benutzerdefinierten Lösung besteht darin, dass sie skalierbar ist (Hinzufügen der Installation mehrerer Produkte zu einer Reihe von Geräten usw.) und sich auch problemlos an die Aufgaben des automatischen Testens anpassen lässt. </p><br><h4 id="istochniki">  Quellen </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Unterprozess">Unterprozess</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="wget">Wget</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="adb">Android Debug Bridge (adb)</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de426149/">https://habr.com/ru/post/de426149/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de426135/index.html">Private Cloud für das Internet der Dinge</a></li>
<li><a href="../de426137/index.html">Zeitalter der Ehrlichkeit</a></li>
<li><a href="../de426141/index.html">Red Hat ersetzt Docker durch Podman</a></li>
<li><a href="../de426143/index.html">3D-Animation - Video oder interaktiv?</a></li>
<li><a href="../de426145/index.html">Unabhängiger Akzeptanzworkshop, 23. Oktober, Moskau</a></li>
<li><a href="../de426151/index.html">Programmierer Freitag, oder wie ich die Bibliothek für lexikalischen und Parsing-Code schrieb</a></li>
<li><a href="../de426155/index.html">Wir optimieren das Web mit Vitaliy Fridman: Download-Geschwindigkeit, Speicher, CPU</a></li>
<li><a href="../de426157/index.html">PUE: weiß zu senken</a></li>
<li><a href="../de426159/index.html">Ist es möglich, Open Source Code wieder zu schließen?</a></li>
<li><a href="../de426161/index.html">Ist die Lieferung kommerzieller Drohnen gerechtfertigt? Island wird es herausfinden</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>