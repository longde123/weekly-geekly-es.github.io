<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüè≠ üöò üëèüèø PyDERASN: como escrevi a biblioteca ASN.1 com slots e blobs üíî ‚ùóÔ∏è üë®üèΩ‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ASN.1 √© um padr√£o (ISO, ITU-T, GOST) de uma linguagem que descreve informa√ß√µes estruturadas, bem como regras de codifica√ß√£o para essas informa√ß√µes. Pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PyDERASN: como escrevi a biblioteca ASN.1 com slots e blobs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444272/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ASN.1</a> √© um padr√£o (ISO, ITU-T, GOST) de uma linguagem que descreve informa√ß√µes estruturadas, bem como regras de codifica√ß√£o para essas informa√ß√µes.  Para mim, como programador, esse √© apenas outro formato para serializar e apresentar dados, juntamente com JSON, XML, XDR e outros.  √â extremamente comum em nossa vida cotidiana, e muitas pessoas se deparam com isso: em comunica√ß√µes m√≥veis, telef√¥nicas, VoIP (UMTS, LTE, WiMAX, SS7, H.323), em protocolos de rede (LDAP, SNMP, Kerberos), em tudo Em rela√ß√£o √† criptografia (padr√µes X.509, CMS, PKCS), em cart√µes banc√°rios e passaportes biom√©tricos, e muito mais. <br><br>  Este artigo discute a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PyDERASN</a> : Python ASN.1 usada ativamente em projetos relacionados √† criptografia no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atlas</a> . <br><br><div style="text-align:center;"><img alt="Meu" src="https://habrastorage.org/getpro/habr/post_images/7da/d0f/755/7dad0f755070999a4333d0206e830205.jpg"></div><a name="habracut"></a><br>  De fato, n√£o vale a pena recomendar o ASN.1 para tarefas criptogr√°ficas: o ASN.1 e seus codecs s√£o complexos.  Isso significa que o c√≥digo n√£o ser√° simples, mas √© sempre um vetor de ataque extra.  Basta olhar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">para a lista de</a> vulnerabilidades nas bibliotecas ASN.1.  Bruce Schneier, em sua <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">engenharia de criptografia,</a> tamb√©m n√£o recomenda o uso desse padr√£o devido √† sua complexidade: "A codifica√ß√£o TLV mais conhecida √© a ASN.1, mas √© incrivelmente complexa e evitamos isso".  Mas, infelizmente, hoje temos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">infraestruturas de chave p√∫blica</a> que usam ativamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">certificados X.509</a> , CRL, OCSP, TSP, CMP, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CMC</a> , mensagens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CMS</a> e uma tonelada de padr√µes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PKCS</a> .  Portanto, voc√™ deve poder trabalhar com o ASN.1 se estiver fazendo algo relacionado √† criptografia. <br><br>  O ASN.1 pode ser codificado de v√°rias maneiras / codecs: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BER</a> (Regras B√°sicas de Codifica√ß√£o) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CER</a> (Regras de codifica√ß√£o can√¥nica) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DER</a> (Regras de Codifica√ß√£o Distintas) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GSER</a> (Regras de codifica√ß√£o de seq√º√™ncia gen√©rica) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JER</a> (regras de codifica√ß√£o JSON) </li><li>  LWER (Regras de codifica√ß√£o leves) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OER</a> (Regras de codifica√ß√£o de octetos) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PER</a> (regras de codifica√ß√£o compactada) </li><li>  SER (Regras de codifica√ß√£o espec√≠ficas de sinaliza√ß√£o) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">XER</a> (regras de codifica√ß√£o XML) </li></ul><br>  e v√°rios outros.  Mas nas tarefas criptogr√°ficas na pr√°tica, duas s√£o usadas: BER e DER.  Mesmo em documentos XML assinados ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">XMLDSig</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">XAdES</a> ), ainda haver√° objetos ASN.1 DER codificados em Base64, como no protocolo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ACME</a> baseado em JSON do Let's Encrypt.  Voc√™ pode entender melhor todos esses codecs e princ√≠pios de codifica√ß√£o BER / CER / DER em artigos e livros: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ASN.1 em palavras simples</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ASN.1 - Comunica√ß√£o entre sistemas heterog√™neos por Olivier Dubuisson</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ASN.1 Conclu√≠do pelo Prof John Larmouth</a> . <br><br>  O BER √© um formato TLV orientado a byte bin√°rio (por exemplo, PER, popular em comunica√ß√µes m√≥veis - orientado a bits).  Cada elemento √© codificado na forma de: uma tag ( <strong>T</strong> ag) que identifica o tipo de elemento que est√° sendo codificado (n√∫mero inteiro, sequ√™ncia, data, etc.), comprimento (comprimento) do conte√∫do e o conte√∫do em si (valor).  O BER opcionalmente permite que voc√™ n√£o especifique um valor de comprimento, definindo um valor especial de comprimento indefinido e terminando com uma mensagem de fim de octetos.  Al√©m da codifica√ß√£o de comprimento, o BER possui muita variabilidade no m√©todo de codifica√ß√£o de tipos de dados, como <br><br><ul><li>  INTEGER, IDENTIFICADOR DE OBJETOS, BIT STRING e o comprimento do elemento n√£o podem ser normalizados (n√£o codificados na forma m√≠nima); </li><li>  BOOLEAN √© verdadeiro para qualquer conte√∫do diferente de zero; </li><li>  BIT STRING pode conter zero bits "extra"; </li><li>  BIT STRING, OCTET STRING e todos os seus tipos de string derivados, incluindo data / hora, podem ser divididos em partes (peda√ßo) de comprimento vari√°vel, cujo comprimento durante a (des) codifica√ß√£o n√£o √© conhecido antecipadamente; </li><li>  UTCTime / GeneralizedTime pode ter m√©todos diferentes para definir o deslocamento do fuso hor√°rio e as fra√ß√µes zero "extras" de segundos; </li><li>  Os valores da SEQU√äNCIA PADR√ÉO podem ou n√£o ser codificados; </li><li>  Valores nomeados dos √∫ltimos bits em BIT STRING podem ser opcionalmente codificados; </li><li>  SEQUENCE (OF) / SET (OF) pode ter uma ordem arbitr√°ria de elementos. </li></ul><br>  Para todas as op√ß√µes acima, nem sempre √© poss√≠vel codificar dados para que sejam id√™nticos √† forma original.  Portanto, um subconjunto das regras foi inventado: o DER √© uma regulamenta√ß√£o estrita de apenas um m√©todo de codifica√ß√£o v√°lido, essencial para tarefas criptogr√°ficas, nas quais, por exemplo, alterar um bit invalida a assinatura ou a soma de verifica√ß√£o.  O DER tem uma desvantagem significativa: os comprimentos de todos os elementos devem ser conhecidos antecipadamente durante a codifica√ß√£o, o que n√£o permite a serializa√ß√£o de dados por fluxo.  O codec CER est√° livre dessa desvantagem, garantindo da mesma forma uma apresenta√ß√£o inequ√≠voca dos dados.  Infelizmente (ou felizmente, n√£o temos decodificadores ainda mais complexos?), Ele n√£o se tornou popular.  Portanto, na pr√°tica, encontramos um uso "misto" de dados codificados em BER e DER.  Como o CER e o DER s√£o um subconjunto do BER, qualquer decodificador BER √© capaz de process√°-los. <br><br><h2>  Problemas com pyasn1 </h2><br>  No trabalho, escrevemos muitos programas Python relacionados √† criptografia.  E h√° alguns anos, praticamente n√£o havia escolha de bibliotecas gratuitas: ou s√£o bibliotecas de n√≠vel muito baixo que permitem codificar / decodificar, por exemplo, um n√∫mero inteiro e um cabe√ßalho de estrutura, ou essa √© a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pyasn1</a> .  N√≥s vivemos nele por v√°rios anos e, a princ√≠pio, ficamos muito satisfeitos, pois permite trabalhar com estruturas ASN.1 como objetos de alto n√≠vel: por exemplo, um objeto de certificado X.509 decodificado permite acessar seus campos atrav√©s da interface do dicion√°rio: cert ["tbsCertificate"] ["SerialNumber"] nos mostrar√° o n√∫mero de s√©rie deste certificado.  Da mesma forma, voc√™ pode "coletar" objetos complexos trabalhando com eles como em listas, dicion√°rios e, em seguida, basta chamar a fun√ß√£o pyasn1.codec.der.encoder.encode e obter uma representa√ß√£o serializada do documento. <br><br>  No entanto, fraquezas, problemas e limita√ß√µes foram revelados.  Infelizmente, ainda existem erros no pyasn1: no momento da escrita, no pyasn1, um dos tipos b√°sicos, GeneralizedTime, √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">incorretamente</a> decodificado e codificado. <br><br>  Em nossos projetos, para economizar espa√ßo, geralmente armazenamos apenas o caminho para o arquivo, o deslocamento e o comprimento em bytes do objeto ao qual queremos nos referir.  Por exemplo, um arquivo assinado arbitr√°rio provavelmente estar√° localizado na estrutura do CMS SignedData ASN.1: <br><br><pre><code class="plaintext hljs">0 [1,3,1018] ContentInfo SEQUENCE 4 [1,1, 9] . contentType: ContentType OBJECT IDENTIFIER 1.2.840.113549.1.7.2 (id_signedData) 19-4 [0,0,1003] . content: [0] EXPLICIT [UNIV 16] ANY 19 [1,3, 999] . . DEFINED BY id_signedData: SignedData SEQUENCE 23 [1,1, 1] . . . version: CMSVersion INTEGER v3 (03) 26 [1,1, 19] . . . digestAlgorithms: DigestAlgorithmIdentifiers SET OF [...] 47 [1,3, 769] . . . encapContentInfo: EncapsulatedContentInfo SEQUENCE 51 [1,1, 8] . . . . eContentType: ContentType OBJECT IDENTIFIER 1.3.6.1.5.5.7.12.2 (id_cct_PKIData) 65-4 [1,3, 751] . . . . eContent: [0] EXPLICIT OCTET STRING 751 bytes OPTIONAL      751  820 [1,2, 199] . . . signerInfos: SignerInfos SET OF 823 [1,2, 196] . . . . 0: SignerInfo SEQUENCE 826 [1,1, 1] . . . . . version: CMSVersion INTEGER v3 (03) 829 [0,0, 22] . . . . . sid: SignerIdentifier CHOICE subjectKeyIdentifier [...] 956 [1,1, 64] . . . . . signature: SignatureValue OCTET STRING 64 bytes . . . . . . C1:B3:88:BA:F8:92:1C:E6:3E:41:9B:E0:D3:E9:AF:D8 . . . . . . 47:4A:8A:9D:94:5D:56:6B:F0:C1:20:38:D2:72:22:12 . . . . . . 9F:76:46:F6:51:5F:9A:8D:BF:D7:A6:9B:FD:C5:DA:D2 . . . . . . F3:6B:00:14:A4:9D:D7:B5:E1:A6:86:44:86:A7:E8:C9</code> </pre> <br>  e podemos obter o arquivo assinado original em um deslocamento de 65 bytes, 751 bytes.  pyasn1 n√£o armazena essas informa√ß√µes em seus objetos decodificados.  O chamado TLVSeeker foi escrito - uma pequena biblioteca que permite decodificar as tags e comprimentos de objetos, na interface da qual comandamos "ir para a pr√≥xima tag", "ir dentro da tag" (ir dentro da SEQU√äNCIA do objeto), "ir para a pr√≥xima tag", "informar o seu deslocamento e o comprimento do objeto em que estamos. "  Foi uma caminhada ‚Äúmanual‚Äù nos dados serializados pelo ASN.1 DER.  Mas n√£o foi poss√≠vel trabalhar com dados serializados do BER dessa maneira, porque, por exemplo, a sequ√™ncia de bytes OCTET STRING pode ser codificada como v√°rias partes. <br><br>  Outra desvantagem de nossas tarefas pyasn1 √© a incapacidade de entender de objetos decodificados se um determinado campo estava presente no SEQUENCE ou n√£o.  Por exemplo, se a estrutura contiver o campo SEQU√äNCIA DE SEGUNDO campo OPCIONAL, ele poder√° estar completamente ausente nos dados recebidos (OPCIONAL), mas poder√° estar presente, mas ao mesmo tempo ter comprimento zero (lista vazia).  No caso geral, isso n√£o p√¥de ser esclarecido.  E isso √© necess√°rio para uma verifica√ß√£o rigorosa da validade dos dados recebidos.  Imagine que alguma autoridade de certifica√ß√£o emitisse um certificado com dados "n√£o totalmente" v√°lidos do ponto de vista dos esquemas ASN.1!  Por exemplo, a autoridade de certifica√ß√£o T√úRKTRUST Elektronik Sertifika Hizmet Saƒülayƒ±cƒ±sƒ± em seu certificado raiz ultrapassava os limites permitidos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 5280</a> para a dura√ß√£o do componente em quest√£o - n√£o pode ser honestamente decodificado de acordo com o esquema.  O codec DER exige que um campo cujo valor seja DEFAULT n√£o seja codificado durante a transmiss√£o - esses documentos s√£o encontrados na vida, e a primeira vers√£o do PyDERASN permitiu conscientemente esse comportamento inv√°lido (do ponto de vista do DER) por uma quest√£o de compatibilidade com vers√µes anteriores. <br><br>  Outra limita√ß√£o √© a incapacidade de descobrir facilmente de que forma (BER / DER) um ou outro objeto foi codificado na estrutura.  Por exemplo, o padr√£o CMS diz que a mensagem √© codificada em BER, mas o campo assinadoAttrs, sobre o qual a assinatura criptogr√°fica √© formada, deve estar no DER.  Se decodificarmos com o DER, recairemos sobre o processamento do pr√≥prio CMS; se decodificarmos com o BER, n√£o saberemos de que forma era assinadoAttrs.  Como resultado, ser√° necess√°rio que o TLVSeeker (o an√°logo n√£o esteja no pyasn1) procure a localiza√ß√£o de cada um dos campos do assinadoAttrs e deve ser decodificado separadamente pelo DER a partir da visualiza√ß√£o serializada. <br><br>  A possibilidade de processamento autom√°tico dos campos DEFINED BY, que s√£o muito comuns, era muito desej√°vel para n√≥s.  Ap√≥s decodificar a estrutura ASN.1, podemos ter muitos campos restantes, os quais devem ser processados ‚Äã‚Äãainda mais de acordo com o esquema selecionado com base no IDENTIFICADOR DE OBJETO especificado no campo de estrutura.  No c√≥digo Python, isso significa escrever um if e, em seguida, chamar o decodificador para o campo ANY. <br><br><h2>  O advento do PyDERASN </h2><br>  No Atlas, regularmente, tendo encontrado problemas ou modificando os programas gratuitos usados, enviamos patches para o topo.  No pyasn1, enviamos aprimoramentos v√°rias vezes, mas o c√≥digo pyasn1 n√£o √© o mais f√°cil de entender e, algumas vezes, ocorrem altera√ß√µes incompat√≠veis na API, que nos atingem nas m√£os.  Al√©m disso, estamos acostumados a escrever testes com testes generativos, o que n√£o era o caso no pyasn1. <br><br>  Um belo dia, decidi que tinha que suportar isso e estava na hora de tentar escrever minha pr√≥pria biblioteca com __slot__s, offset s e blobs belamente exibidos!  Apenas criar um codec ASN.1 n√£o seria suficiente - voc√™ precisa transferir todos os nossos projetos dependentes para ele, e s√£o centenas de milhares de linhas de c√≥digo nas quais h√° muito trabalho com estruturas ASN.1.  Esse √© um dos requisitos: facilidade de tradu√ß√£o do c√≥digo pyasn1 atual.  Depois de passar minhas f√©rias inteiras, escrevi esta biblioteca e transferi todos os projetos para ela.  Como eles t√™m quase 100% de cobertura por testes, isso tamb√©m significava que a biblioteca estava totalmente operacional. <br><br>  Da mesma forma, o PyDERASN tem quase 100% de cobertura de teste.  O teste generativo √© usado com a maravilhosa biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hip√≥teses</a> .  Tamb√©m foram executadas imagens em 32 m√°quinas nucleares.  Apesar do fato de n√£o termos quase nenhum c√≥digo Python2, o PyDERASN ainda mant√©m compatibilidade com ele e, por isso, possui uma √∫nica depend√™ncia de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">seis</a> .  Al√©m disso, ele √© testado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conjunto de testes de conformidade ASN.1: 2008</a> . <br><br>  O princ√≠pio de trabalhar com ele √© semelhante ao pyasn1 - trabalhando com objetos Python de alto n√≠vel.  A descri√ß√£o dos circuitos ASN.1 √© semelhante. <br><br><pre> <code class="plaintext hljs">class TBSCertificate(Sequence): schema = ( ("version", Version(expl=tag_ctxc(0), default="v1")), ("serialNumber", CertificateSerialNumber()), ("signature", AlgorithmIdentifier()), ("issuer", Name()), ("validity", Validity()), ("subject", Name()), ("subjectPublicKeyInfo", SubjectPublicKeyInfo()), ("issuerUniqueID", UniqueIdentifier(impl=tag_ctxp(1), optional=True)), ("subjectUniqueID", UniqueIdentifier(impl=tag_ctxp(2), optional=True)), ("extensions", Extensions(expl=tag_ctxc(3), optional=True)), )</code> </pre><br>  No entanto, PyDERASN tem uma apar√™ncia de digita√ß√£o forte.  Em pyasn1, se o campo fosse do tipo CMSVersion (INTEGER), ele poderia receber um int ou INTEGER.  O PyDERASN exige estritamente que o objeto atribu√≠do seja exatamente CMSVersion.  Al√©m de escrever o c√≥digo Python3, usamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">anota√ß√µes de digita√ß√£o</a> , para que nossas fun√ß√µes n√£o tenham argumentos incompreens√≠veis como def func (serial, conte√∫do), mas def func (serial: CertificateSerialNumber, contents: EncapsulatedContentInfo) e o PyDERASN ajuda a acompanhar tais c√≥digo. <br><br>  Ao mesmo tempo, o PyDERASN possui concess√µes extremamente convenientes para essa mesma digita√ß√£o.  pyasn1 n√£o permitiu que SubjectKeyIdentifier (). subtype (implicitTag = Tag (...)) atribua um objeto SubjectKeyIdentifier () (sem a IMPLICIT TAG necess√°ria) e geralmente precisava copiar e recriar objetos apenas devido √†s tags IMPLICIT / EXPLICIT alteradas.  O PyDERASN observa estritamente apenas o tipo b√°sico - ele substituir√° automaticamente as tags de uma estrutura ASN.1 existente.  Isso simplifica bastante o c√≥digo do aplicativo. <br><br>  Se ocorrer um erro durante a decodifica√ß√£o, no pyasn1 n√£o ser√° f√°cil entender exatamente onde ocorreu.  Por exemplo, no certificado turco j√° mencionado, obtemos este erro: UTF8String (tbsCertificate: issuer: rdnSequence: 3: 0: value: DEFINED BY 2.5.4.10:utf8String) (138) limites n√£o satisfeitos: 1 ‚áê 77 ‚áê 64 Ao escrever o ASN .1 as pessoas podem cometer erros e facilita a depura√ß√£o de aplicativos ou a descoberta de problemas nos documentos codificados do lado oposto. <br><br>  A primeira vers√£o do PyDERASN n√£o suportava a codifica√ß√£o BER.  Apareceu muito mais tarde e o processamento UTCTime / GeneralizedTime com fusos hor√°rios ainda n√£o √© suportado.  Isso vir√° no futuro, porque o projeto √© escrito principalmente em tempo livre. <br><br>  Tamb√©m na primeira vers√£o n√£o houve trabalho com os campos DEFINED BY.  Poucos meses depois, essa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">oportunidade apareceu</a> e come√ßou a ser usada ativamente, reduzindo significativamente o c√≥digo do aplicativo - em uma opera√ß√£o de decodifica√ß√£o, foi poss√≠vel desmontar toda a estrutura completamente.  Para fazer isso, no esquema, quais campos s√£o definidos que "determinam".  Por exemplo, uma descri√ß√£o de um esquema do CMS: <br><br><pre> <code class="plaintext hljs">class ContentInfo(Sequence): schema = ( ("contentType", ContentType(defines=((("content",), { id_authenticatedData: AuthenticatedData(), id_digestedData: DigestedData(), id_encryptedData: EncryptedData(), id_envelopedData: EnvelopedData(), id_signedData: SignedData(), }),))), ("content", Any(expl=tag_ctxc(0))), )</code> </pre><br>  diz que se contentType contiver um OID com id_signedData, o campo de conte√∫do (localizado na mesma SEQUENCE) precisar√° ser decodificado usando o esquema SignedData.  Por que existem tantos suportes?  Um campo pode "definir" v√°rios campos ao mesmo tempo, como √© o caso das estruturas EnvelopedData.  Os campos definidos s√£o identificados pelo chamado caminho de decodifica√ß√£o - ele define a localiza√ß√£o exata de qualquer elemento em todas as estruturas. <br><br>  Nem sempre √© desej√°vel ou nem sempre √© poss√≠vel introduzir imediatamente essas defini√ß√µes no circuito.  Pode haver casos espec√≠ficos de aplicativos em que OIDs e estruturas s√£o conhecidas apenas em um projeto de terceiros.  O PyDERASN fornece a capacidade de especificar essas defini√ß√µes no momento da decodifica√ß√£o da estrutura: <br><br><pre> <code class="plaintext hljs">ContentInfo().decode(data, ctx={"defines_by_path": (( ( "content", DecodePathDefBy(id_signedData), "certificates", any, "certificate", "tbsCertificate", "extensions", any, "extnID", ), ((("extnValue",), { id_ce_authorityKeyIdentifier: AuthorityKeyIdentifier(), id_ce_basicConstraints: BasicConstraints(), [...] id_ru_subjectSignTool: SubjectSignTool(), }),), ),)})</code> </pre><br>  Aqui dizemos que, no CMS SignedData, para todos os certificados anexados, decodifique todas as suas extens√µes (AuthorityKeyIdentifier, BasicConstraints, SubjectSignTool, etc.).  Indicamos atrav√©s do caminho de decodifica√ß√£o qual elemento "substituir" define, como se fosse definido no circuito. <br><br>  Finalmente, o PyDERASN tem a capacidade de trabalhar a partir da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">linha de comando</a> para decodificar arquivos ASN.1 e possui uma rica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">e bonita impress√£o</a> .  Voc√™ pode decodificar um ASN.1 arbitr√°rio ou especificar um esquema claramente definido e ver algo assim: <br><br><img alt="Exemplo bonito de impress√£o" src="https://habrastorage.org/getpro/habr/post_images/3dc/981/000/3dc981000f30512bf2ca9488332345d4.png"><br><br>  Informa√ß√µes exibidas: deslocamento do objeto, comprimento do tag, comprimento do comprimento, comprimento do conte√∫do, presen√ßa de EOC (fim de octetos), sinalizador de codifica√ß√£o BER, sinalizador de codifica√ß√£o de comprimento indefinido, comprimento e deslocamento da marca EXPLICIT (se houver), profundidade de aninhamento de objeto em estruturas, valor da tag IMPLICIT / EXPLICIT, nome do objeto de acordo com o esquema, seu tipo ASN.1 b√°sico, n√∫mero de s√©rie dentro de SEQUENCE / SET OF, valor CHOICE (se houver), nome leg√≠vel por humanos INTEGER / ENUMERATED / BIT STRING de acordo com o esquema, valor de qualquer tipo b√°sico , Flag PADR√ÉO / OPCIONAL do circuito, um sinal de que o objeto foi decodificado automaticamente como DEFINIDO POR e depois  gm de OID e isso aconteceu, chelovekochitaemy OID. <br><br>  O bonito sistema de impress√£o √© feito especialmente para gerar uma sequ√™ncia de objetos PP que j√° s√£o visualizados por meios separados.  A captura de tela mostra o renderizador em texto colorido simples.  Existem renderizadores no formato JSON / HTML para que isso possa ser visto com destaque no navegador ASN.1 como no projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">asn1js</a> . <br><br><h2>  Outras bibliotecas </h2><br>  Este n√£o era o objetivo, mas o PyDERASN era significativamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mais r√°pido</a> que o pyasn1.  Por exemplo, a decodifica√ß√£o de arquivos CRL de tamanhos de megabytes pode levar tanto tempo que voc√™ precisa pensar em formatos intermedi√°rios para armazenar dados (r√°pido) e alterar a arquitetura dos aplicativos.  pyasn1 decodifica CRL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CACert.org</a> no meu laptop por mais de 20 minutos, enquanto PyDERASN em apenas 28 segundos!  Existe um projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">asn1crypto</a> destinado a trabalhar rapidamente com estruturas criptogr√°ficas: ele decodifica (completamente, n√£o pregui√ßosamente) a mesma CRL em 29 segundos, mas consome quase o dobro de RAM ao executar no Python3 (983 MiB versus 498), e 3,5 vezes no Python2 (1677 contra 488), enquanto pyasn1 consome 4,3 vezes mais (2093 contra 488). <br><br>  o asn1crypto, que mencionei, n√£o consideramos, porque o projeto estava em sua inf√¢ncia e ainda n√£o t√≠nhamos ouvido falar.  Agora eles tamb√©m n√£o come√ßariam a olhar na dire√ß√£o dele, pois eu imediatamente descobri que o mesmo GeneralizedTime n√£o √© arbitr√°rio e, quando serializado, ele remove silenciosamente fra√ß√µes de segundo.  Isso √© aceit√°vel para trabalhar com certificados X.509, mas em geral n√£o funcionar√°. <br><br>  No momento, o PyDERASN √© o mais rigoroso dos decodificadores gratuitos Python / Go DER que eu conhe√ßo.  Na biblioteca encoding / asn1 do meu Go favorito, n√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">h√° uma verifica√ß√£o rigorosa nas</a> seq√º√™ncias de caracteres OBJECT IDENTIFIER e UTCTime / GeneralizedTime.  √Äs vezes, o rigor pode interferir (principalmente devido √† compatibilidade com aplicativos antigos que ningu√©m corrigir√°), portanto, no PyDERASN durante a decodifica√ß√£o, voc√™ pode passar por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√°rias</a> verifica√ß√µes de enfraquecimento das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">configura√ß√µes</a> . <br><br>  O c√≥digo do projeto tenta ser o mais simples poss√≠vel.  A biblioteca inteira √© um √∫nico arquivo.  O c√≥digo √© escrito com √™nfase na facilidade de entendimento, sem desempenho desnecess√°rio e otimiza√ß√µes de c√≥digo DRY.  Como eu j√° disse, ele n√£o suporta a decodifica√ß√£o BER completa de seq√º√™ncias UTCTime / GeneralizedTime, bem como tipos de dados REAL, OID RELATIVO, EXTERNO, INSTANCE DE, PDV EMBUTIDO, CHARACTER STRING.  Em todos os outros casos, pessoalmente, n√£o vejo raz√£o para usar outras bibliotecas no Python. <br><br>  Como todos os meus projetos, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PyGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GoGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NNCP</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GoVPN</a> , PyDERASN √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um software</a> totalmente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gratuito,</a> distribu√≠do sob os termos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LGPLv3 +</a> , e est√° dispon√≠vel para download gratuito.  Exemplos de uso est√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">testes do PyGOST</a> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sergey Matveev</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">banco de cifras</a> , membro da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Open Society</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Foundation Foundation</a> , desenvolvedor Python / Go, especialista principal do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FSUE ‚ÄúSTC Atlas‚Äù</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt444272/">https://habr.com/ru/post/pt444272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt444260/index.html">Estamos desenvolvendo um sistema para avaliar o trabalho dos agentes de suporte</a></li>
<li><a href="../pt444262/index.html">C√≥digo fonte Markdown2pdf para Linux</a></li>
<li><a href="../pt444264/index.html">Como se tornar um colaborador e voc√™ realmente precisa dele</a></li>
<li><a href="../pt444268/index.html">Semana 12 de seguran√ßa: ataques de teclado</a></li>
<li><a href="../pt444270/index.html">Webinar do Grupo-IB ‚ÄúA abordagem do Grupo-IB √† educa√ß√£o cibern√©tica: uma vis√£o geral dos programas atuais e casos pr√°ticos‚Äù</a></li>
<li><a href="../pt444274/index.html">Uma resposta detalhada ao coment√°rio, bem como um pouco sobre a vida dos provedores na Federa√ß√£o Russa</a></li>
<li><a href="../pt444276/index.html">Introdu√ß√£o √† arquitetura de fibra reativa</a></li>
<li><a href="../pt444278/index.html">Como fazer o seu artigo em ingl√™s para Habr lido por dezenas de milhares de pessoas: 3 dicas simples</a></li>
<li><a href="../pt444282/index.html">7 extens√µes do Chrome para aprender ingl√™s</a></li>
<li><a href="../pt444284/index.html">conclus√£o do compositor e da linha de comando</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>