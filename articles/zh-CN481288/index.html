<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⤵️ 💳 🖕🏽 Redux Toolkit作为有效Redux开发的工具 👩🏿 👢 🚵🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="当前，正在使用Redux库开发基于React框架的大部分Web应用程序。 该库是FLUX架构最流行的实现，尽管有很多明显的优点，但它也具有非常明显的缺点，例如： 


- 推荐的用于编写和组织代码的模式的复杂性和“冗长性”，这需要大量样板； 
- 缺乏用于异步行为和副作用的内置控件，这导致需要从第三...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Redux Toolkit作为有效Redux开发的工具</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/inobitec/blog/481288/"><p><img src="https://habrastorage.org/getpro/habr/post_images/aad/f48/d2f/aadf48d2f864cef234b3b73d600dc8d1.jpg" alt="图片"><br> 当前，正在使用Redux库开发基于React框架的大部分Web应用程序。 该库是FLUX架构最流行的实现，尽管有很多明显的优点，但它也具有非常明显的缺点，例如： </p><br><ul><li> 推荐的用于编写和组织代码的模式的复杂性和“冗长性”，这需要大量样板； </li><li> 缺乏用于异步行为和副作用的内置控件，这导致需要从第三方开发人员编写的各种附件中选择合适的工具。 </li></ul><br><p> 为了解决这些缺点，Redux开发人员引入了Redux Toolkit库。 该工具是一组实用的解决方案和方法，旨在简化使用Redux的应用程序开发。 该库的开发人员旨在简化使用Redux的典型案例。 在使用Redux的每种可能情况下，该工具都不是通用的解决方案，但它可以简化开发人员需要编写的代码。 </p><br><p> 在本文中，我们将讨论Redux Toolkit中包含的主要工具，并以内部应用程序片段的示例为例，展示如何在现有代码中使用它们。 </p><a name="habracut"></a><br><h2 id="kratko-o-biblioteke"> 图书馆简介 </h2><br><p>  Redux工具包摘要： </p><br><ul><li>在发布之前，该库称为redux-starter-kit； </li><li> 发布于2019年10月底进行; </li><li>  Redux开发人员正式支持该库。 </li></ul><br><p> 根据<a href="https://redux-toolkit.js.org/introduction/quick-start">开发人员的</a>说法，Redux Toolkit执行以下功能： </p><br><ul><li> 帮助您快速开始使用Redux。 </li><li> 使用典型任务和Redux代码简化工作； </li><li> 默认情况下，允许您使用Redux的最佳做法； </li><li> 提供的解决方案可减少对样板的不信任。 </li></ul><br><p>  Redux Toolkit提供了一组专门设计的<a href="https://redux-toolkit.js.org/api/other-exports">工具</a> ，并添加了许多与Redux共同使用的经过验证的<a href="https://redux-toolkit.js.org/api/other-exports">工具</a> 。 这种方法使开发人员可以决定如何在其应用程序中使用哪些工具。 在本文的过程中，我们将注意该库使用哪些借用。 有关Redux Toolkit的更多信息和依赖性，请参阅<a href="https://www.npmjs.com/package/%40reduxjs/toolkit">@ reduxjs / toolkit</a>软件包说明。 </p><br><p>  Redux Toolkit库提供的最重要的功能是： </p><br><ul><li>  <a href="https://habr.com/ru/company/inobitec/blog/481288/">#</a> configureStore-旨在简化创建和配置存储的过程的功能； </li><li>  <a href="https://habr.com/ru/company/inobitec/blog/481288/">#createReducer-</a>此功能有助于简洁明了地描述和创建化<a href="https://habr.com/ru/company/inobitec/blog/481288/">简</a>器； </li><li>  <a href="https://habr.com/ru/company/inobitec/blog/481288/">#createAction-</a>为动作类型的指定字符串返回动作创建者的函数； </li><li>  <a href="https://habr.com/ru/company/inobitec/blog/481288/">#createSlice-</a>结合了createAction和createReducer的功能； </li><li>  createSelector是<a href="https://github.com/reduxjs/reselect">Reselect</a>库中的一个函数，已<a href="https://github.com/reduxjs/reselect">重新导出</a>以便于使用。 </li></ul><br><p> 还应注意Redux Toolkit与TypeScript完全集成。 有关更多信息，请参见官方文档中的<a href="https://redux-toolkit.js.org/usage/usage-with-typescript/">TypeScript用法</a> 。 </p><br><h2 id="primenenie"> 申请书 </h2><br><p> 考虑使用Redux Toolkit库作为实际使用的React Redux应用程序片段的示例。 <br>  <em>注意事项</em> 在本文的进一步内容中，将在不使用Redux Toolkit且不使用Redux Toolkit的情况下展示源代码，这将有助于更好地评估使用该库的积极和消极方面。 </p><br><h3 id="zadacha"> 挑战赛 </h3><br><p> 在我们的一个内部应用程序中，需要添加，编辑和显示有关我们软件产品版本的信息。 对于每个操作，都开发了单独的API函数，需要将其结果添加到Redux存储中。 作为控制异步行为和副作用的一种方法，我们将使用<a href="https://github.com/reduxjs/redux-thunk">Thunk</a> 。 </p><br><h3 id="sozdanie-hranilischa"> 创建存储 </h3><br><p> 创建存储库的源代码的初始版本如下所示： </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createStore, applyMiddleware, combineReducers, compose, } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> thunk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-thunk'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> reducers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ext = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.__REDUX_DEVTOOLS_EXTENSION__; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> devtoolMiddleware = ext &amp;&amp; process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span> ? ext() : <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f</span></span></span><span class="hljs-function"> =&gt;</span></span> f; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore( combineReducers({ ...reducers, }), compose( applyMiddleware(thunk), devtoolMiddleware ) );</code> </pre> <br><p> 如果仔细看一下上面的代码，您会看到很长的动作序列，必须完成这些动作才能完全配置存储。  Redux Toolkit包含一个旨在简化此过程的工具，即configureStore函数。 </p><br><h4 id="funkciya-configurestoreanchorconfigurestoreanchor">  ConfigureStore功能 <a name="configureStore"></a></h4><br><p> 该工具可让您自动组合化归约器，添加Redux中间件（默认包括redux-thunk）以及使用Redux DevTools扩展。  configureStore函数接受具有以下属性的对象作为输入参数： </p><br><ul><li> 减速器-一组定制减速器， </li><li> 中间件-一个可选参数，用于指定旨在连接到存储库的中间件数组， </li><li>  devTools-逻辑类型参数，可让您启用浏览器中安装的Redux DevTools扩展（默认值为true）， </li><li>  preloadedState-一个可选参数，用于设置存储库的初始状态， </li><li> 增强器-定义一组放大器的可选参数。 </li></ul><br><p> 要获得最受欢迎的中间件列表，可以使用特殊功能getDefaultMiddleware，它也是Redux Toolkit的一部分。 此函数返回Redux Toolkit库中默认启用了中间件的数组。 这些中间件的列表因执行代码的方式而异。 在生产模式下，数组仅包含一个元素-thunk。 在开发模式下，在编写本文时，该列表将补充以下中间件： </p><br><ul><li>  serializableStateInvariant-一种专门用于Redux Toolkit的工具，旨在检查状态树中是否存在不可序列化的值，例如函数，Promise，Symbol和不是简单JS数据的其他值； </li><li>  immutableStateInvariant-来自<a href="https://www.npmjs.com/package/redux-immutable-state-invariant">redux-immutable-state-invariant</a>包的中间件，用于检测存储中包含的数据中的突变。 </li></ul><br><p> 要指定中间件的升序列表，getDefaultMidlleware函数接受一个对象，该对象定义了所包括的中间件及其设置的列表。 有关此信息的更多信息，请参见官方文档的相应<a href="https://redux-toolkit.js.org/api/getDefaultMiddleware">部分</a> 。 </p><br><p> 现在，我们将重写代码部分，以使用上述工具创建存储库。 结果，我们得到以下信息： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { configureStore, getDefaultMiddleware } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@reduxjs/toolkit'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> reducers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> middleware = getDefaultMiddleware({ <span class="hljs-attr"><span class="hljs-attr">immutableCheck</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">serializableCheck</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">thunk</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = configureStore({ <span class="hljs-attr"><span class="hljs-attr">reducer</span></span>: { ...reducers }, middleware, <span class="hljs-attr"><span class="hljs-attr">devTools</span></span>: process.env.NODE_ENV !== <span class="hljs-string"><span class="hljs-string">'production'</span></span>, });</code> </pre> <br><p> 使用本节代码的示例，您可以清楚地看到configureStore函数解决了以下问题： </p><br><ul><li> 需要合并减速器，自动调用CombineReducers， </li><li> 需要结合中间件时，会自动调用applyMiddleware。 </li></ul><br><p> 它还允许您使用<a href="https://www.npmjs.com/package/redux-devtools-extension">redux-devtools-extension</a>包中的composeWithDevTools函数更方便地启用Redux DevTools扩展。 以上所有这些都表明使用此功能可以使代码更紧凑和易于理解。 </p><br><p> 这样就完成了存储库的创建和配置。 我们将其转移给提供商，然后继续。 </p><br><h3 id="deystviya-sozdateli-deystviy-i-redyuser"> 动作，动作创建者和减速器 </h3><br><p> 现在，让我们从开发动作，动作创建者和化简器的角度来看一下Redux Toolkit的功能。 不使用Redux Toolkit的代码的初始版本被组织为actions.js和reducers.js文件。  actions.js文件的内容如下所示： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> productReleasesService <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../services/productReleases'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PRODUCT_RELEASES_FETCHING = <span class="hljs-string"><span class="hljs-string">'PRODUCT_RELEASES_FETCHING'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PRODUCT_RELEASES_FETCHED = <span class="hljs-string"><span class="hljs-string">'PRODUCT_RELEASES_FETCHED'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PRODUCT_RELEASES_FETCHING_ERROR = <span class="hljs-string"><span class="hljs-string">'PRODUCT_RELEASES_FETCHING_ERROR'</span></span>; … <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PRODUCT_RELEASE_UPDATING = <span class="hljs-string"><span class="hljs-string">'PRODUCT_RELEASE_UPDATING'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PRODUCT_RELEASE_UPDATED = <span class="hljs-string"><span class="hljs-string">'PRODUCT_RELEASE_UPDATED'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PRODUCT_RELEASE_CREATING_UPDATING_ERROR = <span class="hljs-string"><span class="hljs-string">'PRODUCT_RELEASE_CREATING_UPDATING_ERROR'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">productReleasesFetching</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: PRODUCT_RELEASES_FETCHING }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">productReleasesFetched</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productReleases</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: PRODUCT_RELEASES_FETCHED, productReleases }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">productReleasesFetchingError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: PRODUCT_RELEASES_FETCHING_ERROR, error } } … <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchProductReleases</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch(productReleasesFetching()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productReleasesService.getProductReleases().then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productReleases</span></span></span><span class="hljs-function"> =&gt;</span></span> dispatch(productReleasesFetched(productReleases)) ).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { error.clientMessage = <span class="hljs-string"><span class="hljs-string">"Can't get product releases"</span></span>; dispatch(productReleasesFetchingError(error)) }); } } … <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateProductRelease</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> id, productName, productVersion, releaseDate </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch(productReleaseUpdating()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productReleasesService.updateProductRelease( id, productName, productVersion, releaseDate ).then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productRelease</span></span></span><span class="hljs-function"> =&gt;</span></span> dispatch(productReleaseUpdated(productRelease)) ).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { error.clientMessage = <span class="hljs-string"><span class="hljs-string">"Can't update product releases"</span></span>; dispatch(productReleaseCreatingUpdatingError(error)) }); } }</code> </pre> <br><p> 使用Redux Toolkit之前reducers.js文件的内容： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { <span class="hljs-attr"><span class="hljs-attr">productReleases</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">loadedProductRelease</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">fetchingState</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-attr"><span class="hljs-attr">creatingState</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-attr"><span class="hljs-attr">updatingState</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action = {}</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> productReleases.PRODUCT_RELEASES_FETCHING: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">fetchingState</span></span>: <span class="hljs-string"><span class="hljs-string">'requesting'</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> productReleases.PRODUCT_RELEASES_FETCHED: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">productReleases</span></span>: action.productReleases, <span class="hljs-attr"><span class="hljs-attr">fetchingState</span></span>: <span class="hljs-string"><span class="hljs-string">'success'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> productReleases.PRODUCT_RELEASES_FETCHING_ERROR: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">fetchingState</span></span>: <span class="hljs-string"><span class="hljs-string">'failed'</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.error }; … <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> productReleases.PRODUCT_RELEASE_UPDATING: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">updatingState</span></span>: <span class="hljs-string"><span class="hljs-string">'requesting'</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> productReleases.PRODUCT_RELEASE_UPDATED: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">updatingState</span></span>: <span class="hljs-string"><span class="hljs-string">'success'</span></span>, <span class="hljs-attr"><span class="hljs-attr">productReleases</span></span>: state.productReleases.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productRelease</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (productRelease.id === action.productRelease.id) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.productRelease; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productRelease; }) }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> productReleases.PRODUCT_RELEASE_UPDATING_ERROR: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">updatingState</span></span>: <span class="hljs-string"><span class="hljs-string">'failed'</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.error }; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br><p> 如我们所见，这是大多数样板所在的位置：动作类型常量，动作创建者，常量，但是在化简器代码中，编写所有这些代码需要时间。 您可以使用redux Toolkit的createAction和createReducer函数来部分摆脱此样板。 </p><br><h4 id="funkciya-createactionanchorcreateactionanchor">  CreateAction函数 <a name="createAction"></a></h4><br><p> 在代码的给定部分中，使用了在Redux中定义动作的标准方法：首先，分别定义一个常量，该常量确定动作的类型，然后-此类型的动作的创建者的功能。  <a href="https://redux-toolkit.js.org/api/createaction/">createAction</a>函数将这两个声明合并为一个。 在输入时，它接受一个操作类型并返回该类型的操作的创建者。 动作创建者可以不带参数，也可以带某些参数（有效负载）调用，其值将放置在所创建动作的有效负载字段中。 此外，动作创建者会覆盖toString（）函数，以便动作类型成为其字符串表示形式。 </p><br><p> 在某些情况下，您可能需要编写其他逻辑来调整有效负载的值，例如，接受动作创建者的多个参数，创建随机标识符或获取当前时间戳。 为此，createAction采用一个可选的第二个参数-一个将用于更新有效负载值的函数。 有关此<a href="https://redux-toolkit.js.org/api/createaction/">参数的</a>更多信息，请参见官方文档。 <br> 使用createAction函数，我们得到以下代码： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> productReleasesFetching = createAction(<span class="hljs-string"><span class="hljs-string">'PRODUCT_RELEASES_FETCHING'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> productReleasesFetched = createAction(<span class="hljs-string"><span class="hljs-string">'PRODUCT_RELEASES_FETCHED'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> productReleasesFetchingError = createAction(<span class="hljs-string"><span class="hljs-string">'PRODUCT_RELEASES_FETCHING_ERROR'</span></span>); … <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchProductReleases</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch(productReleasesFetching()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productReleasesService.getProductReleases().then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productReleases</span></span></span><span class="hljs-function"> =&gt;</span></span> dispatch(productReleasesFetched({ productReleases })) ).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { error.clientMessage = <span class="hljs-string"><span class="hljs-string">"Can't get product releases"</span></span>; dispatch(productReleasesFetchingError({ error })) }); } } ...</code> </pre> <br><h4 id="funkciya-createreduceranchorcreatereduceranchor">  CreateReducer函数 <a name="createReducer"></a></h4><br><p> 现在考虑减速器。 如我们的示例中所示，reducer通常是使用switch语句实现的，每种处理的操作类型都有一个寄存器。 这种方法效果很好，但并非没有样板且容易出错。 例如，很容易忘记描述默认情况或不设置初始状态。  <a href="https://redux-toolkit.js.org/api/createreducer/">createReducer</a>函数通过将化简函数定义为用于处理每种动作的函数搜索表，简化了化简函数的创建过程。 它还允许您通过在化简器中以“可变”样式编写代码来显着简化不可变更新的逻辑。 </p><br><p> 通过使用<a href="https://immerjs.github.io/immer/docs/introduction">Immer</a>库，可以使用强大的事件处理样式。 处理程序函数可以“改变”传递的状态以更改属性，也可以返回新状态，例如以不可变样式工作时，但是由于Immer的存在，对象的真正变异无法执行。 第一个选项对于工作和感知来说要容易得多，尤其是在使用深层嵌套更改对象时。 </p><br><p> 注意：从函数返回新对象将覆盖“可变”更改。 不能同时使用两种状态更新方法。 </p><br><p>  createReducer函数接受以下参数作为输入参数： </p><br><ul><li> 初始存储状态 </li><li> 一个对象，该对象在动作和减速器的类型之间建立对应关系，每个动作和减速器都处理某种类型的对象。 </li></ul><br><p> 使用createReducer方法，我们得到以下代码： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { <span class="hljs-attr"><span class="hljs-attr">productReleases</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">loadedProductRelease</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">fetchingState</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-attr"><span class="hljs-attr">creatingState</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-attr"><span class="hljs-attr">loadingState</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> counterReducer = createReducer(initialState, { [productReleasesFetching]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.fetchingState = <span class="hljs-string"><span class="hljs-string">'requesting'</span></span> }, [productReleasesFetched.type]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.productReleases = action.payload.productReleases; state.fetchingState = <span class="hljs-string"><span class="hljs-string">'success'</span></span>; }, [productReleasesFetchingError]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.fetchingState = <span class="hljs-string"><span class="hljs-string">'failed'</span></span>; state.error = action.payload.error; }, … [productReleaseUpdating]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.updatingState = <span class="hljs-string"><span class="hljs-string">'requesting'</span></span> }, [productReleaseUpdated]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.updatingState = <span class="hljs-string"><span class="hljs-string">'success'</span></span>; state.productReleases = state.productReleases.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productRelease</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (productRelease.id === action.payload.productRelease.id) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.payload.productRelease; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productRelease; }); }, [productReleaseUpdatingError]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.updating = <span class="hljs-string"><span class="hljs-string">'failed'</span></span>; state.error = action.payload.error; }, });</code> </pre> <br><p> 如我们所见，使用createAction和createReducer函数本质上解决了编写额外代码的问题，但预先创建常量的问题仍然存在。 因此，我们考虑将动作创建者和简化器的生成结合在一起的更强大的选项-createSlice函数。 </p><br><h4 id="funkciya-createsliceanchorcreatesliceanchor">  CreateSlice函数 <a name="createSlice"></a></h4><br><p>  createSlice函数接受具有以下字段作为输入参数的对象： </p><br><ul><li>  <code>${name}/${action.type}</code>创建的动作的名称空间（ <code>${name}/${action.type}</code> ）； </li><li>  initialState-减速器的初始状态； </li><li> 减速器-具有处理程序的对象。 每个处理程序都采用带有状态和动作自变量的函数，动作在有效负载属性中包含数据，在名称属性中包含事件的名称。 此外，可以在事件进入缩减程序之前预先更改从事件接收的数据（例如，将id添加到集合的元素中）。 为此，您必须通过一个带有reducer和prepare字段的对象来代替函数，其中reducer是动作处理函数，prepare是返回更新后的有效负载的有效负载处理函数。 </li><li>  extraReducers-包含另一个切片的化简器的对象。 如果有必要更新属于另一个片的对象，则可能需要此参数。 您可以从官方文档的相应<a href="https://redux-toolkit.js.org/api/createSlice">部分中</a>了解有关此功能的更多信息。 </li></ul><br><p> 该函数的结果是一个名为“切片”的对象，其中包含以下字段： </p><br><ul><li> 名称-切片名称， </li><li> 减速器-减速器， </li><li> 动作-一组动作。 </li></ul><br><p> 使用此函数解决我们的问题，我们得到以下源代码： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { <span class="hljs-attr"><span class="hljs-attr">productReleases</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">loadedProductRelease</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">fetchingState</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-attr"><span class="hljs-attr">creatingState</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-attr"><span class="hljs-attr">loadingState</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> productReleases = createSlice({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'productReleases'</span></span>, initialState, <span class="hljs-attr"><span class="hljs-attr">reducers</span></span>: { <span class="hljs-attr"><span class="hljs-attr">productReleasesFetching</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.fetchingState = <span class="hljs-string"><span class="hljs-string">'requesting'</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">productReleasesFetched</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.productReleases = action.payload.productReleases; state.fetchingState = <span class="hljs-string"><span class="hljs-string">'success'</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">productReleasesFetchingError</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.fetchingState = <span class="hljs-string"><span class="hljs-string">'failed'</span></span>; state.error = action.payload.error; }, … productReleaseUpdating: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.updatingState = <span class="hljs-string"><span class="hljs-string">'requesting'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">productReleaseUpdated</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.updatingState = <span class="hljs-string"><span class="hljs-string">'success'</span></span>; state.productReleases = state.productReleases.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productRelease</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (productRelease.id === action.payload.productRelease.id) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.payload.productRelease; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productRelease; }); }, <span class="hljs-attr"><span class="hljs-attr">productReleaseUpdatingError</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { state.updating = <span class="hljs-string"><span class="hljs-string">'failed'</span></span>; state.error = action.payload.error; }, }, });</code> </pre> <br><p> 现在，我们将从创建的切片中提取动作创建者和简化器。 </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { actions, reducer } = productReleases; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { productReleasesFetched, productReleasesFetching, productReleasesFetchingError, … productReleaseUpdated, productReleaseUpdating, productReleaseUpdatingError } = actions; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> reducer;</code> </pre> <br><p> 包含API调用的操作创建者的源代码未更改，除了发送操作时传递参数的方法外： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchProductReleases = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> (dispatch) =&gt; { dispatch(productReleasesFetching()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productReleasesService .getProductReleases() .then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productReleases</span></span></span><span class="hljs-function">) =&gt;</span></span> dispatch(productReleasesFetched({ productReleases }))) .catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { error.clientMessage = <span class="hljs-string"><span class="hljs-string">"Can't get product releases"</span></span>; dispatch(productReleasesFetchingError({ error })); }); }; … <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> updateProductRelease = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id, productName, productVersion, releaseDate</span></span></span><span class="hljs-function">) =&gt;</span></span> (dispatch) =&gt; { dispatch(productReleaseUpdating()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productReleasesService .updateProductRelease(id, productName, productVersion, releaseDate) .then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">productRelease</span></span></span><span class="hljs-function">) =&gt;</span></span> dispatch(productReleaseUpdated({ productRelease }))) .catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { error.clientMessage = <span class="hljs-string"><span class="hljs-string">"Can't update product releases"</span></span>; dispatch(productReleaseUpdatingError({ error })); });</code> </pre> <br><p> 上面的代码显示，在使用Redux时，createSlice函数可让您摆脱样板的重要部分，这不仅使代码更紧凑，简洁和易于理解，而且花费更少的时间编写代码。 </p><br><h2 id="itog"> 总结 </h2><br><p> 在本文的最后，我想说的是，尽管Redux Toolkit库没有为存储管理添加任何新东西，但它提供了许多比以前更方便的代码编写方式。 这些工具不仅可以使开发过程更加方便，易于理解和更快，而且由于库中包含许多经过验证的工具，因此也可以提高效率。 我们，Inobitek，计划继续在我们的软件产品开发中使用该库，并监视Web技术领域的新发展。 </p><br><p> 谢谢您的关注。 我们希望我们的文章会有用。 可以从官方<a href="https://redux-toolkit.js.org/">文档中</a>获取有关Redux Toolkit库的更多信息。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN481288/">https://habr.com/ru/post/zh-CN481288/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN481272/index.html">冷冻或现代化-我们在度假做什么？</a></li>
<li><a href="../zh-CN481276/index.html">我如何为它创建YP和编译器长达12年</a></li>
<li><a href="../zh-CN481280/index.html">我们如何准备CTFZone-2020资格认证阶段</a></li>
<li><a href="../zh-CN481282/index.html">创意的价值是什么，以及如何将其转变为概念：游戏设计师工具</a></li>
<li><a href="../zh-CN481286/index.html">上桌！ 办公室的小事根本不是小事</a></li>
<li><a href="../zh-CN481290/index.html">专用Hetzner和Mikrotik服务器上的HOW-to /网络和VLAN设置</a></li>
<li><a href="../zh-CN481294/index.html">10种最佳软件测试自动化工具</a></li>
<li><a href="../zh-CN481296/index.html">如何编写将被重用的代码</a></li>
<li><a href="../zh-CN481302/index.html">“关于，是不是集群”或导入DBMS时</a></li>
<li><a href="../zh-CN481304/index.html">美国国旗排序</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>