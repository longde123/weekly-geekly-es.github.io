<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👐🏿 🧛🏽 🗓️ Wie werden Pentester gekocht? Eingangstests für Praktikanten im Bereich digitale Sicherheit ✋🏾 👩🏽‍🤝‍👩🏻 🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der Summer of Hack 2019 in der digitalen Sicherheit ist bereits in vollem Gange, was bedeutet, dass es Zeit ist zu erzählen, wie wir Leute rekrutiert ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie werden Pentester gekocht? Eingangstests für Praktikanten im Bereich digitale Sicherheit</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/461077/">  <b>Der Summer of Hack 2019</b> in der digitalen Sicherheit ist bereits in vollem Gange, was bedeutet, dass es Zeit ist zu erzählen, wie wir Leute rekrutiert haben. <br><br><img src="https://habrastorage.org/webt/iv/ef/ud/ivefudzwssbwskpfaxaxkczsxvu.jpeg"><br><br>  Unter dem Schnitt, umfangreiches und interessantes Material darüber, wie wir junge Spezialisten für unser Praktikum „Summer of Hack 2019“ und speziell für das Department of Security Audit auswählen. <br><br>  Überlegen Sie, was ein Pentester unserer Meinung nach wissen sollte, um seine Arbeit erfolgreich zu erledigen. <br><br>  Lassen Sie uns eine Reihe schwieriger Aufgaben analysieren, die wir den Jungs gefoltert haben, auch im Auftrag einer von ihnen. <br><a name="habracut"></a><br>  Der vielleicht interessanteste Teil der Auswahl für ein Praktikum in der Sicherheitsüberprüfungsabteilung war unser Profil.  Jedes Jahr versammeln wir uns als ganze Abteilung und diskutieren, welche Fähigkeiten unserer Meinung nach für einen modernen Spezialisten auf dem Gebiet der praktischen Sicherheit gefragt sind, erinnern uns an die interessantesten Aufgaben, die wir in diesem Jahr lösen mussten, und schreiben Wissensbereiche auf, ohne die es schwierig ist, sich einen erfolgreichen Prüfer vorzustellen.  Wenn alle Witze gescherzt und die Geschichten erzählt werden, bleibt das Endergebnis eine Reihe von Ideen. <br><br>  In diesem Jahr haben wir uns an folgenden Anforderungen orientiert: <br><br><ul><li>  Grundkenntnisse der Geräte-Webanwendungen und Angriffe auf diese; </li><li>  Grundkenntnisse über browserbasierte Schutz- und Zugriffskontrollmechanismen (ja, die gleiche SOP und CORS, wo ohne sie); </li><li>  Grundlegende Fähigkeiten zum Lesen von Code und die Fähigkeit, Logik dahinter zu erkennen; </li><li>  Verständnis der Funktionsweise von Computernetzwerken und deren Routing; </li><li>  Erfahrung mit Linux-ähnlichen Systemen; </li><li>  Die Fähigkeit, keine Angst vor ungewohnter Technologie zu haben.  Die Fähigkeit, die empfangenen Informationen zu googeln und zu systematisieren; </li><li> Und eine Prise Android (obwohl nicht notwendig, aber das ist unsere kleine Laune). </li></ul><br>  Nachdem Fragen entwickelt wurden.  Teilweise haben wir sie aus den Fragen ausgeliehen, die wir bei den Interviews gestellt haben, aber mehr als die Hälfte war speziell für diesen Fragebogen vorbereitet.  Unsere Experten verbrachten ihre persönliche Zeit damit, Verkehrsdumps vorzubereiten und zu diskutieren, wie die Frage besser formuliert werden kann und welche Sicherheitslücken „zu spezifisch sind, warum Auszubildende quälen“.  Für diesen Eifer können wir nicht anders, als unseren Hut abzunehmen (natürlich weiß). <br><br>  Die Analyse jeder Frage besteht aus zwei Teilen.  Der erste Teil ist die Antwort eines unserer Auszubildenden - Danila <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Korgik_0 Leontyeva</a> (er ist der Autor der Veröffentlichung), und der zweite Teil sind die Kommentare von Spezialisten, die den Fragebogen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">überhäuft haben</a> . <br><br><hr><br>  <i>Hallo Habr!</i> <i><br><br></i>  <i>Zunächst ein kleiner lyrischer Exkurs.</i> <i><br></i>  <i>Genauer gesagt: „Wie habe ich von Summ3r 0f h4ck erfahren?“.</i> <i><br></i>  <i>Die Ankündigung des Praktikums hörte ich aus einer Rede von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Denis Rybin</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ilya Bulatov</a> auf der RuCTF2019-Konferenz.</i> <i><br><br></i>  <i>Buchstäblich nach 4 Tagen wurde auf habr ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beitrag</a> über die Eröffnung eines Praktikums veröffentlicht.</i> <i><br><br></i>  <i>Und am Abend desselben Tages eröffnete ich die Aufgabe in der Sicherheitsüberprüfungsabteilung und vertiefte mich in die Arbeit.</i>  <i>Heute werde ich dem Leser mitteilen, mit welchen Schwierigkeiten ich konfrontiert war und welche Lösungsoption ich anbieten könnte.</i> <br><br><hr><br><h1>  <strong><font color="#cc0000">Nr. 1.</font></strong>  <strong><font color="#cc0000">PHP-Quellcode</font></strong> </h1><br>  Untersuche den Code.  Beschreiben Sie, welche Fehler Sie sehen und wie Sie sie beheben würden. <br><br><img src="https://habrastorage.org/webt/ne/0x/ku/ne0xkuq_5uz955i1rypa8or5spk.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Jobanalyse</b> <div class="spoiler_text">  4. Zeile - Verwenden Sie den MD5-Hash. <br>  Problem - md5 kann mit Hashcat in angemessener Zeit brutalisiert werden. <br>  Wie zu beheben? <br><br>  Verwendung von "ressourcenintensiveren" Hashing-Algorithmen. <br>  In diesem Fall müssen Sie die Benutzer-Cookies vollständig ablehnen und die gesamte Logik an phpsession binden. <br><br>  5. Zeile - PostgreSQL-Injektionen. <br>  Wie zu beheben? <br>  Vorbereitete Anweisung verwenden. <br>  Implementierung einer vorbereiteten Anweisung zur Überprüfung der Anmeldung <br><br><pre><code class="plaintext hljs">$query = "SELECT username FROM login WHERE username=?"; $stmt = $conn-&gt;prepare($query); $stmt-&gt;execute(array($username)); $username = $stmt-&gt;fetchColumn(); if($username == FALSE) { die(" !"); }</code> </pre> <br>  11 Zeile - eine Reihe von erfolglosen Entscheidungen. <br><br><ol><li>  Zu lange Sitzungsdauer.  Ein ganzes Jahr ist viel.  Wenn das Cookie erfolgreich entführt wurde, kann der Angreifer lange auf das Benutzerkonto zugreifen. </li><li>  Fehlende httpOnly-Flagge.  Bei TRUE kann auf Cookies nur über das HTTP-Protokoll zugegriffen werden.  Das heißt, Cookies sind in diesem Fall für Skriptsprachen wie JavaScript nicht verfügbar. </li><li>  Kein Cookie-Hashing. </li><li>  Fehlende Einstellung des sicheren Flags.  Das sichere Flag gibt an, dass ein Cookie vom Client über eine sichere HTTPS-Verbindung gesendet werden soll.  Bei TRUE wird das Cookie vom Client nur dann an den Server gesendet, wenn eine sichere Verbindung hergestellt wurde. </li></ol><br>  Wie zu beheben? <br>  Standardmäßig beträgt die Sitzungslebensdauer in PHP nur 24 Minuten. Lassen Sie uns dies implementieren. <br>  Setzen Sie das sichere Flag httpOnly. <br><br>  In diesem Fall sollten Sie das seltsame Benutzer-Cookie ablehnen und die gesamte Logik an phpsession binden. <br><br>  18 Zeile - XSS (English Cross-Site Scripting - "Intersite Scripting"). <br>  Wie zu beheben?  Konvertieren Sie alle möglichen Zeichen in die entsprechenden HTML-Entitäten. <br><br><pre> <code class="plaintext hljs">$query = htmlentities($query, ENT_QUOTES, "UTF-8");</code> </pre> <br>  Wir werden die Codierung explizit angeben, um zu vermeiden, dass UTF-7 ersetzt wird. <br><br><pre> <code class="plaintext hljs">header("Content-Type: text/html; charset=utf-8");</code> </pre> <br>  Zeile 20 - Fehler des Authentifizierungssystems und des Sitzungsspeichers. <br><br>  Problem - Wenn Sie die in base64 codierte Benutzer-ID im Cookie-Benutzer festlegen, können Sie sich bei seinem Konto anmelden! <br><br>  Wie zu beheben?  Bei der Autorisierung des Benutzers zeichnen wir die Sitzung in der Datenbank auf und bei der Installation der Sitzung überprüfen wir, ob sie in der Datenbank vorhanden ist. <br><br><pre> <code class="plaintext hljs"> $query = "SELECT sessions FROM login WHERE sessions=?"; $stmt = $conn-&gt;prepare($query); $stmt-&gt;execute(array($_COOKIE["user"])); $session = $stmt-&gt;fetchColumn(); if($session == TRUE) { do_login($_COOKIE["user"]); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Expertenkommentar D:</b> <div class="spoiler_text"><blockquote>  Die erste Frage, mit der der Fragebogen zukünftige Praktikanten traf, betraf die wichtigsten und allgemein bekannten Web-Schwachstellen.  Die einzige Schwierigkeit hierbei ist die Notwendigkeit, sie im Quellcode in PHP zu sehen.  Niemand hat sich jedoch die Aufgabe gestellt, "Fehler zu verbergen". <br><br>  Hier ist eine Liste der Schwachstellen, die in dieser Liste in der Reihenfolge ihrer Erkennungshäufigkeit erkannt werden können: <br><br>  <b>Das Hashing von Passwörtern mit dem MD5-Algorithmus wurde</b> sogar von Kandidaten bemerkt, die weit vom Internet entfernt waren.  Es gab jedoch auch interessante Nuancen, zum Beispiel verwendeten viele Kandidaten sehr falsche Begriffe und versuchten, die Probleme in eigenen Worten zu beschreiben.  "Algorithmus-Schwachstellen", "Einwegfunktionen", "das Vorhandensein von Kollisionen" und andere seltsame Wendungen gingen in den Kampf. Bei näherer Betrachtung stellen sich heraus, dass sie nichts weiter als eine Reihe großer Wörter sind, die das Wesentliche nicht offenbaren.  Natürlich gingen wir hier zu einem Treffen und fanden keine Schuld an den Menschen, die sich gerade darauf vorbereiten, den Weg zum Erlernen der Weisheit der Informationssicherheit einzuschlagen.  Um eine "Aufrechnung" zu erhalten, hätte die Erwähnung der Bedrohung ausgereicht, dass im Falle einer Gefährdung der Datenbank die md5-Hashes vom Angreifer in einer akzeptablen Zeit aussortiert und die Passwörter (oder gleichwertige Zeichenfolgen) in klarer Form empfangen werden können.  Und natürlich erwähnten viele den Mangel an Salz und roher Gewalt aufgrund der Verwendung von Regenbogentischen.  Wir haben solche Kommentare auch positiv aufgenommen, insbesondere wenn der Befragte erklärte, warum dies eine Bedrohung darstellt. <br><br>  <b>Mögliche SQL-Injection.</b>  Es ist schwer, etwas hinzuzufügen.  Beim Aufruf der Datenbank werden Benutzereingaben von Login und Passwort direkt mit der Anfrage verknüpft.  Wenn es unwahrscheinlich ist, dass Sie den Kennwortwert zu diesem Zeitpunkt manipulieren können (ein Hash wird daraus entnommen), ist es für einen potenziellen Angreifer nicht schwierig, eine Injektion in den Benutzernamen einzuführen. <br><br>  <b>Ausgabe unnötiger Debug-Informationen, die zu einem XSS-Angriff führen.</b>  Durch sorgfältiges Lesen der Liste könnte man auf den Echoaufruf achten, der die generierte Anforderung an die Datenbank in HTML-Kommentaren auf der Seite anzeigt.  Natürlich ist eine solche Schlussfolgerung zusätzlicher Informationen auf der Seite völlig optional und wird vom Entwickler nach Durchführung der Tests höchstwahrscheinlich einfach vergessen.  Solche zusätzlichen Informationen sind für den Angreifer sehr nützlich und ermöglichen ein viel besseres Verständnis der Funktionsweise der Anwendung.  Dies ist jedoch leider nur die halbe Miete.  Tatsache ist, dass ein Angreifer den Inhalt der Abfragevariablen manipulieren kann und sein Inhalt nicht gefiltert oder maskiert werden kann, bevor er dem Benutzer angezeigt wird - es liegt ein potenzieller XSS-Angriff vor.  Es kann sich jedoch herausstellen, dass seine Ausnutzung aufgrund der schlecht lokalisierten Strtoupper-Funktion immer noch Kopfschmerzen bereitet.  Der vom Angreifer injizierte Vektor wird in Großbuchstaben geschrieben. Wenn dies für HTML-Tags kein Problem darstellt, ist Javascript durch einen solchen Aufruf sehr beleidigt.  Dies kann einfach über die Browserkonsole überprüft werden. <br><br><img src="https://habrastorage.org/webt/cg/ev/oy/cgevoykot6pzht0mx5ppeqyxwne.png"><br><br>  Zumindest muss sich der Angreifer anscheinend den sogenannten "skriptlosen Angriffen" oder ausgefeilten Techniken zuwenden, um die Filterung zu umgehen (in diesem Fall würde JSFUCK dies tun), sodass die Tatsache eines Sicherheitsrisikos dies nicht aufhebt. <br><br>  <b>Ein Fehler in der Logik des Sitzungsverwaltungsmechanismus</b> war der interessanteste Teil der Aufgabe.  Seine Entdeckung erforderte nicht nur das zeilenweise Lesen der Quelle, sondern auch das Verstehen der Logik der gesamten Auflistung.  Man konnte fühlen, dass etwas nicht stimmte, wenn man die Einstellung eines Cookies bemerkte, das die base64-codierte Benutzer-ID im Remember-Me-Block enthielt.  Eine weitere Analyse der Logik dieses Mechanismus führt uns zu dem Gedanken: "Es stellt sich heraus, dass sich ein Angreifer, der die ID kennt oder durchläuft, bei jedem Konto anmelden kann, ohne einen Benutzernamen und ein Passwort einzugeben ?!".  Ja, tatsächlich kann ein Angreifer unabhängig einen Cookie-Benutzer auf seiner Seite generieren und ihm einen beliebigen ID-Wert zuweisen, der von base64 codiert wird.  Das Senden einer Anfrage mit einem solchen Cookie ohne Benutzername und Passwort würde die Funktion do_login auslösen und sich bei einem anderen Konto anmelden. <br><br>  Die Erwähnung dieser 4 Schwachstellen in der Antwort der Kandidaten hatte direkten Einfluss auf ihre Punktzahl. <br><br>  Viel hing jedoch von der Qualität der Antwort ab.  Erwähnung von Möglichkeiten zur Behebung der Situation, Anmerkungen zu zusätzlichen Faktoren, die die Durchführbarkeit eines Angriffs beeinflussen, die Verwendung der richtigen Begriffe und die Fähigkeit, Ihre Gedanken zu strukturieren, Kommentare zu zusätzlichen Schwächen oder potenziellen Bedrohungen - all dies hat unser Herz erwärmt und zu einer Erhöhung der endgültigen Bewertung geführt. <br></blockquote><br></div></div><br><hr><br><h1>  <strong><font color="#cc0000">Nr. 2.</font></strong>  <strong><font color="#cc0000">Jwt</font></strong> </h1><br>  Bei der Suche nach einer Webanwendung haben Sie festgestellt, dass die Anwendung ein JWT-Token als Berechtigung verwendet. <br><br>  Welche Sicherheitsbedenken sehen Sie, welche Art von Überprüfungen würden Sie durchführen? <br><br>  JWT-Token: <br><br><pre> <code class="plaintext hljs">eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6InNla2EiL CJpYXQiOjE1MTYyMzkwMjIsInJvbGUiOiJub2JvZHkiLCJpc0FkbWluIjoiRmFsc2UiLCJwYX Nzd29yZCI6IjFkMDBjYUgifQ.F7Y1mCAmg5-QFok-rkpLdwe8prCyiKsCyJ-3Z5f7luI</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Jobanalyse</b> <div class="spoiler_text">  Dan JSON Web Tokens (JWT). <br>  Seine Struktur -&gt; [base64url (HEADER)]. [Base64url (PAYLOAD)]. [Base64url (SIGNATURE)] <br>  [base64url (HEADER)] = eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0 <br>  base64url decode -&gt; {"alg": "None", "typ": "JWT"} <br>  Man kann sofort feststellen, dass der Signaturalgorithmus ("alg": "None") der Signatur nicht verwendet wird.  Einige JWT-Bibliotheken unterstützen den "none" -Algorithmus, dh den Signaturalgorithmus, nicht.  Wenn der Alg-Header "none" ist, führt die Serverseite keine Signaturüberprüfung durch. <br>  Das heißt, Sie können beliebige Nutzdaten in base64url schreiben, und die Signatur wird nicht überprüft. <br>  Dadurch können wir einen Benutzer mit Administratorrechten erstellen. <br><br>  Die Tatsache, dass der Nutzlastteil keine Header wie aud (definiert die Empfänger, für die das JWT-Token bestimmt ist) und exp (die Lebensdauer des Tokens) verwendet, vereinfacht unser Leben. <br><br>  Geschätzte Nutzlast <br>  eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6ImhhY2siLCJpYXQiOjE1MTYyMzkwMjIsInJvbGUiOiJub2JvZHkiLCJpc0FkbWluIjoiVHJ1ZSIsInBhc3N3b3JkIjoiaGFjayJ9 <br><br>  base64url decode payload -&gt; {"sub": "1234567890", "name": "hack", "iat": 1516239022, "role": "Nobody", "isAdmin": "True", "password": "hack" »} <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Expertenkommentar D:</b> <div class="spoiler_text"><blockquote>  In der Arbeit des Auditors muss er sich häufig mit neuen Technologien auseinandersetzen, und die Fähigkeit, diese zu verstehen, ist sehr wichtig.  Wir haben diese Frage in den Fragebogen aufgenommen und sind davon ausgegangen, dass die meisten Kandidaten bis auf den Namen kaum von der Technologie der JWT-Token gehört haben.  Daher zielte diese Frage zunächst auf die Fähigkeit ab, Informationen aus öffentlichen Quellen zu suchen und zu analysieren.  Infolgedessen könnte eine Person, die auf Anfrage von "JWT" ​​und "JWT-Schwachstelle" die Herausgabe von Google verpasst hat, zu folgenden Schlussfolgerungen kommen: <br><br>  1. Dieses Token verfügt nicht über einen Signaturalgorithmus, sodass ein Angreifer alle Felder innerhalb des Tokens ändern kann, was vom Konzept der JWT-Token nicht angenommen wird. <br><br>  2. Felder im Token enthalten das Kennwort des Benutzers im Klartext. Das Speichern solcher Informationen im Token ist mindestens eine schlechte Praxis.  In den meisten Fällen können Sie eine solche Entscheidung ablehnen und dadurch Ihr Sicherheitsniveau erhöhen. <br><br>  3. Angesichts des Fehlens einer Signatur und unserer Fähigkeit, die Felder im Token zu ändern, ist es logisch anzunehmen, dass das Ändern des Werts von isAdmin unsere Berechtigungen auf Administratorrechte erhöhen kann. <br><br>  4. Eine weitere interessante Idee, die nur wenige in ihrer Antwort erwähnt haben, betrifft die Tatsache, dass Benutzereingaben in die Felder eines JWT-Tokens übertragen werden können.  In einer normalen Situation kann ein Angreifer die Daten im Token in keiner Weise beeinflussen, was bedeutet, dass Entwickler die Einführung zusätzlicher Überprüfungen im Code der Handler häufig vernachlässigen können.  Dies bringt die einfache Idee auf den Punkt: Versuchen wir jedoch, klassische Angriffe nicht über GET / POST-Parameter, sondern über Token-Felder durchzuführen.  Dies kann zu einem unerwartet guten Ergebnis führen.  Ein solch kreativer Ansatz mit der richtigen Begründung unseres Handelns wurde von uns bei der Bewertung dieses und anderer Probleme sehr geschätzt. <br><br>  Viele Kandidaten haben in ihren Antworten kurz nacherzählt, wie das JWT-Token aufgebaut ist und wo es verwendet wird. Es war für uns interessant zu lesen, und dennoch haben wir zunächst die Aspekte der Antwort in Bezug auf die Sicherheit bewertet. <br></blockquote><br></div></div><br><hr><br><h1>  <strong><font color="#cc0000">Nummer 3.</font></strong>  <strong><font color="#cc0000">CORS / CSRF / IDOR / ???</font></strong> </h1><br><br>  In der Webanwendung wird das Benutzerkennwort mithilfe der folgenden Anforderung geändert (siehe Option 1).  Welche potenziellen Sicherheitsbedrohungen sehen Sie?  Welche Kontrollen würden Sie durchführen?  Wird sich die Situation bei folgendem Verhalten ändern (siehe Option 2)?  Erklären Sie Ihre Antwort. <br><img src="https://habrastorage.org/webt/mr/b-/se/mrb-seaadzkgqbmqvsq-zcqflyo.jpeg"><br><div class="spoiler">  <b class="spoiler_title">Jobanalyse</b> <div class="spoiler_text">  <b>Variante 1.</b> <br>  "Welche potenziellen Sicherheitsbedrohungen sehen Sie?" <br><br>  1) Fehlende Zugangskontrolle. <br>  Wenn der Benutzer - eine Nummer, an die die Kennwortänderungsanforderung gesendet wird - nicht überprüft wird, kann das Kennwort für jeden registrierten Benutzer im System geändert werden. <br>  Wie zu beheben?  - Übereinstimmende JSESSION aus der Datenbank und der angeforderten ID-Shnik. <br><br>  2) Die Fähigkeit, CSRF-Angriffe durchzuführen <br>  Wir locken einen autorisierten Benutzer zu einem von uns kontrollierten Host und nach einer Anfrage an example.com im Namen des Opfers, um das Passwort zu ändern. <br>  Wie zu beheben?  - Hinzufügen eines CSRF-Tokens. <br><br>  <b>Option 2</b> <br>  "Welche potenziellen Sicherheitsbedrohungen sehen Sie?" <br>  Ein Fehler in der CORS-Richtlinie. <br>  Es wird empfohlen, den Header Access-Control-Allow-Origin auf die Whitelist zu setzen. <br><br>  Wie zu beheben?  - - <br><br>  1) Ändern der .htaccess-Datei <br><br><pre> <code class="plaintext hljs">&lt;ifmodule mod_headers.c&gt; Header always set Access-Control-Allow-Origin: "https://whitelist.domain.ru" Header always set Access-Control-Allow-Methods "PUT" &lt;/ifmodule&gt;</code> </pre><br>  2) PHP <br><br><pre> <code class="plaintext hljs">&lt;?php header('Access-Control-Allow-Origin: “https://whitelist.domain.ru”); header('Access-Control-Allow-Methods: PUT'); ?&gt;</code> </pre><br>  "Wird sich die Situation mit dem folgenden Verhalten ändern?" <br><br>  Ja  Da im zweiten Fall eine PUT-Anforderung verwendet wird, ist dies wichtig, da die Verwendung einer PUT-Anforderung die CORS-Anforderung „schwierig“ macht, was uns wiederum die Möglichkeit eines CSRF-Angriffs und das Fehlen eines Headers wie Access-Control-Allow-Credentials: true vollständig entzieht die Möglichkeit, mit anderen http-Headern und Benutzer-Cookies zu senden. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Expertenkommentar I:</b> <div class="spoiler_text"><blockquote>  Betrachten wir der Reihe nach die Hauptprobleme, die bei den gegebenen Abfragen sichtbar sind: <br><br>  1) Da die numerische Kennung des Benutzers "10012" in der Anforderung beobachtet wird, besteht der erste Schritt darin, zu überprüfen, ob es möglich ist, das Kennwort für einen anderen Benutzer zu ändern.  Kann es ausreichen <b>, die ID eines anderen anzugeben</b> ? <br>  Sicherheitslücken der IDOR-Klasse sind relativ einfach auszunutzen und weisen häufig eine hohe Kritikalität auf. <br><br>  2) Die Anforderung zum Ändern des Kennworts erfolgt über die POST-Methode, das CSRF-Token wird nicht beachtet und der Inhaltstyp lautet "text / plain".  Es besteht die Möglichkeit <b>, eine solche Anfrage vorzutäuschen.</b> <br><br>  Um das Passwort des Opfers zu ändern, reicht es daher aus, dass der Angreifer ihn davon überzeugt, nur den "böswilligen" Link zu besuchen. <br><br>  3) In den Antwortheadern zeigt der Server <b>die Version der verwendeten Software an</b> .  Dies kann auf einmal als Sicherheitslücke bezeichnet werden. Es ist jedoch besser, solche Banner auszublenden. Angreifer können leicht bekannte 1-Tages-Exploits finden, und der Wert der verwendeten Software vereinfacht die Planung weiterer Angriffe erheblich. <br><br>  4) Wir würden uns sehr über den Satz "Was passiert, wenn wir <b>das Datenformat von JSON auf XML ändern</b> ?" <br><br>  Tatsache ist, dass moderne Frameworks intelligent und alles fressend sind und Daten in verschiedenen Formaten verarbeiten können.  Und beim Parsen von XML ist häufig eine gefährliche XXE-Sicherheitsanfälligkeit zulässig.  Mit seiner Hilfe kann der Eindringling in das interne Netzwerk "gehen", Konfigurationsdateien vom Server lesen und gelegentlich RCE ausführen. <br><br>  5) Ich wollte auch eine Bemerkung wie "Warum <b>wird das Wissen des Alten</b> beim Ändern des Passworts <b>nicht überprüft</b> ?" <br><br>  Für "Variante Nr. 2" gibt es eine "Falle" - hier werden CORS-Header verwendet, und der Inhaltstyp der Anforderung ist bereits auf "application / json" gesetzt. <br><br>  Der Fehler, den die überwiegende Mehrheit der Kandidaten gemacht hat, ist die Antwort auf das Formular "- Das ist das Sternchen in Allow-Origin, was bedeutet, dass Sie Anfragen von jeder Site aus senden können!" <br><br>  Nein, geht nicht.  Erstens fehlt der Header Allow-Credentials: True. Dies bedeutet, dass der Browser die Anforderung "mit Cookies" ausführen sollte, damit die Anforderung ohne Sitzung anonym bleibt.  Und zweitens würde der Browser selbst dann, wenn ein solcher Header vorhanden wäre, das Senden von Cookies verbieten - nur wegen des "Sternchens".  Ihre Kombination ist verboten und der Browser wird ignoriert. <br></blockquote></div></div><br><hr><br><h1>  <strong><font color="#cc0000">Nummer 4.</font></strong>  <strong><font color="#cc0000">Netzwerk-Dump</font></strong> </h1><br>  Stellen Sie sich vor, Sie sind in das interne Netzwerk des Unternehmens eingetreten und haben den Datenverkehr abgefangen, dessen Speicherauszug unten angehängt ist.  Beschreiben Sie, welche Angriffe Sie mit welchen Tools ausführen möchten. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Speicherauszug</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">yadi.sk/d/qkLcfwSCzdxcwg</a> <br><br><div class="spoiler">  <b class="spoiler_title">Jobanalyse</b> <div class="spoiler_text">  1) LLMNR-Spoofing &lt; <br>  Ein Angreifer im lokalen Subnetz kann Broadcast-Nachrichten abhören und darauf antworten und behaupten, der angeforderte Hostname sei seine eigene IP-Adresse. <br>  Dies führt dazu, dass der anfordernde Client-Computer mit dem Computer des Angreifers verbunden ist und je nach Protokoll möglicherweise versucht, sich zu authentifizieren. <br><br>  Die verwendeten Dienstprogramme sind Intercepter-NG, ein Projekt auf githab VindicateTool. <br><br>  2) HSRP-Missbrauch. <br>  Problematisch - Wenn der Parameter "preempt" auf 1 gesetzt ist, hat der Angreifer aufgrund der höheren Priorität die Möglichkeit, andere Router zu "verdrängen".  Nach dem Senden von HSRP an den Multicast wird der gesteuerte Router zum Hauptrouter (Active Router) im Netzwerk, und der gesamte Datenverkehr wird durch ihn geleitet.  Tatsächlich kamen wir zur Implementierung von Mitm-Angriffen. <br><br>  Für diesen Angriffsvektor müssen wir die Gruppe und das Passwort kennen. <br>  Aus dem uns gegebenen Verkehrsdump erkennen wir die Gruppe (es ist - 3) und das Passwort.  Das Passwort in unserem Fall ist Standard - Cisco. <br><br>  Verwendete Dienstprogramme sind Yersinia, Scapy. <br><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Kommentar von Experte X:</b> <div class="spoiler_text"><blockquote>  Ziel der Frage war es, die Vertrautheit des Auszubildenden mit modernen (und nicht so) Techniken zur Durchführung von MitM-Angriffen zu ermitteln.  Schauen wir uns mögliche Szenarien an, die auf einem vorhandenen Verkehrsdump basieren: <br><br>  <b>1) ARP-Spoofing</b> <br>  ARP-Spoofing ist der älteste und einfachste Weg, MitM-Angriffe zu implementieren.  Es besteht darin, eine kostenlose ARP-Anfrage an Host A zu senden. <br><br>  Die IP-Adresse von Host B ist die IP-Adresse, und unsere MAC-Adresse ist die MAC-Adresse.  Mit einer solchen Anforderung können Sie die ARP-Tabelle auf Host A ändern und sie dazu zwingen, Anforderungen an unser Gerät zu senden, wenn Sie versuchen, Host B zu kontaktieren. Host B ist normalerweise das Standard-Gateway. <br><br>  Empfohlene Tools: Bettercap, Arpspoof <br><br>  <b>2) LLMNR, NBNS-Spoofing</b> <br>  Link-Local Multicast Name Resolution und NetBIOS Name Service sind die Protokolle, die zum Auflösen von Hostnamen im lokalen Netzwerk verwendet werden.  Im Gegensatz zum DNS-Protokoll gibt es keinen dedizierten Server, auf dem alle Informationen gespeichert sind. Stattdessen wird die Anforderung an alle Hosts im Netzwerk gesendet. Wenn der Hostname in der Anforderung mit dem Hostnamen des Geräts übereinstimmt, wird eine Antwort gesendet. <br><br>  Wie in der Antwort richtig vermerkt, kann der Angreifer auf solche Anfragen antworten, indem er seine IP-Adresse in der Antwort sendet. Dies führt dazu, dass das Opfer in Zukunft das Gerät des Angreifers anstelle des Geräts kontaktiert, dessen Hostname in der Anfrage enthalten ist.  Darüber hinaus kann der Angreifer vom Opfer eine NTLM-Authentifizierung anfordern, wodurch das Gerät des Opfers einen NTLM-Hash sendet, der für Brute Force weiter verwendet werden kann. <br><br>  Empfohlene Tools: Responder <br><br>  <b>3) WPAD-Spoofing</b> <br>  WPAD-Spoofing kann auf einen Sonderfall von LLMNR- und NBNS-Spoofing zurückgeführt werden.  Das Auto Proxy Auto Discovery-Protokoll wird verwendet, um einen HTTP-Proxyserver automatisch zu konfigurieren. <br><br>  Das Gerät sendet eine LLMNR / NBNS-Anforderung mit dem wpad-Hostnamen, empfängt die entsprechende IP-Adresse und versucht, über HTTP auf die Datei wpad.dat zuzugreifen, in der Informationen zu den Proxyeinstellungen gespeichert sind. <br><br>  Infolgedessen kann der Angreifer LLMNR / NBNS-Spoofing durchführen und dem Opfer seine Datei wpad.dat zur Verfügung stellen. Infolgedessen wird der gesamte HTTP- und HTTPS-Verkehr durch den Angreifer geleitet. <br><br>  Empfohlene Tools: Responder, mitm6 <br><br>  <b>4) Router-Werbung</b> <br>  Wie Sie dem Speicherauszug entnehmen können, gibt es im Netzwerk Geräte mit aktiviertem IPv6.  Während Sie sich im Netzwerk befinden, können Sie versuchen, Nachrichten an die IPv6-Router-Ankündigung des Opfers zu senden, um das Standard-Gateway oder den DNS-Server zu ändern. <br><br>  RA-Nachrichten (Router Advertisement) sind Teil des SLAAC-Mechanismus (Stateless Address Autoconfiguration), der erforderlich ist, um IPv6-Adressen in einem Netzwerk automatisch zu erhalten, ohne einen DHCPv6-Server zu verwenden oder in Verbindung damit.  Dies wird erreicht, indem regelmäßig Multicast-RA-Nachrichten an den Router gesendet werden, die die Standard-Gateway-Adresse, das Netzwerkpräfix, die DNS-Serveradresse und das Domänenpräfix enthalten. <br><br>  Empfohlene Tools: Rohpaket <br><br>  <b>5) DHCP-Spoofing</b> <br>  In einem Speicherauszug werden DHCP-Erkennungsanforderungen von demselben Gerät in einigen Intervallen wiederholt.  Sie können Schlussfolgerungen zum Fehlen eines DHCP-Servers in diesem Netzwerk ziehen und auf die nächste Erkennungsanforderung antworten, indem Sie das Opfer als Standard-Gateway zum Gerät angeben. <br><br>  Empfohlene Werkzeuge: Yersinia <br><br>  <b>6) HSRP-Spoofing</b> <br>  Außerdem können HSRP-Pakete im Speicherauszug angezeigt werden.  Das Hot Standby Router Protocol kann die Verfügbarkeit von Routern erhöhen, die als Standardgateway fungieren.          IP-,     -.   Hello -        ,           .           HSRP, ,      ,      HSRP         . <br><br>  : Yersinia <br><br> <b>7) STP-</b> <br> Spanning Tree Protocol      L2-  .    BPDU-,           ,     .          BPDU-,   ,   ,    ,    ,         ,   ,   ,     STP,    ,    . <br><br>  : Yersinia <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">№5. NGINX config</font></strong> </h1><br><br>    - nginx.  ,       ? <br><br> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pastebin.com/nYp7uVbB</a> <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   nginx,          : <br> 1)  86 ,   http  X-Managed      secured,  nginx     /management/ <br> 2)        API  70  105 . <br><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  J:</b> <div class="spoiler_text"><blockquote>        ,          .   nginx    ,     web-,       nginx    web-  /.           nginx ,  , ,     . <br><br> ,     ,   ,            .      ,         . ,    ,     . <br><br>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gixy</a> . <br><br> Gixy  4    : <br><br> <b>1) Alias travesal:</b> <br><br>   80     : <br><br><pre> <code class="plaintext hljs">location /static { alias /prod_static/; }</code> </pre><br>     - ,    .  : //host/static../etc/passwd.   -     alias:     ,   /static,   /prod_static/,       : /prod_static/../etc/passwd,      /etc/passwd.    alias traversal  <a href=""></a> <br><br> <b>2) Http Splitting (CRLF injection)</b> <br>    nginx  ,   ,        .       HTTP-. <br> : <a href="https://github.com/yandex/gixy/blob/master/docs/ru/plugins/">github.com/yandex/gixy/blob/master/docs/ru/plugins/httpsplitting.md</a> <br><br> <b>3)   -   </b> <br>   75      «rigin»   .    , -       , ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">production.host.evil.com</a> . <br> : <a href="">github.com/yandex/gixy/blob/master/docs/ru/plugins/origins.md</a> <br><br> <b>4)     add_header</b> <br>  nginx  :      add_header,       , ,    ,  .      CSP      . <br> : <a href="">github.com/yandex/gixy/blob/master/docs/ru/plugins/addheaderredefinition.md</a> <br><hr><br>  ,   gixy,          .       : <br><br> 1)   17     <b>default_type   text/html.</b>     :   ,     ,  nginx    Content-Type,    default_type.   ,         Content-Type: text/html.            HTML-  ,   , , XSS-   . <br><br> <b>2)    POST-</b> <br>  29-30   ,           .  ,   “” POST-.       . !       SSRF  ,     ,   ,     , . <br><br> <b>3)   php-fpm</b> <br>   48  ,  FastCGI-    unix ,    9000.  ,    ,   .   ,      PHP-. <br><br> <b>4) “” CSP</b> <br>  production.host  Content-Security-Policy,    Javascript,    . <br><br> <b>5) “” CORS</b> <br>   76-77   CORS,          ,       cookie  . <br><br> 6)     ,   86   <b>  </b>  .       secured     /managed. <br><br> 7)      ,    ,        ,    -. ,   ,  ,    /user/{userid}  IDOR. <br><br>   ,       ,    ,     . <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">№6. Linux Permissions</font></strong> </h1><br>     Linux      ? <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">  ~ ()  Debian <br> C              ( ,      /etc/passwd). <br> ,      ftp  ,     ~. <br><br> : <br> * root@server:~# ls ~ftp <br> * welcome.msg <br>      : <br> * root@server:~# cat ~ftp/welcome.msg <br> * Welcome, archive user %U@%R! <br>   ,    :      : <br> * root@amorale:~# echo ~ftp <br> * /srv/ftp <br><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  K:</b> <div class="spoiler_text"><blockquote>    ,        : <br><br><ul><li>       </li><li>  ACL      </li><li>    </li><li>      </li><li>  capabilities </li></ul><br>   ,      ,   : <br> “ ,   root”   . <br><br>      ,     <code>Linux/Unix</code> . <br>    ,        “ ” —           . <br>   ,     ,    <code>funky_test.txt</code>      <br><br><pre> <code class="plaintext hljs">-rwxrw-rx 1 alice interns 12  4 13:00 funky_test.txt</code> </pre> <br> ,    Linux/Unix   : <br><br><ul><li>  - —    “rwx”  alice </li><li>   —    “rw”   interns </li><li>    —    “rx”  others </li></ul><br>          <code>read, write, execute</code> . <br><br> ,     —       ,      : <br><br><ul><li>    ,      read </li><li>    ,      read </li><li>     read </li></ul><br>  ,       <code>read</code>            .      ,      execute  . <br><br>            ,    . <br><br>          , ,    .      : <br><br> 1.          ,       ls. <br><br> 2.      — <code>POSIX Access Control Lists</code> . <br><br><h4>    c   . </h4><br><h6>  1 </h6><br> ,   <code>alice</code>     <code>interns</code> .      <code>funny_test.txt</code>    : <br><br><pre> <code class="plaintext hljs">$ whoami alice $ id uid=1001(alice) gid=1001(alice) groups=1001(alice),1002(interns) $ ls -la ----rwx--- 1 alice interns 12  4 13:00 funky_test.txt $ cat funky_test.txt cat: funky_test.txt: Permission denied $</code> </pre><br><h5>  2 </h5><br>   —   <code>funky_test.txt</code>  604.    <code>bob</code> ,    <code>interns</code>    : <br><br><pre> <code class="plaintext hljs">$ whoami bob $ id uid=1002(bob) gid=1003(bob) groups=1003(bob),1002(interns) $ ls -la funky_test.txt -rw----r-- 1 alice interns 12  4 13:00 funky_test.txt $ cat funky_test.txt cat: funky_test.txt: Permission denied</code> </pre><br><h5>  </h5><br>    <code>alice</code>       ,  .  , <code>permission_denied</code>    : <br><br><pre> <code class="plaintext hljs">$ id uid=1001(alice) gid=1001(alice) groups=1001(alice),1002(interns) $ ls -la ----rwx--- 1 alice interns 12  4 13:00 funky_test.txt $ chmod 777 funky_test.txt $ ls -la funky_test.txt -rwxrwxrwx 1 alice interns 12  4 13:00 funky_test.txt $ cat funky_test.txt secret_pass</code> </pre><br>      bob    . <br><br><h5>  Warum so </h5><br>    ,          «  »,  : <br><br><ul><li>  ID      <code>effective UID</code> —      </li><li>  GID        <code>effective GID</code> —      </li><li>      others. </li></ul><br><h5>   </h5><br>  ,      —   ,       “”    ,        ,    , : <br><br><ul><li>    ,   ,          <code>others</code>     </li><li>   ,     ,   <code>others</code>     </li></ul><br>           . <br><br><h4> POSIX Access Control Lists </h4><br>      —         /.   ,     ACL,  ,       “ <code>+</code> ” <br><br>      POSIX ACLs,    —     ,            .      ACL,        . <br><br><h5>  Beispiel </h5><br>   .        <code>alice</code>   <code>funky_test.txt</code>  ,   <br><br><pre> <code class="plaintext hljs">-rwxrw-rx 1 alice interns 12  4 13:00 funky_test.txt</code> </pre> <br>      ACL.  <code>getfacl</code> , ,    ACL,   ,     <code>ls</code> . <br><br><pre> <code class="plaintext hljs">$ getfacl funky_test.txt # file: funky_test.txt # owner: alice # group: interns user::rwx group::rw- other::rx</code> </pre><br>   , ACL        .  ,     bob  : <br><br><pre> <code class="plaintext hljs">setfacl -mu:bob:rwx funky_test.txt</code> </pre><br>       “ <code>+</code> ”   <br><br><pre> <code class="plaintext hljs">ls -l funky_test.txt -rwxrwxr-x+ 1 alice interns 12  4 13:00 funky_test.txt</code> </pre><br>     : <br><br><pre> <code class="plaintext hljs">getfacl funky_test.txt # file: funky_test.txt # owner: alice # group: interns user::rwx user:bob:rwx group::rw- mask::rwx other::rx</code> </pre><br>  ACL     .  : <br><br><ol><li>     .      <code>effective UID</code>  <code>effective GID</code>  —  .        ,       ACL,       .  ,     ,   ,  ,         ,    . </li><li>   ACL  <code>mask</code> ,      ACL    <code>owner, group, others</code> </li></ol><br><h5>   </h5><br>  ,         ,  ,     —      . <br><br>   ,  ACL,     , : <br><br><ul><li>        ACL,     ; </li><li>   ,         ACL,     . </li></ul><br></blockquote></div></div><br><br><hr><br><h1> <strong><font color="#cc0000">№7. Network Dump II</font></strong> </h1><br>            .  ,        ,   ,       . <br><br>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">yadi.sk/d/e3gNme4MBo6tFQ</a> <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   —      . <br>      ,     . <br>   ,     . <br><br><img src="https://habrastorage.org/webt/2t/zn/ip/2tznipywtpqwalr5drvxxr4z0sw.png"><br><br>   ,     SMB-,  ,    ,       .       SMB object list (File -&gt; Export objects -&gt; SMB… ). <br><br>    —     . <br><br><img src="https://habrastorage.org/webt/fe/rt/xy/fertxyt0du3kv3qwcmivz1m6opg.png"><br> <i>(  SMB object list)</i> <br><br><img src="https://habrastorage.org/webt/xo/yd/t-/xoydt-qmcbddrx1lkoqmpplyslg.png"><br> <i>(NotTruePass.jpg)</i> <br><br>     . <br><br>        “”    TCP-…     .    .  :( <br><br>    ,        .    . <br><br><img src="https://habrastorage.org/webt/fd/ch/fc/fdchfcsbkrwxmx08ltr_1qnoozg.png"><br> <i>(  desktop.ini)</i> <br><br>     “”     . ,      NTLM,   ,  ,  NTLM      “Pass-the-hash”.               «-». <br><br>     “”    : <br><br><pre> <code class="plaintext hljs">1)User - 1 Account: IEUser Domain: WIN7 Host: WIN7 hex dump session key - 49 0c 38 3e f8 eb 63 88 79 0f 62 84 09 84 d2 dc 2) User - 2 Account: winwin Domain: WIN7 Host: WIN7 hex dump session key - 8d f6 1b 35 79 a3 78 d3 2e 81 09 f1 95 4f 71 0a 3) User - 3 Account: 192.192.192.29 Domain: WIN7 Host: WIN7 hex dump session key - c3 19 e0 21 1b e2 63 c6 03 9e e7 38 1b 56 f0 d1</code> </pre><br>            .       MSEDGEWIN10. <br><br>    —     : <br><br> 1) SMB Relay. <br>           . <br>      ,   MITM- <br> (.             ). <br><br>      —        ,      ,  . <br>      .       ,       . <br><br>    ,  ,  ,     . <br><br> 2) NTLM Relay. <br>         ,  NTLM-. <br><br>         ,   NTLM-. <br><br>          . <br>     ,     ,  ,    . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">  K:</b> <div class="spoiler_text"><blockquote>   ,  ,    : <br><br><ol><li>    (    ) </li><li>        — / </li><li>      ,       </li></ol><br>       ,        : <br><br><ol><li>     </li><li>     </li><li>     </li></ol><br>     Wireshark,    <code>Protocol Hierarchy Statistics</code>  <code>Conversations</code> . <br><br> <code>Protocol Hierarchy Statistics</code> —           . <br><br><img src="https://habrastorage.org/webt/_3/sy/co/_3sycoln1juvmnzbdlzrug24fgq.png"><br><br> Conversations —   ,         . <br><br><img src="https://habrastorage.org/webt/31/xp/r7/31xpr7rmhyghnrctn3acyznwa9w.png"><br><br><img src="https://habrastorage.org/webt/rw/21/_d/rw21_dwv4digkin6kodypnfpl2w.png"><br><br>       : <br><br><ol><li>    (60%) —  TCP, ,  , SMB.   Protocol hierarchy  SMB  40%,        TCP,     ,     20%      SMB. </li><li>      192.192.192.128  192.192.192.129.   SMB      . </li></ol><br> <b>  </b> <br><br>    . <br><br>        —     SMB. <br><br>        ,    —     wireshark —  <code>ExportObject</code> . <br>              <code>tcp stream</code> .     ,     ,    <code>tcp stream</code> ,            .           ,      . <br><br>    , ,     ,     ,     .  ,         . <br><br> <b>  .</b> <br>     SMB       . <br><br>    NTLM-     “ntlmssp”.    <code>info</code> ,  3    : <br><br><img src="https://habrastorage.org/webt/mm/gn/pj/mmgnpjekpvddsd1f6vdx5ih8hec.png"><br><br> ,        . <br><br><img src="https://habrastorage.org/webt/rk/ix/7m/rkix7mvmxaaxs09m0vvazlblvco.png"><br><br><img src="https://habrastorage.org/webt/tx/zc/hc/txzchc1u7ufdzoqkjxtnrnsvfd0.png"><br><br><img src="https://habrastorage.org/webt/pd/hg/vd/pdhgvdcc_obs9smchhmwidqmawy.png"><br><br>          Net-NTLMv2-,  : <br><br><ul><li> challenge  </li><li> response  </li><li>   </li></ul><br>  <code>Net-NTLMv2</code>       <code>hashcat</code> . <br><br> ,        <code>WIN7\winwin</code>  <code>WIN7\192.192.192.129</code> —      ,          .    <code>WIN7\IEUser</code> — ,       ,  ,  ,   ,  SMB. <br><br>  <code>Net-NTLM</code>   ,   ,    Wireshark.    ,  PCredz (https://github.com/lgandx/PCredz) <br><br><img src="https://habrastorage.org/webt/jd/gn/zj/jdgnzjzb6pgscawu43bxtf5wc0y.png"><br><br>     <code>IEUser</code> (   )     hashcat. <br><br><img src="https://habrastorage.org/webt/ky/i6/gf/kyi6gfki84pqjj4fgjximusk9qa.png"><br><br> <b>     ,      .</b> <br><br>        6,   ,   <code>SMB/NTLM</code> , <code>DNS</code> . <br><br> ,      ,    <code>NT</code>  <code>LM</code>  <code>NTLMv1 (Net-NTLMv1)</code> , <code>NTLMv2 (Net-NTLMv2)</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">     </a> ). <br><br> -    <code>NT</code>  <code>LM</code>  <code>NTLM</code> ,         <code>NTLM</code>  <code>NTLMv1</code>  <code>NTLMv2</code> . ,           .    . <br><br>     ,  <code>NTLMv1/NTLMv2</code> —    challenge-response .        ,    . <br><br>  NT  LM —   “  ” —        . <br><br>      : <br><br><ul><li> PassTheHash — ,        ,     .  Aber.     ,  <code>NT</code> .  PassTheHash  NTLMv2  —   .        ,      “”  ,       ,    . </li><li> NTLM Relay — ,        ,     NTLM.      ,    . </li><li> Spoofing,     Windows: LLMNR, NetBios </li><li>     : MS17-010,    /  ,   . </li></ul><br> <b></b> <br><br>     : <br><br><ul><li>    ( ) </li><li>       </li><li>       ,           </li><li>            eternalBlue </li><li>  NTLM relay </li><li>   NTLM relay    —   SMB </li><li>       </li><li>   ,     (ARP-spoofing,  DNS   )  </li></ul><br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">№8. SSH Pivoting Tricks</font></strong> </h1><br><img src="https://habrastorage.org/webt/ui/gy/a1/uigya1oqcd1poeuc6whph79ehzw.png"><br>      (10.0.10.0/24),      SSH  Linux- (10.0.20.5)    (10.0.20.0/24).   ,         .     ,         ,     //  Linux-. <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> ,    ,   : <br>    <br> nmap      <br><br>    ? <br><br> : <br><br> 1)  ping. <br>  -&gt; ping -b 10.0.20.255 <br>  ping  ,     ,    . <br>    ,               . <br>           . <br> ,     CentOS 7. <br>        . <br><br><img src="https://habrastorage.org/webt/7y/vu/rn/7yvurntbjwgei1q8rr6yth0kjww.png"><br> <i>(  )</i> <br><br>    ,           .  :( <br><br><img src="https://habrastorage.org/webt/nd/r1/jc/ndr1jchof8-_rzbgh-ru1xg7vh0.png"><br><br> 2)   ARP-  . <br>  -&gt; <br>  Debian — arp-scan --interface=/* */ 10.0.0.0/16 <br>  Linux      arp,    ( Debian) -   ,      arp-scan. <br> arp-scan,   ,      ,    . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">  KryaKrya:</b> <div class="spoiler_text"><blockquote>       ,           ,  ,      Pivoting.      ,      ,   ,          ,      ,          . <br><br> ,       ping    ,  ARP- (arp -a),    (route).   ,     netcat (nc -h),  ,      (nc -vnz 10.0.20.3 0-1000).    ,      ,        , , ,   ,   -     bash,   python      . <br><br>     —    SSH-,   SOCKS-  SSH,          . <br> ssh -D 1337 user@10.0.20.5 -f -N <br><br>            .     nmap  SOCKS-   proxychains    . <br><br> proxychains nmap 10.0.20.0/24 <br> nmap 10.0.20.0/24 --proxy socks4://10.0.20.5:1337 <br><br>     nmap       - SOCKS-.     SYN- ( nmap    )  SOCKS-,  SOCKS-    TCP-   ,  SYN-      ,    SYN,    SYN ACK.      CONNECT- (-sT),  nmap      SOCKS-. <br><br> nmap -sT 10.0.20.0/24 --proxy socks4://10.0.20.5:1337 <br><br> ,    -  ,         ,        . ,       Linux-,   nmap  -sT  ,     ,     ,      ,    ,    ,        . <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">№9. Android SSL pinning bypass</font></strong> </h1><br>      Android.  ,        HTTPS. <br><br> 1) ,           HTTP . <br><br> 2)  ,      SSL-pinning,        ? <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> «,           HTTP-.» <br><br>        . <br>        proxy host   wifi. <br><br>  Android     ,  ,      . <br><br>  —    (  )   —   ( ,  ). <br>  ,      MITM,   Android 6.0,      ,     . <br><br>       6.0,         . <br><br> « ,      SSL-pinning,        ?» <br><br>  ,    SSL-pinning. <br><br> SSL-pinning —   ,    ,   «»      . <br><br>        HTTPS-,   ,  «».      ,       . <br><br>   ,      MITM-,    . <br><br>   ,      ,     ,       . <br><br>   —  Frida. <br> Frida —    Dinamic Instrumentation Toolkit,    ,         . <br> , Frida        Javascript. <br>       Frida     ,    , ,  «True»  «False»,     . <br><br>     Frida: <br><br> 1.      ,      .      -. <br><br> 2.      Frida.        Root. <br><br>      . <br>  APK-           .  ,       ,      . <br>      .     apk  META-INF    . <br><br> “” APK-. <br>       APK   smali   Java,     ,     . <br>     ,    ,     . <br><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  I:</b> <div class="spoiler_text"><blockquote> ,     MITM HTTPS       . <br><br>      ,       Proxy   WiFi.      ProxyDroid,    iptables  . <br><br> ,      Root ,         , ? <br><br>    SSL-Pinning,    , ,  “Frida+Objection”. ,           :) <br></blockquote></div></div><br><hr><br><h1> <strong><font color="#cc0000">№10.    ?</font></strong> </h1><br>          ,       . <br><br>    “ ”. ,      ,  dns-rebinding. <br><br>     .  Vielen Dank für Ihre Aufmerksamkeit! <br><br><hr><br> <b>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Digital Security</a></b> <br><br>    ,       . <br>       3  (  -      ).      0  5        2.5,   3.1337. <br><br>      .  ,     50 .        ,          “ <i>   </i> ”   -   ) <br><br>         .      29 ,     43.5.         24%    . <br><br>    : <br><br><img src="https://habrastorage.org/webt/fn/iq/fb/fniqfb7brnsnuqx08am8vx7xmtq.png"><br><br> ,         ,       ,    ,     ,              .    ,       ,     .         . <br><br>  ,     , ,  ,                  . <br><br> ,  ,          : <br><br><img src="https://habrastorage.org/webt/wn/z_/p9/wnz_p90qafczlytjrpuddurwkbc.jpeg"><br><br>          (  !),    ,          ,   ,         “ ”. <br><br>             -     ,        ,        . ,        ,   Summer of Hack 2019. <br><br>     ,                 .                    . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de461077/">https://habr.com/ru/post/de461077/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de461067/index.html">Die 65 wichtigsten SQL-Fragen aus Vorstellungsgesprächen, auf die Sie 2019 vorbereitet sein sollten. Teil I.</a></li>
<li><a href="../de461069/index.html">Nobel-IP-Außenkameras: Tests, Technologien und Funktionen von Ivideon-Videoüberwachungssystemen</a></li>
<li><a href="../de461071/index.html">Optimierung von Datenbankabfragen am Beispiel eines B2B-Service für Builder</a></li>
<li><a href="../de461073/index.html">Wir verbinden Online-Karten mit dem Navigator auf dem Smartphone. Teil 3 - OverpassTurbo</a></li>
<li><a href="../de461075/index.html">Business Intelligence. IT-Objekte, Komponenten, Tools</a></li>
<li><a href="../de461079/index.html">Stadt ohne Stau</a></li>
<li><a href="../de461081/index.html">Der Tag, an dem Dodo aufgehört hat. Asynchrones Skript</a></li>
<li><a href="../de461083/index.html">Schreiben von Software mit der Funktionalität von Client-Server-Dienstprogrammen Windows, Teil 02</a></li>
<li><a href="../de461085/index.html">Wechseln Sie die Sprache in der Android App</a></li>
<li><a href="../de461087/index.html">Dungeons und Höhlen für mein Spiel generieren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>