<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ûüèΩ ‚ôçÔ∏è üõéÔ∏è Redis Stream - Fiabilit√© et √©volutivit√© de vos syst√®mes de messagerie üöì üïµüèº üíÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Redis Stream - un nouveau type de donn√©es abstrait introduit dans Redis avec la sortie de la version 5.0 
 Conceptuellement, Redis Stream est une list...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Redis Stream - Fiabilit√© et √©volutivit√© de vos syst√®mes de messagerie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456270/"><img src="https://habrastorage.org/webt/4z/my/lg/4zmylgmptsa7q0dqxbekaq4gvai.png" alt="image"><br><br>  Redis Stream - un nouveau type de donn√©es abstrait introduit dans Redis avec la sortie de la version 5.0 <br>  Conceptuellement, Redis Stream est une liste √† laquelle vous pouvez ajouter des entr√©es.  Chaque entr√©e a un identifiant unique.  Par d√©faut, un identifiant est g√©n√©r√© automatiquement et inclut un horodatage.  Par cons√©quent, vous pouvez demander des plages d'enregistrement par heure ou recevoir de nouvelles donn√©es √† mesure qu'elles arrivent dans le flux, car la commande Unix tail -f lit le fichier journal et se fige en pr√©vision de nouvelles donn√©es.  Veuillez noter que plusieurs clients peuvent √©couter le flux en m√™me temps, car de nombreux processus ¬´tail -f¬ª peuvent lire un fichier en m√™me temps sans entrer en conflit les uns avec les autres. <br><br>  Pour comprendre tous les avantages du nouveau type de donn√©es, rappelons bri√®vement les structures Redis existantes qui r√©p√®tent partiellement les fonctionnalit√©s de Redis Stream. <br><a name="habracut"></a><br><h1>  Excursion historique </h1><br><h4>  Redis pub / sub </h4><br>  Redis Pub / Sub est un syst√®me de messagerie simple d√©j√† int√©gr√© √† votre stockage de valeurs-cl√©s.  Cependant, pour plus de simplicit√©, vous devez payer: <br><br><ul><li>  Si l'√©diteur pour une raison quelconque √©choue, il perd tous ses abonn√©s </li><li>  L'√©diteur doit conna√Ætre l'adresse exacte de tous ses abonn√©s. </li><li>  Un √©diteur peut surcharger ses abonn√©s si les donn√©es sont publi√©es plus rapidement qu'elles ne sont trait√©es </li><li>  Le message est supprim√© du tampon de l'√©diteur imm√©diatement apr√®s sa publication, quel que soit le nombre d'abonn√©s qu'il a transmis et la rapidit√© avec laquelle ils ont r√©ussi √† traiter ce message. </li><li>  Tous les abonn√©s recevront le message en m√™me temps.  Les abonn√©s eux-m√™mes doivent en quelque sorte s'entendre sur la fa√ßon de traiter le m√™me message. </li><li>  Il n'y a pas de m√©canisme int√©gr√© pour confirmer le succ√®s du traitement d'un message par un abonn√©  Si l'abonn√© a re√ßu un message et est tomb√© pendant le traitement, l'√©diteur n'en sera pas inform√©. </li></ul><br><h4>  Liste Redis </h4><br>  Redis List est une structure de donn√©es qui prend en charge les commandes de lecture de verrouillage.  Vous pouvez ajouter et lire des messages depuis le d√©but ou la fin de la liste.  Sur la base de cette structure, vous pouvez cr√©er une bonne pile ou file d'attente pour votre syst√®me distribu√© et cela suffira dans la plupart des cas.  Les principales diff√©rences avec Redis Pub / Sub: <br><br><ul><li>  Le message est remis √† un client.  Le premier client bloqu√© par la lecture recevra d'abord les donn√©es. </li><li>  Clint doit lancer une op√©ration de lecture pour chaque message.  List ne sait rien des clients. </li><li>  Les messages sont stock√©s jusqu'√† ce que quelqu'un les compte ou les supprime explicitement.  Si vous configurez un serveur Redis pour vider les donn√©es sur le disque, la fiabilit√© du syst√®me augmente consid√©rablement. </li></ul><br><h1>  Introduction √† Stream </h1><br><h4>  Ajout d'un enregistrement √† un flux </h4><br>  La commande <b>XADD</b> ajoute un nouvel enregistrement au flux.  Un enregistrement n'est pas seulement une cha√Æne, il se compose d'une ou plusieurs paires cl√©-valeur.  Ainsi, chaque enregistrement est d√©j√† structur√© et ressemble √† la structure d'un fichier CSV. <br><br><pre><code class="go hljs">&gt; XADD mystream * sensor-id <span class="hljs-number"><span class="hljs-number">1234</span></span> temperature <span class="hljs-number"><span class="hljs-number">19.8</span></span> <span class="hljs-number"><span class="hljs-number">1518951480106</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span></code> </pre> <br>  Dans l'exemple ci-dessus, nous ajoutons deux champs au flux avec le nom (cl√©) "mystream": "sensor-id" et "temperature" avec les valeurs "1234" et "19.8", respectivement.  Comme deuxi√®me argument, la commande accepte l'identifiant qui sera affect√© √† l'enregistrement - cet identifiant identifie de mani√®re unique chaque enregistrement du flux.  Cependant, dans ce cas, nous avons pass√© * car nous voulons que Redis g√©n√®re un nouvel identifiant pour nous.  Chaque nouvel identifiant augmentera.  Par cons√©quent, chaque nouvel enregistrement aura un identifiant plus grand par rapport aux enregistrements pr√©c√©dents. <br><br><h4>  Format d'ID </h4><br>  L'identifiant d'enregistrement renvoy√© par la commande <b>XADD se</b> compose de deux parties: <br><br> <code>{millisecondsTime}-{sequenceNumber} <br></code> <br>  <i>millisecondsTime</i> - Temps Unix en millisecondes (temps du serveur Redis).  Toutefois, si l'heure actuelle est identique ou inf√©rieure √† l'heure de l'enregistrement pr√©c√©dent, l'horodatage de l'enregistrement pr√©c√©dent est utilis√©.  Par cons√©quent, si l'heure du serveur est revenue au pass√©, le nouvel identifiant conservera toujours la propri√©t√© d'augmentation. <br><br>  <i>sequenceNumber est</i> utilis√© pour les enregistrements cr√©√©s dans la m√™me milliseconde.  <i>sequenceNumber</i> sera augment√© de 1 par rapport √† l'enregistrement pr√©c√©dent.  √âtant donn√© que <i>sequenceNumber a une</i> taille de 64 bits, en pratique, vous ne devez pas rencontrer de limite sur le nombre d'enregistrements pouvant √™tre g√©n√©r√©s en une milliseconde. <br><br>  Le format de ces identifiants √† premi√®re vue peut sembler √©trange.  Un lecteur incr√©dule peut se demander pourquoi le temps fait partie d'un identifiant.  La raison en est que les flux Redis prennent en charge les demandes de plage par des identifiants.  L'identifiant √©tant associ√© √† l'heure de cr√©ation de l'enregistrement, cela permet de demander des plages horaires.  Nous examinerons un exemple concret lorsque nous passerons √† l'√©tude de la <b>commande XRANGE</b> . <br><br>  Si, pour une raison quelconque, l'utilisateur doit sp√©cifier son propre identifiant, qui, par exemple, est associ√© √† un syst√®me externe, nous pouvons le transmettre √† la <b>commande XADD</b> au lieu du signe * comme indiqu√© ci-dessous: <br><br><pre> <code class="go hljs">&gt; XADD somestream <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> field value <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> &gt; XADD somestream <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span> foo bar <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span></code> </pre><br>  Veuillez noter que dans ce cas, vous devez surveiller vous-m√™me l'augmentation de l'identifiant.  Dans notre exemple, l'identifiant minimum est ¬´0-1¬ª, donc l'√©quipe n'acceptera pas un autre identifiant √©gal ou inf√©rieur √† ¬´0-1¬ª. <br><br><pre> <code class="go hljs">&gt; XADD somestream <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> foo bar (error) ERR The ID specified in XADD is equal or smaller than the target stream top item</code> </pre><br><h4>  Le nombre d'enregistrements dans le flux </h4><br>  Vous pouvez obtenir le nombre d'enregistrements dans un flux simplement en utilisant la commande <b>XLEN</b> .  Pour notre exemple, cette commande renverra la valeur suivante: <br><br><pre> <code class="go hljs">&gt; XLEN somestream (integer) <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br><h4>  Demandes de plage - XRANGE et XREVRANGE </h4><br>  Pour demander des donn√©es pour une plage, nous devons sp√©cifier deux identifiants - le d√©but et la fin de la plage.  La plage renvoy√©e comprendra tous les √©l√©ments, y compris les bordures.  Il y a √©galement deux identificateurs sp√©ciaux "-" et "+", respectivement, ce qui signifie le plus petit (premier enregistrement) et le plus grand (dernier enregistrement) identificateur dans le flux.  L'exemple ci-dessous affiche toutes les entr√©es de flux. <br><br><pre> <code class="go hljs">&gt; XRANGE mystream - + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1518951480106</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"sensor-id"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"1234"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"19.8"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1518951482479</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"sensor-id"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"9999"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"18.2"</span></span></code> </pre><br>  Chaque enregistrement renvoy√© est un tableau de deux √©l√©ments: un identifiant et une liste de paires cl√©-valeur.  Nous avons d√©j√† dit que les identifiants d'enregistrement sont li√©s au temps.  Par cons√©quent, nous pouvons demander la plage d'une p√©riode de temps sp√©cifique.  Cependant, nous pouvons sp√©cifier dans la requ√™te non pas l'identifiant complet, mais uniquement le temps Unix, en omettant la partie li√©e √† <i>sequenceNumber</i> .  La partie omise de l'identifiant est automatiquement √©gale √† z√©ro au d√©but de la plage et √† la valeur maximale possible √† la fin de la plage.  Voici un exemple de la fa√ßon de demander une plage de deux millisecondes. <br><br><pre> <code class="go hljs">&gt; XRANGE mystream <span class="hljs-number"><span class="hljs-number">1518951480106</span></span> <span class="hljs-number"><span class="hljs-number">1518951480107</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1518951480106</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"sensor-id"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"1234"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"19.8"</span></span></code> </pre><br>  Nous n'avons qu'un seul enregistrement dans cette plage, mais dans les ensembles de donn√©es r√©els, le r√©sultat renvoy√© peut √™tre √©norme.  Pour cette raison, <b>XRANGE</b> prend en charge l'option COUNT.  En sp√©cifiant la quantit√©, nous pouvons simplement obtenir les N premiers enregistrements.  Si nous devons obtenir les N entr√©es suivantes (pagination), nous pouvons utiliser le dernier identifiant re√ßu, augmenter son <i>num√©ro</i> de <i>s√©quence</i> de un et demander √† nouveau.  Voyons cela dans l'exemple suivant.  Nous commen√ßons √† ajouter 10 √©l√©ments en utilisant <b>XADD</b> (supposons que le flux mystream a d√©j√† √©t√© rempli avec 10 √©l√©ments).  Pour commencer l'it√©ration, en obtenant 2 √©l√©ments par commande, nous commen√ßons avec la plage compl√®te, mais avec COUNT √©gal √† 2. <br><br><pre> <code class="go hljs">&gt; XRANGE mystream - + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073278252</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_1"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073279157</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_2"</span></span></code> </pre><br>  Pour continuer l'it√©ration avec les deux √©l√©ments suivants, nous devons s√©lectionner le dernier identifiant re√ßu, c'est-√†-dire 1519073279157-0, et ajouter 1 √† <i>sequenceNumber</i> . <br>  L'identifiant r√©sultant, dans ce cas 1519073279157-1, peut maintenant √™tre utilis√© comme un nouvel argument au d√©but de la plage pour le prochain appel <b>XRANGE</b> : <br><br><pre> <code class="go hljs">&gt; XRANGE mystream <span class="hljs-number"><span class="hljs-number">1519073279157</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073280281</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_3"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073281432</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_4"</span></span></code> </pre><br>  Et ainsi de suite.  Puisque la complexit√© de <b>XRANGE</b> est O (log (N)) pour rechercher, puis O (M) pour renvoyer M √©l√©ments, chaque √©tape d'it√©ration est rapide.  Ainsi, en utilisant <b>XRANGE,</b> il est possible d' <b>it√©rer</b> efficacement les flux. <br><br>  La commande <b>XREVRANGE</b> est l'√©quivalent de <b>XRANGE</b> , mais renvoie les √©l√©ments dans l'ordre inverse: <br><br><pre> <code class="go hljs">&gt; XREVRANGE mystream + - COUNT <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073287312</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_10"</span></span></code> </pre><br>  Notez que la commande <b>XREVRANGE</b> prend les arguments de la plage de d√©but et de fin dans l'ordre inverse. <br><br><h4>  Lecture de nouveaux enregistrements avec XREAD </h4><br>  Il est souvent n√©cessaire de s'abonner au flux et de ne recevoir que de nouveaux messages.  Ce concept peut sembler √™tre un Redis Pub / Sub ou bloquer une liste Redis, mais il existe des diff√©rences fondamentales dans la fa√ßon d'utiliser Redis Stream: <br><br><ol><li>  Chaque nouveau message est remis par d√©faut √† chaque abonn√©.  Ce comportement est diff√©rent du blocage de la liste Redis, o√π un nouveau message sera lu par un seul abonn√©. </li><li>  Alors que dans Redis Pub / Sub tous les messages sont oubli√©s et jamais enregistr√©s, dans Stream tous les messages sont stock√©s ind√©finiment (sauf si le client provoque explicitement la suppression). </li><li>  Redis Stream vous permet de diff√©rencier l'acc√®s aux messages au sein d'un m√™me flux.  Un abonn√© sp√©cifique ne peut voir que l'historique de ses messages personnels. </li></ol><br>  Vous pouvez vous abonner au flux et recevoir de nouveaux messages √† l'aide de la commande <b>XREAD</b> .  C'est un peu plus compliqu√© que <b>XRANGE</b> , nous allons donc commencer par des exemples plus simples. <br><br><pre> <code class="go hljs">&gt; XREAD COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> STREAMS mystream <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073278252</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_1"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073279157</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_2"</span></span></code> </pre><br>  Dans l'exemple ci-dessus, un formulaire <b>XREAD</b> non bloquant est <b>sp√©cifi√©</b> .  Veuillez noter que l'option COUNT est facultative.  En fait, la seule option de commande requise est l'option STREAMS, qui d√©finit la liste des flux avec l'identifiant maximal correspondant.  Nous avons √©crit ¬´STREAMS mystream 0¬ª - nous voulons obtenir tous les enregistrements du flux mystream avec un identifiant sup√©rieur √† ¬´0-0¬ª.  Comme vous pouvez le voir dans l'exemple, la commande renvoie le nom du flux, car nous pouvons nous abonner √† plusieurs flux en m√™me temps.  Nous pourrions √©crire, par exemple, ¬´STREAMS mystream otherstream 0 0¬ª.  Veuillez noter qu'apr√®s l'option STREAMS, nous devons d'abord fournir les noms de tous les flux n√©cessaires, puis seulement une liste d'identifiants. <br><br>  Sous cette forme simple, la commande n'a rien de sp√©cial par rapport √† <b>XRANGE</b> .  Cependant, la chose int√©ressante est que nous pouvons facilement transformer <b>XREAD</b> en une commande de blocage en sp√©cifiant l'argument BLOCK: <br><br> <code>&gt; XREAD BLOCK 0 STREAMS mystream $ <br></code> <br>  Dans l'exemple ci-dessus, une nouvelle option BLOCK est sp√©cifi√©e avec un d√©lai d'expiration de 0 millisecondes (cela signifie une attente sans fin).  De plus, au lieu de passer l'identifiant habituel pour le flux mystream, l'identifiant sp√©cial $ a √©t√© pass√©.  Cet identifiant sp√©cial signifie que <b>XREAD</b> doit utiliser l'identifiant maximum dans le flux mystream comme identifiant.  Nous ne recevrons donc que de nouveaux messages, √† partir du moment o√π nous avons commenc√© √† √©couter.  D'une certaine mani√®re, cela est similaire √† la commande Unix tail -f. <br><br>  Veuillez noter que lorsque vous utilisez l'option BLOC, nous n'avons pas besoin d'utiliser l'identifiant sp√©cial $.  Nous pouvons utiliser n'importe quel identifiant existant dans le flux.  Si l'√©quipe peut r√©pondre imm√©diatement √† notre demande, sans bloquer, elle le fera, sinon elle sera bloqu√©e. <br><br>  Le blocage de <b>XREAD</b> peut √©galement √©couter plusieurs flux √† la fois, il vous suffit de sp√©cifier leurs noms.  Dans ce cas, la commande renverra un enregistrement du premier flux dans lequel les donn√©es sont arriv√©es.  Le premier abonn√© bloqu√© pour ce flux recevra d'abord les donn√©es. <br><br><h3>  Groupes de consommateurs </h3><br>  Dans certaines t√¢ches, nous voulons diff√©rencier l'acc√®s des abonn√©s aux messages dans le m√™me fil.  Un exemple o√π cela peut √™tre utile est une file d'attente de messages avec des travailleurs qui recevront diff√©rents messages du flux, vous permettant de faire √©voluer le traitement des messages. <br><br>  Si nous imaginons que nous avons trois abonn√©s C1, C2, C3 et un flux qui contient les messages 1, 2, 3, 4, 5, 6, 7, alors le service de messagerie se produira comme dans le diagramme ci-dessous: <br><br> <code>1 -&gt; C1 <br> 2 -&gt; C2 <br> 3 -&gt; C3 <br> 4 -&gt; C1 <br> 5 -&gt; C2 <br> 6 -&gt; C3 <br> 7 -&gt; C1 <br></code> <br>  Pour obtenir cet effet, Redis Stream utilise un concept appel√© Consumer Group.  Ce concept est similaire √† un pseudo-abonn√© qui re√ßoit des donn√©es d'un flux, mais est en fait servi par plusieurs abonn√©s au sein d'un groupe, offrant certaines garanties: <br><br><ol><li>  Chaque message est remis √† diff√©rents abonn√©s du groupe. </li><li>  Au sein d'un groupe, les abonn√©s sont identifi√©s par leur nom, qui est une cha√Æne sensible √† la casse.  Si un abonn√© abandonne temporairement le groupe, il peut √™tre restaur√© dans le groupe par son propre nom unique. </li><li>  Chaque groupe de consommateurs suit le concept de ¬´premier message non lu¬ª.  Lorsqu'un abonn√© demande de nouveaux messages, il ne peut recevoir que des messages qui n'ont jamais √©t√© remis √† aucun abonn√© d'un groupe. </li><li>  Il existe une commande pour confirmer explicitement le succ√®s du traitement du message par l'abonn√©.  Jusqu'√† ce que cette commande soit appel√©e, le message demand√© restera dans l'√©tat "en attente". </li><li>  Au sein du Consumer Group, chaque abonn√© peut demander un historique des messages qui lui ont √©t√© remis, mais qui n'ont pas encore √©t√© trait√©s (dans l'√©tat "en attente") </li></ol><br>  En un sens, l'√©tat d'un groupe peut √™tre repr√©sent√© comme suit: <br><br><pre> <code class="go hljs">+----------------------------------------+ | consumer_group_name: mygroup | consumer_group_stream: somekey | last_delivered_id: <span class="hljs-number"><span class="hljs-number">1292309234234</span></span><span class="hljs-number"><span class="hljs-number">-92</span></span> | | consumers: | <span class="hljs-string"><span class="hljs-string">"consumer-1"</span></span> with pending messages | <span class="hljs-number"><span class="hljs-number">1292309234234</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span> | <span class="hljs-number"><span class="hljs-number">1292309234232</span></span><span class="hljs-number"><span class="hljs-number">-8</span></span> | <span class="hljs-string"><span class="hljs-string">"consumer-42"</span></span> with pending messages | ... (and so forth) +----------------------------------------+</code> </pre><br>  Il est maintenant temps de se familiariser avec les principales √©quipes du Consumer Group, √† savoir: <br><br><ul><li>  <b>XGROUP est</b> utilis√© pour cr√©er, d√©truire et g√©rer des groupes. </li><li>  <b>XREADGROUP est</b> utilis√© pour lire un flux √† travers un groupe. </li><li>  <b>XACK</b> - cette commande permet √† l'abonn√© de marquer le message comme trait√© avec succ√®s </li></ul><br><h4>  Cr√©ation d'un groupe de consommateurs </h4><br>  Supposons qu'un flux mystream existe d√©j√†.  La commande de cr√©ation de groupe ressemblera alors √†: <br><br> <code>&gt; XGROUP CREATE mystream mygroup $ <br> OK <br></code> <br>  Lors de la cr√©ation d'un groupe, nous devons transmettre un identifiant commen√ßant par lequel le groupe recevra les messages.  Si nous voulons simplement recevoir tous les nouveaux messages, nous pouvons utiliser l'identifiant sp√©cial $ (comme dans notre exemple ci-dessus).  Si vous sp√©cifiez 0 au lieu d'un identifiant sp√©cial, tous les messages du flux seront disponibles pour le groupe. <br><br>  Maintenant que le groupe est cr√©√©, nous pouvons imm√©diatement commencer √† lire les messages √† l'aide de la <b>commande XREADGROUP</b> .  Cette commande est tr√®s similaire √† <b>XREAD</b> et prend en charge l'option BLOC facultative.  Cependant, il existe une option GROUP obligatoire, qui doit toujours √™tre sp√©cifi√©e avec deux arguments: le nom du groupe et le nom de l'abonn√©.  L'option COUNT est √©galement prise en charge. <br><br>  Avant de lire le flux, mettons-y quelques messages: <br><br><pre> <code class="go hljs">&gt; XADD mystream * message apple <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message orange <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message strawberry <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message apricot <span class="hljs-number"><span class="hljs-number">1526569535168</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message banana <span class="hljs-number"><span class="hljs-number">1526569544280</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span></code> </pre><br>  Essayons maintenant de lire ce flux √† travers le groupe: <br><br><pre> <code class="go hljs">&gt; XREADGROUP GROUP mygroup Alice COUNT <span class="hljs-number"><span class="hljs-number">1</span></span> STREAMS mystream &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"apple"</span></span></code> </pre><br>  La commande ci-dessus textuellement se lit comme suit: <br><br>  "Moi, abonn√© d'Alice, membre de mon groupe, je veux lire un message du mystream qui n'a jamais √©t√© livr√© √† personne auparavant." <br><br>  Chaque fois qu'un abonn√© effectue une op√©ration avec un groupe, il doit indiquer son nom, s'identifiant de mani√®re unique au sein du groupe.  Il y a un autre d√©tail tr√®s important dans la commande ci-dessus - l'identifiant sp√©cial "&gt;".  Cet identifiant sp√©cial filtre les messages, ne laissant que ceux qui n'ont jusqu'√† pr√©sent jamais √©t√© remis. <br><br>  De plus, dans des cas particuliers, vous pouvez sp√©cifier un identifiant r√©el, tel que 0 ou tout autre identifiant valide.  Dans ce cas, la commande <b>XREADGROUP</b> vous renverra l'historique des messages avec le statut ¬´en attente¬ª, qui ont √©t√© remis √† l'abonn√© sp√©cifi√© (Alice), mais qui n'ont pas encore √©t√© confirm√©s √† l'aide de la <b>commande XACK</b> . <br><br>  Nous pouvons v√©rifier ce comportement en sp√©cifiant imm√©diatement l'identifiant 0, sans l'option <b>COUNT</b> .  Nous voyons juste le seul message en attente, c'est-√†-dire le message avec la pomme: <br><br><pre> <code class="go hljs">&gt; XREADGROUP GROUP mygroup Alice STREAMS mystream <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"apple"</span></span></code> </pre><br>  Cependant, si nous confirmons que le message a √©t√© trait√© avec succ√®s, il ne s'affichera plus: <br><br><pre> <code class="go hljs">&gt; XACK mystream mygroup <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; XREADGROUP GROUP mygroup Alice STREAMS mystream <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) (empty list or set)</code> </pre><br>  Maintenant, c'est au tour de Bob de lire quelque chose: <br><br><pre> <code class="go hljs">&gt; XREADGROUP GROUP mygroup Bob COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> STREAMS mystream &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"orange"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"strawberry"</span></span></code> </pre><br>  Bob, membre de mon groupe, n'a pas demand√© plus de deux messages.  La commande signale uniquement les messages non livr√©s en raison de l'identifiant sp√©cial "&gt;".  Comme vous pouvez le voir, le message ¬´pomme¬ª ne s'affiche pas, car il a d√©j√† √©t√© livr√© √† Alice, donc Bob re√ßoit ¬´orange¬ª et ¬´fraise¬ª. <br><br>  Ainsi, Alice, Bob et tout autre abonn√© du groupe peuvent lire diff√©rents messages du m√™me flux.  Ils peuvent √©galement lire l'historique de leurs messages bruts ou marquer les messages comme trait√©s. <br><br>  Il y a quelques points √† garder √† l'esprit: <br><br><ul><li>  D√®s que l'abonn√© consid√®re que le message est la commande <b>XREADGROUP</b> , ce message passe √† l'√©tat ¬´en attente¬ª et est attribu√© √† cet abonn√© particulier.  Les autres abonn√©s du groupe ne pourront pas lire ce message. </li><li>  Les abonn√©s sont automatiquement cr√©√©s √† la premi√®re mention, il n'y a pas besoin de leur cr√©ation explicite. </li><li>  Avec <b>XREADGROUP,</b> vous pouvez lire les messages de plusieurs flux diff√©rents en m√™me temps, cependant, pour que cela fonctionne, vous devez d'abord cr√©er des groupes avec le m√™me nom pour chaque flux √† l'aide de <b>XGROUP</b> </li></ul><br><h4>  R√©cup√©ration apr√®s incident </h4><br>  L'abonn√© peut r√©cup√©rer de l'√©chec et relire sa liste de messages avec le statut "en attente".  Cependant, dans le monde r√©el, les abonn√©s peuvent finalement √©chouer.  Qu'arrive-t-il au message suspendu d'un abonn√© s'il ne peut pas r√©cup√©rer apr√®s un √©chec? <br>  Le Consumer Group propose une fonctionnalit√© qui est utilis√©e sp√©cifiquement pour de tels cas - lorsque vous devez changer le propri√©taire des messages. <br><br>  Tout d'abord, vous devez appeler la commande <b>XPENDING</b> , qui affiche tous les messages du groupe avec le statut "en attente".  Dans sa forme la plus simple, une commande est appel√©e avec seulement deux arguments: le nom du flux et le nom du groupe: <br><br><pre> <code class="go hljs">&gt; XPENDING mystream mygroup <span class="hljs-number"><span class="hljs-number">1</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span></code> </pre><br>  L'√©quipe a imprim√© le nombre de messages non trait√©s pour l'ensemble du groupe et pour chaque abonn√©.  Nous n'avons que Bob avec deux messages non trait√©s, car le seul message demand√© par Alice a √©t√© confirm√© avec <b>XACK</b> . <br><br>  Nous pouvons demander des informations suppl√©mentaires en utilisant plus d'arguments: <br><br> <code>XPENDING {key} {groupname} [{start-id} {end-id} {count} [{consumer-name}]] <br></code> <br>  {start-id} {end-id} - plage d'identifiants (vous pouvez utiliser "-" et "+") <br>  {count} - le nombre de tentatives de livraison <br>  {consumer-name} - nom du groupe <br><br><pre> <code class="go hljs">&gt; XPENDING mystream mygroup - + <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">74170458</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">74170458</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Nous avons maintenant les d√©tails de chaque message: identifiant, nom de l'abonn√©, temps d'arr√™t en millisecondes, et enfin, le nombre de tentatives de livraison.  Nous avons deux messages de Bob et ils sont inactifs pendant 74170458 millisecondes, environ 20 heures. <br><br>  Veuillez noter que personne ne nous emp√™che de v√©rifier le contenu du message simplement en utilisant <b>XRANGE</b> . <br><br><pre> <code class="go hljs">&gt; XRANGE mystream <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"orange"</span></span></code> </pre><br>  Il suffit de r√©p√©ter deux fois le m√™me identifiant dans les arguments.  Maintenant que nous avons une id√©e, Alice peut d√©cider que Bob ne se remettra probablement pas apr√®s 20 heures d'inactivit√©, et il est temps de demander ces messages et de reprendre leur traitement √† la place de Bob.  Pour ce faire, nous utilisons la commande <b>XCLAIM</b> : <br><br> <code>XCLAIM {key} {group} {consumer} {min-idle-time} {ID-1} {ID-2} ... {ID-N} <br></code> <br>  En utilisant cette commande, nous pouvons obtenir un message ¬´√©tranger¬ª qui n'a pas encore √©t√© trait√© en changeant le propri√©taire en {consommateur}.  Cependant, nous pouvons √©galement fournir un temps d'arr√™t minimum {min-idle-time}.  Cela permet d'√©viter une situation o√π deux clients essaient de changer simultan√©ment le propri√©taire des m√™mes messages: <br><br> <code>Client 1: XCLAIM mystream mygroup Alice 3600000 1526569498055-0 <br> Clinet 2: XCLAIM mystream mygroup Lora 3600000 1526569498055-0 <br></code> <br>  Le premier client r√©initialisera les temps d'arr√™t et augmentera le compteur du nombre de livraisons.  Le deuxi√®me client ne pourra donc pas le demander. <br><br><pre> <code class="go hljs">&gt; XCLAIM mystream mygroup Alice <span class="hljs-number"><span class="hljs-number">3600000</span></span> <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"orange"</span></span></code> </pre><br>  Le message a √©t√© revendiqu√© avec succ√®s par Alice, qui peut maintenant traiter le message et le reconna√Ætre. <br><br>  D'apr√®s l'exemple ci-dessus, il est clair qu'une ex√©cution r√©ussie de la demande renvoie le contenu du message lui-m√™me.  Cependant, ce n'est pas n√©cessaire.  L'option JUSTID peut √™tre utilis√©e pour renvoyer uniquement des identificateurs de message.  Ceci est utile si vous n'√™tes pas int√©ress√© par les d√©tails du message et souhaitez augmenter les performances du syst√®me. <br><br><h3>  Comptoir de livraison </h3><br>  Le compteur que vous observez dans la sortie <b>XPENDING</b> est le nombre de livraisons de chaque message.  Un tel compteur est incr√©ment√© de deux mani√®res: lorsque le message est correctement demand√© via <b>XCLAIM</b> ou lorsque l'appel <b>XREADGROUP</b> est <b>utilis√©</b> . <br><br>  Il est normal que certains messages soient remis plusieurs fois.  L'essentiel est qu'en cons√©quence, tous les messages soient trait√©s.  Parfois, lors du traitement d'un message, il y a des probl√®mes dus √† des dommages au message lui-m√™me ou le traitement du message provoque une erreur dans le code du gestionnaire.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, il se peut que personne ne puisse traiter ce message. </font><font style="vertical-align: inherit;">Comme nous avons un compteur de tentatives de livraison, nous pouvons utiliser ce compteur pour d√©tecter de telles situations. </font><font style="vertical-align: inherit;">Par cons√©quent, d√®s que le compteur de remise atteint un grand nombre sp√©cifi√© par vous, il sera probablement plus raisonnable de placer un tel message dans un autre flux et d'envoyer une notification √† l'administrateur syst√®me.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Statut du fil </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XINFO est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilis√©e pour demander diverses informations sur un flux et ses groupes. </font><font style="vertical-align: inherit;">Par exemple, la forme de base de la commande est la suivante:</font></font><br><br><pre> <code class="go hljs">&gt; XINFO STREAM mystream <span class="hljs-number"><span class="hljs-number">1</span></span>) length <span class="hljs-number"><span class="hljs-number">2</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) radix-tree-keys <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) radix-tree-nodes <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>) groups <span class="hljs-number"><span class="hljs-number">8</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>) first-entry <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1524494395530</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"1"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>) last-entry <span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569544280</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"banana"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La commande ci-dessus affiche des informations g√©n√©rales sur le flux sp√©cifi√©. </font><font style="vertical-align: inherit;">Maintenant un exemple un peu plus complexe:</font></font><br><br><pre> <code class="go hljs">&gt; XINFO GROUPS mystream <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"mygroup"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) consumers <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) pending <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"some-other-group"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) consumers <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) pending <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La commande ci-dessus affiche des informations g√©n√©rales pour tous les groupes du flux sp√©cifi√© </font></font><br><br><pre> <code class="go hljs">&gt; XINFO CONSUMERS mystream mygroup <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Alice"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) pending <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) idle <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">9104628</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) pending <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) idle <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">83841983</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La commande ci-dessus affiche des informations sur tous les abonn√©s du flux et du groupe sp√©cifi√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous oubliez la syntaxe de la commande, contactez simplement la commande pour obtenir de l'aide:</font></font><br><br><pre> <code class="go hljs">&gt; XINFO HELP <span class="hljs-number"><span class="hljs-number">1</span></span>) XINFO {subcommand} arg arg ... arg. Subcommands are: <span class="hljs-number"><span class="hljs-number">2</span></span>) CONSUMERS {key} {groupname} -- Show consumer groups of group {groupname}. <span class="hljs-number"><span class="hljs-number">3</span></span>) GROUPS {key} -- Show the stream consumer groups. <span class="hljs-number"><span class="hljs-number">4</span></span>) STREAM {key} -- Show information about the stream. <span class="hljs-number"><span class="hljs-number">5</span></span>) HELP -- Print this help.</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Limite de taille de flux </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De nombreuses applications ne souhaitent pas collecter des donn√©es dans le flux pour toujours. </font><font style="vertical-align: inherit;">Il est souvent utile d'avoir le nombre maximum de messages dans le flux. </font><font style="vertical-align: inherit;">Dans d'autres cas, il est utile de transf√©rer tous les messages du flux vers un autre stockage persistant lorsque la taille de flux sp√©cifi√©e est atteinte. </font><font style="vertical-align: inherit;">Vous pouvez limiter la taille du flux √† l'aide du param√®tre MAXLEN dans la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande XADD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="go hljs">&gt; XADD mystream MAXLEN <span class="hljs-number"><span class="hljs-number">2</span></span> * value <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1526654998691</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream MAXLEN <span class="hljs-number"><span class="hljs-number">2</span></span> * value <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream MAXLEN <span class="hljs-number"><span class="hljs-number">2</span></span> * value <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XLEN mystream (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> &gt; XRANGE mystream - + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"3"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous utilisez MAXLEN, les anciens enregistrements sont automatiquement supprim√©s lorsque la longueur sp√©cifi√©e est atteinte, de sorte que le flux a une taille constante. </font><font style="vertical-align: inherit;">Cependant, le d√©coupage dans ce cas ne se produit pas de la mani√®re la plus productive dans la m√©moire Redis. </font><font style="vertical-align: inherit;">La situation peut √™tre </font><font style="vertical-align: inherit;">am√©lior√©e </font><font style="vertical-align: inherit;">comme suit: L' </font><font style="vertical-align: inherit;">argument ~ dans l'exemple ci-dessus signifie que nous n'avons pas besoin de limiter la longueur du flux √† une valeur sp√©cifique. </font><font style="vertical-align: inherit;">Dans notre exemple, cela peut √™tre n'importe quel nombre sup√©rieur ou √©gal √† 1000 (par exemple, 1000, 1010 ou 1030). </font><font style="vertical-align: inherit;">Nous avons simplement indiqu√© explicitement que nous souhaitons que notre flux stocke au moins 1 000 enregistrements. </font><font style="vertical-align: inherit;">Cela rend le travail avec la m√©moire beaucoup plus efficace dans Redis. </font><font style="vertical-align: inherit;">Il existe √©galement une commande </font><b><font style="vertical-align: inherit;">XTRIM</font></b><font style="vertical-align: inherit;"> distincte </font><font style="vertical-align: inherit;">qui fait la m√™me chose:</font></font><br><br> <code>XADD mystream MAXLEN ~ 1000 * ... entry fields here ... <br></code> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br> <code>&gt; XTRIM mystream MAXLEN 10 <br> <br> &gt; XTRIM mystream MAXLEN ~ 10 <br></code> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Stockage et r√©plication persistants </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis Stream est r√©pliqu√© de mani√®re asynchrone sur les n≈ìuds esclaves et enregistr√© dans des fichiers tels que AOF (instantan√© de toutes les donn√©es) et RDB (journal de toutes les op√©rations d'√©criture). </font><font style="vertical-align: inherit;">La r√©plication d'√©tat des groupes de consommateurs est √©galement prise en charge. </font><font style="vertical-align: inherit;">Par cons√©quent, si le message est dans l'√©tat "en attente" sur le n≈ìud ma√Ætre, alors sur les n≈ìuds esclaves, ce message aura le m√™me √©tat.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suppression d'√©l√©ments individuels d'un flux </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour supprimer les messages, il existe une commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XDEL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sp√©ciale </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La commande obtient le nom du flux, suivi des identifiants du message √† supprimer:</font></font><br><br><pre> <code class="go hljs">&gt; XRANGE mystream - + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"3"</span></span> &gt; XDEL mystream <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; XRANGE mystream - + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"3"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lorsque vous utilisez cette commande, vous devez tenir compte du fait qu'en fait, la m√©moire ne sera pas lib√©r√©e imm√©diatement. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Flux de longueur nulle </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diff√©rence entre les flux et les autres structures de donn√©es Redis est que lorsque d'autres structures de donn√©es n'ont plus d'√©l√©ments en elles-m√™mes, comme effet secondaire, la structure de donn√©es elle-m√™me sera supprim√©e de la m√©moire. </font><font style="vertical-align: inherit;">Ainsi, par exemple, l'ensemble tri√© sera compl√®tement supprim√© lorsque l'appel ZREM supprime le dernier √©l√©ment. </font><font style="vertical-align: inherit;">Au lieu de cela, les threads sont autoris√©s √† rester en m√©moire sans m√™me avoir un seul √©l√©ment √† l'int√©rieur.</font></font><br><br><h4>  Conclusion </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis Stream est id√©al pour cr√©er des courtiers de messages, des files d'attente de messages, des journaux unifi√©s et des syst√®mes de discussion qui stockent l'historique. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme l'a dit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicklaus Wirth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les programmes sont des algorithmes et des structures de donn√©es, et Redis vous offre d√©j√† les deux.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456270/">https://habr.com/ru/post/fr456270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456258/index.html">Free as a wind et free as a beer traduction de ¬´Free as in Freedom¬ª en russe sous la licence GNU FDL 1.3</a></li>
<li><a href="../fr456260/index.html">Discussion sur l'√©conomie √©quitable</a></li>
<li><a href="../fr456262/index.html">Radio d√©finie par logiciel - comment √ßa marche? Partie 9</a></li>
<li><a href="../fr456264/index.html">Cr√©ez des fichiers binaires Android √† l'aide de la source et d'Android NDK. Nous pompons l'utilitaire screencap</a></li>
<li><a href="../fr456266/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 302 (du 10 au 16 juin)</a></li>
<li><a href="../fr456272/index.html">Qu'est-ce qu'Android Lint et comment vous aide-t-il √† √©crire du code pris en charge?</a></li>
<li><a href="../fr456274/index.html">Psychologues: les robots sexuels entra√Æneront une augmentation du nombre de personnes sans couple qui n'ont pas besoin de relations avec d'autres personnes</a></li>
<li><a href="../fr456276/index.html">Qu'est-ce que l'information?</a></li>
<li><a href="../fr456280/index.html">D√©buter avec stm32 ou ne pas r√©p√©ter mes erreurs</a></li>
<li><a href="../fr456282/index.html">Graphiques multidimensionnels en Python - de trois dimensions √† six dimensions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>