<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äç‚öïÔ∏è üë∏ üß¶ Linux tiene muchas caras: c√≥mo trabajar en cualquier distribuci√≥n üë®üèΩ‚Äçü§ù‚Äçüë®üèª ü•Ñ üìë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Crear una aplicaci√≥n de respaldo que se ejecute en cualquier distribuci√≥n no es una tarea f√°cil. Para garantizar que Veeam Agent para Linux se ejecute...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Linux tiene muchas caras: c√≥mo trabajar en cualquier distribuci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/veeam/blog/471226/"><img src="https://habrastorage.org/webt/ry/zz/2e/ryzz2enp795e4whkxs9rgxbmwsm.jpeg"><br><br>  Crear una aplicaci√≥n de respaldo que se ejecute en cualquier distribuci√≥n no es una tarea f√°cil.  Para garantizar que Veeam Agent para Linux se ejecute en distribuciones de RHEL 6 y Debian 6, openSUSE Leap 15.1 y Ubuntu 19.04 tienen que resolver una serie de problemas, especialmente cuando considera que el m√≥dulo del n√∫cleo es parte del producto de software. <br><br>  Este art√≠culo se basa en una presentaci√≥n en la conferencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LinuxPiter 2019</a> . <br><a name="habracut"></a><br>  Linux no es solo uno de los sistemas operativos m√°s populares.  De hecho, esta es una plataforma sobre la cual puedes hacer algo √∫nico, algo tuyo.  Debido a esto, Linux tiene muchas distribuciones que difieren en un conjunto de componentes de software.  Y aqu√≠ surge el problema: para que el producto de software funcione en cualquier distribuci√≥n, debe tener en cuenta las caracter√≠sticas de cada uno. <br><br><h2>  Gerentes de paquetes.  .deb vs .rpm </h2><br>  Comencemos con el problema obvio de distribuir el producto para diferentes distribuciones. <br>  La forma m√°s t√≠pica de distribuir productos de software es colocar el paquete en el repositorio para que el administrador de paquetes integrado en el sistema pueda instalarlo desde all√≠. <br>  Sin embargo, tenemos dos formatos de paquete populares: <i>rpm</i> y <i>deb</i> .  Entonces, todos tendr√°n que apoyar. <br><br>  En el mundo de los paquetes deb, el nivel de compatibilidad es sorprendente.  El mismo paquete se instala igualmente bien y funciona tanto en Debian 6 como en Ubuntu 19.04.  Los est√°ndares para el proceso de creaci√≥n de paquetes y trabajo con ellos, establecidos en distribuciones antiguas de Debian, siguen siendo relevantes en el nuevo sistema operativo Linux Mint y elemental.  Por lo tanto, en el caso de Veeam Agent para Linux, un paquete de deb para cada plataforma de hardware es suficiente. <br><br>  Pero en el mundo de los paquetes rpm, las diferencias son grandes.  En primer lugar, debido al hecho de que hay dos distribuidores completamente independientes de Red Hat y SUSE, para los cuales la compatibilidad no es absolutamente necesaria.  En segundo lugar, estos distribuidores tienen distribuciones de esos.  soporte y experimental.  Entre ellos, tampoco es necesaria la compatibilidad.  Result√≥ que para el6, el7 y el8 sus propios paquetes.  Paquete separado para Fedora.  Paquetes para SLES11 y 12 y separados para openSUSE.  El principal problema son las dependencias y los nombres de los paquetes. <br><br><h2>  Problema de dependencia </h2><br>  Por desgracia, los mismos paquetes a menudo terminan bajo diferentes nombres en diferentes distribuciones.  A continuaci√≥n se muestra una lista parcial de las dependencias del paquete veeam. <br><div class="scrollable-table"><table><tbody><tr><th>  Para EL7: </th><th>  Para SLES 12: </th></tr><tr><td><ul><li>  libblkid </li><li>  libgcc </li><li>  libstdc ++ </li><li>  ncurses-libs </li><li>  fusible-libs </li><li>  file-libs </li><li>  veeamsnap = 3.0.2.1185 </li></ul></td><td><ul><li>  libblkid1 </li><li>  libgcc_s1 </li><li>  libstdc ++ 6 </li><li>  libmagic1 </li><li>  libfuse2 </li><li>  veeamsnap-kmp = 3.0.2.1185 </li></ul></td></tr></tbody></table></div><br>  Como resultado, la lista de dependencias es exclusiva de la distribuci√≥n. <br><br>  Empeora cuando una versi√≥n actualizada comienza a ocultarse bajo el nombre del paquete anterior. <br><br>  <b>Un ejemplo:</b> <br><br>  Fedora 24 ha actualizado el paquete <i>ncurses</i> de la versi√≥n 5 a la versi√≥n 6. Nuestro producto fue construido con la versi√≥n 5 para garantizar la compatibilidad con distribuciones anteriores.  Para usar la quinta versi√≥n anterior de la biblioteca en Fedora 24, tuve que usar el paquete <i>ncurses-compat-libs</i> . <br><br>  Como resultado, aparecen dos paquetes para Fedora, con diferentes dependencias. <br><br>  M√°s interesante  Despu√©s de la pr√≥xima actualizaci√≥n del paquete de distribuci√≥n, el paquete <i>ncurses-compat-libs</i> con la quinta versi√≥n de la biblioteca no est√° disponible.  No es rentable para un distribuidor incorporar bibliotecas antiguas a una nueva versi√≥n de distribuci√≥n.  Despu√©s de un tiempo, el problema se repiti√≥ en las distribuciones de SUSE. <br><br>  Como resultado, para algunas distribuciones, tuve que abandonar la dependencia expl√≠cita de <i>ncurses-libs</i> y arreglar el producto para que pudiera funcionar con cualquier versi√≥n de la biblioteca. <br><br>  Por cierto, en la octava versi√≥n de Red Hat ya no hay un <i>metapaquete de Python</i> que haga referencia al buen y antiguo <i>Python 2.7</i> .  Hay <i>python2</i> y <i>python</i> 3. <br><br><h2>  Alternativa a los gestores de paquetes </h2><br>  El problema con las dependencias es antiguo y obvio desde hace mucho tiempo.  Solo recuerda el infierno de la dependencia. <br>  Combine una variedad de bibliotecas y aplicaciones para que todas funcionen de manera estable y no entren en conflicto; de hecho, cualquier distribuidor de Linux est√° tratando de resolver este problema. <br><br>  El administrador de paquetes can√≥nicos <b>Snappy est√°</b> tratando de resolver este problema de manera muy diferente.  La idea principal: la aplicaci√≥n se ejecuta en una caja de arena aislada y protegida del sistema principal.  Si la aplicaci√≥n necesita bibliotecas, se entregan con la aplicaci√≥n misma. <br><br>  <b>Flatpak</b> tambi√©n le permite ejecutar aplicaciones en el sandbox usando Contenedores de Linux.  Tambi√©n existe <b>AppImage</b> , que le permite crear im√°genes port√°tiles de programas. <br><br>  Estas soluciones le permiten crear un paquete para cualquier distribuci√≥n.  En el caso de <b>Flatpak</b> y <b>AppImage, la</b> instalaci√≥n y el lanzamiento de la aplicaci√≥n es posible incluso sin el conocimiento del administrador. <br><br>  El principal problema es que no todas las aplicaciones pueden ejecutarse en el sandbox y sin privilegios de <i>root</i> .  Algunos necesitan acceso directo a la plataforma.  No estoy hablando de m√≥dulos de kernel, que dependen mucho del kernel y no se ajustan al concepto de sandbox. <br><br>  El segundo problema es que las distribuciones populares de Red Hat y SUSE en el entorno empresarial a√∫n no son compatibles con Snappy y Flatpak. <br><br>  En este sentido, Veeam Agent para Linux no est√° en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">snapcraft.io</a> ni en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">flathub.org</a> . <br><br>  Al final de la pregunta sobre los administradores de paquetes, noto que hay una opci√≥n para abandonar completamente los administradores de paquetes combinando archivos binarios y un script para instalarlos en un paquete. <br><br>  Tal paquete le permite crear un paquete com√∫n para diferentes distribuciones y plataformas, para llevar a cabo un proceso de instalaci√≥n interactivo, llevando a cabo la personalizaci√≥n necesaria.  Encontr√© tales paquetes para Linux solo de VMware. <br><br><h2>  Problema de actualizaci√≥n </h2><br><img src="https://habrastorage.org/webt/ny/8c/-k/ny8c-kdpc74mgrym0nszgkd0d04.png"><br>  Incluso si se resuelven todos los problemas de dependencia, el programa puede funcionar de manera diferente en la misma distribuci√≥n.  El punto est√° en las actualizaciones. <br><br>  Hay 3 estrategias de actualizaci√≥n: <br><br><ul><li>  Lo m√°s f√°cil es nunca actualizar.  Configurado el servidor y olvidado.  ¬øPor qu√© actualizaciones si todo funciona?  Los problemas comienzan la primera vez que contacta a soporte.  El creador de la distribuci√≥n solo admite una versi√≥n actualizada. </li><li>  Puede confiar en el distribuidor y configurar actualizaciones autom√°ticas.  En este caso, es probable que haya una llamada de soporte inmediatamente despu√©s de una actualizaci√≥n fallida. </li><li>  La opci√≥n de actualizaci√≥n manual solo despu√©s de ejecutarla en la infraestructura de prueba es la m√°s fiel, pero costosa y requiere mucho tiempo.  No todos pueden permit√≠rselo. </li></ul><br>  Dado que diferentes usuarios usan diferentes estrategias de actualizaci√≥n, debe admitir tanto la √∫ltima versi√≥n como todas las versiones anteriores.  Esto complica el proceso de desarrollo, y el proceso de prueba, agrega un dolor de cabeza al servicio de soporte. <br><br><h2>  Variedad de plataformas de hardware. </h2><br>  Varias plataformas de hardware son un problema que es en gran medida espec√≠fico del c√≥digo nativo.  Como m√≠nimo, debe recopilar binarios para cada plataforma compatible. <br><br>  En el proyecto Veeam Agent para Linux, todav√≠a no podemos admitir al menos algo similar a RISC. <br><br>  No me detendr√© en este tema en detalle.  Solo describir√© los problemas principales: tipos dependientes de la plataforma, como <code>size_t</code> , alineaci√≥n de estructuras y orden de bytes. <br><br><h2>  Enlace est√°tico y / o din√°mico </h2><br><img src="https://habrastorage.org/webt/x7/im/9v/x7im9v9gtvi7lkwmodbajd0au_g.jpeg"><br>  Y aqu√≠ est√° la pregunta "¬øC√≥mo vincular a las bibliotecas, de forma din√°mica o est√°tica?"  Vale la pena discutirlo. <br><br>  Por lo general, las aplicaciones Linux C / C ++ usan enlaces din√°micos.  Esto funciona muy bien si la aplicaci√≥n est√° construida espec√≠ficamente para una distribuci√≥n espec√≠fica. <br><br>  Si la tarea es cubrir una variedad de distribuciones con un archivo binario, debe concentrarse en la distribuci√≥n admitida m√°s antigua.  Para nosotros, esto es Red Hat 6. Contiene gcc 4.4, que incluso el est√°ndar C ++ 11 no es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">totalmente</a> compatible. <br><br>  Estamos construyendo nuestro proyecto usando gcc 6.3, que es totalmente compatible con C ++ 14.  Naturalmente, en este caso en Red Hat 6, la biblioteca libstdc ++ y boost debe arrastrarse.  La forma m√°s f√°cil de vincularlos es est√°ticamente. <br><br>  Pero, por desgracia, no todas las bibliotecas se pueden vincular est√°ticamente. <br><br>  Primero, las bibliotecas del sistema, como <i>libfuse</i> , <i>libblkid,</i> deben vincularse din√°micamente para asegurarse de que sean compatibles con el n√∫cleo y sus m√≥dulos. <br><br>  En segundo lugar, hay una sutileza con las licencias. <br><br>  La licencia GPL b√°sicamente permite vincular bibliotecas solo con c√≥digo de c√≥digo abierto.  MIT y BSD permiten la vinculaci√≥n est√°tica y permiten incluir bibliotecas en el proyecto.  Pero LGPL no parece contradecir la vinculaci√≥n est√°tica, sino que requiere compartir los archivos necesarios para la vinculaci√≥n. <br><br>  En general, el uso de enlaces din√°micos proteger√° contra la necesidad de proporcionar algo. <br><br><h2>  Creaci√≥n de aplicaciones C / C ++ </h2><br>  Para crear aplicaciones C / C ++ para diferentes plataformas y distribuciones, es suficiente seleccionar o compilar una versi√≥n adecuada de gcc y usar compiladores cruzados para arquitecturas espec√≠ficas, para recopilar todo el conjunto de bibliotecas.  Este trabajo es bastante factible, pero bastante problem√°tico.  Y no hay garant√≠as de que el compilador y las bibliotecas seleccionados proporcionen una opci√≥n viable. <br><br>  Una ventaja obvia: la infraestructura se simplifica enormemente, ya que todo el proceso de ensamblaje se puede realizar en una m√°quina.  Adem√°s, es suficiente recopilar un conjunto de archivos binarios para una arquitectura y puede empaquetarlos en paquetes para diferentes distribuciones.  As√≠ es como se crean los paquetes veeam para Veeam Agent para Linux. <br><br>  En contraste con esta opci√≥n, simplemente puede preparar la granja de compilaci√≥n, es decir, varias m√°quinas para ensamblar.  Cada m√°quina proporcionar√° la compilaci√≥n de la aplicaci√≥n y el ensamblaje del paquete para una distribuci√≥n particular y una arquitectura espec√≠fica.  En este caso, la compilaci√≥n se realiza por los medios que el distribuidor ha preparado.  Es decir, la etapa de preparaci√≥n del compilador y la selecci√≥n de bibliotecas ya no son necesarias.  Adem√°s, el proceso de ensamblaje se puede paralelizar f√°cilmente. <br><br>  Sin embargo, hay un inconveniente en este enfoque: para cada distribuci√≥n dentro de la misma arquitectura, tendr√° que ensamblar su propio conjunto de archivos binarios.  Tambi√©n una desventaja es que se deben mantener tantas m√°quinas para asignar una gran cantidad de espacio en disco y RAM. <br><br>  De esta manera, se ensamblan los paquetes KMOD del m√≥dulo del n√∫cleo veeamsnap para distribuciones de Red Hat. <br><br><h2>  Servicio de compilaci√≥n abierta </h2><br>  Los colegas de SUSE intentaron implementar un t√©rmino medio como un servicio especial para compilar aplicaciones y crear paquetes: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">openbuildservice</a> . <br><br>  De hecho, es un hipervisor que crea una m√°quina virtual, instala todos los paquetes necesarios en ella, compila la aplicaci√≥n y compila el paquete en este entorno aislado, despu√©s de lo cual se libera dicha m√°quina virtual. <br><br><img src="https://habrastorage.org/webt/y0/4p/uy/y04puyokz_w-fexue3zcgpvhcgc.png"><br><br>  El planificador implementado en OpenBuildService determinar√° cu√°ntas m√°quinas virtuales puede ejecutar para obtener la velocidad de compilaci√≥n √≥ptima del paquete.  El propio mecanismo de firma incorporado firmar√° los paquetes y los colocar√° en el repositorio incorporado.  El sistema de control de versiones incorporado guardar√° el historial de cambios y ensamblajes.  Queda por agregar simplemente su c√≥digo fuente a este sistema.  Incluso el servidor en s√≠ no es necesario para subir, pero puedes usar el abierto. <br><br>  Aqu√≠, sin embargo, hay un problema: tal combinaci√≥n es dif√≠cil de encajar en la infraestructura existente.  Por ejemplo, el control de versiones no es necesario, ya tenemos el nuestro para las fuentes.  El mecanismo de firma es diferente: se utiliza un servidor especial.  El repositorio tampoco es necesario. <br><br>  Adem√°s, el soporte para otras distribuciones, por ejemplo, Red Hat, se implementa de manera bastante deficiente, lo cual es comprensible. <br><br>  La ventaja de este servicio es el r√°pido soporte de la pr√≥xima versi√≥n de la distribuci√≥n SUSE.  Antes del anuncio oficial de lanzamiento, los paquetes necesarios para el ensamblaje se cargan en el repositorio p√∫blico.  Una nueva aparece en la lista de distribuciones disponibles en OpenBuildService.  Ponemos una marca y se agrega al plan de ensamblaje.  Por lo tanto, agregar una nueva versi√≥n de la distribuci√≥n se realiza en casi un clic. <br><br>  En nuestra infraestructura, utilizando OpenBuildService, reunimos toda la variedad de paquetes KMP del m√≥dulo del n√∫cleo veeamsnap para distribuciones SUSE. <br><br>  Adem√°s, me gustar√≠a detenerme en cuestiones espec√≠ficas de los m√≥dulos del n√∫cleo. <br><br><h2>  kernel ABI </h2><br>  Los m√≥dulos del kernel de Linux se han distribuido hist√≥ricamente en forma de origen.  El hecho es que los creadores del kernel no se cargan con el cuidado de mantener una API estable para los m√≥dulos del kernel, y a√∫n m√°s a nivel binario, luego kABI. <br><br>  Para construir un m√≥dulo para el n√∫cleo de vainilla, se requieren encabezados de este n√∫cleo en particular, y funcionar√° solo en este n√∫cleo. <br><br>  DKMS le permite automatizar el proceso de ensamblaje de m√≥dulos al actualizar el kernel.  Como resultado, los usuarios del repositorio de Debian (y sus muchos parientes) usan m√≥dulos del n√∫cleo desde el repositorio del distribuidor o ensamblados desde la fuente usando DKMS. <br><br>  Sin embargo, esta situaci√≥n no es particularmente c√≥moda con el segmento Enterprise.  Los distribuidores de c√≥digo propietario quieren distribuir el producto en forma de archivos binarios compilados. <br><br>  Los administradores no desean mantener las herramientas de desarrollo en los servidores de producci√≥n por razones de seguridad.  Los distribuidores de Linux para empresas, como Red Hat y SUSE, han decidido que pueden mantener kABI estable para sus usuarios.  Como resultado, aparecieron los paquetes KMOD para Red Hat y KMP para SUSE. <br><br>  La esencia de esta soluci√≥n es bastante simple.  La API del n√∫cleo se congela para una versi√≥n espec√≠fica de la distribuci√≥n.  El distribuidor declara que usa el kernel, por ejemplo, 3.10, y solo realiza correcciones y mejoras que no afectan las interfaces del kernel de ninguna manera, y los m√≥dulos ensamblados para el primer kernel pueden usarse para todos los posteriores sin recompilaci√≥n. <br><br>  Red Hat anuncia la compatibilidad de kABI para la distribuci√≥n a lo largo del ciclo de vida.  Es decir, el m√≥dulo ensamblado para rhel 6.0 (versi√≥n de noviembre de 2010) tambi√©n deber√≠a funcionar en la versi√≥n 6.10 (versi√≥n de junio de 2018).  Y esto es casi 8 a√±os.  Naturalmente, la tarea es bastante complicada. <br>  Registramos varios casos cuando, debido a problemas con la compatibilidad de kABI, el m√≥dulo veeamsnap dej√≥ de funcionar. <br><br>  Despu√©s de que el m√≥dulo veeamsnap compilado para RHEL 7.0 result√≥ ser incompatible con el kernel de RHEL 7.5, pero se carg√≥ y garantiz√≥ la ca√≠da del servidor, nos negamos a usar la compatibilidad de kABI para RHEL 7 en general. <br><br>  Actualmente, el paquete KMOD para RHEL 7 contiene un ensamblaje para cada versi√≥n de lanzamiento y un script que proporciona la carga del m√≥dulo. <br><br>  SUSE abord√≥ la tarea de compatibilidad de kABI con m√°s cuidado.  Proporcionan compatibilidad kABI en un solo paquete de servicio. <br><br>  Por ejemplo, el lanzamiento de SLES 12 tuvo lugar en septiembre de 2014. Y SLES 12 SP1 ya est√° en diciembre de 2015, es decir, ha pasado poco m√°s de un a√±o.  Aunque ambas versiones usan el n√∫cleo 3.12, no son compatibles con kABI.  Obviamente, mantener la compatibilidad de kABI durante solo un a√±o es mucho m√°s f√°cil.  El ciclo anual de actualizaci√≥n del m√≥dulo principal no deber√≠a causar problemas a los creadores de los m√≥dulos. <br><br>  Como resultado de esta pol√≠tica de SUSE, no solucionamos ning√∫n problema con la compatibilidad de kABI en nuestro m√≥dulo veeamsnap.  Es cierto que el n√∫mero de paquetes para SUSE es casi un orden de magnitud mayor. <br><br><h2>  Parches y backports </h2><br>  A pesar del hecho de que los distribuidores est√°n tratando de garantizar la compatibilidad de kABI y la estabilidad del kernel, tambi√©n est√°n tratando de mejorar el rendimiento y eliminar defectos en este kernel estable. <br><br>  Adem√°s, adem√°s de su propio "trabajo sobre errores", los desarrolladores del kernel de Linux empresarial realizan un seguimiento de los cambios en el kernel de vainilla y los transfieren a su "estable". <br><br>  A veces esto lleva a nuevos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">errores</a> . <br><br>  La √∫ltima versi√≥n de Red Hat 6 cometi√≥ un error en una de las actualizaciones menores.  Condujo al hecho de que el m√≥dulo veeamsnap ten√≠a garantizado el bloqueo del sistema cuando se lanz√≥ la instant√°nea.  Al comparar las fuentes del kernel antes y despu√©s de la actualizaci√≥n, descubrimos que el backport era el culpable.  Se realiz√≥ una soluci√≥n similar en la versi√≥n 4.19 del kernel de vainilla.  Pero solo en el n√∫cleo de vainilla, esta soluci√≥n funcion√≥ bien, y al transferirla al "estable" 2.6.32, hubo un problema con el bloqueo de giro. <br><br>  Por supuesto, todos siempre tienen errores, pero ¬øvali√≥ la pena arrastrar el c√≥digo de 4.19 a 2.6.32, arriesgando la estabilidad? ... No estoy seguro ... <br><br>  Lo peor de todo, cuando el marketing est√° vinculado al tira y afloja "estabilidad" &lt;-&gt; "modernizaci√≥n".  El departamento de marketing necesita que el n√∫cleo de la distribuci√≥n actualizada sea estable, por un lado, y al mismo tiempo tenga un mejor rendimiento y tenga nuevas caracter√≠sticas.  Esto lleva a compromisos extra√±os. <br><br>  Cuando intent√© construir un m√≥dulo en el kernel 4.4 de SLES 12 SP3, me sorprendi√≥ encontrar la funcionalidad de vanilla 4.8 en √©l.  En mi opini√≥n, la implementaci√≥n del bloque de E / S del kernel 4.4 del SLES 12 SP3 es m√°s como un kernel 4.8 que la versi√≥n anterior del kernel 4.4 estable del SLES12 SP2.  No puedo juzgar qu√© porcentaje de c√≥digo se transfiri√≥ desde el kernel 4.8 al SLES 4.4 para SP3, pero a√∫n no tengo la oportunidad de llamar al kernel el mismo 4.4 estable. <br><br>  Lo m√°s desagradable de esto es que al escribir un m√≥dulo que funciona igualmente bien en diferentes n√∫cleos, ya no puede confiar en la versi√≥n del n√∫cleo.  Tambi√©n tenemos que tener en cuenta la distribuci√≥n.  Es bueno que a veces pueda participar en una definici√≥n que aparece junto con una nueva funcionalidad, pero esta caracter√≠stica no siempre aparece. <br><br>  Como resultado, el c√≥digo est√° rodeado de directivas elegantes para la compilaci√≥n condicional. <br><br>  Tambi√©n hay parches que cambian la API del n√∫cleo documentada. <br>  Me encontr√© con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">kit de</a> distribuci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">KDE neon</a> 5.16 y me sorprendi√≥ mucho ver que la llamada lookup_bdev en esta versi√≥n del kernel cambi√≥ la lista de par√°metros de entrada. <br><br>  Para reunirnos, tuvimos que agregar un script en el archivo MAKE que verifica si la funci√≥n lookup_bdev tiene un par√°metro de m√°scara. <br><br><h2>  Firma de los m√≥dulos del kernel </h2><br>  Pero volvamos al tema de la distribuci√≥n de paquetes. <br><br>  Una de las ventajas de kABI estable es que los m√≥dulos del n√∫cleo se pueden firmar como un archivo binario.  En este caso, el desarrollador puede estar seguro de que el m√≥dulo no fue da√±ado accidentalmente o cambiado intencionalmente.  Puede verificar esto con el comando modinfo. <br><br>  Las distribuciones de Red Hat y SUSE le permiten verificar la firma de un m√≥dulo y descargarlo solo si el certificado apropiado est√° registrado en el sistema.  El certificado es la clave p√∫blica mediante la cual se firma el m√≥dulo.  Lo distribuimos como un paquete separado. <br><br>  El problema aqu√≠ es que los certificados pueden integrarse en el n√∫cleo (los usan los distribuidores) o deben escribirse en la memoria EFI no vol√°til utilizando la utilidad <i>mokutil</i> .  Al instalar el certificado, la utilidad <i>mokutil</i> requiere un reinicio del sistema e incluso antes de cargar el n√∫cleo del sistema operativo, ofrece al administrador que permita la descarga del nuevo certificado. <br><br>  Por lo tanto, agregar un certificado requiere acceso f√≠sico del administrador al sistema.  Si la m√°quina se encuentra en alg√∫n lugar de la nube o solo en una sala de servidores remota y el acceso es solo a trav√©s de la red (por ejemplo, a trav√©s de ssh), ser√° imposible agregar un certificado. <br><br><h2>  EFI en m√°quinas virtuales </h2><br>  A pesar del hecho de que EFI ha sido respaldado por casi todos los creadores de la placa base, al instalar el sistema, el administrador puede no pensar en la necesidad de EFI y puede deshabilitarse. <br><br>  No todos los hipervisores son compatibles con EFI.  VMWare vSphere admite EFI desde la versi√≥n 5. <br>  Microsoft Hyper-V tambi√©n recibi√≥ soporte EFI, comenzando con Hyper-V para Windows Server 2012R2. <br><br>  Sin embargo, en la configuraci√≥n predeterminada, esta funcionalidad est√° deshabilitada para m√°quinas Linux, lo que significa que el certificado no se puede instalar. <br><br>  En vSphere 6.5, puede configurar la opci√≥n de <b>Arranque seguro</b> solo en la versi√≥n anterior de la interfaz web que funciona a trav√©s de Flash.  La interfaz de usuario web en HTML-5 est√° muy por detr√°s. <br><br><h2>  Distribuciones Experimentales </h2><br>  Y finalmente, considere el tema de las distribuciones experimentales y las distribuciones sin apoyo oficial.  Por un lado, es improbable que tales distribuciones se encuentren en los servidores de organizaciones serias.  No hay soporte oficial para tales distribuciones.  Por lo tanto, para proporcionar esos.  No es posible el soporte del producto en dicha distribuci√≥n. <br><br>  Sin embargo, tales distribuciones se convierten en una plataforma conveniente para probar nuevas soluciones experimentales.  Por ejemplo, Fedora, OpenSUSE Tumbleweed o la versi√≥n inestable de Debian.  Son bastante estables.  Siempre tienen nuevas versiones de programas y siempre un nuevo n√∫cleo.  Despu√©s de un a√±o, esta funcionalidad experimental puede estar en RHEL, SLES o Ubuntu actualizados. <br><br>  Entonces, si algo no funciona en el kit de distribuci√≥n experimental, esta es una ocasi√≥n para resolver el problema y resolverlo.  Debe estar preparado para el hecho de que esta funcionalidad pronto aparecer√° en los servidores de producci√≥n de los usuarios. <br><br>  La lista actual de distribuciones oficialmente compatibles para la versi√≥n 3.0 se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Pero la lista real de distribuciones en las que nuestro producto puede trabajar es mucho m√°s amplia. <br><br>  Personalmente, estaba interesado en un experimento con el sistema operativo Elbrus.  Despu√©s de actualizar el paquete veeam, nuestro producto fue instalado y ganado.  Sobre este experimento, escrib√≠ sobre Habr√© en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> . <br><br>  Bueno, el soporte para nuevas distribuciones contin√∫a.  Estamos esperando el lanzamiento de la versi√≥n 4.0.  Beta est√° a punto de aparecer, ¬°as√≠ que estad atentos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lo que hay de nuevo</a> ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/471226/">https://habr.com/ru/post/471226/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../471210/index.html">Dios ... Balada sobre un programador</a></li>
<li><a href="../471212/index.html">10 consejos y trucos para ayudarte a convertirte en el mejor desarrollador de VueJS</a></li>
<li><a href="../471216/index.html">La larga historia de la gu√≠a: c√≥mo escrib√≠ un servicio para rutas de senderismo inteligentes durante 5 a√±os</a></li>
<li><a href="../471220/index.html">Cockpit: simplifique las tareas administrativas t√≠picas en Linux a trav√©s de una interfaz web conveniente</a></li>
<li><a href="../471222/index.html">Comprender las pol√≠ticas de privacidad de aplicaciones y servicios ayudar√° a las redes neuronales</a></li>
<li><a href="../471228/index.html">Grokay PyTorch</a></li>
<li><a href="../471232/index.html">Mi experiencia conectando LPS331AP a Omega Onion2</a></li>
<li><a href="../471236/index.html">Dos√≠metro para Seryozha. Parte III Radi√≥metro nacional</a></li>
<li><a href="../471240/index.html">"Bitchy Betty" e interfaces de audio modernas: ¬øpor qu√© hablan con voz femenina?</a></li>
<li><a href="../471242/index.html">Introducci√≥n a Bash Shell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>