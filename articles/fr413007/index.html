<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😟 👩‍👦 🤸🏽 Étrange synthèse en travaillant avec FPGA 🙋🏽 🈺 😖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, il existe deux des langages de description matérielle les plus courants: Verilog / SystemVerilog et VHDL. Les langages de description du ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Étrange synthèse en travaillant avec FPGA</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413007/"> Aujourd'hui, il existe deux des langages de description matérielle les plus courants: Verilog / SystemVerilog et VHDL.  Les langages de description du matériel eux-mêmes sont des moyens assez universels, mais est-ce toujours le cas?  Et de quoi peut dépendre «pas l'universalité» du langage de description matérielle? <br><br>  L'idée d'écrire cet article est née lors de la synthèse d'un projet dans différents environnements de développement, à la suite de quoi différents résultats ont été obtenus.  Comme le module source est assez volumineux, un module de test plus petit a été écrit pour démontrer les résultats, mais dont la synthèse a provoqué les mêmes avertissements / erreurs.  Un registre 4 bits avec réinitialisation asynchrone a été utilisé comme module de test, et Libero SoC 18.1, Quartus Prime 17.1, Vivado 2017.4.1 ont été choisis comme environnements de développement. <br><a name="habracut"></a><br>  Tout d'abord, une variante de description d'un tel module en langage Verilog est présentée, dont le texte est correctement perçu par les environnements de développement sélectionnés: <br><br><pre><code class="hljs vhdl">module test1 ( input clk, input arst, input [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data, output reg [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] q ); always @( posedge clk <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> negedge arst ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ~ arst ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> q &lt;= <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h0</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> q &lt;= data ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endmodule</code> </pre> <br>  À la suite de la synthèse de ce module, les schémas suivants ont été obtenus: <br><br><ol><li>  Libero SoC v11.8 <br><br><div class="spoiler">  <b class="spoiler_title">test1 Libero SoC</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/su/2c/op/su2copn_99lk4jwffmboxidue-4.jpeg"><br></div></div></li><li>  Quartus Prime 17.1 <br><br><div class="spoiler">  <b class="spoiler_title">test1 quartus prime</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5c/iv/ld/5civldrmgkw5gsrcsqvkwrsttxy.jpeg"><br></div></div></li><li>  Vivado 2017.4.1 <br><br><div class="spoiler">  <b class="spoiler_title">test1 vivado</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ju/dv/nr/judvnrm0awltnilsy-v6ik9sd78.jpeg"><br></div></div></li></ol><br>  Dans tous les circuits synthétisés pour test1, les déclencheurs D ont été utilisés soit avec une entrée de réinitialisation inverse (Quartus Prime) soit avec l'ajout d'un onduleur (VERIFIC_INV dans le cas de Libero SoC et LUT1 dans le cas de Vivado). <br><br>  Le circuit synthétisé sera-t-il différent si la vérification d'état de la réinitialisation asynchrone est modifiée?  Pour ce faire, remplacez le texte du module test1 par la description du module test2: <br><br><pre> <code class="hljs pgsql">module test2 ( <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> clk, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> arst, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data, output reg [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] q ); <span class="hljs-keyword"><span class="hljs-keyword">always</span></span> @(posedge clk <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> negedge arst) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arst) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> q&lt;=data; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> q&lt;=<span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-string"><span class="hljs-string">'h0; end end endmodule</span></span></code> </pre> <br>  On peut supposer que la synthèse du module test2 ne doit pas différer de la synthèse du module test1, car les logiques de description des deux modules ne se contredisent pas.  Cependant, la synthèse du module test2 a conduit aux résultats suivants: <br><br><ol><li>  Libero SoC v11.8 <br>  Le circuit a été synthétisé, mais le message d'avertissement suivant «Incompatibilité de bord et de condition (CG136)» est apparu dans les messages.  Cet avertissement indique une incompatibilité de la liste de sensibilité et une vérification de la condition de réinitialisation.  Cependant, le circuit synthétisé n'est pas différent du module test1. <br><br><div class="spoiler">  <b class="spoiler_title">test2 Libero SoC</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/f1/fr/qf/f1frqfolhxmrhqm-s8dh823_iwq.jpeg"><br></div></div></li><li>  Quartus Prime 17.1 <br><br>  La synthèse du circuit a échoué avec l'erreur: <br><br>  "Erreur (10200): erreur de l'instruction conditionnelle Verilog HDL à test2.v (10): ne peut pas faire correspondre les opérandes de la condition aux bords correspondants dans le contrôle d'événement englobant de la construction Always."  Le texte d'erreur est similaire à l'avertissement émis par Libero SoC. </li><li>  Vivado 2017.4.1 <br><br>  La synthèse du circuit a été réalisée avec l'avertissement: <br><br>  "[Synth 8-5788] Le registre q_reg dans le test de module est à la fois défini et réinitialisé avec la même priorité.  Cela peut entraîner des décalages de simulation.  Envisagez de réécrire le code ["/home/vlasovdv0111/project_1/project_1.srcs/sources_1/new/test2.v":10]."  Semblable à Libero SoC et Quartus Prime, un avertissement similaire a été émis.  En outre, l'avertissement indiquait la possible divergence entre les résultats de la modélisation et le travail dans le matériel, à la suite de quoi il a été proposé de réécrire le code du module. <br><br><div class="spoiler">  <b class="spoiler_title">test2 vivado</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8e/jz/8d/8ejz8dgqvtkpzwo9jf28xv2kd3a.jpeg"><br></div></div></li></ol><br>  Après avoir décrit les modules test1 et test2, l'idée est venue de vérifier ce qui se passerait si nous synthétisions le code suivant: <br><br><pre> <code class="hljs vhdl">module test3 ( input clk, input arst, input [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data, output reg [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] q ); always @(posedge clk <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> negedge arst) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arst) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> q&lt;=<span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> q&lt;=data; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endmodule</code> </pre> <br>  La description d'un tel registre n'est pas logique, car la réinitialisation des déclencheurs se produit dans ce cas lorsque la ligne de réinitialisation est inactive. <br><br>  Les résultats de la synthèse sont les suivants: <br><br><ol><li>  Libero SoC v11.8 <br><br>  La synthèse du circuit n'a pas été effectuée avec l'erreur: «La logique pour q [3: 0] ne correspond pas à une bascule standard (CL123)», refusant ainsi de synthétiser le circuit, citant l'absence du type de déclencheurs nécessaires à la synthèse. </li><li>  Quartus Prime 17.1 <br><br>  Le circuit n'a pas été synthétisé avec l'erreur suivante: «Erreur (10200): erreur de déclaration conditionnelle Verilog HDL à test3.v (9): ne peut pas faire correspondre les opérandes dans la condition aux bords correspondants dans le contrôle d'événement englobant de la construction Always» .  Le texte de cette erreur ne diffère pas du texte d'erreur du module test2. </li><li>  Vivado 2017.4.1 <br><br>  Le schéma a été synthétisé sans erreur: <br><br><div class="spoiler">  <b class="spoiler_title">test3 vivado</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dk/gx/we/dkgxwe8f5hw109zv99an5h0wrha.jpeg"><br></div></div></li></ol><br>  Cependant, que se passera-t-il si nous décrivons un module dans lequel la liste de sensibilité ne contredit pas la vérification de la condition de réinitialisation, mais les déclencheurs sont réinitialisés lorsque la ligne de réinitialisation est inactive, comme dans le cas de la description du module test3.  La description d'un tel module test4 est la suivante: <br><br><pre> <code class="hljs pgsql">module test4 ( <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> clk, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> arst, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data, output reg [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] q ); <span class="hljs-keyword"><span class="hljs-keyword">always</span></span> @( posedge clk <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> negedge arst ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ~ arst ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> q &lt;= data ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> q &lt;= <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-string"><span class="hljs-string">'h0 ; end end endmodule</span></span></code> </pre> <br>  Au cours de la synthèse, les résultats suivants ont été obtenus: <br><br><ol><li>  Libero SoC v11.8 <br><br>  La synthèse du circuit a été réalisée avec l'avertissement: <br><br>  «Signal trouvé identifié comme horloge système qui contrôle 4 éléments séquentiels, y compris q_1 [3].  L'utilisation de cette horloge, qui n'a pas de contrainte de temps spécifiée, peut nuire aux performances de conception.  (MT532). " <br><br><div class="spoiler">  <b class="spoiler_title">test4 Libero SoC</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ms/el/em/mselemdf578vem0b_ayoxoes5oa.jpeg"><br></div></div></li><li>  Quartus Prime 17.1 <br><br>  À la suite de la synthèse du circuit, des avertissements ont été reçus: <br><br> <code>«Warning (13004): Presettable and clearable registers converted to equivalent circuits with latches. Registers power-up to an undefined state, and DEVCLRn places the registers in an undefined state. <br> Warning (13310): Register "q[0]~reg0" is converted into an equivalent circuit using register "q[0]~reg0_emulated" and latch "q[0]~1" <br> Warning (13310): Register "q[1]~reg0" is converted into an equivalent circuit using register "q[1]~reg0_emulated" and latch "q[1]~1" <br> Warning (13310): Register "q[2]~reg0" is converted into an equivalent circuit using register "q[2]~reg0_emulated" and latch "q[2]~1" <br> Warning (13310): Register "q[3]~reg0" is converted into an equivalent circuit using register "q[3]~reg0_emulated" and latch "q[3]~1"» <br></code> <br>  Tous les avertissements décrits ci-dessus correspondent au fait que des verrous ont été utilisés à la place des déclencheurs. <br><br><div class="spoiler">  <b class="spoiler_title">test4 quartus prime</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/4i/yz/_s/4iyz_sacasaemyg-hoykw5-cov8.jpeg"><br></div></div></li><li>  Vivado 2017.4.1 <br><br>  Le circuit a été synthétisé avec un avertissement: <br><br>  "[Synth 8-5788] Le registre q_reg dans le test de module est à la fois défini et réinitialisé avec la même priorité.  Cela peut entraîner des décalages de simulation.  Envisagez de réécrire le code ["/home/vlasovdv0111/project_1/project_1.srcs/sources_1/new/test.v":11]."  Le texte de cette erreur répète le texte d'erreur du module test2. <br><br><div class="spoiler">  <b class="spoiler_title">test4 vivado</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/f5/x4/xq/f5x4xqfb1ycj6g_gbxakx_wrf8s.jpeg"><br></div></div></li></ol><br>  De toutes les expériences décrites, les conclusions suivantes peuvent être tirées: <br><br><ol><li>  Le langage Verilog est un langage de description matérielle universel, dont les limites sont les capacités des environnements de développement eux-mêmes; </li><li>  pour la description correcte de l'équipement, il est nécessaire de connaître la syntaxe du langage, ainsi que d'analyser les listes d'avertissements et d'erreurs qui se produisent à chaque étape de la construction du projet. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413007/">https://habr.com/ru/post/fr413007/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr412997/index.html">Cache-cache, ou le premier botnet qui n'a pas peur de redémarrer</a></li>
<li><a href="../fr412999/index.html">Du bourdonnement des girafes aux sons d'oiseaux mimétiques - écouter la nature ensemble</a></li>
<li><a href="../fr413001/index.html">SamsPcbGuide, Part 5: Tracing Signal Lines. Distorsion de ligne et adaptation d'impédance</a></li>
<li><a href="../fr413003/index.html">Le client Steam a éliminé une vulnérabilité dangereuse qui s'y cachait depuis dix ans</a></li>
<li><a href="../fr413005/index.html">Blockchain - un remède contre les principales maladies de l'éducation moderne</a></li>
<li><a href="../fr413009/index.html">Gestion de l'environnement Python avec Pipenv</a></li>
<li><a href="../fr413011/index.html">Sous-sol de la mort</a></li>
<li><a href="../fr413013/index.html">Le désir de transparence</a></li>
<li><a href="../fr413015/index.html">Comment nous sommes analysés dans les cinémas ... et pas seulement</a></li>
<li><a href="../fr413017/index.html">Une petite note sur les certificats génériques Let's Encrypt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>