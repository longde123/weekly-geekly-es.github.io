<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçö üëõ üöï Virtuelle Maschine auf dem ESP8266 zum Ausf√ºhren von Spielen üë∂üèΩ üòó üë®üèø‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="VM geschrieben von einer unsicheren Hand der Geisteswissenschaften in der Arduino-Programmierumgebung unter Verwendung von Quickcode und Fahrr√§dern. A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Virtuelle Maschine auf dem ESP8266 zum Ausf√ºhren von Spielen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459714/"> VM geschrieben von einer unsicheren Hand der Geisteswissenschaften in der Arduino-Programmierumgebung unter Verwendung von Quickcode und Fahrr√§dern.  Au√üerdem gibt es daf√ºr einen Compiler aus einer C-√§hnlichen Sprache, der mit denselben Methoden in JavaScript geschrieben wurde.  Ja  Sie k√∂nnen bereits in Kommentare st√ºrzen, Steine ‚Äã‚Äãwerfen.  Nun, f√ºr diejenigen, die noch interessiert sind, lade ich Sie ein, weiterzulesen. <br><br><img src="https://habrastorage.org/webt/id/lf/6y/idlf6yqnyzplrex2cq3waeu0txc.png" alt="Laibwagen"><br><a name="habracut"></a><br>  Im Allgemeinen wurde meine Arbeit hier bereits ein wenig von der angesehenen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Tormozedison</a> abgedeckt.  Zu dieser Zeit befand sich jedoch eher ein kugelf√∂rmiger Prototyp im luftleeren Raum.  Und jetzt habe ich ein RomanS-Ger√§t, das er mir freundlicherweise f√ºr kostenlose Experimente zur Verf√ºgung gestellt hat.  Dieses Ger√§t hei√üt ESPboy.  Es unterscheidet sich von anderen Handwerken durch seine Kompaktheit und den Erweiterungssteckplatz mit dem MCP23017-Chip.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier k√∂nnen</a> Sie mehr √ºber ihn erfahren. <br><br>  Wenn jemand interessiert ist, wie kam mir eine so seltsame Idee als virtuelle Maschine auf einem Mikrocontroller in den Sinn, dann k√∂nnen Sie sie unter dem Spoiler lesen. <br><br><div class="spoiler">  <b class="spoiler_title">Hintergrund</b> <div class="spoiler_text">  Einmal in der Schule, wurde ich von einem Spielmacher aus Yoyogames mitgerissen, und wie viele, die darauf genietet waren, verstehe ich nicht, was.  Diese schief geschriebenen und schlecht gezeichneten Demos konnten sich immer noch Freunden r√ºhmen, aber im Internet ertranken sie unter √§hnlichen.  Mir wurde klar, wie schwer es war, selbst ein einfaches Spiel zu schreiben, ganz zu schweigen von einem ernsthaften, in dem man die K√ºhe ausrauben konnte.  Aber der Wunsch, Spiele zu schreiben, ging nicht verloren.  Als ich ein Handy bekam, entdeckte ich Midlet Pascal und hatte mehrere Jahre Spa√ü damit.  Immerhin wurde mir klar, dass das Schreiben eines Spiels f√ºr ein schwaches Ger√§t einfacher ist als f√ºr seinen m√§chtigeren gro√üen Bruder.  Zumindest konnte man immer nicht von krummen H√§nden sprechen, sondern von den eingeschr√§nkten M√∂glichkeiten der Plattform.  Die Button-Spieler machten den Sensoren jedoch Platz. Eine weitere Chance, die Welt zu erobern, wurde verpasst.  Trotzdem wurde mir irgendwann klar, dass ich meine Tr√§ume mit einem Mikrocontroller wiederbeleben konnte. <br><br>  Ich begann damit, ein Spiel unter arduino uno zu schreiben, wohin w√ºrdest du ohne es gehen.  Dann war sie meine einzige und ich war sehr besorgt √ºber ihre Leistung.  Ich habe versucht, so wenig wie m√∂glich zu blinken.  Aber der Weg des Rechens geht in kleinen Schritten.  Bei jeder kleinen √Ñnderung des Codes blinkte er immer wieder.  Und ich habe beschlossen, eine gestapelte virtuelle Maschine zu schreiben.  Immerhin sind zwei Kilobyte RAM f√ºr Code- und Datenbytes an Bord.  Aber wie langsam es war, aber aus irgendeinem Grund fehlte st√§ndig das Ged√§chtnis.  Wahrscheinlich ist der springende Punkt, dass alle meine Motorr√§der mit Vierkantr√§dern waren und langsam fuhren.  Dann habe ich beschlossen, einen Chip-8-Emulator auf Arduino Mega zu schreiben, der gerade aus China gekommen ist.  Nat√ºrlich wollte ich dann einen Gameboy-Emulator f√ºr sie schreiben, die erste Playstation und einen Supercomputer einfacher.  Infolgedessen verstand ich die Hauptsache.  Die virtuelle Chip-8-Maschine war sehr einfach, zu einfach.  So sehr, dass Sie beim Schreiben Ihrer Spiele zur Multiplikation oder Division eine separate langsame Unterroutine schreiben mussten.  Sie m√ºssen also Ihre VM schreiben, um einen schwerwiegenden Fehler zu beseitigen.  Zu diesem Zeitpunkt kamen mehrere weitere esp8266 mit einem Speicherplatz von 160 MHz an. <br></div></div><br>  Wenn es Ihnen so vorkommt, als w√§re eine virtuelle Maschine eine Verschwendung von Ressourcen, habe ich auch meinen Chip-8-Emulator daf√ºr umgeschrieben.  Es stellte sich heraus, dass es sich um eine virtuelle Maschine in einer virtuellen Maschine auf einem Mikrocontroller handelte.  Sie k√∂nnen wahrscheinlich noch weiter gehen und eine Turing-Maschine auf Chip-8 schreiben. <br><br><h4>  Technische Daten der ESP Little Game Engine </h4><br>  Eine virtuelle Maschine enth√§lt 16 Register mit jeweils 16 Bit, ein Nullregister ist ein Stapelzeiger.  Jeder Befehl ist Doppelbyte, einige Befehle enthalten zwei Datenbytes.  Adressierbarer Speicher 64 KB.  Beim ESP8266 stehen 20 KB zur Verf√ºgung.  Das Programm kann von SPIFFS und UART heruntergeladen werden.  Falls gew√ºnscht, k√∂nnen Sie einen Download von einer Speicherkarte oder √ºber WLAN hinzuf√ºgen.  Zus√§tzlich zu den √ºblichen arithmetischen Anweisungen und Anweisungen zum Verschieben von Daten gibt es separate Anweisungen zum Arbeiten mit Sprites, Bildschirm und Sound.  Bildschirmgr√∂√üe 128 x 128 Pixel.  Bei 16 Farben pro Punkt belegt der Bildschirm 8 KB Speicher, die gleiche Puffermenge zum Zeichnen von Sprites und Partikeln.  Obwohl die von mir verwendete TFT_eSPI-Bibliothek den Bildschirm mehr als 60 Mal pro Sekunde aktualisieren kann, musste ich mich auf 20 Bilder pro Sekunde beschr√§nken.  Andernfalls war nicht gen√ºgend Prozessorzeit f√ºr die virtuelle Maschine vorhanden.  Sie k√∂nnen Kacheln und 32 Sprites mit einer Gr√∂√üe von bis zu 128 x 128 Pixel mit der M√∂glichkeit der Drehung und Spiegelung zeichnen.  Um Speicherplatz zu sparen, k√∂nnen Sie Einzelbitbilder oder RLE-Komprimierung verwenden.  Es gibt eine vereinfachte Physik: Erkennung von Kollisionen von Sprites mit Sprites und Kacheln, Kollisionsaufl√∂sung, Schwerkraft.  Der Bildschirm wird nur zeilenweise aktualisiert, wenn eine Zeile die Pixel ge√§ndert hat.  Die VM-Geschwindigkeit variiert je nach Anzahl der im Frame gezeichneten Linien zwischen 100.000 und 900.000 Vorg√§ngen pro Sekunde.  Sie k√∂nnen verschiedene Farbbildschirme verwenden, das Bild wird sanft auf die gew√ºnschten Proportionen gedehnt. <br><br><img src="https://habrastorage.org/webt/jf/ai/mv/jfaimvgh6rbtnum5u-lpdsslpws.png"><br>  <i>Einige der von mir geschriebenen Spiele k√∂nnen hier angesehen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden</a> .</i> <br><br>  Zur gleichen Zeit wie VM f√ºr ESP8266 habe ich einen JavaScript-Emulator f√ºr den Browser geschrieben.  Um den Bytecode nicht manuell zu bearbeiten, wurde ein einfacher Assembler hinzugef√ºgt, basierend auf meinen Erfahrungen mit dem Assembler f√ºr den MOS6502.  Dann habe ich beschlossen, eine h√∂here Sprache hinzuzuf√ºgen.  Trotzdem bestand meine Hauptaufgabe darin, schnell einfache Spiele zu schreiben und keinen langen Debug-Assembler-Code.  Es schien mir, dass das Schreiben Ihres Compilers einfacher w√§re als das Hinzuf√ºgen von LLVM.  Und ich habe es in JavaScript geschrieben, weil ich es nicht so schlecht kenne wie andere Sprachen.  Im Moment ist er weit davon entfernt, C-Standards zu unterst√ºtzen, und beim Kompilieren kann es leicht zu einem unverst√§ndlichen Fehler an einem unverst√§ndlichen Ort kommen.  Aber es ist schnell, weil es weniger als 2000 Zeilen dauert. <br><br>  Und nun zur Frage, warum ich das alles hier geschrieben habe.  Bereits jetzt k√∂nnen Sie Spiele schreiben und ausf√ºhren.  Perfektion ist jedoch noch weit entfernt.  Wenn mir jemand helfen m√∂chte, das ESP LGE fertigzustellen oder mein eigenes Spiel zu schreiben, bin ich sehr gl√ºcklich.  Wenn Sie meine Idee f√ºr interessant hielten und mehr wissen m√∂chten, beantworte ich gerne Ihre Fragen.  Ich warne Sie, der Code f√ºr Arduino ist ziemlich schwer zu lesen.  Zum Teil, weil ich Autodidakt bin.  Teilweise aufgrund der Tatsache, dass ich versucht habe, die Anzahl der Funktionsaufrufe zu reduzieren, um die Arbeitsgeschwindigkeit zu erh√∂hen.  Infolgedessen enthalten viele Funktionen gro√üe Codeschritte.  Lassen Sie schwangere Frauen und Kinder nicht auf den Bildschirm.  Allm√§hlich werde ich versuchen, dies zu beheben und die Lesbarkeit zu verbessern. <br><br>  Und f√ºr diejenigen, die gelesen haben, ein Beispiel f√ºr ein Spiel.  Es dauert weniger als hundert Zeilen und weniger als 1 KB in kompilierter Form. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stickCount; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> key,previouseKey,takenSticks; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-comment"><span class="hljs-comment">//   setcolor(2); //   for(i = 0; i &lt; stickCount; i++) line(22 + i * 6, 74, 22 + i * 6, 84); //   setcolor(11); //  for(i = stickCount; i &lt; 15; i++) line(22 + i * 6, 74, 22 + i * 6, 84); //     setcolor(1); //   delayredraw(); } void playersMove(){ //    ,     .  while(key == previouseKey){ key = getkey(); } while(key != KEY_LEFT &amp;&amp; key != KEY_DOWN &amp;&amp; key != KEY_RIGHT){ key = getkey(); } if(key &amp; KEY_LEFT){ takenSticks = 1; }else if(key &amp; KEY_DOWN){ takenSticks = 2; }else{ takenSticks = 3; } printf("%d, ", takenSticks); stickCount -= takenSticks; previouseKey = key; } void computersMove(){ if(stickCount % 4){ //   ,    takenSticks = stickCount % 4; }else{ //      takenSticks = 1 + random(1); } stickCount -= takenSticks; printf("%d, ", takenSticks); } void game(){ // stickCount = 15; clearscreen(); //       gotoxy(8,0); puts(""); gotoxy(2,1); puts(" 1,2  3 .  ,   . :\n"); // 27,25  26   printf(" %c 1 %c 2 %c 3", 27, 25, 26); gotoxy(0,12); redraw(); while(1){ playersMove(); if(stickCount &lt;= 0){ gotoxy(3,8); puts(" "); return; } redraw(); computersMove(); redraw(); if(stickCount &lt;= 0){ gotoxy(3,8); puts(" "); return; } } } void main(){ while(1){ game(); //  settimer(1,1000); while(gettimer(1)){} while(getkey() == 0){} previouseKey = key; } }</span></span></code> </pre> <br>  Sie k√∂nnen es sofort <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">testen</a> .  Folgen Sie dem Link, klicken Sie auf Kompilieren und dann auf Ausf√ºhren.  Wenn Sie mehr √ºber die M√∂glichkeiten der IDE erfahren m√∂chten, k√∂nnen Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tutorial</a> lesen.  Vielen Dank f√ºr Ihre Aufmerksamkeit. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de459714/">https://habr.com/ru/post/de459714/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de459704/index.html">LLVM IR und Go</a></li>
<li><a href="../de459706/index.html">5 Gr√ºnde, warum Sie Redux in React-Anwendungen vergessen sollten</a></li>
<li><a href="../de459708/index.html">Design der Spieloberfl√§che. Brent Fox Worum geht es in dem Buch?</a></li>
<li><a href="../de459710/index.html">√úberlebe eine Frontalkollision und warum Amnesie nicht das ist, was du denkst</a></li>
<li><a href="../de459712/index.html">Mama Hacker bei einem offiziellen Job: Was Pentester tun</a></li>
<li><a href="../de459716/index.html">Einige Aspekte der Optimierung von LINQ-Abfragen in C # .NET f√ºr MS SQL Server</a></li>
<li><a href="../de459718/index.html">10 Tipps zum √úberarbeiten von Code, den Sie nicht m√∂gen</a></li>
<li><a href="../de459722/index.html">Was haben Teamentwicklung und Bergsteigen gemeinsam?</a></li>
<li><a href="../de459726/index.html">7 Teile, die Sie bei der Er√∂ffnung eines Robotikclubs definitiv nicht ben√∂tigen. Hier ist keine Notwendigkeit zu tun</a></li>
<li><a href="../de459728/index.html">Smartphone mit der Brise: ZTE Red Magic 3 Bewertung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>