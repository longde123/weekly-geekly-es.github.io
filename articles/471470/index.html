<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèø üßú üë®üèø‚Äçüöí Cifrado de acuerdo con GOST: memorando sobre la configuraci√≥n del enrutamiento din√°mico del tr√°fico üñáÔ∏è üö´ üë≥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si su empresa transmite o recibe a trav√©s de la red datos personales y otra informaci√≥n confidencial para protegerla de conformidad con la ley, es nec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cifrado de acuerdo con GOST: memorando sobre la configuraci√≥n del enrutamiento din√°mico del tr√°fico</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/471470/"><img src="https://habrastorage.org/webt/v-/53/qf/v-53qfuqlx4ywc8cf8xfp2wlgt8.jpeg"><br>  Si su empresa transmite o recibe a trav√©s de la red datos personales y otra informaci√≥n confidencial para protegerla de conformidad con la ley, es necesario que utilice el cifrado de acuerdo con GOST.  Hoy le diremos c√≥mo implementamos dicho cifrado basado en la puerta de enlace criptogr√°fica S-Terra (KS) en uno de los clientes.  Esta historia ser√° interesante para los especialistas en seguridad de la informaci√≥n, as√≠ como para ingenieros, dise√±adores y arquitectos.  No profundizaremos en los matices de la configuraci√≥n t√©cnica en esta publicaci√≥n, nos detendremos en los puntos clave de la configuraci√≥n b√°sica.  Una gran cantidad de documentaci√≥n sobre la configuraci√≥n de demonios del sistema operativo Linux, en la que se basa el S-Terra KS, est√° disponible gratuitamente en Internet.  La documentaci√≥n de configuraci√≥n del software propietario de S-Terra tambi√©n est√° disponible p√∫blicamente en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el portal</a> del fabricante. <br><a name="habracut"></a><br><h2>  Algunas palabras sobre el proyecto. </h2><br>  La topolog√≠a de red del cliente era t√≠pica: malla completa entre el centro y las sucursales.  Se requiri√≥ introducir encriptaci√≥n de canales de intercambio de informaci√≥n entre todos los sitios, de los cuales hab√≠a 8 piezas. <br><br>  Por lo general, en tales proyectos, todo es est√°tico: en las puertas de enlace criptogr√°ficas (KS), las rutas est√°ticas se establecen en la red de √°rea local del sitio, se escriben listas de direcciones IP (ACL) para el cifrado.  Sin embargo, en este caso, los sitios no tienen una administraci√≥n centralizada, y cualquier cosa puede suceder dentro de sus redes locales: las redes se pueden agregar, eliminar y modificar en todos los sentidos.  Para evitar la reconfiguraci√≥n del enrutamiento y las ACL al KS al cambiar el direccionamiento de las redes locales en los sitios, se decidi√≥ utilizar el t√∫nel GRE y el enrutamiento din√°mico OSPF, que incluye todos los KS y la mayor√≠a de los enrutadores del nivel central de la red en los sitios (en algunos sitios, los administradores de infraestructura prefirieron use SNAT en la direcci√≥n de KS en los enrutadores del n√∫cleo). <br><br>  El t√∫nel GRE resolvi√≥ dos problemas: <br>  <b>1.</b> Utilice en la ACL para cifrar la direcci√≥n IP de la interfaz externa de KS, en la que se encapsula todo el tr√°fico enviado a otros sitios. <br>  <b>2.</b> Organice t√∫neles ptp entre KS, que le permiten configurar el enrutamiento din√°mico (en nuestro caso, el proveedor MPLS L3VPN est√° organizado entre los sitios). <br><br>  El cliente orden√≥ la implementaci√≥n de cifrado como servicio.  De lo contrario, no solo tendr√≠a que admitir las puertas de enlace de cifrado o externalizar alguna organizaci√≥n, sino tambi√©n supervisar de forma independiente el ciclo de vida de los certificados de cifrado, renovarlos a tiempo e instalar otros nuevos. <br><img src="https://habrastorage.org/webt/ho/lc/ch/holcch4mtnk2skxc5_atydslidu.jpeg"><br>  Y ahora el memor√°ndum mismo: c√≥mo y qu√© configuramos <br><br><h2>  Nota de asunto de KII: configuramos una puerta de enlace criptogr√°fica </h2><br><h3>  Configuraci√≥n b√°sica de red </h3><br>  En primer lugar, lanzamos un nuevo cach√© y entramos en la consola de administraci√≥n.  Deber√≠a comenzar cambiando la contrase√±a del administrador incorporado: el comando de <b>administrador de cambio de contrase√±a de usuario</b> .  Entonces es necesario llevar a cabo el procedimiento de inicializaci√≥n (el comando de <b>inicializaci√≥n</b> ) en el proceso en el que se ingresan los datos de la licencia y se inicializa el sensor de n√∫mero aleatorio (DSN). <br><br>  <b><u>¬°Presta atenci√≥n!</u></b>  Cuando se inicializa S-Terra KS, se establece una pol√≠tica de seguridad en la que las interfaces de Security Gateway no pasan paquetes.  Debe crear su propia pol√≠tica o utilizar el <b>comando de ejecuci√≥n csconf_mgr enable</b> para activar una pol√≠tica de permisos predefinida. <br>  A continuaci√≥n, debe configurar el direccionamiento de las interfaces externas e internas, as√≠ como la ruta predeterminada.  Es preferible trabajar con la configuraci√≥n de red de la memoria cach√© y configurar el cifrado a trav√©s de la consola tipo Cisco.  Esta consola est√° dise√±ada para ingresar comandos similares a los comandos de Cisco IOS.  La configuraci√≥n creada usando la consola similar a Cisco, a su vez, se convierte en los archivos de configuraci√≥n correspondientes con los que trabajan los demonios del sistema operativo.  Puede ir a la consola similar a Cisco desde la consola de administraci√≥n con el comando <b>configure</b> . <br><br>  Cambie las contrase√±as para los cscons de usuario integrados y habilite: <br><br>  &gt; habilitar <br>  Contrase√±a: csp (predefinida) <br>  #configure terminal <br>  #username cscons privilege 15 secret 0 #enable secret 0 Configure la configuraci√≥n b√°sica de la red: <br><br>  #interface GigabitEthernet0 / 0 <br>  # direcci√≥n IP 10.111.21.3 255.255.255.0 <br>  #no apagado <br>  #interface GigabitEthernet0 / 1 <br>  #ip direcci√≥n 192.168.2.5 255.255.255.252 <br>  #no apagado <br>  #ip ruta 0.0.0.0 0.0.0.0 10.111.21.254 <br><br><h3>  GRE </h3><br>  Salimos de la consola similar a Cisco y vamos al shell de Debian con el comando del <b>sistema</b> .  Establezca su propia contrase√±a para el <b>usuario root</b> con el comando <b>passwd</b> . <br>  Se configura un t√∫nel separado para cada sitio en cada KSh.  La interfaz del t√∫nel se configura en el <b>archivo / etc / network / interfaces</b> .  La utilidad de t√∫nel IP, que forma parte del conjunto predefinido de iproute2, es responsable de crear la interfaz en s√≠.  El comando para crear una interfaz est√° escrito en la opci√≥n de preajuste. <br><br>  Ejemplo de configuraci√≥n de una interfaz de t√∫nel t√≠pica: <br>  auto site1 <br>  iface site1 inet static <br>  direcci√≥n 192.168.1.4 <br>  m√°scara de red 255.255.255.254 <br>  pre-up ip tunnel add site1 mode gre local 10.111.21.3 remoto 10.111.22.3 clave hfLYEg ^ vCh6p <br><br>  <b><u>¬°Presta atenci√≥n!</u></b>  Cabe se√±alar que la configuraci√≥n de la interfaz del t√∫nel debe ubicarse fuera de la secci√≥n <br><br>  ### netifcfg-begin ### <br>  ***** <br>  ### netifcfg-end ### <br><br>  De lo contrario, esta configuraci√≥n se borrar√° al cambiar la configuraci√≥n de red de las interfaces f√≠sicas a trav√©s de la consola tipo Cisco. <br><br><h3>  Enrutamiento din√°mico </h3><br>  En S-Terra, el enrutamiento din√°mico se implementa utilizando el paquete de software Quagga.  Para configurar OSPF, necesitamos habilitar y configurar los <b>demonios</b> <b>zebra</b> y <b>ospfd</b> .  El demonio cebra es responsable de la interacci√≥n entre los demonios de enrutamiento y el sistema operativo.  El demonio ospfd, como su nombre lo indica, es responsable de implementar el protocolo OSPF. <br>  OSPF se configura a trav√©s de la consola daemon o directamente a trav√©s del archivo de configuraci√≥n <b>/etc/quagga/ospfd.conf</b> .  Todas las interfaces f√≠sicas y de t√∫nel involucradas en el enrutamiento din√°mico se agregan al archivo, y se anuncian las redes que ser√°n anunciadas y recibir√°n anuncios. <br><br>  Un ejemplo de configuraci√≥n para agregar a <b>ospfd.conf</b> : <br>  interfaz eth0 <br>  ! <br>  interfaz eth1 <br>  ! <br>  sitio de interfaz1 <br>  ! <br>  interfaz sitio2 <br>  enrutador ospf <br>  ospf router-id 192.168.2.21 <br>  red 192.168.1.4/31 √°rea 0.0.0.0 <br>  red 192.168.1.16/31 √°rea 0.0.0.0 <br>  red 192.168.2.4/30 √°rea 0.0.0.0 <br><br>  En este caso, las direcciones 192.168.1.x / 31 est√°n reservadas para redes de t√∫nel ptp entre sitios, las direcciones 192.168.2.x / 30 se asignan para redes de tr√°nsito entre el CABG y los enrutadores centrales. <br><br>  <u><b>¬°Presta atenci√≥n!</b></u>  Para reducir la tabla de enrutamiento en grandes instalaciones, puede filtrar el anuncio de las propias redes de tr√°nsito utilizando las construcciones de <b>mapa de ruta</b> <b>no redistribuido conectado</b> o <b>redistribuido conectado</b> . <br><br>  Despu√©s de configurar los demonios, debe cambiar el estado de inicio del demonio en <b>/ etc / quagga / daemons</b> .  En las opciones <b>zebra</b> y <b>ospfd</b> no hay soluci√≥n para yes.  Ejecute el daemon quagga y configure su ejecuci√≥n autom√°tica al iniciar el cach√© con el comando <b>update-rc.d quagga enable</b> . <br><br>  Si los t√∫neles GRE y OSPF est√°n configurados correctamente, entonces las rutas a la red de otros sitios deben aparecer en los enrutadores KS y del kernel, y por lo tanto surge la conectividad de red entre redes locales. <br><br><h3>  Encriptamos el tr√°fico transmitido </h3><br>  Como ya se mencion√≥, cuando se encripta entre sitios, generalmente especificamos los rangos de direcciones IP (ACL) entre los cuales se encripta el tr√°fico: si las direcciones de origen y destino se encuentran dentro de estos rangos, entonces el tr√°fico entre ellos est√° encriptado.  Sin embargo, en este proyecto, la estructura es din√°mica y las direcciones pueden cambiar.  Como ya hemos configurado el t√∫nel GRE, podemos especificar direcciones KS externas como las direcciones de origen y destino para el cifrado de tr√°fico, porque para el cifrado viene el tr√°fico ya encapsulado por el protocolo GRE.  En otras palabras, todo lo que ingresa al cach√© desde la red local de un sitio a las redes anunciadas por otros sitios est√° encriptado.  Y ya dentro de cada uno de los sitios se puede realizar cualquier reenv√≠o.  Por lo tanto, con cualquier cambio en las redes locales, es suficiente que el administrador modifique los anuncios provenientes de su red hacia la escuela secundaria, y estar√° disponible para otros sitios. <br><br>  El cifrado en el S-Terra KS se realiza utilizando el protocolo IPSec.  Utilizamos el algoritmo Grasshopper de acuerdo con GOST R 34.12-2015, y para compatibilidad con versiones anteriores, se puede usar GOST 28147-89.  La autenticaci√≥n t√©cnicamente se puede realizar tanto en claves predefinidas (PSK) como en certificados.  Sin embargo, en la operaci√≥n industrial es necesario utilizar certificados emitidos de acuerdo con GOST R 34.10-2012. <br><br>  El trabajo con certificados, contenedores y CRL se realiza utilizando la utilidad <b>cert_mgr</b> .  En primer lugar, con el comando <b>cert_mgr create</b> , debe <b>crear</b> un contenedor de clave privada y una solicitud de certificado, que se enviar√° al Centro de administraci√≥n de certificados.  Despu√©s de recibir el certificado, debe importarse con el comando <b>cert_mgr import</b> junto con el certificado ra√≠z de la CA y la CRL (si se usa).  Puede <b>verificar</b> que todos los certificados y CRL est√©n instalados con el comando <b>cert_mgr show</b> . <br><br>  Despu√©s de instalar con √©xito los certificados, vaya a la consola similar a Cisco para configurar IPSec. <br>  Creamos una pol√≠tica IKE que especifica los algoritmos y par√°metros deseados del canal seguro creado, que se ofrecer√° al socio para su aprobaci√≥n. <br><br>  #crypto isakmp policy 1000 <br>  #encr gost341215k <br>  #hash gost341112-512-tc26 <br>  # signo de autenticaci√≥n <br>  #group vko2 <br>  #vida 3600 <br><br>  Esta pol√≠tica se aplica al construir la primera fase de IPSec.  La finalizaci√≥n exitosa de la primera fase es el establecimiento de SA (Asociaci√≥n de Seguridad). <br>  A continuaci√≥n, debemos definir una lista de direcciones IP de origen y destino (ACL) para el cifrado, formar un conjunto de transformaci√≥n, crear un mapa criptogr√°fico (mapa criptogr√°fico) y vincularlo a la interfaz externa del CAB. <br><br>  Establecer la ACL: <br>  #ip access-list extendi√≥ el sitio1 <br>  #permit gre host 10.111.21.3 host 10.111.22.3 <br><br>  Un conjunto de transformaciones (as√≠ como para la primera fase, usamos el algoritmo de encriptaci√≥n Grasshopper usando el modo de simulaci√≥n): <br><br>  #crypto ipsec transform-set GOST esp-gost341215k-mac <br><br>  Cree un mapa criptogr√°fico, especifique ACL, conjunto de transformaci√≥n y direcci√≥n de igual: <br><br>  #crypto map MAIN 100 ipsec-isakmp <br>  #match address site1 <br>  #set transform-set GOST <br>  #set peer 10.111.22.3 <br><br>  Adjuntamos el mapa criptogr√°fico a la interfaz externa de la CABG: <br><br>  #interface GigabitEthernet0 / 0 <br>  # direcci√≥n IP 10.111.21.3 255.255.255.0 <br>  #crypto map MAIN <br><br>  Para cifrar canales con otros sitios, debe repetir el procedimiento para crear ACL y tarjetas criptogr√°ficas, cambiando el nombre de la ACL, las direcciones IP y el n√∫mero de la tarjeta criptogr√°fica. <br><br>  <b><u>¬°Presta atenci√≥n!</u></b>  Si no se utiliza la verificaci√≥n del certificado CRL, esto debe especificarse expl√≠citamente: <br><br>  #crypto pki trustpoint s-terra_technological_trustpoint <br>  # revocation-check none <br><br>  En esta configuraci√≥n se puede considerar completa.  El resultado de los comandos de consola similares a los de Cisco <b>show crypto isakmp sa</b> y <b>show crypto ipsec sa</b> deber√≠a reflejar la primera y segunda fases construidas de IPSec.  La misma informaci√≥n se puede obtener utilizando el comando <b>sa_mgr show</b> ejecutado desde el shell debian.  La salida del comando <b>cert_mgr show debe mostrar</b> certificados de sitio remoto.  El estado de dichos certificados ser√° <b>remoto</b> .  En el caso de que no se construyan t√∫neles, debe buscar en el registro del servicio VPN, que se almacena en el archivo <b>/var/log/cspvpngate.log</b> .  Una lista completa de archivos de registro con una descripci√≥n de su contenido est√° disponible en la documentaci√≥n. <br><br><h2>  Monitorear la "salud" del sistema </h2><br>  S-Terra KS utiliza el demonio snmpd est√°ndar para el monitoreo.  Adem√°s de los par√°metros t√≠picos de Linux, S-Terra admite la salida de t√∫neles IPSec de acuerdo con CISCO-IPSEC-FLOW-MONITOR-MIB, que utilizamos para monitorear el estado de los t√∫neles IPSec.  La funcionalidad de los OID personalizados tambi√©n es compatible, dando los resultados del script como valores.  Esta caracter√≠stica nos permite rastrear las fechas de vencimiento de los certificados.  La secuencia de comandos escrita analiza la salida del comando <b>cert_mgr show</b> y, como resultado, proporciona el n√∫mero de d√≠as antes del vencimiento de los certificados locales y ra√≠z.  Esta t√©cnica es indispensable cuando se administra una gran cantidad de CABG. <br><img src="https://habrastorage.org/webt/ho/gl/py/hoglpynhcvdwk7o5x5hpvbtycuo.jpeg"><br><br><h2>  ¬øCu√°l es el cimus de tal cifrado? </h2><br>  Toda la funcionalidad descrita anteriormente es compatible con K-S-Terra "lista para usar".  Es decir, no fue necesario instalar ning√∫n m√≥dulo adicional que pudiera afectar la certificaci√≥n de las puertas de enlace criptogr√°ficas y la certificaci√≥n de todo el sistema de informaci√≥n.  Los canales entre sitios pueden ser cualquiera, incluso a trav√©s de Internet. <br><br>  Debido al hecho de que al cambiar la infraestructura interna no es necesario reconfigurar las puertas de enlace criptogr√°ficas, el <b>sistema funciona como un servicio</b> , lo cual es muy conveniente para el cliente: puede colocar sus servicios (cliente y servidor) en cualquier direcci√≥n, y todos los cambios se transfieren din√°micamente entre el equipo de cifrado. <br><br>  Por supuesto, el cifrado debido a la sobrecarga afecta la velocidad de transferencia de datos, pero no de manera significativa: el ancho de banda del canal puede disminuir en un m√°ximo del 5-10%.  Adem√°s, la tecnolog√≠a fue probada y mostr√≥ buenos resultados incluso en canales satelitales, que son bastante inestables y tienen poco ancho de banda. <br><br>  <i>Igor Vinokhodov, ingeniero de la segunda l√≠nea de administraci√≥n de Rostelecom Solar</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/471470/">https://habr.com/ru/post/471470/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../471452/index.html">La inteligencia artificial se conecta a la predicci√≥n de terremotos</a></li>
<li><a href="../471458/index.html">Regresi√≥n lineal y descenso de gradiente</a></li>
<li><a href="../471462/index.html">Escuela de desarrolladores de Java en Nizhny Novgorod</a></li>
<li><a href="../471464/index.html">Dise√±ador el√©ctrico en miniatura para ni√±os con sus propias manos.</a></li>
<li><a href="../471468/index.html">El problema de la clasificaci√≥n de hackers por peligro</a></li>
<li><a href="../471472/index.html">Semana de la seguridad 42: puertas traseras de hardware, vulnerabilidad en Intel NUC</a></li>
<li><a href="../471474/index.html">Life hack: escribe y aloja el sitio web con un libro de visitas en la nube de forma gratuita</a></li>
<li><a href="../471480/index.html">¬øC√≥mo crear equipos de productos efectivos?</a></li>
<li><a href="../471482/index.html">CLRium # 6: concurrencia y paralelismo. Dos d√≠as: del procesador a as√≠ncrono / espera</a></li>
<li><a href="../471484/index.html">Modelo de transferencias de f√∫tbol: cavando m√°s profundo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>