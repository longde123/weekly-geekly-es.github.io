<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📉 🛌🏿 🍂 YouTube在谈论什么 🛎️ ✔️ 🍼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在机器学习的曙光中，大多数解决方案看起来非常奇怪，孤立和不寻常。 如今，许多ML算法已经排在一个程序员熟悉的框架和工具箱中，您可以在不熟悉其实现细节的情况下使用它们。  顺便说一句，我反对这种肤浅的做法，但我想向我的同事们表明，这个行业正在飞跃发展，将其成就应用于生产项目并不复杂。 
 作为示例，我...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>YouTube在谈论什么</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433532/"><img src="https://habrastorage.org/getpro/habr/post_images/3d3/f22/f50/3d3f22f506897eb0d71e8ed23d424f74.jpg" alt="图片"><br><br> 在机器学习的曙光中，大多数解决方案看起来非常奇怪，孤立和不寻常。 如今，许多ML算法已经排在一个程序员熟悉的框架和工具箱中，您可以在不熟悉其实现细节的情况下使用它们。 <blockquote> 顺便说一句，我反对这种肤浅的做法，但我想向我的同事们表明，这个行业正在飞跃发展，将其成就应用于生产项目并不复杂。 </blockquote><br> 作为示例，我将展示如何在我们的工作流服务中帮助用户找到数百种正确的视频资料。 <br><br> 在我的项目中，用户创建并共享数百种不同的材料：各种格式的文本，图片，视频，文章，文档。 <br><br> 搜索文档似乎很简单。 但是，如何处理多媒体内容呢？ 对于完整的用户服务，您必须填写说明，为视频或图片起一个名字，几个标签不会受到伤害。 不幸的是，并不是每个人都想花时间在这种内容改进上。 通常，用户将链接上传到youtube，报告这是新视频，然后点击保存。 服务可以处理此类“灰色”内容吗？ 首先想到的是问YouTube？ 但是YouTube也充满了用户（通常是同一用户）。 通常，视频资料可能不是来自YouTube服务。 <br> 因此，我想到了要教我们的服务“收听”视频并“了解”其含义的想法。 <br><a name="habracut"></a><br> 我承认，这个想法并不是什么新鲜事物，但是今天要实现它，就不必有十名数据科学家的工作人员，而只需要两天时间和少量硬件资源。 <br><br><h3> 问题陈述 </h3><br> 我们的微服务称为<b>Summarizer</b> ，应： <br><br><ul><li> 从媒体服务下载视频； </li><li> 提取音轨； </li><li> 听音频，实际上是语音到文本； </li><li> 找到20个关键字； </li><li> 从文本中选择一个句子，这可以使视频的本质最大化； </li><li> 将所有结果发送到内容服务； </li></ul><br> 我们将信任<i>Python</i>的实现，因此您不必处理与现成的ML解决方案的集成。 <br><br> 第一步：音频转文字。 <br><br> 首先，安装所有必需的组件。 <br><br><pre><code class="bash hljs">pip3 install wave numpy tensorflow youtube_dl ffmpeg-python deepspeech nltk networkx brew install ffmpeg wget</code> </pre> <br> 接下来，从Mozilla-Deepspeech下载并解压缩训练后的语音到文本解决方案模型。 <br><br><pre> <code class="bash hljs">mkdir /Users/Volodymyr/Projects/deepspeech/ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /Users/Volodymyr/Projects/deepspeech/ wget https://github.com/mozilla/DeepSpeech/releases/download/v0.3.0/deepspeech-0.3.0-models.tar.gz tar zxvf deepspeech-0.3.0-models.tar.gz</code> </pre><br>  Mozilla团队创建并培训了一个相当不错的解决方案，该解决方案使用TensorFlow可以将较长的音频剪辑转换成高质量的大文本块。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TensorFlow</a>还允许您在CPU和GPU上开箱即用。 <br><br> 我们的代码将从下载内容开始。 出色的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">youtube-dl</a>库将为他提供帮助，该库具有内置的后处理器，可以将视频转换为所需的格式。 不幸的是，后处理器代码有点受限制，它不知道如何重新采样，因此我们将提供帮助。 <br> 对于Deepspeech输入，您需要提交带有单声道和16K样本的音频文件。 为此，我们需要重新处理收到的文件。 <br><br><pre> <code class="python hljs">_ = ffmpeg.input(youtube_id + <span class="hljs-string"><span class="hljs-string">'.wav'</span></span>).output(output_file_name, ac=<span class="hljs-number"><span class="hljs-number">1</span></span>, t=crop_time, ar=<span class="hljs-string"><span class="hljs-string">'16k'</span></span>).overwrite_output().run(capture_stdout=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)</code> </pre><br> 在同一操作中，我们还可以通过传递附加参数“ t”来限制文件的持续时间。 <br><br> 下载deepspeech模型。 <br><br><pre> <code class="python hljs">deepspeech = Model(args.model, N_FEATURES, N_CONTEXT, args.alphabet, BEAM_WIDTH)</code> </pre><br> 使用wave库，我们以np.array格式提取帧并将其传输到Deepspeech库输入。 <br><br><pre> <code class="python hljs">fin = wave.open(file_name, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) framerate_sample = fin.getframerate() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> framerate_sample != <span class="hljs-number"><span class="hljs-number">16000</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Warning: original sample rate ({}) is different than 16kHz. Resampling might produce erratic speech recognition.'</span></span>.format(framerate_sample), file=sys.stderr) fin.close() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: audio = np.frombuffer(fin.readframes(fin.getnframes()), np.int16) audio_length = fin.getnframes() * (<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">16000</span></span>) fin.close() print(<span class="hljs-string"><span class="hljs-string">'Running inference.'</span></span>, file=sys.stderr) inference_start = timer() result = deepspeech.stt(audio, framerate_sample)</code> </pre><br> 一段时间后，您会收到与硬件资源成比例的文字。 <br><br><h3> 第二步：找到“含义” </h3><br> 为了搜索描述结果文本的单词，我将使用graph方法。 该方法基于序列之间的距离。 首先，我们找到所有“独特”的单词，假设这些是我们图形的顶点。 在浏览了具有给定长度的“窗口”的文本之后，我们找到了单词之间的距离，它们将成为gaff的边缘。 可以通过仅选择语音某一部分的词汇单元的语法过滤器来限制添加到图中的顶点。 例如，您只能考虑将名词和动词添加到图中。 因此，我们将仅基于可在名词和动词之间建立的关系来构建潜在边。 <br><br> 与每个顶点关联的分数设置为初始值1，并启动排名算法。 排名算法是“投票”或“推荐”。 当一个顶点连接到另一个顶点时，它将对此（连接的）顶点“投票”。 为一个高峰投的票数越高，该高峰的重要性就越高。 此外，投票顶部的重要性决定了投票本身的重要性，并且排名模型也考虑了此信息。 因此，与顶部相关的分数是基于为其投下的票数以及获得这些选票的峰的等级来确定的。 <br><br> 假设我们有一个图G =（V，E），由顶点V和边E来描述。对于给定的顶点V，让一组顶点E与之相连。 对于每个顶点Vi，都有与之关联的In（Vi）顶点和与之相关联的Out（Vi）顶点。 因此，顶点Vi的权重可以由公式表示。 <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>S&amp;#xA0;\&amp;#xA0;big&amp;#xFF08;V_&amp;#xA0;{i}&amp;#xA0;\&amp;#xA0;big&amp;#xFF09;=&amp;#xA0;\&amp;#xA0;big&amp;#xFF08;1-d&amp;#xA0;\&amp;#xA0;big&amp;#xFF09;+&amp;#xA0;d&amp;#xA0;*&amp;#xA0;\&amp;#xA0;sum_&amp;#xA0;{j&amp;#xA0;\&amp;#xA0;in&amp;#xFF08;V_&amp;#xA0;{i}&amp;#xFF09;}}&amp;#xA0;frac&amp;#xA0;{1}&amp;#xA0;{\&amp;#x4E2D;&amp;#x51FA;&amp;#xFF08;V_&amp;#xA0;{j}&amp;#xFF09;\&amp;#xA0;mid}&amp;#xA0;*&amp;#xA0;S&amp;#xA0;\&amp;#x5927;&amp;#xFF08;V_&amp;#xA0;{j}&amp;#xA0;\&amp;#x5927;&amp;#xFF09;</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">S&nbsp;\&nbsp;big（V_&nbsp;{i}&nbsp;\&nbsp;big）=&nbsp;\&nbsp;big（1-d&nbsp;\&nbsp;big）+&nbsp;d&nbsp;*&nbsp;\&nbsp;sum_&nbsp;{j&nbsp;\&nbsp;in（V_&nbsp;{i}）}}&nbsp;frac&nbsp;{1}&nbsp;{\中出（V_&nbsp;{j}）\&nbsp;mid}&nbsp;*&nbsp;S&nbsp;\大（V_&nbsp;{j}&nbsp;\大）</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>S&nbsp;\&nbsp;big（V_&nbsp;{i}&nbsp;\&nbsp;big）=&nbsp;\&nbsp;big（1-d&nbsp;\&nbsp;big）+&nbsp;d&nbsp;*&nbsp;\&nbsp;sum_&nbsp;{j&nbsp;\&nbsp;in（V_&nbsp;{i}）}}&nbsp;frac&nbsp;{1}&nbsp;{\中出（V_&nbsp;{j}）\&nbsp;mid}&nbsp;*&nbsp;S&nbsp;\大（V_&nbsp;{j}&nbsp;\大）</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> S \ big（V_ {i} \ big）= \ big（1-d \ big）+ d * \ sum_ {j \ in（V_ {i}）}} frac {1} {\中出（V_ {j}）\ mid} * S \大（V_ {j} \大）</script></p><br><br> 其中d是衰减/抑制因子，取值为1到0。 <br><br> 该算法应多次迭代图以获得粗略估计。 <br> 在获得图中每个顶点的近似估计后，将这些顶点按降序排序。 出现在列表顶部的顶点将是我们想要的关键字。 <br><br> 文本中最相关的句子是通过找到该句子中所有单词的评分加总的平均值来找到的。 也就是说，我们将所有估算值相加，然后除以句子中的单词数。 <br><br><pre> <code class="bash hljs">iMac:YoutubeSummarizer $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /Users/Volodymyr/Projects/YoutubeSummarizer ; env <span class="hljs-string"><span class="hljs-string">"PYTHONIOENCODING=UTF-8"</span></span> <span class="hljs-string"><span class="hljs-string">"PYTHONUNBUFFERED=1"</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/python3 /Users/Volodymyr/.vscode/extensions/ms-python.python-2018.11.0/pythonFiles/experimental/ptvsd_launcher.py --default --client --host localhost --port 53730 /Users/Volodymyr/Projects/YoutubeSummarizer/summarizer.py --youtube-id yA-FCxFQNHg --model /Users/Volodymyr/Projects/deepspeech/models/output_graph.pb --alphabet /Users/Volodymyr/Projects/deepspeech/models/alphabet.txt --lm /Users/Volodymyr/Projects/deepspeech/models/lm.binary --trie /Users/Volodymyr/Projects/deepspeech/models/trie --crop-time 900 Done downloading, now converting ... ffmpeg version 4.1 Copyright (c) 2000-2018 the FFmpeg developers built with Apple LLVM version 10.0.0 (clang-1000.11.45.5) configuration: --prefix=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/Cellar/ffmpeg/4.1 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-shared --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-pthreads --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-version3 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-hardcoded-tables --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-avresample --cc=clang --host-cflags= --host-ldflags= --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-ffplay --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-gpl --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libmp3lame --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libopus --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libsnappy --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libtheora --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libvorbis --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libvpx --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libx264 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libx265 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libxvid --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-lzma --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-opencl --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-videotoolbox libavutil 56. 22.100 / 56. 22.100 libavcodec 58. 35.100 / 58. 35.100 libavformat 58. 20.100 / 58. 20.100 libavdevice 58. 5.100 / 58. 5.100 libavfilter 7. 40.101 / 7. 40.101 libavresample 4. 0. 0 / 4. 0. 0 libswscale 5. 3.100 / 5. 3.100 libswresample 3. 3.100 / 3. 3.100 libpostproc 55. 3.100 / 55. 3.100 Guessed Channel Layout <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Input Stream <span class="hljs-comment"><span class="hljs-comment">#0.0 : stereo Input #0, wav, from 'yA-FCxFQNHg.wav': Metadata: encoder : Lavf58.20.100 Duration: 00:17:27.06, bitrate: 1536 kb/s Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 48000 Hz, stereo, s16, 1536 kb/s Stream mapping: Stream #0:0 -&gt; #0:0 (pcm_s16le (native) -&gt; pcm_s16le (native)) Press [q] to stop, [?] for help Output #0, wav, to 'result-yA-FCxFQNHg.wav': Metadata: ISFT : Lavf58.20.100 Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 16000 Hz, mono, s16, 256 kb/s Metadata: encoder : Lavc58.35.100 pcm_s16le size= 28125kB time=00:15:00.00 bitrate= 256.0kbits/s speed=1.02e+03x video:0kB audio:28125kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000271% Loading model from file /Users/Volodymyr/Projects/deepspeech/models/output_graph.pb TensorFlow: v1.11.0-9-g97d851f04e DeepSpeech: unknown Warning: reading entire model file into memory. Transform model file into an mmapped graph to reduce heap usage. 2018-12-14 17:42:03.121170: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA Loaded model in 0.5s. Loading language model from files /Users/Volodymyr/Projects/deepspeech/models/lm.binary /Users/Volodymyr/Projects/deepspeech/models/trie Loaded language model in 3.17s. Running inference. Building top 20 keywords... {'communicate', 'government', 'repetition', 'terrorism', 'technology', 'thinteeneighty', 'incentive', 'ponsibility', 'experience', 'upsetting', 'democracy', 'infection', 'difference', 'evidesrisia', 'legislature', 'metriamatrei', 'believing', 'administration', 'antagethetruth', 'information', 'conspiracy'} Building summary sentence... intellectually antagethetruth administration thinteeneighty understanding metriamatrei shareholders evidesrisia recognizing ponsibility communicate information legislature abaddoryis technology difference conspiracy repetition experience government protecting categories mankyuses democracy campaigns primarily attackers terrorism believing happening infection seriously incentive upsetting testified fortunate questions president companies prominent actually platform massacre powerful building poblanas thinking supposed accounts murdered function unsolved perverse recently fighting opposite motional election children watching traction speaking measured nineteen repeated coverage imagined positive designed together countess greatest fourteen attacks publish brought through explain russian opinion winking somehow welcome trithis problem looking college gaining feoryhe talking ighting believe happens connect further working ational mistake diverse between ferring Inference took 76.729s for 900.000s audio file.</span></span></code> </pre><br><h3> 总结 </h3><br> 与三四年前相比，今天想到的想法可以更快地实现。 试试吧，实验！ 我认为人工智能主要是与之合作的工程师的智慧。 <br><br> 该代码可在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我的Github存储库中找到</a> 。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433532/">https://habr.com/ru/post/zh-CN433532/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433520/index.html">保护信息的新立法举措</a></li>
<li><a href="../zh-CN433522/index.html">12月IT活动摘要（第二部分）</a></li>
<li><a href="../zh-CN433524/index.html">今天，MIPS已成为针对RISC-V和ARM的开源。 俄罗斯如何影响美国处理器公司的战略</a></li>
<li><a href="../zh-CN433526/index.html">我们不冒犯</a></li>
<li><a href="../zh-CN433530/index.html">我和代码：如何成为一名受追捧的程序员</a></li>
<li><a href="../zh-CN433534/index.html">《 Python的工作原理》一书。 开发人员，程序员和感兴趣的人的指南”</a></li>
<li><a href="../zh-CN433536/index.html">在德国，IT员工的收入是多少</a></li>
<li><a href="../zh-CN433538/index.html">保护您的Web应用程序：如何关闭它免受第三方干扰</a></li>
<li><a href="../zh-CN433540/index.html">吉拉反对发展中的混乱：如何不丢失任务</a></li>
<li><a href="../zh-CN433542/index.html">有关集成和分立式Intel图形的未来的一点点</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>