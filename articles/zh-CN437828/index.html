<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👨🏽 👍🏿 🚭 打开网络研讨会“ MS SQL Server中的SELECT查询执行顺序和查询计划” 🤹🏽 🚩 🚯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="你好！ 

 同事们，在一月的最后一天，我们将启动“ MS SQL Server开发人员”课程，与此课程相关的是主题公开课。 在会议上，我们讨论了MS SQL Server如何执行SELECT查询，以什么顺序和分析了什么进行了讨论，并且还花了一点时间来阅读查询计划。 

 讲师-Kristina K...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>打开网络研讨会“ MS SQL Server中的SELECT查询执行顺序和查询计划”</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/437828/"> 你好！ <br><br> 同事们，在一月的最后一天，我们将启动<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ MS SQL Server开发人员”</a>课程，与此课程相关的是主题公开课。 在会议上，我们讨论了MS SQL Server如何执行SELECT查询，以什么顺序和分析了什么进行了讨论，并且还花了一点时间来阅读查询计划。 <br><br> 讲师<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-Kristina Kucherova</a> ，俄罗斯联邦储蓄银行的数据模型架构师。 <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/H9oS-eLSX_8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>网络研讨会的目标和途径</b> <br><br> 在网络研讨会开始时设定了以下目标： <br><br><ol><li> 查看服务器如何执行请求，以及为什么以这种方式发生。 </li><li> 学习阅读查询计划。 </li></ol><br> 为了实现这些目标，老师准备了一条简单而有效的方法： <br><br><img src="https://habrastorage.org/webt/fq/kj/nr/fqkjnrypzokv5wpzw1phclft3xa.jpeg"><br><br>  <b>为什么需要查询计划？</b> <br><br> 查询计划是一个非常有用的工具，不幸的是，许多开发人员没有使用它。 乍一看，似乎没有必要了解请求的机制。 但是，如果您了解SQL Server内部的情况，则可以编写更有效的查询。 例如，在优化过程中，它将有很大帮助。 <br><br>  <b>我们如何看到SELECT查询？</b> <br><br> 让我们看看SELECT查询的样子： <br><br><table><tbody><tr><td> 选择[field1]，[field2] ... <br></td><td> 我们选择什么领域？ <br></td></tr><tr><td> 来自[表格] <br></td><td> 从哪里来？ <br></td></tr><tr><td>  [条件] <br></td><td> 条件在哪里 <br></td></tr><tr><td>  GROUP BY [field1] <br></td><td> 按字段分组 <br></td></tr><tr><td> 有[条件] <br></td><td> 有这样的条件 <br></td></tr><tr><td>  ORDER BY [field1] <br></td><td> 订购（排序） <br></td></tr></tbody></table><br>  <b>如何理解去哪里找数据？</b> <br><br> 服务器试图了解请求何时到达的第一件事是数据的去向。  FROM命令回答了这个问题，因为在这里我们将有一个表列表（或一个表的名称）。 <br><br> 为了清楚起见，让我们假设我们的服务器是一种管家，我们打算在度假时将其收集给我们。 因此，管家开始思考，但是在什么壁橱里有必要的东西（您需要在哪个表中获取数据）？ 为了使我们的管家可以轻松完成他的任务，我们使用FROM。 <br><br><img src="https://habrastorage.org/webt/ig/wo/uy/igwouy4la8vroshisd8pk5sqcx8.jpeg"><br><br>  <b>如何理解要取什么数据？</b> <br><br> 假设管家找到了正确的橱柜并将其打开。 但是要拿什么呢？ 也许我们要去滑雪胜地？ 或者也许在炎热的阳光明媚的海滩上？ 为了使我们的东西与天气匹配，WHERE命令对我们很有用，它定义了条件，即允许我们过滤数据。 如果天气很热，我们会选择板岩，衬衫和泳装（如果天气很冷，则要戴手套，针织袜，毛衣））。 <br><br> 下一步是将此数据附加到组，这在GROUP BY（分别为T恤衫和袜子）中发生。 根据分组结果，可以使用HAVING施加另一个条件（例如，清除未配对的事物）。 最后，我们使用ORDER BY添加所有内容，在输出中获得完整的手提箱，或者说是有序的数据块。 <br><br><img src="https://habrastorage.org/webt/vd/lt/4b/vdlt4bg1o5ebpaxz1di_vhl__tm.jpeg"><br><br> 顺便说一下，这是有细微差别的，但这是因为在WHERE中应规定哪些条件以及HAVING中应规定哪些条件之间存在差异。 但这最好在视频中看到。 <br><br> 我们继续。 请求执行路径<b>作为请求计划</b>保存在缓存中，也就是说，我们的管家将所有内容写下来，因为他是一个很好的管家-如果您想在明年再次下订单怎么办？ 从原则上讲，这样的计划可能很多。 <br><br>  <b>查询计划中的连接类型</b> <br><br> 就查询而言，您可能会遇到三个连接： <br><br><ol><li> 嵌套循环。 </li><li> 合并加入。 </li><li> 哈希加入。 </li></ol><br> 在更详细地介绍它们之前，让我们总结一下为什么我们甚至应该阅读查询计划。 这实际上非常有用，因为您将学习： <br><br><ul><li> 使用哪个索引； </li><li> 以什么顺序加入； </li><li> 从缓冲区选择什么； </li><li> 服务器在操作上花费了多少资源； </li><li> 假设计划和实际计划之间有什么区别？ </li></ul><br>  <b>嵌套循环</b> <br><br> 假设我们需要连接来自不同表的数据。 让我们将这些表展示为……少量的Skittles巧克力和M＆M的完整包装。 <br><br><img src="https://habrastorage.org/webt/4k/-s/uh/4k-suhjbpvptu8kjhe77rx8posm.jpeg"><br><br> 连接嵌套循环类型时，我们先吃Skittles糖果，然后再从M＆M的包装中得到盲糖果。 如果我们没有碰到相同颜色的糖果（这是我们的状况），我们会得到下一个糖果，那就是通常的半身像。 结果，我们可以说嵌套循环连接更适合少量数据。 显然，如果有很多数据，那么破坏不是最佳选择。 <br><br><img src="https://habrastorage.org/webt/fu/0d/mv/fu0dmvprjve1i1mgbn5v3nou3ow.jpeg"><br><br> 让我们看看它在SQL面板中的外观： <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--drop table skittles --drop table mms --    create table mms (id int identity(1,1), color varchar(25), taste varchar(15)) insert into mms (color, taste) values ('yellow', 'chocolate') insert into mms (color, taste) values ('red', 'nuts') create clustered index IX_mms_color ON mms(color); create table skittles (id int identity(1,1), color varchar(25), taste varchar(15)) create index IX_skittles_id ON skittles(id); create clustered index IX_skittles_color ON skittles(color); insert into skittles (color, taste) values ('red', 'cherry') insert into skittles (color, taste) values ('blue', 'strange') insert into skittles (color, taste) values ('yellow', 'lemon') insert into skittles (color, taste) values ('green', 'apple') insert into skittles (color, taste) values ('orange', 'orange') --    select mms.* from mms join skittles on mms.color = skittles.color select * from mms join skittles on mms.color = skittles.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/gx/vj/ed/gxvjedgxwzjcdv2kbzreqmmofwi.jpeg"><br><br>  <b>合并加入</b> <br><br> 连接用于大量数据。 当您有一个合并联接时，两个表都有一个索引，通过它们它们可以被联接。 就糖果而言，就好像我们是按颜色预先安排它们一样。 <br><br> 看起来像这样： <br><br><img src="https://habrastorage.org/webt/j2/cy/ld/j2cyldmem4_ytym2ssj3wpyco1q.jpeg"><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--2 tables 50000 rows, only clustered index by color, color is not unique select COUNT(*) from mms_big join skittles_big on mms_big.color = skittles_big.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/xv/vm/mf/xvvmmf1ozq_lt7f2rrcnqsvz1cs.jpeg"><br><br> 在以下情况下，合并联接是好的： <br><br><ul><li> 大数据集； </li><li> 相同类型的相同连接字段； </li><li> 连接字段具有索引。 </li></ul><br>  <b>哈希联接</b> <br><br> 哈希联接用于未排序的大量数据。 在这种情况下，要联接表，您需要构建一些类似于索引的东西。 <br><br> 哈希联接示例： <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--drop table skittles --drop table mms --    create table mms (id int identity(1,1), color varchar(25), taste varchar(15)) insert into mms (color, taste) values ('yellow', 'chocolate') insert into mms (color, taste) values ('red', 'nuts') insert into mms (color, taste) values ('blue', 'strange') insert into mms (color, taste) values ('green', 'chocolate') insert into mms (color, taste) values ('orange', 'chocolate') create table skittles (id int identity(1,1), color varchar(25), taste varchar(15)) insert into skittles (color, taste) values ('red', 'cherry') insert into skittles (color, taste) values ('blue', 'strange') insert into skittles (color, taste) values ('yellow', 'lemon') insert into skittles (color, taste) values ('green', 'apple') insert into skittles (color, taste) values ('orange', 'orange') --    select * from mms join skittles on mms.color = skittles.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/0g/vr/xd/0gvrxdfdoc55bwpdkv5ghkwnq-w.jpeg"><br><br> 为了清楚起见，我们回顾一下我们的糖果： <br><br><img src="https://habrastorage.org/webt/xg/2l/cn/xg2lcndw5mzxm5msx6l_0kq_4wc.jpeg"><br><br> 使用哈希联接涉及两个阶段的操作： <br><br><ol><li> 构建-哈希表建立在最小的表上。 对于表1中的每个值，考虑一个散列。 该值存储在哈希表中，并将计算出的哈希值用作键。 </li><li> 探查。 对于表2中的每一行，将为join（operator =）中指定的字段计算哈希值。 在哈希表中搜索哈希，检查字段值。 </li></ol><br><img src="https://habrastorage.org/webt/nr/nn/q2/nrnnq2ahbh57a28x3szylahyjue.jpeg"><br><br><img src="https://habrastorage.org/webt/fu/e3/bg/fue3bgxwsesvzgwjgzzva6isnpu.jpeg"><br><br><img src="https://habrastorage.org/webt/dd/fx/mn/ddfxmnjwgneqpqmzxeseavjpkhy.jpeg"><br><br> 当哈希联接很好时： <br><br><ul><li> 大数据集； </li><li> 没有边际指数。 </li></ul><br> 重要的一点：如果没有足够的内存，记录将转到tempdb-到磁盘。 <br><br> 朋友们，除了上述内容之外，公开课还包括其他有趣的观点，最好通过观看视频来观看。 我们建议您参观“ MS SQL Server Developer” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">课程</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">开放日，在</a>这里您可以向老师提问。 <br><br>  PS老师<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">克里斯蒂娜·库切罗娃（Kristina Kucherova）</a>感谢Jes Schultz Borland在PASS Summitt执行计划：查询调优成功的秘诀上的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">演讲</a> ，该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">演讲</a>被用于准备公开课。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN437828/">https://habr.com/ru/post/zh-CN437828/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN437816/index.html">MPLS无处不在。 Yandex.Cloud网络基础架构如何</a></li>
<li><a href="../zh-CN437818/index.html">我们教计算机识别声音：了解DCASE竞赛并在30分钟内组装您的音频分类器</a></li>
<li><a href="../zh-CN437820/index.html">50种Drupal安全性</a></li>
<li><a href="../zh-CN437824/index.html">适用于Google表格和文档的通用1C扩展程序-使用和使用</a></li>
<li><a href="../zh-CN437826/index.html">我们如何将数据库从Redis和Riak KV迁移到PostgreSQL。 第1部分：过程</a></li>
<li><a href="../zh-CN437830/index.html">可靠的语言编程-新手评论。 第一部分</a></li>
<li><a href="../zh-CN437832/index.html">开源：代码幽默，代码技巧，非代码</a></li>
<li><a href="../zh-CN437834/index.html">关于叶卡捷琳堡编程活动如何发生的两个故事</a></li>
<li><a href="../zh-CN437836/index.html">深入浅出-面向程序员的MMO沙箱中的虚拟化</a></li>
<li><a href="../zh-CN437838/index.html">机器学习技术有时会加速患者适应仿生假体的过程</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>