<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöá üíÖüèæ üëß Coroutines :: exp√©rience pratique üëâüèæ üë¶ üö∂üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je parlerai du fonctionnement des coroutines et de leur cr√©ation. Consid√©rez l'application dans une ex√©cution s√©quentielle et parall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Coroutines :: exp√©rience pratique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/e-Legion/blog/442920/"> Dans cet article, je parlerai du fonctionnement des coroutines et de leur cr√©ation.  Consid√©rez l'application dans une ex√©cution s√©quentielle et parall√®le.  Parlons de la gestion des erreurs, du d√©bogage et des moyens de tester la coroutine.  √Ä la fin, je r√©sumerai et parlerai des impressions qui sont rest√©es apr√®s l'application de cette approche. <br><br>  L'article a √©t√© pr√©par√© sur la base des documents de mon rapport sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MBLT DEV 2018</a> , √† la fin de l'article - un lien vers la vid√©o. <br><br><h2>  Style coh√©rent </h2><br><img src="https://habrastorage.org/webt/ke/8z/tu/ke8ztulkufchujj6k5pxutqtigw.png"><a name="habracut"></a><br>  <i>Fig.</i>  <i>2.1</i> <br><br>  Quel √©tait le but des d√©veloppeurs Corutin?  Ils voulaient que la programmation asynchrone soit aussi simple que possible.  Il n'y a rien de plus simple que d'ex√©cuter le code ¬´ligne par ligne¬ª en utilisant les constructions syntaxiques du langage: try-catch-finally, boucles, instructions conditionnelles, etc. <br><br>  Consid√©rons deux fonctions.  Chacun est ex√©cut√© sur son propre thread (Fig. 2.1).  La premi√®re est ex√©cut√©e sur le thread <b>B</b> et retourne un r√©sultat <b>dataB</b> , puis nous devons passer ce r√©sultat √† la deuxi√®me fonction, qui prend <b>dataB</b> comme argument et est d√©j√† en cours d'ex√©cution sur le thread <b>A.</b>  Avec coroutine, nous pouvons √©crire notre code comme le montre la fig.  2.1.  Consid√©rez comment y parvenir. <br><br>  Fonctions <b>longOpOnB, longOpOnA</b> - les soi-disant fonctions de <i>suspension</i> , avant lesquelles le thread est lib√©r√©, et apr√®s l'ach√®vement de leur travail, il redevient occup√©. <br><br>  Pour que ces deux fonctions soient effectivement ex√©cut√©es dans un thread diff√©rent de celui appel√©, tout en conservant un style d'√©criture ¬´coh√©rent¬ª, nous devons les plonger dans le contexte de la coroutine. <br><br>  Cela se fait en cr√©ant des coroutines √† l'aide du soi-disant Coroutine Builder.  Dans la figure, c'est le <i>lancement</i> , mais il y en a d'autres, par exemple, <i>async</i> , <i>runBlocking</i> .  J'en parlerai plus tard. <br><br>  Le dernier argument est un bloc de code ex√©cut√© dans le contexte de la coroutine: appel aux fonctions suspend, ce qui signifie que tout le comportement ci-dessus n'est possible que dans le contexte de la coroutine ou dans une autre fonction suspend. <br><br>  Il existe d'autres param√®tres dans la m√©thode Coroutine Builder, par exemple, le type de lancement, le thread dans lequel le bloc sera ex√©cut√© et d'autres. <br><br><h2>  Gestion du cycle de vie </h2><br>  Coroutine Builder nous donne la valeur de retour comme valeur de retour - une sous-classe de la classe <i>Job</i> (Fig.2.2).  Avec lui, nous pouvons g√©rer le cycle de vie de la corutine. <br><br>  Commencez avec la m√©thode <i>start ()</i> , annulez avec la m√©thode <i>cancel ()</i> , attendez la fin du travail √† l'aide de la m√©thode <i>join (</i> ), abonnez-vous √† l'√©v√©nement d'ach√®vement du travail et plus encore. <br><br><img src="https://habrastorage.org/webt/os/bf/9j/osbf9jvwmvqtlidv_ugwrfbk-yc.png"><br>  <i>Fig.</i>  <i>2.2</i> <br><br><h2>  Changement de d√©bit </h2><br>  Vous pouvez modifier le flux d'ex√©cution de la coroutine en modifiant l'√©l√©ment de contexte de la coroutine qui est responsable de la planification.  (Fig. 2.3) <br><br>  Par exemple, la corutine 1 s'ex√©cutera dans un thread d' <i>interface utilisateur</i> , tandis que la corutine 2 dans un thread extrait du pool <i>Dispatchers.IO</i> . <br><br><img src="https://habrastorage.org/webt/oe/9e/o1/oe9eo1ynqwdskvi-laxuunj-xkk.png"><br>  <i>Fig.2.3</i> <br><br>  La biblioth√®que coroutine fournit √©galement une fonction de suspension <i>avecContext (CoroutineContext)</i> , avec laquelle vous pouvez basculer entre les threads dans le contexte d'une coroutine.  Ainsi, le saut entre les threads peut √™tre assez simple: <br><br><img src="https://habrastorage.org/webt/ga/ca/im/gacaimxsxh_bjcxjweywrc8kstw.png"><br>  <i>Fig.</i>  <i>2.4.</i> <br><br>  Nous commen√ßons notre coroutine sur le thread d'interface utilisateur 1 ‚Üí afficher l'indicateur de charge ‚Üí passer au thread de travail 2, lib√©rant le principal ‚Üí y effectuer une longue op√©ration qui ne peut pas √™tre effectu√©e dans le thread d'interface utilisateur ‚Üí renvoyer le r√©sultat au thread d'interface utilisateur 3 ‚Üí et d√©j√† y travailler avec elle, rendant les donn√©es re√ßues et masquant l'indicateur de chargement. <br><br>  Il semble assez confortable jusqu'√† pr√©sent, passez √† autre chose. <br><br><h2>  Fonction de suspension </h2><br>  Consid√©rez le travail de corutin sur l'exemple du cas le plus courant - travailler avec des requ√™tes r√©seau en utilisant la biblioth√®que Retrofit 2. <br><br>  La premi√®re chose que nous devons faire est de convertir l'appel de <b>rappel</b> en une fonction de <i>suspension</i> pour profiter de la fonctionnalit√© coroutine: <br><br><img src="https://habrastorage.org/webt/hs/kk/ue/hskkuekq2frbocs_hd-oxsz8k7o.png"><br>  <i>Fig.</i>  <i>2,5</i> <br><br>  Pour contr√¥ler l'√©tat de la coroutine, la biblioth√®que fournit des fonctions de la forme <i>suspendXXXXCoroutine</i> , qui fournissent un argument qui impl√©mente l'interface <i>Continuation</i> , en utilisant les m√©thodes <i>resumeWithException</i> et <i>resume</i> dont nous pouvons reprendre la coroutine en cas d'erreur et de succ√®s, respectivement. <br><br>  Ensuite, nous allons d√©terminer ce qui se passe lorsque la m√©thode resumeWithException est appel√©e, et tout d'abord, assurez-vous que nous devons en quelque sorte annuler l'appel de demande r√©seau. <br><br><h2>  Fonction de suspension.  Annulation d'appel </h2><br>  Pour annuler l'appel et d'autres actions li√©es √† la lib√©ration des ressources inutilis√©es, lors de l'impl√©mentation de la fonction de suspension, vous pouvez utiliser la m√©thode <i>suspendCancellableCoroutine</i> qui <i>sort</i> de la bo√Æte (Fig. 2.6).  Ici, l'argument de bloc impl√©mente d√©j√† l'interface <i>CancellableContinuation</i> , dont l'une des m√©thodes suppl√©mentaires est <i>invokeOnCancellation</i> , qui vous permet de vous inscrire pour une erreur ou un √©v√©nement d'annulation de coroutine r√©ussi.  Par cons√©quent, ici, il est √©galement n√©cessaire d'annuler l'appel de m√©thode. <br><br><img src="https://habrastorage.org/webt/59/ut/hw/59uthwhyrpuk2-hzm6c2rax0vzk.png"><br>  <i>Fig.</i>  <i>2.6</i> <br><br><h3>  Afficher les modifications dans l'interface utilisateur </h3><br>  Maintenant que la fonction de suspension a √©t√© pr√©par√©e pour les requ√™tes r√©seau, vous pouvez utiliser son appel dans le thread d'interface utilisateur de la coroutine comme s√©quentiel, tandis que pendant l'ex√©cution de la requ√™te, le flux sera libre et le flux de mise √† niveau sera utilis√© pour ex√©cuter la demande. <br><br>  Ainsi, nous impl√©mentons le comportement asynchrone par rapport au flux UI, mais nous l'√©crivons dans un style coh√©rent (Fig. 2.6). <br><br>  Si apr√®s avoir re√ßu la r√©ponse, vous devez effectuer le travail acharn√©, par exemple, √©crire les donn√©es re√ßues dans la base de donn√©es, alors cette fonction, comme cela a d√©j√† √©t√© montr√©, peut √™tre facilement effectu√©e en utilisant <i>withContext</i> sur le pool de flux de retour et continuer l'ex√©cution sur l'interface utilisateur sans une seule ligne de code. <br><br><img src="https://habrastorage.org/webt/ks/qk/g4/ksqkg48x7gjja00x6hii4cpc1uo.png"><br>  <i>Fig.</i>  <i>2.7</i> <br><br>  Malheureusement, ce n'est pas tout ce dont nous avons besoin pour le d√©veloppement d'applications.  Envisagez la gestion des erreurs. <br><br><h3>  Gestion des erreurs: try-catch-finally.  Annuler Coroutine: CancellationException </h3><br>  Une exception qui n'a pas √©t√© d√©tect√©e √† l'int√©rieur de la coroutine est consid√©r√©e comme non g√©r√©e et peut entra√Æner un blocage de l'application.  En plus des situations normales, une exception est lev√©e en reprenant la coroutine √† l'aide de la m√©thode <i>resumeWithException</i> sur la ligne correspondante de l'appel √† la fonction de suspension.  Dans ce cas, l'exception pass√©e en tant qu'argument est lev√©e inchang√©e.  (Fig. 2.8) <br><br><img src="https://habrastorage.org/webt/hm/sv/f0/hmsvf0yzwobbhf3mlv_ce8xy2l8.png"><br>  <i>Fig.</i>  <i>2.8</i> <br><br>  Pour la gestion des exceptions, la construction standard du langage try catch finally est disponible.  Maintenant, le code qui peut afficher l'erreur dans l'interface utilisateur prend la forme suivante: <br><br><img src="https://habrastorage.org/webt/ce/53/hp/ce53hpazfknfd3962fn0wvfv8x8.png"><br>  <i>Fig.</i>  <i>2.9</i> <br><br>  Dans le cas de l'annulation de la coroutine, ce qui peut √™tre r√©alis√© en appelant la m√©thode d'annulation du Job #, une <i>CancellationException est</i> lev√©e.  Cette exception est g√©r√©e par d√©faut et n'entra√Æne pas de plantages ni d'autres cons√©quences n√©gatives. <br><br>  Cependant, lorsque vous utilisez la construction <b>try / catch</b> , elle sera intercept√©e dans le <b>bloc catch</b> , et vous devez en tenir compte dans les cas si vous souhaitez g√©rer uniquement des situations vraiment ¬´erron√©es¬ª.  Par exemple, la gestion des erreurs dans l'interface utilisateur lorsqu'il est possible ¬´d'annuler¬ª les demandes ou l'enregistrement des erreurs est fournie.  Dans le premier cas, l'erreur sera affich√©e √† l'utilisateur, bien qu'elle n'existe pas, et dans le second, une exception inutile sera enregistr√©e et encombrera les rapports. <br><br>  Pour ignorer la situation d'annulation des coroutines, vous devez modifier l√©g√®rement le code: <br><br><img src="https://habrastorage.org/webt/cw/9p/yf/cw9pyfzj3sbzqrpz49b0ochntjq.png"><br>  <i>Fig.</i>  <i>2.10</i> <br><br><h2>  Journalisation des erreurs </h2><br>  Consid√©rez la trace de la pile d'exceptions d'exception. <br><br>  Si vous lancez une exception directement dans le bloc de code de la coroutine (Fig. 2.11), la trace de la pile semble nette, avec seulement quelques appels de la coroutine, elle indique correctement la ligne et les informations sur l'exception.  Dans ce cas, vous pouvez facilement comprendre √† partir de la trace de pile o√π exactement, dans quelle classe et dans quelle fonction l'exception a √©t√© lev√©e. <br><br><img src="https://habrastorage.org/webt/70/1q/h7/701qh72uei7qbt8jpf9kegbnavy.png"><br>  <i>Fig.</i>  <i>2.11</i> <br><br>  Cependant, les exceptions qui sont pass√©es √† la m√©thode <i>resumeWithException</i> de <i>suspendre-</i> fonctions, en r√®gle g√©n√©rale, ne contiennent pas d'informations sur la coroutine dans laquelle elles se sont produites.  Par exemple (Fig. 2.12), si vous reprenez la coroutine de la fonction de suspension pr√©c√©demment impl√©ment√©e avec la m√™me exception que dans l'exemple pr√©c√©dent, la trace de la pile ne donnera pas d'informations sur o√π rechercher sp√©cifiquement l'erreur. <br><br><img src="https://habrastorage.org/webt/wd/41/xr/wd41xr4kb6f-luf61_cvcmxetr4.png"><br>  <i>Fig.</i>  <i>2.12</i> <br><br>  Pour comprendre quelle coroutine a repris avec une exception, vous pouvez utiliser l' <i>√©l√©ment de</i> contexte <i>CoroutineName</i> .  (Fig. 2.13) <br><br>  L'√©l√©ment <i>CoroutineName est</i> utilis√© pour le d√©bogage, en lui passant le nom de la coroutine, vous pouvez l'extraire dans des fonctions de suspension et, par exemple, compl√©ter le message d'exception.  Autrement dit, au moins, il sera clair o√π chercher une erreur. <br><br>  Cette approche ne fonctionnera que si la fonction de suspension en est exclue: <br><br><img src="https://habrastorage.org/webt/5u/xs/st/5uxsstlugngflzdlcrarrfws1d4.png"><br>  <i>Fig.</i>  <i>2.13</i> <br><br><h3>  Journalisation des erreurs.  ExceptionHandler </h3><br>  Pour modifier la journalisation des exceptions pour une coroutine particuli√®re, vous pouvez d√©finir votre propre ExceptionHandler, qui est l'un des √©l√©ments du contexte de la coroutine.  (Fig. 2.14) <br><br>  Le gestionnaire doit impl√©menter l'interface <i>CoroutineExceptionHandler</i> .  En utilisant l'op√©rateur + remplac√© pour le contexte coroutine, vous pouvez remplacer le gestionnaire d'exceptions standard par le v√¥tre.  L'exception non <i>g√©r√©e</i> tombera dans la m√©thode <i>handleException</i> , o√π vous pourrez en faire ce dont vous avez besoin.  Par exemple, ignorez compl√®tement.  Cela se produira si vous laissez le gestionnaire vide ou ajoutez vos propres informations: <br><br><img src="https://habrastorage.org/webt/c_/1w/3y/c_1w3ya8lagmhplbeeq9ajvtbws.png"><br>  <i>Fig.</i>  <i>2.14</i> <br><br>  Voyons √† quoi pourrait ressembler la journalisation de notre exception: <br><br><ol><li>  Vous devez vous souvenir de la <i>CancellationException</i> , que nous voulons ignorer. </li><li>  Ajoutez vos propres journaux. </li><li>  N'oubliez pas le comportement par d√©faut, qui comprend la journalisation et la fermeture de l'application, sinon l'exception ¬´dispara√Ætra¬ª tout simplement et il ne sera pas clair ce qui s'est pass√©. </li></ol><br>  Maintenant, dans le cas de lever une exception, une liste de trace de pile sera envoy√©e au logcat avec les informations ajout√©es: <br><br><img src="https://habrastorage.org/webt/mr/jl/sc/mrjlscj8bilbyancdfmygexqlki.png"><br>  <i>Fig.</i>  <i>2.15</i> <br><br><h2>  Ex√©cution parall√®le.  async </h2><br>  Consid√©rez le fonctionnement parall√®le des fonctions de suspension. <br><br>  <i>Async</i> est le mieux adapt√© pour organiser des r√©sultats parall√®les √† partir de plusieurs fonctions.  Async, comme le <i>lancement</i> - Coroutine Builder.  Sa commodit√© est qu'en utilisant la m√©thode <i>expect ()</i> , il retourne des donn√©es en cas de succ√®s ou l√®ve une exception qui s'est produite lors de l'ex√©cution de la coroutine.  La m√©thode wait attendra la fin de la coroutine, si elle n'est pas d√©j√† termin√©e, sinon elle retournera imm√©diatement le r√©sultat du travail.  Notez que l'attente est une fonction de suspension et ne peut donc pas √™tre ex√©cut√©e en dehors du contexte d'une coroutine ou d'une autre fonction de suspension. <br><br>  En utilisant async, obtenir des donn√©es de deux fonctions en parall√®le ressemblera √† ceci: <br><br><img src="https://habrastorage.org/webt/w1/-t/hv/w1-thvudknznjyexdz7_c5rb0w8.png"><br>  <i>Fig.</i>  <i>2.16</i> <br><br>  Imaginez que nous sommes confront√©s √† la t√¢che d'obtenir des donn√©es √† partir de deux fonctions en parall√®le.  Ensuite, vous devez les combiner et les afficher.  En cas d'erreur, il est n√©cessaire de dessiner l'interface utilisateur, annulant toutes les demandes en cours.  Un tel cas se retrouve souvent dans la pratique. <br><br>  Dans ce cas, l'erreur doit √™tre trait√©e comme suit: <br><br><ol><li>  Apportez la gestion des erreurs √† l'int√©rieur de chaque async-corutine. </li><li>  En cas d'erreur, annulez toutes les coroutines.  Heureusement, pour cela, il est possible de sp√©cifier un travail parent, lors de l'annulation de laquelle tous ses enfants sont annul√©s. </li><li>  Nous proposons une impl√©mentation suppl√©mentaire pour comprendre si toutes les donn√©es ont √©t√© charg√©es avec succ√®s.  Par exemple, nous supposons que si wait renvoie null, une erreur s'est produite lors de la r√©ception des donn√©es. </li></ol><br>  Avec tout cela √† l'esprit, la mise en ≈ìuvre de la coroutine parentale devient un peu plus compliqu√©e.  La mise en ≈ìuvre de async-corutin est √©galement compliqu√©e: <br><br><img src="https://habrastorage.org/webt/wy/xe/ny/wyxenyk2quyek7zmhz4ze1dq5sw.png"><br>  <i>Fig.</i>  <i>2.17</i> <br><br>  Cette approche n'est pas la seule possible.  Par exemple, vous pouvez impl√©menter l'ex√©cution parall√®le avec la gestion des erreurs √† l'aide d' <i>ExceptionHandler</i> ou de <i>SupervisorJob</i> . <br><br><h2>  Coroutines imbriqu√©es </h2><br>  Regardons le travail de la coroutine imbriqu√©e. <br><br>  Par d√©faut, la coroutine imbriqu√©e est cr√©√©e √† l'aide d'une √©tendue externe et h√©rite de son contexte.  En cons√©quence, la coroutine imbriqu√©e devient une fille et le parent externe. <br><br>  Si nous annulons la coroutine externe, les coroutines imbriqu√©es ainsi cr√©√©es, qui ont √©t√© utilis√©es dans l'exemple pr√©c√©dent, seront √©galement annul√©es.  Il sera √©galement utile lorsque vous quittez l'√©cran lorsque vous devez annuler les demandes en cours.  De plus, la corutine parent attendra toujours la fin de la fille. <br><br>  Vous pouvez cr√©er une coroutine ind√©pendante de l'ext√©rieur √† l'aide d'une √©tendue globale.  Dans ce cas, lorsque la coroutine externe est annul√©e, celle imbriqu√©e continuera de fonctionner comme si de rien n'√©tait: <br><br><img src="https://habrastorage.org/webt/fj/pu/_y/fjpu_yzyp3z0ttuypjypxu2oav4.png"><br>  <i>Fig.</i>  <i>2.18</i> <i><br></i> <br>  Vous pouvez cr√©er un enfant de la coroutine globale imbriqu√©e en rempla√ßant l'√©l√©ment contextuel par la cl√© <i>Job</i> par le travail parent, ou vous pouvez utiliser pleinement le contexte de la coroutine parent.  Mais dans ce cas, il convient de se rappeler que tous les √©l√©ments de la coroutine parent sont pris en charge: le pool de threads, le gestionnaire d'exceptions, etc.: <br><br><img src="https://habrastorage.org/webt/hh/wd/jx/hhwdjxobjkl0arojj0sh6ufii7m.png"><br>  <i>Fig.</i>  <i>2.19</i> <br><br>  Maintenant, il est clair que si vous utilisez Coroutine de l'ext√©rieur, vous devez leur fournir la possibilit√© d'installer soit une instance du travail, soit le contexte du parent.  Et les d√©veloppeurs de biblioth√®ques doivent envisager la possibilit√© de l'installer en tant qu'enfant, ce qui cause des inconv√©nients. <br><br><h2>  Points d'arr√™t </h2><br>  Les coroutines affectent l'affichage des valeurs des objets en mode d√©bogage.  Si vous placez un point d'arr√™t √† l'int√©rieur de la prochaine coroutine sur la fonction <b>logData</b> , alors quand elle se d√©clenche, nous voyons que tout va bien ici et les valeurs sont affich√©es correctement: <br><br><img src="https://habrastorage.org/webt/hp/t-/oc/hpt-ockcfqvrlzej2ncx0v2cboy.png"><br>  <i>Fig.</i>  <i>2,20</i> <br><br>  Maintenant, r√©cup√©rez <b>dataA en</b> utilisant la coroutine imbriqu√©e, en laissant un point d'arr√™t sur <b>logData</b> : <br><br><img src="https://habrastorage.org/webt/bq/0j/cb/bq0jcbefwitj0ss-bhahf8_cjy8.png"><br>  <i>Fig.</i>  <i>2.21</i> <br><br>  La tentative de d√©veloppement du bloc this pour essayer de trouver les valeurs souhait√©es √©choue.  Ainsi, le d√©bogage en pr√©sence de fonctions de suspension devient difficile. <br><br><h2>  Tests unitaires </h2><br>  Les tests unitaires sont assez simples.  Vous pouvez utiliser le runBlocking de Coroutine Builder <i>pour cela</i> .  <i>runBlocking</i> bloque un thread jusqu'√† ce que toutes ses coroutines imbriqu√©es se terminent, ce qui est exactement ce dont vous avez besoin pour les tests. <br><br>  Par exemple, si l'on sait que quelque part √† l'int√©rieur de la m√©thode coroutine est utilis√©e pour l'impl√©menter, alors pour tester la m√©thode, il suffit de l' <i>encapsuler</i> dans <i>runBlocking</i> . <br><br>  <i>runBlocking</i> peut √™tre utilis√© pour tester une fonction de suspension: <br><br><img src="https://habrastorage.org/webt/ok/vi/4t/okvi4t5bogczdolbbiimwmqyz5g.png"><br>  <i>Fig.</i>  <i>2.22</i> <br><br><h2>  Des exemples </h2><br>  Enfin, je voudrais montrer quelques exemples d'utilisation de la corutine. <br><br>  Imaginez que nous devons ex√©cuter trois requ√™tes A, B et C en parall√®le, montrer leur ach√®vement et refl√©ter le moment d'ach√®vement des requ√™tes A et B. <br><br>  Pour ce faire, vous pouvez simplement envelopper les coroutines de requ√™te A et B dans une seule et la travailler comme avec un seul ensemble: <br><br><img src="https://habrastorage.org/webt/xy/ut/fo/xyutfowgblzyjx5l-fb0tcazbx4.png"><br>  <i>Fig.</i>  <i>2.23</i> <br><br>  L'exemple suivant montre comment utiliser la boucle for r√©guli√®re pour ex√©cuter des requ√™tes p√©riodiques avec un intervalle de 5 secondes: <br><br><img src="https://habrastorage.org/webt/an/bk/zb/anbkzbm6ozetsl3vtwopsmtm2f0.png"><br>  <i>Fig.</i>  <i>2,24</i> <br><br><h2>  Conclusions </h2><br>  Parmi les inconv√©nients, je note que les coroutines sont un outil relativement jeune, donc si vous voulez les utiliser sur la prod, vous devez le faire avec prudence.  Il y a des difficult√©s de d√©bogage, un petit passe-partout dans la mise en ≈ìuvre de choses √©videntes. <br><br>  En g√©n√©ral, les coroutines sont assez faciles √† utiliser, en particulier pour impl√©menter des t√¢ches asynchrones non compliqu√©es.  En particulier, du fait que des constructions de langage standard peuvent √™tre utilis√©es.  Les coroutines se pr√™tent facilement aux tests unitaires et tout cela sort de la bo√Æte de la m√™me entreprise qui d√©veloppe le langage. <br><br><h2>  Signaler la vid√©o </h2><br>  Il s'est av√©r√© que beaucoup de lettres.  Pour ceux qui aiment en savoir plus - vid√©o de mon reportage sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MBLT DEV 2018</a> : <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/wsYou5lx6zA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Documents utiles sur le sujet: </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Introduction aux Coroutines</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plongez au c≈ìur des coroutines</a> </li><li>  <a href="">Guide de kotlinx.coroutines par exemple</a> </li><li>  <a href="">Guide de programmation UI avec coroutines</a> </li><li>  <a href="">Document de conception des coroutines (KEEP)</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442920/">https://habr.com/ru/post/fr442920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442910/index.html">Pourquoi avons-nous besoin d'analyses avanc√©es dans SIBUR</a></li>
<li><a href="../fr442912/index.html">Rassemblement contre l'isolement de Runet</a></li>
<li><a href="../fr442914/index.html">Battle royale: concevez les secrets du genre de jeu le plus populaire</a></li>
<li><a href="../fr442916/index.html">Les stations de radio FM pirat√©es sont-elles pertinentes aujourd'hui?</a></li>
<li><a href="../fr442918/index.html">Guide de d√©ploiement de mod√®les d'apprentissage automatique dans un environnement de production en tant qu'API √† l'aide de Flask</a></li>
<li><a href="../fr442922/index.html">Mission lunaire "Bereshit" - caract√©ristiques de l'appareil, une s√©rie de man≈ìuvres et le plus long chemin vers la lune</a></li>
<li><a href="../fr442924/index.html">√âclaboussures de texture de terrain avanc√©es</a></li>
<li><a href="../fr442926/index.html">"Souris de souris" dans la lumi√®re infrarouge: l'introduction de nanoparticules dans la r√©gion sous-r√©tinienne de l'≈ìil de la souris</a></li>
<li><a href="../fr442928/index.html">√âcrire un code flexible √† l'aide de SOLID</a></li>
<li><a href="../fr442934/index.html">Comment embaucher des gens dans une grande entreprise avec une pile impopulaire. Conversation avec Wrike</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>