<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧒🏽 🧛🏻 👂🏻 关于廉价数据中心，ILV和DDoS保护 👍🏼 👨🏻‍🔬 👨🏻‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="有时，一个项目住在便宜的外国数据中心中，落在Roskomnadzor的地毯下，定期处于DDoS攻击之下，但同时拥有数TB的数据和流量。 


 如何生活？ 



 前言 


 我们有一个小的照相馆来提供支持。 我们不会提及名称和国家/地区，只会提及一些技术数据： 
 50 TB的数据用于存储，大...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>关于廉价数据中心，ILV和DDoS保护</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/424513/"><p> 有时，一个项目住在便宜的外国数据中心中，落在Roskomnadzor的地毯下，定期处于DDoS攻击之下，但同时拥有数TB的数据和流量。 </p><br><p> 如何生活？ </p><br><p><img src="https://habrastorage.org/webt/42/kg/m1/42kgm1wgykvy6v9uaw_6rzdavwq.png"></p><br><h2 id="preambula"> 前言 </h2><br><p> 我们有一个小的照相馆来提供支持。 我们不会提及名称和国家/地区，只会提及一些技术数据： <br>  50 TB的数据用于存储，大约每月更新100 GB，“热数据”（95％的请求发送给他们）-200 GB。 <br> 平均流量-50 Tb /月。 </p><br><p> 几年前，选择了几台带有大磁盘的Hetzner SX系列服务器来发布照片（为了存储PD，我不得不想出一个更复杂的解决方案，但那时候又需要更多）。 </p><br><p> 南桥公司怀疑赫兹纳是否适合这种项目，但是达到了所需的可访问性和连接质量。 </p><br><p> 另外，对于这样的项目，使用CDN的成本要比从廉价数据中心中的服务器分发静态数据的成本高出一个数量级。 </p><a name="habracut"></a><br><h2 id="fabula"> 情节 </h2><br><p> 罗斯科姆纳佐尔（Roskomnadzor）出现在我们的历史中，不要白白提及。  18年春季，地毯锁开始生产，到5月，它们已覆盖了我们的许多客户。 </p><br><p>一些客户可以通过访问Hetzner，Amazon，MS Azure，GCE，Digitalocean来解决问题，他们将整个服务器转移到了俄罗斯（嗨，Selectel！），但是对于我们的英雄，一个小型照相银行，不断地来回传输50 TB的数据来说太昂贵了，并且在锁定结束后我们不会将项目服务器留在俄罗斯。 </p><br><p> 对于大而不足的问题，需要小而适当的解决方案。 </p><br><h2 id="reshenie-problemy"> 解决问题 </h2><br><p> 例如，将其他（未锁定）服务器或服务用于前端。 更改ip地址范围并不能100％帮助您，因为  ILV每天都会阻止新的IP子网，因此我们决定通过Cloudflare.com启用代理。 突然之间，谁不知道，他们不仅可以防御DDoS攻击（不如这个市场上最好的播放器），还可以提供CDN服务（他们做得很好）。 </p><br><p> 如果您的Cloudflare地址未被阻止，这是一个很好的解决方案） </p><br><p> 好的，他们将其打开-并开始监视工作的稳定性和流量的返回。 连接CF之后，我们在来自其中一台服务器的流量统计图中看到了这张图片（来自Hetzner统计信息的图片）： </p><br><p><img src="https://habrastorage.org/webt/84/c0/qm/84c0qmol58xtmgavixvz0z5mjra.png"></p><br><p> 传入流量在误差范围内发生了变化（这已由上载新照片的计划确认，并为此制定了单独的监视指标），连接CF时此服务器上的传出流量下降了3倍以上。 实际总流量下降了3倍，只是CF开始以不同的方式在服务器之间分配流量。 </p><br><p> 例如，来自我们的监视系统的同一服务器的图形（持续了3个月，因此它不会太小）： </p><br><p><img src="https://habrastorage.org/webt/iv/rx/md/ivrxmdiavqwdhzd-fjz12rto1us.png"></p><br><p> 并根据其他人之一： </p><br><p><img src="https://habrastorage.org/webt/1d/6u/en/1d6uenbn3f3htgpmtr1dbqvt6ss.png"></p><br><p> 但是总体流量仍然下降了20％，即  CF为项目节省了一些流量。 </p><br><p> 平均延迟有所增加，但我们将不会显示这些图表。 </p><br><p> 原因：Cloudflare在俄罗斯没有几个分销点。 在欧洲和北美，它已经更加有效。 </p><br><p> 并且与流量并行，我们监视使用服务的活动。 新照片将上传到该服务，我们会监控它们的数量（和传入流量）。 </p><br><p> 从其中一台处理上传照片请求的服务器安排3个月（4月至6月）的时间： </p><br><p><img src="https://habrastorage.org/webt/1d/6u/en/1d6uenbn3f3htgpmtr1dbqvt6ss.png"></p><br><p> 这是另一台服务器： </p><br><p><img src="https://habrastorage.org/webt/ut/cu/1_/utcu1_2wvgrovfdvcwuzgr2ewfi.png"></p><br><p>  Cloudflare开始以略有不同的方式分配后端流量。 但是内容继续加载，服务正常运行，质量没有灾难性的下降（根据用户评论，原则上差异并不明显）。 </p><br><p> 也有在Cloudflare中获得被阻止地址的风险，但是您可以通过收取有偿关税来减少地址。 <br> 完成ILV地毯锁后，我们禁用了Cloudflare。 </p><br><h2 id="kakov-itog"> 结果如何？ </h2><br><ul><li> 对于每月5至20美元（在我们的示例中仅为5美元/月），您可以解决类似的问题，而不必花费数千美元租用更昂贵的服务器和传输数据。 </li><li> 即使对于流量达到TB的项目，免费或几乎免费的解决方案也是合适的。 经实践证明。 </li></ul><br><p> 作为替代： </p><br><ul><li>  DDoS-GUARD提供带有流量代理的免费资费，并防御DDoS攻击。 </li><li> 几家DDoS防护服务提供商提供了免费的此类服务帮助服务。  （顺便说一句，我们也没有花额外的钱来解决带锁的问题）。 </li><li> 您可以使用一种著名的CDN服务：keycdn.com，cdn77.com，Akamai CDN，CDNVideo，Ngenix.net等。它们解决了阻止其客户自身受到保护的问题。 但这a）更加昂贵b）无法解决返回非静态内容的问题。 </li><li> 您可以连接另一个代理和DDoS保护服务（例如，我们与Qrator和SkyparkCDN / G-Core Labs进行了很多合作），但是它们将需要为每兆位的有用流量付费，这确实非常昂贵。 </li><li> 可以在全球任何提供商中部署“您的未锁定前端”，同时您需要选择一个未锁定地址范围并确保服务器与前端服务器之间的良好连接。 如果您确实需要这样做，可以先从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">列表中</a>自动检查地址，也可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>手动检查地址。 </li></ul><br><p> 就个人而言，我建议为此类“前端”提供packet.net和servers.com-出色的连接性以及按小时计费服务器的能力。 </p><br><p>  ps如果有的话-我是RedSlerm发言人之一。 来吧，这将很有趣： <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://slurm.io/redslurm/</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN424513/">https://habr.com/ru/post/zh-CN424513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN424503/index.html">自己动手，春天来了（第1部分）</a></li>
<li><a href="../zh-CN424505/index.html">“我们对Maven 4甚至Maven 5都有想法”-采访Maven项目的主要参与者Robert Scholte</a></li>
<li><a href="../zh-CN424507/index.html">第六届年度JetBrains Hackathon：Shiftius Altius Ctrlius</a></li>
<li><a href="../zh-CN424509/index.html">使用KOMPAS-3D API→第12课→复合线</a></li>
<li><a href="../zh-CN424511/index.html">用于在Java中查找带注释的类的工具</a></li>
<li><a href="../zh-CN424517/index.html">使用不完整输入集的Quine \ McCluskey方法实现逻辑功能的最小化</a></li>
<li><a href="../zh-CN424519/index.html">贝多芬可以发送删除请求吗？</a></li>
<li><a href="../zh-CN424525/index.html">迷你钻头速度控制</a></li>
<li><a href="../zh-CN424531/index.html">微服务：即使您拥有Kubernetes，规模也很重要</a></li>
<li><a href="../zh-CN424533/index.html">“任何自重的IT人员都在业余时间从事技术工作”-程序员的10个问题，第6期</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>