<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÇ ü¶ì ü•í Comment reconna√Ætre le texte d'une photo: nouvelles fonctionnalit√©s du cadre Vision üåî üíÖüèº üôçüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Maintenant, le cadre Vision est capable de reconna√Ætre le texte pour de vrai, et non plus comme avant. Nous attendons avec impatience le moment o√π nou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment reconna√Ætre le texte d'une photo: nouvelles fonctionnalit√©s du cadre Vision</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/459668/">  Maintenant, le cadre Vision est capable de reconna√Ætre le texte pour de vrai, et non plus comme avant.  Nous attendons avec impatience le moment o√π nous pourrons l'appliquer √† Dodo IS.  En attendant, une traduction d'un article sur la reconnaissance des cartes du jeu de soci√©t√© Magic The Gathering et leur extraction d'informations textuelles. <br><br><img src="https://habrastorage.org/webt/2l/xs/d5/2lxsd5kor2fezmc7qsrvgnzf7tm.png"><br><a name="habracut"></a><br><br>  Le cadre Vision a √©t√© pr√©sent√© pour la premi√®re fois au grand public √† la WWDC en 2017, avec iOS 11. <br><br>  Vision a √©t√© cr√©√© pour aider les d√©veloppeurs √† classer et identifier les objets, les plans horizontaux, les codes-barres, les expressions faciales et le texte. <br><br>  Cependant, il y avait un probl√®me avec la reconnaissance de texte: Vision pouvait trouver l'endroit o√π se trouve le texte, mais la reconnaissance de texte r√©elle ne s'est pas produite.  Bien s√ªr, c'√©tait agr√©able de voir la bo√Æte englobante autour des fragments de texte individuels, mais ensuite ils devaient √™tre retir√©s et reconnus ind√©pendamment. <br><br>  Ce probl√®me a √©t√© r√©solu dans la mise √† jour Vision, qui √©tait incluse dans iOS 13. D√©sormais, le cadre Vision fournit une v√©ritable reconnaissance de texte. <br><br>  Pour tester cela, j'ai cr√©√© une application tr√®s simple qui peut reconna√Ætre une carte du jeu de soci√©t√© Magic The Gathering et en extraire des informations textuelles: <br><br><ul><li>  nom de la carte; </li><li>  code de version; </li><li>  num√©ro de collection (aka code postal). </li></ul><br>  Voici un exemple de carte et de texte s√©lectionn√© que je souhaite recevoir. <br><br><img src="https://habrastorage.org/webt/yt/je/_1/ytje_1zq4exjtvj_srlty1e7wb0.png"><br><br>  En regardant la carte, vous pourriez penser: "Ce texte est plut√¥t petit, et il y a beaucoup d'autres textes sur la carte qui peuvent interf√©rer."  Mais pour Vision, ce n'est pas un probl√®me. <br><br>  Nous devons d'abord cr√©er un <code>VNRecognizeTextRequest</code> .  Essentiellement, ceci est une description de ce que nous esp√©rons reconna√Ætre, ainsi qu'un param√®tre de langue de reconnaissance et un niveau de pr√©cision: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-type"><span class="hljs-type">VNRecognizeTextRequest</span></span>(completionHandler: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.handleDetectedText) request.recognitionLevel = .accurate request.recognitionLanguages = [<span class="hljs-string"><span class="hljs-string">"en_GB"</span></span>]</code> </pre> <br>  Le bloc d'ach√®vement a la forme <code>handleDetectedText(request: VNRequest?, error: Error?)</code> .  Nous la transmettons au constructeur <code>VNRecognizeTextRequest</code> , puis d√©finissons les propri√©t√©s restantes. <br><br>  Deux niveaux de pr√©cision de reconnaissance sont disponibles: <code>.fast</code> et <code>.accurate</code> .  Puisque notre carte a un texte plut√¥t petit en bas, j'ai choisi une pr√©cision plus √©lev√©e.  L'option plus rapide est probablement mieux adapt√©e aux gros volumes de texte. <br><br>  J'ai limit√© la reconnaissance √† l'anglais britannique, car toutes mes cartes y sont. Vous pouvez sp√©cifier plusieurs langues, mais vous devez comprendre que la num√©risation et la reconnaissance peuvent prendre un peu plus de temps pour chaque langue suppl√©mentaire. <br>  Il y a deux autres propri√©t√©s qui m√©ritent d'√™tre mentionn√©es: <br><br><ul><li>  <code>customWords</code> : vous pouvez ajouter un tableau de cha√Ænes √† utiliser au-dessus du lexique int√©gr√©.  Ceci est utile s'il y a des mots inhabituels dans votre texte.  Je n'ai pas utilis√© l'option pour ce projet.  Mais si je devais faire l'application commerciale de reconnaissance de cartes Magic The Gathering, j'ajouterais certaines des cartes les plus complexes (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fblthp, the Lost</a> ) pour √©viter les probl√®mes. </li><li>  <code>minimumTextHeight</code> : il s'agit d'une valeur flottante.  Il indique la taille par rapport √† la hauteur de l'image √† laquelle le texte ne doit plus √™tre reconnu.  Si j'ai cr√©√© ce scanner juste pour obtenir le nom de la carte, il serait utile de supprimer tout autre texte qui n'est pas n√©cessaire.  Mais j'ai besoin des plus petits morceaux de texte, donc pour l'instant j'ai ignor√© cette propri√©t√©.  √âvidemment, si vous ignorez les petits textes, la vitesse de reconnaissance sera plus √©lev√©e. </li></ul><br>  Maintenant que nous avons notre demande, nous devons la transmettre avec l'image au gestionnaire de demande: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> requests = [textDetectionRequest] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> imageRequestHandler = <span class="hljs-type"><span class="hljs-type">VNImageRequestHandler</span></span>(cgImage: cgImage, orientation: .<span class="hljs-keyword"><span class="hljs-keyword">right</span></span>, options: [:]) <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.global(qos: .userInitiated).async { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> imageRequestHandler.perform(requests) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Error: \(error)"</span></span>) } }</code> </pre> <br>  J'utilise l'image directement depuis la cam√©ra, en la convertissant de <code>UIImage</code> en <code>CGImage</code> .  Il est utilis√© dans <code>VNImageRequestHandler</code> avec l'indicateur d'orientation pour aider le gestionnaire √† comprendre le texte qu'il doit reconna√Ætre. <br><br>  Dans le cadre de cette d√©mo, j'utilise le t√©l√©phone uniquement en orientation portrait.  Alors naturellement, j'ajoute l'orientation.  Alors padaji! <br><br>  Il s'av√®re que l'orientation de l'appareil photo sur votre appareil est compl√®tement distincte de la rotation de l'appareil et est toujours consid√©r√©e √† gauche (comme c'√©tait le cas par d√©faut en 2009, pour prendre des photos, vous devez garder le t√©l√©phone en orientation paysage).  Bien s√ªr, les temps ont chang√© et nous prenons essentiellement des photos et des vid√©os au format portrait, mais l'appareil photo est toujours align√© √† gauche. <br><br>  D√®s que notre gestionnaire est configur√©, nous entrons dans le flux avec la priorit√© <code>.userInitiated</code> et essayons de r√©pondre √† nos demandes.  Vous remarquerez peut-√™tre qu'il s'agit d'un tableau de requ√™tes.  Cela se produit car vous pouvez essayer d'extraire plusieurs √©l√©ments de donn√©es en une seule passe (c'est-√†-dire identifier les visages et le texte de la m√™me image).  S'il n'y a pas d'erreur, le rappel cr√©√© √† l'aide de notre demande sera appel√© apr√®s la d√©tection du texte: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleDetectedText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: VNRequest?, error: Error?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"ERROR: \(error)"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> results = request?.results, results.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"No text found"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> results { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> observation = result <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">VNRecognizedTextObservation</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> text <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> observation.topCandidates(<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(text.string) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(text.confidence) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(observation.boundingBox) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>) } } } }</code> </pre> <br>  Notre gestionnaire renvoie notre requ√™te, qui a maintenant la propri√©t√© results.  Chaque r√©sultat est une <code>VNRecognizedTextObservation</code> , qui pour nous a plusieurs options pour le r√©sultat (ci-apr√®s - les candidats). <br><br>  Vous pouvez obtenir jusqu'√† 10 candidats pour chaque unit√© de texte reconnu, et ils sont tri√©s par ordre d√©croissant de confiance.  Cela peut √™tre utile si vous avez une terminologie que l'analyseur ne reconna√Æt pas correctement lors du premier essai.  Mais le d√©termine correctement plus tard, m√™me s'il est moins confiant dans l'exactitude du r√©sultat. <br><br>  Dans cet exemple, nous n'avons besoin que du premier r√©sultat, nous parcourons donc <code>observation.topCandidates(1)</code> et extrayons √† la fois le texte et la confiance.  Bien que le candidat lui-m√™me ait un texte et une confiance diff√©rents, la <code>.boundingBox</code> reste la m√™me.  <code>.boundingBox</code> utilise un syst√®me de coordonn√©es normalis√© avec l'origine dans le coin inf√©rieur gauche, donc s'il doit √™tre utilis√© dans UIKit √† l'avenir, pour votre commodit√©, il doit √™tre converti. <br><br>  C'est presque tout ce dont vous avez besoin.  Si j'ex√©cute une <a href="">photo de la carte</a> , j'obtiens le r√©sultat suivant en moins de 0,5 seconde sur l'iPhone XS Max: <br><br><pre> <code class="markdown hljs">Carnage Tyrant 1.0 (0.2654155572255453, 0.6955686092376709, 0.18710780143737793, 0.019915008544921786) Creature 1.0 (0.26317582130432127, 0.423814058303833, 0.09479101498921716, 0.013565015792846635) Dinosaur 1.0 (0.3883238156636556, 0.42648010253906254, 0.10021591186523438, 0.014479541778564364) Carnage Tyrant can't be countered. 1.0 (0.26538230578104655, 0.3742666244506836, 0.4300231456756592, 0.024643898010253906) Trample, hexproof 0.5 (0.2610074838002523, 0.34864263534545903, 0.23053167661031088, 0.022259855270385653) Sun Empire commanders are well versed 1.0 (0.2619712670644124, 0.31746063232421873, 0.45549616813659666, 0.022649812698364302) in advanced martial strategy. Still, the 1.0 (0.2623249689737956, 0.29798884391784664, 0.4314465204874674, 0.021180248260498136) correct maneuver is usually to deploy the 1.0 (0.2620727062225342, 0.2772137641906738, 0.4592740217844645, 0.02083740234375009) giant, implacable death lizard. 1.0 (0.2610833962758382, 0.252408218383789, 0.3502468903859457, 0.023736238479614258) 7/6 0.5 (0.6693102518717448, 0.23347826004028316, 0.04697717030843107, 0.018937730789184593) 179/279 M 1.0 (0.24829587936401368, 0.21893787384033203, 0.08339192072550453, 0.011646795272827193) XLN: EN N YEONG-HAO HAN 0.5 (0.246867307027181, 0.20903720855712893, 0.19095951716105145, 0.012227916717529319) TN &amp; 0 2017 Wizards of the Coast 1.0 (0.5428387324015299, 0.21133480072021482, 0.19361832936604817, 0.011657810211181618)</code> </pre> <br><blockquote>  C'est incroyable!  Chaque morceau de texte a √©t√© reconnu, plac√© dans sa propre bo√Æte englobante et retourn√© en cons√©quence avec une note de confiance de 1,0. </blockquote><br>  M√™me un tr√®s petit droit d'auteur est g√©n√©ralement correct.  Tout cela a √©t√© fait sur une image 3024x4032 pesant 3,1 Mo.  Le processus serait encore plus rapide si je r√©duisais d'abord l'image.  Il convient √©galement de noter que ce processus est beaucoup plus rapide sur les nouvelles puces bioniques A12, qui ont un moteur neuronal sp√©cial. <br><br>  Lorsque le texte est reconnu, la derni√®re chose √† faire est de retirer les informations dont j'ai besoin.  Je ne mettrai pas tout le code ici, mais la logique cl√© est d' <code>.boundingBox</code> sur chaque <code>.boundingBox</code> d√©terminer l'emplacement, afin que je puisse s√©lectionner le texte dans le coin inf√©rieur gauche et dans le coin sup√©rieur gauche, en ignorant tout ce qui se trouve plus √† droite. <br><blockquote>  Le r√©sultat final est une application de carte de num√©risation et me renvoie le r√©sultat en moins d'une seconde. </blockquote><br>  PS En fait, je n'ai besoin que d'un code de version et d'un num√©ro de collection (c'est un index).  Ensuite, ils peuvent √™tre utilis√©s dans l'API du service Scryfall pour obtenir toutes les informations possibles sur cette carte, y compris les r√®gles du jeu et le co√ªt. <br><br><img src="https://habrastorage.org/webt/om/gp/hr/omgphr0qi2qla1vyp_0cyqdsdfs.png"><br><br>  Un exemple d'application est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459668/">https://habr.com/ru/post/fr459668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459650/index.html">Comment ne pas perdre d'argent dans la bo√Æte noire: m√©thodes de test de facturation</a></li>
<li><a href="../fr459652/index.html">Approche de test de r√©gression automatis√©e</a></li>
<li><a href="../fr459656/index.html">Service OData sans √©crire de code</a></li>
<li><a href="../fr459658/index.html">PVS-Studio voulait mais n'a pas pu trouver de bugs dans robots.txt</a></li>
<li><a href="../fr459662/index.html">PVS-Studio voulait, mais n'a pas pu trouver de bogues dans robots.txt</a></li>
<li><a href="../fr459670/index.html">Aller √† Amsterdam</a></li>
<li><a href="../fr459672/index.html">Souligner en Python</a></li>
<li><a href="../fr459674/index.html">Threat Intelligence Epic Saga</a></li>
<li><a href="../fr459680/index.html">Suite √† Highload ++ Siberia 2019 - 8 t√¢ches Oracle</a></li>
<li><a href="../fr459682/index.html">Qualit√© des donn√©es en stockage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>