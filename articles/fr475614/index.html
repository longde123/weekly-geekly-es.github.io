<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî¥ üòß üöæ Automatisation pour les plus petits. Deuxi√®me partie. Conception du r√©seau üé® üèí üöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans les deux premiers articles, j'ai soulev√© la question de l'automatisation et esquiss√© son cadre, dans le second j'ai fait une digression dans la v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatisation pour les plus petits. Deuxi√®me partie. Conception du r√©seau</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475614/">  Dans les deux premiers articles, j'ai soulev√© la question de l'automatisation et esquiss√© son cadre, dans le second j'ai fait une digression dans la virtualisation de r√©seau, comme premi√®re approche pour automatiser la configuration des services. <br>  Et maintenant, il est temps de dessiner un sch√©ma de r√©seau physique. <br><br>  Si vous n'√™tes pas sur un pied court avec l'appareil des r√©seaux de centres de donn√©es, alors je recommande fortement de commencer par un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article √† leur sujet</a> . <br><br>  Tous les num√©ros: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">0. ADSM.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie z√©ro.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Planification</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1. ADSM.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Premi√®re partie (qui est apr√®s z√©ro).</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Virtualisation du r√©seau</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2. ADSM.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Deuxi√®me partie.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conception du r√©seau</a> </li></ul><br>  Les pratiques d√©crites dans cette s√©rie devraient √™tre applicables √† un r√©seau de tout type, √† toute √©chelle, avec toute vari√©t√© de fournisseurs (non).  Cependant, un exemple universel de l'application de ces approches ne peut √™tre d√©crit.  Par cons√©quent, je me concentrerai sur l'architecture moderne du r√©seau DC: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Klose Factory</a> . <br>  DCI fera l'affaire sur MPLS L3VPN. <br><br>  Un r√©seau Overlay de l'h√¥te s'ex√©cute au-dessus du r√©seau physique (il peut s'agir d'OpenStack VXLAN ou de Tungsten Fabric ou de tout autre √©l√©ment qui ne n√©cessite qu'une connectivit√© IP de base du r√©seau). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e13/b5a/aa8/e13b5aaa8e2c2161e75084de878ed741.jpg" width="600"></a> <br><br>  Dans ce cas, nous obtenons un sc√©nario d'automatisation relativement simple, car nous avons beaucoup d'√©quipements configur√©s de la m√™me mani√®re. <br><br>  Nous choisirons un DC sph√©rique sous vide: <br><br><ul><li>  Une version du design est partout. </li><li>  Deux vendeurs formant deux plans du r√©seau. </li><li>  Un DC est comme un autre comme deux gouttes d'eau. </li></ul><br><hr><br><a name="habracut"></a><br><h1>  Table des mati√®res </h1><br><ul><li>  <b>Topologie physique</b> </li><li>  <b>Acheminement</b> </li><li>  <b>Plan IP</b> </li><li>  <b>Laba</b> </li><li>  <b>Conclusion</b> </li><li>  <b>Liens utiles</b> </li></ul><br>  Laissez notre fournisseur de services LAN_DC, par exemple, h√©berger des vid√©os de formation sur la survie dans les ascenseurs bloqu√©s. <br><br>  Dans les m√©gapoles, c'est extr√™mement populaire, il y a donc beaucoup de machines physiques. <br><br>  Tout d'abord, je vais d√©crire le r√©seau √† peu pr√®s comme je voudrais le voir.  Et puis je vais le simplifier pour le laboratoire. <br><br><hr><br><br><h1>  Topologie physique </h1><br><h2>  Emplacements </h2><br>  LAN_DC aura 6 DC: <br><ul><li>  Russie ( <b>RU</b> ): <br><ul><li>  Moscou ( <b>msk</b> ) </li><li>  Kazan ( <b>kzn</b> ) </li></ul><br></li><li>  Espagne ( <b>SP</b> ): <br><ul><li>  Barcelone ( <b>bcn</b> ) </li><li>  Malaga ( <b>mlg</b> ) </li></ul><br></li><li>  Chine ( <b>CN</b> ): <br><ul><li>  Shanghai ( <b>sha</b> ) </li><li>  Xi'an ( <b>sia</b> ) </li></ul><br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/c79/5f3/6f3/c795f36f3eb1553eaf32f909d570ed16.png" width="800"><br><hr><br><br><h2>  Inside DC (Intra-DC) </h2><br>  Dans tous les DC, r√©seaux de connectivit√© interne identiques bas√©s sur la topologie Clos. <br>  Quels types de r√©seaux sont Klose et pourquoi sont-ils dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> s√©par√©. <br><br>  Dans chaque DC, il y a 10 racks avec des voitures, ils seront num√©rot√©s comme <b>A</b> , <b>B</b> , <b>C</b> Et ainsi de suite. <br><br>  Chaque rack a 30 voitures.  Ils ne nous int√©resseront pas. <br><br>  De plus, dans chaque rack, il y a un commutateur auquel toutes les machines sont connect√©es - c'est <b>le commutateur Top of the Rack - ToR</b> ou bien en termes d'usine Klose, nous l'appellerons <b>Leaf</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3a/5da/d17/e3a5dad17c7aadf1cf95865deaa8e359.png" width="800"><br>  <i>Le sch√©ma g√©n√©ral de l'usine.</i> <br><br>  Nous les nommerons <i><b>XXX</b> -feuille <b>Y</b></i> , o√π <b>XXX</b> est l'abr√©viation √† trois lettres DC et <b>Y</b> est le num√©ro de s√©rie.  Par exemple, <i>kzn-leaf11</i> . <br><blockquote>  Dans les articles, je me permets d'utiliser les termes Leaf et ToR de mani√®re assez frivole, comme synonymes.  Cependant, il faut se rappeler que ce n'est pas le cas. <br>  ToR est un commutateur mont√© en rack auquel les machines se connectent. <br>  Leaf est le r√¥le d'un p√©riph√©rique dans un r√©seau physique ou d'un commutateur de premier niveau en termes de topologie de Clos. <br>  Autrement dit, Leaf! = ToR. <br>  Ainsi, Leaf peut √™tre un commutateur EndofRaw, par exemple. <br>  Cependant, dans le cadre de cet article, nous les d√©signerons n√©anmoins comme des synonymes. <br></blockquote>  Chaque commutateur ToR est √† son tour connect√© √† quatre commutateurs d'agr√©gation en amont - <b>Spine</b> .  Sous Spine'y allou√© un rack dans le DC.  Nous l'appellerons de la m√™me mani√®re: <i><b>XXX-</b> colonne vert√©brale <b>Y.</b></i> <br><br>  Dans le m√™me rack, il y aura un √©quipement r√©seau pour la connectivit√© entre les CC - 2 routeurs avec MPLS √† bord.  Mais dans l'ensemble, ce sont les m√™mes TdR.  Autrement dit, du point de vue des commutateurs Spine, peu importe qu'il existe un ToR habituel avec des machines connect√©es ou un routeur pour DCI - une putain de chose. <br><br>  Ces ToR sp√©ciaux sont appel√©s <b>Edge-leaf</b> .  Nous les appellerons <i><b>XXX</b> bord <b>Y.</b></i> <br><br>  Cela ressemblera √† ceci. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62c/83f/d27/62c83fd278227f1740e5cf4e64eaed4e.png" width="800"><br><br>  Dans le diagramme au-dessus du bord et de la feuille, je me suis vraiment plac√© au m√™me niveau.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les r√©seaux classiques √† trois niveaux</a> nous ont appris √† consid√©rer la liaison montante (le terme vient en fait d'ici), comme des liens.  Et ici, il s'av√®re que la ¬´liaison montante¬ª de DCI redescend, ce qui rompt quelque peu la logique habituelle.  Dans le cas des grands r√©seaux, lorsque les centres de donn√©es sont divis√©s en unit√©s plus petites - <b>POD</b> (Point Of Delivery), des <b>Edge-POD</b> distincts sont allou√©s pour DCI et l'acc√®s aux r√©seaux externes. <br><br>  Pour plus de commodit√©, √† l'avenir, je dessinerai toujours Edge on Spine, tout en gardant √† l'esprit qu'il n'y a pas d'intelligence sur Spine et des diff√©rences lorsque vous travaillez avec une feuille ordinaire et une feuille de bord (bien qu'il puisse y avoir des nuances, mais en g√©n√©ral il en est ainsi). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca5/67d/9db/ca567d9db0c49c3baf63304443477102.png" width="600"><br>  <i>Disposition d'usine avec les feuilles Edge.</i> <br><br>  Trinity Leaf, Spine et Edge forment un r√©seau ou une usine de sous-couches. <br><br>  La t√¢che de l'usine de r√©seau (lire Underlay), comme nous l'avons d√©j√† d√©termin√© dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">num√©ro pr√©c√©dent</a> , est tr√®s, tr√®s simple - fournir une connectivit√© IP entre des machines √† la fois dans le m√™me DC et entre. <br>  C'est pourquoi le r√©seau est appel√© une usine, tout comme, par exemple, une usine de commutation √† l'int√©rieur de bo√Ætiers de r√©seau modulaires, que vous trouverez plus en d√©tail dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SDSM14</a> . <br><blockquote>  En g√©n√©ral, une telle topologie est appel√©e usine, car le tissu en traduction est un tissu.  Et c'est difficile de ne pas √™tre d'accord: <br><img src="https://habrastorage.org/getpro/habr/post_images/7e9/db7/2c3/7e9db72c353e6b5b050eb63de72bb111.png" width="300"><br></blockquote><br>  Usine compl√®tement L3.  Pas de VLAN, pas de diffusion - ce sont d'excellents programmeurs √† LAN_DC, ils peuvent √©crire des applications qui vivent dans le paradigme L3, et les machines virtuelles ne n√©cessitent pas de migration en direct avec l'enregistrement de l'adresse IP. <br><br>  Et encore: la r√©ponse √† la question de savoir pourquoi l'usine et pourquoi L3 - dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> s√©par√©. <br><hr><br><br><h2>  DCI - Data Center Interconnect (Inter-DC) </h2><br>  DCI sera organis√© en utilisant Edge-Leaf, c'est-√†-dire qu'ils sont notre point de sortie vers l'autoroute. <br>  Pour simplifier, nous supposons que les contr√¥leurs de domaine sont connect√©s par des liaisons directes. <br>  Nous excluons la connectivit√© externe de la consid√©ration. <br><blockquote>  Je suis conscient que chaque fois que je supprime un composant, je simplifie consid√©rablement le r√©seau.  Et avec l'automatisation de notre r√©seau abstrait, tout ira bien, mais des b√©quilles appara√Ætront sur le vrai. <br>  C'est vrai.  N√©anmoins, le but de cette s√©rie est de penser et de travailler sur des approches, et non de r√©soudre h√©ro√Øquement des probl√®mes imaginaires. <br></blockquote><br>  Sur Edge-Leafs, la sous-couche est plac√©e dans le VPN et transmise via le r√©seau principal MPLS (le m√™me lien direct). <br><br>  Voici un tel sch√©ma de haut niveau. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4e/ad7/b78/e4ead7b7898490c29fa93f7375376aa8.png" width="800"><br><br><hr><br><br><h1>  Acheminement </h1><br><br>  Pour le routage √† l'int√©rieur du DC, nous utiliserons BGP. <br>  Sur le tronc OSPF + LDP MPLS <br>  Pour DCI, c'est-√†-dire que l'organisation de la connectivit√© en dessous est BGP L3VPN sur MPLS. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a55/3b1/30b/a553b130b286a50fd1c97fe8bb2b5b5b.png" width="800"><br>  <i>Sch√©ma de routage g√©n√©ral</i> <br><br>  Il n'y a pas d'OSPF et d'ISIS en usine (protocole de routage interdit dans la F√©d√©ration de Russie). <br><br>  Et cela signifie qu'il n'y aura pas de d√©tection automatique et de calculs de chemin le plus court - uniquement manuel (en fait automatique - nous sommes ici sur l'automatisation) pour configurer le protocole, le voisinage et les politiques. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82b/426/251/82b4262513aeae7c12d6e1618182f272.png" width="600"><br>  <i>Sch√©ma de routage BGP √† l'int√©rieur du DC</i> <br><br>  <b>Pourquoi BGP?</b> <br><br>  Il existe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tout un RFC</a> nomm√© Facebook et Arista √† ce sujet, qui explique comment construire de <b>tr√®s grands</b> r√©seaux de centres de donn√©es √† l'aide de BGP.  Il se lit presque comme un art, vivement recommand√© pour une soir√©e langoureuse. <br><br>  Et toute une section de mon article y est consacr√©e.  O√π je <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t'envoie</a> . <br><br>  Mais, en bref, aucun IGP ne convient aux r√©seaux de grands centres de donn√©es, o√π comptent des milliers de p√©riph√©riques r√©seau. <br><br>  De plus, l'utilisation de BGP partout vous permet de ne pas pulv√©riser sur le support de plusieurs protocoles diff√©rents et la synchronisation entre eux. <br><blockquote>  La main sur le c≈ìur, dans notre usine, qui avec un haut degr√© de probabilit√© ne se d√©veloppera pas rapidement, l'OSPF suffirait aux yeux.  Ce sont en fait les probl√®mes des m√©gascaleurs et des titans du cloud.  Mais imaginons quelques probl√®mes dont nous avons besoin, et nous utiliserons BGP, comme l‚Äôa l√©gu√© Peter Lapukhov. <br></blockquote><br><hr><br><br><h2>  Strat√©gies de routage </h2><br>  Sur les commutateurs Leaf, nous importons dans les pr√©fixes BGP des interfaces Underlay avec les r√©seaux. <br>  Nous aurons une session BGP entre <b>chaque</b> paire Leaf-Spine dans laquelle ces pr√©fixes Underlay seront annonc√©s sur un r√©seau de flaques d'eau. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85a/4b0/38d/85a4b038dc57c9fc54f1fb1ad10a5172.png" width="800"><br><br>  Dans un centre de donn√©es, nous distribuerons les sp√©cificit√©s qui ont √©t√© import√©es dans ToRe.  Sur Edge-Leafs, nous les agr√©gerons et les annoncerons dans les contr√¥leurs de domaine distants et les abaisserons en ToR.  C'est-√†-dire que chaque ToR saura exactement comment se rendre √† un autre ToR dans le m√™me DC et o√π est le point d'entr√©e pour acc√©der au ToR dans un autre DC. <br><br>  Dans DCI, les itin√©raires seront transmis en tant que VPNv4.  Pour ce faire, sur l'Edge-Leaf, l'interface vers l'usine sera plac√©e dans VRF, appelons-la UNDERLAY, et le quartier avec Spine sur l'Edge-Leaf augmentera √† l'int√©rieur du VRF, et entre les Edge-Leafs de la famille VPNv4. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/231/d58/9d6/231d589d6ae0bcd63e4f60028771cd95.png" width="800"><br><br>  Et nous interdirons √©galement de r√©annoncer les itin√©raires re√ßus des √©pines, de retour vers eux. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f0/f41/dfa/3f0f41dfa8510d48849ef8743f5b757a.png" width="500"><br><br>  Sur Leaf and Spine, nous n'importerons pas de boucles.  Nous en avons besoin uniquement pour d√©terminer l'ID du routeur. <br><br>  Mais sur Edge-Leafs, nous l'importons dans Global BGP.  Entre les adresses de bouclage, Edge Leafs √©tablira une session BGP dans la famille VPN IPv4 entre elles. <br><br>  Entre les appareils EDGE, nous aurons une dorsale OSPF + LDP.  Le tout dans une seule zone.  Configuration extr√™mement simple. <br><br>  Voici une photo du routage. <br><hr><br><br><h2>  BGP ASN </h2><br><h3>  Edge-Leaf ASN </h3><br>  Sur les Edge-Leafs, il y aura un ASN dans tous les DC.  Il est important qu'il y ait un iBGP entre les Edge-Leafs et que nous ne rencontrions pas les nuances de l'eBGP.  Soit 65535. En r√©alit√©, ce pourrait √™tre un num√©ro AS public. <br><br><h3>  Spine ASN </h3><br>  Chez Spine, nous aurons un ASN par DC.  Commen√ßons ici par le tout premier num√©ro de la gamme AS priv√©e - 64512, 64513 Et ainsi de suite. <br><br>  Pourquoi l'ASN est-il sur DC? <br><br>  Nous d√©composons cette question en deux: <br><br><ul><li>  Pourquoi les m√™mes ASN sur toutes les √©pines du m√™me DC? </li><li>  Pourquoi sont-ils diff√©rents dans diff√©rents DC? </li></ul><br>  <b>Pourquoi les m√™mes ASN sur toutes les √©pines d'un DC</b> <br><br>  Voici √† quoi ressemblera l'itin√©raire AS-Path Anderlay sur Edge-Leaf: <br> <code>[leafX_ASN, <b>spine_ASN</b> , edge_ASN]</code> <br>  Si vous essayez de l'annoncer √† Spine, il le supprimera car son AS (Spine_AS) est d√©j√† sur la liste. <br><br>  Cependant, au sein du DC, nous sommes enti√®rement convaincus que les itin√©raires Underlay qui ont grimp√© jusqu'√† Edge ne pourront pas descendre.  Toutes les communications entre les h√¥tes au sein du contr√¥leur de domaine doivent se produire au niveau de la colonne vert√©brale. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b3/cec/64c/0b3cec64c8666b0154f041bd64c9059b.png" width="800"><br><br>  Dans le m√™me temps, les routes agr√©g√©es d'autres DC en tout cas atteindront librement les ToR - dans leur AS-Path, il n'y aura que ASN 65535 - le nombre d'AS Edge-Leafs, car c'est sur eux qu'ils ont √©t√© cr√©√©s. <br><br>  <b>Pourquoi sont diff√©rents dans diff√©rents DC</b> <br><br>  Th√©oriquement, nous pourrions avoir besoin de faire glisser les boucles et certaines machines virtuelles de service entre les contr√¥leurs de domaine. <br><br>  Par exemple, sur l'h√¥te, nous ex√©cuterons un r√©flecteur de route ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le m√™me VNGW</a> (passerelle de r√©seau virtuel), qui sera verrouill√© avec ToR via BGP et annoncera son bouclage, qui devrait √™tre disponible sur tous les contr√¥leurs de domaine. <br><br>  Voici donc √† quoi ressemblera son AS-Path: <br> <code>[VNF_ASN, leafX_DC1_ASN, <b>spine_DC1_ASN</b> , edge_ASN, <b>spine_DC2_ASN</b> , leafY_DC2_ASN]</code> <br> <br>  Et ici, il ne devrait y avoir aucun ASN en double nulle part. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fee/b97/61f/feeb9761f4964eda7f7519464927f61e.png" width="800"><br><br>  Autrement dit, Spine_DC1 et Spine_DC2 devraient √™tre diff√©rents, tout comme leafX_DC1 et leafY_DC2, ce qui est exactement ce que nous approchons. <br><blockquote>  Comme vous le savez probablement, il existe des hacks qui vous permettent d'accepter des routes avec des ASN r√©p√©titifs contrairement au m√©canisme de pr√©vention de boucle (allowas-in sur Cisco).  Et il a m√™me des utilisations tout √† fait l√©gitimes.  Mais il s'agit d'une violation potentielle de la r√©silience du r√©seau.  Et je suis personnellement tomb√© dedans √† quelques reprises. <br><br>  Et si nous avons la possibilit√© de ne pas utiliser de choses dangereuses, nous l‚Äôutiliserons. <br></blockquote><br><h3>  Leaf asn </h3><br>  Nous aurons un ASN individuel sur chaque commutateur Leaf du r√©seau. <br>  Nous le faisons pour les raisons indiqu√©es ci-dessus: AS-Path sans boucles, configuration BGP sans signets. <br><br>  Pour que les routes entre Leafs passent sans entrave, AS-Path devrait ressembler √† ceci: <br> <code>[leafX_ASN, spine_ASN, leafY_ASN]</code> <br>  o√π leafX_ASN et leafY_ASN serait bien d'√™tre diff√©rent. <br><br>  Ceci est √©galement requis pour la situation avec l'annonce du bouclage VNF entre les contr√¥leurs de domaine: <br> <code>[VNF_ASN, <b>leafX_DC1_ASN</b> , spine_DC1_ASN, edge_ASN, spine_DC2_ASN, <b>leafY_DC2_ASN</b> ]</code> <br> <br>  Nous allons utiliser un ASN √† 4 octets et le g√©n√©rer en fonction de l'ASN de Spine et du num√©ro de commutateur de feuille, √† savoir, comme ceci: <i>Spine_ASN.0000X</i> . <br><hr><br><br>  Voici une photo avec l'ASN. <br><img src="https://habrastorage.org/getpro/habr/post_images/c4a/f3b/66c/c4af3b66cff4bb0589ee0c6ef98134cf.png" width="800"><br><hr><br><br><h1>  Plan IP </h1><br><br>  Fondamentalement, nous devons allouer des adresses pour les connexions suivantes: <br><br><ol><li>  Les adresses r√©seau sous-jacentes entre ToR et la machine.  Ils doivent √™tre uniques sur tout le r√©seau afin que toute machine puisse communiquer avec une autre.  Id√©al pour <b>10/8</b> .  Pour chaque rack / 26 avec une marge.  Nous allouerons / 19 pour DC et / 17 pour la r√©gion. <br></li><li>  Liez les adresses entre Leaf / Tor et Spine. <br><br>  Je voudrais les attribuer de mani√®re algorithmique, c'est-√†-dire calculer √† partir des noms des appareils qui doivent √™tre connect√©s. <br><br>  Que ce soit ... 169.254.0.0/16. <br>  A savoir, <b>169.254.00X.Y / 31</b> , o√π <b>X</b> est le num√©ro Spine, <b>Y</b> est le r√©seau P2P / 31. <br>  Cela vous permettra d'ex√©cuter jusqu'√† 128 racks et jusqu'√† 10 Spine dans le DC.  Les adresses de liaison peuvent (et seront) r√©p√©t√©es de DC √† DC. </li><li>  Nous organisons le joint Spine - Edge-Leaf sur les <b>sous-</b> r√©seaux <b>169.254.10X.Y / 31</b> , o√π de la m√™me mani√®re <b>X</b> est le num√©ro Spine, <b>Y</b> est le r√©seau P2P / 31. </li><li>  Liez les adresses de l'Edge-Leaf √† la dorsale MPLS.  Ici, la situation est quelque peu diff√©rente - le lieu de connexion de toutes les pi√®ces en un seul, donc la r√©utilisation des m√™mes adresses ne fonctionnera pas - vous devez s√©lectionner le prochain sous-r√©seau gratuit.  Par cons√©quent, nous prendrons <b>192.168.0.0/16</b> comme base et nous en retirerons des extraits gratuits. </li><li>  Adresses de bouclage.  Donnez-leur toute la gamme <b>172.16.0.0/12</b> . <br><ul><li>  Feuille - √† / 25 par DC - les m√™mes 128 racks.  Attribuer par / 23 √† la r√©gion. </li><li>  Colonne vert√©brale - par / 28 au DC - jusqu'√† 16 vert√®bres.  Attribuer par / 26 √† la r√©gion. </li><li>  Edge-Leaf - par / 29 sur DC - jusqu'√† 8 bo√Ætes.  Attribuer par / 27 √† la r√©gion. </li></ul></li></ol><br>  Si dans le DC, nous n'avons pas assez de plages s√©lectionn√©es (mais elles ne seront pas l√† - nous pr√©tendons √™tre hyper-skeylerostvo), s√©lectionnez simplement le bloc suivant. <br><br>  Voici une image avec l'adressage IP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/def/f08/e49/deff08e49e0fee39e0799dfac4fad2a4.png" width="800"><br><br>  Bouclages: <br><table border="2"><tbody><tr><td>  <b>Pr√©fixe</b> </td><td>  <b>R√¥le d'appareil</b> </td><td>  <b>R√©gion</b> </td><td>  <b>DC</b> </td></tr><tr><td>  172.16.0.0/23 </td><td rowspan="10">  bord </td><td></td><td></td></tr><tr><td>  172.16.0.0/27 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  172.16.0.0/29 </td><td>  msk </td></tr><tr><td>  172.16.0.8/29 </td><td>  kzn </td></tr><tr><td>  172.16.0.32/27 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  172.16.0.32/29 </td><td>  bcn </td></tr><tr><td>  172.16.0.40/29 </td><td>  mlg </td></tr><tr><td>  172.16.0.64/27 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.0.64/29 </td><td>  sha </td></tr><tr><td>  172.16.0.72/29 </td><td>  sia </td></tr><tr><td>  172.16.2.0/23 </td><td rowspan="10">  dos </td><td></td><td></td></tr><tr><td>  172.16.2.0/26 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  172.16.2.0/28 </td><td>  msk </td></tr><tr><td>  172.16.2.16/28 </td><td>  kzn </td></tr><tr><td>  172.16.2.64/26 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  172.16.2.64/28 </td><td>  bcn </td></tr><tr><td>  172.16.2.80/28 </td><td>  mlg </td></tr><tr><td>  172.16.2.128/26 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.2.128/28 </td><td>  sha </td></tr><tr><td>  172.16.2.144/28 </td><td>  sia </td></tr><tr><td>  172.16.8.0/21 </td><td rowspan="10">  feuille </td><td></td><td></td></tr><tr><td>  172.16.8.0/23 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  172.16.8.0/25 </td><td>  msk </td></tr><tr><td>  172.16.8.128/25 </td><td>  kzn </td></tr><tr><td>  172.16.10.0/23 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  172.16.10.0/25 </td><td>  bcn </td></tr><tr><td>  172.16.10.128/25 </td><td>  mlg </td></tr><tr><td>  172.16.12.0/23 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.12.0/25 </td><td>  sha </td></tr><tr><td>  172.16.12.128/25 </td><td>  sia </td></tr></tbody></table><br><br>  Sous-couche: <br><table border="2"><tbody><tr><td>  <b>Pr√©fixe</b> </td><td>  <b>R√©gion</b> </td><td>  <b>DC</b> </td></tr><tr><td>  10.0.0.0/17 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  10.0.0.0/19 </td><td>  msk </td></tr><tr><td>  10.0.32.0/19 </td><td>  kzn </td></tr><tr><td>  10.0.128.0/17 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  10.0.128.0/19 </td><td>  bcn </td></tr><tr><td>  10.0.160.0/19 </td><td>  mlg </td></tr><tr><td>  10.1.0.0/17 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  10.1.0.0/19 </td><td>  sha </td></tr><tr><td>  10.1.32.0/19 </td><td>  sia </td></tr></tbody></table><br><hr><br><br><h1>  Laba </h1><br>  Deux vendeurs.  Un r√©seau.  ADSM. <br><br>  Juniper + Arista.  Ubuntu  Bonne vieille Eve. <br><br>  La quantit√© de ressources sur notre virtuel √† Miran est encore limit√©e, donc pour la pratique, nous utiliserons un tel r√©seau simplifi√© √† la limite. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/477/a27/096/477a2709633866d53fec5972e9417421.png" width="800"><br><br>  Deux centres de donn√©es: Kazan et Barcelone. <br><br><ul><li>  Deux √©pines dans chacune: Juniper et Arista. </li><li>  Un tore (feuille) dans chacun - Juniper et Arista, avec un h√¥te connect√© (prenons pour cela la l√©g√®re IOL Cisco). </li><li>  Un n≈ìud Edge-Leaf (jusqu'√† pr√©sent Juniper uniquement). </li><li>  Un commutateur Cisco pour les gouverner tous. </li><li>  En plus des bo√Ætiers r√©seau, une machine virtuelle de gestion a √©t√© lanc√©e.  Ex√©cuter Ubuntu. <br>  Il a acc√®s √† tous les appareils, aux syst√®mes IPAM / DCIM, √† un tas de scripts Python, ansible et √† tout ce dont nous pourrions avoir besoin. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La configuration compl√®te de</a> tous les p√©riph√©riques r√©seau que nous allons essayer de reproduire en utilisant l'automatisation. <br><hr><br><br><h1>  Conclusion </h1><br>  Aussi accept√©?  Sous chaque article pour faire une courte conclusion? <br><br>  Nous avons donc choisi le r√©seau Klose √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trois niveaux</a> √† l'int√©rieur du DC, car nous attendons beaucoup de trafic Est-Ouest et voulons ECMP. <br><br>  Nous avons divis√© le r√©seau en physique (sous-couche) et virtuel (superposition).  Dans ce cas, la superposition commence √† partir de l'h√¥te - simplifiant ainsi les exigences pour la sous-couche. <br><br>  Nous avons choisi BGP comme protocole de routage pour les r√©seaux non relay√©s pour son √©volutivit√© et la flexibilit√© des politiques. <br><br>  Nous aurons des n≈ìuds s√©par√©s pour l'organisation DCI - Edge-leaf. <br>  Il y aura OSPF + LDP sur le tronc. <br>  DCI sera impl√©ment√© sur la base de MPLS L3VPN. <br>  Pour les liaisons P2P, nous calculerons les adresses IP de mani√®re algorithmique en fonction des noms des appareils. <br>  Les lupbacks seront attribu√©s en fonction du r√¥le des p√©riph√©riques et de leur emplacement de mani√®re s√©quentielle. <br>  Pr√©fixes de calque sous-jacent - uniquement sur les commutateurs Leaf s√©quentiellement en fonction de leur emplacement. <br><br>  Supposons que nous n'ayons pas install√© l'√©quipement pour le moment. <br>  Par cons√©quent, nos prochaines √©tapes seront de les int√©grer dans les syst√®mes (IPAM, inventaire), d'organiser l'acc√®s, de g√©n√©rer une configuration et de la d√©ployer. <br><br>  Dans le prochain article, nous traiterons de Netbox, le syst√®me de gestion de l'inventaire et de l'espace IP dans le DC. <br><hr><br><br><h1>  Merci </h1><br><ul><li>  Andrey Glazkov aka @glazgoo pour la relecture et l'√©dition </li><li>  Alexander Klimenko aka @ v00lk pour la relecture et l'√©dition </li><li>  Artyom Chernobay pour KDPV </li></ul><br><hr></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr475614/">https://habr.com/ru/post/fr475614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr475600/index.html">Comment nous avons connect√© Prometheus</a></li>
<li><a href="../fr475604/index.html">Configuration du mod√®le officiel PostgreSQL sur Zabbix 4.4</a></li>
<li><a href="../fr475608/index.html">Google Tag Manager: param√®tres de d√©clenchement non √©vidents et utiles</a></li>
<li><a href="../fr475610/index.html">Lampes de table LED s√ªres qui conservent la vision</a></li>
<li><a href="../fr475612/index.html">√âtant donn√©, quand, les affirmations et la confiance dans la mise en ≈ìuvre</a></li>
<li><a href="../fr475618/index.html">Comment √©crire un contrat Python intelligent sur le r√©seau Ontology. Partie 2: API de stockage</a></li>
<li><a href="../fr475622/index.html">Extension d'UObject dans Unreal Engine 4</a></li>
<li><a href="../fr475624/index.html">PHP-Watcher: un outil qui simplifie le d√©veloppement d'applications √† longue dur√©e de vie</a></li>
<li><a href="../fr475626/index.html">Les autotests peuvent-ils remplacer une personne √† la recherche de vuln√©rabilit√©s: entretien avec Alexandra Svatikova</a></li>
<li><a href="../fr475630/index.html">Knative - une plate-forme bas√©e sur k8s en tant que service avec prise en charge sans serveur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>