<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÑπÔ∏è üéûÔ∏è üë®‚Äçüé® Ataques de dom√≠nio üòâ üë®‚Äç‚öïÔ∏è üêï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ao realizar testes de penetra√ß√£o, geralmente detectamos erros na configura√ß√£o do dom√≠nio. Embora isso n√£o pare√ßa cr√≠tico para muitos, na realidade, es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ataques de dom√≠nio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/449278/"><img src="https://habrastorage.org/webt/om/yi/ln/omyiln4hxyukdu7znc3sn5j-mzy.png"><br>  Ao realizar testes de penetra√ß√£o, geralmente detectamos erros na configura√ß√£o do dom√≠nio.  Embora isso n√£o pare√ßa cr√≠tico para muitos, na realidade, essas imprecis√µes podem causar comprometimento de todo o dom√≠nio. <br><br>  Por exemplo, de acordo com os resultados do teste em uma empresa, chegamos √† conclus√£o de que todas as m√°quinas dispon√≠veis no dom√≠nio n√£o eram inferiores ao Windows10 / Windows Server2016 e possu√≠am todos os patches mais recentes.  A rede era varrida regularmente, as m√°quinas eram dif√≠ceis.  Todos os usu√°rios passaram por tokens e n√£o sabiam suas "senhas de 20 caracteres".  Tudo parece estar bem, mas o IPv6 n√£o foi desativado.  O esquema de captura de dom√≠nio ficou assim: <br><br>  mitm6 -&gt; ntlmrelay -&gt; ataque atrav√©s da delega√ß√£o -&gt; o hash da senha do administrador local √© recebido -&gt; o hash da senha do administrador do dom√≠nio √© recebido. <br><br>  Infelizmente, certifica√ß√µes populares como OSCP, GPEN ou CEH n√£o ensinam o teste de penetra√ß√£o do Active Directory. <br><br>  Neste artigo, examinaremos v√°rios tipos de ataques do Active Directory que realizamos como parte de pentests, bem como as ferramentas usadas.  Isso de forma alguma pode ser considerado um guia completo para todos os tipos de ataques e ferramentas, existem realmente muitos deles e √© dif√≠cil encaixar em um artigo. <br><br>  Portanto, para demonstra√ß√£o, usamos um laptop no Kali Linux 2019 e os hosts virtuais criados nele no VMware.  Imagine que o principal objetivo do pentest √© obter direitos de administrador de dom√≠nio e, como entrada, temos acesso √† rede corporativa da empresa via Ethernet.  Para come√ßar a testar o dom√≠nio, precisamos de uma conta. <br><a name="habracut"></a><br><h1>  Obtendo uma conta </h1><br>  Considere os dois m√©todos mais comuns, na minha opini√£o, para obter o login e a senha da conta de dom√≠nio: falsifica√ß√£o LLMNR / NBNS e ataque ao protocolo IPv6. <br><br><h3>  LLMNR / NBNS Spoofing </h3><br>  Muito foi dito sobre esse ataque.  A linha inferior √© que o cliente envia multicast LLMNR e transmite consultas NBT-NS para resolver nomes de host, se isso n√£o for poss√≠vel via DNS.  Qualquer usu√°rio da rede pode responder a essas solicita√ß√µes. <br><br>  Ferramentas que permitem um ataque: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Resposta</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Inveight</a> </li><li>  M√≥dulos Metasploit: auxiliar / spoof / llmnr / llmnr_response, auxiliar / spoof / nbns / nbns_response, <br>  auxiliar / servidor / captura / smb, auxiliar / servidor / captura / http_ntlm </li></ul><br>  Com um ataque bem-sucedido, podemos obter o hash NetNTLM da senha do usu√°rio. <br><br><pre><code class="bash hljs">Responder -I eth0 -wrf</code> </pre> <br><img src="https://habrastorage.org/webt/ul/6f/1r/ul6f1rsc1dbtugnzoiup43cofnc.png"><br><br>  O hash resultante, podemos depurar ou executar rel√©s NTLM. <br><br><h3>  Ataque IPv6 </h3><br>  Se o IPv6 for usado na rede corporativa, podemos responder √†s solicita√ß√µes do DHCPv6 e definir nosso endere√ßo IP como o servidor DNS na m√°quina atacada.  Como o IPv6 tem preced√™ncia sobre o IPv4, as consultas DNS do cliente ser√£o enviadas para o nosso endere√ßo.  Leia mais sobre o ataque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Ferramentas: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mitm6</a> </li></ul><br>  Executando o Utilit√°rio mitm6 <br><br><pre> <code class="bash hljs">mitm6 -i vmnet0</code> </pre> <br>  Ap√≥s a conclus√£o do ataque, um novo servidor DNS com o nosso endere√ßo IPv6 aparecer√° na esta√ß√£o de trabalho atacada. <br><br><img src="https://habrastorage.org/webt/ww/w4/w3/www4w3x2eqtuytsmysia_deoi_y.png"><br><br>  M√°quinas atacadas tentar√£o se autenticar com nossa m√°quina.  Tendo aumentado o servidor SMB usando o utilit√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">smbserver.py</a> , podemos obter hashes de senha de usu√°rio. <br><br><pre> <code class="bash hljs">smbserver.py -smb2support SMB /root/SMB</code> </pre> <br><img src="https://habrastorage.org/webt/df/s8/jx/dfs8jxcdecrikctqxdxzbuyq8wk.png"><br><br><h2>  A√ß√µes de Hash capturadas </h2><br>  A pr√≥xima etapa √© executar um ataque criptogr√°fico nos hashes de senha e obter a senha em texto n√£o criptografado ou executar uma retransmiss√£o NTLM. <br><br><h3>  For√ßa bruta da senha </h3><br>  √â simples: use um hash de senha, hashcat <br><br><pre> <code class="bash hljs">hashcat -m 5600 -a 3 hash.txt /usr/share/wordlists/rockyou.txt</code> </pre> <br>  e brutus.  A senha pode ser obtida ou n√£o :) <br><br><img src="https://habrastorage.org/webt/pf/l8/7g/pfl87glgjcfbove5ywlkmul1uyi.png"><br>  <i>A senha do usu√°rio Harvey foi recuperada - Pbvf2019</i> <br><br><h3>  Rel√© NTLM </h3><br>  Tamb√©m podemos executar rel√©s NTLM.  Depois de garantir que a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">assinatura SMB</a> n√£o seja usada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">,</a> usamos o utilit√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ntlmrelayx.py</a> e conduzimos um ataque.  Aqui, novamente, dependendo do objetivo, selecionamos o vetor que precisamos.  Vamos considerar alguns deles. <br><br><br><h4>  Acesso √† m√°quina atacada via protocolo SMB </h4><br>  Realize um ataque com a chave <i>i</i> . <br><br><pre> <code class="bash hljs">ntlmrelayx.py -t 192.168.1.5 -l loot -i</code> </pre> <br><img src="https://habrastorage.org/webt/jk/3w/zu/jk3wzuzoxwr2qnrzhagq7bnweya.png"><br><br>  Com um ataque bem-sucedido, podemos conectar-se √† m√°quina remota usando o netcat. <br><br><img src="https://habrastorage.org/webt/1f/8x/ba/1f8xbajj3gofx2bonp0quqdnxae.png"><br><br><h4>  Coleta de informa√ß√µes de dom√≠nio </h4><br>  Nesse caso, executamos a retransmiss√£o no controlador de dom√≠nio. <br><br><pre> <code class="bash hljs">ntlmrelayx.py -t ldap://192.168.1.2</code> </pre> <br>  Se o ataque for bem-sucedido, obteremos informa√ß√µes detalhadas sobre o dom√≠nio: <br><br><img src="https://habrastorage.org/webt/el/gf/eu/elgfeumon83qjseesppzb8yjitq.png"><br><br><h4>  Adicionando um novo computador ao dom√≠nio </h4><br>  Cada usu√°rio, por padr√£o, pode criar at√© 10 computadores no dom√≠nio.  Para criar um computador, voc√™ precisa executar uma retransmiss√£o em um controlador de dom√≠nio usando o protocolo ldaps.  √â proibido criar usu√°rios e computadores atrav√©s de uma conex√£o LDAP n√£o criptografada.  Al√©m disso, uma conta n√£o pode ser criada se a conex√£o via SMB for interceptada. <br><br><pre> <code class="bash hljs">ntlmrelayx.py -t ldaps://192.168.1.2 --add-computer</code> </pre> <br><img src="https://habrastorage.org/webt/ei/xe/qi/eixeqiuxwttuxx3xmmroqrj8smy.png"><br><br>  Como voc√™ pode ver na figura, conseguimos criar um computador RORYOTGS $. <br><br>  Ao criar mais de 10 computadores, recebemos um erro do seguinte formato: <br><br><img src="https://habrastorage.org/webt/gb/za/ar/gbzaarxwpzhs0zhy4zi8kvwuqjo.png"><br><br>  Usando as credenciais de um computador RORYOTGS $, podemos executar solicita√ß√µes leg√≠timas para um controlador de dom√≠nio. <br><br><h1>  Coleta de informa√ß√µes de dom√≠nio </h1><br>  Portanto, temos uma conta de usu√°rio ou computador do dom√≠nio.  Para continuar testando, precisamos coletar informa√ß√µes dispon√≠veis para um planejamento adicional de ataques.  Considere algumas das ferramentas que nos ajudar√£o a determinar a pesquisa dos sistemas mais cr√≠ticos, planejar e executar um ataque. <br><br><h3>  Bloodhound </h3><br>  Uma das ferramentas mais importantes usadas em quase todos os testes de penetra√ß√£o interna.  O projeto est√° desenvolvendo ativamente e complementado por novos recursos. <br><br><div class="spoiler">  <b class="spoiler_title">Informa√ß√µes coletadas por bloodhound</b> <div class="spoiler_text"><ul><li>  Grupo - Executa a cole√ß√£o de associa√ß√£o ao grupo </li><li>  LocalAdmin - Executa a cole√ß√£o de administradores locais </li><li>  RDP - Executa a cole√ß√£o de usu√°rios da √°rea de trabalho remota </li><li>  DCOM - Executa a cole√ß√£o de usu√°rios COM distribu√≠dos </li><li>  GPOLocalGroup - Executa a cole√ß√£o de administradores locais usando objetos de diretiva de grupo </li><li>  Sess√£o - Executa a cole√ß√£o de sess√µes </li><li>  ComputerOnly - Executa administra√ß√£o local, RDP, DCOM e coleta de sess√µes </li><li>  LoggedOn - Executa a cole√ß√£o de sess√µes privilegiadas (requer direitos de administrador nos sistemas de destino) </li><li>  Rela√ß√µes de confian√ßa - Executa a enumera√ß√£o de confian√ßa do dom√≠nio </li><li>  ACL - Executa cole√ß√£o de ACLs </li><li>  Container - Executa a cole√ß√£o de Containers; </li><li>  DcOnly - Executa a cole√ß√£o usando apenas LDAP.  Inclui grupo, rela√ß√µes de confian√ßa, ACL, ObjectProps, container e GPOLocalGroup </li><li>  Tudo - executa todos os m√©todos de cole√ß√£o, exceto GPOLocalGroup e LoggedOn </li><li>  Pesquisar floresta - pesquise todos os dom√≠nios da floresta em vez de apenas o atual </li><li>  Dom√≠nio - pesquise um dom√≠nio espec√≠fico.  Usa seu dom√≠nio atual se nulo (Padr√£o: nulo) </li><li>  Discri√ß√£o - Executa m√©todos de coleta furtiva.  Todas as op√ß√µes furtivas s√£o de rosca √∫nica </li><li>  SkipGCDeconfliction - Ignora a desconfli√ß√£o do Cat√°logo Global durante a enumera√ß√£o da sess√£o.  Isso pode acelerar a enumera√ß√£o, mas resultar√° em poss√≠veis imprecis√µes nos dados </li><li>  ExcludeDc - Exclui controladores de dom√≠nio da enumera√ß√£o (evita sinalizadores do Microsoft ATA) </li><li>  ComputerFile - especifique um arquivo para carregar nomes / IPs de computador de </li><li>  OU - Especifique qual OU enumerar </li></ul><br></div></div><br>  Os coletores de informa√ß√µes s√£o o <a href="">SharpHound.exe</a> (requer o .NET v3.5 instalado) e o script <a href="">SharpHound.ps1,</a> escrito em PowerShell.  H√° tamb√©m um compilador escrito por um desenvolvedor Python de terceiros, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bloodhound-python</a> . <br><br>  Como banco de dados, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Neo4j √©</a> usado, que possui sua pr√≥pria sintaxe, o que permite executar consultas personalizadas.  Voc√™ pode ler mais sobre a sintaxe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Fora da caixa, 12 pedidos est√£o dispon√≠veis</b> <div class="spoiler_text"><ul><li>  Encontre todos os administradores de dom√≠nio </li><li>  Encontre caminhos mais curtos para administradores de dom√≠nio </li><li>  Encontre entidades com direitos DCSync </li><li>  Usu√°rios com associa√ß√£o ao grupo de dom√≠nio estrangeiro </li><li>  Grupos com associa√ß√£o ao grupo de dom√≠nio estrangeiro </li><li>  Mapear rela√ß√µes de confian√ßa do dom√≠nio </li><li>  Caminhos mais curtos para sistemas de delega√ß√£o sem restri√ß√µes </li><li>  Caminhos mais curtos de usu√°rios Kerberoastable </li><li>  Caminhos mais curtos para administradores de dom√≠nio de usu√°rios Kerberoastable </li><li>  Caminho mais curto dos principais propriet√°rios </li><li>  Caminhos mais curtos para administradores de dom√≠nio de propriet√°rios pr√≥prios </li><li>  Caminhos mais curtos para alvos de alto valor </li></ul><br></div></div><br>  Os desenvolvedores tamb√©m fornecem o script <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DBCreator.py</a> , que permite gerar um banco de dados aleat√≥rio para teste. <br><br><img src="https://habrastorage.org/webt/do/if/95/doif95xzpkhd3xqbdjbwdenmrfu.png"><br><br>  O Neo4j possui uma API REST.  Existem v√°rios utilit√°rios que podem se conectar ao banco de dados e usar os dados recebidos: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cypherdog</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gofetch</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ANGRYPUPPY</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gerador gt</a> </li></ul><br>  Vamos considerar alguns deles. <br><br><h3>  Cypherdog </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CypherDog</a> √© um shell <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BloodHound</a> escrito em PowerShell.  Inclui 27 cmdlets. <br><br><div class="spoiler">  <b class="spoiler_title">Lista de cmdlets</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td>  Cmdlet </td><td>  Sinopse </td></tr><tr><td>  Get-BloodHoundCmdlet </td><td>  BloodHound RTFM - Obter cmdlet </td></tr><tr><td>  Posto de ca√ßa-sangue </td><td>  BloodHound POST - Cifra para API REST </td></tr><tr><td>  Get-BloodHoundNode </td><td>  N√≥ BloodHound - Obter N√≥ </td></tr><tr><td>  Search-BloodHoundNode </td><td>  N√≥ BloodHound - N√≥ de Pesquisa </td></tr><tr><td>  New-BloodHoundNode </td><td>  N√≥ BloodHound - Criar N√≥ </td></tr><tr><td>  Set-bloodhoundnode </td><td>  N√≥ BloodHound - N√≥ de Atualiza√ß√£o </td></tr><tr><td>  Remove-BloodHoundNode </td><td>  N√≥ BloodHound - Excluir N√≥ </td></tr><tr><td>  Get-BloodHoundNodeList </td><td>  N√≥ BloodHound - Obter lista </td></tr><tr><td>  Get-BloodHoundNodeHighValue </td><td>  N√≥ BloodHound - Get HighValue </td></tr><tr><td>  Get-BloodHoundNodeOwned </td><td>  N√≥ BloodHound - Seja Possu√≠do </td></tr><tr><td>  Get-BloodHoundNodeNote </td><td>  N√≥ BloodHound - Obter nota </td></tr><tr><td>  Set-BloodHoundNodeNote </td><td>  N√≥ BloodHound - Definir notas </td></tr><tr><td>  Get-BloodHoundBlacklist </td><td>  N√≥ BloodHound - obter lista negra </td></tr><tr><td>  Set-BloodHoundBlacklist </td><td>  N√≥ BloodHound - Definir lista negra </td></tr><tr><td>  Remove-BloodHoundBlacklist </td><td>  N√≥ BloodHound - Remover lista negra </td></tr><tr><td>  Get-BloodHoundEdge </td><td>  BloodHound Edge - Obter Alvo </td></tr><tr><td>  Get-BloodHoundEdgeReverse </td><td>  BloodHound Edge - Obter fonte </td></tr><tr><td>  Get-BloodHoundEdgeCrossDomain </td><td>  BloodHound Edge - Obtenha o CrossDomain </td></tr><tr><td>  Get-BloodHoundEdgeCount </td><td>  BloodHound Edge - Obter contagem </td></tr><tr><td>  Get-BloodHoundEdgeInfo </td><td>  BloodHound Edge - Obter informa√ß√µes </td></tr><tr><td>  New-BloodHoundEdge </td><td>  Borda BloodHound - Criar borda </td></tr><tr><td>  Remove-BloodHoundEdge </td><td>  Borda BloodHound - Excluir borda </td></tr><tr><td>  Get-BloodHoundPathShort </td><td>  Caminho BloodHound - obtenha o menor </td></tr><tr><td>  Get-BloodHoundPathAny </td><td>  Caminho BloodHound - Obtenha qualquer </td></tr><tr><td>  Get-BloodHoundPathCost </td><td>  Caminho BloodHound - Obter Custo </td></tr><tr><td>  Get-BloodHoundPathCheap </td><td>  Caminho BloodHound - Get Cheapest </td></tr><tr><td>  Get-BloodHoundWald0IO </td><td>  Caminho do BloodHound - √çndice Get Wald0 </td></tr></tbody></table></div><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Exemplos de uso</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td>  A equipe </td><td>  Descri√ß√£o do produto </td></tr><tr><td>  Search-BloodHoundNode -Type Computer -Property unconstraineddelegation -Value $ true |  selecione nome, nomes de servi√ßo principais, delega√ß√£o irrestrita, sistema operacional |  Lista de formata√ß√£o </td><td>  Procure computadores com delega√ß√£o ilimitada do Kerberos </td></tr><tr><td>  Usu√°rio de borda ADMINISTRATOR@JET.LAB MemberOf Group </td><td>  Listar grupos de usu√°rios </td></tr><tr><td>  Qual usu√°rio do computador HasSession ADMINISTRATOR@JET.LAB </td><td>  Listar computadores nos quais h√° uma sess√£o de usu√°rio Administrador </td></tr><tr><td>  Usu√°rio do caminho Computador HARVEY@JET.LAB DC1.JET.LAB </td><td>  Imprimir o caminho do usu√°rio para o controlador de dom√≠nio </td></tr><tr><td>  qual usu√°rio MemberOf Group 'DOMAIN ADMINS@JET.LAB' * |  lista de logon </td><td>  Listar sess√µes de usu√°rio ativo que s√£o membros do grupo Administradores do DOMAIN </td></tr><tr><td>  qual usu√°rio MemberOf Group 'DOMAIN ADMINS@JET.LAB' |  lista de logon |?  opera√ß√£o * -match 7 |  lista AdminTo |  selecione o nome </td><td>  Listar usu√°rios que possuem direitos de administrador em esta√ß√µes de trabalho executando o Windows 7 que possuem uma sess√£o de usu√°rios do grupo de administradores de dom√≠nio </td></tr></tbody></table></div><br></div></div><br>  Por padr√£o, a autentica√ß√£o √© necess√°ria para acessar o banco de dados neo4j.  Voc√™ pode desativar a autentica√ß√£o editando o arquivo neo4j.conf.  Ele precisa descomentar a linha <i>dbms.security.auth_enabled = false.</i>  Mas isso n√£o √© recomendado, pois qualquer usu√°rio pode se conectar ao banco de dados em 127.0.0.1:7474 (a configura√ß√£o padr√£o).  Voc√™ pode ler mais sobre autentica√ß√£o e autoriza√ß√£o no neo4j <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui.</a> <br><br><h3>  Gofetch </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O GoFetch</a> usa um gr√°fico criado no bloodhound para planejar e executar um ataque. <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo de gr√°fico Bloodhound</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/l3/pm/g_/l3pmg_9fw8yy5dkbrftpfq4flyo.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">L√≥gica GoFetch</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ph/g-/us/phg-usiezxoh0-jz2zvfq4iack8.jpeg"><br></div></div><br>  Lan√ßamento do ataque <br><br><pre> <code class="bash hljs">.\Invoke-GoFetch.ps1 -PathToGraph .\pathFromBloodHound.json</code> </pre> <br><h3>  gerador gt </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O gt-generator</a> , usando dados do BloodHound, facilita a cria√ß√£o de tickets de ouro.  Para receber um ticket dourado, apenas o hash de nome de usu√°rio e senha do usu√°rio KRBTGT √© necess√°rio. <br><br><pre> <code class="bash hljs">python gt-generator.py -s 127.0.0.1 -u user -p pass administrator &lt;KRBTGT_HASH&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/oo/d3/b8/ood3b84ooqbwwawb-pn7nybey_s.png"><br><br><h3>  Powerview </h3><br>  <a href="">O PowerView</a> √© uma estrutura do Powershell inclu√≠da no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PowerSploit</a> .  A seguir, √© apresentada uma lista de alguns cmdlets que podem ajud√°-lo a coletar informa√ß√µes sobre um dom√≠nio. <br><br><div class="spoiler">  <b class="spoiler_title">Lista de cmdlets</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td>  Get-NetDomain -Domain jet.lab </td><td>  Obter o dom√≠nio atual </td></tr><tr><td>  Get-domainSID </td><td>  Obter o SID do dom√≠nio atual </td></tr><tr><td>  Get-NetDomainController -Domain jet.lab </td><td>  Obter controladores de dom√≠nio para um dom√≠nio </td></tr><tr><td>  Get-NetUser -Domain jet.lab -UserName labuser </td><td>  Obter usu√°rios de um dom√≠nio </td></tr><tr><td>  Get-NetGroup * group_name * </td><td>  Obter todos os grupos no dom√≠nio atual </td></tr><tr><td>  Get-NetGroupMember -GroupName "Administradores de dom√≠nio" </td><td>  Obter todos os membros do grupo Administradores de Dom√≠nio </td></tr><tr><td>  Get-NetGroup -UserName "domain_user" </td><td>  Obter a associa√ß√£o ao grupo para um usu√°rio </td></tr><tr><td>  Get-NetComputer -FullData </td><td>  Obter todos os computadores do dom√≠nio </td></tr><tr><td>  Find-LocalAdminAccess -Verbose </td><td>  Encontre todas as m√°quinas no dom√≠nio atual em que o usu√°rio atual tenha acesso de administrador local </td></tr><tr><td>  Get-NetSession -ComputerName dc02.jet.lab </td><td>  Listar sess√µes em um computador espec√≠fico </td></tr><tr><td>  Invoke-UserHunter -CheckAccess </td><td>  Encontre computadores nos quais um administrador de dom√≠nio esteja logado e o usu√°rio atual tenha acesso </td></tr></tbody></table></div><br></div></div><br><h3>  Adidnsdump </h3><br>  Ao usar o DNS integrado no Active Directory, qualquer usu√°rio do dom√≠nio pode consultar todos os registros DNS padr√£o. <br><br>  Ferramenta usada: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Adidnsdump.</a> <br><br><img src="https://habrastorage.org/webt/hq/48/rb/hq48rboxepskftc5tnlbsnvgfr0.gif"><br><br><h1>  Ataques de dom√≠nio </h1><br>  Agora que temos as informa√ß√µes do dom√≠nio, passamos para a pr√≥xima fase do teste de penetra√ß√£o - diretamente para o ataque.  Considere 4 vetores em potencial: <br><br><ol><li>  Torrefa√ß√£o </li><li>  Ataque via ACL </li><li>  Delega√ß√£o Kerberos </li><li>  Abusando de permiss√µes de GPO </li></ol><br><br><h3>  Torrefa√ß√£o </h3><br>  Esse tipo de ataque tem como alvo o protocolo Kerberos.  Existem 2 tipos de ataque como o Roasting: <br><br><ul><li>  Kerberoast </li><li>  Asreproast </li></ul><br><h4>  Kerberoast </h4><br>  O ataque foi demonstrado pela primeira vez pelo usu√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">timmedin</a> no DerbyCon em 2014 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≠deo</a> ).  Com um ataque bem-sucedido, poderemos classificar a senha do servi√ßo de ultrassom no modo offline, sem medo de bloquear o usu√°rio.  Frequentemente, as contas de servi√ßo t√™m direitos excessivos e uma senha perp√©tua, o que pode nos permitir obter direitos de administrador de dom√≠nio. <br>  Para entender a ess√™ncia do ataque, considere como o Kerberos funciona. <br><br><img src="https://habrastorage.org/webt/vj/g2/ud/vjg2ud1wzdr89drnazgcob0eaum.png"><br><br>  1. A senha √© convertida em um hash NTLM, o carimbo de data / hora √© criptografado com um hash e enviado ao KDC como um autenticador na solicita√ß√£o de ticket TGT (AS-REQ).  O controlador de dom√≠nio (KDC) verifica as informa√ß√µes do usu√°rio e cria um ticket TGT. <br><br>  2. O ticket TGT √© criptografado, assinado e enviado ao usu√°rio (AS-REP).  Somente o servi√ßo Kerberos (KRBTGT) pode abrir e ler dados de um ticket TGT. <br><br>  3. O usu√°rio envia o ticket TGT ao controlador de dom√≠nio, mediante solicita√ß√£o do ticket TGS (TGS-REQ).  O controlador de dom√≠nio abre um ticket TGT e verifica a soma de verifica√ß√£o PAC. <br><br>  4. O ticket TGS √© criptografado com o hash NTLM da senha da conta de servi√ßo e √© enviado ao usu√°rio (TGS-REP). <br><br>  5. O usu√°rio fornece um ticket TGS ao computador em que o servi√ßo est√° sendo executado (AP-REQ).  O servi√ßo abre um ticket TGS usando seu hash NTLM. <br><br>  6. O acesso ao servi√ßo √© fornecido (AS-REP). <br><br>  Depois de receber um bilhete TGS (TGS-REP), podemos encontrar a senha da conta de servi√ßo offline.  Por exemplo, usando hashcat. <br><br>  De acordo com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC396</a> , 20 tipos de criptografia s√£o reservados para o protocolo Kerberos.  Os tipos de criptografia usados ‚Äã‚Äãagora, em ordem de prioridade: <br><br><ul><li>  AES256_CTS_HMAC_SHA1 </li><li>  AES128_CTS_HMAC_SHA1 </li><li>  RC4_HMAC_MD5 </li></ul><br>  Nas vers√µes recentes do Windows, a criptografia AES √© usada por padr√£o.  Mas, para compatibilidade com sistemas abaixo dos servidores Windows Vista e Windows 2008, √© necess√°rio suporte ao algoritmo RC4.  Ao conduzir um ataque, sempre √© feita uma primeira tentativa de obter um ticket TGS com criptografia RC4_HMAC_MD5, que permite senhas mais r√°pidas e depois o restante.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Harmj0y</a> conduziu um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estudo</a> interessante e descobriu que, se voc√™ especificar apenas o suporte √† criptografia Kerberos AES128 e AES256 nas propriedades do usu√°rio, o ticket Kerberos ainda ser√° emitido com a criptografia RC4_HMAC_MD5. <br><br><img src="https://habrastorage.org/webt/el/4w/vn/el4wvniixybekufn7jswfcr7pey.png"><br><br>  Desabilitar o RC4_HMAC_MD5 √© necess√°rio no n√≠vel do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dom√≠nio.</a> <br><br>  O ataque Kerberoasting tem 2 abordagens. <br><br>  1. O m√©todo antigo.  Os tickets TGS s√£o solicitados por meio de setspn.exe ou .NET System.IdentityModel.Tokens.KerberosRequestorSecurityToken da classe Powershell, recuperados da mem√≥ria usando mimikatz e convertidos no formato desejado (John, Hashcat) e classificados. <br><br>  2. O novo m√©todo.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O machosec</a> notou que a classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">KerberosRequestorSecurityToken</a> possui um m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GetRequest</a> , que extrai a parte criptografada com uma senha de um ticket TGS. <br><br>  Ferramentas para conduzir um ataque: <br><br>  1) Pesquise registros SPN <br><br><ul><li>  <a href="">GetUserSPN.ps1</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Find-PSServiceAccounts.ps1</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Get-NetUSER -SPN</a> </li><li>  (Get-ADUser -Filter {ServicePrincipalName -ne "$ null"} -Propriedades ServicePrincipalName) .ServicePrincipalName </li></ul><br>  2) Solicitar um bilhete TGS <br><br><ul><li>  setspn.exe (utilit√°rio nativo do Windows) </li><li>  Solicita√ß√£o de ticket atrav√©s do PowerShell <br><br><pre> <code class="plaintext hljs">Add-Type -AssemblyNAme System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList ‚Äú&lt;ServicePrincipalName&gt;‚Äù</code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Request-SPNTicket</a> </li></ul><br>  Voc√™ pode visualizar os tickets em cache atuais usando o comando klist. <br><br><div class="spoiler">  <b class="spoiler_title">Registros comuns do SPN</b> <div class="spoiler_text"><ul><li>  TERMSRV - √Årea de Trabalho Remota </li><li>  SmtpSVC e SMTP - Correio </li><li>  WSMAN - WinRM </li><li>  ExchangeAB, ExchangeRFR, ExchangeMDM - MS Exchange </li><li>  POP / POP3 - Servi√ßo Postal POP3 </li><li>  IMAP / IMAP4 - Servi√ßo de email IMAP </li><li>  MSSQLSvc - Microsoft SQL Server </li><li>  MONGO - Servidor de Banco de Dados MongoDB </li><li>  DNS - servidor DNS </li><li>  HTTP, WWW - Servidor Web </li><li>  LDAP - LDAP </li><li>  FTP - servidor FTP </li></ul><br></div></div><br>  3) Exporta√ß√£o de bilhetes: <br><br><ul><li>  <a href="">Comando Invoke-Mimikatz</a> '"Kerberos :: list / export"' </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mimikatz -Command</a> '"Kerberos :: list / export"' </li><li>  <a href="">Invioke-kerberoast</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tgsrepack.py</a> </li></ul><br><br>  Um exemplo de execu√ß√£o automatizada dos tr√™s pontos: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RiskiskSPN</a> <br><br><pre> <code class="bash hljs">Find-PotentiallyCrackableAccounts -Sensitive -Stealth -GetSPNs | Get-TGSCipher -Format <span class="hljs-string"><span class="hljs-string">"Hashcat"</span></span> | Out-File kerberoasting.txt</code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Powersploit</a> <br><br><pre> <code class="bash hljs">Invoke-Kerberoast -Domain jet.lab -OutputFormat Hashcat | fl</code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GetUserSPNs.py</a> <br><br><pre> <code class="bash hljs">GetUserSPNs.py -request jet.lab\user:Password</code> </pre> </li></ul><br><h3>  Asreproast </h3><br>  A vulnerabilidade √© que a pr√©-autentica√ß√£o Kerberos est√° desabilitada.  Nesse caso, podemos enviar solicita√ß√µes AS-REQ para um usu√°rio com a pr√©-autentica√ß√£o Kerberos desativada e obter a parte criptografada com uma senha. <br><br><img src="https://habrastorage.org/webt/zd/pm/h5/zdpmh5i7cas-s0gtv2uopy2sj14.png"><br><br>  A vulnerabilidade √© rara, pois desabilitar a pr√©-autentica√ß√£o n√£o √© a configura√ß√£o padr√£o. <br><br>  Procurando usu√°rios com autentica√ß√£o Kerberos desativada: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Powerview</a> <br><br><pre> <code class="bash hljs">Get-DomainUser -PreauthNotRequired -Properties samaccountname -Verbose</code> </pre> </li><li>  M√≥dulo do Active Directory <br><br><pre> <code class="bash hljs">get-aduser -filter * -properties DoesNotRequirePreAuth | <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> {<span class="hljs-variable"><span class="hljs-variable">$_</span></span>.DoesNotRequirePreAuth -eq <span class="hljs-string"><span class="hljs-string">"True"</span></span> -and <span class="hljs-variable"><span class="hljs-variable">$_</span></span>.Enabled -eq <span class="hljs-string"><span class="hljs-string">"True"</span></span>} | select Name</code> </pre> </li></ul><br>  Obtendo a parte criptografada: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ASREPRoast</a> <br><br><pre> <code class="bash hljs">Invoke-ASREPROast | fl</code> </pre> <br><img src="https://habrastorage.org/webt/i_/o-/vf/i_o-vfbviphgjknolenx_qoesyo.png"></li></ul><br><br><h1>  Ataque via ACL </h1><br>  Uma ACL em um contexto de dom√≠nio √© um conjunto de regras que definem os direitos de acesso de objetos no AD.  Uma ACL pode ser configurada para um √∫nico objeto (por exemplo, uma conta de usu√°rio) ou para uma unidade organizacional, por exemplo, OU.  Quando voc√™ configura a ACL na OU, todos os objetos na OU herdar√£o a ACL.  As ACLs cont√™m entradas de controle de acesso (ACEs) que determinam como o SID interage com o objeto do Active Directory. <br><br>  Por exemplo, temos tr√™s grupos: A, B, C, em que o grupo C √© um membro do grupo B e o grupo B √© um membro do grupo A. Quando voc√™ adiciona um convidado ao grupo C, ele n√£o apenas ser√° membro do grupo C, mas tamb√©m um membro indireto dos grupos B e A. Ao adicionar acesso a um objeto de dom√≠nio no grupo A, o usu√°rio convidado tamb√©m ter√° acesso a esse objeto.  Em uma situa√ß√£o em que o usu√°rio √© um membro direto de apenas um grupo e esse grupo √© um membro indireto dos outros 50 grupos, √© f√°cil perder a conex√£o das permiss√µes herdadas. <br><br>  Voc√™ pode recuperar as ACLs associadas ao objeto executando o seguinte comando <br><br><pre> <code class="bash hljs">Get-ObjectACL -Samaccountname Guest -ResolveGUIDs</code> </pre> <br>  Voc√™ pode usar a ferramenta para explorar erros na configura√ß√£o da ACL. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Invoke-ACLPwn</a> .  O script do Powershell coleta informa√ß√µes sobre todas as ACLs no dom√≠nio usando o coletor BloodHound, SharpHound, e cria uma cadeia para obter a permiss√£o writeDACL.  Depois que a cadeia √© criada, o script opera cada etapa da cadeia.  A ordem do script: <br><br><ol><li>  O usu√°rio √© adicionado aos grupos necess√°rios. </li><li>  Duas ACEs (Replicar Altera√ß√µes no Diret√≥rio e Replicar Altera√ß√µes no Diret√≥rio ALL) s√£o adicionadas √†s ACLs do objeto de dom√≠nio. </li><li>  Se voc√™ possui direitos no DCSync usando o utilit√°rio Mimikatz, √© solicitado o hash da senha do usu√°rio krbtgt (configura√ß√£o padr√£o). </li><li>  Ap√≥s a conclus√£o da opera√ß√£o, o script exclui todos os grupos adicionados e entradas do ACE na ACL. </li></ol><br>  O script visa apenas o uso de permiss√µes writeDACL.  Os seguintes direitos de acesso tamb√©m podem ser de interesse para um invasor: <br><br><ul><li>  ForceChangePassword.  Direitos para alterar a senha do usu√°rio quando a senha atual n√£o √© conhecida.  Opera√ß√£o com o PowerSploit - Set-DomainUserPassword. </li><li>  AddMembers.  Direitos para adicionar grupos, computadores e usu√°rios a grupos.  Opera√ß√£o com o PowerSploit - Add-DomainGroupMember. </li><li>  GenericWrite  Direitos para alterar os atributos de um objeto.  Por exemplo, altere o valor do par√¢metro scriptPath.  Na pr√≥xima vez que o usu√°rio fizer logon no sistema, o arquivo especificado ser√° iniciado.  Opera√ß√£o com o PowerSploit - Set-DomainObject. </li><li>  WriteOwner.  Direitos para alterar o propriet√°rio do objeto.  Opera√ß√£o com o PowerSploit - Set-DomainObjectOwner. </li><li>  AllExtendedRights.  Direitos para adicionar usu√°rios a grupos, alterar senhas de usu√°rios etc. Opera√ß√£o com o PowerSploit - Set-DomainUserPassword ou Add-DomainGroupMember. </li></ul><br>  Opera√ß√£o: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Invoke-aclpwn</a> </li></ul><br>  Iniciando em uma m√°quina que est√° em um dom√≠nio <br><br><pre> <code class="bash hljs">./Invoke-ACL.ps1 -SharpHoundLocation .\sharphound.exe -mimiKatzLocation .\mimikatz.exe</code> </pre> <br>  Iniciando em uma m√°quina que n√£o est√° em um dom√≠nio <br><br><pre> <code class="bash hljs">/Invoke-ACL.ps1 -SharpHoundLocation .\sharphound.exe -mimiKatzLocation .\mimikatz.exe -Username <span class="hljs-string"><span class="hljs-string">'domain\user'</span></span> -Domain <span class="hljs-string"><span class="hljs-string">'fqdn_of_target_domain'</span></span> -Password <span class="hljs-string"><span class="hljs-string">'Pass'</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O aclpwn.py</a> √© uma ferramenta semelhante escrita em Python </li></ul><br><h3>  Delega√ß√£o Kerberos </h3><br>  A delega√ß√£o de autoridade Kerberos permite reutilizar credenciais de usu√°rio final para acessar recursos hospedados em outro servidor. <br><br>  A delega√ß√£o Kerberos pode ser de tr√™s tipos: <br><br><ol><li>  Ilimitado (delega√ß√£o sem restri√ß√µes).  A √∫nica op√ß√£o de delega√ß√£o antes do Windows Server 2003 </li><li>  Delega√ß√£o restrita desde o Windows Server 2003 </li><li>  Delega√ß√£o restrita baseada em recursos  Introduzido no Windows Server 2012 </li></ol><br><h4>  Delega√ß√£o ilimitada </h4><br>  No snap-in do Active Directory, o recurso de delega√ß√£o ilimitada ativado √© o seguinte: <br><br><img src="https://habrastorage.org/webt/ip/mp/e8/ipmpe8ygslgtbdklbkiseqtwg64.png"><br><br>  Para maior clareza, considere como ocorre a delega√ß√£o ilimitada em um diagrama. <br><br><img src="https://habrastorage.org/webt/1i/p1/wq/1ip1wqkjnc9plqcqzmpkr1rcfwg.png"><br><br><ol><li>  A senha do usu√°rio √© convertida em hash ntlm.  O registro de data e hora √© criptografado com esse hash e enviado ao controlador de dom√≠nio para solicitar um ticket TGT. </li><li>  O controlador de dom√≠nio verifica as informa√ß√µes sobre o usu√°rio (restri√ß√£o de logon, associa√ß√£o a grupos etc.), cria um ticket TGT e envia para o usu√°rio.  O ticket TGT √© criptografado, assinado e apenas o krbtgt pode ler seus dados. </li><li>  O usu√°rio solicita um ticket TGS para acessar o servi√ßo da web no servidor da web. </li><li>  O controlador de dom√≠nio fornece um ticket TGS. </li><li>  O usu√°rio envia tickets TGT e TGS para o servidor da web. </li><li>  A conta de servi√ßo do servidor da web usa o ticket TGT do usu√°rio para solicitar um ticket TGS para acessar o servidor de banco de dados. </li><li>  A conta de servi√ßo se conecta ao servidor de banco de dados como um usu√°rio. </li></ol><br>  O principal perigo da delega√ß√£o ilimitada √© que, quando uma m√°quina com delega√ß√£o ilimitada for comprometida, um invasor poder√° obter tickets TGT dos usu√°rios dessa m√°quina e acessar qualquer sistema no dom√≠nio em nome desses usu√°rios. <br><br>  Procure m√°quinas em um dom√≠nio com delega√ß√£o ilimitada: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Powerview</a> <br><br><pre> <code class="bash hljs">Get-NetComputer -unconstrained</code> </pre> </li><li>  M√≥dulo do Active Directory <br><br><pre> <code class="bash hljs">Get-Adcomputer -Filter {TrustedForDelegation -eq <span class="hljs-variable"><span class="hljs-variable">$True</span></span>}</code> </pre>  . </li></ul><br>  Exporta√ß√£o de bilhetes: <br><br><ul><li>  Usando mimikatz.  sekurlsa :: bilhetes / exporta√ß√£o </li><li>  Voc√™ tamb√©m pode executar um ataque de passagem de ingresso. <br><br><pre> <code class="bash hljs"> kerberos::ptt C:\tickets\.</code> </pre> </li></ul><br><img src="https://habrastorage.org/webt/oa/wa/25/oawa25sduaj5u303b1q9svirdku.gif"><br><br><h4>  Delega√ß√£o limitada </h4><br>  O modo de delega√ß√£o limitada permite acessar apenas servi√ßos permitidos e em uma m√°quina espec√≠fica.  No snap-in do Active Directory, fica assim: <br><br><img src="https://habrastorage.org/webt/xj/ku/no/xjkunogyspfpevoanui8nzxwlzq.png"><br><br>  Com delega√ß√£o limitada, duas extens√µes de protocolo Kerberos s√£o usadas: <br><br><ul><li>  S4uself </li><li>  S4UProxy </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">S4U2Self √©</a> usado quando o cliente n√£o se autentica usando o protocolo Kerberos. <br><br>  Para delega√ß√£o ilimitada, o TGT √© usado para identificar o usu√°rio; nesse caso, a extens√£o S4U usa a estrutura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PA-FOR-USER</a> como o novo tipo no campo de dados padata / pr√©-autentica√ß√£o.  O processo S4U2self √© permitido apenas se o usu√°rio solicitante tiver o campo TRUSTED_TO_AUTH_FOR_DELEGATION definido em seu userAccountControl. <br><br><img src="https://habrastorage.org/webt/oo/yk/5s/ooyk5sjtsusxcfkois5ej7dgnua.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O S4U2Proxy</a> permite que a conta de servi√ßo use o ticket de redirecionamento recebido no processo S4U2proxy para solicitar um ticket TGS para acesso aos servi√ßos permitidos (msds-allowtodelegateto).  O KDC verifica se o servi√ßo solicitado est√° especificado no campo msds-allowtodelegateto do usu√°rio solicitante e emite um ticket se a verifica√ß√£o for bem-sucedida.  Assim, a delega√ß√£o √© "limitada" a servi√ßos de destino espec√≠ficos. <br><br><img src="https://habrastorage.org/webt/t-/a7/n6/t-a7n6ludbpsvmbk0ru_kwxvpq4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode procurar computadores e usu√°rios em um dom√≠nio de delega√ß√£o limitado usando o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerView</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Procure computadores com delega√ß√£o ilimitada</font></font><br><br><pre> <code class="bash hljs">Get-DomainComputer -TrustedtoAuth</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Procure usu√°rios de delega√ß√£o limitada </font></font><br><br><pre> <code class="bash hljs">Get-DomainUser -TrustedtoAuth</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para conduzir um ataque, precisamos de uma senha aberta, um hash de senha NTLM ou um ticket TGT. </font></font><br><br><img src="https://habrastorage.org/webt/gd/5f/fx/gd5ffxfwmgeqr5j28ovwzcqqacy.gif"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Delega√ß√£o limitada baseada em recursos </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como na delega√ß√£o regular, as extens√µes S4U s√£o usadas. Como a delega√ß√£o baseada em recursos √© principalmente uma delega√ß√£o limitada, os ataques relevantes √† delega√ß√£o limitada regular tamb√©m est√£o dispon√≠veis aqui. A √∫nica diferen√ßa √© que, em uma delega√ß√£o limitada simples, o servi√ßo A deve ter o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atributo msDS-AllowedToDelegateTo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = ServiceB, e aqui o servi√ßo B deve ter o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atributo msDS-AllowedToActOnBehalfOfOtherIdentity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = Service A. </font></font><br><br><img src="https://habrastorage.org/webt/td/um/jl/tdumjlcportki98xbixgfo1jaiu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa propriedade permite mais um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ataque</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> publicado por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">harmj0y</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Um ataque requer permiss√µes para modificar o par√¢metro PrincipalsAllowedToDelegateToAccount, que define o atributo msds-AllowedToActOnBehalfOfOtherIdentity, que cont√©m uma lista de controle de acesso (ACL). </font><font style="vertical-align: inherit;">Diferentemente da delega√ß√£o limitada, n√£o precisamos de direitos de administrador de dom√≠nio para alterar o atributo msds-AllowedToActOnBehalfOfOtherIdentity. </font><font style="vertical-align: inherit;">Voc√™ pode descobrir quem tem permiss√£o para editar o atributo da seguinte maneira:</font></font><br><br><pre> <code class="plaintext hljs">(Get-acl "AD:$((get-adcomputer Windows7).distinguishedname)").access | Where-Object -Property ActiveDirectoryRights -Match WriteProperty |out-gridview</code> </pre> <br><img src="https://habrastorage.org/webt/ej/4p/bk/ej4pbkl5bkv5y75mqp54mxu0qcm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ent√£o, para realizar o ataque, execute mitm6 </font></font><br><br><pre> <code class="bash hljs">mitm6 -I vmnet0</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Iniciamos o ntlmrelayx com a op√ß√£o --delegate-access </font></font><br><br><pre> <code class="plaintext hljs">ntlmrelayx -t ldaps://dc1.jet.lab --delegate-access</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como resultado do ataque, um computador ZGXTPVYX $ √© criado com direitos de delega√ß√£o para o computador Windows7. </font></font><br><br><pre> <code class="plaintext hljs">$x = Get-ADComputer Windows7 -Properties msDS-AllowedToActOnBehalfOfOtherIdentity $x.'msDS-AllowedToActOnBehalfOfOtherIdentity'.Access</code> </pre><br><img src="https://habrastorage.org/webt/21/oo/w9/21oow9kxnu53sg9wi-xnneus9fc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um bom relat√≥rio de delega√ß√£o foi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apresentado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no PHDays por Yegor Podmokov.</font></font><br><br><img src="https://habrastorage.org/webt/kr/ri/za/krrizaffbrqgiee3gd2kufqs8s4.gif"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abusando de permiss√µes de GPO </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetos de Diretiva de Grupo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© uma ferramenta que permite aos administradores gerenciar eficientemente um dom√≠nio. </font><font style="vertical-align: inherit;">Mas acontece que os usu√°rios recebem direitos desnecess√°rios, inclusive para alterar pol√≠ticas de GPO. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para demonstrar o exemplo, adicionaremos ao usu√°rio Ragnar os direitos para editar a Pol√≠tica de Controladores de Dom√≠nio Padr√£o (na vida real, os direitos dessa pol√≠tica s√£o concedidos apenas aos administradores de dom√≠nio, mas a ess√™ncia do ataque n√£o muda; no caso de outra pol√≠tica, apenas os hosts controlados mudam). </font></font><br><br><img src="https://habrastorage.org/webt/yw/on/ht/ywonhtpbkwdqffjvzck5hdhjgza.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumere os direitos de todos os GPOs no dom√≠nio usando o </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerView</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="plaintext hljs">Get-NetGPO | % {Get-ObjectAcl -ResolveGUIDs -Name $_.Name}</code> </pre> <br><img src="https://habrastorage.org/webt/fk/cf/sk/fkcfskfmeohuicn13_76t190miy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um usu√°rio do Ragnar tem o direito de alterar um GPO que tenha um GUID de 6AC1786C-016F-11D2-945F-00C04FB984F9. </font><font style="vertical-align: inherit;">Para determinar quais hosts no dom√≠nio aplicam essa pol√≠tica, execute o seguinte comando</font></font><br><br><pre> <code class="plaintext hljs">Get-NetOU -GUID "6AC1786C-016F-11D2-945F-00C04FB984F9" | % {Get-NetComputer -AdSpath $_}</code> </pre> <br><img src="https://habrastorage.org/webt/ou/ut/9c/ouut9cizgebvp9q_dkoifqlqgic.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obteve o host dc1.jet.lab. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conhecendo a pol√≠tica espec√≠fica que o usu√°rio do Ragnar pode editar e os hosts aos quais essa pol√≠tica se aplica, podemos executar v√°rias a√ß√µes no host dc1.jet.lab.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abaixo est√£o as op√ß√µes para usar o GPO</font></font></b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td> Computer Configuration\Preferences\Control Panel Settings\Folder Options </td><td> Create/alter file type associations, register DDE actions with those associations </td></tr><tr><td> Computer Configuration\Preferences\Control Panel Settings\Local Users and Groups </td><td> Add new local admin account </td></tr><tr><td> Computer Configuration\Preferences\Control Panel Settings\Scheduled Tasks </td><td> Deploy a new evil scheduled task (ie: PowerShell download cradle) </td></tr><tr><td> Computer Configuration\Preferences\Control Panel Settings\Services </td><td> Create and configure new evil services </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Files </td><td> Affected computers will download a file from the domain controller </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\INI Files </td><td> Update existing INI files </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Registry </td><td> Update specific registry keys. Very useful for disabling security mechanisms, or triggering code execution in any number of ways </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Shortcuts </td><td> Deploy a new evil shortcut </td></tr><tr><td> Computer Configuration\Policies\Software Settings\Software installation </td><td> Deploy an evil MSI. The MSI must be available to the GP client via a network share </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Scripts (startup/shutdown) </td><td> Configure and deploy evil startup scripts. Can run scripts out of GPO directory, can also run PowerShell commands with arguments </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Audit Policy </td><td> Modify local audit settings. Useful for evading detection </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\ </td><td> Grant a user the right to logon via RDP, grant a user SeDebugPrivilege, grant a user the right to load device drivers, grant a user seTakeOwnershipPrivilege. Basically, take over the remote computer without ever being an administrator on it </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Security Settings\Registry </td><td> Alter DACLs on registry keys, grant yourself an extremely hard to find backdoor on the system </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall </td><td> Manage the Windows firewall. Open up ports if they're blocked </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Environment </td><td> Add UNC path for DLL side loading </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Files </td><td> Copy a file from a remote UNC path </td></tr></tbody></table></div><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">ferramentas </font></a></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New-GPOImmediateTask</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SharpGPOAbuse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permitem:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Executar tarefa no agendador de tarefas </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adicionar direitos de usu√°rio (SeDebugPrivilege, SeTakeOwnershipPrivilege, etc.) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adicionar um script que √© executado ap√≥s a inicializa√ß√£o </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adicionar usu√°rio ao grupo local </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por exemplo, adicione uma tarefa no agendador de tarefas para obter uma sess√£o do Meterpreter: </font></font><br><br><pre> <code class="plaintext hljs">New-GPOImmediateTask -TaskName test3 -GPODisplayName "Default Domain Controllers Policy" -CommandArguments '&lt;powershell_meterepreter_payload&gt;' -Force</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s a execu√ß√£o, a tarefa agendada aparece teste </font></font><br><br><img src="https://habrastorage.org/webt/dr/au/v8/drauv8km1pwp56jt_reymw8d5gw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E a sess√£o Meterpreter √© exibida.Para </font></font><br><br><img src="https://habrastorage.org/webt/js/e6/g8/jse6g8vqatvnvr5h1qlx2mvrvzq.png"><br><br><img src="https://habrastorage.org/webt/zj/ct/wz/zjctwz7ca8xg5j6zbqoqlf3q9w0.gif"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">excluir uma tarefa agendada, √© necess√°rio executar o seguinte comando:</font></font><br><br><pre> <code class="plaintext hljs">New-GPOImmediateTask -Remove -Force -GPODisplayName SecurePolicy</code> </pre> <br><h1>  Conclus√µes </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No artigo, examinamos apenas alguns vetores de ataque. </font><font style="vertical-align: inherit;">Exibi√ß√µes como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumerate Accounts and Password spray</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS14-068</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">v√°rios </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">impressora</font></a><font style="vertical-align: inherit;"> e delega√ß√£o irrestrita, ataques ao Exchange ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©gua</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrivExchange</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExchangeRelayX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) podem expandir significativamente o escopo do ataque. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As t√©cnicas de ataque e os m√©todos de pinagem (t√≠quete de ouro, t√≠quete de prata, passe-o-hash, passe de hash, hist√≥rico do SID, DC Shadow, etc.) est√£o constantemente mudando, e a equipe de defesa deve estar sempre pronta para novos tipos de ataques.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt449278/">https://habr.com/ru/post/pt449278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt449264/index.html">Criando um sistema de relat√≥rios para 1C: ERP baseado em OLAP e Excel</a></li>
<li><a href="../pt449266/index.html">3 relat√≥rios com RusCrypto: confer√™ncias com experi√™ncia</a></li>
<li><a href="../pt449270/index.html">A Yandex publicou uma vis√£o geral do mercado de vagas de TI</a></li>
<li><a href="../pt449274/index.html">Visor grande de 7 segmentos com brilho de n√©on no ESP8266</a></li>
<li><a href="../pt449276/index.html">Mudan√ßa de carreira aos 35 anos. Minha experi√™ncia e primeiros sucessos</a></li>
<li><a href="../pt449280/index.html">Como funciona a plataforma de jogos em nuvem para clientes b2b e b2c. Solu√ß√µes para uma √≥tima foto e lute com a √∫ltima milha</a></li>
<li><a href="../pt449282/index.html">Backup, Parte 1: Objetivo, Vis√£o geral de t√©cnicas e tecnologias</a></li>
<li><a href="../pt449284/index.html">Eu vendo cebolas online</a></li>
<li><a href="../pt449286/index.html">API do GraphQL em movimento</a></li>
<li><a href="../pt449288/index.html">Qual equipe √© necess√°ria para criar uma loja online realmente boa?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>