<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßíüèΩ üßöüèΩ üì© Optimiser le chargement de JavaScript sur Wikipedia üí∑ ü§òüèæ ‚óªÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'auteur du document, dont nous publions aujourd'hui la traduction, indique qu'√† la mi-septembre 2019, il a enfin achev√© le projet sur lequel il trava...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimiser le chargement de JavaScript sur Wikipedia</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/470874/">  L'auteur du document, dont nous publions aujourd'hui la traduction, indique qu'√† la mi-septembre 2019, il a enfin achev√© le projet sur lequel il travaille depuis un an.  L'objectif de ce projet √©tait de r√©duire la taille du manifeste requis pour initialiser le pipeline JavaScript asynchrone Wikipedia.  √Ä savoir, la taille du manifeste √©tait de 36 Ko.  Il devait tenir dans moins de 28 Ko, ce qui correspond √† deux fragments de 14 kilo-octets de la s√©quence de paquets Internet. <br><br>  Le r√©sultat de ce projet a √©t√© une √©conomie quotidienne de 4,3 t√©raoctets de trafic. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6fe/198/a19/6fe198a19b0e143d1bb82788cada2024.png"></div><br>  <i><font color="#999999">Au d√©but, la taille du manifeste d√©passait 36 ‚Äã‚ÄãKo, et apr√®s optimisation, sa taille est devenue inf√©rieure √† 28 Ko</font></i> <br><br>  Le graphique montre une diminution progressive de la taille du manifeste.  Nous parlons de donn√©es compress√©es (c'est-√†-dire que c'est la charge nette sur le r√©seau, qui cr√©e le transfert de ces donn√©es du serveur vers le navigateur). <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Processus d'optimisation</font> </h2><br>  Le manifeste d'initialisation est repr√©sent√© par des donn√©es qui ne sont pas faciles √† optimiser.  La majeure partie de son code n'est pas quelque chose comme la logique fonctionnelle qui peut √™tre optimis√©e par des moyens traditionnels.  Au lieu de cela, presque tout le manifeste est repr√©sent√© par des donn√©es pures.  Ces donn√©es sont g√©n√©r√©es automatiquement par le syst√®me de distribution de contenu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ResourceLoader</a> .  Il s'agit d'un registre de bundles de modules.  Wikipedia utilise le syst√®me ResourceLoader pour travailler avec JavaScript, CSS et les ressources textuelles. <br><br>  Le registre comprend des m√©tadonn√©es pour toutes les fonctionnalit√©s frontales d√©ploy√©es sur Wikipedia.  Le manifeste r√©pertorie les noms des bundles, leurs versions actuelles, leurs d√©pendances sur d'autres bundles similaires sont d√©crits ici. <br><br>  J'ai commenc√© par chercher du code qui n'a jamais √©t√© utilis√© en pratique ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T202154</a> ).  Cela comprenait la recherche de morceaux de code incomplets ou oubli√©s li√©s aux fonctionnalit√©s h√©rit√©es.  Le code inutilis√© a √©t√© imm√©diatement supprim√© pour assurer la compatibilit√© avec les navigateurs qui n'ont plus r√©ussi notre test, ce qui a assur√© leur inclusion dans le groupe des navigateurs modernes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grade A</a> ).  J'ai √©galement pr√©par√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">document</a> sur les performances de chargement des pages.  Ce document a servi de r√©f√©rence, permettant aux d√©veloppeurs de comprendre l'impact des changements de diff√©rents types sur les diff√©rentes √©tapes du processus de chargement des pages. <br><br><h2>  <font color="#3AC1EF">R√©duisez le nombre de modules</font> </h2><br>  L'√©tape suivante a √©t√© de collaborer avec les √©quipes d'ing√©nierie de la Fondation Wikimedia et de Wikimedia Deutschland.  Nous devions d√©couvrir quelles fonctionnalit√©s du syst√®me utilisaient un nombre excessif de modules.  Par exemple, apr√®s avoir compris cela, il serait possible de combiner des faisceaux pr√©c√©demment dispers√©s √† partir desquels une certaine fonctionnalit√© a √©t√© construite.  De tels faisceaux, m√™me dans un √©tat dispers√©, sont toujours charg√©s ensemble.  Cela conduirait au fait qu'il y aurait moins de points finaux dans le syst√®me dont les m√©tadonn√©es devraient √™tre stock√©es dans le registre form√© par ResourceLoader. <br><br>  Voici quelques points int√©ressants sur l'application de cette approche d'optimisation: <br><br><ul><li>  L'extension WikiEditor compte d√©sormais 11 modules de moins qu'auparavant.  31 autres modules ont √©t√© supprim√©s de UploadWizard. </li><li>  Lors de l'optimisation du programme ContentTranslation, 24 modules ont √©t√© combin√©s. </li><li>  Le projet MobileFrontend combine 25 modules. </li><li>  20 modules supprim√©s de RevisionSlider et TwoColConflict. </li></ul><br>  Il est √©galement tr√®s important que le client Wikidata pour Wikipedia ait √©t√© optimis√©.  Cette partie de l'≈ìuvre elle-m√™me √©tait un projet √©pique ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T203696</a> ).  Au d√©part, 248 modules individuels √©taient responsables de la mise en ≈ìuvre de cette fonctionnalit√©.  Apr√®s avoir r√©ussi √† nous d√©barrasser de plus de 200 modules, il n'y en avait plus que 42. <br><br>  Le diagramme ci-dessus montre les petites am√©liorations qui ont √©t√© apport√©es au projet au cours de l'ann√©e.  Tous nous ont rapproch√©s de l'objectif.  Je voudrais surtout noter deux grosses baisses de la taille du manifeste.  Une telle chute s'est produite au cours de la premi√®re semaine d'ao√ªt.  C'est alors qu'une version am√©lior√©e de Wikidata a √©t√© d√©ploy√©e.  La deuxi√®me baisse de taille peut √™tre observ√©e √† la toute fin du graphique.  C'est arriv√© √† la mi-septembre.  J'aimerais maintenant vous parler de lui. <br><br><h2>  <font color="#3AC1EF">R√©duisez la taille des m√©tadonn√©es</font> </h2><br>  L'am√©lioration du manifeste qui s'est produite √† la mi-septembre a √©t√© rendue possible par deux changements globaux visant √† une organisation des donn√©es plus intelligente. <br><br>  La premi√®re am√©lioration est que, auparavant, les m√©tadonn√©es du sch√©ma d'extension <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EventLogging faisaient</a> partie du manifeste principal.  Ce m√©canisme a √©t√© refactoris√©, de sorte que les m√©tadonn√©es de sch√©ma soient d√©sormais incluses dans le bundle JS du client EventLogging.  En cons√©quence, la contribution √† la taille du manifeste effectu√©e pr√©c√©demment par EventLogging a √©t√© r√©duite de plus de 90%.  Cela signifie que le chemin critique contient d√©sormais 2 Ko de donn√©es en moins!  Cela signifiait en outre que l'extension des capacit√©s d'EventLogging n'entra√Ænait plus d'augmentation de la taille du manifeste.  Lors de l'assemblage de ces ensembles, une nouvelle fonctionnalit√© de ResourceLoader, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Package Files, a √©t√© utilis√©e</a> .  Cette fonctionnalit√© a √©t√© introduite en f√©vrier 2019, l'une des raisons de son int√©r√™t est qu'elle pourrait aider √† r√©duire le nombre de modules dans le registre.  Les fichiers de package simplifient consid√©rablement le processus de combinaison des donn√©es g√©n√©r√©es et du code JavaScript dans un seul module. <br><br>  La deuxi√®me am√©lioration s'est produite lorsque nous avons r√©duit la taille moyenne de chaque entr√©e de registre ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T229245</a> ).  Le manifeste contient deux entr√©es pour chaque module.  Il s'agit du nom du module et de l'identifiant (ID) de sa version.  L'identifiant de version n√©cessitait auparavant 7 octets de donn√©es.  Apr√®s avoir r√©fl√©chi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">au paradoxe de l'anniversaire</a> dans le contexte de ResourceLoader, nous avons d√©cid√© que le spectre de probabilit√© des ID de version pouvait √™tre r√©duit en toute s√©curit√© de 78 milliards √† ¬´seulement¬ª 60 millions.  Des d√©tails √† ce sujet peuvent √™tre trouv√©s dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commentaires</a> du code.  Mais, pour r√©sumer cette am√©lioration, nous pouvons dire que cela nous a permis d'√©conomiser 2 octets dans la description de chacun des 1 100 modules qui sont encore dans le registre.  En cons√©quence, la taille du manifeste a √©t√© r√©duite de 2 √† 3 Ko suppl√©mentaires. <br><br>  Ci-dessous est un fragment agrandi du diagramme montrant les derniers jours de fonctionnement (ces indicateurs sont tir√©s du syst√®me de surveillance synth√©tique, des donn√©es non compress√©es sont utilis√©es ici). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfb/f35/fad/cfbf35fad375e7141350e3e432039c22.png"></div><br>  <i><font color="#999999">Redimensionnement du manifeste au stade final d'un projet</font></i> <br><br>  Le changement a √©t√© captur√© par le syst√®me de surveillance ResourceLoader.  La capture d'√©cran montre le panneau de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">taille du manifeste de d√©marrage</a> situ√© dans une instance publique de Grafana.  Ici, vous pouvez voir que la taille du flux de donn√©es non compress√© a diminu√© de 2,8 Ko. <br><br>  Le d√©ploiement du syst√®me, qui a eu lieu √† la mi-septembre, a permis d'atteindre l'objectif initial, qui √©tait de compresser le manifeste √† une taille ne d√©passant pas 28 Ko.  La mise en ≈ìuvre de ce projet √† grande √©chelle a conduit au fait que le manifeste d'initialisation a √©t√© r√©duit de 9 Ko (nous parlons de donn√©es compress√©es).  Il y a un an, cette taille √©tait de 36,2 Ko, et apr√®s l'ach√®vement du projet, elle √©tait d√©j√† de 27,2 Ko. <br><br>  Environ 363 000 pages vues sont g√©n√©r√©es chaque minute sur Wikip√©dia et les projets connexes.  En une heure - 21 millions et 800 mille.  Quotidien - 523 millions ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">voici les</a> statistiques sur les pages vues).  Cette version du syst√®me, qui a √©t√© d√©ploy√©e √† la mi-septembre, a permis d'√©conomiser environ 1,4 t√©raoctets de trafic par jour.  Et si vous comparez ce qui est aujourd'hui √† ce qu'il √©tait il y a un an, il s'av√®re que 4,3 t√©raoctets de trafic sont d√©sormais enregistr√©s quotidiennement. <br><br><h2>  <font color="#3AC1EF">Et ensuite?</font> </h2><br>  Nous avons r√©ussi √† adapter le manifeste d'initialisation Wikipedia de 28 Ko.  C'est la taille qui a √©t√© choisie car c'est la plus petite qui soit un multiple de 14 Kb.  Des donn√©es de cette taille peuvent √™tre plac√©es dans des fragments de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√©quence de</a> paquets Internet transmis au navigateur. <br><br>  Nous sommes maintenant confront√©s √† une nouvelle t√¢che: ne pas abandonner de postes.  Au cours de la derni√®re ann√©e, j'ai suivi de pr√®s le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manifeste</a> .  Je l'ai fait afin de garantir nos succ√®s et de d√©couvrir les probl√®mes potentiels qui nous font reculer.  Au final, j'ai automatis√© ce processus en utilisant le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tableau de bord</a> public <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grafana</a> . <br><br>  Si vous croyez √† ce panneau, alors nous avons encore de nombreuses opportunit√©s pour am√©liorer le packaging du code, et pour r√©soudre des probl√®mes encore plus forts que maintenant, faciliter la cr√©ation de bundles.  J'esp√®re que ces am√©liorations √† venir nous seront utiles, mais pour l'instant nous travaillons sur de nouvelles fonctionnalit√©s du syst√®me, tout en nous effor√ßant de respecter les exigences de niveau de performance du projet. <br><br>  <b>Chers lecteurs!</b>  Avez-vous d√©j√† particip√© √† l'optimisation de grands projets Internet? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470874/">https://habr.com/ru/post/fr470874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470858/index.html">Antiquit√©s: r√©f√©rence du 386e processeur et des ann√©es 90 fringantes</a></li>
<li><a href="../fr470864/index.html">√Ä propos des plaisirs de passer au panneau et pas seulement</a></li>
<li><a href="../fr470868/index.html">Temps de premier octet: qu'est-ce que c'est et pourquoi est-il important</a></li>
<li><a href="../fr470870/index.html">Pr√©chargement des polices</a></li>
<li><a href="../fr470872/index.html">Mesures de performances pour la recherche d'applications Web incroyablement rapides</a></li>
<li><a href="../fr470876/index.html">Cr√©ez des constructions de syntaxe JavaScript personnalis√©es √† l'aide de Babel. Partie 1</a></li>
<li><a href="../fr470878/index.html">Cr√©ez des constructions de syntaxe JavaScript personnalis√©es √† l'aide de Babel. 2e partie</a></li>
<li><a href="../fr470880/index.html">M√©canique du jeu. Aventure, le concept de l'orthophonie z√©ro et convaincante</a></li>
<li><a href="../fr470882/index.html">Pourquoi avez-vous attrap√© ma souris ou un jeu de soci√©t√© comme mod√®le d'interaction sociale</a></li>
<li><a href="../fr470884/index.html">√âcriture et lecture de donn√©es dans la blockchain Bitcoin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>