<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ€ ğŸ’´ ğŸ Angularä¸­çš„äº‹ä»¶å¤„ç†ä¼˜åŒ– ğŸµ ğŸ’² ğŸ–•ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 


 Angularä½¿ç”¨è¯­æ³•(eventName)="onEventName($event)"æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„å£°æ˜æ€§æ–¹å¼æ¥è®¢é˜…æ¨¡æ¿ä¸­çš„(eventName)="onEventName($event)" ã€‚ ä¸ChangeDetectionStrategy.OnPushæ›´æ”¹æ£€æŸ¥ç­–ç•¥ä¸€èµ·ï¼Œæ­¤æ–¹æ³•...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Angularä¸­çš„äº‹ä»¶å¤„ç†ä¼˜åŒ–</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/429692/"><h1 id="vvedenie"> å¼•è¨€ </h1><br><p> Angularä½¿ç”¨è¯­æ³•<code>(eventName)="onEventName($event)"</code>æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„å£°æ˜æ€§æ–¹å¼æ¥è®¢é˜…æ¨¡æ¿ä¸­çš„<code>(eventName)="onEventName($event)"</code> ã€‚ ä¸<code>ChangeDetectionStrategy.OnPush</code>æ›´æ”¹æ£€æŸ¥ç­–ç•¥ä¸€èµ·ï¼Œæ­¤æ–¹æ³•ä»…é’ˆå¯¹æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç”¨æˆ·è¾“å…¥è‡ªåŠ¨å¯åŠ¨æ›´æ”¹æ£€æŸ¥å‘¨æœŸã€‚ æ¢å¥è¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä¾¦å¬<code>&lt;input&gt;</code>å…ƒç´ ä¸Šçš„<code>(input)</code>äº‹ä»¶ï¼Œé‚£ä¹ˆå¦‚æœç”¨æˆ·ä»…å•å‡»è¾“å…¥å­—æ®µï¼Œåˆ™ä¸ä¼šè§¦å‘æ›´æ”¹æ£€æŸ¥ã€‚ å¤§å¤§æ”¹å–„ <br> æ€§èƒ½ä¸é»˜è®¤ç­–ç•¥ï¼ˆ <code>ChangeDetectionStrategy.Default</code> ï¼‰çš„æ¯”è¾ƒã€‚ åœ¨æŒ‡ä»¤ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<code>@HostListener('eventName')</code>è£…é¥°å™¨é¢„è®¢hostå…ƒç´ ä¸Šçš„äº‹ä»¶ã€‚ </p><br><p> åœ¨æˆ‘çš„å®è·µä¸­ï¼Œé€šå¸¸åªæœ‰åœ¨æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹æ‰éœ€è¦å¤„ç†ç‰¹å®šäº‹ä»¶ã€‚ å³ å¤„ç†ç¨‹åºçœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><a name="habracut"></a><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ComponentWithEventHandler</span></span></span><span class="hljs-class"> { // ... onEvent(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Event</span></span></span><span class="hljs-class">) { if (!</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">condition</span></span></span><span class="hljs-class">) { return; } // </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Handling</span></span></span><span class="hljs-class"> event ... } }</span></span></code> </pre> <br><p> å³ä½¿ä¸æ»¡è¶³æ¡ä»¶å¹¶ä¸”å®é™…ä¸Šæ²¡æœ‰å‘ç”Ÿä»»ä½•åŠ¨ä½œï¼Œæ›´æ”¹éªŒè¯å‘¨æœŸä»å°†å¼€å§‹ã€‚ å¦‚æœå‘ç”Ÿé¢‘ç¹äº‹ä»¶ï¼Œä¾‹å¦‚<code>scroll</code>æˆ–<code>scroll</code> ï¼Œè¿™å¯èƒ½ä¼šå¯¹åº”ç”¨ç¨‹åºæ€§èƒ½äº§ç”Ÿä¸åˆ©å½±å“ã€‚ </p><br><p> åœ¨æˆ‘æ­£åœ¨ä½¿ç”¨çš„ç»„ä»¶UIåº“ä¸­ï¼Œåœ¨ä¸‹æ‹‰èœå•ä¸­è®¢é˜…<code>mousemove</code>è§¦å‘æ¯æ¬¡é¼ æ ‡ç§»åŠ¨é‡æ–°è®°å½•æ•´ä¸ªç»„ä»¶æ ‘çš„æ›´æ”¹ã€‚ å¿…é¡»ç›‘è§†é¼ æ ‡ä»¥å®ç°æ­£ç¡®çš„èœå•è¡Œä¸ºï¼Œä½†æ˜¯æ˜¾ç„¶å€¼å¾—è¿›è¡Œä¼˜åŒ–ã€‚ åœ¨ä¸‹é¢çš„æ›´å¤šå†…å®¹ã€‚ </p><br><p> è¿™æ ·çš„æ—¶åˆ»å¯¹äºé€šç”¨UIå…ƒç´ å°¤å…¶é‡è¦ã€‚ é¡µé¢ä¸Šå¯èƒ½æœ‰å¾ˆå¤šï¼Œåº”ç”¨ç¨‹åºå¯èƒ½éå¸¸å¤æ‚ä¸”å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜ã€‚ </p><br><p> æ‚¨å¯ä»¥é€šè¿‡ç»•è¿‡<code>ngZone</code>è®¢é˜…äº‹ä»¶æ¥çº æ­£è¿™ç§æƒ…å†µï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨<code>Observable.fromEvent</code>å¹¶å¼€å§‹æ‰‹åŠ¨æ£€æŸ¥æ›´æ”¹ï¼ˆè°ƒç”¨<code>changeDetectorRef.markForCheck()</code> ã€‚ ä½†æ˜¯ï¼Œè¿™å¢åŠ äº†å¾ˆå¤šé¢å¤–çš„å·¥ä½œï¼Œå¹¶ä¸”æ— æ³•ä½¿ç”¨ä¾¿æ·çš„å†…ç½®Angularå·¥å…·ã€‚ </p><br><p>  Angularå…è®¸æ‚¨è®¢é˜…æ‰€è°“çš„ä¼ªäº‹ä»¶å¹¶å‡†ç¡®æŒ‡å®šæˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶å·²ç»ä¸æ˜¯ä»€ä¹ˆç§˜å¯†äº†ã€‚ æˆ‘ä»¬å¯ä»¥ç¼–å†™<code>(keydown.enter)="onEnter($event)"</code>å¹¶ä¸”ä»…åœ¨æŒ‰ä¸‹<code>Enter</code>é”®æ—¶æ‰è°ƒç”¨å¤„ç†ç¨‹åºï¼ˆä»¥åŠæ›´æ”¹æ£€æŸ¥å‘¨æœŸï¼‰ï¼Œå…¶ä½™çš„æŒ‰é”®å°†è¢«å¿½ç•¥ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å¦‚ä½•ä½¿ç”¨ä¸Angularç›¸åŒçš„æ–¹æ³•æ¥ä¼˜åŒ–äº‹ä»¶å¤„ç†ã€‚ å¦å¤–ï¼Œæ·»åŠ <code>.prevent</code>å’Œ<code>.stop</code> ï¼Œè¿™å°†å–æ¶ˆé»˜è®¤è¡Œä¸ºå¹¶é˜»æ­¢äº‹ä»¶è‡ªåŠ¨<code>.stop</code> ã€‚ </p><br><h1 id="eventmanagerplugin">  EventManageræ’ä»¶ </h1><br><div style="text-align:center;"><img width="600" height="600" src="https://habrastorage.org/webt/ss/vr/ls/ssvrlsnebhii2-bcfct4kcmvllu.jpeg"></div><br><p>  Angularä½¿ç”¨<code>EventManager</code>ç±»æ¥å¤„ç†äº‹ä»¶ã€‚ å®ƒå…·æœ‰ä¸€ç»„æ‰€è°“çš„æ’ä»¶ï¼Œè¿™äº›æ’ä»¶æ‰©å±•äº†æŠ½è±¡çš„<code>EventManagerPlugin</code>å¹¶å°†äº‹ä»¶è®¢é˜…å¤„ç†å§”æ‰˜ç»™æ”¯æŒè¯¥äº‹ä»¶çš„æ’ä»¶ï¼ˆæŒ‰åç§°ï¼‰ã€‚  Angularä¸­æœ‰å‡ ä¸ªæ’ä»¶ï¼ŒåŒ…æ‹¬HammerJSäº‹ä»¶å¤„ç†å’Œä¸€ä¸ªè´Ÿè´£å¤åˆäº‹ä»¶ï¼ˆå¦‚<code>keydown.enter</code>çš„æ’ä»¶ã€‚ è¿™æ˜¯Angularçš„å†…éƒ¨å®ç°ï¼Œå¹¶ä¸”æ­¤æ–¹æ³•å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ ä½†æ˜¯ï¼Œè‡ªä»åˆ›å»ºæœ‰å…³æ­¤è§£å†³æ–¹æ¡ˆçš„é—®é¢˜ä»¥æ¥å·²ç»è¿‡å»äº†3å¹´ï¼Œåœ¨è¿™ä¸ªæ–¹å‘ä¸Šæ²¡æœ‰å–å¾—ä»»ä½•è¿›å±•ï¼š </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/angular/angular/issues/3929</a> </p><br><p> è¿™å¯¹æˆ‘ä»¬æœ‰ä»€ä¹ˆæœ‰è¶£çš„ï¼Ÿ å°½ç®¡è¿™äº›ç±»æ˜¯å†…éƒ¨çš„å¹¶ä¸”ä¸èƒ½ä»å®ƒä»¬ç»§æ‰¿ï¼Œä½†è´Ÿè´£å®ç°æ’ä»¶ä¾èµ–æ€§çš„ä»¤ç‰Œæ˜¯å…¬å…±çš„ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç¼–å†™è‡ªå·±çš„æ’ä»¶ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æ‰©å±•å†…ç½®çš„äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚ </p><br><p> å¦‚æœæ‚¨æŸ¥çœ‹<code>EventManagerPlugin</code>çš„æºä»£ç ï¼Œæ‚¨ä¼šå‘ç°æˆ‘ä»¬å°†æ— æ³•ä»ä¸­ç»§æ‰¿å®ƒï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æŠ½è±¡çš„ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“å®ç°æ»¡è¶³å…¶è¦æ±‚çš„æˆ‘ä»¬è‡ªå·±çš„ç±»ï¼š </p><br><p>  <a href="">https://github.com/angular/angular/blob/master/packages/platform-bâ€‹â€‹rowser/src/dom/events/event_manager.ts#L92</a> </p><br><p> ç²—ç•¥åœ°è¯´ï¼Œè¯¥æ’ä»¶åº”è¯¥èƒ½å¤Ÿç¡®å®šå®ƒæ˜¯å¦ä¸æ­¤äº‹ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ä¸”åº”è¯¥èƒ½å¤Ÿæ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºå’Œå…¨å±€å¤„ç†ç¨‹åºï¼ˆåœ¨<code>body</code> ï¼Œ <code>window</code>å’Œ<code>document</code> ï¼‰ã€‚ æˆ‘ä»¬å°†å¯¹<code>.filter</code> ï¼Œ <code>.prevent</code>å’Œ<code>.stop</code>ä¿®é¥°ç¬¦æ„Ÿå…´è¶£ã€‚ è¦å°†å®ƒä»¬ç»‘å®šåˆ°æˆ‘ä»¬çš„æ’ä»¶ï¼Œæˆ‘ä»¬å®ç°äº†å¿…éœ€çš„æ–¹æ³•<code>supports</code> ï¼š </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FILTER = <span class="hljs-string"><span class="hljs-string">'.filter'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PREVENT = <span class="hljs-string"><span class="hljs-string">'.prevent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STOP = <span class="hljs-string"><span class="hljs-string">'.stop'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FilteredEventPlugin</span></span> { supports(<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>): boolean { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.includes(FILTER) || <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.includes(PREVENT) || <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.includes(STOP) ); } }</code> </pre> <br><p> å› æ­¤ï¼Œ <code>EventManager</code>å°†äº†è§£å¿…é¡»å°†å…·æœ‰æŸäº›ä¿®é¥°ç¬¦åç§°çš„äº‹ä»¶ä¼ é€’ç»™æˆ‘ä»¬çš„æ’ä»¶è¿›è¡Œå¤„ç†ã€‚ ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å®ç°äº‹ä»¶å¤„ç†ç¨‹åºçš„æ·»åŠ ã€‚ æˆ‘ä»¬å¯¹å…¨å±€å¤„ç†ç¨‹åºä¸æ„Ÿå…´è¶£ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹æ­¤ç±»å·¥å…·çš„éœ€æ±‚è¦å°‘å¾—å¤šï¼Œå¹¶ä¸”å®ç°ä¼šæ›´åŠ å¤æ‚ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€ä»äº‹ä»¶åç§°ä¸­åˆ é™¤ä¿®é¥°ç¬¦ï¼Œç„¶åå°†å…¶è¿”å›ç»™<code>EventManager</code> ï¼Œå³å¯<code>EventManager</code>æ­£ç¡®çš„å†…ç½®æ’ä»¶è¿›è¡Œå¤„ç†ï¼š </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FilteredEventPlugin</span></span></span><span class="hljs-class"> { supports(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">): boolean { // ... } addGlobalEventListener( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eventName</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">handler</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Function</span></span></span><span class="hljs-class">, ): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Function</span></span></span><span class="hljs-class"> { const event = eventName .replace(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FILTER</span></span></span><span class="hljs-class">, '') .replace(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PREVENT</span></span></span><span class="hljs-class">, '') .replace(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">STOP</span></span></span><span class="hljs-class">, ''); return this.manager.addGlobalEventListener(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">handler</span></span></span><span class="hljs-class">); } }</span></span></code> </pre> <br><p> å¯¹äºå¸¸è§„å…ƒç´ ä¸Šçš„äº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™è‡ªå·±çš„é€»è¾‘ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†å¤„ç†ç¨‹åºå°è£…åœ¨ä¸€ä¸ªé—­åŒ…ä¸­ï¼Œå¹¶å°†ä¸å¸¦ä¿®é¥°ç¬¦çš„äº‹ä»¶ä¼ é€’å›<code>EventManager</code> ï¼Œåœ¨<code>ngZone</code>å¤–éƒ¨è°ƒç”¨å®ƒï¼Œä»¥é¿å…å¯åŠ¨æ›´æ”¹æ£€æŸ¥å‘¨æœŸï¼š </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FilteredEventPlugin</span></span></span><span class="hljs-class"> { supports(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">): boolean { // ... } addEventListener( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HTMLElement</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eventName</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">handler</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Function</span></span></span><span class="hljs-class">, ): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Function</span></span></span><span class="hljs-class"> { const event = eventName .replace(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FILTER</span></span></span><span class="hljs-class">, '') .replace(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PREVENT</span></span></span><span class="hljs-class">, '') .replace(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">STOP</span></span></span><span class="hljs-class">, ''); //     const filtered = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Event</span></span></span><span class="hljs-class">) =&gt; { // ... }; const wrapper = () =&gt; this.manager.addEventListener(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filtered</span></span></span><span class="hljs-class">); return this.manager.getZone().runOutsideAngular(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrapper</span></span></span><span class="hljs-class">); } /* addGlobalEventListener(...): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Function</span></span></span><span class="hljs-class"> { ... } */ }</span></span></code> </pre> <br><p> åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬æœ‰ï¼šäº‹ä»¶çš„åç§°ï¼Œäº‹ä»¶æœ¬èº«ä»¥åŠåœ¨å…¶ä¸Šä¾¦å¬çš„å…ƒç´ ã€‚ åˆ°è¾¾æ­¤å¤„çš„å¤„ç†ç¨‹åºä¸æ˜¯åˆ†é…ç»™æ­¤äº‹ä»¶çš„æºå¤„ç†ç¨‹åºï¼Œè€Œæ˜¯Angularä¸ºè‡ªèº«ç›®çš„åˆ›å»ºçš„é—­åˆé“¾çš„æœ«å°¾ã€‚ </p><br><p> ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åœ¨å…ƒç´ ä¸­æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œè¯¥å±æ€§è´Ÿè´£æ˜¯å¦è°ƒç”¨å¤„ç†ç¨‹åºã€‚ æœ‰æ—¶ï¼Œè¦åšå‡ºå†³å®šï¼Œæœ‰å¿…è¦åˆ†æäº‹ä»¶æœ¬èº«ï¼šé»˜è®¤åŠ¨ä½œæ˜¯å¦å·²å–æ¶ˆï¼Œå“ªä¸ªå…ƒç´ æ˜¯äº‹ä»¶çš„æ¥æºï¼Œç­‰ç­‰ã€‚ ä¸€ä¸ªå±æ€§è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥è®¾ç½®ä¸€ä¸ªæ¥æ”¶äº‹ä»¶å¹¶è¿”å›<code>true</code>æˆ–<code>false</code>çš„è¿‡æ»¤å™¨å‡½æ•°ã€‚ ç„¶åæˆ‘ä»¬å¯ä»¥å°†å¤„ç†ç¨‹åºæè¿°å¦‚ä¸‹ï¼š </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filtered = (<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>: Event) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = getOurHandler(some_arguments); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !eventName.includes(FILTER) || !filter || filter(<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventName.includes(PREVENT)) { <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.preventDefault(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventName.includes(STOP)) { <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.stopPropagation(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.manager.getZone().run(() =&gt; handler(<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>)); } };</code> </pre> <br><h1 id="reshenie"> è§£å†³æ–¹æ¡ˆ </h1><br><p> è§£å†³æ–¹æ¡ˆå¯ä»¥æ˜¯å•ä¾‹æœåŠ¡ï¼Œè¯¥æœåŠ¡å­˜å‚¨å…ƒç´ ä¸äº‹ä»¶/è¿‡æ»¤å™¨å¯¹çš„å¯¹åº”å…³ç³»ä»¥åŠç”¨äºè®¾ç½®è¿™äº›å¯¹åº”å…³ç³»çš„è¾…åŠ©å®ä½“ã€‚ å½“ç„¶ï¼Œåœ¨ä¸€ä¸ªå…ƒç´ ä¸Šï¼ŒåŒä¸€äº‹ä»¶å¯ä»¥æœ‰å¤šä¸ªå¤„ç†ç¨‹åºï¼Œä½†æ˜¯é€šå¸¸ï¼Œå®ƒæ—¢å¯ä»¥æ˜¯<code>@HostListener</code> ï¼Œä¹Ÿå¯ä»¥æ˜¯å®‰è£…åœ¨æ›´é«˜ä¸€çº§æ¨¡æ¿ä¸­æ­¤ç»„ä»¶ä¸Šçš„å¤„ç†ç¨‹åºã€‚ æˆ‘ä»¬å°†é¢„è§è¿™ç§æƒ…å†µï¼Œè€Œå…¶ä»–æƒ…å†µç”±äºå…¶ç‰¹æ®Šæ€§è€Œä½¿æˆ‘ä»¬ä¸æ„Ÿå…´è¶£ã€‚ </p><br><p> ä¸»è¦æœåŠ¡éå¸¸ç®€å•ï¼Œç”±åœ°å›¾å’Œå‡ ç§ç”¨äºè®¾ç½®ï¼Œæ¥æ”¶å’Œæ¸…æ´è¿‡æ»¤å™¨çš„æ–¹æ³•ç»„æˆï¼š </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Filter</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Event</span></span></span><span class="hljs-class">) =&gt; boolean; export </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Filters</span></span></span><span class="hljs-class"> = {[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">]: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Filter</span></span></span><span class="hljs-class">}; class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FilteredEventMainService</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">elements</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Map</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Element</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Filters</span></span></span><span class="hljs-class">&gt; = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Map</span></span></span><span class="hljs-class">(); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">register</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Element</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filters</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Filters</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">elements</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filters</span></span></span><span class="hljs-class">); } unregister(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Element</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">elements</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">delete</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">); } getFilter(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Element</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Filter</span></span></span><span class="hljs-class"> | null { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">elements</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">element</span></span></span><span class="hljs-class">); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class"> ? </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">] || </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class">; } }</span></span></code> </pre> <br><p> å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ’ä»¶ä¸­å®ç°æ­¤æœåŠ¡ï¼Œå¹¶é€šè¿‡ä¼ é€’å…ƒç´ å’Œäº‹ä»¶åç§°æ¥æ¥æ”¶è¿‡æ»¤å™¨ã€‚ ä¸ºäº†ä¸<code>@HostListener</code>ç»“åˆä½¿ç”¨<code>@HostListener</code>æˆ‘ä»¬æ·»åŠ äº†å¦ä¸€ä¸ªä¸ç»„ä»¶ä¸€èµ·ä½¿ç”¨çš„å°å‹æœåŠ¡ï¼Œå¹¶åœ¨åˆ é™¤è¯¥ç»„ä»¶æ—¶æ¸…é™¤äº†ç›¸åº”çš„è¿‡æ»¤å™¨ï¼š </p><br><pre> <code class="hljs kotlin">export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventFiltersService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>( <span class="hljs-meta"><span class="hljs-meta">@Inject(ElementRef)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly elementRef: ElementRef, <span class="hljs-meta"><span class="hljs-meta">@Inject(FilteredEventMainService)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly mainService: FilteredEventMainService, ) {} ngOnDestroy() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mainService.unregister(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementRef.nativeElement); } register(filters: Filters) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mainService.register(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementRef.nativeElement, filters); } }</code> </pre> <br><p> è¦å°†è¿‡æ»¤å™¨æ·»åŠ åˆ°å…ƒç´ ï¼Œå¯ä»¥æ‰§è¡Œç±»ä¼¼çš„æŒ‡ä»¤ï¼š </p><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventFiltersDirective</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Input()</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> eventFilters(filters: Filters) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mainService.register(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementRef.nativeElement, filters); } <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>( <span class="hljs-meta"><span class="hljs-meta">@Inject(ElementRef)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly elementRef: ElementRef, <span class="hljs-meta"><span class="hljs-meta">@Inject(FilteredEventMainService)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly mainService: FilteredEventMainService, ) {} ngOnDestroy() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mainService.unregister(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementRef.nativeElement); } }</code> </pre> <br><p> å¦‚æœæœ‰ç”¨äºè¿‡æ»¤ç»„ä»¶å†…éƒ¨äº‹ä»¶çš„æœåŠ¡ï¼Œæˆ‘ä»¬å°†ä¸å…è®¸é€šè¿‡æŒ‡ä»¤å°†è¿‡æ»¤å™¨æŒ‚åœ¨å…¶ä¸Šã€‚ æœ€åï¼Œè¿™å‡ ä¹æ€»æ˜¯å¯ä»¥é€šè¿‡å°†ç»„ä»¶ä¸æˆ‘ä»¬çš„æŒ‡ä»¤å°†åˆ†é…åˆ°çš„å…ƒç´ åŒ…è£…åœ¨ä¸€èµ·æ¥å®Œæˆçš„ã€‚ ä¸ºäº†ç†è§£è¯¥å…ƒç´ ä¸Šå·²ç»å­˜åœ¨æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨æŒ‡ä»¤ä¸­å®ç°è¯¥æœåŠ¡ï¼š </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EventFiltersDirective</span></span></span><span class="hljs-class"> { // ... constructor( @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Optional</span></span></span><span class="hljs-class">() @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Self</span></span></span><span class="hljs-class">() @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Inject</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FiltersService</span></span></span><span class="hljs-class">) private readonly filtersService: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FiltersService</span></span></span><span class="hljs-class"> | null, ) {} // ... }</span></span></code> </pre> <br><p> å¦‚æœå­˜åœ¨æ­¤æœåŠ¡ï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼ŒæŒ‡å‡ºè¯¥æŒ‡ä»¤ä¸é€‚ç”¨äºå®ƒï¼š </p><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventFiltersDirective</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Input()</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> eventFilters(filters: Filters) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventFiltersService === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { console.warn(ALREADY_APPLIED_MESSAGE); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mainService.register(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementRef.nativeElement, filters); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><div style="text-align:center;"><img width="324" height="500" src="https://habrastorage.org/webt/k5/qi/rd/k5qirdkshv3m4cwjfzama7topjm.jpeg"></div><br><h1 id="primenenie-na-praktike"> å®é™…åº”ç”¨ </h1><br><p> å¯ä»¥åœ¨Stackblitzä¸Šæ‰¾åˆ°æ‰€æœ‰æè¿°çš„ä»£ç ï¼š </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://stackblitz.com/edit/angular-event-filter</a> </p><br><p> ä½œä¸ºä½¿ç”¨ç¤ºä¾‹ï¼Œæ­¤å¤„æ˜¾ç¤ºäº†ä¸€ä¸ªè™šæ„çš„<code>select</code> -æ¨¡æ€çª—å£å†…çš„ç»„ä»¶-ä»¥åŠå…¶ä¸‹æ‹‰èœå•ä¸­çš„ä¸Šä¸‹æ–‡èœå•ã€‚ å¯¹äºä¸Šä¸‹æ–‡èœå•ï¼Œå¦‚æœæ£€æŸ¥ä»»ä½•å®ç°ï¼Œå°†å§‹ç»ˆçœ‹åˆ°ä»¥ä¸‹è¡Œä¸ºï¼šå°†é¼ æ ‡æ‚¬åœåœ¨æŸä¸ªé¡¹ç›®ä¸Šæ—¶ï¼Œå®ƒå°†èšç„¦ï¼Œå½“æ‚¨æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ç®­å¤´æ—¶ï¼Œç„¦ç‚¹å°†åœ¨é¡¹ç›®ä¸­ç§»åŠ¨ï¼Œä½†æ˜¯å¦‚æœæ‚¨ç§»åŠ¨é¼ æ ‡ï¼Œåˆ™ç„¦ç‚¹å°†è¿”å›åˆ°å…ƒç´ ä½äºé¼ æ ‡æŒ‡é’ˆä¸‹æ–¹ã€‚ çœ‹èµ·æ¥è¿™ç§è¡Œä¸ºå¾ˆå®¹æ˜“å®ç°ï¼Œä½†æ˜¯ï¼Œå¯¹<code>mousemove</code>äº‹ä»¶çš„ä¸å¿…è¦ååº”ä¼šè§¦å‘æ•°åä¸ªæ— ç”¨çš„æ›´æ”¹æ£€æŸ¥å‘¨æœŸã€‚ é€šè¿‡å°†äº‹ä»¶<code>target</code>å…ƒç´ çš„ç„¦ç‚¹è®¾ç½®ä¸ºè¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æ¶ˆé™¤è¿™äº›ä¸å¿…è¦çš„è§¦å‘ï¼Œåªä¿ç•™é‚£äº›çœŸæ­£å…·æœ‰ç„¦ç‚¹çš„è§¦å‘å™¨ã€‚ </p><br><div style="text-align:center;"><img width="600" height="325" src="https://habrastorage.org/webt/ha/4m/1r/ha4m1rwr3suhds0xl1cdgbc1lso.gif"></div><br><p> åŒæ ·ï¼Œæ­¤<code>select</code>ç»„ä»¶å¯¹<code>@HostListener</code>è®¢é˜…å…·æœ‰ç­›é€‰ã€‚ å½“æ‚¨åœ¨å¼¹å‡ºçª—å£ä¸­æŒ‰<code>Esc</code> ï¼Œå®ƒå°†å…³é—­ã€‚ ä»…å½“åœ¨æŸäº›åµŒå¥—ç»„ä»¶ä¸­ä¸éœ€è¦å•å‡»å¹¶ä¸”åœ¨å…¶ä¸­æœªå¯¹å…¶è¿›è¡Œå¤„ç†æ—¶ï¼Œæ‰åº”æ‰§è¡Œæ­¤æ“ä½œã€‚ åœ¨<code>select</code>æŒ‰<code>Esc</code>å…³é—­ä¸‹æ‹‰èœå•ï¼Œå¹¶å°†ç„¦ç‚¹è¿”å›åˆ°å­—æ®µæœ¬èº«ï¼Œä½†æ˜¯ï¼Œå¦‚æœè¯¥å­—æ®µå·²å…³é—­ï¼Œåˆ™ä¸åº”é˜»æ­¢äº‹ä»¶å¼¹å‡ºå¹¶åœ¨ä»¥åå…³é—­æ¨¡å¼çª—å£ã€‚ å› æ­¤ï¼Œå¤„ç†å¯ä»¥ç”±è£…é¥°å™¨æè¿°ï¼š </p><br><p>  <code>@HostListener('keydown.esc.filtered.stop')</code> ï¼Œ <code>@HostListener('keydown.esc.filtered.stop')</code> ï¼š <code>() =&gt; this.opened</code> ã€‚ </p><br><p> ç”±äº<code>select</code>æ˜¯å…·æœ‰å¤šä¸ªå¯èšç„¦å…ƒç´ çš„ç»„ä»¶ï¼Œå› æ­¤å¯ä»¥é€šè¿‡<code>focusout</code>å¼¹å‡ºäº‹ä»¶è·Ÿè¸ªå…¶æ€»ä½“èšç„¦ã€‚ å®ƒä»¬å°†ä»¥æ‰€æœ‰ç„¦ç‚¹æ›´æ”¹å‘ç”Ÿï¼ŒåŒ…æ‹¬é‚£äº›ä¸è¶…å‡ºç»„ä»¶è¾¹ç•Œçš„æ›´æ”¹ã€‚ è¯¥äº‹ä»¶æœ‰ä¸€ä¸ª<code>relatedTarget</code>å­—æ®µï¼Œç”¨äº<code>relatedTarget</code>ç„¦ç‚¹ç§»åŠ¨çš„ä½ç½®ã€‚ ç»è¿‡åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£æ˜¯å¦ä¸ºç»„ä»¶è°ƒç”¨<code>blur</code>äº‹ä»¶çš„æ¨¡æ‹Ÿï¼š </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @HostListener('focusout.filtered') onBlur() { this.opened = false; } // ... }</span></span></code> </pre> <br><p> åŒæ—¶ï¼Œè¿‡æ»¤å™¨å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> focusOutFilter = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{relatedTarget}: FocusEvent</span></span></span><span class="hljs-function">) =&gt;</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementRef.nativeElement.contains(relatedTarget);</code> </pre> <br><h1 id="vyvod"> ç»“è®º </h1><br><p> ä¸å¹¸çš„æ˜¯ï¼ŒAngularä¸­å¯¹å¤åˆé”®å‡»çš„å†…ç½®å¤„ç†ä»å°†åœ¨<code>NgZone</code>å¼€å§‹ï¼Œè¿™æ„å‘³ç€å®ƒå°†æ£€æŸ¥æ›´æ”¹ã€‚ å¦‚æœéœ€è¦çš„è¯ï¼Œæˆ‘ä»¬ä¸èƒ½æ±‚åŠ©äºå†…ç½®å¤„ç†ï¼Œä½†æ˜¯æ€§èƒ½æå‡ä¼šå¾ˆå°ï¼Œå¹¶ä¸”åœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼ŒAngularå†…éƒ¨â€œå¨æˆ¿â€ä¸­çš„å‡¹æ§½å……æ»¡äº†ç ´è£‚ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è¦ä¹ˆæ”¾å¼ƒå¤åˆäº‹ä»¶ï¼Œè¦ä¹ˆä½¿ç”¨ç±»ä¼¼äºè¾¹ç•Œè¿ç®—ç¬¦çš„è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”åœ¨ä¸ç›¸å…³çš„åœ°æ–¹ç®€å•åœ°ä¸è°ƒç”¨å¤„ç†ç¨‹åºã€‚ </p><br><p> è¿›å…¥Angularçš„å†…éƒ¨äº‹ä»¶å¤„ç†æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ï¼Œå› ä¸ºå†…éƒ¨å®ç°å¯èƒ½ä¼šåœ¨å°†æ¥å‘ç”Ÿå˜åŒ–ã€‚ è¿™ä½¿æˆ‘ä»¬ä¸å¾—ä¸éµå¾ªæ›´æ–°ï¼Œç‰¹åˆ«æ˜¯æœ¬æ–‡ç¬¬äºŒéƒ¨åˆ†ä¸­ç»™å‡ºçš„GitHubä¸Šçš„ä»»åŠ¡ã€‚ ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°è¿‡æ»¤å¤„ç†ç¨‹åºçš„æ‰§è¡Œå¹¶å¼€å§‹æ£€æŸ¥æ›´æ”¹ï¼›ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰æœºä¼šåœ¨å£°æ˜è®¢é˜…æ—¶æ–¹ä¾¿åœ°åº”ç”¨äº‹ä»¶å¤„ç†ä¸­å…¸å‹çš„<code>preventDefault</code>å’Œ<code>stopPropagation</code>æ–¹æ³•ã€‚ ä»å°†æ¥å¼€å§‹ï¼Œä½¿ç”¨è£…é¥°å™¨ä¸º<code>@HostListener</code>å£°æ˜è¿‡æ»¤å™¨ä¼šæ›´æ–¹ä¾¿ã€‚ åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è®¡åˆ’è®¨è®ºæˆ‘ä»¬åœ¨å®¶é‡Œåˆ›å»ºçš„å‡ ä¸ªè£…é¥°å™¨ï¼Œå¹¶å°è¯•å®ç°æ­¤è§£å†³æ–¹æ¡ˆã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN429692/">https://habr.com/ru/post/zh-CN429692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN429682/index.html">éº»çœç†å·¥å­¦é™¢çš„è¯¾ç¨‹â€œè®¡ç®—æœºç³»ç»Ÿå®‰å…¨â€ã€‚ è®²åº§17ï¼šç”¨æˆ·è®¤è¯ï¼Œç¬¬2éƒ¨åˆ†</a></li>
<li><a href="../zh-CN429684/index.html">Firebase Summit 2018ï¼šç®€è¦ä»‹ç»ä¸»è¦å†…å®¹</a></li>
<li><a href="../zh-CN429686/index.html">éº»çœç†å·¥å­¦é™¢çš„è¯¾ç¨‹â€œè®¡ç®—æœºç³»ç»Ÿå®‰å…¨â€ã€‚ è®²åº§17ï¼šâ€œç”¨æˆ·èº«ä»½éªŒè¯â€ï¼Œç¬¬3éƒ¨åˆ†</a></li>
<li><a href="../zh-CN429688/index.html">å¦‚ä½•åˆ›å»ºä¸€ä¸ªè¢«ç›¸ä¿¡çš„è‹±é›„</a></li>
<li><a href="../zh-CN429690/index.html">Errorx-åœ¨Goä¸­å¤„ç†é”™è¯¯çš„åº“</a></li>
<li><a href="../zh-CN429694/index.html">Mail.Ruç§°Yandexæ’åâ€œè’è°¬â€ï¼Œå¹¶è¦æ±‚ä»ä¸­åˆ é™¤å…¶å“ç‰Œ</a></li>
<li><a href="../zh-CN429696/index.html">å¸¦æœ‰MOSDROIDï¼ƒ13é“çš„è§†é¢‘æŠ¥å‘Š</a></li>
<li><a href="../zh-CN429698/index.html">å¦‚ä½•ä¸Lebedev Studioåˆä½œï¼šTutu.ruç»éªŒ</a></li>
<li><a href="../zh-CN429700/index.html">è€³æœµæ•°å­—çš„å®šä¹‰</a></li>
<li><a href="../zh-CN429702/index.html">è°·æ­Œåˆ†æ Pixel Sync Facebookï¼ŒVKï¼ŒYandexï¼ŒMyTarget</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>