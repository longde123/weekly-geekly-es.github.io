<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâüèº ‚òÇÔ∏è üà∂ Una vez m√°s sobre ImmutableList en Java üë®‚Äçüë©‚Äçüëß‚Äçüëß üò≤ ü§≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En mi art√≠culo anterior, " Ocultando ImmutableList en Java ", propuse una soluci√≥n al problema de la ausencia de listas inmutables en Java, que no est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Una vez m√°s sobre ImmutableList en Java</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471344/"><p>  En mi art√≠culo anterior, " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ocultando ImmutableList en Java</a> ", propuse una soluci√≥n al problema de la ausencia de listas inmutables en Java, que no est√° solucionado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">, ni ahora ni nunca</a> , en Java. </p><br><p>  La soluci√≥n se resolvi√≥ solo al nivel de "existe una idea as√≠", y la implementaci√≥n en el c√≥digo fue torcida, por lo tanto, todo se percibi√≥ un tanto esc√©ptico.  En este art√≠culo, propongo una soluci√≥n modificada.  La l√≥gica de uso y la API se llevan a un nivel aceptable.  La implementaci√≥n en el c√≥digo es hasta el nivel beta. </p><a name="habracut"></a><br><h2 id="postanovka-zadachi">  Declaraci√≥n del problema. </h2><br><p> Utilizaremos las definiciones del art√≠culo original.  En particular, esto significa que <code>ImmutableList</code> es una lista inmutable de referencias a algunos objetos.  Si estos objetos resultan no ser inmutables, la lista tampoco ser√° un objeto inmutable, a pesar del nombre.  En la pr√°ctica, es poco probable que esto perjudique a nadie, pero para evitar expectativas injustificadas es necesario mencionarlo. </p><br><p>  Tambi√©n est√° claro que la inmutabilidad de la lista puede ser "pirateada" por medio de reflexiones, o creando sus propias clases en el mismo paquete, seguido de subir a los campos protegidos de la lista, o algo similar. </p><br><p>  A diferencia del art√≠culo original, no nos adheriremos al principio de "todo o nada": el autor parece creer que si el problema no se puede resolver al nivel JDK, entonces no se debe hacer nada.  (En realidad, otra pregunta, "no se puede resolver" o "los autores de Java no ten√≠an el deseo de resolverlo". Me parece que a√∫n ser√≠a posible al agregar interfaces, clases y m√©todos adicionales para acercar las colecciones existentes a aspecto deseado, aunque menos hermoso que si lo hubiera pensado de inmediato, pero ahora no se trata de eso). </p><br><p>  Crearemos una biblioteca que pueda coexistir con √©xito con las colecciones existentes en Java. </p><br><p>  Las ideas principales de la biblioteca: </p><br><ul><li>  Hay <code>MutableList</code> y <code>MutableList</code> .  Al lanzar tipos es imposible obtener uno del otro. </li><li>  En nuestro proyecto, que queremos mejorar usando la biblioteca, reemplazamos todas las <code>List</code> con una de estas dos interfaces.  Si en alg√∫n momento no puede prescindir de la <code>List</code> , en la primera oportunidad convertiremos la <code>List</code> de / a una de las dos interfaces.  Lo mismo se aplica a los momentos de recepci√≥n / transmisi√≥n de datos a bibliotecas de terceros mediante <code>List</code> . </li><li>  Las conversiones mutuas entre <code>MutableList</code> , <code>MutableList</code> , <code>List</code> deben realizarse lo m√°s r√°pido posible (es decir, sin copiar listas, si es posible).  Sin conversiones "baratas" de ida y vuelta, toda la idea comienza a parecer dudosa. </li></ul><br><p>  Cabe se√±alar que solo se consideran listas, ya que por el momento solo se implementan en la biblioteca.  Pero nada impide que la biblioteca se complemente con <code>Set</code> y <code>Map</code> s. </p><br><h2 id="api">  API </h2><br><h3 id="immutablelist">  Lista inmutable </h3><br><p>  <code>ImmutableList</code> es el sucesor de <code>ReadOnlyList</code> (que, como en el art√≠culo anterior, es una interfaz de <code>List</code> copiada desde la cual se lanzan todos los m√©todos de mutaci√≥n).  M√©todos a√±adidos: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">List&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">MutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contentEquals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iterable&lt;? extends E&gt; iterable)</span></span></span></span>;</code> </pre> <br><p>  El m√©todo <code>toList</code> proporciona la capacidad de pasar una <code>ImmutableList</code> a fragmentos de c√≥digo que esperan una <code>List</code> .  Se devuelve un contenedor en el que todos los m√©todos de modificaci√≥n devuelven una <code>UnsupportedOperationException</code> , y los m√©todos restantes se redirigen a la <code>ImmutableList</code> original. </p><br><p>  El m√©todo <code>mutable</code> convierte una <code>MutableList</code> una <code>MutableList</code> .  Se devuelve un contenedor en el que todos los m√©todos se redirigen a la <code>ImmutableList</code> original hasta el primer cambio.  Antes del cambio, el contenedor se desata de la <code>ImmutableList</code> original, copiando su contenido a la <code>ArrayList</code> interna, a la que se redirigen todas las operaciones. </p><br><p>  El m√©todo <code>contentEquals</code> destinado a comparar el contenido de la lista con el contenido de un <code>Iterable</code> arbitrario pasado (por supuesto, esta operaci√≥n es significativa solo para aquellas implementaciones <code>Iterable</code> que tienen un orden distinto de elementos). </p><br><p>  Tenga en cuenta que en nuestra implementaci√≥n de <code>ReadOnlyList</code> , los <code>listIterator</code> y <code>listIterator</code> devuelven <code>java.util.Iterator</code> / <code>java.util.ListIterator</code> est√°ndar.  Estos iteradores contienen m√©todos de modificaci√≥n que deber√°n suprimirse lanzando una <code>UnsupportedOperationException</code> .  Ser√≠a preferible hacer nuestro <code>ReadOnlyIterator</code> , pero en este caso no podr√≠amos escribir <code>for (Object item : immutableList)</code> , lo que arruinar√≠a de inmediato todo el placer de usar la biblioteca. </p><br><h3 id="mutablelist">  MutableList </h3><br><p>  <code>MutableList</code> es el descendiente de la <code>List</code> regular.  M√©todos a√±adidos: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snapshot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">releaseSnapshot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contentEquals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iterable&lt;? extends E&gt; iterable)</span></span></span></span>;</code> </pre> <br><p>  El m√©todo de <code>snapshot</code> est√° dise√±ado para obtener una "instant√°nea" del estado actual de <code>MutableList</code> como <code>MutableList</code> .  La "instant√°nea" se guarda dentro de <code>MutableList</code> , y si el estado no ha cambiado en el momento de la siguiente llamada al m√©todo, <code>ImmutableList</code> la misma instancia de <code>ImmutableList</code> .  La "instant√°nea" almacenada en su interior se descarta la primera vez que se llama a cualquier m√©todo de modificaci√≥n, o cuando <code>releaseSnapshot</code> llama a <code>releaseSnapshot</code> .  El m√©todo <code>releaseSnapshot</code> se puede usar para ahorrar memoria si est√° seguro de que nadie necesitar√° una "instant√°nea", pero los m√©todos de modificaci√≥n no se llamar√°n pronto. </p><br><h3 id="mutabor">  Mutabor </h3><br><p>  La clase <code>Mutabor</code> proporciona un conjunto de m√©todos est√°ticos que son los "puntos de entrada" a la biblioteca. </p><br><p>  S√≠, el proyecto ahora se llama "mutabor" (est√° en consonancia con "mutable" y, en traducci√≥n, significa "voy a transformar", lo que concuerda con la idea de "transformar" r√°pidamente algunos tipos de colecciones en otros). </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyToImmutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E[] original)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyToImmutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;? extends E&gt; original)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToImmutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;? extends E&gt; original)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">MutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyToMutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;? extends E&gt; original)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E&gt; <span class="hljs-function"><span class="hljs-function">MutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToMutableList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;E&gt; original)</span></span></span></span>;</code> </pre> <br><p>  <code>copyTo*</code> m√©todos <code>copyTo*</code> dise√±ados para crear colecciones apropiadas copiando los datos proporcionados.  Los m√©todos <code>convertTo*</code> una conversi√≥n r√°pida de la colecci√≥n transferida al tipo deseado, y si no fue posible convertir r√°pidamente, realizan una copia lenta.  Si la conversi√≥n r√°pida fue exitosa, la colecci√≥n original se borra y se supone que no se usar√° en el futuro (aunque puede, pero esto no tiene sentido). </p><br><p>  Las llamadas a los constructores de los <code>ImmutableList</code> implementaci√≥n <code>MutableList</code> / <code>MutableList</code> ocultas.  Se supone que el usuario solo trata con interfaces, no crea tales objetos y usa los m√©todos descritos anteriormente para transformar colecciones. </p><br><h2 id="detali-realizacii">  Detalles de implementaci√≥n </h2><br><h3 id="immutablelistimpl">  ImmutableListImpl </h3><br><p>  Encapsula una matriz de objetos.  La implementaci√≥n corresponde aproximadamente a la implementaci√≥n de <code>ArrayList</code> , desde la cual se lanzan todos los m√©todos de modificaci√≥n y comprobaciones de modificaciones concurrentes. </p><br><p>  La implementaci√≥n de los <code>contentEquals</code> <code>toList</code> y <code>contentEquals</code> tambi√©n <code>contentEquals</code> bastante trivial.  El m√©todo <code>toList</code> devuelve un contenedor que redirige las llamadas a una <code>ImmutableList</code> determinada; no se produce una copia lenta de los datos. </p><br><p>  El m√©todo <code>mutable</code> devuelve un <code>MutableListImpl</code> creado en base a esta <code>ImmutableList</code> .  La copia de datos no se produce hasta que se llama a cualquier m√©todo de modificaci√≥n en la <code>MutableList</code> recibida. </p><br><h3 id="mutablelistimpl">  MutableListImpl </h3><br><p>  Encapsula enlaces a <code>ImmutableList</code> y <code>List</code> .  Al crear un objeto, solo uno de estos dos enlaces siempre se llena, el otro permanece <code>null</code> . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> ImmutableList&lt;E&gt; immutable; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> List&lt;E&gt; list;</code> </pre> <br><p>  Los m√©todos inmutables redirigen las llamadas a <code>ImmutableList</code> si no es <code>null</code> , y a <code>List</code> contrario. </p><br><p>  Los m√©todos de modificaci√≥n redirigen las llamadas a la <code>List</code> , despu√©s de inicializar: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(immutable.toList()); } immutable = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre> <br><p>  El m√©todo de la <code>snapshot</code> se ve as√≠: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ImmutableList&lt;E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snapshot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (immutable != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> immutable; } immutable = InternalUtils.convertToImmutableList(list); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (immutable != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//    //   ,  . //     immutable     . list = null; return immutable; } immutable = InternalUtils.copyToImmutableList(list); return immutable; }</span></span></code> </pre> <br><p>  La implementaci√≥n de los <code>contentEquals</code> <code>releaseSnapshot</code> y <code>contentEquals</code> trivial. </p><br><p>  Este enfoque le permite minimizar la cantidad de copias de datos durante el uso "ordinario", reemplazando copias con conversiones r√°pidas. </p><br><h3 id="bystroe-preobrazovanie-spiskov">  Conversi√≥n de lista r√°pida </h3><br><p>  Las conversiones r√°pidas son posibles para las clases <code>ArrayList</code> o <code>Arrays$ArrayList</code> (el resultado del m√©todo <code>Arrays.asList()</code> ).  En la pr√°ctica, en la gran mayor√≠a de los casos, son precisamente estas clases las que se encuentran. </p><br><p>  Dentro de estas clases contienen una serie de elementos.  La esencia de una conversi√≥n r√°pida es obtener una referencia a esta matriz a trav√©s de reflexiones (este es un campo privado) y reemplazarla con una referencia a una matriz vac√≠a.  Esto asegura que la √∫nica referencia a la matriz permanezca con nuestro objeto, y la matriz permanezca sin cambios. </p><br><p>  En la versi√≥n anterior de la biblioteca, se realizaron conversiones r√°pidas de los tipos de colecci√≥n llamando al constructor.  Al mismo tiempo, el objeto de colecci√≥n original se deterior√≥ (se volvi√≥ inadecuado para su uso posterior), que inconscientemente no espera del dise√±ador.  Ahora, se utiliza un m√©todo est√°tico especial para la conversi√≥n, y la colecci√≥n original no se estropea, sino que simplemente se borra.  Por lo tanto, se elimin√≥ el comportamiento inusual aterrador. </p><br><h3 id="problemy-s-equals--hashcode">  Problemas con equals / hashCode </h3><br><p>  Las colecciones Java utilizan un enfoque muy extra√±o para implementar m√©todos <code>equals</code> y <code>hashCode</code> . </p><br><p>  La comparaci√≥n se lleva a cabo de acuerdo con el contenido, que parece ser l√≥gico, pero la clase de la lista en s√≠ misma no se tiene en cuenta.  Por lo tanto, por ejemplo, <code>ArrayList</code> y <code>LinkedList</code> con el mismo contenido ser√°n <code>equals</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Aqu√≠ est√° la implementaci√≥n equals / hashCode de AbstractList (de la cual se hereda ArrayList)</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(o <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> List)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ListIterator&lt;E&gt; e1 = listIterator(); ListIterator e2 = ((List) o).listIterator(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (e1.hasNext() &amp;&amp; e2.hasNext()) { E o1 = e1.next(); Object o2 = e2.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(o1==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? o2==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : o1.equals(o2))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !(e1.hasNext() || e2.hasNext()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hashCode = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (E e : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) hashCode = <span class="hljs-number"><span class="hljs-number">31</span></span>*hashCode + (e==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : e.hashCode()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hashCode; }</code> </pre> </div></div><br><p>  Por lo tanto, ahora se requiere que todas las implementaciones de <code>List</code> tengan una implementaci√≥n <code>equals</code> (y, como resultado, <code>hashCode</code> ).  De lo contrario, puede obtener situaciones en las que <code>a.equals(b) &amp;&amp; !b.equals(a)</code> , lo cual no es bueno.  Una situaci√≥n similar es con <code>Set</code> y <code>Map</code> . </p><br><p>  En la aplicaci√≥n a la biblioteca, esto significa que la implementaci√≥n de <code>equals</code> y <code>hashCode</code> para <code>MutableList</code> predefinida, y en dicha implementaci√≥n, <code>MutableList</code> y <code>MutableList</code> con el mismo contenido no pueden ser <code>equals</code> (ya que <code>ImmutableList</code> no <code>ImmutableList</code> una <code>List</code> ).  Por lo tanto, se han agregado m√©todos <code>contentEquals</code> para comparar contenido. </p><br><p>  La implementaci√≥n de los m√©todos <code>equals</code> y <code>hashCode</code> para <code>hashCode</code> <code>ImmutableList</code> hace completamente similar a la versi√≥n de <code>AbstractList</code> , pero con el reemplazo de <code>List</code> por <code>ReadOnlyList</code> . </p><br><h2 id="itogo">  Total </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Las fuentes y pruebas de la biblioteca se publican por referencia</a> en forma de un proyecto Maven. </p><br><p>  En caso de que alguien quiera usar la biblioteca, ha creado un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">grupo en contacto</a> para "comentarios". </p><br><p>  Usar la biblioteca es bastante obvio, aqu√≠ hay un breve ejemplo: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myBusinessProcess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Entity&gt; tempFromDb = queryEntitiesFromDatabase(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM my_table"</span></span>); ImmutableList&lt;Entity&gt; fromDb = Mutabor.convertToImmutableList(tempFromDb); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromDb.isEmpty() || !someChecksPassed(fromDb)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//... MutableList&lt;Entity&gt; list = fromDb.mutable(); //time to change list.remove(1); ImmutableList&lt;Entity&gt; processed = list.snapshot(); //time to change ended //... if (!callSideLibraryExpectsListParameter(processed.toList())) { return false; } for (Entity entity : processed) { outputToUI(entity); } return true; }</span></span></code> </pre> <br><p>  ¬°Buena suerte a todos!  Enviar informes de errores! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/471344/">https://habr.com/ru/post/471344/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../471332/index.html">Historias de la computadora lunar. Parte 3</a></li>
<li><a href="../471334/index.html">Para memorizar, pero no para api√±ar: aprender "por cartas"</a></li>
<li><a href="../471336/index.html">Holivar Historia de Runet. Parte 6. Cerraduras: acecho, cinta, camino 282 y chino</a></li>
<li><a href="../471340/index.html">Drimsim vs Mate 20 Pro Round! ¬øPero para quien?</a></li>
<li><a href="../471342/index.html">Avalonia con estilo</a></li>
<li><a href="../471346/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 384 (7 al 13 de octubre de 2019)</a></li>
<li><a href="../471348/index.html">Aplicaciones TypeScript de pila completa</a></li>
<li><a href="../471350/index.html">Ingenier√≠a inversa de amplificadores operacionales de bajo ruido desde una computadora anal√≥gica en 1969</a></li>
<li><a href="../471352/index.html">Escribir presentaciones en LaTeX</a></li>
<li><a href="../471358/index.html">¬øC√≥mo escribir un contrato inteligente con Python en ontolog√≠a? Parte 4: API nativa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>