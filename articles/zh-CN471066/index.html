<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💤 🏸 🈲 zip存档是什么样的，我们可以怎么做 👧🏾 🍲 🦈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="美好的一天，亲爱的哈伯！ 

 在过去的半年中，我的宠物项目弯曲的路把我带入了这样的丛林，从那里仍然无法脱身。 一切都以无害的方式开始-一个有图片的网站，但是一种完美主义的感觉，对免费赠品的追求以及我心态的某些特征，使这一切按原计划进行，实际上是一段漫长的旅程。 好吧，好吧，正如一位颇为埋葬的革命家...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>zip存档是什么样的，我们可以怎么做</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471066/">美好的一天，亲爱的哈伯！ <br><br> 在过去的半年中，我的宠物项目弯曲的路把我带入了这样的丛林，从那里仍然无法脱身。 一切都以无害的方式开始-一个有图片的网站，但是一种完美主义的感觉，对免费赠品的追求以及我心态的某些特征，使这一切按原计划进行，实际上是一段漫长的旅程。 好吧，好吧，正如一位颇为埋葬的革命家曾经说过的：“再次学习，学习”，但我（故意）要遵循这种告诫。 <br><br> 哦，我们从主要话题上分散了注意力。 我不会再冗长的演讲让您厌烦，但我会开始做事。 <br><a name="habracut"></a><br><h3> 创建一个zip存档 </h3><br> 原则上，我不会在这里重写<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">规范</a> 。 总体而言，描述结构也是没有意义的，因为所有这些<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工作都是在我之前完成的</a> 。 <br><br> 对于那些懒得跟随链接的人，我将简要概述所有zip归档文件应包含： <br><br><ul><li> 文件输入： <ul><li> 本地文件头 </li><li> 有用的数据 </li><li> 数据描述符（可选，当我们不知道文件大小及其哈希值直到将其读取到最后时使用） </li></ul></li><li> 中央目录文件标题（用于每个文件。就像书的目录，其中指出了可以在其中找到的每个部分和页面） </li><li> 中央目录的结尾 </li></ul><br> 知道了这一点，我们可以尝试编写一个仅包含两个文件的简单存档： <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//        (1.txt  2.txt)   : $entries = [ '1.txt' =&gt; 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc id ante ultrices, fermentum nibh eleifend, ullamcorper nunc. Sed dignissim ut odio et imperdiet. Nunc id felis et ligula viverra blandit a sit amet magna. Vestibulum facilisis venenatis enim sed bibendum. Duis maximus felis in suscipit bibendum. Mauris suscipit turpis eleifend nibh commodo imperdiet. Donec tincidunt porta interdum. Aenean interdum condimentum ligula, vitae ornare lorem auctor in. Suspendisse metus ipsum, porttitor et sapien id, fringilla aliquam nibh. Curabitur sem lacus, ultrices quis felis sed, blandit commodo metus. Duis tincidunt vel mauris at accumsan. Integer et ipsum fermentum leo viverra blandit.', '2.txt' =&gt; 'Mauris in purus sit amet ante tempor finibus nec sed justo. Integer ac nibh tempus, mollis sem vel, consequat diam. Pellentesque ut condimentum ex. Praesent finibus volutpat gravida. Vivamus eleifend neque sit amet diam scelerisque lacinia. Nunc imperdiet augue in suscipit lacinia. Curabitur orci diam, iaculis non ligula vitae, porta pellentesque est. Duis dolor erat, placerat a lacus eu, scelerisque egestas massa. Aliquam molestie pulvinar faucibus. Quisque consequat, dolor mattis lacinia pretium, eros eros tempor neque, volutpat consectetur elit elit non diam. In faucibus nulla justo, non dignissim erat maximus consectetur. Sed porttitor turpis nisl, elementum aliquam dui tincidunt nec. Nunc eu enim at nibh molestie porta ut ac erat. Sed tortor sem, mollis eget sodales vel, faucibus in dolor.', ]; //      Lorem.zip,      cwd (      ) $destination = 'Lorem.zip'; $handle = fopen($destination, 'w'); //      ,    ,     ,   "" Central Directory File Header $written = 0; $dictionary = []; foreach ($entries as $filename =&gt; $content) { //         Local File Header,     //        ,      . $fileInfo = [ //     'versionToExtract' =&gt; 10, //   0,        - 'generalPurposeBitFlag' =&gt; 0, //      ,    0 'compressionMethod' =&gt; 0, // -    mtime ,    ,      ? 'modificationTime' =&gt; 28021, //   , ? 'modificationDate' =&gt; 20072, //      .     ,       ,   ? 'crc32' =&gt; hexdec(hash('crc32b', $content)), //     .        . //       :) 'compressedSize' =&gt; $size = strlen($content), 'uncompressedSize' =&gt; $size, //    'filenameLength' =&gt; strlen($filename), //  .    ,   0. 'extraFieldLength' =&gt; 0, ]; //      . $LFH = pack('LSSSSSLLLSSa*', ...array_values([ 'signature' =&gt; 0x04034b50, //  Local File Header ] + $fileInfo + ['filename' =&gt; $filename])); //       ,       Central Directory File Header $dictionary[$filename] = [ 'signature' =&gt; 0x02014b50, //  Central Directory File Header 'versionMadeBy' =&gt; 798, //  .    ,  -  . ] + $fileInfo + [ 'fileCommentLength' =&gt; 0, //    . No comments 'diskNumber' =&gt; 0, //     0,        'internalFileAttributes' =&gt; 0, //    'externalFileAttributes' =&gt; 2176057344, //    'localFileHeaderOffset' =&gt; $written, //      Local File Header 'filename' =&gt; $filename, //  . ]; //      $written += fwrite($handle, $LFH); //    $written += fwrite($handle, $content); } // ,     ,    . //          End of central directory record (EOCD) $EOCD = [ //  EOCD 'signature' =&gt; 0x06054b50, //  .    ,   0 'diskNumber' =&gt; 0, //      -  0 'startDiskNumber' =&gt; 0, //       . 'numberCentralDirectoryRecord' =&gt; $records = count($dictionary), //    .    ,     'totalCentralDirectoryRecord' =&gt; $records, //   Central Directory Record. //      ,      'sizeOfCentralDirectory' =&gt; 0, // ,    Central Directory Records 'centralDirectoryOffset' =&gt; $written, //     'commentLength' =&gt; 0 ]; //     !   foreach ($dictionary as $entryInfo) { $CDFH = pack('LSSSSSSLLLSSSSSLLa*', ...array_values($entryInfo)); $written += fwrite($handle, $CDFH); } // ,   .  ,    $EOCD['sizeOfCentralDirectory'] = $written - $EOCD['centralDirectoryOffset']; //     End of central directory record $EOCD = pack('LSSSSLLS', ...array_values($EOCD)); $written += fwrite($handle, $EOCD); //  . fclose($handle); echo '  : ' . $written . ' ' . PHP_EOL; echo '     `unzip -tq ' . $destination . '`' . PHP_EOL; echo PHP_EOL;</span></span></code> </pre> <br> 尝试运行此原始代码，输出将为您提供一个Lorem.zip文件，其中将包含1.txt和2.txt。 <br><br><h3> 怎么了 </h3><br> 当然，任何适当的人都会说用php编写存档器是徒劳的，特别是因为对于诸如zip这样的格式，有很多现成的实现可以满足每种口味和颜色。 并且在相同的php中有现成的库。 我也会说:) <br><br> 但是，为什么是整篇文章，为什么我花时间写这篇文章，而您却阅读呢？ <br> 然后，一切都不是那么简单，并且知道zip的工作原理，这为我们带来了更多的可能性。 <br><br> 首先，我希望至少能有所帮助，但对希望了解zip结构的人有所帮助。 <br> 其次，我们用自己的双手创建档案，我们可以控制并且最重要的是可以访问其内部数据。 <br><br> 我们可以预先计算“本地文件头”和“中央目录文件头”，然后按需即时生成包含任何内容和文件顺序的zip存档，只需替换这些数据即可。 除了I / O，没有任何开销。 <br><br> 或者，我们可以记录存档，例如将其上传到云中，该云支持分段下载，并且知道每个文件的偏移量，就可以获取任何存档文件，就像它根本不在存档中一样，只添加一个请求的标题。 然后所有这些都可以被代理... <br><br> 好吧，让我们不要超越自己。 如果您对此主题感兴趣，那么在以下文章中，我将尝试考虑这些机会并展示如何使用它们。 <br><br><hr><blockquote>  'diskNumber'=&gt; 0，//通常我到处都遇到0，尤其是我决定不去研究 </blockquote> 如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">berez所</a>建议，多卷归档中的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">卷</a>号。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471066/">https://habr.com/ru/post/zh-CN471066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471048/index.html">React + Mobx：有什么意义？</a></li>
<li><a href="../zh-CN471050/index.html">D语言发展基金融资：新平台和新赠款...</a></li>
<li><a href="../zh-CN471052/index.html">我可以晕吗？ 受到通用类型编程的打击</a></li>
<li><a href="../zh-CN471054/index.html">Longrid关于加密货币的量子威胁的现实主义和“ 2027年预言”问题</a></li>
<li><a href="../zh-CN471062/index.html">如何教爱丽丝管理您的智能家居。 Yandex报告</a></li>
<li><a href="../zh-CN471070/index.html">为移动开发人员选择哪种服务器语言...</a></li>
<li><a href="../zh-CN471072/index.html">电报中有多少克？</a></li>
<li><a href="../zh-CN471074/index.html">Synet-在CPU上启动预训练的神经网络的框架</a></li>
<li><a href="../zh-CN471076/index.html">矩阵如何创建防弹遗产</a></li>
<li><a href="../zh-CN471078/index.html">Chrome浏览器将完全阻止混合内容</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>