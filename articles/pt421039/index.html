<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüé§ üë©üèª‚Äç‚öñÔ∏è üíú Monitoramento de UPS da esta√ß√£o de trabalho Windows com ferramentas UPS de rede ‚¨úÔ∏è üõ†Ô∏è üåî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quando surge a tarefa de monitorar a energia ininterrupta nas esta√ß√µes de trabalho? Squeaked - substitu√≠do, o fim. Reparar um no-break √© uma tarefa in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoramento de UPS da esta√ß√£o de trabalho Windows com ferramentas UPS de rede</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421039/"> Quando surge a tarefa de monitorar a energia ininterrupta nas esta√ß√µes de trabalho?  Squeaked - substitu√≠do, o fim.  Reparar um no-break √© uma tarefa ingrata, trocar as baterias - nem todo mundo quer mexer (ou at√© mesmo um homem mau). <br><br>  Ent√£o pensei, especialmente depois de uma s√©rie de no-breaks com falha nos componentes eletr√¥nicos.  A situa√ß√£o foi agravada pelo software dos fabricantes.  Ele, por assim dizer, lixo.  E todo mundo tem APC, Ippon, Powercom, TrippLite.  Qual servidor e para esta√ß√µes de trabalho.  Tentando vers√µes pagas ap√≥s a experi√™ncia com as gratuitas - n√£o havia desejo.  E √© realmente divertido quando o no-break √© de diferentes fabricantes. <br><br>  Mas o monitoramento ainda √© necess√°rio.  As vantagens s√£o √≥bvias: 1) voc√™ pode trocar o UPS ANTES que ele emita um grito de despedida;  2) voc√™ pode ver imediatamente onde a bateria est√° descarregada e onde est√° a eletr√¥nica. <br>  O menos √© simples, como sempre: o custo de uma decis√£o, em dinheiro ou horas-homem. <br><br>  Vamos resolver esse problema. <br><a name="habracut"></a><br>  Se tivermos um zool√≥gico, a maneira mais adequada √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Network UPS Tools</a> . <br><br>  H√° pouca informa√ß√£o sobre o Windows e ainda n√£o h√° GUI.  Mas n√≥s vamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">resolver isso</a> . <br><br>  Para ser justo, deve-se notar que existe um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">projeto</a> semelhante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no Python</a> .  Mas, pessoalmente, acho completamente desnecess√°rio usar o Python (e solu√ß√µes t√©cnicas similares) onde voc√™ pode conviver com algumas linhas de script nativo. <br><br><div class="spoiler">  <b class="spoiler_title">Isen√ß√£o de responsabilidade</b> <div class="spoiler_text"><ul><li>  Esta n√£o √© uma "solu√ß√£o pronta". </li><li>  Esta n√£o √© uma frase, mas uma hist√≥ria. </li><li>  Sim, existem Zabbix, Cacti, etc, e essas s√£o solu√ß√µes pesadas para grandes empresas que exigem um servidor dedicado e, de qualquer forma, algum tipo de camada intermedi√°ria para suportar o protocolo UPS correspondente. </li><li>  Com todas as op√ß√µes acima, a solu√ß√£o √© bastante simples, f√°cil e custa 0 moeda. </li></ul><br></div></div><br>  Obviamente, para coletar informa√ß√µes, voc√™ precisa de um no-break com uma porta de informa√ß√µes.  Estou tendo problemas com a porta IPPON COM, tudo o resto funciona com um estrondo. <br><br>  Normalmente, para as esta√ß√µes de trabalho, o no-break √© conectado via USB e consideraremos esse caso.  Voc√™ precisa instalar o NUT em todas as esta√ß√µes de trabalho com o UPS. <br>  Poss√≠veis problemas com isso: <br><br><ul><li>  &gt; O driver <b>libusb</b> √© <b>melhor instalado separadamente</b> .  Os inclu√≠dos n√£o compreendem todos os no-breaks; </li><li>  Se o libusb oferecer o <b>nome padr√£o HID UPS Battery</b> , voc√™ precisar√° <b>alter√°-lo</b> - com um nome padr√£o, alguns sistemas, por algum motivo, n√£o v√™em o UPS; </li><li>  se o processo de instala√ß√£o exibir a mensagem " <b>Driver sem assinatura digital</b> ", <b>ser√° necess√°rio reinstal√°-lo manualmente</b> , caso contr√°rio, ele trava; </li><li>  se o libusb n√£o reconheceu o modelo do no-break, a primeira vez que o driver √© instalado INCORRETO!  Isso √© indicado pelo erro "upsmon ERROR ACCESS DENIED", ou o driver simplesmente trava.  Voc√™ precisa: parar o servi√ßo NUT, remover o driver libusb, aguardar at√© que o ‚Äúdispositivo de entrada USB‚Äù esteja instalado, selecionar manualmente o driver libusb novamente; </li><li>  Para o NUT, voc√™ <b>precisa de bibliotecas de terceiros</b> , que n√£o est√£o inclu√≠das no kit de instala√ß√£o.  A instala√ß√£o fala sobre isso, mas quem a l√™ :) Al√©m disso, muitas vezes os sistemas j√° possuem software com essas bibliotecas.  Definitivamente necess√°rio: libeay32.dll, ssleay32.dll, libgcc_s_dw2-1.dll (encontrado na pasta NUT-bin), libusb.dll (encontrado no kit de distribui√ß√£o do libusb), msvcr71.dll (inclu√≠do no Net Framework 1.1).  Todos esses arquivos devem estar na pasta Windows \ System32; </li><li>  √†s vezes voc√™ precisa especificar bus = "bus-0" para USB UPS no ups.conf; </li><li>  em m√°quinas r√°pidas e em algumas placas de rede, o servi√ßo NUT √© iniciado mais cedo que o driver e / ou a interface de rede.  Nesse caso, o tipo de inicializa√ß√£o "Inicializa√ß√£o (in√≠cio atrasado)" leva ao erro "upsc ERROR DATA STALE".  Solu√ß√£o: crie uma tarefa que verifique o processo upsd quando um evento com o c√≥digo 1 for exibido na fonte Network UPS Tools e reinicie o servi√ßo Network UPS Tools; fa√ßa o download do arquivo xml da tarefa; fa√ßa o download do script (ele deve estar na pasta NUT \ others). </li></ul><br>  Um script de exemplo para a instala√ß√£o semi-autom√°tica do NUT nos clientes: <br><br><pre><code class="hljs pgsql">N:\NUT-Installer<span class="hljs-number"><span class="hljs-number">-2.6</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">-6.</span></span>msi /qn <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\ssleay32.dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\libeay32.dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\libgcc_s_dw2<span class="hljs-number"><span class="hljs-number">-1.</span></span>dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\libusb.dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\etc\* "%programfiles%\NUT\etc" rem  IP-    NUT  <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IP=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip_address_string="IP Address" rem Uncomment the <span class="hljs-keyword"><span class="hljs-keyword">following</span></span> <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows <span class="hljs-number"><span class="hljs-number">7</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> removing "rem")! <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip_address_string="IPv4-" REM echo Network <span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span> Test <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /f "usebackq tokens=2 delims=:" %%f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (`ipconfig ^| findstr /c:%ip_address_string%`) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IP=%%f ECHO <span class="hljs-keyword"><span class="hljs-keyword">LISTEN</span></span> %IP% <span class="hljs-number"><span class="hljs-number">3493</span></span> &gt;&gt; "%programfiles%\NUT\etc\upsd.conf" rem   libusb  N:\libusb-win32-bin<span class="hljs-number"><span class="hljs-number">-1.2</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>\bin\inf-wizard.exe rem  ,     notepad "%programfiles%\NUT\etc\ups.conf" notepad "%programfiles%\NUT\etc\upsmon.conf" pause net use N: /<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> /Y</code> </pre> <br>  <b>Como entender por que o NUT n√£o funciona no Windows:</b> <br><br><ul><li>  verificamos se h√° nut.exe nos processos </li><li>  se houver, verifique upsd.exe e upsmon.exe </li><li>  se o upsd n√£o estiver em processo, v√° para nut \ sbin e corra com as m√£os: </li><li>  ‚ÄúO Upsd n√£o pode ser iniciado porque n√£o h√° dll‚Äù - verifique a dll no system32, reinicie apenas por precau√ß√£o; </li><li>  "Erro Upsd ao criar pipe nomeado" - o upsd j√° est√° em execu√ß√£o </li><li>  ele inicia e fecha imediatamente - verifique o endere√ßo IP no upsd.conf na se√ß√£o LISTEN, especialmente verdadeira se houver um DHCP na m√°quina; </li><li>  upsd iniciado, mas n√£o v√™ o no-break - instale ou reinstale o libusb, verifique o libusb.dll no system32, renomeie o dispositivo a partir da bateria HID UPS; </li><li>  se o upsd tiver iniciado, v√° para o bin e execute upsc our_ups @ localhost </li><li>  ‚ÄúO Upsc n√£o pode ser iniciado porque a DLL est√° ausente‚Äù - verificamos as bibliotecas; </li><li>  ‚ÄúUpsc failed connection unknown error‚Äù - verifique se o upsd e o upsmon est√£o em execu√ß√£o, verifique cuidadosamente a se√ß√£o MONITOR no upsmon.conf, verifique as bibliotecas da dll novamente; </li><li>  ‚ÄúDados de erro de Upsc obsoletos‚Äù - ou o no-break foi iniciado uma vez e n√£o funciona mais, reinstale o driver libusb e renomeie a bateria do no-break HID ou o servi√ßo NUT aumentou mais rapidamente do que a interface de rede ou o no-break USB era vis√≠vel; reinicie o servi√ßo; </li><li>  ‚ÄúErro Upsmon ACCESS DENIED‚Äù - reinstale o driver conforme descrito acima. </li></ul><br>  <b>Para o servidor de monitoramento, voc√™ precisa de:</b> <br><br><ul><li>  NUT no modo aut√¥nomo; </li><li>  qualquer servidor web com php e mysql.  Estou usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">servidor uniforme</a> </li><li>  Banco de dados MySQL e pasta www do reposit√≥rio e alguns scripts em lote a partir da√≠. </li></ul><br>  Colocamos o banco de dados SQL e www nos diret√≥rios correspondentes da web north.  Os scripts de batch_scripts s√£o copiados para a pasta de instala√ß√£o do NUT.  Iniciamos o servidor web, passamos para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">localhost / index_ups.php</a> .  Adicione qualquer UPS cliente no formato UPS_name @ host.  Execute o script get_ups_list_mysql.cmd.  N√≥s verificamos.  Aprecie. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7ca/2c0/c3c/7ca2c0c3c4d9aca4d199dbbd452f0341.png" width="400" alt="imagem"></a> <br><br>  O que podemos ver √∫til al√©m do estado atual?  Por exemplo: <br><br><ul><li>  se a tens√£o m√≠nima da bateria for pr√≥xima de 10, √© melhor substitu√≠-la com anteced√™ncia; </li><li>  em valores normais de tens√£o, uma falha no no-break provavelmente ser√° associada a uma falha nos componentes eletr√¥nicos (sua, K.O.); </li><li>  uma carga de mais de 70% √© indesej√°vel, 100 n√£o √© normal se n√£o estiver associado a um evento de autoteste; </li><li>  uma carga m√≠nima de bateria inferior a 30% indica mau funcionamento da bateria ou configura√ß√µes incorretas de desligamento autom√°tico quando descarregada no cliente. </li></ul><br>  Alguns pontos: <br><br><ul><li>  as colunas podem ser classificadas clicando no cabe√ßalho; </li><li>  os valores m√°ximo / m√≠nimo s√£o exibidos atrav√©s de uma barra para os valores atuais, cr√≠ticos s√£o marcados em vermelho; </li><li>  tenha cuidado com o bot√£o "autoteste". </li></ul><br>  Se algu√©m tiver problemas para instalar / executar o NUT no Windows - escreva, descobriremos isso juntos. <br><br>  Obrigado pela aten√ß√£o! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt421039/">https://habr.com/ru/post/pt421039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt421029/index.html">Como aumentar o rendimento das lojas e se livrar das filas</a></li>
<li><a href="../pt421031/index.html">Random.org - 20 Anos de Hist√≥ria</a></li>
<li><a href="../pt421033/index.html">Livro inteligente - para onde a evolu√ß√£o da impress√£o digital levar√°</a></li>
<li><a href="../pt421035/index.html">Novas estrelas 3D das redes sociais e por que elas podem ser perigosas para n√≥s</a></li>
<li><a href="../pt421037/index.html">Qual √© a ‚Äúinterface intuitiva‚Äù em chatbots, assistentes virtuais, avatares e rob√¥s sociais?</a></li>
<li><a href="../pt421041/index.html">KDD 2018, quinto dia de conclus√£o</a></li>
<li><a href="../pt421043/index.html">Mitap na grava√ß√£o de aplicativos em Lua usando o mecanismo Corona</a></li>
<li><a href="../pt421047/index.html">An√°logos na "Nomenclatura". Outra maneira de economizar sabiamente. Parte 1</a></li>
<li><a href="../pt421049/index.html">Projetando telas de aplicativos: do planejamento ao layout do projeto</a></li>
<li><a href="../pt421051/index.html">Como lancei meu primeiro projeto SaaS para contratar o dia todo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>