<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎞️ 🍹 🕍 Pengujian Python dengan pytest. Menggunakan pytest dengan alat lain, BAB 7 👸🏾 👩‍👩‍👦‍👦 🍁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kembali 


 Biasanya, pytest tidak digunakan secara independen, tetapi dalam lingkungan pengujian dengan alat lain. Bab ini membahas alat-alat lain ya...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengujian Python dengan pytest. Menggunakan pytest dengan alat lain, BAB 7</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448798/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kembali</a> </p><br><p>  <em>Biasanya, pytest tidak digunakan secara independen, tetapi dalam lingkungan pengujian dengan alat lain.</em>  <em>Bab ini membahas alat-alat lain yang sering digunakan bersama dengan pytest untuk pengujian yang efektif dan efisien.</em>  <em>Meskipun ini bukan daftar lengkap, alat-alat yang dibahas di sini akan memberi Anda gambaran tentang rasa kekuatan mencampur pytest dengan alat-alat lainnya.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Contoh-contoh dalam buku ini ditulis menggunakan Python 3.6 dan pytest 3.2.  pytest 3.2 mendukung Python 2.6, 2.7, dan Python 3.3+. </p><br><blockquote> Kode sumber untuk proyek Tugas, serta untuk semua tes yang ditunjukkan dalam buku ini, tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">tautan</a> di halaman web buku di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  Anda tidak perlu mengunduh kode sumber untuk memahami kode uji;  kode uji disajikan dalam bentuk yang mudah dalam contoh.  Tetapi untuk mengikuti tugas-tugas proyek, atau mengadaptasi contoh uji untuk menguji proyek Anda sendiri (tangan Anda tidak terikat!), Anda harus pergi ke halaman web buku dan mengunduh karya.  Di sana, di halaman web buku, ada tautan untuk pesan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest/errata">errata</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://forums.pragprog.com/forums/438">forum diskusi</a> . </blockquote><p>  Di bawah spoiler adalah daftar artikel dalam seri ini. </p><br><div class="spoiler">  <b class="spoiler_title">Daftar isi</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Pendahuluan</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 1: memulai dengan pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 2: Fungsi Tes Penulisan</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 3: Jadwal Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 4: Perlengkapan yang Terpasang</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 5: Plugin</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 6: Konfigurasi</strong></a> </li><li>  [ <strong>Bab 7: Menggunakan pytest dengan alat lain</strong> ] (Artikel ini) ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://habr.com/en/post/448798/</a> ) </li></ul></div></div><br><h2 id="pdb-debugging-test-failures">  pdb: Kegagalan Uji Debugging </h2><br><p> Modul <code>pdb</code> adalah debugger Python di perpustakaan standar.  Anda menggunakan <code>--pdb</code> sehingga pytest memulai sesi debug pada titik kegagalan.  Mari kita lihat <code>pdb</code> dalam aksi dalam konteks proyek Tugas. </p><br><p>  Dalam "Parameterisasi Fixture" pada halaman 64, kami meninggalkan proyek Tugas dengan beberapa kesalahan: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/c/tasks_proj $ pytest --tb=no -q .........................................FF.FFFF FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF.FFF........... 42 failed, 54 passed in 4.74 seconds</code> </pre> <br><p>  Sebelum kita melihat bagaimana <code>pdb</code> dapat membantu kita men-debug tes ini, mari kita lihat opsi pytest yang tersedia untuk mempercepat debugging kesalahan tes, yang pertama kali kita bahas di bagian "Menggunakan Pilihan" pada halaman 9: </p><br><ul><li>  <code>--tb=[auto/long/short/line/native/no]</code> : Mengontrol gaya jejak. </li><li>  <code>-v / --verbose</code> : Menampilkan semua nama uji yang lulus atau gagal. </li><li>  <code>-l / --showlocals</code> : Menampilkan variabel lokal di sebelah jejak stack. </li><li>  <code>-lf / --last-failed</code> : Menjalankan hanya tes yang gagal. </li><li>  <code>-x / --exitfirst</code> : Menghentikan sesi tes pada kegagalan pertama. </li><li>  <code>--pdb</code> : Memulai sesi debugging interaktif pada titik kegagalan. </li></ul><br><hr><br><p>  <em>Menginstal MongoDB</em> </p><br><hr><br><p>  Seperti disebutkan dalam Bab 3, "Perlengkapan Pytest," pada halaman 49, instalasi <code>MongoDB</code> dan <code>pymongo</code> diperlukan untuk menjalankan tes MongoDB. </p><br><p>  Saya menguji versi Server Komunitas yang ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.mongodb.com/download-center</a> .  instal pymongo dengan <code>pip</code> : <code>pip install pymongo</code> .  Namun, ini adalah contoh terakhir dalam buku yang menggunakan MongoDB.  Untuk mencoba debugger tanpa menggunakan MongoDB, Anda dapat menjalankan perintah pytest dari <code>code/ch2/</code> , karena direktori ini juga berisi beberapa tes gagal. </p><br><hr><br><p>  Kami hanya menjalankan tes dari <code>code/ch3/c</code> untuk memastikan beberapa dari mereka tidak berfungsi.  Kami tidak melihat traceback atau nama uji karena <code>--tb=no</code> menonaktifkan penelusuran dan kami tidak mengaktifkan <code>--verbose</code> .  Mari kita ulangi kesalahan (tidak lebih dari tiga) dengan teks terperinci: </p><br><pre> <code class="plaintext hljs">$ pytest --tb=no --verbose --lf --maxfail=3 ============================= test session starts ============================= collected 96 items / 52 deselected run-last-failure: rerun previous 44 failures tests/func/test_add.py::test_add_returns_valid_id[mongo] ERROR [ 2%] tests/func/test_add.py::test_added_task_has_id_set[mongo] ERROR [ 4%] tests/func/test_add.py::test_add_increases_count[mongo] ERROR [ 6%] =================== 52 deselected, 3 error in 0.72 seconds ====================</code> </pre> <br><p>  Sekarang kita tahu tes mana yang gagal.  Mari kita lihat salah satunya, menggunakan <code>-x</code> , menyalakan tracing, tidak menggunakan <code>--tb=no</code> , dan menampilkan variabel lokal dengan <code>-l</code> : </p><br><pre> <code class="plaintext hljs">$ pytest -v --lf -l -x ===================== test session starts ====================== run-last-failure: rerun last 42 failures collected 96 items tests/func/test_add.py::test_add_returns_valid_id[mongo] FAILED =========================== FAILURES =========================== _______________ test_add_returns_valid_id[mongo] _______________ tasks_db = None def test_add_returns_valid_id(tasks_db): """tasks.add(&lt;valid task&gt;) should return an integer.""" # GIVEN an initialized tasks db # WHEN a new task is added # THEN returned task_id is of type int new_task = Task('do something') task_id = tasks.add(new_task) &gt; assert isinstance(task_id, int) E AssertionError: assert False E + where False = isinstance(ObjectId('59783baf8204177f24cb1b68'), int) new_task = Task(summary='do something', owner=None, done=False, id=None) task_id = ObjectId('59783baf8204177f24cb1b68') tasks_db = None tests/func/test_add.py:16: AssertionError !!!!!!!!!!!! Interrupted: stopping after 1 failures !!!!!!!!!!!! ===================== 54 tests deselected ====================== =========== 1 failed, 54 deselected in 2.47 seconds ============</code> </pre><br><p>  Cukup sering ini cukup untuk memahami mengapa tes gagal.  Dalam kasus khusus ini, cukup jelas bahwa <code>task_id</code> bukan bilangan bulat - itu adalah instance dari ObjectId.  ObjectId adalah tipe yang digunakan oleh MongoDB untuk pengidentifikasi objek dalam database.  Niat saya dengan lapisan <code>tasksdb_pymongo.py</code> adalah untuk menyembunyikan detail tertentu dari implementasi MongoDB dari sisa sistem.  Jelas bahwa dalam hal ini tidak berhasil. </p><br><p>  Namun, kami ingin melihat cara menggunakan pdb dengan pytest, jadi mari kita bayangkan tidak jelas mengapa tes ini gagal.  Kita dapat membuat pytest memulai sesi debugging dan memulai kita tepat pada titik kegagalan menggunakan <code>--pdb</code> : </p><br><pre> <code class="plaintext hljs">$ pytest -v --lf -x --pdb ===================== test session starts ====================== run-last-failure: rerun last 42 failures collected 96 items tests/func/test_add.py::test_add_returns_valid_id[mongo] FAILED &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; traceback &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; tasks_db = None def test_add_returns_valid_id(tasks_db): """tasks.add(&lt;valid task&gt;) should return an integer.""" # GIVEN an initialized tasks db # WHEN a new task is added # THEN returned task_id is of type int new_task = Task('do something') task_id = tasks.add(new_task) &gt; assert isinstance(task_id, int) E AssertionError: assert False E + where False = isinstance(ObjectId('59783bf48204177f2a786893'), int) tests/func/test_add.py:16: AssertionError &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; entering PDB &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; /path/to/code/ch3/c/tasks_proj/tests/func/test_add.py(16) &gt; test_add_returns_valid_id() -&gt; assert isinstance(task_id, int) (Pdb)</code> </pre> <br><p>  Sekarang kita berada di prompt (Pdb), kita memiliki akses ke semua fitur debugging pdb interaktif.  Saat melihat crash, saya secara teratur menggunakan perintah ini: </p><br><ul><li>  <code>p/print expr</code> : Mencetak nilai exp. </li><li>  <code>pp expr</code> : Pretty mencetak nilai expr. </li><li>  <code>l/list</code> : Daftar titik kegagalan dan lima baris kode di atas dan di bawah. </li><li>  <code>l/list begin,end</code> : Menghitung angka garis tertentu. </li><li>  <code>a/args</code> : Mencetak argumen fungsi saat ini dengan nilainya. </li><li>  <code>u/up</code> : Memindahkan satu tingkat ke atas jalur tumpukan. </li><li>  <code>d/down</code> : Bergerak ke bawah satu tingkat dalam jejak tumpukan. </li><li>  <code>q/quit</code> : Mengakhiri sesi debugging. </li></ul><br><p>  Perintah navigasi lainnya, seperti langkah dan selanjutnya, tidak terlalu berguna, karena kita duduk tepat di pernyataan tegas.  Anda juga bisa cukup memasukkan nama variabel dan mendapatkan nilai. </p><br><p>  Anda dapat menggunakan <code>p/print expr</code> mirip dengan opsi <code>-l/--showlocals</code> untuk melihat nilai-nilai dalam suatu fungsi: </p><br><pre> <code class="plaintext hljs">(Pdb) p new_task Task(summary='do something', owner=None, done=False, id=None) (Pdb) p task_id ObjectId('59783bf48204177f2a786893') (Pdb)</code> </pre> <br><p>  Sekarang Anda dapat keluar dari debugger dan melanjutkan pengujian. </p><br><pre> <code class="plaintext hljs">(Pdb) q !!!!!!!!!!!! Interrupted: stopping after 1 failures !!!!!!!!!!!! ===================== 54 tests deselected ====================== ========== 1 failed, 54 deselected in 123.40 seconds ===========</code> </pre> <br><p>  Jika kami tidak menggunakan <code>-</code> , pytest akan membuka Pdb lagi di tes berikutnya.  Informasi lebih lanjut tentang penggunaan modul pdb tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi Python</a> . </p><br><h2 id="coveragepy-opredelenie-obema-testiruemogo-koda">  Coverage.py: Menentukan jumlah kode uji </h2><br><p>  Cakupan kode adalah indikator persentase kode yang diuji yang diuji oleh serangkaian tes.  Ketika Anda menjalankan tes untuk proyek Tugas, beberapa fungsi Tugas dieksekusi dengan setiap tes, tetapi tidak dengan semua. </p><br><p>  Alat cakupan kode sangat bagus untuk memberi tahu Anda bagian mana dari sistem yang sepenuhnya diabaikan oleh pengujian. </p><br><p>  <code>Coverage.py</code> adalah alat cakupan Python pilihan yang mengukur cakupan kode. </p><br><p>  Anda akan menggunakannya untuk memverifikasi kode proyek Tugas dengan pytest. </p><br><p>  Untuk menggunakan <code>coverage.py</code> Anda harus menginstalnya.  Tidak <code>pytest-cov</code> salahnya menginstal plugin bernama <code>pytest-cov</code> , yang memungkinkan Anda untuk memanggil <code>coverage.py</code> dari pytest dengan beberapa opsi pytest tambahan.  Karena <code>coverage</code> adalah salah satu dependensi <code>pytest-cov</code> , cukup instal <code>pytest-cov</code> dan itu akan mengambil <code>coverage.py</code> : </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov Collecting pytest-cov Using cached pytest_cov-2.5.1-py2.py3-none-any.whl Collecting coverage&gt;=3.7.1 (from pytest-cov) Using cached coverage-4.4.1-cp36-cp36m-macosx_10_10_x86 ... Installing collected packages: coverage, pytest-cov Successfully installed coverage-4.4.1 pytest-cov-2.5.1</code> </pre> <br><p>  Mari kita jalankan laporan cakupan untuk versi tugas kedua.  Jika Anda masih memiliki versi pertama proyek Tugas yang diinstal, hapus instalannya dan instal versi 2: </p><br><pre> <code class="plaintext hljs">$ pip uninstall tasks Uninstalling tasks-0.1.0: /path/to/venv/bin/tasks /path/to/venv/lib/python3.6/site-packages/tasks.egg-link Proceed (y/n)? y Successfully uninstalled tasks-0.1.0 $ cd /path/to/code/ch7/tasks_proj_v2 $ pip install -e . Obtaining file:///path/to/code/ch7/tasks_proj_v2 ... Installing collected packages: tasks Running setup.py develop for tasks Successfully installed tasks $ pip list ... tasks (0.1.1, /path/to/code/ch7/tasks_proj_v2/src) ...</code> </pre> <br><p>  Sekarang versi tugas berikutnya diinstal, Anda dapat menjalankan laporan cakupan dasar: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch7/tasks_proj_v2 $ pytest --cov=src ===================== test session starts ====================== plugins: mock-1.6.2, cov-2.5.1 collected 62 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py ......... tests/func/test_unique_id.py . tests/unit/test_cli.py ..... tests/unit/test_task.py .... ---------- coverage: platform darwin, python 3.6.2-final-0 ----------- Name Stmts Miss Cover -------------------------------------------------- src\tasks\__init__.py 2 0 100% src\tasks\api.py 79 22 72% src\tasks\cli.py 45 14 69% src\tasks\config.py 18 12 33% src\tasks\tasksdb_pymongo.py 74 74 0% src\tasks\tasksdb_tinydb.py 32 4 88% -------------------------------------------------- TOTAL 250 126 50% ================== 62 passed in 0.47 seconds ===================</code> </pre> <br><p>  Karena direktori saat ini adalah <code>tasks_proj_v2</code> , dan kode sumber yang diuji dalam src, menambahkan opsi <code>--cov=src</code> menghasilkan laporan cakupan untuk direktori itu saja. </p><br><p>  Seperti yang Anda lihat, beberapa file memiliki cakupan yang sangat rendah dan bahkan 0%.  Ini adalah pengingat yang berguna: <code>tasksdb_pymongo.py</code> 0% karena kami telah menonaktifkan pengujian untuk MongoDB dalam versi ini.  Beberapa dari mereka cukup rendah.  Proyek ini tentu harus memberikan tes untuk semua bidang ini sebelum siap untuk prime time. </p><br><p>  Saya percaya bahwa beberapa file memiliki persentase cakupan yang lebih tinggi: <code>api.py</code> dan <code>tasksdb_tinydb.py</code> .  Mari kita lihat <code>tasksdb_tinydb.py</code> dan lihat apa yang hilang.  Saya pikir cara terbaik untuk melakukan ini adalah dengan menggunakan laporan HTML. </p><br><p>  Jika Anda menjalankan <code>coverage.py</code> lagi dengan opsi <code>--cov-report=html</code> , <code>--cov-report=html</code> akan dihasilkan: </p><br><pre> <code class="plaintext hljs">$ pytest --cov=src --cov-report=html ===================== test session starts ====================== plugins: mock-1.6.2, cov-2.5.1 collected 62 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py ......... tests/func/test_unique_id.py . tests/unit/test_cli.py ..... tests/unit/test_task.py .... ---------- coverage: platform darwin, python 3.6.2-final-0 ----------- Coverage HTML written to dir htmlcov ================== 62 passed in 0.45 seconds ===================</code> </pre> <br><p>  Anda kemudian dapat membuka <code>htmlcov/index.html</code> di browser yang menampilkan output di layar berikut: </p><br><p><img src="https://habrastorage.org/webt/vs/sc/84/vssc84hovxefvf2g65740gu3ll0.png"></p><br><p>  Mengklik pada <code>tasksdb_tinydb.py</code> akan menampilkan laporan untuk satu file.  Persentase garis yang tercakup ditampilkan di bagian atas laporan, ditambah berapa banyak garis yang dicakup dan berapa banyak yang tidak, seperti yang ditunjukkan pada layar berikutnya: </p><br><p><img src="https://habrastorage.org/webt/os/pc/-o/ospc-o_yzzdfh1lzllw_1qtilrc.png"></p><br><p>  Menggulir ke bawah, Anda dapat melihat garis yang hilang, seperti yang ditunjukkan pada layar berikut: </p><br><p><img src="https://habrastorage.org/webt/85/rg/lt/85rgltocwrunycedzbeweix4zyc.png"></p><br><p>  Bahkan jika layar ini bukan halaman penuh untuk file ini, ini cukup untuk memberi tahu kami bahwa: </p><br><ol><li>  Kami tidak menguji <code>list_tasks()</code> dengan pemilik yang ditetapkan. </li><li>  Kami tidak menguji <code>update()</code> atau <code>delete()</code> . </li><li>  Mungkin kami tidak sepenuhnya menguji <code>unique_id()</code> . </li></ol><br><p>  Bagus  Kami dapat memasukkannya dalam daftar pengujian TO-DO bersama dengan pengujian sistem konfigurasi. </p><br><p>  Meskipun alat cakupan kode sangat berguna, memperjuangkan cakupan 100% bisa berbahaya.  Ketika Anda melihat kode yang tidak sedang diuji, itu mungkin berarti bahwa tes diperlukan.  Tetapi bisa juga berarti bahwa ada beberapa fungsi sistem yang tidak diperlukan dan dapat dihapus.  Seperti semua alat pengembangan perangkat lunak, analisis cakupan kode tidak menggantikan pemikiran. </p><br><p>  Lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code> coverage.py</code></a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>pytest-cov</code></a> detail lebih lanjut. </p><br><h2 id="mock-podmena-chastey-sistemy">  mock: Pergantian bagian-bagian sistem </h2><br><p>  Paket tiruan digunakan untuk mengganti bagian-bagian dari sistem untuk mengisolasi bagian-bagian dari kode uji dari sisa sistem.  Mock - objek kadang-kadang disebut test doubles, spies, fakes atau stub. </p><br><p>  Di antara perlengkapan monkeypatch pytest Anda sendiri (dijelaskan dalam Menggunakan monkeypatch pada halaman 85) dan tiruan, Anda harus memiliki semua fungsionalitas uji ganda yang diperlukan. </p><br><blockquote>  Perhatian!  Mock dan sangat aneh <br>  Jika ini adalah pertama kalinya Anda menemukan kembar uji seperti mengejek, bertopik, dan mata-mata, bersiap-siaplah!  Akan sangat aneh sangat cepat, lucu, meskipun sangat mengesankan. </blockquote><p>  Paket <code>mock</code> hadir dengan pustaka Python standar, seperti <code>unittest.mock</code> sejak Python 3.3.  Dalam versi sebelumnya, ini tersedia sebagai paket terpisah yang diinstal melalui PyPI.  Ini artinya Anda bisa menggunakan versi <code>mock</code> PyPI dari Python 2.6 ke versi Python terbaru dan mendapatkan fungsi yang sama dengan <code>mock</code> Python terbaru.  Namun, untuk digunakan dengan pytest, sebuah plugin bernama <code>pytest-mock</code> memiliki beberapa fitur yang menjadikannya antarmuka pilihan saya untuk sistem mock. </p><br><p>  Untuk proyek Tugas, kami akan menggunakan <code>mock</code> untuk membantu kami menguji antarmuka baris perintah.  Di Coverage.py: dengan menentukan berapa banyak kode yang diuji, pada halaman 129 Anda melihat bahwa file <code>cli.py</code> kami tidak diuji sama sekali.  Kami akan mulai memperbaikinya sekarang.  Tapi mari kita bicara tentang strategi dulu. </p><br><p>  Solusi pertama dalam proyek Tugas adalah melakukan sebagian besar pengujian fungsionalitas melalui <code>api.py</code>  Oleh karena itu, solusi yang masuk akal adalah pengujian baris perintah tidak harus pengujian fungsional penuh.  Kita dapat yakin bahwa sistem akan bekerja melalui CLI jika kita mendapatkan level API basah selama pengujian CLI.  Ini juga merupakan solusi mudah yang memungkinkan kita untuk melihat moki di bagian ini. </p><br><p>  Implementasi Tugas CLI menggunakan paket antarmuka baris perintah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Klik</a> pihak ketiga.  Ada banyak alternatif untuk mengimplementasikan antarmuka baris perintah, termasuk modul yang dibangun ke dalam Python <code>argparse</code> .  Salah satu alasan saya memilih Click adalah karena ia menyertakan mesin uji yang membantu kami menguji aplikasi Click.  Namun, kode di <code>cli.py</code> , meskipun kami berharap tipikal aplikasi Click, tidak jelas. </p><br><p>  Mari memperlambat dan menginstal Tugas ke-3 versi: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ $ pip install -e ch7/tasks_proj_v2 ... Successfully installed tasks</code> </pre> <br><p>  Di sisa bagian ini, Anda akan mengembangkan beberapa tes untuk menguji fungsionalitas "daftar". <br>  Mari kita lihat aksi untuk memahami apa yang akan kita periksa: </p><br><blockquote>  <strong><em>Catatan Penerjemah:</em></strong> Saat menggunakan platform Windows, saya menemui beberapa masalah saat menguji sesi di bawah ini. <br><ol><li>  Folder harus dibuat untuk basis data bernama <strong><code>tasks_db</code></strong> di folder pengguna Anda.  Sebagai contoh <code>c:\Users\User_1\tasks_db\</code> <br>  Kalau tidak, kita mendapatkan - &gt;&gt; FileNotFoundError: [Errno 2] Tidak ada file atau direktori seperti itu: 'c: \ Users \ User_1 // task_db // task_db.json' </li><li>  Gunakan tanda kutip ganda sebagai ganti tanda kutip.  Kalau tidak, dapatkan kesalahan <br>  'melakukan sesuatu yang hebat' <br>  Penggunaan: tugas menambahkan [OPSI] RINGKASAN <br>  Coba "tugas tambahkan -h" untuk bantuan. <br><br>  Kesalahan: Mendapat argumen tambahan yang tidak terduga (sesuatu yang hebat ') <br></li></ol><br></blockquote><br><pre> <code class="plaintext hljs">$ tasks list ID owner done summary -- ----- ---- ------- $ tasks add 'do something great' $ tasks add "repeat" -o Brian $ tasks add "again and again" --owner Okken $ tasks list ID owner done summary -- ----- ---- ------- 1 False do something great 2 Brian False repeat 3 Okken False again and again $ tasks list -o Brian ID owner done summary -- ----- ---- ------- 2 Brian False repeat $ tasks list --owner Brian ID owner done summary -- ----- ---- ------- 2 Brian False repeat</code> </pre> <br><p>  Ini terlihat sangat sederhana.  Perintah <code>tasks list</code> menampilkan daftar semua tugas di bawah judul. <br>  Judul dicetak meskipun daftar kosong.  Perintah hanya menampilkan data dari satu pemilik, jika <code>-o</code> atau <code>--owner</code> .  Dan bagaimana kita memeriksanya?  Ada banyak cara, tetapi kita akan menggunakan moki. </p><br><p>  Tes yang menggunakan MOK adalah <em>tes kotak putih</em> , dan kita perlu melihat kode untuk memutuskan apa dan di mana kita akan pergi.  Titik masuk utama ada di sini: </p><br><blockquote>  ch7 / task_proj_v2 / src / task / cli.py </blockquote><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: tasks_cli()</code> </pre> <br><p>  Ini hanya panggilan ke <code>tasks_cli()</code> : </p><br><blockquote>  ch7 / task_proj_v2 / src / task / cli.py </blockquote><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@click.group(context_settings={'help_option_names': ['-h', '--help']}) @click.version_option(version='0.1.1') def tasks_cli(): """Run the tasks application.""" pass</span></span></code> </pre> <br><p>  Jelas?  Tidak.  Tapi tunggu, itu menjadi baik (atau buruk, tergantung pada sudut pandang Anda).  Ini adalah salah satu dari <code>list</code> perintah: </p><br><blockquote>  ch7 / task_proj_v2 / src / task / cli.py </blockquote><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@tasks_cli.command(name="list", help="list tasks") @click.option('-o', '--owner', default=None, help='list tasks with this owner') def list_tasks(owner): """    .   ,      . """ formatstr = "{: &gt;4} {: &gt;10} {: &gt;5} {}" print(formatstr.format('ID', 'owner', 'done', 'summary')) print(formatstr.format('--', '-----', '----', '-------')) with _tasks_db(): for t in tasks.list_tasks(owner): done = 'True' if t.done else 'False' owner = '' if t.owner is None else t.owner print(formatstr.format( t.id, owner, done, t.summary))</span></span></code> </pre> <br><p>  Ketika Anda terbiasa menulis kode Klik, pastikan kode ini tidak terlalu buruk.  Saya tidak akan menjelaskan di sini apa dan bagaimana cara kerjanya dalam fungsi ini, karena pengembangan kode baris perintah bukanlah fokus buku;  Namun, meskipun saya hampir sepenuhnya yakin bahwa saya memiliki kode yang benar ini, bagaimanapun, selalu ada banyak ruang untuk kesalahan manusia.  Itu sebabnya serangkaian tes otomatis yang baik penting untuk memastikan bahwa fitur ini berfungsi dengan benar. <br>  <code>list_tasks(owner)</code> tergantung pada beberapa fungsi lain: <code>tasks_db()</code> , yang merupakan manajer konteks, dan <code>tasks.list_tasks(owner)</code> , yang merupakan fungsi API. </p><br><p>  Kita akan menggunakan <code>mock</code> untuk meletakkan fungsi palsu di tempat untuk <code>tasks_db()</code> dan <code>tasks.list_tasks()</code> .  Kemudian kita dapat memanggil metode <code>list_tasks</code> melalui antarmuka baris perintah dan memastikan bahwa ia memanggil fungsi <code>tasks.list_tasks()</code> , yang berfungsi dengan benar dan benar memproses nilai kembali. <br>  Untuk menghilangkan <code>tasks_db()</code> , mari kita lihat implementasi nyata: </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kembali</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id448798/">https://habr.com/ru/post/id448798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id448784/index.html">Fitur baru untuk penulis ekstensi di Visual Studio 2019 versi 16.1</a></li>
<li><a href="../id448786/index.html">Pengujian Python dengan pytest. BAB 3 Jadwal Terbaik</a></li>
<li><a href="../id448788/index.html">Pengujian Python dengan pytest. Bab 2, Fungsi Tes Penulisan</a></li>
<li><a href="../id448792/index.html">Pengujian Python dengan pytest. Perlengkapan Bawaan, Bab 4</a></li>
<li><a href="../id448796/index.html">Pengujian Python dengan pytest. Konfigurasi, BAB 6</a></li>
<li><a href="../id448800/index.html">Konfigurasikan Visual Studio di seluruh organisasi Anda dengan .vsconfig</a></li>
<li><a href="../id448802/index.html">Berpikir dengan Portal: membuat portal di Unreal Engine 4</a></li>
<li><a href="../id448804/index.html">Bersiap untuk Hunted Runtime dan Notaris</a></li>
<li><a href="../id448808/index.html">Soal hal-hal sederhana, rumit. "Baja tidur." Cara melumasi baut berkarat atau Tidak WD-40 dengan satu ...</a></li>
<li><a href="../id448810/index.html">Bagaimana saya menangkap seorang hacker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>