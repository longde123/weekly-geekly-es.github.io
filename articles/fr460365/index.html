<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíø ü§∞üèº ‚ö´Ô∏è Trace distribu√©e: nous avons tout mal fait ü§±üèΩ ü§û ‚è≤Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Remarque perev. : L'auteur de ce document est Cindy Sridharan, une ing√©nieure d'imgix impliqu√©e dans le d√©veloppement d'API et, en particulier, dans l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trace distribu√©e: nous avons tout mal fait</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/460365/">  <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: L'auteur de ce document est Cindy Sridharan, une ing√©nieure d'imgix impliqu√©e dans le d√©veloppement d'API et, en particulier, dans le test de microservices.</i>  <i>Dans cet article, elle partage sa vision d√©taill√©e des probl√®mes r√©els dans le domaine du tra√ßage distribu√©, o√π, √† son avis, il y a un manque d'outils vraiment efficaces pour r√©soudre les probl√®mes urgents.</i> <br><br><img src="https://habrastorage.org/webt/zu/va/og/zuvaogffo6d3gqi1mmzq5ts3zoc.png"><br>  <i>[L'illustration est emprunt√©e √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un autre document</a> sur le tra√ßage distribu√©.]</i> <br><br>  On pense que le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tra√ßage distribu√© est</a> difficile √† mettre en ≈ìuvre et son retour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">est au mieux douteux</a> .  Le ¬´probl√®me¬ª de la trace s'explique par de nombreuses raisons, faisant souvent r√©f√©rence √† la complexit√© de la configuration de chaque composant du syst√®me pour transmettre les en-t√™tes correspondants avec chaque requ√™te.  Bien que ce probl√®me se produise, il ne peut pas du tout √™tre qualifi√© d'insurmontable.  Soit dit en passant, cela n'explique pas pourquoi les d√©veloppeurs n'aiment pas vraiment le tra√ßage (m√™me d√©j√† fonctionnel). <a name="habracut"></a><br><br>  La principale difficult√© du suivi distribu√© n'est pas de collecter des donn√©es, de ne pas normaliser les formats de distribution et de pr√©sentation des r√©sultats, et de ne pas d√©terminer quand, o√π et comment √©chantillonner.  Je n'essaie pas du tout de pr√©senter ces ¬´probl√®mes de digestibilit√©¬ª comme <i>triviaux</i> - en fait, il y a des d√©fis techniques et politiques (si nous examinons vraiment les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">normes et protocoles</a> Open Source) politiques qui doivent √™tre surmont√©s pour que ces probl√®mes puissent √™tre consid√©r√©s r√©solus. <br><br>  Cependant, si vous imaginez que tous ces probl√®mes ont √©t√© r√©solus, il est probable que rien ne changera consid√©rablement en termes d' <i>exp√©rience de l'utilisateur final</i> .  Le suivi n'est peut-√™tre toujours pas pratique dans les sc√©narios de d√©bogage les plus courants, m√™me apr√®s son d√©ploiement. <br><br><h2>  Une telle trace diff√©rente </h2><br>  Le tra√ßage distribu√© comprend plusieurs composants disparates: <br><br><ul><li>  √©quiper les applications et les middlewares de commandes; </li><li>  Transmission de contexte distribu√© </li><li>  collecte de traces; </li><li>  stockage des traces; </li><li>  leur extraction et visualisation. </li></ul><br>  Beaucoup de discussions sur le tra√ßage distribu√© se r√©sument √† le consid√©rer comme une sorte d'op√©ration unaire, dont le seul but est d'aider au diagnostic complet du syst√®me.  Cela est largement d√ª √† la mani√®re dont le concept de tra√ßage distribu√© a √©t√© form√©.  Dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un blog</a> publi√© lors de l'ouverture des sources Zipkin, il a √©t√© mentionn√© <i>qu'il [Zipkin] rend Twitter plus rapide</i> .  Les premi√®res offres commerciales de tra√ßage ont √©galement √©t√© promues comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outils APM</a> . <br><br>  <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: Afin de mieux comprendre le texte, nous d√©finissons deux termes de base selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation du projet OpenTracing</a> :</i> <br><br><ul><li>  <i><b>Span</b> - l'√©l√©ment de base du tra√ßage distribu√©.</i>  <i>Il s'agit d'une description d'un certain flux de travail (par exemple, une requ√™te de base de donn√©es) avec un nom, des heures de d√©but et de fin, des balises, des journaux et un contexte.</i> </li><li>  <i>Les trav√©es contiennent g√©n√©ralement des liens vers d'autres trav√©es, ce qui vous permet de combiner plusieurs trav√©es dans <b>Trace</b> - une visualisation de la dur√©e de vie d'une demande lorsqu'elle se d√©place √† travers un syst√®me distribu√©.</i> </li></ul><br>  Trace'y contient des donn√©es incroyablement pr√©cieuses qui peuvent vous aider dans des t√¢ches telles que: tests en production, tests de reprise apr√®s sinistre, tests avec introduction d'erreurs, etc.  En fait, certaines entreprises utilisent d√©j√† le tra√ßage √† ces fins.  Pour commencer, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le transfert de contexte universel</a> a d'autres utilisations en plus du simple transfert de port√©es vers le syst√®me de stockage: <br><br><ul><li>  Par exemple, Uber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilise</a> les r√©sultats de la trace pour faire la distinction entre le trafic de test et le trafic de production. </li><li>  Facebook <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilise des</a> donn√©es de trace pour analyser le chemin critique et pour basculer le trafic lors des tests de reprise apr√®s sinistre r√©guliers. </li><li>  Le r√©seau social <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilise</a> √©galement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des</a> blocs-notes Jupyter, qui permettent aux d√©veloppeurs d'ex√©cuter des requ√™tes arbitraires sur les r√©sultats du tra√ßage. </li><li>  Les adh√©rents <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LDFI</a> (Lineage Driven Failure Injection <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">)</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilisent</a> des traces distribu√©es pour les tests d'erreur. </li></ul><br>  Aucune des options ci-dessus ne se rapporte enti√®rement au sc√©nario de <i>d√©bogage</i> , au cours duquel l'ing√©nieur essaie de r√©soudre le probl√®me en examinant la trace. <br><br>  En ce qui concerne le sc√©nario de d√©bogage, le diagramme <i>traceview</i> reste l'interface principale (bien que certains l'appellent √©galement le <i>"diagramme de Gantt"</i> ou le <i>"diagramme en cascade"</i> ).  Par <i>traceview,</i> je <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">veux dire</a> toutes les <i>√©tendues</i> et les m√©tadonn√©es associ√©es qui constituent ensemble la trace.  Chaque syst√®me de trace open source, ainsi que chaque solution de trace commerciale, offre une interface utilisateur bas√©e sur <i>traceview</i> pour visualiser, d√©tailler et filtrer les donn√©es de trace. <br><br>  Le probl√®me avec tous les syst√®mes de trace que je connais en ce moment est que la <i>visualisation</i> finale <i>(traceview)</i> refl√®te presque compl√®tement les caract√©ristiques du processus de g√©n√©ration de trace.  M√™me lorsque des visualisations alternatives sont propos√©es: cartes d'intensit√© (heatmap), topologies de service, histogrammes de latence - au final, elles se <i>r√©sument</i> toujours √† <i>traceview</i> . <br><br>  Dans le pass√©, je me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plaignais</a> que la plupart des ¬´innovations¬ª en mati√®re de tra√ßabilit√© en ce qui concerne l'interface utilisateur / l'exp√©rience utilisateur semblent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">se</a> limiter √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">inclure</a> des m√©tadonn√©es suppl√©mentaires dans la trace, √† incorporer des informations avec <i>une cardinalit√© √©lev√©e</i> , ou √† fournir la possibilit√© de parcourir des plages sp√©cifiques ou ex√©cuter des requ√™tes <i>inter- et intra-trace</i> .  Dans ce cas, <i>traceview</i> reste le principal moyen de visualisation.  Tant que cet √©tat de choses persiste, le tra√ßage distribu√© occupera (au mieux) la 4e place en tant qu'outil de d√©bogage, suivi des m√©triques, des journaux et des traces de pile, et au pire, cela se r√©v√©lera √™tre une perte d'argent et de temps. <br><br><h2>  Probl√®me avec traceview </h2><br>  Le but de <i>traceview</i> est de fournir une image compl√®te du mouvement d'une demande individuelle √† travers tous les composants d'un syst√®me distribu√© auquel elle se rapporte.  Certains syst√®mes de tra√ßage plus avanc√©s vous permettent d'explorer des plages individuelles et de visualiser la r√©partition du temps <i>au sein d'un</i> m√™me processus (lorsque les plages ont des limites fonctionnelles). <br><br>  Le principe de base de l'architecture de microservices est l'id√©e que la structure organisationnelle cro√Æt avec les besoins de l'entreprise.  Les partisans des microservices soutiennent que la distribution de diverses t√¢ches commerciales sur des services distincts permet √† de petites √©quipes de d√©veloppement autonomes de contr√¥ler l'ensemble du cycle de vie de ces services, leur permettant de cr√©er, tester et d√©ployer ces services de mani√®re ind√©pendante.  Cependant, l'inconv√©nient de cette distribution est la perte d'informations sur la fa√ßon dont chaque service interagit avec les autres.  Dans de telles circonstances, le tra√ßage distribu√© pr√©tend √™tre un outil indispensable pour <i>d√©boguer</i> les interactions complexes entre les services. <br><br>  Si vous avez un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syst√®me distribu√©</a> vraiment <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">incroyablement complexe</a> , alors personne ne peut garder √† l'esprit son image <i>compl√®te</i> .  En fait, d√©velopper un outil bas√© sur l'hypoth√®se qu'il est g√©n√©ralement possible est un peu un contre-mod√®le (approche inefficace et improductive).  Id√©alement, le d√©bogage n√©cessite un outil pour <i>affiner votre recherche</i> afin que les ing√©nieurs puissent se concentrer sur un sous-ensemble des dimensions (services / utilisateurs / h√¥tes, etc.) qui sont pertinentes pour le sc√©nario en question.  Pour d√©terminer la cause de la panne, les ing√©nieurs ne sont pas tenus de comprendre ce qui s'est pass√© dans <i>tous les services √† la fois</i> , car une telle exigence contredirait l'id√©e m√™me d'une architecture de microservice. <br><br>  Cependant, traceview n'est <i>que</i> cela.  Oui, certains syst√®mes de trace offrent des vues de trace compress√©es lorsque le nombre de plages de trace est si important qu'elles ne peuvent pas √™tre affich√©es dans une seule visualisation.  Cependant, en raison de la grande quantit√© d'informations contenues m√™me dans une visualisation aussi r√©duite, les ing√©nieurs sont toujours <i>oblig√©s de les</i> ¬´filtrer¬ª, en limitant manuellement la s√©lection √† un ensemble de sources de probl√®mes de service.  H√©las, dans ce domaine, les machines sont beaucoup plus rapides que les humains, moins sujettes aux erreurs et leurs r√©sultats sont plus reproductibles. <br><br>  Une autre raison pour laquelle je pense que la m√©thode traceview est erron√©e est qu'elle ne convient pas au d√©bogage hypoth√©tique.  √Ä la base, le d√©bogage est un processus <i>it√©ratif</i> commen√ßant par une hypoth√®se, suivi de la v√©rification de diverses observations et faits re√ßus du syst√®me √† l'aide de diff√©rents vecteurs, conclusions / g√©n√©ralisations et une √©valuation plus approfondie de la v√©rit√© de l'hypoth√®se. <br><br>  La capacit√© <i>de</i> tester des hypoth√®ses <i>rapidement et √† moindre co√ªt</i> et d'am√©liorer le mod√®le mental en cons√©quence est la <i>pierre angulaire du</i> d√©bogage.  Tout outil de d√©bogage doit √™tre <i>interactif</i> et restreindre l'espace de recherche ou, dans le cas d'une fausse trace, permettre √† l'utilisateur de revenir en arri√®re et de se concentrer sur une autre zone du syst√®me.  Un outil id√©al le fera de <i>mani√®re proactive</i> , attirant imm√©diatement l'attention de l'utilisateur sur les zones potentiellement probl√©matiques. <br><br>  H√©las, <i>traceview</i> ne peut pas √™tre appel√© un outil d'interface interactive.  Le mieux que vous puissiez esp√©rer en l'utilisant est de d√©tecter une certaine source de retards accrus et de visualiser toutes sortes de balises et de journaux qui lui sont associ√©s.  Cela n'aide pas l'ing√©nieur √† identifier les <i>mod√®les</i> de trafic, tels que les sp√©cificit√©s de la distribution des retards, ou √† d√©tecter les corr√©lations entre les diff√©rentes mesures.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'analyse g√©n√©rique des traces</a> peut contourner certains de ces probl√®mes.  En effet, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">il existe des exemples d'</a> analyse r√©ussie utilisant l'apprentissage automatique pour identifier des plages anormales et identifier un sous-ensemble de balises pouvant √™tre associ√©es √† un comportement anormal.  N√©anmoins, je n'ai pas encore rencontr√© de visualisations convaincantes de d√©couvertes faites √† l'aide de l'apprentissage automatique ou de l'analyse de donn√©es appliqu√©es √† des √©tendues qui seraient significativement diff√©rentes de traceview ou DAG (graphique directionnel acyclique). <br><br><h3>  Les port√©es sont trop faibles </h3><br>  Le probl√®me fondamental avec traceview est que les √©tendues sont des primitives de niveau trop bas pour l'analyse de latence et l'analyse des causes profondes.  C'est comme analyser des commandes de processeur individuelles dans le but d'√©liminer une exception, sachant qu'il existe des outils de niveau beaucoup plus √©lev√© comme backtrace, qui sont beaucoup plus pratiques √† utiliser. <br><br>  De plus, je me permettrai d'affirmer ce qui suit: id√©alement, nous n'avons pas besoin d'une <i>image compl√®te de</i> ce qui s'est pass√© pendant le cycle de vie de la demande, que repr√©sentent les outils modernes de tra√ßage.  Au lieu de cela, une forme d'abstraction de niveau sup√©rieur est requise, contenant des informations sur ce qui <i>n'a pas fonctionn√©</i> (similaire √† la trace), ainsi qu'un certain contexte.  Au lieu d'observer toute la trace, je pr√©f√®re en voir une <i>partie</i> o√π quelque chose d'int√©ressant ou d'inhabituel se produit.  Actuellement, la recherche est effectu√©e manuellement: l'ing√©nieur re√ßoit une trace et analyse ind√©pendamment les port√©es √† la recherche de quelque chose d'int√©ressant.  L'approche lorsque les gens regardent des trav√©es sur des traces distinctes dans l'espoir de d√©tecter une activit√© suspecte n'est pas du tout mise √† l'√©chelle (en particulier lorsqu'ils doivent comprendre toutes les m√©tadonn√©es encod√©es dans diff√©rentes trav√©es, telles que l'ID de port√©e, le nom de la m√©thode RPC, la dur√©e de la port√©e 'a, journaux, balises, etc.). <br><br><h2>  Alternatives √† Traceview </h2><br>  Les r√©sultats de tra√ßage sont plus utiles lorsqu'ils peuvent √™tre visualis√©s de mani√®re √† avoir une id√©e non triviale de ce qui se passe dans les parties interconnect√©es du syst√®me.  Jusqu'√† ce que ce soit le cas, le processus de d√©bogage reste largement <i>inerte</i> et d√©pend de la capacit√© de l'utilisateur √† remarquer les corr√©lations correctes, √† v√©rifier les bonnes parties du syst√®me ou √† assembler des morceaux de la mosa√Øque ensemble - contrairement √† l' <i>outil</i> qui aide l'utilisateur √† formuler ces hypoth√®ses. <br><br>  Je ne suis pas un concepteur visuel ou un sp√©cialiste UX, mais dans la section suivante, je veux partager quelques id√©es sur l'apparence de telles visualisations. <br><br><h3>  Focus sur des services sp√©cifiques </h3><br>  Dans un environnement o√π l'industrie se consolide autour des id√©es de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SLO (objectifs de niveau de service) et de SLI (indicateurs de niveau de service)</a> , il semble raisonnable que les √©quipes individuelles surveillent d'abord la pertinence de leurs services par rapport √† ces objectifs.  Il s'ensuit que <i>la</i> visualisation <i>orient√©e service</i> est la mieux adapt√©e √† de telles √©quipes. <br><br>  Les traces, en particulier sans √©chantillonnage, sont un r√©servoir d'informations sur chaque composant d'un syst√®me distribu√©.  Ces informations peuvent √™tre transmises √† un gestionnaire d√©licat qui fournira aux utilisateurs des d√©couvertes orient√©es <i>service</i> , qui peuvent √™tre d√©tect√©es √† l'avance - avant m√™me que l'utilisateur ne regarde les traces: <br><br><ol><li>  Diagrammes de distribution des retards uniquement pour les demandes fortement distingu√©es <i>(demandes aberrantes)</i> ; </li><li>  Diagrammes de distribution des retards pour les cas o√π les objectifs de service SLO ne sont pas atteints; </li><li>  Les balises les plus ¬´communes¬ª, ¬´int√©ressantes¬ª et ¬´√©tranges¬ª dans les requ√™tes, qui sont le plus souvent <i>r√©p√©t√©es</i> ; </li><li>  R√©partition des retards pour les cas o√π les <i>d√©pendances de</i> service n'atteignent pas les objectifs SLO d√©finis; </li><li>  R√©partition des retards pour divers services en aval. </li></ol><br>  Les m√©triques int√©gr√©es ne peuvent tout simplement pas r√©pondre √† certaines de ces questions, for√ßant les utilisateurs √† √©tudier attentivement les port√©es.  En cons√©quence, nous avons un m√©canisme extr√™mement hostile √† l'utilisateur. <br><br>  √Ä cet √©gard, la question se pose: qu'en est-il des interactions complexes entre les diff√©rents services contr√¥l√©s par diff√©rentes √©quipes?  <i>Traceview</i> n'est-il pas consid√©r√© comme l'outil le plus appropri√© pour couvrir une telle situation? <br><br>  Les d√©veloppeurs mobiles, les propri√©taires de services sans √©tat, les propri√©taires de services g√©r√©s avec √©tat (comme les bases de donn√©es) et les propri√©taires de plates-formes peuvent √™tre int√©ress√©s par une autre <i>vision d'un</i> syst√®me distribu√©;  <i>traceview</i> est une solution beaucoup trop universelle pour ces besoins fondamentalement diff√©rents.  M√™me dans une architecture de microservices tr√®s complexe, les propri√©taires de services n'ont pas besoin d'une connaissance approfondie de plus de deux ou trois services en amont et en aval.  En substance, dans la plupart des sc√©narios, les utilisateurs n'ont qu'√† r√©pondre √† des questions concernant un <i>ensemble limit√© de services</i> . <br><br>  C'est comme regarder un petit sous-ensemble de services √† travers une loupe pour une √©tude minutieuse.  Cela permettra √† l'utilisateur de poser des questions plus pressantes concernant l'interaction complexe entre ces services et leurs d√©pendances imm√©diates.  Ceci est similaire √† la trame dans le monde des services, o√π l'ing√©nieur sait <i>ce qui</i> ne va pas et a √©galement une id√©e de ce qui se passe dans les services environnants pour comprendre <i>pourquoi</i> . <br><br>  L'approche que je pr√©conise est l'exact oppos√© de l'approche descendante bas√©e sur traceview, lorsque l'analyse commence par la trace enti√®re, puis descend progressivement vers des trav√©es individuelles.  Au contraire, l'approche ascendante commence par l'analyse d'une petite zone proche de la cause potentielle de l'incident, puis l'espace de recherche est √©largi si n√©cessaire (avec la participation √©ventuelle d'autres √©quipes pour analyser une gamme plus large de services).  La seconde approche est mieux adapt√©e pour tester rapidement les hypoth√®ses initiales.  Apr√®s avoir obtenu des r√©sultats sp√©cifiques, il sera possible de passer √† une analyse plus cibl√©e et d√©taill√©e. <br><br><h3>  Construction de la topologie </h3><br>  Les vues associ√©es √† un service particulier peuvent √™tre incroyablement utiles si l'utilisateur sait <i>quel</i> service ou groupe de services est responsable de l'augmentation des retards ou est une source d'erreurs.  Cependant, dans un syst√®me complexe, l'identification d'un intrus peut ne pas √™tre une t√¢che triviale lors d'une panne, surtout si aucun message d'erreur n'a √©t√© re√ßu des services. <br><br>  La cr√©ation d'une topologie de service peut √™tre tr√®s utile pour d√©terminer quel service affiche une augmentation du taux d'erreur ou une augmentation de la latence, entra√Ænant une d√©t√©rioration notable des performances du service.  Parlant de la construction d'une topologie, je ne parle pas d' <i>une carte de service</i> qui affiche tous les services disponibles dans le syst√®me et connus pour leurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cartes d'architecture sous la forme d'une √©toile de la mort</a> .  Une telle repr√©sentation n'est pas meilleure qu'une trace vue bas√©e sur un graphe acyclique dirig√©.  Au lieu de cela, j'aimerais voir une <i>topologie de service g√©n√©r√©e dynamiquement</i> bas√©e sur certains attributs, tels que le taux d'erreur, le temps de r√©ponse ou tout param√®tre sp√©cifi√© par l'utilisateur qui aide √† clarifier la situation avec des services suspects sp√©cifiques. <br><br>  Regardons un exemple.  Imaginez un site de nouvelles hypoth√©tique.  Le service de <i>premi√®re page</i> communique avec Redis, avec un service de recommandation, avec un service de publicit√© et un service vid√©o.  Le service vid√©o prend des vid√©os de S3 et les m√©tadonn√©es de DynamoDB.  Le service de recommandation re√ßoit les m√©tadonn√©es de DynamoDB, t√©l√©charge les donn√©es de Redis et MySQL, √©crit des messages dans Kafka.  Le service de publicit√© re√ßoit des donn√©es de MySQL et √©crit des messages √† Kafka. <br><br>  Ce qui suit est une repr√©sentation sch√©matique de cette topologie (de nombreux programmes de routage commerciaux construisent la topologie).  Cela peut √™tre utile si vous avez besoin de comprendre les d√©pendances des services.  Cependant, lors du <i>d√©bogage</i> , lorsqu'un certain service (par exemple, un service vid√©o) affiche un temps de r√©ponse accru, une telle topologie n'est pas tr√®s utile. <br><br><img src="https://habrastorage.org/webt/qr/85/y9/qr85y98gth6ybvwt5yuditlnack.png"><br>  <i>Syst√®me de services de site de nouvelles hypoth√©tiques</i> <br><br>  Le diagramme ci-dessous serait mieux.  Un service probl√©matique <i>(vid√©o) y est</i> repr√©sent√© en plein centre.  L'utilisateur le remarque imm√©diatement.  De cette visualisation, il devient clair que le service vid√©o fonctionne anormalement en raison de l'augmentation du temps de r√©ponse de S3, ce qui affecte la vitesse de t√©l√©chargement d'une partie de la page principale. <br><br><img src="https://habrastorage.org/webt/v2/w5/za/v2w5zaf_s1_r8mzo0j6r2dopyyk.png"><br>  <i>Topologie dynamique qui affiche uniquement les services ¬´int√©ressants¬ª</i> <br><br>  Les sch√©mas topologiques g√©n√©r√©s dynamiquement peuvent √™tre plus efficaces que les cartes de service statiques, en particulier dans les infrastructures flexibles et √©volutives.  La possibilit√© de comparer et de contraster les topologies de services permet √† l'utilisateur de poser des questions plus pertinentes.  Des questions plus pr√©cises sur le syst√®me sont plus susceptibles de conduire √† une meilleure compr√©hension du fonctionnement du syst√®me. <br><br><h3>  Affichage comparatif </h3><br>  Une autre visualisation utile serait un affichage comparatif.  Les traces ne sont actuellement pas bien adapt√©es aux comparaisons c√¥te √† c√¥te, de sorte que les <i>plages</i> sont g√©n√©ralement compar√©es.  Et l'id√©e principale de cet article est pr√©cis√©ment que les intervalles sont trop bas pour extraire les informations les plus pr√©cieuses des r√©sultats de la trace. <br><br>  La comparaison de deux traces'ov ne n√©cessite pas de visualisations fondamentalement nouvelles.  En fait, quelque chose comme un histogramme repr√©sentant les m√™mes informations que traceview suffit.  √âtonnamment, m√™me cette m√©thode simple peut apporter beaucoup plus de fruits qu'une simple √©tude de deux traces s√©par√©ment.  Encore plus puissant serait la possibilit√© de <i>visualiser la</i> comparaison des traces <i>dans l'agr√©gat</i> .  Il serait extr√™mement utile de voir comment un changement de configuration de base de donn√©es r√©cemment d√©ploy√© avec l'inclusion de GC (garbage collection) affecte le temps de r√©ponse d'un service en aval en quelques heures.  Si ce que je d√©cris ici ressemble √† une analyse A / B de l'impact des changements d'infrastructure <i>dans une vari√©t√© de services en</i> utilisant des r√©sultats de trace, alors vous n'√™tes pas trop loin de la v√©rit√©. <br><br><h2>  Conclusion </h2><br>  Je ne remets pas en question l'utilit√© de la trace elle-m√™me.  Je crois sinc√®rement qu'il n'y a pas d'autre moyen de collecter des donn√©es aussi riches, informelles et contextuelles que celles contenues dans la trace.    ,          .   ,        traceview-,          ,     ,   trace'.  ,          ,         . <br><br>   ,     ,  .        , <b> </b>  ,        .  ,           production   ,   ,      ,       ,     . <br><br>    ,   ,     ,    , ,      .  ,         ,      ,     trace'  span'. <br><br>           (  UI). ,         ,        .        ,           .           .      . <br><br><h2>  PS du traducteur </h2><br>  Lisez aussi dans notre blog: <br><br><ul><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> kubectl-debug    pod' Kubernetes</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">:   ,     Kubernetes</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  Kubernetes (   )</a> ¬ª. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460365/">https://habr.com/ru/post/fr460365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460353/index.html">R√©seau de neurones dans le verre. Ne n√©cessite pas d'alimentation, reconna√Æt les chiffres</a></li>
<li><a href="../fr460355/index.html">Sauver la noyade est notre m√©tier: comment g√©rer la d√©motivation des √©quipes</a></li>
<li><a href="../fr460359/index.html">Cours Young Game Designer 2: √©quilibrer la progression et la dynamique sans math√©matiques</a></li>
<li><a href="../fr460361/index.html">Grande FAQ sur la cybers√©curit√© des syst√®mes d'information m√©dicale</a></li>
<li><a href="../fr460363/index.html">7 facteurs manquants dans l'approche 12 Factor App</a></li>
<li><a href="../fr460367/index.html">Chaos Engineering: l'art de la destruction intentionnelle. Partie 1</a></li>
<li><a href="../fr460373/index.html">Under the Hood Turbo Pages: Architecture de la technologie de t√©l√©chargement rapide des pages Web</a></li>
<li><a href="../fr460375/index.html">Livre "Machine Learning for Business and Marketing"</a></li>
<li><a href="../fr460377/index.html">Utilisation de Liquibase pour g√©rer la structure de la base de donn√©es dans une application Spring Boot. Partie 1</a></li>
<li><a href="../fr460381/index.html">Qu'est-ce que l'assertivit√© et pourquoi est-elle n√©cessaire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>