<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüé® üôÜüèΩ üíß Validation de rdesktop et xrdp √† l'aide de l'analyseur PVS-Studio üòí üßü üíÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il s'agit de la deuxi√®me revue d'une s√©rie d'articles sur la v√©rification des programmes open source pour travailler avec le protocole RDP. Dans ce do...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Validation de rdesktop et xrdp √† l'aide de l'analyseur PVS-Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/447880/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c3/022/209/0c302220992a72800d96b21b634c13f0.png" alt="Image3"></div><br>  Il s'agit de la deuxi√®me revue d'une s√©rie d'articles sur la v√©rification des programmes open source pour travailler avec le protocole RDP.  Dans ce document, nous consid√©rerons le client rdesktop et le serveur xrdp. <br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PVS-Studio a √©t√©</a> utilis√© comme un outil pour d√©tecter les erreurs.  Il s'agit d'un analyseur de code statique pour C, C ++, C # et Java, disponible sur Windows, Linux et macOS. <br><br>  L'article ne pr√©sente que les erreurs qui m'ont paru int√©ressantes.  Cependant, les projets sont petits, il y a donc eu peu d'erreurs :). <br><br>  <b>Remarque</b>  L'article pr√©c√©dent sur la v√©rification du projet FreeRDP peut √™tre trouv√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h2>  rdesktop </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rdesktop</a> est une impl√©mentation gratuite du client RDP pour les syst√®mes UNIX.  Il peut √©galement √™tre utilis√© sous Windows, si vous g√©n√©rez un projet sous Cygwin.  Sous licence GPLv3. <br><br>  Ce client est tr√®s populaire - il est utilis√© par d√©faut dans ReactOS, et vous pouvez √©galement y trouver des frontaux graphiques tiers.  N√©anmoins, il est assez vieux: la premi√®re sortie a eu lieu le 4 avril 2001 - au moment de la r√©daction, son √¢ge √©tait de 17 ans. <br><br>  Comme je l'ai not√© pr√©c√©demment, le projet est tr√®s petit.  Il contient environ 30 000 lignes de code, ce qui est un peu √©trange compte tenu de son √¢ge.  A titre de comparaison, FreeRDP contient 320 mille lignes.  Voici la sortie du programme Cloc: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4a0/8e4/19f/4a08e419fa943d0792b40ea970d7d800.png" alt="Image1"></p><br><h3>  Code inaccessible </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V779</a> Code inaccessible d√©tect√©.  Il est possible qu'une erreur soit pr√©sente.  rdesktop.c 1502 <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *argv[])</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handle_disconnect_reason(deactivated, ext_disc_reason); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (g_redirect_username) xfree(g_redirect_username); xfree(g_username); }</code> </pre> <br>  L'erreur nous rencontre imm√©diatement dans la fonction <i>principale</i> : nous voyons le code qui vient apr√®s l' <i>instruction de retour</i> - ce fragment nettoie la m√©moire.  N√©anmoins, l'erreur ne constitue pas une menace: toute la m√©moire allou√©e est nettoy√©e par le syst√®me d'exploitation apr√®s la fin du programme. <br><br><h3>  Manque de gestion des erreurs </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V557 Le</a> sous-ensemble de la baie est possible.  La valeur de l'indice 'n' pourrait atteindre -1.  rdesktop.c 1872 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">RD_BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subprocess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argv[], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">str_handle_lines_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> linehandler, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> output[<span class="hljs-number"><span class="hljs-number">256</span></span>]; .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (n &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { n = read(fd[<span class="hljs-number"><span class="hljs-number">0</span></span>], output, <span class="hljs-number"><span class="hljs-number">255</span></span>); output[n] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= str_handle_lines(output, &amp;rest, linehandler, data); } .... }</span></span></code> </pre> <br>  L'extrait de code dans ce cas lit le fichier dans le tampon jusqu'√† la fin du fichier.  Cependant, il n'y a pas de gestion d'erreur ici: si quelque chose se passe mal, alors <i>read</i> renverra -1, puis le tableau de sortie d√©passera les limites du tableau. <br><br><h3>  Utilisation d'EOF dans char </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V739</a> EOF ne doit pas √™tre compar√© √† une valeur de type 'char'.  Le '(c = fgetc (fp))' doit √™tre de type 'int'.  ctrl.c 500 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ctrl_send_command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cmd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> result[CTRL_RESULT_SIZE], c, *escaped; .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((c = fgetc(fp)) != EOF &amp;&amp; index &lt; CTRL_RESULT_SIZE &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) { result[index] = c; index++; } .... }</code> </pre> <br>  Nous voyons ici un traitement incorrect pour atteindre la fin du fichier: si <i>fgetc</i> renvoie un caract√®re dont le code est 0xFF, alors il sera interpr√©t√© comme la fin du fichier ( <i>EOF</i> ). <br><br>  <i>EOF</i> est une constante, g√©n√©ralement d√©finie comme -1.  Par exemple, dans le codage CP1251, la derni√®re lettre de l'alphabet russe a le code 0xFF, qui correspond au nombre -1, si nous parlons d'une variable de type <i>char</i> .  Il s'av√®re que le caract√®re 0xFF, comme <i>EOF</i> (-1), est per√ßu comme la fin du fichier.  Pour √©viter de telles erreurs, le r√©sultat de la fonction <i>fgetc</i> doit √™tre stock√© dans une variable <i>int</i> . <br><br><h3>  Typos </h3><br>  <b>Fragment 1</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V547 L'</a> expression 'write_time' est toujours fausse.  disk.c 805 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">RD_NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disk_set_information</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span> write_time, change_time, access_time, mod_time; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (write_time || change_time) mod_time = MIN(write_time, change_time); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> mod_time = write_time ? write_time : change_time; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  L'auteur de ce code est peut-√™tre confus <i>||</i>  et <i>&amp;&amp;</i> fournis.  Consid√©rez les options possibles pour <i>write_time</i> et <i>change_time</i> : <br><br><ul><li>  Les deux variables sont 0: dans ce cas, nous arrivons √† la branche <i>else</i> : la variable <i>mod_time sera</i> toujours 0 quelle que soit la condition suivante. </li><li>  L'une des variables est 0: <i>mod_time</i> sera 0 (√† condition que l'autre variable ait une valeur non n√©gative), car <i>MIN</i> choisira la plus petite des deux options. </li><li>  Les deux variables ne sont pas √©gales √† 0: nous s√©lectionnons la valeur minimale. </li></ul><br>  Lors du remplacement d'une condition par <i>write_time &amp;&amp; change_time, le</i> comportement sera correct: <ul><li>  Une ou les deux variables ne sont pas √©gales √† 0: s√©lectionnez une valeur diff√©rente de z√©ro. </li><li>  Les deux variables ne sont pas √©gales √† 0: nous s√©lectionnons la valeur minimale. </li></ul><br>  <b>Fragment 2</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V547 L'</a> expression est toujours vraie.  L'op√©rateur '&amp;&amp;' devrait probablement √™tre utilis√© ici.  disk.c 1419 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> RD_NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disk_device_control</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RD_NTHANDLE handle, uint32 request, STREAM in, STREAM out)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((request &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) != <span class="hljs-number"><span class="hljs-number">20</span></span>) || ((request &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) != <span class="hljs-number"><span class="hljs-number">9</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RD_STATUS_INVALID_PARAMETER; .... }</code> </pre> <br>  Apparemment, les op√©rateurs <i>||</i>  et <i>&amp;&amp;</i> , soit <i>==</i> et <i>! =</i> : la variable ne peut pas prendre les valeurs 20 et 9 en m√™me temps. <br><br><h3>  Copie de ligne illimit√©e </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V512</a> Un appel de la fonction 'sprintf' entra√Ænera un d√©bordement de la m√©moire tampon 'fullpath'.  disk.c 1257 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">RD_NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disk_query_directory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *dirname, fullpath[PATH_MAX]; .... <span class="hljs-comment"><span class="hljs-comment">/* Get information for directory entry */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(fullpath, <span class="hljs-string"><span class="hljs-string">"%s/%s"</span></span>, dirname, pdirent-&gt;d_name); .... }</code> </pre> <br>  En consid√©rant la fonction, il deviendra compl√®tement clair que ce code ne pose pas de probl√®me.  Cependant, ils peuvent survenir √† l'avenir: un changement imprudent et nous obtenons un d√©bordement de tampon - <i>sprintf</i> n'est limit√© par rien, donc lors de la concat√©nation de chemins, nous pouvons aller au-del√† des limites du tableau.  Il est recommand√© de noter cet appel sur <i>snprintf (fullpath, PATH_MAX, ....)</i> . <br><br><h3>  √âtat redondant </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V560</a> Une partie de l'expression conditionnelle est toujours vraie: ajoutez&gt; 0. scard.c 507 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inRepos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(STREAM in, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> read)</span></span></span><span class="hljs-function"> </span></span>{ SERVER_DWORD add = <span class="hljs-number"><span class="hljs-number">4</span></span> - read % <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (add &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; add &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } }</code> </pre> <br>  La v√©rification de l' <i>addition&gt; 0</i> est inutile: la variable sera toujours sup√©rieure √† z√©ro, car la <i>lecture% 4</i> renverra le reste de la division, et elle ne sera jamais 4. <br><br><h2>  xrdp </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xrdp</a> est une impl√©mentation de serveur RDP open source.  Le projet est divis√© en 2 parties: <br><br><ul><li>  xrdp - impl√©mentation du protocole.  Distribu√© sous la licence Apache 2.0. </li><li>  xorgxrdp - Un ensemble de pilotes Xorg √† utiliser avec xrdp.  Licence - X11 (comme MIT, mais interdit l'utilisation dans la publicit√©) </li></ul><br>  Le d√©veloppement du projet est bas√© sur les r√©sultats de rdesktop et FreeRDP.  Au d√©part, je devais utiliser un serveur VNC distinct pour travailler avec les graphiques, ou un serveur X11 sp√©cial avec prise en charge RDP - X11rdp, mais avec l'av√®nement de xorgxrdp, ils n'√©taient plus n√©cessaires. <br><br>  Dans cet article, nous ne parlerons pas de xorgxrdp. <br><br>  Le projet xrdp, comme le pr√©c√©dent, est tr√®s petit et contient environ 80 000 lignes. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/904/e44/6bd/904e446bdb2edc2f39c5db3c928a61ea.png" alt="Image2"></p><br><h3>  Plus de fautes de frappe </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V525</a> Le code contient la collection de blocs similaires.  V√©rifiez les √©l√©ments ¬´r¬ª, ¬´g¬ª, ¬´r¬ª dans les lignes 87, 88, 89. rfxencode_rgb_to_yuv.c 87 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rfx_encode_format_rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *rgb_data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> stride_bytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pixel_format, uint8 *r_buf, uint8 *g_buf, uint8 *b_buf)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (pixel_format) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RFX_FORMAT_BGRA: .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">64</span></span>) { *lr_buf++ = r; *lg_buf++ = g; *lb_buf++ = r; <span class="hljs-comment"><span class="hljs-comment">// &lt;= x++; } .... } .... }</span></span></code> </pre> <br>  Ce code a √©t√© extrait de la biblioth√®que librfxcodec qui impl√©mente le codec jpeg2000 pour que RemoteFX fonctionne.  Ici, apparemment, les canaux de donn√©es graphiques sont m√©lang√©s - au lieu de la couleur ¬´bleue¬ª, ¬´rouge¬ª est √©crit.  Une telle erreur est probablement apparue √† la suite d'un copier-coller. <br><br>  Le m√™me probl√®me est tomb√© dans une fonction similaire <i>rfx_encode_format_argb</i> , dont l'analyseur nous a √©galement parl√©: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V525</a> Le code contient la collection de blocs similaires.  V√©rifiez les √©l√©ments ¬´a¬ª, ¬´r¬ª, ¬´g¬ª, ¬´r¬ª dans les lignes 260, 261, 262, 263. rfxencode_rgb_to_yuv.c 260 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">64</span></span>) { *la_buf++ = a; *lr_buf++ = r; *lg_buf++ = g; *lb_buf++ = r; x++; }</code> </pre> <br><h3>  D√©claration de tableau </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V557 Le</a> d√©passement de matrice est possible.  La valeur de l'indice ¬´i - 8¬ª pourrait atteindre 129. genkeymap.c 142 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// evdev-map.c int xfree86_to_evdev[137-8+1] = { .... }; // genkeymap.c extern int xfree86_to_evdev[137-8]; int main(int argc, char **argv) { .... for (i = 8; i &lt;= 137; i++) /* Keycodes */ { if (is_evdev) e.keycode = xfree86_to_evdev[i-8]; .... } .... }</span></span></code> </pre> <br>  La d√©claration et la d√©finition du tableau dans ces deux fichiers sont incompatibles - la taille diff√®re de 1. Cependant, aucune erreur ne se produit - la taille correcte est sp√©cifi√©e dans le fichier evdev-map.c, il n'y a donc aucun moyen de sortir des limites.  Ce n'est donc qu'un d√©faut facile √† corriger. <br><br><h3>  Comparaison non valide </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V560</a> Une partie de l'expression conditionnelle est toujours fausse: (cap_len &lt;0).  xrdp_caps.c 616 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// common/parse.h #if defined(B_ENDIAN) || defined(NEED_ALIGN) #define in_uint16_le(s, v) do \ .... #else #define in_uint16_le(s, v) do \ { \ (v) = *((unsigned short*)((s)-&gt;p)); \ (s)-&gt;p += 2; \ } while (0) #endif int xrdp_caps_process_confirm_active(struct xrdp_rdp *self, struct stream *s) { int cap_len; .... in_uint16_le(s, cap_len); .... if ((cap_len &lt; 0) || (cap_len &gt; 1024 * 1024)) { .... } .... }</span></span></code> </pre> <br>  Dans une fonction, une variable de type <i>unsigned short</i> est lue dans une variable de type <i>int</i> .  La v√©rification n'est pas n√©cessaire ici, car nous lisons une variable d'un type non sign√© et affectons le r√©sultat √† une variable plus grande, de sorte que la variable ne peut pas prendre une valeur n√©gative. <br><br><h3>  Contr√¥les inutiles </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V560</a> Une partie de l'expression conditionnelle est toujours vraie: (bpp! = 16).  libxrdp.c 704 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> EXPORT_CC </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">libxrdp_send_pointer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct xrdp_session *session, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cache_idx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *mask, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bpp)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((bpp == <span class="hljs-number"><span class="hljs-number">15</span></span>) &amp;&amp; (bpp != <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp;&amp; (bpp != <span class="hljs-number"><span class="hljs-number">24</span></span>) &amp;&amp; (bpp != <span class="hljs-number"><span class="hljs-number">32</span></span>)) { g_writeln(<span class="hljs-string"><span class="hljs-string">"libxrdp_send_pointer: error"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } .... }</code> </pre> <br>  Les v√©rifications de l'in√©galit√© n'ont pas de sens ici, car nous avons d√©j√† une comparaison au d√©but.  Il s'agit probablement d'une faute de frappe et le d√©veloppeur a voulu utiliser le <i>||</i>  pour filtrer les arguments invalides. <br><br><h2>  Conclusion </h2><br>  Au cours de l'inspection, aucune erreur grave n'a √©t√© d√©tect√©e, mais de nombreuses lacunes ont √©t√© constat√©es.  Cependant, ces projets sont utilis√©s dans de nombreux syst√®mes, quoique de petite envergure.  Un petit projet ne doit pas avoir beaucoup d'erreurs, vous ne devez donc pas juger le travail de l'analyseur uniquement sur de petits projets.  Vous pouvez en savoir plus √† ce sujet dans l'article " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sensations confirm√©es par des chiffres</a> ". <br><br>  Vous pouvez t√©l√©charger une version d'essai de PVS-Studio sur notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site Web</a> . <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Sergey Larin.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V√©rification de rdesktop et xrdp avec PVS-Studio</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447880/">https://habr.com/ru/post/fr447880/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447870/index.html">Bases du moteur JavaScript: optimisation du prototype. Partie 1</a></li>
<li><a href="../fr447872/index.html">Alienware M15: ordinateur portable de jeu compact avec des options de mise √† niveau compl√®tes</a></li>
<li><a href="../fr447874/index.html">Entropie du Chaos</a></li>
<li><a href="../fr447876/index.html">Tout est tr√®s mauvais ou un nouveau type d'interception du trafic</a></li>
<li><a href="../fr447878/index.html">V√©rification de rdesktop et xrdp avec PVS-Studio</a></li>
<li><a href="../fr447882/index.html">Outils r√©seau, ou par o√π commencer le pentester?</a></li>
<li><a href="../fr447884/index.html">Nous d√©couvrons comment la 5G fonctionnera au millim√®tre pr√®s dans la rue et √† l'int√©rieur</a></li>
<li><a href="../fr447886/index.html">Analyse des journaux Nginx √† l'aide d'Amazon Athena et Cube.js</a></li>
<li><a href="../fr447890/index.html">Dieu merci, je ne suis pas manager</a></li>
<li><a href="../fr447892/index.html">Deux nouveaux concours PHDays: contournement IDS et piratage d'usine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>