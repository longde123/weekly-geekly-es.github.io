<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé£ üê≥ üîí Sch√§ferhund üßëüèæ‚Äçü§ù‚ÄçüßëüèΩ üßëüèø üñêüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sheepdog ist ein skalierbares System, das virtuelle Maschinen mit verteilten Blockger√§ten versorgt. Die Entwicklung begann 2009 mit Entwicklern des ja...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sch√§ferhund</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412739/"><p><img src="https://habrastorage.org/webt/ru/g3/9i/rug39i1kkn-c4ack--isbvvzjma.jpeg"></p><br><p> <strong>Sheepdog</strong> ist ein skalierbares System, das virtuelle Maschinen mit verteilten Blockger√§ten versorgt.  Die Entwicklung begann 2009 mit Entwicklern des japanischen Unternehmens <em>Nippon Telegraph and Telephone Corporation</em> .  <strong>Sheepdog</strong> ist eine Open Source-Anwendung unter der GPL2-Lizenz.  Die neueste Version 0.9.3, die im November 2015 ver√∂ffentlicht wurde, ist das Erbe der Version 1.0, die f√ºr den kommerziellen Gebrauch geeignet ist <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1</a></sup> <sup><a name="cite_ref-1"></a></sup>  .  <em>(ist schon geworden - ca. pro.)</em> </p><br><blockquote>  Aus Gr√ºnden des Interesses wurde die erste Version (0.1.0) im August 2010 von Entwicklern ver√∂ffentlicht - und gleichzeitig wurde die Unterst√ºtzung f√ºr Sch√§ferhunde sofort in den Hauptentwicklungszweig von QEMU aufgenommen. <a name="habracut"></a><br>  Die ersten Tests an einem Sch√§ferhund habe ich im November 2011 durchgef√ºhrt <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2</a></sup> <sup><a name="cite_ref-2"></a></sup>  und die Ergebnisse waren gut f√ºr E / A-Operationen.  Dann hatte das <strong>Sheepdog-</strong> System jedoch <strong>immer</strong> noch Probleme mit der Wiederherstellung des gefallenen Knotens.  Dieses Problem wurde wahrscheinlich bald behoben, da die Anwendungsentwicklung ziemlich lebhaft ist, aber zu dieser Zeit habe ich eine andere L√∂sung verwendet. </blockquote><br><h1 id="vozmozhnosti">  Die M√∂glichkeiten </h1><br><p>  Das Arbeitsprinzip von <strong>Sheepdog ist</strong> in der ver√∂ffentlichten Pr√§sentation sehr gut beschrieben, daher beschr√§nke ich mich auf einen kurzen √úberblick. </p><br><p>  <strong>Es ist skalierbar</strong> <br>  Das Clustervolumen kann sowohl auf Knotenebene willk√ºrlich erh√∂ht werden, wodurch die Kapazit√§t und der Speicherplatz f√ºr Daten w√§hrend des Betriebs erh√∂ht werden, als auch indem die Anzahl der Knoten erh√∂ht wird.  Je mehr Knoten vorhanden sind, desto h√∂her ist die Leistung von VDI I / O. </p><br><p>  <strong>Er ist einfach</strong> <br>  Im Gegensatz zu anderen Systemen wie CEPH arbeitet <strong>Sheepdog</strong> nicht direkt mit dem Dateisystem, sondern arbeitet mit Bl√∂cken fester Gr√∂√üe. Daher sind keine separaten D√§monen erforderlich, um Metadaten bereitzustellen.  Alle Kontrollen werden mit einem einzigen <strong>Hundewerkzeug durchgef√ºhrt</strong> , das direkt mit den <strong>Schafen</strong> kommuniziert <br>  <em>(Ceph verwendet auch Objekte - ca. pro.)</em> </p><br><p>  <strong>Berechnet einen gefallenen Knoten</strong> <br>  Jeder VDI besteht aus diesen Bl√∂cken (Objekten), die gleichzeitig auf mehrere Knoten repliziert werden. Wenn einer von ihnen f√§llt, bleiben die Daten verf√ºgbar, und Objekte von den gefallenen Knoten beginnen, sich auf den anderen Knoten zu replizieren. </p><br><p>  <strong>Unterst√ºtzt Blockger√§te-Snapshots</strong> <br>  Sheepdog- <strong>Schnappsch√ºsse</strong> funktionieren genauso wie Btrfs.  Die angeh√§ngten VDI-Bl√∂cke werden gespeichert und neue Daten werden in neue Bl√∂cke geschrieben. </p><br><p>  Die folgenden Funktionen k√∂nnen unter bestimmten Umst√§nden problematisch sein: </p><br><p>  <strong>Sheepdog unterst√ºtzt SPOF nicht</strong> <br>  Wenn VDI √ºber QEMU als Blockger√§t verwendet wird, kann ein Problem auftreten, wenn es an mehreren Stellen gleichzeitig angeschlossen wird.  SPOF <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3</a></sup> h√§tte dies verhindern k√∂nnen. <sup><a name="cite_ref-3"></a></sup>  Sch√§ferhund hat nicht.  In der neuen Version von Sheepdog kann VDI jedoch blockiert werden, um mehr als eine Verbindung zu verhindern. </p><br><p>  <strong>Der Lebenszyklus von Datenobjekten</strong> <br>  VDI-Objekte k√∂nnen nur gel√∂scht werden, wenn alle ihnen zugeordneten Klone und Snapshots gel√∂scht wurden.  Dies ist genau das gleiche wie f√ºr Btrfs.  Daher reicht das Entfernen nicht verwendeter Schnappsch√ºsse m√∂glicherweise nicht aus, um Platz f√ºr die Speicherung zu schaffen. </p><br><h1 id="demon-kommunikacii">  Kommunikationsd√§mon </h1><br><p>  Sheepdog ist im Vergleich zu Ceph oder GlusterFS l√§cherlich klein.  Dies liegt daran, dass er nicht versucht, alle Probleme selbst zu l√∂sen, sondern das, was bereits funktioniert, maximal nutzt. </p><br><p>  Im Gegenzug bietet es ein Blockger√§t, das als physische Festplatte verwendet werden kann, sowie einen Software-Raid usw. </p><br><p>  Es k√ºmmert sich nur um die Verteilung von Datenobjekten zwischen den Knoten, auf denen es ausgef√ºhrt wird. </p><br><p>  Er ben√∂tigt jedoch die Informationen, die der <strong>Kommunikationsd√§mon</strong> bereitstellt - eine Schl√ºsselkomponente, ohne die <strong>Sheepdog</strong> nicht funktioniert. </p><br><p>  <strong>Kommunikationsd√§mon</strong> - bietet keine M√∂glichkeit zum Datenaustausch zwischen Knoten.  Dies ist, was Schafsd√§monen tun.  Dadurch erfahren <strong>Schafe</strong> nur, welche Knoten derzeit leben. </p><br><h2 id="corosync">  corosync </h2><br><p>  Zun√§chst geht <strong>Sheepdog</strong> davon aus, dass die Knoten √ºber <strong>Corosync</strong> miteinander <strong>kommunizieren</strong> .  Es unterst√ºtzt bis zu 64 Knoten, obwohl es theoretisch in der Lage sein sollte, mehr zu bedienen, ist seine Verwendung f√ºr kleine Cluster mit bis zu 16 Knoten optimal. </p><br><p>  In der <strong>Regel</strong> verwendet <strong>corosync</strong> auch Pacemaker, sodass keine weiteren Installationen erforderlich sind. </p><br><h3 id="ustanovka-corosync-na-debian">  Installieren Sie corosync unter Debian </h3><br><p>  Corosync befindet sich in den Distributionsrepositorys und ist einfach zu installieren: </p><br><pre><code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> install corosync libcoro<span class="hljs-built_in"><span class="hljs-built_in">sync-common4</span></span></code> </pre> <br><h3 id="nastroyka-corosync">  Corosync-Setup </h3><br><h2 id="zookeeper">  Tierpfleger </h2><br><p>  <strong>Sheepdog-</strong> Entwickler empfehlen die Verwendung von <strong>zookeeper</strong> f√ºr gr√∂√üere Cluster.  Laut den Entwicklern wurde ein <strong>Sheepdog</strong> -Testspeicher mit 1000 Knoten erstellt und getestet <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4</a></sup> <sup><a name="cite_ref-4"></a></sup>  . </p><br><h3 id="ustanovka-zookeeper-na-debian">  Installieren Sie zookeeper auf Debian </h3><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> install zookeeper zookeeperd</code> </pre> <br><p>  Starten des Daemons .. </p><br><pre> <code class="hljs pgsql">$ /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/zookeeper/bin/zkServer.sh <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre> <br><p>  Der Standardport, auf dem zookeeper ausgef√ºhrt wird, ist 2181 </p><br><p>  Laufender Sch√§ferhund mit Tierpflegerunterst√ºtzung: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> sheep <span class="hljs-literal"><span class="hljs-literal">-c</span></span> zookeeper:IP1:PORT1,IP2:PORT2,IP3:PORT3 ...other...option...</code> </pre> <br><p>  Der <strong>Vorteil</strong> von <strong>zookeeper</strong> ist, dass <strong>Sheepdog</strong> in diesem Fall eine klarere und leichtere Konfiguration von Knoten hat, aber es gibt ein Problem, dass das Debian-Installationspaket seine Unterst√ºtzung nicht enth√§lt. </p><br><p>  Um einen Sch√§ferhund mit Zookeeper-Unterst√ºtzung zu erhalten, m√ºssen Sie ihn daher aus dem Quellcode kompilieren.  Obwohl ich nicht ausschlie√üen kann, dass die Situation derzeit anders sein kann. <br>  <em>(Die Unterst√ºtzung von Tierpflegern erfordert weiterhin eine Kompilierung aus dem Quellcode - ca. per.)</em> </p><br><h1 id="nastroyka-demona-sheep">  Einrichten des Schafd√§mons </h1><br><p>  Der Knoten wird Teil des Sch√§ferhundes, wenn der Objektmanager, der Schafd√§mon, gestartet wird.  Es funktioniert immer in zwei Kopien: </p><br><ol><li><p>  Die erste Instanz des Prozesses startet als Gateway, das E / A-Anforderungen von Clients (z. B. von den Treibern von QEMU-Blockger√§ten) empf√§ngt, die Zielknoten berechnet und Anforderungen zur weiteren Verarbeitung zwischen ihnen sendet.  Das hei√üt, es werden viele Netzwerkverbindungen hergestellt. </p><br></li><li>  Ein anderer arbeitet als lokaler Objektmanager ( <strong>Objektmanager</strong> ) </li></ol><br><p>  Die Konfigurationsparameter des Schafd√§mons k√∂nnen zur Laufzeit als Befehlszeilenargumente √ºbergeben werden.  Wenn keine vorhanden sind, werden die Standardwerte verwendet, mit denen Sie vorsichtig sein sollten: </p><br><p>  <strong>Portnummer</strong> <br>  Sofern nicht anders angegeben, wird der Schafd√§mon auf Port 7000 ausgef√ºhrt </p><br><p>  <strong>Tresorpfad</strong> <br>  Sofern nicht anders angegeben, verwendet das Verzeichnis shep das Verzeichnis / var / lib / libdog, und die VDI-Objekte werden in seinem Unterverzeichnis <code>obj</code> gespeichert. </p><br><blockquote>  Theoretisch hindert nichts mehrere Instanzen von <strong>Schafen</strong> daran, an einem Knoten zu arbeiten - die Hauptbedingung ist, dass jeder seine Portnummer und seinen eigenen Speicher verwendet.  Das Problem mit der IP-Adresse des Knotens ist fast behoben.  Jede laufende Instanz des Schafd√§mons, die auf einem anderen Port ausgef√ºhrt wird, stellt automatisch eine Verbindung zu einem vorhandenen Cluster her! <br><br>  Wichtige Information ist, dass die Portnummer Teil der Konfiguration des VDI-Containers ist.  Sie m√ºssen wissen, ob Sie den Schafd√§mon so konfigurieren m√∂chten, dass er auf dem anderen Port des vorhandenen Clusters ausgef√ºhrt wird. <br><br>  Wenn Sie daher eine Instanz des Schafd√§mons mit einer anderen Portnummer, jedoch mit demselben Pfad zum Objektspeicher ausf√ºhren, k√∂nnen Informationen in vorhandenen VDI-Containern verloren gehen. </blockquote><br><h1 id="demon-sheep-kak-shlyuz">  Das D√§monenschaf als Tor </h1><br><p>  Auf Computern ohne Speicherplatz f√ºr VDI-Objekte kann der Schafd√§mon ausschlie√ülich im Gateway-Modus mit dem Flag <code>-G</code> . </p><br><p>  In diesem Fall wird beim Verteilen von VDI-Objekten √ºberhaupt kein lokaler Speicher verwendet, und die Daten werden direkt an andere Knoten verteilt. </p><br><h1 id="demon-sheep-kak-menedzher-obektov">  Schafsd√§mon als Objektmanager </h1><br><p>  Die zweite ausgef√ºhrte Instanz fungiert als lokaler Objektmanager, empf√§ngt E / A-Anforderungen von einer Instanz, die als Gateway startet, und f√ºhrt R / W-Vorg√§nge im lokalen Objektspeicher ( <strong>Objektspeicher</strong> ) aus. </p><br><h2 id="hranilische-obektov">  Objektspeicherung </h2><br><p>  Standardm√§√üig ist der Speicher f√ºr VDI-Objekte in <strong>Sheepdog</strong> das Verzeichnis <code>/var/lib/sheepdog/obj</code> , das auch vom <code>/var/lib/sheepdog/obj</code> als Teil seiner internen Verzeichnisstruktur verwendet wird. Dies ist der Standardspeicherpfad. </p><br><p>  Wenn Sie m√∂chten, dass VDI-Objekte an anderer Stelle gespeichert werden, k√∂nnen Sie den Pfad √ºbergeben, in dem ein anderes Blockger√§t beim Start als Parameter bereitgestellt wird. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sheep</span></span> ... /cesta_do_p≈ô√≠pojn√©ho_bodu</code> </pre> <br><p>  Es gibt noch mehr M√∂glichkeiten zu vermitteln.  Die neue Version von <strong>Sheepdog</strong> unterst√ºtzt die sogenannte Multi-Device-Technologie, mit der Sie die Speicherkapazit√§t bei Bedarf dynamisch erh√∂hen k√∂nnen, ohne den <strong>Sheepdog</strong> neu starten zu m√ºssen.  Das Erh√∂hen der Speicherkapazit√§t funktioniert √§hnlich wie bei Btrfs. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sheep</span></span> ... /cesta_do_A,/cesta_do_B,/cesta_do_C</code> </pre> <br><p>  <em>(Das erste angegebene Verzeichnis wird nur f√ºr Metadaten verwendet - ca. pro)</em> </p><br><p>  Zus√§tzlicher Speicher kann auch √ºber den <strong>Hundeknoten md</strong> hinzugef√ºgt (oder entfernt) <strong>werden</strong> </p><br><p>  ... </p><br><p>  Die vom Multi-Ger√§t angebotene Funktionalit√§t ist besonders n√ºtzlich, wenn das Speicherdateisystem dies nicht "von Natur aus" unterst√ºtzt (im Gegensatz zu Btrfs oder ZFS).  Im Allgemeinen kann die Auswahl eines Dateisystems zum Speichern von Objekten, deren Eigenschaften, Parametern und Einstellungen die Leistung des E / A-Dateisystems einer virtuellen Maschine erheblich beeinflussen. </p><br><blockquote>  Die Multi-Device-Technologie erfordert erweiterte Attribute auf der Dateiseite, was f√ºr moderne Dateisysteme wie btrfs <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5</a></sup> kein Problem darstellt <sup><a name="cite_ref-5"></a></sup>  oder ext4.  Einige √§ltere Dateisysteme wie reiserfs oder ext2 <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">6</a></sup> <sup><a name="cite_ref-6"></a></sup>  Unterst√ºtze sie nicht. <br><br>  Wenn Sie ein Dateisystem verwenden m√∂chten, das keine erweiterten Attribute zum Speichern von Objekten unterst√ºtzt, m√ºssen Sie <strong>Sheepdog</strong> ohne Unterst√ºtzung f√ºr mehrere Ger√§te kompilieren. </blockquote><br><h2 id="tip-hranilischa---plain-versus-tree">  Lagertyp - einfach gegen Baum </h2><br><p>  Bei der Formatierung eines Clusters k√∂nnen Sie unter anderem den Speichertyp (Backend-Speicher) angeben.  Sie k√∂nnen den Typ auf <strong>Ebene</strong> oder <strong>Baum setzen</strong> .  Bei einem <strong>einfachen</strong> Typ sieht die Verzeichnisstruktur folgenderma√üen aus: </p><br><pre> <code class="hljs ruby"><span class="hljs-params"><span class="hljs-params">| |</span></span>- obj <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt;id &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|-&lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>-&lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|-&lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>- ... <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt;id  &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> ... <span class="hljs-params"><span class="hljs-params">|- config [] |</span></span>- epoch <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span>- ... <span class="hljs-params"><span class="hljs-params">|- journal \- sheep.log []</span></span></code> </pre> <br><p>  Alle VDI-Objekte im <code>obj</code> Verzeichnis werden an ein Unterverzeichnis gesendet, dessen Name auf der aktuellen √Ñra- <code>obj</code> basiert.  Das hei√üt, f√ºr jede Epoche werden die entsprechenden VDI-Objekte separat gespeichert.  W√§hrend einer √Ñra kann jedoch eine gro√üe Anzahl von VDI-Objekten im Verzeichnis erscheinen, was anschlie√üend den Zugriff auf Dateien verlangsamt.  Daher k√∂nnen Sie die zweite Option ausw√§hlen, n√§mlich den <strong>Baum</strong> : </p><br><pre> <code class="hljs ruby"><span class="hljs-params"><span class="hljs-params">|- obj |</span></span> <span class="hljs-params"><span class="hljs-params">|- aa |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>-&lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|-&lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>-&lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|- ... |</span></span> <span class="hljs-params"><span class="hljs-params">|- ab |</span></span> <span class="hljs-params"><span class="hljs-params">| ... |</span></span> <span class="hljs-params"><span class="hljs-params">|- meta |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|- ... |</span></span> <span class="hljs-params"><span class="hljs-params">|- 0a |</span></span> <span class="hljs-params"><span class="hljs-params">| ... |</span></span>- config [] <span class="hljs-params"><span class="hljs-params">|- epoch |</span></span> <span class="hljs-params"><span class="hljs-params">|- &lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">|- &lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">|- ... \- sheep.log []</span></span></code> </pre> <br><p>  Bei dieser Art der Speicherung erstellt der <code>obj</code> eine Reihe von 256 Unterverzeichnissen mit den Namen <code>0a, ..., 99</code> im Verzeichnis <code>obj</code> und streut dann Objekte basierend auf den letzten beiden Zeichen der <strong>VDI-ID</strong> , die nicht nur f√ºr jeden VDI-Container, sondern auch f√ºr seine Snapshots oder eindeutig ist Klone. </p><br><h2 id="imena-vdi-obektov">  VDI-Objektnamen </h2><br><p>  Wenn <strong>Sheepdog</strong> die Daten im VDI-Container speichert, werden Dateien im <code>obj</code> Datenspeicher <code>obj</code> , wobei jeder seinen eigenen Namen hat, der aus mehreren Elementen besteht: </p><br><pre> <code class="hljs go">../obj/<span class="hljs-number"><span class="hljs-number">8f</span></span>/<span class="hljs-number"><span class="hljs-number">00e8</span></span>b18f00000005 ^^</code> </pre> <br><p>  Die ersten beiden Zeichen geben den Objekttyp an.  Datenobjekte beginnen mit <code>00...</code> und Metadaten (die in einem anderen Verzeichnis gespeichert werden k√∂nnen) <code>80...</code> </p><br><pre> <code class="hljs go">../obj/<span class="hljs-number"><span class="hljs-number">8f</span></span>/<span class="hljs-number"><span class="hljs-number">00e8</span></span>b18f00000005 ^^^^^^</code> </pre> <br><p>  Dann kommt der VDI.  Es ist nicht nur f√ºr jeden Container einzigartig, sondern auch f√ºr seinen Snapshot oder Klon. </p><br><pre> <code class="hljs go">../obj/<span class="hljs-number"><span class="hljs-number">8f</span></span>/<span class="hljs-number"><span class="hljs-number">00e8</span></span>b18f00000005 ^^ ^^</code> </pre> <br><p>  Die letzten beiden Ziffern der VDI-Kennung geben - im Fall des Baumspeichertyps - an, in welchem ‚Äã‚ÄãVerzeichnis sich das Unterverzeichnis befindet, zu dem das Objekt geh√∂rt. </p><br><pre> <code class="hljs go">../obj/<span class="hljs-number"><span class="hljs-number">8f</span></span>/<span class="hljs-number"><span class="hljs-number">00e8</span></span>b18f00000005 ^^^^^^^^</code> </pre> <br><p>  Auf die Kennung des VDI-Containers in hexadezimaler Reihenfolge folgt die Seriennummer des Objekts im VDI-Container </p><br><h2 id="epoha">  √Ñra </h2><br><p>  Das Unterverzeichnis der <code>epoch</code> enth√§lt bin√§re Listen von Objekten, die zur Epoche geh√∂ren.  Die Anzahl der Epochen erh√∂ht sich jedes Mal, wenn sich jeder Cluster √§ndert - wenn ein Knoten hinzugef√ºgt oder entfernt wird.  Jede solche √Ñnderung startet den <strong>Wiederherstellungsprozess</strong> , bei dem der aktuelle Status lokaler Objekte auf den Knoten √ºberpr√ºft wird, gefolgt von einer Zunahme der √Ñra. </p><br><h1 id="kak-optimalno-vybrat-hranilische-vdi-obektov">  So w√§hlen Sie den optimalen VDI-Objektspeicher aus </h1><br><p>  Die verf√ºgbare Speicherkapazit√§t wird basierend auf dem freien Speicherplatz auf den Knoten berechnet.  Der von <strong>Schafen</strong> gew√§hlte Speicherplatz h√§ngt immer davon ab, wie viel Speicherplatz in dem Blockger√§t verf√ºgbar ist, in dem die VDI-Objekte gespeichert sind. </p><br><p>  Die Gr√∂√üe eines VDI-Containers ist nur eine virtuelle Form, die in keiner Weise mit dem Platzbedarf von VDI-Objekten zusammenh√§ngt.  Es ist wichtig zu wissen, wie Sheepdog Daten in einem Cluster verarbeitet: </p><br><blockquote>  Sheepdog versucht immer, Daten gleichm√§√üig zwischen allen Maschinen der √Ñra zu speichern. </blockquote><p>  Dies bedeutet, dass wenn einer der Knoten f√§llt, sich die √Ñra √§ndert und <strong>Sheepdog</strong> sofort den Wiederherstellungsprozess startet, die fehlenden VDI-Objekte auf den verbleibenden Knoten erstellt werden, um den Verlust zu kompensieren. </p><br><p>  Eine √§hnliche Situation tritt auf, wenn ein neuer Knoten hinzugef√ºgt wird.  <strong>Sheepdog</strong> beginnt, VDI-Objekte gleichm√§√üig von neuen Knoten in sein Repository zu verschieben, damit die prozentuale F√ºllung des Datenraums auf den Knoten so ausgeglichen wie m√∂glich ist.  Verwenden Sie den folgenden Befehl, um eine globale √úbersicht dar√ºber zu erhalten, wie viel Speicherplatz derzeit auf Ihren Knoten verwendet wird: </p><br><pre> <code class="hljs pgsql">nod1 ~ # collie node md <span class="hljs-keyword"><span class="hljs-keyword">info</span></span> -A Id Size Used Avail Use% <span class="hljs-type"><span class="hljs-type">Path</span></span> Node <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.1</span></span> TB <span class="hljs-number"><span class="hljs-number">391</span></span> GB <span class="hljs-number"><span class="hljs-number">720</span></span> GB <span class="hljs-number"><span class="hljs-number">35</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">702</span></span> GB <span class="hljs-number"><span class="hljs-number">394</span></span> GB <span class="hljs-number"><span class="hljs-number">307</span></span> GB <span class="hljs-number"><span class="hljs-number">56</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">794</span></span> GB <span class="hljs-number"><span class="hljs-number">430</span></span> GB <span class="hljs-number"><span class="hljs-number">364</span></span> GB <span class="hljs-number"><span class="hljs-number">54</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.6</span></span> TB <span class="hljs-number"><span class="hljs-number">376</span></span> GB <span class="hljs-number"><span class="hljs-number">1.2</span></span> TB <span class="hljs-number"><span class="hljs-number">22</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.2</span></span> TB <span class="hljs-number"><span class="hljs-number">401</span></span> GB <span class="hljs-number"><span class="hljs-number">838</span></span> GB <span class="hljs-number"><span class="hljs-number">32</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.5</span></span> TB <span class="hljs-number"><span class="hljs-number">370</span></span> GB <span class="hljs-number"><span class="hljs-number">1.1</span></span> TB <span class="hljs-number"><span class="hljs-number">24</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.6</span></span> TB <span class="hljs-number"><span class="hljs-number">388</span></span> GB <span class="hljs-number"><span class="hljs-number">1.2</span></span> TB <span class="hljs-number"><span class="hljs-number">23</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj</code> </pre> <br><h2 id="proizvoditelnost-io">  E / A-Leistung </h2><br><p>  Es ist wichtig zu sagen, dass <strong>Sheepdog</strong> anders arbeitet als Ceph und unterschiedliche Priorit√§ten hat. </p><br><p>  F√ºr Ceph ist das "Gewicht" des OSD-Ger√§ts beim Platzieren von Datenobjekten sowie die Leistung des Blockger√§ts, die Host-Konnektivit√§t und die Antwortgeschwindigkeit von entscheidender Bedeutung.  <em>(eigentlich nicht - ca. pro)</em> </p><br><p>  Tut Sheepdog so etwas, ich wei√ü es nicht.  M√∂glicherweise.  Daten f√ºr ihn stehen an erster Stelle.  Die Leistung in Bezug auf E / A-Vorg√§nge ist zweitrangig.  Nat√ºrlich kann bei leistungsst√§rkeren Knoten die E / A-Leistung verbessert werden, dies h√§ngt jedoch immer von der spezifischen Struktur ab.  <em>( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tests</a> zeigen jedoch eine bessere Leistung von Sch√§ferhunden im Vergleich zu Ceph - ca. pro)</em> </p><br><blockquote>  Ich habe Sheepdog einen neuen Knoten hinzugef√ºgt, dessen Daten auf einer rotierenden 2-TB-SATA-II-Festplatte gespeichert sind.  Die maximale Schreibgeschwindigkeit f√ºr diese Disc betr√§gt ca. 80 M / s.  Tats√§chlich ist dies sehr unterschiedlich, da SATA-Laufwerke nicht gleichzeitig lesen und schreiben k√∂nnen. <br><br>  Anf√§nglich betrug die durchschnittliche Schreibgeschwindigkeit auf VDI auf dieser Festplatte etwa 20 bis 30 M / s, da zus√§tzlich zu den Daten aus VDI im Rahmen des Wiederherstellungsprozesses 392G-Containerdaten darauf repliziert wurden.  Dies dauerte 6,5 Stunden.  Die Schreibgeschwindigkeit lag zwischen 40 und 55 M / s. <br><br>  In diesem Fall war die Schreibgeschwindigkeit offensichtlich durch die E / A-Leistung des lokalen Blockger√§ts begrenzt. </blockquote><p>  F√ºr Sheepdog gilt die folgende Regel: "Je mehr VDI-Objekte sich auf den Knoten mit schneller Verbindung befinden, desto besser ist die Leistung von E / A-Vorg√§ngen." </p><br><p>  Aufgrund der Tatsache, dass das Verschieben von VDI-Objekten im Hintergrund bedeutet, dass der ‚Äûschnelle Tod eines Knotens‚Äú die Replikation der Datenobjekte verlangsamt, die den meisten Speicherplatz beanspruchen, √§u√üert sich dies in einer Verringerung der Leistung von E / A-Vorg√§ngen des VDI-Containers </p><br><h2 id="zanimaemoe-prostranstvo">  Platz belegt </h2><br><p>  Beim Platzieren von Datenobjekten ist die Menge an freiem Speicherplatz f√ºr den Schafd√§mon entscheidend.  Der Mechanismus scheint einfach.  Der Schafd√§mon, √ºber den Daten von Zeit zu Zeit mit dem VDI-Container √ºbertragen werden, bestimmt die Nutzung des freien und belegten Speicherplatzes auf den Knoten, wodurch diese sortiert werden.  Dann werden die Daten auf die Knoten mit der niedrigsten Auslastungsrate verteilt. </p><br><p>  Wenn es einen √ºberwiegend schnellen Schreibpfad gibt, ist auch die Schreiboperation in den VDI-Container schnell.  Je schneller die E / A-Operationen des VDI-Containers ausgef√ºhrt werden, desto fr√ºher kann der Schafd√§mon mit der n√§chsten Operation fortfahren. </p><br><p>  Wichtig ist, dass es bei Sheepdog keine Situation gibt, in der einer der Knoten vollst√§ndig gef√ºllt ist.  Wenn die Auslastungsrate auf dem Knoten viel schlechter wird, beginnt der Schafd√§mon, seine Datenobjekte an einen anderen Ort zu verschieben. </p><br><p>  Sheepdog funktioniert genau wie Btrfs - nur mit wirklich belegtem Platz.  Auf diese Weise k√∂nnen Sie einen virtuellen VDI-Container mit einer Kapazit√§t von 1 TB erstellen, der tats√§chlich so viel Speicherplatz beansprucht wie die darin gespeicherten Daten.  Unter diesem Gesichtspunkt ist es w√ºnschenswert, solche Formate von virtuellen Festplatten und Dateisystemen in VDI-Containern zu verwenden, die sie nacheinander bereinigen k√∂nnen. </p><br><h1 id="zapusk-klastera">  Clusterstart </h1><br><blockquote>  W√§hrend alle Knoten gleichzeitig gestoppt werden k√∂nnen, k√∂nnen Knoten nicht gleichzeitig gestartet werden !!!  Knoten sollten schrittweise verbunden werden.  Beginnend mit dem Knoten, der zuerst in der Liste der Knoten angegeben wurde. <br>  <em>(Dies ist eine √§u√üerst seltsame Aussage - ca. pro)</em> </blockquote><br><h1 id="vdi">  Vdi </h1><br><p>  Dies ist eine generische Abk√ºrzung in <strong>Sheepdog</strong> f√ºr virtuelle Festplatten, nicht das spezifische Format. <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">7</a></sup> <sup><a name="cite_ref-7"></a></sup>  .  Im Allgemeinen handelt es sich hierbei um eine virtuelle Box mit F√§chern fester Gr√∂√üe, in die <strong>Sheepdog</strong> dann die vom Client √ºbertragenen Daten legt. </p><br><h1 id="sozdanie-vdi">  VDI erstellen </h1><br><p>  Bevor wir den ersten VDI erstellen oder importieren, m√ºssen wir den Cluster formatieren.  Beim Formatieren eines Clusters werden Parameter festgelegt, die dann standardm√§√üig beim Erstellen jedes nachfolgenden VDI verwendet werden. </p><br><p>  Ein Beispiel f√ºr die Erstellung eines neuen VDI mit dem Namen Disk1 und einer Gr√∂√üe von 1 GB </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi create disk1 1G root</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@nod</span></span></span><span class="hljs-comment">1 :~# collie vdi list Name Id Size Used Shared Creation time VDI id Copies Tag Block Size Shift disk1 0 1.0 GB 0.0 MB 0.0 MB 2015-12-04 14:07 e8b18f 2 22</span></span></code> </pre> <br><p>  <strong>Id</strong> <br>  VDI-Kennung </p><br><p>  <strong>Gr√∂√üe</strong> <br>  Die Gr√∂√üe des VDI, die nicht unbedingt sofort vorab zugewiesen wird. <br>  Wenn dieses VDI im inkrementellen Format (qcow2 und dergleichen) <code>qemu-img convert</code> das mit <code>qemu-img convert</code> , entspricht es nicht der Gr√∂√üe der virtuellen Festplatte, w√§chst jedoch st√§ndig. </p><br><p>  <strong>Gebraucht</strong> <br>  Informationen dar√ºber, wie viel Speicherplatz VDI-Datenobjekte belegen. <br>  VDI, f√ºr das w√§hrend der Erstellung keine Zuordnung von Datenobjekten erforderlich ist, belegt √ºberhaupt nichts, da noch keine Datenobjekte daf√ºr erstellt wurden. </p><br><p>  <strong>Geteilt</strong> <br>  Das Volumen der Datenobjekte, die von anderen VDIs gemeinsam genutzt werden </p><br><p>  <strong>Erstellungszeit</strong> <br>  VDI-Erstellungszeit </p><br><p>  <strong>Blockgr√∂√üe</strong> <br>  Die Gr√∂√üe des VDI-Objekts.  Achtung!  Es wird nicht in MB angegeben, sondern als Zweierpotenz.  In √§lteren Versionen wurden nur 4 MB Objekte mit fester Gr√∂√üe verwendet.  Derzeit kann VDI gr√∂√üere Objekte haben.  Die optimale Gr√∂√üe f√ºr das VDI-Objekt einer normalen virtuellen Maschine sieht aus wie 64 MB (26).  Die Standardgr√∂√üe von 22 (4 MB) ist ebenfalls minimal.  Weniger kann nicht installiert werden.  Je kleiner das Objekt ist, <strong>desto</strong> mehr Dateien muss <strong>Sheepdog w√§hrend der</strong> Arbeit mit VDI verarbeiten, und die Arbeit mit Dateien ist aus Sicht von IO kein billiges Problem.  Eine gro√üe Anzahl von Dateien, insbesondere bei langsamen SATA-Controllern, kann zu einer starken Verschlechterung der Lese- und Schreibgeschwindigkeit f√ºhren.  Die maximale Gr√∂√üe der Objekte, die verwendet werden k√∂nnen, betr√§gt 31 (2 GB).  Dies kann von Vorteil sein, wenn VDI konsistent eine gro√üe Menge statischer Daten speichert, z. B. Sicherungen. </p><br><p>  <strong>Vdi id</strong> <br>  VDI-Kennung. </p><br><h2 id="chto-soderzhit-vdi">  Was enth√§lt VDI? </h2><br><p>  VDI-Inhalt sind Daten.  Dies ist ein verteiltes Blockger√§t, daher l√∂st <strong>Sheepdog</strong> diese Daten oder diesen M√ºll nicht.  Unter diesem Gesichtspunkt sieht VDI wie ein logisches LVM-Volume aus.  Ein vorab ausgef√ºllter VDI entspricht einer klassischen LV-Partition mit einem dedizierten Bereich, w√§hrend VDI einer in einem Pool erstellten Thin-LV-Partition √§hnelt (siehe LVM (thin_provisioning)), jedoch mit dem Unterschied, dass die Datenbereiche (Objekte) nicht lokal gespeichert werden Ger√§te blockieren und sind zwischen Knoten verstreut. </p><br><blockquote>  Das VDI-Format funktioniert in dieser Analogie als Dateisystem.  Einige belegen nacheinander reservierte Bereiche (Objekte), andere ordnen sie als Inodes zu und senden dann Daten direkt an sie.  Eine falsche Kombination des Knotenspeicher-Dateisystems, des VDI-Formats und des internen Dateisystems kann zu einer erheblichen Verschlechterung der E / A-Leistung f√ºhren. </blockquote><br><h2 id="kak-poluchit-informaciyu-o-vdi">  So erhalten Sie Informationen zu VDI </h2><br><p>  Um mehr √ºber das VDI-Format zu erfahren, k√∂nnen Sie <strong>qemu-img info verwenden</strong> : </p><br><pre> <code class="hljs mel">root@nod1 :~# qemu-img info sheepdog:localhost:<span class="hljs-number"><span class="hljs-number">8000</span></span>:disk1 <span class="hljs-keyword"><span class="hljs-keyword">image</span></span>: sheepdog:localhost:<span class="hljs-number"><span class="hljs-number">8000</span></span>:test2 <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>: qcow2 virtual <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>G (<span class="hljs-number"><span class="hljs-number">12884901888</span></span> bytes) disk <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">4.0</span></span>G cluster_size: <span class="hljs-number"><span class="hljs-number">65536</span></span> Format specific information: compat: <span class="hljs-number"><span class="hljs-number">1.1</span></span> lazy refcounts: false refcount bits: <span class="hljs-number"><span class="hljs-number">16</span></span> corrupt: false</code> </pre> <br><p>  An der Ausgabe des Befehls k√∂nnen Sie erkennen, dass disk1 eine Nenngr√∂√üe von 12 G hat.  Derzeit dauert es nur 4G.  Da es im qcow2-Format vorliegt, ist es offensichtlich, dass es inkrementell erstellt wurde. </p><br><pre> <code class="hljs mel">root@nod1 :~# collie vdi list Name Id Size Used Shared Creation time VDI id Copies Tag Block Size Shift disk2 <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4.0</span></span> GB <span class="hljs-number"><span class="hljs-number">4.0</span></span> GB <span class="hljs-number"><span class="hljs-number">0.0</span></span> MB <span class="hljs-number"><span class="hljs-number">2015</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-04</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">825</span></span>dc1 <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> root@nod1 :~# qemu-img info sheepdog:localhost:<span class="hljs-number"><span class="hljs-number">8000</span></span>:disk2 <span class="hljs-keyword"><span class="hljs-keyword">image</span></span>: sheepdog:localhost:<span class="hljs-number"><span class="hljs-number">8000</span></span>:disk2 <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>: raw virtual <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">4.0</span></span>G (<span class="hljs-number"><span class="hljs-number">4294967296</span></span> bytes) disk <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">4.0</span></span>G root@nod1 :~# find /datastore/obj/ | grep <span class="hljs-number"><span class="hljs-number">825</span></span>dc1 /datastore/obj/meta/<span class="hljs-number"><span class="hljs-number">80825</span></span>dc100000000 /datastore/obj/c1/<span class="hljs-number"><span class="hljs-number">00825</span></span>dc100000000 /datastore/obj/c1/<span class="hljs-number"><span class="hljs-number">00825</span></span>dc100000001</code> </pre> <br><p>  In diesem Fall wurde Disk2 als vorab zugewiesener 4-GB-VDI im Rohformat mit einer Blockgr√∂√üe von 2 GB erstellt, was tats√§chlich nur zwei 2 GB dauert </p><br><h2 id="eksport-vdi-v-fayl">  Exportieren Sie VDI in eine Datei </h2><br><p>  VDI-Inhalte k√∂nnen <strong>auf</strong> verschiedene Arten aus <strong>Sheepdog</strong> exportiert werden.  Vielleicht ist die schnellste Verwendung von <strong>Hundelesen</strong> .  Der Befehl ist etwas verwirrend, bedeutet aber nur: "Laden Sie den Inhalt des VDI und senden Sie ihn an STDOUT ..", der in eine Datei umgeleitet werden kann: </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi read disk1 &gt; /backups/soubor.raw</span></span></code> </pre> <br><p>  Wenn VDI 10G hat, aber nur 2G verwendet wird, wird eine Datei mit einer vollen Kapazit√§t von 10 GB erstellt. </p><br><p>  <strong>In diesem Befehl bleibt der Inhalt des VDI unver√§ndert</strong> . Wenn also der Inhalt des VDI, z. B. eine virtuelle Festplatte im komprimierten qcow2-Format, direkt verwendet werden kann </p><br><pre> <code class="hljs mel">.. -drive <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>:/disk1_exportovany_z_vdi,..,<span class="hljs-keyword"><span class="hljs-keyword">format</span></span>=qcow2 ..</code> </pre> <br><p>  Eine andere M√∂glichkeit, den Inhalt von VDI in eine Datei zu √ºbertragen, ist die Verwendung von <strong>qemu-img convert</strong> .  Es ist nicht so schnell, aber Sie k√∂nnen VDI mit verschiedenen Optionen des entsprechenden virtuellen Festplattenformats in ein anderes Format konvertieren. </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># qemu-img convert -f qcow2 -O file -o preallocation=full,nocow=on sheepdog:localhost:8000:disk1 /disk1_exportovany_z_vdi</span></span></code> </pre> <br><h2 id="inkrementnoe-rezervnoe-kopirovanie">  Inkrementelle Sicherung </h2><br><p>  Erstellen Sie eine inkrementelle Sicherung </p><br><p>  Delta zwischen dem ersten und zweiten Schnappschuss. </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi backup test -F snap1 -s snap2 /backups/soubor_diff</span></span></code> </pre> <br><p>  Stellen Sie VDI aus der inkrementellen Sicherung wieder her </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi restore test -s snap1 /tmp/backup restoring /tmp/backup... done</span></span></code> </pre> <br><p>  Beim Importieren einer inkrementellen Sicherung sollte der VDI nat√ºrlich √ºber den Snapshot verf√ºgen, aus dem die Sicherung erstellt wurde. </p><br><p>  √úberpr√ºfung durch Lesen des Originalinhalts des Bildtests ... </p><br><pre> <code class="hljs ruby"> root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi read test 0 512 -s 3</span></span></code> </pre> <br><h1 id="import-vdi-iz-fayla">  VDI aus Datei importieren </h1><br><p>  Das Importieren einer vorhandenen virtuellen Festplatte als lokale FS-Datei kann √§hnlich wie beim Exportieren durchgef√ºhrt werden.  Aber mit dem Unterschied, dass <strong>Hundeschreiben verwendet wird</strong> ("Lesen von Daten aus STDIN und Schreiben in eine VDI-Datei ..") </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi write disk1 &lt; /backups/soubor.raw</span></span></code> </pre> <br><p></p><br><blockquote><ul><li>  Inhalte k√∂nnen nur in eine vorhandene VDI importiert werden. </li><li>  Importierte VDI beanspruchen immer mehr Speicherplatz als die Originaldatei, da die Datenbl√∂cke, aus denen die VDI wiederhergestellt wird, Daten im markierten Bereich enthalten. </li></ul><br></blockquote><p>  Wenn VDI noch nicht vorhanden ist und wir nicht wissen, wie viel Speicherplatz f√ºr die virtuelle Festplatte erforderlich ist, k√∂nnen wir <strong>qemu-img convert verwenden</strong> </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># qemu-img convert -f file -O qcow2 -o redundancy=2:1 ./disk_ukladany_do_vdi sheepdog:localhost:8000:disk</span></span></code> </pre> <br><blockquote>  Obwohl VDI-Formate wie qcow2, qed und andere in VDI verwendet werden k√∂nnen.  F√ºr die E / A-Effizienz ist es besser, Datenbl√∂cke vorab zuzuweisen. <br>     ,        <strong>Sheepdog</strong>     VDI. </blockquote><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://www.sheepdog-project.org/doc/vdi_read_and_write.html</a> </p><br><h1 id="proverka-vdi">  VDI </h1><br><p>    VDI ,      . </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi check disk1</span></span></code> </pre> <br><blockquote>    VDI,     .    Sheepdog    ,      .     ,            . </blockquote><p> :   'dog node kill'     ,         ethernet ,   sheep    .          (,    Ethernet),         sheep .               . </p><br><h2 id="io-proizvoditelnost-vdi"> IO  VDI </h2><br><p>  VDI    .          .       ,   IO   VDI. </p><br><p>   <strong>Sheepdog</strong>    SYNC,    .   -,     VFS,   ,       ,       . </p><br><p>       VDI  <strong>Sheepdog</strong>    ,            .              .  <strong>Sheepdog</strong>        VDI-. </p><br><h2 id="ispolzovanie-vfs-kesha-nody">  VFS-  </h2><br><p>      IO  VDI      <strong>sheep</strong>   <strong>-n</strong> .    SYNC         ,   ,        VFS .     ,   VFS  ,   ,      ! </p><br><p>         .            ,          ‚Äî , ,    . </p><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">sheep</span></span> -n ...</code> </pre> <br><blockquote>   <strong>Sheepdog</strong>      .      <strong>-D</strong> </blockquote><br><h1 id="obektnyy-kesh">   </h1><br><p>     -   .   <strong>sheep</strong>           -   IO ‚Äî  SSD .  ,   VDI,       SYNC   .             . </p><br><p>       ,   VDI     ,         VDI   . ,     ,     ,      VDI. </p><br><pre> <code class="hljs dos">sheep -w size=<span class="hljs-number"><span class="hljs-number">20000</span></span>,directio,<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>=/<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> ...</code> </pre> <br><p> <strong>size</strong> <br>   </p><br><p> <strong>directio</strong> <br>     <strong>sheep</strong>      ,      .      SSD. </p><br><p> <strong>dir</strong> </p><br><pre> <code class="hljs erlang">     ,     .</code> </pre> <br><p>       ( )   <strong>dog</strong> . </p><br><blockquote>        VDI          <strong>dog vd cashe flush</strong> ,     VDI! </blockquote><br><h2 id="zhurnal">  Magazin </h2><br><p>   ‚Äî  .           VDI,     VFS   ,           (/store_dir/journal/[epoch]/[vdi_object_id]),     ,    . </p><br><p>   IO   ,        (cik, cak),   (sequence). </p><br><p>  , <strong>Sheepdog</strong>        VDI ,           ,  SSD-.     ,       VDI    ,           ,                VDI. </p><br><p>        <strong>sheep</strong>      ‚Äî         </p><br><pre> <code class="hljs matlab">$ sheep -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> <span class="hljs-built_in"><span class="hljs-built_in">size</span></span>=<span class="hljs-number"><span class="hljs-number">256</span></span>M ...</code> </pre> <br><p>       ,  VDI      ,    .        -,   ‚Äî   ‚Äî         -: </p><br><pre> <code class="hljs matlab">$ sheep -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> dir=/dir,<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>=<span class="hljs-number"><span class="hljs-number">256</span></span>M ...</code> </pre> <br><p>  dir =      ,          .       ,     SW RAID     SSD. </p><br><p> <strong>:</strong>    <strong>sheep</strong>     ,    .     ,      skip,   . </p><br><pre> <code class="hljs matlab">$ sheep -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> dir=/dir,<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>=<span class="hljs-number"><span class="hljs-number">256</span></span>M,skip ...</code> </pre> <br><hr><br><ol><li>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Üë</a></sup> <sup><a name="cite_note-1"></a> .       2015 . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://events.linuxfoundation.jp/sites/events/files/slides/COJ2015_Sheepdog_20150604.pdf</a></sup> </li><li>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Üë</a></sup> <sup><a name="cite_note-2"></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://www.abclinuxu.cz/blog/kenyho_stesky/2011/11/sheepdog-hrajeme-si-v-hampejzu</a></sup> </li><li>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Üë</a></sup> <sup><a name="cite_note-3"></a> SPOF ( <strong>S</strong> ingle <strong>p</strong> oint <strong>o</strong> f <strong>f</strong> ailure) ,             .  SPOF   VDI   iSCSI  <strong>tgtd</strong></sup> </li><li>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Üë</a></sup> <sup><a name="cite_note-4"></a></sup>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1</a></sup> </li><li><p>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Üë</a></sup> <sup><a name="cite_note-5"></a> Btrfs ‚Äî    COW,       ,        .   ,      -,      .      ,     ,              .      ,         ,   .  ,     :</sup> </p><br><p> <sup>autodefrag ‚Äî     ,          .</sup> </p><br><p> <sup>      </sup> </p><br><p> <sup>nocow ‚Äî           (),      ‚Äî           GlusterFS</sup> </p><br><p> <sup> Btrfs   ,     ,     FS,       <strong>Sheepdog</strong> .</sup> </p><br><ul><li> <sup>    ,   ,    ,      </sup> </li><li> <sup>  multipath,                         .</sup> </li></ul><br><p> <sup>,  ,        ,        Sheepdog.</sup> </p><br></li><li><p>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Üë</a></sup> <sup><a name="cite_note-6"></a> <strong>Ext2</strong> .     -  FS  Btrfs,    ext2,     inode.    ext3  ext4     .   inode , Sheepdog          . ,      -,   .           ,   <strong>Sheepdog</strong>      ,         <strong>dog vdi check</strong> . ,  ext2  ,            ‚Äî    -     <strong>dog vdi md</strong> ,       VDI     .</sup> </p><br></li><li>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Üë</a></sup> <sup><a name="cite_note-7"></a>    ,   , <strong>vdi</strong>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">QEMU_Block_Disk</a></sup> </li></ol><br><h1 id="ssylki">  Referenzen </h1><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/collie/sheepdog/wiki</a> ‚Äî ,        <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://www.osrg.net/sheepdog/</a> ‚Äî    Nippon Telegraph and Telephone Corporation <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://www.sheepdog-project.org/doc/index.html</a> ‚Äî   Sheepdog   0.8.0;  ‚Äî Valerio Pachera <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://www.admin-magazine.com/Archive/2014/23/Distributed-storage-with-Sheepdog</a> ‚Äî  Udo Seidela   <strong>Sheepdog</strong> ,   23-   Admin   2014  </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de412739/">https://habr.com/ru/post/de412739/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de412725/index.html">So machen Sie Ihre IT-Infrastruktur langweilig</a></li>
<li><a href="../de412727/index.html">Wie w√§hle ich ein Tool f√ºr das Prototyping im Jahr 2018 aus?</a></li>
<li><a href="../de412729/index.html">DSGVO. Ist es notwendig, es in Russland durchzuf√ºhren?</a></li>
<li><a href="../de412735/index.html">Lassen Sie den ATM Alone-Wettbewerb an PHDays 8</a></li>
<li><a href="../de412737/index.html">Schutz personenbezogener Daten von 3 Milliarden Menschen - √Ñhnlichkeiten und Unterschiede in der Gesetzgebung in den BRICS-L√§ndern</a></li>
<li><a href="../de412741/index.html">Wie Sie aufh√∂ren k√∂nnen, Angst zu haben, dass k√ºnstliche Intelligenz Sie ohne Arbeit l√§sst</a></li>
<li><a href="../de412743/index.html">Beruf: Cyber ‚Äã‚ÄãDetective</a></li>
<li><a href="../de412747/index.html">MIS. Speicherung medizinischer Daten</a></li>
<li><a href="../de412749/index.html">Elektronik als Kunst: Elektrischer Strom</a></li>
<li><a href="../de412751/index.html">Kahlheit: Theorie und Praxis der Behandlung, Teil 1 "Mein Dihydrotestosteron, mein Feind"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>