<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйтАНЁЯСж тЩУя╕П ЁЯЩМЁЯП╜ 3proxy рдФрд░ iptables / netfilter рдпрд╛ "рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдм рдХреБрдЫ рдХреИрд╕реЗ рдХрд░реЗрдВ" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдкрд╛рд░рджрд░реНрд╢реА рд╕рдореАрдкрддрд╛ рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ тЩНя╕П ЁЯеЩ тЩ╛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рдореИрдВ рдкрд╛рд░рджрд░реНрд╢реА рд╕рдореАрдкрддрд╛ рдХреА рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рдкреНрд░рдХрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛, рдЬреЛ рдЖрдкрдХреЛ рдмрд╛рд╣рд░реА рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рд╕рднреА рдпрд╛ рдкреБрд░реНрдЬрд╝реЗ рдХреЛ рдкреВрд░реА рддрд░рд╣...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>3proxy рдФрд░ iptables / netfilter рдпрд╛ "рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдм рдХреБрдЫ рдХреИрд╕реЗ рдХрд░реЗрдВ" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдкрд╛рд░рджрд░реНрд╢реА рд╕рдореАрдкрддрд╛ рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460469/">  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рдореИрдВ рдкрд╛рд░рджрд░реНрд╢реА рд╕рдореАрдкрддрд╛ рдХреА рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рдкреНрд░рдХрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛, рдЬреЛ рдЖрдкрдХреЛ рдмрд╛рд╣рд░реА рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рд╕рднреА рдпрд╛ рдкреБрд░реНрдЬрд╝реЗ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред <br><br>  рдЬрдм рдореИрдВрдиреЗ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛, рддреЛ рдореБрдЭреЗ рдЗрд╕ рддрдереНрдп рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝рд╛ рдХрд┐ рдЗрд╕рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рдорд╕реНрдпрд╛ рд╣реИ - HTTPS рдкреНрд░реЛрдЯреЛрдХреЙрд▓ред  рдЕрдЪреНрдЫреЗ рдкреБрд░рд╛рдиреЗ рджрд┐рдиреЛрдВ рдореЗрдВ, рдкрд╛рд░рджрд░реНрд╢реА HTTP рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд╕рд╛рде рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рдереА, рд▓реЗрдХрд┐рди рдПрдЪрдЯреАрдЯреАрдкреАрдПрд╕ рдХреЗ рдЖрд╕-рдкрд╛рд╕ рд╣реЛрдиреЗ рдкрд░, рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд╕рд╛рде рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣реА рд╡рд╣ рдЬрдЧрд╣ рд╣реИ рдЬрд╣рд╛рдВ рдЦреБрд╢реА рд╕рдорд╛рдкреНрдд рд╣реЛрддреА рд╣реИред <br><br>  рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдирд┐рд░реНрджреЗрд╢реЛрдВ рдореЗрдВ, рд╕реНрдХреНрд╡рд┐рдб рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдФрд░ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдкреЗрд╢рдХрд╢ рднреА рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдХрдо рд╕реЗ рдХрдо рдЕрддрд╛рд░реНрдХрд┐рдХ рд╣реИ рдФрд░ MITM рд╣рдорд▓реЗ рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред  рдореБрдЭреЗ рдкрддрд╛ рд╣реИ рдХрд┐ рд╕реНрдХреНрд╡реАрдб рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдРрд╕рд╛ рдХреБрдЫ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд▓реЗрдЦ рдПрдХ рд╕рд┐рджреНрдз рдФрд░ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИ рдЬреЛ рд╕рдореНрдорд╛рдирд┐рдд 3APA3A рд╕реЗ 3proxy рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред <br><br>  рдЕрдЧрд▓рд╛, рд╣рдо рд╕реНрд░реЛрдд рд╕реЗ 3proxy рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдЗрд╕рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдкреВрд░реНрдг рдФрд░ рдЪрдпрдирд╛рддреНрдордХ рд╕рдореАрдкрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП NAT, рдЪреИрдирд▓ рд╡рд┐рддрд░рдг рдХреЛ рдХрдИ рдмрд╛рд╣рд░реА рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░, рдФрд░ рдПрдХ рд░рд╛рдЙрдЯрд░ рдФрд░ рд╕реНрдерд┐рд░ рдорд╛рд░реНрдЧреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ рдПрдХ рдХрд░реАрдм рд╕реЗ рджреЗрдЦреЗрдВрдЧреЗред  рд╣рдо рдУрдПрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдбреЗрдмрд┐рдпрди 9 x64 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЪрд▓реЛ рд╢реБрд░реВ рд╣реЛ рдЬрд╛рдУ! <br><a name="habracut"></a><br><h3>  3proxy рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ рдФрд░ рдПрдХ рдирд┐рдпрдорд┐рдд рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рд╢реБрд░реВ рдХрд░реЗрдВ </h3><br>  1. рд╕реНрдерд╛рдкрд┐рдд ifconfig (рд╢реБрджреНрдз рдЙрдкрдХрд░рдг рдкреИрдХреЗрдЬ рд╕реЗ) <br> <code>apt-get install net-tools</code> <br>  2. Midnigth рдХрдорд╛рдВрдбрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ <br> <code>apt-get install mc</code> <br>  3. рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ 2 рдЗрдВрдЯрд░рдлреЗрд╕ рд╣реИрдВ: <br>  enp0s3 - рдмрд╛рд╣рд░реА, рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рджрд┐рдЦрддрд╛ рд╣реИ <br>  enp0s8 - рдЖрдВрддрд░рд┐рдХ, рдПрдХ рд╕реНрдерд╛рдиреАрдп рдХреНрд╖реЗрддреНрд░ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП <br>  рдЕрдиреНрдп рдбреЗрдмрд┐рдпрди-рдЖрдзрд╛рд░рд┐рдд рд╡рд┐рддрд░рдг рдореЗрдВ, рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЛ рдЖрдорддреМрд░ рдкрд░ eth0 рдФрд░ eth1 рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред <br> <code>ifconfig -a</code> <br> <br><div class="spoiler">  <b class="spoiler_title">рдЗрдВрдЯрд░рдлреЗрд╕</b> <div class="spoiler_text">  enp0s3: рдЭрдВрдбреЗ = 4163 &lt;UP, BROADCAST, рд░рдирд┐рдВрдЧ, MULTICAST&gt; рдбреАрдЯреАрдПрдЪ 1500 <br>  inet 192.168.23.11 рдиреЗрдЯрдорд╛рд╕реНрдХ 255.255.255.0 рдкреНрд░рд╕рд╛рд░рдг 192.168.23.255 <br>  inet6 fe80 :: a00: 27ff: fec2: bae4 prefixlen 64 рдЧреБрдВрдЬрд╛рдЗрд╢ 0x20 рдИрдерд░ 08: 00: 27: c2: ba: e4 txqueuelen 1000 (рдИрдерд░рдиреЗрдЯ) <br>  RX рдкреИрдХреЗрдЯ 6412 рдмрд╛рдЗрдЯ 8676619 (8.2 MiB) <br>  рдЖрд░рдПрдХреНрд╕ рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рдлреНрд░реЗрдо 0 <br>  TX рдкреИрдХреЗрдЯ 1726 рдмрд╛рдЗрдЯреНрд╕ 289128 (282.3 KiB) <br>  TX рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рд╡рд╛рд╣рдХ 0 рдЯрдХрд░рд╛рд╡ 0 <br><br>  enp0s8: рдЭрдВрдбреЗ = 4098 &lt;BROADCAST, MULTICAST&gt; mtu 1500 <br>  рдИрдерд░ 08: 00: 27: 79: a7: e3 txqueuelen 1000 (рдИрдерд░рдиреЗрдЯ) <br>  RX рдкреИрдХреЗрдЯ 0 рдмрд╛рдЗрдЯреНрд╕ 0 (0.0 B) <br>  рдЖрд░рдПрдХреНрд╕ рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рдлреНрд░реЗрдо 0 <br>  TX рдкреИрдХреЗрдЯ 0 рдмрд╛рдЗрдЯреНрд╕ 0 (0.0 B) <br>  TX рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рд╡рд╛рд╣рдХ 0 рдЯрдХрд░рд╛рд╡ 0 <br><br>  lo: рдЭрдВрдбреЗ = 73 &lt;UP, LOOPBACK, RUNNING&gt; mtu 65536 <br>  inet 127.0.0.1 рдиреЗрдЯрдорд╛рд╕реНрдХ 255.0.0.0 <br>  inet6 :: 1 рдкреНрд░реАрдлрд┐рдХреНрд╕рд▓реЗрди 128 рд╕реНрдХреЛрдкрд┐рдб 0x10 рд▓реВрдк txqueuelen 1 (рд╕реНрдерд╛рдиреАрдп рд▓реВрдкрдмреИрдХ) <br>  RX рдкреИрдХреЗрдЯ 0 рдмрд╛рдЗрдЯреНрд╕ 0 (0.0 B) <br>  рдЖрд░рдПрдХреНрд╕ рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рдлреНрд░реЗрдо 0 <br>  TX рдкреИрдХреЗрдЯ 0 рдмрд╛рдЗрдЯреНрд╕ 0 (0.0 B) <br>  TX рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рд╡рд╛рд╣рдХ 0 рдЯрдХрд░рд╛рд╡ 0 <br><br>  рд╡рд░реНрддрдорд╛рди рдореЗрдВ enp0s8 рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрдм рд╣рдо рдкреНрд░реЙрдХреНрд╕реА NAT рдпрд╛ NAT рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдЗрд╕реЗ рд╕рдХреНрд╖рдо рдХрд░реЗрдВрдЧреЗред  рдЗрд╕рдХреЗ рдмрд╛рдж рдПрдХ рд╕реНрдерд┐рд░ рдЖрдИрдкреА рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛ рддрд░реНрдХрд╕рдВрдЧрдд рд╣реИред <br><br>  4. 3proxy рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝реЗрдВ <br><br>  4.1 рд╕реНрд░реЛрдд рд╕реЗ 3proxy рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореВрд▓ рд╕рдВрдХреБрд▓ рд╕рдВрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ <br><br> <code>root@debian9:~# apt-get install build-essential libevent-dev libssl-dev -y</code> <br> <br>  4.2ред  рд╕реНрд░реЛрдд рдХреЗ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛рдПрдВ <br><br> <code>root@debian9:~# mkdir -p /opt/proxy</code> <br> <br>  4.3ред  рдЖрдЗрдП рдЗрд╕ рдлреЛрд▓реНрдбрд░ рдкрд░ рдЬрд╛рдПрдВ <br><br> <code>root@debian9:~# cd /opt/proxy <br></code> <br><br>  4.4ред  рдЕрдм рдирд╡реАрдирддрдо 3proxy рдкреИрдХреЗрдЬ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВред  рд▓реЗрдЦрди рдХреЗ рд╕рдордп, рдирд╡реАрдирддрдо рд╕реНрдерд┐рд░ рд╕рдВрд╕реНрдХрд░рдг 0.8.12 (04/18/2018) рдЖрдзрд┐рдХрд╛рд░рд┐рдХ 3proxy рд╡реЗрдмрд╕рд╛рдЗрдЯ рд╕реЗ рдЗрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ <br><br> <code>root@debian9:/opt/proxy# wget https://github.com/z3APA3A/3proxy/archive/0.8.12.tar.gz <br></code> <br><br>  4.5ред  рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рд╕рдВрдЧреНрд░рд╣ рдХреЛ рдЕрдирдЬрд╝рд┐рдк рдХрд░реЗрдВ <br><br> <code>root@debian9:/opt/proxy# tar zxvf 0.8.12.tar.gz</code> <br> <br>  4.6ред  рдкреНрд░реЛрдЧреНрд░рд╛рдо рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдирдкреИрдХреНрдб рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ рдЬрд╛рдПрдВ <br><br> <code>root@debian9:/opt/proxy# cd 3proxy-0.8.12</code> <br> <br>  4.7ред  рдЕрдЧрд▓рд╛, рдЖрдкрдХреЛ рд╢реАрд░реНрд╖ рд▓реЗрдЦ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдкрдВрдХреНрддрд┐ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рдорд╛рд░рд╛ рд╕рд░реНрд╡рд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЧреБрдордирд╛рдо рд╣реЛ (рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд╕рдм рдХреБрдЫ рдЬрд╛рдВрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЖрдИрдкреА рд╕рд░реНрд╡рд░ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реИ) <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# nano +29 src/proxy.h</code> <br> <br>  рдПрдХ рдкрдВрдХреНрддрд┐ рдЬреЛрдбрд╝реЗрдВ <br><br> <code>#define ANONYMOUS 1 <br></code> <br>  рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП Ctrl + x рдФрд░ Enter рджрдмрд╛рдПрдБред <br><br>  4.8ред  рдХрд╛рд░реНрдпрдХреНрд░рдо рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВ <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# make -f Makefile.Linux</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Makelog</b> <div class="spoiler_text">  рдореЗрдХ [2]: рд▓реАрдбрд┐рдВрдЧ рдбрд╛рдЗрд░реЗрдХреНрдЯрд░реА '/opt/proxy/3proxy-0.8.12/src/plugins/TransparentPlugin' <br>  рдмрдирд╛рдирд╛ [рез]: рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдЫреЛрдбрд╝рдирд╛ '/opt/proxy/3proxy-0.8.12/src' <br></div></div><br>  рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдирд╣реАрдВ, рдЬрд╛рд░реА рд░рдЦреЗрдВред <br><br>  4.9ред  рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# make -f Makefile.Linux install</code> <br> <br>  4.10ред  рд░реВрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд╣рд╛рдВ рд╕реНрдерд╛рдкрд┐рдд рд╣реИред <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# cd ~/ <br> root@debian9:~# whereis 3proxy</code> <br>  3proxy: / usr / рд╕реНрдерд╛рдиреАрдп / рдмрд┐рди / 3proxy / usr / рд╕реНрдерд╛рдиреАрдп / рдЖрджрд┐ / 3proxy <br><br>  4.11ред  рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛рдПрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╣реЛрдо рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рд▓реЙрдЧ рдХрд░реЗрдВ <br><br> <code>root@debian9:~# mkdir -p /home/joke/proxy/logs</code> <br> <br>  4.12ред  рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ рдЬрд╛рдПрдВ рдЬрд╣рд╛рдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП <br><br> <code>root@debian9:~# cd /home/joke/proxy/</code> <br> <br>  4.13ред  рдПрдХ рдЦрд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдБ рдФрд░ рд╡рд╣рд╛рдБ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдПрдБ <br><br> <code>root@debian9:/home/joke/proxy# cat &gt; 3proxy.conf</code> <br> <br><div class="spoiler">  <b class="spoiler_title">3proxy.conf</b> <div class="spoiler_text">  рдбреЗрдореЙрди <br>  pidfile /home/joke/proxy/3proxy.pid <br>  nserver 8.8.8.8 <br>  nscache 65536 <br>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд░реАрдХреНрд╖рдХ: рд╕реАрдПрд▓: 1234 <br>  рдЯрд╛рдЗрдордЖрдЙрдЯ 1 5 30 60 180 1800 16 60 <br>  log /home/joke/proxy/logs/3proxy.log рдбреА <br>  logformat "- + _L% tред%ред% Nред% p% E% U% C:% c% R:% r% O% I% h% T" <br>  рдШреБрдорд╛рдПрдБ рей <br>  рдЬреЛрд░рджрд╛рд░ <br>  рд▓рд╛рд▓рд┐рдорд╛ <br>  рдкрд░реАрдХреНрд╖рдХ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ <br>  рдореЛрдЬрд╝реЗ -p3128 <br>  рдкреНрд░реЙрдХреНрд╕реА -8080 <br></div></div><br>  рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, Ctrl + Z рджрдмрд╛рдПрдВ <br><br>  4.14ред  рдПрдХ рдкреАрдЖрдИрдбреА тАЛтАЛрдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ рддрд╛рдХрд┐ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдкрд░ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рди рд╣реЛред <br><br> <code>root@debian9:/home/joke/proxy# cat &gt; 3proxy.pid</code> <br> <br>  рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, Ctrl + Z рджрдмрд╛рдПрдВ <br><br>  4.15ред  рдПрдХ рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рд▓реЙрдиреНрдЪ рдХрд░реЗрдВ! <br><br> <code>root@debian9:/home/joke/proxy# 3proxy /home/joke/proxy/3proxy.conf</code> <br> <br>  4.16ред  рдЪрд▓реЛ рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╕рд░реНрд╡рд░ рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдкрд░ рд╕реБрди рд░рд╣рд╛ рд╣реИ <br><br> <code>root@debian9:~/home/joke/proxy# netstat -nlp</code> <br> <br><div class="spoiler">  <b class="spoiler_title">netstat рд▓реЙрдЧ</b> <div class="spoiler_text">  рд╕рдХреНрд░рд┐рдп рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди (рдХреЗрд╡рд▓ рд╕рд░реНрд╡рд░) <br>  рдкреНрд░реЛрдЯреЛ рд░рд┐рдХрд╡-рдХреНрдпреВ рд╕реЗрдВрдб-рдХреНрдпреВ рд▓реЛрдХрд▓ рдПрдбреНрд░реЗрд╕ рдлреЙрд░реЗрди рдПрдбреНрд░реЗрд╕ рд╕реНрдЯреЗрдЯ рдкреАрдЖрдИрдбреА тАЛтАЛ/ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдирд╛рдо <br>  tcp 0 0 0.0.0.0:8080 0.0.0.0:* LISTEN 504 / 3proxy <br>  tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 338 / sshd <br>  tcp 0 0 0.0.0.0lla128 0.0.0.0:* LISTEN 504 / 3proxy <br>  tcp6 0 0 ::: 22 ::: * LISTEN 338 / sshd <br>  udp 0 0 0.0.0.0:68 0.0.0.0:* 352 / dhclient <br></div></div><br>  рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдерд╛, рд╡реЗрдм рдкреНрд░реЙрдХреНрд╕реА 8080 рдХреЛ рдкреЛрд░реНрдЯ рдХрд░рддрд╛ рд╣реИ, рдФрд░ Socks5 рдкреНрд░реЙрдХреНрд╕реА 3128 рдХреЛ рд╕реБрдирддрд╛ рд╣реИред <br><br>  4.17ред  рд░рд┐рдмреВрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдкреНрд░реЙрдХреНрд╕реА рд╕реЗрд╡рд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдХреНрд░реЛрди рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред <br><br> <code>root@debian9:/home/joke/proxy# crontab -e</code> <br> <br>  рдПрдХ рдкрдВрдХреНрддрд┐ рдЬреЛрдбрд╝реЗрдВ <br><br> <code>@reboot /usr/local/bin/3proxy /home/joke/proxy/3proxy.conf</code> <br> <br>  Enter рджрдмрд╛рдПрдВ, рдХреНрдпреЛрдВрдХрд┐ рдХреНрд░реЛрди рдХреЛ рд▓рд╛рдЗрди рд╡рд░реНрдг рдХрд╛ рдЕрдВрдд рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рд╣реЗрдЬрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рдПрдХ рдирдпрд╛ crontab рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рд╕рдВрджреЗрд╢ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  crontab: рдирдпрд╛ crontab рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ <br><br>  4.18ред  рд╣рдо рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд░рд┐рдмреВрдЯ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░реЙрдХреНрд╕реА рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреЗред  рд╕рддреНрдпрд╛рдкрди рдХреЗ рд▓рд┐рдП, рд╣рдо рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╕рд╛рде рдореЛрдЬрд╝реЗ 5 рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдпрд░рдлрд╝реЙрдХреНрд╕ рдмреНрд░рд╛рдЙрдЬрд╝рд░ (рд╡реЗрдм тАЛтАЛрдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд▓рд┐рдП) рдФрд░ рдлреЙрдХреНрд╕рдкреЙрдХреНрд╕реА рдРрдб-рдСрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br> <code>root@debian9:/home/joke/proxy# reboot</code> <br> <br>  4.19ред  рд░рд┐рдмреВрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдкреНрд░реЙрдХреНрд╕реА рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рд▓реЙрдЧ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рдкреНрд░реЙрдХреНрд╕реА рд╕реЗрдЯрдЕрдк рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИред <br><br><div class="spoiler">  <b class="spoiler_title">3 рдкреНрд░реЙрдХреНрд╕реА рд▓реЙрдЧ</b> <div class="spoiler_text">  1542573996.018 PROXY.8080 00000 рдкрд░реАрдХреНрд╖рдХ 192.168.23.10:50915 217.12.15.54ced43 1193 6939 0 CONNECT_ads.yahoo.com:443_HTTP-1.1.1 <br>  1542574289.634 SOCK5.3128 00000 рдкрд░реАрдХреНрд╖рдХ 192.168.23.10/101193 54.192.13.69:443 0 0 0 CONNECT_normandy.cdn.mozilla.net:443 <br></div></div><br><h3>  рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ рдФрд░ рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА NAT рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЪрд▓рд╛рдПрдБ </h3><br>  рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд╕рднреА рдбрд┐рд╡рд╛рдЗрд╕ рдкрд╛рд░рджрд░реНрд╢реА рд░реВрдк рд╕реЗ рджреВрд░рд╕реНрде рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред  рдмрд┐рд▓реНрдХреБрд▓ рд╕рднреА рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЛ рдПрдХ рдпрд╛ рдХрдИ (рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЪреИрдирд▓ рдХреА рдЪреМрдбрд╝рд╛рдИ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЙрджрд╛рд╣рд░рдг рдирдВрдмрд░ 2!) рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  DNS 3proxy (dnspr) рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред  рдпреВрдбреАрдкреА рдмрд╛рд╣рд░ рдирд╣реАрдВ рдЬрд╛рдПрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЕрднреА рддрдХ рдЖрдЧреЗ рддрдВрддреНрд░ (рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдХреНрд╖рдо) рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред <br><br>  1. рдпрд╣ enp0s8 рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ <br><br> <code>root@debian9:~# nano /etc/network/interfaces</code> <br> <br><div class="spoiler">  <b class="spoiler_title">/ etc / рдиреЗрдЯрд╡рд░реНрдХ / рдЗрдВрдЯрд░рдлреЗрд╕ рдлрд╝рд╛рдЗрд▓</b> <div class="spoiler_text">  # рдпрд╣ рдлрд╝рд╛рдЗрд▓ рдЖрдкрдХреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЙрдкрд▓рдмреНрдз рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреА рд╣реИ <br>  # рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рдПред  рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдЗрдВрдЯрд░рдлреЗрд╕ (5) рджреЗрдЦреЗрдВред <br><br>  рд╕реНрд░реЛрдд /etc/network/interfaces.d/* <br><br>  # рд▓реВрдкрдмреИрдХ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ <br>  рдСрдЯреЛ рд▓реЛ <br>  iface рд▓реЛ рдЗрдирд╕реЗрдЯ рд▓реВрдкрдмреИрдХ <br><br>  # рдкреНрд░рд╛рдердорд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ <br>  allow-hotplug enp0s3 <br>  iface enp0s3 inet dhcp <br><br>  # рдорд╛рдзреНрдпрдорд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ <br>  allow-hotplug enp0s8 <br>  iface enp0s8 рдЗрдирд╕реЗрдЯ рд╕реНрдерд┐рд░ <br>  рдкрддрд╛ 192.168.201.254 <br>  netmask 255.255.255.0 <br></div></div><br>  рдпрд╣рд╛рдВ рд╣рдордиреЗ рд╕реНрдереИрддрд┐рдХ рдкрддрд╛ 192.168.201.254 рдФрд░ рдорд╛рд╕реНрдХ 255.255.255.0 рдХреЛ enp0s8 рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рд╕реМрдВрдкрд╛ <br>  Ctrl + X рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░реЗрдВ рдФрд░ рд░рд┐рдмреВрдЯ рдХрд░реЗрдВ <br><br> <code>root@debian9:~# reboot</code> <br> <br>  2. рдЗрдВрдЯрд░рдлреЗрд╕ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛ <br><br> <code>root@debian9:~# ifconfig</code> <br> <br><div class="spoiler">  <b class="spoiler_title">ifconfig рд▓реЙрдЧ</b> <div class="spoiler_text">  enp0s3: рдЭрдВрдбреЗ = 4163 &lt;UP, BROADCAST, рд░рдирд┐рдВрдЧ, MULTICAST&gt; рдбреАрдЯреАрдПрдЪ 1500 <br>  inet 192.168.23.11 рдиреЗрдЯрдорд╛рд╕реНрдХ 255.255.255.0 рдкреНрд░рд╕рд╛рд░рдг 192.168.23.255 <br>  inet6 fe80 :: a00: 27ff: fec2: bae4 prefixlen 64 рдЧреБрдВрдЬрд╛рдЗрд╢ 0x20 рдИрдерд░ 08: 00: 27: c2: ba: e4 txqueuelen 1000 (рдИрдерд░рдиреЗрдЯ) <br>  RX рдкреИрдХреЗрдЯ 61 рдмрд╛рдЗрдЯреНрд╕ 7873 (7.6 KiB) <br>  рдЖрд░рдПрдХреНрд╕ рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рдлреНрд░реЗрдо 0 <br>  TX рдкреИрдХреЗрдЯ 65 рдмрд╛рдЗрдЯреНрд╕ 10917 (10.6 KiB) <br>  TX рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рд╡рд╛рд╣рдХ 0 рдЯрдХрд░рд╛рд╡ 0 <br><br>  enp0s8: рдЭрдВрдбреЗ = 4163 &lt;UP, BROADCAST, рд░рдирд┐рдВрдЧ, MULTICAST&gt; рдбреАрдЯреАрдПрдЪ 1500 <br>  inet 192.168.201.254 рдиреЗрдЯрдорд╛рд╕реНрдХ 255.255.255.0 рдкреНрд░рд╕рд╛рд░рдг 192.168.201.255 <br>  inet6 fe80 :: a00: 27ff: fe79: a7e3 рдкреНрд░реАрдлрд╝рд┐рдХреНрд╕рд▓реАрди 64 рд╕реНрдХреЛрдкрд┐рдб 0x20 рдИрдерд░ 08: 00: 27: 79: a7: e3 txqueuelen 1000 (рдИрдерд░рдиреЗрдЯ) <br>  RX рдкреИрдХреЗрдЯ 0 рдмрд╛рдЗрдЯреНрд╕ 0 (0.0 B) <br>  рдЖрд░рдПрдХреНрд╕ рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рдлреНрд░реЗрдо 0 <br>  TX рдкреИрдХреЗрдЯ 8 рдмрд╛рдЗрдЯреНрд╕ 648 (648.0 рдмреА) <br>  TX рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рд╡рд╛рд╣рдХ 0 рдЯрдХрд░рд╛рд╡ 0 <br><br>  lo: рдЭрдВрдбреЗ = 73 &lt;UP, LOOPBACK, RUNNING&gt; mtu 65536 <br>  inet 127.0.0.1 рдиреЗрдЯрдорд╛рд╕реНрдХ 255.0.0.0 <br>  inet6 :: 1 рдкреНрд░реАрдлрд┐рдХреНрд╕рд▓реЗрди 128 рд╕реНрдХреЛрдкрд┐рдб 0x10 рд▓реВрдк txqueuelen 1 (рд╕реНрдерд╛рдиреАрдп рд▓реВрдкрдмреИрдХ) <br>  RX рдкреИрдХреЗрдЯ 0 рдмрд╛рдЗрдЯреНрд╕ 0 (0.0 B) <br>  рдЖрд░рдПрдХреНрд╕ рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рдлреНрд░реЗрдо 0 <br>  TX рдкреИрдХреЗрдЯ 0 рдмрд╛рдЗрдЯреНрд╕ 0 (0.0 B) <br>  TX рддреНрд░реБрдЯрд┐рдпрд╛рдВ 0 рдЧрд┐рд░рд╛ 0 рдУрд╡рд░рд░рди 0 рд╡рд╛рд╣рдХ 0 рдЯрдХрд░рд╛рд╡ 0 <br><br>  3. рд╕рдм рдХреБрдЫ рдирд┐рдХрд▓рд╛, рдЕрдм рдЖрдкрдХреЛ рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд▓рд┐рдП 3proxy рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br> <code>root@debian9:~# cd /home/joke/proxy/ <br> root@debian9:/home/joke/proxy# cat &gt; 3proxytransp.conf</code> <br> <br><div class="spoiler">  <b class="spoiler_title">рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ # 1 рдХрд╛ рдЙрджрд╛рд╣рд░рдг рд╡рд┐рдиреНрдпрд╛рд╕</b> <div class="spoiler_text">  рдбреЗрдореЙрди <br>  pidfile /home/joke/proxy/3proxy.pid <br>  nserver 8.8.8.8 <br>  nscache 65536 <br>  рдЯрд╛рдЗрдордЖрдЙрдЯ 1 5 30 60 180 1800 16 60 <br>  log /home/joke/proxy/logs/3proxy.log рдбреА <br>  logformat "- + _L% tред%ред% N.% p% E% U% C:% c% R:% r% O% I% h% T" <br>  рдШреБрдорд╛рдПрдБ рей <br>  рд▓рд╛рд▓рд┐рдорд╛ <br>  рдЖрдИрдлрд╝реЛрди <br>  dnspr <br>  рдЕрдиреБрдорддрд┐ * <br>  рдорд╛рддрд╛-рдкрд┐рддрд╛ 1000 рдореЛрдЬреЗ 5 IP_EXTERNAL_PROXY 3128 рдкрд░реАрдХреНрд╖рдХ 1234 <br>  plugin /opt/proxy/3proxy-0.8.12/src/TransparentPlugin.ld.so рдкрд╛рд░рджрд░реНрд╢реА_рдкреНрд▓рдЧрд┐рди <br>  tcppm -i0.0.0.0 888 127.0.0.1 11111 <br></div></div><br>  4. рдЕрдм рдирдП config рдХреЗ рд╕рд╛рде 3proxy рдЪрд▓рд╛рдПрдБ <br> <code>root@debian9:/home/joke/proxy# /usr/local/bin/3proxy /home/joke/proxy/3proxytransp.conf</code> <br> <br>  5. рдлрд┐рд░ рд╕реЗ рдХреНрд░реЙрд╕реНрдЯреИрдм рдЬреЛрдбрд╝реЗрдВ <br> <code>root@debian9:/home/joke/proxy# crontab -e <br> @reboot /usr/local/bin/3proxy /home/joke/proxy/3proxytransp.conf</code> <br> <br>  6. рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рд╣рдорд╛рд░рд╛ рдкреНрд░реЙрдХреНрд╕реА рдЕрдм рдХреНрдпрд╛ рд╕реБрди рд░рд╣рд╛ рд╣реИ <br> <code>root@debian9:~# netstat -nlp <br></code> <br><br><div class="spoiler">  <b class="spoiler_title">netstat рд▓реЙрдЧ</b> <div class="spoiler_text">  рд╕рдХреНрд░рд┐рдп рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди (рдХреЗрд╡рд▓ рд╕рд░реНрд╡рд░) <br>  рдкреНрд░реЛрдЯреЛ рд░рд┐рдХрд╡-рдХреНрдпреВ рд╕реЗрдВрдб-рдХреНрдпреВ рд▓реЛрдХрд▓ рдПрдбреНрд░реЗрд╕ рдлреЙрд░реЗрди рдПрдбреНрд░реЗрд╕ рд╕реНрдЯреЗрдЯ рдкреАрдЖрдИрдбреА тАЛтАЛ/ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдирд╛рдо <br>  tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 349 / sshd <br>  tcp 0 0 0.0.0.0:888 0.0.0.0:* LISTEN 354 / 3proxy <br>  tcp6 0 0 ::: 22 ::: * LISTEN 349 / sshd <br>  udp 0 0 0.0.0.0:53 0.0.0.0:* 354 / 3proxy <br>  udp 0 0 0.0.0.0:68 0.0.0.0:* 367 / dhclient <br></div></div><br>  7. рдЕрдм рдкреНрд░реЙрдХреНрд╕реА рдХрд┐рд╕реА рднреА рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рди рдХреЛ рдкреЛрд░реНрдЯ 888, DNS рдкрд░ рдкреЛрд░реНрдЯ 53 рдкрд░ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИ, рддрд╛рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдлрд┐рд░ рд░рд┐рдореЛрдЯ рдореЛрдЬреЗ 5 - Google рдкреНрд░реЙрдХреНрд╕реА рдФрд░ DNS 8.8.8.8 рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред  рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрддреЗ рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреЗрдЯрдлрд┐рд▓реНрдЯрд░ (iptables) рдФрд░ рдбреАрдПрдЪрд╕реАрдкреА рдирд┐рдпрдореЛрдВ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рд╣рддрд╛ рд╣реИред <br><br>  8. iptables-persistent рдкреИрдХреЗрдЬ рдФрд░ dhcpd рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ <br><br> <code>root@debian9:~# apt-get install iptables-persistent isc-dhcp-server</code> <br> <br>  9. dhcpd рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ <br> <code>root@debian9:~# nano /etc/dhcp/dhcpd.conf</code> <br> <br><div class="spoiler">  <b class="spoiler_title">dhcpd.conf</b> <div class="spoiler_text">  # dhcpd.conf <br>  # <br>  # ISC dhcpd рдХреЗ рд▓рд┐рдП рдирдореВрдирд╛ рд╡рд┐рдиреНрдпрд╛рд╕ рдлрд╛рдЗрд▓ <br>  # <br><br>  # рд╡рд┐рдХрд▓реНрдк рд╕рднреА рд╕рдорд░реНрдерд┐рдд рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд▓рд┐рдП рдЖрдо рд╣реИ ... <br>  рд╡рд┐рдХрд▓реНрдк рдбреЛрдореЗрди-рдирд╛рдо "example.org"; <br>  рд╡рд┐рдХрд▓реНрдк рдбреЛрдореЗрди-рдирд╛рдо-рд╕рд░реНрд╡рд░ ns1.example.org, ns2.example.org; <br><br>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ-рд▓реАрдЬ-рдЯрд╛рдЗрдо 600; <br>  рдЕрдзрд┐рдХрддрдо-рдкрдЯреНрдЯрд╛-рд╕рдордп 7200; <br><br>  ddns-update-style рдХреЛрдИ рдирд╣реАрдВ; <br><br>  # рдпрджрд┐ рдпрд╣ рдбреАрдПрдЪрд╕реАрдкреА рд╕рд░реНрд╡рд░ рд╕реНрдерд╛рдиреАрдп рдХреЗ рд▓рд┐рдП рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдбреАрдПрдЪрд╕реАрдкреА рд╕рд░реНрд╡рд░ рд╣реИ <br>  # рдиреЗрдЯрд╡рд░реНрдХ, рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдирд┐рд░реНрджреЗрд╢ рдХреЛ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рдЖрдзрд┐рдХрд╛рд░рд┐рдХ; <br><br>  # рдПрдХ рдЖрдВрддрд░рд┐рдХ рд╕рдмрдиреЗрдЯ рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рд╡рд┐рдиреНрдпрд╛рд╕ред <br>  рд╕рдмрдиреЗрдЯ 192.168.201.0 рдиреЗрдЯрдорд╛рд╕реНрдХ 255.255.255.0 { <br>  рд░реЗрдВрдЬ 192.168.201.10 192.168.201.250; <br>  рд╡рд┐рдХрд▓реНрдк рдбреЛрдореЗрди-рдирд╛рдо-рд╕рд░реНрд╡рд░ 192.168.201.254; <br>  рд╡рд┐рдХрд▓реНрдк рд░рд╛рдЙрдЯрд░ 192.168.201.254; <br>  рд╡рд┐рдХрд▓реНрдк рдкреНрд░рд╕рд╛рд░рдг-рдкрддрд╛ 192.168.201.255; <br>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ-рд▓реАрдЬ-рдЯрд╛рдЗрдо 600; <br>  рдЕрдзрд┐рдХрддрдо-рдкрдЯреНрдЯрд╛-рд╕рдордп 7200; <br>  } <br></div></div><br>  11. рдкреЛрд░реНрдЯ 67 рдкрд░ рд╕реЗрд╡рд╛ рдХреЛ рд░рд┐рдмреВрдЯ рдФрд░ рдЬрд╛рдВрдЪреЗрдВ <br> <code>root@debian9:~# reboot <br> root@debian9:~# netstat -nlp</code> <br> <br><div class="spoiler">  <b class="spoiler_title">netstat рд▓реЙрдЧ</b> <div class="spoiler_text">  рд╕рдХреНрд░рд┐рдп рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди (рдХреЗрд╡рд▓ рд╕рд░реНрд╡рд░) <br>  рдкреНрд░реЛрдЯреЛ рд░рд┐рдХрд╡-рдХреНрдпреВ рд╕реЗрдВрдб-рдХреНрдпреВ рд▓реЛрдХрд▓ рдПрдбреНрд░реЗрд╕ рдлреЙрд░реЗрди рдПрдбреНрд░реЗрд╕ рд╕реНрдЯреЗрдЯ рдкреАрдЖрдИрдбреА тАЛтАЛ/ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдирд╛рдо <br>  tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 389 / sshd <br>  tcp 0 0 0.0.0.0:888 0.0.0.0:* LISTEN 310 / 3proxy <br>  tcp6 0 0 :: 22 ::: * LISTEN 389 / sshd <br>  udp 0 0 0.0.0.0:20364 0.0.0.0:* 393 / dhcpd <br>  udp 0 0 0.0.0.0:53 0.0.0.0:* 310 / 3proxy <br>  udp 0 0 0.0.0.0:67 0.0.0.0:* 393 / dhcpd <br>  udp 0 0 0.0.0.0:68 0.0.0.0:* 405 / dhclient <br>  udp6 0 0 ::: 31728 ::: * 393 / dhcpd <br>  рдХрдЪреНрдЪрд╛ 0 0 0.0.0.0:1 0.0.0.0:* 393 / dhcpd <br><br></div></div><br>  12. рдпрд╣ 888 рдкреЛрд░реНрдЯ рдФрд░ iptables рдореЗрдВ рдирд┐рдпрдо рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА tcp рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╣реБрдЖ рд╣реИ <br><br> <code>root@debian9:~# iptables -t nat -A PREROUTING -s 192.168.201.0/24 -p tcp -j REDIRECT --to-ports 888</code> <br> <br> <code>root@debian9:~# iptables-save &gt; /etc/iptables/rules.v4</code> <br> <br>  13. рдЪреИрдирд▓ рдмреИрдВрдбрд╡рд┐рдбреНрде рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ рдмрд╛рд░ рдореЗрдВ рдХрдИ рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдХреБрд▓ рд░рд╛рд╢рд┐ 1000 рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рдирдП рдХрдиреЗрдХреНрд╢рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП 0.2, 0.2, 0.2, 0.2, 0.1, 0.1 рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред <br><br>  рдиреЛрдЯ: рдЕрдЧрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╡реЗрдм рдкреНрд░реЙрдХреНрд╕реА рд╣реИ, рддреЛ рдореЛрдЬреЗ 5 рдХреЗ рдмрдЬрд╛рдп рдЖрдкрдХреЛ рдХрдиреЗрдХреНрдЯ рд▓рд┐рдЦрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рдЕрдЧрд░ рдореЛрдЬрд╝реЗ 4, рддреЛ рдореЛрдЬрд╝реЗ 4 (рдореЛрдЬрд╝реЗ 4 рдХреЛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рд▓реЙрдЧрд┐рди / рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрд╡рдЪрд╛рд▓рди!) <br><br><div class="spoiler">  <b class="spoiler_title">рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЙрджрд╛рд╣рд░рдг # 2</b> <div class="spoiler_text">  рдбреЗрдореЙрди <br>  pidfile /home/joke/proxy/3proxy.pid <br>  nserver 8.8.8.8 <br>  nscache 65536 <br>  рдЕрдзрд┐рдХрддрдо 500 <br>  рдЯрд╛рдЗрдордЖрдЙрдЯ 1 5 30 60 180 1800 16 60 <br>  log /home/joke/proxy/logs/3proxy.log рдбреА <br>  logformat "- + _L% tред%ред% Nред% p% E% U% C:% c% R:% r% O% I% h% T" <br>  рдШреБрдорд╛рдПрдБ рей <br>  рд▓рд╛рд▓рд┐рдорд╛ <br>  рдЖрдИрдлрд╝реЛрди <br>  dnspr <br>  рдЕрдиреБрдорддрд┐ * <br><br>  рдорд╛рддрд╛-рдкрд┐рддрд╛ 200 рдореЛрдЬрд╝реЗ IP_EXT_EXT_PROXY # 1 3128 рдкрд░реАрдХреНрд╖рдХ 1234 <br>  рдорд╛рддрд╛-рдкрд┐рддрд╛ 200 рдореЛрдЬрд╝реЗ IP_EXT_EXT_PROXY # 2 3128 рдкрд░реАрдХреНрд╖рдХ 1234 <br>  рдорд╛рддрд╛-рдкрд┐рддрд╛ 200 рдореЛрдЬрд╝реЗ IP_EXT_EXT_PROXY # 3 3128 рдкрд░реАрдХреНрд╖рдХ 1234 <br>  рдорд╛рддрд╛-рдкрд┐рддрд╛ 200 рдореЛрдЬреЗ 5 IP_EXT_EXT_PROXY # 4 3128 рдкрд░реАрдХреНрд╖рдХ 1234 <br>  рдорд╛рддрд╛-рдкрд┐рддрд╛ 100 рдореЛрдЬрд╝реЗ IP_EXT_EXT_PROXY # 5 3128 рдкрд░реАрдХреНрд╖рдХ 1234 <br>  рдорд╛рддрд╛-рдкрд┐рддрд╛ 100 рдореЛрдЬрд╝реЗ IP_EXT_EXT_PROXY # 6 3128 рдкрд░реАрдХреНрд╖рдХ 1234 <br><br>  plugin /opt/proxy/3proxy-0.8.12/src/TransparentPlugin.ld.so рдкрд╛рд░рджрд░реНрд╢реА_рдкреНрд▓рдЧрд┐рди <br>  tcppm -i0.0.0.0 888 127.0.0.1 11111 <br></div></div><br><h3>  рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ рдФрд░ NAT + рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЪрд▓рд╛рдПрдВ </h3><br>  рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, рд╣рдо рд╕рд╛рдорд╛рдиреНрдп рдПрдирдПрдЯреА рддрдВрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкрддреЗ рдпрд╛ рд╕рдмрдиреЗрдЯ рдХреЗ рдЪрдпрдирд╛рддреНрдордХ рдпрд╛ рдкреВрд░реНрдг рдкрд╛рд░рджрд░реНрд╢реА рд╕рдореАрдкрддрд╛ рдХреЗ рд╕рд╛рде рдХрд░реЗрдВрдЧреЗред  рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреБрдЫ рд╕реЗрд╡рд╛рдУрдВ / рд╕рдмрдиреЗрдЯреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВрдЧреЗ, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдПрд╣рд╕рд╛рд╕ рднреА рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдХрд┐ рд╡реЗ рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред  рд╕рднреА https рдХрдиреЗрдХреНрд╢рди рдареАрдХ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдХреЛрдИ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдЙрддреНрдкрдиреНрди / рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рддрдп рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдХреМрди рд╕реА рд╕рдмрдиреЗрдЯ / рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдкреНрд░реЙрдХреНрд╕реА рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рдмрд╛рд╣рд░реА рдкрд░рджреЗ рдХреЗ рдкреАрдЫреЗ рд╕реНрдерд┐рдд рд╣реИрдВ рдЬрд╣рд╛рдБ pandora.com рдЬреИрд╕реА рд╕реЗрд╡рд╛ рдЪрд▓ рд░рд╣реА рд╣реИред  рдЕрдм рдпрд╣ рдЕрдкрдирд╛ рд╕рдмрдиреЗрдЯ / рдкрддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╣реБрдЖ рд╣реИред <br><br>  1. рдкрд┐рдВрдЧ <br><br> <code>root@debian9:~# ping pandora.com</code> <br>  рдкрд┐рдВрдЧ pandora.com (208.85.40.20) 56 (84) рдбреЗрдЯрд╛ рдХрд╛ рдмрд╛рдЗрдЯреНрд╕ред <br><br>  2. рд╣рдо Google BGP 208.85.40.20 рдореЗрдВ рдЯрд╛рдЗрдк рдХрд░рддреЗ рд╣реИрдВ <br><br>  рд╡реЗрдмрд╕рд╛рдЗрдЯ <a href="">bgp.he.net/net/208.85.40.0/24#_netinfo рдкрд░ рдЬрд╛рдПрдВ</a> <br>  рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдореИрдВ рд╕рдмрдиреЗрдЯ рдХреЗ рд▓рд┐рдП рджреЗрдЦ рд░рд╣рд╛ рд╣реВрдБ AS40428 рдкреЗрдВрдбреЛрд░рд╛ рдореАрдбрд┐рдпрд╛, рдЗрдВрдХ <br><br>  <a href="">bgp.he.net/net/208.85.40.0/24#_netinfo</a> <br><br>  V4 рдЙрдкрд╕рд░реНрдЧ рдЦреЛрд▓реЗрдВ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">bgp.he.net/AS40428#_prefixes</a> <br><br>  рдпрд╣рд╛рдБ рд╡рд╛рдВрдЫрд┐рдд рд╕рдмрдиреЗрдЯ рд╣реИрдВ! <br><br>  199.116.161.0/24 <br>  199.116.162.0/24 <br>  199.116.164.0/23 <br>  199.116.164.0/24 <br>  199.116.165.0/24 <br>  208.85.40.0/24 <br>  208.85.41.0/24 <br>  208.85.42.0/23 <br>  208.85.42.0/24 <br>  208.85.43.0/24 <br>  208.85.44.0/24 <br>  208.85.46.0/23 <br>  208.85.46.0/24 <br>  208.85.47.0/24 <br><br>  3. рд╕рдмрдиреЗрдЯ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХрддреНрд░реАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Ip-calculator.ru/aggregate рдкрд░</a> рдЬрд╛рдПрдВ рдФрд░ рд╡рд╣рд╛рдВ рд╣рдорд╛рд░реА рд╕реВрдЪреА рдХреЙрдкреА рдХрд░реЗрдВред  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк - 14 рдХреЗ рдмрдЬрд╛рдп 6 рд╕рдмрдиреЗрдЯред <br><br>  199.116.161.0/24 <br>  199.116.162.0/24 <br>  199.116.164.0/23 <br>  208.85.40.0/22 <br>  208.85.44.0/24 <br>  208.85.46.0/23 <br><br>  4. рд╕реНрдкрд╖реНрдЯ iptables рдирд┐рдпрдо <br><br> <code>root@debian9:~# iptables -F <br> root@debian9:~# iptables -X <br> root@debian9:~# iptables -t nat -F <br> root@debian9:~# iptables -t nat -X</code> <br> <br>  рдЖрдЧреЗ рдФрд░ NAT рд╕рдХреНрд╖рдо рдХрд░реЗрдВ <br><br> <code>root@debian9:~# echo 1 &gt; /proc/sys/net/ipv4/ip_forward <br> root@debian9:~# iptables -A FORWARD -i enp0s3 -o enp0s8 -j ACCEPT <br> root@debian9:~# iptables -A FORWARD -i enp0s8 -o enp0s3 -j ACCEPT <br> root@debian9:~# iptables -t nat -A POSTROUTING -o enp0s3 -s 192.168.201.0/24 -j MASQUERADE</code> <br> <br>  рддрд╛рдХрд┐ рд░рд┐рдмреВрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдлреЙрд░рд╡рд░реНрдб рд╣рдореЗрд╢рд╛ рдлрд╛рдЗрд▓ рдХреЛ рдмрджрд▓реЗ <br><br> <code>root@debian9:~# nano /etc/sysctl.conf</code> <br> <br>  рдФрд░ рд▓рд╛рдЗрди рдХреЛ рдЕрдирдлреЙрд▓реЛ рдХрд░ рджреЗрдВ <br><br>  net.ipv4.ip_forward = 1 <br><br>  рдлрд╝рд╛рдЗрд▓ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП Ctrl + X <br><br>  5. рд╣рдо рдкреНрд░реЙрдХреНрд╕реА рдореЗрдВ pandora.com рд╕рдмрдиреЗрдЯ рдХреЛ рд▓рдкреЗрдЯрддреЗ рд╣реИрдВ <br><br> <code>root@debian9:~# iptables -t nat -A PREROUTING -s 192.168.201.0/24 -d 199.116.161.0/24,199.116.162.0/24,199.116.164.0/23,208.85.40.0/22,208.85.44.0/24,208.85.46.0/23 -p tcp -j REDIRECT --to-ports 888</code> <br> <br>  6. рдирд┐рдпрдореЛрдВ рдХреЛ рдмрдЪрд╛рдПрдВ <br><br> <code>root@debian9:~# iptables-save &gt; /etc/iptables/rules.v4</code> <br> <br><h3>  рд░рд╛рдЙрдЯрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ рдФрд░ рдЪрд▓рд╛рдПрдВ </h3><br>  рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, рдкрд╛рд░рджрд░реНрд╢реА рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рдПрдХ рдЕрд▓рдЧ рдкреАрд╕реА рдпрд╛ рдШрд░ / рдХреЙрд░реНрдкреЛрд░реЗрдЯ рд░рд╛рдЙрдЯрд░ рдХреЗ рдкреАрдЫреЗ рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдпрд╣ рд░рд╛рдЙрдЯрд░ рдпрд╛ рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рд╕реНрдерд┐рд░ рдорд╛рд░реНрдЧреЛрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ рдФрд░ рд╕рдВрдкреВрд░реНрдг рд╕рдмрдиреЗрдЯ рдХрд┐рд╕реА рднреА рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ рдкреНрд░реЙрдХреНрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред <br><br>  рдорд╣рддреНрд╡рдкреВрд░реНрдг!  рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рдкреНрд░рд╡реЗрд╢ рджреНрд╡рд╛рд░ рдХреЛ рд░рд╛рдЙрдЯрд░ рд╕реЗ рдПрдХ рд╕реНрдерд┐рд░ рдЖрдИрдкреА рдкреНрд░рд╛рдкреНрдд рд╣реЛ, рдпрд╛ рд╕реНрд╡рдпрдВ рд╕реНрдерд┐рд░ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдПред <br><br>  1. рдПрдХ рд╕реНрдерд┐рд░ рдЧреЗрдЯрд╡реЗ рдкрддрд╛ (enp0s3 рдПрдбрд╛рдкреНрдЯрд░) рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ <br><br> <code>root@debian9:~# nano /etc/network/interfaces</code> <br> <br><div class="spoiler">  <b class="spoiler_title">/ etc / рдиреЗрдЯрд╡рд░реНрдХ / рдЗрдВрдЯрд░рдлреЗрд╕ рдлрд╝рд╛рдЗрд▓</b> <div class="spoiler_text">  # рдпрд╣ рдлрд╝рд╛рдЗрд▓ рдЖрдкрдХреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЙрдкрд▓рдмреНрдз рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреА рд╣реИ <br>  # рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рдПред  рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдЗрдВрдЯрд░рдлреЗрд╕ (5) рджреЗрдЦреЗрдВред <br><br>  рд╕реНрд░реЛрдд /etc/network/interfaces.d/* <br><br>  # рд▓реВрдкрдмреИрдХ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ <br>  рдСрдЯреЛ рд▓реЛ <br>  iface рд▓реЛ рдЗрдирд╕реЗрдЯ рд▓реВрдкрдмреИрдХ <br><br>  # рдкреНрд░рд╛рдердорд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ <br>  allow-hotplug enp0s3 <br>  iface enp0s3 рдЗрдирд╕реЗрдЯ рд╕реНрдерд┐рд░ <br>  рдкрддрд╛ 192.168.23.2 <br>  netmask 255.255.255.0 <br>  рдЧреЗрдЯрд╡реЗ 192.168.23.254 <br><br>  # рдорд╛рдзреНрдпрдорд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ <br>  allow-hotplug enp0s8 <br>  iface enp0s8 рдЗрдирд╕реЗрдЯ рд╕реНрдерд┐рд░ <br>  рдкрддрд╛ 192.168.201.254 <br>  netmask 255.255.255.0 <br></div></div><br>  2. рдкреНрд░реЙрдХреНрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 192.168.23.0/24 рд╕рдмрдиреЗрдЯ рд╕реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдВ <br><br> <code>root@debian9:~# iptables -t nat -A PREROUTING -s 192.168.23.0/24 -d 199.116.161.0/24,199.116.162.0/24,199.116.164.0/23,208.85.40.0/22,208.85.44.0/24,208.85.46.0/23 -p tcp -j REDIRECT --to-ports 888</code> <br> <br>  3. рдирд┐рдпрдореЛрдВ рдХреЛ рдмрдЪрд╛рдПрдВ <br> <code>root@debian9:~# iptables-save &gt; /etc/iptables/rules.v4</code> <br> <br>  4. рд╣рдо рд░рд╛рдЙрдЯрд░ рдкрд░ рд╕рдмрдиреЗрдЯ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВрдЧреЗ <br><br><div class="spoiler">  <b class="spoiler_title">рд░рд╛рдЙрдЯрд░ рдиреЗрдЯрд╡рд░реНрдХ рд╕реВрдЪреА</b> <div class="spoiler_text">  199.116.161.0 255.255.255.0 192.168.23.2 <br>  199.116.162.0 255.255.255.0 192.168.23.2 <br>  199.116.164.0 255.255.254.0 192.168.23.2 <br>  208.85.40.0 255.255.252.0 192.168.23.2 <br>  208.85.44.0 255.255.255.0 192.168.23.2 <br>  208.85.46.0 255.255.254.0 192.168.23.2 <br></div></div><br><h3>  рдкреНрд░рдпреБрдХреНрдд рд╕рд╛рдордЧреНрд░реА / рд╕рдВрд╕рд╛рдзрди </h3><br>  1. 3proxy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">3proxy.ru рдХрд╛рд░реНрдпрдХреНрд░рдо</a> рдХреА рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╡реЗрдмрд╕рд╛рдЗрдЯ <br><br>  2. рд╕реНрд░реЛрдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">www.ekzorchik.ru/2015/02/how-to-take-your-socks-proxy</a> рд╕реЗ 3proxy рдХреЗ рд▓рд┐рдП рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдирд┐рд░реНрджреЗрд╢ <br><br>  3. github рдкрд░ 3proxy рдбреЗрд╡рд▓рдкрд░ рд╢рд╛рдЦрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">github.com/z3APA3A/3proxy/issues/274</a> <br><br></div></div></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi460469/">https://habr.com/ru/post/hi460469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi460459/index.html">рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ htaccess</a></li>
<li><a href="../hi460461/index.html">рд╕реБрд░рдХреНрд╖рд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЗ рд░реВрдк рдореЗрдВ рд▓рдХреНрд╖рд┐рдд рд╣рдорд▓реЛрдВ рдХрд╛ рдЕрдиреБрдХрд░рдгред рд░реЗрдб рдЯреАрдорд┐рдВрдЧ рд╕рд╛рдЗрдмрд░ рдирд┐рд░реНрджреЗрд╢</a></li>
<li><a href="../hi460463/index.html">GALILEO - GNSS рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдХреНрдпрд╛ рд╣реБрдЖ</a></li>
<li><a href="../hi460465/index.html">рдбрд┐рдЬрд┐рдЯрд▓ рдЫрд╛рдпрд╛ - рдбрд┐рдЬрд┐рдЯрд▓ рд░реВрдк рд╕реЗ рдбрд┐рдЬрд┐рдЯрд▓ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi460467/index.html">рд╣рдо рдзреНрд╡рдирд┐ рджреНрд╡рд╛рд░рд╛ рдХрд╛рд░ рдореЗрдВ рдПрдХ рдЯреВрдЯрдиреЗ рдХреА рддрд▓рд╛рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВ: рд╣рдо рдЗрдВрдЬрди рдореЗрдВ рд╡рд┐рд╕рдВрдЧрддрд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЫреЛрдЯреА рд╕реА рдорд╢реАрди рдкрд░ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВред</a></li>
<li><a href="../hi460471/index.html">рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдкреИрдирд▓ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдпрд╛ рд▓рд╛рд░рд╡реЗрд▓ рдЖрд░реНрдХрд┐рдб рд╡рд┐рдХрд╛рд╕ рдЕрдиреБрднрд╡</a></li>
<li><a href="../hi460473/index.html">рд╕рдлреЗрдж рд╢реЛрд░ рдПрдХ рдХрд╛рд▓реЗ рд╡рд░реНрдЧ рдХреЛ рдЦреАрдВрдЪрддрд╛ рд╣реИ</a></li>
<li><a href="../hi460475/index.html">рд░рд┐рдореЛрдЯ рдХрдВрдЯреНрд░реЛрд▓ рдореЛрдмрд╛рдЗрд▓ Lifebuoy</a></li>
<li><a href="../hi460479/index.html">рдФрд░ рдЯреЗрдбреА рдмрд┐рдпрд░ рднрд╛рд░реА рднрд░рдХрдо рд▓рдЧрддрд╛ рд╣реИ</a></li>
<li><a href="../hi460481/index.html">рдлреИрдирд▓реЗрд╕ рдкреНрд░рджрд░реНрд╢рди рдХрдВрдкреНрдпреВрдЯрд░ MIC-7000</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>