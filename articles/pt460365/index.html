<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•¶ üò£ ‚úãüèª Rastreio distribu√≠do: fizemos tudo errado üë®üèæ‚Äçüíº üöΩ üëáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev. : O autor deste material √© Cindy Sridharan, engenheira da imgix que est√° envolvida no desenvolvimento de APIs e, em particular, no teste d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rastreio distribu√≠do: fizemos tudo errado</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/460365/">  <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: O autor deste material √© Cindy Sridharan, engenheira da imgix que est√° envolvida no desenvolvimento de APIs e, em particular, no teste de microsservi√ßos.</i>  <i>Neste artigo, ela compartilha sua vis√£o detalhada dos problemas reais no campo do rastreamento distribu√≠do, onde, em sua opini√£o, h√° uma falta de ferramentas realmente eficazes para resolver problemas prementes.</i> <br><br><img src="https://habrastorage.org/webt/zu/va/og/zuvaogffo6d3gqi1mmzq5ts3zoc.png"><br>  <i>[A ilustra√ß√£o √© emprestada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">outro material</a> sobre rastreamento distribu√≠do.]</i> <br><br>  Acredita-se que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rastreamento distribu√≠do seja</a> dif√≠cil de implementar e o retorno sobre ele <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">seja duvidoso</a> .  O "problema" do rastreamento √© explicado por v√°rios motivos, geralmente referindo-se √† complexidade de configurar cada componente do sistema para transmitir os cabe√ßalhos correspondentes, juntamente com cada solicita√ß√£o.  Embora esse problema ocorra, ele n√£o pode ser chamado de intranspon√≠vel.  A prop√≥sito, n√£o explica por que os desenvolvedores realmente n√£o gostam de rastrear (mesmo que j√° estejam funcionando). <a name="habracut"></a><br><br>  A principal dificuldade do rastreamento distribu√≠do n√£o √© coletar dados, n√£o padronizar os formatos de distribui√ß√£o e apresenta√ß√£o dos resultados e n√£o determinar quando, onde e como fazer a amostra.  N√£o estou tentando apresentar esses "problemas de digestibilidade" como <i>triviais</i> - na verdade, existem desafios t√©cnicos e (se realmente estamos olhando para os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">padr√µes e protocolos de</a> c√≥digo aberto) bastante pol√≠ticos que devem ser superados para que esses problemas possam ser considerados resolvido. <br><br>  No entanto, se voc√™ imaginar que todos esses problemas foram resolvidos, √© prov√°vel que nada mude significativamente em termos de <i>experi√™ncia do usu√°rio final</i> .  O rastreamento ainda pode n√£o ser pr√°tico nos cen√°rios de depura√ß√£o mais comuns - mesmo ap√≥s a implanta√ß√£o. <br><br><h2>  Um tra√ßo t√£o diferente </h2><br>  O rastreamento distribu√≠do inclui v√°rios componentes diferentes: <br><br><ul><li>  equipar aplicativos e middleware com controles; </li><li>  Transmiss√£o de contexto distribu√≠do </li><li>  cole√ß√£o de tra√ßos; </li><li>  armazenamento de vest√≠gios; </li><li>  sua extra√ß√£o e visualiza√ß√£o. </li></ul><br>  Muita conversa sobre rastreamento distribu√≠do se resume a consider√°-lo como um tipo de opera√ß√£o un√°ria, cujo √∫nico objetivo √© ajudar no diagn√≥stico completo do sistema.  Isso se deve em grande parte √† maneira como o conceito de rastreamento distribu√≠do foi formado.  Em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um post</a> feito quando as fontes Zipkin foram abertas, foi mencionado que <i>ele [Zipkin] torna o Twitter mais r√°pido</i> .  As primeiras ofertas comerciais para rastreamento tamb√©m foram promovidas como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramentas de APM</a> . <br><br>  <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: Para que o texto adicional seja melhor compreendido, definimos dois termos b√°sicos de acordo com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o do projeto OpenTracing</a> :</i> <br><br><ul><li>  <i><b>Extens√£o</b> - o elemento b√°sico do rastreamento distribu√≠do.</i>  <i>√â uma descri√ß√£o de um determinado fluxo de trabalho (por exemplo, uma consulta ao banco de dados) com um nome, hor√°rio de in√≠cio e t√©rmino, tags, logs e contexto.</i> </li><li>  <i>As extens√µes geralmente cont√™m links para outras extens√µes, o que permite combinar v√°rias extens√µes no <b>Rastreio</b> - uma visualiza√ß√£o da vida √∫til de uma solicita√ß√£o √† medida que ela se move por um sistema distribu√≠do.</i> </li></ul><br>  O Trace'y cont√©m dados incrivelmente valiosos que podem ajudar em tarefas como: teste na produ√ß√£o, realiza√ß√£o de testes de recupera√ß√£o de desastres, teste com a introdu√ß√£o de erros etc.  De fato, algumas empresas j√° usam o rastreamento para esses fins.  Para come√ßar, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a transfer√™ncia de contexto universal</a> tem outros usos, al√©m de simplesmente transferir extens√µes para o sistema de armazenamento: <br><br><ul><li>  Por exemplo, o Uber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usa</a> resultados de rastreamento para distinguir entre o tr√°fego de teste e o tr√°fego de produ√ß√£o. </li><li>  O Facebook <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usa</a> dados de rastreamento para analisar o caminho cr√≠tico e alternar o tr√°fego durante testes regulares de recupera√ß√£o de desastres. </li><li>  A rede social tamb√©m <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usa</a> blocos de anota√ß√µes Jupyter, que permitem que os desenvolvedores executem consultas arbitr√°rias nos resultados do rastreamento. </li><li>  Os adeptos da inje√ß√£o de falha controlada por linhagem ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LDFI)</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usam</a> rastreamentos distribu√≠dos para teste de erro. </li></ul><br>  Nenhuma das op√ß√µes acima se refere inteiramente ao cen√°rio de <i>depura√ß√£o</i> , durante o qual o engenheiro tenta resolver o problema observando o rastreamento. <br><br>  Quando se trata do cen√°rio de depura√ß√£o, o diagrama de <i>rastreamento de rastreamento</i> continua sendo a interface principal (embora alguns tamb√©m o chamem de <i>"gr√°fico de Gantt"</i> ou <i>"diagrama em cascata"</i> ).  Por <i>visualiza√ß√£o em rastreamento,</i> quero <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dizer</a> todos os intervalos e metadados associados que juntos formam o rastreamento.  Cada sistema de rastreamento de c√≥digo aberto, bem como cada solu√ß√£o comercial de rastreamento, oferece uma interface de usu√°rio baseada em <i>traceview</i> para visualizar, detalhar e filtrar dados de rastreamento. <br><br>  O problema com todos os sistemas de rastreamento com os quais estou familiarizado no momento √© que a <i>visualiza√ß√£o</i> final <i>(visualiza√ß√£o em rastreamento)</i> reflete quase completamente os recursos do processo de gera√ß√£o de rastreamento.  Mesmo quando visualiza√ß√µes alternativas s√£o oferecidas: mapas de intensidade (mapa de calor), topologias de servi√ßo, histogramas de lat√™ncia - no final, eles ainda se <i>resumem</i> √† <i>visualiza√ß√£o</i> em <i>rastreamento</i> . <br><br>  No passado, eu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reclamei</a> que a maioria das ‚Äúinova√ß√µes‚Äù na rastreabilidade em rela√ß√£o √† interface do usu√°rio / UX parece <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estar</a> limitada a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">incluir</a> metadados adicionais no rastreamento, incorporar informa√ß√µes com <i>alta cardinalidade</i> neles ou fornecer a capacidade de detalhar detalhes em extens√µes espec√≠ficas ou executar consultas <i>entre e intra-rastreamento</i> .  Nesse caso, a <i>traceview</i> continua sendo o principal meio de visualiza√ß√£o.  Enquanto esse estado de coisas persistir, o rastreamento distribu√≠do (na melhor das hip√≥teses) ocupar√° o 4¬∫ lugar como ferramenta de depura√ß√£o, seguido por m√©tricas, logs e rastreios de pilha, e na pior das hip√≥teses, ser√° um desperd√≠cio de dinheiro e tempo. <br><br><h2>  Problema com o rastreamento </h2><br>  O objetivo da <i>traceview</i> √© fornecer uma imagem completa do movimento de uma solicita√ß√£o individual em todos os componentes de um sistema distribu√≠do ao qual ela se relaciona.  Alguns sistemas de rastreamento mais avan√ßados permitem que voc√™ fa√ßa drill down em intervalos individuais e visualize a divis√£o do tempo <i>em um</i> √∫nico processo (quando os intervalos t√™m limites funcionais). <br><br>  A premissa b√°sica da arquitetura de microsservi√ßos √© a ideia de que a estrutura organizacional cresce com as necessidades da empresa.  Os defensores dos microsservi√ßos argumentam que a distribui√ß√£o de v√°rias tarefas de neg√≥cios em servi√ßos separados permite que equipes de desenvolvimento aut√¥nomas pequenas controlem todo o ciclo de vida desses servi√ßos, permitindo que eles criem, testem e implantem esses servi√ßos independentemente.  No entanto, a desvantagem dessa distribui√ß√£o √© a perda de informa√ß√µes sobre como cada servi√ßo interage com outros.  Em tais circunst√¢ncias, o rastreamento distribu√≠do afirma ser uma ferramenta indispens√°vel para <i>depurar</i> intera√ß√µes complexas entre servi√ßos. <br><br>  Se voc√™ tem um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sistema distribu√≠do</a> verdadeiramente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">incrivelmente complexo</a> , ningu√©m consegue ter em mente sua imagem <i>completa</i> .  De fato, o desenvolvimento de uma ferramenta baseada na suposi√ß√£o de que geralmente √© poss√≠vel √© um pouco antipadr√£o (abordagem ineficiente e improdutiva).  Idealmente, a depura√ß√£o requer uma ferramenta para ajudar a <i>restringir sua pesquisa,</i> para que os engenheiros possam se concentrar em um subconjunto das dimens√µes (servi√ßos / usu√°rios / hosts, etc.) relevantes para o cen√°rio em quest√£o.  Ao determinar a causa da falha, os engenheiros n√£o precisam entender o que aconteceu em <i>todos os servi√ßos de uma s√≥ vez</i> , pois esse requisito contradiz a pr√≥pria id√©ia de uma arquitetura de microsservi√ßo. <br><br>  No entanto, a traceview √© <i>exatamente</i> isso.  Sim, alguns sistemas de rastreamento oferecem visualiza√ß√µes de rastreamento compactadas quando o n√∫mero de extens√µes no rastreamento √© t√£o grande que n√£o podem ser exibidas em uma √∫nica visualiza√ß√£o.  No entanto, devido √† grande quantidade de informa√ß√µes contidas mesmo em uma visualiza√ß√£o t√£o truncada, os engenheiros ainda s√£o <i>for√ßados a</i> analis√°-la, restringindo manualmente a sele√ß√£o a um conjunto de fontes de servi√ßo de problemas.  Infelizmente, neste campo, as m√°quinas s√£o muito mais r√°pidas que os humanos, menos propensas a erros e seus resultados s√£o mais repet√≠veis. <br><br>  Outra raz√£o pela qual acho que o m√©todo traceview est√° errado √© porque n√£o √© adequado para depura√ß√£o hipot√©tica.  Na sua ess√™ncia, a depura√ß√£o √© um processo <i>iterativo</i> que come√ßa com uma hip√≥tese, seguido pela verifica√ß√£o de v√°rias observa√ß√µes e fatos recebidos do sistema usando diferentes vetores, conclus√µes / generaliza√ß√µes e uma avalia√ß√£o mais aprofundada da verdade da hip√≥tese. <br><br>  A capacidade <i>de</i> testar hip√≥teses de maneira <i>r√°pida e barata</i> e melhorar o modelo mental de acordo √© a <i>pedra angular da</i> depura√ß√£o.  Qualquer ferramenta de depura√ß√£o deve ser <i>interativa</i> e restringir o espa√ßo de pesquisa ou, no caso de um rastreamento falso, permitir que o usu√°rio volte e se concentre em outra √°rea do sistema.  Uma ferramenta ideal far√° isso de forma <i>proativa</i> , chamando imediatamente a aten√ß√£o do usu√°rio para √°reas potencialmente problem√°ticas. <br><br>  Infelizmente, o <i>traceview</i> n√£o pode ser chamado de ferramenta de interface interativa.  O melhor que voc√™ pode esperar ao us√°-lo √© detectar uma certa fonte de maiores atrasos e visualizar todos os tipos de tags e logs associados a ele.  Isso n√£o ajuda o engenheiro a identificar <i>padr√µes</i> no tr√°fego, como as especificidades da distribui√ß√£o de atrasos, ou a detectar correla√ß√µes entre diferentes medidas.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A an√°lise de rastreamento gen√©rico</a> pode solucionar alguns desses problemas.  De fato, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">existem exemplos de</a> an√°lises bem-sucedidas usando o aprendizado de m√°quina para identificar extens√µes anormais e identificar um subconjunto de tags que podem estar associadas a um comportamento anormal.  No entanto, ainda n√£o encontrei visualiza√ß√µes convincentes de descobertas feitas usando aprendizado de m√°quina ou an√°lise de dados aplicadas a extens√µes que seriam significativamente diferentes da visualiza√ß√£o em traceview ou DAG (gr√°fico ac√≠clico direcional). <br><br><h3>  Os v√£os s√£o de n√≠vel muito baixo </h3><br>  O problema fundamental com a traceview √© que as <i>extens√µes</i> s√£o primitivas de n√≠vel muito baixo para an√°lise de lat√™ncia e an√°lise de causa raiz.  √â como analisar comandos individuais do processador na tentativa de eliminar uma exce√ß√£o, sabendo que existem ferramentas de n√≠vel superior, como o backtrace, que s√£o muito mais convenientes de se trabalhar. <br><br>  Al√©m disso, tomarei a liberdade de afirmar o seguinte: idealmente, n√£o precisamos de uma <i>imagem completa do</i> que aconteceu durante o ciclo de vida da solicita√ß√£o, que representam as ferramentas modernas de rastreamento.  Em vez disso, √© necess√°ria alguma forma de abstra√ß√£o de n√≠vel superior, contendo informa√ß√µes sobre o que <i>deu errado</i> (semelhante ao backtrace), al√©m de algum contexto.  Em vez de observar todo o tra√ßo, prefiro ver <i>parte</i> dele onde algo interessante ou incomum acontece.  Atualmente, a pesquisa √© realizada manualmente: o engenheiro recebe um rastreio e analisa de forma independente as extens√µes em busca de algo interessante.  A abordagem quando as pessoas olham para extens√µes em rastreamentos separados na esperan√ßa de detectar atividades suspeitas n√£o tem escala (especialmente quando elas precisam compreender todos os metadados codificados em extens√µes diferentes, como ID de extens√£o, nome do m√©todo RPC, dura√ß√£o da extens√£o 'a, logs, tags etc.). <br><br><h2>  Alternativas de Traceview </h2><br>  Os resultados do rastreamento s√£o mais √∫teis quando podem ser visualizados de forma a obter uma id√©ia n√£o trivial do que est√° acontecendo nas partes interconectadas do sistema.  At√© que este seja o caso, o processo de depura√ß√£o permanece bastante <i>inerte</i> e depende da capacidade do usu√°rio perceber as correla√ß√µes corretas, verificar as partes corretas do sistema ou montar partes do mosaico - ao contr√°rio da <i>ferramenta</i> que ajuda o usu√°rio a formular essas hip√≥teses. <br><br>  N√£o sou designer visual nem especialista em UX, mas na pr√≥xima se√ß√£o quero compartilhar algumas id√©ias sobre como essas visualiza√ß√µes podem parecer. <br><br><h3>  Foco em servi√ßos espec√≠ficos </h3><br>  Em um ambiente em que o setor est√° se consolidando em torno das id√©ias de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SLO (objetivos de n√≠vel de servi√ßo) e SLI (indicadores de n√≠vel de servi√ßo)</a> , parece razo√°vel que as equipes individuais primeiro monitorem a relev√¢ncia de seus servi√ßos para esses objetivos.  Daqui resulta que <i>a</i> visualiza√ß√£o <i>orientada a servi√ßos</i> √© mais adequada para essas equipes. <br><br>  Rastreios, especialmente sem amostragem, s√£o um reposit√≥rio de informa√ß√µes sobre cada componente de um sistema distribu√≠do.  Essas informa√ß√µes podem ser fornecidas a um manipulador complicado que fornecer√° descobertas orientadas a servi√ßos para os usu√°rios, que podem ser detectadas com anteced√™ncia - mesmo antes de o usu√°rio examinar os rastreamentos: <br><br><ol><li>  Atrasar os diagramas de distribui√ß√£o apenas para solicita√ß√µes fortemente diferenciadas <i>(solicita√ß√µes externas)</i> ; </li><li>  Atraso nos diagramas de distribui√ß√£o para os casos em que as metas de servi√ßo da SLO n√£o s√£o atingidas; </li><li>  As tags mais "comuns", "interessantes" e "estranhas" nas consultas, que s√£o mais frequentemente <i>repetidas</i> ; </li><li>  Detalhamento dos atrasos nos casos em que as <i>depend√™ncias de</i> servi√ßo n√£o atingem as metas SLO definidas; </li><li>  Reparti√ß√£o dos atrasos em v√°rios servi√ßos a jusante. </li></ol><br>  As m√©tricas internas simplesmente n√£o podem responder a algumas dessas perguntas, for√ßando os usu√°rios a estudarem cuidadosamente os per√≠odos.  Como resultado, temos um mecanismo extremamente hostil para o usu√°rio. <br><br>  Nesse sentido, surge a pergunta: e as intera√ß√µes complexas entre os v√°rios servi√ßos controlados por diferentes equipes?  A <i>traceview</i> n√£o √© considerada a ferramenta mais apropriada para cobrir essa situa√ß√£o? <br><br>  Desenvolvedores de dispositivos m√≥veis, propriet√°rios de servi√ßos sem estado, propriet√°rios de servi√ßos gerenciados com estado (como bancos de dados) e propriet√°rios de plataformas podem estar interessados ‚Äã‚Äãem outra <i>vis√£o de um</i> sistema distribu√≠do;  <i>o traceview</i> √© uma solu√ß√£o universal demais para essas necessidades fundamentalmente diferentes.  Mesmo em uma arquitetura de microsservi√ßo muito complexa, os propriet√°rios de servi√ßos n√£o precisam de conhecimento aprofundado de mais de dois ou tr√™s servi√ßos upstream e downstream.  Em ess√™ncia, na maioria dos cen√°rios, os usu√°rios precisam apenas responder perguntas sobre um <i>conjunto limitado de servi√ßos</i> . <br><br>  √â como olhar para um pequeno subconjunto de servi√ßos atrav√©s de uma lente de aumento para fins de estudo meticuloso.  Isso permitir√° que o usu√°rio fa√ßa perguntas mais prementes sobre a complexa intera√ß√£o entre esses servi√ßos e suas depend√™ncias imediatas.  Isso √© semelhante ao backtrace no mundo dos servi√ßos, onde o engenheiro sabe o <i>que</i> est√° errado e tamb√©m tem alguma id√©ia do que est√° acontecendo nos servi√ßos ao redor para entender o <i>porqu√™</i> . <br><br>  A abordagem que estou promovendo √© exatamente o oposto da abordagem de cima para baixo, com base na visualiza√ß√£o de rastreamento, quando a an√°lise come√ßa com todo o rastreamento e depois desce gradualmente para extens√µes individuais.  Pelo contr√°rio, a abordagem de baixo para cima come√ßa com uma an√°lise de uma pequena √°rea pr√≥xima √† causa potencial do incidente e, em seguida, o espa√ßo de pesquisa √© ampliado, se necess√°rio (com o poss√≠vel envolvimento de outras equipes para analisar uma ampla gama de servi√ßos).  A segunda abordagem √© mais adequada para testar rapidamente as hip√≥teses iniciais.  Ap√≥s a obten√ß√£o de resultados espec√≠ficos, ser√° poss√≠vel avan√ßar para uma an√°lise mais focada e detalhada. <br><br><h3>  Constru√ß√£o de topologia </h3><br>  As visualiza√ß√µes associadas a um servi√ßo espec√≠fico podem ser incrivelmente √∫teis se o usu√°rio souber <i>qual</i> servi√ßo ou grupo de servi√ßos √© respons√°vel por aumentar os atrasos ou √© uma fonte de erros.  No entanto, em um sistema complexo, identificar um invasor pode n√£o ser uma tarefa trivial durante uma falha, especialmente se nenhuma mensagem de erro tiver sido recebida dos servi√ßos. <br><br>  Construir uma topologia de servi√ßo pode ser muito √∫til para descobrir qual servi√ßo mostra um aumento na taxa de erros ou um aumento na lat√™ncia, levando a uma deteriora√ß√£o percept√≠vel no desempenho do servi√ßo.  Falando sobre a constru√ß√£o de uma topologia, n√£o estou falando de <i>um mapa de servi√ßo</i> que exibe todos os servi√ßos dispon√≠veis no sistema e conhecido por seus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mapas de arquitetura na forma de uma estrela da morte</a> .  Essa representa√ß√£o n√£o √© melhor do que uma visualiza√ß√£o em rastreamento baseada em um gr√°fico ac√≠clico direcionado.  Em vez disso, gostaria de ver uma <i>topologia de servi√ßo gerada dinamicamente com</i> base em certos atributos, como taxa de erro, tempo de resposta ou qualquer par√¢metro especificado pelo usu√°rio que ajude a esclarecer a situa√ß√£o com servi√ßos suspeitos espec√≠ficos. <br><br>  Vejamos um exemplo.  Imagine um site de not√≠cias hipot√©tico.  O servi√ßo de <i>primeira p√°gina se</i> comunica com a Redis, com um servi√ßo de recomenda√ß√£o, com um servi√ßo de publicidade e servi√ßo de v√≠deo.  O servi√ßo de v√≠deo captura v√≠deos do S3 e os metadados do DynamoDB.  O servi√ßo de recomenda√ß√£o recebe metadados do DynamoDB, baixa dados do Redis e MySQL, grava mensagens no Kafka.  O servi√ßo de publicidade recebe dados do MySQL e grava mensagens no Kafka. <br><br>  A seguir, √© apresentada uma representa√ß√£o esquem√°tica dessa topologia (muitos programas de roteamento comercial constroem a topologia).  Pode ser √∫til se voc√™ precisar entender as depend√™ncias dos servi√ßos.  No entanto, durante a <i>depura√ß√£o</i> , quando um determinado servi√ßo (por exemplo, um servi√ßo de v√≠deo) demonstra maior tempo de resposta, essa topologia n√£o √© muito √∫til. <br><br><img src="https://habrastorage.org/webt/qr/85/y9/qr85y98gth6ybvwt5yuditlnack.png"><br>  <i>Esquema de servi√ßos hipot√©ticos para sites de not√≠cias</i> <br><br>  O diagrama abaixo seria melhor.  Nele, um servi√ßo problem√°tico <i>(v√≠deo) √©</i> representado bem no centro.  O usu√°rio imediatamente o nota.  A partir dessa visualiza√ß√£o, fica claro que o servi√ßo de v√≠deo funciona de maneira anormal devido ao aumento do tempo de resposta do S3, o que afeta a velocidade de download de parte da p√°gina principal. <br><br><img src="https://habrastorage.org/webt/v2/w5/za/v2w5zaf_s1_r8mzo0j6r2dopyyk.png"><br>  <i>Topologia din√¢mica que exibe apenas servi√ßos "interessantes"</i> <br><br>  Os esquemas topol√≥gicos gerados dinamicamente podem ser mais eficientes que os mapas de servi√ßos est√°ticos, especialmente em infraestruturas flex√≠veis e auto-escal√°veis.  A capacidade de comparar e contrastar topologias de servi√ßo permite que o usu√°rio fa√ßa perguntas mais relevantes.  Perguntas mais precisas sobre o sistema provavelmente levar√£o a uma melhor compreens√£o de como o sistema funciona. <br><br><h3>  Exibi√ß√£o comparativa </h3><br>  Outra visualiza√ß√£o √∫til seria uma exibi√ß√£o comparativa.  Atualmente, os rastreamentos n√£o s√£o adequados para compara√ß√µes lado a lado; portanto, os <i>per√≠odos</i> s√£o geralmente comparados.  E a id√©ia principal deste artigo √© precisamente que os per√≠odos s√£o de n√≠vel muito baixo para extrair as informa√ß√µes mais valiosas dos resultados do rastreamento. <br><br>  A compara√ß√£o de dois trace'ov n√£o exige visualiza√ß√µes fundamentalmente novas.  De fato, algo como um histograma representando a mesma informa√ß√£o que a traceview √© suficiente.  Surpreendentemente, mesmo esse m√©todo simples pode trazer muito mais frutos do que um simples estudo de dois tra√ßos separadamente.  Ainda mais poderosa seria a capacidade de <i>visualizar a</i> compara√ß√£o de tra√ßos <i>no agregado</i> .  Seria extremamente √∫til ver como uma configura√ß√£o de banco de dados implantada recentemente com a inclus√£o de GC (coleta de lixo) afeta o tempo de resposta de um servi√ßo downstream em algumas horas.  Se o que estou descrevendo aqui parece uma an√°lise A / B do impacto das altera√ß√µes de infraestrutura <i>em uma variedade de servi√ßos</i> usando resultados de rastreamento, voc√™ n√£o est√° muito longe da verdade. <br><br><h2>  Conclus√£o </h2><br>  N√£o questiono a utilidade do rastreamento em si.  Sinceramente, acredito que n√£o h√° outra maneira de coletar dados t√£o ricos, informais e contextuais quanto os contidos no rastreamento.    ,          .   ,        traceview-,          ,     ,   trace'.  ,          ,         . <br><br>   ,     ,  .        , <b> </b>  ,        .  ,           production   ,   ,      ,       ,     . <br><br>    ,   ,     ,    , ,      .  ,         ,      ,     trace'  span'. <br><br>           (  UI). ,         ,        .        ,           .           .      . <br><br><h2>  PS do tradutor </h2><br>  Leia tamb√©m em nosso blog: <br><br><ul><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> kubectl-debug    pod' Kubernetes</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">:   ,     Kubernetes</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  Kubernetes (   )</a> ¬ª. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460365/">https://habr.com/ru/post/pt460365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460353/index.html">Rede neural no vidro. N√£o requer energia, reconhece n√∫meros</a></li>
<li><a href="../pt460355/index.html">Salvar o afogamento √© o nosso neg√≥cio: como lidar com a desmotiva√ß√£o da equipe</a></li>
<li><a href="../pt460359/index.html">Young Game Designer 2 Course: Balanceando Progress√£o e Din√¢mica sem Matem√°tica</a></li>
<li><a href="../pt460361/index.html">√ìtimas perguntas frequentes sobre seguran√ßa cibern√©tica de sistemas de informa√ß√µes m√©dicas</a></li>
<li><a href="../pt460363/index.html">7 fatores ausentes na abordagem 12 Factor App</a></li>
<li><a href="../pt460367/index.html">Engenharia do Caos: a arte da destrui√ß√£o intencional. Parte 1</a></li>
<li><a href="../pt460373/index.html">P√°ginas sob o cap√¥ Turbo: arquitetura da tecnologia de download r√°pido de p√°ginas da Web</a></li>
<li><a href="../pt460375/index.html">Livro "Aprendizado de m√°quina para neg√≥cios e marketing"</a></li>
<li><a href="../pt460377/index.html">Usando o Liquibase para gerenciar a estrutura do banco de dados em um aplicativo Spring Boot. Parte 1</a></li>
<li><a href="../pt460381/index.html">O que √© assertividade e por que √© necess√°rio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>