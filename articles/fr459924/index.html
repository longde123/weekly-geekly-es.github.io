<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåø üôà üßöüèΩ Cycle d'essai complet de React. Rapport Auto.ru üîí üë®üèæ‚Äçüé® üôéüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le d√©sir de s'√©loigner des tests de r√©gression manuelle est une bonne raison d'introduire des autotests. La question est laquelle? Les d√©veloppeurs d'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cycle d'essai complet de React. Rapport Auto.ru</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/459924/"> Le d√©sir de s'√©loigner des tests de r√©gression manuelle est une bonne raison d'introduire des autotests.  La question est laquelle?  Les d√©veloppeurs d'interfaces Natalya Stus et Alexei Androsov ont rappel√© comment leur √©quipe a travers√© plusieurs it√©rations et construit des tests frontaux dans Auto.ru bas√©s sur Jest et Puppeteer: tests unitaires, tests pour les composants React individuels, tests d'int√©gration.  Le plus int√©ressant de cette exp√©rience est le test isol√© des composants React dans un navigateur sans Selenium Grid, Java et autres. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/yr/np/zo/yrnpzon4-5momllzoy0bg1zz-ie.jpeg"></a> <br><br>  Alexey: <br>  - Vous devez d'abord dire un peu ce qu'est Automotive News.  Ceci est un site de vente de voitures.  Il y a une recherche, un compte personnel, des services automobiles, des pi√®ces d√©tach√©es, des avis, des concessionnaires et bien plus encore.  Auto.ru est un tr√®s gros projet, beaucoup de code.  Nous √©crivons tout le code dans un grand monorepe, car tout est m√©lang√©.  Les m√™mes personnes effectuent des t√¢ches similaires, par exemple pour les mobiles et les ordinateurs de bureau.  Il s'av√®re que beaucoup de code, et monorepa est vital pour nous.  La question est de savoir comment le tester? <br><br><a name="habracut"></a><img src="https://habrastorage.org/webt/vn/qv/qf/vnqvqfbci0v-wlfceczgd5snhgi.jpeg"><br><br>  Nous avons React et Node.js, qui effectue un rendu c√¥t√© serveur et demande des donn√©es au backend.  Reste et petits morceaux sur le BEM. <br><br><img src="https://habrastorage.org/webt/xb/1p/_b/xb1p_b-9j8huy-rle317mtp5sjc.jpeg"><br><br>  Natalya: <br>  - Nous avons commenc√© √† penser √† l'automatisation.  Le cycle de sortie de nos applications individuelles comprenait plusieurs √©tapes.  Tout d'abord, la fonctionnalit√© est d√©velopp√©e par le programmeur dans une branche distincte.  Apr√®s cela, dans la m√™me branche distincte, la fonctionnalit√© est test√©e par des testeurs manuels.  Si tout va bien, la t√¢che incombe au candidat √† la lib√©ration.  Sinon, revenez √† l'it√©ration de d√©veloppement, testez √† nouveau.  Jusqu'√† ce que le testeur dise que tout va bien dans cette fonctionnalit√©, il ne tombera pas dans la version candidate. <br><br>  Apr√®s avoir assembl√© la version candidate, il y a une r√©gression manuelle - pas seulement Auto.ru, mais seulement le package que nous allons rouler.  Par exemple, si nous allons d√©ployer le site Web de bureau, il y a alors une r√©gression manuelle du site Web de bureau.  Ce sont de nombreux cas de test manuels.  Une telle r√©gression a pris environ une journ√©e de travail d'un testeur manuel. <br><br>  Une fois la r√©gression termin√©e, une lib√©ration se produit.  Apr√®s cela, la branche de publication fusionne dans le ma√Ætre.  √Ä ce stade, nous pouvons simplement injecter le code ma√Ætre, que nous avons test√© uniquement pour le Web de bureau, et ce code peut casser le Web mobile, par exemple.  Ce n'est pas v√©rifi√© imm√©diatement, mais seulement lors de la prochaine r√©gression manuelle - le Web mobile. <br><br><img src="https://habrastorage.org/webt/uc/pp/f6/ucppf6mqcfn6rcjayzc7mzgzzwe.jpeg"><br><br>  Naturellement, l'endroit le plus douloureux de ce processus a √©t√© la r√©gression manuelle, qui a pris tr√®s longtemps.  Tous les testeurs manuels sont naturellement fatigu√©s de faire la m√™me chose tous les jours.  Par cons√©quent, nous avons d√©cid√© de tout automatiser.  La premi√®re solution qui a √©t√© ex√©cut√©e a √©t√© les autotests Selenium et Java, r√©dig√©s par une √©quipe distincte.  Ce sont des tests de bout en bout, e2e, qui ont test√© l'ensemble de l'application.  Ils ont √©crit environ 5 000 de ces tests.  Qu'avons-nous fini avec? <br><br>  Naturellement, nous avons acc√©l√©r√© la r√©gression.  Les tests automatiques r√©ussissent beaucoup plus rapidement qu'un testeur manuel, environ 10 fois plus vite.  En cons√©quence, les actions de routine qu'ils effectuaient chaque jour ont √©t√© supprim√©es des testeurs manuels.  Les bogues trouv√©s des autotests sont plus faciles √† reproduire.  Relancez simplement ce test ou regardez les √©tapes qu'il fait - contrairement au testeur manuel, qui dira: "J'ai cliqu√© sur quelque chose et tout s'est cass√©." <br><br>  Assurer la stabilit√© du rev√™tement.  Nous ex√©cutons toujours les m√™mes tests d'ex√©cution - en revanche, encore une fois, √† partir des tests manuels, lorsque le testeur peut consid√©rer que nous n'avons pas touch√© cet endroit, et je ne le v√©rifierai pas cette fois.  Nous avons ajout√© des tests pour comparer les captures d'√©cran, am√©lior√© la pr√©cision des tests de l'interface utilisateur - maintenant, nous v√©rifions la diff√©rence de quelques pixels que le testeur ne verra pas avec ses yeux.  Tout cela gr√¢ce √† des tests de captures d'√©cran. <br><br>  Mais il y avait des inconv√©nients.  Le plus grand - pour les tests e2e, nous avons besoin d'un environnement de test enti√®rement coh√©rent avec le produit.  Il doit toujours √™tre tenu √† jour et op√©rationnel.  Cela n√©cessite presque autant de force que la vente d'un support de stabilit√©.  Naturellement, nous ne pouvons pas toujours nous le permettre.  Par cons√©quent, nous avons souvent eu des situations o√π l'environnement de test se trouve ou quelque part quelque chose est cass√©, et les tests √©chouent, bien qu'il n'y ait eu aucun probl√®me dans le package le plus avant. <br><br>  Ces tests sont √©galement d√©velopp√©s par une √©quipe distincte, qui a ses propres t√¢ches, son propre tour dans le tracker de t√¢ches, et les nouvelles fonctionnalit√©s sont couvertes avec un certain retard.  Ils ne peuvent pas venir imm√©diatement apr√®s la sortie d'une nouvelle fonctionnalit√© et y √©crire imm√©diatement des autotests.  Les tests √©tant co√ªteux et difficiles √† √©crire et √† maintenir, nous ne couvrons pas tous les sc√©narios avec eux, mais seulement les plus critiques.  Dans le m√™me temps, une √©quipe distincte est n√©cessaire, et elle aura des outils distincts, une infrastructure distincte qui lui est propre.  Et l'analyse des tests tomb√©s est √©galement une t√¢che non triviale pour les testeurs manuels ou pour les d√©veloppeurs.  Je vais vous montrer quelques exemples. <br><br><img src="https://habrastorage.org/webt/gn/ix/c6/gnixc6p8h1phrdhcjlosttb0ai8.jpeg"><br><br>  Nous avons effectu√© des tests.  500 tests r√©ussis, dont certains sont tomb√©s.  Nous pouvons voir une telle chose dans le rapport.  Ici, le test n'a tout simplement pas commenc√©, et il n'est pas clair si tout va bien ou non. <br><br><img src="https://habrastorage.org/webt/40/70/6p/40706pwn5i1vfzfpl4ekmfhpeom.jpeg"><br><br>  Un autre exemple - le test a commenc√©, mais s'est √©cras√© avec une telle erreur.  Il n'a trouv√© aucun √©l√©ment sur la page, mais pourquoi - nous ne savons pas.  Soit cet √©l√©ment n'apparaissait tout simplement pas, soit il se trouvait sur la mauvaise page, soit le localisateur avait chang√©.  Tout ce dont vous avez besoin pour vous d√©barrasser des mains. <br><br><img src="https://habrastorage.org/webt/vh/_f/xd/vh_fxdrktlr3llkbrcloced22ks.jpeg"><br><br>  Les tests de capture d'√©cran ne nous donnent pas toujours une bonne pr√©cision.  Ici, nous chargeons une sorte de carte, elle a l√©g√®rement boug√©, notre test est tomb√©. <br><br><img src="https://habrastorage.org/webt/_r/1y/dm/_r1ydm4pdscdlxgdse5focstyje.jpeg"><br><br>  Nous avons essay√© de r√©soudre un certain nombre de ces probl√®mes.  Nous avons commenc√© √† ex√©cuter une partie des tests sur le prod - ceux qui n'affectent pas les donn√©es utilisateur ne changent rien dans la base de donn√©es.  Autrement dit, chez prod, nous avons fabriqu√© une machine distincte qui se penche sur l'environnement de production.  Nous installons simplement un nouveau paquet frontal et y ex√©cutons des tests.  Le produit est au moins stable. <br><br>  Nous avons transf√©r√© certains des tests aux mokeys, mais nous avons beaucoup de backends diff√©rents, des API diff√©rentes, et le verrouillage est une t√¢che tr√®s difficile, en particulier pour 5 000 tests.  Pour cela, un service sp√©cial appel√© mockritsa a √©t√© √©crit, il permet de faire assez facilement les mokas n√©cessaires pour le frontend et est assez facile √† les proxy. <br><br>  Nous avons √©galement d√ª acheter un tas de fer pour que notre grille d'appareils au s√©l√©nium √† partir de laquelle ces tests sont lanc√©s soit plus grande afin qu'ils ne tombent pas, car ils ne pouvaient pas augmenter le navigateur et, par cons√©quent, aller plus vite.  M√™me apr√®s avoir essay√© de r√©soudre ces probl√®mes, nous sommes toujours arriv√©s √† la conclusion que ces tests ne sont pas adapt√©s √† l'IC, ils prennent beaucoup de temps.  Nous ne pouvons pas les ex√©cuter √† chaque demande de pool.  Nous n'allons tout simplement jamais analyser de ces rapports, qui seront g√©n√©r√©s pour chaque demande de pool. <br><br><img src="https://habrastorage.org/webt/od/0z/rl/od0zrladzvsshl04e52vipgtcvo.jpeg"><br><br>  Par cons√©quent, pour CI, nous avons besoin de tests rapides et stables qui n'√©choueront pas pour des raisons al√©atoires.  Nous voulons ex√©cuter des tests pour la demande de pool sans bancs d'essai, backends, bases de donn√©es, sans cas d'utilisation compliqu√©s. <br><br>  Nous voulons que ces tests soient √©crits simultan√©ment avec le code, et que les r√©sultats des tests indiquent imm√©diatement dans quel fichier quelque chose s'est mal pass√©. <br><br>  Alexey: <br>  - Oui, et nous avons d√©cid√© d'essayer tout ce que nous voulons, de tout redresser du d√©but √† la fin dans la m√™me infrastructure Jest.  Pourquoi avons-nous choisi Jest?  Nous avons d√©j√† √©crit des tests unitaires sur Jest, nous l'avons aim√©.  C'est un outil populaire et pris en charge, il contient d√©j√† un tas d'int√©grations pr√™tes √† l'emploi: React test render, Enzyme.  Tout fonctionne hors de la bo√Æte, rien n'a besoin d'√™tre construit, tout est simple. <br><br><img src="https://habrastorage.org/webt/js/bo/sa/jsbosapwtytq_x6a8zkvxl6gdv0.jpeg"><br><br>  Et Jest a personnellement gagn√© pour moi en ce que, contrairement √† tout moka, il est difficile de tirer l'effet secondaire d'une sorte de test tiers dans votre jambe si j'oublie de le nettoyer ou autre chose.  Dans moka, cela se fait une ou deux fois, mais dans Jest, c'est difficile √† faire: il est constamment lanc√© dans des threads s√©par√©s.  C'est possible, mais difficile.  Et pour e2e sorti Puppeteer, nous avons √©galement d√©cid√© de l'essayer.  Voil√† ce que nous avons. <br><br><img src="https://habrastorage.org/webt/ab/ph/oa/abphoap_rzksxw_spwh4t_0nfra.jpeg"><br><br>  Natalya: <br>  ¬´Je vais √©galement commencer par un exemple de tests unitaires.¬ª  Lorsque nous √©crivons des tests simplement pour une fonction, il n'y a pas de probl√®mes particuliers.  Nous appelons cette fonction, passons quelques arguments, comparons ce qui s'est pass√© avec ce qui aurait d√ª se produire. <br><br>  Si nous parlons de composants React, alors tout devient un peu plus compliqu√©.  Nous devons en quelque sorte les rendre.  Il existe un moteur de rendu de test React, mais il n'est pas tr√®s pratique pour les tests unitaires, car il ne nous permettra pas de tester les composants de mani√®re isol√©e.  Il rendra le composant compl√®tement √† la fin, √† la mise en page. <br><br>  Et je veux montrer comment avec Enzyme, il est possible d'√©crire des tests unitaires pour les composants React en utilisant un exemple d'un tel composant o√π nous avons un certain MyComponent.  Il obtient une sorte d'accessoire, il a une sorte de logique.  Ensuite, il retourne le composant Foo, qui, √† son tour, retournera le composant bar, qui d√©j√† dans le composant bar nous renvoie, en fait, la mise en page. <br><br><img src="https://habrastorage.org/webt/h2/1e/e6/h21ee6qkeeucwkgnvye6ewsgxog.jpeg"><br><br>  Nous pouvons utiliser un outil Enzyme comme le rendu peu profond.  C'est exactement ce dont nous avons besoin pour tester le composant MyComponent de mani√®re isol√©e.  Et ces tests ne d√©pendront pas de ce que les composants foo et bar contiendront en eux-m√™mes.  Nous allons juste tester la logique du composant MyComponent. <br><br>  Jest a une telle chose comme Snapshot, et ils peuvent √©galement nous aider ici.  ¬´Attendez-vous √† quelque chose toMatchSnapshot¬ª va cr√©er une telle structure pour nous, juste un fichier texte qui stocke, en fait, ce √† quoi nous nous attendions, ce que nous obtenons, et ce fichier est √©crit la premi√®re fois que nous ex√©cutons de tels tests.  Avec d'autres ex√©cutions des tests, ce qui est obtenu sera compar√© au standard contenu dans le fichier MyComponent.test.js.snap. <br><br>  Ici, nous voyons juste que tout le rendu, il retourne exactement ce que la m√©thode de rendu de MyComponent retourne, et ce que foo est, en g√©n√©ral, cela ne fait rien.  Nous pouvons √©crire ces deux tests pour nos deux cas, pour nos deux cas pour le composant MyComponent. <br><br><img src="https://habrastorage.org/webt/wu/b3/iw/wub3iwlwsatz7ytgzpeim8vsbqs.jpeg"><br><br>  En principe, nous pouvons tester la m√™me chose sans instantan√©, en v√©rifiant simplement les scripts dont nous avons besoin, par exemple, en v√©rifiant quel accessoire est pass√© au composant foo.  Mais cette approche a un inconv√©nient.  Si nous ajoutons un autre √©l√©ment √† MyComponent, notre nouveau test, cela ne s'affiche en aucune fa√ßon. <br><br><img src="https://habrastorage.org/webt/pd/9e/vy/pd9evyrhuh7kfzrqcukvwpbudaq.jpeg"><br><br>  Par cons√©quent, apr√®s tout, les tests d'instantan√©s sont ceux qui nous montreront presque tous les changements √† l'int√©rieur du composant.  Mais si nous √©crivons les deux tests sur Snapshot, puis que nous apportons les m√™mes modifications dans le composant, nous verrons que les deux tests tomberont.  En principe, les r√©sultats de ces tests d√©chus nous diront la m√™me chose, que nous y avons ajout√© une sorte de ¬´bonjour¬ª. <br><br><img src="https://habrastorage.org/webt/gv/c1/dc/gvc1dcwq9aw2m3owq6c-esulpsg.jpeg"><br><br>  Et cela est √©galement redondant, par cons√©quent, je pense qu'il est pr√©f√©rable d'utiliser un test de capture instantan√©e pour la m√™me structure.  V√©rifiez le reste de la logique diff√©remment, sans Snapshot, car Snapshot, ils ne sont pas tr√®s indicatifs.  Lorsque vous voyez un instantan√©, vous voyez simplement que quelque chose a √©t√© rendu, mais la logique que vous avez test√©e ici n'est pas claire.  Ceci est totalement inappropri√© pour TDD si vous souhaitez l'utiliser.  Et cela ne fonctionnera pas comme la documentation.  Autrement dit, lorsque vous allez regarder ce composant, vous verrez que oui, Snapshot correspond √† quelque chose, mais quel type de logique √©tait l√† n'est pas tr√®s clair. <br><br><img src="https://habrastorage.org/webt/wa/yc/ia/wayciagk2zoa51amkq8bb9xcqic.jpeg"><br><br><img src="https://habrastorage.org/webt/zk/mj/sa/zkmjsaoqa-34pqk2flku7_n7nsy.jpeg"><br><br>  De la m√™me mani√®re, nous √©crirons des tests unitaires sur le composant foo, sur le composant bar, par exemple, Snapshot. <br><br><img src="https://habrastorage.org/webt/bg/eu/lk/bgeulklgkyqg-woog9tkqhkkpco.jpeg"><br><br>  Nous b√©n√©ficions d'une couverture √† 100% pour ces trois composants.  Nous pensons avoir tout v√©rifi√©, nous sommes bien faits. <br><br>  Mais disons que nous avons chang√© quelque chose dans le composant bar, y avons ajout√© de nouveaux accessoires, et nous avons eu un test pour le composant bar, √©videmment.  Nous avons corrig√© le test et les trois tests r√©ussissent avec nous. <br><br><img src="https://habrastorage.org/webt/4i/pe/xc/4ipexciijx7ss998ugl84hr6smi.jpeg"><br><br>  Mais en fait, si nous collectons toute cette histoire, alors rien ne fonctionnera, car MyComponent ne se r√©unira pas avec une telle erreur.  Nous ne transmettons pas r√©ellement l'h√©lice qu'il attend au composant barre.  Par cons√©quent, nous parlons du fait que dans ce cas, nous avons √©galement besoin de tests d'int√©gration qui v√©rifieront, notamment si nous appelons correctement son composant enfant √† partir de notre composant. <br><br><img src="https://habrastorage.org/webt/8e/aa/zk/8eaazkltwuurjeh7fhef39ovblq.jpeg"><br><br>  En ayant de tels composants et en modifiant l'un d'entre eux, vous voyez imm√©diatement quels changements dans ce composant ont affect√©. <br><br>  Quelles opportunit√©s avons-nous dans Enzyme pour effectuer des tests d'int√©gration?  Le rendu superficiel lui-m√™me renvoie une telle structure.  Il a une m√©thode de plong√©e, s'il est appel√© sur un composant React, il √©chouera.  En cons√©quence, en l'appelant sur le composant foo, nous obtenons ce que le composant foo rend, c'est bar, si nous refaisons la plong√©e, nous obtiendrons, en fait, la disposition que le composant bar nous renvoie.  Ce ne sera qu'un test d'int√©gration. <br><br><img src="https://habrastorage.org/webt/oo/jm/af/oojmafj91rsbbpprnhyqf868qoy.jpeg"><br><br>  Ou vous pouvez tout rendre √† la fois en utilisant la m√©thode de montage, qui impl√©mente le rendu DOM complet.  Mais je ne conseille pas de faire cela, car ce sera un instantan√© tr√®s difficile.  Et, en r√®gle g√©n√©rale, vous n'avez pas besoin de v√©rifier compl√®tement la structure enti√®re.  Il vous suffit de v√©rifier l'int√©gration entre les composants parent et enfant dans chaque cas. <br><br><img src="https://habrastorage.org/webt/q9/ud/i-/q9udi-03qar0hjqhxe6th8an6zc.jpeg"><br><br>  Et pour MyComponent, nous ajoutons un test d'int√©gration, donc dans le premier test j'ajoute juste de la plong√©e, et il s'av√®re que nous avons test√© non seulement la logique du composant lui-m√™me, mais aussi son int√©gration avec le composant foo.  La m√™me chose, nous ajoutons le test d'int√©gration pour le composant foo qu'il appelle correctement le composant bar, puis nous v√©rifions toute cette cha√Æne, et nous sommes s√ªrs qu'aucun changement ne nous cassera, en fait, le rendu de MyComponent <br><br><img src="https://habrastorage.org/webt/ff/zu/fq/ffzufq_vcw5lmuygnztd0lycvao.jpeg"><br><br>  Un autre exemple, d√©j√† issu d'un vrai projet.  Juste bri√®vement ce que Jest et Enzyme peuvent faire d'autre.  Jest peut faire du moki.  Vous pouvez, si vous utilisez une fonction externe dans votre composant, vous pouvez le verrouiller.  Par exemple, dans cet exemple, nous appelons une sorte d'api, bien s√ªr, nous ne voulons pas aller √† une api dans le test unitaire, donc nous essuyons simplement la fonction getResource avec un objet jest.fn.  En fait, la fonction de simulation.  Ensuite, nous pouvons v√©rifier si elle a √©t√© appel√©e ou non, combien de fois elle a √©t√© appel√©e, avec quels arguments.  Tout cela vous permet de faire Jest. <br><br><img src="https://habrastorage.org/webt/z8/lb/ap/z8lbapgq_qzer-1vz3yazx9wo-o.jpeg"><br><br>  Dans le rendu superficiel, vous pouvez passer le stockage √† un composant.  Si vous avez besoin d'un magasin, vous pouvez simplement le transf√©rer l√†-bas, et cela fonctionnera. <br><br><img src="https://habrastorage.org/webt/y2/tl/ih/y2tlihjjqqwogsbftvcirxe_njc.jpeg"><br><br>  Vous pouvez √©galement modifier l'√©tat et l'accessoire dans un composant d√©j√† rendu. <br><br><img src="https://habrastorage.org/webt/ew/8g/hc/ew8ghcc6gtv3347yt8ik6o9v6s4.jpeg"><br><br>  Vous pouvez appeler la m√©thode de simulation sur certains composants.  Il appelle simplement le gestionnaire.  Par exemple, si vous simulez un clic, il appellera onClick pour le composant bouton ici.  Tout cela peut √™tre lu, bien s√ªr, dans la documentation sur Enzyme, beaucoup de pi√®ces utiles.  Ce ne sont que quelques exemples d'un vrai projet. <br><br><img src="https://habrastorage.org/webt/tw/kn/9t/twkn9txihstmq5pdpc9yqgc1nnw.jpeg"><br><br>  Alexey: <br>  - Nous arrivons √† la question la plus int√©ressante.  Nous pouvons tester Jest, nous pouvons √©crire des tests unitaires, v√©rifier les composants, v√©rifier quels √©l√©ments r√©pondent incorrectement √† un clic.  Nous pouvons v√©rifier leur html.  Maintenant, nous devons v√©rifier la disposition du composant, css. <br><br><img src="https://habrastorage.org/webt/fw/dj/8p/fwdj8pbfn6ywa4he7ejwjnq6hs4.jpeg"><br><br>  Et il est conseill√© de le faire pour que le principe du test ne diff√®re en rien de celui que j'ai d√©crit pr√©c√©demment.  Si je v√©rifie html, j'ai appel√© rendu peu profond, il m'a fallu et rendu html.  Je veux v√©rifier css, appeler simplement une sorte de rendu et v√©rifier - sans rien lever, sans configurer d'outils. <br><br><img src="https://habrastorage.org/webt/mz/u-/p2/mzu-p2y3eiblryntol0eelzghtc.jpeg"><br><br>  J'ai commenc√© √† le chercher, et √† peu pr√®s partout la m√™me r√©ponse a √©t√© donn√©e √† tout cela appel√© Puppeteer, ou grille de s√©l√©nium.  Vous ouvrez un onglet, vous allez sur une page html, prenez une capture d'√©cran et comparez-la avec l'option pr√©c√©dente.  Si cela n'a pas chang√©, alors tout va bien. <br><br>  La question est, qu'est-ce que le HTML de page si je veux juste v√©rifier un composant isol√©ment?  Il est souhaitable - dans diff√©rentes conditions. <br><br><img src="https://habrastorage.org/webt/w2/t0/vn/w2t0vni_fdskrtopftgiigmxows.jpeg"><br><h5>  <sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sub></sup> </h5><br>  Je ne veux pas √©crire un tas de ces pages HTML pour chaque composant, pour chaque √©tat.  Avito a une bonne course.  Roma Dvornov a publi√© un article sur Habr√©, et lui, soit dit en passant, a prononc√© un discours.  Qu'ont-ils fait?  Ils prennent des composants, assemblent du HTML via un rendu standard.  Ensuite, √† l'aide de plugins et de toutes sortes d'astuces, ils collectent tous les actifs qu'ils ont - photos, css.  Ins√©rez le tout en html, et ils obtiennent juste le bon html. <br><br><img src="https://habrastorage.org/webt/0j/yr/zk/0jyrzkzvwzebsx36hos2vvi1uvs.jpeg"><br><h5>  <sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sub></sup> </h5><br>  Et puis ils ont lev√© un serveur sp√©cial, y envoient du HTML, il le rend et retourne un r√©sultat.  Un article tr√®s int√©ressant, cependant, vous pouvez en tirer beaucoup d'id√©es int√©ressantes. <br><br><img src="https://habrastorage.org/webt/z5/xp/gb/z5xpgbasgyr6gooqi_dt-p4_mxw.jpeg"><br><br>  Ce que je n'aime pas l√†-bas.  L'assemblage d'un composant est diff√©rent de sa mise en production.  Par exemple, nous avons un webpack, et l√†, il va √™tre collect√© par une sorte d'actifs babel, il est retir√© diff√©remment l√†-bas.  Je ne peux pas garantir que j'ai test√© ce que je vais t√©l√©charger maintenant. <br><br>  Et encore une fois, un service distinct pour les captures d'√©cran.  Je veux le faire plus facilement.  Et il y avait, en fait, l'id√©e que, collectons-le exactement de la m√™me mani√®re que nous le collecterons.  Et essayez d'utiliser quelque chose comme Docker, car c'est une telle chose, il peut √™tre plac√© sur un ordinateur, localement, ce sera simple, isol√©, ne touchera √† rien, tout va bien. <br><br><img src="https://habrastorage.org/webt/9k/nz/hm/9knzhmk3-qivjt6peujxtmjnovw.jpeg"><br><br>  Mais ce probl√®me est avec la page html, il reste le m√™me qu'il est vraiment.  Et une id√©e est n√©e.  Vous avez un tel webpack.conf simplifi√©, et √† partir de l√† il y a un EntryPoint pour le client js.  Les modules sont d√©crits, comment les assembler, le fichier de sortie, tous les plugins que vous avez d√©crits, tout est configur√©, tout va bien. <br><br><img src="https://habrastorage.org/webt/3f/km/ha/3fkmhal86lf6s38oq8rnnhchsdg.jpeg"><br><br>  Et si j'aime √ßa?  Il ira dans ma composante et la collectera de mani√®re isol√©e.  Et il y aura exactement un composant.  Si j'y ajoute un webpack html, cela me donnera √©galement du html, et ces actifs seront collect√©s l√†-bas, et cette chose, cependant, peut d√©j√† √™tre test√©e automatiquement. <br><br>  Et j'√©tais sur le point d'√©crire tout cela, mais j'ai trouv√© √ßa. <br><br><img src="https://habrastorage.org/webt/hq/ju/0s/hqju0sbemjp1z3ryufas0pk0tfu.jpeg"><br><br>  Jest-puppeteer-React, un jeune plugin.  Et j'ai commenc√© √† y contribuer activement.  Si vous voulez soudainement l'essayer, vous pouvez, par exemple, venir me voir, je peux en quelque sorte vous aider.  En fait, le projet n'est pas le mien. <br><br>  Vous √©crivez un fichier normal en tant que test.js, et ces fichiers doivent √™tre √©crits un peu s√©par√©ment pour aider √† les trouver, afin de ne pas compiler tout le projet pour vous, mais de compiler uniquement les composants n√©cessaires.  En fait, vous prenez la configuration webpack.  Et les points d'entr√©e changent dans ces fichiers browser.js, c'est-√†-dire exactement ce que nous voulons tester va √™tre emball√© en html, et avec l'aide de Puppeteer, il vous prendra des captures d'√©cran. <br><br><img src="https://habrastorage.org/webt/3e/jh/fr/3ejhfrfte3ucybs-vvl6ncw28vo.jpeg"><br><br>  Que peut-il faire?    ,         jest-image-snapshot.    .     ,     ,  js,   media-query, ,  . <br><br>    headless-,  ,    ,  ,   ,  headless-,     Chrome   .  web-,    , , ,   . <br><br>       Docker.          .  .  ,  Docker,  .   .  Docker     ,         , ,     Linux,   -   ,      -  .  Docker   ,            . <br><br><img src="https://habrastorage.org/webt/gt/26/zc/gt26zcwy-madcquchbm37l89lwo.jpeg"><br><br>      ?   ,       . ,  .    before-after,     ,  .   ,    .   ,         Chrome,       Firefox.    . <br><br>       .    pixelmatch.  ,   looksame,    ¬´¬ª,    .   ,         . <br><br><img src="https://habrastorage.org/webt/ep/zg/ov/epzgovfoqseh2bj5r7jcr8z0lr0.jpeg"><br><br>  ‚Äî   .   ,  ,     .  ,    :    - ,             ‚Äî    Enzyme.      Redux   store .  .    viewport,  ,      .   , ,     . <br><br><img src="https://habrastorage.org/webt/ln/wh/qu/lnwhqusfy-4mqef59zw0lmnoaus.jpeg"><br><br>      .  ,   .  ?     ,     . <br><br><img src="https://habrastorage.org/webt/ut/l6/xb/utl6xb7objmhjnhozdlamgwzjyk.jpeg"><br><br>   :       5-10        . Selenium    .    ,  , ,           .        . <br><br><img src="https://habrastorage.org/webt/md/qr/rf/mdqrrf6ueg73uu25m6wqfihyo3q.jpeg"><br><br>      Puppeteer,    e2e-.      ,          e2e- ‚Äî   ,    Selenium. <br><br> : <br> ‚Äî ,         Selenium Java ,    .     - JS   Puppeteer,    ,         . <br><br>     ,       .     ,           ,    . <br><br><img src="https://habrastorage.org/webt/0s/7u/ns/0s7uns7oaxi3dcwuejuhk5kwuoy.jpeg"><br><br>   ‚Äî  Selenium  Java,   ‚Äî  JS Puppeteer.   .   18  .          ,   ,    Java.  ,           ,       Java  Selenium. <br><br><img src="https://habrastorage.org/webt/kk/us/pj/kkuspjg5dwwz6h2tuhkwfkssth0.jpeg"><br><br> : <br> ‚Äî     ?       .    , html-,    css   .   e2e. .  ,       . <br><br><img src="https://habrastorage.org/webt/sj/wg/58/sjwg58se3lov3vvrskvjjh2pw90.jpeg"><br><br>     ,    ,  .        . ,   , ‚Äî  , .        ,     . -    , ,      :     ,     . <br><br>   ,         ,     .     git hook,  -,      .    green master ‚Äî   ,   ,  ,      .  Je vous remercie </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459924/">https://habr.com/ru/post/fr459924/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459906/index.html">Tic Tac Toe, partie 3: Annuler / R√©tablir avec stockage des commandes</a></li>
<li><a href="../fr459910/index.html">Situation: les entreprises ne sont pas press√©es de d√©velopper des services pour les assistants vocaux - quels sont les risques</a></li>
<li><a href="../fr459914/index.html">SQL Index Manager - un outil gratuit pour d√©fragmenter et maintenir les index</a></li>
<li><a href="../fr459918/index.html">R√©solution de probl√®mes avec pwnable.kr 03 - bof. D√©bordement de tampon sur la pile</a></li>
<li><a href="../fr459922/index.html">Suppression du bruit haute fr√©quence des signaux des capteurs de vibrations lors du diagnostic des vibrations des roulements</a></li>
<li><a href="../fr459928/index.html">Parcours de l'√©tudiant vers le d√©veloppement d'applications mobiles</a></li>
<li><a href="../fr459930/index.html">Automatisation de l'importation Python</a></li>
<li><a href="../fr459934/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 306 (du 8 au 14 juillet)</a></li>
<li><a href="../fr459936/index.html">9 astuces suppl√©mentaires pour travailler avec Visual Studio</a></li>
<li><a href="../fr459948/index.html">Impl√©mentation de nuages ‚Äã‚Äãvolum√©triques physiquement corrects comme dans Horizon Zero Dawn</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>