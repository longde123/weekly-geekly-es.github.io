<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äç‚öïÔ∏è üë• üè∑Ô∏è Migrer automatiquement les applications iOS (ARM) vers macOS (x86) √† l'aide de Bitcode üöµüèº üå¨Ô∏è ‚ôÄÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quand Apple a introduit la technologie Bitcode et l'a rendue obligatoire pour watchOS et tvOS, la soci√©t√© a sembl√© ignorer les raisons pour lesquelles...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Migrer automatiquement les applications iOS (ARM) vers macOS (x86) √† l'aide de Bitcode</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452734/"> Quand Apple a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">introduit la technologie Bitcode</a> et l'a rendue obligatoire pour watchOS et tvOS, la soci√©t√© a sembl√© ignorer les raisons pour lesquelles elle √©tait n√©cessaire.  Elle a seulement dit vaguement que cela aide √† personnaliser les fichiers binaires et utilise les derni√®res am√©liorations du compilateur. <br><br>  Depuis lors, Bitcode a jou√© un r√¥le important dans la transition en douceur de watchOS vers 64 bits, o√π les d√©veloppeurs n'avaient m√™me pas √† recompiler leurs applications dans le r√©pertoire.  Apple l'a fait automatiquement: toutes les applications ont commenc√© √† fonctionner sur l'Apple Watch Series 4. Vous n'avez probablement m√™me pas remarqu√© que la migration s'est produite. <br><br>  Qu'est-ce que le Bitcode?  Eh bien, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bitcode</a> avec petit b est la repr√©sentation interm√©diaire sp√©cifique √† l'architecture utilis√©e par LLVM, et Bitcode avec grand B fait r√©f√©rence √† un ensemble de fonctions qui vous permettent d'incorporer cette vue dans votre binaire Mach-O, et les m√©canismes par lesquels vous pouvez rendre ce fichier sur l'App Store. <br><a name="habracut"></a><br>  Le bitcode n'est pas aussi flexible que le code source, mais il est beaucoup plus flexible que le binaire incorpor√©, avec des m√©tadonn√©es et des annotations pour le compilateur.  En pratique, vous (ou Apple) pouvez facilement extraire les objets blob Bitcode de l'application et les recompiler dans une copie pleinement fonctionnelle de votre application.  Passer d'armv7 √† armv7s ou d'arm64 √† arm64e est tr√®s cool et fait gagner du temps aux d√©veloppeurs qui devaient recompiler le binaire √† chaque fois qu'Apple change de puce ARM.  Le bitcode est utilis√© depuis longtemps par Apple dans les pilotes OpenGL, de sorte que le pilote peut √™tre optimis√© √† la vol√©e pour diverses architectures GPU. <br><br>  Nous avons vu comment Microsoft exploite efficacement la recompilation statique sur la Xbox One, donnant acc√®s √† toute une biblioth√®que de jeux √©crits √† l'origine pour la Xbox 360 (sous PowerPC), sans la participation des d√©veloppeurs ni l'acc√®s au code source.  Et sans interm√©diaire comme Bitcode, ce qui simplifie le processus. <br><br>  Bien s√ªr, le fant√¥me de macOS sur ARM tra√Æne depuis de nombreuses ann√©es.  Beaucoup se sont demand√© si cela faciliterait le portage d'applications √† l'aide de Bitcode.  En cons√©quence, ils sont parvenus √† un consensus sur le fait que Bitcode ne convient pas pour le transfert entre des architectures radicalement diff√©rentes telles qu'Intel et ARM. <br><br>  Cela ne m'a pas convaincu, j'ai donc d√©cid√© de v√©rifier! <br><br>  Pour commencer, nous avons besoin d'une application de test simple sur <b>Objective-C</b> avec Bitcode;  il est g√©n√©ralement inclus uniquement lors de la cr√©ation d'une archive pour l'App Store, vous devez donc le forcer √† √™tre inclus dans l'assemblage normal.  Vous pouvez utiliser l' <code>-fembed-bitcode</code> ou l'option de g√©n√©ration personnalis√©e: <br><br><pre> <code class="objectivec hljs">BITCODE_GENERATION_MODE = bitcode</code> </pre> <br>  Cr√©ez un binaire pour le p√©riph√©rique iOS g√©n√©rique ou le p√©riph√©rique connect√©, comme d'habitude.  Il semble que Bitcode ne soit pas int√©gr√© aux assemblages arm64e (par exemple, si vous avez un p√©riph√©rique A12), vous pouvez donc d√©sactiver le param√®tre Xcode ¬´compiler uniquement pour les architectures actives¬ª et compiler directement pour arm64. <br><br>  En utilisant l'outil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ebcutil,</a> tous les objets <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bitcode</a> sont facilement r√©cup√©r√©s √† partir d'un binaire compil√©. <br><br><pre> <code class="plaintext hljs">ebcutil -a arm64 -e path/to/MyApp.app/MyApp</code> </pre> <br>  Recompilez ensuite chaque objet Bitcode pour Intel. <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> clang -arch x86_64 -c -Xclang -disable-llvm-passes -emit-llvm -x ir -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk $f -o $fo; done</code> </pre> <br>  Nous allons maintenant relier les blobs compil√©s au fichier binaire. <br><br><pre> <code class="plaintext hljs">clang -arch x86_64 -mios-version-min=12.0 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk *.o -o path/to/MyApp.app/MyApp</code> </pre> <br>  Si cela fonctionne, nous avons maintenant la version x86 de l'application arm64 d'origine!  En th√©orie, il peut √™tre plac√© directement dans la fen√™tre du simulateur iOS, install√© et lanc√©. <br><br>  C'est un fait tr√®s important: <b>vous <i>pouvez</i> transf√©rer statiquement des fichiers binaires entre les plates-formes Intel et ARM s'ils incluent Bitcode</b> .  √áa marche vraiment! <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://hccdata.s3.amazonaws.com/blog/20190518.mov-blog.mp4" type="video/mp4"></video></div></div></div><br><blockquote><h4>  Pi√®ges pour des projets plus complexes </h4><br>  Il semble que l'ARC utilise l'assembleur int√©gr√©, donc pour le transfert d'arm64 vers x86 pour le moment, vous devez d√©sactiver ARC. <br><br>  Certains types de blocs, tels que les gestionnaires de compl√©tion, d√©marrent le compilateur avec des instructions inacceptables.  Si vous obtenez une erreur X87, c'est probablement le probl√®me. <br><br>  Pourquoi Objective-C?  Eh bien, Swift est con√ßu avec ARC √† l'esprit.  Je ne pense pas qu'il existe un moyen d'√©viter l'assembleur en ligne susmentionn√©, donc la recompilation √©chouera maintenant. </blockquote>  Faisons un pas de plus: nous utiliserons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">marzipanify</a> pour convertir cette application Intel iOS en un programme Mac qui fonctionne avec Marzipan. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/187/e0e/18d/187e0e18d39520cd7837887938f44f7b.jpg"><br><br>  C'√©tait facile! <br><br>  Th√©oriquement, cela signifie qu'Apple a un moyen d'ex√©cuter n'importe quelle application iOS depuis l'App Store sur un Mac sans exiger des d√©veloppeurs qu'ils mettent √† jour ou recompilent leurs applications. <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1129755947663056897"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Et si le Mac passe d'Intel aux puces ARM?  Eh bien, comme vous pouvez le voir, avec Bitcode, il peut transf√©rer toutes les applications compatibles Bitcode vers le Mac App Store sans l'aide des d√©veloppeurs, il sera donc pr√™t √† changer de processeur d√®s le premier jour.  Cela donne √† Apple plus de libert√©.  D√©sormais, vous n'avez pas besoin d'annoncer √† l'avance la transition vers de nouveaux processeurs un an √† l'avance, et une technologie comme Rosetta n'est plus n√©cessaire. <br><br>  √âvidemment, nous n'avons pas atteint ce point: aujourd'hui, Apple n'inclut pas Bitcode pour les applications dans le Mac App Store, et aujourd'hui Bitcode n'est peut-√™tre pas id√©al pour un tel transfert architectural.  Au lieu d'Apple, je me concentrerais sur ces deux facteurs et, bien s√ªr, activer Bitcode pour toutes les applications Marzipan sur macOS 10.15. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452734/">https://habr.com/ru/post/fr452734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452718/index.html">PsyGuide: d√©ficit d'attention. # 0001/1001</a></li>
<li><a href="../fr452722/index.html">Se faire des amis CI, tests unitaires et base de donn√©es</a></li>
<li><a href="../fr452724/index.html">Phoenix LiveView: quand le code javascript est amusant *</a></li>
<li><a href="../fr452726/index.html">Cute bones 3D: mat√©riau osseux hyper√©lastique pour les d√©fauts du cr√¢ne en plastique</a></li>
<li><a href="../fr452730/index.html">Certification des syst√®mes d'information sur le principe des segments standards. Mythes et r√©alit√©</a></li>
<li><a href="../fr452736/index.html">Cryptage des messages dans SecureDialogues</a></li>
<li><a href="../fr452738/index.html">Courte critique du t√©l√©phone IP Snom D717</a></li>
<li><a href="../fr452740/index.html">Une s√©lection de jeux de donn√©es pour l'apprentissage automatique</a></li>
<li><a href="../fr452742/index.html">Configuration du test automatique d'une application hybride</a></li>
<li><a href="../fr452744/index.html">Existe-t-il une vie compl√®te d'un √©loign√© sans √©changes ind√©pendants?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>