<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóíÔ∏è üõå üë≤üèæ Aprendemos promessas baseadas na especifica√ß√£o Ecmascript. Conhecimento ‚ùÑÔ∏è üßñüèø üï∫üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°. Estudando JavaScript (e, em princ√≠pio, qualquer outra tecnologia), sempre surgem v√°rias perguntas, a principal delas √©: ‚ÄúPor que funciona dessa m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprendemos promessas baseadas na especifica√ß√£o Ecmascript. Conhecimento</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478938/"><img src="https://habrastorage.org/webt/zo/be/at/zobeat0bkvnvgpgaxgkufwtm3li.png" alt="promessa de introdu√ß√£o"><br><br><p>  Ol√°.  Estudando JavaScript (e, em princ√≠pio, qualquer outra tecnologia), sempre surgem v√°rias perguntas, a principal delas √©: ‚ÄúPor que funciona dessa maneira e n√£o de outra forma?‚Äù E √© muito importante neste momento n√£o apenas encontrar a resposta para a pergunta, mas tamb√©m a explica√ß√£o recebida incorporar em um √∫nico sistema de conhecimento j√° adquirido.  Caso contr√°rio, as informa√ß√µes √≥rf√£s dever√£o ser memorizadas ou esquecidas. <br></p><br><p>  Aprender algo juntos ajuda muito a encontrar respostas.  Quando um aluno / companheiro faz uma pergunta sobre como entender a frase - "... o resultado da anterior" falha "na pr√≥xima promessa da cadeia ..." involuntariamente pensa ... Isso √© uma coisa t√£o estranha.  Mas voc√™ n√£o pode mais dizer melhor, n√£o est√° realmente claro?  Voc√™ olha nos olhos limpos e um pouco ing√™nuos do companheiro e entende - precisa dizer outra coisa.  √â desej√°vel que voc√™ nem precise memorizar.  Apenas novas informa√ß√µes se encaixam organicamente nos pensamentos humanos existentes. <br></p><br><p>  N√£o vou descrever o que tentamos, lemos, assistimos.  Como resultado, nos interessamos pela especifica√ß√£o ECMAScript.  Como ler e entender √© uma conversa em separado (talvez at√© um post em separado).  Mas o modo como as promessas e seu comportamento s√£o descritos l√°, pela primeira vez, nos deu uma compreens√£o hol√≠stica e logicamente coerente desse t√≥pico.  O que eu quero compartilhar com voc√™. <br></p><a name="habracut"></a><br><p>  Este artigo √© para iniciantes.  As promessas em termos da especifica√ß√£o ECMAScript ser√£o discutidas aqui.  Eu sei que parece estranho, mas como √©. <br></p><br><h2>  O objeto da promessa: sua filosofia, apresenta√ß√£o t√©cnica, estados poss√≠veis <br></h2><br><p>  J√° notei mais de uma vez que o treinamento de programa√ß√£o de alta qualidade deve consistir em 2 partes.  Este √© um entendimento filos√≥fico da id√©ia e, somente ent√£o, sua implementa√ß√£o t√©cnica.  Ou seja, a l√≥gica humana usual, pela qual o aluno √© orientado ao tomar qualquer decis√£o, facilita muito o entendimento da implementa√ß√£o t√©cnica dessa decis√£o.  Portanto, come√ßamos com o que √© uma promessa na vida, e como nos relacionamos com ela?  E ent√£o veremos: como exemplos de promessas ser√£o implementados no c√≥digo.  Considere as seguintes figuras (Fig. 1, 2, 3). <br></p><br><img src="https://habrastorage.org/webt/np/8l/ux/np8luxrdlenwq4o2lzikaludrlw.png" alt="Estado da promessa"><br>  <i>Figura 1. ([[PromiseState]] - como resultado de uma promessa)</i> <br><br><img src="https://habrastorage.org/webt/sj/xi/bq/sjxibq_vroug72q8bkdprh4rxik.png" alt="Resultado da promessa"><br>  <i>fig 2. ([[PromiseResult]] - como informa√ß√µes relacionadas ao resultado de uma promessa cumprida ou n√£o cumprida)</i> <br><br><img src="https://habrastorage.org/webt/2e/zj/l_/2ezjl_fhehmml3yhfqjijcnerbw.png" alt="Rea√ß√µes promissoras"><br>  <i>Figura 3. ([[[PromiseFulfillReactions]], [[PromiseRejectReactions]] - como consequ√™ncias que ocorrem ap√≥s o cumprimento ou n√£o de uma promessa)</i> <br><br><p>  Vemos que o pr√≥prio conceito de promessa assenta em 3 pilares.  1) A promessa foi cumprida?  2) Que informa√ß√µes adicionais podemos extrair ap√≥s cumprir ou recusar uma promessa?  3) Quais s√£o as consequ√™ncias se nossa promessa for positiva ou negativa? <br></p><br><p>  Tecnicamente, uma promessa √© uma entidade comum expressa atrav√©s de um tipo de dados como um objeto.  Essa entidade possui um nome / classe Promise.  Objetos nascidos dessa classe t√™m Promise.prototype em sua cadeia de prot√≥tipos.  E essa entidade deve estar de alguma forma conectada com todas as "informa√ß√µes da vida" que examinamos acima.  A especifica√ß√£o ECMAScript estabelece essas informa√ß√µes em uma promessa, mesmo em um n√≠vel de abstra√ß√£o menor que o pr√≥prio JavaScript.  Por exemplo, no n√≠vel do C ++.  Consequentemente, no objeto da promessa, h√° um lugar tanto sob o status quanto no resultado e sob as conseq√º√™ncias da promessa.  Veja em que consiste a promessa <a href="https://www.ecma-international.org/ecma-262/7.0/">do ECMAScript</a> (Figura 4). <br></p><br><img src="https://habrastorage.org/webt/bj/m5/lh/bjm5lhtxstjywkkfe6jnjqaqaes.png" alt="Campos da promessa"><br>  <i>Figura 4. (Campos internos do objeto de promessa de acordo com a especifica√ß√£o ECMAScript)</i> <br><br><p>  Que novas cores a frase ‚Äúpromessa n√£o significa casar‚Äù tocou em termos de programador?  1) [[PromiseState]].  Algu√©m n√£o se casou.  2) [[PromiseResult]].  Porque ele n√£o tinha dinheiro suficiente para o casamento.  3) [[PromiseRejectReactions]].  Como resultado, ele teve muito tempo livre que dedicou ao autodesenvolvimento 4) [[PromiseFulfillReactions]].  Por que uma pessoa precisa do plano B quando j√° escolheu o plano A? <br></p><br><p>  Sim, existe um quinto campo [[PromiseIsHandled]].  N√£o √© muito importante para n√≥s, pessoal, e n√£o iremos mais operar no futuro.  Em resumo: √© armazenado um sinal para o int√©rprete sobre se a promessa foi rejeitada pelo programador ou n√£o.  Caso contr√°rio, a rejei√ß√£o de promessa bruta √© interpretada pelo mecanismo JS como um erro.  Para os impacientes: se o programador n√£o travar a fun√ß√£o Promise.prototype.then () como manipulador de retorno de chamada do status de promessa rejeitada, o estado de promessa "rejeitada" do objeto mostrar√° um erro vermelho no console do desenvolvedor. <br></p><br><p>  Voc√™ notou que os campos do objeto de promessa est√£o entre "[[" e "]]"?  Isso enfatiza que o programador JS n√£o tem acesso direto a essas informa√ß√µes.  Somente por meio de ferramentas / comandos / API especiais, como o comando Promise.prototype.then ().  Se voc√™ tem um desejo irresist√≠vel de controlar ‚Äúesta cozinha‚Äù diretamente, seja bem-vindo ao clube de padr√µes de especifica√ß√£o EcmaScript. <br></p><br><p>  Uma breve observa√ß√£o no final deste subcap√≠tulo.  Se na vida em nosso pa√≠s as promessas podem ser parcialmente cumpridas, ent√£o no EcmaScript - n√£o.  Ou seja, se uma pessoa prometeu dar um milh√£o e deu 950 mil, ent√£o na vida talvez seja um parceiro confi√°vel, mas, para JavaScript, esse devedor ser√° colocado na lista negra atrav√©s de [[PromiseState]] === "rejeitado".  Um objeto Promise altera seu estado sem ambiguidade e apenas uma vez.  Como isso √© tecnicamente implementado √© um pouco mais tarde. <br></p><br><h2>  Designer Promise, sua filosofia.  O executor da fun√ß√£o de retorno de chamada √© como o "executor" de uma promessa.  Esquema de intera√ß√£o: Promessa (construtor) - executor (retorno de chamada) - promessa (objeto) </h2><br><p>  Assim, descobrimos que a promessa √© uma entidade que √© tecnicamente um objeto JS com campos internos ocultos especiais, que por sua vez fornecem preenchimento filos√≥fico com o significado da palavra ‚Äúpromessa‚Äù. <br></p><br><p>  Quando um iniciante cria um objeto de promessa pela primeira vez, a figura a seguir o aguarda (Fig. 5). <br></p><br><img src="https://habrastorage.org/webt/m1/xg/3u/m1xg3uoxgytd1nd2x7pc_z9i93m.png" alt="objeto de promessa de cria√ß√£o errado"><br>  <i>Figura 5. (Na primeira vez em que criamos intuitivamente um objeto de promessa)</i> <br><br><p>  O que deu errado e por que o erro √© uma pergunta padr√£o.  Ao responder, √© melhor trazer alguma analogia da vida novamente.  Por exemplo, poucas pessoas gostam de "carrilh√µes vazios" ao nosso redor: que apenas prometem, mas n√£o fazem nada para cumprir suas declara√ß√µes (a pol√≠tica n√£o conta).  Somos muito melhores naquelas pessoas que, ap√≥s sua promessa, t√™m um plano e imediatamente tomam alguma a√ß√£o para alcan√ßar o resultado prometido. <br></p><br><p>  Portanto, a filosofia ECMAScript implica que, se voc√™ criar uma promessa, indique imediatamente como a cumprir√°.  O programador precisa elaborar seu plano de a√ß√£o na forma de um par√¢metro de fun√ß√£o, que voc√™ passa para o construtor Promise.  O pr√≥ximo experimento √© assim (Fig. 6). <br></p><br><img src="https://habrastorage.org/webt/xh/sk/h7/xhskh7cuzrn1jxavomenlnfzwu0.png" alt="Construtor Promise usa executor"><br>  <i>Figura 6. (Crie um objeto de promessa, passando a fun√ß√£o executora para o construtor Promise)</i> <br><br><p>  Da legenda √† figura, vemos que a fun√ß√£o (par√¢metro do construtor Promise) tem seu pr√≥prio nome - executor.  Sua tarefa √© come√ßar a cumprir a promessa e, de prefer√™ncia, lev√°-la a algum tipo de conclus√£o l√≥gica.  E se o programador pode escrever qualquer c√≥digo no executor, como o programador pode sinalizar para JS que tudo - o trabalho est√° feito - voc√™ pode ver os resultados da promessa? <br></p><br><p>  Marcadores ou sinais que ajudam o programador a informar que a promessa foi conclu√≠da s√£o passados ‚Äã‚Äãautomaticamente aos par√¢metros executor-a na forma de argumentos especialmente formados por JavaScript.  Esses par√¢metros podem ser chamados como voc√™ quiser, mas na maioria das vezes voc√™ os encontrar√° sob nomes como res e rej.  Na especifica√ß√£o ECMAScript, o nome completo √© resolver fun√ß√£o e rejeitar fun√ß√£o.  Esses marcadores de fun√ß√£o t√™m caracter√≠sticas pr√≥prias, que consideraremos um pouco mais tarde. <br></p><br><p>  Para entender as novas informa√ß√µes, o rec√©m-chegado √© convidado a codificar independentemente a seguinte declara√ß√£o: "Prometo que posso dividir um n√∫mero em outro e dar uma resposta, se apenas o divisor n√£o for zero".  Aqui est√° a apar√™ncia do c√≥digo (fig. 7). <br></p><br><img src="https://habrastorage.org/webt/uu/to/gj/uutogjuluy9r5xxvwo2hrrwnaaq.png" alt="tarefa da promessa: divis√£o por zero"><br>  <i>Figura 7. (Solu√ß√£o do problema de dividir 2 n√∫meros por meio de promessas)</i> <br><br><p>  Agora voc√™ pode analisar o resultado.  Vemos que, pela segunda vez, o console do navegador mostra o objeto Promis de uma maneira interessante.  Ou seja: 2 campos adicionais s√£o indicados entre colchetes duplos.  Voc√™ pode tra√ßar com seguran√ßa uma analogia entre [[PromiseState]] e [[PromiseStatus]], conclu√≠da e resolvida, [[PromiseValue]] e [[PromiseResult]].  Sim, o pr√≥prio navegador tenta informar ao programador a presen√ßa e o valor dos campos internos do objeto de promessa.  Tamb√©m vemos o sistema conectado do objeto de promessa, a fun√ß√£o executora, a fun√ß√£o especial-callback-tokens res e rej. <br></p><br><p>  Para que o aluno / parceiro fique mais relaxado neste material, ele recebe o c√≥digo a seguir (Fig. 8).  √â necess√°rio analis√°-lo e responder √†s seguintes perguntas. <br></p><br><img src="https://habrastorage.org/webt/zs/md/vv/zsmdvv05gwmpi-vyq5a-d5sorjq.png" alt="tarefa da promessa: divis√£o por zero. Vers√£o alternativa"><br>  <i>Figura 8. (Varia√ß√£o da solu√ß√£o para o problema de dividir 2 n√∫meros por meio de promessas)</i> <br><br><p>  O c√≥digo funcionar√°?  Onde est√° a fun√ß√£o executora aqui e qual √© o seu nome?  O nome "wantToDivide" √© apropriado neste c√≥digo?  O que a fun√ß√£o de liga√ß√£o retorna depois de si mesma?  Por que os argumentos s√£o passados ‚Äã‚Äãpara a fun√ß√£o de liga√ß√£o apenas em segundo e terceiro lugar?  Onde as fun√ß√µes especiais resolveram a fun√ß√£o e a fun√ß√£o de rejei√ß√£o desapareceu?  Como os n√∫meros de entrada necess√°rios n√∫mero1 e n√∫mero2 entraram no "plano de cumprimento da promessa"?  Quantos elementos existem nos argumentos pseudo-array?  √â poss√≠vel recuperar da mem√≥ria como ser√° a resposta no console do navegador? <br></p><br><p>  O leitor √© convidado a pensar nas respostas para as perguntas.  Tambem <br>  experimento em c√≥digo.  Felizmente, o c√≥digo √© pequeno e a ideia da tarefa √© simples.  Sim, existem perguntas sobre as promessas e o conhecimento geral do JavaScript.  O que fazer, em todos os lugares, aguardamos surpresas que nos impedem de relaxar.  Assim que tudo ficar claro para voc√™, voc√™ poder√° seguir em frente. <br></p><br><div class="spoiler">  <b class="spoiler_title">Ver / copiar c√≥digo</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> number1 = <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(prompt(<span class="hljs-string"><span class="hljs-string">"input number 1"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> number2 = <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(prompt(<span class="hljs-string"><span class="hljs-string">"input number 2"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> wantToDivide = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] === <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">3</span></span>](<span class="hljs-string"><span class="hljs-string">"it is forbidden to divide by zero"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>](result); }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> myPromise = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(wantToDivide.bind(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, number1, number2)); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(myPromise);</code> </pre> <br></div></div><br><h2>  Considere argumentos executor-a: resolver e rejeitar fun√ß√µes <br></h2><br><p>  Ent√£o, tomamos um caf√© - seguimos em frente.  Vamos considerar com mais detalhes que as fun√ß√µes especiais resolvem a fun√ß√£o e rejeitam a fun√ß√£o, que s√£o geradas automaticamente pelo JavaScript para converter a promessa do objeto no estado cumprido ou rejeitado, o que simboliza o fim da promessa. <br></p><br><p>  Para iniciantes, vamos tentar v√™-los simplesmente no console do desenvolvedor (Fig. 9). <br></p><br><img src="https://habrastorage.org/webt/rz/ox/vj/rzoxvjvsvmt3962toiukmqtf9ye.png" alt="fun√ß√£o de resolu√ß√£o de pesquisa"><br>  <i>Figura 9. (Investiga√ß√£o da fun√ß√£o resolver fun√ß√£o - res)</i> <br><br><p>  Vemos que a fun√ß√£o resolver √© uma fun√ß√£o que recebe um argumento (comprimento da propriedade === 1).  E seu prot√≥tipo √© Function.prototype. <br></p><br><p>  Ok, vamos continuar os experimentos.  E o que acontecer√° se removermos o link da fun√ß√£o resolver / rejeitar do executor para o escopo externo?  Alguma coisa quebrar√° (fig. 10)? <br></p><br><img src="https://habrastorage.org/webt/9z/2i/cf/9z2icfrmkwiwfeeerdphezhtjay.png" alt="controle externo do objeto de promessa"><br>  <i>Figura 10. (Traduzimos a promessa myPromise para o estado cumprido fora da promessa)</i> <br><br><p>  Nada fora do comum.  Fun√ß√µes como subesp√©cie de um objeto em JavaScript s√£o passadas por refer√™ncia.  Tudo funcionou como esper√°vamos.  A vari√°vel do fechamento outerRes obteve uma refer√™ncia √† nossa fun√ß√£o de resolu√ß√£o res.  E usamos sua funcionalidade para colocar a promessa no estado cumprido fora do pr√≥prio executor.  O exemplo a seguir ligeiramente modificado mostra o mesmo pensamento; portanto, observe o c√≥digo e pense em qual estado e com que valor myPromise1 e myPromise2 ser√£o (Fig. 11).  Ent√£o voc√™ pode verificar suas suposi√ß√µes sob o spoiler. </p><br><img src="https://habrastorage.org/webt/re/gf/ov/regfovwn9xc5-jwlkftz0ed8vgc.png" alt="promessa tarefa. Pergunta">  <i>Figura 11. (A tarefa da reflex√£o. Em que estado e com que valor as promessas myPromise1 e myPromise2 estar√£o no console do desenvolvedor?)</i> <br><br><div class="spoiler">  <b class="spoiler_title">A resposta para o problema na Figura 11 (Figura 12).</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/iy/3x/k-/iy3xk-yuomgcgev4ddftqcffnvm.png" alt="promessa tarefa. Resposta"><br>  <i>Figura 12. (A resposta para o problema na Figura 11)</i> <br></div></div><br><p>  E agora voc√™ pode pensar em uma pergunta interessante.  Mas como a fun√ß√£o resolver / rejeitar sempre sabe exatamente qual promessa se traduz no estado necess√°rio?  Voltamos ao <a href="https://www.ecma-international.org/ecma-262/7.0/">algoritmo na especifica√ß√£o</a> , que descreve como essas fun√ß√µes s√£o criadas (Fig. 13). <br></p><br><img src="https://habrastorage.org/webt/4n/gq/k-/4ngqk-fikg8ddjo6uhe00_rhkci.png" alt="criar fun√ß√µes de resolu√ß√£o"><br>  <i>Figura 13. (Recursos de cria√ß√£o de fun√ß√µes de resolu√ß√£o para um objeto de promessa espec√≠fico)</i> <br><br><p>  Pontos importantes a serem observados: <br></p><br><ul><li>  no momento da cria√ß√£o das fun√ß√µes resolver / rejeitar, elas s√£o rigidamente anexadas ao √∫nico objeto de promessa correspondente a ele <br></li><li>  as fun√ß√µes resolver / rejeitar como um tipo de dados do objeto t√™m seus pr√≥prios campos ocultos [[Promise]] e [[AlreadyResolved]], que fornecem a todos a l√≥gica intuitiva familiar de que a) - as fun√ß√µes de resolu√ß√£o convertem o objeto da promessa no estado necess√°rio;  e o fato de que b) uma promessa n√£o pode ser transferida para outro estado se pelo menos uma vez que uma fun√ß√£o de resolu√ß√£o ou rejei√ß√£o foi solicitada.  Este algoritmo pode ser representado pela figura a seguir (Fig. 14). <br><br><img src="https://habrastorage.org/webt/0p/wt/1d/0pwt1dmqxhzhq0uuat_zljihrhc.png" alt="fun√ß√µes de resolu√ß√£o e objeto de promessa"><br>  <i>Figura 14. (Campos de fun√ß√£o ocultos da fun√ß√£o de resolu√ß√£o e fun√ß√£o de rejei√ß√£o)</i> <br><br><p>  Os algoritmos que usam essas informa√ß√µes de campos ocultos n√£o ser√£o considerados agora, pois s√£o detalhados e mais complexos.  Ainda precisamos nos preparar para eles, tanto te√≥rica quanto moralmente.  Por enquanto, apenas posso confirmar seu pensamento: ‚ÄúUau, como √© simples.  Provavelmente, a cada resolu√ß√£o / resolu√ß√£o da promessa do objeto, o sinalizador "objeto" {[[Valor]]: falso} ser√° verificado.  E se for definido como verdadeiro, paramos o processo de traduzir a promessa em outro estado com um retorno simples ".  Sim - √© exatamente isso que acontece.  Parece que voc√™ pode responder corretamente √† seguinte pergunta sem problemas.  Qual ser√° o resultado no console do desenvolvedor (Fig. 15)? <br></p><br><img src="https://habrastorage.org/webt/p6/1l/co/p61lcoillhsvjme0-hotfyacsoi.png" alt="experi√™ncia em vincular fun√ß√µes de resolu√ß√£o e objeto de promessa"><br>  <i>Figura 15. (Um experimento mostrando a rela√ß√£o entre as fun√ß√µes resolver e rejeitar com um objeto de promessa espec√≠fico)</i> <br><br><h2>  Algoritmo para criar um objeto de promessa de acordo com a especifica√ß√£o ECMAScript </h2><br><p>  Considere o momento fascinante em que nasce no mundo - um <a href="https://www.ecma-international.org/ecma-262/7.0/">objeto de promessa de</a> pleno direito (Fig. 16). <br></p><br><img src="https://habrastorage.org/webt/xm/yu/09/xmyu0944vrpk4ykurzgunwst0ji.png" alt="promessa de cria√ß√£o em ecmascript"><br>  <i>Figura 16. (Algoritmo para criar um objeto de promessa a partir da especifica√ß√£o EcmaScript)</i> <br><br><p>  Nenhuma pergunta complicada deve surgir ao visualiz√°-lo: </p><p></p><ul><li>  O construtor Promise deve ser chamado no modo construtor, e n√£o apenas uma chamada de fun√ß√£o <br></li><li>  O construtor Promise requer uma fun√ß√£o executora <br></li><li>  crie um objeto JavaScript com campos ocultos espec√≠ficos <br></li><li>  inicialize campos ocultos com alguns valores iniciais <br></li><li>  crie as fun√ß√µes de resolu√ß√£o e rejei√ß√£o associadas ao objeto de promessa <br></li><li>  chamamos a fun√ß√£o executora de execu√ß√£o, passando para l√° os tokens j√° gerados resolvem a fun√ß√£o e rejeitamos a fun√ß√£o como argumentos <br></li><li>  se durante a execu√ß√£o do executor - algo deu errado, coloque nosso objeto de promessa no estado rejeitado <br></li><li>  retornar √† vari√°vel o objeto de promessa de promessa nascida. <br></li></ul><br><p>  N√£o sei se foi uma descoberta para voc√™ que o algoritmo do executor da fun√ß√£o √© executado aqui e agora, no modo s√≠ncrono normal, mesmo antes de algo ser gravado na vari√°vel √† esquerda do construtor Promise.  Mas no devido tempo, para mim, tornou-se uma revela√ß√£o. <br></p><br><p>  Desde que abordamos o t√≥pico sincronismo e assincronia, eis o c√≥digo a seguir para voc√™ ‚Äúpensar‚Äù ou experimentar.  Pergunta: Tendo examinado alguma cria√ß√£o do programador Dima, voc√™ pode responder qual √© o significado do jogo codificado abaixo? <br></p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randomInteger</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">min, max</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(min + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * (max + <span class="hljs-number"><span class="hljs-number">1</span></span> - min)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> guessCubeNumber = <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(prompt(<span class="hljs-string"><span class="hljs-string">"Throw dice? Guess number?"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"throwing dice ... wait until it stop"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gameState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res, rej</span></span></span><span class="hljs-function">) </span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gottenNumberDice = randomInteger(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>); gottenNumberDice === guessCubeNumber ? res(<span class="hljs-string"><span class="hljs-string">"you win!"</span></span>) : rej(<span class="hljs-string"><span class="hljs-string">`you loose. </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${gottenNumberDice}</span></span></span><span class="hljs-string"> points dropped on dice`</span></span>); }, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gameState; } <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(game());</code> </pre><br><p>  Claro, isso √© uma emula√ß√£o de um rolo de matriz.  O usu√°rio pode adivinhar o n√∫mero que caiu ou n√£o?  Veja como o setTimeout organicamente ass√≠ncrono se integra ao executor s√≠ncrono - em nosso plano, jogue um dado e descubra o n√∫mero que caiu.  Como algu√©m pode interpretar os resultados no console do desenvolvedor de uma maneira especial (Fig. 17)? <br></p><br><p>  Se tentarmos olhar para a promessa at√© o cubo parar (3000 ms √© indicado no c√≥digo), veremos que a promessa ainda est√° em um estado de espera: o jogo n√£o terminou, o cubo ainda n√£o parou, n√£o h√° n√∫mero eliminado.  Se tentarmos olhar para o objeto de promessa depois que o cubo parar, veremos informa√ß√µes muito espec√≠ficas: se o usu√°rio venceu (adivinhando o n√∫mero) ou perdeu e por qu√™ (qual n√∫mero realmente caiu). <br></p><br><img src="https://habrastorage.org/webt/g4/oi/ba/g4oibarzyfjcrnzbvdqs9nqddqm.png" alt="jogo da promessa - jogando dados"><br>  <i>Figura 17. (O estado da promessa de um objeto quando h√° uma opera√ß√£o ass√≠ncrona na fun√ß√£o executora)</i> <br><br><p>  Se voc√™ estiver interessado neste exemplo ou se quiser adivinhar o n√∫mero de cubos invertidos, poder√° copiar o c√≥digo e conduzir suas experi√™ncias.  Atreva-se! <br></p><br><h2>  Rea√ß√£o da promessa como conseq√º√™ncia de uma promessa cumprida </h2><br><p>  Como voc√™ pode ver na Figura 14, as conseq√º√™ncias de resolver / resolver uma promessa de um objeto s√£o assinadas como "+ rea√ß√£o" e "rea√ß√£o".  O termo oficial para essas palavras da especifica√ß√£o ECMAScript √© rea√ß√£o de promessa.  Sup√µe-se que nos artigos a seguir este t√≥pico ser√° considerado em detalhes.  Por enquanto, nos limitamos √† id√©ia geral do que √© rea√ß√£o de promessa, para que este termo possa ser corretamente associado ao significado filos√≥fico dessa palavra e √† sua execu√ß√£o t√©cnica. <br></p><br><p>  Como lembramos, uma promessa pode ter consequ√™ncias, mas n√£o pode.  Qual a conseq√º√™ncia?  Esta √© uma a√ß√£o que acontecer√° algum tempo depois: depois que a promessa for cumprida.  E como essa √© uma a√ß√£o, a consequ√™ncia pode ser expressa por uma fun√ß√£o JavaScript normal.  Algumas fun√ß√µes ser√£o executadas no caso de uma resolu√ß√£o bem-sucedida da promessa (+ rea√ß√£o);  outras fun√ß√µes - no caso em que a promessa entra no estado rejeitado (rea√ß√£o).  Tecnicamente, essas fun√ß√µes (consequ√™ncias) s√£o passadas em argumentos quando o m√©todo Promise.prototype.then () √© chamado. <br></p><br><p>  Assim, uma parte importante de uma rea√ß√£o de promessa √© uma a√ß√£o ass√≠ncrona que √© executada em algum momento no futuro.  H√° um segundo componente importante da rea√ß√£o da promessa - esta √© a promessa rec√©m-criada retornada ap√≥s a execu√ß√£o do comando Promise.prototype.then ().  Isso ocorre porque as consequ√™ncias afetam outras promessas.  Por exemplo, existe a promessa de comprar um carro, mas somente ap√≥s a promessa de ganhar uma certa quantia de dinheiro.  Uma promessa foi cumprida - a conseq√º√™ncia elaborada - agora a segunda pode ser cumprida. <br></p><br><p>  De fato, uma rea√ß√£o de promessa liga promessas entre si em um determinado intervalo de tempo.  √â importante lembrar que a rea√ß√£o √© processada automaticamente.  As chamadas de fun√ß√£o - as conseq√º√™ncias da resolu√ß√£o de uma promessa - s√£o feitas pelo mecanismo JS, n√£o pelo programador (Fig. 18).  E, como as rea√ß√µes est√£o intimamente relacionadas aos objetos da promessa (promessas), √© l√≥gico supor que os algoritmos da rea√ß√£o da promessa usem seus campos internos em sua l√≥gica.  E √© melhor conhecer todas essas nuances para poder controlar conscientemente a l√≥gica ass√≠ncrona com base em promessas. <br></p><br><img src="https://habrastorage.org/webt/zc/tk/ja/zctkjapwx_daq-shustmj4yc5fo.png" alt="prometer rea√ß√£o no m√©todo then ()"><br>  <i>Figura 18. (As consequ√™ncias de resolver uma promessa s√£o registradas pelas fun√ß√µes de retorno de chamada no m√©todo then (). O retorno de chamada ser√° chamado de forma ass√≠ncrona automaticamente pelo mecanismo JS)</i> <br><br><h2>  Resumir </h2><br><p>  1) Nos familiarizamos com as promessas em JavaScript, sua filosofia e execu√ß√£o t√©cnica.  Tudo isso √© implementado usando campos de promessa internos especiais do objeto: [[PromiseState]], [[PromiseValue]], [[PromiseFulFillReactions]], [[PromiseRejectReactions]]. <br></p><br><p>  2) O programador tem a oportunidade de cumprir sua promessa atrav√©s da fun√ß√£o executora, passada como argumento ao construtor Promise. <br></p><br><p>  3) Os limites de uma promessa cumprida ou n√£o cumprida s√£o determinados por fun√ß√µes especiais de marcador, fun√ß√£o de resolu√ß√£o e fun√ß√£o de rejei√ß√£o, geralmente no c√≥digo chamado res e rej.  Essas fun√ß√µes s√£o criadas automaticamente por JavaScript e transmitidas em argumentos para o executor. <br></p><br><p>  4) a fun√ß√£o de resolu√ß√£o e a fun√ß√£o de rejei√ß√£o sempre t√™m um objeto de promessa associado a elas, al√©m de um campo especial comum {[[Valor]]: false}, que garante que a promessa seja resolvida apenas uma vez. <br></p><br><p>  5) [[PromiseFulFillReactions]] e [[PromiseRejectReactions]] s√£o campos internos do objeto de promessa que armazenam as conseq√º√™ncias da resolu√ß√£o da promessa, uma parte importante da qual s√£o fun√ß√µes ass√≠ncronas personalizadas definidas pelo m√©todo de promessa Promise.prototype.then () do objeto. <br></p><br><h2>  PS </h2><br><p>  Este artigo foi preparado como um resumo da sess√£o de v√≠deo do grupo InSimpleWords.  Existem ‚Äúv√≠deoaulas‚Äù suficientes e ainda h√° material para fazer anota√ß√µes.  Outra quest√£o √© se ser√° interessante para os membros da comunidade lerem o artigo sobre promessas seguidas.  Aguardando seus coment√°rios. <br></p><p></p><p></p></li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt478938/">https://habr.com/ru/post/pt478938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt478926/index.html">Lan√ßamento do .NET Core 3.1</a></li>
<li><a href="../pt478928/index.html">Python ou n√£o Python</a></li>
<li><a href="../pt478930/index.html">Como usar o MySQL sem uma senha (e riscos de seguran√ßa)</a></li>
<li><a href="../pt478932/index.html">Docker para o front-end. Parte 1. Por qu√™?</a></li>
<li><a href="../pt478934/index.html">O m√≥dulo de biblioteca padr√£o do Python mais √∫til que todos esquecem constantemente</a></li>
<li><a href="../pt478942/index.html">Grande experimento porn√¥: a hist√≥ria da Internet para adultos</a></li>
<li><a href="../pt478950/index.html">Os resultados da semana: a Huawei se adapta √†s san√ß√µes, Putin assina leis sensacionais e na R√∫ssia bloqueia o ShutterStock</a></li>
<li><a href="../pt478952/index.html">Um m√™s com o Onyx Boox Note Pro</a></li>
<li><a href="../pt478954/index.html">RE: Medo e √≥dio em TI</a></li>
<li><a href="../pt478956/index.html">Apresentando o 3CX V16 Update 4 Beta com um cliente de VoIP do Chrome e aplicativo de v√≠deo para Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>