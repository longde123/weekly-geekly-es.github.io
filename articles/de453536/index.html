<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè≠ üôÇ üêñ Exam Tracking: ExamCookie üò´ üë®üèΩ‚Äç‚úàÔ∏è üë®üèø‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich habe erfahren, dass die d√§nische Regierung nicht nur das Programm Digital Exam Monitor, das wir im vorherigen Artikel analysiert und vollst√§ndig u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Exam Tracking: ExamCookie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453536/"> Ich habe erfahren, dass die d√§nische Regierung nicht nur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das</a> Programm Digital Exam Monitor, das wir im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Artikel</a> analysiert und vollst√§ndig umgangen haben, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ausgesetzt hat</a> , sondern dieses System m√∂glicherweise eine Woche, nachdem wir sie √ºber die Hacking-Methode informiert hatten, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vollst√§ndig heruntergefahren hat</a> .  Ich m√∂chte nicht glauben, dass die d√§nische Regierung die Idee der √úberwachung von Pr√ºfungen nur wegen uns aufgegeben hat, aber unsere Arbeit wurde deutlich wahrgenommen. <br><br>  In diesem Artikel werden die technischen Details der Funktionsweise eines anderen Tools zur Verfolgung von Schulkindern beschrieben: ExamCookie.  Wenn Sie nur das System umgehen m√∂chten, scrollen Sie zum entsprechenden Abschnitt. <br><a name="habracut"></a><br><h1>  ExamCookie </h1><br>  Vor kurzem kam dieses Tool aufgrund einer Untersuchung des Versto√ües gegen die DSGVO in die Nachrichten.  Wir haben uns entschlossen, w√§hrend der Pr√ºfungen einen Blick auf den zweitgr√∂√üten Konkurrenten des oben genannten Schulverfolgungssystems zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werfen</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ExamCookie</a> .  Dies ist ein kommerzielles Tracking-System, das von mehr als 20 d√§nischen Schulen verwendet wird.  Auf der Website gibt es keine andere Dokumentation als die folgende Beschreibung: <br><br><blockquote>  ExamCookie ist eine einfache Software, die die Computeraktivit√§t des Sch√ºlers w√§hrend der Pr√ºfung √ºberwacht, um sicherzustellen, dass die Regeln eingehalten werden.  Das Programm verbietet Studenten, illegale Hilfe in Anspruch zu nehmen. <br><br>  ExamCookie speichert alle Aktivit√§ten auf dem Computer: aktive URLs, Netzwerkverbindungen, Prozesse, Zwischenablage und Screenshots beim √Ñndern der Fenstergr√∂√üe. </blockquote><br>  Das Programm funktioniert einfach: Wenn Sie an der Pr√ºfung teilnehmen, f√ºhren Sie sie auf Ihrem Computer aus und √ºberwachen Ihre Aktivit√§ten.  Wenn die Pr√ºfung abgeschlossen ist, wird das Programm geschlossen und Sie k√∂nnen es vom Computer entfernen. <br><br>  Um mit der Nachverfolgung zu beginnen, m√ºssen Sie Ihr UNI-Login verwenden, das auf verschiedenen Bildungsseiten funktioniert, oder Anmeldeinformationen manuell eingeben.  Wir haben das Tool nicht verwendet, daher k√∂nnen wir nicht sagen, in welchen F√§llen die manuelle Eingabe verwendet wird.  M√∂glicherweise wird dies f√ºr Studenten durchgef√ºhrt, die kein UNI-Login haben, was wir nicht f√ºr m√∂glich halten. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fa/791/152/8fa791152cd6b1442fb8ca7e738c6eeb.png"></div><br><br><h1>  Bin√§re Informationen </h1><br>  Das Programm kann von der ExamCookie-Homepage heruntergeladen werden.  Es ist eine x86 .NET-Anwendung.  Als Referenz hat der analysierte bin√§re MD5-Hash <code>63AFD8A8EC26C1DC368D8FF8710E337D</code> Signatur EXAMCOOKIE APS vom 24. April 2019.  Wie der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">letzte Artikel</a> gezeigt hat, kann die Analyse der .NET-Bin√§rdatei kaum als Reverse Engineering bezeichnet werden, da die Kombination aus einfach zu lesendem IL-Code und Metadaten einen perfekten Quellcode liefert. <br><br>  Im Gegensatz zum vorherigen √úberwachungsprogramm haben die Entwickler dieses Tools es nicht nur aus dem Debug-Protokoll gel√∂scht, sondern auch verschleiert.  Zumindest haben sie es versucht :-) <br><br><h1>  Verschleierung (Lachen zu Tr√§nen) </h1><br>  Als wir die Anwendung in dnSpy √∂ffneten, bemerkten wir schnell einen fehlenden Einstiegspunkt: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Token: 0x0600003D RID: 61 RVA: 0x00047BB0 File Offset: 0x00045FB0 [STAThread] [DebuggerHidden] [EditorBrowsable(EditorBrowsableState.Advanced)] [MethodImpl(MethodImplOptions.NoInlining | MethodImplOptions.NoOptimization)] internal static void Main(string[] Args) { }</span></span></code> </pre> <br>  Seltsamerweise wird normalerweise eine Art Wrapper angenommen, der die K√∂rper der Methoden vom Konstruktor des Moduls √§ndert, der zum eigentlichen Einstiegspunkt l√§uft. Mal sehen: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Token: 0x06000001 RID: 1 RVA: 0x00058048 File Offset: 0x00055048 static &lt;Module&gt;() { &lt;Module&gt;.\u206B\u202B\u200B\u206F\u206C\u202D\u200D\u200E\u202D\u206B\u206F\u206F\u202C\u202A\u206B\u202E\u202A\u206C\u202A\u206C\u200B\u206A\u202D\u206C\u202C\u206C\u200F\u202C\u206C\u202C\u200C\u206A\u200C\u206C\u200B\u206B\u202B\u206E\u202C\u202B\u202E(); &lt;Module&gt;.\u206C\u200D\u200F\u200E\u200C\u200C\u200F\u200F\u206E\u206A\u206A\u200B\u202C\u206A\u206B\u200D\u206E\u200E\u202D\u206B\u202C\u206C\u202D\u206D\u200C\u200F\u206E\u200F\u206E\u206A\u202B\u206B\u200E\u206B\u202E\u206F\u206A\u202E\u202C\u202A\u202E(); &lt;Module&gt;.\u200B\u202D\u200F\u200F\u202A\u206D\u202C\u206B\u206E\u202A\u206F\u206C\u200D\u200C\u202D\u200F\u202B\u202C\u202B\u206D\u206D\u202D\u206E\u200D\u206D\u206A\u202A\u202C\u200C\u206F\u206B\u206E\u200D\u202E\u206F\u200C\u206B\u200E\u206D\u206A\u202E(); }</span></span></code> </pre> <br>  Cool.  Es ist 2019 und die Leute benutzen immer noch Confuser (Ex). <br><br>  Wir haben diesen Dekomprimierungscode sofort erkannt und die Assembler-Header √ºberpr√ºft: <br><br><pre>  [Modul: ConfusedBy ("Confuser.Core 1.1.0 + a36320377a")] </pre><br>  Im Moment dachten wir, dass der Code tats√§chlich verschleiert sein w√ºrde, da der obige Konstruktor die K√∂rper und Ressourcen der Methode entschl√ºsselt.  Zu unserer √úberraschung entschied sich der Entwickler der Verschleierung jedoch, die Metadaten nicht umzubenennen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d2/cd2/01c/2d2cd201c523c4ca0ce981bd41570f6e.png"></div><br><br>  Dies t√∂tet das ganze Summen des Reverse Engineering.  Wie bereits in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fr√ºheren Artikel erw√§hnt</a> , m√∂chte ich auf das eigentliche Problem eines ordnungsgem√§√ü gesch√ºtzten und qualitativ hochwertigen √úberwachungsinstruments sto√üen, dessen Analyse mehr als f√ºnf Minuten dauern wird. <br><br>  In jedem Fall ist das Entpacken einer durch confuser (ex) gesch√ºtzten Bin√§rdatei sehr einfach: Verwenden Sie den Dumper f√ºr .NET-Bin√§rdateien oder den Haltepunkt f√ºr die break-Anweisung in &lt;MODULE&gt; .ctor und sichern Sie sich.  Der Vorgang dauert 30 Sekunden, und dieser Packer bleibt immer mein Favorit, da der Schutz vor dem Debuggen √ºberhaupt <i>nicht funktioniert</i> . <br><br>  Wir haben uns f√ºr MegaDumper entschieden: Dies ist etwas schneller als manuelles Dumping: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e72/e7e/877/e72e7e87788c6e50303005e34a3a3add.png"></div><br><br>  Nach dem Speichern der ExamCookie-Bin√§rdatei sollte die folgende Meldung angezeigt werden: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a32/7fe/b38/a327feb381752accdc31ff15e14b1ede.png"></div><br><br>  Jetzt haben Sie ein Verzeichnis mit allen Assembler-Fragmenten, die in den entsprechenden Prozess geladen werden, diesmal mit entschl√ºsselten Methodenk√∂rpern. <br><br>  Wer auch immer diese Verschleierung implementiert hat, Gott sei Dank, hat zumindest die Zeilen verschl√ºsselt: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.SymbolicLink)) { Module1.DebugPrint(&lt;Module&gt;.smethod_5&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">1582642794u</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.Tiff)) { Module1.DebugPrint(&lt;Module&gt;.smethod_2&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">4207351461u</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.UnicodeText)) { Module1.DebugPrint(&lt;Module&gt;.smethod_5&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">3536903244u</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.WaveAudio)) { Module1.DebugPrint(&lt;Module&gt;.smethod_2&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">2091555364u</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); }</code> </pre> <br>  Ja, der gute alte String-Verschl√ºsselungs-Confuser (Ex), die beste Pseudo-Sicherheit in der Welt von .NET.  Es ist gut, dass Confuser (Ex) so oft gehackt wurde, dass im Internet f√ºr jeden Mechanismus Deobfuscation-Tools verf√ºgbar sind, sodass wir nichts mit .NET zu tun haben.  F√ºhren Sie den ConfuserExStringDecryptor von <i>CodeCracker</i> auf dem Bin√§rdump aus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52d/0f7/c63/52d0f7c6366fda44ab4264876f801f7b.png"></div><br><br>  Das vorherige Snippet wird folgenderma√üen konvertiert: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.SymbolicLink)) { Module1.DebugPrint(<span class="hljs-string"><span class="hljs-string">"ContainsData.SymbolicLink"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.Tiff)) { Module1.DebugPrint(<span class="hljs-string"><span class="hljs-string">"ContainsData.Tiff"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.UnicodeText)) { Module1.DebugPrint(<span class="hljs-string"><span class="hljs-string">"ContainsData.UnicodeText"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.WaveAudio)) { Module1.DebugPrint(<span class="hljs-string"><span class="hljs-string">"ContainsData.WaveAudio"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); }</code> </pre> <br>  Das ist der gesamte Schutz der Anwendung, der in weniger als einer Minute unterbrochen wurde. Wir werden unsere Tools hier nicht ver√∂ffentlichen, da wir sie nicht entwickelt haben und keinen Quellcode haben.  Aber jeder, der den Job wiederholen m√∂chte, kann sie auf <i>Tuts4You finden</i> .  Wir haben kein tuts4you-Konto mehr, daher k√∂nnen wir keine Verkn√ºpfung zu den Spiegeln herstellen. <br><br><h1>  Funktionalit√§t </h1><br>  √úberraschenderweise wurde keine echte "versteckte Funktionalit√§t" gefunden.  Wie auf der Website angegeben, werden die folgenden Informationen regelm√§√üig an den Server gesendet: <br><br><ul><li>  Prozessliste (alle 5000 ms) <br></li><li>  Aktive Anwendung (alle 1000 ms) <br></li><li>  Zwischenablage (alle 500 ms) <br></li><li>  Screenshot (alle 5000 ms) <br></li><li>  Liste der Netzwerkadapter (alle 20.000 ms) </li></ul><br>  Der Rest der Anwendung ist sehr langweilig, daher haben wir beschlossen, den gesamten Initialisierungsvorgang zu √ºberspringen und direkt zu den Funktionen zu wechseln, die f√ºr die Erfassung von Informationen verantwortlich sind. <br><br><h2>  Adapter </h2><br>  Netzwerkadapter werden von der Funktion .NET <code>NetworkInterface.GetAllNetworkInterfaces()</code> genau wie im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Artikel zusammengestellt</a> : <br><br><pre> <code class="cpp hljs">NetworkInterface[] allNetworkInterfaces = NetworkInterface.GetAllNetworkInterfaces(); foreach (NetworkInterface networkInterface in allNetworkInterfaces) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... // TEXT FORMATTING OMITTED // ... dictionary.Add(networkInterface.Id, stringBuilder.ToString()); stringBuilder.Clear(); } catch (Exception ex) { AdapterThread.OnExceptionEventHandler onExceptionEvent = this.OnExceptionEvent; if (onExceptionEvent != null) { onExceptionEvent(ex); } } } result = dictionary;</span></span></code> </pre> <br><h2>  Aktive Anwendung </h2><br>  Das wird interessant.  Anstatt alle ge√∂ffneten Fenster zu registrieren, steuert das Dienstprogramm nur die aktive Anwendung.  Die Implementierung ist √ºbertrieben, daher pr√§sentieren wir einen sch√∂nen Pseudocode: <br><br><pre> <code class="cpp hljs">var whiteList = { <span class="hljs-string"><span class="hljs-string">"devenv"</span></span>, <span class="hljs-string"><span class="hljs-string">"ExamCookie.WinClient"</span></span>, <span class="hljs-string"><span class="hljs-string">"ExamCookie.WinClient.vshost"</span></span>, <span class="hljs-string"><span class="hljs-string">"wermgr"</span></span>, <span class="hljs-string"><span class="hljs-string">"ShellExperienceHost"</span></span> }; <span class="hljs-comment"><span class="hljs-comment">// GET WINDOW INFORMATION var foregroundWindow = ApplicationThread.GetForegroundWindow(); ApplicationThread.GetWindowRect(foregroundWindow, ref rect); ApplicationThread.GetWindowThreadProcessId(foregroundWindow, ref processId); var process = Process.GetProcessById(processId); if (process == null) return; // LOG BROWSER URL if (IsBrowser(process)) { var browserUrl = UiAutomation32.GetBrowserUrl(process.Id, process.ProcessName); // SEND BROWSER URL TO SERVER if (ValidBrowserUrl(browserUrl)) { ReportToServer(browserUrl); } } else if (!whiteList.contains(process.ProcessName, StringComparer.OrdinalIgnoreCase)) { ReportToServer(process.MainWindowTitle); }</span></span></code> </pre> <br>  Gro√üartig ... Leute verwenden immer noch Prozessnamen, um sie zu unterscheiden.  Sie h√∂ren nie auf und denken nicht: ‚ÄûMoment mal, Sie k√∂nnen die Namen der Prozesse nach Belieben √§ndern‚Äú, damit wir diesen Schutz sicher umgehen k√∂nnen. <br><br>  Wenn Sie einen vorherigen Artikel √ºber ein anderes Pr√ºfungsverfolgungsprogramm lesen, werden Sie diese unterdurchschnittliche Implementierung f√ºr Browser wahrscheinlich erkennen: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsBrowser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(System.Diagnostics.Process proc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> left = proc.ProcessName.ToLower(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operators.CompareString(left, <span class="hljs-string"><span class="hljs-string">"iexplore"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Operators.CompareString(left, <span class="hljs-string"><span class="hljs-string">"chrome"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Operators.CompareString(left, <span class="hljs-string"><span class="hljs-string">"firefox"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Operators.CompareString(left, <span class="hljs-string"><span class="hljs-string">"opera"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Operators.CompareString(left, <span class="hljs-string"><span class="hljs-string">"cliqz"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operators.CompareString(left, <span class="hljs-string"><span class="hljs-string">"applicationframehost"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { result = proc.MainWindowTitle.Containing(<span class="hljs-string"><span class="hljs-string">"Microsoft Edge"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { result = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetBrowserName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operators.CompareString(name.ToLower(), <span class="hljs-string"><span class="hljs-string">"iexplore"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"IE-Explorer"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operators.CompareString(name.ToLower(), <span class="hljs-string"><span class="hljs-string">"chrome"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Chrome"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operators.CompareString(name.ToLower(), <span class="hljs-string"><span class="hljs-string">"firefox"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Firefox"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operators.CompareString(name.ToLower(), <span class="hljs-string"><span class="hljs-string">"opera"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Opera"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operators.CompareString(name.ToLower(), <span class="hljs-string"><span class="hljs-string">"cliqz"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Cliqz"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operators.CompareString(name.ToLower(), <span class="hljs-string"><span class="hljs-string">"applicationframehost"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Microsoft Edge"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; }</code> </pre> <br>  Und die Kirsche auf dem Kuchen: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetBrowserUrlById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object processId, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... automationElement.GetCurrentPropertyValue(/*...*/); return url; }</span></span></code> </pre> <br>  Dies ist buchst√§blich die gleiche Implementierung wie im vorherigen Artikel.  Es ist schwer zu verstehen, dass die Entwickler immer noch nicht erkannt haben, wie schlimm es ist.  Jeder kann die URL im Browser bearbeiten, dies ist nicht einmal eine Demonstration wert. <br><br><h2>  Erkennung virtueller Maschinen </h2><br>  Im Gegensatz zu den Aussagen der Website setzt das Starten in einer virtuellen Maschine ein Flag.  Die Implementierung ist ... interessant. <br><br><pre> <code class="cpp hljs">File.WriteAllBytes(<span class="hljs-string"><span class="hljs-string">"ecvmd.exe"</span></span>, Resources.VmDetect); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Process process = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Process()) { process.StartInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProcessStartInfo(<span class="hljs-string"><span class="hljs-string">"ecvmd.exe"</span></span>, <span class="hljs-string"><span class="hljs-string">"-d"</span></span>) { CreateNoWindow = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, UseShellExecute = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, RedirectStandardOutput = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; process.Start(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamReader standardOutput = process.StandardOutput) { result = standardOutput.ReadToEnd().Replace(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex3) { result = <span class="hljs-string"><span class="hljs-string">"-5"</span></span>; } }</code> </pre> <br>  Aus irgendeinem Grund schreiben sie eine externe Bin√§rdatei auf die Festplatte und f√ºhren sie aus. Dann verlassen sie sich vollst√§ndig auf die E / A-Ergebnisse.  Das passiert wirklich ziemlich oft, aber die √úbertragung solch wichtiger Arbeiten auf einen anderen ungesch√ºtzten Prozess ist mittelm√§√üig.  Mal sehen, mit welcher Datei wir es zu tun haben: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b13/e09/99c/b13e0999c55fb0e0686aa91bc16265db.png"></div><br><br>  Also verwenden wir jetzt C ++?  Nun, Interoperabilit√§t ist eigentlich nicht unbedingt schlecht.  Und das kann bedeuten, dass wir jetzt wirklich am Reverse Engineering arbeiten m√ºssen (!!).  Schauen wir uns die IDA an: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">cdecl </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **envp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v3; <span class="hljs-comment"><span class="hljs-comment">// ecx BOOL v4; // ebx int v5; // ebx int *v6; // eax int detect; // eax bool vbox_key_exists; // bl char vpcext; // bh char vmware_port; // al char *vmware_port_exists; // ecx char *vbox_detected; // edi char *vpcext_exists; // esi int v14; // eax int v15; // eax int v16; // eax int v17; // eax int v18; // eax int v20; // [esp+0h] [ebp-18h] HKEY result; // [esp+Ch] [ebp-Ch] HKEY phkResult; // [esp+10h] [ebp-8h] if ( argc != 2 ) goto LABEL_20; v3 = strcmp(argv[1], "-d"); if ( v3 ) v3 = -(v3 &lt; 0) | 1; if ( !v3 ) { v4 = (unsigned __int8)vm_detect::vmware_port() != 0; result = 0; v5 = (vm_detect::vpcext() != 0 ? 2 : 0) + v4; RegOpenKeyExA(HKEY_LOCAL_MACHINE, "HARDWARE\\ACPI\\DSDT\\VBOX__", 0, 0x20019u, &amp;result); v6 = sub_402340(); LABEL_16: sub_404BC0((int)v6, v20); return 0; } detect = strcmp(argv[1], "-s"); if ( detect ) detect = -(detect &lt; 0) | 1; if ( !detect ) { LABEL_20: phkResult = 0; vbox_key_exists = RegOpenKeyExA(HKEY_LOCAL_MACHINE, "HARDWARE\\ACPI\\DSDT\\VBOX__", 0, 0x20019u, &amp;phkResult) == 0; vpcext = vm_detect::vpcext(); vmware_port = vm_detect::vmware_port(); vmware_port_exists = "1"; vbox_detected = "1"; if ( !vbox_key_exists ) vbox_detected = "0"; vpcext_exists = "1"; if ( !vpcext ) vpcext_exists = "0"; if ( !vmware_port ) vmware_port_exists = "0"; result = (HKEY)vmware_port_exists; v14 = std::print((int)&amp;dword_433310, "VMW="); v15 = std::print(v14, (const char *)result); v16 = std::print(v15, ",VPC="); v17 = std::print(v16, vpcext_exists); v18 = std::print(v17, ",VIB="); v6 = (int *)std::print(v18, vbox_detected); goto LABEL_16; } return 0; }</span></span></code> </pre> <br>  Dadurch wird das Vorhandensein des VMWare-E / A-Ports 'VX' √ºberpr√ºft: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __fastcall vm_detect::vmware_port() { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; <span class="hljs-comment"><span class="hljs-comment">// eax result = __indword('VX'); LOBYTE(result) = 0; return result; }</span></span></code> </pre> <br>  Als n√§chstes wird die Ausf√ºhrung der Anweisung zur <i>Erweiterung</i> des <i>virtuellen PCs</i> √ºberpr√ºft, die nur beim Start in einer virtualisierten Umgebung funktionieren sollte, wenn sie bei falscher Verarbeitung nicht zu einem Maschinenabsturz f√ºhrt;): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> vm_detect::vpcext() { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> result; <span class="hljs-comment"><span class="hljs-comment">// al result = 1; __asm { vpcext 7, 0Bh } return result; }</span></span></code> </pre> <br>  ... kein echtes Reverse Engineering, nur 30 Sekunden, um zwei Funktionen umzubenennen :( <br><br>  Dieses Programm liest einfach den Registrierungsschl√ºssel und f√ºhrt zwei Hypervisor-√úberpr√ºfungen durch, die im Vergleich zu ihrem anderen Programm seltsam aussehen.  Ich frage mich, wo sie es kopiert haben?  Oh, schauen Sie, ein Artikel mit dem Titel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Methoden zum Erkennen virtueller (sic) Maschinen"</a> , der diese Methoden erkl√§rt :).  In jedem Fall k√∂nnen diese Erkennungsvektoren umgangen werden, indem Sie die .vmx-Datei bearbeiten oder eine erweiterte Version eines Hypervisors Ihrer Wahl verwenden. <br><br><h1>  Datenschutz </h1><br>  Wie bereits erw√§hnt, l√§uft derzeit eine Untersuchung wegen Nichteinhaltung der DSGVO. Auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Website</a> hei√üt es: <br><br><blockquote>  Die Daten werden verschl√ºsselt und an einen sicheren Microsoft Azure-Server gesendet, auf den nur mit den richtigen Anmeldeinformationen zugegriffen werden kann.  Nach der Pr√ºfung werden die Daten bis zu drei Monate gespeichert. </blockquote><br>  Wir sind uns nicht ganz sicher, wie sie die "Sicherheit" des Servers bestimmen, da die Anmeldeinformationen in der Anwendung fest codiert und in den Metadatenressourcen in vollst√§ndig klarem Text gespeichert sind: <br><br><pre>  Endpunkt: https://examcookiewinapidk.azurewebsites.net
 Benutzername: VfUtTaNUEQ
 Passwort: AwWE9PHjVc </pre><br>  Wir haben den Inhalt des Servers nicht untersucht (dies ist illegal), k√∂nnen jedoch davon ausgehen, dass dort vollst√§ndiger Zugriff gew√§hrt wird.  Da das Konto in der Anwendung fest codiert ist, besteht keine Isolation zwischen den Sch√ºlerdatencontainern. <br><br>  <i>Rechtliche Hinweise: Wir behalten uns das Recht vor, API-Anmeldeinformationen zu ver√∂ffentlichen, da diese in einer √∂ffentlichen Bin√§rdatei gespeichert sind und daher nicht illegal abgerufen werden.</i>  <i>Die Verwendung mit b√∂swilliger Absicht verst√∂√üt jedoch eindeutig gegen das Gesetz. Wir empfehlen daher dringend, dass die Leser die oben genannten Anmeldeinformationen in keiner Weise verwenden und nicht f√ºr m√∂gliche Handlungen verantwortlich sind.</i> <br><br><h1>  Umgehen </h1><br>  Da diese Anwendung unglaublich an Digital Exam Monitor erinnert, haben wir gerade den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ayyxam-</a> Code aktualisiert, um ExamCookie zu unterst√ºtzen. <br><br><h2>  Prozessliste </h2><br>  Die .NET-Prozessschnittstelle speichert Prozessdaten intern mithilfe des <code>ntdll!NtQuerySystemInformation</code> .  Das Ausblenden von Prozessen erfordert einige Arbeit, da an vielen Stellen Informationen √ºber den Prozess angezeigt werden.  Gl√ºcklicherweise ruft .NET nur einen bestimmten Informationstyp ab, sodass Sie nicht alle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Latebros-</a> Methoden verwenden m√ºssen. <br><br>  Code zur Umgehung der Validierung aktiver Prozesse. <br><br><pre> <code class="cpp hljs">NTSTATUS WINAPI ayyxam::hooks::nt_query_system_information( SYSTEM_INFORMATION_CLASS system_information_class, PVOID system_information, ULONG system_information_length, PULONG return_length) { <span class="hljs-comment"><span class="hljs-comment">// DONT HANDLE OTHER CLASSES if (system_information_class != SystemProcessInformation) return ayyxam::hooks::original_nt_query_system_information( system_information_class, system_information, system_information_length, return_length); // HIDE PROCESSES const auto value = ayyxam::hooks::original_nt_query_system_information( system_information_class, system_information, system_information_length, return_length); // DONT HANDLE UNSUCCESSFUL CALLS if (!NT_SUCCESS(value)) return value; // DEFINE STRUCTURE FOR LIST struct SYSTEM_PROCESS_INFO { ULONG NextEntryOffset; ULONG NumberOfThreads; LARGE_INTEGER Reserved[3]; LARGE_INTEGER CreateTime; LARGE_INTEGER UserTime; LARGE_INTEGER KernelTime; UNICODE_STRING ImageName; ULONG BasePriority; HANDLE ProcessId; HANDLE InheritedFromProcessId; }; // HELPER FUNCTION: GET NEXT ENTRY IN LINKED LIST auto get_next_entry = [](SYSTEM_PROCESS_INFO* entry) { return reinterpret_cast&lt;SYSTEM_PROCESS_INFO*&gt;( reinterpret_cast&lt;std::uintptr_t&gt;(entry) + entry-&gt;NextEntryOffset); }; // ITERATE AND HIDE PROCESS auto entry = reinterpret_cast&lt;SYSTEM_PROCESS_INFO*&gt;(system_information); SYSTEM_PROCESS_INFO* previous_entry = nullptr; for (; entry-&gt;NextEntryOffset &gt; 0x00; entry = get_next_entry(entry)) { constexpr auto protected_id = 7488; if (entry-&gt;ProcessId == reinterpret_cast&lt;HANDLE&gt;(protected_id) &amp;&amp; previous_entry != nullptr) { // SKIP ENTRY previous_entry-&gt;NextEntryOffset += entry-&gt;NextEntryOffset; } // SAVE PREVIOUS ENTRY FOR SKIPPING previous_entry = entry; } return value; }</span></span></code> </pre> <br><h2>  Puffer </h2><br>  <code>ole32.dll!OleGetClipboard</code> , das sehr anf√§llig f√ºr Hooks ist, ist f√ºr die interne Implementierung von Puffern in .NET verantwortlich.  Anstatt viel Zeit mit der Analyse interner Strukturen zu verbringen, k√∂nnen Sie einfach <code>S_OK</code> , und die .NET-Fehlerbehandlung <code>S_OK</code> den Rest: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> __stdcall ayyxam::hooks::get_clipboard(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* data_object[[maybe_unused]]) { <span class="hljs-comment"><span class="hljs-comment">// LOL return S_OK; }</span></span></code> </pre> <br>  Dadurch wird der gesamte Puffer vor dem ExamCookie-√úberwachungstool ausgeblendet, ohne die Funktionalit√§t des Programms zu beeintr√§chtigen. <br><br><h2>  Screenshots </h2><br>  Wie immer nehmen die Leute eine fertige .NET-Implementierung der gew√ºnschten Funktion.  Um diese Funktion zu umgehen, mussten wir im vorherigen Code nicht einmal etwas √§ndern.  Screenshots werden von der <code>Graphics.CopyFromScreen</code> .NET-Funktion gesteuert.  Es ist im Wesentlichen ein Wrapper zum √úbertragen von <code>gdi32!BitBlt</code> , der <code>gdi32!BitBlt</code> .  Wie in Videospielen zur Bek√§mpfung von Anti-Cheat-Systemen, die Screenshots machen, k√∂nnen wir den BitBlt-Hook verwenden und unerw√ºnschte Informationen ausblenden, bevor wir einen Screenshot machen. <br><br><br><h2>  Websites √∂ffnen </h2><br>  Die Grabber-URL wird vollst√§ndig aus dem vorherigen Programm kopiert, sodass wir unseren Code erneut verwenden k√∂nnen, um den Schutz zu umgehen.  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">letzten Artikel haben</a> wir die AutomationElement-Struktur dokumentiert, wodurch der folgende Hook gestartet wird: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> __stdcall ayyxam::hooks::get_property_value(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* handle, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> property_id, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* value) { <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> value_value_id = <span class="hljs-number"><span class="hljs-number">0x755D</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (property_id != value_value_id) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ayyxam::hooks::original_get_property_value(handle, property_id, value); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = ayyxam::hooks::original_get_property_value(handle, property_id, value); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != S_OK) <span class="hljs-comment"><span class="hljs-comment">// SUCCESS? return result; // VALUE URL IS STORED AT 0x08 FROM VALUE STRUCTURE class value_structure { public: char pad_0000[8]; //0x0000 wchar_t* value; //0x0008 }; auto value_object = reinterpret_cast&lt;value_structure*&gt;(value); // ZERO OUT OLD URL std::memset(value_object-&gt;value, 0x00, std::wcslen(value_object-&gt;value) * 2); // CHANGE TO GOOGLE.COM constexpr wchar_t spoofed_url[] = L"https://google.com"; std::memcpy(value_object-&gt;value, spoofed_url, sizeof(spoofed_url)); return result; }</span></span></code> </pre> <br><h2>  Erkennung virtueller Maschinen </h2><br>  Die verz√∂gerte Erkennung einer virtuellen Maschine kann auf zwei Arten umgangen werden: 1) ein Patch eines Programms, das auf die Festplatte geschrieben wird;  oder 2) eine Umleitung des Prozesserstellungsprozesses zu einer Dummy-Anwendung.  Letzteres scheint deutlich einfacher :).  <code>Process.Start()</code> ruft <code>Process.Start()</code> <code>CreateProcess</code> es einfach ein und leiten Sie es an eine beliebige Dummy-Anwendung weiter, die das Zeichen '0' druckt. <br><br><pre> <code class="cpp hljs">BOOL WINAPI ayyxam::hooks::create_process( LPCWSTR application_name, LPWSTR command_line, LPSECURITY_ATTRIBUTES process_attributes, LPSECURITY_ATTRIBUTES thread_attributes, BOOL inherit_handles, DWORD creation_flags, LPVOID environment, LPCWSTR current_directory, LPSTARTUPINFOW startup_information, LPPROCESS_INFORMATION process_information ) { <span class="hljs-comment"><span class="hljs-comment">// REDIRECT PATH OF VMDETECT TO DUMMY APPLICATION constexpr auto vm_detect = L"ecvmd.exe"; if (std::wcsstr(application_name, vm_detect)) { application_name = L"dummy.exe"; } return ayyxam::hooks::original_create_process( application_name, command_line, process_attributes, thread_attributes, inherit_handles, creation_flags, environment, current_directory, startup_information, process_information); }</span></span></code> </pre> <br><h2>  Herunterladen </h2><br>  Das gesamte Projekt ist im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github-Repository</a> verf√ºgbar.  Das Programm f√ºgt die x86-Bin√§rdatei in den entsprechenden Prozess ein. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453536/">https://habr.com/ru/post/de453536/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453524/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 299 (vom 20. bis 26. Mai)</a></li>
<li><a href="../de453526/index.html">ITSM - was ist das und wo soll mit der Implementierung begonnen werden?</a></li>
<li><a href="../de453528/index.html">Psion SIBO - PDAs, die nicht einmal emuliert werden m√ºssen</a></li>
<li><a href="../de453532/index.html">Xamarin-API-Dokumente: Open Sourced und jetzt verf√ºgbar</a></li>
<li><a href="../de453534/index.html">Physiklehrer erobert Big Data in Schottland</a></li>
<li><a href="../de453538/index.html">Hardwarekomponenten des Bord-MPS des Unified Strike Fighter F-35</a></li>
<li><a href="../de453540/index.html">Wie 5G unsere Herangehensweise an Shopping und soziale Netzwerke ver√§ndern wird</a></li>
<li><a href="../de453542/index.html">Der vierbeinige Roboter konnte ein 3,3 Tonnen schweres Flugzeug ziehen</a></li>
<li><a href="../de453544/index.html">Sieben-Segment-Decoder, der sowohl direkte als auch inverse Ausg√§nge eines BCD-Z√§hlers verwendet</a></li>
<li><a href="../de453546/index.html">Ben√∂tigen Sie eine kleine Tastatur - machen Sie es selbst</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>