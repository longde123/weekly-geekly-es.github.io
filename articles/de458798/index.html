<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¢ üíÑ üßñüèø N√§hrstoff-Bot oder wie ich Brot von Fitnesstrainern nehmen m√∂chte üë®‚Äçüë¶‚Äçüë¶ üèûÔ∏è üé¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Alle Entwickler haben einmal den Wunsch, etwas f√ºr sich selbst zu tun, und selbst der materielle Wert des Produkts wird unwichtig. H...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>N√§hrstoff-Bot oder wie ich Brot von Fitnesstrainern nehmen m√∂chte</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458798/"> Hallo allerseits!  Alle Entwickler haben einmal den Wunsch, etwas f√ºr sich selbst zu tun, und selbst der materielle Wert des Produkts wird unwichtig. Hauptsache, es funktioniert von selbst.  Buzz. <br><br>  Deshalb wollte ich allein in den Maiferien Programmierkenntnisse und andere wichtige Informationen in einem Projekt kombinieren.  Es stellte sich meiner Meinung nach als interessanter Dienst heraus, dem ich Leben geben und √ºber den ich sprechen m√∂chte. <br><br>  Ich bin kein Ern√§hrungsberater, kein Profisportler und nat√ºrlich tue ich nicht so, als w√ºrden sie mir ohne Frage vertrauen.  Aber einmal interessierte ich mich sehr f√ºr das Thema richtige Ern√§hrung, und ich begann Artikel zu studieren, mit coolen Trainern in den von mir besuchten Hallen zu sprechen und bemerkte so etwas: Die Leute geben ziemlich viel Geld f√ºr die Erstellung von Ern√§hrungspl√§nen aus. <br><br>  Und ich habe mich entschieden: Aber ich werde ein solches System erstellen, das die Produkte von Personen automatisch in Gramm berechnet, abh√§ngig von ihrem Zweck und ihren Parametern. <br><br>  Da ich ein Backend-Entwickler bin, sto√üe ich selten auf die Front. Ich habe dar√ºber nachgedacht und beschlossen, einen Bot zu erstellen.  Die Wahl des Messenger wurde von mehreren Faktoren beeinflusst: Nachfrage und Verf√ºgbarkeit von Zahlungssystemen.  Das soziale Netzwerk Vkontakte ist entstanden. <br><br>  F√ºr Berechnungen habe ich die Harris-Benedict-Formel verwendet.  Ich habe solche Eingabeparameter ber√ºcksichtigt (die der Benutzer des Bots eingibt): <br><br><ul><li>  Gewicht </li><li>  Wachstum </li><li>  Ziel (abnehmen / zunehmen / aufrechterhalten) </li><li>  K√∂rperliche Aktivit√§t (alle Informationen sind verf√ºgbar und Standard f√ºr Berechnungen nach der Harris-Benedict-Formel) </li><li>  Laktosetoleranz </li><li>  Geschlecht </li></ul><br>  Erstellt eine Produktdatenbank, in der das Produkt Felder enth√§lt: Proteine, Fette, Kohlenhydrate, Kcal, GI (glyk√§mischer Index) sowie Laktosegehalt.  Im Allgemeinen m√∂chte ich eine Auflistung und einen Kommentar auf dem Weg geben. <br><br>  Vkontakte verf√ºgt √ºber eine zug√§ngliche und verst√§ndliche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">API</a> <br><br>  Verwendete die PHP-Sprache. <br><a name="habracut"></a><br>  Zun√§chst identifizierte ich mehrere notwendige Funktionen und Konstanten: <br><br><pre><code class="php hljs">header(<span class="hljs-string"><span class="hljs-string">'Content-Type: text/html; charset=utf-8'</span></span>); $request = file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://input"</span></span>); $input = json_decode($request, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); define(<span class="hljs-string"><span class="hljs-string">'VK_API_VERSION'</span></span>, <span class="hljs-string"><span class="hljs-string">'5.95'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  API define('VK_API_ENDPOINT', "https://api.vk.com/method/"); //     API function _vkApi_call($method, $params = array()) { $params['access_token'] = //    ,        ; $params['v'] = VK_API_VERSION; $url = VK_API_ENDPOINT.$method.'?'.http_build_query($params); $curl = curl_init($url); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); $json = curl_exec($curl); curl_close($curl); $response = json_decode($json, true); return $response['error']['error_msg']; $err=$response['error']['error_msg']; } //   messages.send function vkApi_messagesSend($peer_id, $message) { return _vkApi_call('messages.send', array( 'peer_id' =&gt; $peer_id, 'user_id' =&gt; $peer_id, 'message' =&gt; $message, 'random_id' =&gt; rand(), 'qroup_id' =&gt; //      () ));} //      function vkApi_buttonSend($peer_id, $message,$button) { return _vkApi_call('messages.send', array( 'peer_id' =&gt; $peer_id, 'user_id' =&gt; $peer_id, 'message' =&gt; $message, 'random_id' =&gt; rand(), 'keyboard' =&gt; $button, 'qroup_id' =&gt; //      () ));}</span></span></code> </pre> <br>  In den Einstellungen des Bots geben Sie einen Link zu Ihrem Skript (Webhook) an.  √úbrigens k√∂nnen Sie in der VK-API zwei Methoden zum Empfangen von Nachrichten verwenden.  Ich habe Webhooks verwendet.  Es scheint mir, dass es bequemer und vertrauter ist. <br><br>  Als n√§chstes verarbeite ich den resultierenden JSON. <br><br><pre> <code class="php hljs">$test_type=$input[<span class="hljs-string"><span class="hljs-string">'type'</span></span>]; $test_group_id=$input[<span class="hljs-string"><span class="hljs-string">'group_id'</span></span>]; $user_id=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'user_id'</span></span>]; $text=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'body'</span></span>]; $text_body=explode(<span class="hljs-string"><span class="hljs-string">" "</span></span>, $text); $vk_pay=$text_body[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $caption=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'attachments'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'link'</span></span>][<span class="hljs-string"><span class="hljs-string">'caption'</span></span>]; $url=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'attachments'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'link'</span></span>][<span class="hljs-string"><span class="hljs-string">'url'</span></span>]; $str3=$input[<span class="hljs-string"><span class="hljs-string">'object'</span></span>][<span class="hljs-string"><span class="hljs-string">'attachments'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'link'</span></span>][<span class="hljs-string"><span class="hljs-string">'title'</span></span>]; $str2 = explode(<span class="hljs-string"><span class="hljs-string">" "</span></span>, $str3); $money =(int)$str2[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $money=strstr($str3, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $money=(int)$money;</code> </pre><br>  Da VK √ºber Zahlungssysteme verf√ºgt, habe ich die Zahlung per VK-Bezahlung (VK-Server senden solche Anfragen an Ihren Webhook, jedoch nur, wenn Ihre √ñffentlichkeit als STORE angegeben ist und es ein PRODUKT gibt, das √ºber VK-Bezahlung bezahlt werden kann) sowie eine einfache Barzahlung in Betracht gezogen Eine √úbersetzung, die an die Nachricht angeh√§ngt werden kann. <br><br>  Ich speichere jeden Benutzer, der etwas in den Bot schreibt, in die Datenbank, und dann findet die gesamte Kommunikation mit dem Bot abh√§ngig von der Zahlung statt.  Wenn es keine Zahlung gab, sagt der Bot, dass Sie zuerst bezahlen m√ºssen. Wenn die Zahlung erfolgt ist, teilt er Ihnen mit, was als n√§chstes zu tun ist.  Zum Testen k√∂nnen Sie eine beliebige Nachricht an den Bot eingeben, um ihn zu planen. <br><br>  Nach der Zahlung fragt der Bot nach den f√ºr die Berechnung erforderlichen Parametern, ich speichere alles in der Datenbank f√ºr einen bestimmten Benutzer und nach all den erhaltenen Informationen denke ich nach und gebe eine Antwort.  Ich sende eine Nachricht mit der erstellten Funktion und gebe die Benutzer-ID des Benutzers an: <br><br><pre> <code class="php hljs">vkApi_messagesSend($user_id, <span class="hljs-string"><span class="hljs-string">'!   ?'</span></span>);</code> </pre><br>  Es wurde auch der Moment ber√ºcksichtigt, in dem der Benutzer einige Informationen falsch eingegeben hat: In diesem Fall m√ºssen Sie die Nummer 404 an den Bot senden, und er fragt zuerst und setzt die Daten in der Datenbank zur√ºck. <br><br>  Bei einigen Nachrichten war es f√ºr mich praktisch, Schaltfl√§chen zu erstellen. Als ich darauf klickte, flog mir eine Nachricht mit dem auf der Schaltfl√§che angegebenen Text im Webhook zu. <br><br><pre> <code class="php hljs">$buttons=<span class="hljs-string"><span class="hljs-string">'{ "one_time":true, "buttons":[[{ "action":{ "type":"text", "payload":"{\"button\": \"1\"}", "label":" " }, "color":"primary" }, { "action":{ "type":"text", "payload":"{\"button\": \"2\"}", "label":" " }, "color":"primary"}]]}'</span></span>; vkApi_buttonSend($user_id,<span class="hljs-string"><span class="hljs-string">' '</span></span>,$buttons) ;</code> </pre><br>  Und dann den ganzen Spa√ü!  Nach den gesammelten Daten erfolgt die Berechnung selbst.  Ich erfinde selbst nichts, ich erstelle nur die notwendigen Formeln richtig, basierend auf der Harris-Benedict-Formel, sowie Kenntnisse auf dem Gebiet der richtigen Ern√§hrung (die Anzahl der Mahlzeiten, die prozentuale Verteilung von Proteinen / Fetten / Kohlenhydraten f√ºr diese Empf√§nge usw. sind hier wichtig). <br><br>  Im Allgemeinen sind solche Dinge: <br><br><pre> <code class="php hljs">$BMR=<span class="hljs-number"><span class="hljs-number">88.363</span></span>+(<span class="hljs-number"><span class="hljs-number">13.397</span></span>*$weight)+(<span class="hljs-number"><span class="hljs-number">4.799</span></span>*$height)-(<span class="hljs-number"><span class="hljs-number">5.677</span></span>*$age); $BMR_AMR=$BMR*<span class="hljs-number"><span class="hljs-number">1.2</span></span><span class="hljs-number"><span class="hljs-number">-500</span></span>; $b_kkal=<span class="hljs-number"><span class="hljs-number">0.35</span></span>*$BMR_AMR; $b_gr=$b_kkal/<span class="hljs-number"><span class="hljs-number">4</span></span>; $g_kkal=<span class="hljs-number"><span class="hljs-number">0.3</span></span>*$BMR_AMR; $g_gr=$g_kkal/<span class="hljs-number"><span class="hljs-number">9</span></span>; $u_kkal=<span class="hljs-number"><span class="hljs-number">0.35</span></span>*$BMR_AMR; $u_gr=$u_kkal/<span class="hljs-number"><span class="hljs-number">4</span></span>; $break_b=<span class="hljs-number"><span class="hljs-number">0.15</span></span>*$b_gr; $break_u=<span class="hljs-number"><span class="hljs-number">0.25</span></span>*$u_gr; $break_g=<span class="hljs-number"><span class="hljs-number">0.25</span></span>*$g_gr; $break_kk=<span class="hljs-number"><span class="hljs-number">0.25</span></span>*$BMR_AMR; $snack_b=<span class="hljs-number"><span class="hljs-number">0.1</span></span>*$b_gr; $snack_u=<span class="hljs-number"><span class="hljs-number">0.1</span></span>*$u_gr; $snack_g=<span class="hljs-number"><span class="hljs-number">0.15</span></span>*$g_gr; $snack_kk=<span class="hljs-number"><span class="hljs-number">1</span></span>*$BMR_AMR; $snack2_b=<span class="hljs-number"><span class="hljs-number">0.05</span></span>*$b_gr; $snack2_u=<span class="hljs-number"><span class="hljs-number">0.05</span></span>*$u_gr; $snack2_kk=<span class="hljs-number"><span class="hljs-number">0.05</span></span>*$BMR_AMR; $lunch_b=<span class="hljs-number"><span class="hljs-number">0.45</span></span>*$b_gr; $lunch_u=<span class="hljs-number"><span class="hljs-number">0.4</span></span>*$u_gr; $lunch_g=<span class="hljs-number"><span class="hljs-number">0.4</span></span>*$g_gr; $lunch_kk=<span class="hljs-number"><span class="hljs-number">0.4</span></span>*$BMR_AMR; $dinner_b=<span class="hljs-number"><span class="hljs-number">0.25</span></span>*$b_gr; $dinner_u=<span class="hljs-number"><span class="hljs-number">0.2</span></span>*$u_gr; $dinner_g=<span class="hljs-number"><span class="hljs-number">0.2</span></span>*$g_gr; $dinner_kk=<span class="hljs-number"><span class="hljs-number">0.2</span></span>*$BMR_AMR;</code> </pre><br>  Dementsprechend wird es f√ºr Menschen mit einem sitzenden Lebensstil und Menschen mit Hyperaktivit√§t andere Faktoren geben, ich habe ein kleines Beispiel gegeben. <br><br>  Nach der Berechnung von BZHU und KKAL sammle ich eine Reihe von Produkten.  √úbrigens, wenn Sie nach dem erhaltenen Ern√§hrungsplan die Nummer 404 eingeben und erneut beginnen (es ist m√∂glich, Gewicht zu verlieren / zuzunehmen, √Ñnderungen des Lebensstils usw.), √§ndert sich die Produktmenge nach dem Zufallsprinzip.  Und jetzt haben Sie einen anderen Ern√§hrungsplan! <br><br>  Infolgedessen haben wir hier einen solchen Service erhalten (ich habe ihn offiziell zum Testen ver√∂ffentlicht, der Entwickler ist ein Anf√§nger und ich selbst kann nicht alle meine Fehler abfangen, wenn sie pl√∂tzlich existieren): <br><br><div class="spoiler">  <b class="spoiler_title">Bot Screenshots</b> <div class="spoiler_text"><table border="1"><tbody><tr><td><img src="https://habrastorage.org/webt/qy/mv/hr/qymvhrailyruujlwrvsesgmev1a.jpeg" alt="Bild" width="260"></td><td><img src="https://habrastorage.org/webt/6c/gc/b6/6cgcb65wzabxqnwzay24aug2vmm.jpeg" alt="Bild" width="260"></td></tr><tr><td><img src="https://habrastorage.org/webt/5g/yu/gk/5gyugkfknyncnta50ax3tgjlvpi.jpeg" alt="Bild" width="260"></td><td><img src="https://habrastorage.org/webt/ed/l0/g_/edl0g_ncvpj3v2gduo8mqawmy2q.jpeg" alt="Bild" width="260"></td></tr></tbody></table></div><br></div><br><h3>  Von den Fehlern, die ich bemerkt habe (muss verbessert werden): </h3><br><ul><li>  Tasten √∂ffnen sich nicht sofort.  Sie m√ºssen das Tastatursymbol neben der Schaltfl√§che "Senden" finden.  Dies verwirrt die Leute wirklich und sie schreiben falsch (wenn die Schaltfl√§che gedr√ºckt wird, verarbeite ich den Text von der Schaltfl√§che, die Daten, die der Benutzer selbst eingibt, werden ignoriert). </li><li>  Keine sehr gro√üe Datenbank mit Produkten, angesichts der Tatsache, dass niemand dies essen wird. </li></ul><br>  F√ºr diejenigen, die den Link zur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√ñffentlichkeit</a> testen und sehen m√∂chten. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458798/">https://habr.com/ru/post/de458798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458788/index.html">Benutzerdefinierte Vorlagen in GTM: ein Beispiel</a></li>
<li><a href="../de458790/index.html">Einf√ºhrung in CatBoost. Yandex-Bericht</a></li>
<li><a href="../de458792/index.html">"Verbrannte" Mitarbeiter: Gibt es einen Ausweg?</a></li>
<li><a href="../de458794/index.html">Business Analysts Meeting bei Redmadrobot am 18. Juli</a></li>
<li><a href="../de458796/index.html">So bereiten Sie Ihre Site auf hohe Arbeitslasten vor: 5 praktische Tipps und n√ºtzliche Tools</a></li>
<li><a href="../de458800/index.html">Tiefes Lernen. F√∂deriertes Lernen</a></li>
<li><a href="../de458804/index.html">Zusammenfassung der Artikel √ºber maschinelles Lernen und k√ºnstliche Intelligenz</a></li>
<li><a href="../de458808/index.html">Habr Postmortem-Bericht: Zeitung fiel</a></li>
<li><a href="../de458810/index.html">Corel und Parallels wurden aus den USA an die KKR Investment Group verkauft</a></li>
<li><a href="../de458812/index.html">JVM TI: Wie erstelle ich ein Plugin f√ºr eine virtuelle Maschine?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>