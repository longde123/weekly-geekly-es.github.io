<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå™Ô∏è üï¥üèª üéÜ ZFS-Speicher-, Standby- und Testumgebungen ‚òÄÔ∏è üèûÔ∏è üòì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Haben wir ein Bild f√ºr Januar, n√§her am Februar? 
 - Jetzt mal sehen ... Ja, das gibt es! Jetzt √∂ffnen. 

 Es kommt vor, dass es eine durchschnittli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ZFS-Speicher-, Standby- und Testumgebungen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/417373/">  <i>- Haben wir ein Bild f√ºr Januar, n√§her am Februar?</i> <i><br></i>  <i>- Jetzt mal sehen ... Ja, das gibt es!</i>  <i>Jetzt √∂ffnen.</i> <br><br>  Es kommt vor, dass es eine durchschnittliche Lebensdauer der Testbasis gibt, es gibt eine Lebensdauer f√ºr Schnappsch√ºsse, auf die sich alle Interessierten geeinigt haben, aber einige der Umgebungen ‚Äûverweilen‚Äú zu lange in ihrem Bild, was nicht gel√∂scht werden kann ... und es stellt sich dann als n√ºtzlich f√ºr Kollegen heraus.  Und Minus bis Minus gibt ein Plus. <br><br>  Normalerweise m√ºssen Sie f√ºr alle Systeme, auf denen etwas passieren kann, Sicherungen erstellen.  Und wenn es noch entwickelt und finalisiert wird, ist es auch notwendig, irgendwo Entwicklungs- und Testumgebungen bereitzustellen.  Dar√ºber hinaus ben√∂tigen Sie f√ºr Sicherungen und Testumgebungen, die tats√§chlich mit denselben Daten arbeiten, viel Speicherplatz.  Und doch m√ºssen diese Umgebungen irgendwie zum aktuellen Zustand f√ºhren.  Und all dies erfordert Hardware und Zeitressourcen. <br><br>  In unserem Fall wurden diese Anforderungen von den Oracle ZFS Storage Appliance- und Oracle / Sun-Servern abgedeckt, die tats√§chlich in dasselbe √ñkosystem wie Exadata integriert wurden, das kurz vor ihnen erschien. <br><a name="habracut"></a><br>  Da es in Exadata einen InfiniBand-Switch gibt, √ºber den seine Komponenten kommunizieren, und ZFS Storage auch eine Oracle-Appliance ist, gilt Folgendes: <br><br><ul><li>  Erstens war es √ºber einen Teil seiner Ports direkt mit diesem Switch verbunden. </li><li>  Zweitens k√∂nnen Tablespace-Dateien mit Segmenten gespeichert werden, die in der Exadata Hybrid Columnar Compression (EHCC) komprimiert sind, wodurch wir viel Platz im Hauptsystem sparen.  Wenn Sie versuchen, die Datenbank auf einem separaten Server wiederherzustellen, wird nach der Wiederherstellung unter Bezugnahme auf die komprimierten Daten die folgende Fehlermeldung angezeigt: "ORA-64307: Die hybride Spaltenkomprimierung wird f√ºr Tablespaces auf diesem Speichertyp nicht unterst√ºtzt" - aufgrund der Datendateien im EHCC komprimiert sollte in der Oracle Appliance gespeichert werden; </li><li> Drittens er√∂ffnet dies die M√∂glichkeit, ZFS-Kapazit√§ten zum Speichern von Testumgebungsdateien zu verwenden. </li></ul><br>  Was ist mit dem Ort?  Doppelarbeit muss vermieden werden. <br><br>  Testumgebungen ben√∂tigen dieselben Daten wie in Sicherungen.  K√∂nnen diese Daten beide Funktionen ausf√ºhren?  Als Backup und Basis f√ºr jede privilegierte Testumgebung, die einen vollst√§ndigen Datensatz ben√∂tigt?  Sie k√∂nnen! <br><br>  Die Oracle ZFS Storage Appliance ist ein Array, das unter anderem die M√∂glichkeit bietet, Netzwerkfreigaben zu bilden, die unter dem ZFS-Dateisystem ausgef√ºhrt werden.  Innerhalb des ZFS-Dateisystems k√∂nnen Snapshots erstellt werden, auf deren Grundlage Sie Klone bereitstellen k√∂nnen, die als neue Netzwerkfreigaben angezeigt werden.  Wir nutzen diese Gelegenheit wie folgt: <br><br><ol><li>  Auf dem ZFS-Speicher (wie wir das Array nennen werden, um nicht mit dem Dateisystem verwechselt zu werden) werden zwei Freigaben erstellt - Archivelog wird zu einer und Datenbankdateien zu der anderen hinzugef√ºgt; </li><li>  Die Freigabe wird auf dem Oracle / Sun-Server (der auch die Appliance ist) bereitgestellt, und auf dem Server selbst steigt eine Instanz der Oracle-Datenbank an, die als kaskadierter physischer Standby fungiert. Sie empf√§ngt Protokolle von einer bedingten Sicherungssite und wendet die √Ñnderungen auf die Dateien in der Freigabe an. </li><li>  Die Verwendung von Protokollen ist nach dem Prinzip der Arbeitseinheit organisiert (Hallo an alle Teilnehmer am verteilten Rechnen!).  Auf der Ebene des Algorithmus wird das Konzept der Arbeitseinheit eingef√ºhrt, das einem bestimmten Zeitintervall entspricht.  Nachdem die Protokolle f√ºr das erforderliche Intervall gerollt wurden, wird die Instanz angehalten und die Dateien verbleiben in der Freigabe in einem konsistenten Zustand relativ zueinander und zur Steuerdatei.  In der Tat ist dies ein kaltes Backup, es ist auch eine Image-Kopie, auf der ein Schnappschuss erstellt wird. </li><li>  Wenn die Testumgebung neu erstellt werden muss, wird aus dem gew√ºnschten Snapshot ein Klon erstellt.  Es wird auf dem Server bereitgestellt, auf dem die Umgebung ausgef√ºhrt wird. Anschlie√üend werden die darin enthaltenen Dateien als Datenbank unter einem anderen Namen und im Lese- / Schreibmodus ge√∂ffnet. </li><li>  W√§hrend der Arbeit in der Testbasis werden √Ñnderungen vorgenommen, die als Teil des Klons verschoben werden und langsam wachsen.  Am Ende des Lebenszyklus w√§chst das Medium maximal. </li><li>  Um den Speicherplatzverbrauch zu reduzieren, verwenden wir die LZJB-Komprimierung, die ZFS Storage im laufenden Betrieb ausf√ºhrt. </li></ol><br>  Zusammenfassend: <br><br><ol><li>  In der aktuellen Konfiguration k√∂nnen Testumgebungen E / A bis zu 3,75 Gbit / s ausf√ºhren. <br>  Das Maximum f√ºr das Lesen wird durch die vorhandenen InfiniBand-Porteinstellungen auf dem Server begrenzt, das Maximum f√ºr das Schreiben betr√§gt die CPU auf ZFS-Speichercontrollern und erreicht etwa 2 Gbit / s.  (Ja, ja! Da 10 GbE nicht ausreichten, wurden separate Switches f√ºr Testserver gekauft, darunter ZFS Storage und die Server selbst.) </li><li>  Pro Tag werden mehrere Schnappsch√ºsse erstellt, die nun je nach Basis zwischen 2 Wochen und 2 Monaten gespeichert werden.  Danach werden sie alle gel√∂scht, mit Ausnahme der Schnappsch√ºsse, die am 1. eines jeden Monats um 00:00 Uhr erstellt wurden. Diese werden l√§nger als ein Viertel gespeichert.  Es gab F√§lle, in denen sich Schnappsch√ºsse, die etwa <i>sechs Monate lang aufbewahrt</i> wurden, als n√ºtzlich erwiesen. </li><li>  Bei Bedarf kann die gesamte Industriedatenbank aus dem gew√ºnschten Snapshot wiederhergestellt werden.  Auch mit einer Geschwindigkeit in der Gr√∂√üenordnung von 1 ... 3 Gbit / s, aber die Option, einen Klon aus dem gew√ºnschten Snapshot zu erstellen, ist viel beliebter, aus dem die Daten der gew√ºnschten Tabellen dann entladen werden. </li><li>  Die Zeit zum Wiederherstellen der Testumgebung betr√§gt ca. 1 Stunde (mit der √úbertragung einer Reihe zus√§tzlicher Schaltkreise usw.). </li><li>  Die Zeit, um Kollegen einen Klon zur Verf√ºgung zu stellen, von dem Sie Daten f√ºr die Wiederherstellung oder nur eine Art von Analyse sammeln k√∂nnen, betr√§gt 15 Minuten (mit einer idealen Kombination von Bedingungen) bis 1-2 Stunden (mit einer gro√üen parallelen Belastung von ZFS Storage oder us J). </li><li>  Bei Bedarf k√∂nnen Sie aus dem Snapshot und Klon sowie der gesamten Datenbank wiederherstellen. </li><li>  Eine wesentliche Leistungsbeschr√§nkung ist die Anzahl der IOPS, die von Testumgebungen oder Instanzen von kaskadiertem Standby generiert werden.  Und hier verh√§lt sich das System absolut angemessen und vorhersehbar - sobald die Anzahl auf 75 IOPS pro Festplatte (es enth√§lt 3,5-Zoll-Festplatten mit 7200 U / min) bei l√§ngerer Last eingestellt wird, beginnt das System allm√§hlich durchzuh√§ngen.  Und zeitlich klein - Write- und Read-Flash sind sp√ºrbar einfacher; </li><li>  Die Anzahl der IOPS, die Gesamtmenge der eingehenden Daten, die Belastung der CPU, die Anzahl der Lesevorg√§nge aus den Caches im RAM und in Flash sowie mehrere Dutzend (wenn nicht Hunderte) Metriken k√∂nnen in der Webverwaltungsoberfl√§che angezeigt werden. </li><li>  Sie k√∂nnen mit ZFS-Speicherobjekten mithilfe der in der Dokumentation beschriebenen REST-Anforderungen arbeiten.  Mit ihrer Hilfe war es m√∂glich, das Entfernen veralteter Schnappsch√ºsse zu automatisieren, aber es kann noch viel mehr getan werden! </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de417373/">https://habr.com/ru/post/de417373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de417355/index.html">Kahlheit: Theorie und Praxis der Behandlung, Teil 2 ‚ÄûAuch die Prostata hat Mandeln, Prostaglandine‚Äú</a></li>
<li><a href="../de417357/index.html">Desktops "√úber IT". Geschichte der Computer-Einstellungsspiele</a></li>
<li><a href="../de417359/index.html">Informationssicherheit? Nein, nicht geh√∂rt</a></li>
<li><a href="../de417367/index.html">Wie weit gehen Tr√§ume von der perfekten ‚ÄûDateisuche‚Äú?</a></li>
<li><a href="../de417369/index.html">15 Tools f√ºr das Arbeitsarsenal des Produktmanagers</a></li>
<li><a href="../de417375/index.html">15 HTML-Elementmethoden, von denen Sie wahrscheinlich noch nie geh√∂rt haben</a></li>
<li><a href="../de417377/index.html">Warum sollten Sie Google Cloud nicht verwenden?</a></li>
<li><a href="../de417379/index.html">Neuer Feststoffraketenmotor f√ºr Vega-C und Ariane 6</a></li>
<li><a href="../de417383/index.html">JavaScript ES6: Schw√§chen</a></li>
<li><a href="../de417385/index.html">Wie ich umgezogen bin ... nach Hause oder meine Antwort an den Autor des Artikels √ºber "gnadenloses Mehl"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>