<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë®üèø üèáüèΩ üçà Expandir las capacidades de red de un rel√© programable usando WI-FI ‚ûï ü•Å ‚ô®Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como empez√≥ todo 
 Todo comenz√≥ con el desarrollo de algoritmos para el rel√© programable PR200, y a menudo requer√≠a visualizaci√≥n o entrada de informa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Expandir las capacidades de red de un rel√© programable usando WI-FI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424791/"><h2>  Como empez√≥ todo </h2><br>  Todo comenz√≥ con el desarrollo de algoritmos para el rel√© programable PR200, y a menudo requer√≠a visualizaci√≥n o entrada de informaci√≥n desde una computadora, para esto es necesario usar paneles de operador o sistemas SCADA, pero esto no siempre es conveniente, y es necesario para sistemas simples.  La soluci√≥n se encontr√≥ r√°pidamente, y con el tiempo trat√© de mejorar y facilitar mi trabajo en esta direcci√≥n lo m√°s posible, lo que result√≥ de la lectura. <br>  Hablaremos sobre la tarjeta de red WI-FI y sus capacidades. <br><br><img src="https://habrastorage.org/webt/z7/0j/nn/z70jnnmuwed2qwcdyhbqjhni0-w.jpeg" alt="imagen"><br><a name="habracut"></a><br>  Dado que esta placa se utiliza para depurar varios proyectos, la interfaz de interacci√≥n se modifica constantemente para una configuraci√≥n m√°s conveniente y r√°pida.  La primera modificaci√≥n fue un simple convertidor RS-485 a TCP con salida a WEB, con firmware ya conocido en la comunidad ESP8266.  Han pasado m√°s de 2 a√±os desde entonces, y se necesitaron archivos para analizar procesos que requieren mucho tiempo, y como quer√≠a combinar todo esto en un dispositivo sin equipo adicional, se decidi√≥ integrar el soporte microSD, lo que facilit√≥ enormemente el an√°lisis de procesos con la capacidad de acceder r√°pidamente archivos  La segunda modificaci√≥n de la placa ten√≠a una ranura, con la capacidad de extraer una tarjeta microSD para guardar archivos grabados en la computadora.  No me pareci√≥ muy conveniente, y apareci√≥ una versi√≥n con la capacidad de descargar archivos a trav√©s de WI-FI.  A veces, la descarga no se completa y se requiere una operaci√≥n de descarga repetida, pero teniendo en cuenta que en este momento el equipo permanece en funcionamiento y el archivado tambi√©n puede funcionar, creo que este no es un problema muy grande.  Tambi√©n versi√≥n probada con un chip de memoria de 16 mB en lugar de una tarjeta microSD.  Descarga m√°s r√°pida, pero no hay forma de guardar muchos archivos, la grabaci√≥n es secuencial hasta que toda la memoria est√© llena. <br><br><h2>  Prop√≥sito y caracter√≠sticas de la placa de interfaz </h2><br>  La placa est√° dise√±ada para ampliar el acceso a las variables internas de la l√≥gica del rel√© programable PR200, y proporciona acceso a las variables de lectura y escritura. <br><br>  Gracias a la interfaz inal√°mbrica WI-FI, se proporciona acceso al dispositivo sin necesidad de conectar equipos adicionales.  En primer lugar, la soluci√≥n se centra en proyectos simples de automatizaci√≥n del hogar en lugares con redes WI-FI.  Estos incluyen soluciones para la automatizaci√≥n de la iluminaci√≥n interior y exterior, control y monitoreo de estaciones de bombeo, invernaderos, etc. Debido a la presencia de un servidor WEB incorporado en el tablero, no hay necesidad de comprar equipos adicionales para aquellos casos en que se necesita acceso al sistema no a menudo  La salida de entrada b√°sica se lleva a cabo utilizando un tel√©fono inteligente / tableta o PC ubicado en la misma red. <br><br>  La placa de interfaz puede funcionar en varios modos.  Cuando se conecta a un enrutador con acceso a Internet, le permite controlar de forma remota el estado de las variables en la l√≥gica del PR200, as√≠ como controlar el algoritmo a trav√©s de variables de red en formatos compatibles con el PR200 en modo esclavo. <br><br>  La comunicaci√≥n con el algoritmo programado en el dispositivo se lleva a cabo a trav√©s de variables de red, mientras que la placa de interfaz puede actuar como maestro o esclavo.  Se admiten las velocidades y configuraciones est√°ndar de la interfaz de red PR200.  Se admite el intercambio a trav√©s del protocolo Modbus TCP; para esto, se asigna un √°rea de memoria de 100 celdas, a la que se puede acceder tanto desde la interfaz WEB como a trav√©s del protocolo Modbus RTU desde el lado PR200. <br><br>  La elecci√≥n del modo de tarjeta de red es similar a la elecci√≥n cuando se trabaja con paneles gr√°ficos; trabajar en el modo Maestro le permite controlar de manera m√°s flexible el intercambio de variables; para los registros, cuyo valor debe obtenerse con m√°s frecuencia que los dem√°s, es posible establecer menos el per√≠odo de votaci√≥n.  Los siguientes comandos est√°n disponibles para el protocolo Modbus: <br><br>  03 (0x03) Lectura de registros de retenci√≥n Lectura. <br><br>  04 (0x04) Leer registros de entrada Leer <br><br>  06 (0x06) Registro de registro √∫nico preestablecido <br><br>  16 (0x10) Grabaci√≥n de m√∫ltiples registros preestablecidos <br><br>  Las variables recibidas del rel√© est√°n disponibles para escribir en un archivo (archivo), que se encuentra en la tarjeta micro SD, la grabaci√≥n est√° en formato de texto.  Despu√©s de descargar, puede verlo en una computadora en un editor de texto simple.  Los valores registrados en el archivo se pueden mostrar en el gr√°fico hist√≥rico.  Usando las opciones para escalar y seleccionar un per√≠odo espec√≠fico en la l√≠nea de tiempo, as√≠ como mostrar / ocultar individualmente las l√≠neas del gr√°fico, se lleva a cabo el an√°lisis de los datos del archivo. <br><br>  Los archivos creados durante el funcionamiento del archivador permanecen en la tarjeta microSD y se pueden descargar a una computadora, solo hay un archivo disponible en cualquier momento, puede grabar datos de archivo, leer informaci√≥n para construir un gr√°fico hist√≥rico o leer informaci√≥n para guardar en una PC . <br><br>  Para archivar, las variables est√°n disponibles desde el espacio de direcciones de la placa de red, en el que es necesario escribir los datos recibidos a trav√©s de Modbus RTU desde PR200 o Modbus TCP desde otros dispositivos que admiten el protocolo Modbus TCP en modo maestro. <br><br>  La placa de interfaz se puede configurar tanto en el modo de punto de acceso (Punto de acceso) como en el modo de cliente - estaci√≥n de trabajo (Estaci√≥n), y quiz√°s en ambos modos simult√°neamente.  Muy a menudo, el punto de acceso tiene acceso a Internet y act√∫a como un puente entre el dispositivo y la red. <br><br>  La conexi√≥n inal√°mbrica puede protegerse con contrase√±a, tambi√©n es posible ocultar el punto de acceso. <br><br>  Las variables obtenidas a trav√©s de la interfaz RS485 de PR200 pueden analizarse present√°ndolas en forma gr√°fica, en este modo los valores se mostrar√°n en tiempo real con un per√≠odo de ~ 1 segundo. <br><br>  Hay 10 variables disponibles para trazar en n√∫meros enteros, coma flotante o representaci√≥n de 16/32 bits.  El n√∫mero, el tipo, las direcciones de las variables y el formato de salida se toman de la configuraci√≥n de archivo. <br><br>  Para una operaci√≥n r√°pida y conveniente, se decidi√≥ repetir la forma de la tarjeta de red "nativa" del dispositivo. <br><br><img src="https://habrastorage.org/webt/qv/vg/4j/qvvg4jbi6kbwq0i700vlhi9ftne.jpeg" alt="imagen"><br>  <i>La placa est√° instalada en el dispositivo.</i> <br><br><div class="spoiler">  <b class="spoiler_title">La tarjeta de red se puede instalar en la primera o segunda ranura</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j_/qy/pq/j_qypqdkzcf7j3a9jujeeqq5fza.jpeg" alt="imagen"><br></div></div><br>  La placa tiene dos interruptores, uno sirve para restablecer la placa de red (no afecta el programa en PR200), el segundo interruptor se puede programar para habilitar el archivado (seleccionado a trav√©s de la configuraci√≥n de la interfaz WEB de la placa).  Tambi√©n hay 2 LED de informaci√≥n: <br><br>  1 luz azul se ilumina brevemente durante el intercambio de datos a trav√©s de la interfaz RS-485 con PR200 <br>  El 2-rojo se enciende brevemente al momento de escribir datos en la tarjeta micro SD, y est√° constantemente encendido si no hay tarjeta o si es imposible leer los datos en la tarjeta. <br><br>  Los siguientes son los men√∫s principales cuando se trabaja en varios modos: <br><br><img src="https://habrastorage.org/webt/to/ny/-9/tony-98orqrhf1luvbjsjgunzum.png" alt="imagen"><br>  <i>Configuraci√≥n de red b√°sica para conectarse a trav√©s de WEB.</i> <br><br><img src="https://habrastorage.org/webt/mh/cm/f8/mhcmf8an5ct55x2o3xaoaatw6ps.png" alt="imagen"><br>  <i>Configuraci√≥n de conexi√≥n a la interfaz de red PR200 y configuraci√≥n de conexi√≥n a trav√©s de Modbus TCP a trav√©s de WIFI</i> <br><br><img src="https://habrastorage.org/webt/_6/xm/cz/_6xmcznmcjb3mtvepazjeqwh75c.png" alt="imagen"><br>  <i>Mapa de registros internos comunes a Web, Modbus RTU y Modbus TCP</i> <br><br><div class="spoiler">  <b class="spoiler_title">Pruebe la p√°gina WEB para controlar y monitorear el estado de las E / S PR200 con el m√≥dulo de expansi√≥n PRM-1 conectado.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nd/tu/fk/ndtufkepntezf8hbwxjdaxozxdi.png" alt="imagen"><br><br><img src="https://habrastorage.org/webt/qp/td/yx/qptdyx2xpp1ttfzucdh6iprrac4.png" alt="imagen"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">P√°ginas para entrada / salida de valores desde PR200 y transmisi√≥n de datos a las salidas de control del dispositivo.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sw/c8/yb/swc8ybmb1radp2jcf027mi_be0s.png" alt="imagen"></div></div><br>  Al conectar una placa de red a un enrutador con acceso a Internet y reenv√≠o de puertos, es posible trabajar de forma remota con la placa a trav√©s de un navegador. <br><br><h2>  Como funciona </h2><br>  Las siguientes son capturas de pantalla cuando se ejecuta PR200 en un proyecto real, con archivo de datos.  Se carga un proyecto en el PR200, que lee los valores de los 4 canales anal√≥gicos a los que est√°n conectados los sensores NTC y convierte estos valores a temperatura, utilizando la segunda interfaz de red configurada en modo maestro, el PR200 sondea el m√≥dulo MV110-8A al que est√°n conectados 2 DTC Pt1000.  Por lo tanto, se recopilan datos sobre 4 valores de resistencia de las entradas anal√≥gicas de PR200, 4 valores de temperatura obtenidos utilizando la macro NTC, as√≠ como 2 valores de temperatura recibidos del m√≥dulo MV110-8A a trav√©s de RS-485.  Los 10 registros en formato flotante en la primera interfaz de red configurada en modo maestro se leen para escribir en el archivo y la visualizaci√≥n WEB. <br><br><img src="https://habrastorage.org/webt/ov/kb/ue/ovkbuegmxtn4pkqkubbbkmfnxxs.png" alt="imagen"><br>  <i>El men√∫ para trabajar con la tarjeta SD, cuando el archivo est√° desactivado, muestra una lista de archivos en la tarjeta, cuando el archivo est√° activado, muestra el registro de la grabaci√≥n en la tarjeta.</i> <i><br></i> <br><br><div class="spoiler">  <b class="spoiler_title">Men√∫ de gesti√≥n de archivos.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mx/jq/7y/mxjq7y7yqfezmgaflitikmg2qrg.png" alt="imagen"></div></div><br><img src="https://habrastorage.org/webt/w4/45/1j/w4451jdprj0bwuvdt6ytzfem27c.png" alt="imagen"><br>  Las marcas de tiempo para el archivo se leen desde los registros del reloj en tiempo real PR200; en este ejemplo, el reloj no est√° sincronizado con el tiempo real. <br><br><div class="spoiler">  <b class="spoiler_title">Archivo de archivo descargado a trav√©s de WI-FI con micro SD instalado en la placa y abierto con un editor de texto.</b>  <b class="spoiler_title">Listo para graficar.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vd/r8/zo/vdr8zoxuhegu_i0nu1cnqkepln4.png" alt="imagen"></div></div><br><div class="spoiler">  <b class="spoiler_title">La p√°gina se abri√≥ en el navegador para crear un gr√°fico a partir del archivo descargado.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9z/8z/s6/9z8zs6cxqt_ogdniz-qwc6evtqq.png" alt="imagen"></div></div><br><img src="https://habrastorage.org/webt/ml/84/2m/ml842mxpwvm1xnth6o54qhbbntq.png" alt="imagen"><br>  <i>La programaci√≥n generada de acuerdo con los datos del archivo de almacenamiento.</i> <br><br><img src="https://habrastorage.org/webt/vt/of/t3/vtoft3tx0zwvwgzzz3gzituvhhk.png" alt="imagen"><br>  <i>Administrar la visibilidad del gr√°fico a trav√©s de una leyenda</i> <br><br><img src="https://habrastorage.org/webt/gm/wz/9f/gmwz9fhbq3b8d7nqirlqsqaka2u.png" alt="imagen"><br>  <i>Detallando las secciones necesarias en el gr√°fico.</i> <br><br><h2>  Registro de acceso a trav√©s de Modbus TCP (WIFI) </h2><br>  Si las capacidades WEB no son suficientes para crear la visualizaci√≥n, entonces, utilizando el acceso a trav√©s de Modbus TCP, puede organizar la comunicaci√≥n con los sistemas SCADA y crear r√°pidamente la visualizaci√≥n necesaria a partir de bloques prefabricados.  Usando varios monitores de red, es posible monitorear el estado de los registros internos tanto de la tarjeta de red como de los registros integrados del PR200.  Ejemplo de encuesta con el software Modbus Poll. <br><br><img src="https://habrastorage.org/webt/jn/vl/es/jnvlesf0u-zjwdw7ykpea0vlgn0.png" alt="imagen"><br>  <i>Conexi√≥n a trav√©s del protocolo ModBus TCP utilizando el software Modbus Poll.</i> <br><br><img src="https://habrastorage.org/webt/vj/h1/nv/vjh1nvjwlnxmo8mxpzfmdf8d6n8.png" alt="imagen"><br>  <i>Lectura de registros y presentaci√≥n en varios formatos.</i> <br><br><h2>  Conclusiones </h2><br>  Despu√©s de instalar la tarjeta de red en el dispositivo, aparecen funciones y herramientas adicionales al trabajar con el rel√© programable PR200.  Son posibles varios escenarios de uso tanto individualmente como en modo combinado. <br><br>  Un ejemplo, al grabar eventos archivados en PR200, en este momento se han creado varias macros para grabar eventos archivados en el dispositivo, pero ocupan muchos recursos en el dispositivo y tienen capacidades limitadas tanto para generar informaci√≥n como para la profundidad de archivado, utilizando una unidad externa existe la posibilidad m√°s flexible para configurar y grabar los eventos necesarios.  Para facilitar el an√°lisis, se ha agregado un modo para escribir registros en modo bit, de modo que un n√∫mero de 16 o 32 bits descompuesto en bits ingresa al archivo.  Se admiten varios modos de inicio de archivo, a trav√©s de un interruptor en el tablero, interfaz WEB, registro ModBus.  Usando el registro ModBus, el dispositivo mismo determina el momento de grabaci√≥n escribiendo un n√∫mero que no sea "0" en la celda, se excede la configuraci√≥n, escribimos para registrar "1" y los registros se escriben hasta que el valor se escribe para registrar "0", similar a la operaci√≥n de las se√±ales de entrada.  Por separado, puede seleccionar un registro con un cierto per√≠odo de varios datos sobre temperatura, presi√≥n, humedad para su posterior an√°lisis en una representaci√≥n gr√°fica.  Para convertir datos a una vista gr√°fica, se incorpora una p√°gina web en el dispositivo. <br><br>  El segundo escenario es el control remoto, o el monitoreo del estado de las variables internas, cambiando los modos de operaci√≥n.  Esta opci√≥n se puede dividir en local, dentro de la red interna y a trav√©s de Internet. <br><br>  Las opciones restantes son auxiliares, depuraci√≥n, visualizaci√≥n de variables de inter√©s en la visualizaci√≥n actual, visualizaci√≥n de variables de red, etc. <br><br>  Es interesante escuchar la opini√≥n de la comunidad sobre este tema, ¬øqui√©n resuelve problemas similares? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es424791/">https://habr.com/ru/post/es424791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es424777/index.html">Uso del c√≥nsul para escalar servicios con estado</a></li>
<li><a href="../es424779/index.html">SPA de varias p√°ginas en Python</a></li>
<li><a href="../es424781/index.html">Ense√±ar y probar redes neuronales en PyTorch usando Ignite</a></li>
<li><a href="../es424787/index.html">Entrevista con Aaron Patterson, presidente de la Conferencia RubyRussia 2018</a></li>
<li><a href="../es424789/index.html">C√≥mo implementar una aplicaci√≥n Ruby on Rails con HAProxy Ingress, unicornio / puma y sockets web</a></li>
<li><a href="../es424793/index.html">C√≥mo imprimir un motor el√©ctrico</a></li>
<li><a href="../es424795/index.html">¬øQu√© tan grande puede ser un dron con energ√≠a solar?</a></li>
<li><a href="../es424799/index.html">An√°lisis bidireccional para widgets de iframe de afiliados con el Administrador de etiquetas de Google</a></li>
<li><a href="../es424801/index.html">Zeppelin OS: otro paso hacia contratos inteligentes seguros</a></li>
<li><a href="../es424803/index.html">El hacker taiwan√©s estaba a punto de hackear la p√°gina de Facebook de Mark Zuckerberg en l√≠nea, pero luego abandon√≥ sus amenazas.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>