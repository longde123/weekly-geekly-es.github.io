<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüéì üõ∏ üîç A√±o de aventuras con grafeno-pit√≥n üå± ‚úåüèæ üßõüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A√±o de aventuras con grafeno-pit√≥n 





 Hola a todos, soy un desarrollador de Python. El a√±o pasado trabaj√© con graphene-python + django ORM y duran...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A√±o de aventuras con grafeno-pit√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461939/"><h1 id="god-priklyucheniy-s-graphene-python">  A√±o de aventuras con grafeno-pit√≥n </h1><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c77/e6d/8c3/c77e6d8c390320295743710d11babfac.png" alt="imagen"></p><br><p> Hola a todos, soy un desarrollador de Python.  El a√±o pasado trabaj√© con graphene-python + django ORM y durante este tiempo intent√© crear alg√∫n tipo de herramienta para hacer que trabajar con grafeno sea m√°s conveniente.  Como resultado, obtuve una peque√±a base de c√≥digo de <code>graphene-framework</code> y un conjunto de algunas reglas, que me gustar√≠a compartir. </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/getpro/habr/post_images/458/645/f18/458645f180f8fff23bcbd543065d8c11.png" alt="imagen"></p><br><p>  ¬øQu√© es el grafeno-pit√≥n? </p><br><p>  De acuerdo con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">graphene-python.org</a> , entonces: </p><br><blockquote>  Graphene-Python es una biblioteca para crear f√°cilmente API GraphQL usando Python.  Su tarea principal es proporcionar una API simple pero al mismo tiempo extensible para facilitar la vida de los programadores. </blockquote><p>  <strong>Su tarea principal es proporcionar una API simple pero al mismo tiempo extensible para facilitar la vida de los programadores.</strong> </p><br><p>  S√≠, en realidad el grafeno es simple y extensible, pero me parece demasiado simple para aplicaciones grandes y de r√°pido crecimiento.  Documentaci√≥n breve (us√© el c√≥digo fuente en su lugar, es mucho m√°s detallado), as√≠ como la falta de est√°ndares para escribir c√≥digo hace que esta biblioteca no sea la mejor opci√≥n para su pr√≥xima API. </p><br><p>  Sea como fuere, decid√≠ usarlo en el proyecto y encontr√© una serie de problemas, afortunadamente, al haber resuelto la mayor√≠a de ellos (gracias a las caracter√≠sticas indocumentadas de grafeno).  Algunas de mis soluciones son puramente arquitect√≥nicas y se pueden usar de forma inmediata, sin mi marco.  Sin embargo, el resto de ellos a√∫n requieren algo de c√≥digo base. </p><br><p>  Este art√≠culo no es documentaci√≥n, sino una descripci√≥n breve del camino que tom√© y los problemas que resolv√≠ de una forma u otra con una breve justificaci√≥n de mi elecci√≥n.  En esta parte, prest√© atenci√≥n a las mutaciones y cosas relacionadas con ellas. </p><br><p>  El prop√≥sito de este art√≠culo es obtener <strong>comentarios significativos</strong> , ¬°as√≠ que esperar√© las cr√≠ticas en los comentarios! </p><br><p>  <em>Nota: antes de continuar leyendo el art√≠culo, le recomiendo que se familiarice con GraphQL.</em> </p><br><hr><br><h2 id="mutacii">  Mutaciones </h2><br><blockquote>  La mayor√≠a de las discusiones sobre GraphQL se centran en obtener datos, pero cualquier plataforma respetuosa tambi√©n requiere una forma de modificar los datos almacenados en el servidor. </blockquote><p>  Comencemos con las mutaciones. </p><br><p>  Considere el siguiente c√≥digo: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> post_id = graphene.ID(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) title = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) content = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) image_urls = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) allow_comments = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) contact_email = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ok = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) errors = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_, info, post_id, title, content, image_urls, allow_comments, contact_email)</span></span></span><span class="hljs-function">:</span></span> errors = [] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: post = get_post_by_id(post_id) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> PostNotFound: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(ok=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, errors=[<span class="hljs-string"><span class="hljs-string">'post_not_found'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> info.context.user.is_authenticated: errors.append(<span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(title) &lt; TITLE_MIN_LENGTH: errors.append(<span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> is_email(contact_email): errors.append(<span class="hljs-string"><span class="hljs-string">'contact_email_not_valid'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post.owner != info.context.user: errors.append(<span class="hljs-string"><span class="hljs-string">'not_post_owner'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Post.objects.filter(title=title).exists(): errors.append(<span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> errors: post = Utils.update_post(post, title, content, image_urls, allow_comments, contact_email) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(ok=bool(errors), errors=errors)</code> </pre> <br><p>  <code>UpdatePostMutation</code> cambia la publicaci√≥n con la <code>id</code> dada, usando los datos transferidos y devuelve errores si no se cumplen algunas condiciones. </p><br><p>  Uno solo necesita mirar este c√≥digo, ya que se hace visible su no extensibilidad e incompatibilidad debido a: </p><br><ol><li>  Demasiados argumentos de la funci√≥n de <code>mutate</code> , cuyo n√∫mero puede aumentar incluso si queremos agregar m√°s campos para editar. </li><li>  Para que las mutaciones se vean iguales en el lado del cliente, deben devolver <code>errors</code> y <code>ok</code> , de modo que su estado y lo que siempre es posible entender. </li><li>  Buscar y recuperar un <em>objeto</em> en funci√≥n <code>mutate</code> .  La funci√≥n de mutaci√≥n funciona con el ayuno, y si no est√° all√≠, entonces la mutaci√≥n no deber√≠a ocurrir. </li><li>  Comprobando permisos en una mutaci√≥n.  La mutaci√≥n no deber√≠a ocurrir si el usuario no tiene el derecho de hacer esto (edite alguna publicaci√≥n). </li><li>  Un primer argumento in√∫til (una <em>ra√≠z</em> que siempre es <code>None</code> para los campos de nivel superior, que es nuestra mutaci√≥n). </li><li>  Un conjunto impredecible de errores: si no tiene el c√≥digo fuente o la documentaci√≥n, no sabr√° qu√© errores puede devolver esta mutaci√≥n, ya que no se reflejan en el esquema. </li><li>  Hay demasiadas verificaciones de errores de plantilla que se llevan a cabo directamente en el m√©todo de <code>mutate</code> , lo que implica <em>cambiar los</em> datos, en lugar de una variedad de verificaciones.  La <code>mutate</code> ideal debe consistir en una l√≠nea: una llamada a la funci√≥n de edici√≥n posterior. </li></ol><br><p>  En resumen, <strong><code>mutate</code> deber√≠a modificar los datos</strong> , en lugar de ocuparse de tareas de terceros, como acceder a objetos y validar la entrada.  Nuestro objetivo es llegar a algo como: </p><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(post, info, input)</span></span></span><span class="hljs-function">:</span></span> post = Utils.update_post(post, **input) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(post=post)</code> </pre> <br><p>  Ahora echemos un vistazo a los puntos anteriores. </p><br><hr><br><h3 id="polzovatelskie-tipy">  Tipos personalizados </h3><br><p>  El campo de <code>email</code> se pasa como una cadena, mientras que es una <em>cadena de un formato espec√≠fico</em> .  Cada vez que la API recibe un correo electr√≥nico, debe verificar su correcci√≥n.  Entonces, la mejor soluci√≥n ser√≠a crear un tipo personalizado. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Email</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.String)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><p>  Esto puede parecer obvio, pero vale la pena mencionarlo. </p><br><hr><br><h3 id="vhodnye-tipy">  Tipos de entrada </h3><br><p>  Use tipos de entrada para sus mutaciones.  Incluso si no est√°n sujetos a reutilizaci√≥n en otros lugares.  Gracias a los tipos de entrada, las consultas se hacen m√°s peque√±as, lo que las hace m√°s f√°ciles de leer y m√°s r√°pidas de escribir. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostInput</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.InputObjectType)</span></span></span><span class="hljs-class">:</span></span> title = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) content = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) image_urls = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) allow_comments = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) contact_email = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Para: </p><br><pre> <code class="plaintext hljs">mutation( $post_id: ID!, $title: String!, $content: String!, $image_urls: String!, $allow_comments: Boolean!, $contact_email: Email! ) { updatePost( post_id: $post_id, title: $title, content: $content, image_urls: $image_urls, allow_comments: $allow_comments, contact_email: $contact_email, ) { ok } }</code> </pre> <br><p>  Despu√©s: </p><br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: UpdatePostInput!) { updatePost(id: $id, input: $input) { ok } }</code> </pre> <br><p>  El c√≥digo de mutaci√≥n cambia a: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) id = graphene.ID(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ok = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) errors = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_, info, input, id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... if not errors: post = Utils.update_post(post, **input.__dict__) return UpdatePostMutation(errors=errors)</span></span></code> </pre> <br><hr><br><h3 id="bazovyy-klass-mutaciy">  Clase de mutaci√≥n base </h3><br><p>  Como se mencion√≥ en el p√°rrafo 2, las <em>mutaciones deben devolver <code>errors</code> y estar <code>ok</code> para que su estado y sus causas siempre se puedan entender</em> .  Es bastante simple, creamos una clase base: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MutationPayload</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> ok = graphene.Boolean(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) errors = graphene.List(graphene.String, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) query = graphene.Field(<span class="hljs-string"><span class="hljs-string">'main.schema.Query'</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_ok</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, info)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> len(self.errors <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> []) == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_errors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, info)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.errors <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_query</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, info)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {}</code> </pre> <br><p>  Algunas notas </p><br><ul><li>  Se <code>resolve_ok</code> m√©todo <code>resolve_ok</code> , por lo que no tenemos que calcular <code>ok</code> nosotros mismos. </li><li>  El campo de <code>query</code> es la <code>Query</code> ra√≠z, que le permite consultar datos directamente dentro de la solicitud de mutaci√≥n (los datos se solicitar√°n una vez que se complete la mutaci√≥n). <br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: PostUpdateInput!) { updatePost(id: $id, input: $input) { ok query { profile { totalPosts } } } }</code> </pre> </li></ul><br><p>  Esto es muy conveniente cuando el cliente actualiza algunos datos despu√©s de que se completa la mutaci√≥n y no quiere pedirle al patrocinador que devuelva todo este conjunto.  Cuanto menos c√≥digo escriba, m√°s f√°cil ser√° mantenerlo.  Tom√© esta idea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de aqu√≠</a> . </p><br><p>  Con la clase de mutaci√≥n base, el c√≥digo se convierte en: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationPayload, graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) id = graphene.ID(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_, info, input, id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><hr><br><h3 id="kornevye-mutacii">  Mutaciones de la ra√≠z </h3><br><p>  Nuestra solicitud de mutaci√≥n ahora se ve as√≠: </p><br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: PostUpdateInput!) { updatePost(id: $id, input: $input) { ok } }</code> </pre> <br><p>  Contener todas las mutaciones en un √°mbito global no es una buena pr√°ctica.  Aqu√≠ hay algunas razones por las cuales: </p><br><ol><li>  Con el creciente n√∫mero de mutaciones, se hace cada vez m√°s dif√≠cil encontrar la mutaci√≥n que necesita. </li><li>  Debido a un espacio de nombres, es necesario incluir "el nombre de su m√≥dulo" en el nombre de la mutaci√≥n, por ejemplo <code>update</code> <strong><code>Post</code></strong> . </li><li>  Debe pasar <code>id</code> como argumento de la mutaci√≥n. </li></ol><br><p>  Sugiero usar <em>mutaciones de ra√≠z</em> .  Su objetivo es resolver estos problemas separando las mutaciones en √°mbitos separados y liberando las mutaciones de la l√≥gica de acceso a los objetos y los derechos de acceso a ellos. </p><br><p>  La nueva solicitud se ve as√≠: </p><br><pre> <code class="plaintext hljs">mutation($id: ID!, $input: PostUpdateInput!) { post(id: $id) { update(input: $input) { ok } } }</code> </pre> <br><p>  Los argumentos de la solicitud siguen siendo los mismos.  Ahora la funci√≥n de cambio se "llama" dentro de la <code>post</code> , lo que permite implementar la siguiente l√≥gica: </p><br><ol><li>  Si la <code>id</code> no se pasa a la <code>post</code> , devuelve <code>{}</code> .  Esto le permite continuar realizando mutaciones dentro.  Se usa para mutaciones que no requieren un elemento ra√≠z (por ejemplo, para crear objetos). </li><li>  Si se pasa la <code>id</code> , se recupera el elemento correspondiente. </li><li>  Si no se encuentra el objeto, <code>None</code> devuelve <code>None</code> y esto completa la solicitud, no se llama a la mutaci√≥n. </li><li>  Si se encuentra el objeto, verifique los derechos del usuario para manipularlo. </li><li>  Si el usuario no tiene derechos, <code>None</code> devuelve <code>None</code> y se completa la solicitud, no se llama a la mutaci√≥n. </li><li>  Si el usuario tiene derechos, el objeto encontrado se devuelve y la mutaci√≥n lo recibe como ra√≠z: el primer argumento. </li></ol><br><p>  Por lo tanto, el c√≥digo de mutaci√≥n cambia a: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationPayload, graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(post, info, input)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> errors = [] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> info.context.user.is_authenticated: errors.append(<span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(title) &lt; TITLE_MIN_LENGTH: errors.append(<span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Post.objects.filter(title=title).exists(): errors.append(<span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> errors: post = Utils.update_post(post, **input.__dict__) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdatePostMutation(errors=errors)</code> </pre> <br><ul><li>  La ra√≠z de la mutaci√≥n, el primer argumento, ahora es un objeto de tipo <code>Post</code> , sobre el cual se realiza la mutaci√≥n. </li><li>  La verificaci√≥n de autorizaci√≥n se movi√≥ al c√≥digo de mutaci√≥n ra√≠z. </li></ul><br><p>  C√≥digo de mutaci√≥n de la ra√≠z: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostMutationRoot</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationRoot)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> model = Post has_permission = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> post, user: post.owner == user update = UpdatePostMutation.Field()</code> </pre> <br><hr><br><h3 id="interfeys-oshibok">  Interfaz de error </h3><br><p>  Para que un conjunto de errores sea predecible, deben reflejarse en el dise√±o. </p><br><ul><li>  Como las mutaciones pueden devolver varios errores, los errores deben ser una lista. </li><li>  Dado que los errores est√°n representados por diferentes tipos, debe existir una <code>Union</code> errores espec√≠fica para una mutaci√≥n particular. </li><li>  Para que los errores sigan siendo similares entre s√≠, deben implementar la interfaz, llam√©mosla <code>ErrorInterface</code> .  Deje que contenga dos campos: <code>ok</code> y <code>message</code> . </li></ul><br><p>  ¬°Por lo tanto, los errores deben ser del tipo <code>[SomeMutationErrorsUnion]!</code>  .  Todos los subtipos de <code>SomeMutationErrorsUnion</code> deben implementar <code>ErrorInterface</code> . </p><br><p>  Obtenemos: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotAuthenticated</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> message = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, default_value=<span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> interfaces = [ErrorInterface, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TitleTooShort</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> message = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, default_value=<span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> interfaces = [ErrorInterface, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TitleAlreadyTaken</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.ObjectType)</span></span></span><span class="hljs-class">:</span></span> message = graphene.String(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, default_value=<span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> interfaces = [ErrorInterface, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutationErrors</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Union)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> types = [NotAuthenticated, TitleIsTooShort, TitleAlreadyTaken, ]</code> </pre> <br><p>  Se ve bien, pero hay demasiado c√≥digo.  Usamos la metaclase para generar estos errores sobre la marcha: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostErrors</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(metaclass=ErrorMetaclass)</span></span></span><span class="hljs-class">:</span></span> errors = [ <span class="hljs-string"><span class="hljs-string">'not_authenticated'</span></span>, <span class="hljs-string"><span class="hljs-string">'title_too_short'</span></span>, <span class="hljs-string"><span class="hljs-string">'title_already_taken'</span></span>, ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutationErrors</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(graphene.Union)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> types = [PostErrors.not_authenticated, PostErrors.title_too_short, PostErrors.title_already_taken, ]</code> </pre> <br><p>  Agregue la declaraci√≥n de los errores devueltos a la mutaci√≥n: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(MutationPayload, graphene.Mutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() errors = graphene.List(UpdatePostMutationErrors, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(post, info, input)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><hr><br><h3 id="proverka-na-nalichie-oshibok">  Verificar errores </h3><br><p>  Me parece que al m√©todo de <code>mutate</code> no deber√≠a importarle nada m√°s que <em>mutar los datos</em> .  Para lograr esto, debe verificar si hay errores en su c√≥digo para esta funci√≥n. </p><br><p>  Omitiendo la implementaci√≥n, aqu√≠ est√° el resultado: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(DefaultMutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> root_required = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> authentication_required = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-comment"><span class="hljs-comment">#   ,    True   # An iterable of tuples (error_class, checker) checks = [ ( PostErrors.title_too_short, lambda post, input: len(input.title) &lt; TITLE_MIN_LENGTH ), ( PostErrors.title_already_taken, lambda post, input: Post.objects.filter(title=input.title).exists() ), ] def mutate(post, info, input): post = Utils.update_post(post, **input.__dict__) return UpdatePostMutation()</span></span></code> </pre> <br><p>  Antes de iniciar la funci√≥n <code>mutate</code> , se llama a cada <em>verificador</em> (el segundo elemento de los miembros de la matriz de <code>checks</code> ).  Si se devuelve <code>True</code> encuentra el error correspondiente.  Si no se encuentran errores, se llama a la funci√≥n <code>mutate</code> . </p><br><p>  Explicar√©: </p><br><ul><li>  Las funciones de verificaci√≥n toman los mismos argumentos que las funciones de <code>mutate</code> . </li><li>  Las funciones de validaci√≥n deben devolver <code>True</code> si se encuentra un error. </li><li>  Las verificaciones de autorizaci√≥n y la presencia del elemento ra√≠z son bastante generales y se enumeran en los indicadores <code>Meta</code> . </li><li>  <code>authentication_required</code> agrega verificaci√≥n de autorizaci√≥n si es <code>True</code> . </li><li>  <code>root_required</code> agrega una <code>root_required</code> " <code>root is not None</code> <code>root_required</code> <code>root is not None</code> ". </li><li>  <code>UpdatePostMutationErrors</code> ya no es necesario.  Se crea una uni√≥n de posibles errores sobre la marcha dependiendo de las clases de error de la matriz de <code>checks</code> . </li></ul><br><hr><br><h3 id="dzheneriki">  Gen√©ricos </h3><br><p>  <code>DefaultMutation</code> utilizado en la √∫ltima secci√≥n agrega un m√©todo <code>pre_mutate</code> , que le permite cambiar los argumentos de entrada antes de buscar errores y, en consecuencia, invocar la mutaci√≥n. </p><br><p>  Tambi√©n hay un kit de inicio gen√©rico que acorta el c√≥digo y facilita la vida. <br>  <em>Nota: actualmente el c√≥digo gen√©rico es espec√≠fico de django ORM</em> </p><br><h4 id="createmutation">  Createmutation </h4><br><p>  Requiere uno de los <code>create_function</code> <code>model</code> o <code>create_function</code> .  Por defecto, <code>create_function</code> tiene este aspecto: </p><br><pre> <code class="python hljs">model._default_manager.create(**data, owner=user)</code> </pre> <br><p>  Esto puede parecer inseguro, pero no olvide que hay una comprobaci√≥n de tipo incorporada en graphql, as√≠ como comprobaciones en mutaciones. </p><br><p>  Tambi√©n proporciona un m√©todo <code>post_mutate</code> que se llama despu√©s de <code>create_function</code> con argumentos <code>(instance_created, user)</code> , cuyo resultado se devolver√° al cliente. </p><br><h4 id="updatemutation">  Actualizaciones </h4><br><p>  Le permite configurar la funci√≥n de <code>update_function</code> .  Por defecto: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default_update_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, user=None, **data)</span></span></span><span class="hljs-function">:</span></span> instance.__dict__.update(data) instance.save() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance</code> </pre> <br><p>  <code>root_required</code> es <code>True</code> por defecto. </p><br><p>  Tambi√©n proporciona un m√©todo <code>post_mutate</code> que se llama despu√©s de <code>update_function</code> con argumentos <code>(instance_updated, user)</code> , cuyo resultado ser√° devuelto al cliente. </p><br><p>  ¬°Y esto es lo que necesitamos! </p><br><p>  C√≥digo final: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdatePostMutation</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(UpdateMutation)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arguments</span></span></span><span class="hljs-class">:</span></span> input = UpdatePostInput() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> checks = [ ( PostErrors.title_too_short, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> post, input: len(input.title) &lt; TITLE_MIN_LENGTH ), ( PostErrors.title_already_taken, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> post, input: Post.objects.filter(title=input.title).exists() ), ]</code> </pre> <br><h4 id="deletemutation">  Eliminar mutaci√≥n </h4><br><p>  Le permite configurar la funci√≥n <code>delete_function</code> .  Por defecto: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default_delete_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instance, user=None, **data)</span></span></span><span class="hljs-function">:</span></span> instance.delete()</code> </pre> <br><hr><br><h3 id="zaklyuchenie">  Conclusi√≥n </h3><br><p>  Este art√≠culo considera solo un aspecto, aunque en mi opini√≥n es el m√°s complejo.  Tengo algunas ideas sobre resolvers y tipos, as√≠ como cosas generales en graphene-python. </p><br><p>  Es dif√≠cil para m√≠ llamarme un desarrollador experimentado, por lo que estar√© muy contento de cualquier comentario, as√≠ como sugerencias. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El c√≥digo fuente se puede encontrar aqu√≠</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461939/">https://habr.com/ru/post/461939/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461923/index.html">Jornada de Puertas Abiertas de JetBrains en San Petersburgo: video</a></li>
<li><a href="../461927/index.html">Aprendizaje de clasificaci√≥n activa</a></li>
<li><a href="../461929/index.html">Supervisi√≥n y comprobaci√≥n del estado de SSD en Linux</a></li>
<li><a href="../461935/index.html">C√≥mo trabajar con Postgres en Go: pr√°cticas, caracter√≠sticas, matices</a></li>
<li><a href="../461937/index.html">Ley de Parkinson y c√≥mo romperla</a></li>
<li><a href="../461941/index.html">Masajearlo</a></li>
<li><a href="../461945/index.html">El resumen de eventos para profesionales de recursos humanos en el campo de TI para agosto de 2019</a></li>
<li><a href="../461949/index.html">AppCode 2019.2: Swift 5.1, an√°lisis de cobertura de c√≥digo por pruebas, visualizaci√≥n de c√≥digo desmontado y m√°s</a></li>
<li><a href="../461951/index.html">Complemento Veeam para copia de seguridad y recuperaci√≥n de bases de datos SAP HANA</a></li>
<li><a href="../461955/index.html">Intercambiar tokens o c√≥mo fortalecer la cartera de cifrado en 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>