<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí≥ üö∂üèø üò§ ASP.NET MVC - travailler avec MySQL via ADO.NET üì™ üë©üèæ‚Äç‚öñÔ∏è ‚úãüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Technologie h√©rit√©e  Avertissement: ASP.NET MVC est obsol√®te et ADO.NET aussi. Il est recommand√© d'utiliser ASP.NET Core avec l'ORM moderne. Mais si v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ASP.NET MVC - travailler avec MySQL via ADO.NET</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482346/"><div class="spoiler">  <b class="spoiler_title">Technologie h√©rit√©e</b> <div class="spoiler_text">  <b>Avertissement: ASP.NET MVC est obsol√®te et ADO.NET aussi.</b>  <b>Il est recommand√© d'utiliser ASP.NET Core avec l'ORM moderne.</b>  <b>Mais si vous √™tes int√©ress√©, alors lisez.</b> <br></div></div><br>  D√©j√†, probablement, trois fois j'arrive √† ASP.NET MVC.  Apr√®s dix ans avec ASP.NET WebForms, il est un peu difficile de passer √† la technologie MVC, car il y a tellement de diff√©rences qu'il est plut√¥t plus facile de r√©pertorier ce que ces technologies ont en commun - √† l'exception des biblioth√®ques .NET Framework.  Je n'√©crirai pas ici - MVC est meilleur ou pire que WebForms, ils sont tout simplement bons et vous pouvez cr√©er une bonne application sur les deux technologies.  Je laisse √©galement mes r√©flexions sur le besoin de TDD avec moi, bien que je les ai. <br><br>  Et maintenant, je vais parler de la t√¢che la plus standard - le travail habituel avec les donn√©es: afficher sous forme de tableau une liste d'enregistrements, ajouter, modifier et supprimer des donn√©es (op√©rations CRUD).  Cependant, dans presque tous les livres et de nombreuses solutions Internet pour ASP.NET MVC, pour une raison quelconque, l'option est exclusivement envisag√©e via ORM (Object Relation Mapping): Entity Framework (EF) ou LINQ for SQL.  Les technologies sont excellentes, sans doute, enfin, le programmeur peut ne pas comprendre - mais comment fonctionne g√©n√©ralement ce SGBD tr√®s relationnel (qu'il utilise le plus probablement), et m√™me SQL, en th√©orie, n'est plus n√©cessaire: la mise en forme d'EF et les connecteurs pour le SGBD se comprendront.  "Ici, c'est le bonheur - il n'y a plus de beaut√© pour lui."  Mais pour les programmeurs qui n'ont pas peur de travailler directement avec la base de donn√©es via le m√©canisme ADO.NET, il est souvent difficile de savoir - et par o√π commencer avec ASP.NET MVC en g√©n√©ral et s'il est n√©cessaire. <br><a name="habracut"></a><br>  De plus, pour moi, par exemple, au d√©but, cela a provoqu√© une rupture sauvage en l'absence d'un composant pratique pour afficher les donn√©es dans une table de grille.  Il est entendu que le d√©veloppeur lui-m√™me doit impl√©menter tout cela ou prendre quelque chose de convenable du gestionnaire de packages.  Si vous, comme moi, √©tiez plus que satisfait du composant GridView dans ASP.NET WebForms, alors pour MVC, il est difficile de trouver quelque chose de plus ou moins comparable, √† l'exception de Grid.mvc.  Mais ma confiance dans ces composants ne suffit pas √† les utiliser pour un projet suffisamment important.  S'ils sont utilis√©s, le programmeur commence √† d√©pendre d'un autre d√©veloppeur qui, d'une part, ne sait pas √©crire ce composant (est-ce qualitatif?), Et d'autre part, on ne sait pas quand et comment il sera finalis√©.  Il semble parfois m√™me possible d'√©tendre le composant et de le voir plus loin, mais, en cas de d√©veloppement par le d√©veloppeur, nous sommes oblig√©s soit de rechiffrer √† nouveau notre code soit de geler la mise √† jour du composant sur une certaine version.  Et si le d√©veloppeur corrige une vuln√©rabilit√©, vous devez toujours mettre √† niveau vers la nouvelle version.  M√™me la transition vers de nouvelles versions du connecteur MySQL pose certains probl√®mes, bien qu'il soit toujours d√©velopp√© par une grande entreprise, mais qu'en est-il des nombreux ¬´v√©los¬ª dans le gestionnaire de paquets Nuget? <br><br>  Essayons donc d'apprendre √† √©crire sous ASP.NET MVC, tout en travaillant avec des donn√©es trait√©es par le SGBD MySQL.  Tout le code peut √™tre pris ici √† <a href="https://yadi.sk/d/EArrZdGh_iVaJg" rel="nofollow">cette adresse</a> , ci-dessous ce code sera partiellement pr√©sent√© avec de petits liens et explications.  Et <a href="https://example-mvc.azurewebsites.net/" rel="nofollow">ici,</a> vous pouvez voir l'application. <br><br><h2>  Cr√©er une base de donn√©es dans MySQL </h2><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SCHEMA</span></span> <span class="hljs-string"><span class="hljs-string">`example`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-string"><span class="hljs-string">`example`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`users`</span></span> ( <span class="hljs-string"><span class="hljs-string">`UserID`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`SupporterTier`</span></span> enum(<span class="hljs-string"><span class="hljs-string">'None'</span></span>,<span class="hljs-string"><span class="hljs-string">'Silver'</span></span>,<span class="hljs-string"><span class="hljs-string">'Gold'</span></span>,<span class="hljs-string"><span class="hljs-string">'Platinum'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'None'</span></span>, <span class="hljs-string"><span class="hljs-string">`Loginname`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">`Email`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`LastLoginDate`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`UserID`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`i_Loginname`</span></span> (<span class="hljs-string"><span class="hljs-string">`Loginname`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`i_Language_idx`</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-string"><span class="hljs-string">`i_Language`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> <span class="hljs-string"><span class="hljs-string">`languages`</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`languages`</span></span> ( <span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`LanguageName`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`Culture`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8;</code> </pre> <br>  La base de donn√©es (DB) sera simple et repr√©sent√©e par seulement deux tables, avec une relation un-√†-plusieurs entre elles dans le champ <code>LanguageID</code> .  De cette fa√ßon, je vais compliquer la situation pour la n√©cessit√© d'utiliser la liste d√©roulante pour choisir l'une des langues pour l'utilisateur.  De plus, pour complication, pour l'utilisateur, nous introduirons √©galement le champ <code>SupporterTier</code> , qui d√©terminera le niveau de support utilisateur via l'√©num√©ration.  Et afin d'utiliser presque tous les types de donn√©es dans notre projet, nous ajoutons le champ <code>LastLoginDate</code> du type ¬´date / heure¬ª, qui sera rempli par l'application elle-m√™me lorsque l'utilisateur se connectera (non refl√©t√© dans ce projet). <br><br><h2>  Cr√©er un projet </h2><br><img src="https://habrastorage.org/webt/sm/4a/07/sm4a07w8etetdgvtnkhd5i-wjcu.png"><br><br>  Choisissez ¬´MVC¬ª.  Il est possible d'utiliser ¬´Empty¬ª, mais nous avons une formation, pas une vraie application, donc cela nous aidera imm√©diatement, sans gestes inutiles, √† int√©grer Bootstrap et JQuery dans notre application. <br><br><img src="https://habrastorage.org/webt/lg/yv/rn/lgyvrneaxmudgq9mx1ijk36jjqs.png"><br><br>  Nous obtenons les dossiers <i>Content</i> , <i>Fonts</i> , <i>Scripts</i> d√©j√† remplis, ainsi que les <i>fichiers</i> <i>BundleConfig.cs</i> et <i>FilterConfig.cs</i> dans le r√©pertoire <i>App_Start</i> avec enregistrement des bundles et des filtres ASP.NET MVC.  Dans un projet vide, il n'y a que l'enregistrement des routes dans le fichier <i>RouteConfig.cs</i> .  Dans <i>Global.asax.cs, les</i> appels de m√©thode d√©crits dans ces fichiers seront √©galement ajout√©s: <br><br><pre> <code class="cpp hljs">FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters); RouteConfig.RegisterRoutes(RouteTable.Routes); BundleConfig.RegisterBundles(BundleTable.Bundles);</code> </pre> <br><h2>  Nous mettons en place l'infrastructure et l'ensemble du bundle </h2><br>  Pour travailler avec le SGBD MySQL, ajoutez la biblioth√®que <i>MySql.Data</i> : soit manuellement, si le <b>connecteur mysql-connector-net-8.0.18 est</b> d√©j√† install√© sur l'ordinateur, soit √† partir du gestionnaire de paquets Nuget: <br><br><img src="https://habrastorage.org/webt/mk/b_/fh/mkb_fhxg6d8kx2pdnrithceoaf4.png"><br><br>  Ajoutez la configuration de la cha√Æne de connexion au SGBD MySQL au fichier <i>Web.config</i> : <br><br><pre> <code class="cpp hljs">&lt;connectionStrings&gt; &lt;add name=<span class="hljs-string"><span class="hljs-string">"example"</span></span> providerName=<span class="hljs-string"><span class="hljs-string">"MySql.Data.MySqlClient"</span></span> connectionString=<span class="hljs-string"><span class="hljs-string">"server=localhost;Port=3306;user id=develop;Password=develop;persistsecurityinfo=True;database=example;CharSet=utf8;SslMode=none"</span></span> /&gt; &lt;/connectionStrings&gt;</code> </pre> <br>  Ajoutez une ligne dans la <code>&lt;appSettings&gt;</code> avec un lien vers la cha√Æne de connexion ajout√©e: <code>&lt;add key="ConnectionString" value="example" /&gt;</code> <br>  Nous ajoutons un nouveau r√©pertoire de <i>domaine</i> √† l'application, nous y cr√©ons une nouvelle classe de <code>Base</code> statique (dans le fichier <i>Base.cs</i> ), dans laquelle nous <i>acc√©dons</i> √† ces param√®tres: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> ConnectionString { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> System.Configuration.ConfigurationManager.AppSettings[<span class="hljs-string"><span class="hljs-string">"ConnectionString"</span></span>]; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> strConnect { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> System.Configuration.ConfigurationManager.ConnectionStrings[ConnectionString].ConnectionString; } } }</code> </pre> <br>  J'aime avoir une certaine classe de base dans l'application avec des liens vers les param√®tres de l'application et certaines fonctions standard qui pourraient √™tre appel√©es √† partir de l'application enti√®re. <br>  Le nom de la cha√Æne de connexion est d√©fini dans les param√®tres de l'application, de sorte qu'√† l'avenir, il sera plus facile de travailler avec la cha√Æne de connexion au SGBD: basculez rapidement entre les diff√©rentes bases de donn√©es et modifiez les param√®tres de connexion.  De plus, l'utilisation du nom de la cha√Æne de connexion dans le param√®tre d'application est pratique pour publier l'application dans Microsoft Azure - vous pouvez y d√©finir le param√®tre du service d'application utilis√© pour la publication et d√©terminer la cha√Æne de connexion souhait√©e, qui est pr√©d√©finie dans <code>&lt;connectionStrings&gt;</code> .  Ensuite, lors de la publication, vous ne pouvez pas utiliser la transformation du <i>fichier web.config</i> . <br><br>  J'aime √©galement utiliser les valeurs du fichier de ressources global dans le texte, afin de ne pas les √©craser √† plusieurs endroits, si vous en avez soudainement besoin.  Par exemple: <br><br><img src="https://habrastorage.org/webt/rc/8u/qz/rc8uqzdrz9hvnd-y7swirgoh4tm.png"><br><br>  Dans le fichier de mise en page <i>_Layout.cshtml</i> (il est g√©n√©ralement situ√© dans le r√©pertoire <i>Views \ Shared</i> et utilis√© ult√©rieurement pour toutes les pages de ce projet), vous pouvez d√©sormais utiliser ces variables (voir, par exemple, <code>Example_Users.Properties.Resources.Title</code> ): <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width, initial-scale=1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>@ViewBag.Title ‚Äì @Example_Users.Properties.Resources.Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> @Styles.Render("~/Content/css") @Scripts.Render("~/bundles/modernizr") <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container body-content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page-header"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span>@Example_Users.Properties.Resources.Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> @RenderBody() <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">footer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> @DateTime.Now.Year ‚Äì @Example_Users.Properties.Resources.Author<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">footer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> @Scripts.Render("~/bundles/jquery") @Scripts.Render("~/bundles/bootstrap") @RenderSection("scripts", required: false) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Dans ce fichier, nous voyons √©galement la pi√®ce jointe de la feuille de style en cascade du Bootstrap connect√© et de la biblioth√®que de scripts JQuery.  Le contenu de toutes les vues sera g√©n√©r√© √† l'emplacement de l'appel de fonction <code>RenderBody()</code> . <br><br><h2>  M signifie mod√®le </h2><br>  Ajoutez le fichier <i>UserClass.cs</i> au r√©pertoire du <i>domaine</i> : <br><br><pre> <code class="cpp hljs">[DisplayName(<span class="hljs-string"><span class="hljs-string">"User"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserClass</span></span></span><span class="hljs-class"> {</span></span> [Key] [HiddenInput(DisplayValue=<span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UserID { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [Required(ErrorMessage=<span class="hljs-string"><span class="hljs-string">"Please enter a login name"</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Login"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Loginname { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> LanguageClass Language { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [EmailAddress(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please enter a valid email"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Email { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [UIHint(<span class="hljs-string"><span class="hljs-string">"Enum"</span></span>)] [EnumDataType(typeof(Supporter))] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please select supporter tier"</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Supporter"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Supporter SupporterTier { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [HiddenInput(DisplayValue = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] [ScaffoldColumn(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Last login"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime? LastLoginDate { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [HiddenInput(DisplayValue = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsLastLogin { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LastLoginDate != null &amp;&amp; LastLoginDate &gt; DateTime.MinValue; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> UserID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Loginname, LanguageClass Language, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Email, DateTime? LastLoginDate, Supporter SupporterTier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.UserID = UserID; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Loginname = Loginname; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Language = Language; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Email = Email; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastLoginDate = LastLoginDate; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SupporterTier = SupporterTier; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Supporter { [Display(Name=<span class="hljs-string"><span class="hljs-string">""</span></span>)] None = <span class="hljs-number"><span class="hljs-number">1</span></span>, Silver = <span class="hljs-number"><span class="hljs-number">2</span></span>, Gold = <span class="hljs-number"><span class="hljs-number">3</span></span>, Platinum = <span class="hljs-number"><span class="hljs-number">4</span></span> }</code> </pre> <br>  Et aussi le fichier <i>LanguageClass.cs</i> dans le m√™me r√©pertoire: <br><pre> <code class="cpp hljs">[DisplayName(<span class="hljs-string"><span class="hljs-string">"Language"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LanguageClass</span></span></span><span class="hljs-class"> {</span></span> [Key] [HiddenInput(DisplayValue = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please select a language"</span></span>)] [Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please select a language"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LanguageID { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">"Language"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> LanguageName { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LanguageClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LanguageClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LanguageID = LanguageID; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LanguageName = LanguageName; } }</code> </pre> <br>  Ici, vous pouvez voir que les propri√©t√©s des classes r√©p√®tent la structure de la table des <code>Users</code> et des <code>Languages</code> dans le SGBD.  Un <code>enum Supporter</code> cr√©√© pour le type d'√©num√©ration afin qu'il puisse √™tre utilis√© pour la propri√©t√© de la classe <code>SupporterTier</code> d'un champ similaire dans la table de base de donn√©es.  Pour les champs <code>UserID</code> , <code>LanguageID</code> , vous pouvez voir qu'ils sont sp√©cifi√©s comme cl√© primaire, tout comme dans la base de donn√©es.  L'attribut <code>[Key]</code> est utilis√© pour cela. <br><br>  Tous les autres attributs sont plus probablement li√©s aux vues utilisant cette classe.  Et si nous allons utiliser des assistants pour former des balises HTML pour ces propri√©t√©s (que je recommanderais certainement), nous devrons d√©finir ces attributs tr√®s soigneusement pour obtenir ce dont nous avons besoin.  En particulier, voici ce qui √©tait n√©cessaire pour ce projet: <br><br><ul><li>  <b><code>[DisplayName]</code></b> - Utilis√© comme nom d'affichage pour la classe.  Parfois, cela peut √™tre utile, dans ce projet, j'ai sp√©cialement ajout√© l'utilisation de l'assistant <code>Html.DisplayNameForModel</code> pour la d√©monstration. </li><li>  <b><code>[Display]</code></b> avec la propri√©t√© <code>Name</code> - utilis√© comme nom de la propri√©t√© de classe affich√©e √† l'√©cran.  Il existe √©galement une propri√©t√© Order utile qui vous permet de commander la s√©quence d'affichage des propri√©t√©s de classe dans un formulaire √† l'aide d'aides (par d√©faut, le tri par ordre dans lequel les propri√©t√©s de classe sont d√©finies, donc la propri√©t√© Order n'a pas √©t√© utilis√©e dans ce projet). </li><li>  <b><code>[HiddenInput]</code></b> avec la propri√©t√© <code>DisplayValue</code> .  Il est utilis√© pour les propri√©t√©s qui n'ont pas du tout besoin d'√™tre affich√©es dans les formulaires et les listes ( <code>DisplayValue=false</code> , sont dessin√©es comme balises d' <code>input</code> avec le type <code>hidden</code> ), ou pour les propri√©t√©s qui doivent encore √™tre affich√©es, mais sous la forme d'un texte immuable ( <code>DisplayValue=true</code> , est dessin√© comme du texte clair, sans balises) </li><li>  <b><code>[ScaffoldColumn]</code></b> - indique s'il faut afficher le champ dans les <code>Html.EditorForModel</code> √©dition (par exemple, <code>Html.EditorForModel</code> ).  S'il est <code>false</code> , ni la description de la propri√©t√© de classe ni sa valeur ne seront affich√©es dans le formulaire.  <code>[HiddenInput(DisplayValue = false)]</code> ne peut pas √™tre utilis√© <code>[HiddenInput(DisplayValue = false)]</code> , car dans ce cas, les valeurs de cette propri√©t√© de classe ne seront pas du tout affich√©es non seulement dans les formulaires de saisie d'informations, mais √©galement dans les affichages de tableau.  Dans ce cas, cela √©tait requis pour la propri√©t√© <code>LastLoginDate</code> , qui n'est pas entr√©e manuellement, mais remplie quelque part automatiquement, mais nous devons toujours la voir. </li><li>  <b><code>[Required]</code></b> - pour v√©rifier si une valeur a √©t√© entr√©e pour une propri√©t√© de classe, avec le texte du message d'erreur dans la propri√©t√© <code>ErrorMessage</code> et la propri√©t√© <code>AllowEmptyStrings</code> vous permet d'entrer des lignes vides. </li><li>  <b><code>[EmailAddress]</code></b> - essentiellement le m√™me attribut pour v√©rifier l'exactitude de l'adresse postale. </li></ul><br>  Les classes du mod√®le de base de donn√©es sont pr√™tes, nous passons aux repr√©sentations (les classes de mod√®les de repr√©sentations seront d√©crites ci-dessous). <br><br><h2>  V - signifie performance de <s>vendetta</s> </h2><br>  Dans le r√©pertoire <i>Vues</i> , cr√©ez le r√©pertoire <i>Utilisateurs</i> pour nos vues.  Toutes nos vues utilisent la disposition standard (d√©finie dans le fichier <i>_ViewStart.cshtml</i> du r√©pertoire <i>Views</i> ) <i>_Layout.cshtml</i> situ√©e dans le r√©pertoire <i>Views \ Shared</i> .  Cr√©ez une vue <code>Index</code> (fichier <i>Index.cshtml</i> dans le r√©pertoire <i>Users</i> ): <br><br><img src="https://habrastorage.org/webt/jh/es/jn/jhesjnicwj2g1acx7yziv4f6wqy.png"><br><br>  Et √©crivez le code: <br><br><pre> <code class="xml hljs">@model Example_Users.Models.UsersGrid @{ ViewBag.Title = "Users page"; } @using (@Html.BeginForm()) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>Users list:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> @if (TempData["message"] != null) {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-success"</span></span></span><span class="hljs-tag">&gt;</span></span>@TempData["message"]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>} @if (TempData["error"] != null) {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-warning"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert"</span></span></span><span class="hljs-tag">&gt;</span></span>ERROR:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> @TempData["error"]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>} @Html.Partial("List") <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onNewUser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"New user"</span></span></span><span class="hljs-tag"> /&gt;</span></span> @*@Html.ActionLink("New user", "New", "Users")*@ <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre> <br>  Si nous voulons que cette vue d√©marre par d√©faut, modifiez la valeur <code>Default</code> dans le fichier <i>RouteConfig.cs</i> : <br><br><pre> <code class="cpp hljs">routes.MapRoute(name: <span class="hljs-string"><span class="hljs-string">"Default"</span></span>, url: <span class="hljs-string"><span class="hljs-string">"{controller}/{action}/{id}"</span></span>, defaults: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { controller = <span class="hljs-string"><span class="hljs-string">"Users"</span></span>, action = <span class="hljs-string"><span class="hljs-string">"Index"</span></span>, id = UrlParameter.Optional });</code> </pre> <br>  Dans la vue elle-m√™me, vous devez faire attention √† la ligne avec <code>Html.Partial("List")</code> .  Cela est n√©cessaire pour dessiner √† cet endroit une vue partielle g√©n√©rale s√©par√©e sp√©ciale situ√©e dans le fichier <i>List.cshtml</i> dans le r√©pertoire <i>Views \ Shared</i> .  En fait, c'est une table de grille pour afficher les donn√©es de notre table de base de donn√©es d' <code>users</code> : <br><br><pre> <code class="xml hljs">@model Example_Users.Models.UsersGrid @using Example_Users.Domain <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table-responsive"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table table-bordered table-hover"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().Loginname).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().Loginname).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().Loginname).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().Language.LanguageName).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().Language).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().Language).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().Email).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().Email).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().Email).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().SupporterTier).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().SupporterTier).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().SupporterTier).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().LastLoginDate).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().LastLoginDate).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().LastLoginDate).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model.Users) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(item.Loginname, "Edit", "Users", new { UserID = item.UserID }, null)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelitem =&gt; item.Language.LanguageName)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelitem =&gt; item.Email)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Html.DisplayFor(modelitem =&gt; item.SupporterTier)"</span></span></span><span class="hljs-tag">&gt;</span></span>@if (item.SupporterTier != Supporter.None) {@Html.DisplayFor(modelitem =&gt; item.SupporterTier);}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@if (item.IsLastLogin) {@Html.DisplayFor(modelitem =&gt; item.LastLoginDate)}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> @if (Model.PagingInfo.totalPages &gt; 1) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pagination"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.PageLinks(Model.PagingInfo, x =&gt; Url.Action("Index", new { page = x, sortOrder = Model.SortingInfo.currentSort })) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre> <br>  On peut voir que dans l'en-t√™te de la table de donn√©es, les assistants <code>Html.DisplayNameFor</code> sont <code>Html.DisplayNameFor</code> pour afficher les noms des colonnes et pour cela vous devez sp√©cifier une r√©f√©rence √† la propri√©t√© de l'objet classe.  Puisque lors de la formation du titre du tableau, nous n'avons qu'un objet <code>Model.Users</code> , qui est une liste d'objets de type <code>UserClass</code> , nous devons utiliser la m√©thode suivante: s√©lectionnez la premi√®re ligne de cette liste en tant qu'objet de la classe <code>UserClass</code> .  Par exemple, pour le nom d'utilisateur: <code>Model.Users.First().Loginname</code> .  √âtant donn√© que l'attribut <code>Loginname</code> de la classe <code>Users</code> poss√®de l'attribut <code>[Display(Name = "Login")]</code> , il sera affich√© "Login" dans le nom de la colonne: <br><br><img src="https://habrastorage.org/webt/hv/kf/dv/hvkfdvojevmzacuid51wurye8ik.png"><br><br>  Quoi d'autre est int√©ressant dans la vue <code>List</code> ?  Le bloc <code>foreach</code> , bien s√ªr, rend les objets de la classe <code>UserClass</code> qui se trouvent dans la liste des <code>Users</code> re√ßus du contr√¥leur.  Et les <code>PagingInfo</code> <code>SortingInfo</code> et <code>PagingInfo</code> de notre mod√®le <code>UsersGrid</code> sont int√©ressants ici.  Et nous avons besoin de ces objets pour organiser le tri des donn√©es (utilis√© dans l'en-t√™te du tableau dans les balises <code>&lt;th&gt;</code> ) et organiser la pagination des informations (utilis√© au bas de la page, sous le tableau).  C'est pourquoi nous n'utilisons pas comme mod√®le une pure liste d'objets de type <code>IEnumerable&lt;UserClass&gt;</code> .  Et en tant que mod√®le, nous utilisons la classe <code>UsersGrid</code> , qui se trouve dans le fichier <i>UsersGrid.cs</i> du r√©pertoire <i>Model</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersGrid</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;UserClass&gt; Users { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PagingInfo PagingInfo { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SortingInfo SortingInfo { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } }</code> </pre> <br>  Et les classes <code>PagingInfo</code> et <code>SortingInfo</code> elles-m√™mes dans le fichier <code>GridInfo.cs</code> au m√™me endroit. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PagingInfo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//     public int totalItems { get; set; } //     public int itemsPerPage { get; set; } //   public int currentPage { get; set; } //         public int showPages { get; set; } //   public int totalPages { get { return (int)Math.Ceiling((decimal)totalItems / itemsPerPage); } } //           public int pagesSide { get { return (int)Math.Truncate((decimal)showPages / 2); } } } public class SortingInfo { //  ,     public string currentOrder { get; set; } //   public SortDirection currentDirection { get; set; } //      public string currentSort { get { return currentDirection != SortDirection.Descending ? currentOrder : currentOrder + "_desc"; } } //       (      -   ) public string NewOrder(string columnName) { return columnName == currentOrder &amp;&amp; currentDirection != SortDirection.Descending ? columnName + "_desc" : columnName; } }</span></span></code> </pre> <br>  Et pour une utilisation dans les vues, des assistants sp√©ciaux ont √©t√© ajout√©s au fichier <i>GridHelpers.cs</i> (r√©pertoire <i>HtmlHelpers</i> ): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GridHelpers</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//     1 ... 3 4 5 ... Last public static MvcHtmlString PageLinks(this HtmlHelper html, PagingInfo pagingInfo, Func&lt;int, string&gt; pageUrl) { StringBuilder result = new StringBuilder(); if (pagingInfo.currentPage &gt; pagingInfo.pagesSide + 1) {//   TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); TagBuilder tag = new TagBuilder("a"); tag.MergeAttribute("href", pageUrl(1)); tag.InnerHtml = "1"; li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } int page1 = pagingInfo.currentPage - pagingInfo.pagesSide; int page2 = pagingInfo.currentPage + pagingInfo.pagesSide; if (page1 &lt; 1) { page2 = page2 - page1 + 1; page1 = 1; } if (page2 &gt; pagingInfo.totalPages) page2 = pagingInfo.totalPages; if (page1 &gt; 2) {// ... TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); TagBuilder tag = new TagBuilder("span"); tag.InnerHtml = "..."; tag.AddCssClass("page-item"); tag.AddCssClass("disabled"); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } for (int i = page1; i &lt;= page2; i++) {//  TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); if (i == pagingInfo.currentPage) li.AddCssClass("active"); TagBuilder tag = new TagBuilder("a"); tag.AddCssClass("page-link"); tag.MergeAttribute("href", pageUrl(i)); tag.InnerHtml = i.ToString(); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } if (page2 &lt; pagingInfo.totalPages) {// ...    TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); TagBuilder tag = new TagBuilder("span"); tag.InnerHtml = "..."; tag.AddCssClass("page-item"); tag.AddCssClass("disabled"); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); li = new TagBuilder("li"); li.AddCssClass("page-item"); tag = new TagBuilder("a"); tag.MergeAttribute("href", pageUrl(pagingInfo.totalPages)); tag.InnerHtml = pagingInfo.totalPages.ToString(); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } return MvcHtmlString.Create(result.ToString()); } public static IHtmlString SortIdentifier(this HtmlHelper htmlHelper, string sortOrder, string field) { if (string.IsNullOrEmpty(sortOrder) || (sortOrder.Trim() != field &amp;&amp; sortOrder.Replace("_desc", "").Trim() != field)) return null; string glyph = "glyphicon glyphicon-chevron-up"; if (sortOrder.ToLower().Contains("desc")) { glyph = "glyphicon glyphicon-chevron-down"; } var span = new TagBuilder("span"); span.Attributes["class"] = glyph; return MvcHtmlString.Create(span.ToString()); } public static RouteValueDictionary ToRouteValueDictionary(this NameValueCollection collection, string newKey, string newValue) { var routeValueDictionary = new RouteValueDictionary(); foreach (var key in collection.AllKeys) { if (key == null) continue; if (routeValueDictionary.ContainsKey(key)) routeValueDictionary.Remove(key); routeValueDictionary.Add(key, collection[key]); } if (string.IsNullOrEmpty(newValue)) { routeValueDictionary.Remove(newKey); } else { if (routeValueDictionary.ContainsKey(newKey)) routeValueDictionary.Remove(newKey); routeValueDictionary.Add(newKey, newValue); } return routeValueDictionary; } }</span></span></code> </pre> <br>  Puisqu'une grille avec des donn√©es sans tri et sans informations de pagination est une chose plut√¥t inutile, et qu'il n'y a pas d'aide standard pour une table enti√®re de donn√©es dans ASP.NET MVC, vous devez la cr√©er vous-m√™me (ou en prendre une cr√©√©e par quelqu'un d'autre).  Dans ce cas, j'ai espionn√© plusieurs impl√©mentations dans les livres et solutions ASP.NET MVC pr√©sent√©s sur Internet.  De plus, pour une raison quelconque, les solutions qui combinent au moins le tri et la pagination des donn√©es, soit ne le sont pas du tout, soit je ne les ai pas trouv√©es.  J'ai d√ª comprendre tout cela, le combiner et le modifier √† un √©tat normal.  Par exemple, la pagination dans ces impl√©mentations ne fournit souvent pas la sortie d'une liste plus ou moins longue de pages - eh bien, que faire s'il y a plusieurs milliers de pages?  Je donne un exemple d'affichage pour la solution pr√©sent√©e ci-dessus: <br><br><img src="https://habrastorage.org/webt/wj/dt/yr/wjdtyrmtbxm5f_5jfj7til_iqy0.png"><br><br>  Nous avons √©galement besoin de vues pour cr√©er et modifier des donn√©es.  Vue de cr√©ation d'un objet de type <code>UserClass</code> : <br><br><img src="https://habrastorage.org/webt/0u/80/-i/0u80-itckfou4ciyyxremebrqy8.png"><br><br>  Et le code d'affichage ressemblera √† ceci: <br><br><pre> <code class="cpp hljs">@model Example_Users.Models.UserModel @{ ViewBag.Title = <span class="hljs-string"><span class="hljs-string">"New "</span></span> + Html.DisplayNameForModel().ToString().ToLower(); } &lt;h2&gt;@ViewBag.Title&lt;/h2&gt; @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (@Html.BeginForm(<span class="hljs-string"><span class="hljs-string">"New"</span></span>, <span class="hljs-string"><span class="hljs-string">"Users"</span></span>, FormMethod.Post)) { @Html.EditorFor(m =&gt; m.User); @Html.LabelFor(m =&gt; Model.User.Language)&lt;br /&gt; @Html.DropDownListFor(m =&gt; Model.User.Language.LanguageID, Model.SelectLanguages()) &lt;span/&gt;@Html.ValidationMessageFor(m =&gt; Model.User.Language.LanguageID)&lt;br /&gt; &lt;br /&gt; &lt;p&gt;&lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Add"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"button"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"history.go(-1)"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Cancel"</span></span> /&gt;&lt;/p&gt; @*&lt;p&gt;@Html.ActionLink(<span class="hljs-string"><span class="hljs-string">"Back to list"</span></span>, <span class="hljs-string"><span class="hljs-string">"Index"</span></span>)&lt;/p&gt;*@ }</code> </pre> <br>  Cette vue montre, par exemple, l'utilisation de l'assistant <code>Html.EditorFor</code> comme moyen de g√©n√©rer des balises pour √©diter toutes les propri√©t√©s des objets de la classe <code>UserClass</code> .  Il s'affiche comme suit: <br><br><img src="https://habrastorage.org/webt/v-/rz/kw/v-rzkwz4dtui-xhs4lo2vbjyf3s.png"><br><br>  Cette vue utilise la classe <code>UserModel</code> comme mod√®le, pas directement la classe utilisateur.  La classe <code>UserModel</code> elle <code>UserModel</code> m√™me <code>UserModel</code> trouve dans le fichier <i>UserModel.cs</i> du r√©pertoire <i>Models</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserModel</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UserClass User { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IList&lt;LanguageClass&gt; Languages { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user, IList&lt;LanguageClass&gt; languages)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.User = user; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Languages = languages; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;SelectListItem&gt; SelectLanguages() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Languages != null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectList(Languages, <span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>, <span class="hljs-string"><span class="hljs-string">"LanguageName"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } }</code> </pre> <br>  L'objet <code>UserClass</code> lui-m√™me et une liste suppl√©mentaire d'objets de type <code>LanguageClass</code> inclus dans cette classe.  Nous avions besoin de cette liste pour cr√©er une liste d√©roulante de langues, avec la langue utilisateur actuelle s√©lectionn√©e: <code>@Html.DropDownListFor(m =&gt; Model.User.Language.LanguageID, Model.SelectLanguages(), "")</code> <br><br>  Cet assistant utilise l'appel √† la fonction <code>SelectLanguages()</code> , qui convertit la liste des langues en un objet de type <code>SelectList</code> avec les param√®tres d'identifiant et de nom de ligne d√©j√† d√©finis.  Mettre la g√©n√©ration de cet objet dans la vue serait une erreur, car l'id√©e n'√©tait pas de conna√Ætre ces liaisons avec les noms de champ.  <code>SelectList</code> s√ªr, il serait possible de g√©n√©rer une <code>SelectList</code> pr√™te √† l' <code>SelectList</code> directement dans le contr√¥leur, mais j'aime l'option avec une liste priv√©e d'objets de classe de domaine et une fonction de plus. <br><br>  Pour g√©n√©rer une liste d√©roulante, nous devons utiliser des assistants distincts, car l' <code>Html.EditorFor(m =&gt; m.User)</code> ne g√©n√©rera pas de balisage d'√©dition pour un objet incorpor√© de type <code>LanguageClass</code> (cela pourrait √™tre contourn√© en √©crivant un mod√®le g√©n√©ral pour les listes d√©roulantes, mais ici nous nous ne le ferons pas ...). <br><br>  Et comme nous utilisons un objet de la classe <code>UserModel</code> √† notre avis, qui inclut un autre objet de la classe <code>UserClass</code> , nous ne pourrons pas utiliser l' <code>Html.EditorForModel()</code> , car les aides ne sont pas r√©cursives et ne fonctionneront pas dans cette situation, donc l'aide <code>Html.EditorFor()</code> est utilis√©e <code>Html.EditorFor()</code> pour l'objet <code>User</code> . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je veux √©galement faire attention √† la balise comment√©e: </font></font><code>Html.ActionLink("Back to list", "Index")</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habituellement, un retour de la vue pour la modification de la liste de donn√©es est impl√©ment√© de la m√™me mani√®re. En fait, tout d'abord, √† mon avis, cela semble √©trange - lorsque vous utilisez des boutons de saisie dans un formulaire </font></font><code>button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et que le bouton de retour est pour une raison quelconque impl√©ment√© par un lien. Deuxi√®mement, si nous utilisons le tri et la pagination - nous devrons √™tre prudents en revenant √† la m√™me page dans la m√™me vue - et en passant non seulement l'objet √† la vue </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais aussi les param√®tres de retour √† la page. Il existe un moyen beaucoup plus simple - utilisez l'option avec un bouton comme:</font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui renverra l'utilisateur vers la page d'historique du navigateur. Ici, bien s√ªr, il y a des nuances (par exemple, vous avez d√©j√† essay√© d'enregistrer l'objet sur cette page, cela n'a pas fonctionn√©, et maintenant - vous devez d√©j√† double-cliquer sur le bouton Annuler), mais cette option dans son ensemble fonctionne bien. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et la vue pour √©diter un objet de type </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/a2/eo/xh/a2eoxhk3nzvbvs0h7s_nmjxuems.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et son code:</font></font><br><br><pre> <code class="cpp hljs">@model Example_Users.Models.UserModel @{ ViewBag.Title = <span class="hljs-string"><span class="hljs-string">"Edit "</span></span> + Html.DisplayNameForModel().ToString().ToLower(); } &lt;h2&gt;@ViewBag.Title @Model.User.Loginname&lt;/h2&gt; @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (@Html.BeginForm(<span class="hljs-string"><span class="hljs-string">"Edit"</span></span>, <span class="hljs-string"><span class="hljs-string">"Users"</span></span>, FormMethod.Post)) { @Html.HiddenFor(m =&gt; Model.User.UserID) &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.Loginname) @Html.EditorFor(m =&gt; Model.User.Loginname) @Html.ValidationMessageFor(m =&gt; Model.User.Loginname) &lt;/div&gt; &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.Language) @Html.DropDownListFor(m =&gt; Model.User.Language.LanguageID, Model.SelectLanguages()) @Html.ValidationMessageFor(m =&gt; Model.User.Language.LanguageID) &lt;/div&gt; &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.Email) @Html.EditorFor(m =&gt; Model.User.Email) @Html.ValidationMessageFor(m =&gt; Model.User.Email) &lt;/div&gt; &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.SupporterTier) @Html.EditorFor(m =&gt; Model.User.SupporterTier) @*@Html.EnumDropDownListFor(m =&gt; Model.User.SupporterTier)*@ @*@Html.DropDownListFor(m =&gt; m.Model.User.SupporterTier, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectList(Enum.GetNames(typeof(Example_Users.Domain.Supporter))))*@ @Html.ValidationMessageFor(m =&gt; Model.User.SupporterTier) &lt;/div&gt; &lt;br /&gt; &lt;p&gt;&lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Save"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Remove"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"javascript:return confirm('Are you sure?');"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Cancel"</span></span> /&gt;&lt;/p&gt; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et dans cette vue, l'option d'utiliser diff√©rents assistants pour g√©n√©rer des balises s√©par√©ment pour chaque propri√©t√© souhait√©e d'un objet de classe est pr√©sent√©e. </font><font style="vertical-align: inherit;">Dans ce cas, vous pouvez d√©j√† rendre l'affichage d'une mani√®re l√©g√®rement diff√©rente et plus jolie: </font></font><br><br><img src="https://habrastorage.org/webt/3g/ew/as/3gewasn6m2whqy9odk4gvrn2l0c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et dans cette vue, une autre fa√ßon est utilis√©e pour revenir √† la liste. </font><font style="vertical-align: inherit;">Au lieu d'utiliser un bouton comme: </font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le m√™me bouton est utilis√© comme les autres boutons d'action ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supprimer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): </font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le retour s'effectue √† l'int√©rieur de la m√©thode du contr√¥leur qui traite les actions de ces boutons (voir l'impl√©mentation de la m√©thode ci-dessous).</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enum </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et puis il y avait une nuance associ√©e √† l'utilisation d'une propri√©t√© de classe de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le fait est que si nous utilisons simplement l'aide </font></font><code>Html.EditorFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le champ de saisie des informations textuelles (type tag </font></font><code>&lt;input type=‚Äùtext‚Äù/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">sera </font><font style="vertical-align: inherit;">affich√© sur le formulaire </font><font style="vertical-align: inherit;">, mais nous avons en fait besoin d'un champ avec un choix parmi un ensemble de valeurs (c'est-√†-dire une balise </font></font><code>&lt;select&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec un ensemble d'options </font></font><code>&lt;option&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. est r√©solu en </font><font style="vertical-align: inherit;">utilisant le </font><font style="vertical-align: inherit;">type d'rectilignement aide </font></font><code>Html.DropDownListFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>Html.ListBoxFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, par exemple, dans notre cas </font></font><code>@Html.DropDownListFor(m =&gt; m.Model.User.SupporterTier, new SelectList(Enum.GetNames(typeof(Example_Users.Domain.Supporter))))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il y a deux inconv√©nients - √† chaque fois, il devra √™tre prescrit individuellement pour l'aide </font></font><code>Html.EditorForModel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>Html.EditorFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cela ne fonctionnera pas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Vous pouvez cr√©er un mod√®le de type personnalis√© </font></font><code>Editor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cr√©ez le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supporter.cshtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le </font><font style="vertical-align: inherit;">dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Views \ Shared \ EditorTemplates</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><pre> <code class="xml hljs">@model Example_Users.Domain.Supporter @Html.DropDownListFor(m =&gt; m, new SelectList(Enum.GetNames(Model.GetType()), Model.ToString()))</code> </pre> <br>      ,     <code>Html.EditorFor(m =&gt; Model.SupporterTier)</code> ,  <code>Html.EditorFor(m =&gt; Model.SupporterTier, "Supporter")</code> .    -,           <code>[UIHint("Supporter")]</code> .     ,    <code>Html.EditorForModel()</code> ‚Äì     <code>Html.EditorFor(m =&gt; Model.SupporterTier, "Supporter")</code>  . <br><br>      -  ,     (  <code>New</code> )    <code>Html.EditorFor()</code>  <code>Html.EditorForModel()</code>   : ¬´ <i> ,   ,   NULL,         ¬´Example_Users.Domain.Supporter¬ª,    NULL.</i> ¬ª   ‚Äì       ,       .    . <br><br> 3.    <code>Html.EnumDropDownListFor()</code> ,    .    ,     ,   ,        .   ¬´¬ª:  <code>Html.EditorForModel()</code>       <code>Html.EditorFor()</code> , ,   <code>Html.EnumDropDownListFor()</code> . ,   ,          ‚Äì <code>[UIHint]</code> , <code>[DataType]</code>  <code>[EnumDataType]</code>   .        ,    None  , ,   ,       <code>Supporter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. En cons√©quence, j'ai trouv√© une option de solution </font></font><a href="https://odetocode.com/Blogs/scott/archive/2012/08/29/working-with-enums-and-templates-in-asp-net-mvc.aspx" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouv√©e sur Internet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : cr√©er un mod√®le commun pour les transferts. </font><font style="vertical-align: inherit;">Cr√©ez le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enum.cshtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le </font><font style="vertical-align: inherit;">dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Views \ Shared \ EditorTemplates</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="xml hljs">@using System.ComponentModel.DataAnnotations @model Enum @{ Func<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object,</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">string</span></span></span><span class="hljs-tag">&gt;</span></span> GetDisplayName = o =&gt; { var result = null as string; var display = o.GetType() .GetMember(o.ToString()).First() .GetCustomAttributes(false) .OfType<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DisplayAttribute</span></span></span><span class="hljs-tag">&gt;</span></span>() .LastOrDefault(); if (display != null) result = display.GetName(); return result ?? o.ToString(); }; var values = Enum.GetValues(ViewData.ModelMetadata.ModelType).Cast<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag">&gt;</span></span>() .Select(v =&gt; new SelectListItem { Selected = v.Equals(Model), Text = GetDisplayName(v), // v.ToString(), Value = v.ToString() }); } @Html.DropDownList("", values)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, en g√©n√©ral, tout s'est bien pass√©: le mod√®le fonctionne tr√®s bien dans la mesure du possible. </font><font style="vertical-align: inherit;">Vous </font></font><code>[UIHint("Enum")]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne pouvez </font><font style="vertical-align: inherit;">m√™me </font><font style="vertical-align: inherit;">pas ajouter. </font><font style="vertical-align: inherit;">De plus, ce mod√®le g√©n√©ral lit l'attribut </font></font><code>[Display(Name)]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des valeurs d'√©num√©ration √† l'aide d'une fonction sp√©ciale.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C signifie contr√¥leur </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UsersController.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au r√©pertoire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controllers</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersController</span></span></span><span class="hljs-class"> :</span></span> Controller { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pageSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> showPages = <span class="hljs-number"><span class="hljs-number">15</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    public ViewResult Index(string sortOrder, int page = 1) { string sortName = null; System.Web.Helpers.SortDirection sortDir = System.Web.Helpers.SortDirection.Ascending; sortOrder = Base.parseSortForDB(sortOrder, out sortName, out sortDir); UsersRepository rep = new UsersRepository(); UsersGrid users = new UsersGrid { Users = rep.List(sortName, sortDir, page, pageSize, out count), PagingInfo = new PagingInfo { currentPage = page, itemsPerPage = pageSize, totalItems = count, showPages = showPages }, SortingInfo = new SortingInfo { currentOrder = sortName, currentDirection = sortDir } }; return View(users); } [ReferrerHold] [HttpPost] public ActionResult Index(string onNewUser) { if (onNewUser != null) { TempData["referrer"] = ControllerContext.RouteData.Values["referrer"]; return View("New", new UserModel(new UserClass(), Languages())); } return View(); } [ReferrerHold] public ActionResult New() { TempData["referrer"] = ControllerContext.RouteData.Values["referrer"]; return View("New", new UserModel(new UserClass(), Languages())); } [HttpPost] public ActionResult New(UserModel model) { if (ModelState.IsValid) { if (model.User == null || model.User.Language == null || model.User.Language.LanguageID == 0) RedirectToAction("Index"); UsersRepository rep = new UsersRepository(); if (rep.AddUser(model.User)) TempData["message"] = string.Format("{0} has been added", model.User.Loginname); else TempData["error"] = string.Format("{0} has not been added!", model.User.Loginname); if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString()); return RedirectToAction("Index"); } else { model = new UserModel(model.User, Languages()); // -          model.Languages,   return View(model); } } [ReferrerHold] public ActionResult Edit(int UserID) { UsersRepository rep = new UsersRepository(); UserClass user = rep.FetchByID(UserID); if (user == null) return HttpNotFound(); TempData["referrer"] = ControllerContext.RouteData.Values["referrer"]; return View(new UserModel(user, Languages())); } [HttpPost] public ActionResult Edit(UserModel model, string action) { if (action == "Cancel") { if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString()); return RedirectToAction("Index"); } if (ModelState.IsValid) { if (model.User == null || model.User.Language == null || model.User.Language.LanguageID == 0) RedirectToAction("Index"); UsersRepository rep = new UsersRepository(); if (action == "Save") { if (rep.ChangeUser(model.User)) TempData["message"] = string.Format("{0} has been saved", model.User.Loginname); else TempData["error"] = string.Format("{0} has not been saved!", model.User.Loginname); } if (action == "Remove") { if (rep.RemoveUser(model.User)) TempData["message"] = string.Format("{0} has been removed", model.User.Loginname); else TempData["error"] = string.Format("{0} has not been removed!", model.User.Loginname); } if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString()); return RedirectToAction("Index"); } else { model = new UserModel(model.User, Languages()); return View(model); } } public IList&lt;LanguageClass&gt; Languages() { IList&lt;LanguageClass&gt; languages = new List&lt;LanguageClass&gt;(); LanguagesRepository rep = new LanguagesRepository(); languages = rep.List(); return languages; } }</span></span></code> </pre> <br>   : <br><br> 1)  <code>Index</code> <br><br>     : <code>public ViewResult Index(string sortOrder, int page = 1)</code> <br><br>     <code>sortOrder</code>  <code>page</code> .  <code>page</code>  - ,    <code>sortOrder</code>       ,       SQL-     .        (     ,     <i>Base.cs</i> ): <code>sortOrder = Base.parseSortForDB(sortOrder, out sortName, out sortDir);</code> <br><br>   ,    <code>UsersRepository</code> (   ,    ),   <code>List</code>         <code>UsersGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† partir de la liste r√©elle des utilisateurs et des informations n√©cessaires √† l'organisation de la pagination des informations et du tri. De plus, la valeur de totalItem est obtenue lors de l'appel de la m√©thode </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, simultan√©ment √† la cr√©ation de l'objet classe </font></font><code>UsersGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En outre, cet objet est transf√©r√© pour l'affichage √† la repr√©sentation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe √©galement une autre m√©thode Index avec l'attribut </font></font><code>[HttpPost]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dont nous avions besoin pour calculer un clic sur un bouton </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la vue </font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><code>public ActionResult Index(string onNewUser)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le param√®tre d'entr√©e a </font></font><code>onNewUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quelque chose en commun avec l'√©l√©ment </font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la vue </font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et lorsque nous cliquons sur ce bouton, il transmet la valeur √† la fonction que nous v√©rifions par rapport √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si les boutons de type </font></font><code>submit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©taient dans la vue</font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plusieurs, vous devrez v√©rifier la valeur elle-m√™me (dans ce cas, la valeur serait "Nouvel utilisateur"). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s v√©rification, nous formons un objet de classe </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, compos√© d'un nouvel objet </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et d'une liste de langues pour les s√©lectionner dans la liste d√©roulante et les transmettre √† la pr√©sentation </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La liste des langues est obtenue √† partir du r√©f√©rentiel en </font></font><code>LanguageRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appelant la m√©thode </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme suit:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;LanguageClass&gt; Languages() { LanguagesRepository rep = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LanguagesRepository(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rep.List(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) M√©thodes </font></font><code>New</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une m√©thode </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sans param√®tre est con√ßue pour √©tablir un clic sur le lien </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nouvel utilisateur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour une ligne comment√©e </font></font><code>Html.ActionLink("New user", "New", "Users")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la vue </font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. L'action (ouverture de la vue </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) est effectu√©e de la m√™me mani√®re que la pr√©c√©dente, seulement il n'y a pas de contr√¥le sur le bouton enfonc√©, car un clic sur le lien est en cours d'√©laboration. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La m√©thode </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec le param√®tre mod√®le du type </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour traiter l'√©v√©nement d'envoi de donn√©es de formulaire afin d'enregistrer le nouvel utilisateur dans la base de donn√©es: </font></font><code>public ActionResult New(UserModel model)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©cup√®re l'objet de classe rempli de la nouvelle vue </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, v√©rifie l'exactitude des donn√©es (selon les exigences d√©crites dans </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>LanguageClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), cr√©e l'objet de r√©f√©rentiel </font></font><code>UsersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et essaie d'ajouter une nouvelle ligne √† la base de donn√©es, appeler une fonction</font></font><code>AddUser(model.User)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il revient ensuite √† la page pr√©c√©dente (d'o√π la vue a √©t√© appel√©e </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et un message y est affich√© indiquant le succ√®s de l'op√©ration ou l'√©chec. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) M√©thodes </font></font><code>Edit</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une m√©thode </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec un param√®tre d'entr√©e </font></font><code>UserID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ID utilisateur) clique sur le nom d'utilisateur dans la liste pour ouvrir la vue d'√©dition des donn√©es utilisateur: </font></font><code>public ActionResult Edit(int UserID)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la m√©thode, un r√©f√©rentiel est cr√©√© √† nouveau </font></font><code>UsersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et une fonction est appel√©e √† partir de celui-ci </font></font><code>FetchByID(UserID)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour obtenir un objet de type </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En cas de succ√®s, un mod√®le est cr√©√© - un objet </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font><font style="vertical-align: inherit;">classe √† </font><font style="vertical-align: inherit;">partir de l'objet re√ßu et une liste de langues et transmis √† la vue </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour affichage. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©thode avec un param√®tre d'entr√©e du type </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et du </font><font style="vertical-align: inherit;">mod√®le de </font><font style="vertical-align: inherit;">ligne </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><code>public ActionResult Edit(UserModel model, string action)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un objet type est transmis √† cette m√©thode </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et il traite les actions lorsque les boutons sont cliqu√©s (traitement des √©v√©nements pour l'envoi des donn√©es de formulaire) de la vue </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Afin de comprendre quel bouton est enfonc√©, le param√®tre d'entr√©e est utilis√© </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui est indiqu√© dans le nom des balises de type HTML </font></font><code>input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Par cons√©quent, la m√©thode compare les valeurs de ce param√®tre avec les valeurs de param√®tre de </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ces boutons. Avant de v√©rifier la validit√© du mod√®le, la valeur est v√©rifi√©e </font></font><code>Cancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour effectuer des actions pour annuler la modification de l'utilisateur. Cette option est utilis√©e au lieu de revenir √† l'historique du navigateur, qui est utilis√© dans la vue </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et utilise le stockage de l'adresse de la page √† partir de laquelle la vue a √©t√© redirig√©e.</font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour ce faire, le contr√¥leur a d√©montr√© la technologie d'utilisation de son attribut </font></font><code>ActionFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la classe </font></font><code>ReferrerHoldAttribute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReferrerHoldAttribute.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (r√©pertoire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HtmlAttribute</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReferrerHoldAttribute</span></span></span><span class="hljs-class"> :</span></span> ActionFilterAttribute { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionExecutingContext filterContext)</span></span></span><span class="hljs-function"> </span></span>{ var referrer = filterContext.RequestContext.HttpContext.Request.UrlReferrer; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (referrer != null) filterContext.RouteData.Values.Add(<span class="hljs-string"><span class="hljs-string">"referrer"</span></span>, referrer); base.OnActionExecuting(filterContext); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est utilis√© pour stocker des informations sur la page o√π vous devez retourner apr√®s avoir cliqu√© sur le bouton " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nouvel utilisateur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " ou sur un lien pour changer l'utilisateur: </font></font><code>TempData["referrer"] = ControllerContext.RouteData.Values["referrer"];</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous en avons besoin pour qu'√† chaque fois nous n'√©crivions pas le m√™me code dans diff√©rentes m√©thodes. Il serait possible d'√©crire une fonction distincte dans le contr√¥leur, mais si plusieurs contr√¥leurs sont utilis√©s, il est plus pratique d'utiliser un type d'attribut sp√©cial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par la suite, dans le corps de la m√©thode qui traite les actions des vues </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, les informations stock√©es sont extraites et utilis√©es pour rediriger vers la page d'o√π ces vues ont √©t√© appel√©es: </font></font><code>if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString());</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour d√©terminer si l'utilisateur doit √™tre enregistr√© ou supprim√©, le param√®tre est compar√© </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supprimez</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> respectivement les </font></font><code>UsersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctions </font></font><code>ChangeUser(model.User)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font><font style="vertical-align: inherit;">sont appel√©es √† partir du r√©f√©rentiel </font></font><code>RemoveUser(model.User)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ensuite, il y a un retour √† la page pr√©c√©dente (d'o√π l'appel de vue est venu </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et un message y est affich√© indiquant le succ√®s de l'op√©ration ou l'√©chec.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ADO.NET et MySQL - r√©f√©rentiel </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, nous avons finalement pu travailler avec le SGBD. </font><font style="vertical-align: inherit;">Nous devons impl√©menter les fonctions d'ajout d'un utilisateur √† une table </font></font><code>Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, d'apporter des modifications aux donn√©es utilisateur, de supprimer un utilisateur de la table, d'obtenir l'utilisateur par ID, d'obtenir une liste d'utilisateurs et d'obtenir une liste de langues de la table </font></font><code>Languages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plupart du temps, des constructions standard sont utilis√©es pour la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL.Data en</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisant </font></font><code>MySqlCommand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection( )) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">" "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">" "</span></span>,  ).Value =  ; connect.Open(); result = cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//        (INSERT, UPDATE, DELETE)   cmd.ExecuteScalar()         SELECT } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>MySqlDataReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour lire les lignes du tableau √† la suite d'une requ√™te:</font></font><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection( )) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">" "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlDataReader dr = cmd.ExecuteReader()) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">" "</span></span>,  ).Value =  ; objConnect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (dr.Read()) {<span class="hljs-comment"><span class="hljs-comment">//       } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ez le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserRepository.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le r√©pertoire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Models</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersRepository</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user)</span></span></span><span class="hljs-function"> </span></span>{ user.UserID = AddUser(Name: user.Loginname, LanguageID: user.Language.LanguageID, Email: user.Email, SupporterTier: user.SupporterTier); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.UserID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Email, Supporter SupporterTier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ID = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">"INSERT INTO `Users` (`Loginname`, `LanguageID`, `Email`, `SupporterTier`) VALUES (@Loginname, @LanguageID, @Email, @SupporterTier)"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Loginname"</span></span>, MySqlDbType.String).Value = Name; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>, MySqlDbType.Int32).Value = LanguageID; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>, MySqlDbType.String).Value = Email; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>, MySqlDbType.Int32).Value = SupporterTier; connect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { sql = <span class="hljs-string"><span class="hljs-string">"SELECT LAST_INSERT_ID() AS ID"</span></span>; cmd.CommandText = sql; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.TryParse(cmd.ExecuteScalar().ToString(), out ID); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ID; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ChangeUser(ID: user.UserID, Name: user.Loginname, LanguageID: user.Language.LanguageID, Email: user.Email, SupporterTier: user.SupporterTier); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Email, Supporter SupporterTier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">"UPDATE `Users` SET `Loginname`=@Loginname, `LanguageID`=@LanguageID, `Email`=@Email, `SupporterTier`=@SupporterTier WHERE UserID=@UserID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, MySqlDbType.Int32).Value = ID; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Loginname"</span></span>, MySqlDbType.String).Value = Name; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>, MySqlDbType.Int32).Value = LanguageID; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>, MySqlDbType.String).Value = Email; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>, MySqlDbType.Int32).Value = SupporterTier; connect.Open(); result = cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RemoveUser(user.UserID); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">"DELETE FROM `Users` WHERE `UserID`=@UserID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, MySqlDbType.Int32).Value = ID; connect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UserClass </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FetchByID</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID)</span></span></span><span class="hljs-function"> </span></span>{ UserClass user = null; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection objConnect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> strSQL = <span class="hljs-string"><span class="hljs-string">"SELECT u.`UserID`, u.`Loginname`, l.`LanguageID`, l.`LanguageName`, u.`Email`, u.`LastLoginDate`, CAST(u.`SupporterTier` AS UNSIGNED) as `SupporterTier` FROM `Users` u LEFT JOIN `Languages` l ON l.LanguageID=u.LanguageID WHERE `UserID`=@UserID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(strSQL, objConnect)) { objConnect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UserID = <span class="hljs-number"><span class="hljs-number">0</span></span>, LanguageID = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Loginname = null, LanguageName= null, Email = String.Empty; Supporter SupporterTier = Supporter.None; DateTime? LastLoginDate = null; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, MySqlDbType.Int32).Value = ID; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlDataReader dr = cmd.ExecuteReader()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dr.Read()) { UserID = dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>); Loginname = dr.GetString(<span class="hljs-string"><span class="hljs-string">"Loginname"</span></span>).ToString(); LanguageID = dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>); LanguageName = dr.GetString(<span class="hljs-string"><span class="hljs-string">"LanguageName"</span></span>).ToString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dr.IsDBNull(dr.GetOrdinal(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>))) Email = dr.GetString(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>).ToString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dr.IsDBNull(dr.GetOrdinal(<span class="hljs-string"><span class="hljs-string">"LastLoginDate"</span></span>))) LastLoginDate = dr.GetDateTime(<span class="hljs-string"><span class="hljs-string">"LastLoginDate"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dr.IsDBNull(dr.GetOrdinal(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>))) SupporterTier = (Supporter)dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>); } LanguageClass language = null; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LanguageID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) language = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LanguageClass(LanguageID: LanguageID, LanguageName: LanguageName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UserID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; language != null &amp;&amp; language.LanguageID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UserClass(UserID: UserID, Loginname: Loginname, Language: language, Email: Email, LastLoginDate: LastLoginDate, SupporterTier: (Supporter)SupporterTier); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user; } <span class="hljs-comment"><span class="hljs-comment">//       ASP.NET WebForms,             ObjectDataSource      //     ,         " "         //public IEnumerable&lt;DataRow&gt; List() //{ // using (MySqlConnection objConnect = new MySqlConnection(Base.strConnect)) // { // string strSQL = "select * from users"; // using (MySqlCommand objCommand = new MySqlCommand(strSQL, objConnect)) // { // objConnect.Open(); // using (MySqlDataAdapter da = new MySqlDataAdapter(objCommand)) // { // DataTable dt = new DataTable(); // da.Fill(dt); // return dt.AsEnumerable(); // } // } // } //} public IList&lt;UserClass&gt; List(string sortOrder, System.Web.Helpers.SortDirection sortDir, int page, int pagesize, out int count) { List&lt;UserClass&gt; users = new List&lt;UserClass&gt;(); using (MySqlConnection objConnect = new MySqlConnection(Base.strConnect)) { //     string sort = " ORDER BY "; //   ,               (inject) // ,  , MySQL        //    ,         (       ) //        ,    if (sortOrder != null &amp;&amp; sortOrder != String.Empty) { sort += "`" + sortOrder + "`"; if (sortDir == System.Web.Helpers.SortDirection.Descending) sort += " DESC"; sort += ","; } sort += "`UserID`"; //   //        ( ) string limit = ""; if (pagesize &gt; 0) { int start = (page - 1) * pagesize; limit = string.Concat(" LIMIT ", start.ToString(), ", ", pagesize.ToString()); } string strSQL = "SELECT SQL_CALC_FOUND_ROWS u.`UserID`, u.`Loginname`, l.`LanguageID`, l.`LanguageName` as `Language`, u.`Email`, u.`LastLoginDate`, CAST(u.`SupporterTier` AS UNSIGNED) as `SupporterTier` FROM `Users` u LEFT JOIN `Languages` l ON l.LanguageID=u.LanguageID" + sort + limit; using (MySqlCommand cmd = new MySqlCommand(strSQL, objConnect)) { objConnect.Open(); cmd.Parameters.Add("page", MySqlDbType.Int32).Value = page; cmd.Parameters.Add("pagesize", MySqlDbType.Int32).Value = pagesize; using (MySqlDataReader dr = cmd.ExecuteReader()) { while (dr.Read()) { LanguageClass language = new LanguageClass(LanguageID: dr.GetInt32("LanguageID"), LanguageName: dr.GetString("Language").ToString()); users.Add(new UserClass( UserID: dr.GetInt32("UserID"), Loginname: dr.GetString("Loginname"), Language: language, Email: dr.IsDBNull(dr.GetOrdinal("Email")) ? String.Empty : dr.GetString("Email"), LastLoginDate: dr.IsDBNull(dr.GetOrdinal("LastLoginDate")) ? (DateTime?) null : dr.GetDateTime("LastLoginDate"), SupporterTier: dr.IsDBNull(dr.GetOrdinal("SupporterTier")) ? (Supporter) Supporter.None : (Supporter)dr.GetInt32("SupporterTier"))); } } } using (MySqlCommand cmdrows = new MySqlCommand("SELECT FOUND_ROWS()", objConnect)) { int.TryParse(cmdrows.ExecuteScalar().ToString(), out count); } } return users; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il contient une m√©thode </font></font><code>AddUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour ajouter un utilisateur, mettre √† jour les donn√©es utilisateur ( </font></font><code>ChangeUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), supprimer ( </font></font><code>RemoveUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), rechercher l'utilisateur ( </font></font><code>FetchByID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) par identifiant et la m√©thode la plus int√©ressante </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour afficher une liste pagin√©e d'utilisateurs avec tri. </font><font style="vertical-align: inherit;">Je voudrais en outre commenter la fonction </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela ne vaut pas la peine de renvoyer la table ( </font></font><code>DataTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) en tant que telle - dans ce cas, nous perdrons la possibilit√© d'acc√©der aux √©l√©ments de la classe dans la vue et serons oblig√©s d'utiliser des constantes de cha√Æne pour faire r√©f√©rence aux valeurs de la ligne de table.</font></font> C'est-√†-dire          SQL-.       <code>UserClass</code> . </li><li>          <code>LIMIT</code>  SQL- <code>SELECT</code> .  ,  MySQL      ,   <code>LIMIT</code>       .   ,     ,       <code>ORDER BY</code>           . ,         SQL-,     SQL   ,       ,     .       ,      ,          :         . </li><li>           SQL  <code>SELECT FOUND_ROWS()</code> ,          ,     <code>SELECT SQL_CALC_FOUND_ROWS</code>     <code>LIMIT</code> . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes les autres m√©thodes sont compl√®tement ordinaires, conformes au canon ci-dessus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LanguageRepository.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le r√©pertoire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Models</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LanguagesRepository</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;LanguageClass&gt; List() { List&lt;LanguageClass&gt; languages = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;LanguageClass&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection objConnect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> strSQL = <span class="hljs-string"><span class="hljs-string">"SELECT `LanguageID`, `LanguageName` as `Language` FROM `Languages` ORDER BY `LanguageName`"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(strSQL, objConnect)) { objConnect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlDataReader dr = cmd.ExecuteReader()) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (dr.Read()) { LanguageClass language = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LanguageClass(LanguageID: dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>), LanguageName: dr.GetString(<span class="hljs-string"><span class="hljs-string">"Language"</span></span>).ToString()); languages.Add(language); } } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> languages; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'a qu'une seule fonction pour obtenir une liste de langues √† partir de la base de donn√©es, cr√©ant une liste d'√©l√©ments de classe </font></font><code>LanguageClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h2>  Total </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est tout - la t√¢che est r√©solue. </font><font style="vertical-align: inherit;">Il est clair que de nombreux probl√®mes n'ont pas √©t√© abord√©s: conteneur d'injection de d√©pendance, tests unitaires, outils de moking, localisation, etc.</font></font> etc.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certaines choses pourraient √™tre faites diff√©remment ou simplement mieux. </font><font style="vertical-align: inherit;">Mais la ¬´brique¬ª qui s'est av√©r√©e est suffisamment compl√®te pour comprendre comment ASP.NET MVC fonctionne et qu'il n'est pas si effrayant de travailler avec ADO.NET et des SGBD qui ne sont pas MS SQL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS Et enfin: vous pouvez voir comment ce projet fonctionne √† </font></font><a href="http://example-mvc.azurewebsites.net/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette adresse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et </font></font><a href="https://yadi.sk/d/EArrZdGh_iVaJg" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous pouvez t√©l√©charger l'int√©gralit√© du projet. </font><font style="vertical-align: inherit;">Eh bien, au tas - un lien vers </font></font><a href="https://dukeyusupov.wordpress.com/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mon blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482346/">https://habr.com/ru/post/fr482346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482332/index.html">Comment un passionn√© a cr√©√© un r√©seau Wi-Fi sous DOS</a></li>
<li><a href="../fr482336/index.html">Les commer√ßants ont acc√®s aux conf√©rences de presse de la Banque centrale d'Angleterre avant leur diffusion publique</a></li>
<li><a href="../fr482338/index.html">Visual Studio pour Mac: contr√¥lez votre IDE avec des cl√©s</a></li>
<li><a href="../fr482340/index.html">De Junior'a √† Middle'a: Parser</a></li>
<li><a href="../fr482344/index.html">Pr√©parez-vous √† l'introduction d'un classement social en Russie</a></li>
<li><a href="../fr482352/index.html">Comme j'ai jet√© presque 150k dans le vent ou l'histoire de l'installation de la ventilation forc√©e dans l'appartement</a></li>
<li><a href="../fr482354/index.html">ConfigureAwait: Foire aux questions</a></li>
<li><a href="../fr482356/index.html">Utilisation de Windows Server sans explorateur du point de vue d'un utilisateur Windows classique</a></li>
<li><a href="../fr482358/index.html">Comment fonctionne la panique √† Rust</a></li>
<li><a href="../fr482360/index.html">D√©tective Habra: ils sont amis avec les OVNIS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>