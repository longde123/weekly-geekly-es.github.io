<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙏 👨🏼‍💻 ✍️ Backdoor auf Node.js: warum, warum und wie es funktioniert 🧗🏼 😙 🔰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kürzlich haben uns Kollegen von Yandex ein Beispiel eines interessanten Trojaners mitgeteilt, über das wir in diesen Nachrichten berichtet haben. Eine...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Backdoor auf Node.js: warum, warum und wie es funktioniert</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/drweb/blog/460255/">  Kürzlich haben uns Kollegen von Yandex ein Beispiel eines interessanten Trojaners mitgeteilt, über das wir in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesen</a> Nachrichten berichtet haben.  Eine solche Malware kommt nicht oft vor, daher haben wir uns entschlossen, sie genauer zu zerlegen und gleichzeitig darüber zu sprechen, warum wir selten auf solche Beispiele stoßen. <br><a name="habracut"></a><br>  Der Trojaner ist eine in JavaScript geschriebene Mehrkomponenten-Hintertür, die mit Node.js. ausgeführt wird.  Die Hauptelemente sind Worker und Updater, die vom Bootloader heruntergeladen und im System installiert werden.  Die Nutzdaten können beliebig sein. In diesem Fall installiert der Trojaner den xmrig-Miner.  Zum Zeitpunkt der Studie verwendete der Entwickler den Miner, um die TurtleCoin-Kryptowährung abzubauen. <br><br>  MonsterInstall wird über Websites mit Cheats für beliebte Videospiele verbreitet.  Die meisten dieser Ressourcen gehören dem Entwickler des Trojaners, aber wir haben mehrere andere infizierte Dateien auf anderen ähnlichen Websites gefunden.  Der Besitzer eines von ihnen überwacht regelmäßig die Aktualisierungen der Wettbewerber und füllt seine Ressource mit neuen Inhalten.  Dazu verwendet er das Skript parser.php, das über einen Proxy auf cheathappens.com nach neuen Cheats sucht. <br><br><pre><code class="plaintext hljs">Proxy parse done, total: 1 Use sox 84.228.64.133:1080 Error: CURL error(#52), attempts left: 10 Use sox 84.228.64.133:1080 Posts found: 30! [33mPage Satisfactory: ўЂµ№ЅµЂ +8 vCL#96731 {CheatHappens.com} already in base[0m [33mPage Borderlands: The Pre-Sequel - ўЂµ№ЅµЂ +28 v1.2019 {LinGon} already in base[0m [33mPage Borderlands - Game of the Year Enhanced: ўЂµ№ЅµЂ +19 v1.0.1 {LinGon} already in base[0m [33mPage Star Wars: Battlefront 2 (2017): ўЂµ№ЅµЂ +4 v01.04.2019 {MrAntiFun} already in base[0m [36mPage Far Cry 5: ўЂµ№ЅµЂ +23 v1.012 (+LOST ON MARS/DEAD LIVING ZOMBIES) {CheatHappens.com} added 2019-Apr-09[0m [36mPage Fate/Extella Link: ўЂµ№ЅµЂ +13 v04.09.2019 {CheatHappens.com} added 2019-Apr-09[0m [36mPage Superhot: ўЂµ№ЅµЂ +3 v2.1.01p { MrAntiFun} added 2019-Apr-09[0m [36mPage Dawn of Man: ўЂµ№ЅµЂ +7 v1.0.6 {CheatHappens.com} added 2019-Apr-08[0m [36mPage Borderlands 2: ўЂµ№ЅµЂ +14 v06.04.2019 {MrAntiFun} added 2019-Apr-08[0m [36mPage Borderlands: The Pre-Sequel - ўЂµ№ЅµЂ +17 v06.04.2019 {MrAntiFun} added 2019-Apr-08[0m [36mPage Tropico 6: ўЂµ№ЅµЂ +9 v1.01 {MrAntiFun} added 2019-Apr-08[0m [36mPage Operencia: The Stolen Sun - ўЂµ№ЅµЂ +20 v1.2.2 {CheatHappens.com} added 2019-Apr-08[0m [36mPage Enter the Gungeon: ўЂµ№ЅµЂ +6 v2.1.3 {MrAntiFun} added 2019-Apr-07[0m [36mPage The Guild 3: ўЂµ№ЅµЂ +2 v0.7.5 {MrAntiFun} added 2019-Apr-07[0m [36mPage Dead Effect 2: ўЂµ№ЅµЂ +8 v190401 {MrAntiFun} added 2019-Apr-07[0m [36mPage Assassin's Creed: Odyssey - ўЂµ№ЅµЂ +26 v1.2.0 {FLiNG} added 2019-Apr-07[0m [36mPage Assassin's Creed: Odyssey - ўЂµ№ЅµЂ +12 v1.2.0 {MrAntiFun} added 2019-Apr-06[0m [36mPage Super Dragon Ball Heroes: World Mission - ўЂµ№ЅµЂ +11 v1.0 {FLiNG} added 2019-Apr-05[0m [36mPage Tropico 6: ўЂµ№ЅµЂ +7 v1.02 97490 {CheatHappens.com} added 2019-Apr-05[0m [36mPage Risk of Rain 2: ўЂµ№ЅµЂ +10 Build 3703355 {CheatHappens.com} added 2019-Apr-05[0m [36mPage Sid Meier's Civilization 6 - Rise and Fall: ўЂµ№ЅµЂ +12 v1.0.0.314 {MrAntiFun} added 2019-Apr-05[0m [36mPage Sid Meier's Civilization 6 - Gathering Storm: ўЂµ№ЅµЂ +12 v1.0.0.314 {MrAntiFun} added 2019-Apr-05[0m [36mPage Sid Meier's Civilization 6: ўЂµ№ЅµЂ +12 v1.0.0.314 {MrAntiFun} added 2019-Apr-05[0m [36mPage Borderlands GOTY Enhanced: ўЂµ№ЅµЂ +16 v1.0 {CheatHappens.com} added 2019-Apr-05[0m [36mPage Borderlands Game of the Year Enhanced: ўЂµ№ЅµЂ +13 v1.00 {MrAntiFun} added 2019-Apr-04[0m [36mPage Assassin's Creed: Odyssey: ўЂµ№ЅµЂ +24 v1.2.0 (04.04.2019) {CheatHappens.com} added 2019-Apr-04[0m [36mPage Sekiro: Shadows Die Twice - ўЂµ№ЅµЂ +24 v1.02 {FLiNG} added 2019-Apr-04[0m [36mPage Hearts of Iron 4: ўЂµ№ЅµЂ +24 v1.6.2 {MrAntiFun} added 2019-Apr-04[0m [36mPage Wolcen: Lords of Mayhem - ўЂµ№ЅµЂ +5 v1.0.2.1 {MrAntiFun} added 2019-Apr-04[0m [36mPage Devil May Cry 5: ўЂµ№ЅµЂ +18 v1.0 (04.03.2019) {CheatHappens.com} added 2019-Apr-04[0m Parse done</code> </pre> <br><br>  Auf den Websites der Entwickler gibt es eine große Auswahl an Cheats, aber für alle Links wird das gleiche Archiv zurückgegeben.  Wenn Sie versuchen, eine der Dateien von der Malware-Site herunterzuladen, erhält der Benutzer Trojan.MonsterInstall.  Einige Parameter des Trojaners können über den Download-Link erraten werden: <br><br><pre> <code class="plaintext hljs">https://&lt;malicious_site&gt;/fc/download.php?name=Borderlands%20GOTY%20Enhanced:%20%D0%A2%D1%80%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%20+16%20v1.0%20{CheatHappens.com}&amp;link=https://&lt;malicious_site&gt;//r.php?site=http://gtrainers.com/load/0-0-1-7081-20&amp;password=&lt;malicious_site&gt;/&amp;uid=101&amp;sid1=1&amp;sid2=1&amp;charset=utf-8</code> </pre><br><ul><li>  name - der Name des Archivs und exe im Archiv; </li><li>  Link - Ein Link zu der Datei, die der Benutzer herunterladen wollte (ist in data.json verkabelt). </li><li>  Passwort - Passwort für das Archiv. </li></ul><br>  Angenommen, wir wählen den gewünschten Cheat aus und laden das passwortgeschützte 7zip-Archiv mit dem vielversprechenden Namen "ExtrimHack.rar" von der Website des Trojaner-Entwicklers herunter.  Darin befinden sich eine ausführbare Datei, eine Konfigurationsdatei, eine 7zip-Bibliothek sowie ein bin-Archiv mit nativen C ++ - Bibliotheken und Skripten, die mit der Binärdatei Node.js. gestartet wurden <br><br>  Beispiel für einen Archivinhalt: <br><br><ul><li>  7z.dll; </li><li>  data.bin; </li><li>  data.json; </li><li>  ESP-Cheat für COP GO.exe. </li></ul><br><br>  Wenn die ausführbare Datei gestartet wird, installiert der Trojaner alle für seinen Betrieb erforderlichen Komponenten und lädt den für den Benutzer erforderlichen Cheat unter Verwendung der Informationen aus der Datei data.json mit Parametern herunter. <br><br>  Beispielinhalt von data.json: <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"source"</span></span>:[<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">43</span></span>],<span class="hljs-string"><span class="hljs-string">"dataVersion"</span></span>:[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">115</span></span>],<span class="hljs-string"><span class="hljs-string">"link"</span></span>:<span class="hljs-string"><span class="hljs-string">"http:\/\/clearcheats.ru\/images\/dl\/csgo\/ESP_csgo.dll"</span></span>}</code> </pre><br><br>  Um mehrere Kopien seines Prozesses von der Arbeit auszuschließen, erstellt der Trojaner den Mutex „cortelMoney-suncMutex“ und installiert ihn im Verzeichnis „% WINDIR% \ WinKit \“.  Anschließend wird überprüft, ob es sich in der Registrierung befindet ([HKLM \\ Software \\ Microsoft \\ Windows-Knoten]).  In diesem Fall liest es seine Parameter und vergleicht die Version mit der in data.json angegebenen.  Wenn die Version aktuell ist, macht sie nichts weiter und endet. <br><br>  Danach entpackt der Trojaner den Inhalt von data.bin in% WINDIR% \\ WinKit \\ und installiert den Dienst, um start.js zu starten. <br><br>  Inhalt von data.bin: <br><ul><li>  Daemon; </li><li>  node_modules; </li><li>  7z.dll; </li><li>  msnode.exe; </li><li>  start.js; </li><li>  startDll.dll; </li><li>  update.js; </li><li>  updateDll.dll. </li></ul><br>  Gleichzeitig ist msnode.exe eine ausführbare Datei Node.js mit einer gültigen digitalen Signatur, und das Verzeichnis node_modules enthält die Bibliotheken "ffi", "node-windows" und "ref". <br><br>  Die Bibliothek startDll.dll wird in start.js geladen und ihr mymain-Export wird aufgerufen, in dem sie ihre Parameter aus der Registrierung liest, "% WINDIR% \\ WinKit \\ msnode% WINDIR% \\ WinKit \\ update.js" startet und den Dienst beendet "Windows-Knoten."  Das Skript update.js lädt wiederum die Bibliothek updateDll.dll und ruft den mymain-Export auf.  Nichts kompliziertes. <br><br>  In updateDll.dll beginnt der Trojaner, Ihre Internetverbindung zu überprüfen.  Zu diesem Zweck sendet er alle 10 Sekunden Anfragen an google.com, yahoo.com, facebook.com, bis alle drei 200 Code zurückgeben.  Anschließend wird eine Anfrage mit Konfigurationsdaten an den POST-Server <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">s44571fu</a> [.] Bget [.] Ru / CortelMoney / enter.php gesendet: <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"login"</span></span>:<span class="hljs-string"><span class="hljs-string">"NULL"</span></span>,<span class="hljs-string"><span class="hljs-string">"mainId"</span></span>:<span class="hljs-string"><span class="hljs-string">"PPrn1DXeGvUtzXC7jna2oqdO2m?WUMzHAoM8hHQF"</span></span>,<span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"NULL"</span></span>,<span class="hljs-string"><span class="hljs-string">"source"</span></span>:[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>],<span class="hljs-string"><span class="hljs-string">"updaterVersion"</span></span>:[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>],<span class="hljs-string"><span class="hljs-string">"workerVersion"</span></span>:[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]}</code> </pre> <br><br>  In diesem Fall wird für die Basisautorisierung ein Paar "cortel: money" verwendet, und der User-Agent wird auf "USER AGENT" gesetzt.  Für die grundlegende Autorisierung nachfolgender Anforderungen wird das Anmeldekennwort verwendet, das vom Server gemeldet wird. <br><br>  Der Server antwortet mit json wie folgt: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"240797"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"tdzjIF?JgEG5NOofJO6YrEPQcw2TJ7y4xPxqcz?X"</span></span>, <span class="hljs-string"><span class="hljs-string">"updaterVersion"</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">115</span></span>], <span class="hljs-string"><span class="hljs-string">"updaterLink"</span></span>: <span class="hljs-string"><span class="hljs-string">"http:\/\/s44571fu.bget.ru\/CortelMoney\/version\/0-0-0-115-upd.7z"</span></span>, <span class="hljs-string"><span class="hljs-string">"workerVersion"</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"workerLink"</span></span>: <span class="hljs-string"><span class="hljs-string">"http:\/\/s44571fu.bget.ru\/CortelMoney\/version\/0-0-3-0-work.7z"</span></span> }</code> </pre> <br><br>  Wie Sie sehen können, enthält die Antwort des Servers Versionen der Hauptelemente des Trojaners.  Wenn die aktuelle Version des Updaters auf dem Gerät des Benutzers älter ist als die vom Server gemeldete, lädt der Trojaner die Datei von dem angegebenen Link herunter und entpackt das Archiv in das Verzeichnis "% WINDIR% \\ WinKit \\\\", wo stattdessen der Wert des Parameters updaterVersion aus der Serverantwort angezeigt wird . <br><br>  Der Trojaner entpackt die Worker-Datei in das Verzeichnis% WINDIR% \\ WinKit \\ SystemNode \\ und startet dann "% WINDIR% \\ WinKit \\ SystemNode \\ Sysnode% WINDIR% \\ WinKit \\ SystemNode \\ main.js". <br><br>  Der Inhalt des Archivs mit dem Arbeiter: <br><ul><li>  node_modules; </li><li>  7za.exe; </li><li>  Codex; </li><li>  main.js; </li><li>  sysnode.exe. </li></ul><br>  Der Trojaner entfernt dann den Windows Node Guard-Dienst und erstellt ihn erneut, wobei die ausführbare Datei durch die Windows Node-Dienstdatei ersetzt wird.  Auf die gleiche Weise wird der Windows-Knotendienst neu erstellt und die ausführbare Datei durch den Dämon \\ service.exe ersetzt. <br><br>  Als nächstes bildet service.xml mit Parametern: <br><pre> <code class="javascript hljs">&lt;service&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">service.exe</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">executable</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">C:\Windows\\WinKit\0.0.0.115\msnode.exe</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">executable</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">"C:\Windows\\WinKit\0.0.0.115\start.js"</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">service</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><br>  Updater wird im Verzeichnis "C: \ Windows \ Reserve Service" installiert, vom Dienst registriert und von der Binärdatei Node.js. gestartet.  Es besteht auch aus mehreren js-Skripten und nativen C ++ - Bibliotheken.  Das Hauptmodul ist main.js. <br><br>  Der Inhalt des Archivs mit Updater: <br><ul><li>  main.js; </li><li>  start.js; </li><li>  crypto.dll; </li><li>  network.dll; </li><li>  service.exe. </li></ul><br>  Zunächst erkennt der Trojaner das aktuelle Datum, indem er eine Anfrage an google.com, yandex.ru oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.i.ua sendet.</a>  Er nutzt die etwas später erhaltenen Informationen.  Anschließend wird der Inhalt der Datei bootList.json mithilfe der Bibliothek crypto.dll entschlüsselt. <br><br>  Entschlüsselungsalgorithmus: <br><pre> <code class="javascript hljs">key = <span class="hljs-string"><span class="hljs-string">'123'</span></span> s = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(d)): s += chr((ord(d[i]) - ord(key[i % len(key)])) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>)</code> </pre><br><br>  Ruft von dort eine Liste der Verwaltungsserver ab: <br><pre> <code class="javascript hljs">[{<span class="hljs-string"><span class="hljs-string">"node"</span></span>:<span class="hljs-string"><span class="hljs-string">"http://cortel8x.beget.tech/reserve"</span></span>,<span class="hljs-string"><span class="hljs-string">"weight"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>},{<span class="hljs-string"><span class="hljs-string">"node"</span></span>:<span class="hljs-string"><span class="hljs-string">"http://reserve-system.ru/work"</span></span>,<span class="hljs-string"><span class="hljs-string">"weight"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>}]</code> </pre> <br><br>  Dann liest der Trojaner Informationen aus der Registrierung: <br><pre> <code class="plaintext hljs">function getInfo() { var WindowsNodeInfo = new Object(); WindowsNodeInfo.mainId = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "mainId"); WindowsNodeInfo.login = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "log"); WindowsNodeInfo.password = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "pass"); WindowsNodeInfo.source = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "source"); WindowsNodeInfo.updaterVersion = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "updaterVersion"); WindowsNodeInfo.workerVersion = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "workerVersion"); var ReserveSystemInfo = new Object(); ReserveSystemInfo.workerVersion = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Reserve System", "updaterVersion"); var myInfo = new Object(); myInfo.windowsNode = WindowsNodeInfo; myInfo.reserveSystem = ReserveSystemInfo; return JSON.stringify(myInfo); }</code> </pre><br>  Anschließend wird der HTTP-Header der Basisautorisierung hinzugefügt, der dem Paar „cortel: money“ entspricht, und mit einer POST-Anforderung an den zuvor entschlüsselten Verwaltungsserver gesendet. <br>  Als Antwort erhält der Server: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"updaterVersion"</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">"updaterLink"</span></span>: <span class="hljs-string"><span class="hljs-string">"/upd.7z"</span></span>, <span class="hljs-string"><span class="hljs-string">"updaterVerify"</span></span>: <span class="hljs-string"><span class="hljs-string">"£ñß(\u0012Ä\ti¾$ë5ž»\u001c²\u001c\fÙ=±÷ö‚´èUnŽÐÂBÔ\n\u001dW6?u½\u0005Œn\u000fp:üÍ\u0019\u0000\u000bSý«\u00137÷\u0013”'ì¥û§s7F\u0016ó\\\u000f%6ñê\"7î&lt;ýoäƒƒ0Æ%t ñÅv‚S¡\r\u001e•ÅÆ¡¿N)v\\f8\u0004F\fUS¯‰³§ oIõŒiÆîGÝª\u0017êH/8Ö1-°™[P 5E7X‡Fø%S ŠXÕ6Oþ=Vô‰…ˆ:.3Œ‚i\u000eÁù9Ã&amp;¾ŒM\u001eÛªé$\u0006#IèÞÛ\u0018À\u001b^è,ÁòÑCTXb\u001d$ç\u0004„ð¶0UVÕ»e\u001f\b\u001e¡Ä¼è+Fjúÿoâz\r !çô3xØs—_\u000b\u0017\u001fY]\u0001¥j^û\\W"</span></span>, <span class="hljs-string"><span class="hljs-string">"dateTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1534868028000</span></span>, <span class="hljs-string"><span class="hljs-string">"bootList"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://cortel8x.beget.tech/reserve/"</span></span>, <span class="hljs-string"><span class="hljs-string">"weight"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> }, { <span class="hljs-string"><span class="hljs-string">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://reserve-system.ru/work/"</span></span>, <span class="hljs-string"><span class="hljs-string">"weight"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> }] }, <span class="hljs-string"><span class="hljs-string">"dataInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">"I`ù@ÀP'ÈcÊÛ´#iè Ò~\u0007&lt;\u0001Ýìûl«ÔÆq\u0013àÛ\u0003\b\u0017ÑLÁ}ÿÚ˜DS']\u0003bf\u0003!¿Cð¸q¸ÖÜ'B¢CÄAMˆÀA¤d\u001c5¨d -\u0013‰\u0011Ñ¼F'|SB[¬°(Ü¹ÈÒÜ £L\u00071¾:`\u001bŒìýKõ\"²Ÿ¸$´3™UºÅ¨J†¨cƒf¿}r;Öeì¶x‰ØKt¥‹„47a\u001e¸Ô‡ˆy\u0006•\u001b\u0004‚‹„„•ó\u001a\u0019\nu&gt;¨)bkæ…'\u00127@é‹7µæy3ÈNrS'Mð‡\u0018\u0019¾òÓ[Žå5H‡ƒ·¦k'¿ÉŠ&amp;PÂÈîåÚ~M\u0010ðnáHæ“ªxÃv c×“\u0013…T…ïÑÝ\tœŽ\u0018†Æ\u00148$”Ôî"</span></span> }</code> </pre><br><br>  Und hier kommt das aktuelle Datum, das früher erhalten wurde.  Der Trojaner vergleicht dies mit dem vom Server übergebenen Parameter dataTime.  Wenn der Unterschied zwischen den Daten mehr als eine Woche beträgt (in Millisekunden), führt der Trojaner die Befehle nicht aus.  Der Parameter dataInfo enthält auch eine Datensignatur (Datenfeld), die mit dem in main.js verkabelten öffentlichen Schlüssel überprüft wird.  Der Parameter "bootList" enthält eine Liste der Server, die der Trojaner verschlüsselt und in "bootList.json" speichert. <br><br>  Danach vergleicht der Trojaner seine Version mit der im Parameter updaterVersion angegebenen.  Wenn die installierte Version nicht niedriger als die neueste ist, startet der Trojaner "upd \\ upd.exe", indem er den Parameter "main.js" übergibt.  Wenn die Version aus der Antwort des Servers neuer ist, lädt der Trojaner das Update-Archiv über den Link aus dem Parameter upd.7z "updaterLink" herunter, überprüft seine Signatur und entpackt es.  Anschließend wird die Version des Updates [HKLM \\ SOFTWARE \\ Microsoft \\ Reservesystem] 'updaterVersion' in die Registrierung geschrieben. Anschließend wird "upd \\ upd.exe" erneut gestartet und mit dem Parameter "main.js" übergeben. <br><br>  Der Worker des Trojaners überprüft, ob eine der Komponenten bereits installiert wurde, und entscheidet, ob Anwendungen installiert werden sollen.  Zuerst erstellt er den MoonTitleWorker-Mutex, entschlüsselt dann die CodeX-Datei mit einem XOR mit der Zeichenfolge „xor“ und führt sie aus.  Danach bildet sich json mit Informationen: <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"userId"</span></span>: id, <span class="hljs-string"><span class="hljs-string">"starter"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"worker"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"source"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"osInfo"</span></span>: {<span class="hljs-string"><span class="hljs-string">"isX64"</span></span>: True, <span class="hljs-string"><span class="hljs-string">"osString"</span></span>: <span class="hljs-string"><span class="hljs-string">"Windows 7 Enterprise"</span></span>}}</code> </pre><br>  Sendet diese Informationen mit einer POST-Anforderung an http: // &lt;malicious_site&gt; [.] Xyz: 1001 / getApps (aus Gründen des Anstands geben wir keinen Domänennamen an, der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> zu finden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ist</a> .) Die Serverantwort enthält möglicherweise Informationen zu den Anwendungen, die installiert werden müssen. <br><br>  Antwortbeispiel: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"body"</span></span>: { <span class="hljs-string"><span class="hljs-string">"apps"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"hash"</span></span>: <span class="hljs-string"><span class="hljs-string">"452f8e156c5c3206b46ea0fe61a47b247251f24d60bdba31c41298cd5e8eba9a"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">8137466</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">"link"</span></span>: <span class="hljs-string"><span class="hljs-string">"xmr-1-64.7z"</span></span>, <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"%pf%\\Microsoft JDX\\64"</span></span>, <span class="hljs-string"><span class="hljs-string">"runComand"</span></span>: <span class="hljs-string"><span class="hljs-string">"%path%\\moonlight.exe start.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"xmr64"</span></span> }] }, <span class="hljs-string"><span class="hljs-string">"head"</span></span>: <span class="hljs-string"><span class="hljs-string">"O~¨^Óå+ßzIçsG¬üS„Ê¶$êL–LùÎ¸Z\f\u0019ÐÐ\u000e \u0004\u001cÀU¯\u0011š)áUÚ\u001flß²A\u001fôÝÔìˆ±y%\"DP» ^¯«FUâ\u001cÔû\u001dµ´Jï#¬ÌÈ¹ÎÚª?\r—]Yj·÷õ³—\u001e°ÖÒ\\é‰¤d'BT\u0019·¦FõVQ°Aç')\u001cõªµ¦ýûHlbÍ¸þ}éŒ\u0000jvÔ%S;Ã×þA\u0011ß'I[´\u0004ýÚ\u0007Z:ZÂ\n–ñz#ÈBö›²2\u0007ÎJw±èTVoŸå\bÖR3½ù;ƒó\u0011ÉÌ€ÅÖàð06ÓeÕþˆ”7Ùš\u0011•»”˜¢5µgôÛc˜&amp;L\u000fê.?!Çæ}¨\u001eÕ—J#A¼_Ì\u0015càñb"</span></span> }</code> </pre><br>  Wenn das Gerät nicht über eine solche Anwendung verfügt, lädt der Trojaner diese herunter, indem er eine POST-Anforderung an die URL http: // &lt;bösartige Website&gt; [.] Xyz: 1001 / sendet. Dort wird stattdessen der Link-Parameter für die entsprechende Anwendung aus der Serverantwort angegeben.  Wenn es eine solche Anwendung gibt, aber eine ältere Version, wird sie auf die aktuelle aktualisiert. <br><br>  Der Trojaner überprüft die Größe und den Hash der heruntergeladenen Datei anhand der vom Server in den Parametern Hash und Größe angegebenen Informationen.  Wenn die Daten konvergieren, wird die Datei vom Pfadparameter entlang des Pfads verschoben und der im Feld runCommand angegebene Befehl ausgeführt.  Informationen zur heruntergeladenen Anwendung werden in der Registrierung [HKLM \\ SOFTWARE \\ Microsoft \\ MoonTitle \\ apps \\] gespeichert. <br><br>  Im Moment wird der xmrig-Miner über die Hintertür eingestellt.  Abhängig von der Kapazität des Systems lädt der Trojaner ein xmr-1.7z- oder xmr-1-64.7z-Archiv herunter.  In start.js lädt es die Bibliothek xmrig.dll und ruft mymain export auf, wo es seine Umgebungsvariablen bereitstellt und die Prozesse abbricht: <br><ul><li>  % sys32_86% \\ xmr; </li><li>  % sys32_86% \\ xmr64; </li><li>  % pf_86% \\ Microsoft JDX \\ 32 \\ windows-update.exe; </li><li>  % pf_86% \\ Microsoft JDX \\ 64 \\ windows-update.exe. </li></ul><br>  Wenn sich die Datei xmrig.exe in der Nähe befindet, lädt der Trojaner sie in den Speicher des aktuellen Prozesses, löscht die MZ-Signatur, entschlüsselt sie mit XOR mit 0x39 und speichert den Speicherauszug in der Speicherauszugsdatei.  Wenn der Trojaner die "Dump" -Datei im selben Verzeichnis findet, entschlüsselt er sie auf die gleiche Weise, startet windows-update.exe und bettet die entschlüsselten Nutzdaten ein. <br><br>  Der Trojaner sammelt und sendet per POST-Anfrage an die URL: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">cherry-pot</a> [.] Top / RemoteApps / xmr / main.php die folgenden Systeminformationen: {"action": "enter", "architektur": "INTEL", "cpuAES" : true, "cpuCache": 8192, "cpuSpeed": 3392.0, "cpuThreads": 2, "cpuVendorString": "Intel® Core (TM) i5-4690S-CPU bei 3,20 GHz \ u0000", "hightPages": false, " login ":" null "," password ":" null "," ramPhysicalSize ": 3071," xmrigVersion ": [2,10,0]} <br><br>  Als Antwort sendet der Server die Miner-Konfiguration: <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"maxCpuLoad"</span></span>:<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-string"><span class="hljs-string">"minCpuLoad "</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"algo"</span></span>:<span class="hljs-string"><span class="hljs-string">"cryptonight-pico/trtl"</span></span>,<span class="hljs-string"><span class="hljs-string">"av"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"donate-level"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"max-cpu-usage"</span></span>:<span class="hljs-number"><span class="hljs-number">75</span></span>,<span class="hljs-string"><span class="hljs-string">"retries"</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-string"><span class="hljs-string">"retry-pause"</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-string"><span class="hljs-string">"cpu-priority"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"pools"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"url"</span></span>:<span class="hljs-string"><span class="hljs-string">"185.224.133.91:5511"</span></span>,<span class="hljs-string"><span class="hljs-string">"keepalive"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"nicehash"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}]}</code> </pre> <br>  Nachdem der Trojaner die Konfiguration in config.json gespeichert hat, wird er automatisch gestartet und das Mining gestartet. <br><br>  MonsterInstall hat andere Modifikationen.  Zusätzlich zu den Cheats für Spiele verteilte der Malvari-Entwickler sie beispielsweise unter dem Deckmantel eines Chrome-Browser-Installationsprogramms und eines Programms zum Überprüfen von Dateien.  In späteren Versionen des Trojaners dachte der Entwickler über Sicherheit nach und fügte eine Zeichenfolgenverschlüsselung hinzu sowie die Notwendigkeit, für einige Dateien ein Kennwort einzugeben.  Darüber hinaus verfügt der Bootloader einer der Versionen des Trojaners sogar über einen Link zu einer Lizenzvereinbarung, die in der Entwicklerdomäne des Trojaners gehostet wird. <br><br>  (Fragen zur Rechtskraft solcher Vereinbarungen gehen leider über den Rahmen dieses Artikels hinaus. Wenn Sie jedoch Interesse haben, Material zu diesem Thema zu lesen, teilen Sie uns dies in den Kommentaren mit.) <br><br>  <b>Schlussfolgerungen</b> <br><br>  Node.js ist nicht die praktischste Lösung für Virenschreiber.  Wenn die Größe eines solchen Trojaners klein sein kann, ist die Node.js-Bindung (ausführbare Datei und Bibliotheken) erheblich "schwerer" als die Standard-Malvari.  Was diktierte diese Wahl?  Entwickler wählen in der Regel Tools aus, mit denen sie vertraut sind.  Selbst bei den Züchtern ist die Wahl der Technologie daher eher eine Frage der persönlichen Präferenz.  Node.js hat jedoch seine Vorteile, von denen eine eine gültige Signatur ist.  Im System wird ein solcher Prozess als Node.js signiert, was selten Verdacht erregt. <br><br>  Zusammenfassend kann festgestellt werden, dass dies dem Backdoor-Entwickler trotz der interessanten Auswahl an Tools keinen signifikanten Vorteil verschaffte.  Es ist unwahrscheinlich, dass wir in Zukunft mehr Malware mit Node.js sehen werden. <br><br>  Wie üblich teilen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kompromissindikatoren</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460255/">https://habr.com/ru/post/de460255/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460241/index.html">Hölle oder Hochwasser: Geschichte der russischen populärwissenschaftlichen Literatur</a></li>
<li><a href="../de460247/index.html">Rezepte für ELFs</a></li>
<li><a href="../de460249/index.html">Lösung der Aufgabe mit pwnable.kr 07 - Eingabe. Pwntools verstehen</a></li>
<li><a href="../de460251/index.html">Künstliche Dummheit: Ein Bot, der mir nicht geholfen hat</a></li>
<li><a href="../de460253/index.html">10 Gründe, Ihre Fähigkeiten als Sprachassistent zu verbessern</a></li>
<li><a href="../de460257/index.html">Hallo Welt! Tiefes Eintauchen in Terminals</a></li>
<li><a href="../de460259/index.html">Was ist UI- und UX-Design? Was ist gemeinsam und anders?</a></li>
<li><a href="../de460261/index.html">Amazon: 25 Jahre E-Commerce-Erfolg</a></li>
<li><a href="../de460263/index.html">Eine wirklich intelligente Suche durchführen: Schritt-für-Schritt-Anleitung</a></li>
<li><a href="../de460265/index.html">Erstellen Sie eine Xcode-Projektvorlage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>