<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ–ğŸ¾ â³ ğŸ¤¯ ä»OpenAPI v3ï¼ˆaka Swagger 3ï¼‰åˆ°TypeScriptçš„ä»£ç ç”Ÿæˆ ğŸ‘Ÿ ğŸ›ŒğŸ¿ ğŸ“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸¤å¹´å‰ï¼Œæˆ‘å¼€å§‹å¼€å‘  è¿˜æœ‰ä¸€ä¸ª  ä»OpenAPI Specification v3åˆ°TypeScriptçš„å…è´¹ä»£ç ç”Ÿæˆå™¨ï¼ˆ å¯åœ¨Githubä¸Šè·å¾— ï¼‰ã€‚ æœ€åˆï¼Œæˆ‘å¼€å§‹è€ƒè™‘ä½¿ç”¨å„ç§JSON SchemaåŠŸèƒ½ï¼Œä¾‹å¦‚oneOf / anyOf / allOfç­‰ï¼Œåœ¨TypeScriptä¸­é«˜æ•ˆåœ°ç”ŸæˆåŸå§‹æ•°æ®...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä»OpenAPI v3ï¼ˆaka Swagger 3ï¼‰åˆ°TypeScriptçš„ä»£ç ç”Ÿæˆ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483628/"><p> ä¸¤å¹´å‰ï¼Œæˆ‘å¼€å§‹å¼€å‘ <del> è¿˜æœ‰ä¸€ä¸ª </del> ä»<a href="https://swagger.io/docs/specification/about/">OpenAPI Specification</a> v3åˆ°TypeScriptçš„å…è´¹ä»£ç ç”Ÿæˆå™¨ï¼ˆ <a href="https://github.com/koshevy/codegena">å¯åœ¨Githubä¸Šè·å¾—</a> ï¼‰ã€‚ æœ€åˆï¼Œæˆ‘å¼€å§‹è€ƒè™‘ä½¿ç”¨å„ç§<a href="https://json-schema.org/">JSON Schema</a>åŠŸèƒ½ï¼Œä¾‹å¦‚<a href="https://json-schema.org/understanding-json-schema/reference/combining.html">oneOf / anyOf / allOf</a>ç­‰ï¼Œåœ¨TypeScriptä¸­é«˜æ•ˆåœ°ç”ŸæˆåŸå§‹æ•°æ®å’Œå¤æ‚æ•°æ®ç±»å‹ã€‚  ï¼ˆSwaggerçš„<a href="https://github.com/swagger-api/swagger-codegen">æœ¬æœºè§£å†³æ–¹æ¡ˆ</a>å¯¹æ­¤å­˜åœ¨ä¸€äº›é—®é¢˜ï¼‰ã€‚ å¦ä¸€ä¸ªæƒ³æ³•æ˜¯ä½¿ç”¨è§„èŒƒä¸­çš„æ¨¡å¼åœ¨ç³»ç»Ÿçš„æ­£é¢ï¼ŒèƒŒé¢å’Œå…¶ä»–éƒ¨åˆ†è¿›è¡ŒéªŒè¯ã€‚ </p><br><p><img src="https://habrastorage.org/webt/hz/cd/u4/hzcdu47rcjbutgqbe6pdb2k46x8.png"></p><a name="habracut"></a><br><p> ç°åœ¨ä»£ç ç”Ÿæˆå™¨å·²ç»å‡†å¤‡å°±ç»ª-å¤„äº<a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B8%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE_%25D0%25B6%25D0%25B8%25D0%25B7%25D0%25BD%25D0%25B5%25D1%2581%25D0%25BF%25D0%25BE%25D1%2581%25D0%25BE%25D0%25B1%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BA%25D1%2582">MVP</a>é˜¶æ®µã€‚ å®ƒåœ¨ç”Ÿæˆæ•°æ®ç±»å‹æ–¹é¢æœ‰å¾ˆå¤šéœ€æ±‚ï¼Œè¿˜æœ‰ä¸€ä¸ªç”¨äºç”Ÿæˆå‰ç«¯æœåŠ¡çš„å®éªŒåº“ï¼ˆåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¯¹äºAngularï¼‰ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³å±•ç¤ºè¿™äº›å¼€å‘ï¼Œå¹¶å‘Šè¯‰æ‚¨ä½¿ç”¨TypeScriptå’ŒOpenAPI v3æ—¶å®ƒä»¬å¦‚ä½•æä¾›å¸®åŠ©ã€‚ åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€äº›åœ¨æˆ‘çš„å·¥ä½œè¿‡ç¨‹ä¸­å‡ºç°çš„æƒ³æ³•å’Œè€ƒè™‘ã€‚ å¥½å§ï¼Œå¦‚æœæ‚¨æœ‰å…´è¶£ï¼Œå¯ä»¥é˜…è¯»æˆ‘è—åœ¨æ‰°æµæ¿ä¸­çš„èƒŒæ™¯æ•…äº‹ï¼Œä»¥å…ä½¿æŠ€æœ¯éƒ¨åˆ†çš„é˜…è¯»å¤æ‚åŒ–ã€‚ </p><br><h2 id="soderzhanie"> ç›®å½•å†…å®¹ </h2><br><ol><li>  <a href="https://habr.com/ru/post/483628/">èƒŒæ™¯çŸ¥è¯†</a> </li><li>  <a href="https://habr.com/ru/post/483628/">å†…å®¹æè¿°</a> </li><li>  <a href="https://habr.com/ru/post/483628/">å®‰è£…åŠä½¿ç”¨</a> </li><li>  <a href="https://habr.com/ru/post/483628/">ç»ƒä¹ ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨</a> </li><li>  <a href="https://habr.com/ru/post/483628/">åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ç”Ÿæˆçš„æ•°æ®ç±»å‹</a> </li><li>  <a href="https://habr.com/ru/post/483628/">åˆ†è§£ç¬¦åˆOASè§„èŒƒçš„ç”µè·¯</a> </li><li>  <a href="https://habr.com/ru/post/483628/">åµŒå¥—åˆ†è§£</a> </li><li>  <a href="https://habr.com/ru/post/483628/">è‡ªåŠ¨ç”Ÿæˆçš„ç”¨äºREST APIçš„æœåŠ¡</a> <br><ol><li>  <a href="https://habr.com/ru/post/483628/">ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªï¼Ÿ</a> </li><li>  <a href="https://habr.com/ru/post/483628/">æœåŠ¡ç”Ÿæˆ</a> </li><li>  <a href="https://habr.com/ru/post/483628/">ä½¿ç”¨ç”Ÿæˆçš„æœåŠ¡</a> </li></ol></li><li>  <a href="https://habr.com/ru/post/483628/">è€Œä¸æ˜¯åè®°</a> </li></ol><br><a name="Foreword"></a><br><h2 id="predystoriya"> èƒŒæ™¯çŸ¥è¯† </h2><br><div class="spoiler">  <b class="spoiler_title">å±•å¼€é˜…è¯»ï¼ˆè·³è¿‡ï¼‰</b> <div class="spoiler_text"><p> ä¸€åˆ‡éƒ½å§‹äºä¸¤å¹´å‰-ç„¶åæˆ‘åœ¨ä¸€å®¶å¼€å‘æ•°æ®æŒ–æ˜å¹³å°çš„å…¬å¸å·¥ä½œï¼Œè´Ÿè´£å‰ç«¯ï¼ˆä¸»è¦æ˜¯TypeScript + Angularï¼‰ã€‚ é¡¹ç›®åŠŸèƒ½æ˜¯å…·æœ‰å¤§é‡å‚æ•°ï¼ˆ30ä¸ªæˆ–æ›´å¤šï¼‰çš„å¤æ‚æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å®ƒä»¬ä¹‹é—´å¹¶ä¸æ€»æ˜¯æ˜¾è€Œæ˜“è§çš„ä¸šåŠ¡å…³ç³»ã€‚ å…¬å¸å‘å±•å£®å¤§ï¼Œè½¯ä»¶ç¯å¢ƒä¸æ–­å˜åŒ–ã€‚ å‰ç«¯å¿…é¡»ç²¾é€šç»†å¾®å·®åˆ«ï¼Œå› ä¸ºåœ¨å‰ç«¯å’Œåç«¯é‡å¤äº†ä¸€äº›è®¡ç®—ã€‚ å°±æ˜¯è¯´ï¼Œå½“ä½¿ç”¨OpenAPIè¶…å‡ºé€‚å½“èŒƒå›´æ—¶å°±æ˜¯è¿™ç§æƒ…å†µã€‚ æˆ‘åœ¨å…¬å¸å·¥ä½œäº†ä¸€æ®µæ—¶é—´ï¼Œå‡ ä¸ªæœˆåï¼Œå¼€å‘å›¢é˜Ÿå°±è·å¾—äº†ä¸€ä¸ªè§„èŒƒï¼Œè¿™æˆä¸ºåç«¯ï¼Œå‰ç«¯ä¹ƒè‡³æ ¸å¿ƒéƒ¨é—¨ï¼ˆéšè—åœ¨Webåç«¯çš„èƒŒåï¼‰çš„é€šç”¨çŸ¥è¯†åº“ã€‚ é€‰æ‹©OpenAPIç‰ˆæœ¬æ˜¯ä¸ºäº†â€œå¢é•¿â€-é‚£æ—¶v3.0è¿˜å¾ˆå¹´è½» </p><br><p> è¿™ä¸å†æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªé™æ€YML / JSONæ–‡ä»¶ä¸­çš„è§„èŒƒï¼Œè€Œä¸å†æ˜¯<a href="https://github.com/zircote/swagger-php">æ³¨é‡Šå™¨</a>çš„ç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‰ç…§å¹³å°DDDæ¦‚å¿µç»„ç»‡çš„ç»„ä»¶ï¼Œæ–¹æ³•ï¼Œæ¨¡æ¿å’Œå±æ€§çš„å®Œæ•´åº“ã€‚ è¯¥åº“åˆ†ä¸ºç›®å½•å’Œæ–‡ä»¶ï¼Œä¸“é—¨å®‰æ’äº†ä¸€ä¸ªæ”¶é›†è€…ï¼Œä¸ºæ¯ä¸ªä¸»é¢˜é¢†åŸŸåˆ¶ä½œäº†OASæ–‡æ¡£ã€‚ å»ºç«‹äº†å®éªŒæ€§çš„å·¥ä½œæµç¨‹ï¼Œå¯ä»¥å°†å…¶æè¿°ä¸ºâ€œè®¾è®¡ä¼˜å…ˆâ€ã€‚ </p><br><blockquote>  Yandex.Moneyå…¬å¸çš„åšå®¢ä¸Šæœ‰ä¸€ç¯‡<a href="https://habr.com/ru/company/yamoney/blog/347390/">å¾ˆå¥½çš„æ–‡ç« </a> ï¼Œå†…å®¹æ¶‰åŠDesign First </blockquote><p>  â€œè®¾è®¡ä¼˜å…ˆâ€å’Œé€šç”¨è§„èŒƒæœ‰åŠ©äºå‡å°‘çŸ¥è¯†çš„ä½¿ç”¨ï¼Œä½†æ˜¯ä¸€ä¸ªæ–°é—®é¢˜å˜å¾—å¾ˆæ˜æ˜¾-ä¿æŒäº†ä»£ç çš„ç›¸å…³æ€§ã€‚ è¯¥è§„èŒƒæè¿°äº†æ•°åç§æ–¹æ³•å’Œæ•°åç§ï¼ˆä»¥åŠåæ¥çš„æ•°ç™¾ç§ï¼‰å®ä½“ã€‚ ä½†æ˜¯ä»£ç å¿…é¡»æ‰‹åŠ¨ç¼–å†™ï¼šæ•°æ®ç±»å‹ï¼Œç”¨äºRESTçš„æœåŠ¡ç­‰ã€‚ ä¸€ä¸¤ä¸ªå¸¦æœ‰å¹³è¡Œæ•…äº‹çš„å†²åˆºæå¤§åœ°æ”¹å˜äº†å±€é¢ã€‚ ä¸ºå¤šä¸ªæ•…äº‹å’Œäººä¸ºå› ç´ çš„åˆå¹¶å¢åŠ äº†å¤æ‚æ€§ã€‚ è¯¥ä¾‹ç¨‹å¯èƒ½éå¸¸é‡è¦ï¼Œè§£å†³æ–¹æ¡ˆä¼¼ä¹å¾ˆæ˜æ˜¾-æ‚¨éœ€è¦ä»£ç ç”Ÿæˆã€‚ æ¯•ç«Ÿï¼ŒOASè§„èŒƒå·²ç»åŒ…å«äº†æ‰€æœ‰å¿…è¦çš„å†…å®¹ï¼Œä»¥å…æ‰‹åŠ¨è¾“å…¥ã€‚ ä½†è¿™ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚ </p><br><p> å‰ç«¯å¤„äºç”Ÿäº§å‘¨æœŸçš„æœ€åï¼Œå› æ­¤ä¸å…¶ä»–éƒ¨é—¨çš„åŒäº‹ç›¸æ¯”ï¼Œæˆ‘æ„Ÿåˆ°æ›´åŠ ç—›è‹¦çš„å˜åŒ–ã€‚ åœ¨è®¾è®¡REST APIæ—¶ï¼Œåç«¯ç¯å¢ƒæ˜¯å†³å®šæ€§çš„ï¼Œå³ä½¿åœ¨â€œè®¾è®¡ä¼˜å…ˆâ€è·å¾—æ‰¹å‡†åï¼Œæƒ¯æ€§ä»ç„¶å­˜åœ¨ã€‚ å¯¹äºå‰ç«¯ï¼Œä¸€åˆ‡ä¼¼ä¹éƒ½ä¸é‚£ä¹ˆæ˜æ˜¾ã€‚ å®é™…ä¸Šï¼Œæˆ‘ä»ä¸€å¼€å§‹å°±äº†è§£è¿™ä¸€ç‚¹ï¼Œå¹¶å¼€å§‹æå‰æ¢ç©¶åœŸå£¤-å½“è°ˆè®ºâ€œé€šç”¨â€è§„èŒƒæ‰åˆšåˆšå¼€å§‹æ—¶ã€‚ æ²¡æœ‰äººè°ˆè®ºç¼–å†™è‡ªå·±çš„ä»£ç ç”Ÿæˆå™¨ã€‚ æˆ‘åªæ˜¯æƒ³æ‰¾åˆ°å‡†å¤‡å¥½çš„ä¸œè¥¿ã€‚ </p><br><p> æˆ‘å¾ˆå¤±æœ›ã€‚ æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šOASç‰ˆæœ¬3.0ï¼Œä¼¼ä¹æ²¡æœ‰äººæä¾›æ”¯æŒï¼Œè€Œä¸”è§£å†³æ–¹æ¡ˆæœ¬èº«çš„è´¨é‡ä¹Ÿå¾ˆä¸é”™-å½“æ—¶ï¼ˆæˆ‘è®°å¾—æ˜¯ä¸¤å¹´å‰ï¼‰ï¼Œæˆ‘è®¾æ³•æ‰¾åˆ°äº†ä¸¤ä¸ªç›¸å¯¹ç°æˆçš„è§£å†³æ–¹æ¡ˆï¼š <a href="https://github.com/swagger-api/swagger-codegen">Swagger</a>å’ŒMicrosoft ï¼ˆä¼¼ä¹<a href="https://github.com/Azure/autorest">æ˜¯</a> ï¼‰ã€‚ é¦–å…ˆï¼Œå¯¹OAS 3.0çš„æ”¯æŒå¤„äºæ·±åº¦æµ‹è¯•é˜¶æ®µã€‚ ç¬¬äºŒä¸ªä»…é€‚ç”¨äº2.xç‰ˆï¼Œä½†æ²¡æœ‰æ˜ç¡®çš„é¢„æµ‹ã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œå³ä½¿åœ¨Swagger 2.0æ ¼å¼çš„æµ‹è¯•æ–‡æ¡£ä¸Šï¼Œæˆ‘ä¹Ÿæ— æ³•å¯åŠ¨Microsoftä»£ç ç”Ÿæˆå™¨ã€‚  Swaggerçš„è§£å†³æ–¹æ¡ˆæœ‰æ•ˆï¼Œä½†æ˜¯å¸¦æœ‰$ refé“¾æ¥çš„æˆ–å¤šæˆ–å°‘å¤æ‚çš„æ–¹æ¡ˆå˜æˆäº†éš¾ä»¥ç†è§£çš„â€œ ERRORï¼â€ï¼Œå¹¶ä¸”é€’å½’ä¾èµ–æ€§å°†å…¶å‘é€åˆ°äº†æ— é™å¾ªç¯ä¸­ã€‚  <a href="">åŸå§‹ç±»å‹</a>å­˜åœ¨é—®é¢˜ã€‚ å¦å¤–ï¼Œæˆ‘ä¸å¤ªäº†è§£å¦‚ä½•ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„æœåŠ¡-å®ƒä»¬ä¼¼ä¹æ˜¯ä¸ºå±•ç¤ºè€Œåˆ¶ä½œçš„ï¼Œå¹¶ä¸”å®ƒä»¬çš„å®é™…ä½¿ç”¨äº§ç”Ÿäº†æ¯”å…¶è§£å†³çš„é—®é¢˜æ›´å¤šï¼ˆæˆ‘è®¤ä¸ºï¼‰ã€‚ æœ€åï¼Œå°†JARæ–‡ä»¶é›†æˆåˆ°é¢å‘NPMçš„CI / CDä¸­å¾ˆä¸æ–¹ä¾¿ï¼šæˆ‘ä¸å¾—ä¸æ‰‹åŠ¨ä¸‹è½½<a href="https://oss.sonatype.org/content/repositories/snapshots/io/swagger/codegen/v3/swagger-codegen-cli/3.0.15-SNAPSHOT/">å¿…è¦çš„å¿«ç…§</a> ï¼ˆä¼¼ä¹é‡13å…†å­—èŠ‚ï¼‰ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ æ€»çš„æ¥è¯´ï¼Œæˆ‘ä¼‘æ¯äº†ä¸€ä¼šï¼Œå†³å®šè§‚å¯Ÿæ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ </p><br><p> å¤§çº¦äº”ä¸ªæœˆåï¼Œå†æ¬¡å‡ºç°äº†ä»£ç ç”Ÿæˆé—®é¢˜ã€‚ æˆ‘ä¸å¾—ä¸é‡å†™å’Œæ‰©å±•Webåº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œä¸æ­¤åŒæ—¶ï¼Œæˆ‘æƒ³é‡æ„ç”¨äºä½¿ç”¨REST APIå’Œæ•°æ®ç±»å‹çš„æ—§æœåŠ¡ã€‚ ä½†æ˜¯å¯¹å¤æ‚æ€§çš„è¯„ä¼°å¹¶ä¸ä¹è§‚ï¼šä»ä¸€ä¸ªäººå‘¨åˆ°ä¸¤ä¸ªæ˜ŸæœŸ-ä½†è¿™ä»…ç”¨äºRESTæœåŠ¡å’Œç±»å‹æè¿°ã€‚ æˆ‘ä¸ä¼šè¯´è¿™è®©æˆ‘éå¸¸æ²®ä¸§ï¼Œä½†ä»ç„¶å¦‚æ­¤ã€‚ å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»æœªæ‰¾åˆ°ç”¨äºä»£ç ç”Ÿæˆçš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿæ²¡æœ‰ç­‰å¾…ï¼Œå¹¶ä¸”å…¶å®ç°å‡ ä¹ä¸éœ€è¦èŠ±è´¹æ›´å¤šæ—¶é—´ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯«æ— ç–‘é—®ï¼šæ”¶ç›Šæ˜¯å¯ç–‘çš„ï¼Œé£é™©æ˜¯å·¨å¤§çš„ã€‚ æ²¡æœ‰äººä¼šæ”¯æŒè¿™ä¸ªæƒ³æ³•ï¼Œæˆ‘æ²¡æœ‰æå‡ºã€‚ åŒæ—¶ï¼Œäº”æœˆå‡æœŸä¸´è¿‘ï¼Œå…¬å¸â€œæ¬ â€æˆ‘å‡ å¤©æ—¶é—´åœ¨å‘¨æœ«å·¥ä½œã€‚ æœ‰ä¸¤ä¸ªæ˜ŸæœŸï¼Œæˆ‘ä»æ‰€æœ‰çš„å·¥ä½œç»å†ä¸­é€ƒåˆ°äº†ä½æ²»äºšå·ï¼Œåœ¨é‚£é‡Œæˆ‘æ›¾ç»ä½äº†å°†è¿‘ä¸€å¹´ã€‚ </p><br><p> åœ¨èšä¼šå’Œå®´ä¼šä¹‹é—´ï¼Œæˆ‘éœ€è¦åšä¸€äº›äº‹æƒ…ï¼Œäºæ˜¯æˆ‘å†³å®šå†™ä¸‹è‡ªå·±çš„å†³å®šã€‚ åœ¨Vake Parké™„è¿‘çš„å¤å­£å’–å•¡é¦†å·¥ä½œä»¤äººæƒŠè®¶ï¼Œå·¥ä½œæ•ˆç‡å¾ˆé«˜ï¼Œæˆ‘å¸¦ç€ç°æˆçš„ç”¨äºæ•°æ®ç±»å‹çš„ä»£ç ç”Ÿæˆå™¨å›åˆ°Peterã€‚ ç„¶ååˆä¸€ä¸ªæœˆï¼Œæˆ‘åœ¨ä»–å‡†å¤‡ä¸Šç­ä¹‹å‰çš„å‘¨æœ«â€œå®Œæˆâ€äº†æœåŠ¡ã€‚ </p><br><p> ä»ä¸€å¼€å§‹ï¼Œæˆ‘å°±æ‰“å¼€äº†ä»£ç ç”Ÿæˆå™¨ï¼Œå¹¶åœ¨ä¸šä½™æ—¶é—´ä½¿ç”¨å®ƒã€‚ å°½ç®¡å®é™…ä¸Šä»–æ˜¯ä¸ºå·¥ä½œè‰æ¡ˆè€Œå†™çš„ã€‚ æˆ‘ä¸ä¼šè¯´ä¿®è®¢/ç£¨åˆæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼› æˆ‘ä¸ä¼šè¯´å®ƒä»¬å¾ˆé‡è¦ã€‚ ä½†æ˜¯åˆ°äº†æŸä¸ªæ—¶å€™ï¼Œæˆ‘æ³¨æ„åˆ°æˆ‘åœæ­¢ä½¿ç”¨Redoc / Swaggeræ–‡æ¡£ï¼šåªè¦ä»£ç å§‹ç»ˆæ˜¯æœ€æ–°çš„å¹¶å¸¦æœ‰æ³¨é‡Šï¼Œæµè§ˆä»£ç å°±ä¼šæ›´åŠ æ–¹ä¾¿ã€‚ å¾ˆå¿«ï¼Œæˆ‘â€œå¾—åˆ†â€æˆ‘çš„æˆå°±ï¼Œè€Œæ ¹æœ¬æ²¡æœ‰å‘å±•ï¼Œç›´åˆ°ä¸€ä½åŒäº‹ï¼ˆç°åœ¨æ˜¯å…­ä¸ªæœˆå‰æˆ‘å»å¦ä¸€å®¶å…¬å¸ï¼‰å»ºè®®æˆ‘æ›´è®¤çœŸåœ°å¯¹å¾…ä»–ä»¬ï¼ˆä»–ä¹Ÿæƒ³å‡ºäº†è¿™ä¸ªåå­—ï¼‰ã€‚ </p><br><blockquote> æˆ‘æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—²æ—¶é—´ï¼Œå› æ­¤èŠ±äº†å‡ ä¸ªæœˆçš„æ—¶é—´æˆ‘æ‰èƒ½åœ¨åå°å®Œæˆå·¥ä½œï¼š <a href="https://stackblitz.com/edit/codegena-playground">æ“åœº</a> ï¼Œæµ‹è¯•åº”ç”¨ç¨‹åºï¼Œé¡¹ç›®é‡ç»„ã€‚ ç°åœ¨ï¼Œæˆ‘å‡†å¤‡æ¥æ”¶åé¦ˆã€‚ </blockquote></div></div><br><a name="Description"></a><br><h2 id="opisanie"> å†…å®¹æè¿° </h2><br><p>ç›®å‰ï¼Œç”¨äºä»£ç ç”Ÿæˆçš„è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ä¸‰ä¸ªNPMåº“ï¼Œå®ƒä»¬é›†æˆåœ¨@codegena <code>@codegena</code>å¹¶ä½äºä¸€ä¸ªå…¬å…±çš„<a href="https://github.com/koshevy/codegena">å•è‰²å­˜å‚¨åº“ä¸­</a> ï¼š </p><br><div class="scrollable-table"><table><thead><tr><th> å›¾ä¹¦é¦† </th><th> å†…å®¹æè¿° </th></tr></thead><tbody><tr><td>  @ codegena / oapi3ts </td><td> åŸºç¡€åº“æ˜¯ä»OAS3åˆ°æ•°æ®ç±»å‹æè¿°çš„è½¬æ¢å™¨ï¼ˆç°åœ¨ä»…æ”¯æŒTypeScriptï¼‰ </td></tr><tr><td>  @ codegena / ng-api-service </td><td> æ‰©å±•è§’åº¦æœåŠ¡ </td></tr><tr><td>  @ codegena / oapi3ts-cli </td><td>  Shellï¼Œå¯åœ¨CLIè„šæœ¬ä¸­æ–¹ä¾¿ä½¿ç”¨ </td></tr></tbody></table></div><br><a name="SetupAndUsing"></a><br><h3 id="ustanovka-i-ispolzovanie"> å®‰è£…åŠä½¿ç”¨ </h3><br><p> æœ€å®ç”¨çš„é€‰æ‹©æ˜¯åœ¨ä»CLIè¿è¡Œçš„NodeJSè„šæœ¬ä¸­ä½¿ç”¨ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦å®‰è£…ä¾èµ–é¡¹ï¼š </p><br><pre> <code class="plaintext hljs">npm i @codegena/oapi3ts, @codegena/ng-api-service, @codegena/oapi3ts-cli</code> </pre> <br><p> ç„¶åï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªjsæ–‡ä»¶ï¼ˆä¾‹å¦‚<code>update-typings.js</code> ï¼‰ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliLib = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@codegena/oapi3ts-cli'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliApp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cliLib.CliApplication; cliApp.createTypings(); <span class="hljs-comment"><span class="hljs-comment">// cliApp.createServices('angular'); // optional</span></span></code> </pre> <br><p> å¹¶é€šè¿‡ä¼ é€’ä¸‰ä¸ªå‚æ•°å¯åŠ¨å®ƒï¼š </p><br><pre> <code class="plaintext hljs">node ./update-typings.js --srcPath ./specs/todo-app-spec.json --destPath ./src/lib --separatedFiles true</code> </pre> <br><p> åœ¨<code>destPath</code>å°†ç”Ÿæˆæ–‡ä»¶ï¼Œå®é™…ä¸Šï¼Œ <a href="https://github.com/koshevy/codegena/tree/master/libs/todo-app-scheme/src/lib">è¯¥ç›®å½•</a>åœ¨é¡¹ç›®å­˜å‚¨åº“ä¸­çš„å†…å®¹æ˜¯ä»¥ç›¸åŒçš„æ–¹å¼åˆ›å»ºçš„ã€‚  <a href="">è¿™æ˜¯ç”Ÿæˆè„šæœ¬</a> ï¼Œ <a href="">è¿™å°±æ˜¯</a>å®ƒåœ¨NPMè„šæœ¬ä¸­çš„è¿è¡Œæ–¹å¼ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œç”šè‡³å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨å®ƒï¼Œå°±åƒåœ¨<a href="https://codegena-playground.stackblitz.io/">Playgroundä¸­ä¸€æ ·</a> ã€‚ </p><br><a name="CodegenerationUsingPractice"></a><br><h2 id="praktika-ispolzovanie-kodogeneratora"> ç»ƒä¹ ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ </h2><br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘æƒ³è°ˆè°ˆæˆ‘ä»¬å°†å¾—åˆ°çš„ç»“æœï¼šè¿™å°†å¦‚ä½•å¸®åŠ©æˆ‘ä»¬ã€‚ è§†è§‰è¾…åŠ©å°†æ˜¯æ¼”ç¤ºåº”ç”¨ç¨‹åºçš„ä»£ç ã€‚ å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªåç«¯ï¼ˆåœ¨<a href="https://nestjs.com/">NestJS</a>æ¡†æ¶ä¸Šï¼‰å’Œä¸€ä¸ªå‰ç«¯ï¼ˆåœ¨<a href="https://angular.io/">Angularä¸Š</a> ï¼‰ã€‚ å¦‚æœæ„¿æ„ï¼Œæ‚¨ç”šè‡³<a href="https://github.com/koshevy/codegena/tree/5367749623826d270fb652e32fa394c023751877">å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œå®ƒ</a> ã€‚ </p><br><blockquote> å³ä½¿æ‚¨ä¸ç†Ÿæ‚‰Angularå’Œ/æˆ–NestJSï¼Œä¹Ÿä¸ä¼šå¼•èµ·é—®é¢˜ï¼šå¤§å¤šæ•°TypeScriptå¼€å‘äººå‘˜åº”ç†è§£å°†æä¾›çš„ä»£ç ç¤ºä¾‹ã€‚ </blockquote><p> å°½ç®¡åº”ç”¨ç¨‹åºå·²å°½å¯èƒ½ç®€åŒ–ï¼ˆä¾‹å¦‚ï¼Œåç«¯å°†æ•°æ®å­˜å‚¨åœ¨ä¼šè¯ä¸­ï¼Œè€Œä¸æ˜¯æ•°æ®åº“ä¸­ï¼‰ï¼Œä½†æˆ‘è¿˜æ˜¯å°è¯•é‡æ–°åˆ›å»ºçœŸå®åº”ç”¨ç¨‹åºä¸­å›ºæœ‰çš„æ•°æ®æµå’Œæ•°æ®ç±»å‹å±‚æ¬¡ç»“æ„çš„åŠŸèƒ½ã€‚ å¤§çº¦80-85ï¼…å·²ç»å‡†å¤‡å¥½äº†ï¼Œä½†æ˜¯â€œå®Œæˆâ€å¯èƒ½ä¼šå»¶è¿Ÿï¼Œä½†æ˜¯ç°åœ¨æ›´é‡è¦çš„æ˜¯è°ˆè®ºå·²ç»å­˜åœ¨çš„ä¸œè¥¿ã€‚ </p><br><a name="UsingGeneratedDataTypes"></a><br><h2 id="ispolzovanie-generiruemyh-tipov-dannyh-v-prilozheniyah"> åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ç”Ÿæˆçš„æ•°æ®ç±»å‹ </h2><br><p> å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¿…é¡»ä½¿ç”¨çš„OpenAPIè§„èŒƒï¼ˆä¾‹å¦‚ï¼Œ <a href="">æ­¤</a>è§„èŒƒï¼‰ã€‚ ä¸ç®¡æ˜¯ä»å¤´å¼€å§‹åˆ›å»ºä¸œè¥¿è¿˜æ˜¯è·å¾—æ”¯æŒï¼Œæˆ‘ä»¬æœ€æœ‰å¯èƒ½ä»ä¸€å¼€å§‹å°±ç€æ‰‹åšä¸€ä»¶äº‹-è¾“å…¥ã€‚ æˆ‘ä»¬å°†å¼€å§‹æè¿°åŸºæœ¬æ•°æ®ç±»å‹æˆ–å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚ å¤§å¤šæ•°ç¨‹åºå‘˜è¿™æ ·åšæ˜¯ä¸ºäº†ä¿ƒè¿›ä»–ä»¬å°†æ¥çš„å¼€å‘ã€‚ å› æ­¤ï¼Œæ‚¨ä¸å¿…å†æ¬¡æŸ¥çœ‹æ–‡æ¡£ï¼Œè¯·è®°ä½å‚æ•°åˆ—è¡¨ï¼› å¹¶ä¸”æ‚¨å¯ä»¥ç¡®ä¿IDEå’Œ/æˆ–ç¼–è¯‘å™¨ä¼šæ³¨æ„åˆ°è¾“å…¥é”™è¯¯ã€‚ </p><br><p> æˆ‘ä»¬çš„è§„èŒƒå¯èƒ½åŒ…æ‹¬ä¹Ÿå¯èƒ½ä¸åŒ…æ‹¬<a href="">components.schemçš„</a>éƒ¨åˆ†ã€‚ ä½†æ— è®ºå¦‚ä½•ï¼Œå®ƒå°†æè¿°å‚æ•°ï¼Œè¯·æ±‚å’Œç­”æ¡ˆçš„é›†åˆ-æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒã€‚ è€ƒè™‘ä¸€ä¸ªä¾‹å­ï¼š </p><br><pre> <code class="javascript hljs">@Controller(<span class="hljs-string"><span class="hljs-string">'group'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Put(':groupId') rewriteGroup( @Param(ParseQueryPipe) { groupId }: RewriteGroupParameters, @Body() body: RewriteGroupRequest, @Session() session ): RewriteGroupResponse&lt;HttpStatus.OK&gt; { return this.appService .setSession(session) .rewriteGroup(groupId, body); } // ... }</span></span></code> </pre> <br><p> è¿™æ˜¯NestJSæ¡†æ¶çš„<a href="">æ§åˆ¶å™¨</a>ç‰‡æ®µï¼Œå…¶ä¸­é”®å…¥äº†å‚æ•°ï¼ˆ <code>RewriteGroupParameters</code> ï¼‰ï¼Œè¯·æ±‚æ­£æ–‡ï¼ˆ <code>RewriteGroupRequest</code> ï¼‰å’Œå“åº”æ­£æ–‡ï¼ˆ <code>RewriteGroupResponse&lt;T&gt;</code> ï¼‰ã€‚ åœ¨æ­¤ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†é”®å…¥çš„å¥½å¤„ï¼š </p><br><ul><li> å¦‚æœæ··æ·†è¢«ç ´åçš„å‚æ•°<code>groupId</code>çš„åç§°ï¼Œè€Œæ”¹ä¸ºæŒ‡å®š<code>groupId</code> ï¼Œ <code>groupId</code>ç«‹å³åœ¨ç¼–è¾‘å™¨ä¸­å‡ºç°é”™è¯¯ã€‚ <br><img src="https://habrastorage.org/webt/1z/2q/0c/1z2q0cstw2lv3vncwmgi8gkxfa0.png"></li><li> å¦‚æœ<a href="">this.appService.rewriteGroupï¼ˆgroupIdï¼Œbodyï¼‰</a>æ–¹æ³•å…·æœ‰ç±»å‹åŒ–çš„å‚æ•°ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥æ§åˆ¶ä¼ é€’çš„<code>body</code>å‚æ•°çš„æ­£ç¡®æ€§ã€‚ å¦‚æœæ§åˆ¶å™¨æ–¹æ³•æˆ–æœåŠ¡æ–¹æ³•çš„è¾“å…¥æ•°æ®æ ¼å¼å‘ç”Ÿæ›´æ”¹ï¼Œæˆ‘ä»¬å°†ç«‹å³çŸ¥é“ã€‚ å±•æœ›æœªæ¥ï¼Œæˆ‘æ³¨æ„åˆ°serviceæ–¹æ³•çš„è¾“å…¥æ–¹æ³•çš„æ•°æ®ç±»å‹ä¸åŒäº<code>RewriteGroupRequest</code> ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒä»¬å°†å½¼æ­¤ç›¸åŒã€‚ ä½†æ˜¯ï¼Œå¦‚æœçªç„¶æ”¹å˜äº†æœåŠ¡æ–¹æ³•ï¼Œå¹¶å¼€å§‹æ¥å—<code>ToDoGroup</code>è€Œä¸æ˜¯<code>ToDoGroupBlank</code> ï¼Œåˆ™IDEå’Œç¼–è¯‘å™¨å°†ç«‹å³æ˜¾ç¤ºå·®å¼‚çš„ä½ç½®ï¼š <br><img src="https://habrastorage.org/webt/wo/cq/rr/wocqrrks2gtcthaq_wghrhlbbta.png"></li><li> åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¿”å›ç»“æœçš„ç¬¦åˆæ€§ã€‚ å¦‚æœæˆåŠŸå“åº”çš„çŠ¶æ€åœ¨è§„èŒƒä¸­çªç„¶æ”¹å˜ï¼Œä»<code>202</code>å˜ä¸º<code>200</code> ï¼Œè€Œä¸æ˜¯<code>200</code> ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå‘ç°å®ƒï¼Œå› ä¸º<code>RewriteGroupResponse</code>æ˜¯<a href="">å…·æœ‰æšä¸¾ç±»å‹çš„æ³›å‹</a> ï¼š <br><img src="https://habrastorage.org/webt/pt/io/ss/ptiossjjfhihchrlwdlydrrkft4.png"></li></ul><br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<a href="">å‰ç«¯åº”ç”¨ç¨‹åº</a>ä¸­ä¸<a href="">å¦ä¸€ä¸ªAPIæ–¹æ³•</a>ä¸€èµ·ä½¿ç”¨<a href="">çš„ç¤ºä¾‹</a> ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initSelectedGroupData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(truth: ComponentTruth)</span></span></span><span class="hljs-function">: Observable&lt;ComponentTruth&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getGroupsService.request(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, { isComplete: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, withItems: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }).pipe( pickResponseBody&lt;GetGroupsResponse&lt;<span class="hljs-number"><span class="hljs-number">200</span></span>&gt;&gt;(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), switchMap&lt;ToDoGroup[], Observable&lt;ComponentTruth&gt;&gt;( groups =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadItemsOfSelectedGroups({ ...truth, groups }) ) ); }</code> </pre> <br><p> è®©æˆ‘ä»¬ä¸è¦è¶…è¶Šè‡ªå·±ï¼Œè§£æè‡ªå®šä¹‰RxJSè¿ç®—ç¬¦<code>pickResponseBody</code> ï¼Œè€Œæ˜¯è®©æˆ‘ä»¬é›†ä¸­ç²¾åŠ›ä¼˜åŒ–<code>pickResponseBody</code>ç±»å‹ã€‚ æˆ‘ä»¬åœ¨RxJSè¿ç®—ç¬¦é“¾ä¸­ä½¿ç”¨å®ƒï¼Œå…¶åçš„è¿ç®—ç¬¦å…·æœ‰<code>ToDoGroup[]</code>çš„è¾“å…¥ç»†åŒ–ã€‚ å¦‚æœè¯¥ä»£ç æœ‰æ•ˆï¼Œåˆ™æŒ‡ç¤ºçš„æ•°æ®ç±»å‹å½¼æ­¤å¯¹åº”ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ§åˆ¶ç±»å‹åŒ¹é…ï¼Œå¦‚æœAPIä¸­çš„å“åº”æ ¼å¼çªç„¶å‘ç”Ÿå˜åŒ–ï¼Œè¿™å°†ä¸ä¼šå¼•èµ·æˆ‘ä»¬çš„æ³¨æ„ï¼š </p><br><p><img src="https://habrastorage.org/webt/ci/hr/7c/cihr7csbo5kqn9fqkreoij7kuxk.png"></p><br><p> å½“ç„¶ï¼Œè¿˜ä¼šé”®å…¥<code>this.getGroupsService.request</code>çš„è°ƒç”¨å‚æ•°ã€‚ ä½†è¿™æ˜¯ç”ŸæˆæœåŠ¡çš„ä¸»é¢˜ã€‚ </p><br><blockquote> åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯ä»¥åœ¨ç³»ç»Ÿçš„å„ä¸ªéƒ¨åˆ†ï¼ˆå‰ç«¯ï¼Œåç«¯ç­‰ï¼‰ä¸­ä½¿ç”¨è¯·æ±‚ï¼Œå“åº”å’Œå‚æ•°çš„ç±»å‹ã€‚ å¦‚æœåç«¯å’Œå‰ç«¯åœ¨åŒä¸€ä¸ªå•ä¸€å­˜å‚¨åº“ä¸­ï¼Œå¹¶ä¸”å…·æœ‰å…¼å®¹çš„ç”Ÿæ€ç¯å¢ƒï¼Œåˆ™å®ƒä»¬å¯ä»¥å¯¹ç”Ÿæˆçš„ä»£ç ä½¿ç”¨ç›¸åŒçš„<a href="https://github.com/koshevy/codegena/tree/5367749623826d270fb652e32fa394c023751877/libs/todo-app-scheme">å…±äº«åº“</a> ã€‚ ä½†æ˜¯ï¼Œå³ä½¿åç«¯å’Œå‰ç«¯ç”±ä¸åŒçš„å›¢é˜Ÿæ”¯æŒï¼Œå¹¶ä¸”é™¤äº†å…¬å…±OASè§„èŒƒå¤–æ²¡æœ‰å…¶ä»–å…±åŒç‚¹ï¼Œå¯¹äºä»–ä»¬æ¥è¯´ï¼ŒåŒæ­¥ä»£ç ä»ç„¶æ›´åŠ å®¹æ˜“ã€‚ </blockquote><br><a name="DecompositionInOAS"></a><br><h2 id="dekompoziciya-shem-vnutri-oas-specifikacii"> åˆ†è§£ç¬¦åˆOASè§„èŒƒçš„ç”µè·¯ </h2><br><p> å¯èƒ½åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨å…³æ³¨äº†<code>ToDoGroupBlank</code>å’Œ<code>ToDoGroup</code> ï¼Œå®ƒä»¬ä¸<code>RewriteGroupResponse</code>å’Œ<code>RewriteGroupResponse</code> <code>GetGroupsResponse</code> ã€‚ å®é™…ä¸Šï¼Œ <code>RewriteGroupResponse</code>åªæ˜¯<code>ToDoGroup</code> ï¼Œ <code>HttpErrorBadRequest</code>ç­‰çš„é€šç”¨åˆ«åã€‚ å¾ˆå®¹æ˜“çŒœåˆ°<a href="">ToDoGroup</a>å’Œ<a href="">HttpErrorBadRequest</a>éƒ½æ˜¯<a href="">rewriteGroupç«¯ç‚¹</a> ï¼ˆç›´æ¥æˆ–é€šè¿‡<a href="">ä¸­ä»‹</a> ï¼‰å¼•ç”¨çš„<a href="">components.schem</a>è§„èŒƒéƒ¨åˆ†ä¸­çš„æ–¹æ¡ˆï¼š </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"responses"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"200"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Todo group saved"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"content"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"application/json"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"schema"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ToDoGroup"</span></span> } } } }, <span class="hljs-attr"><span class="hljs-attr">"400"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorBadRequest"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"404"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorGroupNotFound"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"409"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorConflict"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"500"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorServer"</span></span> } }</code> </pre><br><p> è¿™æ˜¯æ•°æ®ç»“æ„çš„å¸¸è§åˆ†è§£ï¼Œå…¶åŸç†ä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€ç›¸åŒã€‚ ç»„ä»¶ä¹Ÿå¯ä»¥åˆ†è§£ï¼šå¼•ç”¨å…¶ä»–ç»„ä»¶ï¼ˆåŒ…æ‹¬é€’å½’ï¼‰ï¼Œä½¿ç”¨ç»„åˆå’Œå…¶ä»–JSON SchemaåŠŸèƒ½ã€‚ ä½†æ˜¯ï¼Œæ— è®ºå¤æ‚åº¦å¦‚ä½•ï¼Œéƒ½åº”å°†å…¶æ­£ç¡®è½¬æ¢ä¸ºæ•°æ®ç±»å‹çš„æè¿°ã€‚ æˆ‘æƒ³å±•ç¤ºå¦‚ä½•åœ¨OpenAPIä¸­ä½¿ç”¨åˆ†è§£ï¼Œä»¥åŠç”Ÿæˆçš„ä»£ç çš„å¤–è§‚ã€‚ </p><br><blockquote> ç²¾å¿ƒè®¾è®¡çš„OASè§„èŒƒä¸­çš„ç»„ä»¶å°†ä¸ä½¿ç”¨å®ƒçš„åº”ç”¨ç¨‹åºçš„DDDæ¨¡å‹é‡å ã€‚ ä½†æ˜¯ï¼Œå³ä½¿è§„èŒƒä¸å®Œå–„ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¾é å®ƒæ¥æ„å»ºè‡ªå·±çš„æ•°æ®æ¨¡å‹ã€‚ è¿™å°†ä½¿æ‚¨å¯ä»¥æ›´å¥½åœ°æ§åˆ¶æ•°æ®ç±»å‹ä¸å¯é›†æˆå­ç³»ç»Ÿçš„æ•°æ®ç±»å‹ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ </blockquote><p> ç”±äºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ˜¯ä»»åŠ¡åˆ—è¡¨ï¼Œå› æ­¤ä¸»è¦çš„æœ¬è´¨æ˜¯ä»»åŠ¡ã€‚ é¦–å…ˆå°†å…¶æ”¾å…¥ç»„ä»¶æ˜¯åˆä¹é€»è¾‘çš„ï¼Œå› ä¸º å…¶ä»–å®ä½“å’Œç«¯ç‚¹å°†ä»¥æŸç§æ–¹å¼ä¸å…¶è¿æ¥ã€‚ ä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨éœ€è¦äº†è§£ä¸¤ä»¶äº‹ï¼š </p><br><ul><li> æˆ‘ä»¬ä¸ä»…æè¿°æŠ½è±¡ï¼Œè€Œä¸”æè¿°éªŒè¯çš„è§„åˆ™ï¼Œå¹¶ä¸”å®ƒä»¬è¶Šå‡†ç¡®å’Œæ˜ç¡®ï¼Œå°±è¶Šå¥½ã€‚ </li><li> åƒæ•°æ®åº“ä¸­å­˜å‚¨çš„ä»»ä½•å®ä½“ä¸€æ ·ï¼Œä»»åŠ¡å…·æœ‰ä¸¤ç§ç±»å‹çš„å±æ€§ï¼šæœåŠ¡å’Œç”¨æˆ·è¾“å…¥ã€‚ </li></ul><br><p> äº‹å®è¯æ˜ï¼Œæ ¹æ®ä½¿ç”¨æƒ…å†µï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼šç”¨æˆ·åˆšåˆ›å»ºçš„Taskå’Œå·²ç»å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„Taskã€‚ åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œå®ƒå…·æœ‰å”¯ä¸€çš„UIDï¼Œåˆ›å»ºæ—¥æœŸï¼Œæ›´æ”¹ç­‰ï¼Œå¹¶ä¸”å¿…é¡»åœ¨åç«¯åˆ†é…æ­¤æ•°æ®ã€‚ æˆ‘æè¿°äº†ä¸¤ä¸ªå®ä½“ï¼ˆ <code>ToDoTaskBlank</code>å’Œ<code>ToDoTask</code> ï¼‰ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç¬¬äºŒä¸ªçš„å­é›†ï¼š </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"components"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ToDoTaskBlank"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Base part of data of item in todo's group"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Data about group item needed for creation of it"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"groupUid"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"An unique id of group that item belongs to"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/Uid"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Short brief of task to be done"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"minLength"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxLength"</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Detailed description and context of the task. Allowed using of Common Markdown."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: [<span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"null"</span></span>], <span class="hljs-attr"><span class="hljs-attr">"minLength"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxLength"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"isDone"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Status of task: is done or not"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Position of a task in group. Allows to track changing of state of a concrete item, including changing od position."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"number"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"min"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max"</span></span>: <span class="hljs-number"><span class="hljs-number">4096</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"attachments"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"array"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Any material attached to the task: may be screenshots, photos, pdf- or doc- documents on something else"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMeta"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"maxItems"</span></span>: <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: [] } }, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"isDone"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"isDone"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Book soccer field"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"The complainant agreed and recruited more members to play soccer."</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"ToDoTask"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Item in todo's group"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Describe data structure of an item in group of tasks"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"allOf"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ToDoTaskBlank"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"object"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"uid"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"An unique id of task"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/Uid"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dateCreated"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Date/time (ISO) when task was created"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format"</span></span>: <span class="hljs-string"><span class="hljs-string">"date-time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-11-17T11:20:51.555Z"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dateChanged"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Date/time (ISO) when task was changed last time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format"</span></span>: <span class="hljs-string"><span class="hljs-string">"date-time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-11-17T11:20:51.555Z"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"dateChanged"</span></span>, <span class="hljs-string"><span class="hljs-string">"dateCreated"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>, <span class="hljs-string"><span class="hljs-string">"uid"</span></span> ] } ] } }</code> </pre> <br><p> åœ¨è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªTypeScriptæ¥å£ï¼Œç¬¬<a href="">ä¸€ä¸ª</a>å°†è¢«<a href="">ç¬¬äºŒä¸ª</a>ç»§æ‰¿ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * ## Base part of data of item in todo's group * Data about group item needed for creation of it */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskBlank</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... imagine there are ToDoTaskBlank properties } /** * ## Item in todo's group * Describe data structure of an item in group of tasks */ export interface ToDoTask extends ToDoTaskBlank { /** * ## UID of element * An unique id of task */ readonly uid: string; /** * Date/time (ISO) when task was created */ readonly dateCreated: string; /** * Date/time (ISO) when task was changed last time */ readonly dateChanged: string; // ... imagine there are ToDoTaskBlank properties }</span></span></code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†Taskå®ä½“çš„åŸºæœ¬æè¿°ï¼Œå¹¶ä¸”åƒåœ¨<a href="">æ¼”ç¤ºåº”ç”¨ç¨‹åºä¸­</a>æ‰€åšçš„é‚£æ ·ï¼Œåœ¨<strong>æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä»£ç ä¸­</strong>å¼•ç”¨äº†å®ƒä»¬ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTask, ToDoTaskBlank, } from <span class="hljs-string"><span class="hljs-string">'@our-npm-scope/our-generated-lib'</span></span>; export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskTeaser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-class"> </span></span>{ isInvalid?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Means this task just created, has temporary uid * and not saved yet. */</span></span> isJustCreated?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Means this task is saving now. */</span></span> isPending?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Previous uid of task temporary assigned until * it gets saved and gets new UID from backend. */</span></span> prevTempUid?: string; }</code> </pre> <br><p> åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†ä¸€ä¸ªæ–°å®ä½“ï¼Œå‘<code>ToDoTask</code>æ·»åŠ äº†å‰ç«¯åº”ç”¨ç¨‹åºç«¯ç¼ºå°‘çš„é‚£äº›å±æ€§ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨è€ƒè™‘åˆ°æœ¬åœ°ç»†èŠ‚çš„æƒ…å†µä¸‹æ‰©å±•äº†ç»“æœæ•°æ®æ¨¡å‹ã€‚ å›´ç»•æ­¤æ¨¡å‹ï¼Œä¸€ç»„<a href="">æœ¬åœ°å·¥å…·</a>ä»¥åŠè¯¸å¦‚åŸå§‹DTOä¹‹ç±»çš„ä¸œè¥¿é€æ¸å¢é•¿ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downgradeTeaserToTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> taskTeaser: ToDoTaskTeaser </span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = { ...taskTeaser }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!task.description || !task.description.trim()) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.description; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { task.description = task.description.trim(); } <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.isJustCreated; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.isPending; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.prevTempUid; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downgradeTeaserToTaskBlank</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> taskTeaser: ToDoTaskTeaser </span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoTaskBlank</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = downgradeTeaserToTask(taskTeaser) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> any; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.dateChanged; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.dateCreated; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.uid; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">æœ‰äººæ›´å–œæ¬¢ä½¿æ•°æ®æ¨¡å‹æ›´å®Œæ•´å¹¶ä½¿ç”¨ç±»ã€‚</b> <div class="spoiler_text"><pre> <code class="java hljs">export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskTeaser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// â€¦ imagine, definitions from ToDoTask are here constructor( task: ToDoTask, public isInvalid?: boolean, public isJustCreated?: boolean, public isPending?: boolean, public prevTempUid?: string ) { Object.assign(this, task); } downgradeTeaserToTask(): ToDoTask { const task = {...this}; if (!task.description || !task.description.trim()) { delete task.description; } else { task.description = task.description.trim(); } delete task.isJustCreated; delete task.isPending; delete task.prevTempUid; return task; } downgradeTeaserToTaskBlank(): ToDoTaskBlank { // â€¦ some code } }</span></span></code> </pre> </div></div><br><p> ä½†è¿™æ˜¯æ ·å¼ï¼Œé€‚å½“æ€§ä»¥åŠåº”ç”¨ç¨‹åºä½“ç³»ç»“æ„å°†å¦‚ä½•å¼€å‘çš„é—®é¢˜ã€‚ é€šå¸¸ï¼Œæ— è®ºé‡‡ç”¨å“ªç§æ–¹æ³•ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä¾é åŸºæœ¬çš„æ•°æ®æ¨¡å‹å¹¶æ›´å¥½åœ°æ§åˆ¶é”®å…¥çš„ä¸€è‡´æ€§ã€‚ å› æ­¤ï¼Œå¦‚æœç”±äºæŸç§åŸå› <code>ToDoTask</code>çš„<code>uid</code>å˜æˆäº†æ•°å­—ï¼Œæˆ‘ä»¬å°†äº†è§£éœ€è¦æ›´æ–°çš„ä»£ç çš„æ‰€æœ‰éƒ¨åˆ†ï¼š </p><br><p><img src="https://habrastorage.org/webt/cc/7g/yz/cc7gyzy0tc4oh5zpomvjy09endw.png"></p><br><a name="NestedDecomposition"></a><br><h2 id="vlozhennaya-dekompoziciya"> åµŒå¥—åˆ†è§£ </h2><br><p> æ‰€ä»¥ç°åœ¨æˆ‘ä»¬æœ‰äº†<code>ToDoTask</code>æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å¼•ç”¨å®ƒã€‚ åŒæ ·ï¼Œæˆ‘ä»¬å°†æè¿°<a href="">ToDoTaskGroup</a>å’Œ<a href="">ToDoTaskGroupBlank</a> ï¼Œå®ƒä»¬å°†åˆ†åˆ«åŒ…å«<code>ToDoTask</code>å’Œ<code>ToDoTaskBlank</code>ç±»å‹çš„å±æ€§ã€‚ ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å°†â€œä»»åŠ¡ç»„â€åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ä¸‰ä¸ªéƒ¨åˆ†ï¼šä¸ºæ¸…æ¥šèµ·è§ï¼Œæˆ‘ä»¬å°†åœ¨<a href="">ToDoGroupExtendedDataä¸­</a>æè¿°å¢é‡ã€‚ å› æ­¤ï¼Œæˆ‘æƒ³æ¼”ç¤ºä¸€ç§æ–¹æ³•ï¼Œå…¶ä¸­ä¸€ä¸ªç»„ä»¶æ˜¯ç”±å…¶ä»–ä¸¤ä¸ªç»„ä»¶åˆ›å»ºçš„ï¼š </p><br><pre> <code class="plaintext hljs">"ToDoGroup": { "allOf": [ { "$ref": "#/components/schemas/ToDoGroupBlank" }, { "$ref": "#/components/schemas/ToDoGroupExtendedData" } ] }</code> </pre> <br><p> å¼€å§‹ç”Ÿæˆä»£ç åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ç¨å¾®ä¸åŒçš„TypeScriptæ„é€ ï¼š </p><br><pre> <code class="java hljs">export type ToDoGroup = ToDoGroupBlank &amp; <span class="hljs-comment"><span class="hljs-comment">// Data needed for group creation ToDoGroupExtendedData; // Extended data has to be obtained after first save</span></span></code> </pre> <br><p> ç”±äº<code>ToDoGroup</code>æ²¡æœ‰è‡ªå·±çš„â€œä¸»ä½“â€ï¼Œå› æ­¤ä»£ç ç”Ÿæˆå™¨å€¾å‘äºå°†å…¶è½¬æ¢ä¸ºæ¥å£çš„å¹¶é›†ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨è‡ªå·±çš„ï¼ˆåŒ¿åï¼‰æ–¹æ¡ˆæ·»åŠ ç¬¬ä¸‰éƒ¨åˆ†ï¼Œåˆ™ç»“æœå°†æ˜¯å…·æœ‰ä¸¤ä¸ªç¥–å…ˆçš„æ¥å£ï¼ˆä½†æœ€å¥½ä¸è¦è¿™æ ·åšï¼‰ã€‚ å¹¶ä¸”è¯·æ³¨æ„ï¼Œ <code>ToDoGroupBlank</code>æ¥å£çš„<code>items</code>å±æ€§é”®å…¥ä¸º<code>ToDoTaskBlank</code>çš„æ•°ç»„ï¼Œå¹¶åœ¨<code>ToDoGroupBlank</code>çš„<code>ToDoTask</code>é‡æ–°å®šä¹‰ã€‚ å› æ­¤ï¼Œä»£ç ç”Ÿæˆå™¨èƒ½å¤Ÿå°†ç›¸å½“å¤æ‚çš„åˆ†è§£ç»†èŠ‚ä»JSONæ¨¡å¼ä¼ é€’åˆ°TypeSciptã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTaskBlank } from <span class="hljs-string"><span class="hljs-string">'./to-do-task-blank'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * ## Base part of data of group * Data needed for group creation */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoGroupBlank</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... items?: Array&lt;ToDoTaskBlank&gt;; // ... }</span></span></code> </pre> <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTask } from <span class="hljs-string"><span class="hljs-string">'./to-do-task'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * ## Extended data of group * Extended data has to be obtained after first save */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoGroupExtendedData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... items: Array&lt;ToDoTask&gt;; }</span></span></code> </pre><br><p> å¥½å§ï¼Œå½“ç„¶ï¼Œåœ¨<code>ToDoTask</code> / <code>ToDoTaskBlank</code>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†è§£ã€‚ æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œ <code>attachments</code>å±æ€§æè¿°ä¸º<a href="">AttachmentMeta</a>ç±»å‹çš„å…ƒç´ æ•°ç»„ã€‚ å¹¶ä¸”æ­¤ç»„ä»¶æè¿°å¦‚ä¸‹ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">"AttachmentMeta"</span></span>: { <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Common meta data model of any type of attachment"</span></span>, <span class="hljs-string"><span class="hljs-string">"oneOf"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMetaImage"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMetaDocument"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ExternalResource"</span></span>} ] }</code> </pre> <br><p> å³ï¼Œè¯¥ç»„ä»¶æ˜¯æŒ‡å…¶ä»–ç»„ä»¶ã€‚ ç”±äºå®ƒæ²¡æœ‰è‡ªå·±çš„æ–¹æ¡ˆï¼Œå› æ­¤ä»£ç ç”Ÿæˆå™¨ä¸ä¼šå°†å…¶è®¾ç½®ä¸ºå•ç‹¬çš„æ•°æ®ç±»å‹ï¼Œä»¥å…ä¸å®ä½“ç›¸ä¹˜ï¼Œè€Œæ˜¯å°†å…¶æšä¸¾ç±»å‹è®¾ä¸ºåŒ¿åæè¿°ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Any material attached to the task: may be screenshots, photos, pdf- or doc- * documents on something else */</span></span> attachments?: Array&lt; | AttachmentMetaImage <span class="hljs-comment"><span class="hljs-comment">// Meta data of image attached to task | AttachmentMetaDocument // Meta data of document attached to task | string // Link to any external resource &gt;;</span></span></code> </pre> <br><p> åŒæ—¶ï¼Œå¯¹äº<code>AttachmentMetaImage</code>å’Œ<code>AttachmentMetaDocument</code>ç»„ä»¶ï¼Œæè¿°äº†ä½¿ç”¨å®ƒä»¬å¯¼å…¥æ–‡ä»¶çš„éåŒ¿åæ¥å£ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AttachmentMetaDocument } from <span class="hljs-string"><span class="hljs-string">'./attachment-meta-document'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AttachmentMetaImage } from <span class="hljs-string"><span class="hljs-string">'./attachment-meta-image'</span></span>;</code> </pre> <br><p> ä½†æ˜¯å³ä½¿åœ¨<a href="">AttachmentMetaImageä¸­ï¼Œ</a>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰¾åˆ°å¦ä¸€ä¸ªæ¸²æŸ“çš„<a href="">ImageOptions</a>æ¥å£çš„é“¾æ¥ï¼Œè¯¥æ¥å£è¢«ä½¿ç”¨äº†ä¸¤æ¬¡ï¼ŒåŒ…æ‹¬åœ¨ä¸€ä¸ªåŒ¿åæ¥å£å†…éƒ¨ï¼ˆä»<a href="">AdditionalProperties</a>è½¬æ¢çš„ç»“æœï¼‰ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ImageOptions } from <span class="hljs-string"><span class="hljs-string">'./image-options'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Meta data of image attached to task */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AttachmentMetaImage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... /** * Possible thumbnails of uploaded image */ thumbs?: { [key: string]: { /** * Link to any external resource */ url?: string; imageOptions?: ImageOptions; }; }; // ... imageOptions: ImageOptions; }</span></span></code> </pre> <br><p> å› æ­¤ï¼ŒåŸºäº<code>ToDoTask</code>æˆ–<code>ToDoGroup</code> ï¼Œæˆ‘ä»¬å®é™…ä¸Šå°†å‡ ä¸ªå®ä½“åŠå…¶ä¸šåŠ¡è¿æ¥é“¾é›†æˆåˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œè¿™ä½¿æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°æ§åˆ¶è¶…å‡ºä»£ç èŒƒå›´çš„æ•´ä¸ªç³»ç»Ÿä¸­çš„æ›´æ”¹ã€‚ å½“ç„¶ï¼Œè¿™å¹¶éåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æœ‰æ„ä¹‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯OpenAPIï¼Œé‚£ä¹ˆé™¤äº†å®é™…çš„æ–‡æ¡£å¤–ï¼Œæ‚¨å¯èƒ½è¿˜ä¼šè·å¾—ä¸€ç¬”é¢å¤–çš„çº¢åˆ©ã€‚ </p><br><a name="ServiceGeneration"></a><br><h2 id="avtogeneraciya-servisov-dlya-raboty-s-rest-api"> è‡ªåŠ¨ç”Ÿæˆçš„ç”¨äºREST APIçš„æœåŠ¡ </h2><br><a name="WhyItNeccessary"></a><br><h3 id="zachem-eto-nuzhno"> ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªï¼Ÿ </h3><br><p> å¦‚æœæˆ‘ä»¬é‡‡ç”¨ä¸€ä¸ªæ™®é€šçš„ç»Ÿè®¡å‰ç«¯åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æˆ–å¤šæˆ–å°‘å¤æ‚çš„REST APIï¼Œåˆ™å…¶ä»£ç çš„ç›¸å½“ä¸€éƒ¨åˆ†å°†æ˜¯ç”¨äºè®¿é—®APIçš„æœåŠ¡ï¼ˆæˆ–ä»…ä»…æ˜¯å‡½æ•°ï¼‰ã€‚ å®ƒä»¬å°†åŒ…æ‹¬ï¼š </p><br><ul><li>  URLå’Œå‚æ•°æ˜ å°„ </li><li> éªŒè¯å‚æ•°ï¼Œè¯·æ±‚å’Œå“åº” </li><li> æ•°æ®æå–å’Œç´§æ€¥å¤„ç† </li></ul><br><p> ä»¤äººä¸å¿«çš„æ˜¯ï¼Œè¿™åœ¨è®¸å¤šæ–¹é¢éƒ½æ˜¯å…¸å‹çš„ï¼Œå¹¶ä¸”ä¸åŒ…å«ä»»ä½•å”¯ä¸€é€»è¾‘ã€‚ è®©æˆ‘ä»¬å‡è®¾ä¸€äº›ç¤ºä¾‹-ä½œä¸ºä¸€èˆ¬æ¦‚è¿°ï¼Œå¯ä»¥æ„å»ºä½¿ç”¨APIâ€‹â€‹çš„æ–¹æ³•ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">ä½¿ç”¨REST APIçš„ç®€åŒ–åŸç†å›¾ç¤ºä¾‹</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable, fromFetch, throwError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { switchMap } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Definitions const URLS = { 'getTasksOfGroup': `${env.REST_API_BASE_URL}/tasks/\${groupId}`, // ... other urls ... }; const URL_TEMPLATES = _.mapValues(urls, url =&gt; _.template(url)); interface GetTaskConditions { isDone?: true | false; offset?: number; limit?: number; } interface ErrorReponse { error: boolean; message?: string; } // Helpers // I taken this snippet from StackOverflow only for example function encodeData(data) { return Object.keys(data).map(function(key) { return [key, data[key]].map(encodeURIComponent).join("="); }).join("&amp;"); } // REST API functions // our REST API working function example function getTasksFromServer(groupUid: string, conditions: GetTaskConditions = {}): Observable&lt;Response&gt; { if (!groupUid) { return throwError(new Error('You should specify "groupUid"!')); } if (!_.isString(groupUid)) { return throwError(new Error('`groupUid` should be string!')); } if (_.isBoolean(conditions.isDone)) { // ... applying of conditions.isDone } else if (conditions.isDone !== undefined) { return throwError(new Error('`isDone` should be "true", "false" or should\'t be set!'!)); } if (offset) { // ... check of `offset` and applying or error throwing } if (limit) { // ... check of `limit` and applying or error throwing } const url = [ URL_TEMPLATES['getTasksOfGroup']({groupUid}), ...(conditions ? [encodeData(conditions)] : []) ]; return fromFetch(url); } // Using of REST API working functions function getRemainedTasks(groupUid: number): Observable&lt;ToDoTask[] | ErrorReponse&gt; { return getTasksFromServer(groupUid, {isDone: false}).pipe( switchMap(response =&gt; { if (response.ok) { // OK return data return response.json(); } else { // Server is returning a status requiring the client to try something else. return of({ error: true, message: `Error ${response.status}` }); } }), catchError(err =&gt; { // Network or other error, handle appropriately console.error(err); return of({ error: true, message: err.message }) }) ); }</span></span></code> </pre> </div></div><br><p> æ‚¨å¯ä»¥ä½¿ç”¨é«˜çº§æŠ½è±¡æ¥ä½¿ç”¨REST-æ ¹æ®æ‰€ä½¿ç”¨çš„å †æ ˆï¼Œå®ƒå¯ä»¥æ˜¯ï¼š <a href="https://github.com/axios/axios">Axios</a> ï¼Œ <a href="http">Angular HttpClient</a>æˆ–ä»»ä½•å…¶ä»–ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆã€‚ ä½†æœ€æœ‰å¯èƒ½çš„æ˜¯ï¼ŒåŸºæœ¬ä¸Šæ‚¨çš„ä»£ç å°†ä¸æ­¤ç¤ºä¾‹ä¸€è‡´ã€‚ å‡ ä¹å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œå®ƒå°†åŒ…æ‹¬ï¼š </p><br><ul><li> ç”¨äºè®¿é—®ç‰¹å®šç«¯ç‚¹çš„æœåŠ¡æˆ–å‡½æ•°ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸º<code>getTasksFromServer</code>å‡½æ•°ï¼‰ </li><li> å¤„ç†ç»“æœçš„ä»£ç æ®µï¼ˆ <code>getRemainedTasks</code>å‡½æ•°ï¼‰ </li></ul><br><p> åœ¨æ¥è‡ªç°å®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ­¤ä»£ç å°†æ›´åŠ å¤æ‚ï¼šæ¼”ç¤ºåº”ç”¨ç¨‹åºçš„è§„èŒƒ<a href="">æè¿°äº†5-6ä¸ªç­”æ¡ˆé€‰é¡¹</a> ã€‚ é€šå¸¸ï¼ŒREST APIçš„è®¾è®¡æ–¹å¼æ˜¯å¿…é¡»ç›¸åº”å¤„ç†æœåŠ¡å™¨çš„æ¯ä¸ªå“åº”çŠ¶æ€ã€‚ ä½†æ˜¯ï¼Œå³ä½¿åœ¨åº”ç”¨ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå³ä½¿æ£€æŸ¥è¾“å…¥æ•°æ®ä¹Ÿå¾€å¾€å˜å¾—æ›´åŠ å›°éš¾ï¼šæ”¯æŒå’Œå¤„ç†é”™è¯¯æ£€æŸ¥æ‰€èŠ±è´¹çš„æ—¶é—´è¶Šå¤šï¼Œæ‚¨å°±è¶Šæƒ³çŸ¥é“åº”ç”¨ç¨‹åºä¸­æ•°æ®æµé€šçš„ç“¶é¢ˆã€‚ </p><br><blockquote> åœ¨è½¯ä»¶éƒ¨ä»¶å¯¹æ¥çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ï¼Œå¯¹å…¶è¿›è¡Œä¸åŠæ—¶çš„æ£€æµ‹ï¼ˆä»¥åŠå¯¹éš¾ä»¥è¯Šæ–­çš„é—®é¢˜çš„æœç´¢ï¼‰å¯¹äºä¼ä¸šè€Œè¨€å¯èƒ½æ˜¯éå¸¸æ˜‚è´µçš„ã€‚ å› æ­¤ï¼Œå°†è¿›è¡Œå…¶ä»–æ¾„æ¸…æ£€æŸ¥ã€‚ éšç€ä»£ç åº“çš„å¢é•¿å’Œæ¶µç›–çš„æ¡ˆä¾‹æ•°çš„å¢åŠ ï¼Œè¿›è¡Œæ›´æ”¹çš„å¤æ‚æ€§ä¹Ÿéšä¹‹å¢åŠ ã€‚ ä½†æ˜¯ä¸šåŠ¡æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œå› æ­¤æ— æ³•å…‹æœã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨æ„å¦‚ä½•é¢„å…ˆè¿›è¡Œæ›´æ”¹ã€‚ </blockquote><p> å›åˆ°OpenAPIä¸»é¢˜ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°åœ¨OASè§„èŒƒä¸­å¯èƒ½æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥ï¼š </p><br><ul><li>    -      </li><li>       </li><li>   URL      </li><li>         </li></ul><br><p>         â€” <strong></strong> .    ,     ,     /  â€” 5, 10  200,            .  ,      ,   : , , , RxJS- <a href="">pickResponseBody</a> ,            ,     - ;  <a href="">tapResponse</a> ,    side-effect (tap)   HTTP-.     ,     -   .    ,       ,    . </p><br><blockquote> ,     â€”   -,      .      ,       ,  ,   ""  /     API     "-"  "" .    -   ,        "" (    ),     . </blockquote><p>   ,          REST API   Angular.         ,      ,        /.      . ,      ,    .  ,      , ..      . </p><br><a name="HowToGenerateServices"></a><br><h3 id="generaciya-servisov">   </h3><br><p>   " <a href="https://habr.com/ru/post/483628/">  </a> "      .   Angular-,       <code>update-typings.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliLib = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@codegena/oapi3ts-cli'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliApp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cliLib.CliApplication; cliApp.createTypings(); cliApp.createServices(<span class="hljs-string"><span class="hljs-string">'angular'</span></span>);</code> </pre> <br><p>             ,   Angular-    API   .    , -   - ,     <a href="https://github.com/koshevy/codegena/tree/master/libs/todo-app-scheme/src/lib/services"> </a> .     ,    <a href="">RewriteGroupService</a> .    <a href="">ApiService</a> ,        ,   ,   -: </p><br><div class="spoiler"> <b class="spoiler_title">-  </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Typings for this API method import { RewriteGroupParameters, RewriteGroupResponse, RewriteGroupRequest } from '../typings'; // Schemas import { schema as domainSchema } from './schema.b4c655ec1635af1be28bd6'; /** * Service for angular based on ApiAgent solution. * Provides assured request to API method with implicit * validation and common errors handling scheme. */ @Injectable() export class RewriteGroupService extends ApiService&lt; RewriteGroupResponse, RewriteGroupRequest, RewriteGroupParameters &gt; { protected get method(): 'PUT' { return 'PUT'; } /** * Path template, example: `/some/path/{id}`. */ protected get pathTemplate(): string { return '/group/{groupId}'; } /** * Parameters in a query. */ protected get queryParams(): string[] { return ['forceSave']; } // ... }</span></span></code> </pre> </div></div><br><p> , <a href="">   JSON Schema</a>  ,   .    <a href=""> </a> ,        ,       : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { schema as domainSchema } from <span class="hljs-string"><span class="hljs-string">'./schema.b4c655ec1635af1be28bd6'</span></span>;</code> </pre> <br><blockquote> ,     <code>schema.b4c655ec1635af1be28bd6.ts</code>       ,  <a href="">  </a>  ,  . </blockquote><br><a name="UsingOfGeneratedServices"></a><br><h3 id="ispolzovanie-generiruemyh-servisov">    </h3><br><p>       ,   Angular-. </p><br><div class="spoiler"> <b class="spoiler_title">    Angular-</b> <div class="spoiler_text"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œåªéœ€å¯¼å…¥æ¨¡å—</font></font><code>ApiModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶åœ¨æä¾›ç¨‹åºä¸­æŒ‡å®šæˆ‘ä»¬éœ€è¦çš„æœåŠ¡å³å¯ï¼š</font></font></p><br><pre> <code class="plaintext hljs">import { ApiModule, API_ERROR_HANDLER } from '@codegena/ng-api-service'; import { CreateGroupItemService, GetGroupsService, GetGroupItemsService, UpdateFewItemsService } from '@codegena/todo-app-scheme'; @NgModule({ imports: [ ApiModule, // ... ], providers: [ RewriteGroupService, { provide: API_ERROR_HANDLER, useClass: ApiErrorHandlerService }, // ... ], // ... }) export class TodoAppModule { }</code> </pre> </div></div><br><p>    ,     [])( <a href="https://angular.io/guide/dependency-injection">https://angular.io/guide/dependency-injection</a> ): </p><br><pre> <code class="plaintext hljs">@Injectable() export class TodoTasksStore { constructor( protected createGroupItemService: CreateGroupItemService, protected getGroupsService: GetGroupsService, protected getGroupItemsService: GetGroupItemsService, protected updateFewItemsService: UpdateFewItemsService ) {} }</code> </pre> <br><p>         â€”  ,       <a href="">request</a> ,        : </p><br><pre> <code class="plaintext hljs">return this.getGroupsService.request(null, { isComplete: null, withItems: false }).pipe( pickResponseBody&lt;GetGroupsResponse&lt;200&gt;&gt;(200, null, true), switchMap&lt;ToDoGroup[], Observable&lt;ComponentTruth&gt;&gt;( groups =&gt; this.loadItemsOfSelectedGroups({ ...truth, groups }) ) );</code> </pre> <br><p>  <code>request</code>   <code>Observable&lt;HttpResponse&lt;R&gt; | HttpEvent&lt;R&gt;&gt;</code> ,   ,        . ,     ,      . ,  ,      ,     .     RxJS- <code>pickResponseBody</code> . </p><br><p>  ,    ,    ,   .         API,    .        .   ,     : </p><br><p><img src="https://habrastorage.org/webt/3y/xe/dy/3yxedy51z7su99butzrk2dvunnq.png"></p><br><p>      .   JSON Schema     .       ,   ""      - .   ,      <a href="https://sentry.io/welcome/">Sentry</a>  <a href="https://www.elastic.co/products/kibana">Kibana</a> ,   .       .  ,      ,      . </p><br><blockquote>  ,             .  ,      :) </blockquote><br><a name="AfterWord"></a><br><h2 id="vmesto-poslesloviya"> è€Œä¸æ˜¯åè®° </h2><br><p>   ,       .       -,   "    "    â€”   .  ,  ,   ,   . </p><br><p>     â€”    ,  - /    (   ).      ,  â€”   . </p><br><p>   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483628/">https://habr.com/ru/post/zh-CN483628/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483608/index.html">å¯è§†åŒ–åŸºäºå›¾åƒçš„åˆ†ç±»å™¨è§£å†³æ–¹æ¡ˆçš„è¾¹ç•Œ</a></li>
<li><a href="../zh-CN483612/index.html">ç‰¹æ–¯æ‹‰å¸æœºå› åœ¨è‡ªåŠ¨é©¾é©¶ä»ªä¸Šåˆ·ç‰™è€Œè¢«ç½šæ¬¾</a></li>
<li><a href="../zh-CN483614/index.html">é˜²æ­¢æœºå™¨äººä¿±ä¹éƒ¨ç›—çªƒçš„æ–¹æ³•</a></li>
<li><a href="../zh-CN483616/index.html">Lacmusé¡¹ç›®ï¼šè®¡ç®—æœºè§†è§‰å¦‚ä½•å¸®åŠ©æŒ½æ•‘å¤±å»çš„äººä»¬</a></li>
<li><a href="../zh-CN483624/index.html">Yandex.Taxiæ¯”èµ›ï¼šç¼–ç¨‹å† å†›èµ›çš„åç«¯èµ›é“åˆ†æ</a></li>
<li><a href="../zh-CN483630/index.html">ç°çƒ¬æ—¶ä»£-ç¬¬130æœŸ</a></li>
<li><a href="../zh-CN483634/index.html">CSSä¸­çš„æœ€å°å’Œæœ€å¤§å®½åº¦/é«˜åº¦å±æ€§</a></li>
<li><a href="../zh-CN483646/index.html">å“ˆå…‹ç›’å­-Bitlabæ¼”ç»ƒã€‚ å¼±JSæ··æ·†ï¼ŒGITå’Œåå‘Windowsåº”ç”¨ç¨‹åº</a></li>
<li><a href="../zh-CN483648/index.html">ä½æ²»äºšå·ITä¸šåŠ¡çš„ç¦»å²¸å¸‚åœºï¼šç”Ÿæ´»ä¸­çš„å°äº‹å’Œé™·é˜±</a></li>
<li><a href="../zh-CN483650/index.html">å¤©ä½“æ›´æ¥è¿‘èµ¤é“-æ–‡æ˜Œçƒ­å¸¦å¤©ä½“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>