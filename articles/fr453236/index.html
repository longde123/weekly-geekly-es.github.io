<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õΩÔ∏è üñãÔ∏è ü•Ñ Prototypage d'un jeu mobile, par o√π commencer et comment le faire. 2e partie üë©üèΩ‚Äçüîß üèÑ #‚É£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour ceux qui ont rat√© la premi√®re partie - Partie 1 
 Partie suivante - Partie 3 

 Si quelqu'un est int√©ress√© √† lire sur l'agr√©gateur utilis√© par l'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Prototypage d'un jeu mobile, par o√π commencer et comment le faire. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453236/">  Pour ceux qui ont rat√© la premi√®re partie - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> <br>  Partie suivante - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br><br>  Si quelqu'un est int√©ress√© √† lire sur l'agr√©gateur utilis√© par l'√©v√©nement, alors vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√™tes ici</a> , mais ce n'est pas n√©cessaire. <br><br><h3>  Donc, nous commen√ßons √† tout rassembler en tas </h3><br><img src="https://habrastorage.org/webt/z-/sa/5r/z-sa5rumeqhyobemc4hutmppbai.png"><br><a name="habracut"></a><br>  <b>Fus√©e:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Classe de fus√©e de base</b> <div class="spoiler_text"><pre><code class="java hljs">using DG.Tweening; using GlobalEventAggregator; using UnityEngine; namespace PlayerRocket { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rocket</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayerRocketBase</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pathorrectionTime = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 movingUp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartEventReact</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ButtonStartPressed buttonStartPressed)</span></span></span><span class="hljs-function"> </span></span>{ transform.SetParent(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); rocketState = RocketState.MOVE; transform.DORotate(Vector3.zero, pathorrectionTime); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ base.Start(); EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RegisterUser { playerHelper = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rocketState == RocketState.WAITFORSTART) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; RocketBehaviour(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RocketBehaviour(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RocketBehaviour</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (rocketState) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.WAITFORSTART: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputController.OnTouch &amp;&amp; !inputController.OnDrag) rocketHolder.RotateHolder(inputController.worldMousePos); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.MOVE: rigidbody.AddRelativeForce(Vector3.up*(config.Speed*Time.deltaTime)); forceModel.AddModificator(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.STOP: Debug.Log(<span class="hljs-string"><span class="hljs-string">" "</span></span>); rigidbody.velocity = Vector3.zero; rigidbody.drag = <span class="hljs-number"><span class="hljs-number">50</span></span>; rocketState = RocketState.COMPLETESTOP; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.COMPLETESTOP: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: rocketState = RocketState.COMPLETESTOP; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } }</code> </pre> <br></div></div><br>  De quoi avons-nous besoin pour qu'une fus√©e d√©colle?  Dans l'espace de jeu, nous avons besoin d'une plan√®te conditionnelle avec laquelle nous commen√ßons, d'un bouton de d√©marrage et d'une fus√©e.  Que devrait faire une fus√©e? <br><br><ol><li>  Attendez le d√©but </li><li>  Voler </li><li>  Soyez affect√© par les modificateurs </li><li>  Arr√™ter </li></ol><br>  Autrement dit, nous avons un comportement / √©tat diff√©rent de la fus√©e, selon l'√©tat actuel, la fus√©e devrait fournir un comportement diff√©rent.  En programmation, nous sommes constamment confront√©s √† une situation o√π un objet peut avoir de nombreux comportements radicalement diff√©rents. <br><br>  Pour un comportement complexe d'objets - il est pr√©f√©rable d'utiliser des mod√®les de comportement, par exemple, un mod√®le d'√©tat.  Pour les plus simples, les programmeurs novices en utilisent souvent beaucoup sinon.  Je recommande d'utiliser switch et enum.  Premi√®rement, il s'agit d'une division plus claire de la logique en √©tapes sp√©cifiques.Gr√¢ce √† cela, nous saurons exactement dans quel √©tat nous sommes maintenant et ce qui se passe, il y a moins d'occasions de transformer le code en une nouille de dizaines d'exceptions. <br><br>  <b>Comment √ßa marche:</b> <br><br>  Commen√ßons d'abord par √©num√©rer les √©tats dont nous avons besoin: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> RocketState { WAITFORSTART = <span class="hljs-number"><span class="hljs-number">0</span></span>, MOVE = <span class="hljs-number"><span class="hljs-number">1</span></span>, STOP = <span class="hljs-number"><span class="hljs-number">2</span></span>, COMPLETESTOP = <span class="hljs-number"><span class="hljs-number">3</span></span>, }</code> </pre> <br>  Dans la classe parent, nous avons un champ - <pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> RocketState rocketState;</code> </pre> <br>  Par d√©faut, la premi√®re valeur lui est affect√©e.  Enum lui-m√™me d√©finit les valeurs par d√©faut, mais pour les donn√©es qui peuvent √™tre modifi√©es par le haut ou configur√©es par les concepteurs de jeux - j'ai d√©fini manuellement les valeurs, pour quoi faire?  Afin de pouvoir ajouter une autre valeur √† l'inam n'importe o√π et ne pas violer les donn√©es stock√©es.  Je vous conseille √©galement d'√©tudier l'√©num√©ration des drapeaux. <br><br>  <b>Suivant:</b> <br><br>  Nous d√©finissons le comportement lui-m√™me dans une mise √† jour, en fonction de la valeur du champ rocketState <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RocketBehaviour(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RocketBehaviour</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (rocketState) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.WAITFORSTART: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputController.OnTouch &amp;&amp; !inputController.OnDrag) rocketHolder.RotateHolder(inputController.worldMousePos); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.MOVE: rigidbody.AddRelativeForce(Vector3.up*(config.Speed*Time.deltaTime)); forceModel.AddModificator(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.STOP: Debug.Log(<span class="hljs-string"><span class="hljs-string">" "</span></span>); rigidbody.velocity = Vector3.zero; rigidbody.drag = <span class="hljs-number"><span class="hljs-number">50</span></span>; rocketState = RocketState.COMPLETESTOP; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.COMPLETESTOP: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: rocketState = RocketState.COMPLETESTOP; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br>  <b>Je vais d√©chiffrer ce qui se passe:</b> <br><br><ol><li>  Lorsque nous attendons, nous tournons simplement la fus√©e vers le curseur de la souris, d√©finissant ainsi la trajectoire initiale </li><li>  Le deuxi√®me √©tat - nous volons, acc√©l√©rons la fus√©e dans la bonne direction et mettons √† jour le mod√®le de modification pour l'apparition d'objets affectant la trajectoire </li><li>  Le troisi√®me √©tat est lorsque l'√©quipe arrive √† nous pour nous arr√™ter, ici nous travaillons tout pour que la fus√©e s'arr√™te et se traduise dans l'√©tat - nous nous sommes compl√®tement arr√™t√©s. </li><li>  Le dernier √©tat est que nous ne faisons rien. </li></ol><br>  La commodit√© du mod√®le actuel - tout est tr√®s facilement extensible et r√©glable, mais il y a une chose mais un maillon faible - c'est quand nous pouvons avoir un √©tat qui combine un certain nombre d'autres √©tats.  Ici, soit un drapeau inam, avec une complication de traitement, soit d√©j√† basculer vers des motifs plus "lourds". <br><br>  Nous avons compris la fus√©e.  La prochaine √©tape est un objet simple mais amusant - le bouton de d√©marrage. <br><br><h3>  Bouton D√©marrer </h3><br>  La fonctionnalit√© suivante est requise de sa part - elle a cliqu√©, elle a inform√© qu'ils avaient cliqu√© sur elle. <br><br><div class="spoiler">  <b class="spoiler_title">Classe de bouton de d√©marrage</b> <div class="spoiler_text"><pre> <code class="java hljs">using UnityEngine; using UnityEngine.EventSystems; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StartButton</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IPointerDownHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> bool isTriggered; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ButtonStartPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isTriggered) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; isTriggered = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonStartPressed()); Debug.Log(<span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPointerDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ ButtonStartPressed(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> struct ButtonStartPressed { }</code> </pre> <br></div></div><br>  Selon la conception du jeu, il s'agit d'un objet 3D sur la sc√®ne, le bouton est cens√© √™tre int√©gr√© dans la conception de la plan√®te de d√©part.  Eh bien, ok, il y a une nuance - comment suivre un clic sur un objet dans une sc√®ne? <br><br>  Si nous google, nous trouverons un tas de m√©thodes OnMouse, parmi lesquelles il y aura un clic.  Cela semblerait √™tre un choix facile, mais il est tout simplement tr√®s mauvais, √† commencer par le fait qu'il fonctionne souvent de mani√®re tordue (il existe de nombreuses nuances pour le suivi des clics), "cher", se terminant par le fait qu'il ne donne pas cette tonne de petits pains qui sont dans UnityEngine.EventSystems. <br><br>  Au final, je recommande d'utiliser UnityEngine.EventSystems et les interfaces IPointerDownHandler, IPointerClickHandler.  Dans leurs m√©thodes, nous r√©alisons la r√©action au pressage, mais il y a plusieurs nuances. <br><br><ol><li>  Un EventSystem doit √™tre pr√©sent dans la sc√®ne, il s'agit d'un objet / classe / composant de l'unit√©, g√©n√©ralement cr√©√© lorsque nous cr√©ons le canevas pour l'interface, mais vous pouvez √©galement le cr√©er vous-m√™me. </li><li>  Physics RayCaster doit √™tre pr√©sent sur la cam√©ra (c'est pour la 3D, pour les graphiques 2D il y a un racaster s√©par√©) </li><li>  Il doit y avoir un collisionneur dans l'installation </li></ol><br>  <i>Dans le projet, cela ressemble √† ceci:</i> <br><br><img src="https://habrastorage.org/webt/-l/qa/1s/-lqa1sfgetxwqvlj7tqn1qdafia.jpeg"><br><br>  Maintenant, l'objet suit le clic et cette m√©thode est appel√©e: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPointerDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ ButtonStartPressed(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ButtonStartPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isTriggered) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; isTriggered = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonStartPressed()); Debug.Log(<span class="hljs-string"><span class="hljs-string">""</span></span>); }</code> </pre> <br>  <b>Que se passe-t-il ici:</b> <br><br>  Nous avons un champ bool√©en dans lequel nous suivons si le bouton a √©t√© enfonc√© ou non (c'est une protection contre les pressions r√©p√©t√©es afin que nous n'ayons pas un script de d√©marrage ex√©cut√© √† chaque fois). <br><br>  Ensuite, nous appelons l'√©v√©nement - le bouton est press√©, auquel la classe de fus√©e est abonn√©e, et met la fus√©e en √©tat de mouvement. <br><br>  Avancer un peu - pourquoi est-ce ici et l√† pour les √©v√©nements?  Il s'agit d'une programmation √©v√©nementielle. Tout d'abord, un mod√®le d'√©v√©nement est moins cher qu'un traitement de donn√©es en continu pour conna√Ætre leurs √©volutions.  Deuxi√®mement, c'est la connexion la plus faible, nous n'avons pas besoin de savoir sur la fus√©e qu'il y a un bouton, que quelqu'un l'a appuy√©, et ainsi de suite, nous savons juste qu'il y a un √©v√©nement pour commencer, nous l'avons re√ßu et agissons.  De plus, cet √©v√©nement est int√©ressant non seulement pour la fus√©e, par exemple, un panneau avec des modificateurs est sign√© pour le m√™me √©v√©nement, il est cach√© au d√©but de la fus√©e.  En outre, cet √©v√©nement peut int√©resser le contr√¥leur d'entr√©e - et l'entr√©e utilisateur ne peut pas √™tre trait√©e ou trait√©e diff√©remment apr√®s le lancement de la fus√©e. <br><br>  Pourquoi beaucoup de programmeurs n'aiment-ils pas le paradigme des √©v√©nements?  Parce qu'une tonne d'√©v√©nements et d'abonnements √† ces √©v√©nements transforment facilement le code en nouilles, dans lesquelles il n'est pas du tout clair par o√π commencer et s'il se terminera quelque part, sans parler du fait que vous devez √©galement suivre la d√©sinscription / abonnement et garder tous les objets en vie. <br><br>  Et c'est pourquoi pour l'impl√©mentation d'√©v√©nements, j'utilise mon agr√©gateur d'√©v√©nements, qui en fait ne transmet pas d'√©v√©nements, mais des conteneurs de donn√©es via des √©v√©nements, et les classes souscrivent aux donn√©es qui les int√©ressent.  De plus, l'agr√©gateur lui-m√™me surveille les objets vivants et jette les objets morts hors des abonn√©s.  Gr√¢ce au transfert du conteneur, l'injection est √©galement possible; vous pouvez nous transmettre un lien vers la classe d'int√©r√™t.  Par le conteneur, vous pouvez facilement suivre qui traite et envoie ces donn√©es.  Car le prototypage est une bonne chose. <br><br><h3>  Rotation de la fus√©e pour d√©terminer la trajectoire de d√©part </h3><br><img src="https://habrastorage.org/webt/se/fm/hx/sefmhxvs8qjjymxmsj-i9uogdk0.jpeg"><br>  Selon la conception du jeu, la fus√©e devrait pouvoir tourner autour de la plan√®te pour d√©terminer la trajectoire initiale, mais pas plus d'un certain angle.  La rotation est effectu√©e par le toucher - la fus√©e suit simplement le doigt et est toujours dirig√©e vers l'endroit o√π nous avons pouss√© l'√©cran.  Soit dit en passant, c'est juste le prototype qui a permis de d√©terminer qu'il s'agit d'un point faible et de nombreux √©pisodes associ√©s √† la gestion sont √† la limite de cette fonctionnalit√©. <br><br>  <b>Mais dans l'ordre:</b> <br><br><ol><li>  Il faut que la fus√©e tourne par rapport √† la plan√®te en direction de la brouette </li><li>  Nous devons serrer l'angle de rotation </li></ol><br>  En ce qui concerne la rotation par rapport √† la plan√®te - vous pouvez tourner sournoisement autour de l'axe et calculer l'axe de rotation, ou vous pouvez simplement cr√©er un objet avec un mannequin centr√© √† l'int√©rieur de la plan√®te, y d√©placer la fus√©e et faire tourner doucement le mannequin autour de l'axe Z, le mannequin aura une classe qui d√©terminera le comportement de l'objet.  La fus√©e tournera avec.  L'objet que j'ai appel√© RocketHolder.  Nous l'avons compris. <br><br>  Maintenant, √† propos des restrictions sur le virage et le virage vers la brouette: <br><br><div class="spoiler">  <b class="spoiler_title">classe RocketHolder</b> <div class="spoiler_text"><pre> <code class="java hljs">using UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RocketHolder</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> clampAngle = <span class="hljs-number"><span class="hljs-number">45</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ GlobalEventAggregator.EventAggregator.AddListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, (InjectEvent&lt;RocketHolder&gt; obj) =&gt; obj.inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampAngle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> angle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> from, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> to)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span>) angle = <span class="hljs-number"><span class="hljs-number">360</span></span> + angle; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle &gt; <span class="hljs-number"><span class="hljs-number">180f</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Mathf.Max(angle, <span class="hljs-number"><span class="hljs-number">360</span></span> + from); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Mathf.Min(angle, to); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampRotationVectorZ</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Vector3 rotation )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(rotation.x, rotation.y, ClampAngle(rotation.z, -clampAngle, clampAngle)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RotateHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Vector3 targetPosition)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> diff = targetPosition - transform.position; diff.Normalize(); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rot_z = Mathf.Atan2(diff.y, diff.x) * Mathf.Rad2Deg; transform.rotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, rot_z - <span class="hljs-number"><span class="hljs-number">90</span></span>); transform.eulerAngles = ClampRotationVectorZ(transform.rotation.eulerAngles); } }</code> </pre> <br></div></div><br>  Malgr√© le fait que le jeu soit en th√©orie 3D, mais toute la logique et le gameplay sont en r√©alit√© 2D.  Et il suffit de resserrer la fus√©e autour de l'axe Z en direction du lieu de pressage.  √Ä la fin de la m√©thode, nous fixons le degr√© de rotation par la valeur sp√©cifi√©e dans l'inspecteur.  Dans la m√©thode Awake, vous pouvez voir l'impl√©mentation la plus correcte d'une injection de classe via un agr√©gateur. <br><br><h3>  Inputcontroller </h3><br>  L'une des classes les plus importantes, c'est lui qui collecte et traite le comportement des utilisateurs.  Appui sur les touches de raccourci, les boutons de la manette de jeu, les claviers, etc.  J'ai une entr√©e assez simple dans le prototype, en fait vous devez savoir seulement 3 choses: <br><br><ol><li>  Y a-t-il un clic et ses coordonn√©es </li><li>  Y a-t-il un balayage vertical et combien de balayage </li><li>  Dois-je fonctionner avec une interface / des modificateurs </li></ol><br><div class="spoiler">  <b class="spoiler_title">classe InputController</b> <div class="spoiler_text"><pre> <code class="java hljs">using System; using UnityEngine; using UnityEngine.EventSystems; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> DirectionRange = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 clickedPosition; [Header(<span class="hljs-string"><span class="hljs-string">"     "</span></span>)] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> afterThisDistanceWeGonnaDoSwipe = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; [Header(<span class="hljs-string"><span class="hljs-string">"  "</span></span>)] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speedOfVerticalScroll = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ReactiveValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; ReactiveVerticalScroll { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> set; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 worldMousePos =&gt; Camera.main.ScreenToWorldPoint(Input.mousePosition); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> bool OnTouch { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> set; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> bool OnDrag { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> set; } <span class="hljs-comment"><span class="hljs-comment">// Start is called before the first frame update private void Awake() { ReactiveVerticalScroll = new ReactiveValue&lt;float&gt;(); GlobalEventAggregator.EventAggregator.AddListener(this, (ImOnDragEvent obj) =&gt; OnDrag = obj.IsDragging); GlobalEventAggregator.EventAggregator.AddListener&lt;InjectEvent&lt;InputController&gt;&gt;(this, InjectReact); } private void InjectReact(InjectEvent&lt;InputController&gt; obj) { obj.inject(this); } private void OnEnable() { GlobalEventAggregator.EventAggregator.Invoke(this); } void Start() { GlobalEventAggregator.EventAggregator.Invoke(this); } private void MouseInput() { if (EventSystem.current.IsPointerOverGameObject() &amp;&amp; EventSystem.current.gameObject.layer == 5) return; if (Input.GetKeyDown(KeyCode.Mouse0)) clickedPosition = Input.mousePosition; if (Input.GetKey(KeyCode.Mouse0)) { if (OnDrag) return; VerticalMove(); OnTouch = true; return; } OnTouch = false; ReactiveVerticalScroll.CurrentValue = 0; } private void VerticalMove() { if ( Math.Abs(Input.mousePosition.y-clickedPosition.y) &lt; afterThisDistanceWeGonnaDoSwipe) return; var distance = clickedPosition.y + Input.mousePosition.y * speedOfVerticalScroll; if (Input.mousePosition.y &gt; clickedPosition.y) ReactiveVerticalScroll.CurrentValue = distance; else if (Input.mousePosition.y &lt; clickedPosition.y) ReactiveVerticalScroll.CurrentValue = -distance; else ReactiveVerticalScroll.CurrentValue = 0; } // Update is called once per frame void Update() { MouseInput(); } } }</span></span></code> </pre> <br></div></div><br>  Tout est dans le front et sans probl√®mes, int√©ressante peut √™tre l'impl√©mentation primitive du propri√©taire r√©actif - quand je commen√ßais √† peine √† programmer, il √©tait toujours int√©ressant de savoir comment les donn√©es avaient chang√©, sans ventilation constante des donn√©es.  Eh bien, c'est tout. <br><br>  Cela ressemble √† ceci: <br><br><div class="spoiler">  <b class="spoiler_title">class ReactiveValue</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReactiveValue</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T currentState; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action&lt;T&gt; OnChange; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T CurrentValue { get =&gt; currentState; set { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value.Equals(currentState)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { currentState = value; OnChange?.Invoke(currentState); } } } }</code> </pre><br></div></div><br>  Nous souscrivons √† OnChange, et nous tremblons si seulement la valeur a chang√©. <br><br>  En ce qui concerne le prototypage et l'architecture - les conseils sont les m√™mes, propri√©t√©s et m√©thodes publiques uniquement, toutes les donn√©es ne doivent √™tre modifi√©es que localement.  Tout traitement et calcul - additionnez selon des m√©thodes distinctes.  Par cons√©quent, vous pouvez toujours modifier l'impl√©mentation / les calculs, et cela n'affectera pas les utilisateurs externes de la classe.  C'est tout pour l'instant, dans la troisi√®me partie finale - sur les modificateurs et l'interface (glisser-d√©poser).  Et je pr√©vois de mettre le projet sur git pour que je puisse voir / sentir.  Si vous avez des questions sur le prototypage - posez-les, j'essaierai d'y r√©pondre clairement. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453236/">https://habr.com/ru/post/fr453236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453220/index.html">13 erreurs de marketing par courriel √† √©viter pour un meilleur engagement</a></li>
<li><a href="../fr453222/index.html">SphinxSearch-meetup SuperJob</a></li>
<li><a href="../fr453228/index.html">Horloge Nixie sur indicateurs IN-18</a></li>
<li><a href="../fr453232/index.html">√âcrire des milliards de chansons avec C # et Deep Learning</a></li>
<li><a href="../fr453234/index.html">R√©tro-ing√©nierie du protocole d'√©change dans les √©quipements EOS</a></li>
<li><a href="../fr453238/index.html">Feux de circulation sur relais</a></li>
<li><a href="../fr453242/index.html">Aire de jeux pour les √©v√©nements d'√©t√©</a></li>
<li><a href="../fr453246/index.html">ERP - Syst√®me de d√©gradation continue</a></li>
<li><a href="../fr453248/index.html">Artemis Lunar Mission - lancement de la production de l'√©l√©ment principal de la station orbitale lunaire Lunar Gateway</a></li>
<li><a href="../fr453252/index.html">Comment nous avons fait le programme du club Sportmaster</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>