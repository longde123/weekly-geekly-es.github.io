<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥤 👩🏿‍🤝‍👩🏾 👩🏿‍🚀 Caça a ameaças com visibilidade da Cisco 😘 ◻️ 👨🏾‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine que você leu um artigo no Kommersant que um pacote completo para ataques a bancos Pegasus foi disponibilizado publicamente na Internet. Você p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Caça a ameaças com visibilidade da Cisco</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/cisco/blog/417345/"> Imagine que você <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">leu</a> um artigo no Kommersant que um pacote completo para ataques a bancos Pegasus foi disponibilizado publicamente na Internet.  Você provavelmente desejará descobrir se também foi pego na distribuição e se o código malicioso está na sua rede.  Por um lado, você tem vários logs e eventos de segurança de vários meios de proteção e, por outro, pode receber informações sobre ameaças como parte de uma assinatura de qualquer serviço pago ou gratuito do Threat Intelligence (por exemplo, do BI.ZONE, do State Security Service ou FinCERT).  Por um lado, você tem muitos dados para analisar, mas não sabe se eles têm vestígios do que você está procurando.  Por outro lado, você tem informações sobre os rastreamentos (isto é, indicadores de comprometimento), mas não sabe como eles são aplicáveis ​​a você.  Você precisa combinar esses dois conjuntos de dados implementando o que é comumente chamado Threat Hunting ou localizando vestígios de ataques em sua infraestrutura.  Vamos ver como você pode automatizar essa tarefa com a solução gratuita Cisco Visibility, lançada recentemente. <br><br><img src="https://habrastorage.org/webt/ri/tn/jd/ritnjduwd50csjcb8tqkx-gxzqk.png" alt="imagem"><a name="habracut"></a><br><br>  Você não sabe por onde começar?  Onde procurar vestígios de uma ameaça que lhe interessa?  Aqui está uma folha em branco e, no Cisco Visibility, fica assim: <br><br><img src="https://habrastorage.org/webt/hz/ql/ie/hzqlieayft079i9gry1wg5jmjzw.png" alt="imagem"><br><br>  Nesta janela, você carrega tudo o que procurará.  Vamos usar o TeslaCrypt como exemplo (na vida real, em vez do TeslaCrypt, você substituirá qualquer outra ameaça que você precise encontrar vestígios ou provar sua ausência durante a caça às ameaças).  Primeiro, você precisa reunir todos os indicadores de comprometimento para os quais usa os serviços existentes de Threat Intelligence.  Por exemplo, você obtém dados do TeslaCrypt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no blog Cisco Talos</a> .  Você tem 9 indicadores à sua frente - endereços IP, hashes de arquivos de malware e domínios com os quais o criptografador implantado entra em contato para receber comandos adicionais e pagar pelo resgate em criptomoeda.  Você carrega todos esses indicadores no Cisco Visibility: <br><br><img src="https://habrastorage.org/webt/sq/vr/v1/sqvrv1qyfiqbw6jiwvlamctaxlg.png" alt="imagem"><br><br>  Aqui você precisa fazer uma pequena digressão.  O Cisco Visibility agora trabalha com dados do Cisco AMP for Endpoints, ou seja, com uma solução de classe EDR (Endpoint Detection and Response) instalada em computadores pessoais e móveis com Windows, Linux, MacOS, Android e iOS.  Portanto, a detecção de ameaças com o Cisco Visibility agora é realizada em dispositivos de terminal, que são 70% direcionados por atacantes. <br><br><img src="https://habrastorage.org/webt/km/fw/iu/kmfwiu5ky9hdr11hrqxiuwrpsao.png" alt="imagem"><br><br>  O que vemos após carregar indicadores no Cisco Visibility?  A área principal da tela é ocupada pelo gráfico de relacionamento, que reflete as interações entre indicadores de comprometimento, eventos de segurança coletados da infraestrutura do cliente e o ambiente externo.  Você pode dimensionar a imagem para ter uma idéia geral da imagem do que está acontecendo. <br><br><img src="https://habrastorage.org/webt/ad/kz/kk/adkzkkzagihootdjg2_kalsyabe.png" alt="imagem"><br><br>  Acima do gráfico de interações, há um painel que exibe um resumo de todos os pontos de interesse para nós: <br><br><ul><li>  Metas ou sacrifícios.  Ao clicar neste campo, você receberá imediatamente uma lista de todos os nós da sua rede nos quais as faixas que você procura são encontradas.  É exatamente isso que você precisa para entender a escala do desastre e o quanto você sofreu.  Se nenhum nó for mostrado aqui, você não terá nós envolvidos no ataque. </li><li>  Pegadas.  Ao clicar neste campo, você obterá uma lista de faixas que procura, com destaque para cores que reflete o fato de que essas faixas estão nos bancos de dados do Cisco Threat Intelligence. </li><li>  Indicadores.  Ao clicar neste campo, você verá os padrões de comportamento encontrados em sua infraestrutura que correspondem aos rastreamentos que você está procurando. </li><li>  Domínios, hashes, endereços IP e URLs.  Esses campos mostram os traços correspondentes. </li><li>  Módulos  Este item de menu reflete a lista de módulos com a ajuda de quais dados foram enriquecidos e rastros de ataques foram detectados.  Existem vários módulos e incluem soluções da Cisco (por exemplo, Cisco ThreatGrid, Cisco Umbrella, Inteligência Global da Cisco AMP, Talos Intelligence) e soluções de terceiros (por exemplo, VirusTotal).  A lista desses módulos será expandida. </li></ul><br><br><img src="https://habrastorage.org/webt/2c/gc/d_/2cgcd_-ebsbncdvvjipkwvorxny.png" alt="imagem"><br><br>  Considerando que os agentes AMP4E podem ser instalados em centenas e milhares de computadores, não estamos interessados ​​em todos eles, mas apenas naqueles que “ficaram sob a distribuição” (se é que conseguiram, é claro).  Ao clicar no campo Destino, obtemos uma lista daqueles nós em que foram encontrados traços da ameaça.  No nosso caso, este é apenas um nó. <br><br><img src="https://habrastorage.org/webt/xb/dy/ir/xbdyirqf-1ga43virsmb8i9rbmk.png" alt="imagem"><br><br>  Ao clicar no nome desse nó, obtemos imediatamente a área do gráfico de interações, que reflete todas as conexões entre os traços desejados e o nó comprometido. <br><br><img src="https://habrastorage.org/webt/4g/kh/yb/4gkhybixr3knbccch9sy-3eq7ro.png" alt="imagem"><br><br>  É imediatamente claro que apenas uma pequena parte da infraestrutura foi afetada, na qual você pode se concentrar. <br><br><img src="https://habrastorage.org/webt/ri/tn/jd/ritnjduwd50csjcb8tqkx-gxzqk.png" alt="imagem"><br><br>  Os rastreamentos encontrados foram aprimorados usando vários módulos, incluindo soluções de terceiros (neste caso, VirusTotal).  Isso nos permite ter mais confiança nos resultados da análise, já que a confirmação dos rastreamentos encontrados foi obtida de várias fontes de Threat Intelligence.  Nesse caso, a investigação foi enriquecida com dados de TI de 5 fontes: <br><br><img src="https://habrastorage.org/webt/al/y5/rm/aly5rmv0lqhgzsn6wajemvfymvu.png" alt="imagem"><br><br>  Muitos indicadores de comprometimento, isto é, padrões comportamentais, foram encontrados com relação aos traços procurados (19): <br><br><img src="https://habrastorage.org/webt/md/px/07/mdpx07llwqdd8bbajl2djtijqom.png" alt="imagem"><br><br>  A área da tela "Linha do tempo da avistagem" mostra uma linha do tempo que reflete duas questões importantes - quando os rastros foram encontrados em nossa infraestrutura local e quando foram encontrados fora da empresa, no mundo (os últimos 30 dias são exibidos para não levar os analistas muito longe do momento atual )  Essa comparação das duas linhas do tempo nos permite concluir se a atividade maliciosa é global (e nós apenas caímos em distribuições como muitas outras) ou se foi focal, projetada especificamente para nós. <br><br><img src="https://habrastorage.org/webt/bg/7t/el/bg7telzembuqnsjn2tsb_ok-pk8.png" alt="imagem"><br><br>  Na parte inferior da tela, veremos uma seção onde você pode obter os detalhes de cada faixa, artefato, indicador de comprometimento encontrado e fazer uma análise mais detalhada.  Observe que, de todos os rastreamentos que procuramos, apenas um foi encontrado em nossa rede - o hash do arquivo malicioso. <br><br><img src="https://habrastorage.org/webt/iq/k1/7b/iqk17bn0jjq1phhsycrhsjwum9e.png" alt="imagem"><br><br>  Por exemplo, é assim que as informações sobre arquivos maliciosos detectados em nossa infraestrutura com o hash correspondente são exibidas.  No entanto, vale a pena prestar atenção a um ponto tão importante.  Para cada faixa, vemos várias guias.  O primeiro deles são os julgamentos.  Nele, vemos referências a vários módulos que "viram" esses traços algum dia.  Por exemplo, vemos que no banco de dados do VirusTotal há um hash correspondente e é reconhecido por diferentes mecanismos antivírus.  Isso significa que esta ameaça está em nossa rede?  Ainda não.  Talvez este seja um malware antigo que não é mais válido.  Por exemplo, no campo Expiração, pode haver uma observação de que esse rastreamento foi registrado pela última vez "na natureza" dois meses atrás. <br><br><img src="https://habrastorage.org/webt/ia/yw/ds/iaywdsihkz8zhjjwb17hav3qpfc.png" alt="imagem"><br><br>  A guia Veredicto (sentença final) é muito mais importante, o que nos permite tirar uma conclusão final (avaliando dados diferentes, cujo resultado ponderado é exibido na guia Veredicto) sobre a presença ou ausência de uma ameaça em nossa infraestrutura. <br><br><img src="https://habrastorage.org/webt/li/kb/n4/likbn4bx17o9cq1uyozhayjyxjk.png" alt="imagem"><br><br>  A guia Avistamentos mostra artefatos por ameaça e onde foram descobertos: <br><br><img src="https://habrastorage.org/webt/ti/gv/de/tigvdeoqymwnpirye-snmwama9s.png" alt="imagem"><br><br>  A guia Indicadores mostra uma descrição detalhada de cada indicador inerente aos rastreios detectados: <br><br><img src="https://habrastorage.org/webt/qw/8t/f_/qw8tf_j1jbaqvtqasvf_qyeayfw.png" alt="imagem"><br><br>  Observe que temos interação com o Tor, exclusão de cópias de backup, reconhecimento de antivírus e criação de um grande número de artefatos etc.  Nos nossos bancos de dados de Inteligência de Ameaças, analisamos cerca de 1000 indicadores diferentes. <br><br><img src="https://habrastorage.org/webt/x6/qm/og/x6qmogkcwjcc-tiotzjnzgvajxc.png" alt="imagem"><br><br>  Após receber informações sobre os rastreamentos de um ataque encontrado em nossa infraestrutura, podemos realizar uma investigação mais detalhada usando as ferramentas que forneceram os dados iniciais ao Cisco Visibility.  Por exemplo, podemos executar o AMP for Endpoints para obter uma análise detalhada de um evento específico, o que levou à possibilidade de detectar uma ameaça. <br><br><img src="https://habrastorage.org/webt/ap/zd/s8/apzds89cfirq4mbtiqopzjzim-k.png" alt="imagem"><br><br>  Vemos toda a imagem do que está acontecendo.  Arquivo malicioso criado pelo processo explorer.exe às 20:00:00, horário de Moscou, em 15 de julho.  Vemos onde esse arquivo está localizado e os valores de seus hashes de acordo com vários algoritmos (SHA1 e MD5). <br><br><img src="https://habrastorage.org/webt/dk/a8/6g/dka86gxg9965skwqvay02uehgyw.png" alt="imagem"><br><br>  Usando a tecnologia de segurança retrospectiva e o mecanismo de visualização da Trajetória de dispositivos, podemos visualizar todas as ações realizadas ou realizadas pelo arquivo de seu interesse.  Nesse caso, vemos que o objeto de arquivo t.exe criado pelo processo explorer.exe lançou o utilitário Windows completamente legal - vssadmin.exe, que gerencia cópias de sombra e, entre outras coisas, é frequentemente usado pelos criptografadores para excluí-las (para que não possam ser restauradas) dados criptografados).  Se você olhar a descrição do TeslaCrypt, veremos que esse criptografador usa vssadmin em suas atividades. <br><br><img src="https://habrastorage.org/webt/dr/se/pu/drsepug7_ofjtv-4usydyseb4dq.png" alt="imagem"><br><br>  A propósito, recentemente atualizamos o mecanismo Device Trajectory e agora parece um pouco diferente: <br><br><img src="https://habrastorage.org/webt/eg/bi/zt/egbiztnnll_m0roakbxmb44iztq.png" alt="imagem"><br><br>  No exemplo acima, o arquivo t.exe não foi bloqueado e não foi colocado em quarentena, embora isso seja exatamente o que o AMP for Endpoints faz na vida real.  Mas, para os fins deste artigo, o AMP4E opera no modo de auditoria, que permite monitorar eventos, mas não bloqueá-los.  A propósito, se o PowerShell fosse iniciado em vez do vssadmin (também uma ferramenta de administração do sistema totalmente legal), veríamos isso e os parâmetros da linha de comando usados ​​no PowerShell. <br><br>  Portanto, resumindo, parece trabalhar com o Cisco Visibility enquanto procura vestígios de ameaças na infraestrutura local e enriquece os eventos de segurança existentes com dados de várias fontes de Threat Intelligence. <br><br>  PS: O Cisco Visibility é baseado no Cisco Threat Intelligence Model (CTIM) que desenvolvemos, que, por sua vez, é baseado no padrão de comunicação Threat Intelligence - STIX.  Porém, diferentemente do STIX, o modelo CTIM não se concentra na formalização do formato dos dados de ameaças, mas no processo de coleta, armazenamento e análise desses dados.  Com base na Cisco Threat Intelligence API (este é um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">projeto de código aberto</a> e pode ser usado em suas soluções), planejamos expandir a lista de fontes com as quais trabalharemos, tanto em termos de recebimento de eventos de segurança quanto em termos de recebimento de dados de Threat Intelligence.  Além disso, planejamos adicionar ao Cisco Visibility a capacidade de trabalhar não apenas com indicadores atômicos de comprometimento (IP, hash, domínio, URL), mas também com dados de vulnerabilidade (CVE), programas de configuração (CWE) e banco de dados de padrões de ataque (CAPEC). e uma base de conhecimento sobre métodos, táticas e procedimentos do invasor (ATT e CK).  Este trabalho está em andamento. <br><br>  PPS: No começo da nota, eu era um pouco esperto.  O Cisco Visibility é realmente uma solução gratuita, mas, para usá-lo, você deve pelo menos ter o Cisco AMP for Endpoints instalado em sua organização (e de onde obter os dados para a busca de ameaças?).  Também é desejável (mas não necessário) ter acesso aos serviços Cisco Threat Grid (sandbox) e Cisco Umbrella (análise de DNS).  Nesses casos, será possível realizar uma análise mais profunda das ameaças (rastreamentos e indicadores) já dentro dos serviços especificados lançados pelo Cisco Visibility.  E, é claro, você deve ter acesso a serviços externos de Threat Intelligence que se integram ao Cisco Visibility.  Até agora, este é apenas o VirusTotal (mas não estamos parados e expandimos seu número), acesso ao qual qualquer pessoa pode obter. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt417345/">https://habr.com/ru/post/pt417345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt417329/index.html">Você e Brad Pitt são 99%</a></li>
<li><a href="../pt417331/index.html">Semana 26 de Segurança: Spectre atualizado, agora com gravação de bom gosto</a></li>
<li><a href="../pt417333/index.html">Classificação social</a></li>
<li><a href="../pt417337/index.html">Princípios de operação e aplicação de troca atômica</a></li>
<li><a href="../pt417339/index.html">3DTouch - Escalas no iPhone: Conclusão</a></li>
<li><a href="../pt417349/index.html">Troca de dados e equações diferenciais</a></li>
<li><a href="../pt417353/index.html">Alemanha aprova o uso de trens de células a combustível de hidrogênio</a></li>
<li><a href="../pt417355/index.html">Calvície: Teoria e Prática do Tratamento, Parte 2 “Até a próstata tem amígdalas, prostaglandinas”</a></li>
<li><a href="../pt417357/index.html">Áreas de trabalho "Sobre TI". História dos jogos de configuração do computador</a></li>
<li><a href="../pt417359/index.html">Segurança da informação? Não não ouvi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>