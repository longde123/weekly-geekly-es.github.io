<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤üèø üëºüèª üë®üèæ Maschinelles Lernen als Smart Monitoring Assistant üëçüèª ‚ÅâÔ∏è üë≤üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 

 Home Credit ist ein gro√ües und sehr dynamisches System, das manchmal schwer im Auge zu behalten ist. Um die Mitarbeiter √ºber alle Neuig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Maschinelles Lernen als Smart Monitoring Assistant</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/homecredit/blog/479712/">  Hallo Habr! <br><br>  Home Credit ist ein gro√ües und sehr dynamisches System, das manchmal schwer im Auge zu behalten ist.  Um die Mitarbeiter √ºber alle Neuigkeiten und √Ñnderungen auf dem Laufenden zu halten und √ºberall auf dem Laufenden zu bleiben, f√ºhren wir aktiv Algorithmen f√ºr maschinelles Lernen ein.  In unserer Bank √ºbernehmen Chat-Bots bereits einen Teil der Arbeit von Betreibern, Kundenbewertungen werden nicht nur von Experten, sondern auch von intelligenten Algorithmen zur Verarbeitung nat√ºrlicher Sprache analysiert. <br><br>  Heute werde ich Ihnen erz√§hlen, wie wir den Spezialisten f√ºr Bankdienstleistungen geholfen haben, die Notwendigkeit zu beseitigen, st√§ndig auf die Dashboards von √úberwachungssystemen zu schauen. Sie forderten n√§mlich maschinelles Lernen, um zu helfen.  Das haben wir. <br><br><img src="https://habrastorage.org/webt/jd/w9/xp/jdw9xpbwninwrbz9e8p6heid8o0.png" alt="Bild"><br><a name="habracut"></a><br><h2>  Wie funktioniert die manuelle √úberwachung? </h2><br>  Ein typischer Arbeitsplatz eines Bedienungsfachmanns sieht wie im obigen Bild aus und er verbringt die meiste Zeit damit, sich mit Dashboards zu befassen.  Jede verd√§chtige Aktivit√§t im System, zum Beispiel wenn das Netzwerk ausgefallen ist oder eine NullPointerException ausf√§llt, wird sofort auffallen - eine Untersuchung wird sofort gestartet. <br><br>  Der Mensch ist keine Maschine.  Er kann abgelenkt sein, zum Abendessen gehen, ans Telefon gehen.  Und wenn die Anzahl der Graphen mehr als einhundert betr√§gt, wird es schwierig, sie alle zusammenzuf√ºgen und der Essenz auf den Grund zu gehen. <br><br>  Ein weiteres Problem ist, dass es eine Reihe von Fehlern gibt, die st√§ndig auftreten, das Verhalten des Systems jedoch nicht ernsthaft beeintr√§chtigen.  Beispielsweise fiel ein Mikroservice eines Drittanbieters aus, und die Dashboards wurden merklich ersch√ºttert. Tats√§chlich ist das System jedoch au√üer Gefahr.  Auf den ersten Blick ist nicht immer klar, wie anormales Verhalten kritisch ist und was dahinter steckt.  Um die Gr√ºnde im Detail zu ermitteln, m√ºssen Sie zum Server gehen und sich eingehend mit den Protokollen befassen.  Eine solche Operation muss Dutzende Male am Tag durchgef√ºhrt werden.  Vertrauen wir sie zumindest teilweise dem Auto an. <br><br><h2>  Maschinelles Lernen als kluger Assistent </h2><br>  Es gibt drei Hauptdatenquellen: Zabbix, ElasticSearch und ein internes System zur √úberwachung von Gesch√§ftskennzahlen.  Wir verwenden Zabbix, um die Hardware, das Netzwerk und die Verf√ºgbarkeit verschiedener Einstiegspunkte in die Systeme zu √ºberwachen.  Analysieren und extrahieren Sie das Nachrichtenprotokoll mit ElasticSearch.  Verschiedene Fehler, Ausf√ºhrungen und Abfragen werden als Metriken verwendet.  Gesch√§ftsanalysten √ºberwachen jedoch die Leistung der Benutzer: Anzahl der √úbertragungen, Verk√§ufe und andere Gesch√§ftsaktivit√§ten.  Die Daten werden einmal pro Minute erfasst und der Datenbank hinzugef√ºgt.  Nun, die Daten werden gesammelt, es ist Zeit, eine Reihe von Fragen zu schreiben, um maschinelles Lernen in den Kampf zu ziehen. <br><br>  Wir formulieren das Problem wie folgt: Wenn wir die Systemmetriken am Eingang haben, klassifizieren wir den Endzustand des Systems: regul√§r oder abnormal.  In dieser Situation passt das Problem perfekt zum Paradigma des Lernens mit einem Lehrer.  Dies bedeutet, dass unser gesamter Trainingsdatensatz gekennzeichnet werden muss.  Mit anderen Worten, jede Minute der Systemoperation sollte mit 0 (normales Verhalten) oder -1 (anomales Verhalten) gekennzeichnet sein. <br><br>  Im Leben stellt sich heraus, dass nicht alles so rosig ist, wie wir m√∂chten.  In der Regel werden nicht alle Vorf√§lle in JIRA aufgezeichnet, vieles verbleibt in der Post und geht nicht dar√ºber hinaus, und manchmal sind die Fristen der Anomalie verschwommen oder ungenau.  Es stellt sich heraus, dass die Erstellung eines qualitativ hochwertigen Datensatzes im Bereich der historischen Daten keine triviale Aufgabe ist. <br><br>  W√§hrend die neuen Daten gerade erst angelegt werden, versuchen wir, den Nutzen aus dem herauszuholen, was wir bereits haben.  In F√§llen, in denen die Daten kein Markup haben, werden Lernalgorithmen ohne Lehrer verwendet.  Wir gehen davon aus, dass das System die meiste Zeit korrekt funktioniert, aber gelegentlich unvorhergesehene Ereignisse eintreten: Fehler (wo ohne sie), die Basis fielen ab oder zum Beispiel der Bagger Petr traf das Kabel des Rechenzentrums.  Daher reduzieren wir unsere Aufgabe auf die Suche nach Anomalien, n√§mlich die Suche nach einem neuen Systemverhalten (Novelty Detection). <br>  Verwenden Sie dazu den Isolated Forest-Algorithmus.  Es ist bereits in der sklearn-Bibliothek implementiert.  Wir werden Metriken von √úberwachungssystemen als Merkmale verwenden. <br><br><pre><code class="python hljs">clf = IsolationForest(behaviour=<span class="hljs-string"><span class="hljs-string">'new'</span></span>, max_samples=<span class="hljs-number"><span class="hljs-number">100</span></span>, random_state=rng, contamination=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>)</code> </pre> <br>  Wir werden den isolierten Wald anhand historischer Daten trainieren und die neuen Daten, die wir bereits zur Kennzeichnung herangezogen haben, zur Bewertung der Qualit√§t verwenden.  Es bleibt also die Wahl der Modell-Hyperparameter und der Datensatzgr√∂√üe f√ºr das Training. <br><br>  Jetzt werden die Statusdaten, die jede Minute gesammelt werden, in das trainierte Modell eingegeben und erhalten die Bezeichnung 0 oder -1. <br><br><img src="https://habrastorage.org/webt/2j/wi/ly/2jwilytbwxdl-guvfftwujzbsjs.png" alt="Bild"><br><br>  Ein Bediener kann nur einen Zeitplan verfolgen.  Auf der X - Achse - Zeit, auf der Y - Anomalie - Punktzahl, das hei√üt, wie stark das Modell den Zustand des Systems in dieser Minute als abnormal betrachtete.  Wenn der Geschwindigkeitswert den Papierkorb passiert hat (den das Modell selbst ausw√§hlt), wird der Punkt rot get√∂nt und eine Anomalie aufgezeichnet. <br><br>  Jetzt erfahren wir, dass das System in einem ungew√∂hnlichen Modus arbeitet oder dass eine Notfallsituation in nahezu Echtzeit eingetreten ist.  Das ist sehr sch√∂n, aber was ist mit dem Bediener zum Zeitpunkt des Empfangs des Signals √ºber die Anomalie?  Welches Dashboard soll man anschauen?  Lassen Sie uns versuchen, die ‚ÄûBlack Box‚Äú unseres Modells zu √∂ffnen und zu verstehen, wie es Entscheidungen trifft. <br><br><h2>  Interpretation eines Modells mit LIME </h2><br><br>  Es gibt verschiedene Ans√§tze, um die Black Box eines trainierten Modells zu √∂ffnen und zu verstehen, was die Maschine besch√§ftigt.  Mit einer logistischen Regression oder einem Entscheidungsbaum ist alles klar, es ist nicht schwer zu verstehen, auf deren Grundlage die Entscheidung getroffen wurde.  Mit Isolated Forest sind die Dinge komplizierter.  Erstens gibt es einen Unfall im Algorithmus, und zweitens handelt es sich um einen Lernalgorithmus ohne Lehrer. <br><br>  Der erste Kandidat war die LIME-Bibliothek, die den modellunabh√§ngigen Ansatz verwendet, der bei der Interpretation von Modellen hilft. Die Hauptsache ist, dass die Ausgabe des Modells eine Wahrscheinlichkeitsverteilung zwischen Klassen aufweist.  Okay, nat√ºrlich ist das Ergebnis nicht die Wahrscheinlichkeit, aber bald, aber versuchen wir, sie im Bereich von 0 bis 1 zu normalisieren und sie als Wahrscheinlichkeit zu behandeln.  So konnten wir ein mit LIME kompatibles Eingabeformat bereitstellen. <br>  Die Interpretation der Ergebnisse durch LIME war entt√§uschend.  Erstens gab es als Interpretation mehrere wichtige Anzeichen am Ausgang, und in den meisten F√§llen spiegelte nur eines die Essenz der Entscheidung wirklich angemessen wider, w√§hrend der Rest Rauschen hinzuf√ºgte.  Der zweite Nachteil bestand darin, dass die Interpretation instabil war und h√§ufig von Lauf zu Lauf unterschiedliche Anzeichenlisten hervorbrachte.  Um stabilere Ergebnisse zu erzielen, mussten Sie die Interpretation mehrmals ausf√ºhren und die Ergebnisse irgendwie mitteln.  Das wollte ich eigentlich nicht. <br><br><h2>  SHAP - Br√ºcke von Person zu Auto </h2><br>  Danach fiel unser Blick auf eine andere Bibliothek zur Interpretation von Modellen - SHAP.  Die Idee hinter der Bibliothek kam aus der Spieltheorie.  Die Bibliothek hat auch eine sch√∂ne Visualisierung.  Nachdem wir uns die Beispiele angesehen hatten, stellten wir frustriert fest, dass SHAP den isolierten Wald nicht interpretieren konnte und wir wollten es wirklich!  Andererseits kann SHAP XGBoost sicher sezieren.  Wir dachten uns, was ist, wenn wir lernen, XGBoost genau so zu machen, wie es Isolated Forest kann?  Dazu haben wir unseren gesamten Datensatz genommen und ihn mit Isolated Forest markiert.  Au√üerdem nahmen sie als Ziel keine Klasse, sondern eine Wertung, die dem Isolierten Wald zugeteilt wurde.  Wir werden anhand aller Messdaten die Geschwindigkeit vorhersagen, die Isolated Forest bieten w√ºrde, aber nur mit XGBoot!  Gesagt, getan.  Wir werden unseren mit Tags versehenen Datensatz √ºber XGBoost ausf√ºhren.  Und jetzt, jetzt wei√ü er, wie man Geschwindigkeit vorhersagt, genau wie bei Isolated Forest.  Hurra, jetzt k√∂nnen wir SHAP benutzen! <br><br>  Der erste Schritt besteht darin, ein TreeExplainer-Objekt zu erstellen und das Modell selbst als Parameter zu √ºbergeben.  Als n√§chstes werden die Shap-Werte berechnet, anhand derer wir erkl√§ren k√∂nnen, wie das Modell diese oder jene Entscheidung getroffen hat. <br><br><pre> <code class="python hljs">explainer = shap.TreeExplainer(model) shap_values = explainer.shap_values(X)</code> </pre> <br>  Mit SHAP k√∂nnen Sie sowohl das gesamte Modell als auch die Ergebnisse f√ºr bestimmte Beispiele interpretieren.  Beispielsweise k√∂nnen Sie mithilfe der force_plot () -Methode, die die Eingabewerte und die Werte des Beispiels selbst empf√§ngt, eine Erkl√§rung f√ºr ein bestimmtes Beispiel abrufen. <br><br><pre> <code class="python hljs">shap.force_plot(explainer.expected_value,shap_values[<span class="hljs-number"><span class="hljs-number">0</span></span>,:], X.iloc[<span class="hljs-number"><span class="hljs-number">0</span></span>,:])</code> </pre> <br>  Das folgende Diagramm zeigt, welche Funktionen des Modells und wie stark die Entscheidung beeinflusst haben. <br><br><img src="https://habrastorage.org/webt/k4/he/-u/k4he-ucq5b7zsyjnyc-rwbpmrtg.png" alt="Bild"><br><br><h2>  Wir helfen dem Gesch√§ft </h2><br>  Wenn nun bekannt ist, welche Metriken einen signifikanten Beitrag zur Gesamtanormalit√§tsrate geleistet haben, kann festgestellt werden, auf welcher Ebene das Problem aufgetreten ist und vor allem, ob es sich auf die Endbenutzer des Systems ausgewirkt hat. <br><br><img src="https://habrastorage.org/webt/wp/rp/6g/wprp6gc-gzbjzotptcjvb6hlj9a.png" alt="Bild"><br><br>  Jedes Mal, wenn eine Anomalie erkannt wird, wird eine Liste von Metriken erstellt, die den gr√∂√üten Einfluss auf die Entscheidung haben.  Wenn die Liste Metriken enth√§lt, mit denen gesch√§ftsbezogene Indikatoren direkt verfolgt werden, wird dies in der Warnung in besonderer Weise erw√§hnt, wodurch die Priorit√§t der Anomalie automatisch erh√∂ht wird. <br><br>  Dies ist nur der erste, aber wichtige Schritt zur St√§rkung und Automatisierung des √úberwachungssystems mithilfe von maschinellem Lernen, wodurch die Ermittlung der Ursachen und des Einflusses von abnormalem Systemverhalten erheblich beschleunigt werden kann. <br><br>  <b>Referenzen:</b> <br><br>  <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html">scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html</a> <br>  <a href="https://github.com/marcotcr/lime">github.com/marcotcr/lime</a> <br>  <a href="https://github.com/slundberg/shap">github.com/slundberg/shap</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de479712/">https://habr.com/ru/post/de479712/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de479696/index.html">Ein paar Worte zu Alter Table oder wie man es nicht macht</a></li>
<li><a href="../de479700/index.html">CIMON-2: (un) Doomsday oder wie IBM Watson √ºber den Wolken kletterte</a></li>
<li><a href="../de479702/index.html">Toaster, My Circle und Freelansim werden Teil von Habr</a></li>
<li><a href="../de479704/index.html">Eskalation von Berechtigungen im EA Origin Windows-Client (CVE-2019-19247 und CVE-2019-19248)</a></li>
<li><a href="../de479708/index.html">Inoffizieller Beitrag zum Rebranding von Habr + Competition</a></li>
<li><a href="../de479714/index.html">Vereinheitlichung visueller Komponenten. Teil 1. Stile</a></li>
<li><a href="../de479716/index.html">Eine weitere "Weltneuheit" SuperApp</a></li>
<li><a href="../de479718/index.html">Erstellen einer Arduino-Umgebungsanwendung mit CI Github</a></li>
<li><a href="../de479724/index.html">Tru Hacker sind vorbei</a></li>
<li><a href="../de479726/index.html">Vladimir aka wowik: "OpenStreetMap braucht Ideen, die in anderen Systemen nicht umsetzbar sind"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>