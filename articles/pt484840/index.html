<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèº üë©üèæ‚Äçüî¨ üíÖüèΩ GOTO Return üë©üèæ‚Äç‚öñÔ∏è üïì üì¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Agora, todos entendem que o uso do operador GOTO n√£o √© apenas uma pr√°tica ruim, mas terr√≠vel. O debate sobre seu uso terminou nos anos 80 do s√©culo XX...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GOTO Return</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484840/"><p> Agora, todos entendem que o uso do operador GOTO n√£o √© apenas uma pr√°tica ruim, mas terr√≠vel.  O debate sobre seu uso terminou nos anos 80 do s√©culo XX e foi exclu√≠do da maioria das linguagens de programa√ß√£o modernas.  Mas, como conv√©m a um mal real, ele conseguiu se disfar√ßar e ressuscitar no s√©culo 21 sob o disfarce de exce√ß√µes. </p><a name="habracut"></a><br><p>  Exce√ß√µes, por um lado, s√£o um conceito bastante simples nas linguagens de programa√ß√£o modernas.  Por outro lado, eles s√£o frequentemente usados ‚Äã‚Äãincorretamente.  Existe uma regra simples e bem conhecida - as exce√ß√µes s√£o apenas para lidar com danos.  E √© uma interpreta√ß√£o muito vaga do conceito de "colapso" leva a todos os problemas do uso do GOTO. </p><br><h2 id="teoreticheskiy-primer">  Exemplo te√≥rico </h2><br><p>  A diferen√ßa entre falhas e cen√°rios de neg√≥cios negativos √© claramente vis√≠vel na janela de login com um caso de uso muito simples: </p><br><ol><li>  Usu√°rio digita login / senha. </li><li>  O usu√°rio clica no bot√£o "Login". </li><li>  O aplicativo cliente envia uma solicita√ß√£o ao servidor. </li><li>  O servidor verifica com √™xito o nome de usu√°rio / senha (considera a presen√ßa do par correspondente como bem-sucedida). </li><li>  O servidor envia informa√ß√µes ao cliente que a autentica√ß√£o foi bem-sucedida e um link para a p√°gina de transi√ß√£o. </li><li>  O cliente vai para a p√°gina especificada. </li></ol><br><p>  E uma extens√£o negativa: </p><br><p>  4.1  O servidor n√£o encontrou o par de login / senha correspondente e envia uma notifica√ß√£o ao cliente sobre isso. </p><br><p>  Considerar que o cen√°rio 4.1 √© um "problema" e, portanto, deve ser implementado usando uma exce√ß√£o √© um erro bastante comum.  Este n√£o √© realmente o caso.  As incompatibilidades de login e senha fazem parte da nossa experi√™ncia padr√£o do usu√°rio, conforme fornecido pela l√≥gica comercial do script.  Nossos clientes comerciais esperam esse desenvolvimento.  Portanto, isso n√£o √© um detalhamento e voc√™ n√£o pode usar exce√ß√µes aqui. </p><br><p>  As quebras s√£o: desconex√£o da conex√£o entre o cliente e o norte, inacessibilidade do DBMS, esquema incorreto no banco de dados.  E mais um milh√£o de raz√µes que quebram nossos aplicativos e n√£o t√™m nada a ver com a l√≥gica de neg√≥cios do usu√°rio. </p><br><p>  Em um dos projetos, do qual participei, havia uma l√≥gica de logon mais complexa.  Ao digitar a senha incorreta tr√™s vezes seguidas, o usu√°rio foi temporariamente bloqueado por 15 minutos.  Obtendo tr√™s vezes seguidas em um bloqueio tempor√°rio, o usu√°rio recebeu um bloqueio permanente.  Tamb√©m havia regras adicionais, dependendo do tipo de usu√°rio.  A implementa√ß√£o de exce√ß√µes tornou extremamente dif√≠cil a introdu√ß√£o de novas regras. </p><br><p>  Seria interessante considerar este exemplo, mas √© muito grande e n√£o muito visual.  Como o c√≥digo confuso com a l√≥gica de neg√≥cios sobre exce√ß√µes se torna claro e conciso, mostrarei outro exemplo. </p><br><h2 id="primer-zagruzka-svoystv">  Propriedades de carregamento de exemplo </h2><br><p>  Tente olhar para este c√≥digo e entender claramente o que ele faz.  O procedimento n√£o √© grande com uma l√≥gica bastante simples.  Com um bom estilo de programa√ß√£o, a compreens√£o de sua ess√™ncia n√£o deve exceder mais de 2 a 3 minutos (n√£o me lembro de quanto tempo levei para entender completamente esse c√≥digo, mas definitivamente mais de 15 minutos). </p><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorkspaceProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ Properties loadedProperties = readPropertiesFromFile(WORK_PROPERTIES_PATH, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">//These mappings will replace any mappings that this hashtable had for any of the //keys currently in the specified map. getProperties().putAll( loadedProperties ); //     loadedProperties = readPropertiesFromFile(MY_WORK_PROPERTIES_PATH, false); if (loadedProperties != null){ getProperties().putAll( loadedProperties ); } System.out.println("Loaded properties:" + getProperties()); } /** *  ,    . * @param filepath * @param throwIfNotFound -  FileNotFoundException,     * @return    null,      !throwIfNotFound * @throws FileNotFoundException throwIfNotFound        * @throws IOException     */ private Properties readPropertiesFromFile(String filepath, boolean throwIfNotExists){ Properties loadedProperties = new Properties(); System.out.println("Try loading workspace properties" + filepath); InputStream is = null; InputStreamReader isr = null; try{ int loadingTryLeft = 3; String relativePath = ""; while (loadingTryLeft &gt; 0){ try{ File file = new File(relativePath + filepath); is = new FileInputStream(file); isr = new InputStreamReader( is, "UTF-8"); loadedProperties.load(isr); loadingTryLeft = 0; } catch( FileNotFoundException e) { loadingTryLeft -= 1; if (loadingTryLeft &gt; 0) relativePath += "../"; else throw e; } finally { if (is != null) is.close(); if (isr != null) isr.close(); } } System.out.println("Found file " + filepath); } catch( FileNotFoundException e) { System.out.println("File not found " + filepath); if (throwIfNotExists) throw new RuntimeException("Can`t load workspace properties." + filepath + " not found", e ); }catch (IOException e){ throw new RuntimeException("Can`t read " + filepath, e); } return loadedProperties; }</span></span></code> </pre> <br><p>  Ent√£o, vamos revelar o segredo - o que est√° acontecendo aqui.  As propriedades de dois arquivos s√£o <code>WORK_PROPERTIES</code> - as <code>WORK_PROPERTIES</code> obrigat√≥rias e as <code>MY_WORK_PROPERTIES</code> adicionais, adicionando ao armazenamento de propriedades compartilhadas.  H√° uma nuance - n√£o sabemos exatamente onde o arquivo de propriedades espec√≠fico est√° localizado - ele pode estar no diret√≥rio atual e nos diret√≥rios ancestrais (at√© tr√™s n√≠veis acima). </p><br><p>  Pelo menos duas coisas s√£o confusas aqui: o par√¢metro <code>throwIfNotExists</code> e o grande bloco l√≥gico na <code>catch FileNotFoundException</code> .  Tudo isso sugere opaca - exce√ß√µes s√£o usadas para implementar a l√≥gica de neg√≥cios (mas de que outra maneira explicar isso em um cen√°rio, lan√ßar uma exce√ß√£o √© uma falha e, no outro, n√£o?). </p><br><h2 id="delaem-pravilnyy-kontrakt">  Fazendo o contrato certo </h2><br><p>  Primeiro, <code>throwIfNotExists</code> lidar com <code>throwIfNotExists</code> .  Ao trabalhar com exce√ß√µes, √© muito importante entender onde exatamente ele precisa ser processado em termos de casos de uso.  Nesse caso, √© √≥bvio que o <code>readPropertiesFromFile</code> m√©todo <code>readPropertiesFromFile</code> n√£o pode decidir quando a aus√™ncia de um arquivo √© "ruim" e quando "boa".  Essa decis√£o √© tomada no momento da sua chamada.  Os coment√°rios mostram que decidimos se esse arquivo deve existir ou n√£o.  Mas, na verdade, estamos interessados ‚Äã‚Äãn√£o no arquivo em si, mas nas configura√ß√µes dele.  Infelizmente, isso n√£o segue o c√≥digo. </p><br><p>  Corrigimos essas duas defici√™ncias: </p><br><pre> <code class="java hljs">Properties loadedProperties = readPropertiesFromFile(WORK_PROPERTIES_PATH); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadedProperties.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t load workspace properties"</span></span>); } loadedProperties = readPropertiesFromFile(MY_WORK_PROPERTIES_PATH); getProperties().putAll( loadedProperties );</code> </pre> <br><p>  Agora a sem√¢ntica √© mostrada claramente - <br>  <code>WORK_PROPERTIES</code> deve ser especificado, mas <code>MY_WORK_PROPERTIES</code> n√£o.  Al√©m disso, ao refatorar, notei que o <code>readPropertiesFromFile</code> nunca poderia retornar <code>null</code> e aproveitou isso ao ler <code>MY_WORK_PROPERTIES</code> . </p><br><h2 id="proveryaem-ne-lomaya">  Verificamos sem quebrar </h2><br><p>  A refatora√ß√£o anterior tamb√©m afetou a implementa√ß√£o, mas n√£o significativamente.  Acabei de excluir o <code>throwIfNotExists</code> processamento <code>throwIfNotExists</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (throwIfNotExists) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(‚Ä¶);</code> </pre> <br><p>  Tendo examinado a implementa√ß√£o mais de perto, come√ßamos a entender a l√≥gica do autor do c√≥digo para procurar um arquivo.  Primeiro, √© verificado se o arquivo est√° no diret√≥rio atual; se n√£o for encontrado, verificamos em um n√≠vel superior, etc.  I.e.  fica claro que o algoritmo prev√™ a aus√™ncia de um arquivo.  Nesse caso, a verifica√ß√£o √© feita usando uma exce√ß√£o.  I.e.  o princ√≠pio √© violado - a exce√ß√£o √© percebida n√£o como "algo quebrou", mas como parte da l√≥gica de neg√≥cios. </p><br><p>  Existe uma fun√ß√£o para verificar a disponibilidade de um arquivo para ler <code>File.canRead()</code> .  Com ele, voc√™ pode se livrar da l√≥gica de neg√≥cios em um <code>catch</code> </p><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader( is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); loadingTryLeft = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( FileNotFoundException e) { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } }</code> </pre> <br><p>  Alterando o c√≥digo, obtemos o seguinte: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPropertiesFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filepath)</span></span></span><span class="hljs-function"> </span></span>{ Properties loadedProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Try loading workspace properties"</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); loadingTryLeft = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(); } } } System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileNotFoundException e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"File not found "</span></span> + filepath); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t read "</span></span> + filepath, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; }</code> </pre> <br><p>  Tamb√©m reduzi o n√≠vel de vari√°veis ‚Äã‚Äã( <code>is</code> , <code>isr</code> ) para o m√≠nimo permitido. </p><br><p>  Essa refatora√ß√£o simples melhora muito a legibilidade do c√≥digo.  O c√≥digo exibe diretamente o algoritmo (se o arquivo existir, ent√£o lemos, caso contr√°rio, reduzimos o n√∫mero de tentativas e procuramos no diret√≥rio acima). </p><br><h2 id="vyyavlyaem-goto">  Revelando GOTO </h2><br><p>  Considere em detalhes o que est√° acontecendo em uma situa√ß√£o se o arquivo n√£o foi encontrado: </p><br><pre> <code class="java hljs">} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(); } }</code> </pre> <br><p>  Pode-se ver que aqui a exce√ß√£o √© usada para interromper o ciclo de execu√ß√£o e realmente executar a fun√ß√£o GOTO. </p><br><p>  Para quem duvida, faremos outra mudan√ßa.  Em vez de usar uma pequena muleta no formato <code>loadingTryLeft = 0</code> (muleta, porque na verdade uma tentativa bem-sucedida n√£o <code>loadingTryLeft = 0</code> n√∫mero de tentativas restantes), indicamos explicitamente que a leitura do arquivo leva √† sa√≠da da fun√ß√£o (sem esquecer de escrever uma mensagem): </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> {</code> </pre> <br><p>  Isso nos permite substituir a condi√ß√£o <code>while (loadingTryLeft &gt; 0)</code> por <code>while(true)</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(); <span class="hljs-comment"><span class="hljs-comment">// GOTO: FFN } } } } catch (FileNotFoundException e) { // LABEL: FFN System.out.println("File not found " + filepath); } catch (IOException e) { throw new RuntimeException("Can`t read " + filepath, e); }</span></span></code> </pre> <br><p>  Para se livrar do √≥bvio mau cheiro que causa o <code>throw new FileNotFoundException</code> , voc√™ precisa se lembrar do contrato da fun√ß√£o.  De qualquer forma, a fun√ß√£o retorna um conjunto de propriedades; se elas n√£o puderam ler o arquivo, retornamos em branco.  Portanto, n√£o h√° raz√£o para lan√ßar uma exce√ß√£o e captur√°-la.  A condi√ß√£o usual de <code>while (loadingTryLeft &gt; 0)</code> suficiente: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPropertiesFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filepath)</span></span></span><span class="hljs-function"> </span></span>{ Properties loadedProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Try loading workspace properties"</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) is.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isr != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) isr.close(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; } } System.out.println(<span class="hljs-string"><span class="hljs-string">"file not found"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t read "</span></span> + filepath, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; }</code> </pre> <br><p>  Em princ√≠pio, do ponto de vista do trabalho correto, com exce√ß√µes, tudo est√° aqui.  Existe uma d√∫vida sobre a necessidade de lan√ßar uma RuntimeException no caso de problemas de IOException, mas vamos deix√°-la como est√° por quest√µes de compatibilidade. </p><br><h2 id="navodim-losk">  Bring Gloss </h2><br><p>  Existem algumas pequenas coisas que podemos tornar o c√≥digo ainda mais flex√≠vel e compreens√≠vel: </p><br><ul><li>  O nome do m√©todo readPropertiesFromFile exp√µe sua implementa√ß√£o (a prop√≥sito, e tamb√©m lan√ßa FileNotFoundException).  Melhor chamar isso de mais neutro e conciso - loadProperties (...) </li><li>  O m√©todo pesquisa e l√™ simultaneamente.  Para mim, essas s√£o duas responsabilidades diferentes que podem ser divididas em m√©todos diferentes. </li><li>  O c√≥digo foi originalmente escrito em Java 6, mas agora √© usado em Java 7. Isso permite o uso de recursos que podem ser fechados. </li><li>  Sei por experi√™ncia pr√≥pria que, ao exibir informa√ß√µes sobre um arquivo encontrado ou n√£o, √© melhor usar o caminho completo para o arquivo, em vez de relativo. </li><li> <code>if (loadingTryLeft &gt; 0) relativePath += "../";</code>  - se voc√™ observar cuidadosamente o c√≥digo, poder√° ver - essa verifica√ß√£o √© desnecess√°ria, porque  se o limite de pesquisa estiver esgotado, o novo valor n√£o ser√° usado.  E se houver algo sup√©rfluo no c√≥digo, isso √© lixo que deve ser removido. </li></ul><br><p>  A vers√£o final do c√≥digo fonte: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorkspaceProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (defaultInstance != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(); Properties loadedProperties = readPropertiesFromFile(WORK_PROPERTIES_PATH); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadedProperties.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t load workspace properties"</span></span>); } getProperties().putAll(loadedProperties); loadedProperties = readPropertiesFromFile(MY_WORK_PROPERTIES_PATH); getProperties().putAll(loadedProperties); System.out.println(<span class="hljs-string"><span class="hljs-string">"Loaded properties:"</span></span> + getProperties()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPropertiesFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filepath)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Try loading workspace properties"</span></span> + filepath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> loadingTryLeft = <span class="hljs-number"><span class="hljs-number">3</span></span>; String relativePath = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (loadingTryLeft &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(relativePath + filepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.canRead()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read(file); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { relativePath += <span class="hljs-string"><span class="hljs-string">"../"</span></span>; loadingTryLeft -= <span class="hljs-number"><span class="hljs-number">1</span></span>; } } System.out.println(<span class="hljs-string"><span class="hljs-string">"file not found"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Can`t read "</span></span> + filepath, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (InputStream is = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(file); InputStreamReader isr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(is, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { Properties loadedProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Properties(); loadedProperties.load(isr); System.out.println(<span class="hljs-string"><span class="hljs-string">"Found file "</span></span> + file.getAbsolutePath()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loadedProperties; } }</code> </pre> <br><h2 id="rezyume">  Sum√°rio </h2><br><p>  O exemplo analisado ilustra claramente o que leva ao tratamento descuidado do c√≥digo-fonte.  Em vez de usar uma exce√ß√£o para lidar com o colapso, foi decidido us√°-lo para implementar a l√≥gica de neg√≥cios.  Isso levou imediatamente √† complexidade de seu suporte, que se refletiu em seu desenvolvimento para atender aos novos requisitos e, como resultado, um afastamento dos princ√≠pios da programa√ß√£o estrutural.  O uso de uma regra simples - exce√ß√µes apenas para falhas - ajudar√° a evitar o retorno √† era GOTO e manter√° seu c√≥digo limpo, compreens√≠vel e extens√≠vel. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484840/">https://habr.com/ru/post/pt484840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484824/index.html">A guerra por apagar as luzes</a></li>
<li><a href="../pt484826/index.html">A intelig√™ncia artificial piora ainda mais os rem√©dios ruins</a></li>
<li><a href="../pt484834/index.html">Como construir uma estrat√©gia corporativa para treinamento e desenvolvimento</a></li>
<li><a href="../pt484836/index.html">C√°lculo da rentabilidade da Tarifa Verde em 2020, Ucr√¢nia</a></li>
<li><a href="../pt484838/index.html">13 exemplos de configura√ß√£o de regras no Google Ads [instru√ß√£o]</a></li>
<li><a href="../pt484846/index.html">Meu relacionamento com c√≥digo aberto</a></li>
<li><a href="../pt484854/index.html">Execute o jogo em c # no MS-DOS</a></li>
<li><a href="../pt484860/index.html">Nome da Implementa√ß√£o e Nome do Resultado</a></li>
<li><a href="../pt484862/index.html">Migrando do AngularJS para o Angular7 por meio de um aplicativo h√≠brido</a></li>
<li><a href="../pt484866/index.html">Usando o Astra Linux em um computador embarcado ARM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>