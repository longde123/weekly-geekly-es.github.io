<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title> 锔  TypeScript War o Enum Conquest   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antecedentes 
 Hace medio a帽o, nuestra compa帽铆a decidi贸 cambiar a tecnolog铆as m谩s modernas y de moda. Para hacer esto, se form贸 un grupo de especialis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TypeScript War o Enum Conquest</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420041/"><h2>  Antecedentes </h2><br>  Hace medio a帽o, nuestra compa帽铆a decidi贸 cambiar a tecnolog铆as m谩s modernas y de moda.  Para hacer esto, se form贸 un grupo de especialistas, que deb铆a: decidir sobre la pila tecnol贸gica, hacer un puente al c贸digo heredado sobre la base de esta pila y finalmente transferir algunos de los m贸dulos antiguos a nuevos rieles.  Tuve la suerte de entrar en este grupo.  La base del c贸digo del cliente es aproximadamente un mill贸n de l铆neas de c贸digo.  Elegimos TypeScript como el lenguaje.  Decidieron hacer un sustrato GUI en vue junto con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">vue-class-component</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IoC</a> . <br><br>  Pero la historia no se trata de c贸mo nos deshicimos del legado del c贸digo, sino de un peque帽o incidente que result贸 en una verdadera guerra de conocimientos.  A qui茅n le importa, bienvenido al gato. <br><a name="habracut"></a><br><h2>  Conociendo el problema </h2><br>  Un par de meses despu茅s del inicio, el grupo de trabajo se sinti贸 c贸modo con la nueva pila y logr贸 transferirle parte del c贸digo anterior.  Incluso podr铆a decir que hubo una masa cr铆tica de carne cuando necesitaba detenerse, respirar y ver lo que hab铆amos hecho. <br><br>  Los lugares que requieren un estudio profundo, como saben, fueron suficientes.  Pero de todas las cosas importantes, ir贸nicamente, nada me atrap贸.  No como desarrollador.  Pero uno de los sin importancia, por el contrario, era inquietante.  Me molest贸 hasta el punto de la locura c贸mo trabajamos con los datos de enumeraci贸n.  No hubo generalizaci贸n.  Te encontrar谩s con una clase separada con un conjunto de m茅todos requeridos, luego encontrar谩s dos clases, para la misma, o incluso algo misterioso y m谩gico.  Y no hay nadie a quien culpar.  El ritmo que tomamos para deshacernos del legado fue demasiado grande. <br><br>  Habiendo planteado el tema de las transferencias entre colegas, recib铆 apoyo.  Result贸 que no solo no estaba satisfecho con la falta de un enfoque unificado para trabajar con ellos.  En ese momento, me pareci贸 que en un par de horas de codificaci贸n lograr铆a el resultado deseado y me ofrec铆 para corregir la situaci贸n.  Pero qu茅 equivocado estaba entonces ... <br><br><pre><code class="hljs pgsql">//    ,        . <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Enum} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "ts-jenum"; @Enum("text") export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> State { static readonly <span class="hljs-built_in"><span class="hljs-built_in">NEW</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> State("New"); static readonly ACTIVE = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> State("Active"); static readonly BLOCKED = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> State("Blocked"); private constructor(<span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">text</span></span>: string) { super(); } } //   console.log("" + State.ACTIVE); // Active console.log("" + State.BLOCKED); // Blocked console.log(State.<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>()); // [State.<span class="hljs-built_in"><span class="hljs-built_in">NEW</span></span>, State.ACTIVE, State.BLOCKED] console.log(State.valueOf("New")); // State.<span class="hljs-built_in"><span class="hljs-built_in">NEW</span></span> console.log(State.valueByName("NEW")); // State.<span class="hljs-built_in"><span class="hljs-built_in">NEW</span></span> console.log(State.ACTIVE.enumName); // ACTIVE</code> </pre> <br><h2>  1. Decorador </h2><br>  Por donde empezar  Solo se me ocurri贸 una cosa: tomar como base una enumeraci贸n similar a Java.  Pero como quer铆a presumir ante mis colegas, decid铆 abandonar la herencia cl谩sica.  Use un decorador en su lugar.  Adem谩s, el decorador podr铆a aplicarse con argumentos para dar a las enumeraciones la funcionalidad requerida de manera f谩cil y natural.  La codificaci贸n no tom贸 mucho tiempo, y despu茅s de un par de horas ya ten铆a algo similar a esto: <br><br><div class="spoiler">  <b class="spoiler_title">Decorador</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">export <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Enum(idProperty?: string) { // tslint:<span class="hljs-keyword"><span class="hljs-keyword">disable</span></span>-next-<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> &lt;T extends <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>, V&gt;(target: T): T { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>).__enumMap__ || (target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>).__enumValues__) { const enumName = (target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>).prototype.constructor.name; throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Error(`The enumeration ${enumName} has already initialized`); } const enumMap: <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> = {}; const enumMapByName: <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> = {}; const enumValues = []; // Lookup static fields <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (const key <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.keys(target)) { const <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> = (target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>)[key]; // <span class="hljs-keyword"><span class="hljs-keyword">Check</span></span> static field: <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be instance <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> enum <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> instanceof target) { let id; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idProperty) { id = (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>)[idProperty]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof id !== "string" &amp;&amp; typeof id !== "number") { const enumName = (target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>).prototype.constructor.name; throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Error(`The <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the ${idProperty} property <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the enumeration element ${enumName}. ${key} <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> a string <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> a number: ${id}`); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { id = key; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (enumMap[id]) { const enumName = (target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>).prototype.constructor.name; throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Error(`An element <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> the identifier ${id}: ${enumName}.${enumMap[id].enumName} already <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the enumeration ${enumName}`); } enumMap[id] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; enumMapByName[key] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; enumValues.push(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.defineProperty(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, "__enumName__", {<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: key}); <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">freeze</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">freeze</span></span>(enumMap); <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">freeze</span></span>(enumValues); <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.defineProperty(target, "__enumMap__", {<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: enumMap}); <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.defineProperty(target, "__enumMapByName__", {<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: enumMapByName}); <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.defineProperty(target, "__enumValues__", {<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: enumValues}); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idProperty) { <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.defineProperty(target, "__idPropertyName__", {<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: idProperty}); } //  <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>(), valueOf     ,    -. <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">freeze</span></span>(target); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target; }; }</code> </pre></div></div><br>  Y aqu铆 sufr铆 el primer fracaso.  Result贸 que no puede cambiar el tipo con la ayuda de un decorador.  Microsoft incluso tiene una apelaci贸n sobre este tema: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Class Decorator Mutation</a> .  Cuando digo que no puede cambiar el tipo, me refiero a que su IDE no sabr谩 nada sobre esto y no ofrecer谩 ninguna pista y autocompletado adecuado.  Y puedes cambiar el tipo tanto como quieras, solo lo bueno ... <br><br><h2>  2. Herencia </h2><br>  Como no trat茅 de persuadirme, tuve que volver a la idea de crear transferencias basadas en la clase general.  S铆, y 驴qu茅 hay de malo en eso?  Estaba molesto por m铆 mismo.  Se est谩 acabando el tiempo, muchachos del grupo, Dios no lo quiera, estoy pasando tiempo en decoradores.  Fue posible presentar una enumeraci贸n en general en una hora y seguir adelante.  Que as铆 sea.  Lanz贸 r谩pidamente el c贸digo de la clase base Enumerable y suspir贸, sintiendo alivio.  Lanc茅 el borrador al repositorio general y le ped铆 a mi colega que verificara la soluci贸n. <br><br><div class="spoiler">  <b class="spoiler_title">Enumerable</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">// :     ,  -     export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Enumerable&lt;T&gt; { constructor() { const clazz = this.constructor <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EnumStore; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clazz.__enumMap__ || clazz.__enumValues__ || clazz.__enumMapByName__) { throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Error(`It <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> forbidden <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> ${clazz.name} enumeration elements outside the enumeration`); } } static <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>&lt;T&gt;(): ReadonlyArray&lt;T&gt; { const clazz = this <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EnumStore; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!clazz.__enumValues__) { throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Error(`${clazz.name} enumeration has <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> been initialized. It <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> necessary <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> the decorator @Enum <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>`); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clazz.__enumValues__; } static valueOf&lt;T&gt;(id: string | number): T { const clazz = this <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EnumStore; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!clazz.__enumMap__) { throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Error(`${clazz.name} enumeration has <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> been initialized. It <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> necessary <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> the decorator @Enum <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>`); } const <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = clazz.__enumMap__[id]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Error(`The element <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ${id} identifier does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> exist <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the $ {clazz.name} enumeration`); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } static valueByName&lt;T&gt;(<span class="hljs-type"><span class="hljs-type">name</span></span>: string): T { const clazz = this <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EnumStore; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!clazz.__enumMapByName__) { throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Error(`${clazz.name} enumeration has <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> been initialized. It <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> necessary <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> the decorator @Enum <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>`); } const <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = clazz.__enumMapByName__[<span class="hljs-type"><span class="hljs-type">name</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Error(`The element <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ${<span class="hljs-type"><span class="hljs-type">name</span></span>} <span class="hljs-type"><span class="hljs-type">name</span></span> does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> exist <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the ${clazz.name} enumeration`); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> enumName(): string { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (this <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>).__enumName__; } toString(): string { const clazz = this.constructor <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EnumStore; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clazz.__idPropertyName__) { const self = this <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self[clazz.__idPropertyName__]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this.enumName; } }</code> </pre> </div></div><br>  Pero la tragicomedia estaba ganando fuerza.  La versi贸n 2.6.2 de TypeScript se instal贸 en mi m谩quina, la versi贸n en la que hab铆a un error invaluable.  No tiene precio, porque no es un error, sino un fitcha.  Una voz de la habitaci贸n contigua grit贸 que no iba a hacer nada.  Error al compilar ( <i>transpilar</i> ).  No pod铆a creer lo que escuchaba, porque siempre armaba un proyecto antes de un impulso, incluso si era un borrador.  Y la voz interior susurr贸: esto es un fiasco, hermano. <br><br>  Despu茅s de una breve prueba, me di cuenta de que era una versi贸n TypeScript.  Result贸 que si el nombre gen茅rico de la clase coincid铆a con el nombre del gen茅rico especificado en el m茅todo est谩tico, entonces el compilador consideraba esto como un tipo.  Pero sea lo que sea, ahora ya es parte de la historia de esa guerra por el conocimiento de TypeScript. <br><br>  El resultado final: el problema con las transferencias como era y se mantuvo.  Mi pena ... <br><br>  Nota: <i>No puedo reproducir este comportamiento ahora mismo con 2.6.2, tal vez comet铆 un error con la versi贸n o no agregu茅 algo en los casos de prueba.</i>  <i>Y se rechaz贸 la solicitud del problema anterior <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Permitir que los miembros est谩ticos hagan referencia a par谩metros de tipo de clase</a> .</i> <br><br><h2>  3. Funci贸n de fundici贸n </h2><br>  A pesar del hecho de que hab铆a una soluci贸n torcida, con una indicaci贸n expl铆cita del tipo de la clase de enumeraci贸n en m茅todos est谩ticos, por ejemplo, State.valueOf &lt;State&gt; (), no se adaptaba a nadie y, en primer lugar, a m铆.  Por un tiempo, incluso dej茅 de lado las jodidas transferencias y perd铆 la confianza de que generalmente podr铆a resolver este problema. <br><br>  Una vez que recuper茅 mi fortaleza moral, busqu茅 en Internet trucos de TypeScript, mir茅 qui茅n sufr铆a de qu茅, le铆 la documentaci贸n del idioma nuevamente, por si acaso, y decid铆, para evitarlo, terminar el trabajo.  Siete horas de experimentos continuos, sin buscar nada, ni siquiera caf茅, dieron su resultado.  Solo una funci贸n, que consiste en una l铆nea de c贸digo, coloca todo en su lugar. <br><br><pre> <code class="hljs matlab">export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EnumType</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IStaticEnum</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt; { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&lt;IStaticEnum&lt;T&gt;&gt; Enumerable)</span></span></span><span class="hljs-function">; } //  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IStaticEnum</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">export</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interface</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IStaticEnum</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt; { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: {</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enumName</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function">}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">values</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadonlyArray</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">valueOf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: string | number)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">valueByName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name: string)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">; }</span></span></code> </pre><br>  Y la declaraci贸n de una enumeraci贸n similar a Java ahora se ve as铆: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Enum, EnumType, IStaticEnum} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "ts-jenum"; @Enum("text") export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> State extends EnumType&lt;State&gt;() { static readonly <span class="hljs-built_in"><span class="hljs-built_in">NEW</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> State("New"); static readonly ACTIVE = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> State("Active"); static readonly BLOCKED = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> State("Blocked"); private constructor(<span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">text</span></span>: string) { super(); } } //   console.log("" + State.ACTIVE); // Active console.log("" + State.BLOCKED); // Blocked console.log(State.<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>()); // [State.<span class="hljs-built_in"><span class="hljs-built_in">NEW</span></span>, State.ACTIVE, State.BLOCKED] console.log(State.valueOf("New")); // State.<span class="hljs-built_in"><span class="hljs-built_in">NEW</span></span> console.log(State.valueByName("NEW")); // State.<span class="hljs-built_in"><span class="hljs-built_in">NEW</span></span> console.log(State.ACTIVE.enumName); // ACTIVE</code> </pre><br>  No sin curiosidad, con una importaci贸n adicional de IStaticEnum, que no se usa en ning煤n lado (ver el ejemplo anterior).  En la versi贸n muy desafortunada de TypeScript 2.6.2, debe especificarlo expl铆citamente.  Un error sobre el tema <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu铆</a> . <br><br><h2>  Total </h2><br>  Si sufres por mucho tiempo, algo funcionar谩.  Enlace a github con el resultado del trabajo realizado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu铆</a> .  Por m铆 mismo, descubr铆 que TypeScript es un lenguaje con excelentes caracter铆sticas.  Hay tantas de estas oportunidades que puede ahogarse en ellas.  Y quien no quiere hundirse, aprende a nadar.  Si vuelve al tema de las transferencias, puede ver c贸mo otros trabajan con ellas: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enum basado en dos clases</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Envoltorio de caja</a> </li></ul><br>  Escribe sobre tu trabajo, creo que la comunidad estar谩 interesada.  Gracias a todos por su paciencia e inter茅s. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es420041/">https://habr.com/ru/post/es420041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es420031/index.html">Dibujar con objetivos de renderizado en Unreal Engine</a></li>
<li><a href="../es420033/index.html">C贸mo comenzamos a registrar cajas registradoras para nuestros clientes</a></li>
<li><a href="../es420035/index.html">Golang GUI: GTK + 3</a></li>
<li><a href="../es420037/index.html">Transmita con varias c谩maras de materiales improvisados</a></li>
<li><a href="../es420039/index.html">Pensamiento funcional Parte 2</a></li>
<li><a href="../es420045/index.html">Bunker para la fecha: c贸mo se me permiti贸 caminar por el centro de datos RUVDS en el territorio de la planta espacial</a></li>
<li><a href="../es420049/index.html">El libro "El hombre est谩 hablando. Evoluci贸n y lenguaje</a></li>
<li><a href="../es420051/index.html">[DotNetBook] Span, Memory y ReadOnlyMemory</a></li>
<li><a href="../es420053/index.html">Veeam Academy para desarrolladores de C #: nueva temporada</a></li>
<li><a href="../es420055/index.html">Teor铆a y pr谩ctica de copias de seguridad con Borg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>