<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëºüèª ‚úåüèΩ ü•ö Reverse Engineering Laserscanner Leuze RS4 üíáüèª üê∏ üë®‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fr√ºher habe ich √ºber das Reverse Engineering eines Laser-Abstandssensors gesprochen . Dieses Mal werden wir √ºber ein komplexeres Ger√§t sprechen - eine...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reverse Engineering Laserscanner Leuze RS4</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/396357/"><img src="https://habrastorage.org/files/09a/d9e/f75/09ad9ef7519d415f9d003991043d22b1.jpg" align="right"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fr√ºher habe ich √ºber das Reverse Engineering eines </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laser-Abstandssensors gesprochen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dieses Mal werden wir √ºber ein komplexeres Ger√§t sprechen - einen Laserscanner Leuze RS4. </font><font style="vertical-align: inherit;">Wie der Sensor kam auch dieser Scanner in einem defekten Zustand zu mir, so dass ich damit beginnen musste, seine Arbeit wiederherzustellen und dabei einige seiner Eigenschaften zu verbessern und ihn tats√§chlich in ein anderes Ger√§t umzuwandeln.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist dieser Laserscanner?</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leuze RS4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Lasersicherheitsscanner, der verhindern soll, dass Personen in gef√§hrliche Bereiche am Arbeitsplatz gelangen, Kollisionen von Serienfahrzeugen verhindern usw. Er weist recht anst√§ndige Eigenschaften auf - maximale Reichweite: 15/50 m (abh√§ngig von der Betriebsart) ) betr√§gt die Genauigkeit der Entfernungsmessung im gesamten Messbereich 5 mm, die Winkelaufl√∂sung 0,36 Grad, die Abtastgeschwindigkeit 25 U / min (25000 Messungen / Sek.).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist erw√§hnenswert, dass dieser Scanner genau als Sicherheitsvorrichtung positioniert ist - das hei√üt, er speichert die Position von Alarm- und Warnzonen im Speicher, und wenn ein Objekt diese Zonen betritt, √∂ffnet sich eine der Tasten im Scanner. Um den Standort der Zonen zu konfigurieren, kann der Scanner an einen Computer angeschlossen werden und den Standort von Hindernissen auf dem Bildschirm beobachten. Es gibt sogar ein ROS-Paket, mit dem Sie Daten von diesem Scanner empfangen k√∂nnen.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe einen Scanner ohne Geh√§use, der in seine Komponenten zerlegt wurde. Der Scanner st√ºrzte aufgrund eines starken Schlags auf den K√∂rper ab. Was genau es nicht mehr funktionierte, verstand ich immer noch nicht - vielleicht war die Optik falsch ausgerichtet, der Kontakt in einem der Anschl√ºsse ging aus oder der Gebersensor bewegte sich oder etwas anderes. Ich habe versucht, alle Teile zusammenzubauen. Der Scanner wurde in der nativen Software angezeigt, aber der Scan wurde nicht gestartet. Ich habe also nur eine M√∂glichkeit, es zu starten - die Scannerschaltung so vollst√§ndig wie m√∂glich wiederherzustellen und meine eigene Scanner-Mikrocontroller-Firmware zu schreiben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sahen die Teile aus, die ich ausgesehen hatte: </font><font style="vertical-align: inherit;">
Hier sollten sie sich im Geh√§use befinden (Foto aus der Dokumentation, es ist zu erkennen, dass Design und Elektronik leicht voneinander abweichen):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/52c/f37/092/52cf370928ab5d8ee92ff63432d49fbb.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/77f/2b8/395/77f2b839587cb43a293ea58c34270b1c.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein wichtiger Bestandteil des Scanners ist auch der in der Mitte installierte Scanspiegel (auf dem Foto oben blau hervorgehoben): </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/16d/5db/5c6/16d5db5c60f0e710e0485fab2236e510.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schematische Darstellung des Scanners: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/74e/9e5/8bd/74e9e58bdd529e60b5a823df47fdc6db.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie aus dem Diagramm ersichtlich, besteht die gesamte Elektronik des Scanners aus separaten Modulen (Platinen), die durch Anschl√ºsse und Schleifen verbunden sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt viele Module - Stromversorgungsmodul (DC-DC), Schnittstellenmodul, Prozessormodul, Fotodetektormodul (APD), Lasermodul. Dar√ºber hinaus gibt es ein Encoder-Modul und zwei hufeisenf√∂rmige Platinen, was zun√§chst seltsam erschien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuallererst lohnt es sich, auf sie zu achten:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/957/fd1/ab6/957fd1ab64924ab5285c3442bae9e0fe.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Offensichtlich enth√§lt eine der Karten LEDs und die zweite Fotodioden. Anfangs dachte ich, es sei eine Art Encoder oder ein Mechanismus zur √úberpr√ºfung der Laserstrahlung. Nachdem ich jedoch sp√§ter die Dokumentation f√ºr den Scanner gelesen und die darin enthaltenen Fotos eingehend untersucht hatte, stellte ich fest, dass dies ein System zur √úberwachung des Zustands der Oberfl√§che des Schutzglases des Scanners ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Foto sind L√∂cher f√ºr LEDs sichtbar: </font></font><br>
<br>
<img src="https://habrastorage.org/files/d08/12c/0e5/d0812c0e54544f7d9d6439be016575c7.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durch Messen des Signalpegels von den Fotodioden k√∂nnen Sie den Transmissionspegel des Schutzglases absch√§tzen. Offensichtlich ist dieses System f√ºr den Scanner nicht kritisch, daher habe ich diese Karten in Zukunft nicht mehr verwendet. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Prozessormodul</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist der schwierigste Teil des Scanners. So sieht die Elektronik des Moduls von zwei Seiten aus:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/170/eb3/716/170eb3716ee18ad64d9e8ea5abf453d6.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum ersten Mal, als ich auf die Tafel schaute, wurde mir sofort klar, dass der Scanner die Flugzeitmethode zur Entfernungsmessung (TOF) verwendet - der Chip mit der gr√∂√üten Markierung stellte sich als " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACAM TDC-GPX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " heraus, von dem ich bereits geh√∂rt hatte. TDC - "Time-to-Digital Converter", dh ein spezieller Chip zur Messung von Zeitintervallen mit sehr hoher Genauigkeit, mit dem die "Flugzeit" eines Laserpulses gemessen wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ebenfalls an Bord war ein Infineon C167-Mikrocontroller mit einem externen FLASH-Speicherchip (der zufrieden war) und einem ASIC (der sehr ver√§rgert war). Im Detail √ºber dieses Modul werde ich unten erz√§hlen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leistungsmodul</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enth√§lt einen kundenspezifisch galvanisch getrennten DC-DC-Wandler mit mehreren Ausgangsspannungen und mehreren Kondensatoren: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/7c9/30a/1f5/7c930a1f510a7df150eb89654c4c82dd.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Versorgungsspannung des Wandlers betr√§gt 24V. Sein Hauptmerkmal ist, dass es eine Hochspannung (~ 230 V), die f√ºr den Betrieb des Lasers und des Fotodetektors erforderlich ist, an einen separaten kleinen Anschluss liefert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch die folgenden Spannungen an den Hauptstecker aus: + 5V, -5V, ~ 15V, galvanisch vom Rest getrennt + 5V f√ºr die RS232-Schnittstelle. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optischer Teil des Scanners</font></font></b><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/b2c/f7d/4af/b2cf7d4af2cf9f75fe2659845d9887fb.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf den ersten Blick ist nicht klar, wo sich die Optik des Scanners befindet. In diesem Fall dient ein kleines Fenster mit einem Spiegel in der Mitte des Fotos zur Ausgabe des Laserstrahls, und eine gro√üe gl√§nzende Oberfl√§che um ihn herum ist die Oberfl√§che des Interferenzlichtfilters, das vor der Fotodetektorlinse installiert ist. Dieser Filter √ºbertr√§gt nur die Strahlung, deren Wellenl√§nge nahe an der Laserwellenl√§nge liegt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So wird es in der Scannerdokumentation gezeigt: </font></font><br>
<br>
<img src="https://habrastorage.org/files/a6a/58d/c01/a6a58dc01c2a434398d2e8e4b35ccd3b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Objektiv selbst ist in einem schwarzen Kunststoffgeh√§use montiert, daher ist es problematisch, es zu sehen. Am Ende des Geh√§uses entgegengesetzt zu derjenigen in dem Foto oben zu </font><font style="vertical-align: inherit;">sehen ist </font><font style="vertical-align: inherit;">, dem festen </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lasermodul</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dem Photodetektor</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">Laser - </font></b><b><font style="vertical-align: inherit;">Modul</font></b></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/17a/c09/dcf/17ac09dcf9e6e59b2383d155d932e7a3.jpg" alt="Bild"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ansicht des Lasermoduls (einige Details werden von mir beim Zeichnen der Schaltung markiert): </font><font style="vertical-align: inherit;">
Wie Sie sehen k√∂nnen, ist die Schaltung dieses Moduls recht einfach, so dass ich seine Schaltung vollst√§ndig wiederherstellen konnte: </font><font style="vertical-align: inherit;">
Ein gro√üer runder Teil auf der Platine ist ein spezialisierter Laseremitter. </font><font style="vertical-align: inherit;">Leider waren keine Markierungen darauf, so dass keine Dokumentation darauf gefunden werden konnte. </font><font style="vertical-align: inherit;">
Aus der Beschreibung auf dem Scanner k√∂nnen Sie herausfinden: "Laserlichtwellenl√§nge - 905 nm", "Laserklasse - 1", "Pulsdauer - 0,003 ¬µs", "Wiederholungsfrequenz - 25 kHz". </font><font style="vertical-align: inherit;">
Was war zu verstehen, wenn die Modulschaltung wiederhergestellt und ihre Funktionsweise analysiert wurde:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/c28/71a/a61/c2871aa619e574fe9cb8f01b7c3e21db.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/2d7/2c5/176/2d72c51767c4c239419dbcf2d35ff249.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Laseremitter wird st√§ndig mit einer Versorgungsspannung von 143 V versorgt, die durch Zenerdioden begrenzt ist.</font></font></li>
<li>       ,    ¬´3¬ª .   ,     ,     .</li>
<li>   ,        ,    .        ( )    ¬´¬ª .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die gesamte Lasersteuerung erfolgt in einer Zeile - "LASER_PULSE". Die meiste Zeit auf der Leitung sollte "hoch" sein. Wenn ein negativer Impuls angelegt wird, wird der Trigger DD1 an seiner Vorderflanke auf 0 zur√ºckgesetzt, und an der Hinterflanke beginnt der Trigger auf das Signal von der Fotodiode zu ‚Äûwarten‚Äú und der Laser startet. Wenn ein Signal von der Fotodiode erscheint, schaltet der Trigger auf 1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An den an das Modul angeschlossenen Anschl√ºssen k√∂nnen Sie zwei Koaxialkabel erkennen. Sie dienen zur √úbertragung des Differenzsignals vom Trigger zum OT-Chip. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ebenfalls an diesem Modul befinden sich f√ºnf LEDs. Das Prozessormodul steuert sie. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fotodetektormodul</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Das Modul selbst sieht folgenderma√üen aus: </font><font style="vertical-align: inherit;">
Foto des Fotodetektors selbst in der N√§he von:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/a91/704/ae2/a91704ae269a7ce0761135bf935d1de8.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/444/bb5/671/444bb5671b8daa4ba612f2e35b331ada.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Hochspannungszeichen in der Ecke der Platine zeigt deutlich, dass hier eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lawinenphotodiode (APD)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verwendet wird </font><font style="vertical-align: inherit;">- f√ºr den Betrieb ist eine ziemlich hohe Spannung erforderlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider gab es keine sichtbaren Markierungen auf dem Fotodetektork√∂rper. Anhand des Emblems auf der Fotodiode selbst (in der Mitte) konnte nur festgestellt werden, dass es von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacific Silicon Sensor (First Sensor) hergestellt wurde.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gab jedoch keine weiteren Informationen √ºber ihn, vielleicht ist er ma√ügeschneidert. Aus dem Foto ist ersichtlich, dass dieser Fotodetektor ein Hybrid ist, d.h. enth√§lt einen eingebauten Verst√§rker - er ist deutlich √ºber der Fotodiode sichtbar. Offensichtlich ben√∂tigen der Verst√§rker und die Fotodiode Strom - sie werden √ºber die unteren Anschl√ºsse gespeist (Kondensatoren sind mit ihnen verl√∂tet). Ein gro√ües R√§tsel war das kleine Detail links von der Fotodiode, zu der drei Leiter geh√∂ren. Weitere Untersuchungen haben gezeigt, dass dies ein analoger W√§rmesensor ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Modul ist viel komplizierter als das vorherige. Es verwendet eine mehrschichtige Leiterplatte - mindestens 4 Schichten, wobei sich die meisten Signalleitungen auf der √§u√üeren Schicht der Platine befinden, was die Analyse erheblich erleichtert. In diesem Modul habe ich ungef√§hr 80% der Schaltung wiederhergestellt, der Rest wurde f√ºr mich nicht wirklich ben√∂tigt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die resultierende Schaltung des Fotodetektormoduls: </font><font style="vertical-align: inherit;">
Am oberen Ende der Schaltung befindet sich eine einstellbare lineare Hochspannungsquelle f√ºr eine Lawinenphotodiode. Es kann eine stabile Spannung von mindestens 150 V erzeugen. Diese Quelle wird vom DA1 DAC (LTC1451) gesteuert.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/5d6/508/5ea/5d65085eade00ed5135fbf19a85bb783.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da der Scanner auf einem gepulsten Entfernungsmesser basiert, besteht die Hauptaufgabe des Fotodetektormoduls darin, ein ausreichend schwaches Lasersignal, das von einem Hindernis reflektiert wird, schnell zu erfassen. Da der Pegel des Lichtsignals sehr klein ist, kann es nur mit einer Lawinenphototodiode erfasst werden, die ihre eigene Verst√§rkung hat. In diesem Fall wird das Signal von der Fotodiode zus√§tzlich durch einen im Fotodetektor integrierten integrierten Verst√§rker verst√§rkt. Aufgrund der Tatsache, dass der Verst√§rker in den K√∂rper des Fotodetektors eingebaut ist, wird der Einfluss von Interferenzen auf das Nutzsignal verringert. Das vom Fotodetektor (OUT_B) erzeugte Signal wird an einen bestimmten DA4-Chip √ºbertragen, der anscheinend ein anderer Hochfrequenzverst√§rker ist. Danach wird das Signal an den direkten Eingang des Hochgeschwindigkeitskomparators D1 (MAX9601) √ºbertragen.Das Referenzsignal vom Widerstandsteiler (ca. 50 mV) wird dem inversen Eingang dieses Komparators zugef√ºhrt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Signal am Ausgang des Komparators ist differentiell und wird √ºber ein Koaxialkabel direkt an die Prozessormodulkarte √ºbertragen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zus√§tzlich wird das Signal vom Ausgang des DA4-Verst√§rkers an eine Art Spitzendetektor √ºbertragen, der sich an den Maximalpegel des empfangenen Impulses ‚Äûerinnert‚Äú. Ich habe nicht begonnen, die Schaltung dieses Knotens wiederherzustellen, und habe nur die Ausgangsstufe (U1-Chip) auf die Schaltung gezogen, von der das Signal auch an das Prozessormodul √ºbertragen wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einer der Teile des Scanners, der mir weniger klar ist, ist der Q3-Transistor, der am Ausgang des HF-Verst√§rkers installiert ist. Nach der Schaltung zu urteilen, ist es erforderlich, die D√§mpfung des Signals am Verst√§rkerausgang zu erm√∂glichen. Dieser Transistor kann mit einem Signal von der Prozessorkarte (Zeile 10 - ‚ÄûDigi‚Äú) gesteuert werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√∂glicherweise stellen Sie fest, dass die Karte √ºber einen EEPROM-Chip verf√ºgt. Alle Signalausg√§nge dieses Chips sind mit der Prozessorkarte verbunden. Anscheinend wurden in dieser Mikroschaltung einige Parameter gespeichert, die f√ºr jede Fotodetektorplatine eindeutig sind, und beim Testen der Platine darin aufgezeichnet. Dies kann insbesondere eine Kurve der Abh√§ngigkeit der Verst√§rkung APD von der Versorgungsspannung, der Abh√§ngigkeit der Spannung am Ausgang des Temperatursensors von seiner Temperatur und anderer √§hnlicher Eigenschaften sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen sehen, dass die Leistung des Fotodetektors gesteuert werden kann, indem bestimmte Pegel auf den mit dem DAC und dem EEPROM verbundenen Leitungen CLK, CS, CS2 eingestellt werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Platine enth√§lt mehrere Schaltkreise zur √úberwachung ihres Zustands. Sie k√∂nnen den Spannungspegel des APD, seine Temperatur (Zeile 7) und den Schwellenwert des Komparators steuern. Diese Spannungen werden von DA3-DA5-Operationsverst√§rkern umgewandelt und an die Prozessormodulkarte √ºbertragen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zur√ºck zum Prozessormodul</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dieses Modul ist das komplexeste von allen, es enth√§lt eine gro√üe Anzahl von Mikroschaltungen mit mehreren Ausg√§ngen, die Leiterplatte ist wieder vierschichtig und die meisten Signalleitungen sind in den inneren Schichten getrennt, was die Wiederherstellung der Schaltung erheblich erschwert. </font><font style="vertical-align: inherit;">
Sehr oft stellte sich heraus, dass die Tracks auf eine andere Seite des Boards wechselten. Um schnell zu suchen, wo eine bestimmte Spur angeschlossen ist, musste ich einen solchen Pinsel verwenden, der mit einem Multimeter verbunden ist (im W√§hlmodus):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/170/eb3/716/170eb3716ee18ad64d9e8ea5abf453d6.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/281/d5d/e1c/281d5de1cb6b8e4c16daf6d4f1690f99.jpg" alt="Bild"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe ungef√§hr 70% des Programms wiederhergestellt - den Rest brauchte ich nicht wirklich. Blockschaltbild des Prozessormoduls: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/08d/3f6/60f/08d3f660f31927fd38ae94b82a953714.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das resultierende Diagramm des Prozessormoduls: </font><font style="vertical-align: inherit;">
Obwohl ich dieses Modul √ºberall als ‚ÄûProzessormodul‚Äú bezeichne, basiert es in Wirklichkeit auf dem </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Infineon SAK-C167CR-L33M-Mikrocontroller</font></a><font style="vertical-align: inherit;"> . Es hat 144 Pins und basiert auf der ziemlich alten C166-Architektur. Dieser Mikrocontroller verf√ºgt nicht √ºber einen eigenen nichtfl√ºchtigen Speicher. Es ist erforderlich, einen externen Speicher √ºber einen parallelen Bus mit ihm zu verbinden. Zu diesem Zweck verf√ºgt der Scanner √ºber einen Flash-Speicherchip M29F400B (512 K x 8/256 K x 16). Au√üerdem sind zwei RAM-Chips an den Mikrocontroller angeschlossen - IS61C6416AL-12 (64K x 16) und K6R4016C1D (256K x 16).</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/f5d/fef/0a7/f5dfef0a7e036ce6af8872997538b420.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie sehen, dass der Adressbus mit einer Verschiebung von einem Bit an alle Speichermikroschaltungen angeschlossen ist - die Speicherleitungen A0 sind an die Leitung A1 des Mikrocontrollers angeschlossen. Dies liegt an der Tatsache, dass die Adressen auf dem Adressbus in Bytes eingestellt sind, der Controller und der Speicher jedoch 16-Bit sind. Damit die Steuerung einzelne Bytes in den RAM schreiben kann, ohne benachbarte Bytes in einem 16-Bit-Wort zu beeinflussen, haben die Speicherchips spezielle Leitungen UBn, LBn. Diese L√∂sung ist bei Ger√§ten mit parallelen Bussen sehr verbreitet und wird in der Dokumentation zur Steuerung ausf√ºhrlich beschrieben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine andere L√∂sung im Prozessormodul ist mir jedoch nicht ganz klar geworden. Wenn Sie sich den U1-Flash-Speicherchip ansehen, werden Sie feststellen, dass die A14-Leitung des Chips mit Masse verbunden ist. Die entsprechende A15-Controller-Adressbusleitung ist √ºberhaupt nicht mit dem Chip verbunden. Das Ergebnis ist, dass der Controller nur auf die H√§lfte des Flash-Speichers zugreifen kann. Eine ganz √§hnliche Situation mit dem RAM2-Chip (DD3). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim RAM1 (DD2) -Chip ist die Situation etwas anders - die A15-Controller-Leitung ist ebenfalls nicht daran angeschlossen, aber gleichzeitig sind alle Adresseneing√§nge dieses Chips an den Adressbus angeschlossen, so dass der Controller Zugriff auf den gesamten Speicher des Chips hat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt sollten Sie auf den Knoten in den logischen Elementen DX1, DX2, DD4 achten. </font><font style="vertical-align: inherit;">Es sind diese Mikroschaltungen, die bestimmen, welche der Speichermikroschaltungen vom Mikrocontroller ausgew√§hlt wird. </font><font style="vertical-align: inherit;">Es ist ersichtlich, dass sie durch die folgenden Signale gesteuert werden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WRn - Aufnahmesignal, aktiver Pegel - niedrig. </font><font style="vertical-align: inherit;">In dieser Zeile stellt der Mikrocontroller einen niedrigen Pegel ein, wenn Sie Daten in einen externen RAM-Speicher schreiben m√ºssen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A15 ist dieselbe Datenbusleitung, die nicht direkt mit einem der Speicherchips verbunden ist.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSn0 ist ein spezialisiertes Chipauswahlsignal, der aktive Pegel ist niedrig. </font><font style="vertical-align: inherit;">Diese Leitung ist mit dem in der Steuerung integrierten Adressdecoder verbunden. </font><font style="vertical-align: inherit;">Nach einem Reset ist der Controller niedrig.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM2_CE - mit dem GPIO des Controllers √ºber einen Aufzug zum Boden verbunden.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Logik des Betriebs dieses Knotens wird in der Tabelle gut beschrieben: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/f49/171/c32/f49171c3210acdcfbac396e81b568a46.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen k√∂nnen, arbeitet der Mikrocontroller je nach Status der RAM2_CE-Leitung entweder mit dem Flash-Speicher oder mit der RAM2 (DD3) -Mikroschaltung, und ihre Adressr√§ume stimmen √ºberein. Es ist erw√§hnenswert, dass die Speicherkapazit√§t dieser Mikroschaltungen gleich ist. M√∂glicherweise wird dies durchgef√ºhrt, um das Aktualisieren der Firmware des Ger√§ts zu vereinfachen. Es gibt noch eine andere Option: Der installierte RAM ist dreimal schneller als der Flash-Speicher, sodass der Controller nach dem Start den Inhalt von FLASH in RAM2 kopieren kann, wonach das Programm von dort ausgef√ºhrt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der hohe Pegel auf der A15-Leitung bestimmt jedoch eindeutig, dass der Controller mit dem RAM-Chip (DD2) arbeitet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis stellt sich heraus, dass sich FLASH- und RAM1-Speicher im Adressraum des Controllers abwechseln:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/130/d7a/ee6/130d7aee659a1839be0296586fe25024.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der bereits angetroffene RAM-Bereich wird rot hervorgehoben. Beim Zugriff erh√§lt der Controller in Wirklichkeit Zugriff auf die Daten an den Adressen (0x8000-0xFFFF). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Compilerkonfiguration ist nicht trivial, und wie oben erw√§hnt, geht die H√§lfte von Flash / RAM2 verloren. Warum die Entwickler des Scanners nicht mithilfe der speziellen CSnX-Linie des Controllers zwischen den FLASH- und RAM-Chips gewechselt haben, ist nicht klar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bereits erw√§hnt, verf√ºgt der verwendete Controller nicht √ºber einen Flash-Speicher und daher √ºber Sicherungsbits. Um einige Parameter der Steuerung zu konfigurieren: Datenbusbreite und -adresse, werden PLL-Parameter verwendet, die an den Datenbus angeschlossene Pulldown-Widerst√§nde sind. Der Controller selbst verf√ºgt √ºber eingebaute Pull-Up-Widerst√§nde mit hohem Widerstand (&gt; 100 KOhm), die an den gesamten Bus angeschlossen sind. Aufgrund externer Widerst√§nde wird somit eine bestimmte Kombination von Signalen auf dem Bus hergestellt, die der Controller beim Einschalten liest. Es bestimmt die notwendigen Controller-Einstellungen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall handelt es sich um die Widerst√§nde R3-R6. Die ausgew√§hlte Konfiguration der Widerst√§nde stimmt mit den resultierenden Bussignalverbindungen √ºberein und liefert eine Reglertaktgeschwindigkeit von 33 MHz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Impulssignal vom Spiegelgeber wird √ºber das Logikelement OR D6 dem Eingang des Timers "T2IN" des Mikrocontrollers zugef√ºhrt. Der zweite Eingang dieses Chips ist mit dem GPIO des Controllers verbunden, wodurch Sie die Zufuhr von Impulsen zum Timer-Eingang deaktivieren k√∂nnen. Warum eine solche L√∂sung ben√∂tigt wird und warum es unm√∂glich ist, den Timer programmgesteuert auszuschalten, verstehe ich immer noch nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt sollten Sie auf den OT-Chip (DD1) achten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Scanner verf√ºgt √ºber einen TDC-GPX-Chip - den "fortschrittlichsten" von allen im Bereich ACAM. Die behauptete Genauigkeit der Messung von Zeitintervallen bis zu 10 ps RMS. Die Mikroschaltung hat 8 Eingangskan√§le von LVTTL-Leitungen und 2 Kan√§le von LVECL (Differential).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die maximale Genauigkeit der Zeitmessung zu erzielen, werden in diesem Scanner LVECL-Eing√§nge verwendet, um Signale vom Lasermodul und vom Fotodetektormodul unter Verwendung von vier Koaxialkabeln zu empfangen. Die Signale vom Lasermodul werden den Eing√§ngen des DStart / DStartN zugef√ºhrt und starten die Zeitz√§hlung. Die Signale vom Fotodetektormodul werden den Eing√§ngen DStop1 / DStop1N, DStop2 / DStop2N zugef√ºhrt und stoppen die Zeitz√§hlung. Wie aus dem Diagramm ersichtlich ist, werden Stoppsignale sofort an zwei OT-Kan√§le mit inverser Polarit√§t angelegt. Dadurch ist es m√∂glich, nicht nur die Dauer des "Fluges" des Lichtimpulses zu messen, sondern auch die Breite des empfangenen Impulses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TDC-GPX verf√ºgt √ºber einen 28-Bit-Datenbus, kann jedoch in den 16-Bit-Modus geschaltet werden, der im Scanner verwendet wird. Der Adressbus ist 4-Bit, er ist wie bei Speicherchips ebenfalls um 1 Bit verschoben. Die Chips DD8, DD9, U2 werden verwendet, um Steuersignale des Chips zu erzeugen und die Pegel anzupassen - der Mikrocontroller arbeitet mit 5 V und der OT - mit 3,3 V. Im Allgemeinen ist das OT-Stromversorgungssystem ziemlich komplex, es gibt sogar eine automatische Anpassung der Versorgungsspannung. Aufgrund seiner Komplexit√§t habe ich nicht begonnen, das Diagramm zu zeichnen - ich vermute, dass es sich nicht wesentlich von einem Datenblatt unterscheidet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Programmierung des Mikrocontrollers und des OT wird sp√§ter erl√§utert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bereits erw√§hnt, ist auf der Platine ein benutzerdefinierter ASIC-Chip mit den Aufschriften ‚ÄûLEUZE98‚Äú und ‚ÄûWATCHDOG‚Äú installiert. Was es ist, ist unbekannt. Es ist ersichtlich, dass ein 20-MHz-Quarzoszillator an diese Mikroschaltung angeschlossen ist. Nachdem ich den Mikrocontroller programmieren konnte, stellte ich sicher, dass der ASIC seinen Betrieb nicht st√∂rt, und stellte das ASIC-Verbindungsdiagramm nicht wieder her. Soweit ich wei√ü, kommuniziert dieser Chip √ºber einen parallelen Bus mit der Steuerung. Es ist m√∂glich, dass der ASIC das R√ºcksetzsignal RESETn erzeugt, das den Controller und den OT zur√ºcksetzt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trotzdem mussten einige Ketten genauer behandelt werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie sich herausstellte, kann das Lasersteuersignal "LASER_PULSE" sowohl vom Mikrocontroller als auch vom ASIC unter Verwendung eines Knotens an den Transistoren T1, T2 erzeugt werden. In diesem Fall √∂ffnet der ASIC beim Einschalten den Transistor T1, so dass die Steuerung den Laser nicht steuern kann. Aus diesem Grund musste ich den Widerstand R24 entfernen - und der Laser wurde normalerweise von der Steuerung gesteuert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Spiegelmotor-Steuersignal line_motor1 kam ebenfalls vom ASIC (√ºber die Diode D2). Aus diesem Grund musste ich die Spur auf der Platine abschneiden und dieses Signal direkt an den freien Ausgang des GPIO-Controllers - P3.15 - anschlie√üen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Seltsamste ist, dass die CS2-Leitung, die mit dem auf der Leiterplatte des Fotodetektormoduls installierten DAC verbunden ist, auch mit dem ASIC verbunden ist. Aus diesem Grund konnte der Controller die APD-Versorgungsspannung nicht unabh√§ngig einstellen und den APD-Verst√§rker einschalten. M√∂glicherweise wurde dies getan, um die Zuverl√§ssigkeit des Scanners zu erh√∂hen - eine falsche DAC-Einstellung kann zum Ausfall des APD f√ºhren. Ich musste diese Leitung auch an den freien GPIO-Pin des P3.4-Controllers anschlie√üen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist bekannt, dass es der ASIC ist, der die drei am Lasermodul montierten LEDs steuert. Zwei weitere LEDs, die den Status des Scanners anzeigen (das Vorhandensein eines Hindernisses im Arbeitsbereich), werden von den Steuerungsleitungen LN1, LN2 gesteuert. Diese Leitungen f√ºhren auch zur Schnittstellenmodulplatine.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da der Scanner in Sicherheitssystemen arbeiten kann, verf√ºgt die Prozessorkarte √ºber eine gro√üe Anzahl von Knoten zur Diagnose ihres Zustands. </font><font style="vertical-align: inherit;">Der Prozessor (und m√∂glicherweise der ASIC) kann den Einschluss eines Lasers (unter Verwendung des U3-Chips) erkennen, den Pegel mehrerer Versorgungsspannungen, die APD-Versorgungsspannung, die APD-Temperatur und die Komparatorschwelle auf der Fotodetektorplatine steuern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgrund der Tatsache, dass die Referenzspannung des ADC des Reglers 4,1 V betr√§gt, wird ein Teil der gemessenen Spannungen mit Hilfe von Widerstandsteilern reduziert - sie sind im Diagramm rechts zu sehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt lohnt es sich, einen genaueren Blick auf die Methode zur Erzeugung des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ungew√∂hnlichen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Digi" -Signals zu </font><font style="vertical-align: inherit;">werfen </font><font style="vertical-align: inherit;">, die ich bereits in der Beschreibung des Fotodetektormoduls erw√§hnt habe.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das folgende Diagramm zeigt die Knoten sowohl des Prozessormoduls (unten) als auch des Fotodetektormoduls (oben):</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/44d/9b6/e35/44d9b6e356033cbfe9f892c5b9838622.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Pfeile zeigen den Anschluss der Module √ºber Dr√§hte. Im Folgenden werde ich die Funktionsweise dieser Knoten beschreiben, so wie ich es verstehe. In dem Fotodetektormodul wird das Signal vom APD-Ausgang durch den DA4-Chip verst√§rkt, wonach es an den Komparator D1 √ºbertragen wird. Wenn der Signalpegel am Eingang des Komparators mehr als 50 mV betr√§gt, wird am Ausgang des Komparators ein hoher Pegel eingestellt. Das Signal vom Ausgang des Komparators wird an das Prozessormodul √ºbertragen. Zun√§chst wird der OT-Eingang eingegeben, der die Zeit ab dem Beginn des Laserpulses z√§hlt. Zus√§tzlich wird dieses Signal aber dem Takteingang des D-Triggers DD1 zugef√ºhrt. Dem Triggersignaleingang wird immer eine logische Einheit zugef√ºhrt, und der Trigger selbst kann √ºber die GPIO-Leitung des BASE5-Controllers auf Null zur√ºckgesetzt werden. Somit f√ºhrt der Betrieb des Komparators zu einem Schnappausl√∂ser "1". Dieser Trigger hat einen Differenzausgang.Das Signal wird vom Eingang des D3-Chips eingespeist, der es in das LVTTL-Format konvertiert. Dieses Signal wird dem "Digi" -Eingang des Fotodetektormoduls zugef√ºhrt. Wie bereits erw√§hnt, f√ºhrt das Auftreten dieses Signals meiner Meinung nach zu einer Abschw√§chung des Signalpegels am Eingang des Komparators.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptfrage ist, warum dies erforderlich ist und warum es so schwierig zu implementieren ist. Warum war es unm√∂glich, beide Knoten auf der Platine des Fotodetektormoduls zu erstellen? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich kann nur meine Annahmen ausdr√ºcken. M√∂glicherweise muss das Signal ged√§mpft werden, um den √úbergang des Komparators oder Amplitudendetektors zur S√§ttigung zu vermeiden. Vielleicht - um die L√§nge des empfangenen Impulses zu verringern. F√ºr beide Knoten konnte einfach kein Platz auf der Fotodetektorplatine vorhanden sein. Eine andere Option ist ebenfalls m√∂glich - das Signal muss erst geschw√§cht werden, nachdem es Zeit hat, den OT √ºber Koaxialdr√§hte zu erreichen, was ein derart komplexes Design rechtfertigt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Studie hat gezeigt, dass vor dem Starten eines neuen Laserpulses der Trigger zur√ºckgesetzt werden muss, da sonst die Impulse nicht akzeptiert werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnittstellenmodul</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider habe ich kein gutes Foto von diesem Modul gefunden. Es gibt nur diesen einen: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/394/165/79a/39416579aee7e4e226a1dbc9225386f0.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf diesem Modul sind nur zwei Anschl√ºsse installiert, an die Sie au√üerhalb des Scanners anschlie√üen k√∂nnen. Eine davon ist RS-232 / RS-422. Gem√§√ü der zweiten wird der Scanner mit Strom versorgt, es werden Steuersignale geliefert und hier wird ein Sicherheitsschaltkreis angeschlossen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Modul enth√§lt UART-RS232 / RS485-Wandler und Optokoppler mit galvanischer Trennung (sie sind auf einer separaten kleinen Platine rechts abgebildet), Netzschl√ºssel der Sicherheitsschaltung, Eingangsschaltungen der Steuerleitungen des Entfernungsmessers, eine Motorsteuerschaltung, einen Encodersignalwandler. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Leistungsmodul und das Prozessormodul sowie das Encodermodul und der Spiegelmotor sind an dieses Modul angeschlossen (√ºber die Anschl√ºsse an der Unterseite des Moduls sind sie auf dem Foto nicht sichtbar).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teildiagramm des Schnittstellenmoduls: </font><font style="vertical-align: inherit;">
Ich habe nur einen Teil des Schaltplans dieses Moduls wiederhergestellt (ca. 20%), da ich nicht an den Schl√ºsseln und Eingangsleitungen interessiert war, die zur Gew√§hrleistung der Sicherheit erforderlich sind. In der Dokumentation werden die Strombegrenzung des Sicherheitsstromkreises, die Kurzschluss√ºberwachung und andere Funktionen erw√§hnt.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/6cb/b3b/711/6cbb3b71160b4d70462c898dac6263a5.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Etwas seltsam gemacht, die Drehzahl des Spiegelmotors zu steuern. Die Drehzahlregelung erfolgt durch √Ñnderung der Motorspannung - damit ist alles klar. Die Einstellung dieser Spannung selbst erfolgt jedoch mit Hilfe einer bestimmten Integrationskette an einem Operationsverst√§rker. Um die Spannung zu erh√∂hen, setzt die Steuerung 0 auf der Leitung line_mot1, um sie auf 1 zu senken. Ohne konstante R√ºckmeldung vom Encoder stoppt der Motor offensichtlich oder beschleunigt durch die Steuerung auf die maximale Drehzahl. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie sich herausstellte, ist der UART-RS232 LTC1387-Konverterchip ziemlich langsam - bei einer Geschwindigkeit von 500 kbit / s waren die Daten verzerrt. Aus diesem Grund musste ich mit diesem Chip eine kleine Karte entfernen und den USB-UART-Konverter direkt an die Schnittstellenmodulkarte anschlie√üen.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem ich √ºber das Design aller Module gesprochen habe, lohnt es sich, den Prozess des Reverse Engineering selbst zu erl√§utern.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Als ich anfing, mich mit Scannerelektronik zu besch√§ftigen, hatte ich gr√∂√üte Angst, dass ein Laser oder Fotodetektor durch einen Aufprall besch√§digt werden k√∂nnte. Gleichzeitig war ich mir nicht sicher, ob ich das Prozessormodul starten k√∂nnte - der unbekannte Mikrocontroller und der ASIC waren verlegen. Deshalb habe ich zuerst die Schaltung des Lasermoduls und dann des Fotodetektormoduls wiederhergestellt. Nachdem ich die Schaltung dieser Module verstehen und den Zweck aller Kontakte an ihren Anschl√ºssen bestimmen konnte, war es m√∂glich, mit dem Prozessormodul fortzufahren. Als letzten Ausweg hatte ich die Idee, ein Analogon dieses Moduls auf STM32 + TDC-GP2-Mikroschaltungen zu erstellen, wenn ich es nicht starten konnte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um das Modul zu √ºberpr√ºfen, m√ºssen Sie nat√ºrlich Ihr eigenes Programm auf dem darauf installierten Infineon SAK-C167CR-Mikrocontroller ausf√ºhren. Auch hier ist zu beachten, dass dieser Controller keinen integrierten Flash-Speicher hat. Dar√ºber hinaus verf√ºgt der Controller, wie sich herausstellte, √ºber keine speziellen Debugging-Schnittstellen (einschlie√ülich JTAG). Mit hoher Wahrscheinlichkeit wird die Firmware werkseitig auf einen externen Flash im Programmierer geschrieben. Wie sich herausstellte, ist jedoch nicht alles so schlecht - der Controller verf√ºgt √ºber einen Bootloader (‚ÄûBootstrap Loader‚Äú), der an UART arbeitet. Dieser Bootloader ist im integrierten Boot-ROM des Controllers gespeichert, muss sich also in meinem Controller befunden haben. Und es funktioniert ganz eigenartig - um es beim Start zu aktivieren, m√ºssen Sie die Datenbusleitung P0L.4 auf niedrig setzen,Danach wartet der Controller darauf, dass das 0x00-Byte vom Host angezeigt wird. Nachdem der Bootloader dieses Byte akzeptiert hat, ermittelt er automatisch die √úbertragungsrate und wartet auf 32 Datenbytes, die er in den internen RAM des Controllers kopiert. Nachdem die Daten empfangen wurden, startet die Steuerung die Ausf√ºhrung des empfangenen Programms (16 Steuerungsw√∂rter).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tats√§chlich m√ºssen Sie in diesen 32 Bytes einen anderen Loader ("Preloader") pushen, der den Hauptlader "External Loader" vom Host empf√§ngt, und dessen Ausf√ºhrung starten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier hatte ich Gl√ºck - f√ºr diesen Prozessor gibt es bereits ein fertiges FLASHit-Programm, das alle genannten Vorg√§nge automatisch ausf√ºhren kann. Der eingebaute Loader verf√ºgt √ºber zahlreiche Funktionen: Mit ihm k√∂nnen Sie automatisch das Modell des installierten Flash-Speichers ermitteln, den Inhalt der Controller-Register bearbeiten und anzeigen sowie den Status der ADC-Kan√§le anzeigen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich konnte keine Testpads auf der Platine finden, die mit der P0L.4-Leitung des Controllers verbunden waren. Um den Bootloader zu starten, musste ich einen speziellen Stift an diese Leitung anl√∂ten. Ich habe den Stift auf den Fall eines der RAM-Chips geklebt. Um den Bootloader zu starten, m√ºssen Sie diesen Pin √ºber einen 8-kŒ©-Widerstand mit Masse verbinden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich die Karte an den Computer angeschlossen und das Prozessormodul mit Strom versorgt hatte, wurde der Mikrocontroller wirklich in FLASHit angezeigt. Danach habe ich ein kleines Programm in Keil geschrieben, das einen der Controller-Pins vertauscht und in Flash geschrieben hat. Das Programm hat gut funktioniert, ASIC hat sich nicht eingemischt (ich hatte Angst vor einem eingebauten Watchdog-Mechanismus oder vor Konflikten in den Bussen), damit ich weitermachen konnte.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach stellte ich die Prozessormodulschaltung wieder her, wodurch ich den Betrieb aller Module in der Baugruppe √ºberpr√ºfen konnte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim ersten Mal habe ich den Betrieb des Lasermoduls √ºberpr√ºft. Wie ich bereits geschrieben habe, musste zum Starten des Laserpulses nur ein Signal an dieses Modul angelegt werden. Der Laser funktionierte - seine Blitze konnten mit der Kamera eines Mobiltelefons gesehen werden. Au√üerdem habe ich mit einem Oszilloskop √ºberpr√ºft, ob das Modul normalerweise Startimpulse (Referenzimpulse) bildet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes folgte die √úberpr√ºfung des Fotodetektormoduls. Hier musste ich den Betrieb des DAC, der Lawinenphotodioden-Spannungserzeugungseinheit und der Leistungssteuereinheit des Fotodetektorverst√§rkers √ºberpr√ºfen. Alle verdienten, was es erm√∂glichte, die Funktion des Entfernungsmessers selbst zu √ºberpr√ºfen. Zu diesem Zweck habe ich die Module in der von den Entwicklern beabsichtigten Form zusammengestellt:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/462/307/8fe/4623078fe14cf75b455d285680f2ece8.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Foto sind alle f√ºnf Hauptmodule um das optische System herum zusammengesetzt. Hier habe ich anstelle meines eigenen rotierenden Spiegels einen normalen Spiegel installiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach habe ich ein Lasersteuerungsprogramm f√ºr UART geschrieben, die Fotodiode eingerichtet. Als ich den Laser am Eingang des Komparators startete, konnte ich Impulse mit einem Oszilloskop erfassen, dessen Amplitude eindeutig von der Art des Hindernisses vor dem Spiegel abhing! Der Komparator hat auch gut funktioniert. Der letzte wichtige Teil des Tests blieb - die √úberpr√ºfung der OT-Leistung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der im Scanner installierte TDC-GPX-Chip hat ein ziemlich kompliziertes Design und kann in einer Vielzahl von Modi arbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgende Abbildung zeigt das Strukturdiagramm:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/ab4/c21/6f6/ab4c216f68fe6e7785f763fd7619dc67.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen k√∂nnen, enth√§lt der Chip 8 separate Kan√§le, dh er kann bis zu 8 Stoppsignale empfangen. Wenn die Kan√§le differenziell sind, k√∂nnen nur zwei Stoppsignale plus ein Startsignal analysiert werden. In diesem Fall k√∂nnen Sie mit dem Chip die Messkan√§le kombinieren und so die Genauigkeit der Messzeitintervalle erh√∂hen:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/a22/968/689/a22968689e8450060a016c0db84b9bad.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ehrlich gesagt hat mir die Dokumentation f√ºr diesen Chip nicht gefallen. Viele Dinge darin werden eher oberfl√§chlich beschrieben, Codebeispiele sind unverst√§ndlich. Der Teil des Datenblattes, der der Anpassung der Zeitaufl√∂sung gewidmet ist, enth√§lt eine Art ‚ÄûMigrationszahl‚Äú. Es gibt auch keinen normalen ‚ÄûApplication Note‚Äú auf dem Chip. Au√üerdem konnte ich im Scanner selbst die Verbindung der EF1 / EF1-Leitungen zum Controller nicht erkennen. Aus diesen Linien kann festgestellt werden, dass die Mikroschaltung die Messzeit beendet hat. Aus diesem Grund hat das Starten des OT sehr viel Zeit in Anspruch genommen, aber infolgedessen hat alles so funktioniert, wie es sollte - als der Laser gestartet wurde, funktionierte der TDC, und die Ergebnisse des TDC hingen eindeutig von der Entfernung zum Hindernis ab. Somit begann der gepulste Laser-Entfernungsmesser zu arbeiten. Es bleibt die gesamte Struktur in einen funktionsf√§higen Laserscanner zu verwandeln.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der erste Schritt, den ich brauchte, um die Einstellung vorzunehmen - der zusammengebaute Entfernungsmesser sah nach einigen Metern keine Hindernisse mehr. Das optische System sah intakt aus, aber ich musste die Platinen aus dem optischen System entfernen, damit das reflektierte Licht von der Linse auf dem Fotodetektor nicht genau fokussiert wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor der Ausrichtung habe ich ein Programm f√ºr die Steuerung geschrieben, das nicht nur Entfernungen bestimmt, sondern auch die Amplitude des vom Spitzendetektor mit dem ADC erzeugten Signals gemessen hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der gesamte Einstellvorgang wurde auf reibungslose Bewegungen des Fotodetektors und der Laserplatinen sowie auf die Suche nach ihrer Position reduziert, an der die Signalamplitude maximal ist. Infolge der Einstellung wurde die Amplitude des empfangenen Signals signifikant verbessert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes sollten Sie einige Merkmale der Datenverarbeitung beachten, die Impulsentfernungsmessern eigen sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das vom Fotodetektor erzeugte Signal hat eine analoge Form. Um es in eine digitale Form umzuwandeln, die vom OT weiterverarbeitet wird, wird ein Komparator verwendet, der so konfiguriert ist, dass er umschaltet, wenn das Eingangssignal einen bestimmten Schwellenwert √ºberschreitet. Infolgedessen tritt aufgrund der komplexen Form des Eingangssignals beim √Ñndern der Amplitude des Signals ein Fehler beim Bestimmen der Zeitintervalle auf:</font></font><br>
<br>
<img src="https://img-fotki.yandex.ru/get/198361/14557097.6/0_10da03_2cd9184c_orig.bmp" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie aus dem Diagramm ersichtlich ist, wird ein Signal mit einer niedrigeren Amplitude verz√∂gert erfasst. Um dieses Problem zu l√∂sen, gibt es verschiedene Methoden, sowohl Hardware als auch Software. Ich habe mich f√ºr die einfachste Option entschieden - die Korrektur der Messergebnisse in Abh√§ngigkeit von der Signalamplitude. Gleichzeitig musste ich Statistiken √ºber √Ñnderungen der Zeitmessergebnisse aufgrund von √Ñnderungen der Signalamplitude sammeln. Um die Amplitude des Signals zu √§ndern, ohne die anderen Parameter zu √§ndern, habe ich Papierbl√∂cke auf der Linse verwendet, die den auf die Fotodiode einfallenden Lichtfluss reduzierten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Ergebnis war diese Abh√§ngigkeit: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/0db/eee/642/0dbeee642afc3de178445fe45d3e2044.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basierend auf dieser Abh√§ngigkeit habe ich eine Korrekturtabelle erstellt, deren Daten vom Steuerungsprogramm verwendet werden, um die Entfernung zum Objekt zu bestimmen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der n√§chste Schritt ist das Starten des Spiegelmotors und des Encoders. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe bereits zuvor ein Foto eines Spiegels zitiert: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/16d/5db/5c6/16d5db5c60f0e710e0485fab2236e510.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Spiegelmotor ist b√ºrstenlos, sehr √§hnlich zu denen, die in K√ºhlerl√ºftern verwendet werden. Es kommen drei Dr√§hte heraus - zwei davon sind Strom, ein anderer ist ein Impulsgeschwindigkeitssignal. Alle diese Dr√§hte sind mit dem Schnittstellenmodul verbunden, w√§hrend das vom Motor erzeugte Drehzahlsignal nicht verwendet wird - die Steuerung basiert auf Daten vom Encoder. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie auf dem Foto sehen k√∂nnen, ist eine transparente Scheibe mit Beschriftungen f√ºr den Encoder auf der Achse des Motors befestigt. M√∂glicherweise stellen Sie fest, dass sich auf der Festplatte eine Nullmarke befindet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Encoder wurde auf eine kleine Platine montiert und vollst√§ndig mit einem Metallschirm abgedeckt, so dass seine Markierung nicht bestimmt werden konnte. Aufgrund seiner Gr√∂√üe und Pinbelegung entschied ich mich jedoch f√ºr einen HEDS-9040-Quadraturcodierer: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e13/b8a/134/e13b8a134252c787ef4fee9ae23161ae.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vier Dr√§hte gingen von der </font><font style="vertical-align: inherit;">Encoderplatine </font><font style="vertical-align: inherit;">zum Schnittstellenmodul, aber es stellte sich heraus, dass nur drei davon verwendet wurden - zwei Netzteile und ein Signal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soweit ich wei√ü, wurden Schmitt-Trigger und eine Logik auf der Karte installiert, die Daten von den Kan√§len A, B und dem Index (Nullmarkierungssignal) kombiniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sehen das von der Encoderplatine erzeugte Signal und das direkt vom Encoder aufgenommene Indexsignal aus.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/fef/43c/dd1/fef43cdd10c0302e460b266ba4a5124b.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie zu sehen ist, werden w√§hrend des Indexsignals die Codiererimpulse unterdr√ºckt. Wie sich herausstellte, erzeugte die Geberplatine 500 Impulse pro Umdrehung, aber der Zeitgeber des T2-Reglers, an den die Geberleitung angeschlossen ist, kann gleichzeitig an beiden Flanken der Impulse arbeiten, was 1000 Unterbrechungen pro Umdrehung des Spiegels ergibt. Dieser Wert entspricht der angegebenen Winkelaufl√∂sung des Scanners bei 0,36 Grad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich stelle den T2-Timer auf ‚ÄûAufnahmemodus‚Äú, mit dem ich die Zeit zwischen Unterbrechungen durch den Encoder messen kann. Die erhaltene Zeit wird verwendet, um die "Null" -Position des Spiegels zu erfassen und die Drehzahl des Motors zu stabilisieren. Gleichzeitig wird die Anzahl der Unterbrechungen gez√§hlt, mit denen Sie die Position des Spiegels bestimmen k√∂nnen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem der Encoder funktioniert hatte und ich die Drehzahlregelung starten konnte, konnte der Scanner komplett zusammengebaut werden. Aufgrund der komplexen Form der Platinen und der Optik erwies sich das Design als recht aufwendig: </font><font style="vertical-align: inherit;">
Es war nicht einfach, ein solches Design zusammenzubauen - die Genauigkeit der Anordnung der einzelnen Teile ist f√ºr den Scanner sehr wichtig. Wenn die Achse des Spiegels nicht mit der optischen Achse des Entfernungsmesserteils √ºbereinstimmt, k√∂nnte dies dazu f√ºhren, dass die Abtastebene stark gekr√ºmmt oder geneigt w√§re.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/16f/05e/cdd/16f05ecddefcb0016348678d7f587d8b.jpg" alt="Bild"></a><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/2e6/71b/812/2e671b81234a099cbbe91cd55f9060c7.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der Messung der genauen Entfernung zu Objekten ist es wichtig, eine Art Referenzobjekt zu haben, dessen Entfernung genau bekannt ist. Wenn Sie die "Flugzeit" kennen, k√∂nnen Sie die Zeit genau bestimmen, die der Nullentfernung entspricht. Aufgrund von Temperatur√§nderungen der Scannerkomponenten kann sich diese Zeit √§ndern, daher muss diese Zeit st√§ndig √ºberwacht werden. Um dieses Problem zu l√∂sen, habe ich eine spezielle geschw√§rzte Platte in den Scanner eingebaut: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/fcd/d14/a3b/fcdd14a3bbc74d42b8e75a734530e66d.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Platte ist geschw√§rzt, damit das von ihr reflektierte Licht den Fotodetektor nicht "blind" macht. Nach den Anweisungen wurden auch dunkle und hell reflektierende Elemente in das urspr√ºngliche Scannerdesign eingebaut. Sie wurden verwendet, um den Betrieb des Entfernungsmesserteils des Scanners zu √ºberwachen, und h√∂chstwahrscheinlich wurden sie auch zur Kalibrierung verwendet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Foto oben ist auch der auf der Platine montierte Encoder gut sichtbar. Wie sich herausstellte, muss der Encoder sehr genau relativ zur Platte positioniert sein, und es gab viele Probleme damit - selbst eine kleine Verschiebung des Encoders f√ºhrte zum Verlust von Impulsen, insbesondere von Indeximpulsen. Es ist m√∂glich, dass der Scanner nach dem Auftreffen auf den K√∂rper gerade aufgrund von Problemen mit dem Encoder nicht mehr funktioniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dadurch konnte eine Abtastgeschwindigkeit von bis zu 20 Umdrehungen pro Sekunde erreicht werden. Bei einer APD-Spannung von 135 V werden normalerweise Entfernungen von bis zu 10-15 m erkannt. Bei einer Spannung von 145 V und zus√§tzlicher Signalfilterung k√∂nnen Entfernungen von bis zu 30 m gemessen werden (obwohl ich nicht sicher bin, ob dies f√ºr einen Fotodetektor sicher ist).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist erw√§hnenswert, dass die maximale √úbertragungsgeschwindigkeit im Originalscanner 115200 Bit / s betr√§gt, wodurch Sie alle Daten nur mit einer Geschwindigkeit von etwa 11 Umdrehungen pro Sekunde √ºbertragen k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bereits erw√§hnt, √ºbertrage ich in meiner Firmware Daten mit einer Geschwindigkeit von 500 kbit / s, was die Anzahl der √ºbertragenen Scans pro Sekunde erheblich erh√∂hen kann. Aufgrund der UART-Geschwindigkeitsbegrenzung habe ich die Scangeschwindigkeit nicht auf die urspr√ºnglichen 25 Umdrehungen pro Sekunde erh√∂ht. Ich stelle fest, dass im Originaldesign des Scanners die Daten im Scanner selbst verarbeitet werden, sodass die niedrige Daten√ºbertragungsgeschwindigkeit keine besonderen Auswirkungen hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da der Scanner jetzt ohne Geh√§use arbeitet, konnte der Scanbereich im urspr√ºnglichen Design auf 208 Grad gegen√ºber 190 Grad vergr√∂√üert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Visualisierung der vom Scanner empfangenen Daten:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/ac1/8ae/f90/ac18aef90d3f6f6b083e373c0c80e144.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nat√ºrlich sollte der Scanner einige n√ºtzliche Funktionen erf√ºllen, daher habe ich beschlossen, seine Funktion in ROS in SLAM zu √ºberpr√ºfen und die Ergebnisse mit den Ergebnissen eines </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hausgemachten Laserscanners zu vergleichen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Zu diesem Zweck habe ich es auf Roomba installiert, auf dem zuvor ein hausgemachter Scanner installiert war. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ansicht des auf Roomba installierten Leuze-Scanners (der Spiegel dreht sich so, dass er verschwommen </font><font style="vertical-align: inherit;">
erscheint </font><font style="vertical-align: inherit;">): </font><font style="vertical-align: inherit;">Als Ergebnis der Operation hector_slam ist es uns gelungen, eine solche Wohnungskarte zu erhalten (die W√§nde sind gelb dargestellt): </font><font style="vertical-align: inherit;">
Da der Staubsauger auf Bodenh√∂he f√§hrt, ‚Äûsieht‚Äú er haupts√§chlich die M√∂bel. </font><font style="vertical-align: inherit;">
Eine solche Karte erh√§lt man jedoch, wenn der Staubsauger einfach in H√∂he des G√ºrtels in H√§nden getragen wird: </font><font style="vertical-align: inherit;">
In diesem Fall sind die W√§nde der Wohnung h√§ufiger ‚Äûsichtbar‚Äú.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/dc1/c58/f5a/dc1c58f5a2ecf6eba47a9f880d3aefbc.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/4fd/a8e/83d/4fda8e83dee18c10bfbd178f39a8b8e6.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/4f4/3d8/ec3/4f43d8ec31a8f1a0a546f9d85c76cee7.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir die Qualit√§t der Karten vergleichen, ist klar, dass die Linien des hausgemachten Scanners ‚Äûlauter‚Äú sind. Dies liegt an der Tatsache, dass bei einem hausgemachten Scanner, der das Triangulationsprinzip verwendet, die Genauigkeit mit zunehmender Entfernung erheblich zunimmt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider ist dieser Scanner trotz der sehr guten Scanqualit√§t nicht f√ºr einen autonomen Roboter geeignet - er hat zu gro√üe Abmessungen und einen zu gro√üen Stromverbrauch (ca. 7,2 W).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wo sonst kann ich einen solchen Scanner verwenden? Fr√ºher, als ich √ºber einen hausgemachten Scanner sprach, wurde ich oft nach der M√∂glichkeit gefragt, einen 3D-Scanner herzustellen, und es ist Zeit, ihn herzustellen! Eine ziemlich hohe Scangeschwindigkeit ist hier n√ºtzlich. Nat√ºrlich kann ein solcher Scanner aufgrund seiner Aufl√∂sung nicht mit Scannern verglichen werden, die das Triangulationsprinzip der Entfernungsmessung verwenden (mit einer Laserlinie oder einem Projektor (SLS)), aber sie k√∂nnen gro√üe R√§ume scannen - R√§umlichkeiten, Stra√üenabschnitte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um einen 2D-Scanner in 3D neu zu erstellen, m√ºssen Sie ihm die M√∂glichkeit geben, sich entlang einer anderen Achse zu drehen. Der </font><font style="vertical-align: inherit;">Scanner entschied ich mich zu tun, nach </font><font style="vertical-align: inherit;">dem gleichen Prinzip der Abtaststrahl als Scanner von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diesem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel. Dazu habe ich den Leuze-Scanner so ‚Äûliegend‚Äú platziert, dass seine Scanebene senkrecht zum Boden steht. Als n√§chstes war es notwendig, eine gleichm√§√üige langsame Drehung des gesamten Scanners um die Achse zu realisieren. Die Hauptschwierigkeit - der Scanner muss sich ohne Schl√§ge und Verzerrungen drehen, was zu Verzerrungen der Scans f√ºhrt. Wie sich herausstellte, ist es zu Hause schwierig, eine Lagerbaugruppe herzustellen, die eine so genaue Drehung erm√∂glicht. Aus diesem Grund habe ich mich f√ºr den VHS-Kopf des Tonbandger√§ts als Lagereinheit entschieden - er enth√§lt zwei Lager, ist sehr genau hergestellt und h√§lt dem Gewicht des Scanners stand. Die resultierende Konstruktion wird von einem Schrittmotor angetrieben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zusammengebaute 3D-Scanner sieht folgenderma√üen aus: </font><font style="vertical-align: inherit;">
Ansicht des auf einem Stativ montierten Scanners:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/60d/967/07c/60d96707cb26b50daca5c06bcbee64e5.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/167/77d/118/16777d118478b27a1b5ae56d449304d3.jpg" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der linken Seite befindet sich eine 12-V-Batterie, die auch ein Gegengewicht ist. Da der Leuze-Scanner f√ºr den Betrieb 24 V ben√∂tigt, musste ich einen DC / DC-Aufw√§rtswandler installieren, der auf der Grundlage des XL6009-Chips am Scanner montiert wurde. Der Schrittmotor des Scanners wird von einem Modul des A4988 und des Arduino gesteuert, das eine Drehung mit einer bestimmten Geschwindigkeit erm√∂glicht. Sowohl der Leuze-Scanner (√ºber den USB-UART-Adapter) als auch der Arduino sind √ºber einen USB-Hub mit einem Kabel an einen Computer angeschlossen, der Daten erfasst. In der aktuellen Form sind die Drehung des Scannerspiegels und die Drehung des gesamten Scanners nicht synchronisiert. Die Drehzahl des Scanners wird so gew√§hlt, dass der Spiegel bei einer Drehung um 0,36 Grad Zeit hat, mindestens drei Umdrehungen auszuf√ºhren. Da es keine Geschwindigkeitssynchronisation gibt, musste ich Synchronisationspositionsinformationen vom Arduino an den Leuze-Scanner √ºbertragen.Dies ist ganz einfach zu implementieren: Wenn Arduino den Scanner alle 0,36 Grad dreht, √§ndert sich der Signalpegel an einem der Anschl√ºsse. Dieses Signal wird an das Scanner-Prozessormodul (an den nicht verwendeten Anschluss des Schutzglas-Statussensors) √ºbertragen. Informationen √ºber den Status dieses Signals werden zu Beginn jedes Scanners gesendet - somit empf√§ngt das selbstgeschriebene Programm f√ºr den PC, der den Scanner steuert, Informationen √ºber die Bewegung des Scanners und bestimmt den Winkel, um den er gedreht wird.empf√§ngt Informationen √ºber die Bewegung des Scanners und bestimmt den Winkel, in dem er gedreht wird.empf√§ngt Informationen √ºber die Bewegung des Scanners und bestimmt den Winkel, in dem er gedreht wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein einzelner vom Scanner erzeugter 3D-Scan enth√§lt ungef√§hr 350'000 Punkte. </font><font style="vertical-align: inherit;">Dies ist nat√ºrlich deutlich weniger als bei professionellen Scannern, aber immer noch ziemlich gut, insbesondere wenn Sie mehrere Scans zusammenkleben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Beispiel ist ein einzelner Scan eines Raums: </font><font style="vertical-align: inherit;">
Ein Beispiel ist ein Scan eines Raums, der aus mehreren geklebt wurde: Der </font><font style="vertical-align: inherit;">
gescannte Teil des Eingangs: Ein </font><font style="vertical-align: inherit;">
Video, das die Ergebnisse des resultierenden Scanners zeigt:</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/152/e40/f46/152e40f4695ab5321aa7de9f0bf00f45.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/37c/376/a36/37c376a366c09c7b5c94cca47992d5f1.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/592/ebd/33d/592ebd33da93487d27e38a2ca030025e.png" alt="Bild"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3SnqrfDCc70" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Quellcode des Controller-Programms auf Github</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de396357/">https://habr.com/ru/post/de396357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de396343/index.html">Explodieren die Sterne irgendwann?</a></li>
<li><a href="../de396345/index.html">Unternehmensdruck: weit mehr Probleme als es scheint</a></li>
<li><a href="../de396347/index.html">Klimatisierung √ºber WLAN</a></li>
<li><a href="../de396349/index.html">"Ein Freund meines Freundes sagte ...". Klatsch und Mythen √ºber SSD aufdecken</a></li>
<li><a href="../de396353/index.html">Touch-Taste mit Hintergrundbeleuchtung aus China f√ºr Heimwerker</a></li>
<li><a href="../de396359/index.html">SoftBank kauft ARM Holdings f√ºr 24 Milliarden Pfund</a></li>
<li><a href="../de396361/index.html">Der Besitzer des Tesla Model S behauptet, der Autopilot seines Elektroautos habe den Fu√üg√§nger vor dem Tod gerettet</a></li>
<li><a href="../de396363/index.html">Windows 10 ist genau ein Jahr alt</a></li>
<li><a href="../de396365/index.html">HyperX Alloy FPS - Zuverl√§ssigkeit vor allem</a></li>
<li><a href="../de396367/index.html">SMS-Codes f√ºr die Telegrammautorisierung werden weiterhin abgefangen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>