<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โ๏ธ โ๏ธ ๐ฅ ุฎุทุฃ ููุงุฒูุฉ ุญุฑูุฉ ูุฑูุฑ VoIP. ุชุญููู ุงูุชุจุฏูู ุจูู ูุฑุงูุฒ ุงูุจูุงูุงุช ูู ููุช ุงูุฐุฑูุฉ ๐จ๐ผ ๐๏ธ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุจุถุน ูููุงุช ุญูู ูุง ููุนูู. ุชุดุงุฑู DINS ูู ุชุทููุฑ ูุฏุนู ุฎุฏูุฉ UCaaS ูู ุงูุณูู ุงูุฏูููุฉ ููุนููุงุก ูู ุงูุดุฑูุงุช. ูุชู ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ ูู ูุจู ุงูุดุฑูุงุช ุงูุตุบูุฑุฉ ูุงูุดุฑูุงุช ุงู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฎุทุฃ ููุงุฒูุฉ ุญุฑูุฉ ูุฑูุฑ VoIP. ุชุญููู ุงูุชุจุฏูู ุจูู ูุฑุงูุฒ ุงูุจูุงูุงุช ูู ููุช ุงูุฐุฑูุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/436404/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุจุถุน ูููุงุช ุญูู ูุง ููุนูู.  ุชุดุงุฑู DINS ูู ุชุทููุฑ ูุฏุนู ุฎุฏูุฉ UCaaS ูู ุงูุณูู ุงูุฏูููุฉ ููุนููุงุก ูู ุงูุดุฑูุงุช.  ูุชู ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ ูู ูุจู ุงูุดุฑูุงุช ุงูุตุบูุฑุฉ ูุงูุดุฑูุงุช ุงููุงุดุฆุฉ ูุงูุดุฑูุงุช ุงููุจุฑู.  ูุชุตู ุงูุนููุงุก ุนุจุฑ ุงูุฅูุชุฑูุช ุนุจุฑ ุจุฑูุชูููู SIP ุนุจุฑ TCP ุฃู TLS ุฃู WSS.  ููุฐุง ูุฎูู ุญูููุฉ ูุจูุฑุฉ ุฅูู ุญุฏ ูุง: ุญูุงูู 1.5 ููููู ุงุชุตุงู ูู ุงูุฃุฌูุฒุฉ ุงูุทุฑููุฉ - ููุงุชู Polycom / Cisco / Yealink ูุนููุงุก ุงูุจุฑุงูุฌ ููููุจููุชุฑ / Mac / IOS / Android. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุฃุชุญุฏุซ ุนู ููููุฉ ุชุฑุชูุจ ููุงุท ุฏุฎูู VoIP. </p><a name="habracut"></a><br><h3 id="predystoriya" style=";text-align:right;direction:rtl">  ุงูุฎูููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุนูู ูุญูุท ุงููุธุงู (ุจูู ุงูุฃุฌูุฒุฉ ุงูุทุฑููุฉ ูุงูููุงุฉ) ุชูุฌุฏ SBC ุชุฌุงุฑูุฉ (ูุญุฏุฉ ุชุญูู ุญุฏูุฏ ุงูุฌูุณุฉ). </p><br><p style=";text-align:right;direction:rtl">  ููุฐ ุนุงู 2012 ุ ูุณุชุฎุฏู ุญููููุง ูู Acme Packet ุ ุญุตูุช ุนูููุง Oracle ูุงุญููุง.  ูุจู ุฐูู ุ ุงุณุชุฎุฏููุง NatPASS. </p><br><p style=";text-align:right;direction:rtl">  ุงุฐูุฑ ุจุงุฎุชุตุงุฑ ุงููุธููุฉ ุงูุชู ูุณุชุฎุฏููุง: </p><br><p style=";text-align:right;direction:rtl">  โข ุงุฌุชูุงุฒ NAT. <br>  B2BUA ุ <br>  โข ุชุทุจูุน SIP (ุงูุฑุคูุณ ุงููุณููุญ ุจูุง / ุบูุฑ ุงููุณููุญ ุจูุง ุ ููุงุนุฏ ูุนุงูุฌุฉ ุงูุฑุฃุณ ุ ุฅูุฎ) <br>  โข ุชูุฑูุบ TLS ู SRTP ุ <br>  โข ุชุญููู ุงูููู (ุฏุงุฎู ุงููุธุงู ูุณุชุฎุฏู SIP ุนุจุฑ UDP) ุ <br>  โข ุฑุตุฏ MOS (ุนุจุฑ RTCP-XR) ุ <br>  โข ACLs ุ ุงูุชุดุงู Bruteforce ุ <br>  โข ุงูุฎูุงุถ ุญุฑูุฉ ุงูุชุณุฌูู ุจุณุจุจ ุฒูุงุฏุฉ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุงุชุตุงู (ุงูุฎูุงุถ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุนูู ุฌุงูุจ ุงููุตูู ุ ูุงุฑุชูุงุน ุงูุฌุงูุจ ุงูุฃุณุงุณู) ุ <br>  โข ุฑุณุงุฆู SIP ููู ุทุฑููุฉ ุงุฎุชูุงู. </p><br><p style=";text-align:right;direction:rtl"> ุชุญุชูู ุงูุฃูุธูุฉ ุงูุชุฌุงุฑูุฉ ุนูู ุฅูุฌุงุจูุงุชูุง ุงููุงุถุญุฉ (ุงููุธุงุฆู ุฎุงุฑุฌ ุงูุตูุฏูู ุ ุงูุฏุนู ุงูุชุฌุงุฑู) ูุงููุตูุฑ (ุงูุณุนุฑ ุ ููุช ุงูุชุณููู ุ ููุฉ ุงููุฑุต ุฃู ุงูููุงุนูุฏ ุงูููุงุฆูุฉ ุทูููุฉ ุฌุฏูุง ูุชูููุฐ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ุงูุชู ูุญุชุงุฌูุง ุ ุงูููุงุนูุฏ ุงูููุงุฆูุฉ ูุญู ุงููุดููุงุช ุ ุฅูุฎ).  ุชุฏุฑูุฌูุง ุ ุจุฏุฃ ุชููู ุงูุนููุจ ุ ูุฃุตุจุญ ูู ุงููุงุถุญ ุฃู ููุงู ุญุงุฌุฉ ูุงุณุฉ ูุชุทููุฑ ุญููููุง ุงูุฎุงุตุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชู ุฅุทูุงู ุงูุชุทููุฑ ููุฐ ุนุงู ููุตู.  ูู ุงููุธุงู ุงููุฑุนู ููุญุฏูุฏ ุ ููุฒูุง ุชูููุฏููุง ูููููู ุฑุฆูุณููู: ุฎูุงุฏู SIP ู Media ุ  ููุงุฒู ุงูุชุญููู ููู ูู ูููู.  ุฃูุง ุฃุนูู ุนูู ููุงุท ุงูุฏุฎูู / ุงูููุงุฒูุงุช ููุง ุ ูุฐูู ุณุฃุญุงูู ุงูุชุญุฏุซ ุนููุง. </p><br><h4 id="trebovaniya" style=";text-align:right;direction:rtl">  ุงููุชุทูุจุงุช </h4><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุชุณุงูุญ ูุน ุงูุฎุทุฃ: ูุฌุจ ุฃู ูููุฑ ุงููุธุงู ุฎุฏูุฉ ูู ุญุงูุฉ ูุดู ูุซูู ูุงุญุฏ ุฃู ุฃูุซุฑ ูู ูุฑูุฒ ุงูุจูุงูุงุช ุฃู ูุฑูุฒ ุงูุจูุงูุงุช ุจุฃูููู </li><li style=";text-align:right;direction:rtl">  ุฅููุงููุฉ ุงูุฎุฏูุฉ: ูุฑูุฏ ุฃู ูุชููู ูู ุชุจุฏูู ุงูุฃุญูุงู ูู ูุฑูุฒ ุจูุงูุงุช ุฅูู ุขุฎุฑ </li><li style=";text-align:right;direction:rtl">  ูุงุจููุฉ ุงูุชูุณุน: ุฃุฑูุฏ ุฒูุงุฏุฉ ุงูุณุนุฉ ุจุณุฑุนุฉ ูุบูุฑ ููููุฉ </li></ul><br><h4 id="balansirovka" style=";text-align:right;direction:rtl">  ููุงุฒูุฉ </h4><br><p style=";text-align:right;direction:rtl">  ุงุฎุชุฑูุง IPVS (ุงููููุจ LVS) ูู ูุถุน IPIP (ููู ุงููุฑูุฑ).  ูู ุฃุฎูุถ ูู ุชุญููู ููุงุฑู ูู NAT / DR / TUN / L3DSR ุ (ููููู ุฃู ุชูุฑุฃ ุนู ุงูุฃูุถุงุน ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ) ุ ุณุฃุฐูุฑ ููุท ุงูุฃุณุจุงุจ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ูุฑูุฏ ูุฑุถ ุดุฑุท ุนูู ุงูุฎูููุฉ ููููู ุนูู ููุณ ุงูุดุจูุฉ ุงููุฑุนูุฉ ูุซู LVS (ุชุญุชูู ุงูุชุฌูุนุงุช ุนูู ููุงุท ุฎูููุฉ ูู ูู ูู ูุฑุงูุฒ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุง ูุงูุจุนูุฏุฉ) ุ </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชุชููู ุงููุงุฌูุฉ ุงูุฎูููุฉ IP ุงููุตุฏุฑ ุงูุฃุตูู ููุนููู (ุฃู NAT ุงูุฎุงุต ุจู) ุ ุจูุนูู ุขุฎุฑ ุ ูุตุฏุฑ NAT ุบูุฑ ููุงุณุจ ุ </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชุฏุนู ุงูุฎูููุฉ ุงูุนูู ุงููุชุฒุงูู ูุน ุงูุนุฏูุฏ ูู ุงูุดุฎุตูุงุช ุงููููุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุญู ููุงุฒู ุญุฑูุฉ ูุฑูุฑ ุงููุณุงุฆุท (ุงุชุถุญ ุฃููุง ุตุนุจุฉ ููุบุงูุฉ ุ ูุณูุฑูุถูุง) ุ ูุจุงูุชุงูู ูุฅู ูุฎุทุท ุงููุดุฑ ุงูุญุงูู ูู ูุฑูุฒ ุงูุจูุงูุงุช ูู ููุง ููู: <br><br><img src="https://habrastorage.org/webt/fk/vh/wg/fkvhwgftogjrev-a931o3a9qk-e.png"><br><br>  ุงุณุชุฑุงุชูุฌูุฉ ููุงุฒูุฉ IPVS ุงูุญุงููุฉ ูู "sed" (ุฃูุตุฑ ุชุฃุฎูุฑ ูุชููุน) ุ ูุฃูุซุฑ ูู ุฐูู.  ุนูู ุนูุณ ูุญุฏุฉ ุงูุชุญูู ุงูููุฒููุฉ ูู ุฌููุฉ ุฑูุจู / ุงูุฃูู ูุฑุฌุญูุง ุ ูุฅูู ูุณูุญ ูู ุจุนุฏู ููู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงููุตูุงุช ุงูุฎูููุฉ ุฐุงุช ุงูุฃูุฒุงู ุงูููุฎูุถุฉ ุญุชู ุงููุตูู ุฅูู ุญุฏ ูุนูู.  ูุชู ุญุณุงุจ ุฃูุตุฑ ุชุฃุฎูุฑ ูุชููุน ุจุงุณุชุฎุฏุงู ุงูุตูุบุฉ (Ci + 1) / Ui ุ ุญูุซ Ci ูู ุนุฏุฏ ุงูุงุชุตุงูุงุช ุนูู ุงููุงุฌูุฉ ุงูุฎูููุฉ i ุ Ui ูู ูุฒู ุงููุงุฌูุฉ ุงูุฎูููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงูุช ููุงู ุฎูุงุต ุฎูููุฉ ูู ุงูุจุฑูุฉ ุจุฃูุฒุงู ุชุจูุบ 50.000 ู 2 ุ ูุณูุชู ุชูุฒูุน ุงูุงุชุตุงูุงุช ุงูุฌุฏูุฏุฉ ุจูุงุณุทุฉ ุงูุฃูู ูููุง ุญุชู ูุตู ูู ุฎุงุฏู ุฅูู 25000 ุงุชุตุงู ุฃู ุญุชู ูุชู ุงููุตูู ุฅูู ุงูุญุฏ ุงูุฃูุตู - ููู ุญุฏ ุนูู ุฅุฌูุงูู ุนุฏุฏ ุงูุงุชุตุงูุงุช. <br>  ูุฑุงุกุฉ ุงููุฒูุฏ ุนู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชูุงุฒู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฑุฌู ipvsadm</a> . </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุชุฌูุน IPVS ุจูุฐุง ุงูุดูู (ููุง ูุฃุฏูุงู ุ ูุชู ุณุฑุฏ ุนูุงููู IP ุงูููููุฉ): </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs"># ipvsadm -ln Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConn TCP 1.1.1.1:5060 sed -&gt; 10.11.100.181:5060 Tunnel 50000 5903 4 -&gt; 10.11.100.192:5060 Tunnel 50000 5905 1 -&gt; 10.12.100.137:5060 Tunnel 2 0 0 -&gt; 10.12.100.144:5060 Tunnel 2 0 0</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชูุฒูุน ุงูุชุญููู ุนูู VIP ุนูู ุงูุฎูุงุฏู ุงูุชู ูุจูุบ ูุฒููุง 50000 (ูุชู ูุดุฑูุง ูู ููุณ ูุฑูุฒ ุงูุจูุงูุงุช ููุซูู LVS ูุญุฏุฏ) ุ ุฅุฐุง ูุงูุช ูุญููุฉ ููู ุทุงูุชูุง ุฃู ุชุฏุฎู ูู ูุงุฆูุฉ ุณูุฏุงุก ุ ุณููุชูู ุงูุญูู ุฅูู ุฌุฒุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ูู ุงูุชุฌูุน - ุงูุฎูุงุฏู ุงูุชู ูุจูุบ ูุฒููุง 2 ูุฑูุฒ ุงูุจูุงูุงุช ุงููุฌุงูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุถุจุท ููุณ ุงูุชุฌูุน ุ ูููู ูุน ุงูููุงููุณ ุ ุนูู ุงูุนูุณ ูู ุฐูู ุ ุชู ุชููููู ูู ูุฑูุฒ ุงูุจูุงูุงุช ุงููุฌุงูุฑ (ูู ูุธุงู ุงูุฅูุชุงุฌ ุ ูุนุฏุฏ ุงูุฎูููุฉ ุ ุจุทุจูุนุฉ ุงูุญุงู ุ ุฃูุจุฑ ุจูุซูุฑ). </p><br><p style=";text-align:right;direction:rtl">  ูุชูุญ ุชุฒุงูู ุงูุงุชุตุงูุงุช ุนุจุฑ ipvs sync ูููุณุฎ ุงูุงุญุชูุงุทู LVS ูุนุฑูุฉ ุฌููุน ุงูุงุชุตุงูุงุช ุงูุญุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุงูุชุฒุงูู ุจูู ูุฑุงูุฒ ุงูุจูุงูุงุช ุ ุชู ุชุทุจูู ุชูููุฉ "ูุฐุฑุฉ" ุ ููุน ุฐูู ุชุนูู ุจุดูู ุฌูุฏ.  ุชุนูู ูุฒุงููุฉ IPVS ููุท ูู ุฎูุงู ุงูุจุซ ุงููุชุนุฏุฏ ุ ูุงูุฐู ูุงู ูู ุงูุตุนุจ ุนูููุง ุชูุตููู ุจุดูู ุตุญูุญ ุฅูู ุงูุนุงุตูุฉ ุงููุฌุงูุฑุฉ.  ุจุฏูุงู ูู ุงูุฅุฑุณุงู ุงููุชุนุฏุฏ ุ ูููู ุจุชูุฑุงุฑ ุงุฒุฏุญุงู ุงููุฑูุฑ ุนุจุฑ iptables ุงููุฏู TEE ูู ipvs ุงูุฑุฆูุณู ุฅูู ููู ip-ip ุฅูู ุงูุฎุงุฏู ูู ุงูุนุงุตูุฉ ุงููุฌุงูุฑุฉ ุ ููุฏ ูููู ููุงู ุนุฏุฉ ูุถูููู ูุณุชูุฏููู / ูุฑุงูุฒ ุจูุงูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#### start ipvs sync master role: ipvsadm --start-daemon master --syncid 10 --sync-maxlen 1460 --mcast-interface sync01 --mcast-group 224.0.0.81 --mcast-port 8848 --mcast-ttl 1 #### duplicate all sync packets to remote LVS servers using iptables TEE target: iptables -t mangle -A POSTROUTING -d 224.0.0.81/32 -o sync01 -j TEE --gateway 172.20.21.10 # ip-ip remote lvs server 1 iptables -t mangle -A POSTROUTING -d 224.0.0.81/32 -o sync01 -j TEE --gateway 172.20.21.14 # ip-ip remote lvs server 2 #### start ipvs sync backup role: ipvsadm --start-daemon backup --syncid 10 --sync-maxlen 1460 --mcast-interface sync01 --mcast-group 224.0.0.81 --mcast-port 8848 --mcast-ttl 1 #### be ready to receive sync sync packets from remote LVS servers: iptables -t mangle -A PREROUTING -d 224.0.0.81/32 -i loc02_srv01 -j TEE --gateway 127.0.0.1 iptables -t mangle -A PREROUTING -d 224.0.0.81/32 -i loc02_srv02 -j TEE --gateway 127.0.0.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ูู ุฎุงุฏู ูู ุฎูุงุฏู LVS ููุนุจ ููุง ุงูุฏูุฑูู ูู ุขู ูุงุญุฏ (ุฑุฆูุณู ููุณุฎ ุงุญุชูุงุทู) ุ ูู ูุงุญูุฉ ุ ุฅูู ููุงุณุจ ุชูุงููุง ุ ูุฃูู ูุฒูู ุชุบููุฑ ุงูุฏูุฑ ุนูุฏ ุชุจุฏูู ุญุฑูุฉ ุงููุฑูุฑ ุ ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูุฃู ูู ูุญุฏุฉ ุชุญูู ุงููุฌุงู ุชุนุงูุฌ ุญุฑูุฉ ูุฑูุฑ ุงููุฌููุนุฉ ุจุดูู ุงูุชุฑุงุถู ูุจุงุฑ ุงูุดุฎุตูุงุช ุงูุนุงูุฉ. </p><br><h4 id="pereklyuchenie-nagruzki-mezhdu-data-centrami" style=";text-align:right;direction:rtl">  ุชุญููู ุงูุชุจุฏูู ุจูู ูุฑุงูุฒ ุงูุจูุงูุงุช </h4><br><p style=";text-align:right;direction:rtl">  ูู ุงูุชุดุบูู ุงูุนุงุฏู ุ ูุชู ุงูุฅุนูุงู ุนู ูู ุนููุงู IP ุนุงู ุนูู ุงูุฅูุชุฑูุช ูู ุฃู ููุงู (ูู ูุฐุง ุงููุฎุทุท ุ ูู ูุฑูุฒูู ููุจูุงูุงุช).  ูุชู ุชูุฌูู ุญุฑูุฉ ุงููุฑูุฑ ุงูุชู ุชุฏุฎู VIP ุฅูู ุงูุนุงุตูุฉ ุงูุชู ูุญุชุงุฌูุง ูู ุงูููุช ุงูุญุงูู ุจุงุณุชุฎุฏุงู ุณูุฉ BGP MED (ุชูููุฒ ุงูุฎุฑูุฌ ุงููุชุนุฏุฏ) ุจููู ูุฎุชููุฉ ูู DC ุงููุดุทุฉ ู DC ูููุณุฎ ุงูุงุญุชูุงุทู.  ูู ููุณ ุงูููุช ุ ูููู Backup DC ูุณุชุนุฏูุง ุฏุงุฆููุง ููุจูู ุญุฑูุฉ ุงููุฑูุฑ ุฅุฐุง ุญุฏุซ ุดูุก ูุง ูููุดุงุท ุงููุดุท: <br><br><img src="https://habrastorage.org/webt/ir/s6/ht/irs6htkfhrve2zzevsl0cwcg4k4.png"><br><br>  ูู ุฎูุงู ุชุบููุฑ ููู BGP MEDs ูุงุณุชุฎุฏุงู ูุฒุงููุฉ IPVS ุนุจุฑ ุงูููุงูุน ุ ุณูุญุตู ุนูู ูุฑุตุฉ ูููู ุญุฑูุฉ ุงููุฑูุฑ ุจุณูุงุณุฉ ูู ุงููุงุฌูุฉ ุงูุฎูููุฉ ููุฑูุฒ ุจูุงูุงุช ุฅูู ุขุฎุฑ ุ ุฏูู ุงูุชุฃุซูุฑ ุนูู ุงูููุงููุงุช ุงููุงุชููุฉ ุงูุซุงุจุชุฉ ุ ูุงูุชู ุณูู ุชูุชูู ุนุงุฌูุงู ุฃู ุขุฌูุงู ุจุดูู ุทุจูุนู.  ุชุชู ุงูุนูููุฉ ุชููุงุฆููุง ุจุงููุงูู (ููู ุดุฎุต ูุฏูู ุฒุฑ ูู ูุญุฏุฉ ุงูุชุญูู ุจุงูุฅุฏุงุฑุฉ) ุ ููุจุฏู ููุง ููู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  SIP-VIP ูุดุท ูู DC1 (ูุณุงุฑ) ุ ุงููุชูุฉ ูู DC2 (ูููู) ูุง ูุฒูู ููุง ุ ูุฐูู ุจูุถู ุชุฒุงูู IPvs ุ ูุฏูู ูุนูููุงุช ุญูู ุงูุงุชุตุงูุงุช ุงููุงุฆูุฉ ูู ุฐุงูุฑุชู.  ุนูู ุงููุณุงุฑ ุ ูุชู ุงูุฅุนูุงู ุนู ุงูุดุฎุตูุงุช ุงููููุฉ ุงููุดุทุฉ ุจูููุฉ 100 MED ุ ุนูู ุงููููู - ุจูููุฉ 500: <br><br><img src="https://habrastorage.org/webt/v6/di/th/v6dithpguub8rbq7ggurj_vdlxi.png"></p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุฒุฑ ุงูุชุจุฏูู ูุคุฏู ุฅูู ุชุบููุฑ ูู ูุง ูุณูู  "Target_state" (ููููู ุฏุงุฎูู ูุนูู ุนู ููู BGP MEDs ูู ููุช ูุนูู).  ููุง ูุง ูุฃูู ุฃู ูููู DC1 ูู ุญุงูุฉ ุฌูุฏุฉ ูุฌุงูุฒุฉ ููุนุงูุฌุฉ ุญุฑูุฉ ุงููุฑูุฑ ุ ูุจุงูุชุงูู ูุฅู LVS ูู DC2 ุชุฃุชู ูู ุญุงูุฉ "ุงูููุฉ ุงููุดุทุฉ" ุ ูุชุฎููุถ ูููุฉ MEDs ุฅูู 50 ุ ูุจุงูุชุงูู ุชุฌุฐุจ ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ููุณูุง.  ุฅุฐุง ูุงูุช ุงูุฎูููุฉ ูู DC1 ุญูุฉ ููุชุงุญุฉ ุ ููู ุชููุทุน ุงูููุงููุงุช.  ุณูุชู ุฅุฑุณุงู ุฌููุน ุงุชุตุงูุงุช TCP ุงูุฌุฏูุฏุฉ (ุงูุชุณุฌููุงุช) ุฅูู ุงููุงุฌูุฉ ุงูุฎูููุฉ ูู DC2: <br><br><img src="https://habrastorage.org/webt/lx/zo/cb/lxzocb7gt-zzrznicu5k9hiju2k.png"></p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุชููู DC1 ูุณุฎุฉ ูุชูุงุซูุฉ target_state ุฌุฏูุฏุฉ ูุชุนููู ูููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู MEDs (500).  ุนูุฏูุง ููุชุดู DC2 ุญูู ูุฐุง ุงูููุถูุน ุ ูุฅูู ูุถุจุท ูููุชู (50 =&gt; 100).  ูุจูู ุงูุงูุชุธุงุฑ ูุงุณุชููุงู ุฌููุน ุงูููุงููุงุช ุงููุดุทุฉ ูู DC1 ููุทุน ุงูุงุชุตุงูุงุช tcp ุงูููุดุฃุฉ.  ูุซููุงุช SBC ูู DC1 ุชูุฏู ุงูุฎุฏูุงุช ุงูุถุฑูุฑูุฉ ููุง ูุณูู  ุญุงูุฉ "ุฅููุงู ุงูุชุดุบูู ุงูุฑุดูู": ูุณุชุฌูุจ "503" ูุทูุจุงุช SIP ุงูุชุงููุฉ ูุงููุทุน ุงูุงุชุตุงู ุ ูููู ูุง ุชูุจู ุงูุงุชุตุงูุงุช ุงูุฌุฏูุฏุฉ.  ุฃูุถุง ุ ูุฐู ุงูุญุงูุงุช ุชูุฏุฑุฌ ูู ุงููุงุฆูุฉ ุงูุณูุฏุงุก ุนูู LVS.  ุนูุฏ ุงูุงููุทุงุน ุ ูููู ุงูุนููู ุจุฅูุดุงุก ุชุณุฌูู / ุงุชุตุงู ุฌุฏูุฏ ุ ูุงูุฐู ูุฃุชู ุจุงููุนู ูู DC2: <br><br><img src="https://habrastorage.org/webt/by/rq/uf/byrquf_81kp8zvvryrrjzdtcl-a.png"></p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุชูุชูู ุงูุนูููุฉ ุนูุฏ ูู ุญุฑูุฉ ุงููุฑูุฑ ูู DC2. <br><br><img src="https://habrastorage.org/webt/1m/dm/h8/1mdmh8styniixoof0cragfatdqq.png"></p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  DC1 ู DC2 ุชุจุฏูู ุงูุฃุฏูุงุฑ. <br><br><img src="https://habrastorage.org/webt/wu/t3/ts/wut3ts2mq5iznucnkesz2r3mnra.png"></p><br></li></ol><br><p style=";text-align:right;direction:rtl">  ูู ุธุฑูู ุงูุญูู ุงูุนุงูู ุงููุณุชูุฑ ุนูู ููุงุท ุงูุฏุฎูู ุ ุงุชุถุญ ุฃูู ููุงุณุจ ุฌุฏูุง ูุชููู ูุงุฏุฑูุง ุนูู ุชุจุฏูู ุญุฑูุฉ ุงููุฑูุฑ ูู ุฃู ููุช.  ุชุจุฏุฃ ููุณ ุงูุขููุฉ ุชููุงุฆููุง ูู ุญุงูุฉ ุจุฏุก ุชุดุบูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ DC ูุฌุฃุฉ ูู ุชููู ุญุฑูุฉ ุงููุฑูุฑ.  ูู ุงูููุช ููุณู ุ ููุญูุงูุฉ ูู ุงูุฎููุงู ุ ูุชู ุชุดุบูู ุงูุชุจุฏูู ูุฑุฉ ูุงุญุฏุฉ ููุท ูู ุงุชุฌุงู ูุงุญุฏ ููุชู ุถุจุท ุงูููู ุนูู ุงูุชุจุฏูู ุงูุชููุงุฆู ุ ูุฅุฒุงูุชู ุ ูุทููุจ ุชุฏุฎู ุจุดุฑู. </p><br><h4 id="chto-vnutri" style=";text-align:right;direction:rtl">  ูุง ูู ุงูุฏุงุฎู </h4><br><p style=";text-align:right;direction:rtl">  ูุฌููุนุฉ VRRP ููุฏูุฑ IPVS: Keepalived.  Keepalived ูู ุงููุณุคููุฉ ุนู ุชุจุฏูู ุงูุดุฎุตูุงุช ุงููููุฉ ุฏุงุฎู ุงููุฌููุนุฉ ุ ููุฐูู ุนู ุงูุชุญูู ูู ุงูุตุญุฉ / ุงููุงุฆูุฉ ุงูุณูุฏุงุก. </p><br><p style=";text-align:right;direction:rtl">  BGP ุงูููุฏุณ: ExaBGP.  ุฅูู ูุณุคูู ุนู ุงูุฅุนูุงูุงุช ุนู ุงูุทุฑู ุงููุคุฏูุฉ ุฅูู ุนูุงููู VIP ููุตู BGP MEDs ุงูููุงุจูุฉ.  ุชุณูุทุฑ ุจุงููุงูู ูู ูุจู ุฎุงุฏู ุงูุฅุฏุงุฑุฉ.  ูุชุทูุฑ ูุดุงุท ุจุฑูุงูุฌ BGP ุงูููุซูู ุจู ุงูููุชูุจ ุจูุบุฉ ุจูุซูู ุ ููู ูุคุฏู ูููุชู ุจูุณุจุฉ 100ูช. </p><br><p style=";text-align:right;direction:rtl">  ุฎุงุฏู ุงูุฅุฏุงุฑุฉ (API / ูุฑุงูุจุฉ / ุฅุฏุงุฑุฉ ุงูููููุงุช ุงููุฑุนูุฉ): Pyro4 + Flask.  ุฅูู ุฎุงุฏู ุงูุฏุนู ูู Keepalived ู ExaBGP ุ ููุฏูุฑ ุฌููุน ุฅุนุฏุงุฏุงุช ุงููุธุงู ุงูุฃุฎุฑู (sysctl / iptables / ipset / etc) ุ ููููุฑ ุงููุฑุงูุจุฉ (gnlpy) ุ ููุถูู ููุฒูู ุงููุงุฌูุฉ ุงูุฎูููุฉ ุนูุฏ ุงูุทูุจ (ูุชูุงุตููู ูุน API ุงูุฎุงุตุฉ ุจู). </p><br><h4 id="cifry" style=";text-align:right;direction:rtl">  ุงูุฃุฑูุงู </h4><br><p style=";text-align:right;direction:rtl">  ููุฏู ุงูุฌูุงุฒ ุงูุธุงูุฑู ุงููุฒูุฏ ุจุฃุฑุจุนุฉ ูุฑุงูุฒ ุฃุณุงุณูุฉ Intel Xeon Gold 6140 CPU @ 2.30GHz ุชุฏูู ุญุฑูุฉ ูุตู ุฅูู 300Mbps / 210Kpps (ุชุชู ูุนุงูุฌุฉ ุญุฑูุฉ ูุฑูุฑ ุงููุณุงุฆุท ุ ุญูุงูู 3 ุขูุงู ููุงููุฉ ูุชุฒุงููุฉ ูู ููุช ุงูุฐุฑูุฉ).  ุงุณุชุฎุฏุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูู ููุณ ุงูููุช - 60 ูช. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูููู ุงูุขู ูุฎุฏูุฉ ุญุฑูุฉ ูุฑูุฑ ูุง ูุตู ุฅูู 100 ุฃูู ูู ุงูุฃุฌูุฒุฉ ุงูุทุฑููุฉ (ููุงุชู ุณุทุญ ุงูููุชุจ).  ูุฎุฏูุฉ ูู ุญุฑูุฉ ุงููุฑูุฑ (ุฃูุซุฑ ูู ููููู ุฌูุงุฒ ุทุฑูู) ุ ูููู ุจุจูุงุก ุญูุงูู 10 ุฃุฒูุงุฌ ูู ูุฐู ุงููุฌููุนุงุช ูู ุงูุนุฏูุฏ ูู ูุฑุงูุฒ ุงูุจูุงูุงุช. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar436404/">https://habr.com/ru/post/ar436404/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar436392/index.html">ููุงุฆุฏ ุชุญููู ุชุทุจููุงุช ุงููุณุชูู 7 ูู ุฌุฏุฑุงู ุงูุญูุงูุฉ. ุงูุฌุฒุก 1. ุงูุฃุณุงุณูุงุช</a></li>
<li><a href="../ar436394/index.html">ุฏูููุณ ุญุงุจุณ - ุงูููุฑ ุงูุนุธูู ุงูุฐู ุฎูู ุงูููุฑ ุงูุนุธูู</a></li>
<li><a href="../ar436396/index.html">ูู ูููููู ุงุณุชุฎุฏุงู ุงูุจุฑูุฌุฉ ุงููุธูููุฉ ูู ูุบุชูุ</a></li>
<li><a href="../ar436398/index.html">ุงููุงุก</a></li>
<li><a href="../ar436400/index.html">ูู ุจุชููุฆุฉ ุจูุฆุฉ ุงูุชุทููุฑ ูุชุนูู HTML ู CSS ู PHP ูู Windows</a></li>
<li><a href="../ar436406/index.html">ููู ุชุตุจุญ ูุทูุฑ ูุนุจุฉ ุฅุฐุง ููุช ุณูุณุงุฑ ุนูุงุฑุงุช</a></li>
<li><a href="../ar436408/index.html">ุงูููุฐุฌุฉ ุงูุนุฏุฏูุฉ - ุชุงุฑูุฎ ูุดุฑูุน ูุงุญุฏ</a></li>
<li><a href="../ar436412/index.html">ุฌููุฉ ุตูุฑ ูููุชุจ ุจูุณุทู ุงูุฌุฏูุฏ ุนูู Facebook</a></li>
<li><a href="../ar436416/index.html">ุงููุฌุฑุฉ ูู ูููุบู ุฅูู ุจูุณุชุฌุฑุณ: ุชุฌุฑุจุฉ ุตุญููุฉ ุงูุฌุงุฑุฏูุงู</a></li>
<li><a href="../ar436420/index.html">ุฃูุจุฑ ุชูุฑูุบ ูู ุงูุชุงุฑูุฎ: 2.7 ูููุงุฑ ุญุณุงุจ ุ 773 ููููู ูููุง ูุฑูุฏุฉ ูู ููุนูุง</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>