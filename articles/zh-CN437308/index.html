<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤵🏾 👧🏼 🙊 SDL 2.0课程周期：第4课-处理事件 🛬 🔧 🎅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="来自翻译者： 

 这是Twinklebear教程的一系列翻译的延续，该教程最初在此处提供 。 该翻译是部分免费的，并且可能包含翻译人员的少量修改或补充。 前两节课的翻译由InvalidPointer编写。 原始文章中的图片已本地化，并最大限度地保留了作者的风格。 

 课程清单： 



- 第1...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SDL 2.0课程周期：第4课-处理事件</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437308/"><img src="https://habrastorage.org/getpro/habr/post_images/f5d/0d7/06a/f5d0d706a7ba63af9b903584ea96e187.png" alt="SDL2"><br><br>  <i>来自翻译者：</i> <i><br><br></i>  <i>这是Twinklebear教程的一系列翻译的延续，该教程最初<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处提供</a> 。</i>  <i>该翻译是部分免费的，并且可能包含翻译人员的少量修改或补充。</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">前两节</a>课的翻译由<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">InvalidPointer</a>编写。</i>  <i>原始文章中的图片已本地化，并最大限度地保留了作者的风格。</i> <br><a name="habracut"></a><br>  <b>课程清单：</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1课：世界您好！</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第2课。不要把所有东西都塞进主里</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第3课。SDL扩展库</a> </li><li>  <b>第4课。事件处理</b> </li><li> 第5-6课-待续 </li></ul><br><br><h2> 事件处理 </h2><br> 在本课程中，我们将学习获取用户输入的基础知识，并且为了简单起见，我们将把任何用户操作都视为<strike>逃避</strike>终止程序的尝试。  SDL使用事件队列中的SDL_Event结构和事件提取功能（例如SDL_PollEvent）来检索有关事件的信息。 作为本课程一部分编写的代码基于上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一课程</a>的结果。 <br><br> 但是首先，让我们在屏幕中央更改图片，以便首先看到您的程序的用户了解它的作用和要求。 <br><br><img src="https://habrastorage.org/webt/1_/k7/na/1_k7naqu695aypcoqghnlegv3ws.png"><br>  <i><font color="gray">作者Man已保存</font></i> <br><br><h3> 最简单的主循环 </h3><br> 我们将<b>主循环</b>添加到程序中，这将使程序正常运行，直到用户希望退出（并以可访问的形式通知程序有关程序），而不是像上一课中那样是固定的延迟。 这是这种循环的大致结构： <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!quit) <span class="hljs-comment"><span class="hljs-comment">//   ,  : { //       //  -   }</span></span></code> </pre> <br><br><h3>  SDL事件队列 </h3><br> 为了正确使用SDL事件系统，我们至少需要对其功能有最少的了解。 当SDL从操作系统接收到一个事件时，它将在较早接收到但尚未从程序中提取的所有其他事件之后，将其放置在队列的末尾。 如果在启动程序之后，我们将交替改变窗口的大小，单击窗口并单击一个键，则事件队列将如下所示： <br><img src="https://habrastorage.org/webt/af/ry/zd/afryzdfjn3xxwb40fmovvcyhp7m.png"><br><br> 当我们调用SDL_PollEvent时，我们从队列的开头获取一个事件，这是其余事件中最早的一个。 使用SDL_PollEvent从队列中接收事件会将其从那里删除，为避免这种情况，您可以使用SDL_PeepEvents函数并设置SDL_PEEKEVENT标志来“监听”该事件。 您可以在文档中阅读有关此功能的更多信息，本文的框架中并不需要（而且您很可能也会），因此将不考虑该功能。 <br><br><h3> 事件处理 </h3><br> 在主循环中，我们希望接收绘制前一帧之后发生的所有可用事件，并对其进行处理。 为此，只需将SDL_PollEvent置于while循环中即可，因为如果接收到该事件，它将返回1，如果没有接收到该事件，则将返回0。 由于该程序所做的全部工作都是在某些事件上完成的，因此使用布尔变量（布尔退出）就足够了，它指示我们是否要结束该程序，并在收到这些事件时将其值设置为true。 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// e -    SDL_Event,       while (SDL_PollEvent(&amp;e)) { //      if (e.type == SDL_QUIT) { quit = true; } //       if (e.type == SDL_KEYDOWN) { quit = true; } //     if (e.type == SDL_MOUSEBUTTONDOWN) { quit = true; } }</span></span></code> </pre><br><br> 该循环应放置在应用程序的主循环内。 <br> 当用户关闭窗口时，将发生SDL_QUIT类型的事件；在键盘上按下键时，将发生SDL_KEYDOWN类型的事件（在按住该键时会发生很多很多次，类似于在打印文本时按住键时如何重复字母）；而当用户关闭窗口时，发生SDL_MOUSEBUTTONDOWN类型的事件。鼠标单击。 这些只是您的应用程序可以接收的一些事件-当然，SDL总共可以接收20种以上类型的事件，本文当然无法涵盖，因此，您应该在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SDL_Event</a>文档中阅读它们 <br><br><h3> 主周期完成 </h3><br> 我们已经完成了事件处理，但是在主循环中，缺少了另一部分-场景显示。 在上一课程中，我们已经考虑了该主题，仅是应用此知识而已，其主要周期将采用以下形式： <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   SDL_Event e; //   bool quit = false; while (!quit) { //   while (SDL_PollEvent(&amp;e)) { if (e.type == SDL_QUIT) { quit = true; } if (e.type == SDL_KEYDOWN) { quit = true; } if (e.type == SDL_MOUSEBUTTONDOWN) { quit = true; } } //   SDL_RenderClear(renderer); renderTexture(image, renderer, x, y); SDL_RenderPresent(renderer); }</span></span></code> </pre><br><br> 该程序将永远有效。 好吧，或者至少直到用户<strike>有礼貌地</strike>要求她停止为止。 启动程序后，使用叉形按钮，键盘上的任何键或单击窗口内的鼠标都可以完成程序。 直到那一刻，她将不断重绘窗口的内容。 <br><br>  <i>转换程序的补充：程序形式的程序很可能会消耗所有可用的处理器资源，从而完全加载一个内核。</i>  <i>在主周期末尾使用SDL_Delay添加一个小的延迟（1-5 ms）是合理的，这样，在没有事件的情况下，程序可以将处理器释放给其他程序。</i>  <i>这不适用于已经需要所有可用资源的沉重游戏，当以100fps的速度每秒花100毫秒等待是一种不允许的奢侈时。</i> <br><br><h3> 第四课结束 </h3><br> 因此，下一课结束了。 在第5课中与大家见面：从纹理图集采样 <br><br>  <b>作业：</b>尝试添加图像移动，例如，使用箭头。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN437308/">https://habr.com/ru/post/zh-CN437308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN437296/index.html">人们为什么不使用正式方法？</a></li>
<li><a href="../zh-CN437298/index.html">关于一个人</a></li>
<li><a href="../zh-CN437300/index.html">iOS初学者需要掌握的10种技能和知识</a></li>
<li><a href="../zh-CN437304/index.html">如果您是色盲者，如何购买土豆</a></li>
<li><a href="../zh-CN437306/index.html">产品经理要求的非显而易见的技能</a></li>
<li><a href="../zh-CN437310/index.html">CSS渐变边框</a></li>
<li><a href="../zh-CN437312/index.html">在Linux和macOS上热重载C ++代码：深入研究</a></li>
<li><a href="../zh-CN437314/index.html">Italian Enigma：OMI密码机</a></li>
<li><a href="../zh-CN437316/index.html">自2月1日起，Internet Development Institute已命名可能在RuNet上断开连接的站点</a></li>
<li><a href="../zh-CN437318/index.html">使用逻辑复制在主要PostgreSQL版本之间进行无缝（几乎）迁移</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>