<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ» â™¨ï¸ ChaiScript-C ++è„šæœ¬è¯­è¨€ ğŸ‘¨â€ğŸ”§ ğŸ‘¼ğŸ¿ ğŸšµğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å½“éœ€è¦åœ¨C ++é¡¹ç›®ä¸­åµŒå…¥è„šæœ¬è¯­è¨€æ—¶ï¼Œå¤§å¤šæ•°äººè®°å¾—çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯Luaã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¸ä¼šå†è°ˆè®ºå¦ä¸€ç§åŒæ ·ä¾¿æ·ä¸”æ˜“å­¦çš„è¯­è¨€ï¼Œç§°ä¸ºChaiScriptã€‚ 



 ç®€çŸ­ä»‹ç» 
 å½“æˆ‘è§‚çœ‹è¯­è¨€çš„åˆ›å»ºè€…ä¹‹ä¸€Jason Turnerçš„å…¶ä¸­ä¸€åœºæ¼”è®²æ—¶ï¼Œæˆ‘è‡ªå·±å¶ç„¶å‘ç°äº†ChaiScriptã€‚ å®ƒå¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ChaiScript-C ++è„šæœ¬è¯­è¨€</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483540/"> å½“éœ€è¦åœ¨C ++é¡¹ç›®ä¸­åµŒå…¥è„šæœ¬è¯­è¨€æ—¶ï¼Œå¤§å¤šæ•°äººè®°å¾—çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯Luaã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¸ä¼šå†è°ˆè®ºå¦ä¸€ç§åŒæ ·ä¾¿æ·ä¸”æ˜“å­¦çš„è¯­è¨€ï¼Œç§°ä¸ºChaiScriptã€‚ <br><br><img src="https://habrastorage.org/webt/zh/vl/py/zhvlpyg_87wuf7gg0alk-s7qeyo.png" alt="å›¾ç‰‡"><br><a name="habracut"></a><br><h4> ç®€çŸ­ä»‹ç» </h4><br> å½“æˆ‘è§‚çœ‹è¯­è¨€çš„åˆ›å»ºè€…ä¹‹ä¸€Jason Turnerçš„å…¶ä¸­ä¸€åœº<a href="https://youtu.be/uzF4u9KgUWI">æ¼”è®²</a>æ—¶ï¼Œæˆ‘è‡ªå·±å¶ç„¶å‘ç°äº†ChaiScriptã€‚ å®ƒå¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œå½“éœ€è¦åœ¨é¡¹ç›®ä¸­é€‰æ‹©è„šæœ¬è¯­è¨€æ—¶ï¼Œæˆ‘å†³å®š-ä¸ºä»€ä¹ˆä¸å°è¯•ChaiScriptï¼Ÿ ç»“æœä½¿æˆ‘æ„Ÿåˆ°æƒŠå–œï¼ˆæˆ‘çš„ä¸ªäººç»å†å°†åœ¨æœ¬æ–‡ç»“å°¾å¤„å†™ï¼‰ï¼Œä½†æ˜¯ï¼Œæ— è®ºå¬èµ·æ¥å¤šä¹ˆå¥‡æ€ªï¼Œæ¢çº½ä¸­éƒ½æ²¡æœ‰å“ªä¸€ç¯‡æ–‡ç« ä»¥æŸç§æ–¹å¼æåˆ°äº†è¿™ç§è¯­è¨€ï¼Œå› æ­¤æˆ‘å†³å®šå†™å…³äºä»–çš„äº‹ä¼šå¾ˆé«˜å…´ã€‚ å½“ç„¶ï¼Œè¯¥è¯­è¨€æœ‰<a href="">æ–‡æ¡£</a>å’Œä¸€ä¸ª<a href="http://chaiscript.com/">å®˜æ–¹ç½‘ç«™</a> ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰äººéƒ½ä¼šä»è§‚å¯Ÿä¸­é˜…è¯»è¯¥è¯­è¨€ï¼Œå¹¶ä¸”æ–‡ç« çš„æ ¼å¼æ›´æ¥è¿‘äºè®¸å¤šäººï¼ˆåŒ…æ‹¬æˆ‘ï¼‰ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬å°†è®¨è®ºè¯¥è¯­è¨€çš„è¯­æ³•åŠå…¶æ‰€æœ‰åŠŸèƒ½ï¼Œç„¶åè®¨è®ºå¦‚ä½•åœ¨æ‚¨çš„C ++é¡¹ç›®ä¸­å®ç°è¯¥è¯­è¨€ï¼Œæœ€åï¼Œæˆ‘ä¼šè°ˆä¸€äº›æˆ‘çš„ç»éªŒã€‚ å¦‚æœæ‚¨çš„æŸäº›éƒ¨åˆ†ä¸æ„Ÿå…´è¶£ï¼Œæˆ–è€…æ‚¨æƒ³ä»¥ä¸åŒçš„é¡ºåºé˜…è¯»æ–‡ç« ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç›®å½•ï¼š <br><br><ul><li>  <a href="https://habr.com/ru/post/483540/">ChaiScriptè¯­æ³•</a> </li><li>  <a href="https://habr.com/ru/post/483540/">ç”¨C ++å®ç°</a> </li><li>  <a href="https://habr.com/ru/post/483540/">ä¸ªäººç»å†</a> </li></ul><br><a name="syntax"></a><br><h2> è¯­è¨€è¯­æ³• </h2><br>  ChaiScriptçš„è¯­æ³•ä¸C ++å’ŒJSéå¸¸ç›¸ä¼¼ã€‚ é¦–å…ˆï¼Œå®ƒåƒç»å¤§å¤šæ•°è„šæœ¬è¯­è¨€ä¸€æ ·æ˜¯åŠ¨æ€ç±»å‹çš„ï¼Œä½†æ˜¯ï¼Œä¸JavaScriptä¸åŒï¼Œå®ƒå…·æœ‰ä¸¥æ ¼çš„ç±»å‹ï¼ˆæ²¡æœ‰<code>1 + "2"</code> ï¼‰ã€‚ è¿˜æœ‰ä¸€ä¸ªå†…ç½®çš„åƒåœ¾æ”¶é›†å™¨ï¼Œè¯¥è¯­è¨€æ˜¯å®Œå…¨å¯è§£é‡Šçš„ï¼Œå…è®¸æ‚¨é€è¡Œæ‰§è¡Œä»£ç ï¼Œè€Œæ— éœ€ç¼–è¯‘ä¸ºå­—èŠ‚ç ã€‚ å®ƒæ”¯æŒå¼‚å¸¸ï¼ˆæ­¤å¤–ï¼Œè”åˆï¼Œå…è®¸æ‚¨åœ¨è„šæœ¬å’ŒC ++ä¸­æ•è·å®ƒä»¬ï¼‰ï¼Œlambdaå‡½æ•°ï¼Œè¿ç®—ç¬¦é‡è½½ã€‚ å®ƒå¯¹ç©ºæ ¼ä¸æ•æ„Ÿï¼Œå…è®¸æ‚¨é€šè¿‡åˆ†å·æˆ–pythonæ ·å¼ä»¥å•è¡Œå½¢å¼ç¼–å†™ï¼Œå¹¶ç”¨æ–°è¡Œåˆ†éš”è¡¨è¾¾å¼ã€‚ <br><br><h4> åŸå§‹ç±»å‹ </h4><br> é»˜è®¤æƒ…å†µä¸‹ï¼ŒChaiScriptå°†æ•´æ•°å˜é‡å­˜å‚¨ä¸ºintï¼Œå®æ•°ä½œä¸ºdoubleä»¥åŠå¸¦æœ‰std :: stringçš„å­—ç¬¦ä¸²ã€‚ è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†ç¡®ä¿ä¸è°ƒç”¨ä»£ç çš„å…¼å®¹æ€§ã€‚ è¯¥è¯­è¨€ç”šè‡³éƒ½æœ‰æ•°å­—åç¼€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ˜ç¡®æŒ‡å‡ºå˜é‡çš„ç±»å‹ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*   chaiscript    js    ,  var / auto `;`      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myInt = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">// int var myLongLong = 1ll // long long int var myFloating = 3.3 // double var myBoolean = false // bool var myString = "hello world!\n" // std::string</span></span></code> </pre><br> æ›´æ”¹å˜é‡çš„ç±»å‹å®é™…ä¸Šæ˜¯è¡Œä¸é€šçš„ï¼Œå¾ˆå¯èƒ½æ‚¨éœ€è¦ä¸ºè¿™äº›ç±»å‹å®šä¹‰è‡ªå·±çš„`=`è¿ç®—ç¬¦ï¼Œå¦åˆ™ï¼Œæ‚¨å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆç¨åå†è®¨è®ºï¼‰æˆ–æˆä¸ºèˆå…¥çš„å—å®³è€…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> integer = <span class="hljs-number"><span class="hljs-number">3</span></span> integer = <span class="hljs-number"><span class="hljs-number">5.433</span></span> print(integer) <span class="hljs-comment"><span class="hljs-comment">//  5    double    int! integer = true //   -   `=`  (int, bool)</span></span></code> </pre><br> ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥åœ¨ä¸ç»™å˜é‡èµ‹å€¼çš„æƒ…å†µä¸‹å£°æ˜å˜é‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå˜é‡å°†åŒ…å«ä¸€ç§æœªå®šä¹‰çš„å˜é‡ï¼Œç›´åˆ°ä¸ºå…¶åˆ†é…äº†å€¼ã€‚ <br><br><h4> å†…è”å®¹å™¨ </h4><br> è¯¥è¯­è¨€æœ‰ä¸¤ä¸ªå®¹å™¨-çŸ¢é‡å’Œåœ°å›¾ã€‚ å®ƒä»¬çš„å·¥ä½œæ–¹å¼ä¸C ++ä¸­çš„ç±»ä¼¼ç‰©éå¸¸ç›¸ä¼¼ï¼ˆåˆ†åˆ«ä¸ºstd :: vectorå’Œstd :: mapï¼‰ï¼Œä½†æ˜¯å®ƒä»¬ä¸éœ€è¦ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹ã€‚ å¯ä»¥åƒå¾€å¸¸ä¸€æ ·ä½¿ç”¨intè¿›è¡Œç´¢å¼•ï¼Œä½†æ˜¯Mapéœ€è¦å¸¦æœ‰å­—ç¬¦ä¸²çš„é”®ã€‚ æ˜¾ç„¶æ˜¯å—pythonå¯å‘çš„ï¼Œä½œè€…è¿˜æ·»åŠ äº†ä½¿ç”¨ä»¥ä¸‹è¯­æ³•åœ¨ä»£ç ä¸­å¿«é€Ÿå£°æ˜å®¹å™¨çš„åŠŸèƒ½ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = [ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>u, <span class="hljs-number"><span class="hljs-number">4</span></span>ll, <span class="hljs-string"><span class="hljs-string">"16"</span></span>, <span class="hljs-string"><span class="hljs-string">`+`</span></span> ] <span class="hljs-comment"><span class="hljs-comment">//      var m = [ "key1" : 1, "key2": "Bob" ]; //    - var M = Map() //    var V = Vector() //    //        C++ : v.push_back(123) //    ,     v.push_back_ref(m); // m -   //      m["key"] = 3 //       (reference assignment): m["key"] := m //      </span></span></code> </pre><br> é™¤äº†è¿­ä»£å™¨å¤–ï¼Œè¿™ä¸¤ä¸ªç±»å‡ ä¹éƒ½å®Œå…¨é‡å¤äº†C ++ä¸­çš„å¯¹åº”ç±»ï¼Œå› ä¸ºé™¤äº†å®ƒä»¬ä¹‹å¤–ï¼Œè¿˜æœ‰ç‰¹æ®Šçš„ç±»Rangeå’ŒConst_Rangeã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œå³ä½¿æ‚¨é€šè¿‡=ä½¿ç”¨åˆ†é…ï¼Œæ‰€æœ‰å®¹å™¨ä¹Ÿéƒ½é€šè¿‡å¼•ç”¨ä¼ é€’ï¼Œè¿™å¯¹æˆ‘æ¥è¯´å¾ˆå¥‡æ€ªï¼Œå› ä¸ºå¯¹äºæ‰€æœ‰å…¶ä»–ç±»å‹ï¼Œéƒ½ä¼šå‘ç”ŸæŒ‰å€¼å¤åˆ¶ã€‚ <br><br><h4> æ¡ä»¶æ„é€  </h4><br> æ¡ä»¶å’Œå‘¨æœŸçš„å‡ ä¹æ‰€æœ‰æ„é€ éƒ½å¯ä»¥ç”¨å­—é¢ä¸Šçš„ä¸€ä¸ªç¤ºä¾‹ä»£ç æ¥æè¿°ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-comment"><span class="hljs-comment">//  if-else if (a &gt; b) { print("a &gt; b") } else if (a == b){ print("a == b") } else { print("a &lt; b") } // switch -    if- //      //  break    ,    C++ var str = "hello" switch(str) { case("hi") { print("hi!"); break; } case("hello") { print("hello!" break; } case("bye") { print("bye-bye!") break; } default { print("what have you said?") } } var x = true //     ,       while (x) { print("x was true") x = false; } //    C.        ,    ,    ,    for (var i = 0; i &lt; 10; ++i) //   -,    { print(i); //  0 ... 9  10  } // ranged-for loop for(element : [1, 2, 3, 4, 5]) { puts(element) //   12345 } //  :   C++17 if-init statements: if(var x = get_value(); x &lt; 10) { print(x) // x     if }</span></span></code> </pre><br> æˆ‘è®¤ä¸ºç†Ÿæ‚‰C ++çš„äººä»¬æ²¡æœ‰å‘ç°ä»»ä½•æ–°ä¸œè¥¿ã€‚ è¿™å¹¶ä¸å¥‡æ€ªï¼Œå› ä¸ºChaiScriptè¢«å®šä½ä¸ºâ€œå­¦ä¹ è€…â€å­¦ä¹ çš„ä¸€ç§ç®€ä¾¿è¯­è¨€ï¼Œå› æ­¤å€Ÿé‰´äº†æ‰€æœ‰è‘—åçš„å¤å…¸è®¾è®¡ã€‚ å¦‚æœæ‚¨çœŸçš„å¾ˆå–œæ¬¢autoçš„ä¼˜ç‚¹ï¼Œä½œè€…å†³å®šç”šè‡³çªå‡ºæ˜¾ç¤ºä¸¤ä¸ªç”¨äºå£°æ˜å˜é‡çš„å…³é”®å­—<code>var</code>å’Œautoã€‚ <br><br><h4> æ‰§è¡Œä¸Šä¸‹æ–‡ </h4><br>  ChaiScriptå…·æœ‰æœ¬åœ°å’Œå…¨å±€ä¸Šä¸‹æ–‡ã€‚ è¯¥ä»£ç ä»ä¸Šåˆ°ä¸‹é€è¡Œæ‰§è¡Œï¼Œä½†æ˜¯å¯ä»¥åœ¨å‡½æ•°ä¸­å–å‡ºå¹¶ç¨åè°ƒç”¨ï¼ˆä½†ä¸èƒ½æ›´æ—©ï¼ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä»å¤–éƒ¨çœ‹ä¸åˆ°åœ¨å‡½æ•°æˆ–æ¡ä»¶/å¾ªç¯å†…éƒ¨å£°æ˜çš„å˜é‡ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨<code>global</code>æ ‡è¯†ç¬¦è€Œä¸æ˜¯<code>var</code>æ›´æ”¹æ­¤è¡Œä¸ºã€‚ å…¨å±€å˜é‡ä¸æ™®é€šå˜é‡çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œé¦–å…ˆï¼Œå®ƒä»¬åœ¨å±€éƒ¨ä¸Šä¸‹æ–‡ä¹‹å¤–å¯è§ï¼Œå…¶æ¬¡ï¼Œå¯ä»¥é‡æ–°å£°æ˜ï¼ˆå¦‚æœåœ¨é‡æ–°å£°æ˜æœŸé—´æœªè®¾ç½®è¯¥å€¼ï¼Œåˆ™å®ƒä¿æŒä¸å˜ï¼‰ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     chaiscript def foo(x) { global G = 2 print(x) } foo(0) //  foo(x), G = 2 print(G) //  2 global G = 3 //  G = 3,   global -  !</span></span></code> </pre><br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”éœ€è¦æ£€æŸ¥æ˜¯å¦ä¸ºå…¶åˆ†é…äº†å€¼ï¼Œè¯·ä½¿ç”¨<code>is_var_undef</code>å†…ç½®å‡½æ•°ï¼Œå¦‚æœæœªå®šä¹‰è¯¥å˜é‡ï¼Œåˆ™è¯¥å‡½æ•°è¿”å›trueã€‚ <br><br><h4> å­—ç¬¦ä¸²æ’å€¼ </h4><br> å¯ä»¥ä½¿ç”¨<code>${object}</code>è¯­æ³•å°†<code>to_string()</code>äº†<code>to_string()</code>æ–¹æ³•çš„åŸºç¡€å¯¹è±¡æˆ–ç”¨æˆ·å¯¹è±¡æ”¾å…¥å­—ç¬¦ä¸²ä¸­ã€‚ è¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„å­—ç¬¦ä¸²è¿æ¥ï¼Œå¹¶ä¸”é€šå¸¸çœ‹èµ·æ¥æ›´åŠ æ•´æ´ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-comment"><span class="hljs-comment">//  sum of 3 + 4 = 7 print("sum of ${x} + ${y} = ${x + y}")</span></span></code> </pre><br>  Vectorï¼ŒMapï¼ŒMapPairå’Œæ‰€æœ‰åŸè¯­ä¹Ÿæ”¯æŒæ­¤åŠŸèƒ½ã€‚ å‘é‡ä»¥<code>[o1, o2, ...]</code>æ ¼å¼æ˜¾ç¤ºï¼Œæ˜ å°„ä¸º<code>[&lt;key1, val1&gt;, &lt;key2, val2&gt;, ...]</code>å’ŒMapPairï¼š <code>&lt;key, val&gt;</code> ã€‚ <br><br><h4> åŠŸèƒ½åŠå…¶ç»†å¾®å·®åˆ« </h4><br>  ChaiScriptå‡½æ•°æ˜¯ä¸å…¶ä»–æ‰€æœ‰å¯¹è±¡ä¸€æ ·çš„å¯¹è±¡ã€‚ å®ƒä»¬å¯ä»¥è¢«æ•è·ï¼Œåˆ†é…ç»™å˜é‡ï¼ŒåµŒå¥—åœ¨å…¶ä»–å‡½æ•°ä¸­å¹¶ä½œä¸ºå‚æ•°ä¼ é€’ã€‚ åŒæ ·ï¼Œå¯¹äºå®ƒä»¬ï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¾“å…¥å€¼çš„ç±»å‹ï¼ˆè¿™æ˜¯åŠ¨æ€é”®å…¥çš„è¯­è¨€æ‰€ç¼ºå°‘çš„ï¼ï¼‰ï¼Œä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åœ¨å£°æ˜å‡½æ•°å‚æ•°ä¹‹å‰æŒ‡å®šç±»å‹ã€‚ å¦‚æœåœ¨è°ƒç”¨æ—¶å¯ä»¥å°†å‚æ•°è½¬æ¢ä¸ºæŒ‡å®šçš„å‚æ•°ï¼Œåˆ™å°†æ ¹æ®C ++è§„åˆ™è¿›è¡Œè½¬æ¢ï¼Œå¦åˆ™å°†å¼•å‘å¼‚å¸¸ï¼š <br><br><pre> <code class="javascript hljs">def adder(int x, int y) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y } def adder(bool x, bool y) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x || y } adder(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment">// ,  3 adder(1.22, -3.7) // ,  1 + (-3) = 2 adder(true, true) // ,  true adder(true, 3) // ,    adder(bool, int)</span></span></code> </pre><br> è¯­è¨€åŠŸèƒ½ä¹Ÿå¯ä»¥è®¾ç½®å‘¼å«æ¡ä»¶ï¼ˆå‘¼å«ä¿æŠ¤ï¼‰ã€‚ å¦‚æœä¸éµå®ˆï¼Œåˆ™ä¼šå¼•å‘å¼‚å¸¸ï¼Œå¦åˆ™å°†è¿›è¡Œè°ƒç”¨ã€‚ æˆ‘è¿˜æ³¨æ„åˆ°ï¼Œå¦‚æœå‡½æ•°çš„æœ«å°¾æ²¡æœ‰returnè¯­å¥ï¼Œåˆ™å°†è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼ã€‚ å°ä¾‹ç¨‹éå¸¸æ–¹ä¾¿ï¼š <br><br><pre> <code class="javascript hljs">def div(x, y) : y != <span class="hljs-number"><span class="hljs-number">0</span></span> { x / y } <span class="hljs-comment"><span class="hljs-comment">//  `y`    -    `x`  `y` print(div(2, 0.5)) //  4.0 print(div(2, 0)) // , `y`  0!</span></span></code> </pre><br><h4> ç±»å’ŒDynamic_Object </h4><br>  ChaiScriptå…·æœ‰OOPçš„åŸºç¡€çŸ¥è¯†ï¼Œå¦‚æœæ‚¨éœ€è¦æ“ä½œå¤æ‚çš„å¯¹è±¡ï¼Œè¿™æ˜¯ç»å¯¹çš„ä¼˜åŠ¿ã€‚ è¯¥è¯­è¨€å…·æœ‰ç‰¹æ®Šç±»å‹-Dynamic_Objectã€‚ å®é™…ä¸Šï¼Œæ‰€æœ‰ç±»å’Œåç§°ç©ºé—´çš„å®ä¾‹éƒ½æ˜¯å…·æœ‰é¢„å®šä¹‰å±æ€§çš„Dynamic_Objectã€‚ åŠ¨æ€å¯¹è±¡å…è®¸æ‚¨åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´å‘å…¶æ·»åŠ å­—æ®µï¼Œç„¶åè®¿é—®å®ƒä»¬ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = Dynamic_Object(); obj.x = <span class="hljs-number"><span class="hljs-number">3</span></span>; obj.f = fun(arg) { print(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x + arg); } <span class="hljs-comment"><span class="hljs-comment">//  obj   f (     `x` obj.f(-3); //  0</span></span></code> </pre><br> ç±»çš„å®šä¹‰éå¸¸ç®€å•ã€‚ å¯ä»¥å°†å®ƒä»¬è®¾ç½®ä¸ºå­—æ®µï¼Œæ–¹æ³•ï¼Œæ„é€ å‡½æ•°ã€‚ ä»æœ‰è¶£çš„<code>set_explicit(object, value)</code>é€šè¿‡ç‰¹æ®ŠåŠŸèƒ½<code>set_explicit(object, value)</code>å¯ä»¥é€šè¿‡åœ¨ç±»å£°æ˜åç¦æ­¢æ·»åŠ æ–°æ–¹æ³•æˆ–å±æ€§æ¥â€œå›ºå®šâ€å¯¹è±¡çš„å­—æ®µï¼ˆé€šå¸¸åœ¨æ„é€ å‡½æ•°ä¸­å®Œæˆï¼‰ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id; <span class="hljs-comment"><span class="hljs-comment">//  id def Widget() { this.id= 0 } //    def Widget(id) { this.id = id } //   1  def get_id() { id } //   } var w = Widget(10) print(w.get_id()) //  10 (w.id) print(w.get_id) //   10,        set_explicit(w, true) //    wx = 3 //      Widget   x</span></span></code> </pre><br> é‡è¦çš„ä¸€ç‚¹-å®é™…ä¸Šï¼Œç±»æ–¹æ³•åªæ˜¯å‡½æ•°ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…·æœ‰æ˜ç¡®æŒ‡å®šç±»å‹çš„ç±»çš„å¯¹è±¡ã€‚ å› æ­¤ï¼Œä»¥ä¸‹ä»£ç ç­‰æ•ˆäºå‘ç°æœ‰ç±»æ·»åŠ æ–¹æ³•ï¼š <br><br><pre> <code class="javascript hljs">def set_id(Widget w, id) { w.id = id } w.set_id(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-comment"><span class="hljs-comment">// w.id = 9 set_id(w, 9) //  , w.id = 9</span></span></code> </pre><br> ç†Ÿæ‚‰Cï¼ƒçš„ä»»ä½•äººéƒ½å¯ä»¥ç—›è‹¦åœ°æ›¿æ¢çœ‹èµ·æ¥åƒæ‰©å±•æ–¹æ³•çš„ä¸œè¥¿ï¼Œå¹¶ä¸”ä¼šæ¥è¿‘äº‹å®ã€‚ å› æ­¤ï¼Œä½¿ç”¨è¯¥è¯­è¨€ï¼Œæ‚¨ç”šè‡³å¯ä»¥ä¸ºå†…ç½®ç±»ï¼ˆä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²æˆ–intï¼‰æ·»åŠ æ–°åŠŸèƒ½ã€‚ ä½œè€…è¿˜æä¾›äº†ä¸€ç§ä½¿è¿ç®—ç¬¦é‡è½½çš„æ£˜æ‰‹æ–¹æ³•ï¼šè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨éœ€è¦ç”¨æ³¢æµªå·ï¼ˆ`ï¼‰åŒ…å›´è¿ç®—ç¬¦ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   +     Widget def `+`(Widget w1, Widget w2) { print("merging two widgets!") } var widget1 = Widget() var widget2 = Widget() widget1 + widget2 //      //        : var plus = `+` print(plus(1, 7)) //  8</span></span></code> </pre><br><h4> å‘½åç©ºé—´ </h4><br> è¯´åˆ°ChaiScriptä¸­çš„åç§°ç©ºé—´ï¼Œåº”è¯¥ç‰¢è®°è¿™äº›æœ¬è´¨ä¸Šæ˜¯å§‹ç»ˆåœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­çš„ç±»ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>namespace(name)</code>å‡½æ•°åˆ›å»ºå®ƒä»¬ï¼Œç„¶åæ·»åŠ å¿…è¦çš„å‡½æ•°å’Œç±»ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰è¯¥è¯­è¨€çš„åº“ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨æ‰©å±•æ¥å®‰è£…å®ƒä»¬ï¼Œæˆ‘ä»¬å°†åœ¨ç¨åè®¨è®ºã€‚ é€šå¸¸ï¼Œåç§°ç©ºé—´åˆå§‹åŒ–å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="javascript hljs">namespace(<span class="hljs-string"><span class="hljs-string">"math"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//    math //   math.square = fun(x) { x * x } math.hypot_squared= fun(x, y) { math.square(x) + math.square(y) } print(math.square(4)) //  16 print(math.hypot_squared(3, 4)) //  25</span></span></code> </pre><br><h4>  Lambdaè¡¨è¾¾å¼å’Œå…¶ä»–åŠŸèƒ½ </h4><br>  ChaiScriptä¸­çš„Lambdaè¡¨è¾¾å¼ç±»ä¼¼äºæˆ‘ä»¬ä»C ++çŸ¥é“çš„è¡¨è¾¾å¼ã€‚ ä»–ä»¬ä½¿ç”¨<b>fun</b>å…³é”®å­—ï¼Œå®ƒä»¬è¿˜éœ€è¦æ˜¾å¼æŒ‡å®šæ•è·çš„å˜é‡ï¼Œä½†æ˜¯å®ƒä»¬å§‹ç»ˆé€šè¿‡å¼•ç”¨æ¥æ‰§è¡Œã€‚ è¯¥è¯­è¨€è¿˜å…·æœ‰ç»‘å®šå‡½æ•°ï¼Œå¯è®©æ‚¨å°†å€¼ç»‘å®šåˆ°å‡½æ•°å‚æ•°ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> func_object = fun(x) { x * x } func_object(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  81 var name = "John" var greet = fun[name]() { "Hello, " + name } print(greet()) //  Hello, John name = "Bob" print(greet()) //  Hello, Bob var message = bind(fun(msg, name) { msg + " from " + name }, _, "ChaiScript"); print(message("Hello")) //  Hello from ChaiScript</span></span></code> </pre><br><h4> ä¾‹å¤–æƒ…å†µ </h4><br> åœ¨è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚ å®ƒä»¬å¯ä»¥åœ¨ChaiScriptæœ¬èº«ï¼ˆæˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºï¼‰å’ŒC ++ä¸­è¿›è¡Œæ‹¦æˆªã€‚ è¯­æ³•ä¸åŠ å·ç»å¯¹ç›¸åŒï¼Œç”šè‡³å¯ä»¥æŠ›å‡ºæ•°å­—æˆ–å­—ç¬¦ä¸²ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(x + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// x   } catch (e) { print("Error during evaluation")) } //   C++   ChaiScript //   Vector -   std::vector,    std::exception      try { var vec = [1, 2] var val = vec[3] //     } catch (e) { print("index out of range: " + e.what()); // e.what    ChaiScript } //  atch   guard     ,    `:` try { throw(5.2) } catch(e) : is_type(e, "int") { print("Int: ${e}"); //   `e`  int } catch(e) : is_type(e, "double") { print("Double: ${e}"); //  `e`  double }</span></span></code> </pre><br> ä»¥ä¸€ç§å¥½çš„æ–¹å¼ï¼Œæ‚¨åº”è¯¥å®šä¹‰å¼‚å¸¸ç±»å¹¶å°†å…¶æŠ›å‡ºã€‚ åœ¨ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨C ++ä¸­å¯¹å…¶è¿›è¡Œæ‹¦æˆªã€‚ å¯¹äºè§£é‡Šå™¨å¼‚å¸¸ï¼ŒChaiScriptæŠ›å‡ºå…¶å¼‚å¸¸ï¼Œä¾‹å¦‚eval_errorï¼Œbad_boxed_castç­‰ã€‚ <br><br><h4> è§£é‡Šå™¨å¸¸é‡ </h4><br> ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œè¯¥è¯­è¨€ç«Ÿç„¶æ˜¯æŸç§ç¼–è¯‘å™¨å®-å®ƒä»¬åªæœ‰4ä¸ªï¼Œå®ƒä»¬å…¨éƒ¨ç”¨äºæ ‡è¯†ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”ä¸»è¦ç”¨äºé”™è¯¯å¤„ç†ï¼š <br><div class="scrollable-table"><table><tbody><tr><td>  __LINE__ </td><td> å½“å‰è¡Œï¼Œå¦‚æœæœªä»æ–‡ä»¶æ‰§è¡Œä»£ç ï¼Œåˆ™ä¸ºâ€œ 1â€ </td></tr><tr><td>  __FILE__ </td><td> å½“å‰æ–‡ä»¶ï¼Œå¦‚æœæœªä»æ–‡ä»¶ä¸­è°ƒç”¨ä»£ç ï¼Œåˆ™ä¸ºâ€œ __EVAL__â€ </td></tr><tr><td>  __CLASS__ </td><td> å½“å‰è¯¾ç¨‹æˆ–â€œ NOT_IN_CLASSâ€ </td></tr><tr><td>  __åŠŸèƒ½__ </td><td> å½“å‰å‡½æ•°æˆ–â€œ NOT_IN_FUNCTIONâ€ </td></tr></tbody></table></div><br><h4> é”™è¯¯é™·é˜± </h4><br> å¦‚æœå°šæœªå£°æ˜è¦è°ƒç”¨çš„å‡½æ•°ï¼Œåˆ™ä¼šå¼•å‘å¼‚å¸¸ã€‚ å¦‚æœè¿™å¯¹æ‚¨æ¥è¯´ä¸å¯æ¥å—ï¼Œåˆ™å¯ä»¥å®šä¹‰ä¸€ä¸ªç‰¹æ®Šå‡½æ•°<code>method_missing(object, func_name, params)</code> ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œå°†ä½¿ç”¨ç›¸åº”çš„å‚æ•°è°ƒç”¨è¯¥å‡½æ•°ï¼š <br><br><pre> <code class="javascript hljs">def method_missing(Widget w, string name, Vector v) { print(<span class="hljs-string"><span class="hljs-string">"widget method ${name} with params {v} was not found"</span></span>) } w = Widget() w.invoke_error(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  widget method invoke_error with params [1, 2, 3] was not found</span></span></code> </pre><br><h4> å†…å»ºåŠŸèƒ½ </h4><br>  ChaiScriptå®šä¹‰äº†è®¸å¤šå†…ç½®å‡½æ•°ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³è°ˆä¸€è°ˆç‰¹åˆ«æœ‰ç”¨çš„å‡½æ•°ã€‚ å…¶ä¸­ï¼š <code>eval(str)</code> ï¼Œ <code>eval_file(filename)</code> ï¼Œ <code>to_json(object)</code> ï¼Œ <code>from_json(str)</code> ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(<span class="hljs-string"><span class="hljs-string">"x * y"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// res = 15,  eval     //     : //  eval_file eval_file("source.chai") //   use,  ,         use("source.chai") // to_json    Map    var w = Widget(0) var j = to_json(w) // j = "{ "id" : 0 }" // from_json    Map ( ,   ) var m = from_json(" { "x": 0, "y": 3, "z": 2 }") print(m) //  Map  [&lt;x, 0&gt;, &lt;y, 3&gt;, &lt;z, 2&gt;]</span></span></code> </pre><br><a name="cppchai"></a><br><h2> ç”¨C ++å®ç° </h2><br><h4> å®‰è£…æ–¹å¼ </h4><br>  ChaiScriptæ˜¯ä¸€ä¸ªåŸºäºC ++æ¨¡æ¿çš„ä»…æ ‡å¤´åº“ã€‚ å› æ­¤ï¼Œå¯¹äºå®‰è£…ï¼Œæ‚¨åªéœ€è¦åˆ¶ä½œä¸€ä¸ªå…‹éš†<a href="https://github.com/ChaiScript/ChaiScript">å­˜å‚¨åº“</a>æˆ–å°†æ‰€æœ‰æ¥è‡ª<a href="https://github.com/ChaiScript/ChaiScript/tree/develop/include/chaiscript">æ­¤æ–‡ä»¶å¤¹çš„æ–‡ä»¶</a>æ”¾å…¥æ‚¨çš„é¡¹ç›®ä¸­ã€‚ ç”±äºæ ¹æ®IDEçš„ä¸åŒï¼Œæ‰€æœ‰è¿™äº›æ“ä½œéƒ½æœ‰ä¸åŒçš„æ–¹å¼ï¼Œå¹¶ä¸”å·²ç»åœ¨è®ºå›ä¸Šè¿›è¡Œäº†å¾ˆé•¿æ—¶é—´çš„è¯¦ç»†æè¿°ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å‡å®šæ‚¨å·²æˆåŠŸè¿æ¥è¯¥åº“ï¼Œå¹¶ç¼–è¯‘äº†åŒ…å«<code>#include &lt;chaiscript/chaiscript.hpp&gt;</code>çš„ä»£ç ã€‚ <br><br><h4>  C ++ä»£ç è°ƒç”¨å’Œè„šæœ¬åŠ è½½ </h4><br> ä½¿ç”¨ChaiScriptçš„æœ€å°ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ æˆ‘ä»¬åœ¨C ++ä¸­å®šä¹‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°é‡‡ç”¨std :: stringå¹¶è¿”å›æ›´æ”¹åçš„å­—ç¬¦ä¸²ï¼Œç„¶ååœ¨ChaiScriptå¯¹è±¡ä¸­æ·»åŠ æŒ‡å‘å®ƒçš„é“¾æ¥ä»¥è¿›è¡Œè°ƒç”¨ã€‚ ç¼–è¯‘å¯èƒ½è¦èŠ±è´¹å¤§é‡æ—¶é—´ï¼Œä½†è¿™ä¸»è¦æ˜¯å› ä¸ºä¸ºç¼–è¯‘å™¨å®ä¾‹åŒ–å¤§é‡æ¨¡æ¿å¹¶ä¸å®¹æ˜“ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;string&gt; #include &lt;chaiscript/chaiscript.hpp&gt; std::string greet_name(const std::string&amp; name) { return "hello, " + name; } int main() { chaiscript::ChaiScript chai; //  chaiscript chai.add(chaiscript::fun(&amp;greet_name), "greet"); //    greet //  eval      chai.eval(R"( print(greet("John")); )"); }</span></span></span></span></code> </pre> <br> å¸Œæœ›æ‚¨æˆåŠŸäº†ï¼Œå¹¶ä¸”æ‚¨çœ‹åˆ°äº†å‡½æ•°çš„ç»“æœã€‚ æˆ‘æƒ³ç«‹å³æ³¨æ„ä¸€ä¸ªç»†å¾®å·®åˆ«-å¦‚æœæ‚¨å°†ChaiScriptå¯¹è±¡å£°æ˜ä¸ºé™æ€å¯¹è±¡ï¼Œåˆ™ä¼šé‡åˆ°ä»¤äººä¸æ„‰å¿«çš„è¿è¡Œæ—¶é”™è¯¯ã€‚ è¿™æ˜¯å› ä¸ºè¯¥è¯­è¨€é»˜è®¤æƒ…å†µä¸‹æ”¯æŒå¤šçº¿ç¨‹ï¼Œå¹¶å­˜å‚¨åœ¨å…¶ææ„å‡½æ•°ä¸­è®¿é—®çš„æœ¬åœ°æµå˜é‡ã€‚ ä½†æ˜¯ï¼Œå®ƒä»¬åœ¨è°ƒç”¨é™æ€å®ä¾‹çš„ææ„å‡½æ•°ä¹‹å‰å·²è¢«é”€æ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬é‡åˆ°è®¿é—®å†²çªæˆ–åˆ†æ®µé”™è¯¯é”™è¯¯ã€‚ åŸºäº<a href="https://github.com/ChaiScript/ChaiScript/issues/338">github</a>ä¸Šçš„<a href="https://github.com/ChaiScript/ChaiScript/issues/338">é—®é¢˜</a> ï¼Œæœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†<b><code>#define CHAISCRIPT_NO_THREADS</code></b>æ”¾åœ¨ç¼–è¯‘å™¨è®¾ç½®ä¸­æˆ–åœ¨åŒ…å«åº“æ–‡ä»¶ä¹‹å‰ï¼Œä»è€Œç¦ç”¨å¤šçº¿ç¨‹ã€‚ æ®æˆ‘äº†è§£ï¼Œæ— æ³•ä¿®å¤æ­¤é”™è¯¯ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¯¦ç»†åˆ†æC ++å’ŒChaiScriptä¹‹é—´çš„äº¤äº’ä½œç”¨ã€‚ è¯¥åº“å®šä¹‰äº†ä¸€ä¸ªç‰¹æ®Šçš„æ¨¡æ¿å‡½æ•°<code>fun</code> ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŒ‡å‘å‡½æ•°ï¼Œå‡½å­æˆ–ç±»å˜é‡çš„æŒ‡é’ˆï¼Œç„¶åè¿”å›ä¸€ä¸ªå­˜å‚¨çŠ¶æ€çš„ç‰¹æ®Šå¯¹è±¡ã€‚ ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬ç”¨C ++ä»£ç å®šä¹‰Widgetç±»ï¼Œå¹¶å°è¯•ä»¥ä¸åŒçš„æ–¹å¼å°†å…¶ä¸ChaiScriptå…³è”ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Widget(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id) : Id(id) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Id; } }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Widget&amp; w)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"widget #"</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::to_string(w.GetId()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ chaiscript::ChaiScript chai; <span class="hljs-function"><span class="hljs-function">Widget </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">w</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  Widget  C++  chai.add(chaiscript::fun([&amp;w] { return w; }), "get_widget"); //         chai.add(chaiscript::fun(ToString), "to_string"); //   chai.add(chaiscript::fun(&amp;Widget::GetId), "get_id"); //   //    ,   Widget    GetId,    to_string,    chai.eval(R"( var w = get_widget() print(w.get_id) //  2 print(w) //  widget #2 )"); }</span></span></code> </pre><br> å¦‚æ‚¨æ‰€è§ï¼ŒChaiScriptåœ¨å®ƒæœªçŸ¥çš„C ++ç±»ä¸­å¯ä»¥å®Œå…¨å¹³é™åœ°å·¥ä½œï¼Œå¹¶ä¸”å¯ä»¥è°ƒç”¨å…¶æ–¹æ³•ã€‚ å¦‚æœæ‚¨åœ¨ä»£ç ä¸­çš„æŸä¸ªåœ°æ–¹çŠ¯äº†ä¸€ä¸ªé”™è¯¯ï¼Œåˆ™è„šæœ¬å¾ˆå¯èƒ½ä¼š<code>error in function dispatch</code>æŠ›å‡ºå¼‚å¸¸ç±»å‹çš„å¼‚å¸¸ï¼Œè¿™ä¸€ç‚¹éƒ½ä¸é‡è¦ã€‚ ä½†æ˜¯ï¼Œä¸ä»…å¯ä»¥å¯¼å…¥å‡½æ•°ï¼Œè€Œä¸”è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¯¥åº“å‘è„šæœ¬æ·»åŠ å˜é‡ã€‚ ä¸ºæ­¤ï¼Œè¯·æ›´éš¾é€‰æ‹©ä»»åŠ¡-import std :: vector &lt;Widget&gt;ã€‚  <code>chaiscript::var</code>å‡½æ•°å’Œ<code>add_global</code>æ–¹æ³•å°†å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸€é—®é¢˜ã€‚ æˆ‘ä»¬è¿˜å°†<code>Data</code> publicå­—æ®µæ·»åŠ åˆ°Widgetä¸­ï¼Œä»¥äº†è§£å¦‚ä½•å¯¼å…¥classå­—æ®µï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Data = <span class="hljs-number"><span class="hljs-number">0</span></span>; Widget(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> : Id(id) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Id; } }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Widget&amp; w)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"widget #"</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::to_string(w.GetId()) + <span class="hljs-string"><span class="hljs-string">" with data: "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::to_string(w.Data); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ chaiscript::ChaiScript chai; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Widget&gt; W; <span class="hljs-comment"><span class="hljs-comment">//    Widget W.emplace_back(1); W.emplace_back(2); W.emplace_back(3); chai.add(chaiscript::fund(ToString), "to_string"); chai.add(chaiscript::fun(&amp;Widget::Data), "data"); //     //     ChaiScript chai.add_global(chaiscript::var(std::ref(W)), "widgets"); //     std::ref chai.add(chaiscript::fun(&amp;std::vector&lt;Widget&gt;::size), "size"); //   // .        using IndexFuncType = Widget&amp; (std::vector&lt;Widget&gt;::*)(const size_t); chai.add(chaiscript::fun(IndexFuncType(&amp;std::vector&lt;Widget&gt;::operator[])), "[]"); chai.eval(R"( for(var i = 0; i &lt; vec.size; ++i) { vec[i].data = i * 2; print(vec[i]) } )"); }</span></span></code> </pre><br> ä¸Šé¢çš„ä»£ç æ˜¾ç¤ºï¼š <b><code>widget #1 with data: 0</code> <code>widget #2 with data: 2</code> <code>widget #3 with data: 4</code> <code>widget #2 with data: 2</code> ï¼Œ <code>widget #3 with data: 4</code></b> ã€‚ æˆ‘ä»¬åœ¨ChaiScriptä¸­æ·»åŠ äº†ä¸€ä¸ªæŒ‡å‘classå­—æ®µçš„æŒ‡é’ˆï¼Œå¹¶ä¸”ç”±äºè¯¥å­—æ®µåŸæ¥æ˜¯åŸå§‹ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬æ›´æ”¹å…¶å€¼ã€‚ æ­¤å¤–ï¼Œè¿˜æ·»åŠ äº†å‡ ç§æ–¹æ³•æ¥ä½¿ç”¨<code>std::vector</code> ï¼ŒåŒ…æ‹¬<code>operator[]</code> ã€‚ é‚£äº›ç†Ÿæ‚‰STLçš„äººçŸ¥é“<code>std::vector</code>ä¸¤ç§ç´¢å¼•æ–¹æ³•-ä¸€ç§è¿”å›å¸¸é‡é“¾æ¥ï¼Œå¦ä¸€ç§è¿”å›ç®€å•é“¾æ¥ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯¹äºé‡è½½çš„å‡½æ•°ï¼Œå¿…é¡»æ˜¾å¼æŒ‡ç¤ºå…¶ç±»å‹-å¦åˆ™ä¼šå¼•èµ·æ­§ä¹‰ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨å°†å¼•å‘é”™è¯¯ã€‚ <br><br> è¯¥åº“æä¾›äº†æ›´å¤šçš„æ·»åŠ å¯¹è±¡çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä»¬å‡ ä¹éƒ½æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤æˆ‘çœ‹ä¸åˆ°è¯¦ç»†è€ƒè™‘å®ƒä»¬çš„æ„ä¹‰ã€‚ ä½œä¸ºä¸€ä¸ªå°æç¤ºï¼Œä¸‹é¢æ˜¯ä¸‹é¢çš„ä»£ç ï¼š <br><br><pre> <code class="cpp hljs">chai.add(chaiscript::var(x), <span class="hljs-string"><span class="hljs-string">"x"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// x   ChaiScript chai.add(chaiscript::var(std::ref(x), "x"); //  ,    C++  ChaiScript auto shared_x = std::make_shared&lt;int&gt;(5); chai.add(chaiscript::var(shared_x), "x"); // shared_ptr      C++  ChaiScript chai.add(chaiscript::const_var(x), "x"); //   ChaiScript    chai.add_global_const(chaiscript::const_var(x), "x"); // global const . ,  x   chai.add_global(chaiscript::var(x), "x"); // global , .  x   chai.set_global(chaiscript::var(x), "x"); //   global ,    const</span></span></code> </pre><br><h4> ä½¿ç”¨STLå®¹å™¨ </h4><br> å¦‚æœè¦å°†åŒ…å«<b>åŸå§‹</b>ç±»å‹çš„STLå®¹å™¨ä¼ é€’ç»™ChaiScriptï¼Œå¯ä»¥å°†æ¨¡æ¿å®¹å™¨å®ä¾‹åŒ–æ·»åŠ åˆ°è„šæœ¬ä¸­ï¼Œè¿™æ ·å°±ä¸å¿…ä¸ºæ¯ç§ç±»å‹å¯¼å…¥æ–¹æ³•ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> MyVector = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::pair&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;&gt;; MyVector V; V.emplace_back(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"John"</span></span>); V.emplace_back(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"Bob"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    - vector  pair chai.add(chaiscript::bootstrap::standard_library::vector_type&lt;MyVector&gt;("MyVec")); chai.add(chaiscript::bootstrap::standard_library::pair_type&lt;MyVector::value_type&gt;("MyVecData")); chai.add(chaiscript::var(std::ref(V)), "vec"); chai.eval(R"( for(var i = 0; i &lt; vec.size; ++i) { print(to_string(vec[i].first) + " " + vec[i].second) } )");</span></span></code> </pre> <br>       ChaiScript,     .  ,        STL-,       .   c <code>std::vector&lt;Widget&gt;</code> ,  , ,   ChaiScript        <code>vector_type</code> ,    Widget  . <br><br><h4> ++   ChaiScript </h4><br>            ChaiScript,      .  ,   .      Widget      WindowWidget,         ,       : <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Widget(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id) : Id(id) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Id; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WindowWidget</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Widget { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::pair&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; Size; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: WindowWidget(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> height) : Widget(id), Size(width, height) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Size.first; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Size.second; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ chaiscript::ChaiScript chai; <span class="hljs-comment"><span class="hljs-comment">//   Widget    chai.add(chaiscript::user_type&lt;Widget&gt;(), "Widget"); chai.add(chaiscript::constructor&lt;Widget(int)&gt;(), "Widget"); //   WindowWidget    chai.add(chaiscript::user_type&lt;WindowWidget&gt;(), "WindowWidget"); chai.add(chaiscript::constructor&lt;WindowWidget(int, int, int)&gt;(), "WindowWidget"); // ,  Widget -    WindowWidget chai.add(chaiscript::base_class&lt;Widget, WindowWidget&gt;()); //   Widget  WindowWidget chai.add(chaiscript::fun(&amp;Widget::GetId), "get_id"); chai.add(chaiscript::fun(&amp;WindowWidget::GetWidth), "width"); chai.add(chaiscript::fun(&amp;WindowWidget::GetHeight), "height"); //  WindowWidget     chai.eval(R"( var window = WindowWidget(1, 800, 600) print("${window.width} * ${window.height}") print("widget.id is ${window.get_id}") )"); }</span></span></code> </pre><br>    ChaiScript  ,    C++  ,     .   -          (,      ),      ,          <code>std::vector&lt;Widget&gt;</code> . <br><br><h4>        </h4><br>              .     ChaiScript    ,   ,        : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Widget </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">w</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; w.Data = <span class="hljs-number"><span class="hljs-number">4444</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  Widget w chai.add(chaiscript::fun(&amp;Widget::GetId, &amp;w), "widget_id"); chai.add(chaiscript::fun(&amp;Widget::Data, &amp;w), "widget_data"); chai.eval(R"( print(widget_id) print(widget_data) )");</span></span></code> </pre><br>     Â«Â»   C++  ChaiScript ( , vec3, complex, matrix)          .  ChaiScript      <code>type_conversion</code>   .     Complex    int  double    : <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Complex</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Re, Im; Complex(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> re, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> im = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>) : Re(re), Im(im) { } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ chaiscript::ChaiScript chai; <span class="hljs-comment"><span class="hljs-comment">//  Complex,   re, im,    `=` chai.add(chaiscript::user_type&lt;Complex&gt;(), "Complex"); chai.add(chaiscript::bootstrap::standard_library::assignable_type&lt;Complex&gt;("Complex")); chai.add(chaiscript::constructor&lt;Complex(float, float)&gt;(), "Complex"); chai.add(chaiscript::fun(&amp;Complex::Re), "re"); chai.add(chaiscript::fun(&amp;Complex::Im), "im"); //     double  int  Complex chai.add(chaiscript::type_conversion&lt;int, Complex&gt;()); chai.add(chaiscript::type_conversion&lt;double, Complex&gt;()); //     `+`    chai.eval(R"( def `+`(Complex c, x) { var res = Complex(0, 0) res.re = c.re + x.re res.im = c.im + x.im return res } var c = Complex(1, 2) c = c + 3 print("${c.re} + ${c.im}i") )"); // : `4 + 2i` }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ²¡æœ‰å¿…è¦ç”¨C ++æœ¬èº«ç¼–å†™è½¬æ¢å‡½æ•°ï¼Œåªéœ€å°†å…¶å¯¼å‡ºåˆ°ChaiScriptã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥æ·»åŠ è½¬æ¢ï¼Œå¹¶ä¸”å·²ç»åœ¨è„šæœ¬ä»£ç æœ¬èº«ä¸­æè¿°äº†æ–°åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">å¦‚æœä¸¤ç§ç±»å‹çš„è½¬æ¢å¾ˆç®€å•ï¼Œåˆ™å¯ä»¥å°†lambdaä½œä¸ºå‚æ•°ä¼ é€’ç»™function </font></font><code>type_conversion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æŠ•å°„æ—¶ä¼šè¢«è°ƒç”¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ç±»ä¼¼çš„åŸç†å°†Vectoræˆ–Map ChaiScriptè½¬æ¢ä¸ºæ‚¨çš„è‡ªå®šä¹‰ç±»å‹ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œåœ¨åº“</font></font><code>vector_conversion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­</font><font style="vertical-align: inherit;">å®šä¹‰äº†</font></font><code>map_conversion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è§£å‹ç¼©ChaiScriptè¿”å›å€¼ </font></font></h4><br>  <code>eval</code>  <code>eval_file</code>         <code>Boxed_Value</code> .         C++,        ,     <code>boxed_cast&lt;T&gt;</code> .     ,   ,    <code>bad_boxed_cast</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//       double d = chai.eval&lt;double&gt;("5.3 + 2.1"); //     Boxed_Value,     auto v = chai.eval("5.3 + 2.1"); double d = chai.boxed_cast&lt;double&gt;(v);</span></span></code> </pre><br>      ChaiScript    shared_ptr,            .      shared_ptr    : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> x = chai.eval&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;&gt;(<span class="hljs-string"><span class="hljs-string">"var x = 3.2"</span></span>);</code> </pre><br> ,        shared_ptr,     access violation  ,           . <br><br>     ,     ChaiScript     ,    ChaiScript.  ,      Complex           : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> printComplex = chai.eval&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::function&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>(Complex)&gt;&gt;(<span class="hljs-string"><span class="hljs-string">R"( fun(Complex c) { print("${c.re} + ${c.im}i"); } )"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,   ,      C++ printComplex(Complex(2, 3)); //  chaiscript,  `2 + 3i`</span></span></code> </pre><br><h4>    ChaiScript </h4><br>        ,    .  <code>eval_error</code>    , <code>bad_boxed_cast</code> ,        <code>std::exception</code>   .        ,        ++: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyException</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Data; MyException(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> data) : <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception(<span class="hljs-string"><span class="hljs-string">"MyException"</span></span>), Data(data) { } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ chaiscript::ChaiScript chai; <span class="hljs-comment"><span class="hljs-comment">//      chaiscript chai.add(chaiscript::user_type&lt;MyException&gt;(), "MyException"); chai.add(chaiscript::constructor&lt;MyException(int)&gt;(), "MyException"); try { //          chai.eval("throw(MyException(11111))", chaiscript::exception_specification&lt;MyException, std::exception&gt;()); } catch (MyException&amp; e) { std::cerr &lt;&lt; e.Data; //   `11111` } catch (chaiscript::exception::eval_error&amp; e) { std::cerr &lt;&lt; e.pretty_print(); } catch(std::exception&amp; e) { std::cerr &lt;&lt; e.what(); } }</span></span></code> </pre><br>    ,       C++.   <code>pretty_print</code> ,  <code>eval_error</code>     ,    ,  ,  ,              . <br><br><h4>  ChaiScript </h4><br>  ,   ChaiScript       .  ,     , -,  .         -    <a href="https://github.com/ChaiScript/ChaiScript_Extras">ChaiScript Extras</a> ,      .     <b>math</b>   acos(x): <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;chaiscript/chaiscript.hpp&gt; #include &lt;chaiscript/extras/math.hpp&gt; int main() { chaiscript::ChaiScript chai; //   auto mathlib = chaiscript::extras::math::bootstrap(); chai.add(mathlib); std::cout &lt;&lt; chai.eval&lt;double&gt;("acos(0.5)"); // ~1.047 }</span></span></span></span></code> </pre><br>           .    ,       math     .  ,     C++    ,   ,      . <br><a name="myexp"></a><br><h2>   </h2><br>      3D-  OpenGL    ,          ,         .      <a href="https://github.com/MomoDeve/MSL"></a> , ,  , Â«    Â»,      . <br><br>      ,  ChaiScript      ,         Lua.      ,        ,       :  ,         C++  C,      -  C-style . ,        ,     . <br><br>        ,         .            ImGui,     chaiscript.               ,   : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      3D-: // rotation CHAI_IMPORT(&amp;GLInstance::RotateX, rotate_x); CHAI_IMPORT(&amp;GLInstance::RotateY, rotate_y); CHAI_IMPORT(&amp;GLInstance::RotateZ, rotate_z); // scale CHAI_IMPORT((GLInstance&amp;(GLInstance::*)(float))&amp;GLInstance::Scale, scale); CHAI_IMPORT((GLInstance&amp;(GLInstance::*)(float, float, float))&amp;GLInstance::Scale, scale); // translation CHAI_IMPORT(&amp;GLInstance::Translate, translate); CHAI_IMPORT(&amp;GLInstance::TranslateX, translate_x); CHAI_IMPORT(&amp;GLInstance::TranslateY, translate_y); CHAI_IMPORT(&amp;GLInstance::TranslateZ, translate_z); // hide / show CHAI_IMPORT(&amp;GLInstance::Hide, hide); CHAI_IMPORT(&amp;GLInstance::Show, show); // getters CHAI_IMPORT(&amp;GLInstance::GetTranslation, translation); CHAI_IMPORT(&amp;GLInstance::GetRotation, rotation); CHAI_IMPORT(&amp;GLInstance::GetScale, scale);</span></span></code> </pre><br>       ,      -,     .        : <br><br><img src="https://habrastorage.org/webt/rl/bo/td/rlbotdpcfl4pdpbplwxfrvsk73i.png" alt="å›¾ç‰‡"><br> <i>  chaiscript  ImGui:      </i> <br><br>     ,            . , Lua      ,       ,          (JIT     ),     ChaiScript    .      ,    ,      . <br><br>         .           C++ (  Lua   ),         ChaiScript    .         .    . <br><br><h4>   </h4><br><ul><li>   ChaiScript: <a href="http://chaiscript.com/">chaiscript.com</a> </li><li>      : <a href="">ChaiScript cheatsheet</a> </li><li>  : <a href="https://codedocs.xyz/ChaiScript/ChaiScript/">codedocs.xyz/ChaiScript/ChaiScript</a> </li><li>     ChaiScript: <a href="https://github.com/MomoDeve/MomoEngine">github.com/MomoDeve/MomoEngine</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483540/">https://habr.com/ru/post/zh-CN483540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483528/index.html">REST APIå¿…é¡»åŸºäºè¶…æ–‡æœ¬</a></li>
<li><a href="../zh-CN483530/index.html">æˆ‘ä»¬å¦‚ä½•è¿›è¡Œæ£‹ç›˜æ¸¸æˆã€‚ ä¸ºä»€ä¹ˆå’Œä¸ºä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN483532/index.html">DefCon 27ä¼šè®®ï¼šåˆ›å»ºç”µå­å¾½ç« çš„å¹•åèŠ±çµ® ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN483536/index.html">å¾®å¤„ç†å™¨å’Œä¸ªäººè®¡ç®—æœºçš„å†å²ï¼š1974å¹´-1980å¹´</a></li>
<li><a href="../zh-CN483538/index.html">é€šè¿‡FMCå°†10â€œ ER-TFT101-1æ˜¾ç¤ºå™¨è¿æ¥åˆ°STM32F429</a></li>
<li><a href="../zh-CN483542/index.html">ç”µä¿¡æ‘˜è¦-æœ‰å…³æä¾›å•†å·¥ä½œçš„ææ–™</a></li>
<li><a href="../zh-CN483544/index.html">æ–°æ•°æ®é©³æ–¥äº†æš—èƒ½é‡çš„å…³é”®å‡è®¾</a></li>
<li><a href="../zh-CN483550/index.html">æœåŠ¡å’ŒIaaSå¼€å‘ï¼šäº‘ï¼Œæ•°æ®å­˜å‚¨å’Œ1cloud Evolutionçš„æ±‡ç¼–</a></li>
<li><a href="../zh-CN483552/index.html">MVVMå’Œé€‚é…å™¨ä¸­çš„å…ƒç´ é€‰æ‹©</a></li>
<li><a href="../zh-CN483554/index.html">20å¹´ä»£çš„æ–°æŠ€æœ¯å¹³å°ã€‚ ä¸ºä»€ä¹ˆæˆ‘ä¸åŒæ„æ‰å…‹ä¼¯æ ¼</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>