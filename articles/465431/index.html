<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   An谩lisis del c贸digo fuente RPC del framework Apache Dubbo con el analizador est谩tico PVS-Studio 憋  </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apache Dubbo es uno de los proyectos Java m谩s populares en GitHub. Y esto no es sorprendente. Fue creado hace 8 a帽os y es ampliamente utilizado como u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>An谩lisis del c贸digo fuente RPC del framework Apache Dubbo con el analizador est谩tico PVS-Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/465431/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f9/27c/6fa/0f927c6fa660b245e4b2d6de304356d5.png" alt="Imagen 2"></div><br>  Apache Dubbo es uno de los proyectos Java m谩s populares en GitHub.  Y esto no es sorprendente.  Fue creado hace 8 a帽os y es ampliamente utilizado como un entorno RPC de alto rendimiento.  Por supuesto, la mayor铆a de los errores en su c贸digo se han corregido durante mucho tiempo y la calidad del c贸digo se mantiene a un alto nivel.  Sin embargo, no hay raz贸n para negarse a verificar un proyecto tan interesante utilizando el analizador de c贸digo est谩tico PVS-Studio.  Veamos qu茅 logramos encontrar. <br><a name="habracut"></a><br><h2>  Sobre PVS-Studio </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El</a> analizador de c贸digo est谩tico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PVS-Studio</a> ha existido durante m谩s de 10 a帽os en el mercado de TI y es una soluci贸n de software multifuncional y f谩cil de implementar.  Por el momento, el analizador admite C, C ++, C #, lenguajes Java y funciona en plataformas Windows, Linux y macOS. <br><br>  PVS-Studio es una soluci贸n B2B pagada y es utilizada por una gran cantidad de equipos en varias compa帽铆as.  Si desea evaluar las capacidades del analizador, descargue el kit de distribuci贸n y solicite una clave de prueba <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu铆</a> . <br><br>  Tambi茅n hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">opciones para</a> usar PVS-Studio gratis en proyectos de c贸digo abierto o si eres un estudiante. <br><br><h2>  Apache Dubbo: 驴qu茅 es y qu茅 come? </h2><br>  Actualmente, casi todos los grandes sistemas de software est谩n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">distribuidos</a> .  Si en un sistema distribuido hay una conexi贸n interactiva entre componentes remotos con un tiempo de respuesta corto y una cantidad relativamente peque帽a de datos transmitidos, esta es una buena raz贸n para usar el entorno <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RPC</a> (llamada a procedimiento remoto). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apache Dubbo</a> es un entorno <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RPC</a> (llamada a procedimiento remoto) basado en Java de c贸digo abierto y alto rendimiento.  Al igual que con muchos sistemas RPC, dubbo se basa en la idea de crear un servicio para definir m茅todos que se puedan llamar de forma remota con sus par谩metros y tipos de datos de retorno.  En el lado del servidor, se implementa una interfaz y se inicia el servidor dubbo para procesar las llamadas de los clientes.  Hay un trozo en el lado del cliente que proporciona los mismos m茅todos que el servidor.  Dubbo ofrece tres caracter铆sticas clave que incluyen llamadas remotas frontales, tolerancia a fallas y equilibrio de carga, as铆 como registro autom谩tico y descubrimiento de servicios. <br><br><h2>  Sobre el an谩lisis </h2><br>  La secuencia de pasos para el an谩lisis es bastante simple y no requiere mucho tiempo: <br><br><ul><li>  Tengo Apache Dubbo con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> ; </li><li>  Us茅 las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones</a> para iniciar el analizador Java y comenc茅 el an谩lisis; </li><li>  Recib铆 un informe del analizador, lo analic茅 y destaqu茅 casos interesantes. </li></ul><br>  Resultados del an谩lisis: se emitieron 73 advertencias de los niveles de confianza Alto y Medio (46 y 27, respectivamente) para m谩s de 4000 archivos, lo que es un buen indicador de la calidad del c贸digo. <br><br>  No todas las advertencias son errores.  Esta es una situaci贸n normal y, antes del uso regular del analizador, se requiere su configuraci贸n.  Entonces podemos esperar un porcentaje bastante bajo de falsos positivos ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplo</a> ). <br><br>  Entre las advertencias, no se consideraron 9 advertencias (7 altas y 2 medias) por archivos de prueba. <br><br>  Como resultado, se mantuvo una peque帽a cantidad de advertencias, pero entre ellas tambi茅n hubo falsos positivos, ya que no configur茅 el analizador.  Ordenar 73 advertencias en un art铆culo es una tarea larga, tonta y tediosa, por lo que se seleccionaron las m谩s interesantes. <br><br><h2>  Byte firmado en Java </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6007 La</a> expresi贸n 'endKey [i] &lt;0xff' siempre es verdadera.  Opci贸nUtil.java (32) <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> ByteSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prefixEndOf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ByteSequence prefix)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] endKey = prefix.getBytes().clone(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = endKey.length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; i--) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (endKey[i] &lt; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= endKey[i] = (byte) (endKey[i] + 1); return ByteSequence.from(Arrays.copyOf(endKey, i + 1)); } } return ByteSequence.from(NO_PREFIX_END); }</span></span></code> </pre> <br>  Un valor de tipo <i>byte</i> (un valor de -128 a 127) se compara con un valor de 0xff (255).  En esta condici贸n, no se tiene en cuenta que el tipo de <i>byte</i> en Java es significativo, por lo tanto, la condici贸n siempre se cumplir谩, lo que significa que no tiene sentido. <br><br><h2>  Devuelve el mismo valor </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6007 La</a> expresi贸n 'isPreferIPV6Address ()' siempre es falsa.  NetUtils.java (236) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Optional&lt;InetAddress&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toValidAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InetAddress address)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (address <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Inet6Address) { Inet6Address v6Address = (Inet6Address) address; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isPreferIPV6Address()) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= return Optional.ofNullable(normalizeV6Address(v6Address)); } } if (isValidV4Address(address)) { return Optional.of(address); } return Optional.empty(); }</span></span></code> </pre> <br>  <i>IsPreferIPV6</i> M茅todo de direcci贸n. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPreferIPV6Address</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> preferIpv6 = Boolean.getBoolean(<span class="hljs-string"><span class="hljs-string">"java.net.preferIPv6Addresses"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!preferIpv6) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } return false; // &lt;= }</span></span></code> </pre> <br>  El m茅todo <i>isPreferIPV6Address</i> devuelve <i>falso</i> en ambos casos, lo m谩s probable es que uno de los casos deber铆a haber devuelto <i>verdadero</i> seg煤n lo previsto por el programador, de lo contrario, el m茅todo no tiene sentido. <br><br><h2>  Verificaciones sin sentido </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6007 La</a> expresi贸n '! M谩scara [i] .equals (ipAddress [i])' siempre es verdadera.  NetUtils.java (476) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matchIpRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UnknownHostException </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; mask.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"*"</span></span>.equals(mask[i]) || mask[i].equals(ipAddress[i])) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask[i].contains(<span class="hljs-string"><span class="hljs-string">"-"</span></span>)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mask[i].equals(ipAddress[i])) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= return false; } } return true; }</span></span></code> </pre> <br>  En la primera de las condiciones if-else-if, se produce una comprobaci贸n <i>"*". Igual (m谩scara [i]) ||</i>  <i>mask [i] .equals (ipAddress [i])</i> . Si no se cumple esta condici贸n, el c贸digo pasa a la siguiente verificaci贸n en if-else-if, y nos damos cuenta de que <i>mask [i]</i> e <i>ipAddress [i]</i> no <i>son</i> equivalentes.  Pero una de las siguientes comprobaciones en if-else-if solo comprueba que <i>mask [i]</i> e <i>ipAddress [i]</i> no <i>son</i> equivalentes.  Como la <i>m谩scara [i]</i> y <i>ipAddress [i]</i> no <i>tienen</i> asignado ning煤n valor en el c贸digo del m茅todo, la segunda verificaci贸n no tiene sentido. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6007 La</a> expresi贸n 'message.length&gt; 0' siempre es verdadera.  DeprecatedTelnetCodec.java (302) <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6007</a> Expresi贸n 'mensaje! = Nulo' siempre es verdadero.  DeprecatedTelnetCodec.java (302) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(.... , </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] message)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || message.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NEED_MORE_INPUT; } .... <span class="hljs-comment"><span class="hljs-comment">//   message  ! .... if (....) { String value = history.get(index); if (value != null) { byte[] b1 = value.getBytes(); if (message != null &amp;&amp; message.length &gt; 0) { // &lt;= byte[] b2 = new byte[b1.length + message.length]; System.arraycopy(b1, 0, b2, 0, b1.length); System.arraycopy(message, 0, b2, b1.length, message.length); message = b2; } else { message = b1; } } } .... }</span></span></code> </pre> <br>  Comprobando <i>mensaje! = Nulo &amp;&amp; mensaje.length&gt; 0</i> en la l铆nea 302 no tiene sentido.  Antes de la verificaci贸n, la l铆nea 302 verifica: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || message.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NEED_MORE_INPUT; }</code> </pre> <br>  Si no se cumple la condici贸n de verificaci贸n, sabremos que el <i>mensaje</i> no <i>es</i> <i>nulo</i> y su longitud no es 0. De esta informaci贸n se deduce que su longitud es mayor que cero (ya que la <i>longitud de la</i> cadena no puede ser un n煤mero negativo).  El <i>mensaje de la</i> variable local antes de la l铆nea 302 no tiene asignado ning煤n valor, lo que significa que en la l铆nea 302 se usa el valor de la variable del <i>mensaje</i> , como en el c贸digo anterior.  De todo esto podemos concluir que la expresi贸n <i>message! = Null &amp;&amp; message.length&gt; 0</i> siempre ser谩 <i>verdadera</i> , lo que significa que el c贸digo en el bloque <i>else</i> nunca se ejecutar谩. <br><br><h2>  Establecer el valor de un campo de referencia no inicializado </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6007 La</a> expresi贸n '! ShouldExport ()' siempre es falsa.  ServiceConfig.java (371) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">export</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ checkAndUpdateSubConfigs(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!shouldExport()) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= return; } if (shouldDelay()) { .... } else { doExport(); }</span></span></code> </pre> <br>  El m茅todo <i>shouldExport</i> de la clase <i>ServiceConfig</i> llama al m茅todo <i>getExport</i> definido en la misma clase. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldExport</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Boolean export = getExport(); <span class="hljs-comment"><span class="hljs-comment">// default value is true return export == null ? true : export; } .... @Override public Boolean getExport() { return (export == null &amp;&amp; provider != null) ? provider.getExport() : export; }</span></span></code> </pre> <br>  El m茅todo <i>getExport</i> llama al m茅todo <i>getExport</i> de la clase abstracta <i>AbstractServiceConfig</i> , que devuelve el valor del campo de <i>exportaci贸n</i> de tipo <i>Boolean</i> .  Tambi茅n hay un m茅todo <i>setExport</i> para establecer el valor de un campo. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Boolean export; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getExport</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> export; } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setExport</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Boolean export)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.export = export; }</code> </pre> <br>  El campo de <i>exportaci贸n</i> en el c贸digo se establece solo mediante el m茅todo <i>setExport</i> .  El m茅todo <i>setExport se</i> llama solo en el m茅todo de <i>compilaci贸n</i> de la clase abstracta AbstractServiceBuilder (que extiende <i>AbstractServiceConfig</i> ) y solo si el campo de exportaci贸n no es nulo. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T instance)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (export != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { instance.setExport(export); } .... }</code> </pre> <br>  Debido al hecho de que todos los campos de referencia se inicializan como <i>nulos</i> de forma predeterminada y que al campo de <i>exportaci贸n</i> no se le ha asignado ning煤n valor en ninguna parte del c贸digo, nunca se llamar谩 al m茅todo <i>setExport</i> . <br><br>  Como resultado, el m茅todo <i>getExport</i> de la clase <i>ServiceConfig que</i> extiende la clase <i>AbstractServiceConfig</i> siempre devolver谩 <i>nulo</i> .  El valor devuelto se utiliza en el m茅todo <i>shouldExport</i> de la clase <i>ServiceConfig</i> , por lo que el m茅todo <i>shouldExport</i> siempre devolver谩 <i>verdadero</i> .  Debido a que devuelve verdadero, el valor de la expresi贸n <i>! ShouldExport ()</i> siempre ser谩 falso.  Resulta que nunca habr谩 un retorno del m茅todo de <i>exportaci贸n</i> de la clase <i>ServiceConfig</i> antes de la ejecuci贸n del c贸digo: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (shouldDelay()) { DELAY_EXPORT_EXECUTOR.schedule(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::doExport, getDelay(), ....); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { doExport(); }</code> </pre> <br><h2>  Valor de par谩metro no negativo </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6009</a> La funci贸n 'subcadena' podr铆a recibir el valor '-1' mientras se espera un valor no negativo.  Inspeccionar argumento: 2. AbstractEtcdClient.java (169) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createParentIfAbsent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String fixedPath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = fixedPath.lastIndexOf(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { String parentPath = fixedPath.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (categories.stream().anyMatch(c -&gt; fixedPath.endsWith(c))) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!checkExists(parentPath)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.doCreatePersistent(parentPath); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (categories.stream().anyMatch(c -&gt; parentPath.endsWith(c))) { String grandfather = parentPath .substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, parentPath.lastIndexOf(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (!checkExists(grandfather)) { this.doCreatePersistent(grandfather); } } } }</span></span></code> </pre> <br>  El resultado de la funci贸n <i>lastIndexOf</i> se pasa por el segundo par谩metro a la funci贸n de <i>subcadena</i> , cuyo segundo par谩metro no debe ser un n煤mero negativo, aunque <i>lastIndexOf</i> puede devolver <i>-1</i> si no encuentra el valor en la cadena.  Si el segundo par谩metro del m茅todo de <i>subcadena</i> es menor que el primero (-1 &lt;0), se <i>generar谩</i> una <i>StringIndexOutOfBoundsException</i> .  Para corregir el error, debe verificar el resultado devuelto por la funci贸n <i>lastIndexOf</i> , y si es correcto (al menos no negativo), luego pasarlo a la funci贸n de <i>subcadena</i> . <br><br><h2>  Contador de ciclos no utilizado </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6016</a> Acceso sospechoso al elemento del objeto 'tipos' por un 铆ndice constante dentro de un bucle.  RpcUtils.java (153) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Class&lt;?&gt;[] getParameterTypes(Invocation invocation) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($INVOKE.equals(invocation.getMethodName()) &amp;&amp; invocation.getArguments() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; invocation.getArguments().length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; invocation.getArguments()[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> String[]) { String[] types = (String[]) invocation.getArguments()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (types == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class&lt;?&gt;[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } Class&lt;?&gt;[] parameterTypes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class&lt;?&gt;[types.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; types.length; i++) { parameterTypes[i] = ReflectUtils.forName(types[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } return parameterTypes; } return invocation.getParameterTypes(); }</span></span></code> </pre> <br>  El bucle <i>for</i> utiliza el 铆ndice constante <i>0</i> para referirse al elemento de la matriz de <i>tipos</i> .  Quiz谩s estaba destinado a usar la variable <i>i</i> como 铆ndice para acceder a los elementos de la matriz, pero no pasaron por alto, como dicen. <br><br><h2>  Hacer tiempo sin sentido </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6019</a> C贸digo inalcanzable detectado.  Es posible que haya un error presente.  GrizzlyCodecAdapter.java (136) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> NextAction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FilterChainContext context)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { savedReadIndex = frame.readerIndex(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { msg = codec.decode(channel, frame); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { previousData = ChannelBuffers.EMPTY_BUFFER; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(e.getMessage(), e); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (msg == Codec2.DecodeResult.NEED_MORE_INPUT) { frame.readerIndex(savedReadIndex); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getStopAction(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (savedReadIndex == frame.readerIndex()) { previousData = ChannelBuffers.EMPTY_BUFFER; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"Decode without read data."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (msg != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { context.setMessage(msg); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getInvokeAction(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getInvokeAction(); } } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (frame.readable()); <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  La expresi贸n en la condici贸n de bucle <i>do</i> - <i>while (frame.readable ())</i> es un c贸digo inalcanzable, ya que la primera iteraci贸n del bucle siempre sale del m茅todo.  En el cuerpo del bucle, se realizan varias comprobaciones de la variable <i>msg</i> utilizando if-else, y tanto en <i>if</i> como en <i>else</i> siempre devuelven un valor del m茅todo o arrojan una excepci贸n.  Es por esto que el cuerpo del ciclo se ejecutar谩 solo una vez, como resultado, usar el ciclo do-while no tiene sentido. <br><br><h2>  Copiar y pegar en el interruptor </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V6067</a> Dos o m谩s ramificaciones de casos realizan las mismas acciones.  JVMUtil.java (67), JVMUtil.java (71) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getThreadDumpString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ThreadInfo threadInfo)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; threadInfo.getLockInfo() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { Thread.State ts = threadInfo.getThreadState(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (ts) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BLOCKED: sb.append(<span class="hljs-string"><span class="hljs-string">"\t- blocked on "</span></span> + threadInfo.getLockInfo()); sb.append(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> WAITING: <span class="hljs-comment"><span class="hljs-comment">// &lt;= sb.append("\t- waiting on " + threadInfo.getLockInfo()); // &lt;= sb.append('\n'); // &lt;= break; // &lt;= case TIMED_WAITING: // &lt;= sb.append("\t- waiting on " + threadInfo.getLockInfo()); // &lt;= sb.append('\n'); // &lt;= break; // &lt;= default: } } .... }</span></span></code> </pre> <br>  El c贸digo de <i>cambio</i> para <i>WAITING</i> y <i>TIMED_WAITING</i> contiene un c贸digo de copiar y pegar.  Si realmente necesita hacer lo mismo, puede simplificar el c贸digo eliminando el contenido en el bloque de <i>casos</i> para <i>WAITING</i> .  Como resultado, el mismo c贸digo registrado en una sola copia se ejecutar谩 para <i>WAITING</i> y <i>TIMED_WAITING</i> . <br><br><h2>  Conclusi贸n </h2><br>  Cualquier persona interesada en usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RPC</a> en Java probablemente haya o铆do hablar de Apache Dubbo.  Este es un proyecto de c贸digo abierto popular con una larga historia y c贸digo escrito por muchos desarrolladores.  El c贸digo para este proyecto es de excelente calidad, pero el analizador est谩tico PVS-Studio logr贸 encontrar una serie de errores.  De esto podemos concluir que el an谩lisis est谩tico es muy importante al desarrollar proyectos medianos y grandes, no importa cu谩n perfecto sea su c贸digo. <br><br>  Nota  Estas comprobaciones 煤nicas demuestran las capacidades de un analizador de c贸digo est谩tico, pero son una forma completamente incorrecta de usarlo.  Esta idea se presenta con m谩s detalle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu铆</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu铆</a> .  隆Usa el an谩lisis regularmente! <br><br>  Gracias a los desarrolladores de Apache Dubbo por esta gran herramienta.  Espero que este art铆culo te ayude a mejorar el c贸digo.  El art铆culo no describe todas las secciones sospechosas del c贸digo, por lo que es mejor que los desarrolladores verifiquen el proyecto por su cuenta y eval煤en los resultados. <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  Si desea compartir este art铆culo con una audiencia de habla inglesa, utilice el enlace a la traducci贸n: Valery Komarov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">An谩lisis del marco Apache Dubbo RPC por el analizador de c贸digo est谩tico PVS-Studio</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/465431/">https://habr.com/ru/post/465431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../465419/index.html">Ma帽ana en la Universidad ITMO: el proceso educativo, las competiciones y la educaci贸n en el extranjero: una selecci贸n de los pr贸ximos eventos</a></li>
<li><a href="../465423/index.html">Fabricaci贸n inteligente e industria 4.0: tres tendencias tecnol贸gicas principales</a></li>
<li><a href="../465425/index.html">Vepp: el nuevo servidor de ISPsystem y el panel de control del sitio web</a></li>
<li><a href="../465427/index.html">An谩lisis del marco Apache Dubbo RPC por el analizador de c贸digo est谩tico PVS-Studio</a></li>
<li><a href="../465429/index.html">Sin embargo, C es un lenguaje de bajo nivel.</a></li>
<li><a href="../465433/index.html">Robots de trabajo - hombre feliz</a></li>
<li><a href="../465435/index.html">驴Qu茅 distribuci贸n es mejor para su sistema integrado?</a></li>
<li><a href="../465437/index.html">Por qu茅 me negu茅 a trabajar en AWS</a></li>
<li><a href="../465441/index.html">LuaVela: implementaci贸n de Lua 5.1 basada en LuaJIT 2.0</a></li>
<li><a href="../465445/index.html">Notas del proveedor de IoT. Maldici贸n de salida de impulso</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>