<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’  ğŸ‘§ğŸ» â†•ï¸ VÃ©rification de RBAC dans Kubernetes ğŸ”€ ğŸ˜„ ğŸ‡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SÃ©curiser le cluster Kubernetes est une chose, mais maintenir la sÃ©curitÃ© reste un dÃ©fi. Cependant, de nouveaux outils ont Ã©tÃ© ajoutÃ©s Ã  Kubernetes: i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VÃ©rification de RBAC dans Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/434374/"><p>  SÃ©curiser le cluster Kubernetes est une chose, mais maintenir la sÃ©curitÃ© reste un dÃ©fi.  Cependant, de nouveaux outils ont Ã©tÃ© ajoutÃ©s Ã  Kubernetes: il est dÃ©sormais beaucoup plus facile de faire les deux. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f2c/3a7/e11/f2c3a7e119adbe00cf543fdcb3856c6b.png" alt="image"></p><a name="habracut"></a><br><p>  Kubernetes (Ã  partir de la version 1.6) a introduit le concept de contrÃ´le d'accÃ¨s basÃ© sur les rÃ´les (RBAC), qui permet aux administrateurs de dÃ©finir des politiques de restriction pour les utilisateurs du cluster.  Autrement dit, vous crÃ©ez un utilisateur avec un accÃ¨s limitÃ©: limitez l'accÃ¨s des utilisateurs aux ressources comme les secrets ou Ã  certains espaces de noms. </p><br><p>  Dans cet article, nous ne comprendrons pas comment implÃ©menter RBAC.  Il existe suffisamment de sources dÃ©centes oÃ¹ ce sujet est discutÃ© de et vers: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://medium.com/containerum/configuring-permissions-in-kubernetes-with-rbac-a456a9717d5d</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.cncf.io/blog/2018/08/01/demystifying-rbac-in-kubernetes/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://docs.bitnami.com/kubernetes/how-to/configure-rbac-in-your-kubernetes-cluster/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://kubernetes.io/docs/reference/access-authn-authz/rbac/</a> </li></ul><br><p>  Il est prÃ©fÃ©rable de vous concentrer sur la faÃ§on de vous assurer que les exigences de votre entreprise sont remplies et de voir si les objets RBAC en cours d'exÃ©cution doivent Ãªtre vÃ©rifiÃ©s pour voir s'ils remplissent leurs fonctions. </p><br><h3 id="nash-scenariy">  Notre script </h3><br><p>  Certaines organisations acceptent plusieurs groupes pour travailler avec le nouveau cluster Kubernetes.  Il y a une exigence: vous ne pouvez pas interfÃ©rer dans le dÃ©ploiement d'un groupe voisin, afin qu'il n'y ait pas de problÃ¨mes ou de temps d'arrÃªt intergroupes imprÃ©vus. </p><br><p>  Ainsi, le propriÃ©taire du cluster a dÃ©ployÃ© RBAC dans le cluster, limitant ainsi l'accÃ¨s Ã  un espace de noms spÃ©cifique.  La premiÃ¨re vÃ©rification a montrÃ© que les groupes ne peuvent pas se voir les uns les autres dans l'espace de noms. </p><br><p> Une semaine s'est Ã©coulÃ©e.  Le propriÃ©taire du cluster a remarquÃ© qu'un utilisateur d'un espace de noms isolÃ© lit les secrets d'un autre espace de noms.  Comment Ã§a?  Il a utilisÃ© RBAC! </p><br><p> Je l'ai appliquÃ©, mais, comme pour travailler avec du code, la conformitÃ© du systÃ¨me avec le rÃ©sultat souhaitÃ© doit Ãªtre testÃ©e.  Il est bon que l' <code>kubectl</code> kubectl CLI Kubernetes fournit un ensemble d'outils pour vÃ©rifier la configuration RBAC. <code>kubectl auth can-i</code> </p><br><p>  Puis-je?  ("Puis-je?") <br>  <code>can-i</code> utilisant l'API vÃ©rifie simplement si une certaine action peut Ãªtre effectuÃ©e.  Il utilise les paramÃ¨tres suivants: <code>kubectl auth can-i VERB [TYPE | TYPE/NAME | NONRESOURCEURL]</code> <code>kubectl auth can-i VERB [TYPE | TYPE/NAME | NONRESOURCEURL]</code>  <code>kubectl auth can-i VERB [TYPE | TYPE/NAME | NONRESOURCEURL]</code> .  L'utilisateur actuel peut maintenant vÃ©rifier si une action spÃ©cifique lui est disponible.  C'est parti: </p><br><pre> <code class="plaintext hljs">kubectl auth can-i create pods</code> </pre> <br><p>  Cela devrait retourner une rÃ©ponse Â«ouiÂ» ou Â«nonÂ» avec le code de sortie appropriÃ©. </p><br><p>  Cependant, lorsque nous essayons de vÃ©rifier les droits d'un autre utilisateur, nous rencontrons un problÃ¨me: l'utilisateur sous lequel nous sommes autorisÃ©s dans le cluster est spÃ©cifiÃ© dans le fichier de configuration <code>./kube/config</code> , et il n'est pas pratique d'avoir des configurations distinctes pour tester des utilisateurs individuels.  Heureusement, Kubernetes vient Ã  la rescousse: il est capable de simuler des utilisateurs en utilisant les Ã©tiquettes <code>--as=</code> et <code>--as-group=</code> . </p><br><p>  Mettez Ã  jour la commande, utilisez la simulation d'un autre utilisateur: </p><br><pre> <code class="plaintext hljs">kubectl auth can-i create pods --as=me</code> </pre> <br><p>  Nous devons voir qu'avec le code de sortie <code>1</code> , la rÃ©ponse Â«nonÂ» est retournÃ©e. </p><br><p>  Et c'est formidable, car nous avons maintenant un ensemble de commandes qui nous permettent de vÃ©rifier si un utilisateur ou un groupe d'utilisateurs a accÃ¨s Ã  l'une des ressources de Kubernetes - de l'affichage des pods Ã  la suppression des secrets. </p><br><h3 id="avtomatizaciya">  Automatisation </h3><br><p>  Cependant, il est trop tÃ´t pour arrÃªter: nous pouvons maintenant implÃ©menter une sÃ©quence de test qui dÃ©crira la liste des exigences et l'exÃ©cutera dans le cadre du pipeline de CD.  Pour la cause! </p><br><p>  Il y a beaucoup de choix, il y a suffisamment de langages Ã  implÃ©menter: en commenÃ§ant par Ava et Mocha en JavaScript et en terminant par Rspec.  Dans ce cas, j'implÃ©mente le cadre de test purement Bash <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bats</a> . </p><br><p>  Voici un exemple d'exÃ©cution d'un test.  Il vÃ©rifie le fonctionnement des rÃ¨gles RBAC qui permettent Ã  un utilisateur d'un groupe de modifier le nombre de foyers en cours d'exÃ©cution dans l'espace de noms.  Il est exÃ©cutÃ© si l'attribut Â«exÃ©cutableÂ» a Ã©tÃ© dÃ©fini.  Ou - en utilisant le <code>bats filename</code> . </p><br><pre> <code class="plaintext hljs">#!/usr/bin/env bats @test "Team namespaces can scale deployments within their own namespace" { run kubectl auth can-i update deployments.apps --subresource="scale" --as-group="$group" --as="$user" -n $ns [ "$status" -eq 0 ] [ "$output" == "yes" ] done }</code> </pre> <br><p>  Les commandes <code>--as</code> et <code>--as-group</code> nÃ©cessitent l'utilisation des rÃ¨gles RBAC suivantes: </p><br><pre> <code class="plaintext hljs">rules: - apiGroups: - authorization.k8s.io resources: - selfsubjectaccessreviews - selfsubjectrulesreviews verbs: - create</code> </pre> <br><p>  Voici une mÃ©thode simple pour implÃ©menter des contrÃ´les sur vos rÃ¨gles RBAC dans Kubernetes.  En l'intÃ©grant au pipeline Kubernetes, nous renforcerons considÃ©rablement la politique de RBAC.  La mÃ©thode a Ã©tÃ© testÃ©e dans la pratique: la capture des modifications qui violent les politiques d'accÃ¨s est beaucoup plus rapide! </p><br><p>  Merci d'avoir pris le temps de lire cet article! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434374/">https://habr.com/ru/post/fr434374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434360/index.html">Discussion expliquÃ©e sur la programmation asynchrone en Javascript</a></li>
<li><a href="../fr434362/index.html">PAS prÃ©vu pour 2019</a></li>
<li><a href="../fr434364/index.html">Prise en charge de la file d'attente Hangfire</a></li>
<li><a href="../fr434368/index.html">Apprentissage automatique pour trouver des erreurs dans le code: comment j'ai effectuÃ© un stage chez JetBrains Research</a></li>
<li><a href="../fr434370/index.html">Un autre conquÃ©rant de l'ombre Ã  Phaser, ou l'utilisation de vÃ©los</a></li>
<li><a href="../fr434380/index.html">Bases de l'injection de dÃ©pendance</a></li>
<li><a href="../fr434382/index.html">Portage d'Alpine Linux vers RISC-V</a></li>
<li><a href="../fr434384/index.html">Sous la responsabilitÃ© des artistes interprÃ¨tes ou exÃ©cutants</a></li>
<li><a href="../fr434386/index.html">Douglas Engelbart: Â«Augmenter l'intellect humain: un cadre conceptuelÂ»</a></li>
<li><a href="../fr434394/index.html">Bugatti Automobiles teste avec succÃ¨s l'Ã©trier de frein imprimÃ© en 3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>