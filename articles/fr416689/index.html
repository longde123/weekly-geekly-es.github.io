<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî§ üèë üßê √Ä propos des fonctionnalit√©s de l'architecture Android √† travers les yeux d'un d√©veloppeur non Android üö∞ üë©üèæ‚Äçüéì üë®üèø‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, nous avons compl√®tement repens√© l'application Pyrus pour Android. La premi√®re version de l'application fonctionnait d√©j√† sous Android 2.2. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√Ä propos des fonctionnalit√©s de l'architecture Android √† travers les yeux d'un d√©veloppeur non Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416689/"> R√©cemment, nous avons compl√®tement repens√© l'application Pyrus pour Android.  La premi√®re version de l'application fonctionnait d√©j√† sous Android 2.2.  Refusant de prendre en charge Android en dessous de 4.1, nous avons pu rembourser la dette technique accumul√©e et simplifier consid√©rablement le code source.  Oui, nous avons perdu une partie des utilisateurs (moins de 1%), mais d'un autre c√¥t√©, nous avons √©conomis√© du temps aux d√©veloppeurs pour corriger des bugs rares.  Nous pourrons l'investir dans le d√©veloppement de fonctionnalit√©s pour tous les utilisateurs actuels et nouveaux.  √Ä long terme, cela est beaucoup plus important. <br><br>  Nous partageons ici des exp√©riences qui peuvent √™tre utiles √† ceux qui envisagent de commencer le d√©veloppement de la plate-forme Android. <br><a name="habracut"></a><br>  Android attire de bons outils de d√©veloppement, un langage √©prouv√© (Java) avec la syntaxe habituelle, un large public d'utilisateurs.  Cependant, cr√©er des applications pratiques sur Android est difficile: malgr√© l'API d√©velopp√©e, il arrive souvent qu'il n'y ait pas de composant pr√™t √† l'emploi avec un comportement appropri√©.  Vous devez soit abandonner les id√©es du concepteur UX, soit accepter de d√©pendre de biblioth√®ques tierces, soit vous √©crire.  Toutes les solutions architecturales d'Android ne se sont pas av√©r√©es efficaces, ce qui augmente √©galement la quantit√© de code sans b√©n√©fice √©vident. <br><br><h3>  Mourir et rena√Ætre de ses cendres </h3><br>  L'interface dans Android est bas√©e sur Activity.  Il s'agit d'un conteneur qui occupe g√©n√©ralement la totalit√© de l'√©cran de l'appareil, d'autres widgets y vivent et il re√ßoit des √©v√©nements sur l'interaction de l'utilisateur. <br><br>  Lorsque l'utilisateur active l'application, un √©v√©nement onResume est lanc√© dans l'activit√©.  Appuyez sur le bouton Accueil - L'activit√© a disparu, mais avant cela, il a re√ßu l'√©v√©nement onPause.  Jusqu'√† pr√©sent, tout est logique.  Que se passe-t-il lorsqu'un utilisateur fait pivoter l'√©cran de l'appareil de 90 degr√©s?  Vous ne devinerez jamais: le syst√®me d'exploitation tue l'activit√© et recr√©e!  Lorsque vous d√©sinstallez une activit√©, tous les composants qu'elle contient sont supprim√©s.  Cela signifie que vous devez √©crire du code sp√©cial qui enregistre l'√©tat des widgets √† l'int√©rieur de l'activit√© (position de d√©filement, texte s√©lectionn√©, √©tat des cases √† cocher) et les restaure apr√®s la recr√©ation du parent.  Android fait une partie de ce travail pour vous, mais pas tout. <br><br>  Il est difficile de comprendre ce qui a pouss√© les architectes √† prendre une telle d√©cision.  Plus tard, quelqu'un a d√©cid√© que cela avait l'air laid et a ajout√© le m√™me param√®tre, qui supprime le comportement par d√©faut du syst√®me.  D√©sormais, au lieu de recr√©er Activity, le syst√®me d'exploitation peut appeler la m√©thode sp√©ciale onConfigurationChanged.  Cette ¬´solution¬ª ressemble √† un hack sale et n'a fait qu'exacerber le probl√®me, car la documentation Android <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">indique que</a> ¬´cette technique doit √™tre consid√©r√©e comme une mesure extr√™me et n'est pas recommand√©e pour la plupart des applications¬ª. <br><br><h3>  Fragments fragment√©s </h3><br>  Initialement, le syst√®me d'exploitation Android a √©t√© cr√©√© pour les t√©l√©phones.  Avec l'av√®nement des tablettes, l'√©quipe Android a d√©cid√© √† juste titre que les √©l√©ments d'interface qui √©taient auparavant espac√©s par diff√©rentes activit√©s en raison de la petite taille de l'√©cran du t√©l√©phone peuvent d√©sormais coexister sur le grand √©cran de la tablette.  (Exemple: la liste des lettres et l'e-mail sur le t√©l√©phone √©taient dans deux activit√©s diff√©rentes, et sur la tablette, ils partageaient un √©cran ensemble.) Oui, le probl√®me est: plusieurs activit√©s ne peuvent pas simultan√©ment interagir avec l'utilisateur par conception.  Par cons√©quent, un autre m√©canisme de r√©utilisation des composants est n√©cessaire, et une solution a √©t√© trouv√©e: des fragments sont apparus (Fragment). <br><br>  Par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©finition</a> , un fragment repr√©sente un comportement ou une partie d'une interface utilisateur dans une activit√©.  Tout est clair.  Cependant, dans les instructions d'utilisation des fragments, nous trouvons la section ¬´Ajouter un fragment qui n'a pas d'interface utilisateur¬ª.  QUOI?  Il s'av√®re qu'un fragment peut ne pas avoir sa propre fen√™tre de rendu! <br><br>  Mais qu'arrive-t-il aux fragments lorsque l'on tourne l'√©cran?  Les d√©veloppeurs Android y ont pens√© - lorsque vous recr√©ez une activit√©, tous ses fragments sont √©galement recr√©√©s automatiquement.  Cependant, apr√®s un examen attentif, le fragment a la m√©thode "setRetainInstance", si vous l'appelez, ce fragment ne sera pas supprim√© et restaur√© pendant les tours. <br><br>  √âlanc√© et coh√©rent, ce concept ne peut pas √™tre appel√©. <br><br><h3>  Fonctionnement asynchrone </h3><br>  Le thread de traitement des √©v√©nements ne peut pas √™tre bloqu√© par de longues op√©rations, l'√©change de donn√©es avec le disque et le r√©seau doit donc √™tre effectu√© de mani√®re asynchrone dans les autres threads.  Android propose jusqu'√† quatre m√©canismes de fonctionnement asynchrone: AsyncTask, Service, IntentService, Thread.  Les d√©veloppeurs sont encourag√©s √† d√©terminer celui qui leur convient le mieux.  Le choix n'est pas anodin: par exemple, si l'application a d√©marr√© AsyncTask et que l'utilisateur a tourn√© l'√©cran pendant son ex√©cution, √† la fin du travail, AsyncTask n'est pas en mesure de trouver une nouvelle activit√© (cr√©√©e apr√®s le tour).  Et aucun des quatre m√©canismes n'impl√©mente une logique simple: si l'utilisateur a d√©marr√© le deuxi√®me processus asynchrone sans attendre les r√©sultats du premier, puis le premier s'est termin√© plus t√¥t, il convient alors d'ignorer et de ne pas refl√©ter ses r√©sultats dans l'interface utilisateur. <br><br>  Il devient clair l'apparition de nombreuses biblioth√®ques - des bus de donn√©es pour organiser le travail asynchrone dans une application Android. <br><br><h3>  Red√©marrage de l'application apr√®s OOM </h3><br>  Si Android manque de RAM libre, le syst√®me d'exploitation peut terminer n'importe quel processus.  Lorsque l'utilisateur activera ult√©rieurement l'application, le syst√®me tentera de restaurer son √©tat.  En th√©orie, cela devrait √™tre invisible pour le d√©veloppeur (s'il a impl√©ment√© la m√©thode onSaveInstanceState dans tous les composants): le syst√®me lui-m√™me recr√©e la pile d'activit√© telle qu'elle √©tait lors de l'arr√™t forc√©.  Cependant, si l'initialisation prend du temps (par exemple, le chargement de caches √† partir du disque ou du r√©seau), il sera correct d'afficher √† l'utilisateur un indicateur d'attente.  Il s'av√®re que lors de la cr√©ation d'une activit√©, vous devez toujours surveiller le ¬´d√©marrage √† froid¬ª et effectuer l'initialisation manuellement.  Sans oublier qu'au red√©marrage, aucun Thread et AsyncTask ne sont restaur√©s. <br><br>  Quelle est la probabilit√© de manquer de m√©moire dans la pratique?  En r√®gle g√©n√©rale, cette situation se produit lors du traitement d'images haute r√©solution.  Par exemple, une image 2048x1536 occupe 12 Mo dans la m√©moire d'un objet Bitmap.  La quantit√© de m√©moire disponible pour l'application d√©pend du mod√®le de p√©riph√©rique sp√©cifique et est parfois tr√®s petite (64 Mo ou 128 Mo).  √âtant donn√© que le garbage collector dans toutes les versions d'Android ant√©rieures √† 8.0 n'√©tait pas compact, m√™me si vous avez 100 Mo de m√©moire libre, mais qu'il est divis√© en blocs de 10 Mo, une tentative d'allocation de m√©moire pour une telle image a entra√Æn√© un blocage de l'application. <br><br><h3>  Collecte des ordures √©ternelle </h3><br>  Une fois que notre utilisateur a remarqu√© que lors du d√©filement de longues listes, l'application √©tait ¬´en retard¬ª - toutes les 2-3 secondes, l'animation s'arr√™tait pendant de courtes pauses (200-300 ms), puis continuait.  L'analyse a montr√© que la collecte des ordures commence souvent de mani√®re suspecte dans l'application.  Il s'est av√©r√© que la classe HashMap standard (que nous utilisons pour obtenir un objet Java par son ID) est inefficace dans notre cas: nous devons cr√©er un objet wrapper pour chaque cl√©, qui est un entier (int).  Par cons√©quent, le nombre d'allocations de m√©moire augmente sans aucun avantage.  La solution a √©t√© de passer √† un conteneur SparseArray sp√©cial (disponible uniquement dans Android, pas dans la plate-forme Java standard), ce qui a imm√©diatement r√©duit la pression sur le garbage collector. <br><br>  Quel est le retard dans l'animation, demandez-vous?  Le fait est que le garbage collector dans Android a arr√™t√© tous les threads pendant son fonctionnement, y compris le thread principal impliqu√© dans le rendu.  Dans les versions d'Android √† partir de 5.0, une autre machine virtuelle est utilis√©e (ART au lieu de Dalvik) et un algorithme de collecte des ordures diff√©rent, qui interrompt de moins en moins l'animation.  (Vous pouvez en savoir plus sur la comparaison du temps de collecte des ordures <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .) <br><br><h3>  Afficher les documents </h3><br>  Si vous souhaitez ins√©rer des aper√ßus de documents dans votre application, vous √™tes oblig√© de d√©cevoir: dans Android, il n'y a pas de composant int√©gr√© qui peut afficher les fichiers Word, Excel, Powerpoint.  Sans parler des archives ZIP ou des documents PDF.  Sortir?  Forcer l'utilisateur √† installer des applications tierces pour afficher chaque type de fichier ou utiliser le composant WebView (en fait un navigateur).  Dans les deux cas, lorsque l'utilisateur enregistre le fichier, une application externe est lanc√©e et certains sc√©narios ne peuvent tout simplement pas √™tre mis en ≈ìuvre, par exemple un flux d'images: il n'y a pas de moyen facile d'int√©grer WebView dans un ViewPager standard. <br><br><h3>  Et ensuite </h3><br>  Certaines √©tudes affirment que la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">complexit√© du d√©veloppement Android est relativement √©lev√©e</a> .  Notre exp√©rience montre qu'il est facile pour un d√©veloppeur comp√©tent de s'habituer aux fonctionnalit√©s de cette plateforme.  Et bien qu'Android soit aujourd'hui le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syst√®me d'exploitation mobile</a> le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus populaire au monde</a> , dans 5 √† 10 ans, la situation pourrait radicalement changer. <br><br>  Ces derni√®res ann√©es, Google a secr√®tement d√©velopp√© le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouveau Fuchsia OC</a> avec un mod√®le de s√©curit√© fondamentalement diff√©rent (par rapport au syst√®me d'exploitation moderne).  Il utilisera probablement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dart</a> comme langage de programmation principal et le framework <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flutter</a> comme moyen principal de cr√©er des applications.  La rumeur veut que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fuchsia puisse remplacer Android et ChromeOS</a> sur tous les appareils.  Si Google le fait, la soci√©t√© est susceptible de fournir un support natif pour les applications √©crites pour Android (comme Microsoft l'a fait lors du passage de DOS √† Windows).  Par cons√©quent, jusqu'√† pr√©sent, vous ne pouvez pas vous inqui√©ter et continuer √† accumuler une expertise dans Android.  Et pour ceux qui veulent regarder vers l'avenir, vous pouvez t√©l√©charger Flutter et jouer avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416689/">https://habr.com/ru/post/fr416689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416679/index.html">Informatique p√©riph√©rique: une concordance amicale du ¬´brouillard¬ª avec les ¬´nuages¬ª</a></li>
<li><a href="../fr416681/index.html">Comment de PostgreSQL et ClickHouse en Python beaucoup, rapidement et imm√©diatement en numpy</a></li>
<li><a href="../fr416683/index.html">Et ensuite? Ou comment choisir les fonctionnalit√©s √† d√©velopper</a></li>
<li><a href="../fr416685/index.html">Suivi Epson ColorWorks: vos questions, nos r√©ponses</a></li>
<li><a href="../fr416687/index.html">Le stockage QSAN en tant que concurrent des marques de niveau 1</a></li>
<li><a href="../fr416691/index.html">S√©curit√© de l'apprentissage automatique: techniques de d√©fense efficaces ou nouvelles menaces?</a></li>
<li><a href="../fr416693/index.html">Certificats D-Link et √©volution des technologies de l'information utilis√©s pour signer les logiciels malveillants</a></li>
<li><a href="../fr416695/index.html">Prise en charge de vSphere 6.7 et d'autres fonctionnalit√©s de la derni√®re mise √† jour 3a de Veeam Backup & Replication 9.5</a></li>
<li><a href="../fr416697/index.html">Fusion d'op√©rateurs t√©l√©coms en 2018</a></li>
<li><a href="../fr416699/index.html">Sniper Geek ou comment faire un "oeil vif"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>