<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔤 🏑 🧐 À propos des fonctionnalités de l'architecture Android à travers les yeux d'un développeur non Android 🚰 👩🏾‍🎓 👨🏿‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Récemment, nous avons complètement repensé l'application Pyrus pour Android. La première version de l'application fonctionnait déjà sous Android 2.2. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>À propos des fonctionnalités de l'architecture Android à travers les yeux d'un développeur non Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416689/"> Récemment, nous avons complètement repensé l'application Pyrus pour Android.  La première version de l'application fonctionnait déjà sous Android 2.2.  Refusant de prendre en charge Android en dessous de 4.1, nous avons pu rembourser la dette technique accumulée et simplifier considérablement le code source.  Oui, nous avons perdu une partie des utilisateurs (moins de 1%), mais d'un autre côté, nous avons économisé du temps aux développeurs pour corriger des bugs rares.  Nous pourrons l'investir dans le développement de fonctionnalités pour tous les utilisateurs actuels et nouveaux.  À long terme, cela est beaucoup plus important. <br><br>  Nous partageons ici des expériences qui peuvent être utiles à ceux qui envisagent de commencer le développement de la plate-forme Android. <br><a name="habracut"></a><br>  Android attire de bons outils de développement, un langage éprouvé (Java) avec la syntaxe habituelle, un large public d'utilisateurs.  Cependant, créer des applications pratiques sur Android est difficile: malgré l'API développée, il arrive souvent qu'il n'y ait pas de composant prêt à l'emploi avec un comportement approprié.  Vous devez soit abandonner les idées du concepteur UX, soit accepter de dépendre de bibliothèques tierces, soit vous écrire.  Toutes les solutions architecturales d'Android ne se sont pas avérées efficaces, ce qui augmente également la quantité de code sans bénéfice évident. <br><br><h3>  Mourir et renaître de ses cendres </h3><br>  L'interface dans Android est basée sur Activity.  Il s'agit d'un conteneur qui occupe généralement la totalité de l'écran de l'appareil, d'autres widgets y vivent et il reçoit des événements sur l'interaction de l'utilisateur. <br><br>  Lorsque l'utilisateur active l'application, un événement onResume est lancé dans l'activité.  Appuyez sur le bouton Accueil - L'activité a disparu, mais avant cela, il a reçu l'événement onPause.  Jusqu'à présent, tout est logique.  Que se passe-t-il lorsqu'un utilisateur fait pivoter l'écran de l'appareil de 90 degrés?  Vous ne devinerez jamais: le système d'exploitation tue l'activité et recrée!  Lorsque vous désinstallez une activité, tous les composants qu'elle contient sont supprimés.  Cela signifie que vous devez écrire du code spécial qui enregistre l'état des widgets à l'intérieur de l'activité (position de défilement, texte sélectionné, état des cases à cocher) et les restaure après la recréation du parent.  Android fait une partie de ce travail pour vous, mais pas tout. <br><br>  Il est difficile de comprendre ce qui a poussé les architectes à prendre une telle décision.  Plus tard, quelqu'un a décidé que cela avait l'air laid et a ajouté le même paramètre, qui supprime le comportement par défaut du système.  Désormais, au lieu de recréer Activity, le système d'exploitation peut appeler la méthode spéciale onConfigurationChanged.  Cette «solution» ressemble à un hack sale et n'a fait qu'exacerber le problème, car la documentation Android <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">indique que</a> «cette technique doit être considérée comme une mesure extrême et n'est pas recommandée pour la plupart des applications». <br><br><h3>  Fragments fragmentés </h3><br>  Initialement, le système d'exploitation Android a été créé pour les téléphones.  Avec l'avènement des tablettes, l'équipe Android a décidé à juste titre que les éléments d'interface qui étaient auparavant espacés par différentes activités en raison de la petite taille de l'écran du téléphone peuvent désormais coexister sur le grand écran de la tablette.  (Exemple: la liste des lettres et l'e-mail sur le téléphone étaient dans deux activités différentes, et sur la tablette, ils partageaient un écran ensemble.) Oui, le problème est: plusieurs activités ne peuvent pas simultanément interagir avec l'utilisateur par conception.  Par conséquent, un autre mécanisme de réutilisation des composants est nécessaire, et une solution a été trouvée: des fragments sont apparus (Fragment). <br><br>  Par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">définition</a> , un fragment représente un comportement ou une partie d'une interface utilisateur dans une activité.  Tout est clair.  Cependant, dans les instructions d'utilisation des fragments, nous trouvons la section «Ajouter un fragment qui n'a pas d'interface utilisateur».  QUOI?  Il s'avère qu'un fragment peut ne pas avoir sa propre fenêtre de rendu! <br><br>  Mais qu'arrive-t-il aux fragments lorsque l'on tourne l'écran?  Les développeurs Android y ont pensé - lorsque vous recréez une activité, tous ses fragments sont également recréés automatiquement.  Cependant, après un examen attentif, le fragment a la méthode "setRetainInstance", si vous l'appelez, ce fragment ne sera pas supprimé et restauré pendant les tours. <br><br>  Élancé et cohérent, ce concept ne peut pas être appelé. <br><br><h3>  Fonctionnement asynchrone </h3><br>  Le thread de traitement des événements ne peut pas être bloqué par de longues opérations, l'échange de données avec le disque et le réseau doit donc être effectué de manière asynchrone dans les autres threads.  Android propose jusqu'à quatre mécanismes de fonctionnement asynchrone: AsyncTask, Service, IntentService, Thread.  Les développeurs sont encouragés à déterminer celui qui leur convient le mieux.  Le choix n'est pas anodin: par exemple, si l'application a démarré AsyncTask et que l'utilisateur a tourné l'écran pendant son exécution, à la fin du travail, AsyncTask n'est pas en mesure de trouver une nouvelle activité (créée après le tour).  Et aucun des quatre mécanismes n'implémente une logique simple: si l'utilisateur a démarré le deuxième processus asynchrone sans attendre les résultats du premier, puis le premier s'est terminé plus tôt, il convient alors d'ignorer et de ne pas refléter ses résultats dans l'interface utilisateur. <br><br>  Il devient clair l'apparition de nombreuses bibliothèques - des bus de données pour organiser le travail asynchrone dans une application Android. <br><br><h3>  Redémarrage de l'application après OOM </h3><br>  Si Android manque de RAM libre, le système d'exploitation peut terminer n'importe quel processus.  Lorsque l'utilisateur activera ultérieurement l'application, le système tentera de restaurer son état.  En théorie, cela devrait être invisible pour le développeur (s'il a implémenté la méthode onSaveInstanceState dans tous les composants): le système lui-même recrée la pile d'activité telle qu'elle était lors de l'arrêt forcé.  Cependant, si l'initialisation prend du temps (par exemple, le chargement de caches à partir du disque ou du réseau), il sera correct d'afficher à l'utilisateur un indicateur d'attente.  Il s'avère que lors de la création d'une activité, vous devez toujours surveiller le «démarrage à froid» et effectuer l'initialisation manuellement.  Sans oublier qu'au redémarrage, aucun Thread et AsyncTask ne sont restaurés. <br><br>  Quelle est la probabilité de manquer de mémoire dans la pratique?  En règle générale, cette situation se produit lors du traitement d'images haute résolution.  Par exemple, une image 2048x1536 occupe 12 Mo dans la mémoire d'un objet Bitmap.  La quantité de mémoire disponible pour l'application dépend du modèle de périphérique spécifique et est parfois très petite (64 Mo ou 128 Mo).  Étant donné que le garbage collector dans toutes les versions d'Android antérieures à 8.0 n'était pas compact, même si vous avez 100 Mo de mémoire libre, mais qu'il est divisé en blocs de 10 Mo, une tentative d'allocation de mémoire pour une telle image a entraîné un blocage de l'application. <br><br><h3>  Collecte des ordures éternelle </h3><br>  Une fois que notre utilisateur a remarqué que lors du défilement de longues listes, l'application était «en retard» - toutes les 2-3 secondes, l'animation s'arrêtait pendant de courtes pauses (200-300 ms), puis continuait.  L'analyse a montré que la collecte des ordures commence souvent de manière suspecte dans l'application.  Il s'est avéré que la classe HashMap standard (que nous utilisons pour obtenir un objet Java par son ID) est inefficace dans notre cas: nous devons créer un objet wrapper pour chaque clé, qui est un entier (int).  Par conséquent, le nombre d'allocations de mémoire augmente sans aucun avantage.  La solution a été de passer à un conteneur SparseArray spécial (disponible uniquement dans Android, pas dans la plate-forme Java standard), ce qui a immédiatement réduit la pression sur le garbage collector. <br><br>  Quel est le retard dans l'animation, demandez-vous?  Le fait est que le garbage collector dans Android a arrêté tous les threads pendant son fonctionnement, y compris le thread principal impliqué dans le rendu.  Dans les versions d'Android à partir de 5.0, une autre machine virtuelle est utilisée (ART au lieu de Dalvik) et un algorithme de collecte des ordures différent, qui interrompt de moins en moins l'animation.  (Vous pouvez en savoir plus sur la comparaison du temps de collecte des ordures <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .) <br><br><h3>  Afficher les documents </h3><br>  Si vous souhaitez insérer des aperçus de documents dans votre application, vous êtes obligé de décevoir: dans Android, il n'y a pas de composant intégré qui peut afficher les fichiers Word, Excel, Powerpoint.  Sans parler des archives ZIP ou des documents PDF.  Sortir?  Forcer l'utilisateur à installer des applications tierces pour afficher chaque type de fichier ou utiliser le composant WebView (en fait un navigateur).  Dans les deux cas, lorsque l'utilisateur enregistre le fichier, une application externe est lancée et certains scénarios ne peuvent tout simplement pas être mis en œuvre, par exemple un flux d'images: il n'y a pas de moyen facile d'intégrer WebView dans un ViewPager standard. <br><br><h3>  Et ensuite </h3><br>  Certaines études affirment que la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">complexité du développement Android est relativement élevée</a> .  Notre expérience montre qu'il est facile pour un développeur compétent de s'habituer aux fonctionnalités de cette plateforme.  Et bien qu'Android soit aujourd'hui le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">système d'exploitation mobile</a> le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus populaire au monde</a> , dans 5 à 10 ans, la situation pourrait radicalement changer. <br><br>  Ces dernières années, Google a secrètement développé le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouveau Fuchsia OC</a> avec un modèle de sécurité fondamentalement différent (par rapport au système d'exploitation moderne).  Il utilisera probablement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dart</a> comme langage de programmation principal et le framework <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flutter</a> comme moyen principal de créer des applications.  La rumeur veut que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fuchsia puisse remplacer Android et ChromeOS</a> sur tous les appareils.  Si Google le fait, la société est susceptible de fournir un support natif pour les applications écrites pour Android (comme Microsoft l'a fait lors du passage de DOS à Windows).  Par conséquent, jusqu'à présent, vous ne pouvez pas vous inquiéter et continuer à accumuler une expertise dans Android.  Et pour ceux qui veulent regarder vers l'avenir, vous pouvez télécharger Flutter et jouer avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416689/">https://habr.com/ru/post/fr416689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416679/index.html">Informatique périphérique: une concordance amicale du «brouillard» avec les «nuages»</a></li>
<li><a href="../fr416681/index.html">Comment de PostgreSQL et ClickHouse en Python beaucoup, rapidement et immédiatement en numpy</a></li>
<li><a href="../fr416683/index.html">Et ensuite? Ou comment choisir les fonctionnalités à développer</a></li>
<li><a href="../fr416685/index.html">Suivi Epson ColorWorks: vos questions, nos réponses</a></li>
<li><a href="../fr416687/index.html">Le stockage QSAN en tant que concurrent des marques de niveau 1</a></li>
<li><a href="../fr416691/index.html">Sécurité de l'apprentissage automatique: techniques de défense efficaces ou nouvelles menaces?</a></li>
<li><a href="../fr416693/index.html">Certificats D-Link et évolution des technologies de l'information utilisés pour signer les logiciels malveillants</a></li>
<li><a href="../fr416695/index.html">Prise en charge de vSphere 6.7 et d'autres fonctionnalités de la dernière mise à jour 3a de Veeam Backup & Replication 9.5</a></li>
<li><a href="../fr416697/index.html">Fusion d'opérateurs télécoms en 2018</a></li>
<li><a href="../fr416699/index.html">Sniper Geek ou comment faire un "oeil vif"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>