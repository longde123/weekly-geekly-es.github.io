<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐จ๐ฟโ๐ป ๐ง๐ฟ ููุชุจุฉ ููููุฉ ุฃุฎุฑู ๐ง ๐ค๐พ ๐ฏ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุณุงุก ุงูุฎูุฑ ุฃูุง ููุฎุฑุท ูู ุฃุชูุชุฉ ุงูุงุฎุชุจุงุฑ. ูุซู ูู ูููุฏุณู ุงูุฃุชูุชุฉ ุ ูุฏูู ูุฌููุนุฉ ูู ุงูููุชุจุงุช ูุงูุฃุฏูุงุช ุงูุชู ุนุงุฏุฉ ูุง ุงุฎุชุฑุชูุง ููุชุงุจุฉ ุงูุงุฎุชุจุงุฑุงุช. ูููู ุจุดูู ุฏูุฑ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููุชุจุฉ ููููุฉ ุฃุฎุฑู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476904/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> ูุณุงุก ุงูุฎูุฑ  ุฃูุง ููุฎุฑุท ูู ุฃุชูุชุฉ ุงูุงุฎุชุจุงุฑ.  ูุซู ูู ูููุฏุณู ุงูุฃุชูุชุฉ ุ ูุฏูู ูุฌููุนุฉ ูู ุงูููุชุจุงุช ูุงูุฃุฏูุงุช ุงูุชู ุนุงุฏุฉ ูุง ุงุฎุชุฑุชูุง ููุชุงุจุฉ ุงูุงุฎุชุจุงุฑุงุช.  ูููู ุจุดูู ุฏูุฑู ุ ุชูุฌุฏ ููุงูู ูุง ูููู ูุฃู ูู ุงูููุชุจุงุช ุงููุฃูููุฉ ุญู ุงููุดููุฉ ูููุง ูุน ุฎุทุฑ ุฌุนู ุงูุงุฎุชุจุงุฑุงุช ุงูุชููุงุฆูุฉ ุบูุฑ ูุณุชูุฑุฉ ุฃู ูุดุฉ.  ูู ูุฐู ุงูููุงูุฉ ุ ุฃูุฏ ุฃู ุฃุฎุจุฑูู ููู ุฏูุนุชูู ุงููููุฉ ุงููุนูุงุฑูุฉ ุนูู ูุง ูุจุฏู ุจุงุณุชุฎุฏุงู mock'ov ุฅูู ูุชุงุจุฉ ุงููุญุฏุฉ ุงูุฎุงุตุฉ ุจู.  ุฃูุฏ ุฃูุถูุง ูุดุงุฑูุฉ ูุฑุงุฑู ูุณูุงุน ุงูููุงุญุธุงุช. </p><a name="habracut"></a><br><h1 style=";text-align:right;direction:rtl">  ุชุทุจูู </h1><br><p style=";text-align:right;direction:rtl">  ูุงุญุฏุฉ ูู ุงููุทุงุนุงุช ุงููุงุฒูุฉ ูู ุงููุทุงุน ุงููุงูู ูู ุงูุชุฏููู.  ูุฌุจ ูุญุต ุงูุจูุงูุงุช ุจุงูุชุธุงู (ุงููุตุงูุญุฉ).  ูู ูุฐุง ุงูุตุฏุฏ ุ ุธูุฑ ุงูุชุทุจูู ุงูุฐู ุงุฎุชุจุฑุชู.  ููู ูุง ูุชุญุฏุซ ุนู ุดูุก ูุฌุฑุฏ ุ ูููุชุฎูู ุฃู ูุฑูููุง ูููู ุจุชุทููุฑ ุชุทุจูู ููุนุงูุฌุฉ ุงูุชุทุจููุงุช ูู ุจุฑุงูุฌ ุงูุฑุณุงุฆู ุงูููุฑูุฉ.  ููู ุชุทุจูู ุ ูุฌุจ ุฅูุดุงุก ุญุฏุซ ููุงุณุจ ูู elasticsearch.  ุณูููู ุชุทุจูู ุงูุชุญูู ูู ุฑุตุฏูุง ูุนุฏู ุชุฎุทู ุงูุชุทุจููุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุ ุชุฎูู ุฃู ูุฏููุง ูุธุงููุง ูุญุชูู ุนูู ุงูููููุงุช ุงูุชุงููุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฎุงุฏู ุงูุชูููู.  ุจุงููุณุจุฉ ูููุณุชุฎุฏู ุ ูุฐู ููุทุฉ ุฅุฏุฎุงู ูุงุญุฏุฉ ุญูุซ ูููู ุจุชูููู ููุณ ููุท ุชุทุจูู ุงูุชุญูู ุ ูููู ุฃูุถูุง ููููุงุช ุงููุธุงู ุงูุฃุฎุฑู. </li><li style=";text-align:right;direction:rtl">  ุชุทุจูู ุงูุชุญูู. </li><li style=";text-align:right;direction:rtl">  ุงูุจูุงูุงุช ูู ุชุทุจููุงุช ูุนุงูุฌุฉ ุงูุชุทุจููุงุช ุงูุชู ูุชู ุชุฎุฒูููุง ูู elasticsearch. </li><li style=";text-align:right;direction:rtl">  ุงูุจูุงูุงุช ุงููุฑุฌุนูุฉ.  ูุนุชูุฏ ุชูุณูู ุงูุจูุงูุงุช ุนูู ุจุฑูุงูุฌ ุงููุฑุงุณูุฉ ุงูุฐู ุชู ุฏูุฌ ุงูุชุทุจูู ูุนู. </li></ol><br><h1 style=";text-align:right;direction:rtl">  ูููุฉ </h1><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุงุฎุชุจุงุฑ ุงูุฃุชูุชุฉ ูู ูุฐู ุงูุญุงูุฉ ูุงุถุญูุง ุชูุงููุง: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ ุงูุจูุฆุฉ: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชู ุชุซุจูุช Elasticsearch ูุน ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุชูููู (ุจุงุณุชุฎุฏุงู msi ูุณุทุฑ ุงูุฃูุงูุฑ). </li><li style=";text-align:right;direction:rtl">  ุชู ุชุซุจูุช ุชุทุจูู ุงูุชุญูู. </li></ul></li><li style=";text-align:right;direction:rtl">  ุชูููุฐ ุงูุงุฎุชุจุงุฑ: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชู ุชูููู ุชุทุจูู ุงูุชุญูู. </li><li style=";text-align:right;direction:rtl">  ุชูุชูุฆ Elasticsearch ุจุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ููุงุฎุชุจุงุฑ ุงูููุงุจู (ุนุฏุฏ ุงูุชุทุจููุงุช ุงูุชู ุชูุช ูุนุงูุฌุชูุง). </li><li style=";text-align:right;direction:rtl">  ูุชููู ุงูุชุทุจูู ุจูุงูุงุช "ูุฑุฌุนูุฉ" ูู ุจุฑูุงูุฌ ุงููุฑุงุณูุฉ (ุนุฏุฏ ุงูุชุทุจููุงุช ุงูุชู ูุงู ูู ุงูููุชุฑุถ ุฃููุง ูู ุงููุงูุน). </li><li style=";text-align:right;direction:rtl">  ูุชู ุงูุชุญูู ูู ุงูุญูู ุงูุตุงุฏุฑ ูู ุงูุชุทุจูู: ุนุฏุฏ ุงูุทูุจุงุช ุงูุชู ุชู ุงูุชุญูู ูููุง ุจูุฌุงุญ ุ ูุนุฏุฏ ุงูุทูุจุงุช ุงูููููุฏุฉ ุ ุฅูุฎ. </li></ul></li><li style=";text-align:right;direction:rtl">  ุชูุธูู ุงูุจูุฆุฉ. </li></ol><br><p style=";text-align:right;direction:rtl">  ุงููุดููุฉ ูู ุฃููุง ูุฎุชุจุฑ ุงููุฑุงูุจุฉ ุ ูููู ูุชูููููุง ุ ูุญุชุงุฌ ุฅูู ุจูุงูุงุช ูู ุฎุงุฏู ุงูุชูููู.  ุฃููุงู ุ ูุนุฏ ุชุซุจูุช ูุชูููู ุฎุงุฏู ููู ุชุดุบูู ุนูููุฉ ุชุณุชุบุฑู ููุชูุง ุทูููุงู (ููุง ูุงุนุฏุชูุง ุงูุฎุงุตุฉ ุ ุนูู ุณุจูู ุงููุซุงู).  ุซุงููุงู ุ ุฃุฑูุฏ ุนุฒู ุงูุชุทุจููุงุช ูู ุฃุฌู ุชุจุณูุท ุชูุทูู ุงููุดููุงุช ุนูุฏ ุงูุนุซูุฑ ุนูู ุนูุจ.  ูู ุงูููุงูุฉ ุ ุชูุฑุฑ ุงุณุชุฎุฏุงู ููููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฏ ูุซูุฑ ูุฐุง ุงูุณุคุงู: "ุฅุฐุง ููุง ูุง ูุฒุงู ูุณุชูุฒุฆ ุจุงูุฎุงุฏู ุ ูุฑุจูุง ูุง ูููููุง ูุถุงุก ุจุนุถ ุงูููุช ูู ุชุซุจูุช ูุชุนุจุฆุฉ elasticsearch ุ ูููู ุจุฏูุงู ูู ุงูุงุณุชูุฒุงุกุ".  ูููู ูุง ูุฒุงู ุ ุนููู ุฏุงุฆููุง ุฃู ุชุชุฐูุฑ ุฃู ุงุณุชุฎุฏุงู ุงููููุฐุฌ ูููุฑ ูุฑููุฉ ุ ูููู ูุถูู ุงูุชุฒุงููุง ุจูุฑุงูุจุฉ ุฃูููุฉ ุณููู ุงููููุฐุฌ.  ูุฐูู ุ ุฑูุถุช ุงุณุชุจุฏุงู elasticsearch: ุฅูู ูู ุงูุณูู ุฌุฏูุง ุชุซุจูุชู ูุชุนุจุฆุชู. </p><br><h1 style=";text-align:right;direction:rtl">  ุฃูู ููููุฉ </h1><br><p style=";text-align:right;direction:rtl"> ูุฑุณู ุงูุฎุงุฏู ุงูุชูููู ุฅูู ุทูุจุงุช GET ุจุนุฏุฉ ุทุฑู ูู / ุงูุชูููู.  ูุญู ููุชููู ุจุทุฑููุชูู.  ุงูุฃูู ูู <code>/configuration/data_cluster</code> ูุน ุชูููู ุงููุชูุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">443</span></span>, <span class="hljs-attr"><span class="hljs-attr">"credentials"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"pass"</span></span> } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงูุซุงูู ูู <code>/configuration/reconciliation</code> ูุน ุชูููู ุชุทุจูู ุงูุญูุฑ </p><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"reconciliation_interval"</span></span>: <span class="hljs-number"><span class="hljs-number">3600</span></span>, <span class="hljs-attr"><span class="hljs-attr">"configuration_update_interval"</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"address"</span></span>: <span class="hljs-string"><span class="hljs-string">"file:///c:/path"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"credentials"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"pass"</span></span> } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชููู ุงูุตุนูุจุฉ ูู ุฃูู ุชุญุชุงุฌ ุฅูู ุฃู ุชููู ูุงุฏุฑูุง ุนูู ุชุบููุฑ ุงุณุชุฌุงุจุฉ ุงูุฎุงุฏู ุฃุซูุงุก ุงูุงุฎุชุจุงุฑ ุฃู ุจูู ุงูุงุฎุชุจุงุฑุงุช ูู ุฃุฌู ุงุฎุชุจุงุฑ ููููุฉ ุงุณุชุฌุงุจุฉ ุงูุชุทุจูู ูุชุบููุฑุงุช ุงูุชูููู ููููุงุช ุงููุฑูุฑ ุบูุฑ ุงูุตุญูุญุฉ ุ ุฅูุฎ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูู ุชุนูู ููุง ุฃุฏูุงุช ุงูุชูููุฉ ุงูุซุงุจุชุฉ ูุฃุฏูุงุช mocks ูู ุงุฎุชุจุงุฑุงุช ุงููุญุฏุฉ (ููููุฉ ุ monkeypatch ูู pytest ุ ููุง ุฅูู ุฐูู).  ููุฏ ูุฌุฏุช ููุชุจุฉ <code>pretenders</code> ุฑุงุฆุนุฉ ุงุนุชูุฏุช ุฃููุง ููุงุณุจุฉ ูู.  ูููุฑ <a href="https://pretenders.readthedocs.io/en/latest/" title="ูุฑุงุกุฉ ูุซุงุฆู ุงูุชุธุงูุฑุงุช">Pretenders</a> ุงููุฏุฑุฉ ุนูู ุฅูุดุงุก ุฎุงุฏู HTTP ุจููุงุนุฏ ุชุญุฏุฏ ููููุฉ ุงุณุชุฌุงุจุฉ ุงูุฎุงุฏู ููุทูุจุงุช.  ูุชู ุชุฎุฒูู ุงูููุงุนุฏ ูู ุฅุนุฏุงุฏุงุช ูุณุจูุฉ ุ ููุง ูุณูุญ ุจุนุฒู ุงูุฃุญุฌุงู ุนู ูุฌููุนุงุช ุงุฎุชุจุงุฑ ูุฎุชููุฉ.  ูููู ูุณุญ ุงูุฅุนุฏุงุฏุงุช ุงููุณุจูุฉ ูุฅุนุงุฏุฉ ุชุนุจุฆุชูุง ุ ููุง ูุณูุญ ูู ุจุชุญุฏูุซ ุงูุฅุฌุงุจุงุช ุญุณุจ ุงูุญุงุฌุฉ.  ูููู ุฑูุน ุงูุฎุงุฏู ููุณู ูุฑุฉ ูุงุญุฏุฉ ุฃุซูุงุก ุฅุนุฏุงุฏ ุงูุจูุฆุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">python -m pretenders.server.server --host 127.0.0.1 --port 8000</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ุงูุงุฎุชุจุงุฑุงุช ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุงุณุชุฎุฏุงู ุงูุนููู.  ูู ุฃุจุณุท ุงูุญุงูุงุช ุ ุนูุฏูุง ุชููู ุงูุฅุฌุงุจุงุช ูุดูุฑุฉ ุชูุงููุง ูู ุงูุงุฎุชุจุงุฑุงุช ุ ููุฏ ูุจุฏู ุงูุฃูุฑ ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pretenders.client.http <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HTTPMock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pretenders.common.constants <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FOREVER @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configuration_server_mock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> mock = HTTPMock(host=<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, port=<span class="hljs-number"><span class="hljs-number">8000</span></span>, name=<span class="hljs-string"><span class="hljs-string">"server"</span></span>) request.addfinalizer(mock.reset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mock <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_something</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(configuration_server_mock)</span></span></span><span class="hljs-function">:</span></span> configuration_server_mock.when(<span class="hljs-string"><span class="hljs-string">"GET /configuration/data_cluster"</span></span>).reply( headers={<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>}, body=json.dumps({ <span class="hljs-string"><span class="hljs-string">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">443</span></span>, <span class="hljs-string"><span class="hljs-string">"credentials"</span></span>: { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"pass"</span></span>, }, }), status=<span class="hljs-number"><span class="hljs-number">200</span></span>, times=FOREVER, ) configuration_server_mock.when(<span class="hljs-string"><span class="hljs-string">"GET /configuration/reconciliation"</span></span>).reply( headers={<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>}, body=json.dumps({ <span class="hljs-string"><span class="hljs-string">"reconciliation_interval"</span></span>: <span class="hljs-number"><span class="hljs-number">3600</span></span>, <span class="hljs-string"><span class="hljs-string">"configuration_update_interval"</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-string"><span class="hljs-string">"source"</span></span>: { <span class="hljs-string"><span class="hljs-string">"address"</span></span>: <span class="hljs-string"><span class="hljs-string">"file:///c:/path"</span></span>, <span class="hljs-string"><span class="hljs-string">"credentials"</span></span>: { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"pass"</span></span>, }, }, }), status=<span class="hljs-number"><span class="hljs-number">200</span></span>, times=FOREVER, ) <span class="hljs-comment"><span class="hljs-comment"># test application</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ูุฐุง ููุณ ูู ุดูุก.  ุจูุถู ูุฑููุชูุง ุ ููุฌุฏ ูุฏู <code>pretenders</code> ูุฌุจ ุชุฐูุฑููุง ููุฌุจ ูุนุงูุฌุชููุง ูู ุญุงูุชูุง: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ูููู ุญุฐู ุงูููุงุนุฏ ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู.  ูุชุบููุฑ ุงูุฅุฌุงุจุฉ ุ ูุฌุจ ุนููู ุญุฐู ุงูุฅุนุฏุงุฏ ุงููุณุจู ุจุฃูููู ูุฅุนุงุฏุฉ ุฅูุดุงุก ุฌููุน ุงูููุงุนุฏ ูุฑุฉ ุฃุฎุฑู. </li><li style=";text-align:right;direction:rtl">  ุฌููุน ุงููุณุงุฑุงุช ุงููุณุชุฎุฏูุฉ ูู ุงูููุงุนุฏ ูู ูุณุจูุฉ.  ุงูุฅุนุฏุงุฏุงุช ุงููุณุจูุฉ ููุง ูุณุงุฑ ูุฑูุฏ ูููููุฐุฌ / mockhttp / &lt;preset_name&gt; ุ ููุฐุง ุงููุณุงุฑ ูู ุจุงุฏุฆุฉ ุดุงุฆุนุฉ ูุฌููุน ุงููุณุงุฑุงุช ุงูุชู ุชู ุฅูุดุงุคูุง ูู ุงูููุงุนุฏ.  ูุณุชูุจู ุงูุชุทุจูู ููุฏ ุงูุงุฎุชุจุงุฑ ุงุณู ุงููุถูู ููุท ุ ููุง ููููู ูุนุฑูุฉ ุงูุจุงุฏุฆุฉ. </li></ol><br><p style=";text-align:right;direction:rtl">  ุงูููุฏ ุงูุฃูู ุบูุฑ ุณุงุฑุฉ ููุบุงูุฉ ุ ูููู ูููู ุญููุง ุนู ุทุฑูู ูุชุงุจุฉ ูุญุฏุฉ ููุทูุฉ ุงูุชู ุชุบูู ุงูุนูู ูุน ุงูุชูููู.  ุนูู ุณุจูู ุงููุซุงู </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">configuration.data_cluster.port = <span class="hljs-number"><span class="hljs-number">443</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃู (ูุฌุนู ุทูุจุงุช ุงูุชุญุฏูุซ ุฃูู ุชูุงุชุฑุง) </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">data_cluster_config = get_default_data_cluster_config() data_cluster_config.port = <span class="hljs-number"><span class="hljs-number">443</span></span> configuration.update_data_cluster(data_cluster_config)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุซู ูุฐุง ุงูุชุบููู ูุณูุญ ููุง ุจุชุญุฏูุซ ุฌููุน ุงููุณุงุฑุงุช ุฏูู ุฃูู ุชูุฑูุจุง.  ููููู ุฃูุถูุง ุฅูุดุงุก ุฅุนุฏุงุฏ ูุณุจู ูุฑุฏู ููู ููุทุฉ ููุงูุฉ ูุฑุฏูุฉ ูุฅุนุฏุงุฏ ูุณุจู ุนุงู (ุฑุฆูุณู) ุ ูุน ุฅุนุงุฏุฉ ุงูุชูุฌูู (ูู ุฎูุงู 307 ุฃู 308) ุฅูู ููุงุท ูุฑุฏูุฉ.  ุจุนุฏ ุฐูู ุ ููููู ูุณุญ ุฅุนุฏุงุฏ ูุณุจู ูุงุญุฏ ููุท ูุชุญุฏูุซ ุงููุงุนุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุชุฎูุต ูู ุงูุจุงุฏุฆุงุช ุ ููููู ุงุณุชุฎุฏุงู ููุชุจุฉ <a href="https://mitmproxy.org/" title="ุงูุชูู ุฅูู ูููุน mitmproxy">mitmproxy</a> .  ูุฐู ุฃุฏุงุฉ ูููุฉ ุชุชูุญ ุ ูู ุจูู ุฃุดูุงุก ุฃุฎุฑู ุ ุฅุนุงุฏุฉ ุชูุฌูู ุงูุทูุจุงุช.  ุณูููู ุจุฅุฒุงูุฉ ุงูุจุงุฏุฆุงุช ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mitmdump --mode reverse:http://127.0.0.1:8000 --replacements :~http:^/:/mockhttp/server/ --listen-host 127.0.01 --listen-port 80</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชููู ูุนููุงุช ูุฐุง ุงูุฃูุฑ ุจูุง ููู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>--listen-host 127.0.0.1</code> ู <code>--listen-port 80</code> .  ูููู Mitmproxy ุจุฑูุน ุงูุฎุงุฏู ุงูุฎุงุต ุจู ุ ูุจูุฐู ุงููุนููุงุช ูุญุฏุฏ ุงููุงุฌูุฉ ูุงููููุฐ ุงููุฐูู ุณูุณุชูุน ุฅููู ูุฐุง ุงูุฎุงุฏู. </li><li style=";text-align:right;direction:rtl">  <code>--mode reverse:http://127.0.0.1:8000</code> ูุนูู ุฃูู ุณูุชู ุฅุนุงุฏุฉ ุชูุฌูู ุงูุทูุจุงุช ุฅูู ุฎุงุฏู mitproxy ุฅูู <code>http://127.0.0.1:8000</code> .  ุงูุฑุฃ ุงููุฒูุฏ <a href="https://docs.mitmproxy.org/stable/concepts-modes/" title="ุชูุซูู ุฃูุถุงุน ูุฎุชููุฉ">ููุง</a> . </li><li style=";text-align:right;direction:rtl">  <code>--replacements :~http:^/:/mockhttp/server/</code> ูุญุฏุฏ ุงููุงูุจ ุงูุฐู ุณูุชู ุชุบููุฑ ุงูุทูุจุงุช.  ูุชููู ูู ุซูุงุซุฉ ุฃุฌุฒุงุก: ุนุงูู ุชุตููุฉ ุทูุจ ( <code>~http</code> ูุทูุจุงุช HTTP) ุ ูุงูุจ ููุชุบููุฑ ( <code>^/</code> ูุงุณุชุจุฏุงู ุจุฏุงูุฉ ุงููุณุงุฑ) ุ ูุงุณุชุจุฏุงู ูุนูููุง ( <code>/mockhttp/server</code> ).  ุงูุฑุฃ ุงููุฒูุฏ <a href="https://docs.mitmproxy.org/stable/overview-features/" title="ุงููุซุงุฆู ุงููุธูููุฉ">ููุง</a> . </li></ol><br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุชูุง ุ ูุถูู <code>mockhttp/server</code> ุฅูู ุฌููุน ุทูุจุงุช HTTP <code>mockhttp/server</code> ุชูุฌูููุง ุฅูู <code>http://127.0.0.1:8000</code> ุ ุฃู  ุฅูู ุฃุฏุนูุงุก ุงูุฎุงุฏู ุงูุฎุงุต ุจูุง.  ูุชูุฌุฉ ูุฐูู ุ ุญูููุง ุฃูู ูููู ุงูุขู ุงูุญุตูู ุนูู ุงูุชููุฆุฉ ุจุทูุจ ุงูุญุตูู ุนูู GET ุฅูู <code>http://127.0.0.1/configuration/data_cluster</code> . </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ููุช ุฑุงุถูุง ุนู ุงูุชุตููู ูุน <code>pretenders</code> ู <code>mitmproxy</code> .  ูุน ุงูุชุนููุฏ ุงูุธุงูุฑ - ุจุนุฏ ูู ุดูุก ุ ุฎุงุฏูุงู ุจุฏูุงู ูู ุฎุงุฏูู ูุงุญุฏ ุญูููู - ูุชููู ุงูุฅุนุฏุงุฏ ูู ุชุซุจูุช ุญุฒูุชูู ูุชูููุฐ ุฃูุฑูู ูู ุณุทุฑ ุงูุฃูุงูุฑ ูุจุฏุก ุชุดุบููููุง.  ููุณ ูู ุดูุก ูู ุบุงูุฉ ุงูุจุณุงุทุฉ ูู ุฅุฏุงุฑุฉ ูููู ุ ูููู ูู ุงูุชุนููุฏ ูููู ูู ููุงู ูุงุญุฏ ููุท (ุฅุฏุงุฑุฉ ุงูุฅุนุฏุงุฏุงุช ุงููุณุจูุฉ) ููุชู ุญููุง ุจูู ุจุณุงุทุฉ ูุจุดูู ููุซูู.  ููุน ุฐูู ุ ุธูุฑุช ุธุฑูู ุฌุฏูุฏุฉ ูู ุงููุดููุฉ ุงูุชู ุฏูุนุชูู ุฅูู ุงูุชูููุฑ ูู ุญู ุฌุฏูุฏ. </p><br><h1 style=";text-align:right;direction:rtl">  ููููุฉ ุงูุซุงููุฉ </h1><br><p style=";text-align:right;direction:rtl">  ุญุชู ุชูู ุงููุญุธุฉ ุ ูู ุฃูู ูุง ุชูููู ูู ุฃูู ุฌุงุกุช ุงูุจูุงูุงุช ุงููุฑุฌุนูุฉ.  ูุฏ ููุงุญุธ ุงููุงุฑุฆ ุงูููุธ ุฃูู ูู ุงููุซุงู ุฃุนูุงู ุ ูุชู ุงุณุชุฎุฏุงู ุงููุณุงุฑ ุฅูู ูุธุงู ุงููููุงุช ูุนููุงู ููุตุฏุฑ ุงูุจูุงูุงุช.  ููู ุชุนูู ุญููุง ุดูุก ูู ูุฐุง ุงููุจูู ุ ูููู ููุท ูุฃุญุฏ ุงูุจุงุฆุนูู.  ูููุฑ ุจุงุฆุน ุขุฎุฑ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุงุณุชูุจุงู ุงูุชุทุจููุงุช ุ ููุฏ ูุดุฃุช ูุนู ูุดููุฉ.  ูู ุงูุตุนุจ ุฑูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงูุจุงุฆุน ุฃุซูุงุก ุงูุงุฎุชุจุงุฑุงุช ุ ูุฐุง ููุฏ ุฎุทุทุช ูุงุณุชุจุฏุงููุง ุจุฃุณููุจ ูููู ููููุง ูููุณ ุงููุฎุทุท ููุง ูุงู ูู ูุจู.  ูููู ูุชููู ุงูุทูุจุงุช ุ ุทูุจ ุงููููุฐุฌ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">GET /application-history?page=2&amp;size=5&amp;start=1569148012&amp;end=1569148446</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู 2 ููุทุฉ ููุง.  ุฃููุง ุ ุจุนุถ ุงูุฎูุงุฑุงุช.  ูุงูุญูููุฉ ูู ุฃูู ูููู ุชุญุฏูุฏ ุงููุนููุงุช ูู ุฃู ุชุฑุชูุจ ุ ููุง ูุนูุฏ ุฅูู ุญุฏ ูุจูุฑ ุงูุชุนุจูุฑ ุงูููุชุธู ููุงุนุฏุฉ <code>pretenders</code> .  ูู ุงูุถุฑูุฑู ุฃูุถูุง ุชุฐูุฑ ุฃู ุงููุนููุงุช ุงุฎุชูุงุฑูุฉ ุ ูููู ูุฐู ููุณุช ูุดููุฉ ูุซู ุงูุชุฑุชูุจ ุงูุนุดูุงุฆู.  ุซุงููุงู ุ ุชุญุฏุฏ ุงููุนููุงุช ุงูุฃุฎูุฑุฉ (ุงูุจุฏุงูุฉ ูุงูููุงูุฉ) ุงููุงุตู ุงูุฒููู ูุชุตููุฉ ุงูุชุฑุชูุจ.  ูุงููุดููุฉ ูู ูุฐู ุงูุญุงูุฉ ูู ุฃูู ูุง ูููููุง ุงูุชูุจุค ูุณุจููุง ุจุงููุงุตู ุงูุฒููู (ูููุณ ุงูุญุฌู ุ ูููู ููุช ุงูุจุฏุก) ุงูุฐู ุณูุณุชุฎุฏูู ุงูุชุทุจูู ูุชุดููู ุงุณุชุฌุงุจุฉ ููููุฉ.  ุจุจุณุงุทุฉ ุ ูุญู ุจุญุงุฌุฉ ุฅูู ูุนุฑูุฉ ูุงุณุชุฎุฏุงู ููู ุงููุนููุงุช ูุชุดููู ุฅุฌุงุจุฉ "ูุนูููุฉ".  "ุงููุนููููุฉ" ูู ูุฐู ุงูุญุงูุฉ ูููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุญุชู ูุชููู ูู ุงุฎุชุจุงุฑ ุฃู ุงูุชุทุจูู ููุฑ ุจุฌููุน ุตูุญุงุช ุชุฑููู ุงูุตูุญุงุช: ุฅุฐุง ุฃุฌุจูุง ุนูู ุฌููุน ุงูุทูุจุงุช ุจุงูุทุฑููุฉ ููุณูุง ุ ููู ูุชููู ูู ุงูุนุซูุฑ ุนูู ุนููุจ ูุธุฑูุง ูุญูููุฉ ุฃูู ูุชู ุทูุจ ุตูุญุฉ ูุงุญุฏุฉ ููุท ูู ุฃุตู ุฎูุณุฉ . </p><br><p style=";text-align:right;direction:rtl">  ุญุงููุช ุงูุจุญุซ ุนู ุญููู ุจุฏููุฉ ุ ููู ูู ุงูููุงูุฉ ูุฑุฑุช ุฃู ุฃุญุงูู ูุชุงุจุฉ ุญููุงูู.  ูุฐูู ูุงู ููุงู <a href="https://github.com/KillAChicken/loose-server" title="ุงูุชูู ุฅูู ุงููุณุชูุฏุน ูุงููุซุงุฆู">ุฎุงุฏู ูุถูุงุถ</a> .  ูุฐุง ูู ุชุทุจูู <a href="https://palletsprojects.com/p/flask/" title="ุงูุชูู ุฅูู ุตูุญุฉ ุงููุดุฑูุน">Flask</a> ุญูุซ ูููู ุชูููู ุงููุณุงุฑุงุช ูุงูุงุณุชุฌุงุจุงุช ุจุนุฏ ุฃู ูุจุฏุฃ.  ูู ุฎุงุฑุฌ ุงูุตูุฏูู ุ ูุนุฑู ููููุฉ ุงูุชุนุงูู ูุน ููุงุนุฏ ูููุน ุงูุทูุจ (GET ุ POST ุ ููุง ุฅูู ุฐูู) ููููุณุงุฑ.  ูุฐุง ูุชูุญ ูู ุงุณุชุจุฏุงู <code>pretenders</code> ู <code>mitmproxy</code> ูู ุงููููุฉ ุงูุฃุตููุฉ.  ุณุฃูุถุญ ุฃูุถูุง ููู ูููู ุงุณุชุฎุฏุงูู ูุฅูุดุงุก ูููุฐุฌ ููุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงูุจุงุฆุน. </p><br><p style=";text-align:right;direction:rtl">  ูุญุชุงุฌ ุงูุชุทุจูู ุฅูู ูุณุงุฑูู ุฑุฆูุณููู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุทุฉ ุงูููุงูุฉ ูุงุนุฏุฉ.  ูุฐู ูู ููุณ ุงูุจุงุฏุฆุฉ ุงูุชู ุณูุชู ุงุณุชุฎุฏุงููุง ูุฌููุน ุงูููุงุนุฏ ุงูููููุฉ. </li><li style=";text-align:right;direction:rtl">  ููุทุฉ ููุงูุฉ ุงูุชูููู.  ูุฐุง ูู ุจุงุฏุฆุฉ ุชูู ุงูุทูุจุงุช ุงูุชู ููููู ูู ุฎูุงููุง ุชูููู ุฎุงุฏู ุงูุตูุฑ ููุณู. </li></ol><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">python -m looseserver.default.server.run --host 127.0.0.1 --port 80 --base-endpoint / --configuration-endpoint /_mock_configuration/</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูู ุงูุฃูุถู ุนุฏู ุชูููู ููุทุฉ ุงูููุงูุฉ ุงูุฃุณุงุณูุฉ ูููุทุฉ ุงูููุงูุฉ ุงูุชูููู ุจุญูุซ ูููู ุฃุญุฏููุง ูู ุงูุฃุตู ุจุงููุณุจุฉ ููุขุฎุฑ.  ุฎูุงู ุฐูู ุ ููุงู ุงุญุชูุงู ุฃู ุชุชุนุงุฑุถ ูุณุงุฑุงุช ุงูุชูููู ูุงูุงุฎุชุจุงุฑ.  ุณูููู ูููุทุฉ ููุงูุฉ ุงูุชูููู ุงูุฃุณุจููุฉ ุ ุญูุซ ุชุชู ุฅุถุงูุฉ ููุงุนุฏ Flask ููุชูููู ูู ููุช ูุจูุฑ ุนู ุงููุณุงุฑุงุช ุงูุฏููุงููููุฉ.  ูู ุญุงูุชูุง ุ ูููููุง ุงุณุชุฎุฏุงู <code>--base-endpoint /configuration/</code> ุฅุฐุง ูู ููู ุจุฅุฏุฑุงุฌ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงูุจุงุฆุน ูู ูุฐุง ุงููููุฐุฌ. </p><br><p style=";text-align:right;direction:rtl">  ุฃุจุณุท ูุณุฎุฉ ูู ุงูุงุฎุชุจุงุฑุงุช ูุง ุชุชุบูุฑ ูุซูุฑุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> looseserver.default.client.http <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HTTPClient <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> looseserver.default.client.rule <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PathRule <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> looseserver.default.client.response <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FixedResponse @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configuration_server_mock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockFactory</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._client = HTTPClient(configuration_url=<span class="hljs-string"><span class="hljs-string">"http://127.0.0.1/_mock_configuration/"</span></span>) self._rule_ids = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_rule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, path, json_response)</span></span></span><span class="hljs-function">:</span></span> rule = self._client.create_rule(PathRule(path=path)) self._rule_ids.append(rule.rule_id) response = FixedResponse( headers={<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>}, status=<span class="hljs-number"><span class="hljs-number">200</span></span>, body=json.dumps(json_response), ) self._client.set_response(rule_id=rule.rule_id, response=response) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_delete_rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rule_id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self._rule_ids: self._client.remove_rule(rule_id=rule_id) mock = MockFactory() request.addfinalizer(mock._delete_rules) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mock <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_something</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(configuration_server_mock)</span></span></span><span class="hljs-function">:</span></span> configuration_server_mock.create_rule( path=<span class="hljs-string"><span class="hljs-string">"configuration/data_cluster"</span></span>, json_response={ <span class="hljs-string"><span class="hljs-string">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">443</span></span>, <span class="hljs-string"><span class="hljs-string">"credentials"</span></span>: { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"pass"</span></span>, }, } ) configuration_server_mock.create_rule( path=<span class="hljs-string"><span class="hljs-string">"configuration/reconciliation"</span></span>, json_response={ <span class="hljs-string"><span class="hljs-string">"reconciliation_interval"</span></span>: <span class="hljs-number"><span class="hljs-number">3600</span></span>, <span class="hljs-string"><span class="hljs-string">"configuration_update_interval"</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-string"><span class="hljs-string">"source"</span></span>: { <span class="hljs-string"><span class="hljs-string">"address"</span></span>: <span class="hljs-string"><span class="hljs-string">"file:///applications"</span></span>, <span class="hljs-string"><span class="hljs-string">"credentials"</span></span>: { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"pass"</span></span>, }, }, } )</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุตุจุญุช ููุฒุฉ ุงูุซุงุจุช ุฃูุซุฑ ุตุนูุจุฉ ุ ูููู ูููู ุงูุขู ุญุฐู ุงูููุงุนุฏ ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู ุ ููุง ูุจุณุท ุงูุนูู ูุนูู.  ุจุงุณุชุฎุฏุงู <code>mitmproxy</code> ูู ุชุนุฏ ููุงู ุญุงุฌุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุนูุฏ ุฅูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงูุจุงุฆุน.  ุณููุดุฆ ููุนูุง ุฌุฏูุฏูุง ูู ุงูููุงุนุฏ ูุฎุงุฏู ุณุงุฆุจ ุ ูุงูุฐู ุ ุจูุงุกู ุนูู ูููุฉ ุงููุนููุฉ ุ ุณูุนุทู ุฅุฌุงุจุงุช ูุฎุชููุฉ.  ุจุนุฏ ุฐูู ุ ุณูู ูุณุชุฎุฏู ูุฐู ุงููุงุนุฏุฉ ููุนููุฉ ุงูุตูุญุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฅูุดุงุก ููุงุนุฏ ูุฅุฌุงุจุงุช ุฌุฏูุฏุฉ ููู ูู ุงูุฎุงุฏู ูุงูุนููู.  ููุจุฏุฃ ูุน ุงูุฎุงุฏู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> looseserver.server.rule <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ServerRule <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerParameterRule</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ServerRule)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parameter_name, parameter_value=None, rule_type=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"PARAMETER"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super(ServerParameterRule, self).__init__(rule_type=rule_type) self._parameter_name = parameter_name self._parameter_value = parameter_value <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_match_found</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._parameter_value <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._parameter_name <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> request.args <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.args.get(self._parameter_name) == self._parameter_value</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชุญุฏุฏ ูู ูุงุนุฏุฉ ุทุฑููุฉ <code>is_match_found</code> ุ ูุงูุชู ุชุญุฏุฏ ูุง ุฅุฐุง ูุงู ูุฌุจ ุฃู ุชุนูู ูุทูุจ ูุนูู ุฃู ูุง.  ูุนููุฉ ุงูุฅุฏุฎุงู ุงูุฎุงุตุฉ ุจู ูู ูุงุฆู ุงูุทูุจ.  ุจุนุฏ ุฅูุดุงุก ุงููุงุนุฏุฉ ุงูุฌุฏูุฏุฉ ุ ูู ุงูุถุฑูุฑู "ุชุนููู" ุงูุฎุงุฏู ููุจููู ูู ุงูุนููู.  ููููุงู ุจุฐูู ุ ุงุณุชุฎุฏู <code>RuleFactory</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> looseserver.default.server.rule <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> create_rule_factory <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> looseserver.default.server.application <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configure_application <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_create_application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(base_endpoint, configuration_endpoint)</span></span></span><span class="hljs-function">:</span></span> server_rule_factory = create_rule_factory(base_endpoint) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_parse_param_rule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rule_type, parameters)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ServerParameterRule( rule_type=rule_type, parameter_name=parameters[<span class="hljs-string"><span class="hljs-string">"parameter_name"</span></span>], parameter_value=parameters[<span class="hljs-string"><span class="hljs-string">"parameter_value"</span></span>], ) server_rule_factory.register_rule( rule_type=<span class="hljs-string"><span class="hljs-string">"PARAMETER"</span></span>, parser=_parse_param_rule, serializer=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> rule_type, rule: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> configure_application( rule_factory=server_rule_factory, base_endpoint=base_endpoint, configuration_endpoint=configuration_endpoint, ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: application = _create_application(base_endpoint=<span class="hljs-string"><span class="hljs-string">"/"</span></span>, configuration_endpoint=<span class="hljs-string"><span class="hljs-string">"/_mock_configuration"</span></span>) application.run(host=<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, port=<span class="hljs-number"><span class="hljs-number">80</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูููู ุจุฅูุดุงุก ูุตูุน ููููุงุนุฏ ุจุดูู ุงูุชุฑุงุถู ุ ุจุญูุซ ูุญุชูู ุนูู ุงูููุงุนุฏ ุงูุชู ุงุณุชุฎุฏููุงูุง ูู ูุจู ุ ูุชุณุฌูู ููุน ุฌุฏูุฏ.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุง ูุญุชุงุฌ ุงูุนููู ุฅูู ูุนูููุงุช ุงููุงุนุฏุฉ ุ ูุฐูู ูุฅู <code>serializer</code> ูุง ููุนู ุดูุฆูุง ูู ุงููุงูุน.  ูุฐูู ูุชู ููู ูุฐุง ุงููุตูุน ุฅูู ุงูุชุทุจูู.  ููููู ุชุดุบููู ุจุงููุนู ูุซู ุชุทุจูู Flask ุงูุนุงุฏู. </p><br><p style=";text-align:right;direction:rtl">  ูุชุดุงุจู ุงููููู ูุน ุงูุนููู: ูููู ุจุฅูุดุงุก ูุงุนุฏุฉ ููุตูุน.  ููู ุจุงููุณุจุฉ ููุนููู ุ ุฃููุงู ุ ููุณ ูู ุงูุถุฑูุฑู ุชุญุฏูุฏ ุทุฑููุฉ <code>is_match_found</code> ุ ูุซุงููุงู ุ ูุฅู ุงููุณูุณู ูู ูุฐู ุงูุญุงูุฉ ุถุฑูุฑู ูุฅุฑุณุงู ุงููุงุนุฏุฉ ุฅูู ุงูุฎุงุฏู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> looseserver.client.rule <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ClientRule <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> looseserver.default.client.rule <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> create_rule_factory <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClientParameterRule</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ClientRule)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parameter_name, parameter_value=None, rule_type=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"PARAMETER"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, rule_id=None)</span></span></span><span class="hljs-function">:</span></span> super(ClientParameterRule, self).__init__(rule_type=rule_type, rule_id=rule_id) self.parameter_name = parameter_name self.parameter_value = parameter_value <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_create_client</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(configuration_url)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_serialize_param_rule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rule)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">"parameter_name"</span></span>: rule.parameter_name, <span class="hljs-string"><span class="hljs-string">"parameter_value"</span></span>: rule.parameter_value, } client_rule_factory = create_rule_factory() client_rule_factory.register_rule( rule_type=<span class="hljs-string"><span class="hljs-string">"PARAMETER"</span></span>, parser=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> rule_type, parameters: ClientParameterRule(rule_type=rule_type, parameter_name=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>), serializer=_serialize_param_rule, ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HTTPClient(configuration_url=configuration_url, rule_factory=client_rule_factory)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจูู ุงุณุชุฎุฏุงู <code>_create_client</code> ูุฅูุดุงุก ุงูุนููู ุ ููููู ุงุณุชุฎุฏุงู ุงูููุงุนุฏ ูู ุงูุงุฎุชุจุงุฑุงุช.  ูู ุงููุซุงู ุฃุฏูุงู ุ ุฃุถูุช ุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุงูุชุฑุงุถูุฉ ุฃุฎุฑู: <code>CompositeRule</code> .  ูุณูุญ ูู ุจุฏูุฌ ุงูุนุฏูุฏ ูู ุงูููุงุนุฏ ูู ูุงุนุฏุฉ ูุงุญุฏุฉ ุจุญูุซ ุชุนูู ููุท ุฅุฐุง ูุงูุช ูู ูุงุญุฏุฉ ูููุง ุชูุฑุฌุน "True" ููุงุชุตุงู <code>is_match_found</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture def configuration_server_mock(request): class MockFactory: def __init__(self): self._client = _create_client("http://127.0.0.1/_mock_configuration/") self._rule_ids = [] def create_paged_rule(self, path, page, json_response): rule_prototype = CompositeRule( children=[ PathRule(path=path), ClientParameterRule(parameter_name="page", parameter_value=page), ] ) rule = self._client.create_rule(rule_prototype) self._rule_ids.append(rule.rule_id) response = FixedResponse( headers={"Content-Type": "application/json"}, status=200, body=json.dumps(json_response), ) self._client.set_response(rule_id=rule.rule_id, response=response) ... mock = MockFactory() request.addfinalizer(mock._delete_rules) return mock def test_something(configuration_server_mock): ... configuration_server_mock.create_paged_rule( path="application-history", page=None, json_response=["1", "2", "3"], ) configuration_server_mock.create_paged_rule( path="application-history", page="1", json_response=["1", "2", "3"], ) configuration_server_mock.create_paged_rule( path="application-history", page="2", json_response=["4", "5"], )</span></span></code> </pre> <br><h1 style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h1><br><p style=";text-align:right;direction:rtl">  ูููุฑ <code>mitmproxy</code> <code>pretenders</code> <code>mitmproxy</code> ุฃุฏุงุฉ ูููุฉ ููุฑูุฉ ุจูุง ูููู ูุฅูุดุงุก mocks.  ูุฒุงูุงู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุณูู ุงูุฅุนุฏุงุฏ. </li><li style=";text-align:right;direction:rtl">  ุงููุฏุฑุฉ ุนูู ุนุฒู ูุฌููุนุงุช ุงูุงุณุชุนูุงู ุจุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงููุณุจูุฉ. </li><li style=";text-align:right;direction:rtl">  ุญุฐู ูุฌููุนุฉ ูุนุฒููุฉ ุจุงููุงูู ูู ููุช ูุงุญุฏ. </li></ol><br><p style=";text-align:right;direction:rtl">  ุนู ุทุฑูู ุณูุจูุงุช ูุง ููู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุญุงุฌุฉ ุฅูู ุฅูุดุงุก ุชุนุจูุฑุงุช ููุชุธูุฉ ููููุงุนุฏ. </li><li style=";text-align:right;direction:rtl">  ุนุฏู ุงููุฏุฑุฉ ุนูู ุชุบููุฑ ุงูููุงุนุฏ ุจุดูู ูุฑุฏู. </li><li style=";text-align:right;direction:rtl">  ูุฌูุฏ ุจุงุฏุฆุฉ ููู ุงููุณุงุฑุงุช ุงูุชู ุชู <code>mitmproxy</code> ุฃู ุงุณุชุฎุฏุงู ุงุนุงุฏุฉ ุงูุชูุฌูู ุจุงุณุชุฎุฏุงู <code>mitmproxy</code> . </li></ol><br><p style=";text-align:right;direction:rtl">  ุฑูุงุจุท ุงููุซุงุฆู: <br>  <a href="https://pretenders.readthedocs.io/en/latest/">ุงูุฃุฏุนูุงุก</a> <br>  <a href="https://docs.mitmproxy.org/stable/">Mitmproxy</a> <br>  <a href="https://github.com/KillAChicken/loose-server/wiki">ุฎุงุฏู ูุถูุงุถ</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar476904/">https://habr.com/ru/post/ar476904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar476880/index.html">ุฃุณุฑุฉ ุงูุณูุงูุฉ: CSRF</a></li>
<li><a href="../ar476888/index.html">ูุง ุงุชุฌุงูุงุช ุชุตููู UX ููุชุงุจุนุฉ ูู ุนุงู 2020</a></li>
<li><a href="../ar476890/index.html">ูุฃููุฆู ุงูุฐูู ูุนูููู ูู ููุฏููู. ูุจุฐุฉ ุนู ุฏูุฑุงุช Nature of Vex ู Bites of Python</a></li>
<li><a href="../ar476900/index.html">ุฌูุงุฒ ูุณุชูู ุนูู ุงุฑุฏูููู ุ ููุง ูุดูุฑ ุฅูู ุฒูุงุฏุฉ (ููุตุงู) ูู ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ</a></li>
<li><a href="../ar476902/index.html">ุจุงุฑูููุฑ ุ ูุง ูู ุงูุทูุงูุฉ ุญูู Voximplantุ ูุขุฎุฐ ุงูููุจ ุงููููุฐุฉ ุ ูุง ุณูุฏู</a></li>
<li><a href="../ar476906/index.html">ูุง ุงูุฌุฏูุฏ ูู SOLIDWORKS 2020</a></li>
<li><a href="../ar476908/index.html">ูู Hadoop ููุชุ ุงูุฌุฒุก 2</a></li>
<li><a href="../ar476910/index.html">ุงูุขุซุงุฑ: ุงุฎุชูุงุฑ ุตุนุจ ูู ุจุทุงูุฉ ุงูุตูุช ููุฃูุนุงุจ DOS</a></li>
<li><a href="../ar476912/index.html">ุญููู ุฑูุฒ ุงูุดุฑูุฉ ูููุจุฑูุฌูู</a></li>
<li><a href="../ar476914/index.html">ุชุซุจูุช Powershell Module ูู ูุณุชูุฏุน ุฌูุซุจ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>