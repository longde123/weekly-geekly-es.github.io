<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüåæ üòÉ üö≥ Transfert de donn√©es s√©curis√© entre deux applications üö¥üèΩ ü§öüèæ üï¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous, aujourd'hui, je voudrais vous parler de certaines options de transfert de donn√©es entre deux applications Android et les consid√©rer d'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Transfert de donn√©es s√©curis√© entre deux applications</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/448198/">  Bonjour √† tous, aujourd'hui, je voudrais vous parler de certaines options de transfert de donn√©es entre deux applications Android et les consid√©rer d'un point de vue de la s√©curit√©.  J'ai d√©cid√© d'√©crire cet article pour deux raisons.  Tout d'abord, j'ai souvent commenc√© √† rencontrer un manque de compr√©hension des d√©veloppeurs des m√©canismes de travail avec les composants d'une application Android.  La seconde - j'ai cess√© de comprendre sur quoi se fonde le choix de tel ou tel m√©canisme lors de l'impl√©mentation des fonctionnalit√©s et je voulais transmettre √† quoi il devrait ressembler au minimum. <a name="habracut"></a><br><br><h6>  D√©fi </h6><br>  Nous avons 2 applications qui acc√®dent √† la m√™me API.  Les clients peuvent acc√©der √† l'API par jeton d'acc√®s (sessionId).  Vous devez impl√©menter une transition transparente d'une application √† une autre.  Pour ce faire, vous devez t√¢tonner entre eux, par exemple, que ce soit sessionId. <br><br><h6>  Option n ¬∞ 1: QUERY DEEPLINK </h6><br>  L'option la plus √©vidente consiste √† transf√©rer le jeton vers Query DeepLink.  Cela ressemblera √† ceci: <br> <code>slave://main?sessionId=686A885A4FB644053C584B9BE2A70C7D</code> <br>  Dans ce cas, le destinataire pourra extraire sessionId et l'utiliser sans demander l'autorisation de l'utilisateur.  Du c√¥t√© du d√©veloppeur, il semble que la t√¢che soit termin√©e, mais creusons un peu plus. <br><br><h4>  D√©tournement de lien profond </h4><br>  √âtant donn√© que toute application peut enregistrer le sch√©ma tinkoff: //, le syst√®me d'exploitation peut ouvrir la mauvaise application.  Cela est possible du fait qu'il n'y a pas d'enregistrement et de restrictions sur l'utilisation des programmes.  Une application malveillante peut enregistrer le sch√©ma tinkoff: // et intercepter la demande vers l'application Tinkoff et d√©marrer elle-m√™me.  Dans ce cas, sessionId tombera entre de mauvaises mains et votre compte sera compromis.  De plus, DeepLink Hijacking vous permet d'effectuer du phishing, par exemple, en affichant des champs pour entrer un nom d'utilisateur et un mot de passe. <br><br>  Conceptuellement, le processus ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/jr/ql/kk/jrqlkkybrv_js21icrnk5hjeqme.png" alt="image"><br><br>  Il existe 2 solutions √† ce probl√®me.  Premi√®rement, la technologie AppLinks ne permet plus aux d√©veloppeurs de personnaliser le sch√©ma; √† la place, http / https est utilis√©.  Dans ce cas, le syst√®me d'exploitation prend le lien <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">slave.com/profile</a> et contacte l'h√¥te slave.com pour v√©rification.  La seconde - URL d'intention - au lieu d'appeler slave: //, l'intention: // est appel√©e, o√π l'identifiant unique de l'application √† lancer est transmis.  Cela ressemble √† ceci: <br><br><pre> <code class="plaintext hljs">intent://main/#Intent;scheme=slave;package=com.example.slave.client.android;end"</code> </pre> <br>  Dans ce cas, il ne sera pas possible d'intercepter le lancement de l'application, car un package sp√©cifique est sp√©cifi√©.  Pourtant, le probl√®me demeure que l'utilisateur peut installer l'application √† partir d'une source tierce avec le m√™me packageId que votre esclave.  Dans ce cas, si vous ne disposiez pas d'une application esclave l√©gitime, l'application malveillante installera et recevra votre jeton. <br><br><h4>  Fixation de session </h4><br>  Il s'agit d'une attaque dans laquelle un attaquant force le client √† √©tablir une session avec le logiciel cible √† l'aide de l'identifiant de session fourni par l'attaquant.  D√®s que l'utilisateur s'authentifie, l'attaquant pourra utiliser cet identifiant d√©j√† privil√©gi√© √† ses propres fins.  L'attaque exploite le fait que le logiciel cible utilise le m√™me sessionId apr√®s une √©l√©vation de privil√®ges. <br><br><img src="https://habrastorage.org/webt/pm/s2/_1/pms2_1zmdejnjxlb_duw2zjqzau.png"><br>  √Ä quoi cela ressemble dans notre cas: <br><br><ol><li>  l'attaquant obtient une session anonyme de l'application </li><li>  jette magnifiquement une lettre √† la victime au nom de la banque, dans laquelle il est invit√© √† se rendre sur son compte personnel </li><li>  en cliquant sur le lien, on acc√®de √† DeepLink avec un attaquant session esclave: // main? sessionId = 686A885A4FB644053C584B9BE2A70C7D </li><li>  l'application mobile prend une session, comprend qu'elle ne dispose pas de droits suffisants et demande √† l'utilisateur de s'authentifier </li><li>  l'utilisateur le passe, la session a des droits accrus </li><li>  utilisateur dans l'application, attaquant avec une session privil√©gi√©e, profit </li></ol><br>  Il serait correct de corriger cela sur l'API, en √©mettant un autre sessionId apr√®s une √©l√©vation de privil√®ges, mais nous √©crivons une application mobile.  Et notre fa√ßon est de refuser de transf√©rer le jeton du ma√Ætre √† l'esclave.  De plus, cela nous donnera une protection approfondie et si quelque chose casse sur l'API et que les jetons ne changent pas lorsque les privil√®ges sont augment√©s, alors une attaque sera toujours impossible. <br><br><h4>  Fuite par un tiers </h4><br>  Un autre inconv√©nient de cette option.  De nombreuses personnes utilisent des services tiers pour DeepLink en raison de la commodit√© de g√©n√©rer des liens, des analyses et d'autres trucs sympas.  Dans ce cas, vous remettez simplement votre jeton √† une soci√©t√© tierce. <br><br><h6>  Option # 2: FOURNISSEUR DE CONTENU </h6><br>  Comment allons-nous proc√©der?  Nous d√©finissons le fournisseur de contenu ma√Ætre et faisons en sorte que l'esclave se rende aupr√®s de ce fournisseur de contenu pour le jeton. <br><br><img src="https://habrastorage.org/webt/lq/am/ip/lqamiplsbcmfslxdcb_u1whnv7a.png"><br><br>  Ainsi, nous nous d√©barrassons du risque de transf√©rer le jeton vers la mauvaise application en cas de d√©tournement de DeepLink et rendons l'attaque de fixation de session impossible.  Mais nous avons d'autres probl√®mes - dans la version actuelle, en g√©n√©ral, toute application peut demander un jeton √† tout moment, m√™me si nous n'avons pas initi√© son lancement. <br><br><h4>  Niveau de protection </h4><br>  Dans la plupart des cas, vous devez v√©rifier que l'esclave est sign√© avec la m√™me cl√© que le ma√Ætre, c'est-√†-dire qu'il appartient au m√™me auteur.  Dans ce cas, le gestionnaire de packages dispose d'une m√©thode checkSignatures qui v√©rifie les signatures d'application.  Pour utiliser cette fonction, vous devez ajouter une autorisation avec protectionLevel = "signature" dans Content-Provider dans le manifeste d'application: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.example.contentprovider.access"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:protectionLevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"signature"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">provider</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:readPermission</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.example.contentprovider.access"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Le sch√©ma ne changera gu√®re par rapport √† la figure pr√©c√©dente, seule une garantie appara√Ætra que seules les applications avec une signature du m√™me auteur auront acc√®s au jeton. <br><br><h4>  Condition de course de permission </h4><br>  Il y a une caract√©ristique tr√®s d√©sagr√©able que les noms d'autorisation ne sont pas uniques, qui peuvent √™tre utilis√©s par une application malveillante et enregistrer l'autorisation avec notre nom et protectionLevel = ¬´normal¬ª devant nous.  Dans ce cas, lors de l'installation de notre application, l'autorisation existera d√©j√† sur le syst√®me d'exploitation et ne sera pas √©cras√©e.  Par cons√©quent, notre fournisseur de contenu restera non prot√©g√© et avec un acc√®s autoris√© √† partir de n'importe quelle application. <br><br><h4>  Diff√©rentes signatures </h4><br>  Malheureusement, les applications sont loin d'√™tre toujours sign√©es avec une seule cl√©, par exemple, certaines des applications sont achet√©es, ou ¬´si historiquement¬ª, mais une transition transparente est toujours n√©cessaire.  Dans ce cas, nous prenons la v√©rification de signature sur nous-m√™mes. <br>  Comment cela peut-il √™tre mis en ≈ìuvre: <br>  Le Content-Provider a une m√©thode getCallingPackage (), par laquelle nous pouvons obtenir le packageId de l'application qui a demand√© des donn√©es, et par packageId nous pouvons obtenir la liste des signatures et les v√©rifier avec celles int√©gr√©es. <br><br><pre> <code class="java hljs">String pkg = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCallingPackage(); PackageInfo pkgInfo = pkgmgr.getPackageInfo(pkg, GET_SIGNATURES); Signatures[] signatures = pkgInfo.signatures; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Signature sig: signatures) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sig.equals(TRUSTED_SIGNATURE)) { <span class="hljs-comment"><span class="hljs-comment">// trusted signature found, trust the application } }</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/zh/nx/p4/zhnxp4g2s8znhxf1ushb3ooo7fo.png"><br><br>  Il semble que nous ayons tout fait parfaitement, mais non. <br><br><h4>  Fausse vuln√©rabilit√© d'identification </h4><br>  Le probl√®me est que lorsque Android cr√©e une cha√Æne de confiance, le processus de v√©rification compare uniquement le sujet et ne v√©rifie pas la signature dans le champ du signataire du certificat.  Par cons√©quent, un attaquant peut cr√©er une cha√Æne de confiance sans signature r√©elle. <br><br>  En raison de cette erreur, une cha√Æne de certificats incorrecte est g√©n√©r√©e, qui peut inclure des certificats l√©gitimes int√©gr√©s dans l'APK, mais pas r√©ellement utilis√©s pour signer l'application.  Au final, je vais laisser un lien vers le commit qui corrige cette vuln√©rabilit√©.  Le probl√®me est r√©solu dans Android 4.4, nous ne pouvons donc augmenter le niveau d'API qu'√† 19. <br><br><h6>  Conclusions </h6><br>  Aujourd'hui, nous avons examin√© comment les fonctionnalit√©s doivent √™tre analys√©es pendant le d√©veloppement. <br>  Nous avons √©galement examin√© les options de transfert du secret entre deux applications, au cours desquelles nous avons analys√© les probl√®mes de chaque option et trouv√© des moyens de les √©viter. <br><br>  Toutes les applications s√©curis√©es! <br><br><h6>  Les r√©f√©rences </h6><br><ul><li>  Fake id vuln√©rabilit√© fix <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©sentation de la</a> fausse identit√© de vuln√©rabilit√© </li><li>  CWE: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fixation de session</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448198/">https://habr.com/ru/post/fr448198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448188/index.html">Capsule temporelle: HP iPaq h1940 "pr√™t √† l'emploi". √Ä quoi sert un PDA des ann√©es 2000</a></li>
<li><a href="../fr448190/index.html">√âditeur de logique visuelle pour Unity3d. Partie 1</a></li>
<li><a href="../fr448192/index.html">Pourquoi avons-nous besoin dans la production d'AR et de VR</a></li>
<li><a href="../fr448194/index.html">Exp√©rience du candidat dans le recrutement de d√©veloppeurs de logiciels. 2e partie</a></li>
<li><a href="../fr448196/index.html">L'avenir (ou le pr√©sent secret) des moteurs √† plasma ou comment atteindre une oscillation maximale de 27 dans l'atmosph√®re</a></li>
<li><a href="../fr448202/index.html">Nous contr√¥lons le g√©n√©rateur ou la lutte contre l'ADC dans le STM32F030</a></li>
<li><a href="../fr448204/index.html">√éles de Boh√™me</a></li>
<li><a href="../fr448206/index.html">D√©veloppement modulaire ou chemin, pas retour</a></li>
<li><a href="../fr448208/index.html">20, 100, 3, 19 - InoThings en chiffres</a></li>
<li><a href="../fr448210/index.html">Canon pour satellites, blaster et vaisseau solaire: des projets curieux et paradoxaux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>