<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äç‚öïÔ∏è ü•É ü•Ä Wie organisiere ich DDoS f√ºr gute Zwecke? üóø üë©üèª‚Äçüî¨ üà≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor der Ver√∂ffentlichung eines neuen Dienstes w√§re es hilfreich, sicherzustellen, dass er unseren Erwartungen entspricht und verf√ºgbar ist, unabh√§ngig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie organisiere ich DDoS f√ºr gute Zwecke?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ntc-vulkan/blog/481756/"><p><img src="https://habrastorage.org/webt/qa/gk/up/qagkupe_y5cx7thbrqpj4aynn1y.png" alt="Bild"></p><br><p>  Vor der Ver√∂ffentlichung eines neuen Dienstes w√§re es hilfreich, sicherzustellen, dass er unseren Erwartungen entspricht und verf√ºgbar ist, unabh√§ngig davon, wie viele Kunden ihn gleichzeitig nutzen. </p><br><p>  Und wie wird dieser Dienst reagieren, wenn ein verteilter DoS-Angriff dagegen organisiert wird?  Ist die Ressource vor potenziellen Angreifern gesch√ºtzt? </p><br><p>  Um m√∂gliche Risiken einzusch√§tzen und die Sicherheit zu erh√∂hen, ist es sinnvoll, eigenst√§ndig Aktionen durchzuf√ºhren, die einen DDoS-Angriff simulieren, w√§hrend die Ressource noch nicht f√ºr den Masseneinsatz gestartet wurde. </p><br><p>  In diesem Artikel werden wir √ºber die Erfahrungen beim Organisieren von Auslastungstests f√ºr DNS- und HTTP-Dienste sprechen. </p><a name="habracut"></a><br><h1>  Vorbereitung </h1><br><p>  Um die Erzeugung einer gro√üen Menge an Netzwerkverkehr auf der √ºberwachten Ressource zu provozieren, m√ºssen Sie viele virtuelle Maschinen verwenden, von denen jede die maximale Anzahl von Anforderungen an den Service sendet.  Wenn Sie kein leistungsstarkes Rechenzentrum haben, ist es sinnvoll, virtuelle Maschinen vor√ºbergehend in einer Cloud zu mieten.  Diese Idee hat eine Besonderheit: Sie m√ºssen sicherstellen, dass die Cloud nicht gecrawlt wird, und Ihre Aktivit√§t f√ºr die Aktionen eines Angreifers √ºbernehmen. </p><br><p>  Beim Vergleich der Richtlinien verschiedener Cloud-Services (jemand verbietet gnadenlos das Konto, mit dem vermutlich die Aktionen ausgef√ºhrt wurden, die zum Ausfall der Ressource f√ºhrten) hinsichtlich der Durchf√ºhrung von Auslastungstests unter Verwendung ihrer Funktionalit√§t haben wir uns f√ºr <a href="https://aws.amazon.com/">Amazon Web Services</a> (AWS) entschieden.  Aus den <a href="https://aws.amazon.com/ru/ec2/testing/">Dokumenten geht hervor</a> , dass AWS Lasttests zul√§sst, die Genehmigung jedoch durch Senden einer E-Mail an eine bestimmte Adresse beantragt. </p><br><h1>  Harmonisierung von Stresstests </h1><br><p>  Wir senden eine Nachricht, in der wir kurz √ºber unsere Absichten sprechen, und wir erhalten ein Formular, das ausgef√ºllt werden muss: </p><br><pre><code class="plaintext hljs">Customer ID: Customer Name: Email Address: AWS Account ID load test will be performed from: Does the customer have an NDA? Target Data EC2 Resources: Cloudfront Distribution: API Gateway / Lambda ID: ELB Names: Non-AWS Target: Region (please list all regions in scope for testing): Source Data: IP Addresses: Source Account ID: Regions involved: Testing Parameters: How much traffic do you plan to generate by region during testing? What is your expected peak load from source by region? (ie xx Gbps) What is your expected peak load at destination? (ie xx Gbps) Are you testing traffic outbound from EC2, inbound into EC2, or both? Are you testing traffic outbound (egress) from EC2, inbound (ingress) into EC2, or both: Egress. What is your expected peak load from source by region? (ie xx Gbps) Ingress. What is your expected peak load from source by region? (ie xx Gbps) Start Date: End Date: Finite testing details including timeline of testing: Summary of Test: Testing Timelines by phase including rps, pps, and Gbps: Peak bandwidth for each source IP: Tools Used for each phase of test: Types of testing to be performed for each phase of the request: What criteria/metrics will you monitor to ensure the success of this test? Who is performing the Load Test? (Please provide contact details): Does the tester have an NDA? Testing Security Do you have a way to monitor the data traffic for the duration of the test to verify bandwidth limits do not exceed approved rates? Do you have a way to immediately stop the traffic if we/you discover any issue? 2 Emergency contact names and phone numbers:</code> </pre> <br><p>  Es gibt verschiedene Nuancen: </p><br><ol><li><p>  Sie fragen uns, wen wir "br√§unen" wollen.  Haben wir ein Recht darauf?  Wir sagen, dass dies unsere Ressource ist (anscheinend √ºberpr√ºft niemand, ob dies der Fall ist) und dass die Tests vollst√§ndig konsistent sind. </p><br></li><li><p>  Wir m√ºssen festlegen, wie viel Verkehr wir in den einzelnen Regionen erzeugen werden.  W√§hrend der Korrespondenz stellen wir fest, dass jede Region ihre eigene Grenze f√ºr den Netzwerkverkehr hat.  Insgesamt d√ºrfen sie 645 Gb / s anfordern.  Wir √ºberlegen, wie viel f√ºr den Angriff ben√∂tigt wird, und w√§hlen die Regionen so aus, dass der erforderliche Wert erzielt wird. </p><br></li><li><p>  Es muss beschrieben werden, wann der Angriff ausgef√ºhrt wird, wie lange er andauert und wie seine Kraft zunimmt.  In freier Form, aber ausf√ºhrlich genug, besprechen wir unsere Pl√§ne.  Der Angriff wird mit einer allm√§hlichen Erh√∂hung der Leistung ausgef√ºhrt. Wir zeichnen also auf, welche Stufen die Pr√ºfung haben wird und welche maximale Leistung bei jeder von ihnen erwartet wird.  Das Datum des Angriffs kann bis zu einem Tag weggelassen werden, es ist durchaus m√∂glich, einen Bereich von zwei bis drei Wochen anzugeben. </p><br></li><li><p>  Und wir geben unser Bestes, um sicherzustellen, dass wir uns gut verhalten, den Testfortschritt sorgf√§ltig √ºberwachen und ihn bei Bedarf bei der ersten Anforderung stoppen. </p><br></li></ol><br><p>  Als Antwort auf das ausgef√ºllte Formular werden sie h√∂chstwahrscheinlich um eine Klarstellung bitten, sodass wir korrespondieren und Fragen beantworten, bis wir die Erlaubnis zum Testen erhalten. </p><br><p>  Es dauert ungef√§hr drei Werktage, bis der Genehmigungsprozess abgeschlossen ist, wenn die Antwort umgehend erfolgt. </p><br><h1>  Vorbereitung der Infrastruktur </h1><br><p>  Nach den Genehmigungen stehen wir vor der Notwendigkeit, die Infrastruktur f√ºr Tests vorzubereiten.  Tatsache ist, dass wir w√§hrend der √úberpr√ºfung umgehend Folgendes tun m√ºssen: </p><br><p>  ‚Ä¢ eine Instanz aufnehmen; </p><br><p>  ‚Ä¢ einen Testangriff starten; </p><br><p>  ‚Ä¢ Statistiken √ºber den Fortschritt sammeln; </p><br><p>  ‚Ä¢ den Testangriff stoppen; </p><br><p>  ‚Ä¢ √Ñndern Sie die IP-Adresse. </p><br><p>  ‚Ä¢ Schalten Sie die Instanz aus. </p><br><h2>  Instanz-Image erstellen </h2><br><h3>  W√§hlen Sie den Instanztyp </h3><br><p>  Erstellen wir zun√§chst ein AWS-Image, das die f√ºr die Verwaltung erforderlichen Tools und Skripts enth√§lt.  Der erste Schritt ist die Auswahl der zu mietenden Instanz.  Wir untersuchen die Eigenschaften verschiedener Arten von Instanzen: Wir untersuchen den Preis, die Menge des maximalen Datenverkehrs und die CPU-Leistung (letztere ist wichtig, da der Datenverkehr immerhin durch die Prozessorkapazit√§ten verursacht wird), dann testen wir die tats√§chliche Leistung und die maximale Anzahl von Anforderungen.  Nach unseren Sch√§tzungen <code>t3.small</code> Instanzen am besten zum Testen, aber hier w√§hlt jeder nach seinem Geschmack. </p><br><p>  Eigenschaften von Instanzen finden Sie <a href="https://aws.amazon.com/ec2/instance-types/">hier</a> .  Sie k√∂nnen hier auch Instanzen ausw√§hlen und vergleichen. </p><br><h3>  Anfrage begrenzen </h3><br><p>  Sie m√ºssen im Voraus √ºberlegen, wie viele Instanzen an den Tests teilnehmen werden.  Tatsache ist, dass Amazon f√ºr jede Region die Anzahl der Instanzen begrenzt.  Wenn Sie das Gef√ºhl haben, dass Sie mehr Instanzen ben√∂tigen, als standardm√§√üig verf√ºgbar sind, sollten Sie so fr√ºh wie m√∂glich eine Erh√∂hung des Limits beantragen.  Wechseln Sie dazu zum Abschnitt <a href="https://console.aws.amazon.com/support/cases">Support</a> , und erstellen Sie einen Aufruf vom Typ Service-Limit-Erh√∂hung.  Die Bearbeitungszeit f√ºr den Einspruch kann unterschiedlich sein: Jemand antwortet am n√§chsten Tag und stellt so viele Entit√§ten wie gew√ºnscht zur Verf√ºgung. Jemand sagt, dass er nicht mehr als N Instanzen ausf√ºhren l√§sst.  Es gab Regionen, die etwa einen Monat lang auf die Anfrage geantwortet haben. </p><br><h3>  Leistungsoptimierung </h3><br><p>  Als N√§chstes m√ºssen Sie ein Instanzimage erstellen, das w√§hrend des Tests gestartet wird.  Dazu schalten wir die Instanz des ausgew√§hlten Typs ein, nehmen alle Einstellungen daran vor und speichern das Geschehene als Bild (im Men√º Aktionen, in dem Sie die Instanz aktivieren k√∂nnen, sowie die Funktionen zum Erstellen eines Bildes Bild erstellen). </p><br><p>  Wir m√ºssen den maximalen ausgehenden Datenverkehr von jeder Instanz erhalten, also optimieren wir zuerst die Netzwerk- und Speichereinstellungen f√ºr unsere Aufgabe auf der Instanz. </p><br><p>  <code>/etc/sysctl.conf</code> dazu die Einstellungen in der Datei <code>/etc/sysctl.conf</code> : </p><br><p>  ‚Ä¢ Erh√∂hen Sie die Reichweite lokaler Ports und reduzieren Sie die Zeit, die Sockets im Status FIN_WAIT ben√∂tigen: </p><br><pre> <code class="plaintext hljs">net.ipv4.ip_local_port_range = 1024-65535 ( : 32768-61000) net.ipv4.tcp_fin_timeout = 10 ( : 60)</code> </pre> <br><p>  Der lokale Portbereich bestimmt die maximale Anzahl der ausgehenden Sockets, die ein Host von einer bestimmten IP-Adresse aus erstellen kann. </p><br><p>  Mit der Standardeinstellung (61.000‚Äì32.768) werden 28.233 Buchsen erhalten.  Mit neuen Einstellungen - 64 500. </p><br><p>  Fin_timeout definiert die minimale Zeit, die ausgehende Sockets im Zustand FIN_WAIT sein k√∂nnen. </p><br><p>  Wenn Standardwerte angegeben werden, kann das System nicht mehr als (61.000 - 32.768) / 60 = 470 Sockets pro Sekunde bereitstellen. </p><br><p>  Durch Erh√∂hen von port_range und Verringern von fin_timeout k√∂nnen wir die F√§higkeit des Systems beeinflussen, mehr ausgehende Verbindungen zu generieren. </p><br><p>  ‚Ä¢ Lassen Sie uns Sockets im TIME_WAIT-Status wiederverwenden, wenn die freien Sockets enden: </p><br><pre> <code class="plaintext hljs">net.ipv4.tcp_tw_reuse = 1</code> </pre> <br><p>  Das Einstellen der obigen Option (die standardm√§√üig deaktiviert ist) hilft, den Verlust von "inaktiven" bereits erf√ºllten Verbindungen zu minimieren. </p><br><p>  Sehr detailliert √ºber TIME_WAIT wird in diesem <a href="https://vincent.bernat.ch/en/blog/2014-tcp-time-wait-state-linux">Artikel beschrieben</a> . </p><br><p>  ‚Ä¢ Aktivieren Sie die Option tcp_timestamps, damit die obige Option tcp_tw_reuse funktioniert: </p><br><pre> <code class="plaintext hljs">net.ipv4.tcp_timestamps = 1 ‚Äì   `tcp_timestamps`     tcp_tw_reuse</code> </pre> <br><p>  ‚Ä¢ Andere Optionen: </p><br><pre> <code class="plaintext hljs">net.ipv4.tcp_max_tw_buckets = 720000 ‚Äì       TIME_WAIT net.ipv4.tcp_keepalive_time = 600 ‚Äì  - keepalive- net.ipv4.tcp_keepalive_probes = 3 ‚Äì   keepalive- net.ipv4.tcp_keepalive_intvl = 10 ‚Äì     keepalive- net.ipv4.tcp_window_scaling = 1 ‚Äì   TCP- net.ipv4.tcp_mem = 8192 131072 196304 ‚Äì     TCP- net.ipv4.udp_mem = 8192 131072 196304 ‚Äì     udp- net.ipv4.tcp_slow_start_after_idle=0 ‚Äì  Slow-Start Restart net.core.wmem_default = 31457280 ‚Äì         net.core.wmem_max = 33554432 ‚Äì        net.core.somaxconn = 65535 ‚Äì        net.core.netdev_max_backlog = 65535 ‚Äì          vm.swappiness = 30 ‚Äì    vm.dirty_ratio = 50 ‚Äì     50 %  vm.pagecache = 90 ‚Äì    </code> </pre> <br><h3>  Angriffsskripte testen </h3><br><p>  <strong>1. DNS-Angriff</strong> </p><br><p>  Eine der Hauptaufgaben beim Testen ist die Bewertung der Leistung von DNS-Servern.  DNS-Server k√∂nnen n√§mlich zum Engpass bei der Fehlertoleranz eines Standorts werden, da selbst bei Problemen mit DNS der stabilste Dienst nicht verf√ºgbar ist.  Um eine Last auf den DNS-Servern zu erstellen, werden viele verschiedene DNS-Abfragen generiert.  Anforderungen m√ºssen g√ºltig sein und die gr√∂√ütm√∂gliche und l√§ngste Antwort vom DNS-Server erfordern. </p><br><p>  Das Dienstprogramm <a href="https://www.dns-oarc.net/tools/dnsperf">DNSPerf</a> eignet sich zum Generieren dieses Datenverkehrs. </p><br><p>  DNSPerf ist ein einfaches, flexibles und kostenloses Tool zum Testen der DNS-Leistung.  Es wurde in erster Linie f√ºr autorisierende DNS-Server entwickelt, kann jedoch auch zum Messen der Leistung von Caching-Servern verwendet werden. </p><br><p>  In unserem Fall werden autorisierende DNS-Server geladen, die eine Zone bedienen - example.com. </p><br><p>  F√ºr DNSPerf bereiten wir zuerst eine Datei mit den Anforderungen von <code>dns_queries.txt</code> (haupts√§chlich ANY, um die Zeit und die Gr√∂√üe der Antwort vom DNS-Server zu erh√∂hen): </p><br><pre> <code class="plaintext hljs">#dns_queries.txt example.com ANY www.example.com ANY test.example.com ANY static.example.com ANY example.com  www.example.com  test.example.com MX</code> </pre> <br><p>  Beispiel f√ºr das Ausf√ºhren des Dienstprogramms: </p><br><pre> <code class="plaintext hljs">dnsperf -s TARGET_IP -d dns_queries.txt -c 100 -n 100 -s =  IP- -d =      .   ‚Äì stdin -c =   .         -n =  ¬´¬ª   .</code> </pre> <br><p>  <strong>2. Angriff auf ICMP</strong> </p><br><p>  Die n√§chste Testphase besteht darin, die Best√§ndigkeit gegen√ºber einer gro√üen Anzahl von ICMP-Verkehr zu bewerten.  Da Server aus technischen Gr√ºnden h√§ufig in der Lage sein m√ºssen, auf Ping-Anfragen zu antworten, besteht die M√∂glichkeit eines DDoS-Angriffs mit Ping-Anfragen.  Sie m√ºssen nicht nur Einstellungen festlegen, die die M√∂glichkeit von <code>ping-to-death</code> , sondern auch sicherstellen, dass die Server gegen ICMP-Lastspitzen best√§ndig sind.  Um solche Lasten zu erstellen, ist es besser, das bekannte Dienstprogramm <a href="https://linux.die.net/man/8/hping3">hping3 zu verwenden</a> , mit dem Sie die Anzahl der Anforderungen, das Intervall zwischen den Sendungen sowie die Paketgr√∂√üe anpassen k√∂nnen. </p><br><p>  Beispiel f√ºr das Ausf√ºhren des Dienstprogramms: </p><br><pre> <code class="plaintext hljs">hping3 -i u1000 -d 1500 -c 100000 -1 TARGET_IP -i u100 =     (uX for X microseconds) -d 1500 =    -c 1000000 =     -1 =  ICMP</code> </pre> <br><p>  <strong>3. HTTP-Angriff</strong> </p><br><p>  Jetzt √ºberpr√ºfen wir die Hauptfunktionalit√§t des Dienstes auf Stressresistenz - die Verarbeitung von HTTP (S) -Verkehr.  Eines der flexibelsten und einfachsten Tools zum Generieren von HTTP-Verkehr ist die <a href="https://linux.die.net/man/1/siege">Belagerung</a> .  Siege ist ein Open-Source-Multithread-Dienstprogramm, mit dem die Leistung einer Webressource getestet werden kann. </p><br><p>  Wie bei DNSPerf k√∂nnen Sie mit Belagerung den Server mit Anforderungen von einer bestimmten Anzahl virtueller Benutzer laden (Benutzeremulation wird √ºber einen separaten Port ausgef√ºhrt) und vordefinierte Anforderungss√§tze verwenden.  Dies ist sehr praktisch, da Sie die ressourcenintensivsten Abfragen in den Test einbeziehen k√∂nnen. </p><br><p>  Beispiel f√ºr das Ausf√ºhren des Dienstprogramms: </p><br><pre> <code class="plaintext hljs">siege -b -c 100 -f test_urls.txt -b =   ( benchmark) -c =   .         -f =   </code> </pre> <br><p>  Inhaltsformat <code>test_urls.txt</code> : </p><br><pre> <code class="plaintext hljs">http://example.com/site/login POST login=username&amp;password=test http://example.com/site/client POST useragent=Mozilla&amp;version=123&amp;date=24May http://example.com/site/order POST user=username&amp;company=ooo&amp;phone=812345678</code> </pre> <br><p>  Wie Sie sehen, wurden die Tests haupts√§chlich mit POST-Anforderungen durchgef√ºhrt, die auf der Serverseite verarbeitet werden m√ºssen und im Vergleich zu anderen Arten von Anforderungen die meisten Ressourcen belegen. </p><br><p>  Keine der Optionen verwendet IP-Spoofing, da Amazon dies nicht zul√§sst.  Unabh√§ngig davon, welches src_IP im Paket angegeben ist, wird es beim Verlassen der Instanz in das richtige ge√§ndert. </p><br><p>  Alle generierten Anfragen m√ºssen legitim sein - es bleibt keine Welle von ausgehendem Datenverkehr unbeantwortet - da die DDoS-Richtlinien von Amazon ziemlich streng sind.  Selbst ein koordinierter Stresstest ben√∂tigt mindestens einige Tage, um mit dem technischen Support zu kommunizieren. Bei den ersten "b√∂swilligen" Aktionen wird der Hafen gesperrt, aus dem der Datenverkehr stammt, und die Anforderung muss sofort erl√§utert werden. </p><br><h3>  Skripte zum Starten von Angriffen </h3><br><p>  F√ºr die Remotetestverwaltung erstellen wir Bash-Skripte (dns.sh, ping.sh, http.sh), die den gew√ºnschten Angriffstyp starten, sowie Nutzlastdateien (test_urls.txt, valid_dns_queries.txt). </p><br><p>  Wenn wir all dies in das AWS-Image hochladen (aus dem alle Instanzen erstellt werden), kann jeder Test mit dem Befehl des folgenden Formats remote ausgef√ºhrt werden: </p><br><pre> <code class="plaintext hljs">ssh instance-amazon 'sudo &lt;stress-script&gt;.sh start &lt;params&gt; &amp;&gt;&gt;stress.log &amp;'</code> </pre> <br><p>  Das Skript des erforderlichen Typs wird als stress-script.sh angegeben, und params sind die entsprechenden Parameter.  In der stress.log-Datei verfolgen wir die Ausgabe des ausgef√ºhrten Dienstprogramms.  Der Einfachheit halber verwenden wir verschiedene Protokolle f√ºr verschiedene Dienstprogramme: dns.log, ping.log, http.log. </p><br><p>  Beispiel <code>dns.sh</code> Skript: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash if [[ ! "$1" =~ ^(start|stop|status)$ ]]; then echo "nothing to do: need argument for stop,start or status" exit 1 fi if [[ "$1" = "start" ]]; then shift dnsperf $@ fi if [[ "$1" = "stop" ]]; then kill $(pidof dnsperf) fi if [[ "$1" = "status" ]]; then if [[ ! "$(pidof dnsperf)" = "" ]]; then echo "dnperf is running with PID $(pidof dnsperf)" ps aux | grep dnsperf else echo "dnsperf is not running" fi fi</span></span></code> </pre> <br><p>  Wie aus dem Code hervorgeht, kann das Skript gestartet und gestoppt sowie der Status (ausgef√ºhrt / nicht ausgef√ºhrt) √ºberpr√ºft werden. </p><br><p>  Skripte f√ºr ICMP- und HTTP-Tests werden auf die gleiche Weise erstellt, wobei hping3 bzw. siege mit der durch das Argument √ºbergebenen Parameterzeichenfolge gestartet werden. </p><br><p>  Beispiele f√ºr Befehle: </p><br><pre> <code class="plaintext hljs">ssh instance-amazon 'sudo dns.sh start -s TARGET_IP -d valid_dns_queries.txt -c 1 -n 100 &amp;&gt;&gt;dns.log &amp;' ssh instance-amazon 'sudo ping.sh start -i u1000 -d 1500 -c 100000 -1 TARGET_IP &amp;&gt;&gt;ping.log &amp;' ssh instance-amazon 'sudo http.sh start -b -c 100 -f test_urls.txt &amp;&gt;&gt; http.log &amp;'</code> </pre> <br><h3>  √úberwachen von Skripten </h3><br><p>  Um den ausgehenden Datenverkehr und den Status der Testinfrastruktur zu bewerten, ben√∂tigen wir ein √úberwachungstool.  Aus Gr√ºnden der Einfachheit und Ressourcenschonung verwenden wir iptables.  Dazu schreiben wir ein Skript, das die Anzahl der gesendeten MB z√§hlt, und f√ºgen es in das AWS-Image ein: </p><br><pre> <code class="plaintext hljs">#iptables.sh sudo iptables -N TRAFFIC_OUT sudo iptables -A TRAFFIC_OUT -p tcp sudo iptables -A TRAFFIC_OUT -p udp sudo iptables -A TRAFFIC_OUT -p icmp sudo iptables -A OUTPUT -j TRAFFIC_OUT sudo iptables-save</code> </pre> <br><p>  Das Skript erstellt eine neue Kette TRAFFIC_OUT und f√ºgt ihr Filter f√ºr die erforderlichen Protokolle hinzu: tcp, udp, icmp. </p><br><p>  Die Paketweiterleitung an TRAFFIC_OUT wird der OUTPUT-Kette hinzugef√ºgt. </p><br><p>  Die √ºbertragene Datenmenge kann mit dem Befehl ermittelt werden: </p><br><pre> <code class="plaintext hljs"># iptables -L TRAFFIC_OUT -v -n -x | tail -n 3 | awk '{print $2/1024/1024,"Mb\t\t\t",$3}' : 2.2 Mb tcp 4.4 Mb udp 3.2 Mb icmp</code> </pre> <br><p>  Installieren Sie das Skript als Dienst.  Erstellen Sie dazu eine Datei monitoring.service und verschieben Sie sie in das Verzeichnis <code>/etc/systemd/system</code> unseres Images: </p><br><pre> <code class="plaintext hljs"># /etc/systemd/system/monitoring.service [Unit] After=network.target [Service] ExecStart=/usr/local/bin/monitoring.sh [Install] WantedBy=default.target</code> </pre> <br><p>  Jetzt k√∂nnen Sie den Dienst zum Start hinzuf√ºgen: </p><br><pre> <code class="plaintext hljs">systemctl enable monitoring.service systemctl start monitoring.service</code> </pre> <br><h2>  Instanzverwaltung </h2><br><p>  Kommen wir nun zum (m√∂glichst automatisierten) Remote-Instance-Management. </p><br><p>  Zu diesem Zweck k√∂nnen Sie den <a href="https://aws.amazon.com/ru/cli/">AWS CLI-</a> Mechanismus - Konsolenverwaltung verwenden. </p><br><p>  Erstellen Sie einen <a href="https://console.aws.amazon.com/iam/home%3Fnc2%3Dh_m_sc">geheimen Schl√ºssel</a> (Zugangsschl√ºssel (Zugangsschl√ºssel-ID und geheimer Zugangsschl√ºssel)) und konfigurieren Sie die Konsole. </p><br><p>  Jetzt haben wir Zugriff auf alle Funktionen des Kontos. </p><br><p>  Die Besonderheit bei der Arbeit mit AWS besteht darin, dass alle Aktionen f√ºr eine bestimmte Region ausgef√ºhrt werden und wiederholt werden m√ºssen, wenn mehrere Regionen betroffen sind. </p><br><p>  Um eine neue Instanz aus dem oben erstellten Image zu erstellen (wir gehen davon aus, dass es eine √∂ffentliche Ami-ID gibt, die wir im Skript verwenden), gehen wir wie folgt vor: </p><br><ul><li>  Erstellen Sie einen SSH-Schl√ºssel und f√ºgen Sie ihn zu AWS hinzu: </li></ul><br><pre> <code class="bash hljs">yes n |ssh-keygen -q -t rsa -f <span class="hljs-variable"><span class="hljs-variable">$KEYNAME</span></span> -m pem -N <span class="hljs-string"><span class="hljs-string">""</span></span> &gt; /dev/null chmod 400 <span class="hljs-variable"><span class="hljs-variable">$KEYNAME</span></span> aws ec2 import-key-pair --region <span class="hljs-variable"><span class="hljs-variable">$REGION</span></span> --key-name <span class="hljs-variable"><span class="hljs-variable">$KEYNAME</span></span> --public-key-material file:///$(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>)/<span class="hljs-variable"><span class="hljs-variable">$KEYNAME</span></span>.pub</code> </pre> <br><ul><li>  Erstellen Sie eine Sicherheitsgruppe, die den Zugriff auf den Computer √ºber SSH erm√∂glicht.  Andernfalls werden eingehende SSH-Verbindungen verweigert: </li></ul><br><pre> <code class="bash hljs">SECURITY=<span class="hljs-string"><span class="hljs-string">"ssh-group"</span></span> aws ec2 create-security-group --region <span class="hljs-variable"><span class="hljs-variable">$REGION</span></span> --group-name <span class="hljs-variable"><span class="hljs-variable">$SECURITY</span></span> --description <span class="hljs-string"><span class="hljs-string">"Just ssh. Nothing more"</span></span> IP_RANGE=<span class="hljs-string"><span class="hljs-string">"0.0.0.0/24"</span></span> aws ec2 authorize-security-group-ingress --region <span class="hljs-variable"><span class="hljs-variable">$REGION</span></span> --group-name <span class="hljs-variable"><span class="hljs-variable">$SECURITY</span></span> --protocol tcp --port 22 --cidr <span class="hljs-variable"><span class="hljs-variable">$IP_RANGE</span></span></code> </pre> <br><ul><li>  Erstellen Sie eine Instanz mit dem zuvor erstellten Schl√ºssel und der zuvor erstellten Sicherheitsgruppe und geben Sie die Image-ID an.  Die Anzahl der gleichzeitig erstellten Instanzen kann beliebig sein: </li></ul><br><pre> <code class="bash hljs">IMG=<span class="hljs-string"><span class="hljs-string">'ami-0d0eaed20348a3389'</span></span> NUM=1 aws ec2 run-instances --region <span class="hljs-variable"><span class="hljs-variable">$REGION</span></span> --image-id <span class="hljs-variable"><span class="hljs-variable">$IMG</span></span> --count <span class="hljs-variable"><span class="hljs-variable">$NUM</span></span> --instance-type t2.micro --key-name <span class="hljs-variable"><span class="hljs-variable">$KEYNAME</span></span> --security-groups default <span class="hljs-variable"><span class="hljs-variable">$SECURITY</span></span> &gt; instances.json</code> </pre> <br><ul><li>  Warten Sie, bis die Maschine initialisiert ist.  Dies dauert einige Zeit: Zuerst erhalten wir eine Erfolgsantwort (instance.json), aber zu diesem Zeitpunkt wurde der Computer gerade erstellt, aber noch nicht gestartet (z. B. wurde ihm noch keine IP-Adresse zugewiesen).  Es muss gewartet werden, bis der Start abgeschlossen ist (normalerweise reicht hierf√ºr eine Minute aus). </li></ul><br><p>  Dann k√∂nnen Sie √ºber SSH eine Verbindung herstellen, wenn wir die IP-Adresse kennen.  Fordern Sie einfach eine Liste der derzeit aktiven Maschinen an.  Unter ihren Parametern finden wir PublicDnsName oder PublicIpAddress. </p><br><pre> <code class="bash hljs">aws ec2 describe-instances --region</code> </pre> <br><p>  Als n√§chstes f√ºhren wir die SSH-Befehle aus und geben den oben erstellten SSH-Schl√ºssel an: </p><br><pre> <code class="plaintext hljs">ssh -I $KEYNAME -oStrictHostKeyChecking=no ubuntu''+ins_dns echo''O''</code> </pre> <br><p>  Mit SSH-Befehlen k√∂nnen Sie den Angriff steuern und erhalten alle Informationen √ºber den Status des Angriffs, da wir die Instanzen mit allen erforderlichen Skripten und Tools versehen haben. </p><br><p>  Sie m√ºssen verstehen, dass die meisten Schutzma√ünahmen gegen Denial-of-Service-Angriffe die IP-Adresse blockieren, von der ungew√∂hnlich viele Anforderungen empfangen werden.  Daher m√ºssen sich die IP-Adressen virtueller Maschinen st√§ndig √§ndern, um die Angriffsst√§rke aufrechtzuerhalten. </p><br><p>  AWS weist bei jedem Start der Maschine eine neue IP-Adresse zu.  Um die IP-Adresse zu √§ndern, m√ºssen Sie das Ger√§t aus- und wieder einschalten (es muss nicht entfernt werden!). </p><br><p>  Der Unterschied zwischen Herunterfahren und L√∂schen besteht darin, dass wir unterschiedliche Signale senden.  Stop - ausschalten, beenden - ausschalten und sofort l√∂schen. </p><br><p>  Um den eingehenden Verkehr einer Instanz zu √ºberwachen, verwenden wir den folgenden Befehl mit der Instanz-ID: Wenn die Verkehrsmessung beginnt, wenn sie endet, f√ºr welchen Zeitraum werden die Werte summiert: </p><br><pre> <code class="bash hljs">aws cloudwatch get-metric-statistics --region REGION --namespace AWS/EC2 \ --statistics Sum --metric-name NetworkIn --start-time <span class="hljs-variable"><span class="hljs-variable">$STARTTIME</span></span> --end-time <span class="hljs-variable"><span class="hljs-variable">$FINISHTIME</span></span> --period <span class="hljs-variable"><span class="hljs-variable">$PERIOD</span></span> --dimensions Name=InstanceId,Value=<span class="hljs-variable"><span class="hljs-variable">$INCTANCEID</span></span></code> </pre> <br><h1>  √úberwachung der Serviceverf√ºgbarkeit </h1><br><p>  Um einen Angriff durchzuf√ºhren, m√ºssen Sie au√üerdem beobachten, ob der von uns getestete Dienst aktiv ist. </p><br><p>  Wir erstellen und f√ºhren das einfachste "Ping" -Skript aus, das die Verf√ºgbarkeit der Zielports √ºberwacht (in unserem Fall 53 und 80). </p><br><p>  Beispiel-Python-Code, der die Verf√ºgbarkeitspr√ºfung automatisiert: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">http</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url)</span></span></span><span class="hljs-function">:</span></span> cmd = [<span class="hljs-string"><span class="hljs-string">'curl'</span></span>, <span class="hljs-string"><span class="hljs-string">'-w'</span></span>, <span class="hljs-string"><span class="hljs-string">'"%{time_total}"'</span></span>, <span class="hljs-string"><span class="hljs-string">'-o'</span></span>, <span class="hljs-string"><span class="hljs-string">'/dev/null'</span></span>, <span class="hljs-string"><span class="hljs-string">'-s'</span></span>, url] result = check_output(cmd).decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>) result = float(json.loads(result)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result * <span class="hljs-number"><span class="hljs-number">1000000</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ip, domain)</span></span></span><span class="hljs-function">:</span></span> cmd = [<span class="hljs-string"><span class="hljs-string">'dig'</span></span>, <span class="hljs-string"><span class="hljs-string">'any'</span></span>, <span class="hljs-string"><span class="hljs-string">'@'</span></span>+ip, domain ] result = check_output(cmd).decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>) result = int(result.split(<span class="hljs-string"><span class="hljs-string">'Query time:'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">'msec'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result</code> </pre> <br><p>  Die empfangenen Informationen werden in einer Protokolldatei gespeichert, auf deren Grundlage anhand der Ergebnisse des Angriffs ein Diagramm der Ressourcenverf√ºgbarkeit erstellt werden kann. </p><br><p>  W√§hrend des Testens ist es notwendig, das Ping-Protokoll st√§ndig zu √ºberpr√ºfen, um die Ressource nicht vollst√§ndig und unwiderruflich zu zerst√∂ren.  Sobald eine signifikante Beeintr√§chtigung auftritt und die Antwort auf die Anforderung zu lange dauert, muss der Angriff abgebrochen werden. </p><br><p>  Wenn die Verlangsamung unbedeutend ist und die Angriffskraft das festgelegte Maximum erreicht hat, ist es sinnvoll, ein oder zwei Minuten zu warten, und wenn der Dienst ohne Unterbrechungen weiterarbeitet, wird die √úberpr√ºfung als erfolgreich angesehen. </p><br><h1>  Finanzielles Problem </h1><br><p>  Es lohnt sich, ein weiteres Thema im Zusammenhang mit der Organisation von Tests zu er√∂rtern - die Kosten dieser gesamten Veranstaltung. </p><br><p>  Amazon bietet detaillierte Preisinformationen, aber Sie m√ºssen verstehen, dass Sie f√ºr fast alles bezahlen m√ºssen.  Dennoch k√∂nnen viele Berechnungen vernachl√§ssigt werden.  Zun√§chst lohnt es sich, die Verkehrskosten (abh√§ngig von der Region und davon, wie viele Informationen insgesamt √ºbertragen werden) und die Kosten f√ºr Mietinstanzen (Zahlung pro Minute) zu berechnen.  Diese Gegenst√§nde machen ungef√§hr 99% der Kosten des gesamten Angriffs aus. </p><br><p>  Daher werden die Angriffskosten in Abh√§ngigkeit von der maximalen Angriffskraft und der Anzahl der geplanten Starts jeweils separat berechnet. </p><br><p>  Im Hinblick auf eine Vereinfachung der Berechnungen ist es besser, ein Amazon-Konto zu verwenden, das vor nicht mehr als einem Jahr registriert wurde.  Dann wird ein Teil der Operationen frei sein.  Weitere Informationen zu den Beschr√§nkungen f√ºr die kostenlose Nutzung finden Sie <a href="https://aws.amazon.com/ru/free/%3Fall-free-tier.sort-by%3Ditem.additionalFields.SortRank%26all-free-tier.sort-order%3Dasc">hier</a> . </p><br><p>  Um die Berechnung der Kosten f√ºr die Durchf√ºhrung von Auslastungstests zu veranschaulichen, m√∂chten wir beispielsweise die Stabilit√§t des DNS-Servers bei einer Auslastung von 10 Gbit / s √ºberpr√ºfen. </p><br><p>  Wir wissen, dass Sie mit den verwendeten Tools und den Funktionen der in Mumbai gestarteten t3.small-Instanz 500 MBit / s von einer ausgef√ºhrten Instanz ausgeben k√∂nnen.  Der Preis f√ºr die Anmietung eines Unternehmens betr√§gt 0,0224 USD pro Stunde f√ºr den Datenverkehr - 0,01093 USD f√ºr 1 GB.  Das hei√üt, der H√∂hepunkt des Angriffs bedeutet den gleichzeitigen Betrieb von 20 Einheiten. </p><br><p>  Wir werden die Angriffskraft schrittweise erh√∂hen. Dazu starten wir zuerst eine Entit√§t und f√ºgen dann alle 60 Sekunden eine weitere hinzu. </p><br><p>  Die Formel zur Berechnung der Kosten hat folgende Form: </p><br><pre> <code class="plaintext hljs">60  * (   ) + 60  * 0,5 /c * (  ) =       60 . 1 * (    ) + 2 * (    ) + ... + 20 * (    ) =   </code> </pre> <br><p>  Es stellt sich heraus, dass ein Angriff mit einer Kapazit√§t von 10 Gbit / s auf einen DNS-Server ungef√§hr 70 US-Dollar kostet.  Beachten Sie, dass dies eine grobe Sch√§tzung ist, da das Verkehrsaufkommen nicht genau vorhergesagt werden kann.      <a href="https://aws.amazon.com/ru/ec2/pricing/on-demand/"></a> .  ,   ‚Äì    ,     . </p><br><p>       .          . </p><cut></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de481756/">https://habr.com/ru/post/de481756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de481746/index.html">Einrichten der Umgebung in der CLI. WSL / Windows Terminal</a></li>
<li><a href="../de481748/index.html">Vorteilspaket in Armenien: von der Versicherung √ºber den Empfehlungsbonus bis hin zu Massagen und Darlehen</a></li>
<li><a href="../de481750/index.html">Aufgabennummer 3. Datenkonvertierung und Upload zu Diensten Dritter</a></li>
<li><a href="../de481752/index.html">Ergebnisse der Sprachumfrage</a></li>
<li><a href="../de481754/index.html">Ich Bot und meine Ahle</a></li>
<li><a href="../de481758/index.html">Bau-, Versorgungs- und Besuchsstatistiken der ISS</a></li>
<li><a href="../de481762/index.html">Gleichungen f√ºr die K√ºche unter dem Weihnachtsbaum</a></li>
<li><a href="../de481764/index.html">Warum hat gr√ºne Energie eine schwierige Zukunft?</a></li>
<li><a href="../de481768/index.html">Wir besch√§ftigen uns mit WebKit in 1C, zum Beispiel der Integration von TinyMCE in eine verwaltete Form in UT 11.4</a></li>
<li><a href="../de481770/index.html">Der Computerprogramm-Pionier Tony Brucker stirbt im Alter von 94 Jahren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>