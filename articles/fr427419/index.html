<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™†ğŸ½ ğŸ‘§ğŸ¼ ğŸ‘©ğŸ½â€ğŸ³ Que faire lorsque le processeur n'a rien Ã  faire? ğŸ¿ ğŸ‘¨ğŸ¼ ğŸŒ„</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il serait raisonnable de supposer que pour le noyau, il serait assez facile de ne rien faire - mais ce n'est pas le cas. Lors de la confÃ©rence Kernel ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Que faire lorsque le processeur n'a rien Ã  faire?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427419/"><img src="https://habrastorage.org/getpro/habr/post_images/4d6/056/8ed/4d60568ede6023ffb669539747f5e46f.jpg" align="left">  Il serait raisonnable de supposer que pour le noyau, il serait assez facile de ne rien faire - mais ce n'est pas le cas.  Lors de la confÃ©rence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kernel Recipes 2018</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rafael Vysotsky a</a> parlÃ© de ce que font les processeurs, quand ils n'ont rien Ã  faire, comment le noyau le traite, quelle est sa stratÃ©gie actuelle et comment ses rÃ©cents travaux sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cycle d'inactivitÃ© ont</a> amÃ©liorÃ© la situation Ã©nergÃ©tique des systÃ¨mes qui ne font rien. . <br><br>  Le cycle d'inactivitÃ©, l'un des sous-systÃ¨mes du noyau pris en charge par Vysotsky, contrÃ´le ce que fait le processeur lorsqu'il n'a besoin d'exÃ©cuter aucun processus.  Vysotsky a donnÃ© trÃ¨s prÃ©cisÃ©ment toutes les dÃ©finitions: un processeur est une entitÃ© qui peut recevoir des instructions de la mÃ©moire et les exÃ©cuter simultanÃ©ment avec d'autres entitÃ©s du mÃªme systÃ¨me qui traitent de la mÃªme chose.  Sur le systÃ¨me monoprocesseur le plus simple avec un seul cÅ“ur, ce cÅ“ur est le CPU.  Si le processeur a plusieurs cÅ“urs, chacun de ces cÅ“urs est un processeur.  Si chacun des cÅ“urs possÃ¨de plusieurs interfaces pour exÃ©cuter des instructions simultanÃ©ment - Intel appelle un tel systÃ¨me " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hyperthreading</a> " - alors chacun de ces threads sera un CPU. <br><a name="habracut"></a><br>  Le CPU est inactif lorsqu'il n'a aucune tÃ¢che Ã  effectuer.  Ou, plus prÃ©cisÃ©ment, le noyau Linux possÃ¨de plusieurs classes internes pour la rÃ©partition, dont l'une est une classe inactive spÃ©ciale.  S'il n'y a aucune tÃ¢che sur ce CPU dans aucune des classes, Ã  l'exception de la classe d'inactivitÃ©, le CPU est considÃ©rÃ© comme inactif.  Si l'Ã©quipement ne le permet pas, le CPU devra exÃ©cuter des instructions inutiles jusqu'Ã  ce que le vrai travail se prÃ©sente.  Cependant, il s'agit d'une utilisation extrÃªmement inefficace de l'Ã©lectricitÃ©, c'est pourquoi la plupart des processeurs prennent en charge plusieurs Ã©tats Ã  faible Ã©nergie dans lesquels le cÅ“ur les transfÃ¨re jusqu'Ã  ce qu'ils soient nÃ©cessaires pour effectuer un travail utile. <br><br>  Vous ne pouvez pas simplement entrer ou sortir d'un Ã©tat d'inaction.  Il faut du temps pour entrer et sortir, et en outre, lorsque vous entrez dans cet Ã©tat, la consommation d'Ã©nergie de l'Ã©tat actuel augmente lÃ©gÃ¨rement et lorsque vous le quittez, il consomme l'Ã©tat dans lequel le processeur entre.  Et bien que plus l'Ã©tat d'inactivitÃ© est profond, moins le processeur consomme d'Ã©nergie, le coÃ»t d'entrÃ©e et de sortie dans de tels Ã©tats augmente.  Cela signifie que dans le cas de courtes pÃ©riodes d'inactivitÃ©, la meilleure utilisation des ressources informatiques sera une inaction superficielle;  pour des pÃ©riodes plus longues, le coÃ»t du passage Ã  un Ã©tat d'inaction plus profond sera justifiÃ© par une augmentation de la quantitÃ© d'Ã©nergie Ã©conomisÃ©e.  Par consÃ©quent, il est dans l'intÃ©rÃªt du noyau de prÃ©dire combien de temps le processeur sera inactif avant de dÃ©cider de la profondeur de l'Ã©tat d'inactivitÃ© dont il a besoin.  C'est la tÃ¢che du cycle d'inaction. <br><br>  Dans ce cycle, le planificateur remarque que le CPU est inactif, car il n'a aucune tÃ¢che qui pourrait lui Ãªtre affectÃ©e.  Ensuite, l'ordonnanceur appelle le rÃ©gulateur, qui essaie de donner la meilleure prÃ©diction de l'Ã©tat d'inaction appropriÃ©, que vous pouvez entrer.  Maintenant, dans le noyau, il y a deux contrÃ´les, le menu et l'Ã©chelle.  Ils sont utilisÃ©s dans diffÃ©rents cas, mais les deux essaient de faire Ã  peu prÃ¨s la mÃªme chose: pour surveiller l'Ã©tat du systÃ¨me lorsque le processeur passe en mode inactif et le temps qu'il a passÃ© en inactivitÃ©.  Ceci est fait afin de prÃ©dire combien de temps le CPU entrera dans un Ã©tat inactif et, par consÃ©quent, quel Ã©tat est le mieux adaptÃ© Ã  cette situation. <br><br>  Ce travail est particuliÃ¨rement compliquÃ© par le temporisateur du programmateur CPU.  Le planificateur dÃ©marre ce temporisateur pour partager le temps d'accÃ¨s au CPU: si plusieurs tÃ¢ches doivent Ãªtre effectuÃ©es sur un processeur, chacune d'elles ne peut Ãªtre exÃ©cutÃ©e que peu, puis reportÃ©e pÃ©riodiquement au profit d'une autre tÃ¢che.  Ce temporisateur n'a pas besoin d'Ãªtre exÃ©cutÃ© sur un processeur inactif, car il n'y a pas de tÃ¢ches entre lesquelles le processeur doit Ãªtre divisÃ©.  De plus, si le temporisateur est autorisÃ© Ã  s'exÃ©cuter sur un processeur inactif, cela empÃªchera le contrÃ´leur de sÃ©lectionner des Ã©tats de ralenti profond, limitant les intervalles pendant lesquels le processeur est inactif.  Par consÃ©quent, dans les noyaux jusqu'Ã  4.16, le planificateur a dÃ©sactivÃ© le temporisateur avant d'appeler le rÃ©gulateur.  Lorsque le CPU s'est rÃ©veillÃ© lors d'une interruption, le planificateur a dÃ©cidÃ© s'il y avait des tÃ¢ches nÃ©cessaires Ã  l'exÃ©cution et, le cas Ã©chÃ©ant, a redÃ©marrÃ© le temporisateur. <br><br>  Si le contrÃ´leur prÃ©dit une longue pÃ©riode d'inactivitÃ©, et que cette pÃ©riode s'avÃ¨re vraiment longue, alors le contrÃ´leur Â«gagneÂ»: le CPU entre dans un Ã©tat d'inactivitÃ© profonde et l'Ã©nergie est Ã©conomisÃ©e.  Mais si le rÃ©gulateur prÃ©dit une longue pÃ©riode d'inactivitÃ©, et que cette pÃ©riode s'avÃ¨re courte, alors le rÃ©gulateur Â«perdÂ», car le coÃ»t d'entrer dans une inaction profonde ne paie pas en Ã©conomisant de l'Ã©nergie pour une courte pÃ©riode d'inactivitÃ©.  Pire encore, lorsque le rÃ©gulateur prÃ©dit un court temps d'arrÃªt, il Â«perdÂ» quel que soit le temps d'arrÃªt: si la pÃ©riode s'est avÃ©rÃ©e longue, il a ratÃ© l'opportunitÃ© d'Ã©conomiser, et s'il Ã©tait court, les coÃ»ts d'arrÃªt et de redÃ©marrage de la minuterie Ã©taient perdus.  Ou, en d'autres termes, Ã©tant donnÃ© que les ressources sont dÃ©pensÃ©es pour arrÃªter et dÃ©marrer le minuteur, cela n'a aucun sens de l'arrÃªter lorsque le contrÃ´leur prÃ©dit un court temps d'arrÃªt. <br><br>  Vysotsky a dÃ©cidÃ© d'essayer de changer le fonctionnement du rÃ©gulateur, mais est parvenu Ã  la conclusion que le principal problÃ¨me est que la minuterie est arrÃªtÃ©e avant l'appel du rÃ©gulateur, c'est-Ã -dire avant que l'Ã©tat d'inactivitÃ© recommandÃ© ne soit connu.  Il a renvoyÃ© un cycle d'inactivitÃ© dans le noyau 4.17 afin que la dÃ©cision d'arrÃªter le temporisateur soit prise aprÃ¨s que le rÃ©gulateur a fait sa recommandation.  S'il prÃ©dit un long temps d'arrÃªt, le chronomÃ¨tre s'arrÃªte pour ne pas rÃ©veiller le CPU Ã  l'avance.  Si le temps d'arrÃªt est supposÃ© Ãªtre court, le temporisateur est laissÃ© de maniÃ¨re Ã  ne pas gaspiller les ressources lors des arrÃªts.  Cela signifie que le temporisateur remplit Ã©galement une fonction de sÃ©curitÃ©, rÃ©veillant le CPU si le temps d'arrÃªt s'avÃ¨re plus long que prÃ©vu et donnant au rÃ©gulateur une seconde chance pour la bonne dÃ©cision. <br><br>  Lorsqu'un processeur inactif se rÃ©veille par une interruption, qu'il s'agisse d'un minuteur imparable ou d'un autre Ã©vÃ©nement, le planificateur prend immÃ©diatement une dÃ©cision quant Ã  la disponibilitÃ© du travail.  S'il y a du travail, la minuterie redÃ©marre si nÃ©cessaire.  Sinon, le contrÃ´leur est appelÃ©.  Comme cela signifie que le rÃ©gulateur peut maintenant Ãªtre appelÃ© Ã  la fois lorsque la minuterie fonctionne et lorsqu'il ne fonctionne pas, le rÃ©gulateur doit Ãªtre appelÃ© pour en tenir compte. <br><br>  AprÃ¨s avoir Ã©tudiÃ© le tableau des victoires et des dÃ©faites, Vysotsky estime que ses changements amÃ©lioreront l'image.  Dans le cas de la prÃ©vision d'une longue pÃ©riode d'inactivitÃ©, la minuterie s'arrÃªte toujours, donc rien ne change ici;  nous gagnons si le temps d'arrÃªt est long et nous perdons s'il est court.  Mais si une courte pÃ©riode d'indisponibilitÃ© est prÃ©vue, nous gagnons: si la pÃ©riode s'avÃ¨re vraiment courte, nous Ã©conomiserons sur l'arrÃªt et le dÃ©marrage de la minuterie, et si elle est longue, une minuterie non arrÃªtÃ©e nous rÃ©veillera et nous donnera l'opportunitÃ© de faire une autre prÃ©diction. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/989/c12/2dc/989c122dcc3ec2c085e65f4e057c05a0.jpg"></div><br>  Ã‰tant donnÃ© que la thÃ©orie des jeux ne peut pas remplacer complÃ¨tement la situation rÃ©elle, Vysotsky a testÃ© cette approche sur de nombreux systÃ¨mes.  Le graphique ci-dessus est typique pour tous les systÃ¨mes testÃ©s;  il montre la dÃ©pendance temporelle de la consommation d'Ã©nergie sur un systÃ¨me inactif.  La ligne verte est l'ancien cycle d'inaction, la ligne rouge est la nouvelle.  Selon le nouveau schÃ©ma, moins d'Ã©nergie est consommÃ©e, en plus, elle est plus prÃ©visible.  Tous les processeurs testÃ©s n'ont pas un si grand Ã©cart entre les lignes, mais ils ont tous montrÃ© une ligne rouge plate sous un vert inÃ©gal.  Comme l'a dit Vysotsky, ce nouveau schÃ©ma est moins susceptible de prÃ©dire de courtes pÃ©riodes d'inactivitÃ©, mais le plus souvent, il se rÃ©vÃ¨le juste quant Ã  leur courte durÃ©e. <br><br>  RÃ©pondant Ã  une question du public, Vysotsky a dÃ©clarÃ© que ce travail dÃ©pend de l'architecture.  En particulier, les processeurs Intel en bÃ©nÃ©ficieront, car ils ont une gamme assez large d'Ã©tats d'inactivitÃ© parmi lesquels le rÃ©gulateur peut choisir celui qui lui donnera les meilleures chances de succÃ¨s si la prÃ©diction est correcte;  mais les processeurs ARM bÃ©nÃ©ficieront Ã©galement des nouveaux circuits. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/648/97d/331/64897d33160279143469c00ef7041157.png"></div><br>  Une baisse de 20% de la consommation d'Ã©nergie au repos peut sembler insignifiante, mais ce n'est pas le cas.  Tout systÃ¨me qui veut faire face assez bien aux charges de pointe devrait avoir une rÃ©serve de puissance en mode normal, qui se manifestera pendant l'inactivitÃ©.  Le graphique ci-dessus montre l'utilisation du processeur pour l'annÃ©e sur mon serveur, qui traite du courrier, du transfert de fichiers, du VPN, du NTP, etc.  Le jaune signifie le temps simple.  Ã‰conomiser 20% de cette Ã©nergie serait apprÃ©ciÃ© par mon fournisseur, et pour la planÃ¨te, ce serait mieux. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427419/">https://habr.com/ru/post/fr427419/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427407/index.html">MÃ©ta-clustering avec minimisation des erreurs, et pourquoi je pense que le cerveau fonctionne de cette faÃ§on</a></li>
<li><a href="../fr427409/index.html">Le livre "The Brilliant Agile. Gestion de projet flexible avec Agile, Scrum et Kanban Â»</a></li>
<li><a href="../fr427413/index.html">Lutter pour les ressources, partie 4: grand</a></li>
<li><a href="../fr427415/index.html">Nous utilisons Node.js pour travailler avec des fichiers volumineux et des ensembles de donnÃ©es brutes.</a></li>
<li><a href="../fr427417/index.html">Avec de l'humour sur des disquettes de 8 pouces (dans les annÃ©es 70, il n'y en avait que)</a></li>
<li><a href="../fr427421/index.html">Comment les sites de gÃ©nÃ©alogie facilitent la capture des tueurs</a></li>
<li><a href="../fr427423/index.html">City2Share: voitures Ã©lectriques et autonomes dans les pÃ´les logistiques de Munich</a></li>
<li><a href="../fr427427/index.html">Comment ils arrivent Ã  l'informatique: Ã  propos des stagiaires et des joons (rÃ©sultat du sondage Â«My CircleÂ»)</a></li>
<li><a href="../fr427429/index.html">Framework GUI - par thread</a></li>
<li><a href="../fr427431/index.html">Fonctionnement d'Android, partie 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>