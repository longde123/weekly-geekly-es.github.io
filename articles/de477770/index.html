<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘‰ğŸ¼ ğŸ‘¨ğŸ¾â€ğŸ’¼ ğŸ‘©ğŸ¾ Mach das Licht durch die Kraft des Denkens an, na ja, fast ğŸ‘„ ğŸ‘©ğŸ»â€ğŸ³ ğŸ…</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Schreiben von Algorithmen ist wahrscheinlich der interessanteste Teil fÃ¼r mich in der Heimautomation. Aber selbst die ganze Masse an Sensoren und ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mach das Licht durch die Kraft des Denkens an, na ja, fast</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477770/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/v6/5s/kh/v65skhw1ssde-bikgplmz-ntc8e.jpeg" alt="KDPV"></div><br>  Das Schreiben von Algorithmen ist wahrscheinlich der interessanteste Teil fÃ¼r mich in der Heimautomation.  Aber selbst die ganze Masse an Sensoren und Skripten kann die Ã¼berbordende Fantasie des Lebens nicht bewÃ¤ltigen und Sie mÃ¼ssen einen Weg finden, um die Kontrolle zu lenken.  Als manuelle Steuerung kÃ¶nnen Sie eine gewÃ¶hnliche TÃ¼rklingel einsetzen, aber was ist, wenn Sie mehr wollen?  Wir treffen den Helden dieses Artikels - einen Gesten-Sensor, der auf SI1143 von Silicon Labs basiert. <br><a name="habracut"></a><br>  SI1143 selbst: <br><br><img src="https://habrastorage.org/webt/3l/a5/hz/3la5hzxcweqdhstg7x_67dpbx5y.jpeg" alt="SI1143"><br><br>  Es sieht wirklich futuristisch aus. <br><br>  Und wie viele Vorteile: <br><br><ul><li>  hochempfindliche Fotodiode, rauscharmer ADC </li><li>  LED-Treiber mit StrÃ¶men von 6 bis 360 Milliampere </li><li>  Stromversorgung von 1,71 bis 3,6 Volt </li><li>  und Smart I2C - bis zu 3,4 Megabit pro Sekunde </li></ul><br>  Das ist nur die GrÃ¶ÃŸe, die nur 5 mal 3 Millimeter hochgepumpt wird.  Dies ist nicht das erste Mal, dass Sie es sehen.  Nun, hier brauchen Sie ein bisschen mehr Riemen. <br><br><img src="https://habrastorage.org/webt/qd/gt/h2/qdgth25drlqtfixzko3e-cijooy.png" alt="GerÃ¤t"><br><br>  Kann das entfernt werden?  Fragte mich mein SchÃ¶nheitsgefÃ¼hl.  Dann werde ich versuchen, die Bitte dieses seltenen Gastes in unserer Gegend zu befriedigen und die Tafel im GebÃ¤ude zu verstecken, aber in der Zwischenzeit kÃ¶nnen Sie Strom anlegen und sehen, was passiert ist. <br><blockquote>  Kommentar fÃ¼r den aufmerksamen.  Es gibt wirklich ein paar mehr Details als erwartet.  Der Knoten aus dem Enviriot-Projekt wurde als Basis genommen.  Neben dem Mikrocontroller STM32F051 verfÃ¼gt die Karte auch Ã¼ber einen 868-Megahertz-CC1101-Transceiver von Texas Instruments. Nach dem AusfÃ¼llen der Firmware reicht die Stromversorgung aus, und das GerÃ¤t wird mit dem MQTT-SN-Server verbunden. <br></blockquote><hr><br>  Das Funktionsprinzip basiert auf der Messung des Pegels des reflektierten Signals von jeder der 3 LEDs.  Ich werde versuchen, es einzuschalten und mir die Antwort anzusehen. <br><br><img src="https://habrastorage.org/webt/8n/ga/gr/8ngagr4kxddscblrnp01j7l-lbk.png" alt="signalisieren"><br><br>  Aufgrund der asymmetrischen Anordnung der LEDs ist das Signal von LED 1 deutlich grÃ¶ÃŸer und die Messergebnisse mÃ¼ssen erst normalisiert werden. <br><br><img src="https://habrastorage.org/webt/ac/qq/yf/acqqyfb0cuibrsjuq0xu_hripqo.png" alt="signal_norm"><br><br>  Und so ist die AbhÃ¤ngigkeit schon ganz verstÃ¤ndlich.  Ich werde versuchen, den folgenden Algorithmus zu codieren: <br><div class="scrollable-table"><table><tbody><tr><th></th><th>  A </th><th>  B </th><th>  C </th><th>  D </th></tr><tr><td>  ===&gt; <br></td><td>  L1 + <br>  L3 + <br>  L1&gt; L3 </td><td>  L1- <br>  L3 + <br>  L1&gt; L3 </td><td>  L1- <br>  L3 + <br>  L1&gt; L3 </td><td>  L1- <br>  L3- <br>  L1 &lt;L3 </td></tr><tr><td>  &lt;=== <br></td><td>  L1- <br>  L3- <br>  L1 &lt;L3 </td><td>  L1 + <br>  L3- <br>  L1 &lt;L3 </td><td>  L1 + <br>  L3- <br>  L1 &lt;L3 </td><td>  L1 + <br>  L3 + <br>  L1&gt; L3 </td></tr></tbody></table></div><br>  Wenn L1 + - das Signal von LED 1 ansteigt, ist L1&gt; L3 - das Signal von LED 1 grÃ¶ÃŸer als das Signal von LED 3. <br><br>  Es war glatt auf dem Papier, aber in der Dynamik begannen Probleme.  FÃ¼r ein weiÃŸes Blatt Papier, das auf derselben HÃ¶he fixiert war, wurden die erwarteten Ergebnisse in zwei von drei FÃ¤llen erhalten.  Wenn ich versuche, mit den HÃ¤nden zu winken, beginnt das Signal zu springen und mein wunderbarer Algorithmus beginnt, in den Messwerten durcheinander zu kommen.  Er sah auf seine Hand, aber es gibt viele Unterschiede zu einem flachen weiÃŸen Blatt Papier.  Aber irgendwie sollte es funktionieren.  Ok  Ãœberredet!  Ich werde versuchen, die Dokumentation zu lesen. <br><br><hr><br>  FÃ¼r die Betroffenen hat Silicon Labs AppNote AN580 - "INFRARED GESTURE SENSING" verÃ¶ffentlicht.  Es werden zwei grundlegende Methoden zur Bestimmung von Gesten und deren mÃ¶glichen Kombinationen beschrieben.  Die erste Methode ist die Bestimmung der Position zu jedem Zeitpunkt und die Bestimmung von Gesten basierend auf den Koordinaten.  Die zweite Methode bestimmt die Phasenverschiebung zwischen den Signalen.  Eine der Varianten der ersten Methode wurde bereits getestet und war nicht beeindruckend.  Ich werde versuchen, die zweite umzusetzen. <br><br>  Lass uns gehen.  Es mÃ¼ssen bis zu zwei Punkte implementiert werden.  Bestimmen Sie den Zeitpunkt der Eingabe und Ã¼bertragen Sie diese Daten in die Zustandsmaschine.  Die Eingangsschwelle wurde experimentell zu 1/8 des Gesamtsignals bestimmt.  Zum Schutz vor LÃ¤rm werde ich den Schmidt-Trigger hinzufÃ¼gen, der sich um 15% einschaltet und sich um 10% ausschaltet. <br><br>  Nun, die Staatsmaschine selbst.  ZustÃ¤nde 1 bis 3 - AufwÃ¤rtsbewegung, ZustÃ¤nde -1 bis -3 - AbwÃ¤rtsbewegung und Zustand 4 fÃ¼r den unwahrscheinlichen Fall, dass beide LEDs gleichzeitig arbeiten. <br><br><img src="https://habrastorage.org/webt/nu/td/gs/nutdgsnfzqqmob6zd_tpc6ylnzu.png" alt="ka"><br><br>  Nun wollen wir versuchen, mit all dem davonzukommen. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> LSt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int8Array</span></span>([<span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>]); <span class="hljs-comment"><span class="hljs-comment">/* ...... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r1 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r3 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.button = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Int8(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* ...... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(n1 &gt; <span class="hljs-number"><span class="hljs-number">15</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(n1 &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r1 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(n3 &gt; <span class="hljs-number"><span class="hljs-number">15</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r3 = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(n3 &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r3 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> st = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r1?<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>) | (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r3?<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(st == <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-comment"><span class="hljs-comment">// .      this.button = 0; } else { this.button = LSt[st*8 + this.button - 5]; }</span></span></code> </pre> <br>  Die Variablen n1 und n3 enthalten normierte Werte fÃ¼r die entsprechenden LEDs.  Das Ergebnis befindet sich im Feld "SchaltflÃ¤che". <br><br>  FÃ¼r die weitere Verwendung sind die ZustÃ¤nde 2 - auf und -2 - ab nÃ¼tzlich. <br><br>  Das Programm wird in eine Teilmenge von JavaScript geschrieben, dann in Bytecode kompiliert und auf das GerÃ¤t hochgeladen.  JavaScript wird analysiert und der AST wird von der NiL.JS-Bibliothek des Genossen <a href="https://habr.com/ru/users/iaiojek/" class="user_link">IaIojek generiert</a> , wofÃ¼r er sich sehr <a href="https://habr.com/ru/users/iaiojek/" class="user_link">bedankt</a> . <br><br><img src="https://habrastorage.org/webt/bo/q1/-h/boq1-hroa90suwbentkltmxa9xu.png" alt="Logramm"><br><br>  Wenn der Zustand 2 kÃ¼rzer als 0,3 Sekunden dauert, sind die Bausteine â€‹â€‹A14 und A15 dafÃ¼r verantwortlich, die Helligkeit wird auf das Maximum gesetzt.  Die BlÃ¶cke A01 und A13 setzen die Helligkeit fÃ¼r eine kurze AbwÃ¤rtsbewegung auf 0. <br><br>  Beim Hochfahren und Halten sorgen die BlÃ¶cke A10, A09 und A04 fÃ¼r einen gleichmÃ¤ÃŸigen Helligkeitsanstieg.  Wenn Sie gedrÃ¼ckt halten, arbeiten die BlÃ¶cke A12, A11 und A08 und ermÃ¶glichen es Ihnen, den Pegel zu verringern. <br><br><div class="spoiler">  <b class="spoiler_title">Demonstration der Arbeit.</b>  <b class="spoiler_title">20 Megabyte GIF.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/38a/35d/cad/38a35dcad7ba7d1ab74b0dbc1271be96.gif" alt="Demo"><br></div></div><br>  Nun, vielleicht ist das alles.  Der Kunde ist glÃ¼cklich und ich beginne Ã¼ber die nÃ¤chste Version nachzudenken.  Bei den erforderlichen Ã„nderungen: Platzieren Sie die LEDs im gleichen Abstand zum EmpfÃ¤nger, zeigen Sie die Betriebsanzeige an und fÃ¼hren Sie eine Abfrage auf einem separaten Controller durch, wodurch sich das Abfrageintervall verkÃ¼rzt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de477770/">https://habr.com/ru/post/de477770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de477756/index.html">Wie wir zwei Banking-CRM-Systeme heirateten</a></li>
<li><a href="../de477758/index.html">"Doktor, entfernen Sie dies von der Rechnung": wie wir nach illegalen Diensten in VHI gesucht haben</a></li>
<li><a href="../de477760/index.html">SberX RamblerFront & Meet Up: wie es war</a></li>
<li><a href="../de477766/index.html">Anwendung des VerschlÃ¼sselungsmodus von SL3 MIfare-Karten am Beispiel eines Unternehmens</a></li>
<li><a href="../de477768/index.html">Die Geschichte von Vim und eine Anleitung zu seiner effektiven Verwendung</a></li>
<li><a href="../de477774/index.html">Designtreffen im St. Petersburger BÃ¼ro von Wrike 5. Dezember</a></li>
<li><a href="../de477778/index.html">Geschichte des Videoprozessors, Teil 2: 3Dfx Voodoo</a></li>
<li><a href="../de477780/index.html">Schreiben Sie Ihre eigene CLI fÃ¼r React</a></li>
<li><a href="../de477782/index.html">DJI Mavic Mini und das Gesetz</a></li>
<li><a href="../de477786/index.html">Smartphone statt Datenerfassungsterminal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>