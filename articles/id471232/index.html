<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§˜ğŸ¼ ğŸ§¦ ğŸ•‰ï¸ Pengalaman saya menghubungkan LPS331AP ke Omega Onion2 ğŸ‘©ğŸ¼â€ğŸ”§ ğŸ¢ ğŸ‘¨ğŸ»â€ğŸŒ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat siang, Habrovsk! 

 Pengantar singkat 
 Suatu hari saya menjadi pemilik bahagia dari salah satu pemain papan tunggal terkecil yang bekerja pad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengalaman saya menghubungkan LPS331AP ke Omega Onion2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471232/">  Selamat siang, Habrovsk! <br><br><h4>  Pengantar singkat </h4><br>  Suatu hari saya menjadi pemilik bahagia dari salah satu pemain papan tunggal terkecil yang bekerja pada LEDE, dan hal pertama yang ingin saya lakukan (setelah mengedipkan LED) adalah stasiun cuaca rumah, yang dapat diakses dari mana saja.  Langkah pertama adalah mengambil data tentang suhu, kelembaban dan tekanan.  Untuk ini, sensor <b>DHT11</b> dan <b>LPS3311AP yang</b> dibeli sebelumnya dipilih (foto di bawah potongan). <br><br><div class="spoiler">  <b class="spoiler_title">Foto untuk mereka yang tertarik</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-g/5z/mk/-g5zmk6kgvu0yhab0e_bz7j0g5y.jpeg" alt="gambar"></div></div><br>  Setelah google singkat, ternyata jika keluarga pertama didokumentasikan dengan baik dan memiliki banyak perpustakaan untuk bekerja, maka barometer yang saya pilih tidak begitu populer kecuali untuk perpustakaan yang ditulis sendiri (walaupun sangat berkualitas tinggi) untuk toko Arduino di mana sensor dibeli (bukan iklan, hanya sebuah penghormatan), tidak ada yang dapat ditemukan. <br><br>  Pilihan apa yang tersisa? <br><br><ol><li>  <i>Kumpulkan layer pada mikrokontroler ATmega328, flash, isi kode yang sudah jadi dan bacalah darinya.</i>  Sangat mengasyikkan, tetapi sepertinya mencoba merakit sepeda untuk digunakan nanti sebagai penopang. </li><li>  <i>Baca "secara manual" dengan I2C, mengandalkan lembar data resmi</i> .  Saya mencoba, itu mungkin, tetapi saya tidak ingin menghasilkan skrip bash dan tampaknya tidak sesuai secara metodologi. </li><li>  <i>Tulis <b>perpustakaan</b></i> untuk bekerja dengan sensor seperti yang Anda inginkan. </li></ol><br>  Jika Anda tertarik pada bagaimana itu datang dan apa yang terjadi, selamat datang di kucing. <br><a name="habracut"></a><br>  Pertanyaan pertama yang saya temui adalah pilihan bahasa.  Dari apa yang berhasil di papan tunggal ini tanpa menari dengan rebana - C ++ dan Python.  Karena di masa depan saya ingin menempatkan proyek ini di jantung rumah pintar untuk diri saya sendiri, pilihan ada pada yang terakhir. <br><br>  Karena efek itik, saya tidak mengajukan pertanyaan berikutnya (versi mana) dan segera memasukkan python3 ringan dan perpustakaan untuk bekerja dengan bus I2C. <br><br>  Kemudian ada jam merokok, pertama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lembar data</a> , kemudian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">panduan perangkat lunak</a> dari produsen.  Mereka memungkinkan untuk mempersiapkan sensor dengan cepat untuk operasi (meskipun panduan perangkat lunak ternyata lebih lengkap, termasuk mengenai rekomendasi untuk memeriksa penyelesaian pengukuran dan "mengatur ulang" sensor untuk pengumpulan yang lebih akurat. <br><br>  Kesulitan pertama yang saya temui adalah membaca data.  Karena data dari termometer ditransmisikan dalam dua byte, dan tekanan dalam tiga, perlu untuk mendapatkan beberapa byte dan menggabungkannya menjadi satu nomor besar.  Tapi python akan mengkonversi hex ke int secara default, dan penggabungan sederhana tidak berfungsi.  Konversi int ke hex mengembalikan string yang digabung sempurna tetapi tidak dikonversi kembali ke angka.  Jalan keluar?  Mungkin saja untuk menghubungkan dukungan untuk tipe-c, tetapi saya tidak ingin dipusingkan, serta menyumbat memori dengan perpustakaan tambahan, jadi diputuskan untuk menulis fungsi pada 7 (sebenarnya 8, jika kita menghitung kamus) baris untuk menerjemahkan string pseudo-byte ke angka. <br><br><div class="spoiler">  <b class="spoiler_title">Hex berisi string ke int</b> <div class="spoiler_text"><pre><code class="python hljs">s_t_h = { <span class="hljs-string"><span class="hljs-string">'0'</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'4'</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'5'</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'6'</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'7'</span></span> : <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'8'</span></span> : <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'9'</span></span> : <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span> : <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span> : <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span> : <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">'d'</span></span> : <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-string"><span class="hljs-string">'e'</span></span> : <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-string"><span class="hljs-string">'f'</span></span> : <span class="hljs-number"><span class="hljs-number">15</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__string_to_int</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, hex_string)</span></span></span><span class="hljs-function">:</span></span> l = len(hex_string) - <span class="hljs-number"><span class="hljs-number">1</span></span> res = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> h <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hex_string: res += s_t_h[h] * (<span class="hljs-number"><span class="hljs-number">16</span></span> ** l) l -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res</code> </pre> <br>  Saya percaya bahwa pertanyaan "mengapa membaca dari kamus?" Dapat ditanyakan di sini.  jawabannya sederhana - tidak terpikir oleh saya untuk membuat keputusan yang jelas tentang tipe casting, jika para ahli memiliki jawaban untuk pertanyaan ini, saya akan dengan senang hati melakukan perubahan. <br></div></div><br>  Kesulitan kedua yang membingungkan saya adalah interpretasi data.  Kedua dokumen di atas memberikan rumus yang sangat sederhana untuk konversi: <br><br>  <code>Pout(mbar)=(PRESS_OUT_H &amp; PRESS_OUT_L &amp; PRESS_OUT_XL)[dec] / 4096</code> untuk tekanan; <br>  <code>T(degC) = 42.5 + (Temp_OUTH &amp; TEMP_OUT_L)[dec] / 480</code> untuk suhu. <br><br>  Apa yang menyenangkan, mereka langsung menawarkan sistem metrik. <br><br>  Namun, pendekatan pertama dengan keras kepala memberi saya hasil 0x2F8000, yang berarti 760 milibar atau sekitar 585 mmHg.  Seni  Untuk ketinggian 130 meter di atas permukaan laut, ini jelas tidak cukup.  Memeriksa ulang kode, membaca kembali informasi tentang pengukuran tekanan, me-reboot sensor dan bermain dengan akurat tidak memberikan apa-apa.  Tetapi studi berulang dari pedoman ini membantu - stabil 760 mbar diartikan sebagai sinyal bahwa sensornya salah.  Pembaca yang hati-hati melihat foto yang terlampir di awal artikel dapat memastikan bahwa sensor, pada prinsipnya, tidak ada pada chip :) Untungnya, saya dengan cepat membeli dua dari mereka sekaligus. <br><br><div class="spoiler">  <b class="spoiler_title">Foto chip kerja dan operasi yang tepat</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/7v/jy/z5/7vjyz5w10xg9qsd58stxhj1rakg.jpeg"><br><br>  Kotak hitam kecil di tengah adalah pelat pengukur HCLGA-16L, "jantung" sensor. <br><br><img src="https://habrastorage.org/webt/gu/tt/om/guttom3d5dczqqgbikz4d1xocug.png" alt="gambar"></div></div><br>  Setelah penemuan ini, menjadi jelas bahwa pemeriksaan kesehatan harus dilakukan.  Jadi fungsi lahir: <br><br><div class="spoiler">  <b class="spoiler_title">periksa kerja</b> <div class="spoiler_text"><pre> <code class="python hljs">BROKEN_MARKER = <span class="hljs-number"><span class="hljs-number">0x2f8000</span></span>/<span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__working_check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, address)</span></span></span><span class="hljs-function">:</span></span> c1 = self.__read_pressure(address) c2 = self.__read_pressure(address) c3 = self.__read_pressure(address) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> c1 == c2 == c3 == BROKEN_MARKER: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br>  Untuk menghindari kasus positif palsu yang jarang, tetapi masih berpeluang terjadi, pembacaan dilakukan tiga kali dan hanya setelah itu dikeluarkan vonis ketidakberoperasian.  Dimungkinkan untuk menggunakan konstanta secara berlebihan dalam kode seperti itu, tetapi nada yang baik harus diperhatikan kapan pun memungkinkan. <br></div></div><br>  Segera muncul ide di benak saya bahwa tidak akan buruk selama inisialisasi untuk memeriksa apakah alamat di bus sudah benar, dan fungsi <b>__deviceAdressCheck</b> ditambahkan, yang memeriksa register <b>WHO_AM_I</b> dan <b>berharap</b> menerima nomor yang didambakan 0xBB. <br><br>  Mengenai hal ini, tampaknya, tidak ada poin yang lebih menarik.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kode</a> lengkap tersedia di github dan tersedia untuk digunakan dan dimodifikasi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id471232/">https://habr.com/ru/post/id471232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id471216/index.html">Sejarah panjang buku panduan - bagaimana saya menulis layanan untuk jalur pendakian yang cerdas selama 5 tahun</a></li>
<li><a href="../id471220/index.html">Cockpit - menyederhanakan tugas administrasi tipikal di Linux melalui antarmuka web yang nyaman</a></li>
<li><a href="../id471222/index.html">Memahami kebijakan privasi aplikasi dan layanan akan membantu jaringan saraf</a></li>
<li><a href="../id471226/index.html">Linux memiliki banyak wajah: cara bekerja pada distribusi apa pun</a></li>
<li><a href="../id471228/index.html">Grokay PyTorch</a></li>
<li><a href="../id471236/index.html">Dosimeter untuk Seryozha. Bagian III. Radiometer nasional</a></li>
<li><a href="../id471240/index.html">"Bitchy Betty" dan antarmuka audio modern: mengapa mereka berbicara dengan suara wanita?</a></li>
<li><a href="../id471242/index.html">Pengantar Bash Shell</a></li>
<li><a href="../id471244/index.html">Kode Rosetta: mengukur panjang kode dalam sejumlah besar bahasa pemrograman, mempelajari kedekatan bahasa satu sama lain</a></li>
<li><a href="../id471248/index.html">Regulator AS melarang distribusi token Telegram Open Network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>