<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯУЫ ЁЯШ╜ ЁЯП╗ рддреАрди.js - рдЕрдВрддрд░рд┐рдХреНрд╖ рдпрд╛ рддрд╛рд░рд╛рдордВрдбрд▓ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдВрддреНрд░рдг рдХрд░рддреЗ рд╣реИрдВ ЁЯСГЁЯП╗ ЁЯСйЁЯП╝тАНЁЯЪТ ЁЯСиЁЯП╛тАНЁЯОд</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЕрдВрддрд░рд┐рдХреНрд╖ рдХреЗ рд╡рд┐рд╖рдп рдкрд░ рдЕрдкрдиреА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рд╡рд┐рдХрд╛рд╕ рдХрд░рддреЗ рд╕рдордп, рдореИрдВ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдЖрдпрд╛ рдХрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рддреАрди.js рдореЗрдВ рдРрд╕реЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рддреИрдпрд╛рд░ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рддреАрди.js - рдЕрдВрддрд░рд┐рдХреНрд╖ рдпрд╛ рддрд╛рд░рд╛рдордВрдбрд▓ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдВрддреНрд░рдг рдХрд░рддреЗ рд╣реИрдВ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435974/">  рдЕрдВрддрд░рд┐рдХреНрд╖ рдХреЗ рд╡рд┐рд╖рдп рдкрд░ рдЕрдкрдиреА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рд╡рд┐рдХрд╛рд╕ рдХрд░рддреЗ рд╕рдордп, рдореИрдВ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдЖрдпрд╛ рдХрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рддреАрди.js рдореЗрдВ рдРрд╕реЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рддреИрдпрд╛рд░ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдХреИрдорд░рд╛ рдирд┐рдпрдВрддреНрд░рдг рдЙрдкрдХрд░рдг рдирд╣реАрдВ рд╣реИред  рдмреЗрд╢рдХ, рдореИрдВ рдорд╛рдирддрд╛ рд╣реВрдВ рдХрд┐ рдореИрдВ рдмрд╕ рдЦрд░рд╛рдм рджрд┐рдЦ рд░рд╣рд╛ рдерд╛ ... рд▓реЗрдХрд┐рди, рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рдВрдмреА рдЦреЛрдЬ рдиреЗ рдЙрддреНрдкрд╛рджрди рдирд╣реАрдВ рдХрд┐рдпрд╛ред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдСрд░реНрдмрд┐рдЯрдХрдВрдЯреНрд░реЛрд▓ рддреАрди.рдЬреЗрдПрд╕ рдЙрджрд╛рд╣рд░рдгреЛрдВ</a> рдХрд╛ рдПрдХ рдкрд╛рд░рдВрдкрд░рд┐рдХ рдкрд╕рдВрджреАрджрд╛ рд╣реИ, рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдирддрд╛ рдХрд┐ рдХреИрдорд░реЗ рдХреЛ рдЙрд▓реНрдЯрд╛ рдХреИрд╕реЗ рдореЛрдбрд╝рдирд╛ рд╣реИ, рдФрд░ рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдирддрд╛ рдХрд┐ рдЗрд╕реЗ рдХрд┐рддрдиреА рдЕрдиреНрдп рдЪреАрдЬреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">TrackballControls</a> рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рд╣реИ рдХрд┐ рдХреИрдорд░рд╛ рдЖрдкрдХреА рдкрд╕рдВрдж рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреВрдорддрд╛ рд╣реИ, рдФрд░ рдЙрд▓реНрдЯрд╛ рднреА рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдирддрд╛ рд╣реИ рдХрд┐ рджреГрд╢реНрдп рдХреЗ рдЕрдХреНрд╖ рдХреЛ рдХреИрд╕реЗ рдЪрд╛рд▓реВ рдХрд┐рдпрд╛ рдЬрд╛рдП, рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдирддрд╛ рдХрд┐ рдкреИрдорд╛рдиреЗ рдХреЛ рдмрджрд▓реЗ рдмрд┐рдирд╛ рдЖрдЧреЗ рдФрд░ рдкреАрдЫреЗ рдХреИрд╕реЗ рдмрдврд╝рдирд╛ рд╣реИ, рдЖрдВрджреЛрд▓рдиреЛрдВ рдФрд░ рдШреБрдорд╛рд╡реЛрдВ рдХреА рдЧрддрд┐ рдХрд╛ рдХреЛрдИ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╕рдорд╛рдпреЛрдЬрди рдирд╣реАрдВ рд╣реИред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлреНрд▓рд╛рдИрдХрдВрдЯреНрд░реЛрд▓</a> - рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, рдЖрдкрдХреЛ "рдмреИрд░рд▓" рдмрдирд╛рдиреЗ рдФрд░ рдЧрддрд┐ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди ... рдкреНрд░рд╢реНрди рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдХреИрдорд░реЗ рдХрд╛ рд░реЛрдЯреЗрд╢рди рдХрд╣рд╛рдВ рдЧрдпрд╛? <br><br>  рдпрд╣, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреА рдмреИрд╕рд╛рдЦреА рдХреА рдорджрдж рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдирд╛ рд╕рдВрднрд╡ рдерд╛, рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдпрд╣ рдХрдо рдирд╣реАрдВ рд╣реИред  рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдХрд┐ рдореЗрд░реЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рддреИрдпрд╛рд░ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ, рдореИрдВрдиреЗ рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рдмрдирд╛рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред  рдХреМрди рд░реБрдЪрд┐ рд░рдЦрддрд╛ рд╣реИ, рдХреГрдкрдпрд╛, рдмрд┐рд▓реНрд▓реА рдХреЗ рдиреАрдЪреЗред <br><a name="habracut"></a><br>  рдореИрдВрдиреЗ рдЯреНрд░реИрдХрдмреЙрд▓рдХрдВрдЯреНрд░реЛрд▓рдЬ рдХреЛ рдЖрдзрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗрдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рдЗрд╕реЗ рдЦреЛрд▓рд╛, рд╣рдо рд▓реЗрдЦрдХреЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @author Eberhard Graether / http://egraether.com/ * @author Mark Lundin / http://mark-lundin.com * @author Simone Manini / http://daron1337.github.io * @author Luca Antiga / http://lantiga.github.io */</span></span></code> </pre> <br>  рдпрд╣ рдЙрдирдХрд╛ рдХрд╛рдо рд╣реИ рдФрд░ рд╣рдорд╛рд░реЗ рд╢реБрд░реБрдЖрддреА рдмрд┐рдВрджреБ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред  рдпрд╣ рдереЛрдбрд╝рд╛ рдЬреЛрдбрд╝рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдФрд░ рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ рдореМрдЬреВрджрд╛ рдХреЛ рддреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВред  (рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреБрдЫ рдХрд╛рдЯрд╛ рдЬрд╛рдирд╛ рдерд╛)ред <br><br>  рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреНрдпрд╛ рд╣реИ: рдХреИрдорд░рд╛ рдкреНрд░рддрд┐рдмрдВрдз рдХреЗ рдмрд┐рдирд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреВрдорддрд╛ рд╣реИ, рдкреЛрд▓ рдкрд░ рдЕрдЯрдХ рдирд╣реАрдВ рдЬрд╛рддрд╛ рд╣реИ, рд╕рднреА рдореЛрдбрд╝ рдкрд░ рдпрд╣ рдПрдХ рдирд┐рд░рдВрддрд░ рдХреЛрдгреАрдп рд╡реЗрдЧ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИред  рдЭреВрдо рд╣реИ, рдкрд╛рди рд╣реИред  рдпрд╣ рдЕрдЪреНрдЫрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИред <br><br>  рдЖрд╢реНрдЪрд░реНрдп рдХреА рдмрд╛рдд рдмрдЯрди рдХреЗ рд╕рд╛рде рдЕрдЬреАрдм рд╕реНрдерд┐рддрд┐ рдереАред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╣реИ: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.keys = [ <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-comment"><span class="hljs-comment">/*A*/</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> <span class="hljs-comment"><span class="hljs-comment">/*S*/</span></span>, <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-comment"><span class="hljs-comment">/*D*/</span></span> ];</code> </pre> <br>  рд╕рд┐рд░реНрдл рддреАрди рдмрдЯрди рдХреЗ рд╕рд╛рде рдХреИрдорд░рд╛ рдирд┐рдпрдВрддреНрд░рдг?  рд╢рд╛рдпрдж рдпрд╣ рдПрдХ рдЕрдЪреНрдЫрд╛ рд╡рд┐рдЪрд╛рд░ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рд╕реНрд░реЛрдд рдореЗрдВ рдХреАрдбрд╛рдЙрди рдЗрд╡реЗрдВрдЯ рд╣реИрдВрдбрд▓рд░ рдореЗрдВ, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.removeEventListener( <span class="hljs-string"><span class="hljs-string">'keydown'</span></span>, keydown ); _prevState = _state; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _state !== STATE.NONE ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( event.keyCode === _this.keys[ STATE.ROTATE ] &amp;&amp; ! _this.noRotate ) { _state = STATE.ROTATE; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( event.keyCode === _this.keys[ STATE.ZOOM ] &amp;&amp; ! _this.noZoom ) { _state = STATE.ZOOM; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( event.keyCode === _this.keys[ STATE.PAN ] &amp;&amp; ! _this.noPan ) { _state = STATE.PAN; }</code> </pre> <br>  рдпрд╣ рдереЛрдбрд╝рд╛ рд░рд╣рд╕реНрдпрдордп рд▓рдЧрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди ... рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рдпрд╛рдиреА  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░ред  рдЙрдкрд░реЛрдХреНрдд рдмрдЯрди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдХреИрдорд░рд╛ рдХреЗрд╡рд▓ рдорд╛рдЙрд╕ рдпрд╛ рд╕реНрдкрд░реНрд╢ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЛрддрд╛ рд╣реИред <br><br>  рдореИрдВрдиреЗ рдЗрд╕ рдХреЛрдб рдХреЗ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд╣реЛрдиреЗ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХреА, рдФрд░ рдЗрд╕реЗ рдореЗрд░реЗ рд╕рд╛рде рдмрджрд▓ рджрд┐рдпрд╛, рдЬрд┐рд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХрд╣рд╛рдиреА рдереЛрдбрд╝реА рдЖрдЧреЗ рд╣реЛрдЧреАред  рдмрдЯрди рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдмреИрдХ рдХреЛ рд╣рдЯрд╛рддреЗ рд╣реБрдП - рдЬрд╛рд╣рд┐рд░ рд╣реИ, рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдерд╛ рдХрд┐ рдмрдЯрди рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╣рд░ рдмрд╛рд░ рджрдмрд╛рдП рдЬрд╛рдПрдВред  рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд╣ рд╡реНрдпрд╡рд╣рд╛рд░ рдирд╣реАрдВ рд╣реИ рдЬрд┐рд╕рдХреА рдмрд╛рд╣рд░реА рд╕реНрдерд╛рди рдкрд░ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рднреА рдЯрд┐рдкреНрдкрдгреА рдХреЗ рдЕрдзреАрди рд╣реИред <br><br>  рддреЛ рд╣рдо рдпрд╣рд╛рдБ рдХреНрдпрд╛ рдпрд╛рдж рдХрд░ рд░рд╣реЗ рд╣реИрдВ?  рдореИрдВрдиреЗ рдХреНрдпрд╛ рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛: <br><br><ol><li>  рджреГрд╖реНрдЯрд┐ рдХреА рд░реЗрдЦрд╛ рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдФрд░ рдкреАрдЫреЗ рдЖрдВрджреЛрд▓рдиред </li><li>  рдХреИрдорд░реЗ рдХрд╛ рд░реЛрдЯреЗрд╢рди рдЬрд┐рд╕рдХреА рдзреБрд░реА рджреГрд╖реНрдЯрд┐ рд░реЗрдЦрд╛ рд╣реИред </li><li>  Autorotationред </li><li>  рд╕рднреА рдЖрдВрджреЛрд▓рдиреЛрдВ рдХреА рдЧрддрд┐ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдФрд░ рдПрдХ рдмрдЯрди рдХреЗ рд╕рд╛рде рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИред </li><li>  рдкреВрд░реНрдг рдХреАрдмреЛрд░реНрдб рдирд┐рдпрдВрддреНрд░рдгред </li></ol><br>  рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдкрд╛рдардХ рдореБрдЭреЗ рдЗрд╕ рддрдереНрдп рдХреЗ рд▓рд┐рдП рдХреНрд╖рдорд╛ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдореИрдВ рдЗрди рдЙрдк-рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рдХреНрд░рдо рдореЗрдВ рд╕рдВрдкрд╛рджрди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛, рд▓реЗрдХрд┐рди рд╕реНрд░реЛрдд рдХреЛрдб рдХрд╛ рдКрдкрд░ рд╕реЗ рдиреАрдЪреЗ рддрдХ рдЕрдиреБрд╕рд░рдг рдХрд░рдиреЗ рдХреЗ рдХреНрд░рдо рдореЗрдВред  рдореИрдВ рд╕рдордЭрд╛рдКрдВрдЧрд╛ рдХрд┐ рдореИрдВ рдХреНрдпрд╛ рдФрд░ рдХреНрдпреЛрдВ рдХрд░ рд░рд╣рд╛ рд╣реВрдВред <br><br><h4>  рдбрд┐рдЬрд╛рдЗрдирд░ </h4><br>  рдХреБрдЫ рдЪрд░ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotationZFactor = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RVMovingFactor = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.autoRotate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.autoRotateSpeed = <span class="hljs-number"><span class="hljs-number">0.001</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.allSpeedsFactor = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  рджреЗрдЦрдиреЗ рдХреЗ рдЕрдХреНрд╖ рдкрд░ рдХреИрдорд░реЗ рдХреЗ рд░реЛрдЯреЗрд╢рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░реЛрдЯреЗрд╢рдирдЬреИрдХреНрдЯрд░ рдХреА рдЬрд░реВрд░рдд рд╣реЛрддреА рд╣реИ, <br>  RVMovingFactor рдПрдХ рд╣реА рдзреБрд░реА рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдФрд░ рдкреАрдЫреЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <br>  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЯрд┐рдкреНрдкрдгреА рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИ, <br>  allSpeedsFactor рд╕рднреА рд╕рдВрдпреБрдХреНрдд, рдЖрдВрджреЛрд▓рдиреЛрдВ рдФрд░ рдШреБрдорд╛рд╡реЛрдВ рдХреА рдЧрддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред <br><br><h4>  рд░реЛрдЯреЗрдЯрдХреИрдорд░рд╛ рд╡рд┐рдзрд┐ </h4><br>  рдЗрд╕ рддрд░рд╣ рд╕рдВрдЧрдард┐рдд: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotateCamera = ( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> axis = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3(), quaternion = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Quaternion(), eyeDirection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3(), objectUpDirection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3(), objectSidewaysDirection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3(), moveDirection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3(), tmpQuaternion = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Quaternion(), angle; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rotateCamera</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ...</code> </pre> <br>  рдпрд╣рд╛рдВ, рд▓рдЧрднрдЧ рд╕рдм рдХреБрдЫ рдРрд╕рд╛ рдерд╛, рдХреЗрд╡рд▓ рдПрдХ рдЪреАрдЬ рдЬреЛ рдореИрдВрдиреЗ рдЬреЛрдбрд╝реА рдереА рд╡рд╣ Z рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рдХреИрдорд░реЗ рдХреЗ рд░реЛрдЯреЗрд╢рди рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд░ tmpQuaternion рдереАред <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрд╛рдБрдЪрдирд╛ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдЖрд╡рд╢реНрдпрдХ рдерд╛, рдмрд╣реБрдд рд╕реАрдзрд╛ рдерд╛: <br><br><pre> <code class="javascript hljs">moveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, <span class="hljs-number"><span class="hljs-number">0</span></span> ); angle = moveDirection.length(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( angle ) {</code> </pre> <br>  рдФрд░ рдпрд╣ рдЗрд╕ рддрд░рд╣ рд╣реЛ рдЧрдпрд╛: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_this.autoRotate) _moveCurr.x += _this.autoRotateSpeed; moveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, <span class="hljs-number"><span class="hljs-number">0</span></span> ); moveDirection.setLength(moveDirection.length() * _this.allSpeedsFactor); angle = moveDirection.length(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( angle || _this.rotationZFactor) {</code> </pre> <br>  рдпрд╣рд╛рдБ рдХреНрдпрд╛ рд╣реИ рдФрд░ рдХреНрдпреЛрдВ рд╣реИред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрджрд┐ рдСрдЯреЛ-рд░реЛрдЯреЗрд╢рди рд╕рдХреНрд░рд┐рдп рд╣реИ, рддреЛ рд╣рдо рдПрдХреНрд╕ рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рд░реЛрдЯреЗрд╢рди рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреА рдЧрддрд┐ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред рджреВрд╕рд░реЗ, рд╣рдордиреЗ рд╕рднреА рд░реЛрдЯреЗрд╢рди (рдФрд░ рдСрдЯреЛ-рд░реЛрдЯреЗрд╢рди рднреА) рдХреЛ allSpeedsFactor рдореЗрдВ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ред  рд╕рднреА рд░реВрдкрд╛рдВрддрд░рдгреЛрдВ рдХреА рдЧрддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред  рдФрд░ рддреАрд╕рд░рд╛, рд╣рдо рди рдХреЗрд╡рд▓ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдЧреЗ рдХреА рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░реЗрдВрдЧреЗ рдЬрдм рдХреЛрдг рдХреЛрдг (рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдХреИрдорд░рд╛ рдЖрдВрджреЛрд▓рди) рдЧреИрд░-рд╢реВрдиреНрдп рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рднреА рдорд╛рдорд▓реЗ рдореЗрдВ рдЬрдм рд░реЛрдЯреЗрд╢рди рдПрдХреНрд╕рдлрд╝реИрдХреНрдЯрд░, рдЬреЛ рдЬрд╝реЗрдб рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рдХреИрдорд░рд╛ рд░реЛрдЯреЗрд╢рди рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИ, рдЧреИрд░-рд╢реВрдиреНрдп рд╣реИред <br><br>  рд╡рд┐рдзрд┐ рдХреЛрдб рдореЗрдВ рдЖрдЧреЗ, рд░реЛрдЯреЗрд╢рди рдХреЗ рдЪрддреБрд░реНрднреБрдЬ рдХреА рдЧрдгрдирд╛ рдХреЗ рдмрд╛рдж, рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдЬреЛрдбрд╝: <br><br><pre> <code class="javascript hljs">quaternion.setFromAxisAngle( axis, angle ); <span class="hljs-comment"><span class="hljs-comment">//    , //   ,         . // added for z-axis rotation tmpQuaternion.setFromAxisAngle( eyeDirection, _this.rotationZFactor ); quaternion.multiply( tmpQuaternion ); // end add</span></span></code> </pre> <br>  рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдХреИрдорд░реЗ рдХреЗ рд░реЛрдЯреЗрд╢рди рдХрд╛ рдЪрддреБрд░реНрднреБрдЬ, рд╣рдо Z рдЕрдХреНрд╖ рдХреЗ рд░реЛрдЯреЗрд╢рди рдХреЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЧрдгрдирд╛ рдХрд┐рдП рдЧрдП рдЪрддреБрд░реНрднреБрдЬ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВред рдЕрдм рдХреИрдорд░рд╛ рддреАрдиреЛрдВ рдЕрдХреНрд╖реЛрдВ рдХреЗ рд╕рд╛рде рдШреВрдо рд╕рдХрддрд╛ рд╣реИред <br><br><h4>  рдЬрд╝реВрдордХрдореЗрд░рд╛ рд╡рд┐рдзрд┐ </h4><br>  рдореИрдВ рдЖрдкрдХреЛ рдкреВрд░рд╛ рдХреЛрдб рджреВрдВрдЧрд╛, рдпрд╣ рдЫреЛрдЯрд╛ рд╣реИ: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.zoomCamera = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> factor; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _state === STATE.TOUCH_ZOOM_PAN ) { <span class="hljs-comment"><span class="hljs-comment">//  allSpeedsFactor : factor = _this.allSpeedsFactor * _touchZoomDistanceStart / _touchZoomDistanceEnd; _touchZoomDistanceStart = _touchZoomDistanceEnd; _eye.multiplyScalar( factor ); } else { //  allSpeedsFactor : factor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * _this.zoomSpeed * _this.allSpeedsFactor; if ( factor !== 1.0 &amp;&amp; factor &gt; 0.0 ) { _eye.multiplyScalar( factor ); } if ( _this.staticMoving ) { _zoomStart.copy( _zoomEnd ); } else { //  allSpeedsFactor : _zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor * _this.allSpeedsFactor; } } };</span></span></code> </pre> <br>  рдЧрддрд┐ (рдЖрдВрджреЛрд▓рдиреЛрдВ, рдШреБрдорд╛рд╡реЛрдВ) рдФрд░ рдЬрд╝реВрдо рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ allSpeedsFactor рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрди рдиреАрдЪреЗ рдЖрддреЗ рд╣реИрдВред <br><br><h4>  рдкреИрдирдХреЗрдореЗрд░рд╛ рд╡рд┐рдзрд┐ </h4><br>  рдореИрдВ рдЗрд╕рдХрд╛ рдкреВрд░рд╛ рдХреЛрдб рднреА рджреВрдВрдЧрд╛  рдпрд╣ рдЫреЛрдЯрд╛ рд╣реИ: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.panCamera = ( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mouseChange = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector2(), objectUp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3(), rv = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3() pan = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">panCamera</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ mouseChange.copy( _panEnd ).sub( _panStart ); mouseChange.setLength(mouseChange.length() * _this.allSpeedsFactor); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( mouseChange.lengthSq() || _this.RVMovingFactor ) { mouseChange.multiplyScalar( _eye.length() * _this.panSpeed ); pan.copy( _eye ).cross( _this.object.up ).setLength( mouseChange.x ); pan.add( objectUp.copy( _this.object.up ).setLength( mouseChange.y ) ); pan.add( rv.copy( _eye ).setLength(_this.RVMovingFactor * _eye.length()) ); _this.object.position.add( pan ); _this.target.add( pan ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _this.staticMoving ) { _panStart.copy( _panEnd ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( _this.dynamicDampingFactor * _this.allSpeedsFactor ) ); } } }; }() );</code> </pre> <br>  рд▓реЗрдХрд┐рди рдмрд╣реБрдд рдЕрдзрд┐рдХ рдкрд░рд┐рд╡рд░реНрддрди рд╣реИрдВред  рдореИрдВ рдЖрдкрдХреЛ рдХреНрд░рдо рдореЗрдВ рд╕рдм рдХреБрдЫ рдмрддрд╛рддрд╛ рд╣реВрдБред <br><br>  рдЪрд░ рдЖрд░рд╡реА рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ - рдХреИрдорд░реЗ рдХреЗ рд░реЗрдбрд┐рдпрд▓ рд╡реЗрдЧ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реЗрдХреНрдЯрд░, рдЕрд░реНрдерд╛рддред  z рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рдЗрд╕рдХреА рдЧрддрд┐ред <br><br>  рдПрдХ рд╣реА allSpeedsFactor рдХреЗ рд▓рд┐рдП MouseChange рд╡реЗрдХреНрдЯрд░ рдХреЗ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рд╕реЗ рдпрд╣рд╛рдБ рд╣реИ, рдореИрдВ рдПрдХ рдПрдХрд▓ рдПрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рд╕рднреА рдЖрдВрджреЛрд▓рдиреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛ред <br><br>  рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рдЕрдм рди рдХреЗрд╡рд▓ рдорд╛рдЙрд╕ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдкрд░ рдЧреБрдЬрд░рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рднреА рд╣реЛрддрд╛ рд╣реИ рдЬрдм RVMovingFactor рдиреЙрдирдЬрд╝рд░реЛ рд╣реЛрддрд╛ рд╣реИ - рджреГрд╖реНрдЯрд┐ рдХреА рд░реЗрдЦрд╛ рдХреЗ рд╕рд╛рде рдХреИрдорд░реЗ рдХреЗ рдЖрдВрджреЛрд▓рди рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдПрдХ рдЪрд░ред <br><br>  рдФрд░ рдЕрдВрдд рдореЗрдВ, рд╡рд┐рдзрд┐ рдХреЛрдб рдореЗрдВ, рд╕рднреА рддреАрди рдЕрдХреНрд╖реЛрдВ рдХреЗ рд╕рд╛рде рдХреИрдорд░реЗ рдХреА рдкреВрд░реА рдЧрддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреИрди рдФрд░ рдЖрд░рд╡реА рд╡реИрдХреНрдЯрд░ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЗрд╕реЗ рдХреИрдорд░реЗ рдкрд░ рдФрд░ control.target рдкрд░ рд▓рд╛рдЧреВ рдХрд░реЗрдВред <br><br><h4>  рдЕрджреНрдпрддрди рд╡рд┐рдзрд┐ </h4><br>  рдХреБрдЫ рдЕрд╡рд╛рдВрдЫрд┐рдд рдкреНрд░рднрд╛рд╡реЛрдВ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд┐рдзрд┐ рдХреЗ рдмрд╣реБрдд рдЕрдВрдд рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдЬреЛрдбрд╝реА рдЬрд╛рддреА рд╣реИрдВ: <br><br><pre> <code class="javascript hljs"> _this.RVMovingFactor = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; _this.rotationZFactor = <span class="hljs-number"><span class="hljs-number">0.0</span></span>;</code> </pre> <br>  рдЕрд╡рд╛рдВрдЫрдиреАрдп рдкреНрд░рднрд╛рд╡ рдЬреЗрдб рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рд░реЛрдЯреЗрд╢рди рдФрд░ рдЖрдВрджреЛрд▓рди рд╕реЗ рдЬреБрдбрд╝реЗ рдереЗ, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЕрдиреБрдорд╛рди рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВред <br><br><h4>  рдХреАрдбрд╛рдЙрди рд╡рд┐рдзрд┐ </h4><br>  рд╕реНрд░реЛрдд рдХреЛрдб рдЬреЛ рдореИрдВрдиреЗ рдХрд╣рд╛рдиреА рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдерд╛, рдЙрд╕ рдкрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЯрд┐рдкреНрдкрдгреА рдХреА рдЧрдИ рд╣реИред  рдФрд░ рдЙрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╡рд┐рдзрд┐ рдХреЗ рд╢рд░реАрд░ рдореЗрдВ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд░реВрдк рд╕реЗ рдХреБрдЫ рднреА рдирд╣реАрдВ рдерд╛, рдЗрд╕рд▓рд┐рдП рд╣рдо рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдЦрд░реЛрдВрдЪ рд╕реЗ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдерд╛ред <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keydown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> event </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _this.enabled === <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (event.keyCode) { <span class="hljs-comment"><span class="hljs-comment">// 81:Q; 87:W; 69:E; 82:R; // 65:A; 83:S; 68:D; 70:F; // 90:Z; 88:X; 67:C; 86:V; // 107:+; 109:-; 16:Shift; 17:Ctrl; 18:Alt; 9:Tab; // 38:Up; 37:Left; 40:Down; 39:Right; case 87: _this.RVMovingFactor = -0.002 * _this.allSpeedsFactor;//W break; case 83: _this.RVMovingFactor = 0.002 * _this.allSpeedsFactor;//S break; case 65: _movePrev.copy( _moveCurr ); _moveCurr.x -= 0.01 * _this.allSpeedsFactor; //A break; case 68: _movePrev.copy( _moveCurr ); _moveCurr.x += 0.01 * _this.allSpeedsFactor; //D break; case 90: _movePrev.copy( _moveCurr ); _moveCurr.y -= 0.01 * _this.allSpeedsFactor; //Z break; case 88: _movePrev.copy( _moveCurr ); _moveCurr.y += 0.01 * _this.allSpeedsFactor; //X break; case 81: _this.rotationZFactor = -0.01 * _this.allSpeedsFactor;//Q break; case 69: _this.rotationZFactor = 0.01 * _this.allSpeedsFactor;//E break; case 107: _zoomStart.y += 0.02 * _this.allSpeedsFactor; // + break; case 109: _zoomStart.y -= 0.02 * _this.allSpeedsFactor; // - break; case 38: // up _panEnd.y -= 0.01 * _this.allSpeedsFactor; break; case 40: // down _panEnd.y += 0.01 * _this.allSpeedsFactor; break; case 37: // left _panEnd.x -= 0.01 * _this.allSpeedsFactor; break; case 39: // right _panEnd.x += 0.01 * _this.allSpeedsFactor; break; case 82: // R _this.allSpeedsFactor = 0.33; break; case 16: // Shift _this.allSpeedsFactor = 0.05; break; } }</span></span></code> </pre> <br>  рддреЛ рдпрд╣рд╛рдБ рдХреНрдпрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: <br><br>  рдХрдИ рдмрдЯрди рдорд╛рдЙрд╕ рдЖрдВрджреЛрд▓рди рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рддреЗ рд╣реИрдВред <br>  "рдП", "рдбреА" - рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдХреИрдорд░рд╛ рд░реЛрдЯреЗрд╢рди рдХреЛ рджреЛрд╣рд░рд╛рддрд╛ рд╣реИред <br>  "Z", "X" - рдКрдкрд░ рдФрд░ рдиреАрдЪреЗ рдХреА рдУрд░ рдореБрдбрд╝рддреЗ рд╣реБрдП рдХреИрдорд░реЗ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░рддрд╛ рд╣реИред <br>  "+", "-" - рдорд╛рдЙрд╕ рд╡реНрд╣реАрд▓ рдХреЗ рд╕рд╛рде рдЬрд╝реВрдо рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░реЗрдВред <br><br>  рддреАрд░ рдмрдЯрди рдКрдкрд░ рдФрд░ рдиреАрдЪреЗ рдФрд░ рдмрд╛рдПрдБ рдФрд░ рджрд╛рдПрдБ, рдФрд░ рдШреБрдорд╛рд╡ рдХреЗ рдХреЛрдг рдХреЛ рдмрджрд▓реЗ рдмрд┐рдирд╛, рдХреИрдорд░реЗ рдХреА рдЧрддрд┐ рдХреЛ рджреЛрд╣рд░рд╛рддреЗ рд╣реИрдВред <br><br>  рдФрд░ рдЙрди рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЛ рднреА рдЬреЛрдбрд╝рд╛ рдЬрд┐рди рдкрд░ рдорд╛рдирдХ рдорд╛рдЙрд╕ рдХреЗ рдмрдЯрди рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ: <br>  "рдбрдмреНрд▓реНрдпреВ", "рдПрд╕" - рдЬрд╝реВрдо рдХреЛ рдмрджрд▓реЗ рдмрд┐рдирд╛ рджреГрд╖реНрдЯрд┐ рдХреА рд░реЗрдЦрд╛ рдХреЗ рд╕рд╛рде рдЖрдВрджреЛрд▓рдиред <br>  "рдХреНрдпреВ", "рдИ" - рдЬреЗрдб рдЕрдХреНрд╖ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдХреИрдорд░рд╛ рд░реЛрдЯреЗрд╢рди, рдЕрд░реНрдерд╛рддреНред  рдЪрд╛рд░реЛрдВ рдУрд░ рджреГрд╖реНрдЯрд┐ рдХреА рд░реЗрдЦрд╛ред <br>  "рдЖрд░", "рд╢рд┐рдлреНрдЯ" - рдХреНрд░рдорд╢рдГ рд╕рднреА рдЖрдВрджреЛрд▓рдиреЛрдВ, рдШреБрдорд╛рд╡реЛрдВ, рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ, 3 рдмрд╛рд░ рдФрд░ 20 рдмрд╛рд░ рдХреА рдЧрддрд┐ рдореЗрдВ рдХрдореАред <br><br>  рдЙрд╕реА рд╕рдордп, рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ рд╕рд░рдгреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдореЗрд░реЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рдерд╛, рдФрд░ рдИрдорд╛рдирджрд╛рд░ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП, рдореБрдЭреЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдЬрд┐рд╕ рдЪреАрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдЙрд╕реЗ рдЦрд░рд╛рдм рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВ рдмрд╣реБрдд рдЖрд▓рд╕реА рдерд╛ред <br><br><h4>  рдХреАрдк рд╡рд┐рдзрд┐ </h4><br>  рдореИрдВ рдЗрд╕реЗ рдЗрд╕рдХреА рд╕рдВрдкреВрд░реНрдгрддрд╛ рдореЗрдВ рдЙрджреНрдзреГрдд рдХрд░реВрдВрдЧрд╛: <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keyup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> event </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _this.enabled === <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (event.keyCode) { <span class="hljs-comment"><span class="hljs-comment">// 81:Q; 87:W; 69:E; 82:R; // 65:A; 83:S; 68:D; 70:F; // 90:Z; 88:X; 67:C; 86:V; // 107:+; 109:-; 16:Shift; 17:Ctrl; 18:Alt; 9:Tab; // 38:Up; 37:Left; 40:Down; 39:Right; case 87: // W _this.RVMovingFactor = 0.0; break; case 83: // S _this.RVMovingFactor = 0.0; break; case 81: // Q _this.rotationZFactor = 0.0; break; case 69: // E _this.rotationZFactor = 0.0; break; case 82: // R _this.allSpeedsFactor = 1.0; break; case 16: // Shift _this.allSpeedsFactor = 1.0; break; } _state = _prevState; //window.addEventListener( 'keydown', keydown, false ); }</span></span></code> </pre> <br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЕрдиреБрдорд╛рди рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдХрд┐ рдЬреЛ рдХреБрдЫ рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рд╡рд╣ рдЪрд░ рдЖрд░рд╡реАрдореЛрд╡рд┐рдВрдЧрдлреИрдХреНрдЯрд░, рд░реЛрдЯреЗрд╢рдирдЬреИрдлреИрдХреНрдЯреЛрд░, рдСрд▓рд╕реНрдкреАрдбреНрд╕рдлреИрдХреНрдЯрд░ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдЙрдирдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рдиреЛрдВ рдкрд░ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреАрд╕реНрдЯреНрд░реЛрдХ рд╣реИрдВрдбрд▓рд░ рдХреА рд╕реНрдерд╛рдкрдирд╛ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХреА рдЧрдИ - рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рд╣рдЯрд╛рдиреЗ рдХреЛ рдХреАрдбрд╛рдЙрди рд╡рд┐рдзрд┐ рдореЗрдВ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред <br><br>  рдЕрдВрдд рдореЗрдВ, рдорд╛рдирдХ рдПрдХ рдХреЗ рд╕рд╛рде рд╕рдВрд╢реЛрдзрд┐рдд рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рднреНрд░рдорд┐рдд рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдирд╛рдо рдмрджрд▓рддреЗ рд╣реИрдВред <br><br>  рдирд┐рд░реНрдорд╛рддрд╛ рдХрд╛ рдирд╛рдо рдмрджрд▓реЗрдВ: <br><br><pre> <code class="javascript hljs">THREE.AstroControls = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> object, domElement </span></span></span><span class="hljs-function">) </span></span>{</code> </pre> <br>  TrackballControls рдХреЗ рдмрдЬрд╛рдп, рдЕрдм AstroControlsред <br><br>  рдФрд░ рдлрд╛рдЗрд▓ рдХреЗ рдЕрдВрдд рдореЗрдВ рд╣рдо рд▓рд┐рдЦрддреЗ рд╣реИрдВ: <br><br><pre> <code class="javascript hljs">THREE.AstroControls.prototype = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.create( THREE.EventDispatcher.prototype ); THREE.AstroControls.prototype.constructor = THREE.AstroControls;</code> </pre> <br>  рд╕рдм рдХреБрдЫ, рдирдП рдирд┐рдпрдВрддреНрд░рдг рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рдЙрд╕рдХрд╛ рд╕рд╛рд░рд╛ рдХреЛрдб рд╕реНрдкреЙрдЗрд▓рд░ рдХреЗ рдиреАрдЪреЗ рд╣реИ</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @author Eberhard Graether / http://egraether.com/ * @author Mark Lundin / http://mark-lundin.com * @author Simone Manini / http://daron1337.github.io * @author Luca Antiga / http://lantiga.github.io * modified by Zander. */</span></span> THREE.AstroControls = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> object, domElement </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _this = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STATE = { <span class="hljs-attr"><span class="hljs-attr">NONE</span></span>: - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">ROTATE</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">ZOOM</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">PAN</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">TOUCH_ROTATE</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">TOUCH_ZOOM_PAN</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.object = object; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.domElement = ( domElement !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> ) ? domElement : <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotationZFactor = <span class="hljs-number"><span class="hljs-number">0.0</span></span>;<span class="hljs-comment"><span class="hljs-comment">//1; this.RVMovingFactor = 0.0; this.autoRotate = false; this.autoRotateSpeed = 0.001; this.allSpeedsFactor = 1; // API this.enabled = true; this.screen = { left: 0, top: 0, width: 0, height: 0 }; this.rotateSpeed = 1.0; this.zoomSpeed = 1.2; this.panSpeed = 0.3; this.noRotate = false; this.noZoom = false; this.noPan = false; this.staticMoving = false; this.dynamicDampingFactor = 0.2; this.minDistance = 0; this.maxDistance = Infinity; this.keys = [null, null, null]; // [ 65 /*A*/, 83 /*S*/, 68 /*D*/ ]; // internals this.target = new THREE.Vector3(); var EPS = 0.000001; var lastPosition = new THREE.Vector3(); var _state = STATE.NONE, _prevState = STATE.NONE, _eye = new THREE.Vector3(), _movePrev = new THREE.Vector2(), _moveCurr = new THREE.Vector2(), _lastAxis = new THREE.Vector3(), _lastAngle = 0, _zoomStart = new THREE.Vector2(), _zoomEnd = new THREE.Vector2(), _touchZoomDistanceStart = 0, _touchZoomDistanceEnd = 0, _panStart = new THREE.Vector2(), _panEnd = new THREE.Vector2(); // for reset this.target0 = this.target.clone(); this.position0 = this.object.position.clone(); this.up0 = this.object.up.clone(); // events var changeEvent = { type: 'change' }; var startEvent = { type: 'start' }; var endEvent = { type: 'end' }; // methods this.handleResize = function () { if ( this.domElement === document ) { this.screen.left = 0; this.screen.top = 0; this.screen.width = window.innerWidth; this.screen.height = window.innerHeight; } else { var box = this.domElement.getBoundingClientRect(); // adjustments come from similar code in the jquery offset() function var d = this.domElement.ownerDocument.documentElement; this.screen.left = box.left + window.pageXOffset - d.clientLeft; this.screen.top = box.top + window.pageYOffset - d.clientTop; this.screen.width = box.width; this.screen.height = box.height; } }; var getMouseOnScreen = ( function () { var vector = new THREE.Vector2(); return function getMouseOnScreen( pageX, pageY ) { vector.set( ( pageX - _this.screen.left ) / _this.screen.width, ( pageY - _this.screen.top ) / _this.screen.height ); return vector; }; }() ); var getMouseOnCircle = ( function () { var vector = new THREE.Vector2(); return function getMouseOnCircle( pageX, pageY ) { vector.set( ( ( pageX - _this.screen.width * 0.5 - _this.screen.left ) / ( _this.screen.width * 0.5 ) ), ( ( _this.screen.height + 2 * ( _this.screen.top - pageY ) ) / _this.screen.width ) // screen.width intentional ); return vector; }; }() ); this.rotateCamera = ( function () { var axis = new THREE.Vector3(), quaternion = new THREE.Quaternion(), eyeDirection = new THREE.Vector3(), objectUpDirection = new THREE.Vector3(), objectSidewaysDirection = new THREE.Vector3(), moveDirection = new THREE.Vector3(), tmpQuaternion = new THREE.Quaternion(), angle; return function rotateCamera() { if (_this.autoRotate) _moveCurr.x += _this.autoRotateSpeed; moveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0 ); moveDirection.setLength(moveDirection.length() * _this.allSpeedsFactor); angle = moveDirection.length(); if ( angle || _this.rotationZFactor) { _eye.copy( _this.object.position ).sub( _this.target ); eyeDirection.copy( _eye ).normalize(); objectUpDirection.copy( _this.object.up ).normalize(); objectSidewaysDirection.crossVectors( objectUpDirection, eyeDirection ).normalize(); objectUpDirection.setLength( _moveCurr.y - _movePrev.y ); objectSidewaysDirection.setLength( _moveCurr.x - _movePrev.x ); moveDirection.copy( objectUpDirection.add( objectSidewaysDirection ) ); axis.crossVectors( moveDirection, _eye ).normalize(); angle *= _this.rotateSpeed; quaternion.setFromAxisAngle( axis, angle ); // added for z-axis rotation tmpQuaternion.setFromAxisAngle( eyeDirection, _this.rotationZFactor ); quaternion.multiply( tmpQuaternion ); // end add _eye.applyQuaternion( quaternion ); _this.object.up.applyQuaternion( quaternion ); _lastAxis.copy( axis ); _lastAngle = angle; } else if ( ! _this.staticMoving &amp;&amp; _lastAngle ) { _lastAngle *= Math.sqrt( 1.0 - _this.dynamicDampingFactor * _this.allSpeedsFactor ); _eye.copy( _this.object.position ).sub( _this.target ); quaternion.setFromAxisAngle( _lastAxis, _lastAngle ); _eye.applyQuaternion( quaternion ); _this.object.up.applyQuaternion( quaternion ); } _movePrev.copy( _moveCurr ); }; }() ); this.zoomCamera = function () { var factor; if ( _state === STATE.TOUCH_ZOOM_PAN ) { factor = _this.allSpeedsFactor * _touchZoomDistanceStart / _touchZoomDistanceEnd; _touchZoomDistanceStart = _touchZoomDistanceEnd; _eye.multiplyScalar( factor ); } else { factor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * _this.zoomSpeed * _this.allSpeedsFactor; if ( factor !== 1.0 &amp;&amp; factor &gt; 0.0 ) { _eye.multiplyScalar( factor ); } if ( _this.staticMoving ) { _zoomStart.copy( _zoomEnd ); } else { _zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor * _this.allSpeedsFactor; } } }; this.panCamera = ( function () { var mouseChange = new THREE.Vector2(), objectUp = new THREE.Vector3(), rv = new THREE.Vector3() pan = new THREE.Vector3(); return function panCamera() { mouseChange.copy( _panEnd ).sub( _panStart ); mouseChange.setLength(mouseChange.length() * _this.allSpeedsFactor); if ( mouseChange.lengthSq() || _this.RVMovingFactor ) { mouseChange.multiplyScalar( _eye.length() * _this.panSpeed ); pan.copy( _eye ).cross( _this.object.up ).setLength( mouseChange.x ); pan.add( objectUp.copy( _this.object.up ).setLength( mouseChange.y ) ); pan.add( rv.copy( _eye ).setLength(_this.RVMovingFactor * _eye.length()) ); _this.object.position.add( pan ); _this.target.add( pan ); if ( _this.staticMoving ) { _panStart.copy( _panEnd ); } else { _panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( _this.dynamicDampingFactor * _this.allSpeedsFactor ) ); } } }; }() ); this.checkDistances = function () { if ( ! _this.noZoom || ! _this.noPan ) { if ( _eye.lengthSq() &gt; _this.maxDistance * _this.maxDistance ) { _this.object.position.addVectors( _this.target, _eye.setLength( _this.maxDistance ) ); _zoomStart.copy( _zoomEnd ); } if ( _eye.lengthSq() &lt; _this.minDistance * _this.minDistance ) { _this.object.position.addVectors( _this.target, _eye.setLength( _this.minDistance ) ); _zoomStart.copy( _zoomEnd ); } } }; this.update = function () { _eye.subVectors( _this.object.position, _this.target ); if ( ! _this.noRotate ) { _this.rotateCamera(); } if ( ! _this.noZoom ) { _this.zoomCamera(); } if ( ! _this.noPan ) { _this.panCamera(); } _this.object.position.addVectors( _this.target, _eye ); _this.checkDistances(); _this.object.lookAt( _this.target ); if ( lastPosition.distanceToSquared( _this.object.position ) &gt; EPS ) { _this.dispatchEvent( changeEvent ); lastPosition.copy( _this.object.position ); } _this.RVMovingFactor = 0.0; _this.rotationZFactor = 0.0; }; this.reset = function () { _state = STATE.NONE; _prevState = STATE.NONE; _this.target.copy( _this.target0 ); _this.object.position.copy( _this.position0 ); _this.object.up.copy( _this.up0 ); _eye.subVectors( _this.object.position, _this.target ); _this.object.lookAt( _this.target ); _this.dispatchEvent( changeEvent ); lastPosition.copy( _this.object.position ); }; // listeners function keydown( event ) { if ( _this.enabled === false ) return; //window.removeEventListener( 'keydown', keydown ); _prevState = _state; /** if ( _state !== STATE.NONE ) { return; } else if ( event.keyCode === _this.keys[ STATE.ROTATE ] &amp;&amp; ! _this.noRotate ) { _state = STATE.ROTATE; } else if ( event.keyCode === _this.keys[ STATE.ZOOM ] &amp;&amp; ! _this.noZoom ) { _state = STATE.ZOOM; } else if ( event.keyCode === _this.keys[ STATE.PAN ] &amp;&amp; ! _this.noPan ) { _state = STATE.PAN; } **/ switch (event.keyCode) { // 81:Q; 87:W; 69:E; 82:R; // 65:A; 83:S; 68:D; 70:F; // 90:Z; 88:X; 67:C; 86:V; // 107:+; 109:-; 16:Shift; 17:Ctrl; 18:Alt; 9:Tab; // 38:Up; 37:Left; 40:Down; 39:Right; case 87: _this.RVMovingFactor = -0.002 * _this.allSpeedsFactor;//W break; case 83: _this.RVMovingFactor = 0.002 * _this.allSpeedsFactor;//S break; case 65: _movePrev.copy( _moveCurr ); _moveCurr.x -= 0.01 * _this.allSpeedsFactor; //A break; case 68: _movePrev.copy( _moveCurr ); _moveCurr.x += 0.01 * _this.allSpeedsFactor; //D break; case 90: _movePrev.copy( _moveCurr ); _moveCurr.y -= 0.01 * _this.allSpeedsFactor; //Z break; case 88: _movePrev.copy( _moveCurr ); _moveCurr.y += 0.01 * _this.allSpeedsFactor; //X break; case 81: _this.rotationZFactor = -0.01 * _this.allSpeedsFactor;//Q break; case 69: _this.rotationZFactor = 0.01 * _this.allSpeedsFactor;//E break; case 107: _zoomStart.y += 0.02 * _this.allSpeedsFactor; // + break; case 109: _zoomStart.y -= 0.02 * _this.allSpeedsFactor; // - break; case 38: // up _panEnd.y -= 0.01 * _this.allSpeedsFactor; break; case 40: // down _panEnd.y += 0.01 * _this.allSpeedsFactor; break; case 37: // left _panEnd.x -= 0.01 * _this.allSpeedsFactor; break; case 39: // right _panEnd.x += 0.01 * _this.allSpeedsFactor; break; case 82: // R _this.allSpeedsFactor = 0.33; break; case 16: // Shift _this.allSpeedsFactor = 0.05; break; } } function keyup( event ) { if ( _this.enabled === false ) return; switch (event.keyCode) { // 81:Q; 87:W; 69:E; 82:R; // 65:A; 83:S; 68:D; 70:F; // 90:Z; 88:X; 67:C; 86:V; // 107:+; 109:-; 16:Shift; 17:Ctrl; 18:Alt; 9:Tab; // 38:Up; 37:Left; 40:Down; 39:Right; case 87: // W _this.RVMovingFactor = 0.0; break; case 83: // S _this.RVMovingFactor = 0.0; break; case 81: // Q _this.rotationZFactor = 0.0; break; case 69: // E _this.rotationZFactor = 0.0; break; case 82: // R _this.allSpeedsFactor = 1.0; break; case 16: // Shift _this.allSpeedsFactor = 1.0; break; } _state = _prevState; //window.addEventListener( 'keydown', keydown, false ); } function mousedown( event ) { if ( _this.enabled === false ) return; event.preventDefault(); event.stopPropagation(); if ( _state === STATE.NONE ) { _state = event.button; } if ( _state === STATE.ROTATE &amp;&amp; ! _this.noRotate ) { _moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) ); _movePrev.copy( _moveCurr ); } else if ( _state === STATE.ZOOM &amp;&amp; ! _this.noZoom ) { _zoomStart.copy( getMouseOnScreen( event.pageX, event.pageY ) ); _zoomEnd.copy( _zoomStart ); } else if ( _state === STATE.PAN &amp;&amp; ! _this.noPan ) { _panStart.copy( getMouseOnScreen( event.pageX, event.pageY ) ); _panEnd.copy( _panStart ); } document.addEventListener( 'mousemove', mousemove, false ); document.addEventListener( 'mouseup', mouseup, false ); _this.dispatchEvent( startEvent ); } function mousemove( event ) { if ( _this.enabled === false ) return; event.preventDefault(); event.stopPropagation(); if ( _state === STATE.ROTATE &amp;&amp; ! _this.noRotate ) { _movePrev.copy( _moveCurr ); _moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) ); } else if ( _state === STATE.ZOOM &amp;&amp; ! _this.noZoom ) { _zoomEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) ); } else if ( _state === STATE.PAN &amp;&amp; ! _this.noPan ) { _panEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) ); } } function mouseup( event ) { if ( _this.enabled === false ) return; event.preventDefault(); event.stopPropagation(); _state = STATE.NONE; document.removeEventListener( 'mousemove', mousemove ); document.removeEventListener( 'mouseup', mouseup ); _this.dispatchEvent( endEvent ); } function mousewheel( event ) { if ( _this.enabled === false ) return; if ( _this.noZoom === true ) return; event.preventDefault(); event.stopPropagation(); switch ( event.deltaMode ) { case 2: // Zoom in pages _zoomStart.y -= event.deltaY * 0.025 * _this.allSpeedsFactor; break; case 1: // Zoom in lines _zoomStart.y -= event.deltaY * 0.01 * _this.allSpeedsFactor; break; default: // undefined, 0, assume pixels _zoomStart.y -= event.deltaY * 0.00025 * _this.allSpeedsFactor; break; } _this.dispatchEvent( startEvent ); _this.dispatchEvent( endEvent ); } function touchstart( event ) { if ( _this.enabled === false ) return; switch ( event.touches.length ) { case 1: _state = STATE.TOUCH_ROTATE; _moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) ); _movePrev.copy( _moveCurr ); break; default: // 2 or more _state = STATE.TOUCH_ZOOM_PAN; var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX; var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY; _touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt( dx * dx + dy * dy ); var x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2; var y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2; _panStart.copy( getMouseOnScreen( x, y ) ); _panEnd.copy( _panStart ); break; } _this.dispatchEvent( startEvent ); } function touchmove( event ) { if ( _this.enabled === false ) return; event.preventDefault(); event.stopPropagation(); switch ( event.touches.length ) { case 1: _movePrev.copy( _moveCurr ); _moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) ); break; default: // 2 or more var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX; var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY; _touchZoomDistanceEnd = Math.sqrt( dx * dx + dy * dy ); var x = ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX ) / 2; var y = ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY ) / 2; _panEnd.copy( getMouseOnScreen( x, y ) ); break; } } function touchend( event ) { if ( _this.enabled === false ) return; switch ( event.touches.length ) { case 0: _state = STATE.NONE; break; case 1: _state = STATE.TOUCH_ROTATE; _moveCurr.copy( getMouseOnCircle( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY ) ); _movePrev.copy( _moveCurr ); break; } _this.dispatchEvent( endEvent ); } function contextmenu( event ) { if ( _this.enabled === false ) return; event.preventDefault(); } this.dispose = function () { this.domElement.removeEventListener( 'contextmenu', contextmenu, false ); this.domElement.removeEventListener( 'mousedown', mousedown, false ); this.domElement.removeEventListener( 'wheel', mousewheel, false ); this.domElement.removeEventListener( 'touchstart', touchstart, false ); this.domElement.removeEventListener( 'touchend', touchend, false ); this.domElement.removeEventListener( 'touchmove', touchmove, false ); document.removeEventListener( 'mousemove', mousemove, false ); document.removeEventListener( 'mouseup', mouseup, false ); window.removeEventListener( 'keydown', keydown, false ); window.removeEventListener( 'keyup', keyup, false ); }; this.domElement.addEventListener( 'contextmenu', contextmenu, false ); this.domElement.addEventListener( 'mousedown', mousedown, false ); this.domElement.addEventListener( 'wheel', mousewheel, false ); this.domElement.addEventListener( 'touchstart', touchstart, false ); this.domElement.addEventListener( 'touchend', touchend, false ); this.domElement.addEventListener( 'touchmove', touchmove, false ); window.addEventListener( 'keydown', keydown, false ); window.addEventListener( 'keyup', keyup, false ); this.handleResize(); // force an update at start this.update(); }; THREE.AstroControls.prototype = Object.create( THREE.EventDispatcher.prototype ); THREE.AstroControls.prototype.constructor = THREE.AstroControls;</span></span></code> </pre><br></div></div><br><h4>  рдЖрд╡реЗрджрди </h4><br>  рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдкреВрд░рд╛ рдХреЛрдб рд╕рд╣реЗрдЬреЗрдВ, рдЗрд╕реЗ рдПрд╕реНрдЯреНрд░реЛ рдХрд╛рдВрдЯреНрд░реЛрд▓реЗрдЬрд╝ рдирд╛рдо рджреЗрдВ, рдЕрдкрдиреА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред <br><br>  рдЗрд╕ рддрд░рд╣ рдирд┐рдпрдВрддреНрд░рдг рдмрдирд╛рдПрдБ: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> controls; ... <span class="hljs-comment"><span class="hljs-comment">//      , ,  : controls = new THREE.AstroControls( camera, renderer.domElement ); //  controls //       ,     . // controls      . controls.rotateSpeed = 1.0; controls.zoomSpeed = 1.2; controls.panSpeed = 0.8; controls.noZoom = false; controls.noPan = false; controls.staticMoving = true; controls.dynamicDampingFactor = 0.3;</span></span></code> </pre> <br>  рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рд╕рдм рдХреБрдЫ рдорд╛рдирдХ рд╣реИ, рдирд┐рдпрдиреНрддреНрд░рдг рд╕реЗрдЯ рдХрд░реЗрдВред рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣ control.target рдФрд░ controlaautoRotateред<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(рдпрджрд┐ рдЖрдкрдХреЗ рдХреЛрдИ рдкреНрд░рд╢реНрди рд╣реИрдВ, рддреЛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреАрди</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ </font><font style="vertical-align: inherit;">рджреЗрдЦреЗрдВред рдСрд░реНрдмрд┐рдЯрдХрдВрдЯреНрд░реЛрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рдЧрднрдЧ рд╕рднреА рдЙрджрд╛рд╣рд░рдг рд╣реИрдВред рдПрд╕реНрдЯреНрд░реЛрдХреЛрдиреНрдЯреНрд░реЛрд▓ рдХреЛ рдЙрд╕реА рддрд░рд╣ рд╕реЗ рд╕рдВрднрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ) рдФрд░ рдорд╛рдЙрд╕ рдпрд╛ рдХреАрдмреЛрд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рднреА рддреАрди рдХреБрд▓реНрд╣рд╛рдбрд╝рд┐рдпреЛрдВ рдХреА рддрд░рд╣, рдХреИрдорд░рд╛ рдШреБрдорд╛рдиреЗ рдФрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдпрд╛ рд╕реНрдкрд░реНрд╢-рдШрдЯрдирд╛рдПрдБред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдпрд╣ рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИред</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi435974/">https://habr.com/ru/post/hi435974/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi435962/index.html">Aeron рдХреА 25 рд╡реАрдВ рд╡рд░реНрд╖рдЧрд╛рдВрда: Aeron Remastered рдХреЗ рдЕрджреНрдпрддрди рд╕рдВрд╕реНрдХрд░рдг рдХреА рд╕рдВрд╡реЗрджрдирд╛рдПрдВ рдФрд░ рдЫрд╛рдк</a></li>
<li><a href="../hi435964/index.html">Ethereum рдХреА рдпреЛрдЬрдирд╛ 99% рдЕрдзрд┐рдХ рдХрд┐рдлрд╛рдпрддреА рд╣реИ</a></li>
<li><a href="../hi435968/index.html">рд░реЛрдмреЛрдЯ рдХреЗ рд▓рд┐рдП рдбреАрдк рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХрд╛ рдЕрд╡рд▓реЛрдХрди</a></li>
<li><a href="../hi435970/index.html">Node.js рдХреЗ рд╕рд╛рде рд╡реЗрдм рд╕рд░реНрд╡рд░ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рд╢реБрд░реБрдЖрддреА рдЧрд╛рдЗрдб</a></li>
<li><a href="../hi435972/index.html">рдкреНрд░рд╕реНрддреБрдд рд╣реИ рд╕реНрдкреНрд░рд┐рдВрдЧ рдореЗрдВ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рд╢реАрд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ</a></li>
<li><a href="../hi435976/index.html">рдЙрддреНрдкрд╛рджрди рдореЗрдВ WebAssembly рдФрд░ рд╕реНрдорд╛рд░реНрдЯ рдЯреАрд╡реА рдХреЗ "рдорд╛рдЗрдирдлреАрд▓реНрдб": рдЖрдВрджреНрд░реЗрдИ рдирд╛рдЧрд┐рдЦ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░</a></li>
<li><a href="../hi435978/index.html">рдмреЙрдпреЛрдореАрдЯреНрд░рд┐рдХ рд╕реБрд░рдХреНрд╖рд╛ Workarounds</a></li>
<li><a href="../hi435984/index.html">рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдФрд░ рднрд╛рд╖рд╛ рдХрд╛ рджрд░реНрд╢рди</a></li>
<li><a href="../hi435986/index.html">рд╣рд╛рд░реНрдб рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рд╕реЗ рдмрд╛рд╣рд░ рднрд╛рдЧрдиреЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдВрдбреЛрдЬ рд╕рд┐рд╕реНрдЯрдо рдЕрдкрдбреЗрдЯ рдХреЗ рд▓рд┐рдП 7 рдЬреАрдмреА рдЖрд░рдХреНрд╖рд┐рдд рдХрд░реЗрдЧрд╛</a></li>
<li><a href="../hi435988/index.html">рдкрд╛рдпрдерди рдкреНрд░рдХрд╛рд░ рдХреЗ рдПрдиреЛрдЯреЗрд╢рди рдХрд╛ рдкрд░рд┐рдЪрдпред рд╡рд┐рд╕реНрддрд╛рд░</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>