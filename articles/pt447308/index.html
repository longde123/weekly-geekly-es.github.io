<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèΩ üêà ‚ôíÔ∏è Design instant√¢neo üëÖ üê™ üëäüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As pessoas aprendem arquitetura a partir de livros antigos que foram escritos para Java. Os livros s√£o bons, mas fornecem uma solu√ß√£o para os problema...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Design instant√¢neo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/447308/">  As pessoas aprendem arquitetura a partir de livros antigos que foram escritos para Java.  Os livros s√£o bons, mas fornecem uma solu√ß√£o para os problemas da √©poca com instrumentos da √©poca.  O tempo mudou, o C # √© mais parecido com o Scala leve do que com o Java, e existem poucos bons livros novos. <br><br>  Neste artigo, examinaremos os crit√©rios para c√≥digo bom e c√≥digo ruim, como e o que medir.  Veremos uma vis√£o geral das tarefas e abordagens t√≠picas, analisaremos os pr√≥s e os contras.  No final, haver√° recomenda√ß√µes e pr√°ticas recomendadas para o design de aplicativos da web. <br><br>  Este artigo √© uma transcri√ß√£o do meu relat√≥rio da confer√™ncia DotNext 2018 em Moscou.  Al√©m do texto, h√° um v√≠deo e um link para os slides abaixo do corte. <br><br><img src="https://habrastorage.org/webt/qu/ur/ih/quurihchxowghlgnkanhvmb5o7e.jpeg"><br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qJPwSvDLmQE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Slides</b></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina de relat√≥rio no site</a> . </blockquote>  Brevemente sobre mim: sou de Kazan, trabalho para o High Tech Group.  Estamos desenvolvendo software para neg√≥cios.  Recentemente, tenho ministrado um curso na Universidade Federal de Kazan, chamado Corporate Software Development.  De tempos em tempos, ainda escrevo artigos sobre a Habr sobre pr√°ticas de engenharia, sobre o desenvolvimento de software corporativo. <br><br>  Como voc√™ provavelmente j√° deve ter adivinhado, hoje vou falar sobre o desenvolvimento de software corporativo, como estruturar aplicativos da Web modernos: <br><br><ul><li>  os crit√©rios </li><li>  uma breve hist√≥ria do desenvolvimento do pensamento arquitet√¥nico (o que foi, o que se tornou, o que s√£o problemas); </li><li>  vis√£o geral das falhas da arquitetura cl√°ssica de sopro </li><li>  a decis√£o </li><li>  an√°lise passo a passo da implementa√ß√£o sem entrar em detalhes </li><li>  resultados. </li></ul><br><h1>  Crit√©rios </h1><br>  N√≥s formulamos os crit√©rios.  Eu realmente n√£o gosto quando falar sobre design √© do tipo "meu kung fu √© mais forte que o seu kung fu".  Uma empresa possui, em princ√≠pio, um crit√©rio espec√≠fico chamado dinheiro.  Todo mundo sabe que tempo √© dinheiro, ent√£o esses dois componentes costumam ser os mais importantes. <br><br><img src="https://habrastorage.org/webt/pu/2e/fh/pu2efhyhoibrcu9lav6fzdg48da.jpeg"><br><br>  Ent√£o, os crit√©rios.  Em princ√≠pio, a empresa costuma nos perguntar ‚Äúo maior n√∫mero poss√≠vel de recursos por unidade de tempo‚Äù, mas com uma ressalva - esses recursos devem funcionar.  E o primeiro passo em que isso pode ocorrer √© a revis√£o de c√≥digo.  Ou seja, parece que o programador disse: "Farei isso em tr√™s horas".  Tr√™s horas se passaram, a revis√£o entrou no c√≥digo e o l√≠der da equipe disse: "Oh, n√£o, refa√ßa."  Existem mais tr√™s - e quantas itera√ß√µes a revis√£o de c√≥digo passou, voc√™ precisa multiplicar tr√™s horas. <br><br>  O pr√≥ximo ponto √© o retorno do est√°gio de teste de aceita√ß√£o.  A mesma coisa  Se o recurso n√£o funcionar, isso n√£o ser√° feito. Essas tr√™s horas se estendem por uma semana, duas - normalmente, como de costume.  O √∫ltimo crit√©rio √© o n√∫mero de regress√µes e erros que, apesar de serem testados e aceitos, passaram pela produ√ß√£o.  Isso tamb√©m √© muito ruim.  H√° um problema com esse crit√©rio.  √â dif√≠cil rastrear, porque a conex√£o entre o fato de inserirmos algo no reposit√≥rio e o fato de que algo quebrou ap√≥s duas semanas pode ser dif√≠cil de rastrear.  Mas, no entanto, √© poss√≠vel. <br><br><h1>  Desenvolvimento de arquitetura </h1><br>  Era uma vez, quando os programadores estavam come√ßando a escrever programas, ainda n√£o havia arquitetura, e todos faziam o que gostavam. <br><br><img src="https://habrastorage.org/webt/27/l7/oq/27l7oqmpgjyxndbw-4trowmrmem.jpeg"><br><br>  Portanto, temos um estilo arquitet√¥nico t√£o amplo.  Isso √© chamado de "c√≥digo de macarr√£o" aqui, eles dizem "c√≥digo de espaguete" no exterior.  Tudo est√° conectado com tudo: mudamos algo no ponto A - ele quebra no ponto B, √© completamente imposs√≠vel entender o que est√° conectado com o qu√™.  Naturalmente, os programadores rapidamente perceberam que isso n√£o funcionaria, e alguma estrutura precisava ser feita e decidiram que algumas camadas nos ajudariam.  Agora, se voc√™ imagina que carne picada √© c√≥digo e lasanha √© uma camada dessas, aqui est√° uma ilustra√ß√£o da arquitetura em camadas.  A carne picada permaneceu picada, mas agora a carne picada da camada 1 n√£o pode mais falar com a carne picada da camada 2. Demos o c√≥digo de alguma forma: mesmo na figura, voc√™ pode ver que a escalada √© mais emoldurada. <br><br><img src="https://habrastorage.org/webt/yx/_j/cu/yx_jcumnfvnensrmrbjwi9lyyqa.jpeg"><br><br>  Todos provavelmente est√£o familiarizados com a <b>arquitetura cl√°ssica em camadas</b> : h√° uma interface do usu√°rio, h√° uma l√≥gica de neg√≥cios e h√° uma camada de acesso a dados.  Ainda existem todos os tipos de servi√ßos, fachadas e camadas, nomeados para o arquiteto que saiu da empresa, e pode haver um n√∫mero ilimitado deles. <br><br><img src="https://habrastorage.org/webt/dd/28/qj/dd28qjfaycsftyr71tczg5ykxjo.jpeg"><br><br>  O pr√≥ximo est√°gio foi a chamada <b>arquitetura da cebola</b> .  Parece que h√° uma enorme diferen√ßa: antes disso havia um pequeno quadrado, e aqui havia c√≠rculos.  Parece ser completamente diferente. <br><br><img src="https://habrastorage.org/webt/pe/8r/rx/pe8rrxifll2tswmz63paezukklq.jpeg"><br><br>  Na verdade n√£o.  Toda a diferen√ßa √© que, em algum momento da √©poca, os princ√≠pios do SOLID foram formulados e, na cebola cl√°ssica, existe um problema com a invers√£o de depend√™ncia, porque o c√≥digo de dom√≠nio abstrato, por algum motivo, depende da implementa√ß√£o, no Data Access, por isso decidimos implantar o Data Access. e o acesso a dados depende do dom√≠nio. <br><br><img src="https://habrastorage.org/webt/8o/eb/we/8oebwed-cag1f-zvake5t9lmhl8.jpeg"><br><br>  Aqui eu pratiquei desenho e desenhei a arquitetura da cebola, mas n√£o classicamente com os ‚Äúan√©is‚Äù.  Eu tenho algo entre um pol√≠gono e c√≠rculos.  Fiz isso para mostrar simplesmente que, se voc√™ se deparar com as palavras ‚Äúcebola‚Äù, ‚Äúhexagonal‚Äù ou ‚Äúportas e adaptadores‚Äù - essas s√£o todas iguais.  O ponto √© que o dom√≠nio est√° no centro, est√° envolto em servi√ßos, eles podem ser servi√ßos de dom√≠nio ou aplicativo, como voc√™ quiser.  E o mundo exterior na forma de interface do usu√°rio, testes e infraestrutura para onde o DAL se mudou - eles se comunicam com o dom√≠nio por meio dessa camada de servi√ßo. <br><br><h2>  Um exemplo simples.  Atualiza√ß√£o por email </h2><br>  Vamos ver como seria um caso de uso simples nesse paradigma - atualizando o endere√ßo de email do usu√°rio. <br><br><img src="https://habrastorage.org/webt/ta/fg/x-/tafgx-5pwfraeofdjg323ewoova.jpeg"><br><br>  Precisamos enviar uma solicita√ß√£o, validar, atualizar o valor no banco de dados, enviar uma notifica√ß√£o para um novo email: ‚ÄúEst√° tudo em ordem, voc√™ mudou seu email, sabemos que est√° tudo bem‚Äù e responde ao navegador ‚Äú200‚Äù - est√° tudo bem. <br><br><img src="https://habrastorage.org/webt/xs/vm/0f/xsvm0f4b6zhpypwnixjazbv3ufi.jpeg"><br><br>  O c√≥digo pode se parecer com isso.  Aqui temos a valida√ß√£o padr√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ASP.NET</a> MVC, existe o ORM para ler e atualizar os dados e h√° algum tipo de remetente de email que envia uma notifica√ß√£o.  Parece que est√° tudo bem, certo?  Uma ressalva - em um mundo ideal. <br><br>  No mundo real, a situa√ß√£o √© um pouco diferente.  O objetivo √© adicionar autoriza√ß√£o, verifica√ß√£o de erros, formata√ß√£o, registro e cria√ß√£o de perfil.  Isso tudo n√£o tem nada a ver com o nosso caso de uso, mas deve ser.  E esse pequeno peda√ßo de c√≥digo se tornou grande e assustador: com muito aninhamento, muito c√≥digo, com o fato de que √© dif√≠cil de ler e, o mais importante, que h√° mais c√≥digo de infraestrutura do que o c√≥digo de dom√≠nio. <br><br><img src="https://habrastorage.org/webt/lh/xr/xd/lhxrxdbyaacgxsxrjcsoinbq-c8.jpeg"><br><br>  "Onde est√£o os servi√ßos?"  voc√™ diz.  Eu escrevi toda a l√≥gica para os controladores.  Claro, isso √© um problema, agora vou adicionar servi√ßos e tudo ficar√° bem. <br><br><img src="https://habrastorage.org/webt/c6/nd/ca/c6ndcaxmuebeyawelqctgsh19ig.jpeg"><br><br>  Adicionamos servi√ßos, e realmente fica melhor, porque em vez de um grande cal√ßado, temos uma pequena linha bonita. <br><br>  Melhorou?  Tornou-se!  E agora podemos reutilizar esse m√©todo em diferentes controladores.  O resultado √© √≥bvio.  Vamos olhar para a implementa√ß√£o deste m√©todo. <br><br><img src="https://habrastorage.org/webt/up/xx/rx/upxxrx8d_fc-5qmzbk-d0afuht4.jpeg"><br><br>  Mas aqui nem tudo √© t√£o bom.  Este c√≥digo ainda est√° aqui.  Acabamos de transferir a mesma coisa para os servi√ßos.  Decidimos n√£o resolver o problema, mas simplesmente disfar√ß√°-lo e transferi-lo para outro local.  Isso √© tudo. <br><br><img src="https://habrastorage.org/webt/m0/bo/fj/m0bofjvz471nmxub7ubqhshqwgi.jpeg"><br><br>  Al√©m disso, surgem outras quest√µes.  Devemos fazer a valida√ß√£o no controlador ou aqui?  Bem, mais ou menos no controlador.  E se voc√™ precisar acessar o banco de dados e verificar se existe um ID ou que n√£o h√° outro usu√°rio com esse email?  Hmm, bem, ent√£o no servi√ßo.  Mas tratamento de erros aqui?  Essa manipula√ß√£o de erros provavelmente est√° aqui e a manipula√ß√£o de erros que responder√° ao navegador no controlador.  E o m√©todo SaveChanges, est√° no servi√ßo ou voc√™ precisa transferi-lo para o controlador?  Pode ser assim, porque, se um servi√ßo for chamado, √© mais l√≥gico chamar o servi√ßo e, se voc√™ tiver tr√™s m√©todos de servi√ßos no controlador que precisam ser chamados, precisar√° cham√°-lo fora desses servi√ßos para que a transa√ß√£o seja uma.  Essas reflex√µes sugerem que talvez as camadas n√£o resolvam nenhum problema. <br><br><img src="https://habrastorage.org/webt/9d/s6/gd/9ds6gdwecmtqyjjv3rko5l-rccg.jpeg"><br><br>  E essa ideia ocorreu a mais de uma pessoa.  Se voc√™ pesquisar no Google, pelo menos tr√™s desses maridos respeit√°veis ‚Äã‚Äãescrevem sobre a mesma coisa.  De cima para baixo: Stephen .NET Junkie (infelizmente, n√£o sei o sobrenome dele, porque ela n√£o aparece em nenhum lugar da Internet), a autora do cont√™iner <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Simple Injector</a> IoC.  Em seguida, Jimmy Bogard √© o autor do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AutoMapper</a> .  E abaixo, est√° Scott Vlashin, autor de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">F # por divers√£o e lucro</a> . <br><br><img src="https://habrastorage.org/webt/pu/lt/rz/pultrzyz_24mf5fycqif--zcbpe.jpeg"><br><br>  Todas essas pessoas est√£o falando da mesma coisa e sugerem a cria√ß√£o de aplicativos n√£o com base em camadas, mas com base em casos de uso, ou seja, nos requisitos que a empresa est√° solicitando.  Por conseguinte, o caso de uso em C # pode ser determinado usando a interface IHandler.  Ele possui valores de entrada, existem valores de sa√≠da e existe um m√©todo em si que realmente executa esse caso de uso. <br><br><img src="https://habrastorage.org/webt/9m/lj/hw/9mljhwhphjkuckh2r5tvegoyzg0.jpeg"><br><br>  E dentro desse m√©todo, pode haver um modelo de dom√≠nio ou algum modelo desnormalizado para leitura, talvez com o Dapper ou com o Elastic Search, se voc√™ precisar procurar algo e talvez tenha o Legacy sistema com procedimentos armazenados - n√£o h√° problema, assim como solicita√ß√µes de rede - bem, em geral, qualquer coisa que voc√™ possa precisar l√°.  Mas se n√£o houver camadas, o que fazer? <br><br><img src="https://habrastorage.org/webt/lg/iw/se/lgiwseqpyf9krjfkv4j9ciluxri.jpeg"><br><br>  Para come√ßar, vamos nos livrar do UserService.  N√≥s removemos o m√©todo e criamos uma classe.  E vamos remov√™-lo e remov√™-lo novamente.  E ent√£o tire e remova a classe. <br><br><img src="https://habrastorage.org/webt/xx/tv/z1/xxtvz10bmxyzpefudhd2cw7892y.jpeg"><br><br>  Vamos pensar, essas classes s√£o equivalentes ou n√£o?  A classe GetUser retorna dados e n√£o altera nada no servidor.  Isso, por exemplo, sobre a solicita√ß√£o "D√™-me o ID do usu√°rio".  As classes UpdateEmail e BanUser retornam o resultado da opera√ß√£o e alteram o estado.  Por exemplo, quando dizemos ao servidor: "Por favor, altere o estado, voc√™ precisa alterar alguma coisa." <br><br><img src="https://habrastorage.org/webt/yj/qs/tn/yjqstnlgzw9lwrk8s1nr0j2s47u.jpeg"><br><br>  Vamos dar uma olhada no protocolo HTTP.  Existe um m√©todo GET que, de acordo com a especifica√ß√£o do protocolo HTTP, deve retornar dados e n√£o alterar o estado do servidor. <br><br><img src="https://habrastorage.org/webt/uq/ql/7i/uqql7icixrsmjce88qwxwuxouss.jpeg"><br><br>  E existem outros m√©todos que podem alterar o status do servidor e retornar o resultado da opera√ß√£o. <br><br><img src="https://habrastorage.org/webt/zu/u3/l6/zuu3l6-bulai-mgo4fozlyru8ci.jpeg"><br><br>  O paradigma CQRS parece ter sido projetado especificamente para o protocolo HTTP.  Consulta s√£o opera√ß√µes GET e comandos s√£o PUT, POST, DELETE - n√£o √© necess√°rio inventar nada. <br><br><img src="https://habrastorage.org/webt/2t/wk/yp/2twkypfgr9s5xxslujdjfelkkx4.jpeg"><br><br>  Redefinimos nosso manipulador e definimos interfaces adicionais.  IQueryHandler, que difere apenas na pend√™ncia da restri√ß√£o de que o tipo de valores de entrada seja IQuery.  O IQuery √© uma interface de marcador, n√£o h√° nada al√©m deste gen√©rico.  Precisamos do gen√©rico para colocar restri√ß√µes no QueryHandler e, agora, declarando QueryHandler, n√£o podemos passar para l√° n√£o, mas passando o objeto Query para l√°, sabemos seu valor de retorno.  Isso √© conveniente se voc√™ tiver apenas uma interface, para que n√£o precise procurar a implementa√ß√£o deles no c√≥digo e, novamente, para n√£o atrapalhar.  Voc√™ escreve IQueryHandler, escreve uma implementa√ß√£o l√° e no TOut n√£o pode substituir outro tipo de valor de retorno.  Simplesmente n√£o compila.  Assim, voc√™ pode ver imediatamente quais valores de entrada correspondem a quais dados de entrada. <br><br><img src="https://habrastorage.org/webt/e5/k9/pd/e5k9pdmjpohmvppi9j5mco2lpz8.jpeg"><br><br>  A situa√ß√£o √© completamente semelhante para o CommandHandler com uma exce√ß√£o: esse gen√©rico √© necess√°rio para mais um truque, que veremos um pouco mais adiante. <br><br><h3>  Implementa√ß√£o do manipulador </h3><br>  Manipuladores, anunciamos, qual √© a implementa√ß√£o deles? <br><br><img src="https://habrastorage.org/webt/xb/ye/no/xbyeno8s7xry4tv5n1t2sgig4fk.jpeg"><br><br>  Existe algum problema, sim?  Algo parece ter falhado. <br><br><h3>  Decoradores correm para o resgate </h3> <br>  Mas n√£o ajudou, porque ainda estamos no meio do caminho, precisamos finalizar um pouco mais e, desta vez, precisamos usar o padr√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">decorador</a> , ou seja, seu maravilhoso recurso de layout.  O decorador pode ser embrulhado em um decorador, embrulhado em um decorador, embrulhado em um decorador - continue at√© ficar entediado. <br><br><img src="https://habrastorage.org/webt/pj/oj/m2/pjojm2jkr9q2q3of-rgouuydrjc.jpeg"><br><br>  Ent√£o, tudo ficar√° assim: existe uma entrada Dto, ela entra no primeiro decorador, no segundo, terceiro, depois entramos no Handler e tamb√©m sa√≠mos, passamos por todos os decoradores e retornamos o Dto no navegador.  Declaramos uma classe base abstrata para herdar posteriormente, o corpo de Handler √© passado para o construtor e declaramos o m√©todo Handle abstrato, no qual a l√≥gica decoradora adicional ser√° suspensa. <br><br><img src="https://habrastorage.org/webt/4k/df/ha/4kdfha-rrtuvomibpp8tuadhcrw.jpeg"><br><br>  Agora, com a ajuda de decoradores, voc√™ pode construir um pipeline inteiro.  Vamos come√ßar com as equipes.  O que n√≥s t√≠nhamos?  Insira valores, valida√ß√£o, verifica√ß√£o de direitos de acesso, a pr√≥pria l√≥gica, alguns eventos que ocorrem como resultado dessa l√≥gica e retorne valores. <br><br><img src="https://habrastorage.org/webt/zp/yw/3i/zpyw3iastzi8ggkluwnk_dhdes0.jpeg"><br><br>  Vamos come√ßar com a valida√ß√£o.  Declaramos um decorador.  O IEnumerable dos validadores do tipo T. entra no construtor deste decorador.Executamos todos eles, verificamos se a valida√ß√£o falha e o tipo de retorno √© <code>IEnumerable&lt;validationresult&gt;</code> , e podemos devolv√™-lo porque os tipos correspondem.  E se for algum outro Hander, bem, voc√™ precisar√° lan√ßar uma exce√ß√£o, porque n√£o h√° resultado aqui, o tipo de outro valor de retorno. <br><br><img src="https://habrastorage.org/webt/wp/pi/bp/wppibp3w6wzoylmbhx8nsop6lda.jpeg"><br><br>  O pr√≥ximo passo √© seguran√ßa.  Tamb√©m declaramos o decorador, fazemos o m√©todo CheckPermission e verificamos.  Se de repente algo deu errado, tudo, n√£o continuamos.  Agora, depois de concluir todas as verifica√ß√µes e ter certeza de que est√° tudo bem, podemos cumprir nossa l√≥gica. <br><br><h3>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Obsess√£o com primitivos</a> </h3><br>  Antes de mostrar a implementa√ß√£o da l√≥gica, quero come√ßar um pouco mais cedo, ou seja, com os valores de entrada que chegam l√°. <br><br><img src="https://habrastorage.org/webt/gl/y5/ro/gly5roxocvdausjqf9dztn69jjk.jpeg"><br><br>  Agora, se destacarmos essa classe, na maioria das vezes ela pode ser algo assim.  Pelo menos o c√≥digo que vejo no trabalho di√°rio. <br><br><img src="https://habrastorage.org/webt/is/e4/6r/ise46rxpz-gsrqeqpqjwac-ir58.jpeg"><br><br>  Para que a valida√ß√£o funcione, adicionamos aqui alguns atributos que informam que tipo de valida√ß√£o √© essa.  Isso ajudar√° do ponto de vista da estrutura de dados, mas n√£o ajudar√° com a valida√ß√£o como verificar valores no banco de dados.  √â apenas EmailAddress, n√£o est√° claro como, onde verificar como usar esses atributos para acessar o banco de dados.  Em vez de atributos, voc√™ pode ir para tipos especiais, esse problema ser√° resolvido. <br><br><img src="https://habrastorage.org/webt/oq/6b/3x/oq6b3xuwdmc5xh_04v71g02jkmo.jpeg"><br><br>  Em vez da primitiva <code>int</code> , declaramos que um tipo de ID que possui um gen√©rico √© uma determinada entidade com uma chave int.  E n√≥s passamos essa entidade para o construtor ou passamos seu ID, mas, ao mesmo tempo, devemos passar uma fun√ß√£o que por Id possa receber e retornar, verificando se ela √© nula ou n√£o. <br><br><img src="https://habrastorage.org/webt/tt/fk/ut/ttfkutansz1nzthl3x5adtxftde.jpeg"><br><br>  Fazemos o mesmo com o email.  Converta todos os e-mails na linha inferior para que tudo pare√ßa o mesmo para n√≥s.  Em seguida, pegamos o atributo Email, declaramos como est√°tico para compatibilidade com a valida√ß√£o do ASP.NET, e aqui simplesmente o chamamos.  Ou seja, isso tamb√©m pode ser feito.  Para que a infraestrutura do ASP.NET capte tudo isso, voc√™ precisa modificar levemente a serializa√ß√£o e / ou ModelBinding.  N√£o h√° muito c√≥digo l√°, √© relativamente simples, ent√£o n√£o vou parar por a√≠. <br><br><img src="https://habrastorage.org/webt/md/5k/zi/md5kzigojhdaybdbizxrvby2p5w.jpeg"><br><br>  Ap√≥s essas altera√ß√µes, em vez de tipos primitivos, os tipos especializados aparecem aqui: ID e email.  E depois que o ModelBinder e o desserializador atualizado forem executados, sabemos com certeza que esses valores est√£o corretos, incluindo que esses valores est√£o no banco de dados.  "Invariantes" <br><br><img src="https://habrastorage.org/webt/hu/ew/ul/huewulf5m8-mwkha62fbu3dm5sy.jpeg"><br><br>  O pr√≥ximo ponto em que gostaria de me debru√ßar √© sobre o estado dos invariantes na classe, porque muitas vezes √© usado um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modelo an√™mico</a> , no qual h√° apenas uma classe, muitos getter-setters, n√£o est√° totalmente claro como eles devem trabalhar juntos.  Como trabalhamos com l√≥gica de neg√≥cios complexa, √© importante para n√≥s que o c√≥digo seja auto-documentado.  Em vez disso, √© melhor declarar o construtor real junto com vazio para o ORM, ele pode ser declarado protegido para que os programadores em seu c√≥digo de aplicativo n√£o possam cham√°-lo e o ORM poderia.  Aqui n√£o passamos o tipo primitivo, mas o tipo E-mail, ele j√° est√° correto, se for nulo, ainda lan√ßamos uma exce√ß√£o.  Voc√™ pode usar algum Fody, PostSharp, mas o C # 8. estar√° dispon√≠vel em breve.Em conseq√º√™ncia, haver√° um tipo de refer√™ncia N√£o anul√°vel e √© melhor aguardar pelo suporte no idioma.  No momento seguinte, se quisermos alterar o nome e o sobrenome, √© prov√°vel que desejemos alter√°-los juntos; portanto, deve haver um m√©todo p√∫blico apropriado que os altere. <br><br><img src="https://habrastorage.org/webt/p8/ze/vw/p8zevw3bkth4ialnrabvlsk3hru.jpeg"><br><br>  Nesse m√©todo p√∫blico, tamb√©m verificamos que o comprimento dessas linhas corresponde ao que usamos no banco de dados.  E se algo estiver errado, pare a execu√ß√£o.  Aqui eu uso o mesmo truque.  Declaro um atributo especial e apenas o chamo no c√≥digo do aplicativo. <br><br><img src="https://habrastorage.org/webt/tj/ae/mi/tjaemirkcgpbgkmknl9acjkhioa.jpeg"><br><br>  Al√©m disso, esses atributos podem ser reutilizados no Dto.  Agora, se eu quiser alterar o nome e o sobrenome, posso ter um comando de altera√ß√£o.  Vale a pena adicionar um construtor especial aqui?  Parece valer a pena.  Ficar√° melhor, ningu√©m mudar√° esses valores, n√£o os quebrar√°, eles estar√£o exatamente certos. <br><br><img src="https://habrastorage.org/webt/lt/hq/r1/lthqr1w63fzepclzgrcl6ykwaik.jpeg"><br><br>  Na verdade n√£o.  O fato √© que Dto n√£o s√£o realmente objetos.  Esse √© um dicion√°rio no qual colocamos dados desserializados.  Ou seja, eles fingem ser objetos, √© claro, mas eles t√™m apenas uma responsabilidade - √© ser serializado e desserializado.  Se tentarmos combater essa estrutura, come√ßaremos a anunciar alguns ModelBinders com os designers, fazer algo assim √© incrivelmente cansativo e, o mais importante, ser√° romper com os novos lan√ßamentos de novas estruturas.  Tudo isso foi bem descrito por Mark Simon no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Nas fronteiras do programa n√£o s√£o orientadas a objetos"</a> , se √© interessante, √© melhor ler o post dele, onde √© descrito em detalhes. <br><br><img src="https://habrastorage.org/webt/mf/bw/he/mfbwhegqg7nbmsw4iwj0y8w99c0.jpeg"><br><br>  Em resumo, temos um mundo externo sujo, colocamos verifica√ß√µes na entrada, convertemos para nosso modelo limpo e depois transferimos tudo de volta para serializa√ß√£o, para o navegador, novamente para o mundo externo sujo. <br><br><h3>  Handler </h3><br>  Depois de todas essas altera√ß√µes, como ser√° o Hander aqui? <br><br><img src="https://habrastorage.org/webt/o-/ov/wl/o-ovwlxyrkjuv2murrbk4ifttr4.jpeg"><br><br>  Escrevi duas linhas aqui para facilitar a leitura, mas em geral pode ser escrita em uma.  Os dados est√£o exatamente corretos, porque temos um sistema de tipos, existe valida√ß√£o, ou seja, os dados s√£o de concreto armado, n√£o √© necess√°rio verific√°-los novamente.  Esse usu√°rio tamb√©m existe, n√£o h√° outro usu√°rio com um e-mail t√£o ocupado, tudo pode ser feito.  No entanto, ainda n√£o h√° chamada para o m√©todo SaveChanges, n√£o h√° notifica√ß√£o e n√£o h√° logs e criadores de perfil, certo?  N√≥s seguimos em frente. <br><a name="events"></a><br><h3>  Eventos </h3><br>  Eventos de dom√≠nio. <br><br><img src="https://habrastorage.org/webt/fo/s8/tq/fos8tqpb3kq5ealyvsm3qu9ayhm.jpeg"><br><br>  Provavelmente, a primeira vez que este conceito foi popularizado por Udi Dahan em seu post <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Domain Events - Salvation"</a> .  L√°, ele sugere simplesmente declarar uma classe est√°tica com o m√©todo Raise e lan√ßar esses eventos.  Um pouco mais tarde, Jimmy Bogard prop√¥s uma melhor implementa√ß√£o, chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Um melhor padr√£o de eventos de dom√≠nio"</a> . <br><br><img src="https://habrastorage.org/webt/lq/e_/hq/lqe_hqerzlvb_vi4less4xr6lg4.jpeg"><br><br>  Mostrarei a serializa√ß√£o de Bogard com uma pequena altera√ß√£o, mas importante.  Em vez de lan√ßar eventos, podemos declarar alguma lista e, nos locais em que algum tipo de rea√ß√£o deve ocorrer, diretamente dentro da entidade para salvar esses eventos.  Nesse caso, esse getter de <code>email</code> tamb√©m √© uma classe User e essa classe, essa propriedade n√£o finge ser uma propriedade com getters e setters autom√°ticos, mas realmente adiciona algo a isso.  Ou seja, isso √© encapsulamento real, n√£o profana√ß√£o.  Ao alterar, verificamos que o email √© diferente e lan√ßamos um evento.  Este evento ainda n√£o chegou a lugar algum, apenas o temos na lista interna de entidades. <br><br><img src="https://habrastorage.org/webt/ge/4c/nd/ge4cndzro2vbjuhb4qeujuot1qq.jpeg"><br><br>  Al√©m disso, no momento em que chamaremos o m√©todo SaveChanges, pegamos o ChangeTracker, verificamos se existem entidades que implementam a interface, se elas t√™m eventos de dom√≠nio.  E, se houver, vamos pegar todos esses eventos de dom√≠nio e envi√°-los a algum despachante que sabe o que fazer com eles. <br><br>  A implementa√ß√£o desse expedidor √© um t√≥pico para outra discuss√£o, existem algumas dificuldades com o envio m√∫ltiplo em C #, mas isso tamb√©m √© feito.  Com essa abordagem, h√° outra vantagem n√£o √≥bvia.  Agora, se tivermos dois desenvolvedores, um pode escrever um c√≥digo que altera esse email e o outro pode criar um m√≥dulo de notifica√ß√£o.  Eles n√£o est√£o absolutamente conectados entre si, escrevem c√≥digos diferentes, est√£o conectados apenas no n√≠vel desse evento de dom√≠nio de uma classe Dto.  O primeiro desenvolvedor simplesmente joga fora essa classe em algum momento, o segundo responde e sabe que precisa ser enviado por email, SMS, notifica√ß√µes por push para o telefone e todos os outros milh√µes de notifica√ß√µes, levando em considera√ß√£o as prefer√™ncias do usu√°rio que geralmente acontecem. <br><br><img src="https://habrastorage.org/webt/pb/-r/op/pb-ropw5rupxtrrbdfes8_lvp6q.jpeg"><br><br>  Aqui est√° o ponto menor, mas importante.  O artigo de Jimmy usa uma sobrecarga do m√©todo SaveChanges, e √© melhor n√£o.  E √© melhor faz√™-lo no decorador, porque se sobrecarregarmos o m√©todo SaveChanges e precisarmos do dbContext no Handler, obteremos depend√™ncias circulares.  Voc√™ pode trabalhar com isso, mas as solu√ß√µes s√£o um pouco menos convenientes e um pouco menos bonitas.  Portanto, se o pipeline √© constru√≠do com decoradores, n√£o vejo raz√£o para faz√™-lo de maneira diferente. <br><br><h3>  Registro e cria√ß√£o de perfil </h3><br><img src="https://habrastorage.org/webt/bg/nq/m_/bgnqm_jchmmhwbbl7bsvb-binni.jpeg"><br><br>  O aninhamento do c√≥digo permaneceu, mas no exemplo inicial, primeiro t√≠nhamos usando o MiniProfiler, depois tentamos pegar e depois se.  No total, havia tr√™s n√≠veis de aninhamento, agora cada um desse n√≠vel de aninhamento est√° em seu pr√≥prio decorador.  E dentro do decorador, que √© respons√°vel pela cria√ß√£o de perfil, temos apenas um n√≠vel de aninhamento, o c√≥digo √© lido perfeitamente.  Al√©m disso, √© claro que nesses decoradores h√° apenas uma responsabilidade.  Se o decorador for respons√°vel pelo registro, ele registrar√° apenas, se a cria√ß√£o de perfis, respectivamente, apenas o perfil, todo o resto estiver em outros lugares. <br><br><h3>  Resposta </h3><br>  Depois que todo o pipeline tiver funcionado, s√≥ podemos pegar o Dto e envi√°-lo ao navegador, serializando JSON. <br><br><img src="https://habrastorage.org/webt/wc/tt/0h/wctt0hneqcetsw0pjtya_s5p5eg.jpeg"><br><br>  Mas mais uma coisa pequena, algo que √†s vezes √© esquecido: a cada est√°gio, uma Exce√ß√£o pode acontecer aqui e, na verdade, voc√™ precisa lidar com eles de alguma forma. <br><br><img src="https://habrastorage.org/webt/rh/ns/lh/rhnslhowdccmndavybt1a9pyfmy.jpeg"><br><br>  N√£o posso deixar de mencionar Scott Vlashin e seu relat√≥rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Programa√ß√£o Orientada a Ferrovias"</a> aqui novamente.  Porque  O relat√≥rio original √© inteiramente dedicado ao trabalho com erros na linguagem F #, como organizar o fluxo de maneira um pouco diferente e por que essa abordagem pode ser prefer√≠vel ao uso de Exception'ov.  No F #, isso realmente funciona muito bem, porque o F # √© uma linguagem funcional e Scott usa a funcionalidade de uma linguagem funcional. <br><br><img src="https://habrastorage.org/webt/wd/-7/gg/wd-7ggf6-mg0y1orcgz-2si45ci.jpeg"><br><br>  Uma vez que, provavelmente, a maioria de voc√™s ainda escreve em C #, se voc√™ escreve <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um anal√≥gico em C #</a> , essa abordagem ser√° mais ou menos assim.  Em vez de lan√ßar exce√ß√µes, declaramos uma classe Result que possui uma ramifica√ß√£o bem-sucedida e uma ramifica√ß√£o sem √™xito.  Assim, dois designers.  Uma classe pode estar em apenas um estado.  Essa classe √© um caso especial de tipo de uni√£o, uni√£o discriminada de F #, mas reescrita em C #, porque n√£o h√° suporte interno em C #. <br><br><img src="https://habrastorage.org/webt/jo/xu/p2/joxup2i8w_uziwqyawnwp6cty8e.jpeg"><br><br>  Em vez de declarar public getters que algu√©m pode n√£o procurar nulo no c√≥digo, a Correspond√™ncia de Padr√µes √© usada.  Novamente, em F #, seria uma linguagem interna de correspond√™ncia de padr√µes; em C #, precisamos escrever um m√©todo separado no qual passaremos uma fun√ß√£o que sabe o que fazer com o resultado bem-sucedido da opera√ß√£o, como convert√™-la ainda mais na cadeia e com erro.  Ou seja, n√£o importa qual ramo funcionou para n√≥s, devemos converter isso em um √∫nico resultado retornado.  No F #, tudo isso funciona muito bem, porque existe uma composi√ß√£o funcional e tudo o que eu j√° listei.  No .NET, isso funciona um pouco pior, porque assim que voc√™ tem mais de um resultado, mas muito - e quase todo m√©todo pode falhar por um motivo ou outro - quase todos os tipos de fun√ß√£o resultantes se tornam tipos de resultado, e voc√™ precisa deles como para combinar alguma coisa. <br><br><img src="https://habrastorage.org/webt/vb/s8/wd/vbs8wdzd81uocge3l2louammnwa.jpeg"><br><br>  A maneira mais f√°cil de combin√°-los √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usar o LINQ</a> , porque, de fato, o LINQ funciona n√£o apenas com o IEnumerable, se voc√™ redefinir os m√©todos SelectMany e Select da maneira correta, o compilador C # ver√° que voc√™ pode usar a sintaxe do LINQ para esses tipos.  Em geral, o papel √© tra√ßado com doa√ß√£o de Haskell ou com as mesmas express√µes de computa√ß√£o em F #.  Como isso deve ser lido?  Aqui temos tr√™s resultados da opera√ß√£o e, se tudo estiver bem nos tr√™s casos, pegue esses resultados r1 + r2 + r3 e adicione-os.  O tipo do valor resultante tamb√©m ser√° Resultado, mas o novo Resultado, que declaramos em Selecionar.  Em geral, essa √© mesmo uma abordagem de trabalho, se n√£o uma, mas. <br><br><img src="https://habrastorage.org/webt/ez/8d/lw/ez8dlwqtpilfzqbpsp_8zg1udvw.jpeg"><br><br>  Para todos os outros desenvolvedores, assim que voc√™ come√ßa a escrever esse c√≥digo em C #, voc√™ come√ßa a se parecer com isso.  ‚ÄúEssas s√£o exce√ß√µes assustadoras, n√£o as escreva!  Eles s√£o maus!  Melhor escrever c√≥digo que ningu√©m entende e n√£o pode depurar! ‚Äù <br><br><img src="https://habrastorage.org/webt/v4/v4/vd/v4v4vdhq2reierp3a0diyhtm-ws.jpeg"><br><br>  C # n√£o √© F #, √© um pouco diferente, n√£o h√° conceitos diferentes com base nos quais isso √© feito, e quando tentamos puxar uma coruja no globo, verifica-se, para dizer o m√≠nimo, incomum. <br><br><img src="https://habrastorage.org/webt/ns/w3/q7/nsw3q7lbpx2xqiewao1619j-t1s.jpeg"><br><br>  Em vez disso, voc√™ pode usar as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramentas normais integradas</a> documentadas, que todos sabem e que n√£o causar√£o disson√¢ncia cognitiva entre os desenvolvedores.  O ASP.NET possui uma exce√ß√£o de manipulador global. <br><br><img src="https://habrastorage.org/webt/i8/9i/vk/i89ivkfdyr5w8xmemg2by9qz0zs.jpeg"><br><br>  Sabemos que, se houver algum problema com a valida√ß√£o, voc√™ precisar√° retornar o c√≥digo 400 ou 422 (entidade n√£o process√°vel).  Se houver um problema com autentica√ß√£o e autoriza√ß√£o, existem 401 e 403. Se algo deu errado, algo deu errado.  E se algo der errado e voc√™ desejar informar exatamente ao usu√°rio, defina seu tipo de exce√ß√£o, diga que √© IHasUserMessage, declare um getter de mensagens nessa interface e verifique: se essa interface estiver implementada, voc√™ poder√° receber uma mensagem de Exception e passe-o em JSON para o usu√°rio.  Se essa interface n√£o for implementada, h√° algum tipo de erro no sistema e simplesmente dizemos aos usu√°rios que algo deu errado, j√° estamos fazendo isso, todos sabemos - como sempre. <br><br><h3>  Pipeline de consulta </h3><br>  Conclu√≠mos isso com as equipes e analisamos o que temos na pilha de leitura.  Quanto ao pedido, valida√ß√£o, resposta diretamente - √© a mesma coisa, n√£o vamos parar separadamente.  Ainda pode haver um cache adicional, mas em geral tamb√©m n√£o h√° grandes problemas com o cache. <br><br><h3>  Seguran√ßa </h3><br>  Vamos dar uma olhada melhor em uma verifica√ß√£o de seguran√ßa.  Tamb√©m pode haver o mesmo decorador de seguran√ßa, que verifica se esta solicita√ß√£o pode ser feita ou n√£o: <br><br><img src="https://habrastorage.org/webt/9k/y7/dr/9ky7drwhf3o5tk_r6wcapy4nqaw.jpeg"><br><br>  Mas h√° outro caso em que exibimos mais de um registro e exibimos listas. Para alguns usu√°rios, precisamos exibir uma lista completa (por exemplo, para alguns superadministradores), e para outros usu√°rios, temos que listar listas limitadas, terceirizadas. para outro, bem, e como costuma ser o caso em aplicativos corporativos, os direitos de acesso podem ser extremamente sofisticados; portanto, voc√™ precisa garantir que os dados que n√£o visam esses usu√°rios n√£o entrem nessas listas. <br><br>  O problema √© resolvido de maneira <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bastante simples</a> .  Podemos redefinir a interface (IPermissionFilter) na qual o question√°vel original chega e retorna question√°vel.  A diferen√ßa √© que, para o question√°vel que retorna, j√° impusemos condi√ß√µes adicionais onde, verificamos o usu√°rio atual e dissemos: "Aqui, devolva apenas esses dados para esse usu√°rio ..." - e ent√£o toda a sua l√≥gica relacionada a permiss√µes .  Novamente, se voc√™ tem dois programadores, um programa usa permiss√µes de grava√ß√£o, ele sabe que precisa escrever apenas muitos filtros de permiss√£o e verificar se eles funcionam corretamente para todas as entidades.  E outros programadores n√£o sabem nada sobre permiss√£o, em sua lista os dados corretos simplesmente sempre passam, s√≥ isso.  Porque eles recebem na entrada n√£o mais o original consult√°vel do dbContext, mas limitado a filtros.  Esse permissionFilter tamb√©m possui uma propriedade de layout, podemos adicionar e aplicar todos os permissionFilters.  Como resultado, obtemos o permissionFilter resultante, que restringir√° a sele√ß√£o de dados ao m√°ximo, levando em considera√ß√£o todas as condi√ß√µes adequadas para essa entidade. <br><br><img src="https://habrastorage.org/webt/25/2o/xj/252oxjpxf1p7zd_aq3nt55cenyi.jpeg"><br><br>  Por que n√£o fazer isso com ferramentas internas do ORM, por exemplo, Filtros Globais em uma estrutura de entidade?  Novamente, para n√£o fazer depend√™ncias c√≠clicas e n√£o arrastar nenhuma hist√≥ria adicional sobre sua camada de neg√≥cios para o contexto. <br><br><h3>  Pipeline de consulta.  Ler modelo </h3><br>  Resta olhar para o modelo de leitura.  O paradigma CQRS n√£o usa o modelo de dom√≠nio na pilha de leitura; em vez disso, criamos imediatamente o Dto de que o navegador precisa no momento. <br><br><img src="https://habrastorage.org/webt/2s/kc/0y/2skc0ygq4rmh9rs6cyg5czxa5rm.jpeg"><br><br>  Se escrevermos em C #, provavelmente usaremos o LINQ, se n√£o houver requisitos de desempenho monstruosos e, se houver, talvez voc√™ n√£o tenha um aplicativo corporativo.  Em geral, esse problema pode ser resolvido de uma vez por todas com um LinqQueryHandler.  Aqui est√° uma restri√ß√£o bastante assustadora sobre o gen√©rico: esta √© a Consulta, que retorna uma lista de proje√ß√µes e ainda pode filtrar essas proje√ß√µes e classific√°-las.  Ela tamb√©m trabalha apenas com alguns tipos de entidades e sabe como converter essas entidades em proje√ß√µes e retornar a lista dessas proje√ß√µes na forma de Dto para o navegador. <br><br><img src="https://habrastorage.org/webt/8e/vz/ax/8evzaxkzbhqx0mgxfadxacpek24.jpeg"><br><br>  A implementa√ß√£o do m√©todo Handle pode ser bastante simples.  Por precau√ß√£o, verifique se esse filtro TQuery √© implementado para a entidade original.  Al√©m disso, fazemos uma proje√ß√£o, √© a extens√£o consult√°vel AutoMapper.  Se algu√©m ainda n√£o souber, o AutoMapper pode criar proje√ß√µes no LINQ, ou seja, aquelas que criar√£o o m√©todo Select e n√£o mape√°-lo na mem√≥ria. <br><br>  Em seguida, aplicamos a filtragem, a classifica√ß√£o e exibimos tudo no navegador.     ,      DotNext,     ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> ,  , , ,     expression' ,            . <br><br><h3>     <s></s>   SQL </h3><br>  .  ,       DotNext', ‚Äî      SQL.    Select , ,      ,  queryable-   . <br><br><img src="https://habrastorage.org/webt/3j/ns/3b/3jns3bzz_ebriubturd0ewzzwqg.jpeg"><br><br>      ,    .     ,    Title,  Title      ,     .      ,  .        SubTitle,      ,   ,     -      ,    queryable-   .    ,        . <br><br>      ,    .  ,    ,     .    ,   , .     ¬´JsonIgnore¬ª,     .    ,   ,  Dto.    ,     ,      .       JSON,  ,  Created  LastUpdated   ,  SubTitle ‚Äî   ,   .    ,   ,        ,   , ,       .          ,  -     . <br><br><img src="https://habrastorage.org/webt/uy/el/go/uyelgoxsnf7dzhsv6arfq0q16ly.jpeg"><br><br>      . ,  -,      ,    .    ,  pipeline,     .      ‚Äî      , ,  . ,      SaveChanges,   Query    SaveChanges.      ,    ,          ,   NuGet,         . <br><br>         .     ,    -  ,     ,     .   , ,   , , ,       ‚Äî   . ,  ,      : ¬´    ¬ª, ‚Äî   .  . <br><br><h2>   </h2><br>    ,    ? <br><br><img src="https://habrastorage.org/webt/rj/px/0i/rjpx0ig2zyqa7d9g47vibhbeccy.jpeg"><br><br>    -  .   . <br><br><img src="https://habrastorage.org/webt/d6/ag/p7/d6agp7a_t3m2ppxscq9vb7piagq.jpeg"><br><br>  , ,    ,     .   MediatR  ,         . ,    ,    ‚Äî ,    MediatR   pipeline behaviour.    ,      Request/Response, RequestHandler'      .    Simple Injector,    ‚Äî    . <br><br><img src="https://habrastorage.org/webt/qd/et/4g/qdet4g_b9ezljfr1mx9moe_m18y.jpeg"><br><br>       , ,  ,       ,  TIn: ICommand. <br><br><img src="https://habrastorage.org/webt/su/nb/vn/sunbvndlkmxley6clq7hs4hj70s.jpeg"><br><br>   Simple Injector'      constraint' .     ,    , ,     constraint',        Handler',     constraint. ,     constraint ICommand,      SaveChanges   constraint'  ICommand,  Simple Injector  ,    constraint' ,         Handler'. ,      ,          ,     . <br><br>  ? Simple Injector  MeriatR ‚Äî  ,       ,    Autofac', -,          ,    ,  .  , . <br><br><h2>   ,    </h2><br>          ,   ¬´¬ª. <br><br><img src="https://habrastorage.org/webt/8m/1l/lj/8m1lljzfrx2amaidftyjnthd3yc.jpeg"><br><br>   ,   ¬´Clean architecture¬ª.             . <br><br><img src="https://habrastorage.org/webt/ch/gm/jq/chgmjq7gihsvthnvinnydngrtcw.jpeg"><br><br>  - -     ,   MVC,   ,    . <br><br><img src="https://habrastorage.org/webt/g8/70/wz/g870wzkcrbvqeplit3m_i69uru4.jpeg"><br><br>  ,   ,   ,     Angular, ,       ,      ,    .  ,  : ¬´ ‚Äî MVC-¬ª,  : ¬´    Features,    :     ,    Blog     - Import,    -  ¬ª. <br><br>  , , ,  ,   MVC-,  ,   -  , .    MVC  .    ,   ,      ‚Äî     .       . <br><br><img src="https://habrastorage.org/webt/ix/8v/qo/ix8vqotanjad8uljd2rfz17xygg.jpeg"><br><br><img src="https://habrastorage.org/webt/xq/lj/bv/xqljbvd8zk59n6pdn1-q-x4czhc.jpeg"><br><br>    -     ,  -   -,        . <br><br> -,     ,   .            ,   .   ,          -   ,         User Service,   pull request',     ,       User Service    ,   .    ,      - ,     -  , . -       ,             . <br><br>  .         ,          .  ,    ,             ,   . , ,  ,  ,   ,     ,    ,     -   .    ,      (    ,    ),     ,    ¬´Delete¬ª:   ,      ,  .  . <br><br>          ‚Äî  ¬´¬ª, ,   ,       ,   .          ,    :   ,    ,     ,      .           ,   .      ,    ,   .      ,      ,      . <br><br>   :        .    ¬´ ¬ª,        :     ,     ,         . ,    ,    ,       , ,    ,  ,   .        ,   .  ,   - pull request    ,    ‚Äî  ,    ‚Äî -   ,    .          VCS    :     -  ,    ?       ,    -  ,         ,    . <br><br><img src="https://habrastorage.org/webt/ie/g2/i6/ieg2i6gpy-mp6nsmrvdvxot3x6o.jpeg"><br><br>   , ,    ,   .  :     .        ,     .  ,    ,      ,  ,   .    , ,    ,      . ,  , .    ¬´ ¬ª,        ,     .  ,   ,      ‚Äî  ,      ,   . <br><br>      :    , - , .           .  -      ,    ,  ,   ,  .       -        ,  -        ,      , ,      ,    .    . <br><br><img src="https://habrastorage.org/webt/8g/7g/3h/8g7g3htn43hhoprdfj2thj86wre.jpeg"><br><br> .         ,       IHandler     .    . <br><br>   IHandler    ICommandHandler  IQueryHandler  ,    .    ,     ,       .  ,   CommandHandler,      CommandHandler',       . <br><br>  Porque      ,    Query   ,   Query ‚Äî   .      ,     ,  ,    Hander,    CommandHandler  QueryHandler,   -  use case,     . <br><br>  ‚Äî     ,      ,  ,    ,     :  ,  . <br><br>      ,  .         ,    .    ,       -. <br><br>      C# 8,   nullable reference type      .  , , ,     ,  . <br><br>         ChangeTracker' ORM. <br><br>  Exception' ‚Äî     ,     F#,     C#.  ,   -     ,    -   , .        ,   ,      Exception', ,      LINQ,   ,  ,    ,     ,    , Dapper  - , ,  ,   .NET. <br><br>          ,  LINQ,  , permission' ‚Äî   . ,    ,   - ,    ,       .      ,     ‚Äî   . <br><br>        .  : <br><br><hr><br><ul><li> Vertical Slices <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.youtube.com/watch?v=SUiWfhAhgQw</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.cuttingedge.it/blogs/steven/pivot/entry.php?id=91</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cuttingedge.it/blogs/steven/pivot/entry.php?id=92</a> </li></ul></li><li>   <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">habr.com/post/266937</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">habr.com/post/205088</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">habr.com/post/205108</a> </li></ul></li><li> Domain Events <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">udidahan.com/2009/06/14/domain-events-salvation</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lostechies.com/jimmybogard/2014/05/13/a-better-domain-events-pattern</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">enterprisecraftsmanship.com/2017/10/03/domain-events-simple-and-reliable-solution</a> </li></ul></li><li> DDD <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">habr.com/post/334126</a> </li></ul></li><li> ROP <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fsharpforfunandprofit.com/rop</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">habr.com/post/339606</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">habr.com/post/347284</a> </li></ul></li><li> LINQ  Expressions: <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">habr.com/company/jugru/blog/423891</a> </li></ul></li><li> Clean Architecture <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.youtube.com/watch?v=JEeEic-c0D4</a> </li></ul></li></ul><br><img src="https://habrastorage.org/webt/fm/ik/wu/fmikwu49krcbqw7xbefe1vm6tsq.jpeg"><br><br>   ‚Äî   .      .   ‚Äî     ¬´Domain Modeling Made Functional¬ª,   F#,          F#,      ,     ,     ,        ,      .       C# ,    ,         Exception'. <br><br>  ,  ,   ‚Äî  ¬´Entity Framework Core In Action¬ª.      ,    Entity Framework,         ,     DDD  ORM,   ,   ORM      DDD    . <br><br><blockquote>  Minuto de publicidade. 15-16  2019  .NET- DotNext Piter,      .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt447308/">https://habr.com/ru/post/pt447308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt447298/index.html">Gest√£o do conhecimento atrav√©s de modelos de compet√™ncia</a></li>
<li><a href="../pt447300/index.html">Criando o VirtualBox para Windows</a></li>
<li><a href="../pt447302/index.html">Sistema operacional de fim de semana</a></li>
<li><a href="../pt447304/index.html">Avaricious n√£o paga duas vezes - configuramos mem√≥ria na plataforma AMD B450 e obtemos desempenho gratuito</a></li>
<li><a href="../pt447306/index.html">Transformador de Tesla em uma placa de uma polegada quadrada</a></li>
<li><a href="../pt447310/index.html">Como passamos do desenvolvimento web para o desenvolvimento de jogos</a></li>
<li><a href="../pt447314/index.html">O que eu entendi sobre a constru√ß√£o de um neg√≥cio depois de trabalhar por sete anos no Airbnb</a></li>
<li><a href="../pt447318/index.html">Gadgets de um mercado de pulgas: por que comprar um laptop Packard Bell de 20 anos por 10 euros</a></li>
<li><a href="../pt447322/index.html">Princ√≠pios de constru√ß√£o de uma API REST JSON</a></li>
<li><a href="../pt447324/index.html">Como o computador funciona dentro do Hayabusa-2, que lan√ßou uma bomba em Ryuga. E fotos de seus desenvolvedores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>