<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüè≠ ü§±üèø üëä Primeira introdu√ß√£o ao AssemblyScript üë®üèΩ‚Äçüîß üë©üèæ‚Äçüéì üçû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O suporte √† tecnologia WebAssembly (Wasm) apareceu nos navegadores h√° relativamente pouco tempo. Mas essa tecnologia pode expandir os recursos da Web,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Primeira introdu√ß√£o ao AssemblyScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/477272/">  O suporte √† <a href="https://webassembly.org/">tecnologia WebAssembly</a> (Wasm) apareceu nos navegadores h√° relativamente pouco tempo.  Mas essa tecnologia pode expandir os recursos da Web, tornando-a uma plataforma capaz de suportar aplicativos que geralmente s√£o vistos como desktop. <br><br>  Dominar o WebAssembly pode ser uma tarefa assustadora para desenvolvedores da web.  No entanto, o compilador <a href="https://assemblyscript.org/">AssemblyScript</a> pode melhorar a situa√ß√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/p4/91/pwp491ryabgnwblabon5slwooey.jpeg"></div><br>  O autor do artigo, que estamos publicando a tradu√ß√£o de hoje, oferece primeiro para falar sobre por que o WebAssembly √© uma tecnologia muito promissora e, em seguida, ver como o AssemblyScript pode ajudar a desbloquear o potencial de Wasm. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Webassembly</font> </h2><br>  O WebAssembly pode ser chamado de idioma de baixo n√≠vel para navegadores.  Ele oferece aos desenvolvedores a capacidade de criar c√≥digo compilado em algo que n√£o seja JavaScript.  Isso permite que os programas inclu√≠dos nas p√°ginas da Web funcionem quase t√£o r√°pido quanto os aplicativos nativos para v√°rias plataformas.  Esses programas s√£o executados em um ambiente limitado e seguro. <br><br>  Representantes das equipes respons√°veis ‚Äã‚Äãpelo desenvolvimento de todos os principais navegadores (Chrome, Firefox, Safari e Edge) participaram da cria√ß√£o do padr√£o WebAssembly.  Eles concordaram em uma <a href="https://lists.w3.org/Archives/Public/public-webassembly/2017Feb/0002.html">arquitetura de</a> sistema no in√≠cio de 2017.  Agora, todos os navegadores acima oferecem suporte ao WebAssembly.  De fato, essa tecnologia pode ser usada em <a href="https://caniuse.com/">aproximadamente 87% dos</a> navegadores. <br><br>  O c√≥digo do WebAssembly existe em formato bin√°rio.  Isso significa que esse c√≥digo √© menor que o c√≥digo JavaScript semelhante e √© carregado mais rapidamente.  Al√©m disso, o c√≥digo Wasm pode ser apresentado em <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format">formato de texto</a> , para que as pessoas possam ler e editar. <br><br>  Quando o padr√£o WebAssembly apareceu pela primeira vez, alguns desenvolvedores pensaram que ele poderia substituir o JavaScript e se tornar o idioma principal da web.  Mas o WebAssembly √© melhor visto como uma nova ferramenta que se integra bem √† plataforma da web existente.  Este √© um dos seus <a href="https://webassembly.org/docs/high-level-goals/">objetivos priorit√°rios</a> . <br><br>  Em vez de substituir o JavaScript, onde esse idioma √© usado h√° muito tempo e com sucesso, o WebAssembly oferece novas oportunidades interessantes para desenvolvedores da web.  √â verdade que o c√≥digo Wasm n√£o tem acesso direto ao DOM, portanto, a maioria dos projetos da Web existentes continuar√° usando JavaScript.  Essa linguagem, ao longo dos anos de desenvolvimento e otimiza√ß√£o, j√° √© bastante r√°pida.  E o WebAssembly tem seus pr√≥prios <a href="https://webassembly.org/docs/use-cases/">aplicativos</a> : <br><br><ul><li>  Jogos </li><li>  C√°lculos cient√≠ficos, visualiza√ß√µes, simula√ß√µes. </li><li>  Aplica√ß√µes CAD. </li><li>  Editando imagens e v√≠deos. </li></ul><br>  Todos esses usos para Wasm s√£o unidos pelo que seus respectivos aplicativos geralmente s√£o considerados desktop.  Por√©m, devido ao fato do WebAssembly permitir que voc√™ atinja um n√≠vel de desempenho pr√≥ximo ao nativo, muitos aplicativos semelhantes agora podem ser implementados usando a plataforma da web. <br><br>  O WebAssembly pode tirar proveito dos projetos da web existentes.  Um exemplo √© o projeto <a href="https://www.figma.com/">Figma</a> .  Gra√ßas ao uso do Wasm, o tempo de carregamento deste projeto foi significativamente aprimorado.  Se um site usa c√≥digo que executa c√°lculos pesados, ent√£o, para melhorar o desempenho deste site, faz sentido substituir apenas esse c√≥digo por um an√°logo do WebAssembly. <br><br>  Voc√™ pode tentar usar o WebAssembly em seus pr√≥prios projetos.  Este idioma pode ser aprendido e escrito <a href="https://blog.scottlogic.com/2018/04/26/webassembly-by-hand.html">imediatamente nele</a> .  Por√©m, o WebAssembly foi desenvolvido originalmente como um <a href="https://github.com/appcypher/awesome-wasm-langs">destino de compila√ß√£o</a> para outros idiomas.  Foi <a href="https://webassembly.org/docs/c-and-c%2B%2B/">projetado</a> com bom suporte para C e C ++.  O <a href="">suporte experimental</a> Wasm apareceu no Go 1.11.  Est√° sendo feito muito esfor√ßo para escrever aplicativos Wasm no <a href="https://www.rust-lang.org/what/wasm">Rust</a> . <br><br>  Mas √© perfeitamente poss√≠vel que os desenvolvedores da Web n√£o desejem aprender C, C ++, Go ou Rust apenas para usar o WebAssembly.  O que eles fazem?  A resposta a esta pergunta pode dar ao AssemblyScript. <br><br><h2>  <font color="#3AC1EF">AssemblyScript</font> </h2><br>  O AssemblyScript √© um compilador que converte o c√≥digo TypeScript em c√≥digo do WebAssembly.  TypeScript √© uma linguagem desenvolvida pela Microsoft.  Este √© um superconjunto de JavaScript, com suporte aprimorado a tipos e alguns outros recursos.  O TypeScript se tornou uma linguagem bastante <a href="https://insights.stackoverflow.com/survey/2019">popular</a> .  Note-se que o AssemblyScript pode converter em Wasm apenas um conjunto limitado de constru√ß√µes TypeScript.  Isso significa que mesmo algu√©m que n√£o conhece o TypeScript pode aprender rapidamente essa linguagem em um n√≠vel suficiente para escrever o c√≥digo que o AssemblyScript entende. <br><br>  Al√©m disso, como o TypeScript √© muito semelhante ao JavaScript, podemos dizer que a tecnologia AssemblyScript permite que os desenvolvedores da Web integrem facilmente m√≥dulos Wasm em seus projetos sem a necessidade de aprender uma linguagem completamente nova. <br><br><h2>  <font color="#3AC1EF">Exemplo</font> </h2><br>  Vamos escrever nosso primeiro m√≥dulo AssemblyScript.  Todo o c√≥digo que discutiremos agora pode ser encontrado no <a href="https://github.com/dguo/assemblyscript-demo">GitHub</a> .  Para dar <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly">suporte ao</a> WebAssembly, precisamos pelo menos do <a href="https://nodejs.org/">Node.js</a> 8. <br><br>  Crie um novo diret√≥rio, inicialize o projeto npm e instale o AssemblyScript: <br><br><pre><code class="javascript hljs">mkdir assemblyscript-demo cd assemblyscript-demo npm init npm install --save-dev github:AssemblyScript/assemblyscript</code> </pre> <br>  Observe que o AssemblyScript deve ser instalado diretamente <a href="https://github.com/AssemblyScript/assemblyscript">no reposit√≥rio GitHub</a> do projeto.  O AssemblyScript ainda n√£o foi publicado no npm, pois os desenvolvedores <a href="https://github.com/AssemblyScript/assemblyscript/issues/442">ainda n√£o o consideram</a> pronto para uso generalizado. <br><br>  <code>asinit</code> arquivos auxiliares usando o comando <code>asinit</code> inclu√≠do no AssemblyScript: <br><br><pre> <code class="javascript hljs">npx asinit .</code> </pre> <br>  Agora a se√ß√£o de <code>scripts</code> do nosso <code>package.json</code> deve assumir o seguinte formato: <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>  } }</code> </pre> <br>  O arquivo <code>index.js</code> localizado na pasta raiz do projeto ter√° a seguinte apar√™ncia: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> compiled = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Module(fs.readFileSync(__dirname + <span class="hljs-string"><span class="hljs-string">"/build/optimized.wasm"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imports = {  <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {    abort(_msg, _file, line, column) {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);    }  } }; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>, <span class="hljs-string"><span class="hljs-string">"exports"</span></span>, {  <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Instance(compiled, imports).exports });</code> </pre> <br>  Isso permite incluir m√≥dulos WebAssembly no seu c√≥digo usando o comando <a href="https://nodejs.org/api/modules.html">require</a> .  Ou seja - da mesma maneira que os m√≥dulos JavaScript regulares est√£o conectados. <br><br>  A pasta de <code>assembly</code> cont√©m o arquivo <code>index.ts</code> .  Possui c√≥digo-fonte escrito de acordo com as regras do AssemblyScript.  O c√≥digo clich√™ gerado automaticamente √© uma fun√ß√£o simples para adicionar dois n√∫meros: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a: i32, b: i32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i32</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }</code> </pre> <br>  Talvez voc√™ esperasse que a assinatura de uma fun√ß√£o semelhante se parecesse com <code>add(a: number, b: number): number</code> .  Portanto, parece que ele foi escrito em TypeScript comum.  Mas aqui, em vez do <code>number</code> do tipo, o tipo <code>i32</code> .  Isso acontece porque o c√≥digo AssemblyScript usa <a href="https://docs.assemblyscript.org/basics/types">tipos WebAssembly</a> espec√≠ficos para n√∫meros inteiros e de ponto flutuante, em vez do tipo de <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">n√∫mero</a> gen√©rico do TypeScript. <br><br>  Vamos montar o projeto: <br><br><pre> <code class="javascript hljs">npm run asbuild</code> </pre> <br>  Os seguintes arquivos devem aparecer na pasta de <code>build</code> : <br><br><pre> <code class="javascript hljs">optimized.wasm optimized.wasm.map optimized.wat untouched.wasm untouched.wasm.map untouched.wat</code> </pre> <br>  Existem vers√µes otimizadas e regulares da montagem.  Cada vers√£o do assembly nos fornece um arquivo .wasm bin√°rio, um <a href="https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map">mapa</a> .wasm.map do <a href="https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map">mapa</a> e uma representa√ß√£o textual do c√≥digo bin√°rio em um arquivo .wat.  A apresenta√ß√£o de teste do c√≥digo Wasm √© destinada ao programador, mas nem olharemos para este arquivo.  Na verdade, uma das raz√µes para usar o AssemblyScript √© que elimina a necessidade de trabalhar com o c√≥digo Wasm. <br><br>  Agora, vamos executar o Node.js no modo REPL e garantir que o m√≥dulo Wasm compilado possa ser usado da mesma maneira que qualquer m√≥dulo JS comum: <br><br><pre> <code class="javascript hljs">$ node Welcome to Node.js v12<span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>. Type <span class="hljs-string"><span class="hljs-string">".help"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. &gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).add; <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt; add(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre> <br>  Em geral, isso √© tudo o que √© necess√°rio para usar a tecnologia WebAssembly no Node.js. <br><br><h2>  <font color="#3AC1EF">Equipando um projeto com um script observador</font> </h2><br>  Para reconstruir automaticamente o m√≥dulo durante o desenvolvimento ao fazer altera√ß√µes, recomendo usar o pacote <a href="https://github.com/Qard/onchange">onchange</a> .  O fato √© que o AssemblyScript <a href="https://github.com/AssemblyScript/assemblyscript/issues/624">ainda n√£o possui</a> seu pr√≥prio sistema para monitorar altera√ß√µes no arquivo.  Instale o pacote onchange: <br><br><pre> <code class="javascript hljs">npm install --save-dev onchange</code> </pre> <br>  Adicione o script <code>asbuild:watch</code> ao <code>package.json</code> .  <a href="https://github.com/Qard/onchange">O sinalizador</a> <code>-i</code> <a href="https://github.com/Qard/onchange">√©</a> inclu√≠do no comando para que o processo de constru√ß√£o inicie uma vez quando o script for chamado, antes que ocorram eventos. <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange -i 'assembly/**/*' -- npm run asbuild"</span></span>  } }</code> </pre> <br>  Agora, em vez de executar constantemente o comando <code>asbuild</code> , basta executar o <code>asbuild:watch</code> uma vez. <br><br><h2>  <font color="#3AC1EF">Desempenho</font> </h2><br>  Escreveremos um teste simples que avaliar√° o n√≠vel de desempenho do c√≥digo Wasm.  O principal escopo do WebAssembly √© resolver tarefas que usam o processador intensivamente.  Por exemplo, esses s√£o alguns tipos de c√°lculos "pesados".  Vamos criar uma fun√ß√£o que descubra se um determinado n√∫mero √© primo. <br><br>  A implementa√ß√£o b√°sica de JS de uma fun√ß√£o semelhante √© mostrada abaixo.  √â organizado de maneira muito simples, verifica o n√∫mero por for√ßa bruta, mas, para nossos prop√≥sitos, √© adequado, pois realiza grandes quantidades de c√°lculos. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Uma fun√ß√£o semelhante, escrita para o compilador AssemblyScript, parece quase a mesma.  A principal diferen√ßa √© a presen√ßa de anota√ß√µes de tipo no c√≥digo: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x: u32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i: u32 = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Para analisar o desempenho do c√≥digo, usaremos o pacote <a href="https://benchmarkjs.com/">Benchmark.js</a> .  Instale-o: <br><br><pre> <code class="javascript hljs">npm install --save-dev benchmark</code> </pre> <br>  Crie o arquivo <code>benchmark.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Benchmark = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'benchmark'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assemblyScriptIsPrime = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).isPrime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> suite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Benchmark.Suite; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startNumber = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stopNumber = <span class="hljs-number"><span class="hljs-number">10000</span></span>; suite.add(<span class="hljs-string"><span class="hljs-string">'AssemblyScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        assemblyScriptIsPrime(i);    } }).add(<span class="hljs-string"><span class="hljs-string">'JavaScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        isPrime(i);    } }).on(<span class="hljs-string"><span class="hljs-string">'cycle'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(event.target)); }).on(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fastest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'fastest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> slowest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'slowest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> difference = (fastest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) - slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>)) / slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) * <span class="hljs-number"><span class="hljs-number">100</span></span>;    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fastest.map(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'name'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> is ~</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${difference.toFixed(</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">% faster.`</span></span>); }).run();</code> </pre> <br>  Aqui est√° o que eu consegui obter ap√≥s executar o comando <code>node benchmark</code> do <code>node benchmark</code> no meu computador: <br><br><pre> <code class="javascript hljs">AssemblyScript isPrime x <span class="hljs-number"><span class="hljs-number">74.00</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">0.43</span></span>% (<span class="hljs-number"><span class="hljs-number">76</span></span> runs sampled) JavaScript isPrime x <span class="hljs-number"><span class="hljs-number">61.56</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">0.30</span></span>% (<span class="hljs-number"><span class="hljs-number">64</span></span> runs sampled) AssemblyScript isPrime is ~<span class="hljs-number"><span class="hljs-number">20.2</span></span>% faster.</code> </pre> <br>  Como voc√™ pode ver, a implementa√ß√£o do algoritmo AssemblyScript foi 20% mais r√°pida que a implementa√ß√£o do JS.  No entanto, observe que este teste √© uma <a href="https://stackoverflow.com/a/2842707/1481479">marca de microbench</a> .  N√£o confie demais em seus resultados. <br><br>  Para encontrar resultados mais confi√°veis ‚Äã‚Äãda pesquisa de desempenho dos projetos AssemblyScript - eu recomendo dar uma olhada <a href="https://wasmboy.app/benchmark/">neste</a> e <a href="https://jtiscione.github.io/webassembly-wave/index.html">neste</a> benchmark. <br><br><h2>  <font color="#3AC1EF">Usando um m√≥dulo Wasm em uma p√°gina da Web</font> </h2><br>  Vamos usar o nosso m√≥dulo Wasm em uma p√°gina da web.  Come√ßamos criando um arquivo <code>index.html</code> com o seguinte conte√∫do: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt;    &lt;head&gt;        &lt;meta charset="utf-8" /&gt;        &lt;title&gt;AssemblyScript isPrime demo&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;form id="prime-checker"&gt;            &lt;label for="number"&gt;Enter a number to check if it is prime:&lt;/label&gt;            &lt;input name="number" type="number" /&gt;            &lt;button type="submit"&gt;Submit&lt;/button&gt;        &lt;/form&gt;        &lt;p id="result"&gt;&lt;/p&gt;        &lt;script src="demo.js"&gt;&lt;/script&gt;    &lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  Agora crie o arquivo <code>demo.js</code> cujo c√≥digo √© mostrado abaixo.  Existem <a href="https://developers.google.com/web/updates/2018/04/loading-wasm">v√°rias maneiras de</a> carregar os m√≥dulos WebAssembly.  O mais eficiente √© compilar e inicializar no modo de streaming usando a fun√ß√£o <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiateStreaming">WebAssembly.instantiateStreaming</a> .  Observe que precisaremos redefinir a fun√ß√£o <a href="https://docs.assemblyscript.org/details/debugging">abort</a> , que √© chamada se alguma <a href="https://docs.assemblyscript.org/basics/environment">instru√ß√£o</a> n√£o <a href="https://docs.assemblyscript.org/basics/environment">for</a> executada. <br><br><pre> <code class="javascript hljs">(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> importObject = {        <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {            abort(_msg, _file, line, column) {                <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);            }        }    };    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> WebAssembly.instantiateStreaming(        fetch(<span class="hljs-string"><span class="hljs-string">"build/optimized.wasm"</span></span>),        importObject    );    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isPrime = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.instance.exports.isPrime;    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#result"</span></span>);    <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#prime-checker"</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>, event =&gt; {        event.preventDefault();        result.innerText = <span class="hljs-string"><span class="hljs-string">""</span></span>;        <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> number = event.target.elements.number.value;        result.innerText = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${number}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${isPrime(number) ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'not '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">prime.`</span></span>;    }); })();</code> </pre> <br>  Em seguida, instale o pacote do <a href="https://github.com/nbluis/static-server">servidor est√°tico</a> .  Precisamos de um servidor devido ao fato de que, para usar a fun√ß√£o <code>WebAssembly.instantiateStreaming</code> , o m√≥dulo deve ser atendido usando o tipo MIME <code>application/wasm</code> . <br><br><pre> <code class="javascript hljs">npm install --save-dev <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>-server</code> </pre> <br>  Adicione o script apropriado ao <code>package.json</code> : <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"serve-demo"</span></span>: <span class="hljs-string"><span class="hljs-string">"static-server"</span></span>  } }</code> </pre> <br>  Agora <code>npm run serve-demo</code> e abra o URL do host local no navegador.  Se voc√™ digitar um determinado n√∫mero no formul√°rio, poder√° descobrir se √© simples ou n√£o.  Agora, ao desenvolver o AssemblyScript, percorremos um longo caminho desde a escrita do c√≥digo at√© seu uso no Node.js. e em uma p√°gina da web. <br><br><h2>  <font color="#3AC1EF">Sum√°rio</font> </h2><br>  O WebAssembly e, portanto, o AssemblyScript, n√£o conseguem, de alguma forma, acelerar qualquer site magicamente.  Mas Wasm nunca foi encarregado de acelerar absolutamente tudo.  Essa tecnologia √© not√°vel, pois abre caminho para a web para novos tipos de aplicativos. <br><br>  Algo semelhante pode ser dito sobre o AssemblyScript.  Essa tecnologia simplifica o acesso ao WebAssembly para um grande n√∫mero de desenvolvedores.  Ele permite, ao criar c√≥digo em uma linguagem pr√≥xima ao JavaScript, usar os recursos do WebAssembly para resolver problemas computacionais complexos. <br><br>  <b>Caros leitores!</b>  Como voc√™ avalia as perspectivas de uso do AssemblyScript em seus projetos? <br><br><div style="text-align:center;"> <a href="https://ruvds.com/vps_start/"><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt477272/">https://habr.com/ru/post/pt477272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt477256/index.html">O primeiro lan√ßamento completo do OneWeb no ve√≠culo de lan√ßamento da Soyuz √© adiado no pr√≥ximo ano, bem como o lan√ßamento do ve√≠culo de lan√ßamento de Angara</a></li>
<li><a href="../pt477262/index.html">Androids da empresa Promobot. Vista lateral</a></li>
<li><a href="../pt477264/index.html">A escavadeira se transformou em um rob√¥ aut√¥nomo capaz de cavar valas de forma independente</a></li>
<li><a href="../pt477266/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 390 (18 a 24 de novembro de 2019)</a></li>
<li><a href="../pt477268/index.html">Otimiza√ß√£o da solu√ß√£o de pesquisa no github</a></li>
<li><a href="../pt477274/index.html">Como voc√™ se livra do c√≥digo CSS n√£o utilizado? Parte 1</a></li>
<li><a href="../pt477276/index.html">Como voc√™ se livra do c√≥digo CSS n√£o utilizado? Parte 2</a></li>
<li><a href="../pt477278/index.html">Teste de front-end</a></li>
<li><a href="../pt477282/index.html">Cria√ß√£o de perfil do c√≥digo do projeto Go e resolu√ß√£o de problemas de aloca√ß√£o de mem√≥ria</a></li>
<li><a href="../pt477284/index.html">Por que o JavaScript √© necess√°rio no modo estrito?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>