<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🏫 🌨️ ☝🏿 Faites confiance à Codd ou à vos installations? 🏙️ 👣 👏🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Objets stockés sans maux de tête: un exemple simple de travail avec des objets Caché dans ObjectScript et Python 

 Château de Neuschwanstein 

 En ju...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Faites confiance à Codd ou à vos installations?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435612/"><h2>  Objets stockés sans maux de tête: un exemple simple de travail avec des objets Caché dans ObjectScript et Python </h2><br><img src="https://habrastorage.org/webt/jb/ba/sp/jbbaspnh-olgr2ot_f2peelsifc.jpeg"><br>  <i>Château de Neuschwanstein</i> <br><br>  En juin 2020, exactement 50 ans d'entrepôts de données tabulaires ou, officiellement, un modèle de données relationnel.  Voici un document officiel - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce même article célèbre</a> .  Nous remercions chaleureusement le Dr Edgar Frank Codd.  Et, soit dit en passant, le modèle de données relationnelles figure sur la liste Forbes des innovations mondiales les plus importantes des 100 dernières années. <br><br>  D'un autre côté, curieusement, Codd considérait les bases de données relationnelles et le langage SQL comme une implémentation déformée de sa théorie.  À titre indicatif, il a même développé 12 règles que chaque système de gestion de bases de données relationnelles doit satisfaire (en fait, ce sont 13 règles).  Et, en vérité, aujourd'hui, dans le monde, vous ne pouvez pas trouver de SGBD qui satisfont au moins à la «règle 0» de Codd et, par conséquent, personne ne peut appeler leur SGBD 100% relationnel :) Peut-être qu'il y a des exceptions, dites-moi? <br><a name="habracut"></a><br>  Le modèle relationnel n'est pas très complexe et est étudié en parallèle.  Elle peut même être trop étudiée.  Pendant ce temps, en cette année 2019, nous célébrerons également un autre anniversaire - il y a exactement 10 ans, le hashtag #NoSQL plus tard "non seulement SQL" est apparu sur Twitter et a commencé sa pénétration rapide dans la pratique du développement de modèles de base de données. <br><br>  Pourquoi une si longue introduction?  Au fait que l'univers de programmation est constitué de données (et d'algorithmes bien sûr), et la position de monopole du modèle relationnel conduit, comme il est plus poli à dire, à une conscience partagée du programmeur.  Parce que les objets de travail dans la tête du développeur (OOP est également total, non?), Toutes ces listes, files d'attente, arbres, tas, dictionnaires, threads, etc. à l'infini, sont loin des tables. <br><br>  Et si vous continuez et vous souvenez de l'architecture de stockage dans les SGBD modernes?  Disons directement que personne de bon sens ne stocke les données sous forme de tableaux.  Les développeurs de SGBD utilisent le plus souvent des variétés de l'arbre B (par exemple, dans PostrgeSQL) ou, beaucoup moins souvent, un stockage basé sur un dictionnaire.  D'autre part, les barricades, les développeurs qui utilisent des SGBD pour stocker, fonctionnent également sur des non-tables.  Et cela oblige les programmeurs à combler constamment l'écart sémantique avec une couche de données intermédiaire maladroite.  Et, par conséquent, provoquer une tension dichotomique interne, un inconfort systémique et une insomnie de débogage. <br><br>  En bref, il y a une contradiction - nous emballons les données dans des objets adaptés à la tâche, et lors de l'enregistrement, nous devons prendre soin de certaines tables. <br><br>  Le désespoir?  Non :) Mais qu'en est-il du mapping objet-relationnel, est-ce dans le folklore ORM?  Laissons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette guerre sainte à Yegor Bugaenko</a> avec des camarades.  Et toute cette histoire du siècle dernier, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">selon l'oncle Bob, ne devrait pas nous inquiéter</a> . <br><br>  Bien sûr, il convient de mentionner que le "sac avec octets" (Robert Martin "Pure Architecture") peut être sérialisé et déposé dans un fichier ou inséré dans un autre flux approprié.  Mais, d'une part, cela nous limitera immédiatement dans la langue, et d'autre part, maintenant nous ne nous soucierons que du stockage dans le SGBD. <br><br>  Il existe une exception agréable à ces hauts et ces bas avec les sacs d'octets - le SGBD Intersystems Caché (et maintenant la plate-forme de données InterSystems IRIS).  C'est probablement le seul SGBD au monde qui ne cache pas l'évidence au développeur et va même plus loin - cela libère quelqu'un de penser "comment tout stocker correctement".  Il suffit de dire que la classe continue le genre Persistant et que le point est dans le chapeau, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">c'est-à-dire en globaux</a> (à ne pas confondre avec les variables globales!). <br><br>  Tous les types de données peuvent être stockés, y compris les flux de caractères et binaires.  Voici un exemple simple: <br><br><pre><code class="plaintext hljs">//       - // :      ,     ,     , ,   Class FW.Events Extends %Persistent { Property "My name" As %String; } //      //   «»  set haJS = ##class(FW.Events).%New() //   write haJS.%Id()</code> </pre> <br>  De plus, et c'est formidable, vous pouvez communiquer avec des objets stockés non seulement en ObjectScript, natif de Caché, mais en les récupérant et en les enregistrant directement en Python, Java, JavaScript, C ++, C #, Perl.  Et même, oh horreur :).  Il est également possible d'obtenir des informations à partir des mêmes objets directement via des requêtes SQL, et il est également possible d'appeler vos propres méthodes sur des objets.  Plus précisément, les méthodes dans ce cas seules (et le mot magique SqlProc) se transforment en procédures stockées.  Toute la magie est déjà sous le capot du SGBD Caché. <br><blockquote>  Comment obtenir un accès de test gratuit au SGBD Intersystems Caché? <br>  C'est absolument réel, peu importe ce que disent les mauvaises langues!  :) Vous pouvez télécharger et installer la version complète mono-utilisateur de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Caché ici</a> (vous devrez vous inscrire gratuitement).  Les versions sont disponibles pour MacOS, Windows et Linux. </blockquote>  Il est plus pratique de travailler avec du code ObjectScript et d'accéder directement au serveur SGBD Caché (et à la plate-forme InterSystems IRIS également) à l'aide de l'Atelier IDE, qui est basé sur Eclipse.  Toutes <a href="">les</a> instructions de <a href="">téléchargement et d'installation</a> sont <a href="">ici</a> . <br><br>  Pour qui il est plus pratique et familier, vous pouvez utiliser le code Visual Studio confortable et simple, en le complétant avec le plug-in ObjectScript développé par la communauté. <br><br>  Et maintenant quelques exemples pratiques.  Essayons de créer quelques objets liés et travaillons avec eux en ObjectScript et Python.  L'intégration avec d'autres langues est implémentée de manière très similaire.  Python est choisi pour des raisons "d'affinité maximale" avec ObjectScript - les deux langages sont scriptables, supportent la POO et n'ont pas de typage fort :) <br><br>  Pour des idées d'exemples, nous nous tournons vers des projets vigoureux de Khabarovsk (à ne pas confondre avec Khabrovsk!) Du «Cadre de rassemblement assis».  Le code source idéologique se trouve sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/Hajsru/framework-weekend</a> Et notre code source est plus bas en texte. <br><blockquote>  Une nuance importante pour les utilisateurs de macOS.  Lors du démarrage des modules de support pour Python, vous devez vous rappeler que vous devez spécifier le chemin DYLD_LIBRARY_PATH vers le répertoire où vous avez installé Caché.  Par exemple, comme ceci: <br>  export DYLD_LIBRARY_PATH = / application / Cache / bin: $ DYLD_LIBRARY_PATH <br>  Ceci <a href="">est spécifiquement indiqué</a> dans la documentation. </blockquote><h3>  Nous créons des classes stockées sur ObjectScript </h3><br>  Alors allons-y.  Les cours à Caché seront très simples.  Vous pouvez vous passer d'un IDE - copiez le code de classe directement via le portail de votre instance de plate-forme Caché (oui, le SGBD Caché est loin d'être un simple SGBD): Navigateur système&gt; Classes&gt; Importer (espace de noms USER). <br><br>  Après l'enregistrement, les objets apparaîtront dans les globes avec des noms correspondant aux noms des classes correspondantes.  Consultez également le portail de gestion Caché: Navigateur système&gt; Globals (Namespace USER). <br><br><pre> <code class="plaintext hljs">//    , ,      Class FW.Event Extends %Persistent { Property title as %String; Property description as %String; Property date as %Date; Property visitors as list of FW.Attendee; } //    / Class FW.Attendee Extends %Persistent { Property name As %String; }</code> </pre><br><h3>  Accès aux objets dans Caché depuis Python </h3><br>  Tout d'abord, connectez-vous à la base de données du SGBD Caché.  Nous répétons comme <a href="">dans la documentation</a> . <br><blockquote>  Juste un fait utile pour travailler avec.  Gratuit, c'est aussi une version de formation du SGBD Caché, qui vous permettra de faire tout ce qui est disponible dans la version entièrement fonctionnelle, mais ne permet que deux connexions actives.  Par conséquent, en même temps, il ne sera pas possible de conserver une connexion à partir de l'IDE et d'essayer d'exécuter un autre code pour interagir avec le serveur.  La solution la plus simple trouvée est de fermer l'IDE pendant que le code Python est en cours d'exécution. </blockquote><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   Caché    Python3 import intersys.pythonbind3 #    conn = intersys.pythonbind3.connection() conn.connect_now("localhost[1972]:USER","_SYSTEM","SYS", None) #    print ("conn = %d " % conn.handle) #     database = intersys.pythonbind3.database(conn)</span></span></code> </pre> <br>  Et maintenant, nous allons créer une base de données d'objets d'événements informatiques et de leurs participants.  Très très simple.  La première consiste à créer une classe pour enregistrer et stocker des informations sur le participant à l'événement.  Pour plus de simplicité pour la classe, seul le nom du membre. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#         class Attendee: #        def __init__ (self): self.att = database.create_new("FW.Attendee", None) #             id def new (self, name): self.att.set("name", name) self.att.run_obj_method("%Save",[]) #    id     def use (self, id): self.att = database.openid("FW.Attendee",str(id),-1,-1) #       def clean (self): id = self.att.run_obj_method("%Id",[]) self.att.run_obj_method("%DeleteId", [id])</span></span></code> </pre><br>  Comme vous pouvez le voir, nous utilisons des fonctions wrapper prêtes à l'emploi pour les méthodes d'accès aux champs des objets dans Caché: définissez et dans les paramètres, nous passons le nom de la propriété entre guillemets et openid avec le nom du package et de la classe.  À propos d'une fonction get similaire, il existe des exemples ci-dessous.  Pour accéder à toutes les autres méthodes, y compris celles héritées par la classe de leurs ancêtres, utilisez la fonction run_obj_method () avec le nom de la méthode et les paramètres d'appel, si nécessaire. <br><br>  La magie la plus importante de la ligne: self.att.run_obj_method ("% Save", []) <br>  C'est ainsi que nous avons la possibilité d'enregistrer des objets avec une référence directe et sans avoir besoin d'utiliser des bibliothèques et des cadres supplémentaires, tels que les ORM omniprésents et disgracieux. <br><br>  De plus, étant donné la nature orientée objet d'ObjectScript, ainsi que les méthodes de sa classe (dans notre exemple, nous ne les avons pas faites), nous obtenons un bonus de l'accès Python à l'ensemble des méthodes héritées de la classe Persistent et de ses ancêtres.  <a href="">Voici la liste complète</a> , si cela. <br><br>  Créez le premier membre: <br><br><pre> <code class="python hljs">att = Attendee() att.new(<span class="hljs-string"><span class="hljs-string">""</span></span>)</code> </pre><br>  Après avoir exécuté ce code, un global apparaîtra dans la base de données avec le nom FW.AttendeeD et le contenu de l'objet juste enregistré comme dans la capture d'écran: <br><br><img src="https://habrastorage.org/webt/pg/rz/ck/pgrzckyjglh-k4knyfjbchwl_6y.png"><br><br>  Après l'enregistrement, cet objet a son propre identifiant (avec le numéro 1).  Par conséquent, vous pouvez le charger dans notre programme en utilisant cet identifiant: <br><br><pre> <code class="python hljs">att = Attendee() att.use(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (att.att.get(<span class="hljs-string"><span class="hljs-string">"name"</span></span>))</code> </pre><br>  Et maintenant, connaissant à nouveau id, si nécessaire, vous pouvez supprimer l'objet de la base de données des participants: <br><br><pre> <code class="python hljs">att = Attendee() att.use(<span class="hljs-number"><span class="hljs-number">1</span></span>) att.clean()</code> </pre><br>  Vérifiez, après avoir exécuté cet exemple, l'enregistrement sur l'objet doit disparaître dans le global.  Bien que les données téléchargées restent «en mémoire» de votre objet jusqu'à la fin du programme. <br><br>  Passons à l'étape suivante.  Créez les enregistrements d'événements réels. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#        class Event: #        def __init__ (self): self.event = database.create_new("FW.Event", None) #            id def new (self, title, desc, date): self.event.set("title", title) self.event.set("description", desc) self.event.set("date", date) self.event.run_obj_method("%Save",[]) #    id    def use (self, id): self.event = database.openid("FW.Event",str(id),-1,-1) #       def addAttendee (self, att): eventAtt = self.event.get("visitors") eventAtt.run_obj_method("Insert", [att]) self.event.set("visitors", eventAtt) self.event.run_obj_method("%Save",[]) #      def clean (self): id = self.event.run_obj_method("%Id",[]) self.event.run_obj_method("%DeleteId", [id])</span></span></code> </pre><br>  La structure de la classe est presque la même que ci-dessus pour le membre de la classe.  Plus important encore, une méthode est apparue pour ajouter des participants à la liste des participants à cet événement addAttendee (att). <br><br>  Nous essayons de créer un objet-enregistrement sur un nouvel événement et l'enregistrons dans la base de données: <br><br><pre> <code class="python hljs">haJS = Event() haJS.new(<span class="hljs-string"><span class="hljs-string">"haJS"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"2019-01-19"</span></span>)</code> </pre><br>  Cela devrait ressembler à ceci (notez que la date est automatiquement convertie au format ObjectScript et lorsqu'elle est rechargée dans l'objet Python, elle reviendra au format d'origine): <br><br><img src="https://habrastorage.org/webt/yk/vt/xh/ykvtxherbupxqtus54bsoz19exy.png"><br><br>  Reste à ajouter le participant à l'événement: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     haJS = Event() haJS.use(1) #    att = Attendee() att.new("") #      haJS.addAttendee(att.att)</span></span></code> </pre><br>  Ainsi, ces exemples montrent qu'il n'est pas nécessaire de penser en même temps à votre modèle de données et à son schéma de stockage tabulaire.  Vous pouvez utiliser des outils plus évidents pour vos tâches. <br><br>  Des instructions détaillées pour la connexion et l'utilisation de Caché avec Python et d'autres langues sont toujours <a href="">à votre disposition dans la documentation</a> et sur le portail de la communauté des développeurs InterSystems - ce ne sont pas moins de 5 000 membres de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">community.intersystems.com</a> <br><blockquote>  Aide: Le SGBD multimodèle InterSystems Caché reste le leader mondial permanent des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bases de données d'objets</a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/dg/zf/p_/dgzfp_-rxolw5x9zlt95sqip64q.png"></a> <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435612/">https://habr.com/ru/post/fr435612/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435602/index.html">Préparation à l'examen Azure</a></li>
<li><a href="../fr435604/index.html">BlaBlaCar est devenu ce à quoi il n'était pas destiné</a></li>
<li><a href="../fr435606/index.html">Comment écrire des tests unitaires pour les acteurs? Approche SObjectizer</a></li>
<li><a href="../fr435608/index.html">Écrans de bricolage</a></li>
<li><a href="../fr435610/index.html">Oeufs de Pâques pour ZX Spectrum - dans l'album de musique et le film</a></li>
<li><a href="../fr435614/index.html">Rust News # 4 (décembre 2018)</a></li>
<li><a href="../fr435616/index.html">Comment Peer Zoning a simplifié nos vies et contribué à équilibrer la charge d'EMC VPLEX</a></li>
<li><a href="../fr435618/index.html">Mon expérience de préparation à l'emploi Google</a></li>
<li><a href="../fr435620/index.html">Les idées de futurologues qui se sont réalisées</a></li>
<li><a href="../fr435624/index.html">Une sélection de rapports intéressants de la Conférence 35C3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>