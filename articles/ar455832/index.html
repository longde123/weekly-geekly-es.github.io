<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ซ ๐๐พ ๐ง๐พ ุชุงุฑูุฎ ุชุญููู SQL ูุงุญุฏ โ๐ฝ ๐ค ๐ต๐ฝ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุฏูุณูุจุฑ ุงููุงุถู ุ ุชูููุช ุชูุฑูุฑูุง ุนู ุงูุฃุฎุทุงุก ูุซูุฑูุง ููุงูุชูุงู ูู ูุฑูู ุฏุนู VWO. ุจุฏุง ููุช ุงูุชุญููู ูุฃุญุฏ ุงูุชูุงุฑูุฑ ุงูุชุญููููุฉ ูุนููู ูุจูุฑ ูู ุงูุดุฑูุงุช ุจุงูุธูุง. ูุจู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุงุฑูุฎ ุชุญููู SQL ูุงุญุฏ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455832/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูู ุฏูุณูุจุฑ ุงููุงุถู ุ ุชูููุช ุชูุฑูุฑูุง ุนู ุงูุฃุฎุทุงุก ูุซูุฑูุง ููุงูุชูุงู ูู ูุฑูู ุฏุนู VWO.  ุจุฏุง ููุช ุงูุชุญููู ูุฃุญุฏ ุงูุชูุงุฑูุฑ ุงูุชุญููููุฉ ูุนููู ูุจูุฑ ูู ุงูุดุฑูุงุช ุจุงูุธูุง.  ูุจูุง ุฃู ูุฐุง ูู ูุฌุงู ูุณุคูููุชู ุ ููุฏ ุฑูุฒุช ุนูู ุงูููุฑ ุนูู ุญู ุงููุดููุฉ. </p><br><h2 style=";text-align:right;direction:rtl">  ูุจู ุงูุชุงุฑูุฎ </h2><br><p style=";text-align:right;direction:rtl">  ูุชูุถูุญ ูุง ุฃุชุญุฏุซ ุนูู ุ ุณุฃุฎุจุฑู ููููุงู ุนู VWO.  ูุฐู ููุตุฉ ููููู ูู ุฎูุงููุง ุชุดุบูู ูุฎุชูู ุงูุญููุงุช ุงููุณุชูุฏูุฉ ุนูู ููุงูุนู: ุฅุฌุฑุงุก ุชุฌุงุฑุจ A / B ุ ูุชุชุจุน ุงูุฒุงุฆุฑูู ูุงูุชุญูููุงุช ุ ูุชุญููู ูุณุงุฑุงุช ุงููุจูุนุงุช ุ ูุนุฑุถ ุฎุฑุงุฆุท ุงูุญุฑุงุฑุฉ ุ ูุชุดุบูู ุชุณุฌููุงุช ุงูุฒูุงุฑุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุดูุก ุงูุฃูุซุฑ ุฃูููุฉ ูู ุงูููุตุฉ ูู ุงูุฅุจูุงุบ.  ุฌููุน ุงููุธุงุฆู ุงููุฐููุฑุฉ ุฃุนูุงู ูุชุฑุงุจุทุฉ.  ูุจุงููุณุจุฉ ููุนููุงุก ูู ุงูุดุฑูุงุช ุ ูุฅู ูุฌููุนุฉ ูุจูุฑุฉ ูู ุงููุนูููุงุช ุณุชููู ุนุฏููุฉ ุงููุงุฆุฏุฉ ุจุจุณุงุทุฉ ูู ุฏูู ููุตุฉ ูููุฉ ุชูุฏููุง ูู ุดูู ุชุญูููุงุช. </p><br><p style=";text-align:right;direction:rtl"> ุจุงุณุชุฎุฏุงู ุงููุธุงู ุงูุฃุณุงุณู ุ ููููู ุชูุฏูู ุทูุจ ุชุนุณูู ุนูู ูุฌููุนุฉ ูุจูุฑุฉ ูู ุงูุจูุงูุงุช.  ููุง ูุซุงู ุจุณูุท: </p><br><pre style=";text-align:right;direction:rtl">  ุนุฑุถ ูู ุงูููุฑุงุช ุนูู abc.com
 ูู &lt;ุชุงุฑูุฎ d1&gt; ุฅูู &lt;ุชุงุฑูุฎ d2&gt;
 ููุฃุดุฎุงุต ุงูุฐูู
 ุชุณุชุฎุฏู ูุฑูู ุฃู
 (ูุงูุช ูู ุฃูุฑูุจุง ูุงุณุชุฎุฏูุช iPhone) </pre><br><p style=";text-align:right;direction:rtl">  ุงูุชุจู ููุดุบูู ุงูููุทููุฉ.  ุชููู ูุชุงุญุฉ ููุนููุงุก ูู ูุงุฌูุฉ ุงูุงุณุชุนูุงู ูุฅุฌุฑุงุก ุงุณุชุนูุงูุงุช ูุนูุฏุฉ ุจุดูู ุชุนุณูู ูุงุณุชุฑุฏุงุฏ ุงูุนููุงุช. </p><br><h2 style=";text-align:right;direction:rtl">  ุทูุจ ุจุทูุก </h2><br><p style=";text-align:right;direction:rtl">  ูุงู ุงูุนููู ุงููุนูู ูุญุงูู ุงูููุงู ุจุดูุก ูุฌุจ ุฃู ูุนูู ุจุดูู ุญุฏุณู ุจุณุฑุนุฉ: </p><br><pre style=";text-align:right;direction:rtl">  ุนุฑุถ ูู ููุงุญุธุงุช ุงูุฌูุณุฉ
 ูููุณุชุฎุฏููู ุงูุฐูู ูุฒูุฑูู ุฃู ุตูุญุฉ
 ูุน ุฑุงุจุท ุญูุซ ููุฌุฏ "/ ูุธุงุฆู" </pre><br><p style=";text-align:right;direction:rtl">  ูุงู ููุงู ุงููุซูุฑ ูู ุงูุฒูุงุฑุงุช ุนูู ูุฐุง ุงููููุน ุ ููููุง ุจุชุฎุฒูู ุฃูุซุฑ ูู ููููู ุนููุงู URL ูุฑูุฏ ูู ุฃุฌูู ููุท.  ูุฃุฑุงุฏูุง ุงูุนุซูุฑ ุนูู ูุงูุจ ุนููุงู url ุจุณูุท ุฌุฏูุง ูุชุนูู ุจูููุฐุฌ ุฃุนูุงููู. </p><br><a name="habracut"></a><h2 style=";text-align:right;direction:rtl">  ุงูุชุญููู ุงูุฃููู </h2><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุฑู ูุง ูุญุฏุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ุงูุชุงูู ูู ุงุณุชุนูุงู SQL ุงูุจุทูุก ุงูุฃุตูู: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">SELECT count(*) FROM acc_{account_id}.urls as recordings_urls, acc_{account_id}.recording_data as recording_data, acc_{account_id}.sessions as sessions WHERE recording_data.usp_id = sessions.usp_id AND sessions.referrer_id = recordings_urls.id AND ( urls &amp;&amp; array(select id from acc_{account_id}.urls where url ILIKE '%enterprise_customer.com/jobs%')::text[] ) AND r_time &gt; to_timestamp(1542585600) AND r_time &lt; to_timestamp(1545177599) AND recording_data.duration &gt;=5 AND recording_data.num_of_pages &gt; 0 ;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููุง ุชูููุช: </p><br><pre style=";text-align:right;direction:rtl">  ุงูููุช ุงููุฎุทุท: 1.480 ูููู ุซุงููุฉ
 ุงููููุฉ ุงูุฒูููุฉ: 1431924.650 ูููู ุซุงููุฉ </pre><br><p style=";text-align:right;direction:rtl">  ุชุฌุงูุฒ ุงูุทูุจ 150 ุฃูู ุฎุท.  ุฃุธูุฑ ูุฎุทุท ุงูุงุณุชุนูุงู ุจุถุน ุชูุงุตูู ูุซูุฑุฉ ููุงูุชูุงู ุ ูููู ูุง ุชูุฌุฏ ุงุฎุชูุงูุงุช ูุงุถุญุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุฏุฑุณ ุงูุงุณุชุนูุงู ุฃูุซุฑ.  ููุง ุชุฑูู ุ ูุฅูู ูุฌุนู ุซูุงุซุฉ ุฌุฏุงูู <code>JOIN</code> : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงูุฌูุณุงุช</strong> : ูุนุฑุถ ูุนูููุงุช ุงูุฌูุณุฉ: ุงููุณุชุนุฑุถ ุ ูููู ุงููุณุชุฎุฏู ุ ุงูุจูุฏ ุ ููุง ุฅูู ุฐูู. </li><li style=";text-align:right;direction:rtl">  <strong>registration_data</strong> : ุนูุงููู url ุงููุณุฌูุฉ ูุงูุตูุญุงุช ููุฏุฉ ุงูุฒูุงุฑุงุช </li><li style=";text-align:right;direction:rtl">  <strong>ุนูุงููู url</strong> : ูุชุฌูุจ ุชูุฑุงุฑ ุนูุงููู url ุงููุจูุฑุฉ ุฌุฏูุง ุ ูููู ุจุชุฎุฒูููุง ูู ุฌุฏูู ูููุตู. </li></ol><br><p style=";text-align:right;direction:rtl">  ูุงุญุธ ุฃูุถูุง ุฃู ุฌููุน <code>account_id</code> ููุณููุฉ ุจุงููุนู ุนูู <code>account_id</code> .  ูุจุงูุชุงูู ุ ูุชู ุงุณุชุจุนุงุฏ ุงููููู ุนูุฏูุง ูููู ุงูุขุฎุฑูู ุจุณุจุจ ูุดุงูู ูุจูุฑุฉ. </p><br><h2 style=";text-align:right;direction:rtl">  ุชุจุญุซ ุนู ุฃุฏูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงููุญุต ุงูุฏููู ุ ูุฑู ุฃู ุดูุฆูุง ูุง ูู ุทูุจ ูุนูู ุบูุฑ ุตุญูุญ.  ุงูุฃูุฑ ูุณุชุญู ุฅููุงุก ูุธุฑุฉ ุนูู ูุฐุง ุงูุฎุท: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">urls &amp;&amp; array( select id from acc_{account_id}.urls where url ILIKE '%enterprise_customer.com/jobs%' )::text[]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงูุช ุงูููุฑุฉ ุงูุฃููู ุฃูู ุฑุจูุง ุจุณุจุจ <code>ILIKE</code> ูู ุฌููุน ุนูุงููู URL ุงูุทูููุฉ ูุฐู (ูุฏููุง ุฃูุซุฑ ูู 1.4 ููููู ุนููุงู URL <strong>ูุฑูุฏ</strong> ุชู ุฌูุนู ููุฐุง ุงูุญุณุงุจ) ุ ููุฏ ูุชุถุงุกู ุงูุฃุฏุงุก. </p><br><p style=";text-align:right;direction:rtl">  ููู ูุง - ูุฐู ููุณุช ุงูููุทุฉ! </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">SELECT id FROM urls WHERE url ILIKE '%enterprise_customer.com/jobs%'; id -------- ... (198661 rows) Time: 5231.765 ms</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุณุชุบุฑู ุทูุจ ุงูุจุญุซ ุนู ุงููุงูุจ ููุณู 5 ุซูุงูู ููุท.  ูู ุงููุงุถุญ ุฃู ุงูุจุญุซ ุนู ููุท ุนูู ููููู ุนููุงู URL ูุฑูุฏ ููุณ ูุดููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงููุดุชุจู ุจู ุงูุชุงูู ูู ุงููุงุฆูุฉ ูู ุนุฏุฏ ูููู ูู <code>JOIN</code> .  ุฑุจูุง ุฃุฏู ุงูุฅูุฑุงุท ูู ุงุณุชุฎุฏุงููุง ุฅูู ุชุจุงุทุคุ  ุนุงุฏุฉู ูุง <code>JOIN</code> ุงููุฑุดุญูู ุงูุฃูุซุฑ ูุถูุญุง ููุดุงูู ุงูุฃุฏุงุก ุ ููููู ูู ุฃุนุชูุฏ ุฃู ุญุงูุชูุง ูุงูุช ูููุฐุฌูุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">analytics_db=# SELECT count(*) FROM acc_{account_id}.urls as recordings_urls, acc_{account_id}.recording_data_0 as recording_data, acc_{account_id}.sessions_0 as sessions WHERE recording_data.usp_id = sessions.usp_id AND sessions.referrer_id = recordings_urls.id AND r_time &gt; to_timestamp(1542585600) AND r_time &lt; to_timestamp(1545177599) AND recording_data.duration &gt;=5 AND recording_data.num_of_pages &gt; 0 ; count ------- 8086 (1 row) Time: 147.851 ms</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฐุง ูู ููู ูุฐูู ุญุงูุชูุง.  <code>JOIN</code> ุชุญููุช <code>JOIN</code> ุฅูู ุณุฑุนุฉ ูุจูุฑุฉ. </p><br><h2 style=";text-align:right;direction:rtl">  ูููู ุจุชุถููู ุฏุงุฆุฑุฉ ุงููุดุชุจู ุจูู </h2><br><p style=";text-align:right;direction:rtl">  ููุช ูุณุชุนุฏูุง ูุจุฏุก ุชุบููุฑ ุงูุงุณุชุนูุงู ูุชุญููู ุฃู ุชุญุณููุงุช ูุญุชููุฉ ูู ุงูุฃุฏุงุก.  ุทูุฑูุง ุฃูุง ููุฑููู ุจููุฑุชูู ุฑุฆูุณูุชูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงุณุชุฎุฏู EXISTS ูุนููุงู URL ููุงุณุชุนูุงู ุงููุฑุนู</strong> : ุฃุฑุฏูุง ุงูุชุญูู ูุฑุฉ ุฃุฎุฑู ุฅุฐุง ูุงูุช ููุงู ุฃู ูุดุงูู ูู ุงูุงุณุชุนูุงู ุงููุฑุนู ูุนูุงููู URL.  ุทุฑููุฉ ูุงุญุฏุฉ ูุชุญููู ุฐูู ูู ุจุจุณุงุทุฉ ุงุณุชุฎุฏุงู <code>EXISTS</code> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู</a> <code>EXISTS</code> ุชุญุณูู ุงูุฃุฏุงุก ุจุดูู ูุจูุฑ ูุฃูู ููุชูู ุนูู ุงูููุฑ ุจูุฌุฑุฏ ุงูุนุซูุฑ ุนูู ุณุทุฑ ูุงุญุฏ ุดุฑุท. </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">SELECT count(*) FROM acc_{account_id}.urls as recordings_urls, acc_{account_id}.recording_data as recording_data, acc_{account_id}.sessions as sessions WHERE recording_data.usp_id = sessions.usp_id AND ( 1 = 1 ) AND sessions.referrer_id = recordings_urls.id AND (exists(select id from acc_{account_id}.urls where url ILIKE '%enterprise_customer.com/jobs%')) AND r_time &gt; to_timestamp(1547585600) AND r_time &lt; to_timestamp(1549177599) AND recording_data.duration &gt;=5 AND recording_data.num_of_pages &gt; 0 ; count 32519 (1 row) Time: 1636.637 ms</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุณูุง ูุนู.  ุงูุงุณุชุนูุงู ุงููุฑุนู ุ ุนูุฏ ููู ูู <code>EXISTS</code> ุ ูุฌุนู ูู ุดูุก ุจุณุฑุนุฉ ูุงุฆูุฉ.  ูุงูุณุคุงู ุงูููุทูู ุงูุชุงูู ูู ููุงุฐุง ูููู ุงูุงุณุชุนูุงู ูุน JOINs ูุงูุงุณุชุนูุงู ุงููุฑุนู ููุณู ุณุฑูุนูุง ุจุดูู ูุฑุฏู ุ ููู ุจุทูุฆูุง ุจุดูู ุฑููุจุ </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ูููู ุงูุงุณุชุนูุงู ุงููุฑุนู ุฅูู CTE</strong> : ุฅุฐุง ูุงู ุงูุทูุจ ุณุฑูุนูุง ูู ุชููุงุก ููุณู ุ ููููููุง ุจุจุณุงุทุฉ ุญุณุงุจ ุงููุชูุฌุฉ ุงูุณุฑูุนุฉ ุฃููุงู ุซู ุชูุฏูููุง ุฅูู ุงูุทูุจ ุงูุฑุฆูุณู </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">WITH matching_urls AS ( select id::text from acc_{account_id}.urls where url ILIKE '%enterprise_customer.com/jobs%' ) SELECT count(*) FROM acc_{account_id}.urls as recordings_urls, acc_{account_id}.recording_data as recording_data, acc_{account_id}.sessions as sessions, matching_urls WHERE recording_data.usp_id = sessions.usp_id AND ( 1 = 1 ) AND sessions.referrer_id = recordings_urls.id AND (urls &amp;&amp; array(SELECT id from matching_urls)::text[]) AND r_time &gt; to_timestamp(1542585600) AND r_time &lt; to_timestamp(1545107599) AND recording_data.duration &gt;=5 AND recording_data.num_of_pages &gt; 0;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููุง ูุงูุช ูุง ุชุฒุงู ุจุทูุฆุฉ ุฌุฏุง. </p><br><h2 style=";text-align:right;direction:rtl">  ุงูุนุซูุฑ ุนูู ุงูุฌุงูู </h2><br><p style=";text-align:right;direction:rtl">  ุทูุงู ูุฐุง ุงูููุช ุ ุชููุถ ุดูุก ุตุบูุฑ ุฃูุงู ุนููู ุ ูุงูุฐู ููุช ุฃุชุฌุงููู ุจุงุณุชูุฑุงุฑ.  ููู ุจูุง ุฃูู ูู ูุชุจู ุดูุก ุ ููุฏ ูุฑุฑุช ุฃู ุฃูุธุฑ ุฅูููุง.  ุฃูุง ุฃุชุญุฏุซ ุนู ุงููุดุบู <code>&amp;&amp;</code> .  ุจูููุง ูุงู <code>EXISTS</code> ุจุชุญุณูู ุงูุฃุฏุงุก ุ ูุงู <code>&amp;&amp;</code> ูู ุงูุนุงูู ุงููุดุชุฑู ุงููุญูุฏ ุงููุชุจูู ูู ุฌููุน ุฅุตุฏุงุฑุงุช ุงูุงุณุชุนูุงู ุงูุจุทูุก. </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุธุฑ ุฅูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู</a> ุ ูุฑู ุฃู <code>&amp;&amp;</code> ุงุณุชุฎุฏุงููุง ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ุงูุนุซูุฑ ุนูู ุนูุงุตุฑ ูุดุชุฑูุฉ ุจูู ุตููููู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุทูุจ ุงูุฃุตูู ุ ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">AND ( urls &amp;&amp; array(select id from acc_{account_id}.urls where url ILIKE '%enterprise_customer.com/jobs%')::text[] )</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูุนูู ุฃููุง ูุฌุฑู ุจุญุซูุง ุนู ูุงูุจ ูุนูุงููู url ุงูุฎุงุตุฉ ุจูุง ุ ุซู ูุฌุฏ ุงูุชูุงุทุน ูุน ุฌููุน ุนูุงููู url ุฐุงุช ุงูุณุฌูุงุช ุงููุดุชุฑูุฉ.  ูุฐุง ูุฑุจู ุจุนุถ ุงูุดูุก ุ ูุฃู "ุนูุงููู url" ููุง ูุง ุชุดูุฑ ุฅูู ุฌุฏูู ูุญุชูู ุนูู ุฌููุน ุนูุงููู URL ุ ูููู ุฅูู ุนููุฏ "ุนูุงููู url" ูู ุฌุฏูู <code>recording_data</code> . </p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุชูุงูู ุงูุดููู ุญูู <code>&amp;&amp;</code> ุ ุญุงููุช ุฃู ุฃุฌุฏ ุชุฃููุฏูุง ูู ุฎุทุฉ ุงูุงุณุชุนูุงู ุงูุชู <code>EXPLAIN ANALYZE</code> (ูุงู ูุฏู ุจุงููุนู ุฎุทุฉ ูุญููุธุฉ ุ ููู ุนุงุฏุฉ ูุง ุชููู ุงูุชุฌุฑุจุฉ ูุน SQL ุฃูุซุฑ ููุงุกูุฉ ูู ูุญุงููุฉ ููู ุนุชุงูุฉ ูุฎุทุทู ุทูุจ ุงูุจุญุซ). </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Filter: ((urls &amp;&amp; ($0)::text[]) AND (r_time &gt; '2018-12-17 12:17:23+00'::timestamp with time zone) AND (r_time &lt; '2018-12-18 23:59:59+00'::timestamp with time zone) AND (duration &gt;= '5'::double precision) AND (num_of_pages &gt; 0)) Rows Removed by Filter: 52710</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงู ููุงู ุนุฏุฏ ูููู ูู ุฎุทูุท ุงููุฑุดุญุงุช ูู <code>&amp;&amp;</code> ููุท.  ููุง ูุนูู ุฃู ูุฐู ุงูุนูููุฉ ูู ุชูู ุจุงูุธุฉ ุงูุซูู ูุญุณุจ ุ ูููููุง ุฃุฌุฑูุช ุฃูุถูุง ุนุฏุฉ ูุฑุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุฑุงุฌุนุช ูุฐุง ุนู ุทุฑูู ุนุฒู ุงูุญุงูุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">SELECT 1 FROM acc_{account_id}.urls as recordings_urls, acc_{account_id}.recording_data_30 as recording_data_30, acc_{account_id}.sessions_30 as sessions_30 WHERE urls &amp;&amp; array(select id from acc_{account_id}.urls where url ILIKE '%enterprise_customer.com/jobs%')::text[]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงู ูุฐุง ุงูุทูุจ ุจุทูุฆูุง.  ูุธุฑูุง ูุฃู <code>JOIN</code> ุณุฑูุนุฉ <code>JOIN</code> ุงููุฑุนูุฉ ุณุฑูุนุฉ ุ ูุจูู ููุท ุงููุดุบู <code>&amp;&amp;</code> . </p><br><p style=";text-align:right;direction:rtl">  ูุฐู ูุฌุฑุฏ ุนูููุฉ ุฑุฆูุณูุฉ.  ูุญุชุงุฌ ุฏุงุฆููุง ุฅูู ุงูุจุญุซ ูู ุฌููุน ุฃูุญุงุก ุงูุฌุฏูู ุงูุฑุฆูุณู ูุนูุงููู URL ููุจุญุซ ุญุณุจ ุงูููุท ุ ููุญุชุงุฌ ุฏุงุฆููุง ุฅูู ุงูุจุญุซ ุนู ุงูุชูุงุทุนุงุช.  ูุง ูููููุง ุงูุจุญุซ ูู ุฅุฏุฎุงูุงุช ุนููุงู url ูุจุงุดุฑุฉู ุ ูุฃู ูุฐู ูุฌุฑุฏ ูุนุฑูุงุช ุชุตู ุฅูู <code>urls</code> . </p><br><h2 style=";text-align:right;direction:rtl">  ูุญู ุญู </h2><br><p style=";text-align:right;direction:rtl">  <code>&amp;&amp;</code> ุจุทูุฆุฉ ูุฃู ููุง ุงููุฌููุนุชูู ุถุฎูุชุงู.  ุณุชููู ุงูุนูููุฉ ุณุฑูุนุฉ ูุณุจููุง ุฅุฐุง ุงุณุชุจุฏูุช <code>urls</code> ุจู <code>{ "http://google.com/", "http://wingify.com/" }</code> . </p><br><p style=";text-align:right;direction:rtl">  ุจุฏุฃุช ุฃุจุญุซ ุนู ุทุฑููุฉ ูุฌุนู ุชูุงุทุน ุงููุฌููุนุงุช ูู Postgres ุฏูู ุงุณุชุฎุฏุงู <code>&amp;&amp;</code> ุ ูููู ุฏูู ูุฌุงุญ ูุจูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููุงูุฉ ุ ูุฑุฑูุง ุจุจุณุงุทุฉ ุญู ุงููุดููุฉ ุจูุนุฒู ุนู ุบูุฑูุง: ุฃุนุทูู ูู <code>urls</code> ุจุงูุณูุณูุฉ ุงูุชู ุชุทุงุจู ุนููุงู url ุงููููุฐุฌ ุงูุฎุงุต ุจูุง.  ุจุฏูู ุดุฑูุท ุฅุถุงููุฉ ุ ุณูููู - </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">SELECT urls.url FROM acc_{account_id}.urls as urls, (SELECT unnest(recording_data.urls) AS id) AS unrolled_urls WHERE urls.id = unrolled_urls.id AND urls.url ILIKE '%jobs%'</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุฏูุงู ูู ุจูุงุก ุฌููุฉ <code>JOIN</code> ุ ููุช ุจุงุณุชุฎุฏุงู ุงุณุชุนูุงู ูุฑุนู ูููุช ุจุชูุณูุน ุตููู registration_data.urls ุจุญูุซ ูููู ุชุทุจูู ุงูุดุฑุท ูุจุงุดุฑุฉู ุนูู <code>WHERE</code> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุดูุก ุงูุฃูุซุฑ ุฃูููุฉ ููุง ูู ุฃูู <code>&amp;&amp;</code> ุงุณุชุฎุฏุงู <code>&amp;&amp;</code> ููุชุญูู ููุง ุฅุฐุง ูุงู ุงูุฅุฏุฎุงู ุงููุญุฏุฏ ูุญุชูู ุนูู ุนููุงู URL ููุงุณุจ.  ุนูุฏ ุงูุชุญุฏูู ููููุงู ุ ููููู ุฃู ุชุฑู ูู ูุฐู ุงูุนูููุฉ ุชุชุญุฑู ูู ุฎูุงู ุนูุงุตุฑ ุงููุตูููุฉ (ุฃู ุตููู ุงูุฌุฏูู) ูุชุชููู ุนูุฏ ุงุณุชููุงุก ุงูุดุฑุท (ุงููุทุงุจูุฉ).  ูุง ูุดุจู ุฃู ุดูุกุ  ูุนู ุ <code>EXISTS</code> . </p><br><p style=";text-align:right;direction:rtl">  ุจูุง ุฃูู ูููู ุงูุฑุฌูุน ุฅูู registration_data.urls ูู ุฎุงุฑุฌ ุณูุงู ุงูุงุณุชุนูุงู ุงููุฑุนู ุนูุฏ ุญุฏูุซ ุฐูู ุ ููููููุง ุงูุนูุฏุฉ ุฅูู ุตุฏูููุง ุงููุฏูู <code>EXISTS</code> ุจุงุณุชุฎุฏุงู ุงุณุชุนูุงู ูุฑุนู. </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุฏูุฌ ูู ุดูุก ูุนูุง ุ ูุญุตู ุนูู ุงูุงุณุชุนูุงู ุงูููุงุฆู ุงููุญุณู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">SELECT count(*) FROM acc_{account_id}.urls as recordings_urls, acc_{account_id}.recording_data as recording_data, acc_{account_id}.sessions as sessions WHERE recording_data.usp_id = sessions.usp_id AND ( 1 = 1 ) AND sessions.referrer_id = recordings_urls.id AND r_time &gt; to_timestamp(1542585600) AND r_time &lt; to_timestamp(1545177599) AND recording_data.duration &gt;=5 AND recording_data.num_of_pages &gt; 0 AND EXISTS( SELECT urls.url FROM acc_{account_id}.urls as urls, (SELECT unnest(urls) AS rec_url_id FROM acc_{account_id}.recording_data) AS unrolled_urls WHERE urls.id = unrolled_urls.rec_url_id AND urls.url ILIKE '%enterprise_customer.com/jobs%' );</code> </pre><br><p style=";text-align:right;direction:rtl">  <code>Time: 1898.717 ms</code> ุงูุชุดุบูู ุงูููุงุฆู <code>Time: 1898.717 ms</code> ุญุงู ููุช ุงูุงุญุชูุงูุ!ุ </p><br><p style=";text-align:right;direction:rtl">  ููุณ ุจูุฐู ุงูุณุฑุนุฉ!  ุชุญุชุงุฌ ุฃููุง ุฅูู ุงูุชุญูู ูู ุตุญุฉ.  ููุช ูุชุดููุง ููุบุงูุฉ ูู ุชุญุณูู <code>EXISTS</code> ุ ูุฃูู ูุบูุฑ ุงูููุทู ุฅูู ููุงูุฉ ุณุงุจูุฉ.  ูุฌุจ ุฃู ูุชุฃูุฏ ูู ุฃููุง ูู ููู ุจุฅุถุงูุฉ ุฎุทุฃ ุบูุฑ ูุงุถุญ ููุทูุจ. </p><br><p style=";text-align:right;direction:rtl">  ูุงู ุงูุงุฎุชูุงุฑ ุงูุจุณูุท ูู ุฅุฌุฑุงุก <code>count(*)</code> ููู ูู ุงูุงุณุชุนูุงูุงุช ุงูุจุทูุฆุฉ ูุงูุณุฑูุนุฉ ูุนุฏุฏ ูุจูุฑ ูู ูุฌููุนุงุช ุงูุจูุงูุงุช ุงููุฎุชููุฉ.  ุจุนุฏ ุฐูู ุ ุจุงููุณุจุฉ ููุฌููุนุฉ ูุฑุนูุฉ ุตุบูุฑุฉ ูู ุงูุจูุงูุงุช ุ ุฑุงุฌุนุช ุตุญุฉ ุฌููุน ุงููุชุงุฆุฌ ูุฏูููุง. </p><br><p style=";text-align:right;direction:rtl">  ุฃุนุทุช ุฌููุน ุงูุดููุงุช ูุชุงุฆุฌ ุฅูุฌุงุจูุฉ ุจุงุณุชูุฑุงุฑ.  ูุญู ุฅุตูุงุญู! </p><br><h2 style=";text-align:right;direction:rtl">  ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ </h2><br><p style=";text-align:right;direction:rtl">  ููุงู ุงูุนุฏูุฏ ูู ุงูุฏุฑูุณ ุงูุชู ูุฌุจ ุชุนูููุง ูู ูุฐู ุงููุตุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฎุทุท ุงูุงุณุชุนูุงู ูุง ุชุฑูู ุงููุตุฉ ุจุฃููููุง ุ ูููููุง ูุฏ ุชุนุทู ุฃุฏูุฉ </li><li style=";text-align:right;direction:rtl">  ุงููุดุชุจู ุจูู ุงูุฑุฆูุณููู ููุณูุง ุฏุงุฆูุงู ุงูุฌูุงุฉ ุงูุญูููููู </li><li style=";text-align:right;direction:rtl">  ูููู ุชูุณูู ุงูุงุณุชุนูุงูุงุช ุงูุจุทูุฆุฉ ูุนุฒู ุงูุงุฎุชูุงูุงุช </li><li style=";text-align:right;direction:rtl">  ููุณุช ูู ุงูุชุญุณููุงุช ูุฎุชุตุฑุฉ ุจุทุจูุนุชูุง </li><li style=";text-align:right;direction:rtl">  ูููู ุฃู ูุคุฏู ุงุณุชุฎุฏุงู <code>EXIST</code> ุ ุญูุซูุง ุฃููู ุ ุฅูู ุฒูุงุฏุฉ ุญุงุฏุฉ ูู ุงูุฅูุชุงุฌูุฉ. </li></ol><br><h2 style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br><p style=";text-align:right;direction:rtl">  ููุฏ ุฐูุจูุง ูู ููุช ุงูุทูุจ ูู ~ 24 ุฏูููุฉ ุฅูู 2 ุซุงููุฉ - ุฒูุงุฏุฉ ุฎุทูุฑุฉ ููุบุงูุฉ ูู ุงูุฃุฏุงุก!  ุนูู ุงูุฑุบู ูู ุฃู ูุฐู ุงูููุงูุฉ ูุงูุช ูุจูุฑุฉ ุ ุฅูุง ุฃู ุฌููุน ุงูุชุฌุงุฑุจ ุงูุชู ุฃุฌุฑููุงูุง ุญุฏุซุช ูู ููุณ ุงูููู ุ ูููููุง ููุชูุฏูุฑุงุช ุ ุงุณุชุบุฑู ุงูุฃูุฑ ูู 1.5 ุฅูู ุณุงุนุชูู ููุชุญุณููุงุช ูุงูุงุฎุชุจุงุฑุงุช. </p><br><p style=";text-align:right;direction:rtl">  SQL ูู ูุบุฉ ุฑุงุฆุนุฉ ุ ุฅู ูู ุชูู ุฎุงุฆูุฉ ูููุง ุ ูููู ุญุงูู ุฃู ุชุชุนูููุง ูุชุณุชุฎุฏููุง.  ุจุนุฏ ููู ุฌูุฏ ูููููุฉ ุชูููุฐ ุงุณุชุนูุงูุงุช SQL ุ ูููู ุชูุดุฆ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฎุทุท ุงูุงุณุชุนูุงู ุ ูููู ุชุนูู ุงูููุงุฑุณ ุ ูุจุจุณุงุทุฉ ุญุฌู ุงูุจูุงูุงุช ุงูุชู ุชุชุนุงูู ูุนูุง ุ ููููู ุงููุฌุงุญ ุฅูู ุญุฏ ูุจูุฑ ูู ุชุญุณูู ุงูุงุณุชุนูุงู.  ููุน ุฐูู ุ ูู ุงูููู ุจููุณ ุงููุฏุฑ ุงูุงุณุชูุฑุงุฑ ูู ุชุฌุฑุจุฉ ุฃุณุงููุจ ูุฎุชููุฉ ูุญู ุงููุดููุฉ ุจุจุทุก ูุฅูุฌุงุฏ ุงุฎุชูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุฃูุถู ุฌุฒุก ูู ุชุญููู ูุฐู ุงููุชุงุฆุฌ ูู ุชุญุณู ููุญูุธ ูู ุงูุณุฑุนุฉ - ุนูุฏูุง ูุชู ุงูุขู ุชุญููู ุงูุชูุฑูุฑ ุงูุฐู ูู ูุชู ุชูุฒููู ูู ูุจู ุนูู ุงูููุฑ ุชูุฑูุจูุง. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุดูุฑ ุฎุงุต</strong> ูุฒููุงุฆู ูู ุงููุฑูู <em>Aditya</em> <em>Misra</em> ู <em>Aditya Gauru</em> ู <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Varun Malhotra</a></em> ุนูู ุงูุนุตู ุงูุฐููู ู <em>Dinkar Pandir</em> ูุฅูุฌุงุฏ ุฎุทุฃ ููู ูู ุทูุจูุง ุงูููุงุฆู ูุจู ุฃู <em>ููุฏุนู</em> ุฃุฎูุฑูุง! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar455832/">https://habr.com/ru/post/ar455832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar455816/index.html">ููููุฉ ุฅูุดุงุก ุนูู ุฑุงุฆุน ููุณุงุนุฏ Google. Lifehacks ูู ูุฌุฑุฏ ููุธูุฉ ุงูุนูู ุงูุฏูููุฉ</a></li>
<li><a href="../ar455820/index.html">ุชุญููู ุฃุฏุงุก VM ูู VMware vSphere. ุงูุฌุฒุก 2: ุงูุฐุงูุฑุฉ</a></li>
<li><a href="../ar455826/index.html">ุณูู ุงูุณูุงุฑุงุช ุงูุชุญูู ูููุง ุนู ุจุนุฏ</a></li>
<li><a href="../ar455828/index.html">ููุฏ ุงูุชุดู ุงูุนููุงุก ุฃุดูุงูุง ุบุฑูุจุฉ ุฌุฏูุฏุฉ ูู ุงูุชุฒุงูู</a></li>
<li><a href="../ar455830/index.html">ูุธุฑุฉ ุนูู Go ูู ุฎูุงู ุนููู ูุทูุฑ .NET. ุงูุฃุณุจูุน ุฑูู 1</a></li>
<li><a href="../ar455834/index.html">ูุนุงููุฑ ูุฎูุงุฏู Linux: 5 ุฃุฏูุงุช ููุชูุญุฉ</a></li>
<li><a href="../ar455840/index.html">ููููุฉ ุงูุนูู ูุน ุงุณุชูุณุงุฑุงุช ูุชุนุฏุฏุฉ. ุชูููู ุ ุงููุฎูุถ ุ FP</a></li>
<li><a href="../ar455842/index.html">ูุดุฑ ูุงุฆูุฉ ูุฑุชุจุทุฉ ูููุฑุฏุฉ. ุทุจุนุฉ ุณุฑูุนุฉ</a></li>
<li><a href="../ar455844/index.html">ุฅูุดุงุก ูุญูู Roslyn ุจุงุณุชุฎุฏุงู ุงุฎุชุจุงุฑ ุงูุชุบููู ููุซุงู</a></li>
<li><a href="../ar455846/index.html">ุงูุญูุณุจุฉ ุงูููุฒุนุฉ ูู ุฌูููุง</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>