<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸˆº ğŸš ğŸ‘§ğŸ¾ The Ø±Ø¨Ù…Ø§ Monad Ø¹Ø¨Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© / ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± C # (Ø¨Ø¯ÙˆÙ† Task ov!) ğŸ›°ï¸ ğŸ“€ âœ³ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ØªØ¹Ø¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ C # 7 ØªØªÙŠØ­ Ù„Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„ÙŠØ³ ÙÙ‚Ø· Ø§Ù„Ù…Ù‡Ù…Ø© ÙƒÙ†ÙˆØ¹ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ù„Ø£Ø³Ø§Ù„ÙŠØ¨ ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø© (ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø© / ØªÙ†ØªØ¸Ø± ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>The Ø±Ø¨Ù…Ø§ Monad Ø¹Ø¨Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© / ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± C # (Ø¨Ø¯ÙˆÙ† Task ov!)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468017/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/3n/zz/tw/3nzztwahkcl-ppecyzowprupvym.jpeg"></p><br><p style=";text-align:right;direction:rtl">  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ØªØ¹Ø¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</a></strong> Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ C # 7 ØªØªÙŠØ­ Ù„Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„ÙŠØ³ ÙÙ‚Ø· <strong>Ø§Ù„Ù…Ù‡Ù…Ø©</strong> ÙƒÙ†ÙˆØ¹ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ù„Ø£Ø³Ø§Ù„ÙŠØ¨ ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø© (ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø© <strong>/ ØªÙ†ØªØ¸Ø±</strong> ) ØŒ ÙˆÙ„ÙƒÙ† Ø£ÙŠØ¶Ù‹Ø§ Ø£ÙŠ Ø£Ù†ÙˆØ§Ø¹ Ø£Ø®Ø±Ù‰ (ÙØ¦Ø§Øª Ø£Ùˆ Ø¨Ù†ÙŠØ§Øª) ØªÙÙŠ Ø¨Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø¹ÙŠÙ†Ø©. </p><br><p style=";text-align:right;direction:rtl"> ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ù†ÙØ³Ù‡ ØŒ ÙŠØ¹Ø¯ <strong>Ø§Ù„ØªØ²Ø§Ù…Ù† / Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</strong> Ø·Ø±ÙŠÙ‚Ø© Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„ ÙÙŠ Ø³ÙŠØ§Ù‚ Ù…Ø¹ÙŠÙ† ØŒ ÙˆÙ‡Ùˆ Ø¬ÙˆÙ‡Ø± Ù†Ù…Ø· ØªØµÙ…ÙŠÙ… <strong>Monad</strong> .  ÙˆØ§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ùˆ ØŒ Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… <strong>Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© / Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</strong> Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ø§Ù„ØªÙŠ ØªØªØµØ±Ù ÙƒÙ…Ø§ Ù„Ùˆ ÙƒÙ†Ø§ Ù†Ø³ØªØ®Ø¯Ù… monadsØŸ  Ø§ØªØ¶Ø­ Ø£Ù† Ù†Ø¹Ù… (Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ­ÙØ¸Ø§Øª).  Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ ÙŠÙ‚ÙˆÙ… Ø§Ù„ÙƒÙˆØ¯ Ø£Ø¯Ù†Ø§Ù‡ Ø¨ØªØ±Ø¬Ù…Ø© ÙˆÙŠØ¹Ù…Ù„: </p><br><pre style=";text-align:right;direction:rtl"><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-string"><span class="hljs-string">"1,2"</span></span>, <span class="hljs-string"><span class="hljs-string">"3,7,1"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span> }) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Sum(s).GetMaybeResult(); Console.WriteLine(res.IsNothing ? <span class="hljs-string"><span class="hljs-string">"Nothing"</span></span> : res.GetValue().ToString()); } <span class="hljs-comment"><span class="hljs-comment">// 3, 11, Nothing, Nothing } async Maybe&lt;int&gt; Sum(string input) { var args = await Split(input);//   var result = 0; foreach (var arg in args) result += await Parse(arg);//   return result; } Maybe&lt;string[]&gt; Split(string str) { var parts = str?.Split(',').Where(s=&gt;!string.IsNullOrWhiteSpace(s)).ToArray(); return parts == null || parts.Length &lt; 2 ? Maybe&lt;string[]&gt;.Nothing() : parts; } Maybe&lt;int&gt; Parse(string str) =&gt; int.TryParse(str, out var result) ? result : Maybe&lt;int&gt;.Nothing();</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ ØŒ Ø£Ø´Ø±Ø­ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² ... </p><a name="habracut"></a><br><h2 id="obobschennye-asinhronnye-tipy-vozvraschaemyh-znacheniy" style=";text-align:right;direction:rtl">  Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† Ø§Ù„Ø¹Ø§Ù…Ø© </h2><br><p style=";text-align:right;direction:rtl">  <strong>Ø¨Ø§Ø¯Ø¦ Ø°ÙŠ</strong> Ø¨Ø¯Ø¡ ØŒ <strong>Ø¯Ø¹Ù†Ø§ Ù†ØªØ¹Ø±Ù</strong> Ø¹Ù„Ù‰ Ù…Ø§ Ù‡Ùˆ Ù…Ø·Ù„ÙˆØ¨ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… <strong>Ù†ÙˆØ¹Ù†Ø§</strong> Ø§Ù„Ø®Ø§Øµ (Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ ÙØ¦Ø© <strong>MyAwaitable &lt;T&gt;</strong> ) ÙƒÙ†ÙˆØ¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ø¨Ø¹Ø¶ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©.  ØªÙ‚ÙˆÙ„ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ†: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  Ø£Ø³Ù„ÙˆØ¨ <strong>GetAwaiter ()</strong> ØŒ ÙˆØ§Ù„Ø°ÙŠ ÙŠÙ‚ÙˆÙ… Ø¨Ø¥Ø±Ø¬Ø§Ø¹ ÙƒØ§Ø¦Ù† Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ ÙŠÙ‚ÙˆÙ… Ø¨ØªÙ†ÙÙŠØ° ÙˆØ§Ø¬Ù‡Ø© <strong>INotifyCompletion</strong> ØŒ ÙƒÙ…Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®Ø§ØµÙŠØ© <strong>IsCompleted Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©</strong> ÙˆØ·Ø±ÙŠÙ‚Ø© <strong>T GetResult ()</strong> Ø› </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>[AsyncMethodBuilder (Type)]</strong> - Ø³Ù…Ø© ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø°ÙŠ Ø³ÙŠÙƒÙˆÙ† Ø¨Ù…Ø«Ø§Ø¨Ø© " <strong>Method Builder</strong> " ØŒ Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ <strong>MyAwaitableTaskMethodBuilder &lt;T&gt;</strong> .  ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ ÙÙŠ Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„ØªØ§Ù„ÙŠØ©: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Ø¥Ù†Ø´Ø§Ø¡ Ø«Ø§Ø¨Øª () </li><li style=";text-align:right;direction:rtl">  Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (ÙˆÙ„Ø§ÙŠØ© Ù…Ø§Ø´ÙŠÙ†) </li><li style=";text-align:right;direction:rtl">  SetResult (Ø§Ù„Ù†ØªÙŠØ¬Ø©) </li><li style=";text-align:right;direction:rtl">  SetException (Ø§Ø³ØªØ«Ù†Ø§Ø¡) </li><li style=";text-align:right;direction:rtl">  SetStateMachine (stateMachine) </li><li style=";text-align:right;direction:rtl">  AwaitOnCompleted (awaiter ØŒ stateMachine) </li><li style=";text-align:right;direction:rtl">  AwaitUnsafeOnCompleted (awaiterØŒ stateMachine) </li><li style=";text-align:right;direction:rtl">  Ù…Ù‡Ù…Ø© </li></ul><br></li></ol><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø³ÙŠØ· Ù„Ù€ MyAwaitable Ùˆ MyAwaitableTaskMethodBuilder</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AsyncMethodBuilder(typeof(MyAwaitableTaskMethodBuilder&lt;&gt;))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyAwaitable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">INotifyCompletion</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action _continuation; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyAwaitable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyAwaitable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsCompleted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MyAwaitable&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAwaiter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsCompleted { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Exception Exception { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsCompleted) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Not completed"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Exception != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { ExceptionDispatchInfo.Throw(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Exception); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsCompleted) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Already completed"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsCompleted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._continuation?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception exception</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsCompleted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Exception = exception; } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> INotifyCompletion.OnCompleted(Action continuation) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._continuation = continuation; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsCompleted) { continuation(); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyAwaitableTaskMethodBuilder</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyAwaitableTaskMethodBuilder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyAwaitable&lt;T&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> MyAwaitableTaskMethodBuilder&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyAwaitableTaskMethodBuilder&lt;T&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Start&lt;TStateMachine&gt;(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TStateMachine stateMachine) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TStateMachine : IAsyncStateMachine =&gt; stateMachine.MoveNext(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetStateMachine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IAsyncStateMachine stateMachine</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception exception</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Task.SetException(exception); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T result</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Task.SetResult(result); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AwaitOnCompleted&lt;TAwaiter, TStateMachine&gt;( <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TAwaiter awaiter, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TStateMachine stateMachine) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TAwaiter : INotifyCompletion <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TStateMachine : IAsyncStateMachine =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GenericAwaitOnCompleted(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> awaiter, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> stateMachine); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AwaitUnsafeOnCompleted&lt;TAwaiter, TStateMachine&gt;( <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TAwaiter awaiter, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TStateMachine stateMachine) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TAwaiter : ICriticalNotifyCompletion <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TStateMachine : IAsyncStateMachine =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GenericAwaitOnCompleted(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> awaiter, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> stateMachine); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> GenericAwaitOnCompleted&lt;TAwaiter, TStateMachine&gt;( <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TAwaiter awaiter, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TStateMachine stateMachine) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TAwaiter : INotifyCompletion <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TStateMachine : IAsyncStateMachine =&gt; awaiter.OnCompleted(stateMachine.MoveNext); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MyAwaitable&lt;T&gt; Task { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre></div></div><br><p style=";text-align:right;direction:rtl">  Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… <strong>MyAwaitable</strong> ÙƒÙ†ÙˆØ¹ Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø·Ø±Ù‚ ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> MyAwaitable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyAwaitableMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> arg1 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetMyAwaitable(<span class="hljs-number"><span class="hljs-number">1</span></span>); result += arg1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> arg2 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetMyAwaitable(<span class="hljs-number"><span class="hljs-number">2</span></span>); result += arg2; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> arg3 = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetMyAwaitable(<span class="hljs-number"><span class="hljs-number">3</span></span>); result += arg3; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> MyAwaitable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMyAwaitable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Task.Delay(<span class="hljs-number"><span class="hljs-number">1</span></span>);<span class="hljs-comment"><span class="hljs-comment">//   return await new MyAwaitable&lt;int&gt;(arg); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙŠØ¹Ù…Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² ØŒ ÙˆÙ„ÙƒÙ† Ù„ÙÙ‡Ù… Ø¬ÙˆÙ‡Ø± Ù…ØªØ·Ù„Ø¨Ø§Øª ÙØ¦Ø© <strong>MyAwaitable ØŒ</strong> Ø¯Ø¹ÙˆÙ†Ø§ Ù†Ø±Ù‰ Ù…Ø§ ÙŠÙØ¹Ù„Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø³Ø¨Ù‚ Ù„Ù€ C # Ù…Ø¹ Ø·Ø±ÙŠÙ‚Ø© <strong>MyAwaitableMethod</strong> .  Ø¥Ø°Ø§ Ù‚Ù…Øª Ø¨ØªØ´ØºÙŠÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ .NET (Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ dotPeek) ØŒ Ø³ØªØ±Ù‰ Ø£Ù† Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù‚Ø¯ ØªØºÙŠØ±Øª ÙƒÙ…Ø§ ÙŠÙ„ÙŠ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> MyAwaitable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyAwaitableMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stateMachine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyAwaitableMethodStateMachine(); stateMachine.Owner = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; stateMachine.Builder = MyAwaitableTaskMethodBuilder&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Create(); stateMachine.State = <span class="hljs-number"><span class="hljs-number">0</span></span>; stateMachine.Builder.Start(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> stateMachine); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stateMachine.Builder.Task; }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">MyAwaitableMethodStateMachine</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <em>Ù‡Ø°Ø§ Ù‡Ùˆ ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø±Ù…Ø² Ù…Ø¨Ø³Ø· ØŒ Ø­ÙŠØ« Ø£ØªØ®Ø·Ù‰ Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ø¬Ø¹Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„Ù…ØªØ±Ø¬Ù… Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©</em> </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyAwaitableMethodStateMachine</span></span> : <span class="hljs-title"><span class="hljs-title">IAsyncStateMachine</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> State; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MyAwaitableTaskMethodBuilder&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; Builder; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BuilderDemo Owner; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _result; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _arg1; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _arg2; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _arg3; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MyAwaitableAwaiter&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; _awaiter1; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MyAwaitableAwaiter&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; _awaiter2; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MyAwaitableAwaiter&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; _awaiter3; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetAwaitCompletion</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">INotifyCompletion awaiter</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stateMachine = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Builder.AwaitOnCompleted(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> awaiter, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> stateMachine); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IAsyncStateMachine.MoveNext() { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> finalResult; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { label_begin: <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.State) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._awaiter1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Owner.GetMyAwaitable(<span class="hljs-number"><span class="hljs-number">1</span></span>).GetAwaiter(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.State = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._awaiter1.IsCompleted) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SetAwaitCompletion(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._awaiter1); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> label_begin; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-comment"><span class="hljs-comment">// awaiter1    this._arg1 = this._awaiter1.GetResult(); this._result += this._arg1; this.State = 2; this._awaiter2 = this.Owner.GetMyAwaitable(2).GetAwaiter(); if (!this._awaiter2.IsCompleted) { this.SetAwaitCompletion(this._awaiter2); return; } goto label_begin; case 2:// awaiter2    this._arg2 = this._awaiter2.GetResult(); this._result += this._arg2; this.State = 3; this._awaiter3 = this.Owner.GetMyAwaitable(3).GetAwaiter(); if (!this._awaiter3.IsCompleted) { this.SetAwaitCompletion(this._awaiter3); return; } goto label_begin; case 3:// awaiter3    this._arg3 = this._awaiter3.GetResult(); this._result += this._arg3; finalResult = this._result; break; default: throw new Exception(); } } catch (Exception ex) { this.State = -1; this.Builder.SetException(ex); return; } this.State = -1; this.Builder.SetResult(finalResult); } }</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  Ø¨Ø¹Ø¯ ÙØ­Øµ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØŒ Ù†Ø±Ù‰ Ø£Ù† <strong>Method Builder</strong> Ù„Ø¯ÙŠÙ‡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ØªÙ†Ø¸ÙŠÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ <strong>MoveNext ()</strong> Ø§Ù„Ø°ÙŠ ÙŠÙ†Ù‚Ù„ Ø¬Ù‡Ø§Ø² Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ„Ø¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©. </li><li style=";text-align:right;direction:rtl">  Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† ÙŠÙ…Ø«Ù„ Ø³ÙŠØ§Ù‚ Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø© ( <code>public MyAwaitable&lt;T&gt; Task { get; }</code> ) </li><li style=";text-align:right;direction:rtl">  Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„ØªØ±Ø¬Ù…Ø© Ø¬Ù‡Ø§Ø² Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¥Ù„Ù‰ Ø­Ø§Ù„Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ©: <strong>SetResult</strong> Ø£Ùˆ <strong>SetException</strong> . </li></ol><br><p style=";text-align:right;direction:rtl">  Ø¨Ù…Ø¹Ù†Ù‰ Ø¢Ø®Ø± ØŒ Ø¨Ù…Ø³Ø§Ø¹Ø¯Ø© <strong>Method Builder ØŒ</strong> ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙƒÙŠÙÙŠØ© ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ø³Ø§Ù„ÙŠØ¨ ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© ØŒ ÙˆÙŠØ¨Ø¯Ùˆ Ø£Ù† Ù‡Ø°Ù‡ ÙØ±ØµØ© Ø³ØªØ³Ø§Ø¹Ø¯Ù†Ø§ Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ù‡Ø¯ÙÙ†Ø§ - ØªÙ†ÙÙŠØ° Ø³Ù„ÙˆÙƒ <strong>Ø±Ø¨Ù…Ø§</strong> Ø£Ø­Ø§Ø¯ÙŠ. </p><br><p style=";text-align:right;direction:rtl">  ÙˆÙ„ÙƒÙ† Ù…Ø§ Ù‡Ùˆ Ø¬ÙŠØ¯ Ø­ÙˆÙ„ Ù‡Ø°Ø§ monadØŸ ... ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø­ÙˆÙ„ Ù‡Ø°Ø§ monad Ø¹Ù„Ù‰ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ØŒ Ù„Ø°Ù„Ùƒ Ù‡Ù†Ø§ Ø³ÙˆÙ Ø£ØµÙ ÙÙ‚Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª. </p><br><h2 id="monada-maybe" style=";text-align:right;direction:rtl">  Ø±Ø¨Ù…Ø§ Ù…Ù†Ø§Ø¯ </h2><br><p style=";text-align:right;direction:rtl">  Ø¨Ø§Ø®ØªØµØ§Ø± ØŒ <strong>Ø±Ø¨Ù…Ø§ ÙŠÙƒÙˆÙ†</strong> monad Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ù†Ù…Ø· ØªØµÙ…ÙŠÙ… ÙŠØªÙŠØ­ Ù„Ùƒ Ù…Ù‚Ø§Ø·Ø¹Ø© Ø³Ù„Ø³Ù„Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø¥Ø°Ø§ Ù„Ù… ØªØªÙ…ÙƒÙ† Ø¨Ø¹Ø¶ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ù…Ù† Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ù…Ù† Ø¥Ø±Ø¬Ø§Ø¹ Ù†ØªÙŠØ¬Ø© Ø°Ø§Øª Ù…Ø¹Ù†Ù‰ (Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø©). </p><br><p style=";text-align:right;direction:rtl">  Ø­Ù„Øª Ù„ØºØ§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© Ø§Ù„Ø­ØªÙ…ÙŠØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ø·Ø±ÙŠÙ‚ØªÙŠÙ†: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø´Ø±Ø·ÙŠ </li><li style=";text-align:right;direction:rtl">  Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª </li></ol><br><p style=";text-align:right;direction:rtl">  ÙƒÙ„ØªØ§ Ø§Ù„Ø·Ø±ÙŠÙ‚ØªÙŠÙ† Ù„Ù‡Ø§ Ø¹ÙŠÙˆØ¨ ÙˆØ§Ø¶Ø­Ø© ØŒ Ù„Ø°Ù„Ùƒ ØªÙ… Ø§Ù‚ØªØ±Ø§Ø­ Ù†Ù‡Ø¬ Ø¨Ø¯ÙŠÙ„: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù†ÙˆØ¹ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø­Ø§Ù„ØªÙŠÙ†: "Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙŠÙ…Ø©" Ùˆ "Ø¨Ù„Ø§ Ù‚ÙŠÙ…Ø©" (" <strong>Ù„Ø§ Ø´ÙŠØ¡</strong> ") - Ø¯Ø¹Ù†Ø§ Ù†Ø³Ù…ÙŠÙ‡Ø§ <strong>Ø±Ø¨Ù…Ø§</strong> </li><li style=";text-align:right;direction:rtl">  Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¸ÙŠÙØ© (Ø¯Ø¹Ù†Ø§ Ù†Ø³Ù…ÙŠÙ‡Ø§ <strong>SelectMany</strong> ) Ø§Ù„ØªÙŠ ØªØ£Ø®Ø° ÙˆØ³ÙŠØ·Ø§Øª 2: <br>  2.1.  <strong>Ø±Ø¨Ù…Ø§</strong> ÙŠØ¹ØªØ±Ø¶ <br>  2.2.  Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª.  ÙŠØ¬Ø¨ Ø£Ù† ØªÙØ±Ø¬Ø¹ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø£ÙŠØ¶Ù‹Ø§ ÙƒØ§Ø¦Ù†Ù‹Ø§ Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ <strong>Ø±Ø¨Ù…Ø§</strong> ØŒ ÙˆØ§Ù„Ø°ÙŠ Ù‚Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ø§ØªØ¬Ø© Ø£Ùˆ ÙÙŠ Ø­Ø§Ù„Ø© <strong>Ù„Ø§ Ø´ÙŠØ¡</strong> Ø¥Ø°Ø§ ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ ØªÙ… ØªÙ…Ø±ÙŠØ± Ù…Ø¹Ù„Ù…Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø§Ù„Ø©) </li><li style=";text-align:right;direction:rtl">  ØªÙ‚ÙˆÙ… ÙˆØ¸ÙŠÙØ© <strong>SelectMany</strong> Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒØ§Ø¦Ù† Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ <strong>Ø±Ø¨Ù…Ø§</strong> ØŒ ÙˆØ¥Ø°Ø§ ÙƒØ§Ù†Øª ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ø§ØªØ¬Ø© ØŒ ÙØ³ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØªÙ…Ø±ÙŠØ±Ù‡Ø§ ÙƒÙˆØ³ÙŠØ·Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù…Ù† Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ (ÙŠØªÙ… ØªÙ…Ø±ÙŠØ±Ù‡Ø§ ÙƒÙˆØ³ÙŠØ·Ø© Ø«Ø§Ù†ÙŠØ©).  Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒØ§Ø¦Ù† <strong>Ø±Ø¨Ù…Ø§</strong> ÙÙŠ Ø­Ø§Ù„Ø© <strong>Nothing</strong> ØŒ ÙØ³ÙˆÙ ÙŠÙ‚ÙˆÙ… <strong>SelectMany</strong> Ø¨Ø¥Ø±Ø¬Ø§Ø¹ <strong>Nothing Ø¹Ù„Ù‰</strong> Ø§Ù„ÙÙˆØ±. </li></ol><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/f2/zl/3k/f2zl3kmfcocbyyujwqa4wvidxqw.png"></p><br><p style=";text-align:right;direction:rtl">  ÙÙŠ C # ØŒ ÙŠÙ…ÙƒÙ† ØªÙ†ÙÙŠØ° Ø°Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø­Ùˆ Ø§Ù„ØªØ§Ù„ÙŠ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Maybe&lt;T&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Maybe&lt;T&gt;(T <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) =&gt; Value(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Maybe&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Value</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Maybe&lt;T&gt;(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Maybe&lt;T&gt; Nothing = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Maybe&lt;T&gt;(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Maybe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isNothing, T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsNothing = isNothing; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsNothing; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> T _value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsNothing ? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Nothing"</span></span>) : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._value; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MaybeExtensions</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Maybe&lt;TRes&gt; SelectMany&lt;TIn, TRes&gt;( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> Maybe&lt;TIn&gt; source, Func&lt;TIn, Maybe&lt;TRes&gt;&gt; func) =&gt; source.IsNothing ? Maybe&lt;TRes&gt;.Nothing : func(source.GetValue()); }</code> </pre><br><p style=";text-align:right;direction:rtl">  ÙˆÙ…Ø«Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = Function1(i).SelectMany(Function2).SelectMany(Function3); Console.WriteLine(res.IsNothing ? <span class="hljs-string"><span class="hljs-string">"Nothing"</span></span> : res.GetValue().ToString()); } <span class="hljs-function"><span class="hljs-function">Maybe&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Function1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> acc</span></span></span><span class="hljs-function">)</span></span> =&gt; acc &lt; <span class="hljs-number"><span class="hljs-number">10</span></span> ? acc + <span class="hljs-number"><span class="hljs-number">1</span></span> : Maybe&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Nothing; <span class="hljs-function"><span class="hljs-function">Maybe&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Function2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> acc</span></span></span><span class="hljs-function">)</span></span> =&gt; acc &lt; <span class="hljs-number"><span class="hljs-number">10</span></span> ? acc + <span class="hljs-number"><span class="hljs-number">2</span></span> : Maybe&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Nothing; <span class="hljs-function"><span class="hljs-function">Maybe&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Function3</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> acc</span></span></span><span class="hljs-function">)</span></span> =&gt; acc &lt; <span class="hljs-number"><span class="hljs-number">10</span></span> ? acc + <span class="hljs-number"><span class="hljs-number">3</span></span> : Maybe&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Nothing; }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Ù„Ù…Ø§Ø°Ø§ Ù‡Ùˆ "SelectMany"ØŸ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  Ø£Ø¹ØªÙ‚Ø¯ Ø£Ù† Ø§Ù„Ø¨Ø¹Ø¶ Ù…Ù†ÙƒÙ… Ù‚Ø¯ ÙŠØªØ³Ø§Ø¡Ù„: "Ù„Ù…Ø§Ø°Ø§ Ù‚Ø§Ù… Ø§Ù„Ù…Ø¤Ù„Ù Ø¨Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ©" SelectMany "ØŸ ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ØŒ Ù‡Ù†Ø§Ùƒ Ø³Ø¨Ø¨ Ù„Ø°Ù„Ùƒ - ÙÙŠ C # ÙŠÙ‚ÙˆÙ… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø³Ø¨Ù‚ Ø¨Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ <strong>Select Many</strong> Ø¹Ù†Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ¹Ø¨ÙŠØ±Ø§Øª Ø§Ù„Ù…ÙƒØªÙˆØ¨Ø© ÙÙŠ <strong>Query Notation</strong> ØŒ ÙˆØ§Ù„ØªÙŠ Ù‡ÙŠ ÙÙŠ Ø¬ÙˆÙ‡Ø±Ù‡Ø§ "Ø§Ù„Ø³ÙƒØ± Ø§Ù„Ù†Ø­ÙˆÙŠ" Ù„Ù„Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© Ù„Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø²ÙŠØ¯ Ù…Ù† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙÙŠ Ù…Ù‚Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚</a> ). </p><br><p style=";text-align:right;direction:rtl">  ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¥Ø¹Ø§Ø¯Ø© ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø­Ùˆ Ø§Ù„ØªØ§Ù„ÙŠ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = Function1(i) .SelectMany(x2 =&gt; Function2(x2).SelectMany(x3 =&gt; Function3(x3.SelectMany&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(x4 =&gt; x2 + x3 + x4)));</code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙˆØ¨Ø§Ù„ØªØ§Ù„ÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© (x2 ØŒ x3) ØŒ ÙˆØ§Ù„ØªÙŠ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø±ÙŠØ­Ø© Ù„Ù„ØºØ§ÙŠØ©.  Ù„Ø³ÙˆØ¡ Ø§Ù„Ø­Ø¸ ØŒ ÙØ¥Ù† Ù‚Ø±Ø§Ø¡Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø´ÙØ±Ø© Ø£Ù…Ø± ØµØ¹Ø¨ Ù„Ù„ØºØ§ÙŠØ© ØŒ Ù„ÙƒÙ† Ù„Ø­Ø³Ù† Ø§Ù„Ø­Ø¸ ØŒ ÙŠØ­ØªÙˆÙŠ C # Ø¹Ù„Ù‰ <strong>ØªØ±Ù…ÙŠØ² Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</strong> Ø¨Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ø«Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ Ø³ÙŠÙƒÙˆÙ† Ø£Ø³Ù‡Ù„ Ø¨ÙƒØ«ÙŠØ±: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> x2 </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Function1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> x3 </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Function2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x2</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> x4 </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Function3</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x3</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">select</span></span></span><span class="hljs-function"> x2 + x3 + x4</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù„Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù…ØªØ±Ø¬Ù…Ù‹Ø§ ØŒ Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªÙˆØ³ÙŠØ¹ ÙˆØ¸ÙŠÙØ© <strong>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ø¯ÙŠØ¯</strong> Ø¨Ø´ÙƒÙ„ Ø·ÙÙŠÙ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Maybe&lt;TJ&gt; SelectMany&lt;TIn, TRes, TJ&gt;( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> Maybe&lt;TIn&gt; source, Func&lt;TIn, Maybe&lt;TRes&gt;&gt; func, Func&lt;TIn, TRes, TJ&gt; joinFunc) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (source.IsNothing) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Maybe&lt;TJ&gt;.Nothing; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = func(source.GetValue()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.IsNothing ? Maybe&lt;TJ&gt;.Nothing : joinFunc(source.GetValue(), res.GetValue()); }</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙŠ Ø³ÙŠØ¨Ø¯Ùˆ Ø¨Ù‡Ø§ Ø§Ù„Ø±Ù…Ø² Ù…Ù† Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ø¥Ø°Ø§ Ù‚Ù…Øª Ø¨Ø¥Ø¹Ø§Ø¯Ø© ÙƒØªØ§Ø¨ØªÙ‡Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ·Ø¨ÙŠÙ‚ Ø±Ø¨Ù…Ø§ "ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ"</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {<span class="hljs-string"><span class="hljs-string">"1,2"</span></span>, <span class="hljs-string"><span class="hljs-string">"3,7,1"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span>}) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = Sum(s); Console.WriteLine(res.IsNothing ? <span class="hljs-string"><span class="hljs-string">"Nothing"</span></span> : res.GetValue().ToString()); } Console.ReadKey(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Maybe&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sum</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input</span></span></span><span class="hljs-function">)</span></span> =&gt; Split(input).SelectMany(items =&gt; Acc(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, items)); <span class="hljs-comment"><span class="hljs-comment">//       "Maybe" static Maybe&lt;int&gt; Acc(int res, int index, IReadOnlyList&lt;string&gt; array) =&gt; index &lt; array.Count ? Add(res, array[index]) .SelectMany(newRes =&gt; Acc(newRes, index + 1, array)) : res; static Maybe&lt;int&gt; Add(int acc, string nextStr) =&gt; Parse(nextStr).SelectMany&lt;int, int&gt;(nextNum =&gt; acc + nextNum); static Maybe&lt;string[]&gt; Split(string str) { var parts = str?.Split(',') .Where(s =&gt; !string.IsNullOrWhiteSpace(s)).ToArray(); return parts == null || parts.Length &lt; 2 ? Maybe&lt;string[]&gt;.Nothing : parts; } static Maybe&lt;int&gt; Parse(string value) =&gt; int.TryParse(value, out var result) ? result : Maybe&lt;int&gt;.Nothing;</span></span></code> </pre><br><p style=";text-align:right;direction:rtl">  <em>Ù„Ø§ ÙŠØ¨Ø¯Ùˆ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ø£Ù†ÙŠÙ‚Ù‹Ø§ Ø¬Ø¯Ù‹Ø§ ØŒ Ø­ÙŠØ« Ø¥Ù† C # Ù„Ù… ÙŠÙƒÙ† Ù…ØµÙ…Ù…Ù‹Ø§ ÙÙŠ Ø§Ù„Ø£ØµÙ„ ÙƒÙ„ØºØ© ÙˆØ¸ÙŠÙÙŠØ© ØŒ ÙˆÙ„ÙƒÙ† Ù‡Ø°Ø§ Ø§Ù„Ù†Ù‡Ø¬ Ø´Ø§Ø¦Ø¹ Ø¬Ø¯Ù‹Ø§ ÙÙŠ Ø§Ù„Ù„ØºØ§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ© "Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©".</em> </p></div></div><br><h2 id="async-maybe" style=";text-align:right;direction:rtl">  Ù…ØªØ²Ø§Ù…Ù† Ø±Ø¨Ù…Ø§ </h2><br><p style=";text-align:right;direction:rtl">  Ø¥Ù† Ø¬ÙˆÙ‡Ø± <strong>Ø±Ø¨Ù…Ø§</strong> monad Ù‡Ùˆ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø³Ù„Ø³Ù„Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ØŒ ÙˆÙ„ÙƒÙ† Ù‡Ø°Ø§ Ù‡Ùˆ Ø¨Ø§Ù„Ø¶Ø¨Ø· Ù…Ø§ ÙŠÙØ¹Ù„Ù‡ <strong>Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© / Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</strong> .  Ù„Ø°Ù„Ùƒ ØŒ Ø¯Ø¹ÙˆÙ†Ø§ Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø¬Ù…Ø¹ Ø¨ÙŠÙ†Ù‡Ù…Ø§.  Ø£ÙˆÙ„Ø§Ù‹ ØŒ Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¬Ø¹Ù„ Ù†ÙˆØ¹ <strong>Ø±Ø¨Ù…Ø§</strong> Ù…ØªÙˆØ§ÙÙ‚Ù‹Ø§ Ù…Ø¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© ØŒ ÙˆÙ†Ø¹Ø±Ù Ø¨Ø§Ù„ÙØ¹Ù„ ÙƒÙŠÙÙŠØ© ØªØ­Ù‚ÙŠÙ‚ Ø°Ù„Ùƒ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AsyncMethodBuilder(typeof(MaybeTaskMethodBuilder&lt;&gt;))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Maybe</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">INotifyCompletion</span></span> { ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Maybe&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAwaiter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsCompleted { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action continuation</span></span></span><span class="hljs-function">)</span></span>{...} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt;... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø§Ù„Ø¢Ù† ØŒ Ù„Ù†Ø±Ù‰ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© ÙƒØªØ§Ø¨Ø© "Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©" ÙƒØ¢Ù„ÙŠØ© Ø­Ø§Ù„Ø© Ù…Ø­Ø¯ÙˆØ¯Ø© Ø­ØªÙ‰ Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø£ÙˆØ¬Ù‡ ØªØ´Ø§Ø¨Ù‡: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stateMachine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateMachine(); stateMachine.state = <span class="hljs-number"><span class="hljs-number">0</span></span>; stateMachine.i = i; stateMachine.MoveNext(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = stateMachine.Result; Console.WriteLine(res.IsNothing ? <span class="hljs-string"><span class="hljs-string">"Nothing"</span></span> : res.GetValue().ToString()); } Console.ReadKey(); } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">StateMachine</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> state = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Maybe&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; Result; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Maybe&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; _f1; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Maybe&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; _f2; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Maybe&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; _f3; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { label_begin: <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._f1 = Function1(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.i); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = Match ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> label_begin; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._f2 = Function2(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._f1.GetValue()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._f2.IsNothing ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> label_begin; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._f3 = Function3(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._f2.GetValue()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._f3.IsNothing ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> label_begin; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Result = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._f3.GetValue(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Result = Maybe&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Nothing; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø¥Ø°Ø§ Ù‚Ø§Ø±Ù†Ø§ Ø¬Ù‡Ø§Ø² Ø§Ù„Ø­Ø§Ù„Ø© Ù‡Ø°Ø§ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø³Ø¨Ù‚ C # Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ (Ø§Ù†Ø¸Ø± "MyAwaitableMethodStateMachine" Ø£Ø¹Ù„Ø§Ù‡) ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø£Ù† Ù†Ù„Ø§Ø­Ø¸ Ø£Ù†Ù‡ <strong>Ø±Ø¨Ù…Ø§</strong> ÙŠÙ…ÙƒÙ† ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø¯Ø§Ø®Ù„: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Builder.AwaitOnCompleted(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> awaiter, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> stateMachine);</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø­ÙŠØ« <code>ref awaiter</code> Ù‡Ùˆ ÙƒØ§Ø¦Ù† Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ <strong>Ø±Ø¨Ù…Ø§</strong> .  Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù‡Ù†Ø§ Ù‡ÙŠ Ø£Ù†Ù†Ø§ Ù„Ø§ Ù†Ø³ØªØ·ÙŠØ¹ Ø¶Ø¨Ø· Ø§Ù„Ø¢Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© "Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©" (-1) ØŒ Ù„ÙƒÙ† Ù‡Ù„ ÙŠØ¹Ù†ÙŠ Ø°Ù„Ùƒ Ø£Ù†Ù†Ø§ Ù„Ø§ Ù†Ø³ØªØ·ÙŠØ¹ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ØªØ¯ÙÙ‚ Ø§Ù„ØªÙ†ÙÙŠØ°ØŸ  Ù‡Ø°Ø§ ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ù„ÙŠØ³ Ù‡Ùˆ Ø§Ù„Ø­Ø§Ù„.  Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ù‡ÙŠ Ø£Ù†Ù‡ Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„ÙƒÙ„ Ø¥Ø¬Ø±Ø§Ø¡ ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù† ØŒ ØªÙ‚ÙˆÙ… C # Ø¨Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ¸ÙŠÙØ© Ø±Ø¯ Ø§ØªØµØ§Ù„ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† Ù…Ù† Ø®Ù„Ø§Ù„ ÙˆØ§Ø¬Ù‡Ø© <strong>INotifyCompletion</strong> ØŒ Ù„Ø°Ù„Ùƒ Ø¥Ø°Ø§ Ø£Ø±Ø¯Ù†Ø§ ÙƒØ³Ø± ØªØ¯ÙÙ‚ Ø§Ù„ØªÙ†ÙÙŠØ° ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¨Ø¨Ø³Ø§Ø·Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ÙˆØ¸ÙŠÙØ© Ø±Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯Ù…Ø§ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ù…ØªØ§Ø¨Ø¹Ø© Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©. <br>  Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© Ø£Ø®Ø±Ù‰ Ù‡Ù†Ø§ ÙˆÙ‡ÙŠ Ø£Ù† Ø¬Ù‡Ø§Ø² Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙŠÙ†Ù‚Ù„ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ© (ÙƒØ¯Ø§Ù„Ø© Ø±Ø¯ Ø§ØªØµØ§Ù„) Ø¥Ù„Ù‰ Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© ØŒ Ù„ÙƒÙ†Ù†Ø§ Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ÙˆØ¸ÙŠÙØ© Ø±Ø¯ Ø§ØªØµØ§Ù„ Ù„Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙŠØ­ Ù„Ù†Ø§ ØªØ¬Ø§ÙˆØ² Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© (Ù…Ù† Ø£ÙŠ Ù…Ø³ØªÙˆÙ‰ ØªØ¯Ø§Ø®Ù„) : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/da/v-/vb/dav-vbwfusgtb1degxhxyhafsdk.png"></p><br><p style=";text-align:right;direction:rtl">  Ù„Ø°Ù„Ùƒ ØŒ Ù†Ø­Ù† Ø¨Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ Ø±Ø¨Ø· Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø§ Ù…Ø¹ Ù…Ù†Ø´Ø¦Ù‡.  ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨Ø°Ù„Ùƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… <strong>Method Builder</strong> ØŒ ÙˆØ§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ù„Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© - <strong>Ø§Ù„Ù…Ù‡Ù…Ø©</strong> .  Ø³ÙŠØªÙ… ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© <code>AwaitOnCompleted (ref awaiter)</code> Ø¥Ù„Ù‰ <code>AwaitOnCompleted (ref awaiter)</code> ÙƒÙ€ <strong>awaiter</strong> ØŒ Ù„Ø°Ù„Ùƒ Ù†Ø­ØªØ§Ø¬ ÙÙ‚Ø· Ø¥Ù„Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ù‡ÙŠ Ù…Ø«Ø§Ù„ <strong>Ø±Ø¨Ù…Ø§</strong> ØŒ Ø«Ù… Ù‚Ù… Ø¨ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ <strong>Ø±Ø¨Ù…Ø§</strong> Ø¨ØµÙØªÙ‡ Ø£ØµÙ„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ§Ø¨Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AsyncMethodBuilder(typeof(MaybeTaskMethodBuilder&lt;&gt;))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Maybe</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IMaybe</span></span>, <span class="hljs-title"><span class="hljs-title">INotifyCompletion</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IMaybe _parent; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IMaybe.SetParent(IMaybe parent) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._parent = parent; ... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MaybeTaskMethodBuilder</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> GenericAwaitOnCompleted&lt;TAwaiter, TStateMachine&gt;( <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TAwaiter awaiter, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> TStateMachine stateMachine) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TAwaiter : INotifyCompletion <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TStateMachine : IAsyncStateMachine { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (awaiter <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IMaybe maybe) { maybe.SetParent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Task); } awaiter.OnCompleted(stateMachine.MoveNext); } ... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø§Ù„Ø¢Ù† ÙƒÙ„ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ <strong>Ø±Ø¨Ù…Ø§</strong> ÙŠÙ…ÙƒÙ† Ø¯Ù…Ø¬Ù‡Ø§ ÙÙŠ ØªØ³Ù„Ø³Ù„ Ù‡Ø±Ù…ÙŠ ØŒ ÙˆÙ†ØªÙŠØ¬Ø© Ù„Ø°Ù„Ùƒ ØŒ Ø³Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ù‡Ø±Ù…ÙŠ Ø¨Ø£ÙƒÙ…Ù„Ù‡ (Ø·Ø±ÙŠÙ‚Ø© <strong>Ø§Ù„Ø®Ø±ÙˆØ¬</strong> ) Ù…Ù† Ø£ÙŠ Ø¹Ù‚Ø¯Ø©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AsyncMethodBuilder(typeof(MaybeTaskMethodBuilder&lt;&gt;))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Maybe</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IMaybe</span></span>, <span class="hljs-title"><span class="hljs-title">INotifyCompletion</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action _continuation; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IMaybe _parent; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action continuation</span></span></span><span class="hljs-function">)</span></span> { ... <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._continuation = continuation; ... } ... <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IMaybe.Exit() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsCompleted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._parent != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._parent.Exit(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._continuation(); } } ... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙŠØ¬Ø¨ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø·Ø±ÙŠÙ‚Ø© <strong>Ø§Ù„Ø®Ø±ÙˆØ¬</strong> Ø¹Ù†Ø¯Ù…Ø§ ØŒ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¹Ø¨Ø± Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ù‡Ø±Ù…ÙŠ ØŒ Ù†Ø¬Ø¯ ÙƒØ§Ø¦Ù† <strong>Ø±Ø¨Ù…Ø§</strong> Ù…Ø­Ø³ÙˆØ¨ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø­Ø§Ù„Ø© <strong>Ù„Ø§ Ø´ÙŠØ¡</strong> .  Ù…Ø«Ù„ <strong>Ø±Ø¨Ù…Ø§</strong> ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ø¨Ø·Ø±Ù‚ Ù…Ø«Ù„ Ù‡Ø°Ø§: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">Maybe&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Parse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> str</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.TryParse(str, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result) ? result : Maybe&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Nothing();</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù„ØªØ®Ø²ÙŠÙ† <strong>Ø±Ø¨Ù…Ø§</strong> Ø§Ù„Ø­Ø§Ù„Ø© ØŒ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù†ÙŠØ© Ù…Ù†ÙØµÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> MaybeResult { ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> T _value; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsNothing; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsNothing ? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Nothing"</span></span>) : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._value; } [AsyncMethodBuilder(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(MaybeTaskMethodBuilder&lt;&gt;))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Maybe</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IMaybe</span></span>, <span class="hljs-title"><span class="hljs-title">INotifyCompletion</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MaybeResult? _result; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Maybe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { }<span class="hljs-comment"><span class="hljs-comment">//Used in async method private Maybe(MaybeResult result) =&gt; this._result = result;// ""  ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ¯Ø¹ÙŠ ÙÙŠÙ‡ Ø§Ù„Ø¬Ù‡Ø§Ø² ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© (Ø¹Ø¨Ø± <strong>Method Builder</strong> ) Ø·Ø±ÙŠÙ‚Ø© <strong>OnCompleted</strong> Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø«ÙŠÙ„ <strong>Ø±Ø¨Ù…Ø§</strong> Ù…Ø­Ø³ÙˆØ¨ Ø¨Ø§Ù„ÙØ¹Ù„ ÙˆÙ‡Ùˆ ÙÙŠ Ø­Ø§Ù„Ø© <strong>Nothing</strong> ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ ÙƒØ³Ø± Ø§Ù„Ø¯ÙÙ‚ Ø¨Ø£ÙƒÙ…Ù„Ù‡: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action continuation</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._continuation = continuation; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._result.HasValue) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.NotifyResult(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._result.Value.IsNothing); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T result</span></span></span><span class="hljs-function">) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//  "method builder"     { this._result = MaybeResult.Value(result); this.IsCompleted = true; this.NotifyResult(this._result.Value.IsNothing); } private void NotifyResult(bool isNothing) { this.IsCompleted = true; if (isNothing) { this._parent.Exit();//    } else { this._continuation?.Invoke(); } }</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø§Ù„Ø¢Ù† ÙŠØ¨Ù‚Ù‰ Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· - ÙƒÙŠÙÙŠØ© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø© ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù† <strong>Ø±Ø¨Ù…Ø§</strong> Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚Ù‡ (Ø£ÙŠ Ø·Ø±ÙŠÙ‚Ø© ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø© Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡ <strong>Ø±Ø¨Ù…Ø§ Ø±Ø¨Ù…Ø§</strong> ).  Ø¥Ø°Ø§ Ø­Ø§ÙˆÙ„Øª Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„ØªÙŠ <strong>ØªÙ†ØªØ¸Ø± Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</strong> ÙÙ‚Ø· Ù…Ø¹ Ù…Ø«ÙŠÙ„ <strong>Ø±Ø¨Ù…Ø§</strong> ØŒ ÙØ³ÙŠØªÙ… Ø·Ø±Ø­ Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø²: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AsyncMethodBuilder(typeof(MaybeTaskMethodBuilder&lt;&gt;))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Maybe</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IMaybe</span></span>, <span class="hljs-title"><span class="hljs-title">INotifyCompletion</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MaybeResult? _result; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._result.Value.GetValue(); } ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> MaybeResult { ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsNothing ? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Nothing"</span></span>) : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._value; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù„Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¨Ø¨Ø³Ø§Ø·Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„ <strong>Ø§Ù†ØªØ¸Ø§Ø±</strong> Ø¬Ø¯ÙŠØ¯ <strong>Ø³ÙŠØ¹ÙŠØ¯</strong> Ø¨Ù†ÙŠØ© <strong>MaybeResult</strong> Ø¨Ø£ÙƒÙ…Ù„Ù‡Ø§ ØŒ ÙˆÙ…Ù† Ø«Ù… ÙŠÙ…ÙƒÙ†Ù†Ø§ ÙƒØªØ§Ø¨Ø© Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø²: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> GetResult().GetMaybeResult(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(res.IsNothing){ ... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ res.GetValue(); ... };</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù‡Ø°Ø§ ÙƒÙ„ Ø´ÙŠØ¡ Ø§Ù„Ø¢Ù†.  ÙÙŠ Ø£Ù…Ø«Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© ØŒ Ø­Ø°ÙØª Ø¨Ø¹Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù„Ù„ØªØ±ÙƒÙŠØ² ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø£ÙƒØ«Ø± Ø£Ù‡Ù…ÙŠØ©.  ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¹Ù„Ù‰ <a href="">Ø¬ÙŠØ«Ø¨</a> . </p><br><p style=";text-align:right;direction:rtl">  <strong>ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹</strong> ØŒ Ù„Ø§ Ø£ÙˆØµÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© Ø£Ø¹Ù„Ø§Ù‡ ÙÙŠ Ø£ÙŠ Ø±Ù…Ø² Ø¹Ù…Ù„ ØŒ Ù„Ø£Ù†Ù‡ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø´ÙƒÙ„Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ù‡Ù…Ø© - Ø¹Ù†Ø¯Ù…Ø§ Ù†ÙƒØ³Ø± Ø³Ù„Ø³Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ° ØŒ Ù…Ù…Ø§ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¬Ø°Ø± ØºÙŠØ± Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© (Ù…Ø¹ Ø§Ù„Ù†ÙˆØ¹ <strong>Ø±Ø¨Ù…Ø§</strong> ) ØŒ ÙØ¥Ù†Ù†Ø§ Ù†ÙƒØ³Ø± Ø§Ù„ÙƒÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚!  Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªÙ„ Ø§Ù„Ø£Ø®ÙŠØ±Ø© (Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¤Ø§Ù„ "Ù‡Ù„ ØªØ³Ù…Ù‰ Ø§Ù„ÙƒØªÙ„ <strong>Ø£Ø®ÙŠØ±Ù‹Ø§</strong> Ø¯Ø§Ø¦Ù…Ù‹Ø§ØŸ") ØŒ Ù„Ø°Ù„Ùƒ Ù„Ù† <strong>ØªØ³ØªØ®Ø¯Ù…</strong> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ØŒ Ù…Ù…Ø§ Ù‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ØªØ³Ø±Ø¨ Ù…ÙˆØ±Ø¯.  ÙŠÙ…ÙƒÙ† Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¥Ø°Ø§ Ù‚Ù…Ù†Ø§ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¨Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ØŒ ÙØ³Ù†Ø«ÙŠØ± Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø®Ø§ØµÙ‹Ø§ Ø³ÙŠØªÙ… Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡ Ø¶Ù…Ù†ÙŠÙ‹Ø§ ( <a href="">Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø±</a> ) ØŒ ÙˆÙ„ÙƒÙ† Ù…Ù† Ø§Ù„ÙˆØ§Ø¶Ø­ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ù„ Ù„Ù‡ Ø­Ø¯ Ø£Ø¯Ø§Ø¡ (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…Ù‚Ø¨ÙˆÙ„Ù‹Ø§ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª).  ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ C # ØŒ Ù„Ø§ Ø£Ø±Ù‰ Ø­Ù„Ø§Ù‹ Ø¢Ø®Ø± ØŒ Ù„ÙƒÙ† Ø±Ø¨Ù…Ø§ ÙŠØªØºÙŠØ± Ù‡Ø°Ø§ ÙÙŠ ÙŠÙˆÙ… Ù…Ø§ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„. </p><br><p style=";text-align:right;direction:rtl">  ÙˆÙ…Ø¹ Ø°Ù„Ùƒ ØŒ Ù„Ø§ ØªØ¹Ù†ÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¶Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ø¹Ø¯ÙŠÙ…Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© ØªÙ…Ø§Ù…Ù‹Ø§ ØŒ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„ØªÙ†ÙÙŠØ° monads Ø§Ù„Ø£Ø®Ø±Ù‰ Ø§Ù„ØªÙŠ Ù„Ø§ ØªØªØ·Ù„Ø¨ ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØŒ Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ "Reader".  ÙƒÙŠÙÙŠØ© ØªÙ†ÙÙŠØ° Ù‡Ø°Ø§ "Ù‚Ø§Ø±Ø¦" Ø£Ø­Ø§Ø¯ÙŠ Ù…Ù† Ø®Ù„Ø§Ù„ <strong>async / Ø§Ù†ØªØ¸Ø§Ø±</strong> Ø³ÙˆÙ ØªØ¸Ù‡Ø± <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar468017/">https://habr.com/ru/post/ar468017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar468007/index.html">Ù„ÙƒÙ†Ù†ÙŠ Ù„Ø§ Ø£ÙØ¹Ù„ Ù‡Ø±Ø§Ø¡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ØŸ ÙƒÙŠÙ ÙˆÙ„Ù…Ø§Ø°Ø§ Ù„ØªÙ†ÙÙŠØ° Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø¬ÙˆØ¯Ø©</a></li>
<li><a href="../ar468009/index.html">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù ÙÙŠ Ù†Ø¸Ù… ØªØ®Ø·ÙŠØ· Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ù…Ù† Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª KII</a></li>
<li><a href="../ar468011/index.html">Ù‚ØµØ© Ø±ÙˆØ¨ÙˆØª Ø§ÙØªØ±Ø§Ø¶ÙŠ</a></li>
<li><a href="../ar468013/index.html">Ø·Ø±ÙŠÙ‚Ø© Ø³Ù‡Ù„Ø© ÙˆØ¢Ù…Ù†Ø© Ù„Ø£ØªÙ…ØªØ© Ø¹Ù…Ù„ÙŠØ§Øª Ù†Ø´Ø± Ø§Ù„ÙƒÙ†Ø§Ø±ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Helm</a></li>
<li><a href="../ar468015/index.html">Ù…Ø§ Ù‡Ùˆ Ù…Ø¹Ø±ÙˆÙ Ø¹Ù† ITIL 4 ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ ØŒ ÙˆØ§Ù„Ø°ÙŠ ÙŠØ³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</a></li>
<li><a href="../ar468019/index.html">ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ WebAssembly Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… NetCore 3 Ùˆ Blazor</a></li>
<li><a href="../ar468021/index.html">ÙØ¨ ØŒ ÙƒÙ… Ù…Ù† Ø§Ù„ØªØ¬Ø±ÙŠØ¯ Ù„Ù„Ø´Ø¹Ø¨ØŸ</a></li>
<li><a href="../ar468023/index.html">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚ØªØ§Ù„ Shadow Fight 3</a></li>
<li><a href="../ar468025/index.html">ÙƒÙŠÙÙŠØ© ØªÙƒÙˆÙŠÙ† SNI ÙÙŠ Zimbra OSEØŸ</a></li>
<li><a href="../ar468027/index.html">Ø·Ø±Ù‚ ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ Ù„ Redd. Ø§Ù„Ø¬Ø²Ø¡ 2: Ø°Ø§ÙƒØ±Ø© ØºÙŠØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø§ÙÙ„Ø© Ø§Ù„Ù…ÙˆØ§Ø²ÙŠØ©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>