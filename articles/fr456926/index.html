<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•¶ üöä üë®üèø‚Äç‚öïÔ∏è Comment nous faisons Sportmaster üëéüèΩ üêú ü•©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! Je suis s√ªr que beaucoup d'entre vous ont d√©j√† achet√© un T-shirt, un ballon, des baskets, ou tout autre √©quipement de sport dans nos m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous faisons Sportmaster</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/456926/"> Bonjour √† tous!  Je suis s√ªr que beaucoup d'entre vous ont d√©j√† achet√© un T-shirt, un ballon, des baskets, ou tout autre √©quipement de sport dans nos magasins, mais peu savent ce qu'est le Sportmaster d'un point de vue technique. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/_s/2g/78/_s2g78t3lwucifnjqtiod7yatja.png"></a> <br>  <i>Un peu de Sportmaster 2003 de web.archive.org</i> <br><br>  Je m'appelle Dmitry, je suis un d√©veloppeur Java senior chez Sportmaster, et aujourd'hui je voudrais parler de notre boutique en ligne, de la voie qu'il est devenue pour devenir votre fa√ßon de le conna√Ætre maintenant: comment nous avons commenc√©, comment nous avons d√©velopp√© ce qui s'est pass√© et ce qui ne s'est pas pass√©, des probl√®mes d'aujourd'hui et des plans pour l'avenir.  Int√©ressant?  Bienvenue au chat! <br><a name="habracut"></a><br>  L'histoire de la pr√©sence de notre entreprise sur le web a d√©j√† commenc√© en 1999 avec le premier site du Sportmaster, qui n'√©tait qu'une carte de visite et un catalogue de marchandises pour les acheteurs en gros.  En fait, la boutique en ligne de l'entreprise a son histoire depuis 2001.  √Ä cette √©poque, la soci√©t√© ne disposait pas de sa propre √©quipe pour d√©velopper des projets en ligne, et la boutique en ligne a r√©ussi √† changer plusieurs plates-formes self-made (maintenant, nous ne nous souvenons m√™me pas du nombre).  La premi√®re solution relativement stable pour nous a √©t√© cr√©√©e par le prochain int√©grateur en 2011 en PHP, bas√©e sur CMS 1C Bitrix.  Le site s'est av√©r√© √™tre simple, en fait, la fonctionnalit√© en bo√Æte Bitrix a √©t√© utilis√©e, avec de petites personnalisations pour passer une commande.  Pour le mat√©riel, la configuration de d√©marrage comprenait 2 serveurs d'applications et un serveur de base de donn√©es. <br><br>  Entre-temps, la soci√©t√© a commenc√© √† d√©velopper activement ses propres comp√©tences dans le domaine de la vente en ligne, principalement du c√¥t√© de l'entreprise, qui, je dois le dire, a progress√© assez rapidement, et l'√©quipe de d√©veloppement a √©t√© contrainte de se d√©velopper rapidement dans tous les sens afin de r√©pondre √† ses besoins.  En moins d'un an, trois √©quipes ont imm√©diatement commenc√© √† r√©pondre du d√©veloppement et du support du site - l'int√©grateur lui-m√™me, l'√©quipe interne du Sportmaster, qui n'√©tait alors compos√©e que de quelques personnes, et d'un autre entrepreneur - son apparition, en fait, √©tait due au fait que l'int√©grateur √† ce moment, je ne pouvais pas fournir les capacit√©s dont nous avions besoin pour les gens. <br><br>  Quels probl√®mes avions-nous √† ce moment-l√†?  Il y avait de nombreux probl√®mes, mais le plus important est le fonctionnement instable de notre boutique en ligne. <br><br>  Nous pourrions m√™me tomber du fait que l'entreprise a r√©alis√© une sorte de newsletter, apr√®s quoi ~ 2000-2500 personnes sont venues sur le site, ou, si je me souviens bien, une banni√®re publicitaire sur Yandex nous a plong√©s.  Bien s√ªr, de telles choses sont inacceptables, car ce n'est pas seulement une perte de profits, mais aussi l'image de l'entreprise - en g√©n√©ral, nous avons compris que quelque chose devait √™tre chang√©.  Tout d'abord, il a √©t√© r√©alis√© que les solutions standard avec nos charges de travail (√† l'√©poque pas tr√®s grandes, mais toujours pas petites) ne fonctionneraient pas.  Nous avons ensuite eu environ 1000 visiteurs en ligne normalement, environ 2500 au plus fort, plus des plans de d√©veloppement x2 par an. <br><br>  Intensification imm√©diate en termes de mat√©riel: nous avons ajout√© 2 serveurs d'applications suppl√©mentaires et cr√©√© un cluster de 2 serveurs de bases de donn√©es.  Notre pile √† cette √©poque √©tait nginx, MySQL, PHP.  En parall√®le, nous avons essay√© d'optimiser la solution actuelle - nous avons cherch√© des goulots d'√©tranglement, essay√© de r√©√©crire tout ce qui √©tait possible.  Notre goulot d'√©tranglement √©tant la base, il a toujours √©t√© le premier √† ¬´mourir¬ª, nous avons d√©cid√© de le d√©charger au maximum.  Sphinx impl√©ment√© pour la recherche en plein texte et la sortie de tuiles de produits avec des facettes par les filtres s√©lectionn√©s et les caches connect√©s.  Et voila - ces charges qui se sont av√©r√©es fatales pour nous hier, nous avons commenc√© √† tenir avec facilit√©. <br><br>  Parall√®lement, un pilote a √©t√© lanc√© en parall√®le, dans le cadre duquel ils souhaitaient r√©aliser une mise √† jour technologique du site - un transfert vers une plateforme fondamentalement diff√©rente.  Il y avait beaucoup d'id√©es et d'id√©es - √† cette √©poque, la personnalisation de tout et de tout, des recommandations personnelles, des envois postaux, des remises et d'autres choses utiles gagnait en popularit√©, et nous voulions bien s√ªr √©galement utiliser tout cela.  Nous avons regard√© ce qui √©tait disponible sur le march√© √† partir de cela, eh bien, et avons achet√© la plate-forme la plus ch√®re sur le principe "Une fois de plus cher, puis plus cool."  La mise en ≈ìuvre a √©t√© planifi√©e avec l'aide d'un int√©grateur, et nous avions toujours le support et le d√©veloppement de l'ancienne IM conditionnelle jusqu'√† ce que la nouvelle soit mise en service sur la nouvelle plate-forme. <br><br>  Mais comme la vitesse de d√©veloppement fonctionnel du site actuel √©tait tr√®s √©lev√©e, nous avons d√©cid√© de commencer la mise en ≈ìuvre de la nouvelle plate-forme de commerce √©lectronique √† partir de la boutique en ligne plus petite et plus simple de l'√©poque de la cha√Æne de magasins Austin, qui √©tait √©galement desservie par l'√©quipe IT Sportmaster.  Au cours du processus, nous avons r√©alis√© que la chose √©tait lourde et fonctionnellement sophistiqu√©e, mais technologiquement obsol√®te, et trouver des personnes pour la mettre en ≈ìuvre pleinement s'est av√©r√© √™tre un √©norme probl√®me.  De plus, le dimensionnement effectu√© avant le d√©but du projet a r√©duit consid√©rablement les besoins en mat√©riel et le nombre de licences - la dur√©e de vie s'est av√©r√©e beaucoup plus cruelle.  En g√©n√©ral, nous avons compris une chose: nous ne ferons pas de Sportmaster dessus.  Et comme l'√©quipe de migration vers la plateforme √©tait d√©j√† en cours de recrutement, les gars ont d√©cid√© de commencer √† prototyper leur propre solution, en fonction des exigences fix√©es par l'entreprise pour la nouvelle plateforme. <br><br>  La pile technologique a √©t√© s√©lectionn√©e comme suit: Java, Spring, Tomcat, ElasticSearch, Hazelcast. <br><br>  Par cons√©quent, √† la fin de 2014, nous avions une nouvelle version de la messagerie instantan√©e pr√™te, enti√®rement auto-√©crite, vers laquelle nous sommes pass√©s avec succ√®s.  C'est la premi√®re version du site que vous voyez aujourd'hui.  Naturellement, la version actuelle est beaucoup plus fonctionnelle et technologique, mais la plate-forme de base est la m√™me. <br><br><h2>  T√¢ches principales </h2><br>  Bien s√ªr, lorsque nous parlons d'une grande boutique en ligne, nous parlons de la volont√© de faire face non seulement aux charges quotidiennes, mais √©galement aux pics de charge - pour √™tre stable pour les entreprises et les utilisateurs finaux. <br><br>  Les principales approches ici sont la capacit√© √† √©voluer horizontalement et l'application d'approches de mise en cache des donn√©es √† diff√©rents niveaux.  Et maintenant, comme il y a quelque temps, nous avons d√©cid√© d'optimiser l'acc√®s √† nos donn√©es.  Mais nous ne pouvons pas utiliser la mise en cache de page r√©guli√®re.  G√©n√©ralement.  Il s'agit d'une exigence commerciale et l'exigence est tout √† fait raisonnable - si vous montrez le mauvais prix ou la mauvaise disponibilit√© des marchandises √† un moment donn√© √† l'utilisateur du site, cela entra√Ænera tr√®s probablement un rejet de l'achat et une diminution de la fid√©lit√© des clients. <br><br>  Et ce n'est pas grave si le client a command√© 15 paires de chaussettes pour 299 roubles, et dans le magasin, il a d√©couvert qu'il n'y avait en fait que 14 paires et 300 roubles chacune - vous pouvez en quelque sorte vivre avec.  Acceptez, achetez ce qui est et vivez avec cette cicatrice dans votre √¢me.  Mais si les √©carts de chiffres sont s√©rieux, ou si vous recherchiez une taille sp√©cifique - et qu'elle a √©t√© achet√©e pendant que vous lisiez les avis des heureux propri√©taires de shorts √† carreaux, ici tout est d√©j√† plus triste.  C'est-√†-dire imm√©diatement la perte d'un client satisfait (jusqu'√† ce point) et la perte de temps et d'argent sur le travail du centre d'appels, o√π ce client appellera pour savoir ce qui s'est pass√© et pourquoi. <br><br>  Par cons√©quent, l'utilisateur doit toujours voir le dernier prix et les donn√©es les plus r√©centes sur les soldes des mati√®res premi√®res, et donc nos caches sont intelligents et savent quand les donn√©es de la base de donn√©es changent.  Pour la mise en cache, nous utilisons Hazelcast. <br><br><h2>  Au fait, √† propos des restes </h2><br>  Il est important de noter ici que la profondeur des r√©sidus de produits est tr√®s faible.  Et un tr√®s grand nombre de commandes sont prises en charge (tr√®s).  Par cons√©quent, le client doit normalement r√©server les marchandises dans le bon magasin et suivre les soldes.  √Ä une √©poque, sur Bitrix, le probl√®me des r√©sidus a √©t√© r√©solu par le fait qu'ils consid√©raient simplement les restes de plus de 10 unit√©s comme infinis.  Autrement dit, tout ce qui est sup√©rieur √† 10 est toujours √©gal √† 10, mais les valeurs inf√©rieures sont d√©j√† int√©ressantes pour nous √† calculer et nous les prenons en compte, les t√©l√©chargeons sur le site. <br><br>  Maintenant, il n'est plus possible de le faire, nous t√©l√©chargeons donc les restes de tous les magasins toutes les 15 minutes.  Et nous avons environ 500 magasins, plus un certain nombre d'entrep√¥ts r√©gionaux, ainsi que plusieurs cha√Ænes de magasins.  Et tout cela doit √™tre mis √† jour rapidement.  La cerise sur le g√¢teau est le fait que les conditions de travail des entreprises de messagerie changent tr√®s souvent √† l'√©chelle de la F√©d√©ration de Russie, par cons√©quent, les param√®tres de livraison doivent √©galement √™tre charg√©s.  En outre, un flux continu de marchandises est livr√© aux entrep√¥ts de l'entreprise, c'est pourquoi la quantit√© de marchandises dans les entrep√¥ts devrait changer.  Donc, il doit √©galement √™tre retir√© √† nouveau. <br><br>  Et voici comment les identifiants des articles de base (SKU) sont form√©s.  Nous avons environ 40 000 mod√®les de produits, appel√©s couleurs.  Si nous allons plus loin dans la taille des marchandises, nous obtenons environ 200 000 SKU.  Et pour tout cela, 200 000 doivent √™tre mis √† jour √† l'√©chelle de 500 magasins. <br><br>  Nous avons √©galement des dizaines de milliers de villes et villages dans lesquels nous livrons des marchandises dans des magasins ou des entrep√¥ts.  Par cons√©quent, il s'av√®re que la variabilit√© du cache pour une seule page de produit (ville * SKU) est un millioni√®me de valeur.  Notre approche est la suivante: le calcul de la disponibilit√© d'une unit√© de marchandise particuli√®re se fait √† la vol√©e lorsque l'utilisateur entre la carte du produit.  Nous regardons le travail des coursiers dans la r√©gion de l'utilisateur, nous regardons leur horaire de travail, nous calculons la cha√Æne de livraison et consid√©rons sa dur√©e.  Parall√®lement √† cela, les restes dans les magasins √† proximit√© sont analys√©s en parall√®le, √† partir desquels le transport peut √™tre organis√©. <br><br>  Pour faciliter la gestion de tout cela, nous avons un certain nombre de caches tr√®s rapides dans l'application - gr√¢ce √† cela, nous pouvons rapidement obtenir toutes les donn√©es n√©cessaires par ID et les trier √† la vol√©e.  La m√™me chose avec les courriers - nous les regroupons en clusters, puis les clusters sont d√©j√† enregistr√©s dans la base de donn√©es.  Toutes les 15 minutes, tout cela est mis √† jour, pour chaque demande entrante, nous calculons un certain groupe de courriers avec les param√®tres n√©cessaires, les agr√©gons et les remettons rapidement √† l'acheteur - tout va bien, nous avons d√©finitivement de tels shorts verts de taille 50, vous pouvez soit ramasser avec des stylos dans ces trois magasins √† proximit√© en ce moment, ou commander dans un magasin de l'autre c√¥t√© de la route (ou m√™me √† la maison) pendant 3 jours, choisissez. <br><br>  Pour Moscou, cette situation peut sembler inutile, mais pour les r√©gions, c'est une question compl√®tement diff√©rente, ils commandent tr√®s souvent des marchandises √† certains magasins (auxquels vous devez peut-√™tre √©galement vous rendre sp√©cialement). <br><br><h2>  Les chiffres </h2><br>  D√©sormais, le site re√ßoit des milliers de demandes par seconde, en tenant compte de la statique et de 500 √† 1 000 demandes par seconde aux serveurs d'applications.  Le nombre de serveurs d'applications n'a pas chang√©, mais leur configuration a consid√©rablement augment√©.  Une moyenne d'environ 3 000 000 de vues par jour est obtenue. <br><br>  Des DDoS se trouvent parfois sur le site.  En m√™me temps, ils frappent avec des botnets, d'ailleurs, nos proches de la F√©d√©ration de Russie.  Il y a longtemps, il y a eu des cas de tentatives de frapper des botnets du Mexique et de Ta√Øwan, mais maintenant ce n'est plus le cas. <br><br>  Il existe un certain nombre de solutions pour la protection du cloud contre les DDoS sur le march√©, oui, et assez bonnes.  Mais pour certaines politiques de s√©curit√©, nous ne pouvons pas utiliser ce type de solutions cloud. <br><br><h2>  Et maintenant </h2><br>  Nous commen√ßons √† faire une solution de plate-forme, en s√©parant les √©quipes non pas verticalement (certains d'entre eux ont vu un site, et le second en a vu un autre), mais horizontalement, mettant en √©vidence la couche de plate-forme commune, la divisant en parties, formant une √©quipe autour d'elle.  Et sur eux, nous fermons d√©j√† le site et pas seulement, y compris les clients de l'entreprise, √† la fois externes et internes.  Par cons√©quent, nous avons beaucoup de travail complexe et int√©ressant. <br><br>  La pile √† l'avant, pour des raisons √©videntes, n'a pas vraiment chang√© pendant cette p√©riode - Java, Spring, Tomcat, ElasticSearch, Hazelcast sont toujours bons pour nos besoins.  Une autre chose est que maintenant beaucoup de syst√®mes de back-office sur diverses technologies sont cach√©s derri√®re le site.  Et, bien s√ªr, la r√©ing√©nierie est en cours (car les demandes de syst√®mes internes et de travail avec eux dans leur ensemble doivent √™tre optimis√©es, sans oublier les exigences m√©tier et les nouvelles fonctions m√©tier). <br><br>  Et vous pouvez en toute s√©curit√© me faire part de vos suggestions personnelles (ou de commentaires) sur l'am√©lioration du site - √† la fois en termes de nouvelles fonctionnalit√©s, et du composant visuel et de l'exp√©rience utilisateur globale.  Nous allons essayer de r√©pondre rapidement et de tout prendre en compte.  Et si vous voulez faire partie de l'√©quipe et tout voir de l'int√©rieur - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bienvenue</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456926/">https://habr.com/ru/post/fr456926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456908/index.html">Comment Telegram vous fusionne avec Rostelecom</a></li>
<li><a href="../fr456910/index.html">Internet project security.txt - apprendre √† conna√Ætre un autre fichier bien connu</a></li>
<li><a href="../fr456912/index.html">Comment cr√©er des sites en 2019</a></li>
<li><a href="../fr456920/index.html">Sony Xperia 1 en Russie - prix et bonus de pr√©commande</a></li>
<li><a href="../fr456922/index.html">Comment les processeurs sont con√ßus et fabriqu√©s: les bases de l'architecture informatique</a></li>
<li><a href="../fr456928/index.html">JMeter - Swiss Tester Knife (Partie 1)</a></li>
<li><a href="../fr456930/index.html">Amener l'IoT √† la masse: r√©sultats du premier hackathon IoT de GeekBrains et Rostelecom</a></li>
<li><a href="../fr456932/index.html">OpenGL ultramoderne. Partie 1</a></li>
<li><a href="../fr456936/index.html">Cartes anim√©es sur SwiftUI</a></li>
<li><a href="../fr456938/index.html">Lancement d'une application de taxi-toiling √† Tokyo: comment Sony le fait-il avec S. Ride?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>