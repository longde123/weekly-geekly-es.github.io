<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüè≠ ü§æüèæ üëäüèΩ [Quel est le probl√®me avec GraphQL] ... Et comment y faire face ü§±üèæ üë®üèº üë®üèº‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans l' article pr√©c√©dent , nous avons examin√© les points incommodes du syst√®me de type GraphQL. 
 Et maintenant, nous allons essayer de vaincre certa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>[Quel est le probl√®me avec GraphQL] ... Et comment y faire face</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435690/"><p>  Dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> , nous avons examin√© les points incommodes du syst√®me de type GraphQL. <br>  Et maintenant, nous allons essayer de vaincre certains d'entre eux.  Tous int√©ress√©s, s'il vous pla√Æt, sous cat. </p><a name="habracut"></a><br><p>  La num√©rotation des partitions correspond aux probl√®mes auxquels j'ai r√©ussi √† faire face. </p><br><h3 id="12-non_null-input">  1.2 ENTR√âE NON_NULL </h3><br><p>  √Ä ce stade, nous avons examin√© l'ambigu√Øt√© qui g√©n√®re une fonctionnalit√© d'impl√©mentation nullable dans GraphQL. </p><br><p> Et le probl√®me est qu'il ne permet pas d'impl√©menter le concept de mise √† jour partielle √† partir de z√©ro - un analogue de la m√©thode HTTP <code>PATCH</code> dans l'architecture REST.  Dans les commentaires sur le mat√©riel pass√©, j'ai √©t√© fortement critiqu√© pour la pens√©e "REST".  Je peux seulement dire que l'architecture CRUD m'y oblige.  Et je n'√©tais pas pr√™t √† renoncer aux avantages de REST, simplement parce que ¬´ne fais pas √ßa¬ª.  Oui, et une solution √† ce probl√®me a √©t√© trouv√©e. </p><br><p>  Et donc, revenons au probl√®me.  Comme nous le savons tous, le script CRUD lors de la mise √† jour de l'enregistrement ressemble √† ceci: </p><br><ol><li>  J'ai un disque √† l'arri√®re. </li><li>  Champs d'enregistrement modifi√©s. </li><li>  Envoy√© un dossier √† l'arri√®re. </li></ol><br><p>  Le concept de mise √† jour partielle, dans ce cas, devrait nous permettre de renvoyer uniquement les champs qui ont √©t√© modifi√©s. <br>  Donc, si nous d√©finissons un mod√®le d'entr√©e de cette fa√ßon </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">input</span></span> ExampleInput { foo: String! bar: <span class="hljs-attribute"><span class="hljs-attribute">String</span></span> }</code> </pre> <br><p>  puis lors du mappage d'une variable de type <code>ExampleInput</code> avec cette valeur </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"foo"</span></span>: <span class="hljs-string"><span class="hljs-string">"bla-bla-bla"</span></span> }</code> </pre> <br><p>  sur un DTO avec cette structure: </p><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">ExampleDTO</span></span> { foo: <span class="hljs-attribute"><span class="hljs-attribute">String</span></span> <span class="hljs-comment"><span class="hljs-comment">#   bar: ?String #   }</span></span></code> </pre> <br><p>  nous obtenons un objet DTO avec cette valeur: </p><br><pre> <code class="plaintext hljs">{ foo: "bla-bla-bla", bar: null }</code> </pre> <br><p>  et lors du mappage d'une variable avec cette valeur </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"foo"</span></span>: <span class="hljs-string"><span class="hljs-string">"bla-bla-bla"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bar"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre> <br><p>  on obtient un objet DTO avec la m√™me valeur que la derni√®re fois: </p><br><pre> <code class="plaintext hljs">{ foo: "bla-bla-bla", bar: null }</code> </pre> <br><p>  C'est-√†-dire que l'entropie se produit - nous perdons des informations sur la transmission ou non du champ par le client. <br>  Dans ce cas, il n'est pas clair ce qui doit √™tre fait avec le champ de l'objet final: ne le touchez pas parce que le client n'a pas pass√© le champ, ou ne le d√©finissez pas parce que le client a pass√© <code>null</code> . </p><br><p>  √Ä strictement parler, GraphQL est un protocole RPC.  Et j'ai commenc√© √† r√©fl√©chir √† la fa√ßon dont je fais ces choses dans le dos et aux proc√©dures √† suivre pour faire exactement ce que je veux.  Et sur le backend, je fais une mise √† jour partielle des champs comme celui-ci: </p><br><pre> <code class="php hljs">$repository-&gt;find(<span class="hljs-number"><span class="hljs-number">42</span></span>)-&gt;setFoo(<span class="hljs-string"><span class="hljs-string">'bla-bla-lba'</span></span>);</code> </pre> <br><p>  C'est-√†-dire que je ne touche litt√©ralement pas √† l'auteur d'une propri√©t√© d'entit√©, sauf si je dois changer la valeur de cette propri√©t√©.  Si vous le d√©placez vers le sch√©ma GraphQL, vous obtenez le r√©sultat suivant: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Mutation { entityRepository: EntityManager! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> EntityManager { update(id: ID!): <span class="hljs-attribute"><span class="hljs-attribute">PersitedEntity</span></span> } type PersitedEntity { setFoo(foo: String!): String! setBar(foo: String): <span class="hljs-attribute"><span class="hljs-attribute">String</span></span> }</code> </pre> <br><p>  Maintenant, si nous voulons, nous pouvons appeler la m√©thode <code>setBar</code> et d√©finir sa valeur sur null, ou ne pas toucher √† cette m√©thode, puis la valeur ne sera pas modifi√©e.  Ainsi, une belle impl√©mentation de <code>partial update</code> sort.  Pas pire que <code>PATCH</code> du fameux REST. </p><br><blockquote>  Dans les commentaires sur le mat√©riel pass√©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Summerwind a</a> demand√©: pourquoi avons-nous besoin d'une <code>partial update</code> ?  Je r√©ponds: il y a de TR√àS grands champs. </blockquote><br><h1 id="3-polimorfizm">  3. Polymorphisme </h1><br><p>  Il arrive souvent que vous deviez vous soumettre aux entit√©s d'entr√©e qui sont en quelque sorte "une seule et m√™me chose" mais pas tout √† fait.  J'utiliserai l'exemple de cr√©ation d'un compte √† partir de documents ant√©rieurs. </p><br><pre> <code class="lua hljs">#   AccountInput { login: <span class="hljs-string"><span class="hljs-string">"Acme"</span></span>, password: <span class="hljs-string"><span class="hljs-string">"***"</span></span>, subject: OrganiationInput { title: <span class="hljs-string"><span class="hljs-string">"Acme Inc"</span></span> } }</code> </pre> <br><pre> <code class="lua hljs">#    AccountInput { login: <span class="hljs-string"><span class="hljs-string">"Acme"</span></span>, password: <span class="hljs-string"><span class="hljs-string">"***"</span></span>, subject: PersonInput { firstName: <span class="hljs-string"><span class="hljs-string">"Vasya"</span></span>, lastName: <span class="hljs-string"><span class="hljs-string">"Pupkin"</span></span>, } }</code> </pre> <br><p>  De toute √©vidence, nous ne pouvons pas soumettre des donn√©es avec une telle structure pour un argument - GraphQL ne nous permettra tout simplement pas de le faire.  Donc, vous devez en quelque sorte r√©soudre ce probl√®me. </p><br><p>  <strong>M√©thode 0 - front</strong> </p><br><p>  La premi√®re chose qui me vient √† l'esprit est la s√©paration de la partie variable de l'entr√©e: </p><br><pre> <code class="plaintext hljs">input AccountInput { login: String! password: Password! subjectOrganization: OrganiationInput subjectPerson: PersonInput }</code> </pre> <br><p>  Hmm ... quand je vois un tel code, je me souviens souvent de Jos√©phine Pavlovna.  √áa ne me convient pas. </p><br><p>  <strong>M√©thode 1 - pas sur le front, mais sur le front</strong> <br>  Ensuite, le fait m'est venu √† l'esprit que pour identifier les entit√©s, j'utilise J'utilise UUID (je le recommande g√©n√©ralement √† tout le monde - cela aidera plus d'une fois).  Et cela signifie que je peux cr√©er des entit√©s valides directement sur le client, les lier ensemble par identifiant et les envoyer au back-end, s√©par√©ment. </p><br><p>  Ensuite, nous pouvons faire quelque chose dans l'esprit de: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">input</span></span> AccountInput { login: String! password: Password! subject: SubjectSelectInput! } <span class="hljs-attribute"><span class="hljs-attribute">input</span></span> SubjectSelectInput { id: ID! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Mutation { createAccount( organization: OrganizationInput, person: PersonInput, account: AccountInput! ): Account! }</code> </pre> <br><p>  ou, ce qui s'est av√©r√© encore plus pratique (pourquoi c'est plus pratique, je vous dirai quand nous arriverons √† la g√©n√©ration des interfaces utilisateurs), divisez-le en diff√©rentes m√©thodes: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Mutation { createAccount(account: AccountInput!): Account! createOrganization(organization: OrganizationInput!): Organization! createPerson(person: PersonInput!) : Person! }</code> </pre> <br><p>  Ensuite, nous devrons envoyer une demande pour createAccount et createOrganization / createPerson <br>  un lot.  Il convient de noter que le traitement du lot doit alors √™tre encapsul√© dans une transaction. </p><br><p>  <strong>M√©thode 2 - Le scalaire magique</strong> <br>  L'astuce est que le scalaire dans GraphQL n'est pas seulement <code>Int</code> , <code>Sting</code> , <code>Float</code> , etc.  C'est g√©n√©ralement n'importe quoi (enfin, alors que JSON peut g√©rer cela, bien s√ªr). <br>  Ensuite, nous pouvons simplement d√©clarer un scalaire: </p><br><pre> <code class="plaintext hljs">scalar SubjectInput</code> </pre> <br><p>  Ensuite, √©crivez votre gestionnaire dessus, et ce n'est pas cuit √† la vapeur.  Ensuite, nous pouvons facilement glisser des champs variables √† l'entr√©e. </p><br><p>  Quelle fa√ßon choisir?  J'utilise les deux et j'ai d√©velopp√© une r√®gle pour moi: <br>  Si l'entit√© parent est une racine agr√©g√©e pour l'enfant, je choisis la deuxi√®me m√©thode, sinon la premi√®re. </p><br><h2 id="4-dzheneriki">  4. G√©n√©riques. </h2><br><p>  Tout est trivial ici et je n'ai rien trouv√© de mieux que la g√©n√©ration de code.  Et sans Rails (paquet railt / sdl) je n'aurais pas pu (ou plut√¥t, j'aurais fait la m√™me chose avec des b√©quilles).  L'astuce est que Rail vous permet de d√©finir des directives au niveau du document (il n'y a pas une telle position pour les directives dans la feuille de sp√©cifications). </p><br><pre> <code class="plaintext hljs">directive @example on DOCUMENT</code> </pre> <br><p>  Autrement dit, les directives ne sont attach√©es √† rien d'autre que le document dans lequel elles sont appel√©es. </p><br><p>  J'ai pr√©sent√© les directives suivantes: </p><br><pre> <code class="plaintext hljs">directive @defineMacro(name: String!, template: String!) on DOCUMENT directive @macro(name: String!, arguments: [String]) on DOCUMENT</code> </pre> <br><p>  Je pense que personne n'a besoin d'expliquer l'essence des macros ... </p><br><p>  C'est tout pour l'instant.  Je ne pense pas que ce mat√©riau causera autant de bruit que par le pass√©.  Tout de m√™me, le titre y √©tait assez "jaune") </p><br><p>  Dans les commentaires de l'article pr√©c√©dent, les habitants de Khabrovsk se sont noy√©s pour avoir partag√© l'acc√®s ... donc le prochain article portera sur l'autorisation. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435690/">https://habr.com/ru/post/fr435690/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435680/index.html">AWS a montr√© le doigt du milieu open source</a></li>
<li><a href="../fr435682/index.html">Critique de l'imprimante de caf√© Cafe Maker</a></li>
<li><a href="../fr435684/index.html">Oak Ridge National Laboratory a r√©solu le principal probl√®me des d√©veloppeurs d'appareils spatiaux: la carence en plutonium 238</a></li>
<li><a href="../fr435686/index.html">Pavel Durov liquide Telegram Messenger LLP</a></li>
<li><a href="../fr435688/index.html">Exemple d'application Flutter Client Server</a></li>
<li><a href="../fr435692/index.html">Y Combinator: ¬´Au d√©but, certaines des plus grandes entreprises technologiques ressemblent √† des jouets¬ª</a></li>
<li><a href="../fr435694/index.html">Comment et pourquoi nous avons optimis√© l'algorithme de nettoyage des caches SLAB dans le noyau Linux</a></li>
<li><a href="../fr435696/index.html">Antiquit√©s: publicit√© informatique 1997</a></li>
<li><a href="../fr435698/index.html">√âcrire votre propre bon gestionnaire de m√©moire</a></li>
<li><a href="../fr435700/index.html">Questions d'entretiens chez 8 Worst Vue.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>