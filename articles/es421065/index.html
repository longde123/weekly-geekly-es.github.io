<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜ üßõüèª üßö C√≥mo le ense√±√© a la IA a jugar Tetris para NES. Parte 2: AI üö∫ üçû üê∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La primera parte (an√°lisis de c√≥digo) est√° aqu√≠: https://habr.com/post/420725/ . 

 Algoritmo 
 Descripci√≥n 
 El algoritmo realiza continuamente los s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo le ense√±√© a la IA a jugar Tetris para NES. Parte 2: AI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421065/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/2c5/a7e/cfd2c5a7e44131bfc188c3eea6ad5139.png" alt="imagen"></div><br>  La primera parte (an√°lisis de c√≥digo) est√° aqu√≠: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://habr.com/post/420725/</a> . <br><br><h2>  Algoritmo </h2><br><h3>  Descripci√≥n </h3><br>  El algoritmo realiza continuamente los siguientes pasos: <br><br><ol><li>  √âl espera hasta que se cree un nuevo tetrimino. </li><li>  Comprueba el tipo del tetrimino reci√©n creado, el tipo del siguiente tetrimino (figura en el campo de vista previa) y el contenido del campo de juego. </li><li>  Explora todas las formas posibles de agregar dos tetriminos al campo de juego y eval√∫a cada probabilidad. </li><li>  Mueve el tetrimino reci√©n creado para que coincida con la ubicaci√≥n de la mejor probabilidad detectada. </li></ol><br>  Cada uno de estos pasos se describe en detalle a continuaci√≥n. <br><br><h3>  Bloquear b√∫squeda </h3><br>  Considere una versi√≥n simplificada de Tetris, en la que las formas no caen autom√°ticamente.  La √∫nica forma de bajar la figura es bajando suavemente.  Una vez eliminados los tiempos del juego, podemos describir completamente el estado del tetrimino activo por su posici√≥n y orientaci√≥n.  La figura tiene un lugar conocido de creaci√≥n inicial, y las siguientes operaciones se utilizan para convertir de un estado a otro: <br><br><ul><li>  Un paso abajo </li><li>  Un paso a la izquierda </li><li>  Mueve un paso hacia la derecha </li><li>  Gire un paso en sentido antihorario </li><li>  Rotaci√≥n en sentido horario </li></ul><a name="habracut"></a><br>  Estas operaciones son aplicables solo cuando los cuadrados del tetrimino resultante corresponden a celdas vac√≠as del campo de juego.  Cuando es imposible avanzar un paso hacia abajo, el estado se considera bloqueado.  Sin embargo, dado que simplificamos Tetris y la espera para el bloqueo es esencialmente infinita, el estado bloqueado puede transformarse a√∫n m√°s mediante otras operaciones mediante el deslizamiento y el desplazamiento. <br><br>  Se pueden encontrar muchos estados bloqueados con una secuencia m√≠nima de operaciones que los crean mediante la b√∫squeda de amplitud primero (BFS).  Como se indica a continuaci√≥n, utiliza una cola para almacenar resultados intermedios. <br><br><ol><li>  Hacemos cola en el estado en la creaci√≥n. </li><li>  Deducimos el estado de la cola. </li><li>  Obtenemos los siguientes estados utilizando la operaci√≥n de conversi√≥n. </li><li>  Si no hay movimiento hacia abajo entre ellos, entonces el estado que se elimina de la cola se bloquea. </li><li>  Hacemos cola en estados posteriores que a√∫n no hemos visitado. </li><li>  Si la cola no est√° vac√≠a, repita desde el paso 2. </li></ol><br>  El programa representa cada estado como un objeto con los siguientes campos: <br><br> <code>{ x, y, rotation, visited, predecessor }</code> <br> <br>  En el proceso de preparaci√≥n, el programa crea una matriz tridimensional de objetos de estado (20 filas √ó 10 columnas √ó 4 vueltas), inicializando <code>x</code> , <code>y</code> <code>rotation</code> consecuencia. <br><br>  El campo <code>visited</code> se marca cuando el estado est√° en cola.  En BFS, esto es v√°lido porque cada estado posterior aumenta la longitud total de la ruta en 1. Es decir, al aumentar la longitud de la ruta es imposible crear un estado posterior que deba insertarse en otro lugar que no sea el final de la cola para mantener el orden. <br><br>  El campo <code>predecessor</code> indica el objeto de estado del que se deriva el estado actual.  Se establece cuando el estado est√° en cola.  El estado de creaci√≥n no tiene estados anteriores. <br><br>  El conjunto de estados bloqueados detectados durante la b√∫squeda est√° determinado por el tipo de tetrimino y los bloques llenos en el campo de juego.  La secuencia de los movimientos que los generaron se puede aclarar (en el orden inverso) siguiendo los enlaces anteriores al estado de creaci√≥n.  Cuando la constante <code>PLAY_FAST</code> se establece en <code>true</code> al comienzo del programa, omite por completo los estados anteriores al colocar directamente tetrimino en el campo y bloquearlo. <br><br>  Una matriz tridimensional de objetos de estado, una cola y BFS se empaquetan en una clase.  Tiene un m√©todo de b√∫squeda que recibe el campo de juego (matriz bidimensional), el tipo de tetrimino y el oyente.  Cada vez que se detecta un estado bloqueado, el campo de juego se actualiza agregando tetrimino a la ubicaci√≥n adecuada.  Luego, el campo de juego modificado junto con la informaci√≥n sobre los cambios se transmite al oyente para su procesamiento.  Despu√©s de que el oyente completa el retorno, se restaura el campo de juego. <br><br>  El oyente se usa para combinar varias operaciones de b√∫squeda en una cadena, lo que permite encontrar todas las formas posibles de agregar dos (o m√°s) tetriminos al campo de juego.  El primer motor de b√∫squeda de la cadena ejecuta BFS solo una vez.  Sin embargo, el segundo motor de b√∫squeda ejecuta BFS cada vez que la primera b√∫squeda detecta un estado bloqueado.  Y as√≠ sucesivamente, si hay otros motores de b√∫squeda en la cadena. <br><br>  El oyente del √∫ltimo motor de b√∫squeda eval√∫a el campo de juego modificado.  Cuando encuentra el campo de juego mejor de lo que se ha investigado anteriormente, escribe el objeto usado del estado bloqueado, que en este momento utiliza el primer motor de b√∫squeda de la cadena.  Dado que el primer motor de b√∫squeda ejecuta BFS solo una vez, los campos <code>predecessor</code> de sus objetos de estado siguen siendo v√°lidos hasta la finalizaci√≥n de todo el proceso de b√∫squeda.  Es decir, el √∫ltimo oyente esencialmente graba el camino a lo largo del cual debe ir el primer tetrimino para llegar a la mejor configuraci√≥n del campo de juego como resultado. <br><br><h3>  Funci√≥n de evaluaci√≥n </h3><br>  La funci√≥n de puntuaci√≥n asigna un valor al campo de juego modificado: una suma ponderada de varios par√°metros de influencia.  La funci√≥n de evaluaci√≥n utilizada en este caso se basa en la funci√≥n desarrollada por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Islam Al-Ashi</a> .  Utiliza los siguientes par√°metros: <br><br><ul><li>  <b>N√∫mero total de filas borradas</b> : este es el n√∫mero total de filas que se borrar√°n mediante la adici√≥n de dos tetriminos. </li><li>  <b>Altura total de bloqueo</b> : la <b>altura de bloqueo</b> es la altura sobre el piso del campo de juego en el que la figura est√° bloqueada.  Esta es la distancia vertical que caer√≠a una figura bloqueada si elimina todos los otros cuadrados ocupados del campo de juego y mantiene la orientaci√≥n de la figura.  La altura total de bloqueo es la suma de las alturas de bloqueo de los dos tetriminos. </li><li>  <b>El n√∫mero total de celdas de ‚Äúpozo‚Äù</b> : una celda de pozo es una celda vac√≠a ubicada sobre todas las celdas ocupadas en una columna, de modo que sus vecinos izquierdo y derecho son celdas ocupadas;  Al determinar los pozos, las paredes del campo de juego se consideran celdas ocupadas.  La idea es que un pozo es una estructura abierta en la parte superior, cerrada en la parte inferior y rodeada de paredes a ambos lados.  La probabilidad de espacios intermitentes en las paredes del pozo significa que las c√©lulas del pozo no necesariamente ocurren en un mont√≥n continuo dentro de una columna. </li><li>  <b>N√∫mero total de agujeros en las columnas</b> : el agujero en la columna es una celda vac√≠a ubicada inmediatamente debajo de la celda ocupada.  El g√©nero del campo de juego no se compara con la celda superior.  No hay agujeros en las columnas vac√≠as. </li><li>  <b>N√∫mero total de transiciones en columnas</b> : una transici√≥n en columnas es una celda vac√≠a adyacente a una celda ocupada (o viceversa) dentro de una sola columna.  La combinaci√≥n del bloque de columnas ocupado m√°s alto con un espacio vac√≠o encima no se considera una transici√≥n.  Del mismo modo, el piso del campo de juego tampoco se compara con la celda que est√° sobre √©l.  Por lo tanto, no hay transiciones en una columna completamente vac√≠a. </li><li>  <b>N√∫mero total de transiciones en filas</b> : una transici√≥n en filas es una celda vac√≠a adyacente a una celda ocupada (o viceversa) dentro de la misma fila.  Las celdas vac√≠as cerca de las paredes del campo de juego se consideran transiciones.  La cantidad total se calcula para todas las l√≠neas del campo de juego.  Sin embargo, las l√≠neas completamente vac√≠as no se tienen en cuenta en el n√∫mero total de transiciones. </li></ul><br>  El-Ashi sugiri√≥ que se pueden encontrar pesos √∫tiles utilizando el algoritmo de optimizaci√≥n de enjambre de part√≠culas (PSO), que mejora iterativamente el conjunto de soluciones al simular el comportamiento del enjambre observado en la naturaleza.  En nuestro caso, cada soluci√≥n es un vector de peso, y la aptitud de la opci√≥n est√° determinada por el juego en Tetris;  Este es el n√∫mero total de tetriminos durante el cual sobrevivi√≥ hasta el final del juego. <br><br>  Estas ideas se aplican en la versi√≥n de Java que se describe a continuaci√≥n;  se ejecuta fuera de FCEUX y se puede configurar para un juego no gr√°fico en memoria que se ejecuta a una velocidad mucho mayor.  Despu√©s de preparar el PSO, me sorprendi√≥ ver que el algoritmo no avanza m√°s despu√©s de la iteraci√≥n inicial.  Despu√©s de esta iteraci√≥n, varias variantes de soluciones generadas aleatoriamente ya jugaron bastante bien.  Durante varios d√≠as, el tama√±o de este conjunto disminuy√≥ hasta que solo qued√≥ una opci√≥n.  Aqu√≠ est√°n los valores para esta soluci√≥n: <br><br><table><tbody><tr><th>  Par√°metro </th><th>  Peso </th></tr><tr><td>  N√∫mero total de filas despejadas </td><td> <code>1.000000000000000</code> </td> </tr><tr><td>  Altura total de bloqueo </td><td> <code>12.885008263218383</code> </td> </tr><tr><td>  N√∫mero total de c√©lulas de pozo </td><td> <code>15.842707182438396</code> </td> </tr><tr><td>  El n√∫mero total de agujeros en las columnas. </td><td> <code>26.894496507795950</code> </td> </tr><tr><td>  El n√∫mero total de transiciones en columnas. </td><td> <code>27.616914062397015</code> </td> </tr><tr><td>  Saltos de l√≠nea totales </td><td> <code>30.185110719279040</code> </td> </tr></tbody></table><br>  El campo de juego se estim√≥ multiplicando los par√°metros por sus respectivos pesos y sumando los resultados.  Cuanto menor sea el valor, mejor ser√° la soluci√≥n.  Como todos los par√°metros y pesos tienen valores positivos, todos los par√°metros perjudican la evaluaci√≥n general;  cada uno de ellos debe ser minimizado.  Tambi√©n significa que la mejor puntuaci√≥n es 0. <br><br>  Dado que estos pesos se seleccionaron aleatoriamente, el rango de valores adecuados puede ser muy amplio.  Este conjunto particular de n√∫meros y la importancia relativa estimada de cada par√°metro pueden no ser relevantes.  Sin embargo, ser√° interesante observarlos de cerca. <br><br>  El par√°metro menos da√±ino es el n√∫mero total de filas borradas.  El hecho de que esta opci√≥n sea perjudicial es contraintuitivo.  Pero el objetivo principal de la IA es la supervivencia.  No se esfuerza por la mayor√≠a de los puntos.  En cambio, juega de forma conservadora, generalmente limpiando las filas de una en una.  Para obtener Doble, Triple o Tetris, debes hacer crecer un mont√≥n que vaya en contra del objetivo a largo plazo. <br><br>  El siguiente en la lista es la altura total de bloqueo.  Se puede minimizar bajando el tetrimino lo m√°s cerca posible del piso.  Esta es una estrategia simple que contribuye a largo plazo a la supervivencia y, a corto plazo, al embalaje de calidad de las piezas. <br><br>  El peso asignado al n√∫mero total de celdas de pozos parece un poco sorprendente, porque los jugadores experimentados generalmente construyen pozos profundos intencionalmente para recolectar varios Tetris (combinaciones de cuatro l√≠neas) en una fila.  Pero como se mencion√≥ anteriormente, este es un juego arriesgado, contrario al objetivo principal: la supervivencia.  Adem√°s, el n√∫mero de pozos es un indicador de la "rugosidad" de la pila.  Un cierto nivel de desigualdad es beneficioso al colocar ciertas figuras o combinaciones de figuras.  Pero la alta rugosidad provoca da√±os en el embalaje herm√©tico. <br><br>  El n√∫mero total de agujeros en las columnas es aproximadamente la mitad del n√∫mero total de transiciones en las columnas.  Estos par√°metros se pueden combinar y colapsar en un par√°metro relacionado com√∫n, obteniendo un par√°metro m√°s extenso y m√°s da√±ino: el n√∫mero total de transiciones. <br><br>  Las √°reas densamente pobladas tienen un peque√±o n√∫mero de transiciones en todas las direcciones.  Por lo tanto, la estrategia principal, impulsada por la inteligencia artificial, se puede describir brevemente de la siguiente manera: empacar las piezas lo m√°s cerca posible entre s√≠. <br><br><h3>  Otras opciones </h3><br>  Aqu√≠ hay una lista de algunos par√°metros m√°s con los que experiment√© durante el desarrollo de la IA: <br><br><ul><li>  <b>Altura del mont√≥n</b> : los bloques ocupados pueden colgar sobre celdas vac√≠as, creando protuberancias y agujeros;  sin embargo, no es posible bloquear bloques ocupados sobre l√≠neas completamente vac√≠as.  Por lo tanto, la altura del mont√≥n es el n√∫mero de filas que contienen al menos un bloque ocupado. </li><li>  <b>N√∫mero total de columnas ocupadas</b> : es el n√∫mero de columnas que contienen al menos una celda ocupada. </li><li>  <b>N√∫mero total de celdas ocupadas</b> : el n√∫mero de celdas ocupadas en el campo de juego. </li><li>  <b>N√∫mero total de √°reas conectadas</b> : el algoritmo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">relleno</a> se usa aqu√≠ para calcular el n√∫mero de √°reas conectadas continuamente.  Adem√°s de encontrar "islas" ocupadas, descubre agujeros que se extienden a lo largo de ambos ejes. </li><li>  <b>Dispersi√≥n de altura de columna</b> : esta es una medida estad√≠stica de la variaci√≥n en las alturas de columna.  Es un indicador de rugosidad de la superficie. </li><li>  <b>Valor de adaptaci√≥n total</b> : calcula el valor de adaptaci√≥n del mont√≥n para la siguiente figura desconocida.  Cuenta el n√∫mero total de formas en que se pueden agregar 7 tipos de formas al campo de juego sin la aparici√≥n de nuevos agujeros.  Para un conteo preciso, se requerir√° el uso repetido de BFS.  Pero para un c√°lculo aproximado, el √°rbol de b√∫squeda se puede truncar mucho. </li><li>  <b>Calificaci√≥n promedio para la siguiente figura</b> : este par√°metro profundiza la b√∫squeda al analizar todas las posibilidades para la siguiente figura desconocida.  Utiliza otros par√°metros para separar la ubicaci√≥n de cada tipo de figura, y luego devuelve el promedio de 7 calificaciones.  Para cada ubicaci√≥n de la figura, se requiere BFS. </li><li>  <b>Juego simulado promedio</b> : el par√°metro simula una serie de juegos en Tetris, seleccionando piezas usando su propio generador de n√∫meros pseudoaleatorios y usando AI para trabajar con ellos.  Al final de cada juego, el campo de juego se eval√∫a utilizando otros par√°metros.  Se devuelve el valor promedio para todos los lotes. </li></ul><br>  Todos los par√°metros se pueden personalizar agregando factores personalizados.  Por ejemplo, en lugar de simplemente calcular las filas borradas, puede asignar sus propios pesos para Single, Double, Triple y Tetris, simulando un sistema de puntos.  Si la limpieza simult√°nea de varias filas perjudica el objetivo a largo plazo de la supervivencia, a las filas individuales se les puede asignar un peso negativo, mientras que otras pueden ser positivas. <br><br>  Otro factor √∫til es el valor de compensaci√≥n.  Por ejemplo, una superficie perfectamente plana de un mont√≥n tiene una dispersi√≥n de alturas de columna de 0. Pero una superficie perfectamente plana no se adapta a S y Z, as√≠ como a otras combinaciones de formas.  Por lo tanto, al restar la constante, la varianza debe centrarse alrededor de la rugosidad √≥ptima. <br><br>  Los par√°metros ajustados y sesgados se pueden elevar hasta cierto punto para que antes de calcular la suma ponderada puedan escalar logar√≠tmicamente o exponencialmente.  Todas estas probabilidades pueden considerarse como pesos adicionales que pueden optimizarse potencialmente por m√©todos como PSO. <br><br>  Muchos de los par√°metros dan una idea de qu√© tan bien el mont√≥n puede manejar piezas adicionales, por ejemplo, aquellas que se ocupan de la rugosidad de la superficie, pero la "Cantidad total de adaptaci√≥n", "Calificaci√≥n promedio de la siguiente figura" y "Juego simulado promedio" eval√∫an el campo de juego modificado insertando figuras que no est√°n incluidas en las dos conocidas.  En el estudio de figuras posteriores, debido a la r√°pida eliminaci√≥n de la serie, la cantidad de conocimiento adicional obtenido disminuye con la profundidad.  Esto significa que el curso pasado de la fiesta no es tan importante, y el curso de la fiesta en el futuro distante tampoco es muy importante.  De hecho, si una secuencia corta de figuras se establece aleatoriamente de forma incorrecta, entonces la IA restaura r√°pidamente el juego, usando las siguientes figuras para borrar las filas afectadas.  La determinaci√≥n del valor √≥ptimo para el an√°lisis de las cifras posteriores requiere m√°s investigaci√≥n. <br><br>  Otro aspecto de la utilidad de un par√°metro es el costo computacional.  Los costos aumentan enormemente porque se llama a la funci√≥n de evaluaci√≥n para cada posible colocaci√≥n de dos figuras.  Dado que la IA debe poder jugar Tetris en tiempo real, los factores de costo que proporcionan informaci√≥n valiosa se pueden intercambiar por t√©cnicas m√°s aproximadas que se ejecutan m√°s r√°pido. <br><br><h3>  Entrenamiento de IA </h3><br>  Hay secuencias patol√≥gicas que pueden conducir a Game Over, independientemente de la estrategia.  El ejemplo m√°s simple es la secuencia interminable de tetrimino S y Z, que, como se muestra en la animaci√≥n, r√°pidamente lleva a la IA a perder. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb2/66a/2ba/cb266a2ba3575a43876e33f6a2948737.gif"></div><br>  Dado que lleva d√≠as ejecutar la variante AI antes de completar varios lotes y calcular el promedio, no es pr√°ctico usar la duraci√≥n promedio del lote como una m√©trica de control de PSO.  En cambio, puede aumentar la complejidad del juego con una velocidad controlada al aumentar la frecuencia de S y Z, lo que con el tiempo conducir√° a la creaci√≥n alternativa de solo este par de figuras. <br><br>  Intent√© usar este m√©todo de ense√±anza, pero descubr√≠ que ense√±ar IA para trabajar con S y Z frecuentes en realidad da√±a la capacidad de hacer frente a formas aleatorias distribuidas uniformemente. <br><br>  En un m√©todo alternativo inspirado en el juego B-Type, la m√©trica de PSO controla la frecuencia de la limpieza de filas.  El campo de juego es un diagrama de 10 l√≠neas de bloques de basura aleatorios, y cada vez que se borra la l√≠nea, aparece una nueva l√≠nea de basura debajo, restaurando la altura del mont√≥n.  Dado que el campo de juego tiene un ancho de 10 columnas, y cada tetrimino consta de 4 cuadrados, en promedio, la IA debe despejar una fila cada 2.5 tetrimino.  Y para deshacerse de la basura, debe hacerlo a√∫n m√°s r√°pido. <br><br>  Desafortunadamente, esta t√©cnica tampoco mejor√≥ el rendimiento.  Una raz√≥n probable es que los agujeros de basura aleatorios no coinciden exactamente con las cadenas con las que la IA trata en el juego real.  Adem√°s, limpiar la fila es un objetivo a corto plazo;  la limpieza de hileras codiciosas no necesariamente mejora la supervivencia a largo plazo.  De vez en cuando, no se deben tocar las filas para procesar ciertas combinaciones de figuras posteriores. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Colin Fei</a> sugiri√≥ un enfoque diferente en su p√°gina web.  Cre√≥ histogramas que muestran el porcentaje de formas que est√°n bloqueadas en cada fila durante los lotes de prueba.  Curiosamente, todos los histogramas se ven casi id√©nticos independientemente del n√∫mero de figuras creadas.  En base a esto, sugiri√≥ que puede usar una imagen aproximada de la funci√≥n para cualquier lote de prueba al evaluar la expectativa estad√≠stica de bloquear una figura en la l√≠nea de creaci√≥n, obteniendo as√≠ el tiempo durante el cual la IA jugar√° hasta el final del juego.  Decid√≠ explorar esta posibilidad. <br><br>  A continuaci√≥n se muestra un mapa de calor de muchos lotes de prueba, en total que contienen 2,039,900,000 tetrimino.  Cada celda se colorea seg√∫n el porcentaje de formas encerradas en ella.  Para mejorar el contraste visual, se selecciona una paleta no lineal.  El mapa fue creado al normalizar los valores de las celdas dividi√©ndolos entre el porcentaje m√°ximo de celdas y luego anunciando a la potencia de 0.19 (ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"correcci√≥n gamma"</a> ). <br><br><table><tbody><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d13/bcd/196/d13bcd1968b1f71c3311f7007c6f573e.png"></div></td><td><table><tbody><tr><th>  Color </th><th>  Porcentaje </th></tr><tr><td>  <font color="#000000">‚ñ†</font> </td><td> <code>0.00000000</code> </td> </tr><tr><td>  <font color="#0066FF">‚ñ†</font> </td><td> <code>0.00000315</code> </td> </tr><tr><td>  <font color="#00CCFF">‚ñ†</font> </td><td> <code>0.00024227</code> </td> </tr><tr><td>  <font color="#00FFCC">‚ñ†</font> </td><td> <code>0.00307038</code> </td> </tr><tr><td>  <font color="#00FF66">‚ñ†</font> </td><td> <code>0.01860818</code> </td> </tr><tr><td>  <font color="#00FF00">‚ñ†</font> </td><td> <code>0.07527774</code> </td> </tr><tr><td>  <font color="#66FF00">‚ñ†</font> </td><td> <code>0.23582574</code> </td> </tr><tr><td>  <font color="#CCFF00">‚ñ†</font> </td><td> <code>0.61928352</code> </td> </tr><tr><td>  <font color="#FFCC00">‚ñ†</font> </td><td> <code>1.42923040</code> </td> </tr><tr><td>  <font color="#FF6600">‚ñ†</font> </td><td> <code>2.98867416</code> </td> </tr><tr><td>  <font color="#FF0000">‚ñ†</font> </td><td> <code>5.78182519</code> </td> </tr></tbody></table></td></tr></tbody></table><br>  Las rayas naranja oscuro y rojo en las l√≠neas 17 y 18 significan que la gran mayor√≠a de las figuras terminan all√≠.  El tono verde p√°lido desde abajo es una consecuencia de la geometr√≠a de las figuras: solo 4 de los 7 tipos de tetrimino pueden aparecer en la l√≠nea inferior.  Las esquinas inferiores son negras porque es imposible llegar all√≠. <br><br>  El color a lo largo de cada l√≠nea es casi uniforme, y esto sugiere que las formas se distribuyen horizontalmente de manera uniforme.  Se pueden explicar brechas leves observando los histogramas de tipos individuales de formas: <br><br><table><tbody><tr><td>  <b>T</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82c/fb3/c14/82cfb3c1456fce7726985859554021d8.png"></div></td><td>  <b>J</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/f38/1a2/ebdf381a25323b9c73eaed6c467064b5.png"></div></td><td>  <b>Z</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/381/986/389/38198638921c4dcbc3a8f1978e665b89.png"></div></td><td>  <b>O</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/669/be1/5e4/669be15e4ba1b9becffb4ee97e398cbb.png"></div></td><td>  <b>S</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc8/79c/2a5/dc879c2a52f1020a69f76e9554fca978.png"></div></td><td>  <b>L</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbf/204/acb/fbf204acb6d376818fc6e98f8f517e4e.png"></div></td><td>  <b>Yo</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bb/e41/92b/7bbe4192bbb2204d4b677a9a36354da2.png"></div></td></tr></tbody></table><br>  T resulta ser el tipo m√°s universal: su histograma es m√°s uniforme que todos los dem√°s.  Anomal√≠as en el histograma J: el resultado de la influencia de las paredes;  solo <code>Jr</code> y <code>Jl</code> pueden estar en las columnas laterales, lo que hace que AI use las columnas 1 y 9 con m√°s frecuencia para compensar. Lo mismo se aplica a L. Los histogramas Z y S se ven aproximadamente iguales, lo que enfatiza el desequilibrio debido al hecho de que <code>Zv</code> y <code>Sv</code> No son im√°genes especulares perfectas el uno del otro.  El Tipo O est√° limitado a un campo de juego de 19 √ó 9, y parece que es m√°s probable que AI use O en los lados que en el centro.  Tetrimino I se desplaza hacia la derecha, porque su punto de partida se encuentra all√≠;  por lo tanto, el bloqueo en la columna 1 es raro. <br><br>  La tabla muestra el porcentaje de cifras que est√°n bloqueadas en cada fila. <br><br><table><tbody><tr><th>  Cadena </th><th>  Porcentaje </th></tr><tr><td>  0 0 </td><td>  0.0000000000 </td></tr><tr><td>  1 </td><td>  0.0000000000 </td></tr><tr><td>  2 </td><td>  0.0000004902 </td></tr><tr><td>  3 </td><td>  0.0000026472 </td></tr><tr><td>  4 4 </td><td>  0.0000066180 </td></tr><tr><td>  5 5 </td><td>  0.0000172557 </td></tr><tr><td>  6 6 </td><td>  0.0000512280 </td></tr><tr><td>  7 7 </td><td>  0.0001759400 </td></tr><tr><td>  8 </td><td>  0.0006681210 </td></tr><tr><td>  9 9 </td><td>  0.0023187901 </td></tr><tr><td>  10 </td><td>  0.0077928820 </td></tr><tr><td>  11 </td><td>  0.0259672043 </td></tr><tr><td>  12 </td><td>  0.0866187068 </td></tr><tr><td>  13 </td><td>  0.2901315751 </td></tr><tr><td>  14 </td><td>  0.9771663807 </td></tr><tr><td>  15 </td><td>  3.3000408353 </td></tr><tr><td>  16 </td><td>  10.6989059268 </td></tr><tr><td>  17 </td><td>  28.5687976371 </td></tr><tr><td>  18 a√±os </td><td>  50.0335706162 </td></tr><tr><td>  19 </td><td>  6.0077671454 </td></tr></tbody></table><br>  Aqu√≠ hay un gr√°fico de los valores: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a6/943/9d8/8a69439d8d818e46921cc5c9b75bd345.png"></div><br>  Si la l√≠nea 19 no se tiene en cuenta, el gr√°fico muestra un crecimiento exponencial. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La siguiente es una lista de las proporciones del n√∫mero de formas bloqueadas en filas adyacentes. </font></font><br><br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cadena </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / Cadena </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></sub> </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ratio (%) </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1/2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.00 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2/3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 18,52 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3/4 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 40,00 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4/5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 38,35 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5/6 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 33,68 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6/7 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29/12 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7/8 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 26,33 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8/9 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 28,81 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9/10 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,76 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10/11 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 30/01 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11/12 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,98 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 13/12 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,85 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 13/14 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,69 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14/15 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,61 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 15/16 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 30,84 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 16/17 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 37,45 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 17/18 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 57,10 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 18/19 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 832.81 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las l√≠neas </font></font><code>16‚Äì19</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tienen en cuenta las figuras que interact√∫an con el piso del campo de juego, por lo que pueden descartarse. En filas, la </font></font><code>0‚Äì5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selecci√≥n es demasiado peque√±a para ser significativa. Las razones restantes, pares 6 / 7‚Äì14 / 15, son casi id√©nticas; su valor promedio es 29.24%. Esto significa que la probabilidad de que el mont√≥n crezca en una l√≠nea es aproximadamente la misma independientemente de la altura del mont√≥n. Esto es l√≥gico, porque las reglas de Tetris limitan la interacci√≥n en la parte superior del mont√≥n cuando est√° muy empaquetado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El siguiente gr√°fico muestra el registro del </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por ciento de las cifras en las l√≠neas 6‚Äì15.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd6/7ec/745/fd67ec745b6509ae7c165ae0ebabedcc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est√° cerca de una l√≠nea perfectamente recta con un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coeficiente de determinaci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cercano a 1 </font><font style="vertical-align: inherit;">. La f√≥rmula derivada de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regresi√≥n lineal que se</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muestra arriba </font><font style="vertical-align: inherit;">nos da la intersecci√≥n con el eje Y, suponiendo que el porcentaje de formas en la fila 0 es aproximadamente 10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àí7.459</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> %. El inverso de este valor nos da una expectativa estad√≠stica de 2,877,688,349 tetrimino o 1,151,175,340 filas hasta el final del juego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto nos hace entender que log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el porcentaje de figuras en cada l√≠nea permanece lineal hasta la l√≠nea 0. Sin embargo, cuando el mont√≥n casi alcanza el techo del campo de juego, la libertad de movimiento se limita a tal punto que se viola esta propiedad. Adem√°s, bloquear una pieza en la l√≠nea 0 no significa necesariamente que el juego haya terminado; a√∫n puede guardarse si hay un lugar para crear nuevas figuras. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otra forma de evaluar la fuerza de la IA es medir el n√∫mero promedio de formas creadas entre la limpieza completa del campo de juego. La limpieza completa se puede obtener con solo 5 tetriminos. Por ejemplo, entre otras posibilidades, esto se puede lograr con cinco figuras O dispuestas en el piso del campo de juego. En general, dado que cada tetrimino consta de 4 cuadrados y el ancho del campo de juego es de 10 cuadrados, el n√∫mero de figuras creadas entre la limpieza completa debe ser un m√∫ltiplo de 5 ( desde</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 √ó 5n = 2 √ó 10n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mi IA tiene un n√∫mero promedio de formas creadas entre limpiezas de campo completo de 1,181, un n√∫mero bastante peque√±o. Dado que una limpieza completa es como reiniciar un juego, un lote completo puede verse como una serie extremadamente larga de reinicios del juego, seguido de un avance r√°pido al final del juego. Al igual que la secuencia de alternativas descrita anteriormente </font></font><code>SZ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, las secuencias patol√≥gicas que conducen al final del juego suelen ser muy cortas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El siguiente histograma muestra la probabilidad (en porcentaje) de que la IA logre una limpieza completa del campo despu√©s del n√∫mero especificado de figuras creadas.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7f/665/112/f7f66511246ef114d27d325a21c9b785.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El orden de grados en la f√≥rmula anterior determina la tasa de disminuci√≥n y, presumiblemente, la fuerza de la IA. Seg√∫n esta f√≥rmula, aproximadamente el 0,4%, o aproximadamente 1 de cada 253 juegos que comienzan con un campo de juego vac√≠o, termina con una limpieza completa en solo 5 tetriminos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En contraste con lo que sugiri√≥ Faye, las constantes en las aproximaciones lineales y exponenciales requieren un tama√±o de muestra muy grande para que R </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se acerc√≥ a 1, por lo que este m√©todo no es aplicable para PSO. </font><font style="vertical-align: inherit;">Sin embargo, las constantes obtenidas con lotes largos se pueden utilizar para optimizar la funci√≥n de aproximaci√≥n que crea posibles valores constantes para lotes cortos. </font><font style="vertical-align: inherit;">En una especie de bucle de retroalimentaci√≥n de desarrollo, la funci√≥n de aproximaci√≥n optimizada se puede usar en el PSO, lo que mejora la IA, que a su vez se puede usar para calcular nuevas constantes, sirviendo como criterios de referencia para la funci√≥n de aproximaci√≥n.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Versi√≥n Java </font></font></h3><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sobre el programa </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para los desarrolladores que no est√°n familiarizados con Lua, agregu√© un </font><font style="vertical-align: inherit;">puerto Java AI </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al archivo zip de origen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Las clases son una traducci√≥n casi l√≠nea por l√≠nea </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de objetos Lua basados ‚Äã‚Äãen cierres</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Paquetes </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El c√≥digo se divide en dos paquetes: </font></font><br><br><ul><li> <code>tetris.ai</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contiene clases e interfaces de IA. </font></font></li><li> <code>tetris.gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crea un modelo gr√°fico del campo de juego. </font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Clases e interfaces AI </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una clase con el nombre apropiado </font></font><code>Tetriminos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">describe tetrimino. </font><font style="vertical-align: inherit;">Se usa de manera similar </font></font><code>enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y contiene constantes para todos los tipos de tetrimino:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> NONE = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> T = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> J = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Z = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> O = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> S = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> L = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> I = <span class="hljs-number"><span class="hljs-number">6</span></span>;</code> </pre> <br> <code>NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significa valor no asignado. </font><font style="vertical-align: inherit;">Se utiliza para celdas vac√≠as del campo de juego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n </font></font><code>Tetriminos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene dos modelos de la tabla de orientaci√≥n. </font></font><code>PATTERNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- esta es una matriz entera de 4 dimensiones (tipo √ó rotaci√≥n √ó cuadrado √ó coordenadas) que contiene las coordenadas relativas de los cuadrados; </font><font style="vertical-align: inherit;">las l√≠neas est√°n dispuestas de modo que en cada tipo la orientaci√≥n de creaci√≥n de forma sea la primera </font></font><code>ORIENTATIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es otro modelo, una matriz bidimensional (tipo √ó rotaci√≥n) de objetos </font></font><code>Orientation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cada uno </font></font><code>Orientation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene las coordenadas del cuadrado como una matriz de objetos </font></font><code>Point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tambi√©n tiene campos que describen el rango de posiciones permitidas para la orientaci√≥n correspondiente.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Orientation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Point[] squares = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point[<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> minX; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxX; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxY; ... }</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Point</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La rotaci√≥n de Tetrimino (el segundo √≠ndice en ambas tablas de orientaci√≥n) se usa en objetos </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que BFS manipula.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rotation; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> visited; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> State predecessor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> State next; ... }</code> </pre> <br> <code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>rotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juntos describan la posici√≥n y orientaci√≥n de la figura. Dado que el tipo Tetrimino permanece constante desde el momento de la creaci√≥n hasta el bloqueo, un campo para √©l es opcional. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La clase </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que contiene el algoritmo BFS crea un conjunto completo de todos los objetos posibles </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuando se crea:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ states = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State[AI.PLAYFIELD_HEIGHT][AI.PLAYFIELD_WIDTH][<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; AI.PLAYFIELD_HEIGHT; y++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; AI.PLAYFIELD_WIDTH; x++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rotation = <span class="hljs-number"><span class="hljs-number">0</span></span>; rotation &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; rotation++) { states[y][x][rotation] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State(x, y, rotation); } } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aunque Java tiene una rica API de colecciones, </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene su propia implementaci√≥n de la cola. La clase </font></font><code>Queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliza </font></font><code>State.next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para unir objetos </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en una lista vinculada. Como todos los objetos </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√°n predefinidos, y cada uno </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se puede agregar a la cola no m√°s de una vez, la cola puede funcionar en su lugar, lo que elimina la necesidad de objetos contenedores temporales innecesarios utilizados en implementaciones de cola comunes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El "coraz√≥n" de BFS es el m√©todo que se muestra a continuaci√≥n </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxRotation = Tetriminos.ORIENTATIONS[tetriminoType].length - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mark = globalMark++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!addChild(playfield, tetriminoType, mark, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(queue.isNotEmpty()) { State state = queue.dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxRotation != <span class="hljs-number"><span class="hljs-number">0</span></span>) { addChild(playfield, tetriminoType, mark, state, state.x, state.y, state.rotation == <span class="hljs-number"><span class="hljs-number">0</span></span> ? maxRotation : state.rotation - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxRotation != <span class="hljs-number"><span class="hljs-number">1</span></span>) { addChild(playfield, tetriminoType, mark, state, state.x, state.y, state.rotation == maxRotation ? <span class="hljs-number"><span class="hljs-number">0</span></span> : state.rotation + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } addChild(playfield, tetriminoType, mark, state, state.x - <span class="hljs-number"><span class="hljs-number">1</span></span>, state.y, state.rotation); addChild(playfield, tetriminoType, mark, state, state.x + <span class="hljs-number"><span class="hljs-number">1</span></span>, state.y, state.rotation); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!addChild(playfield, tetriminoType, mark, state, state.x, state.y + <span class="hljs-number"><span class="hljs-number">1</span></span>, state.rotation)) { lockTetrimino(playfield, tetriminoType, id, state); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Genera una cola con el estado del tetrimino creado, y luego recupera secuencialmente los elementos secundarios de los estados que se eliminan de la cola, y los agrega de nuevo a la cola cuando aparecen en el campo de juego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">campo de juego que contiene una combinaci√≥n de celdas ocupadas y vac√≠as, el tipo Tetrimino creado y un identificador arbitrario se pasa al </font><font style="vertical-align: inherit;">m√©todo </font><font style="vertical-align: inherit;">. Durante la ejecuci√≥n del BFS, se llama a un oyente cada vez que se detecta una posici√≥n de bloqueo.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISearchListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, State state)</span></span></span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El oyente recibe un campo de juego modificado que contiene un tetrimino bloqueado en su lugar. El tipo de Tetrimino creado y un identificador arbitrario tambi√©n se transmiten. El √∫ltimo par√°metro es </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el que tetrimino est√° bloqueado. Siguiendo la cadena de enlaces </font></font><code>State.predecessor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puede restaurar todo el camino hasta </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crear una forma. </font></font><br><br> <code>State.visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">podr√≠a implementarse como </font></font><code>boolean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; pero con todas las instalaciones necesarias para resolver antes de buscar </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para el alivio </font></font><code>visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En cambio, hice un </font></font><code>visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor en </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comparaci√≥n con un contador, incrementando con cada llamada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo</font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pre-colas estados posteriores. El estado posterior debe estar dentro del campo y estar ubicado en 4 celdas vac√≠as del campo de juego. Adem√°s, el estado posterior no debe ser visitado </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si la posici√≥n es v√°lida, </font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuelve </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incluso si el estado posterior no se pudo poner en cola porque ya se ha visitado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El m√©todo </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa el </font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor de </font><font style="vertical-align: inherit;">retorno </font><font style="vertical-align: inherit;">para determinar si se puede crear una forma. Si no se puede crear la figura, el mont√≥n ha llegado a la cima y la b√∫squeda ya no se puede realizar; Por lo tanto, vuelve </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retornable</font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n se est√° estudiando la importancia de la posibilidad de bajar un paso m√°s. Si esto no se puede hacer, entonces el estado actual es la posici√≥n de bloqueo y comienza la llamada </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. El m√©todo </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cambia el campo de juego, llama al oyente y luego restaura el campo de juego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada fila de la matriz </font></font><code>playfield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene 1 elemento adicional, que almacena el n√∫mero de celdas ocupadas en la fila. El m√©todo incrementa el elemento </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">porque marca las celdas como ocupadas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando el oyente recibe un campo de juego modificado, llama</font></font><code>PlayfieldUtil.clearRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para eliminar filas llenas el m√©todo los reconoce al verificar el valor en el elemento adicional de la matriz. Para eliminar una cadena, el c√≥digo aprovecha el hecho de que en Java, las matrices bidimensionales son esencialmente matrices de matrices; solo empuja enlaces hacia cadenas. </font></font><code>PlayfieldUtil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene l√≠neas libres; √©l completa el proceso de limpieza insertando un enlace a uno de ellos. Antes de realizar el cambio, el √≠ndice de la fila que se borra se almacena en un elemento de fila adicional. Luego, el enlace a la l√≠nea se inserta en la pila. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces el oyente llama</font></font><code>PlayfieldUtil.restoreRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para descartar los cambios realizados en el campo de juego. </font><font style="vertical-align: inherit;">Los pasos se cancelan en orden inverso. </font><font style="vertical-align: inherit;">Primero obtenemos una fila libre desde la parte superior. </font><font style="vertical-align: inherit;">Luego, la fila llena se recupera de la pila y se restaura el √≠ndice del elemento adicional. </font><font style="vertical-align: inherit;">Se utiliza para cambiar las referencias de l√≠nea y volver al lugar de la l√≠nea eliminada. </font><font style="vertical-align: inherit;">Finalmente, se restaura un elemento adicional, se le asigna el valor del ancho del campo de juego: el n√∫mero de celdas ocupadas en la fila llena. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n </font></font><code>PlayfieldUtil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hay un m√©todo </font></font><code>evaluatePlayfield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que calcula y escribe 4 par√°metros de evaluaci√≥n en la clase de contenedor que se muestra a continuaci√≥n.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayfieldEvaluation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> holes; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columnTransitions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowTransitions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> wells; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La clase maneja todo esto </font></font><code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Contiene dos objetos </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conectados entre s√≠ por el oyente que se muestra a continuaci√≥n.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, State state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id == <span class="hljs-number"><span class="hljs-number">0</span></span>) { result0 = state; } Orientation orientation = Tetriminos.ORIENTATIONS[tetriminoType][state.rotation]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rows = playfieldUtil.clearRows(playfield, state.y); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalTotalRows = totalRows; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalTotalDropHeight = totalDropHeight; totalRows += rows; totalDropHeight += orientation.maxY - state.y; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nextID = id + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextID == tetriminoIndices.length) { playfieldUtil.evaluatePlayfield(playfield, e); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> fitness = computeFitness(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fitness &lt; bestFitness) { bestFitness = fitness; bestResult = result0; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { searchers[nextID].search(playfield, tetriminoIndices[nextID], nextID); } totalDropHeight = originalTotalDropHeight; totalRows = originalTotalRows; playfieldUtil.restoreRows(playfield, rows); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una clase </font></font><code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede manejar cualquier cantidad de objetos </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pero Nintendo Tetris solo muestra una forma por adelantado. Los objetos </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se almacenan en una matriz, y el c√≥digo que se muestra arriba sirve como su escucha com√∫n. El identificador aleatorio pasado al m√©todo </font></font><code>Searcher.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es en realidad el √≠ndice de la matriz, que tambi√©n es la profundidad de la b√∫squeda. Cuando se llama al oyente, el identificador dirige la llamada al siguiente </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la cadena. Si llega al final de la matriz, eval√∫a el campo de juego. Y cuando encuentra un campo de juego con un puntaje de condici√≥n f√≠sica m√°s alto, anota el bloqueado </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">del primero </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la cadena. </font></font><br><br> <code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene un m√©todo </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que recibe el campo de juego y una matriz que contiene los tipos de tetrimino creado y el siguiente. El regresa</font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que contiene la posici√≥n y la rotaci√≥n en la que debe bloquearse el primer tetrimino. </font><font style="vertical-align: inherit;">No se enfoca en el segundo tetrimino; </font><font style="vertical-align: inherit;">la pr√≥xima vez que se llama, vuelve a calcular la puntuaci√≥n. </font><font style="vertical-align: inherit;">Si el mont√≥n es demasiado alto y la cadena </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no puede colocar ambos tetriminos, entonces </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volver√° </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> State </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] tetriminoIndices)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tetriminoIndices = tetriminoIndices; bestResult = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; bestFitness = Double.MAX_VALUE; searchers[<span class="hljs-number"><span class="hljs-number">0</span></span>].search(playfield, tetriminoIndices[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bestResult; }</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desaf√≠o AI </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dado que la versi√≥n de Java no est√° vinculada a FCEUX, puede usarse potencialmente para otros proyectos. Para aquellos que est√©n interesados ‚Äã‚Äãen integrar AI en otro lugar, esta secci√≥n describe todo lo que necesita. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero, cree una instancia </font></font><code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, instancia </font></font><code>PlayfieldUtil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y matriz para contener todos los tipos conocidos de tetrimino. Adem√°s, cree una </font></font><code>PlayfieldUtil.createPlayfield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instancia del campo de juego </font><font style="vertical-align: inherit;">llamando </font><font style="vertical-align: inherit;">; devuelve una matriz bidimensional con una columna adicional, que examinamos anteriormente. Probablemente tambi√©n necesitar√° un generador de n√∫meros aleatorios.</font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(); PlayfieldUtil playfieldUtil = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlayfieldUtil(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] tetriminos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[AI.TETRIMINOS_SEARCHED]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[][] playfield = playfieldUtil.createPlayfield(); Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicialmente, el campo de juego est√° vac√≠o y todas las celdas son relevantes </font></font><code>Tetriminos.NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si completa las celdas mediante programaci√≥n, no olvide anotar el </font></font><code>playfield[rowIndex][AI.PLAYFIELD_WIDTH]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero de celdas ocupadas en cada fila. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rellene el conjunto de tipos de tetrimino con los tipos de la forma creada inicialmente y la siguiente forma, que generalmente se seleccionan manualmente.</font></font><br><br><pre> <code class="java hljs">tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luego pasamos el campo de juego y la matriz de tipos al m√©todo </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">√âl regresar√° </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el que necesita bloquear el primer tetrimino. </font><font style="vertical-align: inherit;">Si regresa </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, entonces el juego es inevitable.</font></font><br><br><pre> <code class="java hljs">State state = ai.search(playfield, tetriminos);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si necesita una forma de crear una figura para bloquear, p√°selo al </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todo </font></font><code>AI.buildStateList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs">State[] states = ai.buildStatesList(state);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para actualizar el campo de juego, lo pasaremos </font></font><code>PlayfieldUtil.lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">junto con su tipo y objeto </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Este m√©todo borra autom√°ticamente las filas rellenas.</font></font><br><br><pre> <code class="java hljs">playfieldUtil.lockTetrimino(playfield, tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>], state);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de volver a llamar, </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe seleccionar aleatoriamente el siguiente tetrimino.</font></font><br><br><pre> <code class="java hljs">tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>]; tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Juntos, se ve as√≠: </font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(); PlayfieldUtil playfieldUtil = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlayfieldUtil(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] tetriminos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[AI.TETRIMINOS_SEARCHED]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[][] playfield = playfieldUtil.createPlayfield(); Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// ... print playfield ... State state = ai.search(playfield, tetriminos); if (state == null) { break; // game over } playfieldUtil.lockTetrimino(playfield, tetriminos[0], state); tetriminos[0] = tetriminos[1]; tetriminos[1] = random.nextInt(7); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En lugar de mostrar el campo de juego en forma de texto, puede usar una forma m√°s interesante para mostrar lo que est√° sucediendo ... </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Visualizaci√≥n del campo de juego </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La clase </font></font><code>TetrisFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imita los gr√°ficos de Nintendo Tetris, incluidas las caracter√≠sticas de comportamiento descritas en la parte anterior del art√≠culo.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d58/dac/a4c/d58daca4c668408a42efa51ad7508d75.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para verlo en acci√≥n, ejec√∫telo </font></font><code>tetris.gui.Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Al igual que con la versi√≥n de Lua, podemos ajustar la velocidad del juego cambiando el valor constante al comienzo del archivo.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> PLAY_FAST = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre> <br> <code>TetrisFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiene 4 m√©todos para manipular la pantalla. </font><font style="vertical-align: inherit;">El m√©todo </font></font><code>displayTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">representa el tetrimino activo en las coordenadas especificadas. </font><font style="vertical-align: inherit;">Recibe un par√°metro de retraso, lo que hace que el m√©todo espere antes de devolver el n√∫mero especificado de cuadros de animaci√≥n.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">displayTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El m√©todo </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloquea la figura en su lugar. </font><font style="vertical-align: inherit;">Los colores del contador de filas, puntos, nivel y tetrimino se actualizan en consecuencia, lo que demuestra el comportamiento curioso esperado cuando los valores exceden los valores permitidos. </font><font style="vertical-align: inherit;">La asignaci√≥n de un </font></font><code>animate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font><font style="vertical-align: inherit;">a un par√°metro </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incluye animaciones de limpieza de filas y parpadeo de pantalla al recibir Tetris. </font><font style="vertical-align: inherit;">El m√©todo est√° bloqueado hasta que finalice la animaci√≥n.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lockTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animate)</span></span></span></span></code> </pre> <br> <code>updateStatisticsAndNext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> realiza un incremento del contador de estad√≠sticas para el tetrimino reci√©n creado y actualiza la visualizaci√≥n de la siguiente figura. </font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStatisticsAndNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> activeTetrimino, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nextTetrimino)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El m√©todo </font></font><code>dropTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crea una forma y le permite descender bajo la influencia de la "gravedad", sin hacer ning√∫n intento de girarla o moverla. </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lo usa para las dos √∫ltimas cifras cuando </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regresa </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si el par√°metro </font></font><code>animate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importa </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, entonces si es imposible crear una figura, se cortar√° el tel√≥n del final del juego. Al igual que con todos los dem√°s m√©todos, este m√©todo bloquea hasta que finaliza la animaci√≥n. Solo regresa </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuando puede crear una figura en un campo de juego ocupado.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dropTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animate)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El flujo de trabajo debe llamar a estos 4 m√©todos, pero se </font></font><code>TetrisFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deben crear en el subproceso de env√≠o de eventos en s√≠. Para ver c√≥mo se hace esto, vea la clase </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En aras del inter√©s, </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliza una clase </font></font><code>Randomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que simula un generador de n√∫meros pseudoaleatorio sesgado de Nintendo Tetris. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El paquete </font></font><code>tetris.gui.images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene archivos relacionados con la pantalla. </font></font><code>tiles.png</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Esta es una tabla de patrones que contiene todos los gr√°ficos de mosaico. </font></font><code>background.dat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">almacena los identificadores de los mosaicos que forman el fondo; datos extra√≠dos de </font></font><code>$BF3F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Y </font></font><code>colors.dat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene bytes que generan colores cuadrados inusuales que aparecen desde el nivel 138. </font></font><br><br> <code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contiene una tabla de paletas NES y </font></font><code>ImagePane</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se almacena </font><font style="vertical-align: inherit;">el </font><font style="vertical-align: inherit;">conjunto completo de valores de nivel visualizados.</font></font><br><br><h4>  Otros proyectos </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Potencialmente, el c√≥digo se puede usar en lugar de escribir para el modo de demostraci√≥n. De hecho, dicha demostraci√≥n se puede representar para siempre, aprovechando la rapidez con que la IA puede despejar todo el campo de juego. Para lograr esto, en el generador de n√∫meros pseudoaleatorios, debe usar alguna constante arbitraria como semilla, lo que nos dar√° una secuencia tetrimino determinista. Se grabar√°n las dos primeras secuencias de tetrimino. Cuando la IA alcanza la limpieza de campo completo, los siguientes dos tetriminos se comparar√°n con los dos primeros de la secuencia. Si coinciden (este evento se espera cada 49 limpiezas de campo completo), entonces el generador de n√∫meros pseudoaleatorios puede pasar la misma constante que la semilla, lo que crear√° un bucle de demostraci√≥n infinito. La duraci√≥n del ciclo puede ser muy larga para ocultar el hecho de que es un ciclo. Tambi√©nla demostraci√≥n puede comenzar en un punto aleatorio del bucle, creando una nueva demostraci√≥n cada vez.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otra posibilidad de usar AI es crear un modo de "jugador contra computadora". En el Tetris multijugador, al despejar varias l√≠neas al mismo tiempo, aparecen l√≠neas de basura en la parte inferior del campo del oponente, elevando el campo de juego. La IA debe ser capaz de protegerse de los escombros por la misma raz√≥n que puede jugar juegos de tipo B. Sin embargo, como se dijo anteriormente, AI juega de forma conservadora, generalmente luchando por despejar una l√≠nea a la vez. Es decir, podr√° defenderse de los ataques, pero no podr√° atacar. Para poder cambiar su comportamiento, cre√© una interfaz llamada </font></font><code>IChildFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IChildFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation)</span></span></span></span>; }</code> </pre> <br> <code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiene un constructor alternativo que obtiene una implementaci√≥n </font></font><code>IChildFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si est√° disponible, </font></font><code>IChildFilter.validate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sirve como un control adicional para el permiso del estado secundario; si regresa </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, entonces el estado secundario no est√° en cola. </font></font><br><br> <code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es una implementaci√≥n</font></font><code>IChildFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinado a recoger cuatro filas (Tetris). </font><font style="vertical-align: inherit;">Al igual que los jugadores vivos, construye gradualmente un pozo en la columna m√°s a la derecha del campo de juego, subiendo l√≠nea por l√≠nea de abajo hacia arriba. </font><font style="vertical-align: inherit;">Como funciona l√≠nea por l√≠nea, rechaza los estados secundarios que agregan un cuadrado a la columna de la derecha. </font><font style="vertical-align: inherit;">Cuando toda la fila, con la excepci√≥n de la columna del pozo, est√° completamente llena, la IA pasa a la siguiente fila. </font><font style="vertical-align: inherit;">Cuando 4 o m√°s de estas l√≠neas est√°n listas, permite que el "palo" caiga en el pozo y obtenga Tetris. </font><font style="vertical-align: inherit;">Adem√°s, se realiza un seguimiento de la altura del mont√≥n; </font><font style="vertical-align: inherit;">Si se vuelve demasiado grande, </font></font><code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deja de afectar a la IA.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82b/c27/710/82bc27710c0e5200d599be07bf549206.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para probarlo en funcionamiento, realice los </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">siguientes cambios:</font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WellFilter());</code> </pre> <br> <code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciona, pero no es particularmente efectivo. Contiene una heur√≠stica simple dise√±ada para demostrar el concepto. Para obtener Tetris con m√°s frecuencia, debe utilizar una estrategia m√°s sofisticada, tal vez una que pueda optimizarse con PSO. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, puede usar el filtro de estado secundario para generar patrones. A continuaci√≥n se muestra un ejemplo de lo que es capaz de hacer </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/569/e21/15f/569e2115f8936fc3391d1bb330017d8a.png"></div><br> <code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crea im√°genes l√≠nea por l√≠nea de abajo hacia arriba, de forma similar a c√≥mo funciona </font></font><code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">sin embargo, en lugar de preservar la columna m√°s a la derecha, </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solo aprueba los estados secundarios que corresponden a un patr√≥n particular. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El constructor </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtiene el nombre de una de las im√°genes en el paquete </font></font><code>tetris.gui.patterns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que utiliza como plantilla. </font><font style="vertical-align: inherit;">Cada imagen de 20 √ó 10 contiene p√≠xeles en blanco y negro correspondientes a las celdas en el campo de juego.</font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PatternFilter(<span class="hljs-string"><span class="hljs-string">"tetriminos"</span></span>));</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La l√≠nea de c√≥digo que se muestra arriba crea las siluetas de siete tipos de tetrimino. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb3/0c8/d79/cb30c8d795e12e41d3831a0735637a55.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Otro ejemplo con un gran tetrimino T girado en √°ngulo. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf0/f95/14c/cf0f9514c3a08b88c4f67117614ade91.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otro ejemplo. </font><font style="vertical-align: inherit;">Si te fijas bien, ver√°s el nombre del juego.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a26/712/284/a267122840a2373e7bb5fb6fa6282018.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como </font></font><code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, no </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es m√°s que una prueba de concepto. </font><font style="vertical-align: inherit;">Los patrones que procesa se limitan al fondo del campo de juego debido al hecho de que los intentos de obtenerlos generalmente terminan con el juego terminado. </font><font style="vertical-align: inherit;">Sin embargo, esta es una idea interesante que vale la pena seguir estudiando.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Versi√≥n de Gamepad </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El script Lua y el programa Java ignoran la gravedad; para ellos, la velocidad de descenso no es importante, porque dependiendo de la configuraci√≥n, teletransportan las figuras inmediatamente a la ubicaci√≥n deseada o arrastran a lo largo de cualquier ruta elegida. En cierto modo, simplemente imitan el Tetris, no lo juegan. Sin embargo, en el </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivo zip con las fuentes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hay otro script Lua que se reproduce generando las se√±ales de los botones del gamepad, lo que permite que el juego controle el movimiento de las figuras, la gravedad y todo lo dem√°s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregar gravedad expande enormemente el espacio de b√∫squeda, obligando a AI a tener en cuenta las astutas reglas de manipulaci√≥n de formas. Los detalles de estas reglas se describen en la primera parte del art√≠culo y se pueden apreciar plenamente mediante un estudio directo del c√≥digo.</font></font> Aqu√≠ est√°n los m√°s importantes: <br><br><ul><li>       : ,   . </li><li>   ¬´¬ª   . </li><li>   ¬´¬ª  ¬´¬ª    . </li><li>         . </li><li>          . </li><li>          . </li><li>          . </li><li>   ,        . </li><li>   A  B           . </li><li>  ¬´¬ª  ¬´¬ª       6      16 .     ¬´¬ª  ¬´¬ª   ,     . </li><li>  ¬´¬ª            3 . </li><li>       96 .    ,    ‚Äî . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para acomodar todas estas reglas, la informaci√≥n hist√≥rica debe integrarse en los estados de b√∫squeda. Necesitan campos en los que se almacenar√° el n√∫mero de cuadros de retenci√≥n para cada bot√≥n y el n√∫mero de cuadros despu√©s de la √∫ltima liberaci√≥n autom√°tica. Cada conjunto √∫nico de valores, incluidas las coordenadas </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y la rotaci√≥n tetrimino caracterizan un estado separado y √∫nico. Desafortunadamente, el n√∫mero de posibilidades es tan grande que una b√∫squeda completa de este espacio no es pr√°ctica. La versi√≥n AI para el gamepad explora solo un subconjunto del mismo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AI usa un objeto </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con los siguientes campos:</font></font><br><br><pre> <code class="java hljs">{ x, y, rotation, Left, Right, Down, A, B, fallTimer, visited, predecessor }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En lugar de usar el cambio autom√°tico de AI en cuadros alternativos, presione y suelte el bot√≥n de cambio. </font><font style="vertical-align: inherit;">Por lo tanto, solo necesita monitorear si se presiona el bot√≥n y no cu√°nto tiempo se lo presiona. </font><font style="vertical-align: inherit;">Dado que no hay rotaci√≥n autom√°tica, la misma idea se aplica a los botones A y B. Por lo tanto el campo </font></font><code>Left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede ser interpretada como una lista que contiene uno de los siguientes valores:</font></font><br><br><pre> <code class="java hljs">{ RELEASED, PRESSED }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por otro lado, para el descenso suave, inicialmente debe mantener presionado el bot√≥n "Abajo" durante tres cuadros, lo que requiere la existencia de 4 estados: </font></font><br><br><pre> <code class="java hljs">{ RELEASED, PRESSED_FOR_1_FRAME, PRESSED_FOR_2_FRAMES, PRESSED_FOR_3_FRAMES }</code> </pre> <br> <code>Down</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aumenta gradualmente desde el valor </font></font><code>RELEASED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasta </font></font><code>PRESSED_FOR_3_FRAMES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en el que se produce un descenso suave. Despu√©s de eso, puede recibir un valor </font></font><code>RELEASED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o volver a </font></font><code>PRESSED_FOR_2_FRAMES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, causando un descenso suave cada segundo cuadro despu√©s del retraso inicial. No puede ser </font></font><code>RELEASED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font></font><code>PRESSED_FOR_1_FRAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o de </font></font><code>PRESSED_FOR_2_FRAMES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En realidad, el c√≥digo Lua usa una constante entera, pero el principio es el mismo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Del mismo modo, </font></font><code>visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>predecessor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se le asigna el valor obtenido al escribir en el estado de la cola subsidiaria; que </font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° uno m√°s que el valor del estado de los padres. Condici√≥n que contiene</font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, igual a la velocidad de descenso, implica que el descenso autom√°tico ocurre en este cuadro, y para los estados posteriores de este estado el valor </font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° 0. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">predefinici√≥n de una </font></font><code>8-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matriz que contiene todos los estados posibles ( </font></font><code>20  √ó 10  √ó 4  √ó 2  √ó 2  √ó 4  √ó 2 A √ó 2 B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), y BFS se ejecuta de manera similar al m√©todo mostrado para la </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matriz. </font><font style="vertical-align: inherit;">El pseudoc√≥digo que se muestra a continuaci√≥n describe c√≥mo se obtienen los estados posteriores de los estados inactivos.</font></font><br><br><pre> <code class="cpp hljs">Slide = (Left == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (Right == PRESSED) Rotate = (A == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (B == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == RELEASED <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Down == PRESSED_FOR_3_FRAMES then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == RELEASED then nextDown = PRESSED_FOR_1_FRAME <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nextDown = PRESSED_FOR_2_FRAMES end addChild(Down = nextDown) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED, Down = nextDown) addChild(B = PRESSED, Down = nextDown) end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Slide then addChild() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED) addChild(B = PRESSED) end <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> addChild(Left = PRESSED) addChild(Right = PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(Left = PRESSED, A = PRESSED) addChild(Left = PRESSED, B = PRESSED) addChild(Right = PRESSED, A = PRESSED) addChild(Right = PRESSED, B = PRESSED) end end <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == PRESSED_FOR_1_FRAME then nextDown = PRESSED_FOR_2_FRAMES <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nextDown = PRESSED_FOR_3_FRAMES end addChild(Down = nextDown) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED, Down = nextDown) addChild(B = PRESSED, Down = nextDown) end end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como se muestra en el pseudoc√≥digo siguiente, la funci√≥n </font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiene en cuenta el orden de los eventos que ocurren en cada cuadro (por ejemplo, desplazamiento, rotaci√≥n y descenso).</font></font><br><br><pre> <code class="cpp hljs">nextFallTimer = fallTimer + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Left == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x - <span class="hljs-number"><span class="hljs-number">1</span></span>, y, rotation) then x = x - <span class="hljs-number"><span class="hljs-number">1</span></span> elseif Right == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x + <span class="hljs-number"><span class="hljs-number">1</span></span>, y, rotation) then x = x + <span class="hljs-number"><span class="hljs-number">1</span></span> end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> A == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x, y, nextClockwiseRotation) then rotation = nextClockwiseRotation elseif B == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x, y, nextCounterclockwiseRotation) then rotation = nextCounterclockwiseRotation end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == PRESSED_FOR_3_FRAMES <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> nextFallTimer &gt;= dropSpeed then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> testPosition(x, y + <span class="hljs-number"><span class="hljs-number">1</span></span>, rotation) then y = y + <span class="hljs-number"><span class="hljs-number">1</span></span> nextFallTimer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> lockTetrimino() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> end end childState = states[y][x][rotation][Left][Right][Down][A][B] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> childState.visited then childState.visited = mark childState.predecessor = state childState.fallTimer = nextFallTimer <span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.enqueue(childState) end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como en la versi√≥n anterior, </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devuelve una cadena de objetos </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pero en este caso, cada uno </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene muchos botones que deben presionarse en cada cuadro. Los campos </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>rotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se usan para manipular formas, pero se pueden usar para verificar el movimiento correcto de las formas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aunque el espacio de b√∫squeda se ha reducido significativamente debido a las limitaciones descritas anteriormente, se tarda de 1 a 3 segundos en completar la b√∫squeda. Si lo ejecuta, notar√° una pausa despu√©s de crear cada tetrimino. Adem√°s, los movimientos se ven muy poco naturales; Por lo general, un giro se realiza un instante antes del bloqueo. Sin embargo, esta IA juega casi de la misma manera que la versi√≥n que ignoraba la gravedad, incluso a la velocidad m√°xima.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para verificarlo, ejec√∫telo </font></font><code>lua/NintendoTetrisAIGamepadVersion.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ubicado en el </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivo zip con las fuentes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una forma m√°s sencilla de explicar la gravedad es limitar el movimiento de las figuras solo girando, seguido de un cambio y luego descender al fondo. </font><font style="vertical-align: inherit;">La idea es que si se deshace del deslizamiento y el desplazamiento, la velocidad vertical de las figuras tendr√° poco efecto en la IA; </font><font style="vertical-align: inherit;">todo lo que necesita hacer es entregar la figura a la columna deseada, y la gravedad har√° el resto. </font><font style="vertical-align: inherit;">Otra ventaja de esta t√©cnica es que el espacio de b√∫squeda es muy peque√±o, lo que le permite jugar en tiempo real, sin demora para los c√°lculos. </font><font style="vertical-align: inherit;">Sin embargo, el inconveniente de este enfoque es que sin deslizarse y desplazarse, la IA juega mucho peor. </font><font style="vertical-align: inherit;">Sin embargo, la IA de Tetris, incapaz de jugar en tiempo real, es pr√°cticamente in√∫til.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adem√°s </font></font></h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/2c5/a7e/cfd2c5a7e44131bfc188c3eea6ad5139.png" alt="Tetris"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anteriormente, escrib√≠ un complemento que simulaba procedimentalmente un jugador en Tetris. </font><font style="vertical-align: inherit;">Sin embargo, mi proyecto ten√≠a algunas desventajas:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El bot apag√≥ la gravedad, lo que le permite realizar deslizamientos y desplazamientos, superando las capacidades del jugador en el nivel m√≠nimo de Nintendo Tetris. </font><font style="vertical-align: inherit;">Nunca sube las cifras, pero la √∫nica forma de bajarlas es un descenso suave y controlado. </font><font style="vertical-align: inherit;">Es decir, juega en un mundo te√≥rico e idealizado. </font><font style="vertical-align: inherit;">Para decirlo sin rodeos, hace trampa.</font></font></li><li>   .    ‚Äî  ,      .     Double, Triple  Tetris,         ‚Äî  ,    .         90.    ,   ,       29   -     . </li><li>          .      .       .     ,  Tetris      . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En esta secci√≥n, hablar√© sobre un bot avanzado que juega Nintendo Tetris sin desactivar la gravedad. </font><font style="vertical-align: inherit;">Eval√∫a el riesgo y lo maneja, esforz√°ndose agresivamente por obtener el m√°ximo n√∫mero de puntos antes de alcanzar una alta velocidad de descenso.</font></font><br><br><hr><br><h1>  Video </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mira c√≥mo el robot gana la cantidad m√°xima de puntos de Nintendo Tetris a partir del nivel 19 en todos los videos que se muestran a continuaci√≥n. </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/l2YOt_GdfA0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zsd3eAYMlN0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/efh-_zeQH4Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><hr><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Descargar </font></font></h1><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TetrisAI_2018-01-28.zip</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El archivo </font></font><code>.zip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiene:</font></font><br><br><ul><li> <code>src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √°rbol de c√≥digo fuente. </font></font></li><li> <code>TetrisAI.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - archivo binario compilado. </font></font></li><li> <code>lgpl-2.1.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - licencia de software libre. </font></font></li></ul><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lanzamiento </font></font></h1><br><h2>  Prerrequisitos </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nintaco</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un emulador NES / Famicom.</font></font></li><li> <code>Tetris (U) [!].nes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Archivo ROM de Nintendo Tetris. </font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lanzamiento de complemento </font></font></h2><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicie Nintaco y √°bralo </font></font><code>Tetris (U) [!].nes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extracto </font></font><code>TetrisAI.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la descargada </font></font><code>.zip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra la ventana Ejecutar programa seleccionando Herramientas | </font><font style="vertical-align: inherit;">Ejecutar programa ...</font></font></li><li>        JAR        Find JAR‚Ä¶ . </li><li>  Load JAR,   . </li><li>  Run. </li><li>        ,       <code>GAME TYPE</code>  <code>MUSIC TYPE</code> .   <code>D-pad</code> (     )  <code>A-TYPE</code>   .   Start (Enter),      . </li><li>    <code>A-TYPE</code>  <code>D-pad</code> (  )   <code>LEVEL 9</code> . ,    <code>A</code>    Start (   <code>X</code>   Enter),     19,    . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vale la pena considerar que el bot est√° dise√±ado solo para el nivel 19 y superior. </font><font style="vertical-align: inherit;">En niveles inferiores, no podr√° controlar las piezas.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Referencia de velocidad </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que el juego vaya m√°s r√°pido, selecciona M√°quina | </font><font style="vertical-align: inherit;">Velocidad | </font><font style="vertical-align: inherit;">Max</font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Detalles </font></font></h1><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Meseta </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por debajo del nivel 10, la velocidad de descenso en cada nivel es ligeramente mayor que en el anterior. </font><font style="vertical-align: inherit;">Pero en el nivel de 10 y superior hay varias mesetas a las cuales la velocidad permanece constante durante varios niveles. </font><font style="vertical-align: inherit;">Esto es una consecuencia de la forma en que funciona el mecanismo de activaci√≥n. </font><font style="vertical-align: inherit;">La velocidad se presenta como el n√∫mero de cuadros por descenso, que es un valor entero. </font><font style="vertical-align: inherit;">Es decir, para niveles m√°s altos no quedan muchas opciones: 10‚Äì12, 13‚Äì15, 16‚Äì18, 19‚Äì28 y 29+ son 5, 4, 3, 2 y 1 cuadro para el descenso.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El bot se desarroll√≥ teniendo en cuenta solo la meseta de 19‚Äì28. Incluso en cuadros, hace clic en el control del juego "Izquierda", "Derecha", A, B o nada. Y en cuadros extra√±os, permite el descenso autom√°tico sin presionar ning√∫n bot√≥n. Parece que el juego no percibe el movimiento horizontal que coincide con la rotaci√≥n; por lo tanto, cada bot√≥n se presiona de forma independiente en cuadros pares. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A diferencia de los maestros que juegan a niveles altos, el bot no aprovecha el cambio autom√°tico diferido (DAS), tambi√©n conocido como repetici√≥n autom√°tica, y t√©cnicas relacionadas. Su trabajo recuerda m√°s </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la t√©cnica de vibraci√≥n del pulgar de Thor Akerlund</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sin embargo, aumenta la frecuencia de vibraci√≥n al m√°ximo te√≥rico permitido por el juego.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los jugadores son recompensados ‚Äã‚Äãcon 40, 100, 300 y 1200 puntos por Single, Double, Triple y Tetris. </font><font style="vertical-align: inherit;">Y los puntos se multiplican por el n√∫mero de nivel m√°s 1. En otras palabras, para obtener el puntaje m√°ximo, el jugador debe luchar por el n√∫mero m√°ximo de Tetris, jugando el mayor tiempo posible en niveles altos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El nivel 19 es el m√°s alto que se puede seleccionar como el inicial, lo que permite que el bot salte directamente a la meseta 19‚Äì28. </font><font style="vertical-align: inherit;">Sin embargo, debido a un error en el mecanismo de c√°lculo de nivel que mencion√© en la parte anterior, el juego pasar√° al nivel 20 despu√©s de despejar 140 filas, en lugar de las 200 esperadas. Despu√©s de eso, el juego cambiar√° los niveles cada 10 filas. </font><font style="vertical-align: inherit;">Sin embargo, despu√©s de alcanzar 230 filas, el bot se levantar√° de la meseta y se rendir√° r√°pidamente. </font><font style="vertical-align: inherit;">Es decir, necesita marcar tantos Tetris como sea posible antes de limpiar 230 filas.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Descenso suave </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El descenso suave tambi√©n puede aumentar el n√∫mero de puntos. </font><font style="vertical-align: inherit;">Para obtener puntos, la figura debe bajarse suavemente para bloquear el campo de juego. </font><font style="vertical-align: inherit;">Cualquier descenso suave a corto plazo que ocurra en el camino al posicionar una figura no afectar√° la puntuaci√≥n. </font><font style="vertical-align: inherit;">Si el descenso es exitoso, el jugador recibir√° un punto por cada l√≠nea cruzada durante el descenso suave. </font><font style="vertical-align: inherit;">Y el valor resultante no se multiplica por el n√∫mero de nivel, incluso si un descenso suave lleva a despejar las filas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El descenso suave tiene poco efecto en el puntaje general. </font><font style="vertical-align: inherit;">Sin embargo, si es posible, el bot completa la colocaci√≥n de la figura haciendo clic en "Abajo" para obtener estos puntos. </font><font style="vertical-align: inherit;">En casos raros, puede promediar la diferencia entre un puntaje muy alto y exceder el puntaje m√°ximo.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algoritmo AI </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al crear una forma, el bot explora cada posible colocaci√≥n de las formas actuales y siguientes. La ubicaci√≥n permitida es la posici√≥n en la que la figura descansa sobre las celdas ocupadas o en el piso del campo de juego. Desde el lugar de creaci√≥n de la figura, esta posici√≥n se puede alcanzar a trav√©s de una secuencia de movimientos horizontales, giros y descensos. Las ubicaciones v√°lidas y las secuencias de ruta se encuentran utilizando BSF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colocar una pieza en el campo de juego tiene consecuencias: 4 celdas vac√≠as se ocupan, y todas las filas llenas se borran, dejando que las filas bajen. Para cada ubicaci√≥n permitida de la figura actual y las consecuencias asociadas con ella, el bot verifica cada ubicaci√≥n permitida de la siguiente figura, evaluando la combinaci√≥n de consecuencias. Dicha cadena de b√∫squeda se presenta </font></font><code>SearchChain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada una de las consecuencias combinadas se transfiere a una funci√≥n de evaluaci√≥n que calcula el contenido del campo de juego. </font><font style="vertical-align: inherit;">La combinaci√≥n con la puntuaci√≥n m√°s baja gana y la pieza actual se coloca en consecuencia. </font><font style="vertical-align: inherit;">Los resultados de la cadena de b√∫squeda solo afectan la forma actual. </font><font style="vertical-align: inherit;">Al crear la siguiente figura, se eval√∫a en combinaci√≥n con la figura que le sigue, y as√≠ sucesivamente.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funci√≥n de evaluaci√≥n </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La funci√≥n de evaluaci√≥n es una suma ponderada de los siguientes par√°metros: </font></font><br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El n√∫mero total de filas eliminadas</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el n√∫mero de filas eliminadas mediante la adici√≥n de ambos tetriminos.</font></font></li><li> <strong>  </strong> ‚Äì      ,   .     ‚Äî   ,        ,       . </li><li> <strong>  -</strong> ‚Äì    . </li><li> <strong>   </strong> ‚Äì  ,     -. </li><li> <strong>    </strong> ‚Äì   ,      .         .     . </li><li> <strong>     </strong> ‚Äì      .       ,   1.   ,         ,           . </li><li> <strong>     </strong> ‚Äì         ,    .  ‚Äî        ,    ‚Äî          . </li><li> <strong>    </strong> ‚Äì     .   ,         (20). </li><li> <strong>    </strong> ‚Äì     .   ,      0. </li><li> <strong>    </strong> ‚Äì   ,     ( )    . </li><li> <strong>    </strong> :    ‚Äî   ,     ( )    .         .        .          . </li><li> <strong>   </strong> ‚Äì           . ,   1  ,   1,     ‚Äî  0. </li><li> <strong> </strong> ‚Äì   . </li><li> <strong>  </strong> ‚Äì         . </li><li> <strong>   </strong> ‚Äì      . </li><li> <strong>    </strong> ‚Äì     .     . </li><li> <strong>  </strong> ‚Äì        . </li></ul><br><h2>  Aprendizaje autom√°tico </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para encontrar los pesos de la funci√≥n de evaluaci√≥n, utilizamos una variante del m√©todo de optimizaci√≥n de enjambre de part√≠culas (PSO) descrito en la nota al pie [1]. Para obtener un buen comportamiento convergente, se aplican los coeficientes de inercia y aceleraci√≥n propuestos. Y los tama√±os m√°ximos de los pasos de part√≠culas est√°n determinados por la limitaci√≥n de sus valores de velocidad. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durante cada iteraci√≥n, las part√≠culas se evaluaron en paralelo para aprovechar al m√°ximo los recursos inform√°ticos disponibles. Adem√°s, despu√©s de que se detect√≥ la convergencia (sin mejoras despu√©s de un cierto n√∫mero de iteraciones), el PSO se configur√≥ para reiniciarse autom√°ticamente con pesos seleccionados al azar, lo que nos permiti√≥ explorar a√∫n m√°s el espacio de b√∫squeda.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada vector de posici√≥n de part√≠culas se evalu√≥ simulando la finalizaci√≥n de 100 lotes en una meseta de niveles 19‚Äì28. Un lote completo implica la limpieza de 230 filas, pero muchas terminaron con un desbordamiento del campo. Las puntuaciones de los lotes se ordenaron y las puntuaciones de part√≠culas se determinaron como el promedio de 33 de cada 100 lotes. La idea era elegir en funci√≥n de la agresividad. Las part√≠culas en el tercio superior se acostumbran solo a las secuencias deseadas de figuras, lo que limita la necesidad de un juego conservador. Como resultado, tienden a llevar el juego habitual al l√≠mite, esperando el pr√≥ximo "palo".</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se generaron secuencias de patrones para 100 lotes antes de la PSO, y las mismas secuencias se usaron una y otra vez. Esto era necesario para arreglar el espacio de b√∫squeda, de modo que las opciones de soluci√≥n pudieran compararse entre s√≠. Las secuencias se crearon utilizando la l√≥gica de un PRNG Nintendo Tetris real, que est√° dise√±ado para reducir las posibilidades de que los duplicados se sigan. Pero PRNG tambi√©n tiene puntos d√©biles (consulte la secci√≥n "Elegir Tetrimino" de un art√≠culo anterior): no selecciona las cifras de manera uniforme. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los intentos iniciales dieron como resultado que los bots actuaran de manera demasiado agresiva. Si superaban la meseta 19‚Äì28, generalmente llegaban al puntaje m√°ximo. Pero, desafortunadamente, a menudo demasiado pronto llevaron a desbordamientos de campo. En respuesta a esto, se tomaron cuatro pasos para "calmar" a los bots:</font></font><br><br><ol><li>    :        Tetris,   .      ¬´¬ª          .          .     ;     230 .  ,      Tetris   .        Single, Double  Triple.          ;        . </li><li>          .      ,   ,      7 .         . </li><li>  ,          ,           .        ,       7 . </li><li>          ,      ,      .       ,       .         ,      . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Despu√©s de aplicar todas estas reglas para "calmar" a los bots, el m√©todo PSO dio los siguientes pesos: </font></font><br><br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Par√°metro </font></font></th><th>  Peso </th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de filas despejadas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.286127095297893900 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Altura total de bloqueo </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.701233676909959200 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de c√©lulas de pozo </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.711304230768307700 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de pozos profundos </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.910665415998680400 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El n√∫mero total de agujeros en las columnas. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.879338064244357000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agujeros de columna ponderados totales </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.168463848297177000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de profundidades de agujeros en columnas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí0.265587111961757270 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Profundidad m√≠nima del agujero de columna </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.289886584949610500 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Profundidad m√°xima del agujero de columna </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.362361055261181730 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El n√∫mero total de transiciones en columnas. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí0.028668795795469625 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Saltos de l√≠nea totales </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.874179981113233100 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alturas totales de columna </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí0.507409683144361900 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Altura del mont√≥n </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí2.148676202831281000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dispersi√≥n de alturas de columna </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí1.187558540281141700 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de celdas ocupadas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí2.645656132241128000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total ponderado de celdas ocupadas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.242043416268706620 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dispersi√≥n de alturas de columna </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.287838126164431440 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dado que la cadena busca una combinaci√≥n que minimice la funci√≥n de evaluaci√≥n, los par√°metros que tienen pesos positivos pueden considerarse bonificaciones, y el resto, multas. </font><font style="vertical-align: inherit;">Pero los pesos no muestran necesariamente la importancia de los par√°metros correspondientes; </font><font style="vertical-align: inherit;">no est√°n normalizados, por lo tanto no se pueden comparar.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fuerza AI </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para evaluar la fuerza de la IA, se obtuvieron aproximadamente 1,7 millones de resultados (en puntos) de juegos simulados en una meseta de 19‚Äì28. La puntuaci√≥n no refleja el juego en el nivel 29 o superior, y no tiene en cuenta los puntos obtenidos del descenso suave. Sin embargo, incluye juegos completados prematuramente debido a desbordamientos de campo. La l√≥gica PRNG de Nintendo Tetris se utiliz√≥ para generar las secuencias de Tetrimino. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entre estos resultados, el puntaje m√°s alto es 1,313,600, el m√≠nimo es 0. El </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">promedio es 816,379 y parece ser peque√±o. Pero como se menciona a continuaci√≥n, los datos est√°n distorsionados, por lo que la puntuaci√≥n media de 989.200 puntos da una mejor idea del valor t√≠pico.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como se indic√≥ anteriormente, PSO optimiz√≥ los pesos en funci√≥n del promedio del mejor tercio de los lotes. </font><font style="vertical-align: inherit;">En este caso, el puntaje promedio del mejor tercero es 1 108 860. De hecho, el puntaje promedio del mejor 75% es 1,000,000. El </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bot tiene una probabilidad del 47% de alcanzar el l√≠mite de puntos al nivel 29. Tiene una probabilidad del 61% de obtener 900,000 puntos al nivel 29. El gr√°fico a continuaci√≥n muestra las probabilidades de anotar hasta el nivel 29.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a8/082/43a/5a808243a35de546e886bcf6cc8663aa.png" alt="densidad de probabilidad"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece que la probabilidad disminuye linealmente a unos 900,000 puntos. </font><font style="vertical-align: inherit;">Luego entra en una curva sigmoidea invertida. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A continuaci√≥n se muestra un histograma suavizado con el n√∫mero de partidos para cada uno de los puntos anotados. </font><font style="vertical-align: inherit;">Su forma est√° determinada por la derivada del gr√°fico que se muestra arriba.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b4/cf4/a7c/7b4cf4a7cfc06203bedef3b81243d20b.png" alt="histograma"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si ignora las fluctuaciones, hasta aproximadamente 900,000 es plano, y luego entra en una distribuci√≥n normal con el centro alrededor de 1,050,000 puntos. </font><font style="vertical-align: inherit;">Las razones de las fluctuaciones no est√°n claras. </font><font style="vertical-align: inherit;">Parece que la cantidad de puntos prefiere saltar en incrementos de 20,000 puntos. </font><font style="vertical-align: inherit;">Quiz√°s esto se deba al ciclo de construcci√≥n del mont√≥n y a obtener Tetris.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Asignaci√≥n de RAM y ROM </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para manipular la memoria de la CPU, transmitir clics en los botones y recibir eventos de representaci√≥n de cuadros, el complemento utiliza la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API de Nintaco</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todas las direcciones de memoria se descubrieron utilizando las herramientas de depuraci√≥n de Nintaco y se agreg√≥ informaci√≥n a la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki de Data Crystal ROMhacking.net</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En el c√≥digo fuente, se ven como constantes en la interfaz </font></font><code>Addresses</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Referencias </font></font></h1><br><ol><li> van den Bergh, F.; Engelbrecht, AP (2006) <br> A study of particle swarm optimization particle trajectories <br> In: <i>Information Sciences 176 (2006)</i> (pp. 937‚Äì971) <br> Retrieved from <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://researchspace.csir.co.za/dspace/bitstream/handle/10204/1155/van%20den%20bergh_2006_D.pdf</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421065/">https://habr.com/ru/post/es421065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421055/index.html">Desarrollo web personalizado: c√≥mo escalar en un proyecto cada vez mayor</a></li>
<li><a href="../es421057/index.html">C√≥mo ensamblar vagones para trenes de pasajeros</a></li>
<li><a href="../es421059/index.html">Acelerar los sitios con consejos tempranos</a></li>
<li><a href="../es421061/index.html">PostgreSQL: c√≥mo y por qu√© se hincha WAL</a></li>
<li><a href="../es421063/index.html">Nuevos libros sobre programaci√≥n infantil en Scratch</a></li>
<li><a href="../es421067/index.html">C√≥mo desarrollamos la aplicaci√≥n AR para revisar lugares hist√≥ricos</a></li>
<li><a href="../es421069/index.html">Bobby Urban Backpack: Inside the Castle</a></li>
<li><a href="../es421071/index.html">Mod y resto no son lo mismo</a></li>
<li><a href="../es421073/index.html">Episodio 1. Costo del pirateo</a></li>
<li><a href="../es421075/index.html">Diccionario digital de la A a la Z</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>