<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå∞ üë©üèº‚Äçüíª üâë Novamente sobre os diagramas de Voronoi üöò üë®‚Äç‚ù§Ô∏è‚Äçüë® üôÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Conforme escrito em posts recentes , lutei para obter os detalhes corretos do litoral no meu jogo Dragons Abound . Minha decep√ß√£o surgiu durante a imp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Novamente sobre os diagramas de Voronoi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439224/">  Conforme escrito em posts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recentes</a> , lutei para obter os detalhes corretos do litoral no meu jogo <b>Dragons Abound</b> .  Minha decep√ß√£o surgiu durante a implementa√ß√£o das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ilhas barreira</a> .  Para criar a ilha mais estreita poss√≠vel, criei uma localiza√ß√£o ampla - na figura abaixo, cada localiza√ß√£o √© um tri√¢ngulo de Delaunay: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5dc/cce/739/5dccce739bdcd3372876b7cff72b4f0e.png"></div><br>  Isso foi bastante desagrad√°vel - tanto porque a ilha estava muito quebrada quanto porque o tamanho das pe√ßas era muito grande.  Parecia que com um forte aumento no n√∫mero de tri√¢ngulos de Delaunay (isto √©, com uma forte diminui√ß√£o de tamanho), esse problema seria resolvido - mas a densidade de tri√¢ngulos que eu precisava levou a uma falha no navegador. <br><a name="habracut"></a><br>  Resolvi esse problema separando os contornos da terra da representa√ß√£o interna dos locais.  Isso me permitiu desenhar ilhas de qualquer tamanho ou forma, independentemente da grade de localiza√ß√£o subjacente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b2e/8a2/351/b2e8a235144cb7c07c9d374980be1782.png"></div><br>  Ent√£o o problema est√° resolvido!  Isso me permitiu desenhar as ilhas barreira e, como o litoral n√£o √© mais necess√°rio para seguir a grade b√°sica, se necess√°rio, um litoral mais detalhado pode ser criado da maneira usual e, em seguida, adicionar detalhes. <br><br>  Mas ... como adicionamos detalhes ao litoral?  N√£o √© t√£o f√°cil quanto voc√™ imagina.  Como eu queria criar um litoral fractal, considerei usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fractais para adicionar detalhes</a> ao litoral: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b3/f94/9fd/5b3f949fd2649767029f2768d55a8185.png"></div><br>  Tendo experimentado as configura√ß√µes, pude adicionar muitos detalhes e coisas interessantes ao litoral.  No entanto, o sistema n√£o p√¥de criar algo parecido com esse mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ed/03d/701/0ed03d701f34074236f314574162073f.png"></div><br>  O ru√≠do Perlin <i>pode</i> criar esse tipo de terreno se houver uma grade de base suficientemente detalhada, mas isso pode ser feito <i>sem</i> armazenar as alturas de eleva√ß√£o na grade de base com a resolu√ß√£o desejada (porque sei que isso quebrar√° meu c√≥digo)?  At√© eu descobrir como faz√™-lo.  O litoral √© essencialmente um caminho atrav√©s de todos os pontos nos quais a fun√ß√£o de ru√≠do Perlin tem um valor zero.  Embora possamos aprender diretamente com a fun√ß√£o de ru√≠do Perlin o valor em um local espec√≠fico (X, Y), n√£o podemos encontrar (digamos) "todos os locais em que a fun√ß√£o tem um valor zero".  Ou seja, √© dif√≠cil ver como desenhar um contorno de alturas sem uma grade b√°sica. <br><br>  Pior ainda, perguntei a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Amit</a> como fazer isso, e ele tamb√©m n√£o sabia a resposta.  Uma coisa √© que n√£o posso dizer isso, mas quando mesmo uma pessoa t√£o inteligente n√£o pode dar uma resposta, come√ßo a pensar que isso n√£o pode ser feito.  Isso √© triste  Posso dar √† costa a forma que precisar, mas n√£o consigo as formas necess√°rias sem uma grade de base muito detalhada. <br><br>  Ent√£o, como obtenho uma grade de alta resolu√ß√£o sem quebrar o c√≥digo? <br><br>  Uma das solu√ß√µes que me veio √† mente me lembra o que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Azgaar fez</a> em seu gerador de cart√µes - c√©lulas Voronoi de tamanho vari√°vel.  A id√©ia principal √© aumentar a densidade (e diminuir o tamanho) da malha base ao longo da costa e manter uma densidade menor nos oceanos e em outras √°reas que n√£o exigem detalhes.  Com esta op√ß√£o, terei muitas c√©lulas de malha apenas nas √°reas em que voc√™ precisa de detalhes.  Essa mudan√ßa ser√° bastante dif√≠cil de implementar em <b>Dragons Abound</b> , mas quero ponderar sobre isso.  Por outro lado, o pr√≥prio Azgaar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√£o ficou muito satisfeito com essa abordagem</a> , portanto, isso tamb√©m precisa ser levado em considera√ß√£o. <br><br>  Paralelamente, eu queria investigar as causas de uma falha do navegador ao processar uma pilha de tri√¢ngulos.  As ferramentas de desenvolvedor no Chrome me forneceram informa√ß√µes detalhadas de desempenho.  N√£o sou especialista em usar essas ferramentas, mas muitas fun√ß√µes s√£o simples o suficiente para qualquer um entender.  Caso voc√™ queira descobrir a quantidade total de mem√≥ria usada no programa, a guia Mem√≥ria cont√©m informa√ß√µes sobre a capacidade usada atualmente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ccd/da9/c31/ccdda9c31c29814b1ffa88b0ae5eefce.png"></div><br>  Nesse caso, abri a p√°gina da Web do Azgaar e ela ocupa 20 modestos de mem√≥ria.  Voc√™ pode usar esta ferramenta para descobrir quanta mem√≥ria os <b>Dragons Abundam</b> ocupam e para determinar quando a guia trava. <br><br>  O par√¢metro b√°sico que controla a resolu√ß√£o da malha subjacente em <b>Dragons Abound √©</b> habilmente chamado de "npts" (N√∫mero de pontos).  Para cada √°rea de unidade do mapa (os mapas das regi√µes que eu costumo usar como exemplos t√™m uma √°rea de 1 unidade). <b>Dragons Abound</b> cria um determinado n√∫mero de locais da grade base.  Normalmente, uso 16K (16384) para npts, o que significa que cada local da grade corresponde a aproximadamente 70 pixels quadrados da tela em uma escala de zoom padr√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73d/0a7/6ca/73d0a76ca2e25bf5c5724ef2c446b25c.png"></div><br>  Obviamente, a quantidade exata de mem√≥ria usada depende do cart√£o, mas para o cart√£o mostrado acima com 16K pontos, voc√™ precisa de aproximadamente 92 MB: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82e/f8f/8c2/82ef8f8c28678bfb47a7a642761fe11e.png"></div><br>  Isso √© menor do que eu esperava e, para ser sincero, um n√∫mero bastante modesto. <br><br>  Se voc√™ dobrar o n√∫mero de pontos na grade base, a capacidade da mem√≥ria aumentar√° para 138 MB: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/40d/beb/ad7/40dbebad7c52e1e833fef7372ac7d1d9.png"></div><br>  O tamanho da mem√≥ria ocupada n√£o dobrou, porque parte dessa mem√≥ria √© ocupada por recursos e outras estruturas de dados cujo tamanho n√£o foi alterado.  16K pontos adicionais "pesam" cerca de 50 MB de mem√≥ria, ou seja, cada ponto como resultado ocupa aproximadamente 3 KB de mem√≥ria.  Isso √© mais do que eu esperava, mas, em geral, o volume ainda √© bastante modesto.  Em um computador com 64 GB de mem√≥ria, 150 MB √© quase impercept√≠vel. <br><br>  Depois de fazer mais algumas duplas, descobri que a aba com <b>Dragons Abound</b> geralmente falha em cerca de 128K pontos.  Se o pegarmos antes de sair e verificarmos a mem√≥ria, veremos o seguinte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/718/c57/d27/718c57d27a1bce96fa73943e53196b9a.png"></div><br>  Supus que a guia travasse devido √† mem√≥ria ocupada, mas geralmente o problema n√£o est√° na mem√≥ria.  Por que a guia trava?  A √∫nica pista √© que a guia n√£o falha antes que o mapa termine, e isso √© provavelmente uma indica√ß√£o de que uma falha ocorre durante a renderiza√ß√£o. <br><br>  √â l√≥gico supor que o SVG que eu crie sobrecarregue o renderizador do navegador devido ao seu tamanho ou complexidade.  Para come√ßar, posso descobrir quantos elementos SVG crio.  No D3, posso obter o n√∫mero total de elementos SVG criados usando <code>svg.selectAll('*').size()</code> . <br><br>  Correndo a partir de 16K pontos e verificando o n√∫mero de elementos SVG me mostrou o seguinte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/14a/d15/77d/14ad1577d0e1f61b29e76bc36f57961f.png"></div><br>  32K pontos t√™m 65457 elementos e 128K pontos t√™m 258823. Cada ponto adicionado √† grade base adiciona dois elementos ao mapa.  Eu acho que encontrei uma fonte de infort√∫nio. <br><br>  Cada ponto da grade base adiciona elementos SVG devido √† maneira como os <b>Dragons Abound processam a</b> terra (e a √°gua).  O terreno √© renderizado renderizando cada local de base como um pol√≠gono preenchido, seguido de um desfoque de todos eles.  Isso permite que os <b>Dragons Abound</b> d√™em √† terra um belo padr√£o ou usem a altura da terra para renderiz√°-la com sombreamento 3D, como mostrado aqui: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/294/b56/8c4/294b568c4939a297253b4fe4172eac0b.png"></div><br>  Voc√™ pode desativar a visualiza√ß√£o de terra e oceano para verificar quantos elementos SVG s√£o criados.  Em 256K pontos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad7/e09/1e6/ad7e091e6c4c6de42207734830d508af.png"></div><br>  Uau, o n√∫mero de elementos SVG caiu significativamente.  Como eu esperava, agora o mapa √© renderizado sem bater!  Ou seja, se voc√™ evitar usar uma grade para renderizar terra e √°gua, poder√° criar uma grade muito mais densa do que antes. <br><br>  Agora que tenho uma grade de Voronoi muito mais densa, quero verificar se ela me permite gerar os elementos de al√≠vio da terra de que preciso, como ilhas costeiras.  A malha densa de Voronoi cria outros problemas (especialmente com rios), ent√£o desligarei tudo, exceto as costas, para acelerar os testes e focar neles.  Aqui est√° a renderiza√ß√£o original de algum litoral em 256K pixels e com ru√≠do padr√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c4/bad/0a0/7c4bad0a043f626a83d3edb071e5c77f.png"></div><br>  Acontece que o mapa renderiza bem e j√° cria um litoral muito mais bonito. <br><br>  Mesmo sem ajuste cuidadoso, o resultado √© muito melhor.  O barulho cria os tipos de linhas costeiras e ilhas costeiras que eu indiquei no mapa acima. <br><br>  Aqui est√£o as ilhas com um aumento de 300%: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b70/32e/471/b7032e471d8ac9c0029781799a43af56.png"></div><br>  Com esse aumento, voc√™ pode observar artefatos de tri√¢ngulos da grade base, mas, mesmo assim, as ilhas podem criar formas interessantes.  Voc√™ pode usar a suaviza√ß√£o de serrilhado (como eu fa√ßo na vers√£o atual dos mapas) para se livrar de alguns dos artefatos mais vis√≠veis dos tri√¢ngulos.  Na amplia√ß√£o padr√£o, isso proporciona uma costa menos acidentada, mas tamb√©m elimina alguns pequenos detalhes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6f/783/120/c6f78312049d55db06e1776250ce520a.png"></div><br>  Voc√™ provavelmente precisa se sintonizar para obter um meio termo. <br><br>  A maioria dos geradores de sushi processuais usa o ru√≠do Perlin para criar um mapa de altura.  Precisamos encontrar os par√¢metros de ru√≠do apropriados, selecionar uma semente e, em seguida, usar o valor do ru√≠do em cada local (x, y) para definir a massa da terra.  Um aspecto conveniente de fazer terra √© que, se voc√™ precisar de mais detalhes sobre o litoral, poder√° simplesmente ajustar os par√¢metros de ru√≠do. <br><br>  No entanto, <b>Dragons Abound</b> n√£o cria terras dessa maneira.  (Ou pelo menos cria mais do que isso.) <b>Dragons Abound</b> usa muitos m√©todos diferentes para criar sushi.  Embora todos usem o ru√≠do em um grau ou outro, muito poucos criam terra diretamente a partir do ru√≠do.  Por exemplo, o jogo possui um procedimento para criar uma ilha, que cria uma m√°scara para a ilha (geralmente uma elipse), usa ru√≠do para tornar a elipse mais natural e, em seguida, aplica um ru√≠do diferente para aproximar o preenchimento da m√°scara.  Cada mapa espec√≠fico √© geralmente criado por uma combina√ß√£o de v√°rios procedimentos diferentes.  Portanto, adicionar detalhes ajustando os par√¢metros de ru√≠do para <b>Dragons Abound</b> n√£o <b>√©</b> muito adequado. <br><br>  Para meus prop√≥sitos, √© melhor abordar o problema de um √¢ngulo um pouco diferente.  Se eu tenho um mapa de eleva√ß√£o espec√≠fico que define massas de terra, como adiciono detalhes √†s bordas dessas massas de terra?  Isso pode nos levar √† id√©ia de que precisamos reconhecer as margens das massas de terra e mascarar o resto do mapa, etc.  Mas, por outro lado, n√£o sou contra a adi√ß√£o de detalhes adicionais ao restante do mapa.  Se a terra √© um pouco mais irregular ou o fundo do oceano √© um pouco mais √°spero, isso √© normal. <br><br>  O que significa adicionar detalhes ao litoral?  Um litoral √© simplesmente uma linha de contorno na qual um mapa de altura tem um valor zero.  (O valor √© arbitr√°rio, mas esse princ√≠pio √© usado em todos os geradores de terra procedimentais.) Para tornar essa linha mais detalhada, √© necess√°rio deslocar um pouco a terra ao lado dessa linha de contorno um pouco para cima e para baixo, para que linhas costeiras simples se tornem mais complexas, partes da terra se projetem para o oceano e se tornem ilhas e assim por diante.  Mas isso n√£o deve acontecer por acaso, quero que as mudan√ßas pare√ßam naturais.  Resumimos tudo isso e parece que voc√™ precisa adicionar uma pequena quantidade de ru√≠do a todo o mapa.  E, na verdade, foi exatamente isso que fiz no exemplo original mostrado acima. <br><br>  Obviamente, isso deve ser feito com cuidado para n√£o apagar as massas de terra criadas e criar outros problemas.  Essencialmente, preciso configurar tr√™s par√¢metros. <br><br>  O primeiro √© a escala do ru√≠do.  Uma escala √© simplesmente um intervalo de valores para esse ru√≠do.  No nosso caso, quero diminuir algumas √°reas e aumentar algumas, para que a faixa de valores seja de negativa para positiva.  No entanto, n√£o quero adicionar novas montanhas ou criar um oceano longe da costa existente, portanto tornarei o valor m√°ximo (absoluto) do ru√≠do uma pequena fra√ß√£o da altura padr√£o da terra. <br><br>  O segundo par√¢metro √© a principal frequ√™ncia do ru√≠do.  A frequ√™ncia determina a rapidez com que o ru√≠do muda dentro do local.  O ru√≠do de baixa frequ√™ncia muda muito lentamente, portanto uma √°rea positiva com ru√≠do de baixa frequ√™ncia pode (por exemplo) cobrir o mapa inteiro.  O ru√≠do de alta frequ√™ncia muda rapidamente, de modo que uma regi√£o positiva com ru√≠do de alta frequ√™ncia pode (digamos) ter o tamanho de uma pequena ilha.  No nosso caso, a principal frequ√™ncia de ru√≠do determina os maiores elementos de al√≠vio que veremos no ru√≠do.  Ou seja, se eu quiser que o ru√≠do adicione (digamos) pequenas ilhas (mas nada maiores que elas) ao mapa, preciso selecionar a frequ√™ncia principal do tamanho de uma pequena ilha. <br><br>  Voc√™ pode pensar que isso √© f√°cil de fazer (basta medir uma pequena ilha e atribuir esse tamanho √† frequ√™ncia principal).  No entanto, a frequ√™ncia √© medida nas coordenadas da fun√ß√£o de ru√≠do, n√£o nas coordenadas do mapa!  Uma fun√ß√£o t√≠pica de ru√≠do pode ter um intervalo de 0 a 255 em cada coordenada, e um mapa pode ter um intervalo de -1 a 1. Em cada coordenada, o que √© pior, as coordenadas de ru√≠do s√£o reduzidas e muitos usu√°rios que usam ru√≠do nem percebem isso.  A tradu√ß√£o de uma unidade para outra e a determina√ß√£o de frequ√™ncias adequadas s√£o confusas; portanto, geralmente √© mais f√°cil experimentar apenas intervalos de frequ√™ncia e escolher a que cria os elementos do cart√£o do tamanho certo. <br><br>  O terceiro par√¢metro √© o n√∫mero de oitavas de ru√≠do.  As oitavas s√£o camadas adicionais de ru√≠do.  Cada camada geralmente dobra a frequ√™ncia e reduz pela metade a escala de ru√≠do.  Ou seja, cada nova camada adiciona elementos de al√≠vio duas vezes menos que a camada anterior, mas tamb√©m duas vezes mais fraca.  Ou seja, voc√™ precisa escolher o n√∫mero de oitavas que fornece o m√≠nimo de elementos necess√°rios e, para isso, pode ser necess√°rio ajustar a escala de ru√≠do, porque ainda √© forte o suficiente na oitava mais alta para aparecer no mapa.  Como intencionalmente fa√ßo isso para tornar as costas muito complicadas, usarei algumas oitavas de ru√≠do. <br><br>  Vamos come√ßar com a instala√ß√£o.  Para come√ßar, gerarei um mapa de exemplo sem ru√≠do adicional: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf2/e89/ce9/cf2e89ce9f62d676f9659141be032e15.png"></div><br>  Obviamente, este √© um litoral chato, com linhas suaves e apenas algumas ilhas grandes.  Aqui est√° o mesmo litoral da amostra de ru√≠do original: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/035/e88/a62/035e88a62f7f2a79fd41e573016bb3aa.png"></div><br>  O barulho mudou significativamente a forma do mapa, transformando grandes fragmentos de terra em um oceano e vice-versa.  Muitas ilhas tamb√©m apareceram, inclusive no mar.  Tudo isso indica que a escala de ru√≠do √© muito grande.  Os maiores elementos de al√≠vio individuais adicionados pelo ru√≠do devem ser do tamanho das pequenas ilhas do mapa original.  Este √© provavelmente o tamanho m√°ximo novo dos elementos, provando que a frequ√™ncia principal do ru√≠do √© aproximadamente escolhida corretamente.  Por fim, muitos pequenos detalhes apareceram, at√© os limites do tamanho da tela, e isso mostra que h√° oitavas suficientes.  (No entanto, o n√∫mero de oitavas pode ser maior que o necess√°rio. Isso n√£o afeta a apar√™ncia do cart√£o, mas √© ineficiente.) Parece que basicamente voc√™ precisa ajustar a escala de ru√≠do. <br><br>  Ajustar o ru√≠do √© uma opera√ß√£o bastante complicada, porque quero que esse ru√≠do afete principalmente terra e √°gua em uma linha de contorno com uma altura = 0. Ou seja, preciso de uma escala relativamente pequena, mas n√£o est√° claro como escolher o n√∫mero certo, porque em mapas diferentes, a distribui√ß√£o das alturas varia.  A solu√ß√£o √© encontrar a escala certa em tempo real.  Voc√™ pode pegar todos os valores absolutos das alturas no mapa, classific√°-las e encontrar o ponto de corte que seleciona (digamos) 10% dos locais em torno de zero.  Todos esses locais caem no intervalo (por exemplo) [-0,05, 0,05] e, em seguida, posso usar o valor 0,05 para determinar a escala do ru√≠do adicionado. <br><br>  (Escrevo "defini√ß√µes" porque, por v√°rias raz√µes, voc√™ n√£o pode usar apenas 0,05. Primeiro, voc√™ precisa transformar a terra em √°gua e vice-versa. A adi√ß√£o de (digamos) 0,002 a -0,05 n√£o far√° nenhuma altera√ß√£o vis√≠vel no mapa. Ou seja, o intervalo deve ser muito maior que 0,05 se eu quiser converter uma propor√ß√£o significativa de locais com uma altura de -0,05 da √°gua para a terra.Em segundo lugar, as fun√ß√µes de ru√≠do n√£o s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">distribu√≠das uniformemente</a> , portanto, com uma escala de 0,05, a fun√ß√£o de ru√≠do nunca retornar√° realmente o valor 0,05! Na pr√°tica, a dificuldade √© que a escala deve ser muito maior  do que os maiores valores que queremos ver com bastante frequ√™ncia.) <br><br>  Depois de experimentar, encontrei um valor que agrega complexidade √†s costas, sem alter√°-las significativamente, e tamb√©m cria um pequeno n√∫mero de ilhas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f9/2e5/19c/3f92e519c2370c7bbaa3338ef65a0944.png"></div><br>  Como sempre, esses par√¢metros no jogo podem levar um intervalo de valores, para que eu possa obter uma ampla variedade de mapas: de mapas com costas razoavelmente suaves a mapas com bancos complexos e quebrados.  Deixando o programa selecionar os valores, obtive o seguinte resultado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43f/275/649/43f2756497cf54b7f95aa6a8f9cd5618.png"></div><br>  As costas est√£o no lado mais suave, mas ainda h√° a maior complexidade da escala m√©dia e um n√∫mero suficiente de novas ilhas. <br><br>  Ao implementar linhas costeiras fractais, percebi a capacidade de controlar o n√≠vel de fractaliza√ß√£o usando a fun√ß√£o de ru√≠do, para que algumas √°reas tenham costas suaves, enquanto outras ter√£o linhas complexas.  Eu pensei que isso aumentaria muito o interesse do mapa e pareceria menos "gerado", ent√£o adicionarei esse recurso aqui.  A ideia √© bastante simples - antes de adicionar ru√≠do do litoral ao mapa, multiplico-o pela sa√≠da da segunda fun√ß√£o de ru√≠do, que varia de zero a 1. Onde essa fun√ß√£o √© pequena, pequenos detalhes ser√£o adicionados ao litoral.  Onde estiver pr√≥ximo de 1, detalhes adicionais ser√£o adicionados na √≠ntegra.  Selecionando a escala da segunda fun√ß√£o de ru√≠do, que varia lentamente ao longo do mapa, vou obter algumas √°reas com linhas costeiras complexas, algumas com linhas simples e transi√ß√µes l√≥gicas entre elas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/095/4a0/350/0954a03506ed074216606083654ceb08.png"></div><br>  Aqui eu ampliei os par√¢metros costeiros, para que a diferen√ßa seja mais vis√≠vel.  Vemos costas selvagens e acidentadas no nordeste e praias mais suaves no oeste. <br><br>  Portanto, melhoramos significativamente a gera√ß√£o da costa, mas ainda n√£o consigo gerar um mapa completo com tantos tri√¢ngulos em Delaunay.  Eu s√≥ mostro mapas de estrutura de t√≥picos porque muitos outros elementos do mapa est√£o quebrados.  Ele precisa ser consertado. <br><br>  O restante do programa n√£o funciona bem com tantos tri√¢ngulos de Delaunay (com as configura√ß√µes atuais de 256K).  O principal problema √© que os <b>Dragons Abound desenham</b> terra e √°gua desenhando todos os tri√¢ngulos individuais, e muitos elementos SVG fazem com que o navegador trave.  Ent√£o eu tive que desativar completamente a renderiza√ß√£o de sushi.  Provavelmente existe uma maneira de contornar esse problema, mas ter tantos tri√¢ngulos cria outros problemas.  Por exemplo, algumas partes do programa devem processar o mapa inteiro.  Cada um deles se torna dezesseis vezes mais lento em locais de 256K do que em locais de 16K.  Tamb√©m no c√≥digo, existem partes (por exemplo, um novo modelo de precipita√ß√£o) que se quebram ao trabalhar com tantos tri√¢ngulos.  E com a cria√ß√£o de uma grade t√£o detalhada de locais, n√£o ganhamos nada - depois de gerar o litoral, nada melhora com a complexidade adicional.  Portanto, embora eu possa revisar o programa e corrigir as √°reas em que um grande n√∫mero de locais diminui a velocidade ou quebra o c√≥digo muito, parece mais f√°cil reduzir a resolu√ß√£o da grade do mapa ap√≥s a cria√ß√£o de linhas costeiras. <br><br>  Como mencionado acima, Azgaar j√° realizou um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">trabalho</a> para alterar a resolu√ß√£o da grade de Voronoi subjacente ao mapa.  Ele percebeu a possibilidade de alterar a resolu√ß√£o da rede em tempo real no processo de gera√ß√£o, ou seja, ele poderia (por exemplo) aumentar a densidade de locais ao longo da costa.  No entanto, uma mudan√ßa local na densidade tem suas desvantagens - em particular, cria estranhos tri√¢ngulos ao longo da borda.  Azgaar mais tarde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sugeriu</a> que o sistema √© muito complexo e n√£o vale o esfor√ßo.  Azgaar geralmente sabe do que est√° falando, ent√£o vou aceitar a palavra dele e n√£o tentarei reembalar a malha finalizada. <br><br>  Em vez disso, criei uma segunda grade com a resolu√ß√£o (inferior) desejada e copiei o mapa de eleva√ß√£o para essa nova grade.  (N√£o se esque√ßa que <b>Dragons Abound</b> agora armazena <b>linhas</b> costeiras separadamente da grade, portanto, depois que elas s√£o criadas, elas n√£o dependem mais do ajuste exato da grade. Para fazer isso √© um pouco complicado. Como a grade original tem uma resolu√ß√£o muito mais alta que a nova, muitos locais na original a grade ser√° sobreposta em um local na nova grade. Cada um desses locais de origem tem uma altura diferente no mapa de altura, como posso copi√°-los? Usar a m√©dia? ou a altura m√°xima (m√≠nima)? <br><br>  Para come√ßar, basta selecionar um local aleat√≥rio para ver se a nova grade funciona com o restante do programa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d2/6c4/0d3/3d26c40d3b59d96dd54c98a550352dde.png"></div><br>  Tudo saiu surpreendentemente bem.  Um pequeno erro ocorre quando novos locais n√£o s√£o adequadamente marcados como terra, costa ou √°gua, mas depois de resolver esse problema, a gera√ß√£o do mapa funcionou bem.  Voc√™ precisa limpar pequenas falhas (por exemplo, a etiqueta Palmanor que saiu na √°gua), mas no geral parece boa.  At√© as pequenas ilhas ficaram lindas. <br><br>  No final, decidi que, com uma diminui√ß√£o na resolu√ß√£o da grade de Voronoi, cada local seria a m√©dia dos locais de base.  Parece uma decis√£o s√°bia e, se necess√°rio, sempre pode ser alterada.  Esta imagem mostra como, como resultado, as costas foram separadas da malha finalizada: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c40/859/805/c40859805e84a195276b4cbaeaaa0796.png"></div><br>  Para resumir: em <b>Dragons Abound</b> , uma grade de tri√¢ngulos Delone de resolu√ß√£o muito alta √© usada ao gerar o mapa de altura.  Ap√≥s sua conclus√£o, <b>Dragons Abound</b> define <b>linhas</b> costeiras rastreando transi√ß√µes de valores negativos para positivos no mapa de altura.  Em seguida, o jogo copia a grade de alta resolu√ß√£o para uma grade de resolu√ß√£o muito mais baixa, calculando a m√©dia dos locais que se enquadram em um local da nova grade.  Em seguida, a grade de alta resolu√ß√£o √© descartada e o restante da gera√ß√£o e visualiza√ß√£o de procedimentos continua na grade de baixa resolu√ß√£o.  Uma quest√£o interessante √© se o uso da malha de Delaunay tem algum valor nesse est√°gio;  pode valer a pena copiar para uma grade de hex√°gonos ou algo semelhante. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt439224/">https://habr.com/ru/post/pt439224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt439210/index.html">Java ap√≥s erup√ß√£o vulc√¢nica</a></li>
<li><a href="../pt439216/index.html">banco de dados incorpor√°vel pudge 500 linhas em golang</a></li>
<li><a href="../pt439218/index.html">VK bot no joelho, ou como agradar as pessoas em 14 de fevereiro</a></li>
<li><a href="../pt439220/index.html">Cidade grande para dispositivos m√≥veis no Unity. Experi√™ncia em desenvolvimento e otimiza√ß√£o</a></li>
<li><a href="../pt439222/index.html">O que √© gerenciamento de API?</a></li>
<li><a href="../pt439226/index.html">Scala + MXNet = Microsservi√ßo com neur√¥nio em prod</a></li>
<li><a href="../pt439232/index.html">JAMstack: Como criar seu pr√≥prio blog usando Gatsby + Contentful + Netlify</a></li>
<li><a href="../pt439234/index.html">Vida do desenvolvedor de c√≥digo aberto em GIFs</a></li>
<li><a href="../pt439236/index.html">xenvman: ambientes flex√≠veis de teste de microsservi√ßos (e mais)</a></li>
<li><a href="../pt439238/index.html">A Play Store agora aceita aplicativos da web progressivos (PWA)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>