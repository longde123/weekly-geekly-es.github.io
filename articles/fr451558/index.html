<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗞️ 👒 🕺🏿 Un jour dans la vie de l'automatisation QA 👩🏿‍⚕️ 👨🏼‍🔬 👈🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment j'ai dû devenir un peu de qa-automation: ce que j'ai ressenti, survécu et la merveilleuse architecture et infrastructure des tests automatique...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un jour dans la vie de l'automatisation QA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451558/"><p>  Comment j'ai dû devenir un peu de qa-automation: ce que j'ai ressenti, survécu et la merveilleuse architecture et infrastructure des tests automatiques à travers les yeux d'un développeur de passage. </p><a name="habracut"></a><br><h2 id="vvedenie">  Présentation </h2><br><p>  Comme on dit, je ne suis pas gynécologue, je suis juste passé et j'ai décidé de regarder.  Par conséquent, pour commencer, je vais dire sur les raisons de l'écriture.  Il me semble qu'un spécialiste ferait face au problème un ordre de grandeur plus rapidement et ne collecterait pas autant de râteau sur son chemin.  Mais il ne serait pas aussi intéressé que moi, et vous n'auriez rien à lire. </p><br><p>  Une autre raison qui m'a amené à écrire: pendant un bon moment je n'ai pas compris ce qui était si spécial dans l'infrastructure des autotests.  De plus, de nombreux managers de PM et au-dessus ne comprenaient pas pleinement ce qui est si cosmique là-bas et pourquoi les développeurs écrivent des tests unitaires pour un ou deux eux-mêmes, et pour les phycestests, des gars individuels sont pris, qui écrivent des tests plus lentement, réparent constamment quelque chose et la chance de réussir toutes les spécifications financières est strictement inférieure à 100%, à condition que l'échantillon soit suffisamment grand. </p><br><h2 id="problema">  Le problème </h2><br><p> Le troisième jour, la spécification sur le projet ferroviaire est tombée.  Quelque part une semaine auparavant, notre seul ingénieur en automatisation a décidé d'aller travailler à Chicago et nous n'avons pas encore trouvé de nouveau spécialiste.  Par conséquent, j'ai dû retrousser mes manches et faire semblant d'être QA.  À propos de comment c'était et essayez de le dire. </p><br><p>  Le problème semble assez inoffensif.  Mais, pour commencer, un peu d'histoire et de description de l'environnement.  Nous avons de nombreux sélecteurs d'adresses dans notre plateforme.  Honnêtement, c'est l'une des principales entités de la plateforme.  Les sélecteurs vont à Google api pour les données.  Dans les autotests, toutes les demandes sont bloquées afin d'économiser de l'argent et d'accélérer les tests.  De plus, un peu de logique a été ajoutée pour donner approximativement la même ligne d'adresse qui a été demandée sans passer par des services externes. </p><br><p>  Ce qui a cassé: on entre l'adresse souhaitée dans la barre d'adresse, une liste déroulante apparaît avec plusieurs options, on sélectionne celle désirée et ... la valeur de l'élément voisin est insérée dans l'entrée.  Toujours. </p><br><h2 id="dolgiy-put-k-istine">  Un long chemin vers la vérité </h2><br><h3 id="pervye-gipotezy-i-naivnyy-podhod">  Premières hypothèses et approche naïve </h3><br><p> Sans plus tarder, j'ai fait le test de chute le plus proche, trouvé la ligne sur laquelle l'adresse a été sélectionnée et j'ai commencé à l'examiner attentivement ainsi que les voisins.  La ligne semble inoffensive: <code>new_order_page.destination_address.select(baker_street)</code> .  Mais nous comprenons que derrière un beau code, il y a toujours un tas de petits dessins étranges et des entrailles désagréables. </p><br><p>  J'ai rapidement rappelé que toute cette économie fonctionne sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SitePrism</a> .  Cette chose permet d'envelopper la page et les éléments sur elle dans les méthodes class et class, respectivement.  Pour les clics et autres actions, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Capybara</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RSpec</a> sont responsables.  Mais ils n'ont aucun doute, ils sont fiables, comme toute la flotte civile.  Et si c'est le cas, la première hypothèse se suggère immédiatement: soit quelqu'un a mal écrit les sélecteurs pour le prisme, soit quelqu'un a tordu la disposition à l'avant. </p><br><p>  La première partie de l'hypothèse a rapidement disparu, les sélecteurs sont parfaitement écrits.  Aucun <code>xpath</code> avec le choix du troisième <code>li</code> à l'intérieur de l'élément n'y a été trouvé et le code lui-même n'a pas changé l'année dernière. </p><br><p>  Cependant, dans le domaine de la méthode de <code>select</code> , une logique accumulée avec des expressions régulières pour sélectionner l'option souhaitée dans la liste déroulante.  Bien sûr, je me fâche contre les regexps et je vais les vérifier.  Je passe une demi-heure et je comprends que tout fonctionne bien.  Exactement, la ligne nécessaire est sélectionnée.  <code>click</code> est appelé dessus.  Et tout devrait fonctionner.  Autrement dit, la deuxième partie de l'hypothèse de disposition disparaît également.  Mais la pensée apparaît sur la courbe <code>js</code> .  Après tout, l'élément sur la page que nous avons est personnalisé, les <code>js</code> autour de lui dans l'ordre et, de plus, dans ce <code>js</code> venons de le bricoler récemment. </p><br><h3 id="vo-vsyom-vinovat-js">  Js est à blâmer </h3><br><p>  C'est la raison standard pour tous les problèmes obscurs.  Quelque chose comme "aller à <code>js</code> , car il est déjà sous le choc."  Et, il semble, dans mon cas, ne pouvait pas non plus se passer de <code>js</code> .  En général, sans y réfléchir à deux fois, je cours vers l'équipe frontale et pointe du doigt les tests de chute, déclarant "tout fonctionne de notre côté, veuillez réparer votre côté." </p><br><p>  Mais, les gars du dandy ne sont pas un raté, ils font le tour pendant quelques heures, trouvent quelques bugs qui ne sont pas liés au récit et disent que <code>js</code> pas à blâmer!  Dans le même temps, ils lèvent des informations intéressantes selon lesquelles une demande de sélection n'est pas suffisante et il en fait une autre, dont la réponse correspond exactement au contenu incorrect de l'entrée. </p><br><p>  Je ne m'attendais pas à un tel virage.  Nous devons revenir en arrière et comprendre comment la maquette des demandes fonctionne pour nous. </p><br><h3 id="obstoyatelnyy-podhod">  Approche globale </h3><br><p>  Donc, il n'y a nulle part où attendre de l'aide, Moscou est derrière nous et des trucs comme ça. </p><br><p>  Tout d'abord, nous examinons les façons dont Moka demande à Google.  Plus précisément, nous cherchons d'abord où cela se produit.  Ce n'est pas une tâche banale.  Il s'avère que nous avons un module entier <code>MockServices::Base</code> , qui est responsable de la simulation de différentes requêtes utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VCR</a> .  Il est agenouillé adroitement dans le contrôleur de base et rien qu'en raison du nom du service responsable des demandes externes, il est introuvable. </p><br><p>  D'accord, j'ai trouvé le moki.  Nous examinons maintenant leur mise en œuvre.  La première demande est tout simplement mouillée: les informations des <code>params</code> sont prises et substituées dans le modèle avec la réponse.  Juste au cas où, j'ai vérifié le contenu des <code>params</code> et, comme prévu, tout vient comme il se doit. </p><br><p>  La méthode moka de la prochaine requête est plus intéressante.  Une sorte de <code>mock_data</code> y apparaît.  Ce ne sont pas des <code>params</code> et nous devons déterminer d'où vient cette date.  Après être tombé cinq fois en profondeur, il est révélé que ces données sont extraites de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RequestStore</a> à l'aide de la clé <code>x_mock_data</code> .  Déjà plus intéressant. </p><br><p>  Nous revenons au test d'origine et remarquons qu'il y a une chose <code>set_mock_header</code> , qui, après un examen plus approfondi, ajoute des données au même <code>RequestStore</code> .  Plus intéressant! </p><br><p>  Quelque part en ce moment, une dissonance cognitive se produit dans la tête: d’une part, c’est la cause probable du problème, les variables globales que la requête secondaire nous donne se sont brisées.  Mais il y a une nuance: le serveur pour les spécifications financières et les spécifications financières elles-mêmes sont deux processus indépendants (en fait, le serveur est au moins 3 processus), par conséquent, un débit avec crédit ne peut en aucun cas converger, car aucune variable globale entre les processus n'a encore été introduite dans ce monde.  Et avec un serveur Web multi-thread, ce sera un jeu féroce, qui ne fonctionnera pas physiquement.  Signifie que j'ai creusé quelque chose et qu'il faut chercher. </p><br><p>  Nous regardons plus loin et trouvons un certain <code>bm</code> , auquel les en-têtes reposent.  Allez-y et réalisez que <code>bm</code> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BrowserMob</a> .  Ensuite, je me suis un peu trompé, car c'est un proxy sur Java dans un wrapper ruby.  Juste un piano dans les buissons. </p><br><p>  Nous commençons à choisir plus loin et comprenons que pour les variables "globales" entre le client avec <code>rspec</code> et le serveur avec l'application (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">puma</a> ), les mêmes en <code>X-Mock-Data</code> têtes <code>X-Mock-Data</code> dans la demande sont utilisés.  Le problème est que l'application ne doit rien savoir de ces lecteurs.  Juste pour cela, vous avez besoin d'un proxy à travers lequel toutes les demandes voleront et qui se chargera de configurer les en-têtes.  Astucieusement, vous ne direz rien. </p><br><p>  Nous allons tester et découvre que cette chose ne fonctionne pas.  Les en-têtes sont introuvables: ni dans les demandes ni dans les réponses.  Mais le RequestStore est <code>rspec</code> côté <code>rspec</code> et vide du côté du serveur Web.  Cela signifie à coup sûr - c'est dans le proxy. </p><br><p>  Ensuite, entre les deux, il s'avère que nous avons non seulement des tests avec des adresses qui <code>set_mock_header</code> , mais aussi tout ce qui utilise le <code>set_mock_header</code> ci-dessus. </p><br><p>  Super.  Reste à comprendre comment y remédier. </p><br><h3 id="razbiraemsya-s-proksikom">  Nous traitons avec un proxy </h3><br><p>  Nous omettons les points de fouille dans la région où le fichier <code>jar</code> est lancé, puis le contrôlons via Ruby.  Mieux vaut prêter attention à la façon dont le proxy du navigateur est spécifié.  Nous utilisons Chrome et transmettons les informations de proxy dans l'un des nombreux arguments de la ligne de commande au démarrage.  La fonction proxy est que nous utilisons le fichier <code>pac</code> que nous générons à partir du modèle afin d'empêcher le trafic des sockets Web via le proxy. </p><br><p>  Quelque part ici, il y a un désir d'aller chercher sur Google ce qui est sur le chrome avec la configuration du proxy.  Il s'avère que vous n'avez pas besoin d'aller loin et dans la version 72+, les gars ont «terminé» son travail.  À cette occasion, ils ont même <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">apporté un bug distinct</a> .  Mon commentaire préféré: </p><br><blockquote>  "Pouvez-vous s'il vous plaît arrêter de supprimer la fonctionnalité?" </blockquote><p>  La tristesse est qu'elle est considérée comme une caractéristique et à l'avenir, elle promet encore plus d'étain en termes de "secret". </p><br><p>  En bref, Chrome ne prend plus en charge le protocole <code>file:</code> dans l'argument <code>proxy-pac-url</code> .  Les solutions sont meilleures l'une que l'autre: </p><br><ul><li>  passez l'argument <code>js</code> qui lira le fichier <code>pac</code> et le transformera en base64: <code>--proxy-pac-url='data:application/x-javascript-config;base64,'$(base64 -w0 /path/to/pac/script)</code> ; </li><li>  élevez votre serveur web en python afin de distribuer un fichier selon un protocole plus "correct", qui est supporté dans l'argument pour <code>pac</code> proxy; </li><li>  désactivez <code>NetworkService</code> , puis le <code>file:</code> protocole devrait fonctionner, mais ils promettent qu'il sera "corrigé" à l'avenir également. </li></ul><br><p>  Les deux premières options ne m'ont certainement pas inspiré et la troisième, curieusement, m'a aidé. </p><br><h2 id="nedolgaya-radost">  Joie de courte durée </h2><br><p>  Je me réjouis qu'une connexion délicate ait été trouvée entre les listes déroulantes inactives et le chrome mis à jour, je n'étais pas content pour longtemps.  Il s'avère que notre CI a mis à jour non seulement Chrome, mais aussi tous les packages adjacents, et maintenant nous avons encore plus de tests qui se <code>Selenium::WebDriver::Error::NoSuchDriverError</code> raison d'une erreur inconnue <code>Selenium::WebDriver::Error::NoSuchDriverError</code> , qui, curieusement, n'est pas liée à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chromedriver</a> , mais est liée avec une configuration chrome, des versions de bibliothèque et l'exécution de spécifications parallèles. </p><br><p>  Mais c'est la tâche du prochain jour ouvrable ... </p><br><p>  Regard vers l'avenir: l'argument <code>disable-dev-shm-usage</code> y a aidé. </p><br><h2 id="vyvody">  Conclusions </h2><br><p>  Ne grondez pas l'automatisation.  Il semble souffrir le plus de circonstances extérieures indépendantes de lui. </p><br><p>  Il vaut mieux se faire un ami de l'ingénieur en automatisation avec les développeurs, afin qu'ils organisent leur infrastructure <del>  avec préférence et courtisanes </del>  avec des versions fixes et un environnement de test contrôlé.  Pour moi, c'est mieux que de souffrir de CI propriétaire, chacun ayant ses propres béquilles et tabourets sous-marins très sophistiqués, que vous ne découvrirez qu'après une intégration étroite de votre application et des tests avec l'environnement de quelqu'un d'autre. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr451558/">https://habr.com/ru/post/fr451558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr451538/index.html">Guide de mise à l'échelle parallèle d'Amazon Redshift et résultats des tests</a></li>
<li><a href="../fr451540/index.html">Combien de développeurs ont besoin de créer un service comme Airbnb</a></li>
<li><a href="../fr451542/index.html">Comment et pourquoi avons-nous fait une reconnaissance historique dans Mail.ru Cloud</a></li>
<li><a href="../fr451552/index.html">Nous construisons des canaux de vente en réseau du gadget DO-RA</a></li>
<li><a href="../fr451556/index.html">Flutter: localisation d'applications à l'aide d'Android Studio</a></li>
<li><a href="../fr451560/index.html">Cher client, c'est pourquoi ce changement a pris autant de temps.</a></li>
<li><a href="../fr451562/index.html">Comment échapper à une secte?</a></li>
<li><a href="../fr451566/index.html">Opération TaskMasters: Comment nous avons exposé les organisations d'attaque du cyber groupe en Russie et dans la CEI</a></li>
<li><a href="../fr451570/index.html">S'installer en France pour travailler: salaires, visas et curriculum vitae</a></li>
<li><a href="../fr451572/index.html">Tendances des technologies de développement Web 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>