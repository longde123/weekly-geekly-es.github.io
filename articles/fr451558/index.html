<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóûÔ∏è üëí üï∫üèø Un jour dans la vie de l'automatisation QA üë©üèø‚Äç‚öïÔ∏è üë®üèº‚Äçüî¨ üëàüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment j'ai d√ª devenir un peu de qa-automation: ce que j'ai ressenti, surv√©cu et la merveilleuse architecture et infrastructure des tests automatique...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un jour dans la vie de l'automatisation QA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451558/"><p>  Comment j'ai d√ª devenir un peu de qa-automation: ce que j'ai ressenti, surv√©cu et la merveilleuse architecture et infrastructure des tests automatiques √† travers les yeux d'un d√©veloppeur de passage. </p><a name="habracut"></a><br><h2 id="vvedenie">  Pr√©sentation </h2><br><p>  Comme on dit, je ne suis pas gyn√©cologue, je suis juste pass√© et j'ai d√©cid√© de regarder.  Par cons√©quent, pour commencer, je vais dire sur les raisons de l'√©criture.  Il me semble qu'un sp√©cialiste ferait face au probl√®me un ordre de grandeur plus rapidement et ne collecterait pas autant de r√¢teau sur son chemin.  Mais il ne serait pas aussi int√©ress√© que moi, et vous n'auriez rien √† lire. </p><br><p>  Une autre raison qui m'a amen√© √† √©crire: pendant un bon moment je n'ai pas compris ce qui √©tait si sp√©cial dans l'infrastructure des autotests.  De plus, de nombreux managers de PM et au-dessus ne comprenaient pas pleinement ce qui est si cosmique l√†-bas et pourquoi les d√©veloppeurs √©crivent des tests unitaires pour un ou deux eux-m√™mes, et pour les phycestests, des gars individuels sont pris, qui √©crivent des tests plus lentement, r√©parent constamment quelque chose et la chance de r√©ussir toutes les sp√©cifications financi√®res est strictement inf√©rieure √† 100%, √† condition que l'√©chantillon soit suffisamment grand. </p><br><h2 id="problema">  Le probl√®me </h2><br><p> Le troisi√®me jour, la sp√©cification sur le projet ferroviaire est tomb√©e.  Quelque part une semaine auparavant, notre seul ing√©nieur en automatisation a d√©cid√© d'aller travailler √† Chicago et nous n'avons pas encore trouv√© de nouveau sp√©cialiste.  Par cons√©quent, j'ai d√ª retrousser mes manches et faire semblant d'√™tre QA.  √Ä propos de comment c'√©tait et essayez de le dire. </p><br><p>  Le probl√®me semble assez inoffensif.  Mais, pour commencer, un peu d'histoire et de description de l'environnement.  Nous avons de nombreux s√©lecteurs d'adresses dans notre plateforme.  Honn√™tement, c'est l'une des principales entit√©s de la plateforme.  Les s√©lecteurs vont √† Google api pour les donn√©es.  Dans les autotests, toutes les demandes sont bloqu√©es afin d'√©conomiser de l'argent et d'acc√©l√©rer les tests.  De plus, un peu de logique a √©t√© ajout√©e pour donner approximativement la m√™me ligne d'adresse qui a √©t√© demand√©e sans passer par des services externes. </p><br><p>  Ce qui a cass√©: on entre l'adresse souhait√©e dans la barre d'adresse, une liste d√©roulante appara√Æt avec plusieurs options, on s√©lectionne celle d√©sir√©e et ... la valeur de l'√©l√©ment voisin est ins√©r√©e dans l'entr√©e.  Toujours. </p><br><h2 id="dolgiy-put-k-istine">  Un long chemin vers la v√©rit√© </h2><br><h3 id="pervye-gipotezy-i-naivnyy-podhod">  Premi√®res hypoth√®ses et approche na√Øve </h3><br><p> Sans plus tarder, j'ai fait le test de chute le plus proche, trouv√© la ligne sur laquelle l'adresse a √©t√© s√©lectionn√©e et j'ai commenc√© √† l'examiner attentivement ainsi que les voisins.  La ligne semble inoffensive: <code>new_order_page.destination_address.select(baker_street)</code> .  Mais nous comprenons que derri√®re un beau code, il y a toujours un tas de petits dessins √©tranges et des entrailles d√©sagr√©ables. </p><br><p>  J'ai rapidement rappel√© que toute cette √©conomie fonctionne sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SitePrism</a> .  Cette chose permet d'envelopper la page et les √©l√©ments sur elle dans les m√©thodes class et class, respectivement.  Pour les clics et autres actions, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Capybara</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RSpec</a> sont responsables.  Mais ils n'ont aucun doute, ils sont fiables, comme toute la flotte civile.  Et si c'est le cas, la premi√®re hypoth√®se se sugg√®re imm√©diatement: soit quelqu'un a mal √©crit les s√©lecteurs pour le prisme, soit quelqu'un a tordu la disposition √† l'avant. </p><br><p>  La premi√®re partie de l'hypoth√®se a rapidement disparu, les s√©lecteurs sont parfaitement √©crits.  Aucun <code>xpath</code> avec le choix du troisi√®me <code>li</code> √† l'int√©rieur de l'√©l√©ment n'y a √©t√© trouv√© et le code lui-m√™me n'a pas chang√© l'ann√©e derni√®re. </p><br><p>  Cependant, dans le domaine de la m√©thode de <code>select</code> , une logique accumul√©e avec des expressions r√©guli√®res pour s√©lectionner l'option souhait√©e dans la liste d√©roulante.  Bien s√ªr, je me f√¢che contre les regexps et je vais les v√©rifier.  Je passe une demi-heure et je comprends que tout fonctionne bien.  Exactement, la ligne n√©cessaire est s√©lectionn√©e.  <code>click</code> est appel√© dessus.  Et tout devrait fonctionner.  Autrement dit, la deuxi√®me partie de l'hypoth√®se de disposition dispara√Æt √©galement.  Mais la pens√©e appara√Æt sur la courbe <code>js</code> .  Apr√®s tout, l'√©l√©ment sur la page que nous avons est personnalis√©, les <code>js</code> autour de lui dans l'ordre et, de plus, dans ce <code>js</code> venons de le bricoler r√©cemment. </p><br><h3 id="vo-vsyom-vinovat-js">  Js est √† bl√¢mer </h3><br><p>  C'est la raison standard pour tous les probl√®mes obscurs.  Quelque chose comme "aller √† <code>js</code> , car il est d√©j√† sous le choc."  Et, il semble, dans mon cas, ne pouvait pas non plus se passer de <code>js</code> .  En g√©n√©ral, sans y r√©fl√©chir √† deux fois, je cours vers l'√©quipe frontale et pointe du doigt les tests de chute, d√©clarant "tout fonctionne de notre c√¥t√©, veuillez r√©parer votre c√¥t√©." </p><br><p>  Mais, les gars du dandy ne sont pas un rat√©, ils font le tour pendant quelques heures, trouvent quelques bugs qui ne sont pas li√©s au r√©cit et disent que <code>js</code> pas √† bl√¢mer!  Dans le m√™me temps, ils l√®vent des informations int√©ressantes selon lesquelles une demande de s√©lection n'est pas suffisante et il en fait une autre, dont la r√©ponse correspond exactement au contenu incorrect de l'entr√©e. </p><br><p>  Je ne m'attendais pas √† un tel virage.  Nous devons revenir en arri√®re et comprendre comment la maquette des demandes fonctionne pour nous. </p><br><h3 id="obstoyatelnyy-podhod">  Approche globale </h3><br><p>  Donc, il n'y a nulle part o√π attendre de l'aide, Moscou est derri√®re nous et des trucs comme √ßa. </p><br><p>  Tout d'abord, nous examinons les fa√ßons dont Moka demande √† Google.  Plus pr√©cis√©ment, nous cherchons d'abord o√π cela se produit.  Ce n'est pas une t√¢che banale.  Il s'av√®re que nous avons un module entier <code>MockServices::Base</code> , qui est responsable de la simulation de diff√©rentes requ√™tes utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VCR</a> .  Il est agenouill√© adroitement dans le contr√¥leur de base et rien qu'en raison du nom du service responsable des demandes externes, il est introuvable. </p><br><p>  D'accord, j'ai trouv√© le moki.  Nous examinons maintenant leur mise en ≈ìuvre.  La premi√®re demande est tout simplement mouill√©e: les informations des <code>params</code> sont prises et substitu√©es dans le mod√®le avec la r√©ponse.  Juste au cas o√π, j'ai v√©rifi√© le contenu des <code>params</code> et, comme pr√©vu, tout vient comme il se doit. </p><br><p>  La m√©thode moka de la prochaine requ√™te est plus int√©ressante.  Une sorte de <code>mock_data</code> y appara√Æt.  Ce ne sont pas des <code>params</code> et nous devons d√©terminer d'o√π vient cette date.  Apr√®s √™tre tomb√© cinq fois en profondeur, il est r√©v√©l√© que ces donn√©es sont extraites de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RequestStore</a> √† l'aide de la cl√© <code>x_mock_data</code> .  D√©j√† plus int√©ressant. </p><br><p>  Nous revenons au test d'origine et remarquons qu'il y a une chose <code>set_mock_header</code> , qui, apr√®s un examen plus approfondi, ajoute des donn√©es au m√™me <code>RequestStore</code> .  Plus int√©ressant! </p><br><p>  Quelque part en ce moment, une dissonance cognitive se produit dans la t√™te: d‚Äôune part, c‚Äôest la cause probable du probl√®me, les variables globales que la requ√™te secondaire nous donne se sont bris√©es.  Mais il y a une nuance: le serveur pour les sp√©cifications financi√®res et les sp√©cifications financi√®res elles-m√™mes sont deux processus ind√©pendants (en fait, le serveur est au moins 3 processus), par cons√©quent, un d√©bit avec cr√©dit ne peut en aucun cas converger, car aucune variable globale entre les processus n'a encore √©t√© introduite dans ce monde.  Et avec un serveur Web multi-thread, ce sera un jeu f√©roce, qui ne fonctionnera pas physiquement.  Signifie que j'ai creus√© quelque chose et qu'il faut chercher. </p><br><p>  Nous regardons plus loin et trouvons un certain <code>bm</code> , auquel les en-t√™tes reposent.  Allez-y et r√©alisez que <code>bm</code> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BrowserMob</a> .  Ensuite, je me suis un peu tromp√©, car c'est un proxy sur Java dans un wrapper ruby.  Juste un piano dans les buissons. </p><br><p>  Nous commen√ßons √† choisir plus loin et comprenons que pour les variables "globales" entre le client avec <code>rspec</code> et le serveur avec l'application (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">puma</a> ), les m√™mes en <code>X-Mock-Data</code> t√™tes <code>X-Mock-Data</code> dans la demande sont utilis√©s.  Le probl√®me est que l'application ne doit rien savoir de ces lecteurs.  Juste pour cela, vous avez besoin d'un proxy √† travers lequel toutes les demandes voleront et qui se chargera de configurer les en-t√™tes.  Astucieusement, vous ne direz rien. </p><br><p>  Nous allons tester et d√©couvre que cette chose ne fonctionne pas.  Les en-t√™tes sont introuvables: ni dans les demandes ni dans les r√©ponses.  Mais le RequestStore est <code>rspec</code> c√¥t√© <code>rspec</code> et vide du c√¥t√© du serveur Web.  Cela signifie √† coup s√ªr - c'est dans le proxy. </p><br><p>  Ensuite, entre les deux, il s'av√®re que nous avons non seulement des tests avec des adresses qui <code>set_mock_header</code> , mais aussi tout ce qui utilise le <code>set_mock_header</code> ci-dessus. </p><br><p>  Super.  Reste √† comprendre comment y rem√©dier. </p><br><h3 id="razbiraemsya-s-proksikom">  Nous traitons avec un proxy </h3><br><p>  Nous omettons les points de fouille dans la r√©gion o√π le fichier <code>jar</code> est lanc√©, puis le contr√¥lons via Ruby.  Mieux vaut pr√™ter attention √† la fa√ßon dont le proxy du navigateur est sp√©cifi√©.  Nous utilisons Chrome et transmettons les informations de proxy dans l'un des nombreux arguments de la ligne de commande au d√©marrage.  La fonction proxy est que nous utilisons le fichier <code>pac</code> que nous g√©n√©rons √† partir du mod√®le afin d'emp√™cher le trafic des sockets Web via le proxy. </p><br><p>  Quelque part ici, il y a un d√©sir d'aller chercher sur Google ce qui est sur le chrome avec la configuration du proxy.  Il s'av√®re que vous n'avez pas besoin d'aller loin et dans la version 72+, les gars ont ¬´termin√©¬ª son travail.  √Ä cette occasion, ils ont m√™me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">apport√© un bug distinct</a> .  Mon commentaire pr√©f√©r√©: </p><br><blockquote>  "Pouvez-vous s'il vous pla√Æt arr√™ter de supprimer la fonctionnalit√©?" </blockquote><p>  La tristesse est qu'elle est consid√©r√©e comme une caract√©ristique et √† l'avenir, elle promet encore plus d'√©tain en termes de "secret". </p><br><p>  En bref, Chrome ne prend plus en charge le protocole <code>file:</code> dans l'argument <code>proxy-pac-url</code> .  Les solutions sont meilleures l'une que l'autre: </p><br><ul><li>  passez l'argument <code>js</code> qui lira le fichier <code>pac</code> et le transformera en base64: <code>--proxy-pac-url='data:application/x-javascript-config;base64,'$(base64 -w0 /path/to/pac/script)</code> ; </li><li>  √©levez votre serveur web en python afin de distribuer un fichier selon un protocole plus "correct", qui est support√© dans l'argument pour <code>pac</code> proxy; </li><li>  d√©sactivez <code>NetworkService</code> , puis le <code>file:</code> protocole devrait fonctionner, mais ils promettent qu'il sera "corrig√©" √† l'avenir √©galement. </li></ul><br><p>  Les deux premi√®res options ne m'ont certainement pas inspir√© et la troisi√®me, curieusement, m'a aid√©. </p><br><h2 id="nedolgaya-radost">  Joie de courte dur√©e </h2><br><p>  Je me r√©jouis qu'une connexion d√©licate ait √©t√© trouv√©e entre les listes d√©roulantes inactives et le chrome mis √† jour, je n'√©tais pas content pour longtemps.  Il s'av√®re que notre CI a mis √† jour non seulement Chrome, mais aussi tous les packages adjacents, et maintenant nous avons encore plus de tests qui se <code>Selenium::WebDriver::Error::NoSuchDriverError</code> raison d'une erreur inconnue <code>Selenium::WebDriver::Error::NoSuchDriverError</code> , qui, curieusement, n'est pas li√©e √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chromedriver</a> , mais est li√©e avec une configuration chrome, des versions de biblioth√®que et l'ex√©cution de sp√©cifications parall√®les. </p><br><p>  Mais c'est la t√¢che du prochain jour ouvrable ... </p><br><p>  Regard vers l'avenir: l'argument <code>disable-dev-shm-usage</code> y a aid√©. </p><br><h2 id="vyvody">  Conclusions </h2><br><p>  Ne grondez pas l'automatisation.  Il semble souffrir le plus de circonstances ext√©rieures ind√©pendantes de lui. </p><br><p>  Il vaut mieux se faire un ami de l'ing√©nieur en automatisation avec les d√©veloppeurs, afin qu'ils organisent leur infrastructure <del>  avec pr√©f√©rence et courtisanes </del>  avec des versions fixes et un environnement de test contr√¥l√©.  Pour moi, c'est mieux que de souffrir de CI propri√©taire, chacun ayant ses propres b√©quilles et tabourets sous-marins tr√®s sophistiqu√©s, que vous ne d√©couvrirez qu'apr√®s une int√©gration √©troite de votre application et des tests avec l'environnement de quelqu'un d'autre. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr451558/">https://habr.com/ru/post/fr451558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr451538/index.html">Guide de mise √† l'√©chelle parall√®le d'Amazon Redshift et r√©sultats des tests</a></li>
<li><a href="../fr451540/index.html">Combien de d√©veloppeurs ont besoin de cr√©er un service comme Airbnb</a></li>
<li><a href="../fr451542/index.html">Comment et pourquoi avons-nous fait une reconnaissance historique dans Mail.ru Cloud</a></li>
<li><a href="../fr451552/index.html">Nous construisons des canaux de vente en r√©seau du gadget DO-RA</a></li>
<li><a href="../fr451556/index.html">Flutter: localisation d'applications √† l'aide d'Android Studio</a></li>
<li><a href="../fr451560/index.html">Cher client, c'est pourquoi ce changement a pris autant de temps.</a></li>
<li><a href="../fr451562/index.html">Comment √©chapper √† une secte?</a></li>
<li><a href="../fr451566/index.html">Op√©ration TaskMasters: Comment nous avons expos√© les organisations d'attaque du cyber groupe en Russie et dans la CEI</a></li>
<li><a href="../fr451570/index.html">S'installer en France pour travailler: salaires, visas et curriculum vitae</a></li>
<li><a href="../fr451572/index.html">Tendances des technologies de d√©veloppement Web 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>