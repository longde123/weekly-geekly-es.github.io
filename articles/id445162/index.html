<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçü§ù‚Äçüë®üèº ‚õ±Ô∏è ü§≥üèΩ Selectel Penyedia Terraform ü•á üïï üëá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami meluncurkan penyedia Terraform resmi untuk bekerja dengan Selectel. Produk ini memungkinkan pengguna untuk sepenuhnya menerapkan manajemen sumber...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Selectel Penyedia Terraform</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/445162/"><img src="https://habrastorage.org/webt/yf/si/pf/yfsipfz7j0lfweuvzxwwqzqr94a.png"><br><br>  Kami meluncurkan penyedia Terraform resmi untuk bekerja dengan Selectel.  Produk ini memungkinkan pengguna untuk sepenuhnya menerapkan manajemen sumber daya melalui metodologi Infrastruktur-sebagai-kode. <br><a name="habracut"></a><br>  Saat ini, penyedia mendukung manajemen sumber daya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">layanan Virtual Private Cloud</a> (selanjutnya disebut sebagai VPC).  Di masa depan, kami berencana untuk menambahkannya ke manajemen sumber daya layanan lain yang disediakan oleh Selectel. <br><br>  Seperti yang sudah Anda ketahui, layanan VPC didasarkan pada OpenStack.  Namun, karena OpenStack tidak menyediakan alat asli untuk melayani cloud publik, kami telah mengimplementasikan fungsionalitas yang hilang dalam satu set API tambahan yang menyederhanakan pengelolaan objek komposit kompleks dan membuat pekerjaan lebih nyaman.  Bagian dari fungsi yang tersedia di OpenStack ditutup dari penggunaan langsung, tetapi dapat diakses melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">API kami</a> . <br><br>  Penyedia Selectel Terraform sekarang menyediakan kemampuan untuk mengelola sumber daya VPC berikut: <br><br><ul><li>  proyek dan kuota mereka; </li><li>  pengguna, peran dan token mereka; </li><li>  subnet publik, termasuk lintas regional dan VRRP; </li><li>  lisensi perangkat lunak. </li></ul><br>  Penyedia menggunakan perpustakaan-Go publik kami untuk bekerja dengan VPC API.  Baik perpustakaan dan penyedia itu sendiri adalah open-source, mereka sedang dikembangkan di Github: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">Go-selvpcclient</a> library repository, </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">Repositori penyedia Selectform penyedia Terraform</a> . </li></ul><br>  Untuk mengelola sumber daya cloud lainnya, seperti mesin virtual, disk, kluster Kubernetes, Anda dapat menggunakan penyedia OpenStack Terraform.  Dokumentasi resmi untuk kedua penyedia tersedia di tautan berikut: <br><br><ul><li>  Dokumentasi Sumberdaya Selectel: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">Selectform penyedia Terraform</a> , </li><li>  Dokumentasi Sumber Daya OpenStack: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow noopener noreferrer">OpenStack penyedia Terraform</a> . </li></ul><br><h2>  Memulai </h2><br>  Untuk memulai, Anda perlu menginstal Terraform (instruksi dan tautan ke paket instalasi dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow noopener noreferrer">situs web resmi</a> ). <br><br>  Agar berfungsi, penyedia memerlukan kunci Selectel API, yang dibuat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">panel kontrol untuk akun</a> . <br><br>  Manifestasi untuk bekerja dengan Selectel dibuat menggunakan Terraform atau menggunakan sekumpulan contoh siap pakai yang tersedia di repositori Github kami: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">terraform-example</a> . <br><br>  Repositori dengan contoh-contoh dibagi menjadi dua direktori: <br><br><ul><li>  <strong>modul</strong> , berisi <strong>modul</strong> kecil yang dapat digunakan kembali yang mengambil satu set parameter sebagai input dan mengelola sejumlah kecil sumber daya; </li><li>  <strong>contoh</strong> , yang berisi contoh kumpulan lengkap modul yang saling berhubungan. </li></ul><br>  Setelah menginstal Terraform, membuat kunci API Selectel dan membiasakan diri dengan contoh, kami beralih ke contoh praktis. <br><br><h2>  Contoh membuat server dengan disk lokal </h2><br>  Pertimbangkan contoh membuat proyek, pengguna dengan peran dan mesin virtual dengan disk lokal: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">terraform-contoh / contoh / vpc / server_local_root_disk</a> . <br><br>  File <strong>vars.tf</strong> menjelaskan semua parameter yang akan digunakan saat memanggil modul.  Beberapa dari mereka memiliki nilai default, misalnya, server akan dibuat di zona <strong>ru-3a</strong> dengan konfigurasi berikut: <br><br><pre><code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"server_vcpus"</span></span> { default = 4 } variable <span class="hljs-string"><span class="hljs-string">"server_ram_mb"</span></span> { default = 8192 } variable <span class="hljs-string"><span class="hljs-string">"server_root_disk_gb"</span></span> { default = 8 } variable <span class="hljs-string"><span class="hljs-string">"server_image_name"</span></span> { default = <span class="hljs-string"><span class="hljs-string">"Ubuntu 18.04 LTS 64-bit"</span></span> }</code> </pre> <br>  Dalam file <b>main.tf</b> , penyedia Selectel diinisialisasi: <br><br><pre> <code class="bash hljs">provider <span class="hljs-string"><span class="hljs-string">"selectel"</span></span> { token = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.sel_token}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  File ini juga berisi nilai default untuk kunci SSH yang akan diinstal di server: <br><br><pre> <code class="bash hljs">module <span class="hljs-string"><span class="hljs-string">"server_local_root_disk"</span></span> { ... server_ssh_key = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${file("~/.ssh/id_rsa.pub")}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  Jika perlu, Anda dapat menentukan kunci publik yang berbeda.  Kunci tidak harus ditentukan sebagai jalur ke file, Anda juga dapat menambahkan nilai sebagai string. <br><br>  Selanjutnya dalam file ini modul <strong>project_with_user</strong> dan <strong>server_local_root_disk</strong> diluncurkan, yang mengelola sumber daya yang diperlukan. <br><br>  Kami akan menganalisis modul-modul ini secara lebih rinci. <br><br><h3>  Membuat proyek dan pengguna dengan peran </h3><br>  Modul pertama membuat proyek dan pengguna dengan peran dalam proyek ini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">terraform-example / modules / vpc / project_with_user</a> . <br><br>  Pengguna yang dibuat akan dapat masuk ke OpenStack dan mengelola sumber dayanya.  Modul ini sederhana dan hanya mengelola tiga entitas: <br><br><ul><li>  selectel_vpc_project_v2, </li><li>  selectel_vpc_user_v2, </li><li>  selectel_vpc_role_v2. </li></ul><br><h3>  Membuat server virtual dengan disk lokal </h3><br>  Modul kedua mengelola objek OpenStack yang diperlukan untuk membuat server dengan disk lokal. <br><br>  Anda harus memperhatikan beberapa argumen yang ditentukan dalam modul ini untuk sumber daya <strong>openstack_compute_instance_in2</strong> : <br><br><pre> <code class="bash hljs">resource <span class="hljs-string"><span class="hljs-string">"openstack_compute_instance_v2"</span></span> <span class="hljs-string"><span class="hljs-string">"instance_1"</span></span> { ... lifecycle { ignore_changes = [<span class="hljs-string"><span class="hljs-string">"image_id"</span></span>] } vendor_options { ignore_resize_confirmation = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  Argumen <strong>ign_changes</strong> memungkinkan <strong>Anda</strong> untuk mengabaikan perubahan atribut <strong>id</strong> untuk gambar yang digunakan untuk membuat mesin virtual.  Dalam layanan VPC, sebagian besar gambar publik diperbarui secara otomatis seminggu sekali, dan <strong>id</strong> mereka juga berubah.  Ini karena fitur komponen OpenStack - Glance, di mana gambar dianggap sebagai entitas yang tidak dapat diubah. <br><br>  Jika server atau disk yang ada dibuat atau dimodifikasi yang menggunakan <strong>id</strong> gambar publik sebagai argumen <strong>image_id</strong> , maka setelah gambar ini diperbarui, memulai ulang manifes Terraform akan membuat ulang server atau disk.  Menggunakan argumen <strong>ign_changes</strong> menghindari situasi ini. <br><br>  <em>Catatan: argumen</em> <strong><em>ign_changes</em></strong> <em>muncul di Terraform sejak lama:</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">pull # 2525</a> <em>.</em> <br><br>  Argumen <strong>ign_resize_confirmation</strong> diperlukan untuk berhasil mengubah ukuran disk lokal, inti, atau memori server.  Perubahan tersebut dilakukan melalui komponen OpenStack Nova menggunakan permintaan <b>ukuran</b> .  Secara default, Nova setelah permintaan <b>pengubahan ukuran</b> menempatkan server ke status <b>verifikasi_resize</b> dan menunggu konfirmasi tambahan dari pengguna.  Namun, perilaku ini dapat diubah sehingga Nova tidak menunggu tindakan tambahan dari pengguna. <br><br>  Argumen yang ditentukan memungkinkan Terraform untuk tidak menunggu status <b>verifikasi_resize</b> untuk server dan bersiap untuk server berada dalam status aktif setelah mengubah parameternya.  Argumen ini tersedia dari versi 1.10.0 dari penyedia OpenStack Terraform: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">pull # 422</a> . <br><br><h3>  Penciptaan sumber daya </h3><br>  Sebelum memulai manifes, harus dicatat bahwa dalam contoh kami dua penyedia berbeda diluncurkan, dan penyedia OpenStack bergantung pada sumber daya penyedia Selectel, karena tidak mungkin untuk mengelola objek miliknya tanpa membuat pengguna dalam proyek.  Sayangnya, untuk alasan yang sama, kita tidak bisa menjalankan perintah <strong>terraform apply</strong> di dalam contoh kita.  Pertama-tama kita perlu <strong>mendaftar</strong> untuk modul <strong>project_with_user</strong> dan setelah itu untuk yang lainnya. <br><br>  <em>Catatan: masalah ini belum diselesaikan di Terraform, Anda dapat mengikuti diskusi tentang Github di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">edisi # 2430</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">edisi # 4149</a> .</em> <br><br>  Untuk membuat sumber daya, kita akan pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">direktori terraform -amples /amples / vpc / server_local_root_disk</a> , isinya harus seperti ini: <br><br><pre> <code class="bash hljs">$ ls README.md main.tf vars.tf</code> </pre><br>  Kami menginisialisasi modul menggunakan perintah: <br><br><pre> <code class="bash hljs">$ terraform init</code> </pre><br>  Output menunjukkan bahwa Terraform mengunduh versi terbaru dari penyedia yang digunakan dan memeriksa semua modul yang dijelaskan dalam contoh. <br><br>  Pertama, terapkan modul <strong>project_with_user</strong> .  Dalam hal ini, Anda perlu mentransfer nilai untuk variabel yang belum ditetapkan secara manual: <br><br><ul><li>  <strong>sel_account</strong> dengan nomor akun Selectel Anda; </li><li>  <strong>sel_token</strong> dengan kunci Anda untuk API Selectel; </li><li>  <strong>user_password</strong> dengan kata sandi untuk pengguna OpenStack. </li></ul><br>  Nilai untuk dua variabel pertama harus diambil dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">panel kontrol</a> . <br><br>  Untuk variabel terakhir, Anda dapat memikirkan kata sandi apa pun. <br><br>  Untuk menggunakan modul, perlu untuk mengganti nilai <strong>SEL_ACCOUNT</strong> , <strong>SEL_TOKEN</strong> dan <strong>USER_PASSWORD dengan</strong> menjalankan perintah: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user</code> </pre><br>  Setelah menjalankan perintah Terraform, itu akan menunjukkan sumber daya apa yang ingin dibuat dan akan membutuhkan konfirmasi: <br><br><pre> <code class="bash hljs">Plan: 3 to add, 0 to change, 0 to destroy. Do you want to perform these actions? Terraform will perform the actions described above. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to approve. Enter a value: yes</code> </pre><br>  Setelah proyek, pengguna, dan peran dibuat, Anda dapat mulai membuat sumber daya yang tersisa: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Saat membuat sumber daya, perhatikan output Terraform dengan alamat IP eksternal di mana server yang dibuat dapat diakses: <br><br><pre> <code class="bash hljs">module.server_local_root_disk.openstack_networking_floatingip_associate_v2.association_1: Creating... floating_ip: <span class="hljs-string"><span class="hljs-string">""</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"xxxx"</span></span></code> </pre><br>  Anda dapat bekerja dengan mesin virtual yang dibuat melalui SSH pada IP yang ditentukan. <br><br><h3>  Pengeditan sumber daya </h3><br>  Selain menciptakan sumber daya melalui Terraform, mereka juga dapat dimodifikasi. <br><br>  Sebagai contoh, tambah jumlah core dan memori untuk server kami dengan mengubah nilai untuk <strong>parameter</strong> <strong>server_vcpus</strong> dan <strong>server_ram_mb</strong> dalam <strong>contoh / file vpc / server_local_root_disk / main.tf</strong> : <br><br><pre> <code class="bash hljs">- server_vcpus = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_vcpus}</span></span></span><span class="hljs-string">"</span></span> - server_ram_mb = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_ram_mb}</span></span></span><span class="hljs-string">"</span></span> + server_vcpus = 8 + server_ram_mb = 10240</code> </pre><br>  Setelah itu, kami memeriksa perubahan apa yang akan menyebabkan penggunaan perintah berikut: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform plan</code> </pre><br>  Akibatnya, Terraform membuat perubahan pada sumber daya <strong>openstack_compute_instance_v2</strong> dan <strong>openstack_compute_flavor_v2</strong> . <br><br>  <em>Harap dicatat bahwa ini akan menghasilkan reboot mesin virtual yang dibuat.</em> <br><br>  Untuk menerapkan konfigurasi mesin virtual baru, gunakan perintah <strong>terraform apply</strong> , yang sudah kita jalankan sebelumnya. <br><br>  Semua objek yang dibuat akan ditampilkan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">panel kontrol VPC</a> : <br><br><img src="https://habrastorage.org/webt/eq/e5/3a/eqe53anrxqpnpd6qn7hlcrnuxec.png"><br><br>  Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">repositori contoh</a> kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">,</a> Anda juga dapat melihat manifes untuk membuat mesin virtual dengan drive jaringan. <br><br><h2>  Contoh Kubernetes Cluster </h2><br>  Sebelum melanjutkan ke contoh berikutnya, kami akan menghapus sumber yang dibuat sebelumnya.  Untuk melakukan ini, di root proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">terraform-contoh / contoh / vpc / server_local_root_disk,</a> jalankan perintah untuk menghapus objek OpenStack: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.server_local_root_disk</code> </pre><br>  Selanjutnya, jalankan perintah Selectel VPC API Object Cleanup: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.project_with_user</code> </pre><br>  Dalam kedua kasus, Anda harus mengonfirmasi penghapusan semua objek: <br><br><pre> <code class="bash hljs">Do you really want to destroy all resources? Terraform will destroy all your managed infrastructure, as shown above. There is no undo. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to confirm. Enter a value: yes</code> </pre><br>  Contoh berikut adalah dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">direktori terraform -amples /amples / vpc / kubernetes_cluster</a> . <br><br>  Contoh ini membuat proyek, pengguna dengan peran dalam proyek, dan memunculkan satu cluster Kubernetes.  Di file <strong>vars.tf</strong> , <strong>Anda</strong> dapat melihat nilai default, seperti jumlah node, karakteristiknya, versi Kubernetes, dan lainnya. <br><br>  Untuk membuat sumber daya, mirip dengan contoh pertama, hal pertama yang akan kita lakukan adalah menginisialisasi modul dan membuat sumber daya modul <strong>project_with_user</strong> , dan kemudian membuat sisanya: <br><br><pre> <code class="bash hljs">$ terraform init $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Kami meneruskan pembuatan dan pengelolaan kluster Kubernetes melalui komponen OpenStack Magnum.  Anda dapat mempelajari lebih lanjut tentang cara bekerja dengan cluster di salah satu artikel kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">sebelumnya</a> , serta di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">basis pengetahuan</a> . <br><br>  Selama persiapan cluster, disk, mesin virtual akan dibuat dan semua komponen yang diperlukan akan diinstal.  Persiapan memakan waktu sekitar 4 menit, di mana Terraform akan menampilkan pesan-pesan dari formulir: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Still creating... (3m0s elapsed)</code> </pre><br>  Setelah instalasi selesai, Terraform akan memberi tahu Anda bahwa cluster sudah siap dan menampilkan pengenalnya: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Creation complete after 4m20s (ID: 3c8...) Apply complete! Resources: 6 added, 0 changed, 0 destroyed.</code> </pre><br>  Untuk mengelola cluster Kubernetes yang dibuat melalui utilitas kubectl, <strong>Anda</strong> harus mendapatkan file akses cluster.  Untuk melakukan ini, buka proyek yang dibuat melalui Terraform dalam daftar proyek di akun Anda: <br><br><img src="https://habrastorage.org/webt/pp/7y/rt/pp7yrtw_q-79pkx1j6mr5ebbsyi.png"><br><br>  Selanjutnya, ikuti tautan dari form <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">xxxxxx.selvpc.ru</a> , yang ditampilkan di bawah nama proyek: <br><br><img src="https://habrastorage.org/webt/yr/in/wk/yrinwkfne83cenropq9t3szxt6c.png"><br><br>  Gunakan nama pengguna dan kata sandi yang dibuat melalui Terraform sebagai informasi login.  Jika Anda tidak mengubah <strong>vars.tf</strong> atau <strong>main.tf</strong> untuk contoh kami, maka pengguna akan memiliki nama <strong>tf_user</strong> .  Sebagai kata sandi, gunakan nilai variabel <strong>TF_VAR_user_password</strong> , yang ditentukan saat <strong>terraform berlaku</strong> dijalankan sebelumnya. <br><br>  Di dalam proyek, Anda harus pergi ke tab <strong>Kubernetes</strong> : <br><br><img src="https://habrastorage.org/webt/ft/bp/dj/ftbpdjhjrgxkgzomuxegaujj3wu.png"><br><br>  Berikut ini adalah cluster yang dibuat melalui Terraform.  Anda dapat mengunduh file untuk <strong>kubectl</strong> pada tab ‚ÄúAccess‚Äù: <br><br><img src="https://habrastorage.org/webt/y_/pe/ov/y_peovkv0kjznzx95c_vw4wc-4e.png"><br><br>  Tab yang sama berisi instruksi untuk menginstal <strong>kubectl</strong> dan menggunakan <strong>config.yaml yang</strong> diunduh. <br><br>  Setelah memulai <strong>kubectl</strong> dan mengatur variabel lingkungan <strong>KUBECONFIG,</strong> Anda dapat menggunakan Kubernetes: <br><br><pre> <code class="bash hljs">$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-9578f5c87-g6bjf 1/1 Running 0 8m kube-system coredns-9578f5c87-rvkgd 1/1 Running 0 6m kube-system heapster-866fcbc879-b6998 1/1 Running 0 8m kube-system kube-dns-autoscaler-689688988f-8cxhf 1/1 Running 0 8m kube-system kubernetes-dashboard-7bdb5d4cd7-jcjq9 1/1 Running 0 8m kube-system monitoring-grafana-84c97bb64d-tc64b 1/1 Running 0 8m kube-system monitoring-influxdb-7c8ccc75c6-dzk5f 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-0 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-1 1/1 Running 0 8m kube-system openstack-cloud-controller-manager-8vrmp 1/1 Running 3 8m prometeus-monitoring grafana-76bcb7ffb8-4tm7t 1/1 Running 0 8m prometeus-monitoring prometheus-75cdd77c5c-w29gb 1/1 Running 0 8m</code> </pre><br>  Jumlah node cluster mudah diubah melalui Terraform. <br>  Nilai berikut ditentukan dalam file <strong>main.tf</strong> : <br><br><pre> <code class="bash hljs">cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><p>  Nilai ini diganti dari <strong>vars.tf</strong> : </p><br><br><pre> <code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"cluster_node_count"</span></span> { default = 2 }</code> </pre><br>  Anda dapat mengubah nilai default di <strong>vars.tf</strong> , atau menentukan nilai yang diperlukan langsung di <strong>main.tf</strong> : <br><br><pre> <code class="bash hljs">- cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span> + cluster_node_count = 3</code> </pre><br>  Untuk menerapkan perubahan, seperti pada contoh pertama, gunakan perintah <strong>terraform apply</strong> : <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Ketika jumlah node berubah, cluster akan tetap tersedia.  Setelah menambahkan simpul melalui Terraform, Anda dapat menggunakannya tanpa konfigurasi tambahan: <br><br><pre> <code class="bash hljs">$ kubectl get nodes NAME STATUS ROLES AGE VERSION tf-cluster-rz6nggvs4va7-master-0 Ready,SchedulingDisabled master 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-0 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-1 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-2 Ready &lt;none&gt; 3m v1.12.4</code> </pre><br><h2>  Kesimpulan </h2><br>  Pada artikel ini, kami belajar tentang cara dasar untuk bekerja dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">"Virtual Private Cloud"</a> melalui Terraform.  Kami akan senang jika Anda menggunakan Selectel penyedia Terraform resmi dan memberikan umpan balik. <br><br>  Semua bug yang ditemukan dari penyedia Terraform Selectel dapat dilaporkan melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener noreferrer">Masalah Github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id445162/">https://habr.com/ru/post/id445162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id445152/index.html">Apa lagi yang bisa dilakukan dalam pencarian? Laporan Yandex</a></li>
<li><a href="../id445154/index.html">Acara digital di Moskow dari 25 Maret hingga 31 Maret</a></li>
<li><a href="../id445156/index.html">Glenmark compact nebulizer: hal yang berguna dalam kehidupan sehari-hari</a></li>
<li><a href="../id445158/index.html">Orientasi Bagian Optimal dan Konfigurasi Dukungan pada Printer 3D</a></li>
<li><a href="../id445160/index.html">Kami mengembangkan firmware pedal untuk belajar memainkan balalaika</a></li>
<li><a href="../id445164/index.html">Performa situs seimbang. Bagian 5: Kegunaan</a></li>
<li><a href="../id445166/index.html">Semua yang Perlu Anda Ketahui Tentang Hyphenation Otomatis CSS</a></li>
<li><a href="../id445168/index.html">Resume ideal yang akan disambut oleh perekrut dan pemberi kerja</a></li>
<li><a href="../id445170/index.html">Tiga Kebohongan Besar tentang JavaScript</a></li>
<li><a href="../id445172/index.html">Browser tepi dengan Chromium muncul di layanan hosting file</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>