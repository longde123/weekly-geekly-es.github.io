<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙋 💊 🤲🏽 Catatan Kalibrasi Sensor Posisi Rumah ⛩️ 🌃 🌷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa sensor akselerasi memerlukan kalibrasi nol tambahan setelah pemasangan di papan. Ketika saya melihat beberapa sumber dengan kalibrasi sensor ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Catatan Kalibrasi Sensor Posisi Rumah</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384075/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa sensor akselerasi memerlukan kalibrasi nol tambahan setelah pemasangan di papan. </font><font style="vertical-align: inherit;">Ketika saya melihat beberapa sumber dengan kalibrasi sensor akselerasi, di mana komponen G diperhitungkan hanya dengan mengurangi nilai = 9,8 m / s2 dari sumbu Z, muncul ide untuk menulis catatan ini.</font></font><br>
<br>
<img src="https://habrastorage.org/files/b4d/dcb/c3b/b4ddcbc3ba4d4e2dbd467eeab056db2d.jpg"><br>
<a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Struktur publikasi</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pernyataan masalah dan metode solusi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara mendapatkan poin?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara menghitung bagian tengah bola?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara mempercepat pencarian pusat bola?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana lagi untuk mempercepat pencarian pusat bola?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentang kesalahan pengukuran</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></li>
</ul><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa masalahnya - Sensor MEMS setelah pemasangan di papan mengalami deformasi kecil yang memengaruhi:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">posisi nol;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">penskalaan nilai yang diukur;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tegak lurus sumbu satu sama lain.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan jika scaling dan tegak lurus dilanggar tidak begitu terasa, maka posisi nol akan kusut secara nyata. Misalnya, jika Anda menerjemahkan nilai khas dari offset nol untuk accelerometer sensor MPU9250 menjadi m / s </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka ini diperoleh di wilayah 0,2 m / s </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Artinya, sensornya diam, tetapi menunjukkan akselerasi, dan setelah 5 detik kita mendapatkan kecepatan 1 m / s. Di satu sisi, semua data sensor selalu melewati beberapa jenis filter (misalnya, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seperti itu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Tetapi di sisi lain, mengapa filter harus secara konstan mengimbangi bias ini? Setelah semua, sensor akan menunjukkan gerakan di tempat yang tidak. Ini mengurangi akurasi hasil. Secara keseluruhan, Anda perlu menemukan nilai offset sekali dan kemudian kurangi nilai ini dari pembacaannya selama operasi sensor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi paling sederhana untuk menemukan nilai zero offset, yang langsung muncul di benak, adalah menciptakan kondisi di mana sensor harus secara akurat menunjukkan nol. Nilai yang terekam pada sensor adalah nilai zero offset! Begitu? Tapi tidak - gravitasi terus bekerja pada accelerometer. Untuk menghindarinya, bobot akan dibutuhkan (melempar tidak akan berhasil). Medan magnet Bumi bekerja pada kompas, dan perputarannya di giroskop. Jadi jika Anda tidak memiliki kapal luar angkasa pribadi, Anda harus membuat sesuatu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi kedua yang langsung terlintas dalam pikiran adalah menempatkan sensor (atau lebih tepatnya porosnya) pada posisi di mana kita akan tahu persis apa yang harus ditunjukkan oleh sensor. Perbedaan antara apa yang ditunjukkan oleh sensor dan apa yang seharusnya ditampilkan - dan akan ada offset nol! Begitu? Sebagai contoh, kita tahu bahwa jika accelerometer ditempatkan pada level dengan horizon, maka secara teori, vektor percepatan gravitasi akan diarahkan tepat di sepanjang sumbu Z sensor. Besarnya vektor percepatan yang kita tahu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, ada masalah. </font><font style="vertical-align: inherit;">Terdiri dari fakta bahwa kita tidak dapat secara tepat mengatur sumbu sensor ke level dengan horizon. </font><font style="vertical-align: inherit;">Faktanya adalah bahwa permukaan yang akan kita andalkan tidak sejajar dengan papan sirkuit tercetak. </font><font style="vertical-align: inherit;">Itu, pada gilirannya, tidak sejajar dengan situs di mana sensor berada. </font><font style="vertical-align: inherit;">Sensor itu sendiri tidak berdiri tepat di tempatnya dan sumbu di dalam sensor tidak sejajar dengan badan sensor. </font><font style="vertical-align: inherit;">Kesalahan dalam menyetel sumbu relatif terhadap cakrawala sebesar 1 derajat memberikan proyeksi yang sebanding ukurannya dengan nilai titik nol itu sendiri, yang ingin kami temukan. </font><font style="vertical-align: inherit;">Dalam kasus magnetometer, kami juga tidak tahu di mana vektor medan magnet diarahkan. </font><font style="vertical-align: inherit;">Secara teori, ke utara. </font><font style="vertical-align: inherit;">Namun dalam praktiknya, medan magnet Bumi itu sendiri heterogen dalam intensitas dan arahnya. </font><font style="vertical-align: inherit;">Plus, benda-benda logam di dekatnya membuat penyesuaian.</font></font><br>
<img src="https://habrastorage.org/files/62a/4e5/7e2/62a4e57e29a24a389b1fddf12a652219.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pernyataan masalah dan metode solusi</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tugasnya adalah sebagai berikut: kita perlu menentukan vektor perpindahan nol menggunakan sensor, yang akan selalu merekam vektor perpindahan + vektor dampak eksternal konstan (percepatan gravitasi, rotasi bumi, medan magnet Bumi), besarnya dan arah yang tidak kita ketahui (dalam kasus akselerometer kita tahu nilainya, tetapi sekali lagi skala sensor mungkin tidak sama dengan 1). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara memecahkannya. </font><font style="vertical-align: inherit;">Artikel ini mengusulkan untuk menentukan vektor perpindahan sebagai berikut. </font><font style="vertical-align: inherit;">Kami mengambil dan memutar sensor dengan segala cara dan mendaftarkan pembacaan sensor. </font><font style="vertical-align: inherit;">Setelah pengukuran N, nilai-nilai yang diambil dari sensor dan terletak pada grafik akan menjadi bola, jari-jari yang besarnya dampak eksternal, dan pusat adalah nol offset yang diinginkan tepat.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara mendapatkan poin?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memudahkan prosedur pengukuran itu sendiri, Anda dapat menulis program sederhana. </font><font style="vertical-align: inherit;">Seharusnya merekam sensor ketika perangkat stasioner. </font><font style="vertical-align: inherit;">Kami hanya perlu mengubah perangkat ke posisi yang diinginkan. </font><font style="vertical-align: inherit;">Untuk menentukan keadaan stasioner, accelerometer yang tidak dikalibrasi juga cocok - ambil saja selisih antara nilai saat ini dan yang sebelumnya. </font><font style="vertical-align: inherit;">Dan jika ada lebih banyak suara, maka kita perbaiki gerakannya. </font><font style="vertical-align: inherit;">Ambang saya diperoleh di wilayah 0,07G. </font><font style="vertical-align: inherit;">Jika Anda memegang dengan tangan Anda, lebih dari nilai ini akan berubah. </font><font style="vertical-align: inherit;">Saya menggunakan selotip untuk memperbaiki posisi. </font><font style="vertical-align: inherit;">Jika masih tidak berhasil, periksa untuk melihat apakah ada lemari es, kipas angin atau sesuatu yang serupa di dekatnya.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana bisa dalam kode</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">//       </span>
<span class="hljs-keyword">static</span> TSumSensorsData 	g_sens_data[<span class="hljs-number">2</span>];
<span class="hljs-keyword">static</span> <span class="hljs-keyword">int32_t</span>   	g_sens_data_sum_cnt[<span class="hljs-number">2</span>];
<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint8_t</span>		g_sens_data_num;<font></font>
<font></font>
<span class="hljs-comment">//  - ,     </span>
<span class="hljs-function">IS_INTERRUPT <span class="hljs-keyword">void</span> <span class="hljs-title">on_dma_raw_ready_calibrate_step1</span><span class="hljs-params">()</span>
</span>{<font></font>
	SensorRawBuffer *raw = sensor_get_raw_buffer();<font></font>
	g_sens_data[g_sens_data_num].acc_x += swap_i16(raw-&gt;accell_x_unswap);<font></font>
	g_sens_data[g_sens_data_num].acc_y += swap_i16(raw-&gt;accell_y_unswap);<font></font>
	g_sens_data[g_sens_data_num].acc_z += swap_i16(raw-&gt;accell_z_unswap);<font></font>
	g_sens_data[g_sens_data_num].gyro_x += swap_i16(raw-&gt;gyro_x_unswap);<font></font>
	g_sens_data[g_sens_data_num].gyro_y += swap_i16(raw-&gt;gyro_y_unswap);<font></font>
	g_sens_data[g_sens_data_num].gyro_z += swap_i16(raw-&gt;gyro_z_unswap);<font></font>
	g_sens_data[g_sens_data_num].mag_x += raw-&gt;mag_x_raw * g_mag_calibrate.kx;<font></font>
	g_sens_data[g_sens_data_num].mag_y += raw-&gt;mag_y_raw * g_mag_calibrate.ky;<font></font>
	g_sens_data[g_sens_data_num].mag_z += raw-&gt;mag_z_raw * g_mag_calibrate.kz;<font></font>
	g_sens_data_sum_cnt[g_sens_data_num]++;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   main</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sensors_calibrate_program</span><span class="hljs-params">(FlashROM *flash_ptr)</span>
</span>{
	<span class="hljs-keyword">double</span> calibrate_result_error[<span class="hljs-number">3</span>];<font></font>
	TVector16 calibrate_result[<span class="hljs-number">3</span>];
	<span class="hljs-keyword">int32_t</span> radius[ACCEL_NO_MOTION_DETECT_COUNT];
	<span class="hljs-keyword">uint8_t</span> raw_is_deleted[ACCEL_NO_MOTION_DETECT_COUNT];<font></font>
	TVector16 raw[<span class="hljs-number">3</span>][ACCEL_NO_MOTION_DETECT_COUNT];<font></font>
	<font></font>
        . . .<font></font>
<font></font>
	<span class="hljs-comment">//  </span>
	g_sens_data_sum_cnt[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<font></font>
	g_sens_data_num = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int16_t</span> prev_avg_x = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int16_t</span> prev_avg_y = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int16_t</span> prev_avg_z = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int8_t</span> low_motion_cnt = <span class="hljs-number">0</span>;<font></font>
<font></font>
	<span class="hljs-keyword">while</span>(low_motion_cnt &lt; ACCEL_NO_MOTION_DETECT_COUNT)<font></font>
	{<font></font>
		<span class="hljs-keyword">if</span> (g_sens_data_sum_cnt[g_sens_data_num] &gt;= ACCEL_NO_MOTION_DETECT_SAMPLES)<font></font>
		{<font></font>
			<span class="hljs-keyword">uint8_t</span> new_data_num = (g_sens_data_num + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">1</span>;<font></font>
			g_sens_data[new_data_num].acc_x = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].acc_y = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].acc_z = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].gyro_x = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].gyro_y = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].gyro_z = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].mag_x = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].mag_y = <span class="hljs-number">0</span>;<font></font>
			g_sens_data[new_data_num].mag_z = <span class="hljs-number">0</span>;<font></font>
			g_sens_data_sum_cnt[new_data_num] = <span class="hljs-number">0</span>;<font></font>
<font></font>
			<span class="hljs-keyword">uint8_t</span> old_data_num = g_sens_data_num;<font></font>
			g_sens_data_num = new_data_num; <span class="hljs-comment">//           </span>
			<span class="hljs-comment">// ( -    ,   )</span><font></font>
<font></font>
			<span class="hljs-comment">//     -  </span>
			<span class="hljs-keyword">int16_t</span> avg_x = g_sens_data[old_data_num].acc_x / g_sens_data_sum_cnt[old_data_num];
			<span class="hljs-keyword">int16_t</span> avg_y = g_sens_data[old_data_num].acc_y / g_sens_data_sum_cnt[old_data_num];
			<span class="hljs-keyword">int16_t</span> avg_z = g_sens_data[old_data_num].acc_z / g_sens_data_sum_cnt[old_data_num];<font></font>
<font></font>
			<span class="hljs-comment">//      </span>
			<span class="hljs-keyword">int16_t</span> dx = avg_x - prev_avg_x;
			<span class="hljs-keyword">int16_t</span> dy = avg_y - prev_avg_y;
			<span class="hljs-keyword">int16_t</span> dz = avg_z - prev_avg_z;<font></font>
			prev_avg_x = avg_x;<font></font>
			prev_avg_y = avg_y;<font></font>
			prev_avg_z = avg_z;<font></font>
<font></font>
			<span class="hljs-comment">//     </span>
			<span class="hljs-keyword">if</span> ((abs_i16(dx) &lt;= ACCEL_NO_MOTION_DETECT_AVG_VALUE)&amp;&amp;(abs_i16(dy) &lt;= ACCEL_NO_MOTION_DETECT_AVG_VALUE)&amp;&amp;(abs_i16(dz) &lt;= ACCEL_NO_MOTION_DETECT_AVG_VALUE))<font></font>
			{<font></font>
				<span class="hljs-comment">//    </span><font></font>
				raw[RAW_ACC][low_motion_cnt].x = avg_x;<font></font>
				raw[RAW_ACC][low_motion_cnt].y = avg_y;<font></font>
				raw[RAW_ACC][low_motion_cnt].z = avg_z;<font></font>
				raw[RAW_GYRO][low_motion_cnt].x = g_sens_data[old_data_num].gyro_x / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_GYRO][low_motion_cnt].y = g_sens_data[old_data_num].gyro_y / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_GYRO][low_motion_cnt].z = g_sens_data[old_data_num].gyro_z / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_MAG][low_motion_cnt].x = g_sens_data[old_data_num].mag_x / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_MAG][low_motion_cnt].y = g_sens_data[old_data_num].mag_y / g_sens_data_sum_cnt[old_data_num];<font></font>
				raw[RAW_MAG][low_motion_cnt].z = g_sens_data[old_data_num].mag_z / g_sens_data_sum_cnt[old_data_num];<font></font>
<font></font>
				low_motion_cnt++;<font></font>
<font></font>
				<span class="hljs-comment">//   </span><font></font>
				beep();<font></font>
<font></font>
				<span class="hljs-comment">//     2   ,     -   </span>
				<span class="hljs-comment">//  -  </span>
				<span class="hljs-comment">//      </span>
				delay_ms(<span class="hljs-number">2000</span>);<font></font>
			}<font></font>
		}<font></font>
	}<font></font>
. . .<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mendapatkan bola pada grafik, Anda perlu memutar perangkat dengan sensor sesuai skema tertentu. </font><font style="vertical-align: inherit;">Untuk tujuan ini, globe sangat cocok, karena memiliki markup. </font><font style="vertical-align: inherit;">Anda mungkin berpikir bahwa Anda perlu membuat patung di seluruh dunia. </font><font style="vertical-align: inherit;">Tapi ini tidak benar.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh hasil yang salah</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/3b4/db9/bdf/3b4db9bdff434974b8616d24153755a1.png"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penting untuk memahat sensor tidak pada seluruh permukaan globe, tetapi pada satu meridian. </font><font style="vertical-align: inherit;">Misalkan kita mengambil tujuh titik pada meridian (yang pertama dan terakhir di kutub utara dan selatan). </font><font style="vertical-align: inherit;">Di setiap titik meridian, kami memasang perangkat Anda ke globe dan masih memutar perangkat di sekitar porosnya dengan langkah tertentu, misalnya 30-35 derajat. </font><font style="vertical-align: inherit;">Ternyata jika Anda memutar 12 kali di sekitar porosnya, maka pada 7 titik total 84 pengukuran diperoleh. </font></font><br>
<br>
<img src="https://habrastorage.org/files/dfb/5df/1e5/dfb5df1e5107458e8560d939b6a5cd9a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keindahan metode ini adalah bahwa segala sesuatu dapat dilakukan "di lutut". </font><font style="vertical-align: inherit;">Akurasi posisi tidak memainkan peran khusus, Anda hanya perlu memutar sesuai skema sehingga vektor pengaruh eksternal pada grafik menarik bola. </font><font style="vertical-align: inherit;">Yang benar terlihat seperti ini - lihat gambar (tengah ditandai dengan tanda).</font></font><br>
<br>
<img src="https://habrastorage.org/files/2d4/8e8/3a3/2d48e83a3c784bdb8736b86e4b3f6d87.gif"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara menghitung bagian tengah bola?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah tugas yang menarik dan memiliki beberapa solusi. Tampaknya untuk mencari pusat, cukup untuk mengambil rata-rata aritmatika dari koordinat poin yang diperoleh. Namun, ini tidak demikian - poin-poinnya bisa terletak tidak rata pada bola (lihat Gambar.). </font></font><br>
<br>
<img src="https://habrastorage.org/files/eda/0cd/9d2/eda0cd9d222e401ca3898d108182fbd8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Persamaan bola terlihat seperti ini: (X - A) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + (Y - B) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + (Z - C) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = R </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , di mana X, Y, Z adalah koordinat dari titik berbaring di bola. A, B, C adalah koordinat pusat pada sumbu x, y, dan z. R adalah jari-jari bola. Anda dapat membangun sistem persamaan dan mencoba menyelesaikan sistem ini lebih sederhana menggunakan beberapa metode. Atau Anda bisa langsung menemukan pusatnya (ini seperti metode perkiraan yang berurutan). Arti metode ini sederhana: nilai kesalahan (X - A) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + (Y - B) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ (Z - C) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - R </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> harus cenderung nol. Ini berarti bahwa jumlah jumlah ini untuk semua titik bola juga harus cenderung nol. Mengetahui hal ini, kita dapat memilih nilai A, B, dan C yang kesalahannya minimal untuk semua poin. Area pencarian dibatasi oleh ukuran bola (kubus kondisional). Artinya, kita harus secara berurutan meletakkan pusat bola di semua titik kubus dan menghitung kesalahannya. Di mana ada kesalahan minimal - ada pusatnya. </font></font><br>
<br>
<img src="https://habrastorage.org/files/d53/d46/4d5/d53d464d57c0411790594a6df5a45ca1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai R, kita perlu mengambil nilai teoritis dari vektor pengaruh luar - untuk akselerometer, ini adalah percepatan gravitasi, untuk kompas - ini adalah besarnya rata-rata medan magnet bumi, untuk giroskop - kecepatan rotasi Bumi. Tentu saja, dalam rumus harus ada nilai satu dimensi (unit konvensional sensor atau m / s </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, derajat / s, dll.). </font><font style="vertical-align: inherit;">Lebih mudah mengonversi ke unit arbitrary dari sensor yang sesuai.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara menghitung nilai tertentu dalam unit standar sensor?</font></font></b><div class="spoiler_text">   =  *   / (   —   )<br>
:      16-      ±2g        ?: <br>
9,8 /<sup>2</sup> * 65536 / (2g + 2g) = 9,8 /<sup>2</sup> * 65536 / (2 * 9,8 /<sup>2</sup> + 2 * 9,8 /<sup>2</sup>) = 16384 . . .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ngomong-ngomong, jika Anda tahu jari-jari bola dengan tepat, maka Anda dapat menghitung pusat hanya dengan "baji". </font><font style="vertical-align: inherit;">Yaitu, pada titik-titik yang terletak hanya pada selembar permukaan bola. </font><font style="vertical-align: inherit;">Tapi ini bukan kasus kami.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara mempercepat pencarian pusat bola?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penting untuk mencari pusat bukan di seluruh kubus (dimensi bola), tetapi sepanjang garis yang permulaannya sewenang-wenang, setiap titik berikutnya lebih dekat ke pusat nyata dan ujungnya di tengah. </font><font style="vertical-align: inherit;">Misalkan kita mulai dari titik (0; 0; 0) ... Kita selalu bergerak dengan langkah yang konstan. </font><font style="vertical-align: inherit;">Oleh karena itu, jika kita membayangkan satu set kubus 3x3x3, di mana setiap wajah sama dengan ukuran langkah dan juga membayangkan bahwa posisi saat ini adalah kubus tengah, maka kita memiliki 9 + 8 + 9 opsi tempat untuk meletakkan titik berikutnya. </font><font style="vertical-align: inherit;">Kita hanya harus berada di setiap titik, untuk menghitung di mana dari 26 titik tetangga kesalahannya akan lebih kecil. </font><font style="vertical-align: inherit;">Jika ternyata kesalahannya kurang pada titik saat ini, dan bukan di salah satu yang tetangga, maka itu berarti bahwa itu adalah di tengah dan pencarian sudah selesai.</font></font><br>
<br>
<img src="https://habrastorage.org/files/ba5/4dd/8d4/ba54dd8d423e4323a643cb4653361f1a.bmp"><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana bisa dalam kode</font></font></b><div class="spoiler_text"><pre><code class="vbscript hljs"><span class="hljs-keyword">Public</span> <span class="hljs-keyword">Function</span> get_err(A As Double, B As Double, C As Double, R As Double) As Double
<span class="hljs-keyword">Dim</span> x, y, z As Double
<span class="hljs-keyword">Dim</span> sigma As Double
<span class="hljs-keyword">Dim</span> row_n As Long<font></font>
get_err = <span class="hljs-number">0</span>
<span class="hljs-keyword">For</span> row_n = <span class="hljs-number">1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">15</span>
    x = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">1</span>).Value<font></font>
    y = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">2</span>).Value<font></font>
    z = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">3</span>).Value<font></font>
    get_err = get_err + <span class="hljs-built_in">abs</span>( (A - x) ^ <span class="hljs-number">2</span> + (B - y) ^ <span class="hljs-number">2</span> + (C - z) ^ <span class="hljs-number">2</span> - R ^ <span class="hljs-number">2</span> )
<span class="hljs-keyword">Next</span>
<span class="hljs-keyword">End</span> <span class="hljs-keyword">Function</span><font></font>
<font></font>
. . .<font></font>
A = <span class="hljs-number">0</span>
B = <span class="hljs-number">0</span>
C = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-keyword">Do</span> <span class="hljs-keyword">While</span> <span class="hljs-literal">True</span>
   min_sigma = <span class="hljs-number">0</span>
    <span class="hljs-keyword">For</span> ai = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">For</span> bi = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">For</span> ci = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
                sigma = get_err(A + ai, B + bi, C + ci, <span class="hljs-number">16384</span>)
                <span class="hljs-keyword">If</span> sigma &lt; min_sigma <span class="hljs-keyword">Or</span> min_sigma = <span class="hljs-number">0</span> <span class="hljs-keyword">Then</span><font></font>
                    ai_min = ai<font></font>
                    bi_min = bi<font></font>
                    ci_min = ci<font></font>
                    min_sigma = sigma<font></font>
                <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span>
            <span class="hljs-keyword">Next</span>
        <span class="hljs-keyword">Next</span>
    <span class="hljs-keyword">Next</span><font></font>
    <font></font>
    <span class="hljs-keyword">If</span> ai_min = <span class="hljs-number">0</span> <span class="hljs-keyword">And</span> bi_min = <span class="hljs-number">0</span> <span class="hljs-keyword">And</span> ci_min = <span class="hljs-number">0</span> <span class="hljs-keyword">Then</span>
        <span class="hljs-keyword">Exit</span> <span class="hljs-keyword">Do</span>
    <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span><font></font>
    <font></font>
    A = A + ai_min<font></font>
    B = B + bi_min<font></font>
    C = C + ci_min<font></font>
<span class="hljs-keyword">Loop</span><font></font>
. . .<font></font>
</code></pre><br>
</div></div><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana lagi untuk mempercepat pencarian pusat bola?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu mencari dengan nada variabel. </font><font style="vertical-align: inherit;">Pertama kita mencari pusat di langkah besar. </font><font style="vertical-align: inherit;">Kami menemukan pusat, kami mengurangi langkah dan dari sana kami mulai mencari lebih jauh. </font><font style="vertical-align: inherit;">Dan seterusnya, sampai Anda mendapatkan hasil dari akurasi yang diperlukan.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana bisa dalam kode</font></font></b><div class="spoiler_text"><pre><code class="vbscript hljs"><span class="hljs-keyword">Public</span> <span class="hljs-keyword">Function</span> get_err(A As Double, B As Double, C As Double, R As Double) As Double
<span class="hljs-keyword">Dim</span> x, y, z As Double
<span class="hljs-keyword">Dim</span> sigma As Double
<span class="hljs-keyword">Dim</span> row_n As Long<font></font>
get_err = <span class="hljs-number">0</span>
<span class="hljs-keyword">For</span> row_n = <span class="hljs-number">1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">15</span>
    x = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">1</span>).Value<font></font>
    y = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">2</span>).Value<font></font>
    z = Application.ActiveWorkbook.ActiveSheet.Cells(row_n, <span class="hljs-number">3</span>).Value<font></font>
    get_err = get_err + <span class="hljs-built_in">abs</span>( (A - x) ^ <span class="hljs-number">2</span> + (B - y) ^ <span class="hljs-number">2</span> + (C - z) ^ <span class="hljs-number">2</span> - R ^ <span class="hljs-number">2</span> )
<span class="hljs-keyword">Next</span>
<span class="hljs-keyword">End</span> <span class="hljs-keyword">Function</span><font></font>
. . .<font></font>
A = <span class="hljs-number">0</span>
B = <span class="hljs-number">0</span>
C = <span class="hljs-number">0</span>
<span class="hljs-keyword">step</span> = <span class="hljs-number">1000</span>
<span class="hljs-keyword">Do</span> <span class="hljs-keyword">While</span> <span class="hljs-literal">True</span>
   min_sigma = <span class="hljs-number">0</span>
    <span class="hljs-keyword">For</span> ai = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">For</span> bi = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">For</span> ci = <span class="hljs-number">-1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">1</span>
                sigma = get_err(A + ai * <span class="hljs-keyword">step</span>, B + bi * <span class="hljs-keyword">step</span>, C + ci * <span class="hljs-keyword">step</span>, <span class="hljs-number">16384</span>)
                <span class="hljs-keyword">If</span> sigma &lt; min_sigma <span class="hljs-keyword">Or</span> min_sigma = <span class="hljs-number">0</span> <span class="hljs-keyword">Then</span><font></font>
                    ai_min = ai<font></font>
                    bi_min = bi<font></font>
                    ci_min = ci<font></font>
                    min_sigma = sigma<font></font>
                <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span>
            <span class="hljs-keyword">Next</span>
        <span class="hljs-keyword">Next</span>
    <span class="hljs-keyword">Next</span>
    <span class="hljs-keyword">If</span> ai_min = <span class="hljs-number">0</span> <span class="hljs-keyword">And</span> bi_min = <span class="hljs-number">0</span> <span class="hljs-keyword">And</span> ci_min = <span class="hljs-number">0</span> <span class="hljs-keyword">Then</span>        
        <span class="hljs-keyword">step</span> = <span class="hljs-keyword">step</span> / <span class="hljs-number">10</span>
        <span class="hljs-keyword">If</span> <span class="hljs-keyword">step</span> &lt; <span class="hljs-number">0.01</span> <span class="hljs-keyword">Then</span>
            <span class="hljs-keyword">Exit</span> <span class="hljs-keyword">Do</span>
        <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span>
    <span class="hljs-keyword">Else</span>
    A = A + ai_min * <span class="hljs-keyword">step</span>
    B = B + bi_min * <span class="hljs-keyword">step</span>
    C = C + ci_min * <span class="hljs-keyword">step</span>
    <span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span>
<span class="hljs-keyword">Loop</span><font></font>
. . .<font></font>
</code></pre><br>
</div></div><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentang kesalahan pengukuran</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama pengukuran, mungkin ada situasi di mana, untuk beberapa alasan, hasil pengukuran mungkin jauh lebih jauh dari permukaan bola. Atau bisa banyak poin. Atau, secara umum, hasil pengukuran mungkin bukan bola, tetapi "telur" atau "airship". Dalam hal ini, tentu saja, Anda perlu mengulang semua pengukuran, mengidentifikasi kemungkinan penyebab kesalahan. Misalnya, untuk magnetometer dapat berupa baut atau paku di meja dan Anda melakukan pengukuran langsung di atasnya. Dan semakin rendah Anda menurunkan sensor di sepanjang meridian, semakin kuat logam akan mempengaruhi hasilnya. Oleh karena itu, perlu untuk menentukan ambang batas nilai kesalahan yang diizinkan. Agar tidak mengulangi pengukuran karena beberapa titik yang keliru jelas, Anda dapat menerapkan filter. Prinsip filter ini sangat sederhana - setelah menghitung pusat untuk pertama kalinya, urutkan poin berdasarkan tingkat kesalahan di masing-masingnya.Beberapa poin dengan kesalahan terbesar dapat dengan mudah dibuang (misalnya, 10%). Maka Anda perlu mengulangi pencarian untuk pusat.</font></font><br>
<img src="https://habrastorage.org/files/e22/c6f/b13/e22c6fb1385e4d678aabf7f1d879bc02.png"> <img src="https://habrastorage.org/files/569/40f/d17/56940fd17eef42cba93f590606bbe9e7.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode ini memiliki akurasi yang cukup baik. </font><font style="vertical-align: inherit;">Metode ini memungkinkan Anda melakukan dengan cara improvisasi sederhana (bola, bank, dll.). </font><font style="vertical-align: inherit;">Ini bekerja cukup cepat. </font><font style="vertical-align: inherit;">Kode sederhana </font><font style="vertical-align: inherit;">Banyak sensor memiliki register khusus di mana Anda dapat menulis nilai yang ditemukan, dan sensor akan menguranginya dengan cepat. </font><font style="vertical-align: inherit;">Register semacam itu biasanya memiliki awalan "TRIM", seperti pada MPU9260, atau "OFFSET", seperti pada LSM303. </font><font style="vertical-align: inherit;">Tetapi LIS302DL yang terkenal tidak memiliki register seperti itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jangan lupa beri tanda plus jika Anda menyukainya. </font><font style="vertical-align: inherit;">Tulis dalam komentar metode Anda untuk mengkalibrasi sensor.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id384075/">https://habr.com/ru/post/id384075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id384063/index.html">Как не потратить незаметно для себя несколько гигабайт трафика, если вы не хотите обновляться до Windows 10</a></li>
<li><a href="../id384067/index.html">Mozilla mendorong batas waktu tanda tangan ekstensi Firefox hingga 26 Januari</a></li>
<li><a href="../id384069/index.html">Penelitian: Apakah latihan olahraga membantu kelelahan?</a></li>
<li><a href="../id384071/index.html">Sony Pictures mempertimbangkan untuk membeli BitTorrent pada tahun 2006</a></li>
<li><a href="../id384073/index.html">Magma Underground Ocean Menjelaskan Aktivitas Vulkanik di Io</a></li>
<li><a href="../id384079/index.html">Panorama yang luas dari Gunung Sharpe</a></li>
<li><a href="../id384081/index.html">Foto Luar Angkasa untuk minggu ini (09/07/13/09)</a></li>
<li><a href="../id384083/index.html">«Война миров» Стивена Хокинга. Чем опасны инопланетяне для землян?</a></li>
<li><a href="../id384085/index.html">SpaceX memposting foto interior pesawat ruang angkasa Crew Dragon</a></li>
<li><a href="../id384087/index.html">Mobil Model Tesla S P85D Mematahkan Sistem Peringkat Laporan Konsumen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>