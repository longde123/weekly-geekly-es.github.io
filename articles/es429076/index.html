<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ©Ô∏è üêó üôá La evoluci√≥n de la b√∫squeda: c√≥mo comprar un piano en tres clics üë®üèø‚Äçüé§ üëÜüèæ üôáüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anteriormente, en Avito, pod√≠a encontrar el producto adecuado mediante el filtrado de palabras clave o la navegaci√≥n del √°rbol de categor√≠as. Este m√©t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La evoluci√≥n de la b√∫squeda: c√≥mo comprar un piano en tres clics</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/429076/"><p>  Anteriormente, en Avito, pod√≠a encontrar el producto adecuado mediante el filtrado de palabras clave o la navegaci√≥n del √°rbol de categor√≠as.  Este m√©todo, aunque parec√≠a familiar, no siempre era conveniente: para encontrar un producto o servicio, era necesario hacer una gran cantidad de clics.  Hace m√°s de un a√±o, hemos ganado relevancia, gracias a lo cual la b√∫squeda ha mejorado, y ahora es m√°s f√°cil y conveniente encontrar un producto o servicio incluso en la p√°gina principal.  Con esta innovaci√≥n, los bienes inadecuados y francamente "basura" dejaron de caer en el tema.  Y este es solo uno de los pasos para mejorar su b√∫squeda.  Estamos cambiando gradualmente la infraestructura, lo que nos permite trabajar en la calidad de b√∫squeda con mayor intensidad, mejorarla m√°s r√°pido y desplegar nuevas caracter√≠sticas que beneficien a los vendedores y compradores en Avito. </p><br><p>  En el art√≠culo, le dir√© c√≥mo ha cambiado la b√∫squeda en Avito: d√≥nde comenzamos y c√≥mo avanzamos ahora para mejorar la vida de nuestros usuarios, compartir√© nuestras innovaciones tanto en el producto como en su llenado, la parte t√©cnica.  No habr√° carne hardcore aqu√≠, pero espero que lo disfruten. </p><br><img src="https://habrastorage.org/webt/19/zx/he/19zxhesvegeiygbo4haapoe4mic.png"><a name="habracut"></a><br><p>  Algunas notas introductorias: Avito es el servicio publicitario m√°s popular en Rusia.  Tenemos m√°s de 450 mil anuncios por d√≠a, y la cantidad mensual de visitantes √∫nicos alcanza los 35 millones, lo que hace m√°s de 140 millones de b√∫squedas por d√≠a. </p><br><h1 id="tipichnyy-scenariy-poiska-ranshe">  Escenario de b√∫squeda t√≠pico antes </h1><br><p>  Veamos un ejemplo simple de c√≥mo funcion√≥ una b√∫squeda hace m√°s de un a√±o.  Supongamos que necesita un piano (bueno, ¬øpor qu√© no?).  Vamos a la p√°gina principal, escribimos "piano". </p><br><img src="https://habrastorage.org/webt/yh/jq/di/yhjqdiamdihyfnkermrcwkhwzpq.png"><br><p>  En la extradici√≥n, lo m√°s probable es que reciba mudanzas, servicios de transporte de piano o algo similar, pero no un instrumento musical. </p><br><img src="https://habrastorage.org/webt/wy/dp/rm/wydprmf6to16xbqxq6mfkpfqlno.png"><br><p>  Esto sucede porque tendremos que ordenar por la fecha de colocaci√≥n, y estos servicios se colocan con mayor frecuencia. </p><br><img src="https://habrastorage.org/webt/bt/m8/rz/btm8rzqberfol38jrn2uln1ipju.jpeg"><br><p>  Para ver el piano, debe especificar la categor√≠a.  Hacemos clic en el encabezado ‚ÄúAficiones y tiempo libre‚Äù, bajamos en el √°rbol de categor√≠as a ‚ÄúInstrumentos musicales‚Äù, luego ‚ÄúInstrumentos de teclado‚Äù. </p><br><img src="https://habrastorage.org/webt/d1/h2/oq/d1h2oqqqz5gv9snlihpiu51yzau.png"><br><img src="https://habrastorage.org/webt/be/c2/zf/bec2zflrha8wktusuudqo1w3o08.png"><br><p>  Y solo despu√©s de eso vemos el piano que est√°bamos buscando. </p><br><img src="https://habrastorage.org/webt/-c/wz/71/-cwz71ifodfnrcda86qj03u__5y.png"><br><p>  Resulta que, para encontrar el anuncio deseado, hab√≠a las siguientes opciones: </p><br><ul><li>  refinamiento de la categor√≠a al buscar por palabras clave, </li><li>  ordenando por frescura y precio, </li><li>  filtros </li><li>  busca solo por nombre. </li></ul><br><h1 id="chto-izmenilos-blagodarya-relevantnosti">  ¬øQu√© ha cambiado debido a la relevancia? </h1><br><p>  Debido a la relevancia, los anuncios que no se ajustan en absoluto han dejado de incluirse en la emisi√≥n.  Ahora, si est√° buscando un piano en la p√°gina principal, lo m√°s probable es que no vea los servicios de los cargadores que lo ayudan a transportarlo, pero ver√° de inmediato el instrumento musical que desea.  Al mismo tiempo, se agreg√≥ una nueva clasificaci√≥n: "Por defecto".  Est√° formado por dos indicadores: relevancia del anuncio para la consulta de texto y frescura. </p><br><img src="https://habrastorage.org/webt/oc/p_/ry/ocp_rycbztfxg1fdvec-3usu0cm.png"><br><p>  En la parte superior, ver√° el m√°s reciente de los relevantes. </p><br><img src="https://habrastorage.org/webt/cg/md/pq/cgmdpq3ogawjuoqf4cr66l17gr0.png"><br><p>  En Avito, por una tarifa adicional, puede subir su anuncio.  Y con la introducci√≥n de relevancia, las elevaciones remuneradas funcionan de manera m√°s eficiente.  Funcionar√°n, en primer lugar, si su anuncio es relevante para la consulta de texto. </p><br><p>  La introducci√≥n de relevancia no significa que abandonamos por completo las transiciones al √°rbol de categor√≠as.  Solo para la mayor√≠a de los casos, redujimos el n√∫mero de clics en el anuncio deseado cuando realizamos b√∫squedas desde la p√°gina principal.  Si a√∫n necesita servicios de transporte, aunque acaba de escribir "piano" en la b√∫squeda, vaya al √°rbol de categor√≠as y encontrar√° estos anuncios.  La b√∫squeda tambi√©n comenz√≥ a funcionar de manera m√°s eficiente y dentro de la categor√≠a, por ejemplo, "Art√≠culos personales" y "Electrodom√©sticos". </p><br><h1 id="kak-nayti-nuzhnyy-tovar-v-tri-klika">  C√≥mo encontrar el producto correcto en tres clics </h1><br><p>  La b√∫squeda se est√° volviendo m√°s conveniente para los usuarios no solo debido a la calidad de los resultados de b√∫squeda.  Hay otras formas de mejorarlo.  Uno de ellos est√° reenviando a la categor√≠a.  Por ejemplo, estamos buscando Lamborghini Gayardo (s√≠, te gusta tocar el piano y quieres montar Lamborghini).  Para ingresar a la categor√≠a de un autom√≥vil de un modelo en particular, debe hacer dos clics adicionales.  Con relevancia, lo m√°s probable es que obtenga lo que desea. </p><br><img src="https://habrastorage.org/webt/vd/d0/-y/vdd0-ymtzuq15oeaxe_bdikffne.png"><br><p>  Pero hay un m√©todo adicional que lo arrojar√° inmediatamente a los autom√≥viles.  La emisi√≥n se reducir√°, se seleccionar√° el autom√≥vil correcto en los filtros y realmente recibir√° autom√≥viles en la emisi√≥n. </p><br><img src="https://habrastorage.org/webt/xq/b_/7v/xqb_7v4xa6vmvo4rtt88h8yvttk.png"><br><img src="https://habrastorage.org/webt/vo/lk/yo/volkyo_aktkx5cemgpd9fvy2hp4.png"><br><p>  Otra forma es expandir las etiquetas.  Por ejemplo, cuando ingresa la palabra "chaqueta", obtendr√° pistas. </p><br><img src="https://habrastorage.org/webt/mv/7q/si/mv7qsiygsxehsjbl0pkctnhykjo.png"><br><p>  La captura de pantalla anterior muestra los consejos: el tipo de chaquetas: mujeres, hombres, ni√±as y ni√±os.  Si hace clic en "For Girls", inmediatamente entrar√° en la categor√≠a donde se seleccionar√°n los filtros apropiados.  Aqu√≠ tambi√©n aparecer√° un conjunto de etiquetas adicionales expandibles: chaqueta de invierno, cuero, nuevas, etc.  Si baja manualmente el √°rbol de categor√≠as al producto deseado, entonces necesita realizar m√°s acciones. </p><br><img src="https://habrastorage.org/webt/4k/hq/vg/4khqvgdpjs1sgxhb_icjrxl__v0.png"><br><h1 id="v-chem-raznica-mezhdu-poiskom-i-filtrami">  ¬øCu√°l es la diferencia entre b√∫squeda y filtros? </h1><br><p>  Cuando habl√© en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RIT ++</a> , el p√∫blico ten√≠a una pregunta: ¬øcu√°l es la diferencia entre la b√∫squeda de texto y los filtros?  Todo es bastante simple.  Tambi√©n puede encontrar el anuncio deseado sin una solicitud de texto bajando el √°rbol de categor√≠as.  En este caso, la b√∫squeda seguir√° encontrando bienes y servicios, no por el texto dado, sino por el conjunto de par√°metros pasados ‚Äã‚Äãde los filtros correspondientes de la categor√≠a seleccionada. </p><br><p>  Cada categor√≠a tiene su propio conjunto de filtros.  Por ejemplo, en la categor√≠a "Autos" - algunos filtros, en la categor√≠a "Cosas personales" - otros filtros.  Es decir, los filtros est√°n r√≠gidamente vinculados a una categor√≠a. </p><br><h1 id="razmeschenie-obyavleniya-za-dve-minuty">  Colocaci√≥n del anuncio en dos minutos. </h1><br><p>  Una innovaci√≥n importante ha aparecido para los vendedores que sienten al enviar su anuncio.  Si su anuncio no contiene ning√∫n "prohibido" o no es un duplicado, el buen anuncio habitual, lo ver√° en la publicaci√≥n casi de inmediato.  En realidad, este retraso dura aproximadamente dos minutos, pero en casos excepcionales puede extenderse hasta 30 minutos.  Anteriormente, un anuncio siempre aparec√≠a en el sitio solo despu√©s de media hora. </p><br><h1 id="avito-pomoschnik">  Asistente Avito </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Avito Helper</a> es una extensi√≥n para Chrome que muestra el precio de un producto similar en Avito en sitios de terceros.  En la extensi√≥n, puede comparar los precios en muchas tiendas en l√≠nea con los precios de Avito o simplemente buscar los bienes y servicios necesarios en nuestro servicio sin ir directamente al sitio web o la aplicaci√≥n.  Pudimos implementar el "Asistente", incluso gracias a los nuevos cambios de infraestructura. </p><br><img src="https://habrastorage.org/webt/d5/hv/cw/d5hvcwkpl7-npnqilrei9wfcz80.png"><br><h1 id="arhitektura">  Arquitectura </h1><br><h2 id="pilim-monolit">  Serrar un monolito </h2><br><p>  Avito tiene un monolito en PHP.  Hace un a√±o, toda la funcionalidad de b√∫squeda que funciona en Avito estaba en este monolito.  La b√∫squeda en el monolito funcion√≥ con cuatro plataformas: Android, iOS, la versi√≥n m√≥vil en el navegador y el escritorio.  Para dar el resultado, las consultas SQL correspondientes se generaron en Sphinx dentro de este c√≥digo, el procesamiento estaba en curso y el resultado se envi√≥ en formato JSON o HTML.  Luego, los usuarios vieron lo que estaban buscando. </p><br><img src="https://habrastorage.org/webt/cw/l_/rn/cwl_rnema8zlhzfu4gnrrgrz1jq.jpeg"><br><h2 id="chto-u-nas-seychas">  Lo que tenemos ahora </h2><br><p>  Si implementa nuevas funciones, es muy dif√≠cil integrarse con este monolito.  Por lo tanto, decidimos desarrollar un servicio de b√∫squeda, al que llamamos "B√∫squeda".  Ahora el monolito va a este servicio de b√∫squeda, y el servicio va a Sphinx. </p><br><img src="https://habrastorage.org/webt/wk/rf/up/wkrfupfza_kexfbo_yiafhq-lz4.jpeg"><br><h2 id="prichiny-sozdaniya-poiskovogo-servisa">  Razones para crear un servicio de b√∫squeda. </h2><br><p>  Al desarrollar servicios, siempre debe comprender por qu√© est√° haciendo esto.  La primera ventaja obvia es la eliminaci√≥n de la l√≥gica de bajo nivel.  En nuestro caso, esto est√° ocultando la cocina para procesar consultas SphinxQL.  Adem√°s, podemos proporcionar m√°s f√°cilmente la funcionalidad de b√∫squeda a sistemas de terceros. </p><br><p>  Consulta as√≠ncrona de ejecuci√≥n.  Esta ventaja es bastante obvia y dependiendo de la implementaci√≥n, se puede lograr uno u otro √©xito.  Nuestro servicio se implement√≥ en Golang, y hab√≠a una funcionalidad que se pod√≠a paralelizar: tres solicitudes en Sphinx, lo que result√≥ en buenos resultados. </p><br><p>  Despliegue r√°pido.  Hemos identificado una funcionalidad separada con menos c√≥digo, pruebas adicionales (el monolito tiene muchas pruebas, no solo la funcionalidad de b√∫squeda), y es m√°s f√°cil de implementar.  Lo que es m√°s importante, debido a un enfoque exitoso para la implementaci√≥n de este servicio, pudimos reducir cosas interesantes e implementar algoritmos de clasificaci√≥n avanzados, para hacer un procesamiento bastante complicado que no podr√≠amos hacer en un monolito.  Esto nos proporciona una base muy buena para experimentar con la calidad de b√∫squeda. </p><br><p>  Como beneficio adicional, tenemos la oportunidad de cambiar de Sphinx a Elastic, porque la l√≥gica de bajo nivel ahora est√° oculta. </p><br><p>  Este diagrama ya muestra el caso cuando hay un monolito, el servicio "B√∫squeda" y el servicio de terceros "Avito Assistant". </p><br><img src="https://habrastorage.org/webt/ed/3s/ws/ed3swsgnqulgqx9lokpg6l4po8g.jpeg"><br><h2 id="kak-rabotaet-poiskovyy-servis">  ¬øC√≥mo funciona un servicio de b√∫squeda? </h2><br><p>  Tiene un conjunto de agregadores.  Cada agregador realiza una cierta l√≥gica comercial relacionada con el procesamiento de la emisi√≥n.  √âl puede formar este problema de cierta manera. </p><br><p>  La solicitud llega al planificador.  El planificador selecciona el agregador de acuerdo con los criterios de consulta en t√©rminos de sus par√°metros (o si el agregador deseado se especifica en la solicitud).  El agregador va a Sphinx.  Despu√©s de recibir una respuesta de Sphinx, genera una salida y le da la respuesta al cliente. </p><br><img src="https://habrastorage.org/webt/f9/56/lj/f956ljoot6y6pas3k94vkb8bo3k.gif"><br><p>  En este caso, la solicitud estaba fuera, no desde la nube en la que funciona nuestro servicio de b√∫squeda.  Pero tambi√©n es posible otra opci√≥n: algunos de nuestros servicios, dentro de la nube, por ejemplo, Avito Assistant, recurren a un servicio de b√∫squeda.  Esta solicitud ya va a otro agregador: hay otra l√≥gica de negocios.  As√≠ es como funciona: </p><br><img src="https://habrastorage.org/webt/vb/gb/yu/vbgbyukk8a5yynkv5kupow23s6y.gif"><br><h2 id="kak-rabotaet-asinhronnoe-vypolnenie-zaprosov-na-agregatore">  C√≥mo funciona la ejecuci√≥n de consultas as√≠ncronas en el agregador </h2><br><p>  El agregador consta de varios perfiles.  Un perfil es, en t√©rminos generales, una entidad en la que puede obtener un anuncio de alg√∫n tipo o de alguna manera espec√≠fica.  Por ejemplo, esto puede explicarse a trav√©s de una analog√≠a: hay anuncios "Premium", "VIP" y regulares en Avito.  El agregador recibe una solicitud del planificador, mientras que las solicitudes paralelas se ejecutan para el conjunto de perfiles conocidos en el agregador.  El perfil tiene un controlador en su interior que accede f√≠sicamente al nivel subyacente, en este caso en Sphinx, pero puede ser cualquier otra fuente de datos </p><br><img src="https://habrastorage.org/webt/la/np/ic/lanpiclts0oo-uhfktoxszkxl3g.jpeg"><br><p>  El agregador puede simplemente dar al planificador los resultados de las consultas a los perfiles, y tambi√©n puede realizar acciones m√°s complejas, por ejemplo, mezclar estos resultados usando uno u otro algoritmo. </p><br><img src="https://habrastorage.org/webt/zy/_o/ji/zy_ojiffyfpbt4h9vmkcyciqsuy.jpeg"><br><h2 id="hranenie-poiskovogo-indeksa">  Buscar √≠ndice de almacenamiento </h2><br><p>  Debido al hecho de que utilizamos Kubernetes en la arquitectura, en RIT ++ se me hizo una pregunta sobre el almacenamiento del √≠ndice de b√∫squeda: ¬øest√° almacenado en Kubernetes?  No, tenemos a Sphinx viviendo en m√°quinas f√≠sicas.  En Kubernetes, estamos implementando un servicio de b√∫squeda que procesa la l√≥gica de b√∫squeda.  La nube tambi√©n contiene un √≠ndice de b√∫squeda de muestra para el entorno de desarrollo en el que se ejecutan las pruebas, pero no es deseable colocar un √≠ndice de combate all√≠, porque los servicios que funcionan en Kubernetes son, en primer lugar, servicios sin estado. </p><br><h2 id="nagruzka-na-poiskovyy-servis">  Servicio de b√∫squeda de carga </h2><br><p>  Ahora este servicio est√° en batalla, sirve el 100% de la carga con algunas excepciones.  La carga que tiene es de aproximadamente 200 krpm.  Retardo: mediana - hasta 17 ms, percentil 95 - hasta 120 ms, percentil 99 - hasta 320 ms. </p><br><img src="https://habrastorage.org/webt/bt/46/ny/bt46nyowpcuqysikxjcpp2weov8.png"><br><img src="https://habrastorage.org/webt/bn/fj/hx/bnfjhx1hqse5b4lfok8cgv3ez04.png"><br><h2 id="itogo-po-poiskovomu-servisu">  Servicio de b√∫squeda total </h2><br><p>  El servicio de b√∫squeda est√° escrito en Golang, implementado en Kubernetes, el agregador funciona de forma as√≠ncrona con varios perfiles.  El perfil funciona con el controlador especificado, el controlador accede a la fuente de datos especificada, por ejemplo, Sphinx.  La cantidad de solicitudes que atiende nuestro servicio es de hasta 200 krpm en este momento.  Retardo: mediana - hasta 17 ms, percentil 95 - hasta 120 ms, percentil 99 - hasta 320 ms. </p><br><h2 id="vnedrenie-servisa-v-rabochuyu-sistemu">  Implementaci√≥n del servicio en un sistema de trabajo. </h2><br><p>  El problema de la doble funcionalidad es bastante obvio, tenemos que admitir dos bases de c√≥digo que deben realizar la misma tarea.  Necesitamos una reserva.  Lo llamamos "pajitas", recordamos sobre "pajitas".  Adem√°s, necesitamos control de tr√°fico, es deseable que sea r√°pido, a trav√©s de un tablero de instrumentos. </p><br><h2 id="kak-rabotaet-solomka">  ¬øC√≥mo funciona la "paja" </h2><br><p>  La consulta de b√∫squeda llega a la "Paja", que funciona dentro del monolito y puede realizar una nueva llamada a una nueva b√∫squeda o una antigua.  Ella llama a una nueva b√∫squeda, √©l la cumple y, si tiene √©xito, solo obtenemos el resultado de una nueva b√∫squeda. </p><br><img src="https://habrastorage.org/webt/y1/xa/wm/y1xawmqms1bxqtotevfsl7bfatu.gif"><br><p>  Hay situaciones en las que falla alguna consulta al servicio de b√∫squeda: por ejemplo, y hasta que se implementa alg√∫n tipo de funcionalidad dentro del servicio de b√∫squeda.  Luego, necesariamente prometemos dicha solicitud: "The Straw" la ejecutar√° en la b√∫squeda anterior.  La b√∫squeda anterior del monolito se convertir√° en Sphinx, y la respuesta ir√° al cliente.  El cliente no sentir√° nada. </p><br><img src="https://habrastorage.org/webt/cr/zu/za/crzuzaufpka6dvpjsjy_m5qq0jc.gif"><br><p>  Un esquema bastante confiable, y siempre es interesante ver lo que sucede en la pr√°ctica.  El Departamento de Arquitectura de Avito est√° mejorando constantemente nuestra nube, afinando, haci√©ndola m√°s confiable y productiva.  En alg√∫n momento, hubo problemas que al dar servicio a uno de los nodos con una intensidad suficientemente alta, los errores proven√≠an del monolito (100 errores por segundo). </p><br><img src="https://habrastorage.org/webt/tu/zv/wm/tuzvwmgmpzid5objz-4bmvl157y.png"><br><p>  Al mismo tiempo, el retraso del servicio aument√≥ considerablemente: en la imagen a continuaci√≥n puede ver los picos. </p><br><img src="https://habrastorage.org/webt/pq/of/z5/pqofz5fynz2bsibynewd3gro2cw.png"><br><p>  La "gota" resolvi√≥ esta situaci√≥n notablemente, y los errores HTTP resultantes estaban al mismo nivel, una unidad de errores para todo el Avito.  Nuestros visitantes no notaron nada. </p><br><img src="https://habrastorage.org/webt/wx/ya/ij/wxyaij2xka5dhghoa74ovncverq.png"><br><h2 id="avtomatizaciya-eksperimentov">  Automatizaci√≥n Experimental </h2><br><p>  Queremos que la b√∫squeda se desarrolle r√°pidamente, y la implementaci√≥n de nuevas caracter√≠sticas fue m√°s f√°cil.  Para esto, se necesita una infraestructura adecuada.  Hemos configurado la automatizaci√≥n de las pruebas A / B.  Usando el tablero, podemos comenzar nuevos experimentos, configurarlos en base a las innovaciones agregadas y, en consecuencia, ejecutar experimentos sin rodar el monolito. </p><br><p>  En el estado inicial, cuando no se lanz√≥ un solo experimento, todos los visitantes ven la funcionalidad de b√∫squeda habitual. </p><br><img src="https://habrastorage.org/webt/go/rz/qp/gorzqpca1whra33-df1c6ss18yk.jpeg"><br><p>  En un experimento t√≠pico, los usuarios se dividen en grupos.  El grupo de control, con la funcionalidad habitual para nuestros visitantes.  Hay varios grupos de prueba, con innovaciones.  Cuando necesitamos crear un nuevo experimento, en el servicio de b√∫squeda implementamos una nueva funcionalidad de b√∫squeda (agregamos nuevos agregadores) y a trav√©s del tablero configuramos el experimento con los grupos necesarios, vincul√°ndolos con nuevos agregadores. </p><br><p>  Al analizar los experimentos, comparamos el comportamiento de los visitantes en el grupo de control con los de la prueba y, en base a esto, sacamos conclusiones sobre el √©xito del experimento. </p><br><img src="https://habrastorage.org/webt/gd/g5/r2/gdg5r20saoh4inq46d5jggjcxee.gif"><br><p>  Supongamos que hemos desarrollado una nueva f√≥rmula de clasificaci√≥n.  ¬øQu√© necesitamos hacer para experimentar con ella? </p><br><ol><li>  En el servicio de b√∫squeda, despliegue el agregador apropiado (que sea "Agregador 2"). </li><li>  Cree un experimento a trav√©s de un tablero y conecte uno de los grupos en este experimento con este agregador. </li><li>  Ahora, si llega una consulta en la b√∫squeda que pertenece al grupo de prueba, se dirige al servicio de b√∫squeda en "Agregador 2". </li></ol><br><p>  Podemos continuar creando nuevos experimentos y asociar sus grupos de prueba con nuevos agregadores. </p><br><h1 id="itogo-po-infrastrukture-poiska">  Infraestructura de b√∫squeda total </h1><br><p>  Hay un cl√∫ster de servidores Sphinx 3. Contiene 13 krps de consultas SphinxQL y tiene m√°s de 45 millones de anuncios activos. </p><br><p>  Sphinx 3.0 es estable y satisface su rendimiento.  Por cierto, los binarios son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de dominio p√∫blico</a> .  Adem√°s, gracias a Avito, se filman nuevas caracter√≠sticas en Sphinx 3, por ejemplo, la operaci√≥n del producto escalar de vectores, y los errores encontrados son corregidos. </p><br><p>  Utilizamos arquitectura de servicio.  Tenemos el servicio de b√∫squeda "Iskalo" y el servicio "Avito Assistant".  Parte de la funcionalidad se ha mantenido en el monolito, pero seguimos trabajando en su corte. </p><br><h1 id="vyvody">  Conclusiones </h1><br><p>  Durante el a√±o pasado, se recibi√≥ un sistema de desarrollo de funcionalidad de b√∫squeda avanzada.  Tuvimos la oportunidad de realizar experimentos r√°pidos y flexibles.  Y ahora la b√∫squeda de usuarios se ha vuelto m√°s conveniente, m√°s r√°pida y mejor ayuda a resolver sus problemas. </p><br><h1 id="chto-dalshe">  Que sigue </h1><br><p>  Adem√°s, continuaremos eliminando del monolito lo que queda: renderizado, filtros.  Trabajaremos para mejorar la calidad de la b√∫squeda, continuaremos deleitando a nuestros visitantes.  Espero que tu tambi√©n. </p><br><p>  Si tiene preguntas sobre el trabajo de nuestra b√∫squeda, nos gustar√≠a conocer m√°s detalles t√©cnicos, escriba en los comentarios.  Contestar√© con gusto.  Por cierto, recientemente, Andrey Drozdov habl√≥ en Highload ++ 2018 con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe sobre la optimizaci√≥n de criterios m√∫ltiples de los resultados de b√∫squeda</a> , aqu√≠ est√° su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">presentaci√≥n</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429076/">https://habr.com/ru/post/es429076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429066/index.html">C√≥mo la tripulaci√≥n del avi√≥n se prepara para la partida</a></li>
<li><a href="../es429068/index.html">Una publicaci√≥n muy corporativa: abrir en Mosc√∫ o por qu√© el 10 y 11 de noviembre son buenos d√≠as para comprar productos electr√≥nicos</a></li>
<li><a href="../es429070/index.html">Linux no se puede cargar en nuevas MacBooks debido al chip T2</a></li>
<li><a href="../es429072/index.html">Por qu√© muri√≥ Kodak y floreci√≥ Fujifilm: la historia de dos cineastas</a></li>
<li><a href="../es429074/index.html">Buenas acciones para Google Money: nuevo desaf√≠o de impacto de IA</a></li>
<li><a href="../es429078/index.html">C√≥mo crear arte procesal en menos de 100 l√≠neas de c√≥digo</a></li>
<li><a href="../es429082/index.html">Tailandia sin estereotipos</a></li>
<li><a href="../es429084/index.html">La segunda vida del horno el√©ctrico "Jarkov"</a></li>
<li><a href="../es429086/index.html">Fiesta de cerveza de respaldo</a></li>
<li><a href="../es429088/index.html">Ejecuci√≥n de consultas GraphQL con OdataToEntity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>