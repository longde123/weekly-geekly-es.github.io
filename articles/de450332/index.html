<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✊🏻 🏨 🧑🏿‍🤝‍🧑🏿 Wie das Rendering von The Witcher 3 implementiert wird: Blitz, das Flair des Hexers und andere Effekte 🌗 🎴 👩🏻‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Teil 1. Reißverschlüsse 
 In diesem Teil werden wir uns den Prozess des Renderns von Blitzen in Witcher 3: Wild Hunt ansehen. 

 Das Blitz-Rendering w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie das Rendering von The Witcher 3 implementiert wird: Blitz, das Flair des Hexers und andere Effekte</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450332/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/abf/ce7/1c4/abfce71c4469b6dcd077723d498c1685.jpg" alt="Bild"></div><br><h2>  Teil 1. Reißverschlüsse </h2><br>  In diesem Teil werden wir uns den Prozess des Renderns von Blitzen in Witcher 3: Wild Hunt ansehen. <br><br>  Das Blitz-Rendering wird etwas später als der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Regenvorhang-</a> Effekt ausgeführt, tritt jedoch immer noch im direkten Rendering-Durchgang auf.  In diesem Video ist ein Blitz zu sehen: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VXt4PEEqV2k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Sie verschwinden sehr schnell, daher ist es besser, das Video mit einer Geschwindigkeit von 0,25 anzusehen. <br><br>  Sie können sehen, dass dies keine statischen Bilder sind.  Mit der Zeit ändert sich ihre Helligkeit leicht. <br><br>  In Bezug auf das Rendern von Nuancen gibt es viele Ähnlichkeiten mit dem Zeichnen eines Regenvorhangs in der Ferne, z. B. dieselben Mischzustände (additive Mischung) und Tiefe (Überprüfung ist aktiviert, Tiefenaufzeichnung wird nicht durchgeführt). <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ba/7e1/f20/4ba7e1f2075dc128baf8b717eeb3ce92.jpg"></div><br>  <i>Szene ohne Blitz</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3dd/37a/e59/3dd37ae5986de4621766f4fc64525906.jpg"></div><br>  <i>Blitzszene</i> <br><br>  In Bezug auf die Blitzgeometrie ist The Witcher 3 ein baumartiges Netz.  Dieses Beispiel eines Blitzes wird durch das folgende Netz dargestellt: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b7/23c/3dc/5b723c3dc1f934c0f6c14903e2a260cf.jpg"></div><br>  Es hat UV-Koordinaten und normale Vektoren.  All dies ist praktisch im Vertex-Shader-Stadium. <br><br><h3>  Vertex-Shader </h3><br>  Werfen wir einen Blick auf den zusammengestellten Vertex-Shader-Code: <br><br><pre><code class="cpp hljs">vs_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb1[<span class="hljs-number"><span class="hljs-number">9</span></span>], immediateIndexed dcl_constantbuffer cb2[<span class="hljs-number"><span class="hljs-number">6</span></span>], immediateIndexed dcl_input v0.xyz dcl_input v1.xy dcl_input v2.xyz dcl_input v4.xyzw dcl_input v5.xyzw dcl_input v6.xyzw dcl_input v7.xyzw dcl_output o0.xy dcl_output o1.xyzw dcl_output_siv o2.xyzw, position dcl_temps <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: mov o0.xy, v1.xyxx <span class="hljs-number"><span class="hljs-number">1</span></span>: mov o1.xyzw, v7.xyzw <span class="hljs-number"><span class="hljs-number">2</span></span>: mul r0.xyzw, v5.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].yyyy <span class="hljs-number"><span class="hljs-number">3</span></span>: mad r0.xyzw, v4.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].xxxx, r0.xyzw <span class="hljs-number"><span class="hljs-number">4</span></span>: mad r0.xyzw, v6.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].zzzz, r0.xyzw <span class="hljs-number"><span class="hljs-number">5</span></span>: mad r0.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r0.xyzw <span class="hljs-number"><span class="hljs-number">6</span></span>: mov r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: mad r1.xyz, v0.xyzx, cb2[<span class="hljs-number"><span class="hljs-number">4</span></span>].xyzx, cb2[<span class="hljs-number"><span class="hljs-number">5</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">8</span></span>: dp4 r2.x, r1.xyzw, v4.xyzw <span class="hljs-number"><span class="hljs-number">9</span></span>: dp4 r2.y, r1.xyzw, v5.xyzw <span class="hljs-number"><span class="hljs-number">10</span></span>: dp4 r2.z, r1.xyzw, v6.xyzw <span class="hljs-number"><span class="hljs-number">11</span></span>: add r2.xyz, r2.xyzx, -cb1[<span class="hljs-number"><span class="hljs-number">8</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">12</span></span>: dp3 r1.w, r2.xyzx, r2.xyzx <span class="hljs-number"><span class="hljs-number">13</span></span>: rsq r1.w, r1.w <span class="hljs-number"><span class="hljs-number">14</span></span>: div r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.w <span class="hljs-number"><span class="hljs-number">15</span></span>: mul r1.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">0.000001</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span>: mad r2.xyz, v2.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">17</span></span>: mad r1.xyz, r2.xyzx, r1.wwww, r1.xyzx <span class="hljs-number"><span class="hljs-number">18</span></span>: mov r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">19</span></span>: dp4 o2.x, r1.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">20</span></span>: mul r0.xyzw, v5.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].yyyy <span class="hljs-number"><span class="hljs-number">21</span></span>: mad r0.xyzw, v4.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].xxxx, r0.xyzw <span class="hljs-number"><span class="hljs-number">22</span></span>: mad r0.xyzw, v6.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].zzzz, r0.xyzw <span class="hljs-number"><span class="hljs-number">23</span></span>: mad r0.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r0.xyzw <span class="hljs-number"><span class="hljs-number">24</span></span>: dp4 o2.y, r1.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">25</span></span>: mul r0.xyzw, v5.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].yyyy <span class="hljs-number"><span class="hljs-number">26</span></span>: mad r0.xyzw, v4.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].xxxx, r0.xyzw <span class="hljs-number"><span class="hljs-number">27</span></span>: mad r0.xyzw, v6.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].zzzz, r0.xyzw <span class="hljs-number"><span class="hljs-number">28</span></span>: mad r0.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r0.xyzw <span class="hljs-number"><span class="hljs-number">29</span></span>: dp4 o2.z, r1.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">30</span></span>: mul r0.xyzw, v5.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].yyyy <span class="hljs-number"><span class="hljs-number">31</span></span>: mad r0.xyzw, v4.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].xxxx, r0.xyzw <span class="hljs-number"><span class="hljs-number">32</span></span>: mad r0.xyzw, v6.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].zzzz, r0.xyzw <span class="hljs-number"><span class="hljs-number">33</span></span>: mad r0.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r0.xyzw <span class="hljs-number"><span class="hljs-number">34</span></span>: dp4 o2.w, r1.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">35</span></span>: ret</code> </pre> <br>  Es gibt viele Ähnlichkeiten mit dem Vertex-Shader-Regenvorhang, daher werde ich nicht wiederholen.  Ich möchte Ihnen den wichtigen Unterschied in den Zeilen 11-18 zeigen: <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">11</span></span>: add r2.xyz, r2.xyzx, -cb1[<span class="hljs-number"><span class="hljs-number">8</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">12</span></span>: dp3 r1.w, r2.xyzx, r2.xyzx <span class="hljs-number"><span class="hljs-number">13</span></span>: rsq r1.w, r1.w <span class="hljs-number"><span class="hljs-number">14</span></span>: div r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.w <span class="hljs-number"><span class="hljs-number">15</span></span>: mul r1.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">0.000001</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span>: mad r2.xyz, v2.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">17</span></span>: mad r1.xyz, r2.xyzx, r1.wwww, r1.xyzx <span class="hljs-number"><span class="hljs-number">18</span></span>: mov r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">19</span></span>: dp4 o2.x, r1.xyzw, r0.xyzw</code> </pre> <br>  Erstens ist cb1 [8] .xyz die Position der Kamera und r2.xyz ist die Position im Weltraum, dh Zeile 11 berechnet den Vektor von der Kamera zur Position in der Welt.  Dann berechnen die Zeilen 12-15 die <i>Länge (worldPos - cameraPos) * 0,000001.</i> <br><br>  v2.xyz ist der Normalenvektor der eingehenden Geometrie.  Zeile 16 erweitert es vom Intervall [0-1] bis zum Intervall [-1; 1]. <br><br>  Dann wird die endgültige Position in der Welt berechnet: <br><br>  <i>finalWorldPos = worldPos + Länge (worldPos - cameraPos) * 0,000001 * normalVector</i> <br>  Das HLSL-Code-Snippet für diese Operation sieht ungefähr so ​​aus: <br><br><pre> <code class="cpp hljs"> ... <span class="hljs-comment"><span class="hljs-comment">// final world-space position float3 vNormal = Input.NormalW * 2.0 - 1.0; float lencameratoworld = length( PositionL - g_cameraPos.xyz) * 0.000001; PositionL += vNormal*lencameratoworld; // SV_Posiiton float4x4 matModelViewProjection = mul(g_viewProjMatrix, matInstanceWorld ); Output.PositionH = mul( float4(PositionL, 1.0), transpose(matModelViewProjection) ); return Output;</span></span></code> </pre> <br>  Diese Operation führt zu einer kleinen "Explosion" des Netzes (in Richtung des Normalenvektors).  Ich habe experimentiert, indem ich 0,000001 durch mehrere andere Werte ersetzt habe.  Hier sind die Ergebnisse: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f1/dca/ddb/6f1dcaddbdcd0f6e3c957cd8d2a1121b.jpg"></div><br>  <i>0,000002</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/609/289/c37/609289c37cea41590ffcb94beebae7e5.jpg"></div><br>  <i>0,000005</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56a/d36/09c/56ad3609c6bbe28990bc8894b163c50d.jpg"></div><br>  <i>0,00001</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/71b/e90/b04/71be90b04a538e953b4a0ee0d4ce2912.jpg"></div><br>  <i>0,000025</i> <br><br><h3>  Pixel Shader </h3><br>  Nun, wir haben den Vertex-Shader herausgefunden, jetzt ist es Zeit, zum Assembler-Code für den Pixel-Shader zu gelangen! <br><br><pre> <code class="cpp hljs"> ps_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb0[<span class="hljs-number"><span class="hljs-number">1</span></span>], immediateIndexed dcl_constantbuffer cb2[<span class="hljs-number"><span class="hljs-number">3</span></span>], immediateIndexed dcl_constantbuffer cb4[<span class="hljs-number"><span class="hljs-number">5</span></span>], immediateIndexed dcl_input_ps linear v0.x dcl_input_ps linear v1.w dcl_output o0.xyzw dcl_temps <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: mad r0.x, cb0[<span class="hljs-number"><span class="hljs-number">0</span></span>].x, cb4[<span class="hljs-number"><span class="hljs-number">4</span></span>].x, v0.x <span class="hljs-number"><span class="hljs-number">1</span></span>: add r0.y, r0.x, l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>: round_ni r0.y, r0.y <span class="hljs-number"><span class="hljs-number">3</span></span>: ishr r0.z, r0.y, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span>: xor r0.y, r0.y, r0.z <span class="hljs-number"><span class="hljs-number">5</span></span>: imul null, r0.z, r0.y, r0.y <span class="hljs-number"><span class="hljs-number">6</span></span>: imad r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: imad r0.y, r0.y, r0.z, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r0.y, r0.y, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span>: round_ni r0.z, r0.x <span class="hljs-number"><span class="hljs-number">10</span></span>: frc r0.x, r0.x <span class="hljs-number"><span class="hljs-number">11</span></span>: add r0.x, -r0.x, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">12</span></span>: ishr r0.w, r0.z, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">13</span></span>: xor r0.z, r0.z, r0.w <span class="hljs-number"><span class="hljs-number">14</span></span>: imul null, r0.w, r0.z, r0.z <span class="hljs-number"><span class="hljs-number">15</span></span>: imad r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span>: imad r0.z, r0.z, r0.w, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">17</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">18</span></span>: itof r0.yz, r0.yyzy <span class="hljs-number"><span class="hljs-number">19</span></span>: mul r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>) <span class="hljs-number"><span class="hljs-number">20</span></span>: mad r0.y, r0.y, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r0.z <span class="hljs-number"><span class="hljs-number">21</span></span>: mul r0.w, r0.x, r0.x <span class="hljs-number"><span class="hljs-number">22</span></span>: mul r0.x, r0.x, r0.w <span class="hljs-number"><span class="hljs-number">23</span></span>: mul r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">3.000000</span></span>) <span class="hljs-number"><span class="hljs-number">24</span></span>: mad r0.x, r0.x, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r0.w <span class="hljs-number"><span class="hljs-number">25</span></span>: mad r0.x, r0.x, r0.y, r0.z <span class="hljs-number"><span class="hljs-number">26</span></span>: add r0.y, -cb4[<span class="hljs-number"><span class="hljs-number">2</span></span>].x, cb4[<span class="hljs-number"><span class="hljs-number">3</span></span>].x <span class="hljs-number"><span class="hljs-number">27</span></span>: mad_sat r0.x, r0.x, r0.y, cb4[<span class="hljs-number"><span class="hljs-number">2</span></span>].x <span class="hljs-number"><span class="hljs-number">28</span></span>: mul r0.x, r0.x, v1.w <span class="hljs-number"><span class="hljs-number">29</span></span>: mul r0.yzw, cb4[<span class="hljs-number"><span class="hljs-number">0</span></span>].xxxx, cb4[<span class="hljs-number"><span class="hljs-number">1</span></span>].xxyz <span class="hljs-number"><span class="hljs-number">30</span></span>: mul r0.xyzw, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].wxyz <span class="hljs-number"><span class="hljs-number">31</span></span>: mul o0.xyz, r0.xxxx, r0.yzwy <span class="hljs-number"><span class="hljs-number">32</span></span>: mov o0.w, r0.x <span class="hljs-number"><span class="hljs-number">33</span></span>: ret</code> </pre> <br>  Gute Nachricht: Der Code ist nicht so lang. <br><br>  Schlechte Nachrichten: <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">3</span></span>: ishr r0.z, r0.y, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span>: xor r0.y, r0.y, r0.z <span class="hljs-number"><span class="hljs-number">5</span></span>: imul null, r0.z, r0.y, r0.y <span class="hljs-number"><span class="hljs-number">6</span></span>: imad r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: imad r0.y, r0.y, r0.z, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r0.y, r0.y, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>)</code> </pre> <br>  ... worum geht es? <br><br>  Ehrlich gesagt ist dies nicht das erste Mal, dass ich einen solchen Assembler-Code in den Witcher 3-Shadern sehe.  Aber als ich ihn zum ersten Mal traf, dachte ich: "Was zum Teufel ist das?" <br><br>  Ähnliches gilt für einige andere TW3-Shader.  Ich werde meine Abenteuer mit diesem Fragment nicht beschreiben und nur sagen, dass die Antwort im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ganzzahligen Rauschen liegt</a> : <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// For more details see: http://libnoise.sourceforge.net/noisegen/ float integerNoise( int n ) { n = (n &gt;&gt; 13) ^ n; int nn = (n * (n * n * 60493 + 19990303) + 1376312589) &amp; 0x7fffffff; return ((float)nn / 1073741824.0); }</span></span></code> </pre> <br>  Wie Sie sehen können, wird es im Pixel-Shader zweimal aufgerufen.  Anhand der Anleitungen auf dieser Website können wir verstehen, wie sanftes Rauschen korrekt implementiert wird.  Ich werde gleich darauf zurückkommen. <br><br>  Schauen Sie sich Zeile 0 an - hier animieren wir nach folgender Formel: <br><br>  <i>animation = elapsedTime * animationSpeed ​​+ TextureUV.x</i> <br>  Diese Werte werden nach zukünftiger Rundung auf die untere Seite ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Etage</a> ) (Anweisung <i>round_ni</i> ) zu Eingabepunkten für ganzzahliges Rauschen.  Normalerweise berechnen wir den Rauschwert für zwei Ganzzahlen und dann den endgültigen interpolierten Wert zwischen ihnen (Einzelheiten finden Sie auf der libnoise-Website). <br><br>  Nun, dies ist <b>ein ganzzahliges</b> Rauschen, aber schließlich sind alle zuvor genannten Werte (auch abgerundet) float! <br><br>  Beachten Sie, dass es hier keine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ftoi-</a> Anweisungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gibt</a> .  Ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gehe</a> davon aus, dass die Programmierer von CD Projekt Red hier die interne Funktion HLSL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">asint</a> verwendet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">haben</a> , die die Konvertierung von Gleitkommawerten „reinterpret_cast“ durchführt und diese als ganzzahliges Muster behandelt. <br><br>  Das Interpolationsgewicht für die beiden Werte wird in den Zeilen 10-11 berechnet. <br><br>  <i>interpolationWeight = 1.0 - frac (Animation);</i> <br>  Dieser Ansatz ermöglicht es uns, zwischen Werten über die Zeit zu interpolieren. <br><br>  Um ein gleichmäßiges Rauschen zu erzeugen, wird dieser Interpolator an die <b>SCurve-</b> Funktion übergeben: <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s_curve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x2 = x * x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x3 = x2 * x; <span class="hljs-comment"><span class="hljs-comment">// -2x^3 + 3x^2 return -2.0*x3 + 3.0*x2; }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15a/5d0/48e/15a5d048e4fcf9b12c51cad50d7bfc3e.png"></div><br>  <i>Smoothstep-Funktion [libnoise.sourceforge.net]</i> <br><br>  Diese Funktion wird als "Smoothstep" bezeichnet.  Wie Sie dem Assembler-Code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">entnehmen</a> können, handelt es sich hierbei <b>nicht um eine</b> interne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Smoothstep-</a> Funktion von HLSL.  Eine interne Funktion wendet Einschränkungen an, damit die Werte wahr sind.  Da wir jedoch wissen, dass <i>interpolationWeight</i> immer im Bereich [0-1] liegt, können diese Überprüfungen sicher übersprungen werden. <br><br>  Bei der Berechnung des Endwerts werden mehrere Multiplikationsoperationen verwendet.  Sehen Sie, wie sich die endgültige Alpha-Ausgabe abhängig vom Rauschwert ändern kann.  Dies ist praktisch, da es die Deckkraft des gerenderten Blitzes beeinflusst, genau wie im wirklichen Leben. <br><br>  Bereit für den Pixel-Shader: <br><br><pre> <code class="cpp hljs"> cbuffer cbPerFrame : <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> (b0) { float4 cb0_v0; float4 cb0_v1; float4 cb0_v2; float4 cb0_v3; } cbuffer cbPerFrame : <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> (b2) { float4 cb2_v0; float4 cb2_v1; float4 cb2_v2; float4 cb2_v3; } cbuffer cbPerFrame : <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> (b4) { float4 cb4_v0; float4 cb4_v1; float4 cb4_v2; float4 cb4_v3; float4 cb4_v4; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VS_OUTPUT</span></span></span><span class="hljs-class"> {</span></span> float2 Texcoords : Texcoord0; float4 InstanceLODParams : INSTANCE_LOD_PARAMS; float4 PositionH : SV_Position; }; <span class="hljs-comment"><span class="hljs-comment">// Shaders in TW3 use integer noise. // For more details see: http://libnoise.sourceforge.net/noisegen/ float integerNoise( int n ) { n = (n &gt;&gt; 13) ^ n; int nn = (n * (n * n * 60493 + 19990303) + 1376312589) &amp; 0x7fffffff; return ((float)nn / 1073741824.0); } float s_curve( float x ) { float x2 = x * x; float x3 = x2 * x; // -2x^3 + 3x^2 return -2.0*x3 + 3.0*x2; } float4 Lightning_TW3_PS( in VS_OUTPUT Input ) : SV_Target { // * Inputs float elapsedTime = cb0_v0.x; float animationSpeed = cb4_v4.x; float minAmount = cb4_v2.x; float maxAmount = cb4_v3.x; float colorMultiplier = cb4_v0.x; float3 colorFilter = cb4_v1.xyz; float3 lightningColorRGB = cb2_v2.rgb; // Animation using time and X texcoord float animation = elapsedTime * animationSpeed + Input.Texcoords.x; // Input parameters for Integer Noise. // They are floored and please note there are using asint. // That might be an optimization to avoid "ftoi" instructions. int intX0 = asint( floor(animation) ); int intX1 = asint( floor(animation-1.0) ); float n0 = integerNoise( intX0 ); float n1 = integerNoise( intX1 ); // We interpolate "backwards" here. float weight = 1.0 - frac(animation); // Following the instructions from libnoise, we perform // smooth interpolation here with cubic s-curve function. float noise = lerp( n0, n1, s_curve(weight) ); // Make sure we are in [0.0 - 1.0] range. float lightningAmount = saturate( lerp(minAmount, maxAmount, noise) ); lightningAmount *= Input.InstanceLODParams.w; // 1.0 lightningAmount *= cb2_v2.w; // 1.0 // Calculate final lightning color float3 lightningColor = colorMultiplier * colorFilter; lightningColor *= lighntingColorRGB; float3 finalLightningColor = lightningColor * lightningAmount; return float4( finalLightningColor, lightningAmount ); }</span></span></code> </pre> <br><h3>  Zusammenfassend </h3><br>  In diesem Teil habe ich in The Witcher 3 eine Möglichkeit beschrieben, Blitze zu rendern. <br><br>  Ich freue mich sehr, dass der Assembler-Code, der aus meinem Shader stammt, vollständig mit dem Original übereinstimmt! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/25c/708/e50/25c708e503f4528c313c557abb080222.jpg"></div><br><h2>  Teil 2. Dumme Himmels-Tricks </h2><br>  Dieser Teil unterscheidet sich geringfügig von den vorherigen.  Darin möchte ich Ihnen einige Aspekte des Sky Shader Witcher 3 zeigen. <br><br>  Warum "dumme Tricks" und nicht der ganze Shader?  Nun, es gibt mehrere Gründe.  Erstens ist der Witcher 3 Sky Shader ein ziemlich komplexes Tier.  Der Pixel-Shader aus der Version 2015 enthält 267 Zeilen Assembler-Code, und der Shader aus dem Blood and Wine-DLC enthält 385 Zeilen. <br><br>  Darüber hinaus erhalten sie viele Eingaben, was für das Reverse Engineering des vollständigen (und lesbaren!) HLSL-Codes nicht sehr förderlich ist. <br><br>  Deshalb habe ich beschlossen, nur einen Teil der Tricks dieser Shader zu zeigen.  Wenn ich etwas Neues finde, werde ich den Beitrag ergänzen. <br><br>  Die Unterschiede zwischen der Version 2015 und dem DLC (2016) sind sehr deutlich.  Insbesondere enthalten sie Unterschiede in der Berechnung von Sternen und deren Flimmern, eine andere Herangehensweise an das Rendern der Sonne ... <i>Der Blut- und Wein-</i> Shader berechnet sogar die Milchstraße bei Nacht. <br><br>  Ich werde mit den Grundlagen beginnen und dann über dumme Tricks sprechen. <br><br><h3>  Die Grundlagen </h3><br>  Wie die meisten modernen Spiele verwendet Witcher 3 Skydome, um den Himmel zu modellieren.  Schauen Sie sich die dafür verwendete Halbkugel in Witcher 3 (2015) an.  Hinweis: In diesem Fall liegt der Begrenzungsrahmen dieses Netzes im Bereich von [0,0,0] bis [1,1,1] (Z ist die nach oben weisende Achse) und weist gleichmäßig verteilte UV-Strahlen auf.  Später benutzen wir sie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cf/49a/34d/3cf49a34dead2ff2e6f2542487edbf65.jpg"></div><br>  Die Idee hinter Skydome ähnelt der Idee von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Skybox</a> (der einzige Unterschied ist das verwendete Netz).  Im Vertex-Shader-Stadium transformieren wir den Skydome relativ zum Betrachter (normalerweise entsprechend der Kameraposition), wodurch die Illusion entsteht, dass der Himmel tatsächlich sehr weit entfernt ist - wir werden ihn niemals erreichen. <br><br>  Wenn Sie die vorherigen Teile dieser Artikelserie lesen, wissen Sie, dass „The Witcher 3“ die inverse Tiefe verwendet, dh die ferne Ebene ist 0.0f und die nächste ist 1.0f.  Damit die Skydome-Ausgabe vollständig in der Fernebene ausgeführt wird, setzen wir in den Parametern des Suchfensters <i>MinDepth auf</i> den gleichen Wert wie <i>MaxDepth</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/34f/931/2d734f931c687dde42e3bb549a695764.jpg"></div><br>  Klicken Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> (docs.microsoft.com), um zu erfahren, wie die <i>Felder</i> <i>MinDepth</i> und <i>MaxDepth</i> während der Konvertierung des Suchfensters verwendet werden. <br><br><h3>  Vertex-Shader </h3><br>  Beginnen wir mit dem Vertex-Shader.  In Witcher 3 (2015) lautet der Assembler-Shader-Code wie folgt: <br><br><pre> <code class="cpp hljs"> vs_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb1[<span class="hljs-number"><span class="hljs-number">4</span></span>], immediateIndexed dcl_constantbuffer cb2[<span class="hljs-number"><span class="hljs-number">6</span></span>], immediateIndexed dcl_input v0.xyz dcl_input v1.xy dcl_output o0.xy dcl_output o1.xyz dcl_output_siv o2.xyzw, position dcl_temps <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: mov o0.xy, v1.xyxx <span class="hljs-number"><span class="hljs-number">1</span></span>: mad r0.xyz, v0.xyzx, cb2[<span class="hljs-number"><span class="hljs-number">4</span></span>].xyzx, cb2[<span class="hljs-number"><span class="hljs-number">5</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">2</span></span>: mov r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span>: dp4 o1.x, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">4</span></span>: dp4 o1.y, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">5</span></span>: dp4 o1.z, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">6</span></span>: mul r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].yyyy, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">7</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].xxxx, r1.xyzw <span class="hljs-number"><span class="hljs-number">8</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].zzzz, r1.xyzw <span class="hljs-number"><span class="hljs-number">9</span></span>: mad r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.xyzw <span class="hljs-number"><span class="hljs-number">10</span></span>: dp4 o2.x, r0.xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">11</span></span>: mul r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].yyyy, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">12</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].xxxx, r1.xyzw <span class="hljs-number"><span class="hljs-number">13</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].zzzz, r1.xyzw <span class="hljs-number"><span class="hljs-number">14</span></span>: mad r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.xyzw <span class="hljs-number"><span class="hljs-number">15</span></span>: dp4 o2.y, r0.xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">16</span></span>: mul r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].yyyy, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">17</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].xxxx, r1.xyzw <span class="hljs-number"><span class="hljs-number">18</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].zzzz, r1.xyzw <span class="hljs-number"><span class="hljs-number">19</span></span>: mad r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.xyzw <span class="hljs-number"><span class="hljs-number">20</span></span>: dp4 o2.z, r0.xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">21</span></span>: mul r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].yyyy, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">22</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].xxxx, r1.xyzw <span class="hljs-number"><span class="hljs-number">23</span></span>: mad r1.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].zzzz, r1.xyzw <span class="hljs-number"><span class="hljs-number">24</span></span>: mad r1.xyzw, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].wwww, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>), r1.xyzw <span class="hljs-number"><span class="hljs-number">25</span></span>: dp4 o2.w, r0.xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">26</span></span>: ret</code> </pre> <br>  In diesem Fall überträgt der Vertex-Shader nur Texcoords und eine Position im Weltraum an die Ausgabe.  In <i>Blood and Wine zeigt</i> er auch einen normalisierten Normalenvektor an.  Ich werde die Version 2015 in Betracht ziehen, weil sie einfacher ist. <br><br>  Schauen Sie sich den als <b>cb2</b> bezeichneten konstanten Puffer an: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/360/38d/fc6/36038dfc67c29ef2934d96314ed46aff.jpg"></div><br>  Hier haben wir eine Matrix der Welt (einheitliche Skalierung um 100 und Übertragung relativ zur Kameraposition).  Nichts kompliziertes.  cb2_v4 und cb2_v5 sind die Skalierungs- / Abweichungsfaktoren, die zum Konvertieren der Scheitelpunktpositionen vom Intervall [0-1] in das Intervall [-1; 1] verwendet werden.  Hier „komprimieren“ diese Koeffizienten jedoch die Z-Achse (nach oben). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e9/774/4c2/7e97744c28b0997b0b11049bee26fa7b.jpg"></div><br>  In den vorherigen Teilen der Serie hatten wir ähnliche Vertex-Shader.  Der allgemeine Algorithmus besteht darin, Texcoords weiter zu übertragen, dann wird die <i>Position</i> unter Berücksichtigung von Skalierungs- / Abweichungskoeffizienten berechnet, dann wird <i>PositionW</i> im Weltraum berechnet, dann wird die endgültige Position des Clipping-Raums durch Multiplikation von <i>matWorld</i> und <i>matViewProj berechnet</i> -&gt; ihr Produkt wird verwendet, um mit <i>Position</i> zu multiplizieren, um die endgültige SV_Position zu erhalten . <br><br>  Daher sollte die HLSL dieses Vertex-Shaders ungefähr so ​​aussehen: <br><br><pre> <code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputStruct</span></span></span><span class="hljs-class"> {</span></span> float3 param0 : POSITION; float2 param1 : TEXCOORD; float3 param2 : NORMAL; float4 param3 : TANGENT; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OutputStruct</span></span></span><span class="hljs-class"> {</span></span> float2 param0 : TEXCOORD0; float3 param1 : TEXCOORD1; float4 param2 : SV_Position; }; <span class="hljs-function"><span class="hljs-function">OutputStruct </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditedShaderVS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(in InputStruct IN)</span></span></span><span class="hljs-function"> </span></span>{ OutputStruct OUT = (OutputStruct)<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Simple texcoords passing OUT.param0 = IN.param1; // * Manually construct world and viewProj martices from float4s: row_major matrix matWorld = matrix(cb2_v0, cb2_v1, cb2_v2, float4(0,0,0,1) ); matrix matViewProj = matrix(cb1_v0, cb1_v1, cb1_v2, cb1_v3); // * Some optional fun with worldMatrix // a) Scale //matWorld._11 = matWorld._22 = matWorld._33 = 0.225f; // b) Translate // XYZ //matWorld._14 = 520.0997; //matWorld._24 = 74.4226; //matWorld._34 = 113.9; // Local space - note the scale+bias here! //float3 meshScale = float3(2.0, 2.0, 2.0); //float3 meshBias = float3(-1.0, -1.0, -0.4); float3 meshScale = cb2_v4.xyz; float3 meshBias = cb2_v5.xyz; float3 Position = IN.param0 * meshScale + meshBias; // World space float4 PositionW = mul(float4(Position, 1.0), transpose(matWorld) ); OUT.param1 = PositionW.xyz; // Clip space - original approach from The Witcher 3 matrix matWorldViewProj = mul(matViewProj, matWorld); OUT.param2 = mul( float4(Position, 1.0), transpose(matWorldViewProj) ); return OUT; }</span></span></code> </pre> <br>  Vergleich meines Shaders (links) und des Originals (rechts): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd9/ed7/de2/fd9ed7de275ba36551e7751e1d351b8c.jpg"></div><br>  Eine hervorragende Eigenschaft von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RenderDoc</a> ist, dass wir unseren eigenen Shader anstelle des ursprünglichen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einfügen</a> können. Diese Änderungen wirken sich auf die Pipeline bis zum Ende des Frames aus.  Wie Sie dem HLSL-Code entnehmen können, habe ich verschiedene Optionen zum Zoomen und Transformieren der endgültigen Geometrie bereitgestellt.  Sie können mit ihnen experimentieren und sehr lustige Ergebnisse erzielen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a5/350/e14/0a5350e14231505c0ff1bd5cbf384e15.jpg"></div><br><h4>  Vertex Shader-Optimierung </h4><br>  Haben Sie das Problem des ursprünglichen Vertex-Shaders bemerkt?  Die Scheitelpunktmultiplikation einer Matrix mit einer Matrix ist völlig redundant!  Ich fand dies in mindestens einigen Vertex-Shadern (zum Beispiel im Shader ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Regenvorhang in der Ferne</a> ).  Wir können es optimieren, indem wir <i>PositionW</i> sofort mit <i>matViewProj</i> multiplizieren! <br><br>  Wir können diesen Code also durch HLSL ersetzen: <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Clip space - original approach from The Witcher 3 matrix matWorldViewProj = mul(matViewProj, matWorld); OUT.param2 = mul( float4(Position, 1.0), transpose(matWorldViewProj) );</span></span></code> </pre> <br>  wie folgt: <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Clip space - optimized version OUT.param2 = mul( matViewProj, PositionW );</span></span></code> </pre> <br>  Die optimierte Version gibt uns den folgenden Assembler-Code: <br><br><pre> <code class="cpp hljs"> vs_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer CB1[<span class="hljs-number"><span class="hljs-number">4</span></span>], immediateIndexed dcl_constantbuffer CB2[<span class="hljs-number"><span class="hljs-number">6</span></span>], immediateIndexed dcl_input v0.xyz dcl_input v1.xy dcl_output o0.xy dcl_output o1.xyz dcl_output_siv o2.xyzw, position dcl_temps <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: mov o0.xy, v1.xyxx <span class="hljs-number"><span class="hljs-number">1</span></span>: mad r0.xyz, v0.xyzx, cb2[<span class="hljs-number"><span class="hljs-number">4</span></span>].xyzx, cb2[<span class="hljs-number"><span class="hljs-number">5</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">2</span></span>: mov r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span>: dp4 r1.x, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">4</span></span>: dp4 r1.y, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">5</span></span>: dp4 r1.z, r0.xyzw, cb2[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw <span class="hljs-number"><span class="hljs-number">6</span></span>: mov o1.xyz, r1.xyzx <span class="hljs-number"><span class="hljs-number">7</span></span>: mov r1.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span>: dp4 o2.x, cb1[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">9</span></span>: dp4 o2.y, cb1[<span class="hljs-number"><span class="hljs-number">1</span></span>].xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">10</span></span>: dp4 o2.z, cb1[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">11</span></span>: dp4 o2.w, cb1[<span class="hljs-number"><span class="hljs-number">3</span></span>].xyzw, r1.xyzw <span class="hljs-number"><span class="hljs-number">12</span></span>: ret</code> </pre> <br>  Wie Sie sehen, haben wir die Anzahl der Anweisungen von 26 auf 12 reduziert - eine ziemlich bedeutende Änderung.  Ich weiß nicht, wie weit verbreitet dieses Problem im Spiel ist, aber um Gottes willen, CD Projekt Red, veröffentlichen Sie vielleicht einen Patch?  :) :) <br><br>  Und ich scherze nicht.  Sie können meinen optimierten Shader anstelle des ursprünglichen RenderDoc einfügen und Sie werden sehen, dass diese Optimierung keine visuellen Auswirkungen hat.  Ehrlich gesagt verstehe ich nicht, warum CD Projekt Red beschlossen hat, eine Scheitelpunktmultiplikation einer Matrix mit einer Matrix durchzuführen ... <br><br><h3>  Die Sonne </h3><br>  In The Witcher 3 (2015) besteht die Berechnung der atmosphärischen Streuung und der Sonne aus zwei separaten Zeichnungsaufrufen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/649/9df/02c/6499df02c248c9bab14a597b6b111d6d.jpg"></div><br>  <i>Hexer 3 (2015) - Bis</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fe6/4ee/77c/fe64ee77c1923920bc01de149ddb60e7.jpg"></div><br>  <i>Hexer 3 (2015) - mit dem Himmel</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64d/9e5/416/64d9e541622b33d646b887db01c7c1a2.jpg"></div><br>  <i>Hexer 3 (2015) - mit Himmel + Sonne</i> <br><br>  Das Rendering der Sonne in der Version 2015 ist dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Rendering des Mondes</a> in Bezug auf Geometrie und Mischungs- / Tiefenzustände sehr ähnlich. <br><br>  Andererseits wird in <i>"Blut und Wein" der</i> Himmel mit der Sonne in einem Durchgang gerendert: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/184/7dd/daa/1847dddaa38e0876bc829a2d5747c9ce.jpg"></div><br>  <i>The Witcher 3: Blut und Wein (2016) - Zum Himmel</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7fa/aff/002/7faaff002cc6d328d663c582c74a3628.jpg"></div><br>  <i>The Witcher 3: Blut und Wein (2016) - mit Himmel und Sonne</i> <br><br>  Egal wie Sie die Sonne rendern, irgendwann benötigen Sie immer noch die (normalisierte) Richtung des Sonnenlichts.  Der logischste Weg, diesen Vektor zu erhalten, ist die Verwendung von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sphärischen Koordinaten</a> .  Tatsächlich benötigen wir nur zwei Werte, die zwei Winkel angeben (im Bogenmaß!): <i>Phi</i> und <i>Theta</i> .  Nachdem wir sie erhalten haben, können wir annehmen, dass <i>r = 1 ist</i> , wodurch es reduziert wird.  Dann können Sie für die kartesischen Koordinaten mit der Y-Achse nach oben den folgenden Code in HLSL schreiben: <br><br><pre> <code class="cpp hljs"> float3 vSunDir; vSunDir.x = <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(fTheta)*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(fPhi); vSunDir.y = <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(fTheta)*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(fPhi); vSunDir.z = <span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(fTheta); vSunDir = normalize(vSunDir);</code> </pre> <br>  In der Regel wird die Richtung des Sonnenlichts in der Anwendung berechnet und dann zur zukünftigen Verwendung an den konstanten Puffer übergeben. <br><br>  Nachdem wir die Richtung des Sonnenlichts erhalten haben, können wir tiefer in den Assembler-Code des Pixel-Shaders <i>„Blood and Wine“</i> eintauchen ... <br><br><pre> <code class="cpp hljs"> ... <span class="hljs-number"><span class="hljs-number">100</span></span>: add r1.xyw, -r0.xyxz, cb12[<span class="hljs-number"><span class="hljs-number">0</span></span>].xyxz <span class="hljs-number"><span class="hljs-number">101</span></span>: dp3 r2.x, r1.xywx, r1.xywx <span class="hljs-number"><span class="hljs-number">102</span></span>: rsq r2.x, r2.x <span class="hljs-number"><span class="hljs-number">103</span></span>: mul r1.xyw, r1.xyxw, r2.xxxx <span class="hljs-number"><span class="hljs-number">104</span></span>: mov_sat r2.xy, cb12[<span class="hljs-number"><span class="hljs-number">205</span></span>].yxyy <span class="hljs-number"><span class="hljs-number">105</span></span>: dp3 r2.z, -r1.xywx, -r1.xywx <span class="hljs-number"><span class="hljs-number">106</span></span>: rsq r2.z, r2.z <span class="hljs-number"><span class="hljs-number">107</span></span>: mul r1.xyw, -r1.xyxw, r2.zzzz ...</code> </pre> <br>  Erstens ist <i>cb12 [0] .xyz</i> die Kameraposition, und in <i>r0.xyz</i> speichern wir die Scheitelpunktposition (dies ist die Ausgabe vom Scheitelpunkt-Shader).  Daher berechnet Zeile 100 den Vektor <i>worldToCamera</i> .  Aber schauen Sie sich die Zeilen 105-107 an.  Wir können sie als <i>normalize (-worldToCamera)</i> schreiben, d. H. Wir berechnen den normalisierten <i>cameraToWorld-</i> Vektor. <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">120</span></span>: dp3_sat r1.x, cb12[<span class="hljs-number"><span class="hljs-number">203</span></span>].yzwy, r1.xywx</code> </pre> <br>  Dann berechnen wir das Skalarprodukt der <i>Vektoren</i> <i>cameraToWorld</i> und <i>sunDirection</i> !  Denken Sie daran, dass sie normalisiert werden müssen.  Wir sättigen diesen vollständigen Ausdruck auch, um ihn auf das Intervall [0-1] zu beschränken. <br><br>  Großartig!  Dieses Skalarprodukt ist in r1.x gespeichert.  Mal sehen, wo es als nächstes gilt ... <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">152</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r1.x, r1.x <span class="hljs-number"><span class="hljs-number">153</span></span>: mul r1.x, r1.x, cb12[<span class="hljs-number"><span class="hljs-number">203</span></span>].x <span class="hljs-number"><span class="hljs-number">154</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r1.x, r1.x <span class="hljs-number"><span class="hljs-number">155</span></span>: mul r1.x, r2.y, r1.x</code> </pre> <br>  Die Dreifaltigkeit "log, mul, exp" ist Potenzierung.  Wie Sie sehen können, erhöhen wir unseren Kosinus (das Skalarprodukt normalisierter Vektoren) in gewissem Maße.  Sie fragen sich vielleicht warum.  Auf diese Weise können wir einen Farbverlauf erzeugen, der die Sonne nachahmt.  (Und Zeile 155 wirkt sich auf die Deckkraft dieses Verlaufs aus, sodass wir ihn beispielsweise zurücksetzen, um die Sonne vollständig zu verbergen.)  Hier einige Beispiele: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/674/662/658/6746626580dbe0d943c27bcda10f8a9d.jpg"></div><br>  <i>Exponent = 54</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b0a/a4e/fca/b0aa4efcae350fe8423e3bc8a1463d78.jpg"></div><br>  <i>Exponent = 2400</i> <br><br>  Mit diesem Farbverlauf interpolieren wir zwischen <i>skyColor</i> und <i>sunColor</i> !  Um Artefakte zu vermeiden, müssen Sie den Wert in Zeile 120 sättigen. <br><br>  Es ist erwähnenswert, dass dieser Trick verwendet werden kann, um die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kronen des</a> Mondes zu simulieren (bei niedrigen Exponentenwerten).  Dazu benötigen wir den <i>moonDirection-</i> Vektor, der leicht mit sphärischen Koordinaten berechnet werden kann. <br><br>  Der vorgefertigte HLSL-Code sieht möglicherweise wie folgt aus: <br><br><pre> <code class="cpp hljs"> float3 vCamToWorld = normalize( PosW – CameraPos ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cosTheta = saturate( dot(vSunDir, vCamToWorld) ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sunGradient = <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>( cosTheta, sunExponent ); float3 color = lerp( skyColor, sunColor, sunGradient );</code> </pre> <br><h3>  Bewegung der Sterne </h3><br>  Wenn Sie den klaren Nachthimmel von Witcher 3 im Zeitraffer betrachten, können Sie sehen, dass die Sterne nicht statisch sind - sie bewegen sich ein wenig über den Himmel!  Ich habe das fast zufällig bemerkt und wollte wissen, wie es umgesetzt wurde. <br><br>  Beginnen wir mit der Tatsache, dass die Sterne in Witcher 3 als kubische Karte der Größe 1024x1024x6 dargestellt werden.  Wenn Sie darüber nachdenken, können Sie verstehen, dass dies eine sehr praktische Lösung ist, mit der Sie leicht Anweisungen zum Abtasten einer kubischen Karte abrufen können. <br><br>  Schauen wir uns den folgenden Assembler-Code an: <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">159</span></span>: add r1.xyz, -v1.xyzx, cb1[<span class="hljs-number"><span class="hljs-number">8</span></span>].xyzx <span class="hljs-number"><span class="hljs-number">160</span></span>: dp3 r0.w, r1.xyzx, r1.xyzx <span class="hljs-number"><span class="hljs-number">161</span></span>: rsq r0.w, r0.w <span class="hljs-number"><span class="hljs-number">162</span></span>: mul r1.xyz, r0.wwww, r1.xyzx <span class="hljs-number"><span class="hljs-number">163</span></span>: mul r2.xyz, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].zwyz, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">164</span></span>: mad r2.xyz, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].yzwy, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), -r2.xyzx <span class="hljs-number"><span class="hljs-number">165</span></span>: mul r4.xyz, r2.xyzx, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].zwyz <span class="hljs-number"><span class="hljs-number">166</span></span>: mad r4.xyz, r2.zxyz, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].wyzw, -r4.xyzx <span class="hljs-number"><span class="hljs-number">167</span></span>: dp3 r4.x, r1.xyzx, r4.xyzx <span class="hljs-number"><span class="hljs-number">168</span></span>: dp2 r4.y, r1.xyxx, r2.yzyy <span class="hljs-number"><span class="hljs-number">169</span></span>: dp3 r4.z, r1.xyzx, cb12[<span class="hljs-number"><span class="hljs-number">204</span></span>].yzwy <span class="hljs-number"><span class="hljs-number">170</span></span>: dp3 r0.w, r4.xyzx, r4.xyzx <span class="hljs-number"><span class="hljs-number">171</span></span>: rsq r0.w, r0.w <span class="hljs-number"><span class="hljs-number">172</span></span>: mul r2.xyz, r0.wwww, r4.xyzx <span class="hljs-number"><span class="hljs-number">173</span></span>: sample_indexable(texturecube)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r4.xyz, r2.xyzx, t0.xyzw, s0</code> </pre> <br>  Um den endgültigen <i>Abtastvektor</i> (Zeile 173) zu berechnen, berechnen wir zunächst den normalisierten <i>worldToCamera-</i> Vektor (Zeilen 159-162). <br><br>  Dann berechnen wir zwei Vektorprodukte (163-164, 165-166) mit <i>moonDirection</i> und später drei Skalarprodukte, um den endgültigen <i>Abtastvektor</i> zu erhalten.  HLSL-Code: <br><br><pre> <code class="cpp hljs"> float3 vWorldToCamera = normalize( g_CameraPos.xyz - Input.PositionW.xyz ); float3 vMoonDirection = cb12_v204.yzw; float3 vStarsSamplingDir = cross( vMoonDirection, float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) ); float3 vStarsSamplingDir2 = cross( vStarsSamplingDir, vMoonDirection ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dirX = dot( vWorldToCamera, vStarsSamplingDir2 ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dirY = dot( vWorldToCamera, vStarsSamplingDir ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dirZ = dot( vWorldToCamera, vMoonDirection); float3 dirXYZ = normalize( float3(dirX, dirY, dirZ) ); float3 starsColor = texNightStars.Sample( samplerAnisoWrap, dirXYZ ).rgb;</code> </pre> <br>  Hinweis für mich: Dies ist ein sehr gut gestalteter Code, und ich sollte ihn genauer untersuchen. <br><br>  Hinweis für die Leser: Wenn Sie mehr über diesen Vorgang wissen, sagen Sie es mir! <br><br><h3>  Funkelnde Sterne </h3><br>  Ein weiterer interessanter Trick, den ich genauer untersuchen möchte, ist das Flackern von Sternen.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie beispielsweise bei klarem Wetter durch Novigrad wandern, werden Sie feststellen, dass die Sterne funkeln. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich war gespannt, wie das umgesetzt wurde. Es stellte sich heraus, dass der Unterschied zwischen der Version 2015 und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„Blood and Wine“</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ziemlich groß ist. Der Einfachheit halber werde ich die Version 2015 betrachten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir beginnen also direkt nach dem Abtasten von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starsColor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus dem vorherigen Abschnitt:</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">174</span></span>: mul r0.w, v0.x, l(<span class="hljs-number"><span class="hljs-number">100.000000</span></span>) <span class="hljs-number"><span class="hljs-number">175</span></span>: round_ni r1.w, r0.w <span class="hljs-number"><span class="hljs-number">176</span></span>: mad r2.w, v0.y, l(<span class="hljs-number"><span class="hljs-number">50.000000</span></span>), cb0[<span class="hljs-number"><span class="hljs-number">0</span></span>].x <span class="hljs-number"><span class="hljs-number">177</span></span>: round_ni r4.w, r2.w <span class="hljs-number"><span class="hljs-number">178</span></span>: bfrev r4.w, r4.w <span class="hljs-number"><span class="hljs-number">179</span></span>: iadd r5.x, r1.w, r4.w <span class="hljs-number"><span class="hljs-number">180</span></span>: ishr r5.y, r5.x, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">181</span></span>: xor r5.x, r5.x, r5.y <span class="hljs-number"><span class="hljs-number">182</span></span>: imul null, r5.y, r5.x, r5.x <span class="hljs-number"><span class="hljs-number">183</span></span>: imad r5.y, r5.y, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">184</span></span>: imad r5.x, r5.x, r5.y, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">185</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r5.x, r5.x, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">186</span></span>: itof r5.x, r5.x <span class="hljs-number"><span class="hljs-number">187</span></span>: mad r5.y, v0.x, l(<span class="hljs-number"><span class="hljs-number">100.000000</span></span>), l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">188</span></span>: round_ni r5.y, r5.y <span class="hljs-number"><span class="hljs-number">189</span></span>: iadd r4.w, r4.w, r5.y <span class="hljs-number"><span class="hljs-number">190</span></span>: ishr r5.z, r4.w, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">191</span></span>: xor r4.w, r4.w, r5.z <span class="hljs-number"><span class="hljs-number">192</span></span>: imul null, r5.z, r4.w, r4.w <span class="hljs-number"><span class="hljs-number">193</span></span>: imad r5.z, r5.z, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">194</span></span>: imad r4.w, r4.w, r5.z, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">195</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r4.w, r4.w, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">196</span></span>: itof r4.w, r4.w <span class="hljs-number"><span class="hljs-number">197</span></span>: add r5.z, r2.w, l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">198</span></span>: round_ni r5.z, r5.z <span class="hljs-number"><span class="hljs-number">199</span></span>: bfrev r5.z, r5.z <span class="hljs-number"><span class="hljs-number">200</span></span>: iadd r1.w, r1.w, r5.z <span class="hljs-number"><span class="hljs-number">201</span></span>: ishr r5.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">202</span></span>: xor r1.w, r1.w, r5.w <span class="hljs-number"><span class="hljs-number">203</span></span>: imul null, r5.w, r1.w, r1.w <span class="hljs-number"><span class="hljs-number">204</span></span>: imad r5.w, r5.w, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">205</span></span>: imad r1.w, r1.w, r5.w, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">206</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r1.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">207</span></span>: itof r1.w, r1.w <span class="hljs-number"><span class="hljs-number">208</span></span>: mul r1.w, r1.w, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>) <span class="hljs-number"><span class="hljs-number">209</span></span>: iadd r5.y, r5.z, r5.y <span class="hljs-number"><span class="hljs-number">210</span></span>: ishr r5.z, r5.y, l(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-number"><span class="hljs-number">211</span></span>: xor r5.y, r5.y, r5.z <span class="hljs-number"><span class="hljs-number">212</span></span>: imul null, r5.z, r5.y, r5.y <span class="hljs-number"><span class="hljs-number">213</span></span>: imad r5.z, r5.z, l(<span class="hljs-number"><span class="hljs-number">0x0000ec4d</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span>) <span class="hljs-number"><span class="hljs-number">214</span></span>: imad r5.y, r5.y, r5.z, l(<span class="hljs-number"><span class="hljs-number">146956042240.000000</span></span>) <span class="hljs-number"><span class="hljs-number">215</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> r5.y, r5.y, l(<span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>) <span class="hljs-number"><span class="hljs-number">216</span></span>: itof r5.y, r5.y <span class="hljs-number"><span class="hljs-number">217</span></span>: frc r0.w, r0.w <span class="hljs-number"><span class="hljs-number">218</span></span>: add r0.w, -r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">219</span></span>: mul r5.z, r0.w, r0.w <span class="hljs-number"><span class="hljs-number">220</span></span>: mul r0.w, r0.w, r5.z <span class="hljs-number"><span class="hljs-number">221</span></span>: mul r5.xz, r5.xxzx, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">3.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">222</span></span>: mad r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r5.z <span class="hljs-number"><span class="hljs-number">223</span></span>: frc r2.w, r2.w <span class="hljs-number"><span class="hljs-number">224</span></span>: add r2.w, -r2.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">225</span></span>: mul r5.z, r2.w, r2.w <span class="hljs-number"><span class="hljs-number">226</span></span>: mul r2.w, r2.w, r5.z <span class="hljs-number"><span class="hljs-number">227</span></span>: mul r5.z, r5.z, l(<span class="hljs-number"><span class="hljs-number">3.000000</span></span>) <span class="hljs-number"><span class="hljs-number">228</span></span>: mad r2.w, r2.w, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r5.z <span class="hljs-number"><span class="hljs-number">229</span></span>: mad r4.w, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r5.x <span class="hljs-number"><span class="hljs-number">230</span></span>: mad r4.w, r0.w, r4.w, r5.x <span class="hljs-number"><span class="hljs-number">231</span></span>: mad r5.x, r5.y, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r1.w <span class="hljs-number"><span class="hljs-number">232</span></span>: mad r0.w, r0.w, r5.x, r1.w <span class="hljs-number"><span class="hljs-number">233</span></span>: add r0.w, -r4.w, r0.w <span class="hljs-number"><span class="hljs-number">234</span></span>: mad r0.w, r2.w, r0.w, r4.w <span class="hljs-number"><span class="hljs-number">235</span></span>: mad r2.xyz, r0.wwww, l(<span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r2.xyzx <span class="hljs-number"><span class="hljs-number">236</span></span>: sample_indexable(texturecube)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r2.xyz, r2.xyzx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">237</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r4.xyz, r4.xyzx <span class="hljs-number"><span class="hljs-number">238</span></span>: mul r4.xyz, r4.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">239</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r4.xyz, r4.xyzx <span class="hljs-number"><span class="hljs-number">240</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r2.xyz, r2.xyzx <span class="hljs-number"><span class="hljs-number">241</span></span>: mul r2.xyz, r2.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">2.200000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">242</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r2.xyz, r2.xyzx <span class="hljs-number"><span class="hljs-number">243</span></span>: mul r2.xyz, r2.xyzx, r4.xyzx</code> </pre> <br>  Hm.         . <br><br>   <i>starsColor</i>   173   -  <i>offset</i> .  <i>offset</i>       (r2.xyz,  235),       ,  -    (237-242)    (243). <br><br> ,   ? ,  .      <i>offset</i> .         skydome —       . <br><br>  <i>offset</i>     ,   ,  UV   skydome (v0.xy)    ,     (cb[0].x). <br><br>      ishr/xor/and,          . <br><br>  ,      ,     ,    .      ,        ( <i>iadd</i> )       (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">reversebits</a> ;  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bfrev</a> ). <br><br> ,   .     . <br><br>    4 «»  .    ,   4   : <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> asint( <span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(x) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getReverseInt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reversebits( getInt(x) ); } <span class="hljs-comment"><span class="hljs-comment">// * Inputs - UV and elapsed time in seconds float2 starsUV; starsUV.x = 100.0 * Input.TextureUV.x; starsUV.y = 50.0 * Input.TextureUV.y + g_fTime; // * Iteration 1 int iStars1_A = getReverseInt( starsUV.y ); int iStars1_B = getInt( starsUV.x ); float fStarsNoise1 = integerNoise( iStars1_A + iStars1_B ); // * Iteration 2 int iStars2_A = getReverseInt( starsUV.y ); int iStars2_B = getInt( starsUV.x - 1.0 ); float fStarsNoise2 = integerNoise( iStars2_A + iStars2_B ); // * Iteration 3 int iStars3_A = getReverseInt( starsUV.y - 1.0 ); int iStars3_B = getInt( starsUV.x ); float fStarsNoise3 = integerNoise( iStars3_A + iStars3_B ); // * Iteration 4 int iStars4_A = getReverseInt( starsUV.y - 1.0 ); int iStars4_B = getInt( starsUV.x - 1.0 ); float fStarsNoise4 = integerNoise( iStars4_A + iStars4_B );</span></span></code> </pre> <br>     4  (  ,    <i>itof</i> ): <br><br>  1 — r5.x, <br><br>  2 — r4.w, <br><br>  3 — r1.w, <br><br>  4 — r5.y <br><br>   <i>itof</i> ( 216)  : <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">217</span></span>: frc r0.w, r0.w <span class="hljs-number"><span class="hljs-number">218</span></span>: add r0.w, -r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">219</span></span>: mul r5.z, r0.w, r0.w <span class="hljs-number"><span class="hljs-number">220</span></span>: mul r0.w, r0.w, r5.z <span class="hljs-number"><span class="hljs-number">221</span></span>: mul r5.xz, r5.xxzx, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">3.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">222</span></span>: mad r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r5.z <span class="hljs-number"><span class="hljs-number">223</span></span>: frc r2.w, r2.w <span class="hljs-number"><span class="hljs-number">224</span></span>: add r2.w, -r2.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">225</span></span>: mul r5.z, r2.w, r2.w <span class="hljs-number"><span class="hljs-number">226</span></span>: mul r2.w, r2.w, r5.z <span class="hljs-number"><span class="hljs-number">227</span></span>: mul r5.z, r5.z, l(<span class="hljs-number"><span class="hljs-number">3.000000</span></span>) <span class="hljs-number"><span class="hljs-number">228</span></span>: mad r2.w, r2.w, l(<span class="hljs-number"><span class="hljs-number">-2.000000</span></span>), r5.z</code> </pre> <br>     S-        UV,      .  Also: <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s_curve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x2 = x * x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x3 = x2 * x; <span class="hljs-comment"><span class="hljs-comment">// -2x^3 + 3x^2 return -2.0*x3 + 3.0*x2; } ... // lines 217-222 float weightX = 1.0 - frac( starsUV.x ); weightX = s_curve( weightX ); // lines 223-228 float weightY = 1.0 - frac( starsUV.y ); weightY = s_curve( weightY );</span></span></code> </pre> <br>    ,              : <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">229</span></span>: mad r4.w, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r5.x <span class="hljs-number"><span class="hljs-number">230</span></span>: mad r4.w, r0.w, r4.w, r5.x <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> noise0 = lerp( fStarsNoise1, fStarsNoise2, weightX ); <span class="hljs-number"><span class="hljs-number">231</span></span>: mad r5.x, r5.y, l(<span class="hljs-number"><span class="hljs-number">0.000000001</span></span>), -r1.w <span class="hljs-number"><span class="hljs-number">232</span></span>: mad r0.w, r0.w, r5.x, r1.w <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> noise1 = lerp( fStarsNoise3, fStarsNoise4, weightX ); <span class="hljs-number"><span class="hljs-number">233</span></span>: add r0.w, -r4.w, r0.w <span class="hljs-number"><span class="hljs-number">234</span></span>: mad r0.w, r2.w, r0.w, r4.w <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> offset = lerp( noise0, noise1, weightY ); <span class="hljs-number"><span class="hljs-number">235</span></span>: mad r2.xyz, r0.wwww, l(<span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000500</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r2.xyzx <span class="hljs-number"><span class="hljs-number">236</span></span>: sample_indexable(texturecube)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r2.xyz, r2.xyzx, t0.xyzw, s0 float3 starsPerturbedDir = dirXYZ + offset * <span class="hljs-number"><span class="hljs-number">0.0005</span></span>; float3 starsColorDisturbed = texNightStars.Sample( samplerAnisoWrap, starsPerturbedDir ).rgb;</code> </pre> <br>     <i>offset</i> : <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/SAI-cLJFpfg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach der Berechnung von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starsColorDisturbed ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der schwierigste Teil abgeschlossen.</font></font> Hurra! <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der nächste Schritt besteht darin, eine Gammakorrektur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sowohl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für </font><i><font style="vertical-align: inherit;">starsColor</font></i><font style="vertical-align: inherit;"> als auch </font><font style="vertical-align: inherit;">für </font><i><font style="vertical-align: inherit;">starsColorDisturbed</font></i><font style="vertical-align: inherit;"> durchzuführen. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anschließend</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> werden sie multipliziert:</font></font><br><br><pre> <code class="cpp hljs"> starsColor = <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>( starsColor, <span class="hljs-number"><span class="hljs-number">2.2</span></span> ); starsColorDisturbed = <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>( starsColorDisturbed, <span class="hljs-number"><span class="hljs-number">2.2</span></span> ); float3 starsFinal = starsColor * starsColorDisturbed;</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sterne - der letzte Schliff </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StarsFinal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in r1.xyz. </font><font style="vertical-align: inherit;">Am Ende der Sternverarbeitung tritt Folgendes auf:</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">256</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r1.xyz, r1.xyzx <span class="hljs-number"><span class="hljs-number">257</span></span>: mul r1.xyz, r1.xyzx, l(<span class="hljs-number"><span class="hljs-number">2.500000</span></span>, <span class="hljs-number"><span class="hljs-number">2.500000</span></span>, <span class="hljs-number"><span class="hljs-number">2.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">258</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r1.xyz, r1.xyzx <span class="hljs-number"><span class="hljs-number">259</span></span>: min r1.xyz, r1.xyzx, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">260</span></span>: add r0.w, -cb0[<span class="hljs-number"><span class="hljs-number">9</span></span>].w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">261</span></span>: mul r1.xyz, r0.wwww, r1.xyzx <span class="hljs-number"><span class="hljs-number">262</span></span>: mul r1.xyz, r1.xyzx, l(<span class="hljs-number"><span class="hljs-number">10.000000</span></span>, <span class="hljs-number"><span class="hljs-number">10.000000</span></span>, <span class="hljs-number"><span class="hljs-number">10.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist viel einfacher als funkelnde und sich bewegende Sterne. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir beginnen also damit, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StarsFinal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf eine Potenz von 2,5 </font><i><font style="vertical-align: inherit;">anzuheben</font></i><font style="vertical-align: inherit;"> - dies ermöglicht es uns, die Dichte der Sterne zu steuern. </font><font style="vertical-align: inherit;">Ziemlich schlau. </font><font style="vertical-align: inherit;">Dann machen wir die maximale Farbe der Sterne gleich float3 (1, 1, 1). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb0 [9] .w wird verwendet, um die Gesamtsichtbarkeit von Sternen zu steuern. </font><font style="vertical-align: inherit;">Daher können wir erwarten, dass dieser Wert tagsüber 1,0 (was eine Multiplikation mit Null ergibt) und nachts 0,0 beträgt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am Ende erhöhen wir die Sichtbarkeit von Sternen um 10. Und das war's!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Teil 3. Das Hexer-Flair (Objekte und Helligkeitskarte) </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fast alle zuvor beschriebenen Effekte und Techniken waren nicht wirklich mit Witcher 3 verbunden. Dinge wie Tonkorrektur, Vignettierung oder Berechnung der durchschnittlichen Helligkeit sind in fast jedem modernen Spiel vorhanden. </font><font style="vertical-align: inherit;">Sogar die Wirkung einer Vergiftung ist weit verbreitet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deshalb habe ich mich entschlossen, die Rendermechanik des „Hexerinstinkts“ genauer zu betrachten. </font><font style="vertical-align: inherit;">Geralt ist ein Hexer, und deshalb sind seine Gefühle viel schärfer als die eines gewöhnlichen Menschen. </font><font style="vertical-align: inherit;">Folglich kann er mehr sehen und hören als andere Menschen, was ihm bei seinen Ermittlungen sehr hilft. </font><font style="vertical-align: inherit;">Die Flairmechanik des Hexers ermöglicht es dem Spieler, solche Spuren zu visualisieren. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier ist eine Demonstration des Effekts:</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/794z0wbcI6U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und noch eine mit besserer Beleuchtung: </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ReB6IrOb3ic" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie sehen können, gibt es zwei Arten von Objekten: diejenigen, mit denen Geralt interagieren kann (gelber Umriss) und die mit der Untersuchung verbundenen Spuren (roter Umriss). </font><font style="vertical-align: inherit;">Nachdem Geralt die rote Spur untersucht hat, kann sie sich in Gelb verwandeln (erstes Video). </font><font style="vertical-align: inherit;">Beachten Sie, dass der gesamte Bildschirm grau wird und ein Fischaugeneffekt (zweites Video) hinzugefügt wird. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieser Effekt ist ziemlich kompliziert, deshalb habe ich beschlossen, seine Forschung in drei Teile zu unterteilen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im ersten werde ich über die Auswahl von Objekten sprechen, im zweiten - über die Erzeugung der Kontur und im dritten - über die endgültige Vereinigung all dessen zu einem Ganzen.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wählen Sie Objekte </font></font></h3><br>    ,    ,     .  Witcher 3     -.    GBuffer,      „“ (),    stencil = 8. ,     „“ ,   stencil = 4. <br><br> ,             -: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/7ed/667/2a67ed667870cd52dcf0da4f366975b6.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac7/a84/a9c/ac7a84a9c8aa25c1685a2a5f83f7447f.jpg"></div><br><h4>   - </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schablonenpuffer werden häufig in Spielen verwendet, um Netze zu markieren. </font><font style="vertical-align: inherit;">Bestimmten Kategorien von Netzen wird dieselbe ID zugewiesen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Idee ist, die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Always-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><font style="vertical-align: inherit;">mit dem Operator </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ersetzen zu verwenden</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">wenn der Schablonentest erfolgreich ist, und </font><font style="vertical-align: inherit;">in allen anderen Fällen </font><font style="vertical-align: inherit;">mit dem Operator </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Behalten</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So wird es mit D3D11 implementiert:</font></font><br><br><pre> <code class="cpp hljs"> D3D11_DEPTH_STENCIL_DESC depthstencilState; <span class="hljs-comment"><span class="hljs-comment">// Set depth parameters.... // Enable stencil depthstencilState.StencilEnable = TRUE; // Read &amp; write all bits depthstencilState.StencilReadMask = 0xFF; depthstencilState.StencilWriteMask = 0xFF; // Stencil operator for front face depthstencilState.FrontFace.StencilFunc = D3D11_COMPARISON_ALWAYS; depthstencilState.FrontFace.StencilDepthFailOp = D3D11_STENCIL_OP_KEEP; depthstencilState.FrontFace.StencilFailOp = D3D11_STENCIL_OP_KEEP; depthstencilState.FrontFace.StencilPassOp = D3D11_STENCIL_OP_REPLACE; // Stencil operator for back face. depthstencilState.BackFace.StencilFunc = D3D11_COMPARISON_ALWAYS; depthstencilState.BackFace.StencilDepthFailOp = D3D11_STENCIL_OP_KEEP; depthstencilState.BackFace.StencilFailOp = D3D11_STENCIL_OP_KEEP; depthstencilState.BackFace.StencilPassOp = D3D11_STENCIL_OP_REPLACE; pDevice-&gt;CreateDepthStencilState( &amp;depthstencilState, &amp;m_pDS_AssignValue );</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der in den Puffer zu schreibende </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stensilwert wird</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im API-Aufruf </font><font style="vertical-align: inherit;">als </font><i><font style="vertical-align: inherit;">StencilRef übergeben</font></i><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// from now on set stencil buffer values to 8 pDevCon-&gt;OMSetDepthStencilState( m_pDS_AssignValue, 8 ); ... pDevCon-&gt;DrawIndexed( ... );</span></span></code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Helligkeit rendern </font></font></h4><br>              R11G11B10_FLOAT,          R  G. <br><br>        ? ,      ,    ,        . <br><br>      : <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Xbs-ZRJ7v1w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f1/073/f03/6f1073f03172250a5b4c052ebfdfd832.jpg"></div><br>      ,    . <br><br>      :   „“,  —   : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/077/c17/138/077c1713805b1f95625c05fb11643c53.jpg"></div><br>       —  : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/14f/7df/63e/14f7df63e4e1760304e4a2c6279953d1.jpg"></div><br>       —  : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6db/379/add/6db379add4ffc7f54a047f79b608d67f.jpg"></div><br>  ,    ,    ?   -! <br><br>       -,     ,      „8“ (  )  „4“. <br><br>  -  : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a60/227/b57/a60227b575f307ad5a251aa817a49963.jpg"></div><br> …    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/014/6eb/5f4/0146eb5f4da50018f5d28b4453e2424c.jpg"></div><br>      ?   -     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> .     -   : <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StencilRef &amp; StencilReadMask OP StencilValue &amp; StencilReadMask) accept pixel <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> discard pixel</code> </pre> <br>  wo: <br> <i>StencilRef</i> — ,   API, <br><br> <i>StencilReadMask</i> — ,      (,      ,    ), <br><br> <i>OP</i> —  ,   API, <br><br> <i>StencilValue</i> —  -    . <br><br>  ,        AND. <br><br>   ,  ,        : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/164/373/d2c/164373d2c3421c708e40dc9cb26eb7c9.jpg"></div><br> <i>   </i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e5/3c0/ae3/1e53c0ae3680bebe785e64739c4ece43.jpg"></div><br> <i>    </i> <br><br> !   ,     ReadMask.   !      -: <br><br><pre> <code class="cpp hljs"> Let StencilReadMask = <span class="hljs-number"><span class="hljs-number">0x08</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> StencilRef = <span class="hljs-number"><span class="hljs-number">0</span></span>: For a pixel with stencil = <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x08</span></span> &lt; <span class="hljs-number"><span class="hljs-number">8</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x08</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> &lt; <span class="hljs-number"><span class="hljs-number">8</span></span> TRUE For a pixel with stencil = <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x08</span></span> &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x08</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> FALSE</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clever. </font><font style="vertical-align: inherit;">Wie Sie sehen, vergleichen wir in diesem Fall nicht den Schablonenwert, sondern prüfen, ob ein bestimmtes Bit des Schablonenpuffers gesetzt ist. </font><font style="vertical-align: inherit;">Jedes Pixel des Schablonenpuffers hat das Format uint8, sodass das Werteintervall [0-255] beträgt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis: Alle </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DrawIndexed (36)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Aufrufe </font><font style="vertical-align: inherit;">beziehen sich auf das Rendern von Footprints als Footprints. In diesem speziellen Frame hat die Helligkeitskarte daher die folgende endgültige Form:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/917/f0d/d04/917f0dd0490ef8faa829ede007838906.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor dem Schablonentest gibt es jedoch einen Pixel-Shader. </font><font style="vertical-align: inherit;">Sowohl 28738 als auch 28748 verwenden denselben Pixel-Shader:</font></font><br><br><pre> <code class="cpp hljs"> ps_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>], immediateIndexed dcl_constantbuffer cb3[<span class="hljs-number"><span class="hljs-number">8</span></span>], immediateIndexed dcl_constantbuffer cb12[<span class="hljs-number"><span class="hljs-number">214</span></span>], immediateIndexed dcl_sampler s15, <span class="hljs-function"><span class="hljs-function">mode_default </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t15 dcl_input_ps_siv v0.xy, position dcl_output o0.xyzw dcl_output o1.xyzw dcl_output o2.xyzw dcl_output o3.xyzw dcl_temps 2 0: mul r0.xy, v0.xyxx, cb0[1].zwzz 1: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.x, r0.xyxx, t15.xyzw, s15 2: mul r1.xyzw, v0.yyyy, cb12[211].xyzw 3: mad r1.xyzw, cb12[210].xyzw, v0.xxxx, r1.xyzw 4: mad r0.xyzw, cb12[212].xyzw, r0.xxxx, r1.xyzw 5: add r0.xyzw, r0.xyzw, cb12[213].xyzw 6: div r0.xyz, r0.xyzx, r0.wwww 7: add r0.xyz, r0.xyzx, -cb3[7].xyzx 8: dp3 r0.x, r0.xyzx, r0.xyzx 9: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">sqrt</span></span></span><span class="hljs-function"> r0.x, r0.x 10: mul r0.y, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.120000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 11: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">log</span></span></span><span class="hljs-function"> r1.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cb3[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">].y)</span></span></span><span class="hljs-function"> 12: mul r1.xy, r1.xxxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.800000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.800000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 13: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">exp</span></span></span><span class="hljs-function"> r1.xy, r1.xyxx 14: mad r0.zw, r1.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">120.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">120.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 15: lt r1.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.030000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, cb3[6].y 16: movc r0.xy, r1.xxxx, r0.yzyy, r0.xwxx 17: div r0.x, r0.x, r0.y 18: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">log</span></span></span><span class="hljs-function"> r0.x, r0.x 19: mul r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.600000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 20: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">exp</span></span></span><span class="hljs-function"> r0.x, r0.x 21: add r0.x, -r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 22: max r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 23: mul o0.xyz, r0.xxxx, cb3[0].xyzx 24: mov o0.w, cb3[0].w 25: mov o1.xyzw, cb3[1].xyzw 26: mov o2.xyzw, cb3[2].xyzw 27: mov o3.xyzw, cb3[3].xyzw 28: ret</span></span></code> </pre> <br>         render target,   24-27 . <br><br> ,    —   (    ),  1.                 ( 2-6). <br><br>    (cb3[7].xyz — ,   <i></i>  !),          ( 7-9). <br><br>       : <br><br> — cb3[0].rgb —  .     float3(0, 1, 0) ()  float3(1, 0, 0) ( ), <br> — cb3[6].y —   .         . <br><br>                  .  ,     . <br><br>     <i>color</i> * <i>intensity</i> . <br><br>   HLSL    : <br><br><pre> <code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FSInput</span></span></span><span class="hljs-class"> {</span></span> float4 param0 : SV_Position; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FSOutput</span></span></span><span class="hljs-class"> {</span></span> float4 param0 : SV_Target0; float4 param1 : SV_Target1; float4 param2 : SV_Target2; float4 param3 : SV_Target3; }; <span class="hljs-function"><span class="hljs-function">float3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWorldPos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( float2 screenPos, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> depth )</span></span></span><span class="hljs-function"> </span></span>{ float4 worldPos = float4(screenPos, depth, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); worldPos = mul( worldPos, screenToWorld ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> worldPos.xyz / worldPos.w; } <span class="hljs-function"><span class="hljs-function">FSOutput </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditedShaderPS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(in FSInput IN)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// * Inputs // Directly affects radius of the effect float distanceScaling = cb3_v6.y; // Color of output at the end float3 color = cb3_v0.rgb; // Sample depth float2 uv = IN.param0.xy * cb0_v1.zw; float depth = texture15.Sample( sampler15, uv ).x; // Reconstruct world position float3 worldPos = getWorldPos( IN.param0.xy, depth ); // Calculate distance from Geralt to world position of particular object float dist_geraltToWorld = length( worldPos - cb3_v7.xyz ); // Calculate two squeezing params float t0 = 1.0 + 120*pow( abs(distanceScaling), 2.8 ); float t1 = 1.0 + 120*pow( abs(distanceScaling), 0.8 ); // Determine nominator and denominator float2 params; params = (distanceScaling &gt; 0.03) ? float2(dist_geraltToWorld * 0.12, t0) : float2(dist_geraltToWorld, t1); // Distance Geralt &lt;-&gt; Object float nominator = params.x; // Hiding factor float denominator = params.y; // Raise to power of 1.6 float param = pow( params.x / params.y, 1.6 ); // Calculate final intensity float intensity = max(0.0, 1.0 - param ); // * Final outputs. // * // * This PS outputs only one color, the rest // * is redundant. I just added this to keep 1-1 ratio with // * original assembly. FSOutput OUT = (FSOutput)0; OUT.param0.xyz = color * intensity; // == redundant == OUT.param0.w = cb3_v0.w; OUT.param1 = cb3_v1; OUT.param2 = cb3_v2; OUT.param3 = cb3_v3; // =============== return OUT; }</span></span></code> </pre> <br>    ()   ()   . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68c/07d/1d6/68c07d1d6fd99f81cb0b3b63c9927a53.jpg"></div><br>      <i> </i> .   ,   . <br><br><h2>  4.   ( ) </h2><br>       : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/7ed/667/2a67ed667870cd52dcf0da4f366975b6.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im ersten Teil der Analyse der Wirkung des Hexeninstinkts habe ich gezeigt, wie die „Helligkeitskarte“ erzeugt wird. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben eine Vollbild-Textur im Format R11G11B10_FLOAT, die folgendermaßen aussehen könnte:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/917/f0d/d04/917f0dd0490ef8faa829ede007838906.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der grüne Kanal bedeutet "Fußabdrücke", die roten - interessanten Objekte, mit denen Geralt interagieren kann. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem wir diese Textur erhalten haben, können wir mit der nächsten Stufe fortfahren - ich nannte sie die „Konturkarte“.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1bf/428/855/1bf4288554d1cef31c2607a4ca73c2bb.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist eine etwas seltsame Textur des 512x512 R16G16_FLOAT-Formats. </font><font style="vertical-align: inherit;">Es ist wichtig, dass es im Stil von "Tischtennis" implementiert ist. </font><font style="vertical-align: inherit;">Die Konturkarte aus dem vorherigen Frame sind die Eingabedaten (zusammen mit der Helligkeitskarte), um eine neue Konturkarte im aktuellen Frame zu generieren. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ping-Pong-Puffer können auf viele Arten implementiert werden, aber ich persönlich mag Folgendes (Pseudocode) am meisten:</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Declarations Texture2D m_texOutlineMap[2]; uint m_outlineIndex = 0; // Rendering void Render() { pDevCon-&gt;SetInputTexture( m_texOutlineMap[m_outlineIndex] ); pDevCon-&gt;SetOutputTexture( m_texOutlineMap[!m_outlineIndex] ); ... pDevCon-&gt;Draw(...); // after draw m_outlineIndex = !m_outlineIndex; }</span></span></code> </pre> <br>  ,      <i>[m_outlineIndex]</i> ,     <i>[!m_outlineIndex]</i> ,       . <br><br>     : <br><br><pre> <code class="cpp hljs"> ps_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb3[<span class="hljs-number"><span class="hljs-number">1</span></span>], immediateIndexed dcl_sampler s0, mode_default dcl_sampler s1, <span class="hljs-function"><span class="hljs-function">mode_default </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t1 dcl_input_ps linear v2.xy dcl_output o0.xyzw dcl_temps 4 0: add r0.xyzw, v2.xyxy, v2.xyxy 1: round_ni r1.xy, r0.zwzz 2: frc r0.xyzw, r0.xyzw 3: add r1.zw, r1.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 4: dp2 r1.z, r1.zwzz, r1.zwzz 5: add r1.z, -r1.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 6: max r2.w, r1.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 7: dp2 r1.z, r1.xyxx, r1.xyxx 8: add r3.xyzw, r1.xyxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 9: add r1.x, -r1.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 10: max r2.x, r1.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 11: dp2 r1.x, r3.xyxx, r3.xyxx 12: dp2 r1.y, r3.zwzz, r3.zwzz 13: add r1.xy, -r1.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 14: max r2.yz, r1.xxyx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 15: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.xyzw, r0.zwzz, t1.xyzw, s1 16: dp4 r1.x, r1.xyzw, r2.xyzw 17: add r2.xyzw, r0.zwzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.003906</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.003906</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 18: add r0.xyzw, r0.xyzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.003906</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.003906</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 19: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.yz, r2.xyxx, t1.zxyw, s1 20: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r2.xy, r2.zwzz, t1.xyzw, s1 21: add r1.yz, r1.yyzy, -r2.xxyx 22: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.xy, r0.xyxx, t1.xyzw, s1 23: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.zw, r0.zwzz, t1.zwxy, s1 24: add r0.xy, -r0.zwzz, r0.xyxx 25: max r0.xy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r0.xyxx)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r1.yzyy)</span></span></span><span class="hljs-function"> 26: min r0.xy, r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 27: mul r0.xy, r0.xyxx, r1.xxxx 28: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.zw, v2.xyxx, t0.zwxy, s0 29: mad r0.w, r1.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.150000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.w 30: mad r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.350000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.w 31: mad r0.x, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.350000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.x 32: mul r0.yw, cb3[0].zzzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">300.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">300.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 33: mad r0.yw, v2.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">150.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">150.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.yyyw 34: ftoi r0.yw, r0.yyyw 35: bfrev r0.w, r0.w 36: iadd r0.y, r0.w, r0.y 37: ishr r0.w, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">13</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 38: xor r0.y, r0.y, r0.w 39: imul null, r0.w, r0.y, r0.y 40: imad r0.w, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x0000ec4d</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0000000000000000000000000000000000001</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 41: imad r0.y, r0.y, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">146956042240.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 42: </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">and</span></span></span><span class="hljs-function"> r0.y, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0x7fffffff</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 43: itof r0.y, r0.y 44: mad r0.y, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000001</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.650000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 45: add_sat r1.xyzw, v2.xyxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.001953</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.001953</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 46: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.w, r1.xyxx, t0.yzwx, s0 47: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.x, r1.zwzz, t0.xyzw, s0 48: add r0.w, r0.w, r1.x 49: add_sat r1.xyzw, v2.xyxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.001953</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.001953</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 50: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.x, r1.xyxx, t0.xyzw, s0 51: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r1.y, r1.zwzz, t0.yxzw, s0 52: add r0.w, r0.w, r1.x 53: add r0.w, r1.y, r0.w 54: mad r0.w, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.250000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, -r0.z 55: mul r0.w, r0.y, r0.w 56: mul r0.y, r0.y, r0.z 57: mad r0.x, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.900000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.x 58: mad r0.y, r0.y, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.240000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r0.x 59: add r0.x, r0.y, r0.z 60: mov_sat r0.z, cb3[0].x 61: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">log</span></span></span><span class="hljs-function"> r0.z, r0.z 62: mul r0.z, r0.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">100.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 63: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">exp</span></span></span><span class="hljs-function"> r0.z, r0.z 64: mad r0.z, r0.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.160000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.700000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 65: mul o0.xy, r0.zzzz, r0.xyxx 66: mov o0.zw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 67: ret</span></span></code> </pre> <br>  ,        ,   ,    : <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">0</span></span>: add r0.xyzw, v2.xyxy, v2.xyxy <span class="hljs-number"><span class="hljs-number">1</span></span>: round_ni r1.xy, r0.zwzz <span class="hljs-number"><span class="hljs-number">2</span></span>: frc r0.xyzw, r0.xyzw <span class="hljs-number"><span class="hljs-number">3</span></span>: add r1.zw, r1.xxxy, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span>: dp2 r1.z, r1.zwzz, r1.zwzz <span class="hljs-number"><span class="hljs-number">5</span></span>: add r1.z, -r1.z, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span>: max r2.w, r1.z, l(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: dp2 r1.z, r1.xyxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">8</span></span>: add r3.xyzw, r1.xyxy, l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span>: add r1.x, -r1.z, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">10</span></span>: max r2.x, r1.x, l(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">11</span></span>: dp2 r1.x, r3.xyxx, r3.xyxx <span class="hljs-number"><span class="hljs-number">12</span></span>: dp2 r1.y, r3.zwzz, r3.zwzz <span class="hljs-number"><span class="hljs-number">13</span></span>: add r1.xy, -r1.xyxx, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">14</span></span>: max r2.yz, r1.xxyx, l(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>     floor( TextureUV * 2.0 ),    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e25/7b3/e14/e257b3e14ac5b8a1f2b65525333924c5.jpg"></div><br>       : <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float2 uv)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> d = dot(uv, uv); d = <span class="hljs-number"><span class="hljs-number">1.0</span></span> - d; d = max( d, <span class="hljs-number"><span class="hljs-number">0.0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d; }</code> </pre> <br> ,    1.0    float2(0.0, 0.0). <br><br>       .         ,     texcoords float2(1, 0),     float2(0, 1),    — float2(1.0, 1.0). <br><br>  Also: <br><br><pre> <code class="cpp hljs"> float2 flooredTextureUV = <span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>( <span class="hljs-number"><span class="hljs-number">2.0</span></span> * TextureUV ); ... float2 uv1 = flooredTextureUV; float2 uv2 = flooredTextureUV + float2(<span class="hljs-number"><span class="hljs-number">-1.0</span></span>, <span class="hljs-number"><span class="hljs-number">-0.0</span></span>); float2 uv3 = flooredTextureUV + float2( <span class="hljs-number"><span class="hljs-number">-0.0</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0</span></span>); float2 uv4 = flooredTextureUV + float2(<span class="hljs-number"><span class="hljs-number">-1.0</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0</span></span>); float4 mask; mask.x = getParams( uv1 ); mask.y = getParams( uv2 ); mask.z = getParams( uv3 ); mask.w = getParams( uv4 );</code> </pre> <br>    <i>mask</i>   ,  ,      . , <i>mask.r</i>  <i>mask.w</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/559/e1c/242/559e1c242221886f5c0100fa66837c31.jpg"></div><br> <i>mask.r</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb5/108/a24/bb5108a241181f23a66c7f3803d33cea.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mask.w</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir haben </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maske</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lass uns </font><i><font style="vertical-align: inherit;">weitermachen</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Zeile 15 tastet die Luminanzkarte ab. </font><font style="vertical-align: inherit;">Beachten Sie, dass die Luminanztextur das Format R11G11B10_FLOAT hat, obwohl wir alle rgba-Komponenten abtasten. </font><font style="vertical-align: inherit;">In dieser Situation wird angenommen, dass .a 1.0f ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die für diesen Vorgang verwendeten Texcoords können als </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frac (TextureUV * 2.0)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berechnet werden </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Daher kann das Ergebnis dieser Operation beispielsweise folgendermaßen aussehen:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/955/071/c05/955071c057420f3c4b083ed174046189.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sehen Sie die Ähnlichkeit? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der nächste Schritt ist sehr klug - das Vier-Komponenten-Skalarprodukt (dp4) wird ausgeführt:</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">16</span></span>: dp4 r1.x, r1.xyzw, r2.xyzw</code> </pre> <br>           (    ),    —    ( ),     —  (    .w    1.0).  .     : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37c/488/3ab/37c4883ab098cd1bc4ef2d22187f7d16.jpg"></div><br>   <i>masterFilter</i> ,      .    ,   .         —       . <br><br>   :          (:       1.0/256.0!)          : <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> fTexel = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">256</span></span>; float2 sampling1 = TextureUV + float2( fTexel, <span class="hljs-number"><span class="hljs-number">0</span></span> ); float2 sampling2 = TextureUV + float2( -fTexel, <span class="hljs-number"><span class="hljs-number">0</span></span> ); float2 sampling3 = TextureUV + float2( <span class="hljs-number"><span class="hljs-number">0</span></span>, fTexel ); float2 sampling4 = TextureUV + float2( <span class="hljs-number"><span class="hljs-number">0</span></span>, -fTexel ); float2 intensity_x0 = texIntensityMap.Sample( sampler1, sampling1 ).xy; float2 intensity_x1 = texIntensityMap.Sample( sampler1, sampling2 ).xy; float2 intensity_diff_x = intensity_x0 - intensity_x1; float2 intensity_y0 = texIntensityMap.Sample( sampler1, sampling3 ).xy; float2 intensity_y1 = texIntensityMap.Sample( sampler1, sampling4 ).xy; float2 intensity_diff_y = intensity_y0 - intensity_y1; float2 maxAbsDifference = max( <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(intensity_diff_x), <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(intensity_diff_y) ); maxAbsDifference = saturate(maxAbsDifference);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn wir nun den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maxAbsDifference</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> multiplizieren </font><font style="vertical-align: inherit;">...</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dcb/332/626/dcb332626d34f07ecf1bd85928b7d1dc.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sehr einfach und effizient. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem wir die Konturen erhalten haben, probieren wir die Konturkarte aus dem vorherigen Frame aus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um einen „gespenstischen“ Effekt zu erzielen, nehmen wir einen Teil der Parameter, die für den aktuellen Durchgang berechnet wurden, und die Werte aus der Konturkarte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Begrüßen Sie unseren alten Freund - ganzzahliges Rauschen. </font><font style="vertical-align: inherit;">Er ist hier anwesend. </font><font style="vertical-align: inherit;">Animationsparameter (cb3 [0] .zw) werden aus dem konstanten Puffer entnommen und ändern sich im Laufe der Zeit.</font></font><br><br><pre> <code class="cpp hljs"> float2 outlines = masterFilter * maxAbsDifference; <span class="hljs-comment"><span class="hljs-comment">// Sample outline map float2 outlineMap = texOutlineMap.Sample( samplerLinearWrap, uv ).xy; // I guess it's related with ghosting float paramOutline = masterFilter*0.15 + outlineMap.y; paramOutline += 0.35 * outlines.r; paramOutline += 0.35 * outlines.g; // input for integer noise float2 noiseWeights = cb3_v0.zw; float2 noiseInputs = 150.0*uv + 300.0*noiseWeights; int2 iNoiseInputs = (int2) noiseInputs; float noise0 = clamp( integerNoise( iNoiseInputs.x + reversebits(iNoiseInputs.y) ), -1, 1 ) + 0.65; // r0.y</span></span></code> </pre> <br> :       ,       [-1;1] (     -).    TW3   ,             . <br><br>        ,      (      1.0/512.0),      .x: <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// sampling of outline map fTexel = 1.0 / 512.0; sampling1 = saturate( uv + float2( fTexel, 0 ) ); sampling2 = saturate( uv + float2( -fTexel, 0 ) ); sampling3 = saturate( uv + float2( 0, fTexel ) ); sampling4 = saturate( uv + float2( 0, -fTexel ) ); float outline_x0 = texOutlineMap.Sample( sampler0, sampling1 ).x; float outline_x1 = texOutlineMap.Sample( sampler0, sampling2 ).x; float outline_y0 = texOutlineMap.Sample( sampler0, sampling3 ).x; float outline_y1 = texOutlineMap.Sample( sampler0, sampling4 ).x; float averageOutline = (outline_x0+outline_x1+outline_y0+outline_y1) / 4.0;</span></span></code> </pre> <br> ,    ,         ,      : <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// perturb with noise float frameOutlineDifference = averageOutline - outlineMap.x; frameOutlineDifference *= noise0;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der nächste Schritt besteht darin, den Wert von der „alten“ Konturkarte mithilfe von Rauschen zu verzerren. Dies ist die Hauptlinie, die der Ausgabetextur ein blockartiges Gefühl verleiht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dann gibt es andere Berechnungen, nach denen ganz am Ende die „Dämpfung“ berechnet wird.</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// the main place with gives blocky look of texture float newNoise = outlineMap.x * noise0; float newOutline = frameOutlineDifference * 0.9 + paramOutline; newOutline -= 0.24*newNoise; // 59: add r0.x, r0.y, r0.z float2 finalOutline = float2( outlineMap.x + newOutline, newOutline); // * calculate damping float dampingParam = saturate( cb3_v0.x ); dampingParam = pow( dampingParam, 100 ); float damping = 0.7 + 0.16*dampingParam; // * final multiplication float2 finalColor = finalOutline * damping; return float4(finalColor, 0, 0);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hier ist ein kurzes Video, das eine Übersichtskarte in Aktion zeigt: </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/vSscLz2RYsQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>      ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> .    RenderDoc. <br><br>  (,  ,  ) ,           Witcher 3,       RenderDoc ! <br><br> :    (.  )  ,     .r  .       .g? ,   -  „-“    — ,  .r   .g + -  . <br><br><h2>  5:   (» "   ) </h2><br>  ,     :   ,   ,    ,          .        ,       . <br><br>     .    !   —   .  :  ,     . <br><br> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/7ed/667/2a67ed667870cd52dcf0da4f366975b6.jpg"></div><br><br> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/abf/ce7/1c4/abfce71c4469b6dcd077723d498c1685.jpg"></div><br>       : <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ReB6IrOb3ic" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  ,     ,      ,      « »,    ( )  ,       . <br><br>     : <br><br><pre> <code class="cpp hljs"> ps_5_0 dcl_globalFlags refactoringAllowed dcl_constantbuffer cb0[<span class="hljs-number"><span class="hljs-number">3</span></span>], immediateIndexed dcl_constantbuffer cb3[<span class="hljs-number"><span class="hljs-number">7</span></span>], immediateIndexed dcl_sampler s0, mode_default dcl_sampler s2, <span class="hljs-function"><span class="hljs-function">mode_default </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dcl_resource_texture2d</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> t3 dcl_input_ps_siv v0.xy, position dcl_output o0.xyzw dcl_temps 7 0: div r0.xy, v0.xyxx, cb0[2].xyxx 1: mad r0.zw, r0.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 2: mov r1.yz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r0.zzwz)</span></span></span><span class="hljs-function"> 3: div r0.z, cb0[2].x, cb0[2].y 4: mul r1.x, r0.z, r1.y 5: add r0.zw, r1.xxxz, -cb3[2].xxxy 6: mul_sat r0.zw, r0.zzzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.555556</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.555556</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 7: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">log</span></span></span><span class="hljs-function"> r0.zw, r0.zzzw 8: mul r0.zw, r0.zzzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 9: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">exp</span></span></span><span class="hljs-function"> r0.zw, r0.zzzw 10: dp2 r0.z, r0.zwzz, r0.zwzz 11: </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">sqrt</span></span></span><span class="hljs-function"> r0.z, r0.z 12: min r0.z, r0.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 13: add r0.z, -r0.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 14: mov_sat r0.w, cb3[6].x 15: add_sat r1.xy, -r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.030000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.030000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 16: add r1.x, r1.y, r1.x 17: add_sat r0.xy, r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.970000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.970000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 18: add r0.x, r0.x, r1.x 19: add r0.x, r0.y, r0.x 20: mul r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">20.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 21: min r0.x, r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 22: add r1.xy, v0.xyxx, v0.xyxx 23: div r1.xy, r1.xyxx, cb0[2].xyxx 24: add r1.xy, r1.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 25: dp2 r0.y, r1.xyxx, r1.xyxx 26: mul r1.xy, r0.yyyy, r1.xyxx 27: mul r0.y, r0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.100000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 28: mul r1.xy, r0.yyyy, r1.xyxx 29: max r1.xy, r1.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-0.400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 30: min r1.xy, r1.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.400000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 31: mul r1.xy, r1.xyxx, cb3[1].xxxx 32: mul r1.zw, r1.xxxy, cb0[2].zzzw 33: mad r1.zw, v0.xxxy, cb0[1].zzzw, -r1.zzzw 34: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r2.xyz, r1.zwzz, t0.xyzw, s0 35: mul r3.xy, r1.zwzz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 36: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.y, r3.xyxx, t2.yxzw, s2 37: mad r3.xy, r1.zwzz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 38: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r2.w, r3.xyxx, t2.yzwx, s2 39: mul r2.w, r2.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 40: mul r3.x, cb0[0].x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.100000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 41: add r0.x, -r0.x, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 42: mul r0.xy, r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.030000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 43: mov r3.yzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 44: mov r4.x, r0.y 45: mov r4.y, r2.w 46: mov r4.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 47: loop 48: ige r4.w, r4.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">8</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 49: breakc_nz r4.w 50: itof r4.w, r4.z 51: mad r4.w, r4.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.785375</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, -r3.x 52: sincos r5.x, r6.x, r4.w 53: mov r6.y, r5.x 54: mul r5.xy, r0.xxxx, r6.xyxx 55: mad r5.zw, r5.xxxy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r1.zzzw 56: mul r6.xy, r5.zwzz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 57: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r4.w, r6.xyxx, t2.yzwx, s2 58: mad r4.x, r4.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r4.x 59: mad r5.zw, r5.zzzw, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.500000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 60: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r4.w, r5.zwzz, t2.yzwx, s2 61: mad r4.y, r4.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r4.y 62: mad r5.xy, r5.xyxx, r1.xyxx, r1.zwzz 63: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r5.xyz, r5.xyxx, t0.xyzw, s0 64: mad r3.yzw, r5.xxyz, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.125000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r3.yyzw 65: iadd r4.z, r4.z, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 66: endloop 67: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample_indexable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(texture2d)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> r0.xy, r1.zwzz, t3.xyzw, s0 68: mad_sat r0.xy, -r0.xyxx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.800000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.750000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r4.xyxx 69: dp3 r1.x, r3.yzwy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.300000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.300000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.300000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 70: add r1.yzw, -r1.xxxx, r3.yyzw 71: mad r1.xyz, r0.zzzz, r1.yzwy, r1.xxxx 72: mad r1.xyz, r1.xyzx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.600000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.600000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.600000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, -r2.xyzx 73: mad r1.xyz, r0.wwww, r1.xyzx, r2.xyzx 74: mul r0.yzw, r0.yyyy, cb3[4].xxyz 75: mul r2.xyz, r0.xxxx, cb3[5].xyzx 76: mad r0.xyz, r0.yzwy, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.200000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.200000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.200000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, r2.xyzx 77: mov_sat r2.xyz, r0.xyzx 78: dp3_sat r0.x, r0.xyzx, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 79: add r0.yzw, -r1.xxyz, r2.xxyz 80: mad o0.xyz, r0.xxxx, r0.yzwy, r1.xyzx 81: mov o0.w, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">l</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.000000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> 82: ret</span></span></code> </pre> <br> 82  — ,    ! <br><br>      : <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// *** Inputs // * Zoom amount, always 1 float zoomAmount = cb3_v1.x; // Another value which affect fisheye effect // but always set to float2(1.0, 1.0). float2 amount = cb0_v2.zw; // Elapsed time in seconds float time = cb0_v0.x; // Colors of witcher senses float3 colorInteresting = cb3_v5.rgb; float3 colorTraces = cb3_v4.rgb; // Was always set to float2(0.0, 0.0). // Setting this to higher values // makes "grey corners" effect weaker. float2 offset = cb3_v2.xy; // Dimensions of fullscreen float2 texSize = cb0_v2.xy; float2 invTexSize = cb0_v1.zw; // Main value which causes fisheye effect [0-1] const float fisheyeAmount = saturate( cb3_v6.x );</span></span></code> </pre> <br>  ,     —  <i>fisheyeAmount</i> . ,     0.0  1.0,      .     ,   ,      ,        fisheye (   ). <br><br> ,    —   ,    : <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">0</span></span>: div r0.xy, v0.xyxx, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxx <span class="hljs-number"><span class="hljs-number">1</span></span>: mad r0.zw, r0.xxxy, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>: mov r1.yz, <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(r0.zzwz) <span class="hljs-number"><span class="hljs-number">3</span></span>: div r0.z, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].x, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].y <span class="hljs-number"><span class="hljs-number">4</span></span>: mul r1.x, r0.z, r1.y <span class="hljs-number"><span class="hljs-number">5</span></span>: add r0.zw, r1.xxxz, -cb3[<span class="hljs-number"><span class="hljs-number">2</span></span>].xxxy <span class="hljs-number"><span class="hljs-number">6</span></span>: mul_sat r0.zw, r0.zzzw, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.555556</span></span>, <span class="hljs-number"><span class="hljs-number">0.555556</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> r0.zw, r0.zzzw <span class="hljs-number"><span class="hljs-number">8</span></span>: mul r0.zw, r0.zzzw, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.500000</span></span>, <span class="hljs-number"><span class="hljs-number">2.500000</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span> r0.zw, r0.zzzw <span class="hljs-number"><span class="hljs-number">10</span></span>: dp2 r0.z, r0.zwzz, r0.zwzz <span class="hljs-number"><span class="hljs-number">11</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span> r0.z, r0.z <span class="hljs-number"><span class="hljs-number">12</span></span>: min r0.z, r0.z, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">13</span></span>: add r0.z, -r0.z, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>)</code> </pre> <br>  HLSL      : <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Main uv float2 uv = PosH.xy / texSize; // Scale at first from [0-1] to [-1;1], then calculate abs float2 uv3 = abs( uv * 2.0 - 1.0); // Aspect ratio float aspectRatio = texSize.x / texSize.y; // * Mask used to make corners grey float mask_gray_corners; { float2 newUv = float2( uv3.x * aspectRatio, uv3.y ) - offset; newUv = saturate( newUv / 1.8 ); newUv = pow(newUv, 2.5); mask_gray_corners = 1-min(1.0, length(newUv) ); }</span></span></code> </pre> <br>    [-1; 1] UV    .     «».     : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba9/320/0d4/ba93200d4f20e0a5bc361e96994b525b.png"></div><br>      . <br><br>           ,    «». <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">22</span></span>: add r1.xy, v0.xyxx, v0.xyxx <span class="hljs-number"><span class="hljs-number">23</span></span>: div r1.xy, r1.xyxx, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxx <span class="hljs-number"><span class="hljs-number">24</span></span>: add r1.xy, r1.xyxx, l(<span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">25</span></span>: dp2 r0.y, r1.xyxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">26</span></span>: mul r1.xy, r0.yyyy, r1.xyxx <span class="hljs-number"><span class="hljs-number">27</span></span>: mul r0.y, r0.w, l(<span class="hljs-number"><span class="hljs-number">0.100000</span></span>) <span class="hljs-number"><span class="hljs-number">28</span></span>: mul r1.xy, r0.yyyy, r1.xyxx <span class="hljs-number"><span class="hljs-number">29</span></span>: max r1.xy, r1.xyxx, l(<span class="hljs-number"><span class="hljs-number">-0.400000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.400000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">30</span></span>: min r1.xy, r1.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.400000</span></span>, <span class="hljs-number"><span class="hljs-number">0.400000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">31</span></span>: mul r1.xy, r1.xyxx, cb3[<span class="hljs-number"><span class="hljs-number">1</span></span>].xxxx <span class="hljs-number"><span class="hljs-number">32</span></span>: mul r1.zw, r1.xxxy, cb0[<span class="hljs-number"><span class="hljs-number">2</span></span>].zzzw <span class="hljs-number"><span class="hljs-number">33</span></span>: mad r1.zw, v0.xxxy, cb0[<span class="hljs-number"><span class="hljs-number">1</span></span>].zzzw, -r1.zzzw</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zunächst werden die "doppelten" Texturkoordinaten berechnet und die Subtraktion float2 (1, 1) durchgeführt: </font></font><br><br><pre> <code class="cpp hljs"> float2 uv4 = <span class="hljs-number"><span class="hljs-number">2</span></span> * PosH.xy; uv4 /= cb0_v2.xy; uv4 -= float2(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein solcher Texcoord kann wie folgt visualisiert werden: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70a/0b0/dfe/70a0b0dfeb9ca86eb86f137ac96c9811.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dann wird der skalare Produktpunkt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(uv4, uv4) berechnet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , der uns die Maske gibt:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f0/b6c/0a9/1f0b6c0a97ed9ad17a6bc17f3ebcf6c6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> welches verwendet wird, um mit den obigen Texcoords zu multiplizieren: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e34/27e/5f2/e3427e5f2a925c8a78f77d81c5840da4.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wichtig: In der oberen linken Ecke (schwarze Pixel) sind die Werte negativ. </font><font style="vertical-align: inherit;">Sie werden aufgrund der eingeschränkten Genauigkeit des Formats R11G11B10_FLOAT in Schwarz (0,0) angezeigt. </font><font style="vertical-align: inherit;">Es hat kein Vorzeichenbit, daher können keine negativen Werte darin gespeichert werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dann wird der Dämpfungskoeffizient berechnet (wie oben erwähnt, </font><font style="vertical-align: inherit;">variiert </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fisheyeAmount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von 0,0 bis 1,0).</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> attenuation = fisheyeAmount * <span class="hljs-number"><span class="hljs-number">0.1</span></span>; uv4 *= attenuation;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dann werden die Einschränkung (max / min) und eine Multiplikation durchgeführt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somit wird der Offset berechnet. </font><font style="vertical-align: inherit;">Um die endgültige UV zu berechnen, die zum </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abtasten der Farbtextur verwendet wird</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , führen wir einfach die Subtraktion durch: </font><i><font style="vertical-align: inherit;">float2 colorUV = mainUv - offset; </font></i></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durch Abtasten der eingegebenen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">colorUV-Farbtextur erhalten</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir ein verzerrtes Bild in der Nähe der Ecken:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbc/4f4/967/bbc4f4967c3bf008bf3692af3eb54d69.jpg"></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Umrisse </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der nächste Schritt besteht darin, die Konturkarte abzutasten, um die Konturen zu finden. </font><font style="vertical-align: inherit;">Es ist ziemlich einfach: Zuerst finden wir Texcoords, um die Konturen interessanter Objekte abzutasten, und dann machen wir dasselbe für die Tracks:</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Sample outline map // interesting objects (upper left square) float2 outlineUV = colorUV * 0.5; float outlineInteresting = texture2.Sample( sampler2, outlineUV ).x; // r0.y // traces (upper right square) outlineUV = colorUV * 0.5 + float2(0.5, 0.0); float outlineTraces = texture2.Sample( sampler2, outlineUV ).x; // r2.w outlineInteresting /= 8.0; // r4.x outlineTraces /= 8.0; // r4.y</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a08/746/0a3/a087460a37b1b88733e1fef632a566db.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interessante Objekte aus der Konturkarte</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c6/edc/995/0c6edc995e2f6cb4c6aeec6701c30ba3.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spuren aus der Konturkarte</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es ist erwähnenswert, dass wir nur den .x-Kanal aus der Konturkarte abtasten und nur die oberen Quadrate berücksichtigen.</font></font><br><br><h4>  Bewegung </h4><br>         ,     .        8        ,    . <br><br> ,        8.0. <br><br>         [0-1] <sup>2</sup> ,     1       : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e3/8f1/de3/3e38f1de3016256205a5aa9199bb3a0d.jpg"></div><br>     ,  ,    .         15-21.         ,       (, -   ).     (15-21)   (41-42): <br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">15</span></span>: add_sat r1.xy, -r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.030000</span></span>, <span class="hljs-number"><span class="hljs-number">0.030000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">16</span></span>: add r1.x, r1.y, r1.x <span class="hljs-number"><span class="hljs-number">17</span></span>: add_sat r0.xy, r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">-0.970000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.970000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">18</span></span>: add r0.x, r0.x, r1.x <span class="hljs-number"><span class="hljs-number">19</span></span>: add r0.x, r0.y, r0.x <span class="hljs-number"><span class="hljs-number">20</span></span>: mul r0.x, r0.x, l(<span class="hljs-number"><span class="hljs-number">20.000000</span></span>) <span class="hljs-number"><span class="hljs-number">21</span></span>: min r0.x, r0.x, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) ... <span class="hljs-number"><span class="hljs-number">41</span></span>: add r0.x, -r0.x, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">42</span></span>: mul r0.xy, r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.030000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie sehen können, betrachten wir nur Texel von [0,00 - 0,03] neben jeder Oberfläche, fassen ihre Werte zusammen, multiplizieren 20 und sättigen. </font><font style="vertical-align: inherit;">So sehen sie nach den Zeilen 15-21 aus:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b2/080/809/5b20808099b641be7510714ffd45a737.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und so geht's nach Zeile 41: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa8/51d/853/fa851d8539027d54d2874472d5952448.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Zeile 42 multiplizieren wir dies mit 0,03. Dieser Wert ist der Radius des Kreises für den gesamten Bildschirm. </font><font style="vertical-align: inherit;">Wie Sie sehen können, wird der Radius näher an den Bildschirmrändern kleiner. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt können wir uns den Assembler-Code ansehen, der für die Bewegung verantwortlich ist:</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">40</span></span>: mul r3.x, cb0[<span class="hljs-number"><span class="hljs-number">0</span></span>].x, l(<span class="hljs-number"><span class="hljs-number">0.100000</span></span>) <span class="hljs-number"><span class="hljs-number">41</span></span>: add r0.x, -r0.x, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">42</span></span>: mul r0.xy, r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.030000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">43</span></span>: mov r3.yzw, l(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">44</span></span>: mov r4.x, r0.y <span class="hljs-number"><span class="hljs-number">45</span></span>: mov r4.y, r2.w <span class="hljs-number"><span class="hljs-number">46</span></span>: mov r4.z, l(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">47</span></span>: loop <span class="hljs-number"><span class="hljs-number">48</span></span>: ige r4.w, r4.z, l(<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-number"><span class="hljs-number">49</span></span>: breakc_nz r4.w <span class="hljs-number"><span class="hljs-number">50</span></span>: itof r4.w, r4.z <span class="hljs-number"><span class="hljs-number">51</span></span>: mad r4.w, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.785375</span></span>), -r3.x <span class="hljs-number"><span class="hljs-number">52</span></span>: sincos r5.x, r6.x, r4.w <span class="hljs-number"><span class="hljs-number">53</span></span>: mov r6.y, r5.x <span class="hljs-number"><span class="hljs-number">54</span></span>: mul r5.xy, r0.xxxx, r6.xyxx <span class="hljs-number"><span class="hljs-number">55</span></span>: mad r5.zw, r5.xxxy, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>), r1.zzzw <span class="hljs-number"><span class="hljs-number">56</span></span>: mul r6.xy, r5.zwzz, l(<span class="hljs-number"><span class="hljs-number">0.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">57</span></span>: sample_indexable(texture2d)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r4.w, r6.xyxx, t2.yzwx, s2 <span class="hljs-number"><span class="hljs-number">58</span></span>: mad r4.x, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.125000</span></span>), r4.x <span class="hljs-number"><span class="hljs-number">59</span></span>: mad r5.zw, r5.zzzw, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.500000</span></span>), l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">60</span></span>: sample_indexable(texture2d)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r4.w, r5.zwzz, t2.yzwx, s2 <span class="hljs-number"><span class="hljs-number">61</span></span>: mad r4.y, r4.w, l(<span class="hljs-number"><span class="hljs-number">0.125000</span></span>), r4.y <span class="hljs-number"><span class="hljs-number">62</span></span>: mad r5.xy, r5.xyxx, r1.xyxx, r1.zwzz <span class="hljs-number"><span class="hljs-number">63</span></span>: sample_indexable(texture2d)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r5.xyz, r5.xyxx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">64</span></span>: mad r3.yzw, r5.xxyz, l(<span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>, <span class="hljs-number"><span class="hljs-number">0.125000</span></span>), r3.yyzw <span class="hljs-number"><span class="hljs-number">65</span></span>: iadd r4.z, r4.z, l(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">66</span></span>: endloop</code> </pre> <br>     .   40     —  <i>elapsedTime * 0.1</i> .   43      ,   . <br><br> <i>r0.x</i> ( 41-42) — ,    ,  . <i>r4.x</i> ( 44) —    , <i>r4.y</i> ( 45) —   (   8!),  <i>r4.z</i> ( 46) —  . <br><br>   ,   8 .        <i>i * PI_4</i> ,    2*PI —  .    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit sincos bestimmen wir den Abtastpunkt (Einheitskreis) und ändern den Radius durch Multiplikation (Linie 54). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Danach gehen wir in einem Kreis um das Pixel herum und probieren die Konturen und Farben aus. </font><font style="vertical-align: inherit;">Nach dem Zyklus erhalten wir die Durchschnittswerte (aufgrund der Division durch 8) der Konturen und Farben.</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timeParam = time * <span class="hljs-number"><span class="hljs-number">0.1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// adjust circle radius circle_radius = 1.0 - circle_radius; circle_radius *= 0.03; float3 color_circle_main = float3(0.0, 0.0, 0.0); [loop] for (int i=0; 8 &gt; i; i++) { // full 2*PI = 360 angles cycle const float angleRadians = (float) i * PI_4 - timeParam; // unit circle float2 unitCircle; sincos(angleRadians, unitCircle.y, unitCircle.x); // unitCircle.x = cos, unitCircle.y = sin // adjust radius unitCircle *= circle_radius; // * base texcoords (circle) - note we also scale radius here by 8 // * probably because of dimensions of outline map. // line 55 float2 uv_outline_base = colorUV + unitCircle / 8.0; // * interesting objects (circle) float2 uv_outline_interesting_circle = uv_outline_base * 0.5; float outline_interesting_circle = texture2.Sample( sampler2, uv_outline_interesting_circle ).x; outlineInteresting += outline_interesting_circle / 8.0; // * traces (circle) float2 uv_outline_traces_circle = uv_outline_base * 0.5 + float2(0.5, 0.0); float outline_traces_circle = texture2.Sample( sampler2, uv_outline_traces_circle ).x; outlineTraces += outline_traces_circle / 8.0; // * sample color texture (zooming effect) with perturbation float2 uv_color_circle = colorUV + unitCircle * offsetUV; float3 color_circle = texture0.Sample( sampler0, uv_color_circle ).rgb; color_circle_main += color_circle / 8.0; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Farbabtastung wird auf die gleiche Weise durchgeführt, aber </font><font style="vertical-align: inherit;">wir werden </font><font style="vertical-align: inherit;">der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundfarbe UV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einen Versatz multipliziert mit einem „einzelnen“ Kreis </font><i><font style="vertical-align: inherit;">hinzufügen</font></i><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Helligkeit </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nach dem Zyklus probieren wir die Helligkeitskarte aus und ändern die endgültigen Helligkeitswerte (da die Helligkeitskarte nichts über die Konturen weiß): </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">67</span></span>: sample_indexable(texture2d)(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) r0.xy, r1.zwzz, t3.xyzw, s0 <span class="hljs-number"><span class="hljs-number">68</span></span>: mad_sat r0.xy, -r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">0.800000</span></span>, <span class="hljs-number"><span class="hljs-number">0.750000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r4.xyxx</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HLSL-Code: </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Sample intensity map float2 intensityMap = texture3.Sample( sampler0, colorUV ).xy; float intensityInteresting = intensityMap.r; float intensityTraces = intensityMap.g; // * Adjust outlines float mainOutlineInteresting = saturate( outlineInteresting - 0.8*intensityInteresting ); float mainOutlineTraces = saturate( outlineTraces - 0.75*intensityTraces );</span></span></code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Graue Ecken und die endgültige Vereinigung von allem </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die graue Farbe näher an den Ecken wird mit dem Skalarprodukt (Assembler-Linie 69) berechnet: </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Greyish color float3 color_greyish = dot( color_circle_main, float3(0.3, 0.3, 0.3) ).xxx;</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b55/9a1/e0f/b559a1e0f3ae66041cdf3f9f48ba4b06.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dann folgen zwei Interpolationen. </font><font style="vertical-align: inherit;">Die erste kombiniert Grau mit der „Farbe im Kreis“ unter Verwendung der ersten von mir beschriebenen Maske, sodass die Ecken grau werden. </font><font style="vertical-align: inherit;">Zusätzlich gibt es einen Koeffizienten von 0,6, der die Sättigung des endgültigen Bildes verringert:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6a/389/202/c6a38920286de2fe269224a6b26ebd77.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die zweite kombiniert die erste Farbe mit der obigen mit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fisheyeAmount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dies bedeutet, dass der Bildschirm allmählich dunkler (aufgrund der Multiplikation mit 0,6) und an den Ecken grau wird! </font><font style="vertical-align: inherit;">Genial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HLSL:</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Determine main color. // (1) At first, combine "circled" color with gray one. // Now we have have greyish corners here. float3 mainColor = lerp( color_greyish, color_circle_main, mask_gray_corners ) * 0.6; // (2) Then mix "regular" color with the above. // Please note this operation makes corners gradually gray (because fisheyeAmount rises from 0 to 1) // and gradually darker (because of 0.6 multiplier). mainColor = lerp( color, mainColor, fisheyeAmount );</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt können wir die Konturen von Objekten hinzufügen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Farben (rot und gelb) werden aus dem konstanten Puffer entnommen.</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// * Determine color of witcher senses float3 senses_traces = mainOutlineTraces * colorTraces; float3 senses_interesting = mainOutlineInteresting * colorInteresting; float3 senses_total = 1.2 * senses_traces + senses_interesting;</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ca/4ea/52d/9ca4ea52df8a22889828414ee2bfde05.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuh! </font><font style="vertical-align: inherit;">Wir sind fast am Ziel! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben die endgültige Farbe, da ist die Farbe des Hexeninstinkts ... es bleibt, sie irgendwie zu kombinieren! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und dafür ist eine einfache Zugabe nicht geeignet. </font><font style="vertical-align: inherit;">Zuerst berechnen wir das Skalarprodukt:</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">78</span></span>: dp3_sat r0.x, r0.xyzx, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dot_senses_total = saturate( dot(senses_total, float3(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) ) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> das sieht so aus: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ae/357/099/2ae357099e5bfe5185d16103f87a6b69.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und diese Werte ganz am Ende werden verwendet, um zwischen Farbe und dem (gesättigten) Hexenflair zu interpolieren: </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">76</span></span>: mad r0.xyz, r0.yzwy, l(<span class="hljs-number"><span class="hljs-number">1.200000</span></span>, <span class="hljs-number"><span class="hljs-number">1.200000</span></span>, <span class="hljs-number"><span class="hljs-number">1.200000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r2.xyzx <span class="hljs-number"><span class="hljs-number">77</span></span>: mov_sat r2.xyz, r0.xyzx <span class="hljs-number"><span class="hljs-number">78</span></span>: dp3_sat r0.x, r0.xyzx, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">1.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>) <span class="hljs-number"><span class="hljs-number">79</span></span>: add r0.yzw, -r1.xxyz, r2.xxyz <span class="hljs-number"><span class="hljs-number">80</span></span>: mad o0.xyz, r0.xxxx, r0.yzwy, r1.xyzx <span class="hljs-number"><span class="hljs-number">81</span></span>: mov o0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">82</span></span>: ret float3 senses_total = <span class="hljs-number"><span class="hljs-number">1.2</span></span> * senses_traces + senses_interesting; <span class="hljs-comment"><span class="hljs-comment">// * Final combining float3 senses_total_sat = saturate(senses_total); float dot_senses_total = saturate( dot(senses_total, float3(1.0, 1.0, 1.0) ) ); float3 finalColor = lerp( mainColor, senses_total_sat, dot_senses_total ); return float4( finalColor, 1.0 );</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/abf/ce7/1c4/abfce71c4469b6dcd077723d498c1685.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und das ist alles. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der vollständige Shader ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verfügbar </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vergleich meiner (links) und ursprünglichen (rechts) Shader:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/433/5be/2e4/4335be2e49bd901916567734cc0485a5.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich hoffe dir hat dieser Artikel gefallen! </font><font style="vertical-align: inherit;">In der Mechanik des „Hexerinstinkts“ gibt es viele brillante Ideen, und das Endergebnis ist sehr plausibel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Vorherige Teile der Analyse: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zweiter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .]</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450332/">https://habr.com/ru/post/de450332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450318/index.html">Entwurfsmuster in der modernen JavaScript-Entwicklung</a></li>
<li><a href="../de450320/index.html">Einfache Quantenspiele enthüllen die ultimative Komplexität des Universums</a></li>
<li><a href="../de450322/index.html">Warum brauchen wir so viele Boten?</a></li>
<li><a href="../de450324/index.html">Wie das Produktivitäts-Tracking-System Amazon-Mitarbeiter automatisch entlässt</a></li>
<li><a href="../de450330/index.html">Wahl einer Schule bei einem Umzug in die USA</a></li>
<li><a href="../de450334/index.html">IaaS und Managed IT: Technology Digest</a></li>
<li><a href="../de450340/index.html">So analysieren Sie die Website eines Mitbewerbers kostenlos. Schritt für Schritt Anleitung</a></li>
<li><a href="../de450342/index.html">Über einfache Dinge, kompliziert. Wir geben das Mädchen Geflügel oder RTFM für die Definition von Kunststoffen zu Hause zurück</a></li>
<li><a href="../de450344/index.html">Ein Beitrag mit weißer Flagge oder Wie ich Ihren Videokurs vor dem Erscheinen auf dem Tracker gespeichert habe</a></li>
<li><a href="../de450346/index.html">Newtons Cottage Cradle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>