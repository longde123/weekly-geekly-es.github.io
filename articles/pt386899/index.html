<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé• üö¶ üë©üèæ‚Äçü§ù‚Äçüë©üèº Desenvolvimento de um banco de pot√™ncia para um laptop. Do layout ao produto final. Parte dois ü¶Å üï¥Ô∏è üèß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na √∫ltima parte do artigo sobre o desenvolvimento do PowerBank para um laptop, decidimos por um layout fabricado, medimos a efici√™ncia e entendemos o ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento de um banco de pot√™ncia para um laptop. Do layout ao produto final. Parte dois</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/386899/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na √∫ltima parte do artigo sobre o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desenvolvimento do PowerBank para um laptop,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> decidimos por um layout fabricado, medimos a efici√™ncia e entendemos o que fazer em seguida. </font><font style="vertical-align: inherit;">E ent√£o foi necess√°rio reviver o peda√ßo de ferro. </font><font style="vertical-align: inherit;">Portanto, apresento a sua aten√ß√£o a parte dois: layout do software.</font></font><br>
<img src="https://habrastorage.org/files/368/fcc/f59/368fccf5979c4932a392b911139c892b.png"><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A quebra entre as pe√ßas acabou sendo bastante grande - todas as for√ßas foram lan√ßadas no projeto de uma bateria externa de carregamento r√°pido, que agora est√° coletando suporte no </font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">boomstarter</font></a></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Vamos continuar. </font><font style="vertical-align: inherit;">
Para entender quais microcircuitos teremos que programar, examinaremos o diagrama de blocos do </font><font style="vertical-align: inherit;">
layout.Aqui √© claro que teremos que escrever um software para o controle MK (STM32F042), al√©m de configurar o sistema de controle da bateria de √≠on de l√≠tio + o carregador (BQ40Z60). Comecei com o segundo, porque considerava essa parte a mais dif√≠cil. </font><font style="vertical-align: inherit;">
Para programar o controlador BQ40Z60, precisamos: </font><font style="vertical-align: inherit;">
 - Os adaptadores EV2400 e EV2300 ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">prontos</font></a><font style="vertical-align: inherit;"> ou dom√©sticos). Deixei o EV2300 de projetos anteriores, ent√£o o usei. </font><font style="vertical-align: inherit;">
 - Programa</font></font><b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<img src="https://habrastorage.org/files/87a/3e9/68e/87a3e968e1dc4112a6e96f5375e7b2f8.png"><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est√∫dio de gerenciamento de bateria (bqStudio)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O adaptador √© conectado via SMBus, para a conex√£o deixei pontos de solda nas linhas SMBD e SMBC (n√£o √© a solu√ß√£o mais pr√°tica - ent√£o percebi que precisava instalar o conector). </font></font><br>
<img src="https://habrastorage.org/files/90a/c7d/ddf/90ac7dddfa184d8498d418b786c853fa.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de dan√ßar com um pandeiro, o BQ40Z60 decidiu usar o Battery Management Studio. O motivo disso foi o modo de suspens√£o no qual o controlador entra quando n√£o h√° pull-up no barramento SMBus e nenhum acesso a ele. Ele acorda ao conectar a mem√≥ria. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, ajustaremos diretamente o chip BQ40Z60. Dizer que ele tem muitos registros √© n√£o dizer nada. Um milh√£o de configura√ß√µes. Como a configura√ß√£o √© um processo longo e complicado (√© necess√°rio um artigo separado para descri√ß√£o), descreverei-a brevemente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s o in√≠cio, a janela principal do Battery Management Studio √© exibida.</font></font><br>
<img src="https://habrastorage.org/files/8c5/bb5/610/8c5bb561090943eebcb578c4b6891727.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A guia Mem√≥ria de dados cont√©m um grande n√∫mero de campos nos quais devemos inserir os par√¢metros da bateria e os modos de opera√ß√£o do controlador. </font></font><br>
<img src="https://habrastorage.org/files/d9a/b9a/c2a/d9ab9ac2ac5140debab0ccb00a154b92.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na guia Qu√≠mica, voc√™ pode tentar encontrar calibra√ß√µes prontas para as c√©lulas usadas. </font></font><br>
<img src="https://habrastorage.org/files/fad/140/d49/fad140d49cbd4e4d8837098da6af29f1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o meu YOKU LP 5558115 3500mAh, n√£o havia calibra√ß√µes prontas (a prop√≥sito, as calibra√ß√µes s√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atualizadas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constantemente </font><font style="vertical-align: inherit;">). Encontrado YOKU LP 656193 4000mAh semelhante. Tendo percebido que ainda n√£o sei nada sobre os pacotes dispon√≠veis, escolhi esse perfil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, na guia Mem√≥ria de dados, eu configurei: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calibra√ß√£o:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valores de calibra√ß√£o para volt√≠metros (c√©lulas, baterias e um adaptador externo), resist√™ncia do sensor de corrente, valores de calibra√ß√£o para o sensor de temperatura. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defini√ß√µes:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inclus√£o de prote√ß√µes, termistores, LEDs, modo de suspens√£o, configura√ß√£o da bateria. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prote√ß√µes:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajuste dos limites de prote√ß√£o (tens√£o, tempo, temperatura), ajuste dos limites de tens√£o do adaptador externo. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Falha permanente:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> definir limites para erros irrevers√≠veis (de modo que n√£o seja poss√≠vel uma opera√ß√£o adicional da bateria). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritmo de carga avan√ßado:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configura√ß√£o do carregador (correntes, tens√µes para diferentes faixas de temperatura, sinal do fim da carga, balanceamento). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medi√ß√£o de g√°s:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configura√ß√£o da unidade para determinar o n√≠vel de carga (capacidade da placa de identifica√ß√£o / tens√£o da c√©lula, resist√™ncia do fio, estat√≠stica). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pot√™ncia:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configurando os modos de opera√ß√£o do controlador. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status do PF:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status de falha permanente status do bit </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dados do sistema:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> campos para dados do fabricante. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√£o do SBS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configura√ß√£o dos limites do acionador de alarme, informa√ß√µes b√°sicas da bateria (n√∫mero de s√©rie, data de produ√ß√£o, fabricante, nome, qu√≠mica). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suporte de LED:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configura√ß√£o do modo da luz indicadora de LED. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caixa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> preta </font><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> caixa preta (hist√≥rico de altera√ß√µes nos bits de status da prote√ß√£o). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vida</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √∫til </font><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> estat√≠sticas da bateria. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ra Table: uma</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tabela de resist√™ncias internas da c√©lula. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante o processo de instala√ß√£o, n√£o alterei todos os campos, mas isso foi suficiente para iniciar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com essa parte do circuito, havia apenas um batente de hardware conectado √† sa√≠da do microcircuito 21-AFEFUSE. Aconteceu assim:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu estava rasgando o circuito da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placa de depura√ß√£o,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exceto o microcircuito de prote√ß√£o secund√°ria e o fus√≠vel queimado. O BQ40Z60 possui 21 pinos AFEFUSE para queimar um fus√≠vel (como eu pensava). Ent√£o olhei para a quinta p√°gina da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folha de dados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">BQ40Z60.</font></a><font style="vertical-align: inherit;"> Vi o </font></font><br>
<img src="https://habrastorage.org/files/f1c/964/667/f1c964667aa042cdae2a1d63122e9b67.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tipo de sa√≠da Output </font><font style="vertical-align: inherit;">na tabela </font><font style="vertical-align: inherit;">e, com a consci√™ncia limpa, o deixei pairando no ar. Os problemas surgiram ap√≥s a soldagem da placa: eu resolvi todas as configura√ß√µes (e na √©poca havia muitas d√∫vidas), mas n√£o funcionou - os transistores de carga e descarga n√£o foram ligados. Ap√≥s 2 dias de d√∫vida / delibera√ß√£o / tentativa e erro, notei que o bit FUSE_EN n√£o estava definido e decidi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"perguntar √†s pessoas"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, quando </font><font style="vertical-align: inherit;">publiquei </font><font style="vertical-align: inherit;">uma pergunta, veio um insight</font></font><br>
<img src="https://habrastorage.org/files/13b/a37/caf/13ba37caf5564b55896121eb247369e0.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observando a placa de circuito da placa de depura√ß√£o, sugeri que o pino AFEFUSE tamb√©m pode ser uma entrada, o que foi confirmado na se√ß√£o 9.3.2.4 p.24, que diz que se o pino n√£o for usado, ele dever√° ser conectado ao terra. Eu fiz isso com uma pin√ßa e funcionou. Ap√≥s 5 minutos, eles me responderam no e2e.com - a resposta √© clara e correta, eu expressei meu ‚Äúphi‚Äù sobre o erro na tabela de sa√≠da - eles prometeram corrigi-lo em vers√µes futuras da documenta√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para encerrar as configura√ß√µes do controlador, executei 2 ciclos de treinamento de carga / descarga + relaxamento (levou um total de 30 horas). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos prosseguir com a programa√ß√£o do STM32F042. No est√°gio de simula√ß√£o, este processador n√£o exigiu muito: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Controle o conversor de tens√£o, processe os bot√µes.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - V√° o mais longe poss√≠vel para dormir, para n√£o descarregar a bateria. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Leia os principais par√¢metros da bateria no controlador (tens√£o, corrente, n√≠vel de carga, temperatura, estado atual, n√∫mero de ciclos, tempo para carga / descarga completa) e envie-os para o PC via USART (uma vez que o conversor CP2102 j√° estava na placa). Embora o processador contenha USB embutido, eu n√£o o usei no layout e foi feito um layout para o 051 MK, mas n√£o consegui compr√°-lo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O controle do conversor foi reduzido para definir duas conclus√µes (modo de ativa√ß√£o e opera√ß√£o), fornecendo o PWM (com filtragem RC subsequente) √† sa√≠da da configura√ß√£o de frequ√™ncia de convers√£o do chip LTC3780 (como resultado, defina a frequ√™ncia para um m√°ximo de 400 kHz) e a entrada de monitoramento de sinal PowerGood. Mas mesmo aqui eu consegui pisar no ancinho. O bug estava flutuando e ocorreu quando o Power Bank se deitou por um longo tempo, expresso no fato de que ele simplesmente n√£o foi ligado. O problema foi que primeiro liguei a interrup√ß√£o no sinal PowerGood do LTC3780 e depois liguei o pr√≥prio chip (EN). Aconteceu que a interrup√ß√£o foi acionada antes mesmo do in√≠cio do conversor e o desligou. Reorganizou os eventos em alguns locais e adicionou um atraso - o problema desapareceu. Caso contr√°rio, essa funcionalidade foi f√°cil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidiu-se criar uma interface de usu√°rio com 1 bot√£o e 5 (6) LEDs (embora houvesse 2 bot√µes e 10 LEDs na placa de layout). Funciona da seguinte forma: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dispositivo est√° desligado -&gt; press√£o curta (&lt;500 ms) - anima√ß√£o do n√≠vel de carga em 4 LEDs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dispositivo est√° desligado -&gt; press√£o longa (&gt; 500 ms) - liga o dispositivo (o quinto LED acende). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dispositivo est√° desligado -&gt; conectando a mem√≥ria -&gt; anima√ß√£o do n√≠vel de carga em 4 LEDs at√© o final do processo de carregamento. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dispositivo est√° ligado -&gt; press√£o curta - anima√ß√£o do n√≠vel de carga em 4 LEDs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dispositivo ligado -&gt; press√£o longa - desligue o dispositivo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dispositivo desligado -&gt; consumo de corrente inferior a 50 mA por mais de 3 min. - desligue o dispositivo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso permitiu remover 27 elementos do dispositivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu j√° tinha experi√™ncia na implementa√ß√£o de modos de suspens√£o no STM32F0xx, por isso n√£o contei com uma grande comiss√£o aqui. Para otimizar o consumo, substitu√≠ o 3.3V LDO pelo mcp1703 por uma corrente baixa do meu pr√≥prio consumo (era necess√°rio n√£o interromper a depura√ß√£o, mas instal√°-lo imediatamente). Tamanho, pre√ßo, consumo, kit de carroceria - tudo menos que o LP2951. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecemos √† </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardegor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pela edi√ß√£o do LDO para os √≠ons de l√≠tio 4. O Mcp1703 n√£o pode ser usado devido √† baixa tens√£o de entrada. Eu usei o LiFePo4 para qu√≠mica - n√£o existe esse problema. Seja cuidadoso!!!</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-Quando o dispositivo √© desligado, o MK est√° no modo STANDBY e responde apenas ao pressionar um bot√£o ou √† conex√£o da mem√≥ria. O consumo neste modo √© de 108 ŒºA (100 deles consome BQ40Z60). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-Quando o dispositivo √© ligado, o processador na maioria das vezes (exceto nos momentos de indica√ß√£o e busca do BQ40Z60) fica no modo STOP com um consumo de 1,5 mA (1 mA √© um LED). No momento da interroga√ß√£o e indica√ß√£o, o consumo atual varia de 4,5 a 9 mA. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Quando um USB MK √© conectado no modo RUN de 48 MHz, o consumo √© de 15 mA. No futuro, ligarei o MK neste modo a partir do USB.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O maior problema em potencial foi a pesquisa BQ40Z60. Eu n√£o trabalhei com o SMBus e at√© o √∫ltimo esperava que o SMBus fosse I2C 1v1 (em parte porque o n√≠vel f√≠sico √© o mesmo para eles), mas aconteceu que o n√≠vel do canal √© muito diferente e isso criou v√°rias dificuldades. Aqui n√£o descreverei as diferen√ßas entre SMBus e I2C, mas fornecerei um link para um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bastante competente </font><font style="vertical-align: inherit;">. Na fase de layout, n√£o me envolvi na luta contra o SMBus (a prop√≥sito, como programador, sou muito mais fraco que um projetista de circuitos) e, como os comandos de envio e recebimento de bytes no SMBus e I2C eram completamente id√™nticos, usei apenas eles. Como resultado, li SOC, SOH, Current, CellVolt, TimeToFull, TimeToEmpty do BQ40Z60. Dependendo dos valores dos registros, o modo de opera√ß√£o foi alterado (avisos foram emitidos, ocorreu qualquer desligamento).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, no lado do PC, √© claro, era necess√°rio um programa que pudesse exibir os dados lidos da bateria de uma forma conveniente. Como eu s√≥ podia usar GUIs no Borland C ++ Builder e o fazia por um longo tempo, pedi ao programador para esbo√ßar uma depura√ß√£o simples para mim. Para um r√°pido chicote, saiu o seguinte:</font></font><br>
<img src="https://habrastorage.org/files/62e/18d/c55/62e18dc550c04870a8d51acb5dda6691.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse √© todo o trabalho realizado na fase de layout. </font><font style="vertical-align: inherit;">Al√©m disso, nos planos (e desde que descrevo as opera√ß√µes que j√° foram conclu√≠das, parte do trabalho j√° foi realizado), a transfer√™ncia de especifica√ß√µes t√©cnicas para o projetista para o desenvolvimento / fabrica√ß√£o do pacote PowerBank, corre√ß√£o / revis√£o de erros do circuito, altera√ß√£o da placa para o caso, revis√£o de software. </font><font style="vertical-align: inherit;">Depois disso, o dispositivo ser√° semelhante a um produto e, ap√≥s a conclus√£o, se tornar√° um produto no sentido literal da palavra. </font><font style="vertical-align: inherit;">Nas partes seguintes do artigo, consideraremos as etapas e as principais dificuldades da transi√ß√£o de um layout para um produto acabado, trabalharemos em embalagens, consideraremos os custos de v√°rias solu√ß√µes e opera√ß√µes, otimizaremos e tamb√©m veremos o resultado final.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt386899/">https://habr.com/ru/post/pt386899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt386883/index.html">Como apagamos √† beira da realidade</a></li>
<li><a href="../pt386891/index.html">O teclado UHK √© ainda melhor e mais confort√°vel: agora com m√≥dulos opcionais e um apoio para as m√£os ergon√¥mico</a></li>
<li><a href="../pt386893/index.html">Nova tecnologia de processo reduz o custo do grafeno em 100 vezes</a></li>
<li><a href="../pt386895/index.html">Pr√©-realidade - bonita, seguran√ßa - lucrativa</a></li>
<li><a href="../pt386897/index.html">Remo√ß√£o de ervas daninhas? Nada √© mais f√°cil, carregue-o na Bosch</a></li>
<li><a href="../pt386901/index.html">Energia natural</a></li>
<li><a href="../pt386903/index.html">Stormbuddy bot creator for WOW culpa a Blizzard por roubar c√≥digo fonte</a></li>
<li><a href="../pt386905/index.html">Austr√°lia pro√≠be armazenamento de arquivos para impress√£o 3D de armas de fogo</a></li>
<li><a href="../pt386911/index.html">Avalia√ß√£o do Sony Xperia Z5</a></li>
<li><a href="../pt386915/index.html">A diferen√ßa no tempo de despertar entre dias √∫teis e fins de semana est√° associada a problemas de sa√∫de</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>