<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🌾 👢 🛣️ Asistente de base de datos GreenPig 🙅🏽 📎 👨🏾‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Entrada 
2. Conexión a la biblioteca 
3. Donde clase Parte atómica de la solicitud Consultas complicadas 
4. Parte atómica de la solicitud 
5. Cons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Asistente de base de datos GreenPig</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483458/"><ol><li>  <a href="https://habr.com/ru/post/483458/">Entrada</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Conexión a la biblioteca</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Donde clase</a> <br><ul><li>  <a href="https://habr.com/ru/post/483458/">Parte atómica de la solicitud</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Consultas complicadas</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/483458/">Unirse a clase</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Consulta de clase</a> <br><ul><li>  <a href="https://habr.com/ru/post/483458/">Selección desde una base de datos con parámetros anidados</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Unión múltiple contigo mismo en el nombre de la búsqueda</a> </li></ul></li></ol><br><pre><code class="sql hljs">╔═══╗╔═══╗╔═══╗╔═══╗╔╗─╔╗────╔═══╗╔══╗╔═══╗ ║╔══╝║╔═╗║║╔══╝║╔══╝║╚═╝║────║╔═╗║╚╗╔╝║╔══╝ ║║╔═╗║╚═╝║║╚══╗║╚══╗║╔╗─║────║╚═╝║─║║─║║╔═╗ ║║╚╗║║╔╗╔╝║╔══╝║╔══╝║║╚╗║────║╔══╝─║║─║║╚╗║ ║╚═╝║║║║║─║╚══╗║╚══╗║║─║║────║║───╔╝╚╗║╚═╝║ ╚═══╝╚╝╚╝─╚═══╝╚═══╝╚╝─╚╝────╚╝───╚══╝╚═══╝ 5HHHG HH HHHHHHH 9HHHA HHHHHHHH5 HHHHHHHHHHHHHHHHHH 9HHHHH5 5HHHHHHHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHHHHHHHHH ;HHHHHHHHHHHHHHHHHHHHHHHHHHA H2 HHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHHHH9 HHHHHHHHHHHHHHHHHHHHHHH AHHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHH9 iHS HHHHHHHHHHHHHHHHHHHHHHhh HHHHHHHHHHHHHHHHHH AA HHHHHHHHHHHHHH3 &amp;H Hi HS Hr &amp; H&amp; H&amp; Hi</code> </pre> <a name="habracut"></a><br><h2 id="entry">  Entrada </h2><br><p>  Quiero contarles sobre el desarrollo de mi pequeña biblioteca en php.  ¿Qué tareas resuelve ella?  ¿Por qué decidí escribirlo y por qué podría serle útil?  Bueno, intenta responder estas preguntas. </p><br><p>  <strong>GreenPig</strong> (en adelante <strong>GP</strong> ) es un pequeño asistente de base de datos que puede complementar la funcionalidad de cualquier framework php que use. </p><br><p>  Como cualquier herramienta <strong>GP</strong> , está afilada para resolver ciertos problemas.  Le resultará útil si prefiere escribir consultas de la base de datos en sql puro y no utiliza el registro activo y otras tecnologías similares.  Por ejemplo, tenemos una base de datos Oracle en el trabajo y, a menudo, las consultas ocupan varias pantallas con docenas de combinaciones, todavía se utilizan funciones plsql, union all, etc.  etc., por lo que no queda nada más que hacer que escribir consultas en sql puro. </p><br><p>  Pero con este enfoque, surge la pregunta: ¿cómo generar dónde parte de la consulta SQL cuando los usuarios buscan información?  <strong>GP</strong> está dirigido, en primer lugar, a una compilación conveniente mediante php en caso de una solicitud de cualquier complejidad. </p><br><p>  Pero, ¿qué me llevó a escribir esta biblioteca (excepto, por supuesto, para obtener una experiencia interesante)?  Estas son tres cosas: </p><br><p>  Primero, la necesidad de obtener no una respuesta plana estándar de la base de datos, sino una matriz anidada similar a un árbol. </p><br><div class="spoiler">  <b class="spoiler_title">Aquí hay un ejemplo de una muestra de base de datos estándar:</b> <div class="spoiler_text"><pre> <code class="php hljs">[ [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ], [<span class="hljs-number"><span class="hljs-number">3</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">4</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">5</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">6</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">7</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">8</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">9</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">10</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">11</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">12</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">13</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">14</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ], [<span class="hljs-number"><span class="hljs-number">15</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">16</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">17</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ] ]</code> </pre> </div></div><br><p>  Para obtener una matriz en forma de árbol, necesitamos llevar el resultado a la forma deseada nosotros mismos, o realizar N consultas en la base de datos para cada producto.  ¿Y si necesitamos paginación, e incluso con clasificación?  <strong>GP</strong> es capaz de resolver estos problemas.  Aquí hay un ejemplo de una muestra con <strong>GP</strong> : </p><br><pre> <code class="php hljs">[ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'prod_type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'properties'</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ] [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ] [<span class="hljs-number"><span class="hljs-number">3</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ] ] ] [<span class="hljs-number"><span class="hljs-number">4</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'prod_type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'properties'</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">10</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ] [<span class="hljs-number"><span class="hljs-number">8</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ] [<span class="hljs-number"><span class="hljs-number">9</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ] ] ] ]</code> </pre> <br><p>  Y, por supuesto, al mismo tiempo conveniente paginación y clasificación: <code>-&gt;pagination(1, 10)-&gt;sort('id')</code> . </p><br><p>  La segunda razón no es tan frecuente, pero sin embargo ocurre (y en mi caso esta es la razón principal).  Si algunas entidades se almacenan en la base de datos, y las propiedades de estas entidades son dinámicas y establecidas por los usuarios, cuando necesite buscar entidades por sus propiedades, tendrá que agregar (unir) la misma tabla con los valores de las propiedades (tantas veces como se usen). propiedades al buscar).  Por lo tanto, el GP lo ayudará a conectar todas las tablas y generar la consulta where con casi una función.  Hacia el final del artículo analizaré este caso en detalle. </p><br><p>  Y finalmente, todo esto debería funcionar tanto para la base de datos Oracle como para mySql.  También hay una serie de características descritas en la documentación. </p><br><p>  Es posible que haya inventado otra bicicleta, pero busqué concienzudamente y no encontré una solución adecuada para mí.  Si conoce una biblioteca que resuelve estos problemas, escriba los comentarios. </p><br><p>  Antes de proceder directamente a un examen de la propia biblioteca y a ejemplos, diré que solo habrá la esencia, sin explicaciones detalladas.  Si te interesa cómo funciona el <strong>GP</strong> , puedes mirar la <a href="https://falbin.ru/documentation/greenpig">documentación</a> , en ella intenté explicar todo en detalle. </p><br><h2 id="libraryconnection">  Conexión a la biblioteca </h2><br><p>  La biblioteca se puede instalar a través del compositor: el <code>composer require falbin/green-pig-dao</code> </p><br><p>  Luego debe escribir una fábrica a través de la cual utilizará esta biblioteca. </p><br><h2 id="where">  Donde clase </h2><br><p>  Con esta clase, puede componer la parte where de la consulta sql de cualquier complejidad. </p><br><h3 id="partrequest">  Parte atómica de la solicitud </h3><br><p>  Considere la parte atómica más pequeña de una consulta.  Se describe mediante una matriz: <code>[, , ]</code> <br>  Ejemplo: <code>['name', 'like', '%%']</code> </p><br><ul><li>  <strong>El primer elemento de la</strong> matriz es solo una cadena, insertada en la consulta sql sin cambios y, por lo tanto, puede escribir funciones sql en ella.  Ejemplo: <code>['LOWER(name)', 'like', '%%']</code> </li><li>  <strong>El segundo elemento</strong> también es una cadena insertada en sql sin cambios entre dos operandos.  Puede tomar los siguientes valores: <em>=,&gt;, &lt;,&gt; =, &lt;=, &lt;&gt;, like, not like, between, not between, in, not in</em> . </li><li>  <strong>El tercer elemento de la</strong> matriz puede ser numérico o tipo cadena.  Donde la clase sustituirá automáticamente el alias generado en la consulta sql. </li><li>  <strong>Elemento de matriz con clave sql.</strong>  A veces es necesario que el valor se inserte en el código sql sin cambios.  Por ejemplo, para aplicar funciones.  Esto se puede lograr especificando 'sql' como la clave (para el tercer elemento).  Ejemplo: <code>['LOWER(name)', 'like', 'sql' =&gt; "LOWER('$name')"]</code> </li><li>  <strong>Un elemento de matriz con la clave de vinculación</strong> es una matriz para almacenar enlaces.  El ejemplo anterior es incorrecto desde un punto de vista de seguridad.  No puede insertar variables en sql: es demasiada inyección.  Por lo tanto, en este caso, deberá especificar alias usted mismo, por ejemplo: <code>['LOWER(name)', 'like', 'sql' =&gt; "LOWER(:name)", 'bind'=&gt; ['name' =&gt; $name] ]</code> </li><li>  <strong>El operador in</strong> puede escribirse así: <code>['curse', 'not in', [1, 3, 5]]</code> .  La clase Where convierte dicha entrada en el siguiente código sql: <code>curse not in (:al_where_jCgWfr95kh, :al_where_mCqefr95kh, :al_where_jCfgfr9Gkh)</code> </li><li>  <strong>La declaración between</strong> se puede escribir así: <code>['curse', ' between', 1, 5]</code> .  La clase Where convierte dicha entrada en el siguiente código sql: <code>curse between :al_where_Pi4CRr4xNn and :al_where_WiPPS4NKiG</code> <br>  Pero tenga cuidado, si los elementos tercero y cuarto de la matriz son cadenas, entonces se aplica una lógica especial.  En este caso, se cree que la selección es de un rango de fechas y, por lo tanto, se utiliza la función sql de convertir una cadena a una fecha.  La función de convertir a una fecha (mySql y Oracle tienen diferentes) y sus parámetros se toman de una variedad de configuraciones (más en la documentación).  La matriz <code>['build_date', 'between', '01.01.2016', '01.01.2019']</code> se convertirá en sql: <code>build_date between TO_DATE(:al_where_fkD7nZg5lU, 'dd.mm.yyyy hh24:mi::ss') and TO_DATE(:al_where_LdyVRznPF8, 'dd.mm.yyyy hh24:mi::ss')</code> </li></ul><br><h3 id="complicatedqueries">  Consultas complicadas </h3><br><p>  Creemos una instancia de la clase a través de la fábrica: <code>$wh = GP::where();</code> </p><br><p>  Para indicar la conexión lógica entre las "partes atómicas" de la solicitud, debe usar las <code>linkAnd()</code> o <code>linkOr()</code> .  Un ejemplo: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// sql: (old &gt; 18 and old &lt; 50) $wh-&gt;linkAnd([ ['old', '&lt;', 18], ['old', '&gt;', 50] ]); // sql: (old &lt; 18 or old &gt; 50) $wh-&gt;linkOr([ ['old', '&lt;', 18], ['old', '&gt;', 50] ]);</span></span></code> </pre> <br><p>  Cuando se usan las <strong>funciones linkAnd / linkOr,</strong> todos los datos se almacenan dentro de una instancia de la clase Where - $ wh.  Además, todas las "partes atómicas" indicadas en la función <strong>están entre corchetes</strong> . </p><br><p>  SQL de cualquier complejidad se puede describir mediante tres funciones: <code>linkAnd(), linkOr(), getRaw()</code> .  Considere un ejemplo: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// sql: curse = 1 and (old &lt; 18 or old &gt; 50) $wh-&gt;linkAnd([ ['curse', '=', 1], $wh-&gt;linkOr([ ['old', '&lt;', 18], ['old', '&gt;', 50] ])-&gt;getRaw() ]);</span></span></code> </pre> <br><p>  La clase Where tiene una variable privada que almacena la expresión sin formato.  Los <code>linkAnd()</code> y <code>linkOr()</code> sobrescriben esta variable, por lo tanto, al construir una expresión lógica, los métodos se anidan juntos y la variable con la expresión sin procesar contiene datos obtenidos del último método ejecutado. </p><br><h2 id="join">  ÚNETE a la clase </h2><br><p>  <strong>Join</strong> es una clase que genera un fragmento de unión de código sql.  <code>$jn = GP::leftJoin('coursework', 'student_id', 's.id')</code> una instancia de la clase a través de la fábrica: <code>$jn = GP::leftJoin('coursework', 'student_id', 's.id')</code> , donde: </p><br><ul><li>  <strong>el curso</strong> es la mesa a la que nos uniremos </li><li>  <strong>student_id</strong> : una columna con una clave externa de la tabla de <strong>cursos</strong> . </li><li>  <strong>s.id</strong> : la columna de la tabla con la que se debe escribir join junto con el alias de la tabla (en este caso, el alias de la tabla es s). </li></ul><br><p>  Sql generada: <code>left JOIN coursework coursework_joM9YuTTfW ON coursework_joM9YuTTfW.student_id = s.id</code> </p><br><p>  Al crear una instancia de la clase, ya describimos la condición para unir tablas, pero puede ser necesario aclarar y expandir la condición.  Las <strong>funciones linkAnd / linkOr</strong> lo ayudarán a hacer esto: <code>$jn-&gt;linkAnd(['semester_number', '&gt;', 2])</code> </p><br><p>  Sql generada: <code>inner JOIN coursework coursework_Nd1n5T7c0r ON coursework_Nd1n5T7c0r.student_id = s.id and (semester_number &gt; :al_where_M1kEcHzZyy)</code> </p><br><p>  Si hay varias tablas para unir, puede combinarlas en una clase: <strong>CollectionJoin</strong> . </p><br><h2 id="query">  Consulta de clase </h2><br><p>  Esta es la clase principal para trabajar con la base de datos, a través de ella hay una selección, registro, actualización y eliminación de datos.  También puede realizar cierto procesamiento de datos obtenidos de la base de datos. </p><br><p>  Considere un ejemplo típico. </p><br><p>  Creemos una instancia de la clase a través de la fábrica: <code>$qr = GP::query();</code> </p><br><p>  Ahora configuraremos la plantilla sql, sustituiremos los valores necesarios para el escenario dado en la plantilla sql y diremos que queremos obtener un registro, y específicamente los datos de la columna <strong>average_mark</strong> . </p><br><pre> <code class="php hljs">$rez = $qr-&gt;sql(<span class="hljs-string"><span class="hljs-string">"select /*select*/ from student s inner join mark m on s.id = m.student_id inner join lesson l on l.id = m.lesson_id /*where*/ /*group*/"</span></span>) -&gt;sqlPart(<span class="hljs-string"><span class="hljs-string">'/*select*/'</span></span>, <span class="hljs-string"><span class="hljs-string">'s.name, avg(m.mark) average_mark'</span></span>, []) -&gt;whereAnd(<span class="hljs-string"><span class="hljs-string">'/*where*/'</span></span>, [<span class="hljs-string"><span class="hljs-string">'s.id'</span></span>, <span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) -&gt;sqlPart(<span class="hljs-string"><span class="hljs-string">'/*group*/'</span></span>, <span class="hljs-string"><span class="hljs-string">'group by s.name'</span></span>, []) -&gt;one(<span class="hljs-string"><span class="hljs-string">'average_mark'</span></span>);</code> </pre> <br><p>  Resultado: <code>3,16666666666666666666666666666666666667</code> </p><br><h3 id="selection">  Selección desde una base de datos con parámetros anidados </h3><br><p>  Sobre todo, no tuve la oportunidad de obtener una selección de la base de datos en una vista de árbol, con propiedades adjuntas.  Por lo tanto, la biblioteca GP tiene esa oportunidad, y la profundidad de anidamiento no está limitada. </p><br><p>  La forma más fácil de considerar el principio de funcionamiento se basa en un ejemplo.  Para su consideración, tomamos el siguiente <strong>esquema de base de datos:</strong> </p><br><p><img src="https://habrastorage.org/webt/tt/ih/_o/ttih_oflaq8cvslm1yiutxabp8q.png"></p><br><p>  <strong>Contenido de la tabla:</strong> </p><br><p><img src="https://habrastorage.org/webt/z4/v4/aa/z4v4aa7oci4w-9q7nrncht1tceu.png"></p><br><p>  A menudo, al consultar una base de datos, desea obtener una respuesta similar a un árbol, no plana.  Por ejemplo, ejecutando esta consulta: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.id, s.name, c.id title_id, c.title <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> student s <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> coursework c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c. student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> s.id = <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Obtenemos un resultado plano: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'«»    '</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span>=&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span> ] ]</code> </pre> <br><p>  Usando GP, puede obtener este resultado: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'«»    '</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>] ] ] ]</code> </pre> <br><p>  Para lograr este resultado, debe pasar una matriz con opciones a <code>all</code> funciones (la función devuelve todas las líneas de consulta): </p><br><pre> <code class="php hljs">all([ <span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span> ] ])</code> </pre> <br><p>  La matriz <code>$option</code> en el <strong>agregador de</strong> funciones <strong>( <code>$option</code> , $ rawData)</strong> y <strong>todas ( <code>$options</code> )</strong> se crean de acuerdo con las siguientes reglas: </p><br><ul><li>  <strong>Teclas de matriz</strong> : nombres de columna.  <strong>Elementos de matriz</strong> : nuevos nombres para columnas, puede ingresar el nombre anterior. </li><li>  Hay una palabra reservada para los valores de la matriz: <code>pk</code> .  Dice que los datos se agruparán por esta columna (la clave de matriz es el nombre de la columna). </li><li>  En cada nivel solo debe haber un <code>pk</code> . </li><li>  En la matriz agregada (resultante), los valores de la columna declarada por <code>pk</code> se utilizarán como claves. </li><li>  Si es necesario colocar parte de las columnas un nivel más bajo, se utilizará un nombre nuevo e inventado como clave de matriz, y se utilizará como valor una matriz construida de acuerdo con las reglas descritas anteriormente. </li></ul><br><p>  Considere un ejemplo más complejo.  Supongamos que necesitamos que todos los estudiantes tengan el nombre de sus cursos y todas las calificaciones en todas las materias.  Nos gustaría recibirlo no en forma plana, sino en forma de árbol, sin duplicados.  A continuación se muestra la consulta deseada a la base de datos y el resultado. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.id student_id, s.name student_name, s.semester_number, c.id coursework_id, c.semester_number coursework_semester, c.title coursework_title, l.id lesson_id, l.name lesson, m.id mark_id, m.mark <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> student s <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> coursework c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> mark m <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> m.student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> lesson l <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.id = m.lesson_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> s.id, c.id, l.id, m.id</code> </pre> <br><p>  El resultado no nos conviene: </p><br><p><img src="https://habrastorage.org/webt/er/mj/7p/ermj7p5zki1g4hfxausavajfcps.png"></p><br><p>  Para lograr la tarea, debe escribir la siguiente matriz <code>$option</code> : </p><br><pre> <code class="php hljs">$option = [ <span class="hljs-string"><span class="hljs-string">'student_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'student_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'coursework_semester'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'coursework_title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span> ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'lesson'</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'mark_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mark'</span></span> ] ] ];</code> </pre> <br><p>  Consulta de base de datos: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    Query   .       // (    yii2) $qr = Yii::$app-&gt;gp-&gt;query( "SELECT s.id student_id, s.name student_name, s.semester_number, c.id coursework_id, c.semester_number coursework_semester, c.title coursework_title, l.id lesson_id, l.name lesson, m.id mark_id, m.mark FROM student s LEFT JOIN coursework c ON c.student_id = s.id LEFT JOIN mark m ON m.student_id = s.id LEFT JOIN lesson l ON l.id = m.lesson_id ORDER BY s.id, c.id, l.id, m.id"); //   1,  2   3  //  1 $result = $qr-&gt;all($option); //  2 $result = $qr-&gt;aggregator($option, $qr-&gt;all()); //  3 $qr-&gt;all(); $result = $qr-&gt;aggregator($option, $qr-&gt;rawData());</span></span></code> </pre> <br><p>  La función del <code>aggregator</code> puede procesar cualquier matriz con una estructura similar al resultado de una consulta a la base de datos, de acuerdo con las reglas descritas en la <code>$option</code> . </p><br><p>  La variable <code>$result</code> contiene los siguientes datos: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'    '</span></span>], ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'«»    '</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>] ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">17</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">18</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">20</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">16</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">19</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>] ] ], ] ] ]</code> </pre> <br><p>  Por cierto, con la paginación con consulta agregada, solo se consideran los datos principales y más básicos.  En el ejemplo anterior, solo habrá 2 líneas para la paginación. </p><br><h2 id="union">  Unión múltiple contigo mismo en el nombre de la búsqueda </h2><br><p>  Como escribí anteriormente, la tarea principal de mi biblioteca es simplificar la generación de las partes where para consultas seleccionadas.  Entonces, ¿en qué caso es posible que necesitemos unirnos repetidamente a la misma tabla para consultar dónde?  Una de las opciones es cuando tenemos un determinado producto cuyas propiedades no se conocen de antemano y serán agregadas por los usuarios, y debemos tener la oportunidad de buscar productos por estas propiedades dinámicas.  La forma más fácil de explicar con un ejemplo simplificado. </p><br><p>  Supongamos que tenemos una tienda en línea que vende componentes informáticos, y no tenemos una variedad estricta, y periódicamente compraremos uno u otro componente.  Pero nos gustaría describir todos nuestros productos como una entidad única y buscar todos los productos.  Entonces, qué entidades se pueden distinguir desde el punto de vista de la lógica empresarial: </p><br><ol><li>  <strong>Producto.</strong>  La entidad más importante en torno a la cual se construye todo. </li><li>  <strong>Tipo de producto.</strong>  Esto se puede representar como la propiedad raíz para todas las demás propiedades del producto.  Por ejemplo, en nuestra pequeña tienda es solo: RAM, SSD y HDD. </li><li>  <strong>Propiedades del producto</strong>  En nuestra implementación, cualquier propiedad puede aplicarse a cualquier tipo de producto, la elección queda en la conciencia del gerente.  En nuestra tienda, los gerentes hicieron solo 3 propiedades: tamaño de memoria, factor de forma y DDR. </li><li>  <strong>El valor de los bienes.</strong>  El valor que el comprador generará en la búsqueda. </li></ol><br><p>  Toda la lógica comercial descrita anteriormente se refleja en detalle en la imagen a continuación. </p><br><p><img src="https://habrastorage.org/webt/z1/gx/um/z1gxum4ba1zhvsilqqdqijndt94.png"></p><br><p>  Por ejemplo, tenemos un producto: <strong>16 GB DDR 3 RAM</strong> .  En el diagrama, esto se puede mostrar de la siguiente manera: </p><br><p><img src="https://habrastorage.org/webt/kz/lp/-x/kzlp-xtvozjhyffgboxtbqr7qri.png"></p><br><p>  La estructura y los datos de la base de datos son claramente visibles en la siguiente figura: </p><br><p><img src="https://habrastorage.org/webt/es/lk/8a/eslk8aungbzzjqtpjnejscp6ywk.png"></p><br><p>  Como vemos en el diagrama, todos los valores de todas las propiedades se almacenan en una tabla de <strong>valores</strong> (por cierto, en nuestra versión simplificada, todas las propiedades tienen valores numéricos).  Por lo tanto, si queremos buscar simultáneamente varias propiedades con un grupo de AND, obtenemos una selección vacía. </p><br><p>  Por ejemplo, un comprador está buscando productos adecuados para tal solicitud: la <em>cantidad de memoria debe ser superior a 10 GB y el factor de forma debe ser de 2,5 pulgadas</em> .  Si escribimos sql como se muestra a continuación, obtenemos una selección vacía: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> product p <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> val v <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> v.product_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> (v.property_id = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> v.value &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (v.property_id = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> v.value = <span class="hljs-number"><span class="hljs-number">2.5</span></span>)</code> </pre> <br><p>  Dado que los valores de todas las propiedades se almacenan en una tabla, para buscar varias propiedades, debe unir el valor de la tabla para cada propiedad que se buscará.  Pero hay un matiz, unir tablas de unión "horizontalmente" (a la palabra unión todas las uniones "verticalmente"), el siguiente es un ejemplo: </p><br><p><img src="https://habrastorage.org/webt/00/th/4d/00th4d4mehwetkemk7vnkvqukr4.png"></p><br><p>  Este resultado no nos conviene, nos gustaría ver todos los valores en una columna.  Para hacer esto, debe unirse a la tabla val 1 veces más que las propiedades por las cuales se realiza la búsqueda. </p><br><p><img src="https://habrastorage.org/webt/pp/br/rp/ppbrrphdkttykoq0uexraglkcve.png"></p><br><p>  Estamos cerca de generar automáticamente consultas SQL.  Veamos la función. <br>  <code>whereWithJoin ($aliasJoin, $options, $aliasWhere, $where)</code> , que hará todo el trabajo: </p><br><ul><li>  <strong>$ aliasJoin</strong> : un alias en la plantilla base, en lugar del cual se sustituye la parte sql con combinaciones. </li><li>  <strong>$ options</strong> : una matriz con descripciones de las reglas para generar la parte de unión. </li><li>  <strong>$ aliasWhere</strong> : un alias en la plantilla base, que sustituye la parte where sql en su lugar. </li><li>  <strong>$ where</strong> es una instancia de la clase Where. </li></ul><br><p>  Veamos un ejemplo: <code>whereWithJoin('/*join*/', $options, '/*where*/', $wh)</code> . </p><br><p>  Primero, cree la variable <strong>$ options</strong> : <code>$options = ['v' =&gt; ['val', 'product_id', 'p.id']];</code> </p><br><p>  <strong>v</strong> es el alias de la tabla.  Si el alias dado se encuentra en <strong>$ wh</strong> , entonces una nueva tabla <strong>val</strong> se conectará mediante join (donde <strong>product_id</strong> es la clave externa de la tabla <strong>val</strong> , y <strong>p.id</strong> es la clave principal para la tabla con el alias <strong>p</strong> ), se generará un nuevo alias y este alias. reemplazará <strong>v</strong> en donde. </p><br><p>  <strong>$ wh</strong> es una instancia de la clase Where.  Formulamos la misma solicitud: <em>la memoria debe tener más de 10 GB y el factor de forma debe ser de 2.5 pulgadas.</em> </p><br><pre> <code class="php hljs">$wh-&gt;linkAnd([ $wh-&gt;linkAnd([ [<span class="hljs-string"><span class="hljs-string">'v.property_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], [<span class="hljs-string"><span class="hljs-string">'v.value'</span></span>, <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>] ])-&gt;getRaw(), <span class="hljs-comment"><span class="hljs-comment">//    $wh-&gt;linkAnd([ ['v.property_id', '=', 3], ['v.value', '=', 2.5] ])-&gt;getRaw(),//    ]);</span></span></code> </pre> <br><p>  Al crear una solicitud where, es necesario ajustar la parte con la propiedad id y su valor entre paréntesis, esto le dice a la función <code>whereWithJoin()</code> que el alias de la tabla será el mismo en esta parte. </p><br><pre> <code class="php hljs">$qr-&gt;sql(<span class="hljs-string"><span class="hljs-string">"select p.id, t.name type_name, pr.id prop_id, pr.name prop_name, v.id val_id, v.value from product p inner join type t on t.id = p.type_id inner join val v on v.product_id = p.id inner join properties pr on pr.id = v.property_id /*join*/ /*where*/"</span></span>) -&gt;whereWithJoin(<span class="hljs-string"><span class="hljs-string">'/*join*/'</span></span>, $options, <span class="hljs-string"><span class="hljs-string">'/*where*/'</span></span>, $wh) <span class="hljs-comment"><span class="hljs-comment">//     . -&gt;all([ 'id' =&gt; 'pk', 'type_name' =&gt; 'type', 'properties' =&gt; [ 'prop_id' =&gt; 'pk', 'prop_name' =&gt; 'name', 'values' =&gt; [ 'val_id' =&gt; 'pk', 'value' =&gt; 'val' ] ] ]);</span></span></code> </pre> <br><p>  Examinamos el sql generado, los enlaces y el tiempo de ejecución de la consulta: <code>$qr-&gt;debugInfo()</code> : </p><br><pre> <code class="php hljs">[ [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'info'</span></span>, <span class="hljs-string"><span class="hljs-string">'sql'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'select p.id, t.name type_name, pr.id prop_id, pr.name prop_name, v.id val_id, v.value from product p inner join type t on t.id = p.type_id inner join val v on v.product_id = p.id inner join properties pr on pr.id = v.property_id inner JOIN val val_mIQWpnHhdQ ON val_mIQWpnHhdQ.product_id = p.id inner JOIN val val_J0uveMpwEM ON val_J0uveMpwEM.product_id = p.id WHERE ( val_mIQWpnHhdQ.property_id = :al_where_leV5QlmOZN and val_mIQWpnHhdQ.value &gt; :al_where_ycleYAswIw ) and ( val_J0uveMpwEM.property_id = :al_where_dinxDraTOE and val_J0uveMpwEM.value = :al_where_wZJhUqs74i )'</span></span>, <span class="hljs-string"><span class="hljs-string">'binds'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'al_where_leV5QlmOZN'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_ycleYAswIw'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_dinxDraTOE'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_wZJhUqs74i'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], <span class="hljs-string"><span class="hljs-string">'timeQuery'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0384588241577</span></span> ] ]</code> </pre> <br><p>      <code>$qr-&gt;rawData()</code> : </p><br><pre> <code class="php hljs">[ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">512</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">256</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1024</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ] ]</code> </pre> <br><p>        <code>$qr-&gt;aggregateData()</code> : </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">512</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">256</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">8</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">11</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1024</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">12</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ] ]</code> </pre> <br><p>     ,   ,    <code>whereWithJoin()</code> ,    . </p><br><p>  <code>whereWithJoin()</code> ,    ,      <strong>n</strong>    ,   <strong>m</strong>    .  <strong>n</strong>  <strong>m</strong>     1         id    .        ,      <strong>AND</strong> . </p><br><hr><br><p>        <a href="https://falbin.ru/documentation/greenpig/"></a>     <a href="https://github.com/mrFalbin/green-pig-dao/tree/master">GitHub</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/483458/">https://habr.com/ru/post/483458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../483440/index.html">Últimos compiladores de D</a></li>
<li><a href="../483444/index.html">Informe DORA 2019: Cómo mejorar el rendimiento de DevOps</a></li>
<li><a href="../483446/index.html">Los científicos han encontrado una nueva forma de reducir los niveles de hierro en el agua potable</a></li>
<li><a href="../483448/index.html">Disney: el mejor bidireccional de la historia humana</a></li>
<li><a href="../483454/index.html">Cambiar de Mercurial a GIT en Atlassian Bitbucket con guardar archivos en cirílico</a></li>
<li><a href="../483460/index.html">SQL HowTo: construir cadenas usando funciones de ventana</a></li>
<li><a href="../483462/index.html">Cállate y toma mi dinero</a></li>
<li><a href="../483466/index.html">Introduciendo el método de retropropagación</a></li>
<li><a href="../483468/index.html">Pruebas de integración de flutter: es fácil</a></li>
<li><a href="../483470/index.html">Coloque mosaicos de manera eficiente (Pro CSS, SVG, patrón y más)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>