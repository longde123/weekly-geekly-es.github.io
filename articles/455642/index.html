<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöà üòΩ üë®‚Äçüë©‚Äçüë¶ La arquitectura del servicio de cola de mensajes distribuidos en Yandex.Cloud üõçÔ∏è üî∂ ‚úíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola, me llamo Vasily Bogonatov. Soy uno de los que pone mi mano y mi cabeza y pone mi alma al servicio de las colas de mensajes persistentes distribu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La arquitectura del servicio de cola de mensajes distribuidos en Yandex.Cloud</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/455642/">  Hola, me llamo Vasily Bogonatov.  Soy uno de los que pone mi mano y mi cabeza y pone mi alma al servicio de las colas de mensajes persistentes distribuidas de Yandex Message Queue.  El servicio se hizo p√∫blico a fines de mayo, pero dentro de Yandex se ha utilizado activamente en varios productos. <br><br>  Hoy quiero contarles a los lectores de Habr sobre las colas de mensajes en general y sobre Yandex Message Queue en particular.  Primero, quiero explicar qu√© es una "cola de mensajes persistentes distribuidos" y por qu√© es necesaria.  Mostrar su valor pr√°ctico, la mec√°nica de trabajar con mensajes, hablar sobre la API y la usabilidad.  En la segunda mitad del art√≠culo, veremos el aspecto t√©cnico: c√≥mo se usa la base de datos Yandex en nuestras colas (esta es una base confiable de nuestro servicio), c√≥mo se ve un enfoque ingenuo y mejorado para construir una arquitectura, qu√© problemas son causados ‚Äã‚Äãpor la distribuci√≥n y c√≥mo se pueden resolver. <br><br><img src="https://habrastorage.org/webt/xy/ht/eb/xyhtebqslkofciotlmohtwlopb4.png"><br><a name="habracut"></a><br><h3>  ¬øQu√© es una cola de mensajes persistentes distribuidos? </h3><br>  Wikipedia define la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cola de mensajes</a> como "un componente de ingenier√≠a de software utilizado para la interacci√≥n entre procesos o entre subprocesos dentro de un proceso".  De hecho, este concepto es algo m√°s amplio: los procesos que interact√∫an usando una cola pueden ubicarse en diferentes servidores e incluso en diferentes centros de datos. <br><br>  Aclararemos un poco los t√©rminos. <br><br>  <b>Una cola de mensajes</b> es un repositorio que proporciona la colocaci√≥n y lectura de datos en un orden espec√≠fico. <br><br>  Dos tipos de entidades suelen interactuar con una cola: <br><br><ul><li>  <b>escritores (productores)</b> : env√≠an mensajes a la cola; </li><li>  <b>lectores (consumidores)</b> : reciben (leen) mensajes de la cola. </li></ul><br>  Al usar la cola, los lectores y escritores son independientes entre s√≠.  Pueden trabajar con diferentes prestaciones, fiabilidad, disponibilidad e incluso pueden escribirse en diferentes lenguajes de programaci√≥n. <br><br>  El escenario principal para la cola: transmite mensajes de manera confiable y r√°pida del escritor al lector.  A diferencia de la base de datos, la cola no est√° destinada al almacenamiento de mensajes a largo plazo.  En muchas implementaciones populares, hay un par√°metro correspondiente: "Per√≠odo de retenci√≥n de mensajes".  Determina cu√°nto tiempo se almacena el mensaje hasta que se elimina permanentemente. <br><br>  Descubrimos el concepto de cola, ir a la "distribuci√≥n" y "persistencia". <br><br><ul><li>  <b>Distribuci√≥n</b> en nuestro caso significa la presencia de un cl√∫ster que almacena y procesa datos y metadatos en cola, combinando todos sus nodos en un solo conjunto utilizando una red inform√°tica. </li><li>  <b>La persistencia</b> implica que todos los mensajes en la cola se escriben en el disco, y el escritor recibe la confirmaci√≥n de env√≠o solo despu√©s de una grabaci√≥n exitosa. </li></ul><br>  La distribuci√≥n y la persistencia no afectan la funcionalidad principal de la cola, proporcionan tolerancia a fallas y confiabilidad del almacenamiento de datos.  Qu√© tipos de fallas pueden ocurrir en nuestro sistema, lo consideraremos un poco m√°s adelante.  Sin embargo, no puedo negarme el placer y abrir un poco las tarjetas: en toda la historia de la existencia del servicio, no hemos perdido un solo mensaje guardado del cliente. <br><br><h3>  ¬øPara qu√© sirve la cola de mensajes? </h3><br>  La cola le permite separar las partes l√≥gicamente independientes de los servicios entre s√≠, es decir, proporciona un <b>desacoplamiento</b> , que es tan solicitado en los microservicios ahora populares.  Esto aumenta la escalabilidad y la confiabilidad: siempre puede aumentar el flujo de grabaciones en la cola y agregar m√°s lectores, manejadores de mensajes, mientras que la falla de los lectores no afecta el trabajo de los escritores. <br><br>  Las colas suavizan las cargas m√°ximas: act√∫an como amortiguadores para los lectores.  Si las capacidades actuales del lector no son suficientes para el procesamiento instant√°neo de todos los mensajes entrantes, los mensajes en cola se procesar√°n m√°s tarde cuando la carga disminuya.  El almacenamiento en b√∫fer es √∫til para servicios con una carga inestable, donde no se necesitan eventos entrantes instant√°neos. <br><br>  Veamos c√≥mo funciona, usando el ejemplo de un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">robot de b√∫squeda</a> (¬°despu√©s de todo, Yandex comenz√≥ con una b√∫squeda!), Que descarga, procesa y coloca p√°ginas web en una base de datos.  Tomemos tal arquitectura. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/oe/dh/zooedh0t0qs4uu1lhpdc0psa2qi.png" width="600" height="778"></div><br><br>  La cola de mensajes resuelve los siguientes problemas aqu√≠: <br><br><ol><li>  El robot funciona mucho m√°s r√°pido que los trabajadores responsables de analizar y cargar p√°ginas en la base de datos.  Fuera de l√≠nea, los enlaces se acumular√≠an y llenar√≠an la memoria o el disco disponible.  Lo mismo suceder√≠a si los trabajadores no estuvieran disponibles temporalmente. </li><li>  Sin una cola, el robot necesita "conocer" la interfaz de trabajo de los trabajadores para poder asignarles tareas.  La interfaz puede cambiar a medida que se desarrolla el producto. </li><li>  Un trabajador individual tiene una fiabilidad bastante baja, por lo que no hay garant√≠a de que el enlace transmitido sea procesado por √©l por completo. </li></ol><br>  La cola proporciona almacenamiento de datos confiable con escala, le permite retrasar el procesamiento de los enlaces.  Si un trabajador falla, el enlace sin procesar despu√©s de un cierto per√≠odo de tiempo ser√° devuelto a la cola para que otro trabajador lo procese.  La cola tiene su propia interfaz, que se prueba y describe en la documentaci√≥n, de modo que el robot de b√∫squeda y los sistemas de trabajo pueden desarrollar diferentes equipos en diferentes lenguajes de programaci√≥n.  Esto no afectar√° el rendimiento general. <br><br><h3>  C√≥mo funciona Yandex Message Queue con los mensajes </h3><br>  Aqu√≠ se pueden distinguir tres etapas principales: <br><br><ul><li>  <b>escribir un</b> mensaje en la cola; </li><li>  <b>leer un</b> mensaje de la cola; </li><li>  <b>Eliminar un</b> mensaje de la cola. </li></ul><br>  Un registro se considera exitoso si el mensaje se ha almacenado de forma segura y pronto estar√° disponible para los lectores.  La grabaci√≥n de deduplicaci√≥n es posible: cuando se ignora un intento repetido de grabar un mensaje enviado. <br><br>  En el momento de la lectura, el mensaje est√° oculto de la cola por un per√≠odo de tiempo llamado Visibilidad Timeout, y se vuelve inaccesible para otros lectores.  Si el tiempo de espera de visibilidad expira, el mensaje vuelve a la cola y vuelve a estar disponible para su procesamiento.  El orden en que se leen los mensajes est√° determinado por la cola, no por el lector. <br><br>  El lector en s√≠ y la conexi√≥n de red con √©l son potencialmente poco confiables.  Es necesario un tiempo de espera de visibilidad para poder devolver un mensaje a la cola cuando el lector falla o la conexi√≥n se desconecta.  De lo contrario, es probable que un solo mensaje nunca se procese correctamente. <br><br>  Despu√©s de una lectura exitosa, el mensaje se transmite al cliente con el identificador ReceiptHandle.  Un identificador indica datos espec√≠ficos que deben eliminarse de la cola de mensajes. <br><br><h3>  Tipos de cola en Yandex Message Queue </h3><br>  El primer tipo y el m√°s utilizado es la cola est√°ndar.  Se caracteriza por un alto rendimiento (miles de mensajes por segundo), excelente rendimiento y corto tiempo de ejecuci√≥n de operaciones b√°sicas.  Las colas est√°ndar consisten en fragmentos l√≥gicos y admiten una escala de ancho de banda casi lineal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wy/p0/jp/wyp0jpi_pmhorpq2mikwm_mgl-u.png"></div><br>  Las colas est√°ndar no admiten la deduplicaci√≥n de mensajes al escribir en una cola y no garantizan el orden de lectura.  Debido al uso de fragmentos, una solicitud de lectura puede no devolver un solo mensaje, incluso si est√°n en la cola.  La mayor√≠a de las veces esto sucede en el modo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sondeo corto</a> , cuando la lectura proviene de un fragmento seleccionado al azar. <br><br>  El segundo tipo, <abbr title="Primero en entrar, primero en salir">FIFO</abbr> , es el opuesto de la cola est√°ndar.  Proporciona un estricto orden de lectura, admite deduplicaci√≥n al escribir e intentos repetidos de leer mensajes.  El rendimiento y la escalabilidad son inferiores a los est√°ndares.  El rendimiento de la cola FIFO est√° limitado a 30 solicitudes por segundo.  Se recomienda utilizar FIFO cuando necesite intentar garantizar la sem√°ntica de entrega "exactamente una vez".  Por lo general, la palabra "cola" significa FIFO. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yr/jy/l5/yrjyl5kbyfzqzkruqhaoqdrsxzs.png" width="421" height="801"></div><br><h3>  API Yandex Message Queue </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">API</a> es un componente extremadamente importante de cualquier producto.  Una buena interfaz de software debe ser simple y directa, requiriendo una m√≠nima familiarizaci√≥n con la documentaci√≥n para un uso efectivo.  No debe permitir realizar acciones extra√±as o innecesarias y protegerse contra errores est√∫pidos, informando oportunamente la violaci√≥n del "contrato". <br><br>  Si el sistema tiene una API de este tipo, r√°pidamente recibe usuarios leales y est√° rodeado de "envoltorios" convenientes para diferentes plataformas y lenguajes de programaci√≥n. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La API de Amazon Simple Queue Service (AWS SQS API)</a> es un ejemplo de dicha interfaz, probada por el tiempo y una gran cantidad de clientes.  Por lo tanto, decidimos no inventar una interfaz √∫nica para Yandex Message Queue, pero implementamos el soporte para la API de AWS SQS, y con mucho cuidado. <br><br>  En la mayor√≠a de los casos, es suficiente que el usuario de SQS cambie el punto final (direcci√≥n de servicio), la regi√≥n (en este momento solo usamos "ru-central1") y obtenga nuevas credenciales dentro de Yandex.Cloud.  Todo lo dem√°s, por ejemplo, un script que usa la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠nea de comandos de AWS</a> , el c√≥digo que usa AWS SDK o un servicio listo en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Celery</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">boto</a> , es muy probable que no se toque.  La l√≥gica y la funcionalidad del servicio de cola seguir√°n siendo las mismas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_r/td/kn/_rtdknyixiytyqo63khne5gz4uq.png"></div><br>  Una descripci√≥n detallada de los m√©todos de la API Yandex Message Queue se encuentra en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n del servicio</a> . <br><br><h3>  Un poco sobre conveniencia </h3><br>  Yandex Message Queue es un servicio administrado, es decir, Yandex. Cloud es responsable del funcionamiento de los servidores y el software.  El equipo de servicio monitorea el estado de las colas, reemplaza r√°pidamente los discos fallidos, elimina las interrupciones de la red y lanza actualizaciones.  La actualizaci√≥n no detiene el servicio: mientras instalamos la nueva versi√≥n de YMQ en un grupo de servidores, el equilibrador de carga redirige cuidadosamente el tr√°fico a otros.  Para que los usuarios no noten nada. <br><br>  Para que le resulte m√°s conveniente controlar el funcionamiento de las colas, hemos agregado una gran cantidad de gr√°ficos visuales a YMQ, aqu√≠ solo se muestra una peque√±a parte de ellos.  Los gr√°ficos se encuentran en la consola Yandex.Cloud, en la secci√≥n "Estad√≠sticas". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bi/cp/nn/bicpnn5tjwzqustzy9ye5abnrho.png"></div><br>  Le diremos sobre los cuatro gr√°ficos m√°s √∫tiles en nuestra opini√≥n: <br><br><ul><li>  El gr√°fico <b>"Mensajes en cola" lo</b> ayuda a monitorear la acumulaci√≥n de datos en la cola.  Un crecimiento en el gr√°fico puede significar que los manejadores no est√°n administrando la carga o que el procesamiento se ha detenido. </li><li>  Gr√°fico <b>"Antig√ºedad del mensaje m√°s antiguo en la cola"</b> : los valores grandes indican problemas con el procesamiento del mensaje.  Si todo funciona correctamente, los mensajes no deber√≠an estar en la cola por mucho tiempo. </li><li>  El gr√°fico <b>"N√∫mero de intentos de leer un mensaje"</b> muestra cu√°ndo los mensajes comienzan a leerse varias veces.  Esto puede significar que los controladores se bloquean cuando reciben algunos mensajes. </li><li>  El gr√°fico <b>"Tiempo de</b> espera <b>"</b> indica cu√°nto tiempo transcurre desde el momento en que se env√≠a el mensaje a la cola hasta que el controlador lo recibe. </li></ul><br>  Los gr√°ficos ayudan a evaluar instant√°neamente la din√°mica de la cola y la presencia de fallas sin la necesidad de ver registros. <br><br>  Discutimos puntos m√°s o menos generales, ahora pasemos a los detalles. <br><br><h3>  C√≥mo Yandex Database Queue usa Yandex Database </h3><br>  El servicio Yandex Message Queue se basa en la base de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">datos Yandex Database (YDB)</a> tolerante a fallas geo-distribuida, que proporciona una consistencia estricta y soporte para transacciones ACID.  Ahora no desensamblaremos su dispositivo y caracter√≠sticas, nos limitaremos al esquema general. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uq/5m/o3/uq5mo3fm83hovqxkgt7no-yjevg.png" width="742" height="860"></div><br>  Una cola en YMQ consta de fragmentos l√≥gicos, representados por un conjunto fijo de tablas YDB.  Cada tabla almacena su propia informaci√≥n.  Por ejemplo, hay una tabla de estado general llamada State, que almacena offs y el n√∫mero real de mensajes.  Hay una tabla con datos y metadatos de mensajes.  Hay una tabla con atributos relacionados. <br><br>  Todas las operaciones principales con la cola (trabajar con mensajes, cambiar atributos, crear y eliminar) funcionan con la jerarqu√≠a de tablas y directorios YDB, o consultas transaccionales a una o m√°s tablas de la cola.  Los datos dentro de las tablas de la cola son la fuente de la verdad absoluta.  Por lo tanto, adem√°s del funcionamiento correcto y estable de la base de datos, es necesario garantizar un almacenamiento confiable y una alta disponibilidad de datos. <br><br>  Nuestra informaci√≥n se almacena en varias r√©plicas: una copia en cada uno de los tres centros de datos de Yandex.  Si uno de los centros de datos no est√° disponible, el n√∫mero de r√©plicas en los restantes se duplica.  Por lo tanto, se restablece el nivel de fiabilidad requerido.  Incluso si falla un centro de datos completo y una mesa de servicio en otra, los datos ser√°n completamente accesibles. <br><br><h3>  La primera versi√≥n de la arquitectura Yandex Message Queue </h3><br>  La primera versi√≥n de la arquitectura YMQ, que nosotros mismos llamamos ingenua, se ve√≠a as√≠. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/aj/qc/eu/ajqceuaoisynocw4u3ffek3epjo.png"></div><br>  El diagrama muestra la ruta de la solicitud HTTPS desde el cliente YMQ al repositorio YDB.  Veamos los componentes principales: <br><br><ol><li>  El equilibrador L3 env√≠a una solicitud al centro de datos Yandex m√°s cercano al usuario.  Esto reduce la latencia de la red, aunque la carga se distribuye de manera desigual. </li><li>  Nginx en la m√°quina virtual Yandex.Cloud termina las conexiones HTTPS, brinda protecci√≥n contra ataques a la red y env√≠a la solicitud al servidor YMQ, que ya est√° en HTTP. </li><li>  El servidor HTTP YMQ implementa la l√≥gica API SQS HTTP, valida y traduce la solicitud a un formato protobuf fuertemente tipado. </li><li>  Sistema de actor YMQ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sistema de actor</a> .  Simult√°neamente lanz√≥ miles de actores diferentes que intercambian informaci√≥n.  El sistema de actores de cada host forma parte de un cl√∫ster.  Todos los actores del grupo viven y act√∫an como un todo.  La l√≥gica de negocios de YMQ se implementa en varios actores involucrados en las solicitudes de transacciones a YDB. </li><li>  Tabletas YDB ("tabletas"): parte del n√∫cleo YDB, que es responsable de trabajar con tablas en consultas y transacciones.  Las tabletas en s√≠ no almacenan datos.  Estas son estructuras de control en la memoria que pueden restaurar el estado en caso de una falla de hardware. </li><li>  El almacenamiento es un almacenamiento confiable, distribuido y tolerante a fallas. </li></ol><br>  Esta arquitectura tiene un inconveniente: todos los servidores en el cl√∫ster trabajan independientemente con tablas de la misma cola.  Esto afecta negativamente el rendimiento y evita la organizaci√≥n de cach√©s confiables de mensajes ocultos y legibles.  Es dif√≠cil limitar el flujo de solicitudes, y esto es muy importante para cualquier servicio altamente cargado. <br><br><h3>  Arquitectura de Yandex Message Queue con maestros de cola </h3><br>  La activaci√≥n de carga mostr√≥ que la primera versi√≥n de la arquitectura soporta alrededor de 450 mensajes por segundo por cola con un fragmento.  Era muy peque√±o. <br>  El principal problema eran las consultas de contenci√≥n.  Una gran cantidad de transacciones l√≥gicamente conflictivas r√°pidamente llevaron a los cach√©s de mensajes ocultos a un estado inconsistente.  Para resolver el problema, presentamos una entidad especial: el maestro de colas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gc/b4/om/gcb4omkmhk28uhwe2hrlewhzsig.png"></div><br>  <b>Un maestro de cola</b> es un actor que, en condiciones normales, existe en un cl√∫ster en una sola instancia y pasa todas las solicitudes asociadas con una cola particular.  Si una solicitud a la cola llega a un servidor donde falta el maestro deseado, un actor proxy especial redirige la solicitud y luego traduce la respuesta recibida del maestro. <br><br>  Cuando se utiliza el Asistente de cola, la memoria cach√© correcta de los mensajes desbloqueados reduce la contenci√≥n al trabajar con tablas.  La implementaci√≥n de la restricci√≥n del flujo de solicitudes se simplifica, por ejemplo, a trav√©s del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dep√≥sito Leaky</a> .  Se encuentran disponibles m√©tricas de cola r√°pidas y precisas: n√∫mero de mensajes, tr√°fico total y similares.  Puede agrupar solicitudes similares. <br><br>  En teor√≠a, dicha arquitectura tiene ciertas desventajas asociadas con la centralizaci√≥n: <br><br><ol><li>  Reducci√≥n de la tolerancia a fallas: si falla una m√°quina virtual con un maestro, todas las colas con maestros no estar√°n disponibles.  Sin embargo, los mecanismos especiales de YDB le permiten crear nuevos maestros dentro del cl√∫ster en solo unos segundos.  Esto resuelve en gran medida el problema. </li><li>  Escalabilidad limitada: todas las solicitudes pasan por un host.  La desventaja son las tabletas YDB niveladas.  Hacen todo el trabajo duro con los datos.  Y el maestro env√≠a asincr√≥nicamente solicitudes y procesa los resultados recibidos.  Esto lo convierte en una entidad "ligera" que no crea un efecto de "cuello de botella" durante las pruebas de estr√©s. </li></ol><br><h3>  Asistente de consultas en cola </h3><br>  Las transacciones distribuidas con tablas de base de datos conducen a ciertos costos adicionales, por lo que la idea de reducir el n√∫mero de consultas nos pareci√≥ l√≥gica.  Cien transacciones para grabar mensajes de una en una es mejor convertirlas en una transacci√≥n para grabar cien mensajes a la vez.  Con los maestros de colas, implementar dicho procesamiento por lotes (lote) es mucho m√°s f√°cil. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yc/rn/0j/ycrn0j7obrbg0_cimvkyzj5izr4.png"></div><br>  El procesamiento por lotes aumenta ligeramente la latencia durante las operaciones.  En cambio, el ancho de banda aumenta significativamente.  Con el procesamiento por lotes, una cola de un solo fragmento puede procesar hasta 30,000 solicitudes por segundo. <br><br>  En general, la carga de la cola puede ser muy diferente: miles de mensajes por segundo y varios mensajes por d√≠a.  Necesit√°bamos optimizar el trabajo con colas usando un algoritmo flexible.                 .     YMQ   ,      .       . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qm/g2/rx/qmg2rx2e8pllaxuajav0gyxe2kg.png"></div><br>          : <br><br><ol><li>   ,       . </li><li>    ,        . </li><li>      ,     .     . </li></ol><br>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>  TCP/IP.    :      ,      latency .    ,        .               . <br><br><h3>        </h3><br>  Yandex Message Queue,      ,    .  ,  ,      -. <br><br>    YDB               .   YMQ     . <br><br>           ,   ,     ,      . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ol/yb/ay/olybayeljh8jcdbcmod9dpylopw.png" width="808" height="712"></div><br>  YMQ   .                    .   ¬´¬ª        . <br><br><h3>        </h3><br>  YDB           .    ,  ,     ,   ¬´¬ª.             ,       .          . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eg/em/eg/egemegamvnhmv-c5t8pw4im73u0.png" width="661" height="685"></div><br>   :              .    ,    ¬´¬ª      .  -,   ¬´¬ª  ,   ¬´¬ª,    . <br><br>     ¬´  ¬ª               .    ,  ,     . <br><br><h3>   Yandex Message Queue     </h3><br> Yandex Message Queue ‚Äì  - .      .       ,  .     . <br><br><ul><li> <b>-</b>    ,  ,   .      . </li><li> <b> </b>       API   ,    .  ,        . </li><li> <b> </b>  ,     :    ,           . ,       .          .     boto,    24/7,     -    . </li><li> <b> </b>    ,   ,         .        . </li></ul><br>        .       -         .   .       . <br><br>     : <br><br><ul><li>     5,       ; </li><li>    YDB; </li><li>  , , ,   ; </li><li>      ,    ; </li><li>    .       . </li></ul><br>                  . <br><br><h3>  En conclusi√≥n </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tarea de los equipos de infraestructura en Yandex es crear y mantener soluciones confiables, escalables y productivas, en base a las cuales se puedan lanzar nuevos productos de manera r√°pida y exitosa que mejoren la vida de los usuarios finales. </font><font style="vertical-align: inherit;">Dentro de la empresa, nuestro servicio de colas ha demostrado su utilidad y se ha convertido en parte de la arquitectura de Yandex.Video, Yandex.Market, Yandex.Education, Yandex.Taxi y otros servicios. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora est√° disponible en el ecosistema Yandex.Cloud y se puede usar para crear servicios dentro y fuera de la propia nube. </font><font style="vertical-align: inherit;">Ahora los nuevos usuarios en el registro reciben una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subvenci√≥n de dinero</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para familiarizarse, por lo que puede </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">probar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Yandex Message Queue de forma gratuita.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/455642/">https://habr.com/ru/post/455642/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455632/index.html">Atencion Error peligroso en la implementaci√≥n de C ++ std :: map :: merge y std :: set :: merge en Visual Studio 2017</a></li>
<li><a href="../455634/index.html">Matem√°ticas y el juego "Set"</a></li>
<li><a href="../455636/index.html">La primera ola afectada por la vulnerabilidad Exim. El guion para el tratamiento</a></li>
<li><a href="../455638/index.html">Alan Kay no invent√≥ objetos</a></li>
<li><a href="../455640/index.html">"La m√°quina de la emoci√≥n" de Marvin Minsky: Cap√≠tulo 4. "C√≥mo reconocemos la conciencia"</a></li>
<li><a href="../455644/index.html">Usamos datos en la pr√°ctica.</a></li>
<li><a href="../455646/index.html">Semana de la seguridad 24: puertas traseras de f√°brica en tel√©fonos inteligentes Android</a></li>
<li><a href="../455648/index.html">Life Cycle ML</a></li>
<li><a href="../455650/index.html">C√≥mo entrenamos una red neuronal para clasificar tornillos</a></li>
<li><a href="../455652/index.html">Aprendizaje profundo vs sentido com√∫n: desarrollar un bot de chat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>