<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï• üöà üòÆ D√©veloppement d'une banque d'alimentation pour ordinateur portable. De la mise en page au produit fini. Deuxi√®me partie üë∞üèæ ü§Ωüèª üôÖüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans la derni√®re partie de l'article sur le d√©veloppement de PowerBank pour un ordinateur portable, nous nous sommes install√©s sur une configuration f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement d'une banque d'alimentation pour ordinateur portable. De la mise en page au produit fini. Deuxi√®me partie</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/386899/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la derni√®re partie de l'article sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©veloppement de PowerBank pour un ordinateur portable,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous nous sommes install√©s sur une configuration fabriqu√©e, une efficacit√© mesur√©e et une compr√©hension de ce qu'il faut faire ensuite. </font><font style="vertical-align: inherit;">Et puis il a fallu faire revivre le morceau de fer. </font><font style="vertical-align: inherit;">Par cons√©quent, je pr√©sente √† votre attention la deuxi√®me partie: la mise en page du logiciel.</font></font><br>
<img src="https://habrastorage.org/files/368/fcc/f59/368fccf5979c4932a392b911139c892b.png"><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La rupture entre les pi√®ces s'est av√©r√©e assez importante - toutes les forces ont √©t√© exerc√©es sur le projet d'une batterie externe √† charge rapide, qui rassemble d√©sormais un soutien sur le </font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">boomstarter</font></a></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Nous allons continuer. </font><font style="vertical-align: inherit;">
Afin de comprendre quels microcircuits nous devrons programmer, nous allons regarder le sch√©ma de principe de la disposition. </font><font style="vertical-align: inherit;">
√Ä partir de l√†, il est clair que nous devrons √©crire un logiciel pour le contr√¥le MK (STM32F042), ainsi que configurer le syst√®me de contr√¥le de batterie Li-ion + chargeur (BQ40Z60). J'ai commenc√© par la seconde, car je consid√©rais cette partie comme la plus difficile. </font><font style="vertical-align: inherit;">
Pour programmer le contr√¥leur BQ40Z60, nous avons besoin de: </font><font style="vertical-align: inherit;">
 - L'adaptateur EV2400 et EV2300 ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">pr√™t √† l'</font></a><font style="vertical-align: inherit;"> emploi ou fait maison). J'ai quitt√© l'EV2300 de projets pass√©s, je l'ai donc utilis√©. </font><font style="vertical-align: inherit;">
 - Programme</font></font><b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<img src="https://habrastorage.org/files/87a/3e9/68e/87a3e968e1dc4112a6e96f5375e7b2f8.png"><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Battery Management Studio (bqStudio)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'adaptateur est connect√© via SMBus, pour la connexion j'ai laiss√© des points de soudure sur les lignes SMBD et SMBC. (Pas la solution la plus pratique - alors j'ai r√©alis√© que je devais installer le connecteur). </font></font><br>
<img src="https://habrastorage.org/files/90a/c7d/ddf/90ac7dddfa184d8498d418b786c853fa.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir dans√© avec un tambourin, le BQ40Z60 a opt√© pour Battery Management Studio. La raison en √©tait le mode veille dans lequel le contr√¥leur entre lorsqu'il n'y a pas de pull-up sur le bus SMBus et aucun acc√®s √† celui-ci. Il se r√©veille lors de la connexion de la m√©moire. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous allons r√©gler directement la puce BQ40Z60. Dire qu'il a de nombreux registres, c'est ne rien dire. Un million de r√©glages. La configuration √©tant un processus long et compliqu√© (un article s√©par√© est requis pour la description), je vais la d√©crire bri√®vement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s le d√©marrage, la fen√™tre principale de Battery Management Studio appara√Æt.</font></font><br>
<img src="https://habrastorage.org/files/8c5/bb5/610/8c5bb561090943eebcb578c4b6891727.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'onglet M√©moire de donn√©es contient un grand nombre de champs dans lesquels nous devons entrer les param√®tres de la batterie et les modes de fonctionnement du contr√¥leur. </font></font><br>
<img src="https://habrastorage.org/files/d9a/b9a/c2a/d9ab9ac2ac5140debab0ccb00a154b92.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'onglet Chimie, vous pouvez essayer de trouver des √©talonnages pr√™ts √† l'emploi pour les cellules utilis√©es. </font></font><br>
<img src="https://habrastorage.org/files/fad/140/d49/fad140d49cbd4e4d8837098da6af29f1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mon YOKU LP 5558115 3500mAh, il n'y avait pas d'√©talonnages pr√™ts √† l'emploi (au fait, les √©talonnages sont constamment </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">jour</font></a><font style="vertical-align: inherit;"> ). Trouv√© similaire YOKU LP 656193 4000mAh. Ayant r√©alis√© que je ne sais toujours rien des packages disponibles, j'ai choisi ce profil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, dans l'onglet M√©moire de donn√©es, j'ai configur√©: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calibration:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valeurs de calibration pour les voltm√®tres (cellules, batteries et un adaptateur externe), r√©sistance du capteur de courant, valeurs de calibration pour le capteur de temp√©rature. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©glages:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inclusion de protections, thermistances, LED, mode veille, configuration de la batterie. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protections:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©glage des seuils de protection (tension, temps, temp√©rature), r√©glage des seuils de tension de l'adaptateur externe. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âchec permanent:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©finition de seuils pour les erreurs irr√©versibles (de sorte que le fonctionnement de la batterie n'est pas possible). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algorithme de charge avanc√©:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©glage du chargeur (courants, tensions pour diff√©rentes plages de temp√©rature, signe de fin de charge, √©quilibrage). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gas Gauging:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©glage de l'unit√© pour d√©terminer le niveau de charge (capacit√© de la plaque signal√©tique / tension de la cellule, r√©sistance du fil, statistiques). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puissance:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©glage des modes de fonctionnement du contr√¥leur. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statut PF:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statut du bit d'√©tat d'√©chec permanent </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donn√©es syst√®me:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> champs pour les donn√©es du fabricant. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration SBS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©finition des seuils de d√©clenchement pour le d√©clencheur d'alarme, informations de base sur la batterie (num√©ro de s√©rie, date de production, fabricant, nom, composition chimique). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support LED:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©glage du mode du voyant LED. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Black Box:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bo√Æte noire (historique des modifications des bits d'√©tat de protection). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dur√©e de vie:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> statistiques de la batterie. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ra Table: un</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tableau des r√©sistances internes des cellules. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant le processus d'installation, je n'ai pas chang√© tous les champs, mais cela a suffi pour commencer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cette partie du circuit, il n'y avait qu'un seul montant mat√©riel connect√© √† la sortie du microcircuit 21-AFEFUSE. C'est arriv√© comme √ßa:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je d√©chirais le circuit de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carte de d√©bogage, √† l'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exception du microcircuit de protection secondaire et du fusible grill√©. Le BQ40Z60 poss√®de 21 broches AFEFUSE pour br√ªler un fusible (comme je le pensais). J'ai donc regard√© la 5√®me page de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fiche technique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">BQ40Z60.</font></a><font style="vertical-align: inherit;"> J'ai vu le </font></font><br>
<img src="https://habrastorage.org/files/f1c/964/667/f1c964667aa042cdae2a1d63122e9b67.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
type de sortie Output </font><font style="vertical-align: inherit;">dans le tableau </font><font style="vertical-align: inherit;">et, en toute conscience, </font><font style="vertical-align: inherit;">je l'ai </font><font style="vertical-align: inherit;">laiss√© suspendu dans les airs. Les probl√®mes sont survenus apr√®s avoir soud√© la carte: j'ai tri√© tous les param√®tres (et √† l'√©poque, il y avait beaucoup de doutes), mais cela n'a pas fonctionn√© - les transistors de charge et de d√©charge ne se sont pas allum√©s. Apr√®s 2 jours de doute / r√©flexion / essais et erreurs, j'ai remarqu√© que le bit FUSE_EN n'√©tait pas d√©fini et </font><font style="vertical-align: inherit;">j'ai </font><font style="vertical-align: inherit;">d√©cid√© de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´demander aux gens¬ª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et quand j'ai post√© une question, une id√©e m'est venue</font></font><br>
<img src="https://habrastorage.org/files/13b/a37/caf/13ba37caf5564b55896121eb247369e0.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En regardant le circuit imprim√© de la carte de d√©bogage, j'ai sugg√©r√© que la broche AFEFUSE peut √©galement √™tre une entr√©e, ce qui a √©t√© confirm√© par la section 9.3.2.4 p.24, qui dit que si la broche n'est pas utilis√©e, elle doit √™tre connect√©e √† la masse. Je l'ai fait avec des pincettes et √ßa a march√©. Apr√®s 5 minutes, ils m'ont r√©pondu sur e2e.com - la r√©ponse est claire et correcte, j'ai exprim√© mon "phi" sur l'erreur dans le tableau de sortie - ils ont promis de le corriger dans les futures versions de la documentation. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour mettre fin aux r√©glages du contr√¥leur, j'ai effectu√© 2 cycles d'entra√Ænement charge / d√©charge compl√®te + relaxation (au total 30 heures). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons maintenant √† la programmation du STM32F042. Au stade fictif, ce processeur ne demandait pas grand-chose: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Contr√¥ler le convertisseur de tension, traiter les boutons.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Aller le plus loin possible en veille pour ne pas d√©charger la batterie. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Lisez les principaux param√®tres de la batterie √† partir du contr√¥leur (tension, courant, niveau de charge, temp√©rature, √©tat actuel, nombre de cycles, temps de charge / d√©charge compl√®te) et envoyez-les au PC via USART (puisque le convertisseur CP2102 √©tait d√©j√† sur la carte). Bien que le processeur contienne USB √† bord, je ne l'ai pas utilis√© dans la mise en page, et une mise en page a √©t√© faite pour 051 MK, mais je n'ai pas pu l'acheter.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le contr√¥le du convertisseur a √©t√© r√©duit √† deux conclusions (allumage et mode de fonctionnement), alimentant le PWM (avec un filtrage RC ult√©rieur) √† la sortie du param√®tre de fr√©quence de conversion de la puce LTC3780 (en cons√©quence, r√©glez la fr√©quence √† un maximum de 400 kHz) et l'entr√©e de surveillance du signal PowerGood. Mais m√™me ici, j'ai r√©ussi √† monter sur le r√¢teau. Le bug flottait et s'est produit lorsque Power Bank s'est allong√© pendant une longue p√©riode, ce qui s'explique par le fait qu'il ne s'est tout simplement pas allum√©. Le probl√®me √©tait que j'avais d'abord activ√© l'interruption du signal PowerGood du LTC3780, puis allum√© la puce elle-m√™me (EN). Il s'est av√©r√© que l'interruption s'est d√©clench√©e avant m√™me le d√©marrage du convertisseur et l'a √©teint. R√©organis√© les √©v√©nements par endroits et ajout√© un retard - le probl√®me a disparu. Sinon, cette fonctionnalit√© √©tait facile.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a √©t√© d√©cid√© de cr√©er une interface utilisateur avec 1 bouton et 5 (6) LED (bien qu'il y ait 2 boutons et 10 LED sur le tableau de configuration). Il fonctionne comme suit: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appareil est √©teint -&gt; appui court (&lt;500 ms) - animation du niveau de charge sur 4 LED. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appareil est √©teint -&gt; appui long (&gt; 500 ms) - allumez l'appareil (la 5√®me LED s'allume). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appareil est √©teint -&gt; connexion de la m√©moire -&gt; animation du niveau de charge sur 4 LED jusqu'√† la fin du processus de charge. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appareil est allum√© -&gt; appui court - animation du niveau de charge sur 4 LED. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Appareil allum√© -&gt; appui long - √©teignez l'appareil. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Appareil √©teint -&gt; consommation de courant inf√©rieure √† 50 mA pendant plus de 3 min. - √©teignez l'appareil.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela a permis de supprimer 27 √©l√©ments de l'appareil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'avais d√©j√† l'exp√©rience de l'impl√©mentation des modes de veille sur STM32F0xx, donc je ne comptais pas sur un gros rake ici. Pour optimiser la consommation, j'ai d'abord remplac√© le LDO 3.3V par mcp1703 par un faible courant de ma propre consommation (il fallait ne pas arracher du d√©bogage, mais l'installer tout de suite). Taille, prix, consommation, kit carrosserie - tous moins que le LP2951. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci √† </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardegor d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avoir √©dit√© LDO pour Li-ion 4. Le Mcp1703 ne peut pas √™tre utilis√© en raison d'une faible tension d'entr√©e. J'ai utilis√© LiFePo4 pour la chimie - il n'y a pas un tel probl√®me. Faites attention!!!</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-Lorsque l'appareil est √©teint, le MK est en mode STANDBY et ne r√©pond qu'√† la pression d'un bouton ou √† la connexion de la m√©moire. La consommation dans ce mode est de 108 ŒºA (100 d'entre eux consomment du BQ40Z60). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Lorsque l'appareil est allum√©, le processeur la plupart du temps (√† l'exception des moments d'indication et d'interrogation du BQ40Z60) est en mode STOP avec une consommation de 1,5 mA (1 mA est une LED). Au moment de l'interrogation et de l'indication, la consommation de courant varie de 4,5 √† 9 mA. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Lorsqu'un USB MK est connect√© en mode RUN 48 MHz, la consommation est de 15 mA. √Ä l'avenir, je vais alimenter le MK dans ce mode √† partir de l'USB.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus gros probl√®me potentiel √©tait l'enqu√™te BQ40Z60. Je n'ai pas travaill√© avec SMBus et jusqu'√† ce que le dernier esp√®re que SMBus est I2C 1v1 (c'est en partie parce que le niveau physique est le m√™me pour eux), mais il s'est av√©r√© que le niveau du canal est tr√®s diff√©rent et cela a cr√©√© un certain nombre de difficult√©s. Ici, je ne d√©crirai pas les diff√©rences entre SMBus et I2C, mais je fournirai un lien vers un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plut√¥t comp√©tent </font><font style="vertical-align: inherit;">. Au stade de la mise en page, je ne me suis pas impliqu√© dans la lutte contre SMBus (en passant, en tant que programmeur, je suis beaucoup plus faible qu'un concepteur de circuits) et comme les commandes d'envoi et de r√©ception d'octets dans SMBus et I2C √©taient compl√®tement identiques, je les ai utilis√©es uniquement. En cons√©quence, j'ai lu SOC, SOH, Current, CellVolt, TimeToFull, TimeToEmpty de BQ40Z60. En fonction des valeurs des registres, le mode de fonctionnement a chang√© (des avertissements ont √©t√© √©mis, un arr√™t s'est produit).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, du c√¥t√© PC, bien s√ªr, un programme √©tait n√©cessaire pour afficher les donn√©es lues dans la batterie sous une forme pratique. Comme je ne pouvais utiliser les GUI que dans Borland C ++ Builder et que je l'ai fait pendant longtemps, j'ai demand√© au programmeur de dessiner un d√©bogage simple pour moi. Pour un fouet rapide, voici ce qui est sorti:</font></font><br>
<img src="https://habrastorage.org/files/62e/18d/c55/62e18dc550c04870a8d51acb5dda6691.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout le travail qui a √©t√© r√©alis√© lors de la mise en page. </font><font style="vertical-align: inherit;">Plus loin dans les plans (et puisque je d√©cris les op√©rations d√©j√† termin√©es, une partie du travail a d√©j√† √©t√© fait), le transfert des sp√©cifications techniques au concepteur pour le d√©veloppement / fabrication du package PowerBank, correction d'erreur / r√©vision du circuit, alt√©ration de la carte pour le bo√Ætier, r√©vision du logiciel. </font><font style="vertical-align: inherit;">Apr√®s cela, l'appareil sera similaire √† un produit et, une fois termin√©, deviendra un produit au sens litt√©ral du terme. </font><font style="vertical-align: inherit;">Dans les parties suivantes de l'article, nous examinerons les √©tapes et les principales difficult√©s de la transition d'une mise en page √† un produit fini, travaillerons sur l'emballage, consid√©rerons les co√ªts des diff√©rentes solutions et op√©rations, l'optimisation, et verrons √©galement le r√©sultat final.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr386899/">https://habr.com/ru/post/fr386899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr386883/index.html">Comment nous avons effac√© le bord de la r√©alit√©</a></li>
<li><a href="../fr386891/index.html">Le clavier UHK est encore meilleur et plus confortable: maintenant avec des modules en option et un repose-mains ergonomique</a></li>
<li><a href="../fr386893/index.html">Une nouvelle technologie de processus r√©duit le co√ªt du graph√®ne de 100 fois</a></li>
<li><a href="../fr386895/index.html">Pr√©-r√©alit√© - belle, s√©curit√© - rentable</a></li>
<li><a href="../fr386897/index.html">D√©sherber les mauvaises herbes? Rien de plus simple, chargez-le √† Bosch</a></li>
<li><a href="../fr386901/index.html">√ânergie naturelle</a></li>
<li><a href="../fr386903/index.html">Le cr√©ateur du robot Stormbuddy pour WOW bl√¢me Blizzard pour avoir vol√© le code source</a></li>
<li><a href="../fr386905/index.html">L'Australie interdit le stockage de fichiers pour l'impression 3D d'armes √† feu</a></li>
<li><a href="../fr386911/index.html">Sony Xperia Z5 critique</a></li>
<li><a href="../fr386915/index.html">La diff√©rence de temps de r√©veil entre les jours de la semaine et les week-ends est associ√©e √† des probl√®mes de sant√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>