<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèø üßíüèª üë©üèº‚Äçüè´ Implementando o padr√£o de design de comando no Unity ‚ùì üçµ ü§úüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voc√™ j√° se perguntou como em jogos como Super Meat Boy a fun√ß√£o de repeti√ß√£o √© implementada? Uma das maneiras de implement√°-lo √© executar a entrada da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementando o padr√£o de design de comando no Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463953/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fef/cfb/edf/fefcfbedf0b2e0711f2e831b0d069ebf.gif" alt="imagem"></div><br>  Voc√™ j√° se perguntou como em jogos como <i>Super Meat Boy</i> a fun√ß√£o de repeti√ß√£o √© implementada?  Uma das maneiras de implement√°-lo √© executar a entrada da mesma maneira que o reprodutor, o que, por sua vez, significa que a entrada precisa ser armazenada de alguma forma.  Voc√™ pode usar <em>o padr√£o de comando</em> para isso e muito mais. <br><br>  O modelo de comando tamb√©m √© √∫til para criar fun√ß√µes de desfazer e refazer em um jogo de estrat√©gia. <br><br>  Neste tutorial, implementamos o modelo de comando em C # e o usamos para guiar o caractere bot atrav√©s de um labirinto tridimensional.  No tutorial, voc√™ aprender√°: <br><br><ul><li>  Os princ√≠pios do padr√£o de comando. </li><li>  Como implementar o padr√£o de comando </li><li>  Como criar uma fila de comandos de entrada e atrasar sua execu√ß√£o. </li></ul><a name="habracut"></a><br><blockquote>  <em>Nota</em> : sup√µe-se que voc√™ j√° esteja familiarizado com o Unity e tenha um conhecimento m√©dio de C #.  Neste tutorial, trabalharemos com o <em>Unity 2019.1</em> e <em>C # 7</em> . </blockquote><br><h2>  Come√ßando a trabalhar </h2><br>  Para come√ßar, fa√ßa o download dos <a href="">materiais</a> do <a href="">projeto</a> .  Descompacte o arquivo e abra o projeto <em>Starter</em> no Unity. <br><br>  V√° para <em>RW / Scenes</em> e abra a cena <em>principal</em> .  A cena consiste em um bot e um labirinto, bem como uma interface de usu√°rio terminal que exibe instru√ß√µes.  O design do n√≠vel √© feito na forma de uma grade, o que √© √∫til quando movemos o bot visualmente pelo labirinto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53b/ab9/660/53bab9660bdd0a5017b570d43a57b2d9.png"></div><br>  Se voc√™ clicar em <em>Play</em> , veremos que as instru√ß√µes n√£o funcionam.  Isso √© normal porque adicionaremos essa funcionalidade ao tutorial. <br><br>  A parte mais interessante da cena √© o GameObject <em>Bot</em> .  Selecione-o na janela Hierarquia clicando nele. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/187/35e/acf/18735eacfd1f8df8920749ea80a12b8f.png"></div><br>  No Inspetor, voc√™ pode ver que ele possui um componente <em>Bot</em> .  Usaremos esse componente emitindo comandos de entrada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a5/2e3/2bc/2a52e32bc7feb6baafae6af958cc4910.png"></div><br><h2>  Entendemos a l√≥gica do bot </h2><br>  V√° para <em>RW / Scripts</em> e abra o script <em>Bot</em> no editor de c√≥digo.  Voc√™ n√£o precisa saber o que est√° acontecendo no script <em>Bot</em> .  Mas d√™ uma olhada em dois m√©todos: <code>Move</code> e <code>Shoot</code> .  Novamente, voc√™ n√£o precisa descobrir o que est√° acontecendo dentro desses m√©todos, mas precisa entender como us√°-los. <br><br>  Observe que o m√©todo <code>Move</code> recebe um par√¢metro de entrada <code>CardinalDirection</code> .  <code>CardinalDirection</code> √© uma enumera√ß√£o.  Um elemento de enumera√ß√£o do tipo <code>CardinalDirection</code> pode ser <code>Up</code> , <code>Down</code> , <code>Right</code> ou <code>Left</code> .  Dependendo da <code>CardinalDirection</code> selecionada <code>CardinalDirection</code> bot se move exatamente um quadrado ao longo da grade na dire√ß√£o correspondente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02c/72e/8ca/02c72e8ca19f987e6e36774558242058.png"></div><br>  O m√©todo <code>Shoot</code> for√ßa o bot a disparar conchas que destroem as <em>paredes amarelas</em> , mas s√£o in√∫teis contra outras paredes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b34/f18/2bb/b34f182bb9c0bb682606d0c5a1beb0fd.gif"></div><br>  Por fim, d√™ uma olhada no m√©todo <code>ResetToLastCheckpoint</code> ;  para entender o que ele est√° fazendo, olhe para o labirinto.  H√° pontos no labirinto chamado <em>ponto de verifica√ß√£o</em> .  Para passar pelo labirinto, o bot precisa chegar ao ponto de controle <em>verde</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4c/d3b/fc9/e4cd3bfc9d59944e28d9a22206141888.png"></div><br>  Quando um bot pisa em um novo ponto de controle, ele se torna o <em>√∫ltimo</em> para ele.  <code>ResetToLastCheckpoint</code> redefine a posi√ß√£o do bot, movendo-o para o √∫ltimo ponto de controle. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/829/617/95a/82961795afe53c9b45f1f8037896783c.gif"></div><br>  Embora n√£o possamos usar esses m√©todos, vamos corrigi-lo em breve.  Para come√ßar, voc√™ precisa aprender sobre o padr√£o de design do <em>Comando</em> . <br><br><h2>  O que √© o Command Design Pattern? </h2><br>  O padr√£o Command √© um dos 23 padr√µes de design descritos no livro <i>Design Patterns: Elements of Reusable Oriented Object Oriented,</i> escrito por Gang of Four por Erich Gamma, Richard Helm, Ralph Johnson e John Vlissides ( <em>GoF</em> , Gang of Four). <br><br>  Os autores relatam que "o padr√£o Command encapsula a solicita√ß√£o como um objeto, permitindo assim parametrizar outros objetos com solicita√ß√µes diferentes, solicita√ß√µes de fila ou log e oferecer suporte a opera√ß√µes revers√≠veis". <br><br>  Uau!  Como √© isso? <br><br>  Entendo que essa defini√ß√£o n√£o √© muito simples, ent√£o vamos analis√°-la. <br><br>  <em>Encapsulamento</em> significa que uma chamada de m√©todo pode ser encapsulada como um objeto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07d/5c3/214/07d5c32142de4fd36bd2cd73c543856a.png" width="50%" height="50%"></div><br>  O m√©todo encapsulado pode afetar muitos objetos, dependendo do par√¢metro de entrada.  Isso √© chamado de <em>parametriza√ß√£o de</em> outros objetos. <br><br>  O "comando" resultante pode ser salvo junto com outras equipes at√© que sejam executados.  Esta √© a <em>fila de</em> pedidos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/035/637/264/0356372640076e0829d2a427cf3552f1.png" width="50%" height="50%"></div><br>  <i>Fila de equipe</i> <br><br>  Finalmente, <em>reversibilidade</em> significa que as opera√ß√µes podem ser revertidas usando a fun√ß√£o Desfazer. <br><br>  OK, mas como isso se reflete no c√≥digo? <br><br>  A classe <em>Command</em> ter√° um m√©todo <em>Execute</em> , que recebe como par√¢metro de entrada o objeto (pelo qual o comando √© executado) chamado <em>Receiver</em> .  Na verdade, o m√©todo Execute √© <em>encapsulado</em> pela classe Command. <br><br>  Muitas inst√¢ncias da classe Command podem ser passadas como objetos comuns, ou seja, elas podem ser armazenadas em estruturas de dados como uma fila, pilha, etc. <br><br>  Para executar um comando, voc√™ deve chamar seu m√©todo Execute.  A classe que inicia a execu√ß√£o √© chamada <em>Invoker</em> . <br><br>  O projeto atualmente cont√©m uma classe vazia chamada <code>BotCommand</code> .  Na pr√≥xima se√ß√£o, implementaremos a implementa√ß√£o acima para permitir que o bot execute a√ß√µes usando o modelo de comando. <br><br><h2>  Mover o bot </h2><br><h3>  Implementa√ß√£o de padr√£o de comando </h3><br>  Nesta se√ß√£o, implementamos o padr√£o de comando.  Existem muitas maneiras de implement√°-lo.  Neste tutorial, abordaremos um deles. <br><br>  Para come√ßar, v√° para <em>RW / Scripts</em> e abra o script <em>BotCommand</em> no editor.  A classe <code>BotCommand</code> ainda <code>BotCommand</code> vazia, mas n√£o por muito tempo. <br><br>  Insira o seguinte c√≥digo na classe: <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//1 private readonly string commandName; //2 public BotCommand(ExecuteCallback executeMethod, string name) { Execute = executeMethod; commandName = name; } //3 public delegate void ExecuteCallback(Bot bot); //4 public ExecuteCallback Execute { get; private set; } //5 public override string ToString() { return commandName; }</span></span></code> </pre> <br>  O que est√° acontecendo aqui? <br><br><ol><li>  A vari√°vel <code>commandName</code> usada simplesmente para armazenar o nome do comando leg√≠vel por humanos.  N√£o √© necess√°rio us√°-lo no modelo, mas precisaremos posteriormente no tutorial. </li><li>  O construtor do <code>BotCommand</code> recebe uma fun√ß√£o e uma string.  Isso nos ajudar√° a configurar o m√©todo <code>Execute</code> do objeto Command e seu <code>name</code> . </li><li>  O representante <code>ExecuteCallback</code> define o tipo de m√©todo encapsulado.  O m√©todo encapsulado retornar√° nulo e aceitar√° como par√¢metro de entrada um objeto do tipo <code>Bot</code> (componente <em>Bot</em> ). </li><li>  A propriedade <code>Execute</code> far√° refer√™ncia ao m√©todo encapsulado.  Vamos us√°-lo para chamar o m√©todo encapsulado. </li><li>  O m√©todo <code>ToString</code> √© substitu√≠do para retornar a cadeia <code>commandName</code> .  Isso √© conveniente, por exemplo, para uso na interface do usu√°rio. </li></ol><br>  Salve as altera√ß√µes e pronto!  Implementamos com sucesso o padr√£o de comando. <br><br>  Resta us√°-lo. <br><br><h3>  Team building </h3><br>  Abra o <em>BotInputHandler</em> na pasta <em>RW / Scripts</em> . <br><br>  Aqui criaremos cinco inst√¢ncias do <code>BotCommand</code> .  Essas inst√¢ncias encapsular√£o m√©todos para mover o GameObject Bot para cima, para baixo, para a esquerda e para a direita, bem como para fotografar. <br><br>  Para implementar isso, insira o seguinte nesta classe: <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//1 private static readonly BotCommand MoveUp = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Up); }, "moveUp"); //2 private static readonly BotCommand MoveDown = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Down); }, "moveDown"); //3 private static readonly BotCommand MoveLeft = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Left); }, "moveLeft"); //4 private static readonly BotCommand MoveRight = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Right); }, "moveRight"); //5 private static readonly BotCommand Shoot = new BotCommand(delegate (Bot bot) { bot.Shoot(); }, "shoot");</span></span></code> </pre> <br>  Em cada uma dessas inst√¢ncias, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">um m√©todo an√¥nimo √©</a> passado para o construtor.  Este m√©todo an√¥nimo ser√° encapsulado dentro do objeto de comando correspondente.  Como voc√™ pode ver, a assinatura de cada um dos m√©todos an√¥nimos atende aos requisitos especificados pelo delegado <code>ExecuteCallback</code> . <br><br>  Al√©m disso, o segundo par√¢metro para o construtor √© uma sequ√™ncia que indica o nome do comando.  Este nome ser√° retornado pelo m√©todo <code>ToString</code> da inst√¢ncia do comando.  Mais tarde vamos aplic√°-lo √† interface do usu√°rio. <br><br>  Nas quatro primeiras inst√¢ncias, m√©todos an√¥nimos chamam o m√©todo <code>Move</code> no objeto <code>bot</code> .  No entanto, seus par√¢metros de entrada s√£o diferentes. <br><br>  Os <code>MoveUp</code> , <code>MoveDown</code> , <code>MoveLeft</code> e <code>MoveRight</code> passam os par√¢metros <code>Move</code> <code>CardinalDirection.Up</code> , <code>CardinalDirection.Down</code> , <code>CardinalDirection.Left</code> e <code>CardinalDirection.Right</code> .  Conforme mencionado na se√ß√£o <i>O que √© padr√£o de design de comando</i> , eles indicam dire√ß√µes diferentes para o GameObject Bot se mover. <br><br>  Na quinta inst√¢ncia, o m√©todo an√¥nimo chama o m√©todo <code>Shoot</code> para o objeto <code>bot</code> .  Gra√ßas a isso, o bot disparar√° um shell durante a execu√ß√£o do comando. <br><br>  Agora que criamos os comandos, precisamos acess√°-los de alguma forma quando o usu√°rio faz uma entrada. <br><br>  Para fazer isso, <code>BotInputHandler</code> seguinte c√≥digo no <code>BotInputHandler</code> , imediatamente ap√≥s as inst√¢ncias de comando: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BotCommand </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.W)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveUp; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.S)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveDown; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.D)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveRight; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.A)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveLeft; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.F)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Shoot; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  O m√©todo <code>HandleInput</code> retorna uma inst√¢ncia do comando, dependendo da tecla pressionada pelo usu√°rio.  Salve suas altera√ß√µes antes de prosseguir. <br><br><h3>  Aplicando comandos </h3><br>  √ìtimo, agora √© hora de usar as equipes que criamos.  V√° para <em>RW / Scripts</em> novamente e abra o script <em>SceneManager</em> no editor.  Nesta classe, voc√™ notar√° um link para uma vari√°vel <code>uiManager</code> do tipo <code>UIManager</code> . <br><br>  A classe <code>UIManager</code> fornece m√©todos auxiliares √∫teis para a <em>interface do usu√°rio</em> do <em>terminal</em> que usamos nesta cena.  Se o m√©todo do <code>UIManager</code> for usado, o tutorial explicar√° o que ele faz, mas, em geral, para nossos prop√≥sitos, n√£o √© necess√°rio conhecer sua estrutura interna. <br><br>  Al√©m disso, a vari√°vel <code>bot</code> refere-se ao componente bot anexado ao GameObject <em>Bot</em> . <br><br>  Agora adicione o seguinte c√≥digo √† classe <code>SceneManager</code> , substituindo-o pelo coment√°rio <code>//1</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//1 private List&lt;BotCommand&gt; botCommands = new List&lt;BotCommand&gt;(); private Coroutine executeRoutine; //2 private void Update() { if (Input.GetKeyDown(KeyCode.Return)) { ExecuteCommands(); } else { CheckForBotCommands(); } } //3 private void CheckForBotCommands() { var botCommand = BotInputHandler.HandleInput(); if (botCommand != null &amp;&amp; executeRoutine == null) { AddToCommands(botCommand); } } //4 private void AddToCommands(BotCommand botCommand) { botCommands.Add(botCommand); //5 uiManager.InsertNewText(botCommand.ToString()); } //6 private void ExecuteCommands() { if (executeRoutine != null) { return; } executeRoutine = StartCoroutine(ExecuteCommandsRoutine()); } private IEnumerator ExecuteCommandsRoutine() { Debug.Log("Executing..."); //7 uiManager.ResetScrollToTop(); //8 for (int i = 0, count = botCommands.Count; i &lt; count; i++) { var command = botCommands[i]; command.Execute(bot); //9 uiManager.RemoveFirstTextLine(); yield return new WaitForSeconds(CommandPauseTime); } //10 botCommands.Clear(); bot.ResetToLastCheckpoint(); executeRoutine = null; }</span></span></code> </pre> <br>  Uau, quanto c√≥digo!  Mas n√£o se preocupe;  finalmente estamos prontos para o primeiro lan√ßamento real do projeto na janela do jogo. <br><br>  Vou explicar o c√≥digo mais tarde.  Lembre-se de salvar as altera√ß√µes. <br><br><h3>  Executando o jogo para testar o modelo de comando </h3><br>  Ent√£o agora √© a hora de construir;  Clique em <em>Play</em> no editor do Unity. <br><br>  Voc√™ deve poder inserir comandos de movimenta√ß√£o usando <em>as teclas WASD</em> .  Para inserir o comando de disparo, pressione a tecla <em>F.</em>  Para executar comandos, pressione <em>Enter</em> . <br><br><blockquote>  <em>Nota</em> : at√© que o processo de execu√ß√£o seja conclu√≠do, n√£o √© poss√≠vel inserir novos comandos. </blockquote><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20b/ef8/483/20bef8483dd70829836bd9234178f5dd.gif"></div><br>  Observe que as linhas s√£o adicionadas √† interface do usu√°rio do terminal.  As equipes na interface do usu√°rio s√£o indicadas por seus nomes.  Isso √© poss√≠vel gra√ßas √† vari√°vel <code>commandName</code> . <br><br>  Observe tamb√©m como a interface do usu√°rio rola antes da execu√ß√£o e como as linhas s√£o exclu√≠das durante a execu√ß√£o. <br><br><h3>  Estudamos as equipes mais de perto </h3><br>  √â hora de aprender o c√≥digo que adicionamos na se√ß√£o "Aplicando comandos": <br><br><ol><li>  A lista <code>botCommands</code> armazena links para inst√¢ncias do <code>BotCommand</code> .  Lembre-se de que, para economizar mem√≥ria, podemos criar apenas cinco inst√¢ncias de comandos, mas pode haver v√°rias refer√™ncias a um comando.  Al√©m disso, a vari√°vel <code>executeCoroutine</code> refere-se a <code>ExecuteCommandsRoutine</code> , que controla a execu√ß√£o do comando. </li><li>  <code>Update</code> verifica se o usu√°rio pressionou a tecla Enter;  <code>ExecuteCommands</code> caso, chama <code>ExecuteCommands</code> , caso contr√°rio, <code>CheckForBotCommands</code> √© <code>CheckForBotCommands</code> . </li><li>  <code>CheckForBotCommands</code> usa o m√©todo est√°tico <code>HandleInput</code> do <code>BotInputHandler</code> para verificar se o usu√°rio concluiu a entrada e, em caso afirmativo, o comando √© <em>retornado</em> .  O comando retornado √© passado para <code>AddToCommands</code> .  No entanto, se os comandos forem executados, ou seja,  se <code>executeRoutine</code> n√£o <code>executeRoutine</code> nulo, ele retornar√° sem passar nada para <code>AddToCommands</code> .  Ou seja, o usu√°rio precisa esperar at√© a conclus√£o. </li><li>  <code>AddToCommands</code> adiciona um novo link √† inst√¢ncia <em>retornada</em> do comando em <code>botCommands</code> . </li><li>  O m√©todo <code>InsertNewText</code> classe <code>InsertNewText</code> adiciona uma nova linha de texto √† interface do usu√°rio do terminal.  Uma sequ√™ncia de texto √© uma sequ√™ncia passada como um par√¢metro de entrada.  Nesse caso, passamos commandName para <code>commandName</code> . </li><li>  O m√©todo <code>ExecuteCommandsRoutine</code> inicia <code>ExecuteCommandsRoutine</code> . </li><li>  <code>ResetScrollToTop</code> no <code>UIManager</code> rola a interface do usu√°rio do terminal para cima.  Isso √© feito imediatamente antes do in√≠cio da execu√ß√£o. </li><li>  <code>ExecuteCommandsRoutine</code> cont√©m um loop <code>for</code> que itera sobre os comandos dentro da lista <code>botCommands</code> e os executa um por um, passando o objeto <code>bot</code> para o m√©todo retornado pela propriedade <code>Execute</code> .  Ap√≥s cada execu√ß√£o, uma pausa √© adicionada em segundos de <code>CommandPauseTime</code> . </li><li>  O m√©todo <code>RemoveFirstTextLine</code> do <code>UIManager</code> exclui a primeira linha de texto na interface do usu√°rio do terminal, se existir.  Ou seja, quando um comando √© executado, seu nome √© removido da interface do usu√°rio. </li><li>  Depois que todos os comandos s√£o <code>botCommands</code> √© limpo e o bot √© redefinido para o √∫ltimo ponto de interrup√ß√£o usando <code>ResetToLastCheckpoint</code> .  No final, <code>executeRoutine</code> <code>null</code> e o usu√°rio pode continuar a digitar comandos. </li></ol><br><h2>  Implementando os recursos Desfazer e Refazer </h2><br>  Execute a cena novamente e tente chegar ao ponto de controle verde. <br><br>  Voc√™ notar√° que, embora n√£o possamos cancelar o comando digitado.  Isso significa que, se voc√™ cometer um erro, n√£o poder√° voltar antes de concluir todos os comandos inseridos.  Voc√™ pode corrigir isso adicionando os recursos <em>Desfazer</em> e <em>Refazer</em> . <br><br>  Volte ao <em>SceneManager.cs</em> e adicione a seguinte declara√ß√£o de vari√°vel imediatamente ap√≥s a declara√ß√£o <i>List</i> para <code>botCommands</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Stack&lt;BotCommand&gt; undoStack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stack&lt;BotCommand&gt;();</code> </pre> <br>  A vari√°vel <code>undoStack</code> √© uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">pilha</a> (da fam√≠lia Cole√ß√µes) que armazenar√° todas as refer√™ncias a comandos que podem ser desfeitos. <br><br>  Agora, adicionamos dois m√©todos <code>UndoCommandEntry</code> e <code>RedoCommandEntry</code> que executar√£o Desfazer e Refazer.  Na classe <code>SceneManager</code> , <code>SceneManager</code> seguinte c√≥digo ap√≥s <code>ExecuteCommandsRoutine</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UndoCommandEntry</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//1 if (executeRoutine != null || botCommands.Count == 0) { return; } undoStack.Push(botCommands[botCommands.Count - 1]); botCommands.RemoveAt(botCommands.Count - 1); //2 uiManager.RemoveLastTextLine(); } private void RedoCommandEntry() { //3 if (undoStack.Count == 0) { return; } var botCommand = undoStack.Pop(); AddToCommands(botCommand); }</span></span></code> </pre> <br>  Vamos analisar o c√≥digo: <br><br><ol><li>  Se os comandos forem executados ou a lista <code>botCommands</code> vazia, o m√©todo <code>UndoCommandEntry</code> nada.  Caso contr√°rio, ele grava um link para o √∫ltimo comando digitado na pilha <code>undoStack</code> .  Isso tamb√©m remove o link para o comando da lista <code>botCommands</code> . </li><li>  O m√©todo <code>RemoveLastTextLine</code> do <code>UIManager</code> remove a √∫ltima linha de texto da interface do usu√°rio do terminal para que ela corresponda ao conte√∫do de <code>botCommands</code> . </li><li>  Se a pilha <code>undoStack</code> vazia, o <code>RedoCommandEntry</code> n√£o <code>RedoCommandEntry</code> nada.  Caso contr√°rio, ele extrai o √∫ltimo comando da parte superior do <code>undoStack</code> e o adiciona de volta √† lista <code>AddToCommands</code> usando <code>AddToCommands</code> . </li></ol><br>  Agora vamos adicionar a entrada do teclado para usar essas fun√ß√µes.  Dentro da classe <code>SceneManager</code> substitua o corpo <code>Update</code> m√©todo <code>Update</code> pelo seguinte c√≥digo: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.Return)) { ExecuteCommands(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.U)) <span class="hljs-comment"><span class="hljs-comment">//1 { UndoCommandEntry(); } else if (Input.GetKeyDown(KeyCode.R)) //2 { RedoCommandEntry(); } else { CheckForBotCommands(); }</span></span></code> </pre> <br><ol><li>  Quando voc√™ pressiona a tecla <em>U</em> , o m√©todo <code>UndoCommandEntry</code> √© <code>UndoCommandEntry</code> . </li><li>  Quando voc√™ pressiona a tecla <em>R</em> , o m√©todo <code>RedoCommandEntry</code> √© <code>RedoCommandEntry</code> . </li></ol><br><h3>  Manuseio de Caixas de Borda </h3><br>  √ìtimo, estamos quase terminando!  Mas primeiro, precisamos fazer o seguinte: <br><br><ol><li>  Ao inserir um novo comando, a pilha <code>undoStack</code> deve ser limpa. </li><li>  Antes de executar comandos, a pilha <code>undoStack</code> deve ser limpa. </li></ol><br>  Para implementar isso, primeiro precisamos adicionar um novo m√©todo ao <code>SceneManager</code> .  Insira o seguinte m√©todo ap√≥s <code>CheckForBotCommands</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddNewCommand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BotCommand botCommand</span></span></span><span class="hljs-function">)</span></span> { undoStack.Clear(); AddToCommands(botCommand); }</code> </pre> <br>  Este m√©todo limpa <code>undoStack</code> e chama o m√©todo <code>AddToCommands</code> . <br><br>  Agora substitua a chamada para <code>AddToCommands</code> dentro de <code>CheckForBotCommands</code> pelo seguinte c√≥digo: <br><br><pre> <code class="cs hljs"> AddNewCommand(botCommand);</code> </pre> <br>  Em seguida, insira a seguinte linha ap√≥s a <code>if</code> no m√©todo <code>ExecuteCommands</code> para limpar antes de executar os comandos <code>undoStack</code> : <br><br><pre> <code class="cs hljs"> undoStack.Clear();</code> </pre> <br>  E finalmente terminamos! <br><br>  Salve seu trabalho.  Crie o projeto e clique no editor <em>Play</em> .  Digite os comandos como antes.  Pressione <em>U</em> para cancelar os comandos.  Pressione <em>R</em> para repetir os comandos cancelados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fef/cfb/edf/fefcfbedf0b2e0711f2e831b0d069ebf.gif" width="1024" height="576"></div><br>  Tente chegar ao ponto de verifica√ß√£o verde. <br><br><h2>  Para onde ir a seguir? </h2><br>  Para saber mais sobre os padr√µes de design usados ‚Äã‚Äãna programa√ß√£o de jogos, recomendo que voc√™ estude os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">Padr√µes de programa√ß√£o de jogos de</a> Robert Nystrom. <br><br>  Para saber mais sobre t√©cnicas avan√ßadas de C #, fa√ßa o curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="noopener">C # Collections, Lambdas e LINQ</a> . <br><br><h3>  Tarefa </h3><br>  Como tarefa, tente chegar ao ponto de controle verde no final do labirinto.  Eu escondi uma das solu√ß√µes embaixo do spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Solu√ß√£o</b> <div class="spoiler_text"><ul><li>  moveUp √ó 2 </li><li>  moveRight √ó 3 </li><li>  moveUp √ó 2 </li><li>  moveLeft </li><li>  atirar </li><li>  moveLeft √ó 2 </li><li>  moveUp √ó 2 </li><li>  moveLeft √ó 2 </li><li>  moveDown √ó 5 </li><li>  moveLeft </li><li>  atirar </li><li>  moveLeft </li><li>  moveUp √ó 3 </li><li>  atirar √ó 2 </li><li>  moveUp √ó 5 </li><li>  moveRight √ó 3 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dab/f9e/05f/dabf9e05f3cb79ab20a6a663108295fe.png"></div></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463953/">https://habr.com/ru/post/pt463953/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463933/index.html">Um script Python de 20 linhas que deseja aos pais bom dia todos os dias atrav√©s do WhatsApp</a></li>
<li><a href="../pt463937/index.html">N√£o tenho nada a esconder</a></li>
<li><a href="../pt463939/index.html">SimbirSoft lan√ßou uma solu√ß√£o m√≥vel para companhias de seguros</a></li>
<li><a href="../pt463943/index.html">As desventuras do unic√≥rnio preto</a></li>
<li><a href="../pt463951/index.html">c.tech: Cassandra Meetup # 2</a></li>
<li><a href="../pt463955/index.html">Como desenvolver um conceito para alterar a plataforma IP? Instru√ß√µes de uso</a></li>
<li><a href="../pt463957/index.html">Como implantar uma lista de entrevistas vinculada individualmente</a></li>
<li><a href="../pt463961/index.html">Pr√≥prio mapeador ou um pouco sobre ExpressionTrees</a></li>
<li><a href="../pt463963/index.html">Reconhecimento facial em um canteiro de obras</a></li>
<li><a href="../pt463965/index.html">Aplica√ß√£o tipogr√°fica no LaTeX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>