<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëãüèø üßëüèº‚Äçü§ù‚Äçüßëüèª üëßüèæ Kontinuierliche Integration in Unity: Verk√ºrzung der Montagezeit und Einsparung von Ressourcen + Gewinnlinie als Geschenk üñ≤Ô∏è üéπ ‚¨úÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits, ich stehe in Kontakt mit Alexander Panov, einem technischen Experten von Pixonic. In der Firma bin ich f√ºr projekt√ºbergreifende L√∂su...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kontinuierliche Integration in Unity: Verk√ºrzung der Montagezeit und Einsparung von Ressourcen + Gewinnlinie als Geschenk</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/484172/"><img src="https://habrastorage.org/webt/gu/jv/tz/gujvtzrponhszxkg1z_lmobwdt8.png"><br><br>  Hallo allerseits, ich stehe in Kontakt mit Alexander Panov, einem technischen Experten von Pixonic.  In der Firma bin ich f√ºr projekt√ºbergreifende L√∂sungen und projektnahe Peripherieger√§te verantwortlich und m√∂chte heute meine Erfahrungen und Best Practices teilen. <br><br>  Plattformen der kontinuierlichen Weiterentwicklung und Integration oder CI / CD werden mittlerweile √ºberall dort eingesetzt, wo iterative und gut funktionierende technische Prozesse eine entscheidende Rolle spielen.  In diesem Artikel werden wir uns mit CI / CD f√ºr die Implementierung unserer Unity-Projekte f√ºr die Entwicklung mobiler Spiele befassen: Welche Probleme sind aufgetreten, wie haben wir sie gel√∂st, welche Verbesserungen haben wir erzielt und wie werden unsere Pipeline-Assembly-Builds registriert? <br><br>  Stimmen Sie sofort zu, dass wir TeamCity von <a href="https://habr.com/ru/company/JetBrains/">JetBrains</a> als CI-Server, GitHub als Repository f√ºr Git-Repositorys und Nexus zum Speichern von Assembly-Artefakten verwenden. <br><a name="habracut"></a><br>  Wir standen also vor folgenden Problemen: <br><br><ul><li>  <i>Fehlen eines gemeinsamen Standards f√ºr die Erstellung von Assemblys:</i> Praktisch alle Entwickler hatten Zugriff auf den TeamCity-Server, wodurch Assemblyskripte in verschiedenen Programmiersprachen (BASH, PowerShell, Python) geschrieben und die Logik h√§ufig dupliziert wurden. </li><li>  <i>Schwache Flotte:</i> Aufgrund der Tatsache, dass wir Builds f√ºr iOS erstellen m√ºssen, mussten wir eine Flotte von Autos von Mac mini verwenden.  Und da in Unity fast die gesamte Baugruppe in einem Thread abl√§uft, stellte sich die Parallelisierung von Baugruppen auf einer Maschine als problematisch heraus. </li><li>  <i>Ein wenig √ºberarbeitete Betriebseffizienz:</i> Aufgrund der geringen Produktivit√§t unseres technischen Supports dauerte die Montage sehr lange. </li><li>  <i>Gro√üe Warteschlangen, die</i> mit einer ausreichenden Anzahl von TeamCity-Agenten <i>auf den Zusammenbau warten</i> ; </li><li>  <i>F√ºr jedes Projekt einen eigenen Agentenpool:</i> Aufgrund der unterschiedlichen auf den Ger√§ten installierten Umgebung sowie der zwischen den Projekten widerspr√ºchlichen Konfigurationsdateien (Cache-Server-Konfigurationsdateien usw.) war es nicht m√∂glich, einen gemeinsamen Pool zu organisieren. </li></ul><br><h2>  Was hast du als Ergebnis gemacht? </h2><br><ul><li>  <b>Repository f√ºr Assemblerskripte</b> </li></ul><br>  Zun√§chst haben wir ein einzelnes Repository mit Skripten f√ºr Assemblys in Python erstellt.  Der Start erfolgt in der Pipenv-Verwaltungsumgebung f√ºr virtuelle Umgebungen, wobei Bibliotheken von Drittanbietern auf dem Server f√ºr eine schnelle Aktualisierung und Versionskontrolle der erforderlichen Bibliotheken √ºbertragen werden.  Daher haben wir einen einzigen Einstiegspunkt f√ºr Baugruppen aller vorhandenen Projekte bereitgestellt.  Wir haben alle Skripte in Python neu geschrieben, die Konfigurationen vereinheitlicht, zu einem gemeinsamen Standard gef√ºhrt und Duplikate des Codes entfernt. <br><br><ul><li>  <b>Neue Flotte von Autos</b> </li></ul><br>  Es war notwendig, die Montagezeit zu verk√ºrzen und m√∂glicherweise die Anzahl der verwendeten Ger√§te zu verringern. <br><br>  Anfangs hatten wir eine Farm mit 13 Mac-Minicomputern, aber diese L√∂sung ist alles andere als optimal: Aufgrund der Besonderheiten von Assemblys in Unity werden etwa 80% der Montagezeit in nur einem Thread ausgef√ºhrt.  Hinzu kommt ein solider Schreibzugriff auf die Festplatte, und wir erhalten, dass ein Mac mini mit 1-2 gleichzeitigen Assemblys kaum zurechtkommt. <br><br>  Das Ergebnis ist die Notwendigkeit, die Hardware zu √ºberpr√ºfen. <br><br>  Bei der Suche und dem Vergleich von Alternativen f√ºr Unity-Baugruppen haben wir festgestellt, dass AMD Ryzen-basierte Computer aufgrund ihrer Leistung die gleichzeitige Montage von bis zu 8-12 Baugruppen ohne nennenswerten Leistungsverlust erm√∂glichen. In diesem Zusammenhang wurde beschlossen, vier solcher Ger√§te mit sechs SSDs zu erwerben und zu installieren zwei Agenten pro Festplatte. <br><br>  Ein Vergleich, wie es war und was wurde, ist in der Tabelle angegeben. <br><br><img src="https://habrastorage.org/webt/zt/u2/sf/ztu2sfkhfk_xhz3v2tke-upw8eu.png"><br><br>  Durchschnittliche Bauzeit: <br><br><img src="https://habrastorage.org/webt/x5/x0/5t/x5x05txnepni2gtkygvorspm_le.png"><br><br>  Dar√ºber hinaus organisierten wir die Priorisierung der Auswahl der TeamCity-Agenten, um den Zeitaufwand f√ºr die Montage in der Warteschlange zu verringern.  Bisher verf√ºgte jedes unserer Projekte √ºber einen eigenen Agentenpool, und aufgrund der Vielzahl von Plattformen in den Spielen war es in der projektabh√§ngigen Umgebung nicht m√∂glich, einen gemeinsamen Pool zu erstellen.  Nach der Neuorganisation des Systems haben wir eine Reihe von Agenten f√ºr die Projekte √ºbrig gelassen, die f√ºr automatische Assemblierungen verwendet werden. Sie konnten jedoch mehrere gemeinsame Agenten f√ºr alle Projekte hinzuf√ºgen: Sie werden in die Arbeit aufgenommen, wenn alle mit dem gew√ºnschten Projekt verkn√ºpften Agenten besch√§ftigt sind. <br><br><ul><li>  <b>BuildPipeline-Bibliothek f√ºr Unity</b> </li></ul><br>  Sie haben eine kleine Bibliothek f√ºr Unity gestartet, mit der Build-Builds in einem separaten Unity-Editorfenster festgelegt und Build-Builds im Batch-Modus ausgef√ºhrt werden k√∂nnen.  Von der Hauptfunktionalit√§t der Bibliothek: Sie k√∂nnen vor dem Zusammenbau Definitionen hinzuf√ºgen und entfernen, Bibliotheken von Drittanbietern oder bestimmte Dateien deaktivieren, benutzerdefinierte Vor- und Nachbearbeitungsschritte hinzuf√ºgen, alle Einstellungen in Konfigurationsdateien speichern und die M√∂glichkeit ihrer Vererbung nutzen. <br><br><img src="https://habrastorage.org/webt/87/qc/kv/87qckvdpssyfxuexcy7dirr9zw0.png"><br>  <i>Das Definitionsfenster in der BuildPipeline-Bibliothek</i> <br><br><h2>  Unsere aktuelle Pipeline CI / CD </h2><br>  <b>PullRequest-Assembly.</b>  F√ºr jedes Commit: <br><br><ol><li>  Starten von Unity, um nach Kompilierungsfehlern zu suchen, Updates zu definieren und L√∂sungen zu generieren. </li><li>  laufende Tests; </li><li>  Start eines statischen Analysators: Mit seiner Hilfe wird eine inkrementelle Analyse f√ºr Dateien durchgef√ºhrt, die vom aktuellen PullRequest betroffen sind. </li><li>  Eine Nachricht √ºber das √úberpr√ºfungsergebnis, die auf GitHub gespeichert wird. </li></ol><br>  <b>Schritte zum Erstellen eines Unity-Projekts:</b> <br><br>  1. Installieren von Pipenv und Ausf√ºhren von Skripten zum Erstellen in Python: Aktualisieren und Installieren von Python-Bibliotheken von Drittanbietern von unserem Server (Proxy des <a href="https://pypi.org/">pypi.org-</a> Repositorys) und Ausf√ºhren des Erstellungsskripts. <br><br>  2. Vorbereitungen f√ºr die Versammlung der Einheit: <br><br><ul><li>  L√∂schen des Bibliotheksordners, der Bundles, ausgew√§hlter Assets (nach Maske und / oder bestimmten Dateien), L√∂schen von L√∂sungen (SLN-Dateien) - falls erforderlich; </li><li>  Generieren einer Baugruppeninformationsdatei: Filialname, Baugruppennummer usw.  - zur weiteren Verwendung im Build zum Debuggen und Testen; </li><li>  Einrichten eines Unity-Cache-Servers f√ºr ein Projekt.  Jedes Projekt hat sein eigenes.  Jeder Entwickler hat auch einen Cache-Server eingerichtet, um das F√ºllen zu beschleunigen: Wenn ein Entwickler ein neues Asset hinzuf√ºgt, wird es automatisch auf dem Cache-Server und auf dem Build-Server angezeigt, sodass der Import von Assets viel schneller erfolgt. </li></ul><br>  3. F√ºhren Sie Unity aus, um nach Kompilierungsfehlern zu suchen, Definitionen zu aktualisieren und L√∂sungen zu generieren. <br><br>  4. F√ºhren Sie die Tests aus und beenden Sie sie, falls erforderlich, falls Fehler auftreten. <br><br>  5. Starten Sie Unity BuildPipeline mit der erforderlichen Konfiguration und zus√§tzlichen Projektparametern. <br><br>  6. F√ºr Android / iOS-Builds - Gradle / Xcode starten: <br><br><ul><li>  Gradle - GradleWrapper; </li><li>  Xcode - Archivieren Sie das nach Unity erhaltene XcodeProject und kopieren Sie es auf den Mac mini.  Installieren und aktualisieren Sie alle erforderlichen Zertifikate und Bereitstellungsprofildateien separat.  F√ºhren Sie die Befehle Bereinigen, Archivieren, Exportieren aus. </li><li>  Beim Export ist es m√∂glich, die Signatur des Builds, des Entwicklers und des AppStore zu trennen.  W√§hlen Sie je nach dem, was wir sammeln, die gew√ºnschte Pliste oder jede einzelne nacheinander aus.  Am Ausgang erhalten wir zwei Dateien: Developer und Release - zur Installation auf Testger√§ten bzw. zum Hochladen in den AppStore. </li></ul><br>  7. Gie√üen gesammelter Builds und zugeh√∂riger Dateien (Protokolle, Testergebnisse, .obb, Manifest zum Installieren von iOS-Anwendungen, dsym-Dateien usw.) in den Artefaktspeicher f√ºr eigenst√§ndige Assemblys - Hochladen des gesammelten Builds in den Archivspeicher. <br><br>  8. Erstellen einer Seite mit einem QR-Code zum Installieren des Builds, Hinzuf√ºgen von Links aus dem Repository und Erstellen von Informationen zur Datenbank f√ºr die weitere Arbeit mit der PixLauncher-Anwendung - wir werden sp√§ter darauf zur√ºckkommen. <br><br>  9. Mitteilung an Slack √ºber das Ergebnis der Versammlung: an denjenigen, der die Versammlung gestartet hat, sowie an die erforderlichen Kan√§le. <br><br><img src="https://habrastorage.org/webt/dd/uu/ap/dduuapzv8vkhqbirksspxw8eqra.png"><br>  <i>Solche Botschaften kommen zu Slack</i> <br><br><h2>  Weitere Schritte </h2><br>  Als letzter Schritt des Plans werden die gesammelten Builds an Ger√§te zum weiteren Testen und Hochladen in den Store verteilt. <br><br>  Um Builds auf Ger√§ten zu installieren, haben wir eine kleine Anwendung f√ºr Android und iOS geschrieben - PixLauncher.  Wir installieren es auf jedem Ger√§t, auf dem es m√∂glich ist, einen Build von TeamCity auszuw√§hlen.  Der Einfachheit halber k√∂nnen Sie darin Filter festlegen, z. B. eine Konfiguration zu Ihren Favoriten hinzuf√ºgen und dann mit einem Klick Aktionen ausf√ºhren.  Bei Builds f√ºr Android wird bei Bedarf die Datei in OBB-Aufl√∂sung automatisch heruntergeladen. <br><br>  Dar√ºber hinaus haben wir die M√∂glichkeit der Installation des Builds √ºber Push-Benachrichtigungen organisiert: Wir haben dem TeamCity-Server ein selbst geschriebenes Plug-In hinzugef√ºgt, mit dem wir die MAC-Adressen der mit dem lokalen Netzwerk verbundenen Ger√§te auf der Build-Seite ausw√§hlen k√∂nnen.  Anschlie√üend wird an diese Ger√§te eine Push-Benachrichtigung mit einem Link zur Installation gesendet - so erfolgt dies nun mit einem Klick. <br><br>  So konnte die Anwendung die Suche nach dem gew√ºnschten QS-Build durch die Abteilung und die Installation auf Ger√§ten f√ºr eine sp√§tere √úberpr√ºfung beschleunigen. <br><br><img src="https://habrastorage.org/webt/8t/nm/_b/8tnm_bbygilukr-n5krvxb1yq_c.png"><br>  <i>Aussehen der PixLauncher iOS App</i> <br><br><h2>  Abschlie√üend werden Builds in die Stores hochgeladen </h2><br>  Nach all den durchgef√ºhrten Aktionen ergibt sich nat√ºrlich die Notwendigkeit einer garantierten Ausf√ºllung der Build- und Metainformationen √ºber die Anwendung an die Parteien. <br><br>  Anfangs traten Probleme haupts√§chlich mit dem AppStore auf: <br><br><ul><li>  Das Ausf√ºllen des Gates erfolgt nur von einem MacOS-Ger√§t aus. </li><li>  Sie m√ºssen Videos, Screenshots und Anwendungsbeschreibungen in mehr als 25 Sprachen hochladen. </li></ul><br>  Dies f√ºhrte zu gro√üen Zeitverlusten beim Bef√ºllen und Abst√ºrzen beim Herunterladen von Dateien in das Admin-Panel.  Deshalb haben wir uns Gedanken √ºber die Prozessautomatisierung gemacht. <br><br>  Als Ergebnis haben wir Folgendes: <br><br><ol><li>  In Google Disk haben wir ein Tablet mit einer Beschreibung der Anwendung in allen Sprachen erhalten. </li><li>  Die Videos und Screenshots der Anwendung sind in Ordnern mit einer bestimmten Benennung angeordnet. </li><li>  In Teamcity wurde eine Konfiguration vom Release-Build abh√§ngig gemacht, um einen bereits zusammengestellten Build auszuw√§hlen. </li><li>  Geben Sie √ºber die GooglePlay-API und den iTMSTransporter f√ºr Apple die Builds und Metainformationen zur Anwendung im Store f√ºr alle erforderlichen Sprachen ein.  Bei Problemen (zum Beispiel mit dem Netzwerk) unternehmen wir mehrere Versuche und senden eine Nachricht mit dem Fehlertext an Slack. </li></ol><br><img src="https://habrastorage.org/webt/lf/qu/un/lfquunvooflyh40dlkshhvmhg2m.png"><br>  <i>So sieht das Hochladen des Builds in den AppStore aus</i> <br><br><h2>  Als Ergebnis - ein paar Zahlen </h2><br><ul><li>  Derzeit haben wir ungef√§hr 400 Baugruppen und bis zu 60 Installationen von Ger√§ten pro Tag. </li><li>  Es gibt 57 verschiedene Build-Konfigurationen in TeamCity. </li><li>  Wir verwenden 22 TeamCity-Agenten, w√§hrend es m√∂glich ist, die Leistung ohne nennenswerte Einbu√üen auf 48 Agenten zu erweitern. </li><li>  Es besteht die M√∂glichkeit einer horizontalen Erweiterung der Flotte. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484172/">https://habr.com/ru/post/de484172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484160/index.html">Ausweichendes Talent: Russland verliert die besten IT-Experten</a></li>
<li><a href="../de484164/index.html">Die Geschichte der B√ºcher und die Zukunft der Bibliotheken</a></li>
<li><a href="../de484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../de484168/index.html">Wir schreiben unsere Strategie f√ºr das virtuelle Scrollen von Angular CDK</a></li>
<li><a href="../de484170/index.html">Aktualisieren Sie Check Point von R77.30 auf 80.20</a></li>
<li><a href="../de484174/index.html">Castle trinkt unter "extremen" Bedingungen oder wie wir an der "DOZOR" Show teilgenommen haben</a></li>
<li><a href="../de484176/index.html">Implementieren der Statusvorlage in Unity</a></li>
<li><a href="../de484178/index.html">Intelligenter Ethernet-Switch f√ºr Planet Earth</a></li>
<li><a href="../de484180/index.html">Virtuelle Telefonanlage von Rostelecom: Was und wie kann √ºber die API geschehen?</a></li>
<li><a href="../de484182/index.html">Xenobots: Lebende Nanoroboter aus Froschzellen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>