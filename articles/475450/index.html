<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôéÔ∏è üèª üëÇ Telegram bot para una selecci√≥n personalizada de art√≠culos de Habr ‚§¥Ô∏è üßìüèª üë®üèæ‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para preguntas al estilo de "¬øpor qu√©?" Hay un art√≠culo m√°s antiguo, Natural Geektimes, que hace que el espacio sea m√°s limpio . 


 Muchos art√≠culos,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Telegram bot para una selecci√≥n personalizada de art√≠culos de Habr</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475450/"><p>  Para preguntas al estilo de "¬øpor qu√©?"  Hay un art√≠culo m√°s antiguo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Natural Geektimes, que hace que el espacio sea m√°s limpio</a> . </p><br><p>  Muchos art√≠culos, por razones subjetivas, a algunos no les gusta, y otros, por el contrario, es una pena perderse.  Quiero optimizar este proceso y ahorrar tiempo. </p><br><p>  El art√≠culo anterior sugiri√≥ un enfoque con scripts en el navegador, pero realmente no me gust√≥ (a pesar de que lo us√© antes) por las siguientes razones: </p><br><ul><li>  Para diferentes navegadores en su computadora / tel√©fono, debe configurarlo nuevamente, si es posible. </li><li>  El filtrado duro por parte de los autores no siempre es conveniente. </li><li>  El problema con los autores cuyos art√≠culos no quieren perderse, incluso si se publican una vez al a√±o, no se resuelve. </li></ul><br><p>  Filtrar por calificaci√≥n de art√≠culo integrado en el sitio no siempre es conveniente, ya que los art√≠culos altamente especializados, por todo su valor, pueden recibir una calificaci√≥n bastante modesta. </p><br><p>  Inicialmente, quer√≠a generar un feed rss (o incluso algunos), dejando solo lo interesante all√≠.  Pero al final result√≥ que leer rss no parec√≠a muy conveniente: en cualquier caso, para comentar / votar un art√≠culo / agregarlo a favoritos, debe pasar por el navegador.  Por lo tanto, escrib√≠ un bot para un telegrama que me arroja art√≠culos interesantes en PM.  Telegram en s√≠ mismo los convierte en hermosas vistas previas, que en combinaci√≥n con informaci√≥n sobre el autor / calificaci√≥n / vistas parece bastante informativo. </p><br><p><img src="https://habrastorage.org/webt/uk/e7/hr/uke7hrnmcthxqqzubouampuvlrw.png"></p><br><p>  Debajo del corte, detalles como caracter√≠sticas de trabajo, proceso de escritura y soluciones t√©cnicas. </p><a name="habracut"></a><br><h2 id="kratko-o-bote">  Brevemente sobre el bot </h2><br><p>  Repositorio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/Kright/habrahabr_reader</a> </p><br><p>  Telegram bot: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://t.me/HabraFilterBot</a> </p><br><p>  El usuario establece una calificaci√≥n adicional para etiquetas y autores.  Despu√©s de eso, se aplica un filtro a los art√≠culos: se agrega la calificaci√≥n del art√≠culo en Habr√©, la calificaci√≥n del autor del usuario y el promedio de las calificaciones del usuario por etiquetas.  Si la cantidad es mayor que el valor umbral definido por el usuario, el art√≠culo pasa el filtro. </p><br><p>  Un objetivo secundario de escribir un bot era divertirse y experimentar.  Adem√°s, regularmente me recordaba a m√≠ mismo que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no era Google</a> y, por lo tanto, muchas cosas se hac√≠an de la manera m√°s simple e incluso primitiva posible.  Sin embargo, esto no impidi√≥ que el proceso de escritura del bot se alargara durante tres meses. </p><br><h2 id="za-oknom-bylo-leto">  Fuera de la ventana era verano </h2><br><p>  Julio termin√≥ y decid√≠ escribir un bot.  Y no solo, sino con un amigo que dominaba la escala y quer√≠a escribir algo sobre ella.  El comienzo parec√≠a prometedor: el c√≥digo ser√° aserrado "equipo", la tarea parec√≠a f√°cil y pens√© que en un par de semanas o un mes el bot estar√° listo. </p><br><p>  A pesar de que yo mismo he estado escribiendo c√≥digo en la roca durante los √∫ltimos a√±os, generalmente nadie ve ni mira este c√≥digo: proyectos favoritos, verificar algunas ideas, preprocesamiento de datos, dominar algunos conceptos del FP.  Estaba realmente interesado en c√≥mo se ve el c√≥digo en el equipo, porque el c√≥digo en la roca se puede escribir de maneras muy diferentes. </p><br><p>  ¬øQu√© pudo haber ido <strong>as√≠</strong> ?  Sin embargo, no apuraremos las cosas. <br>  Todo lo que sucede puede ser rastreado por la historia de los commits. </p><br><p>  Un amigo cre√≥ el repositorio el 27 de julio, pero no hizo nada m√°s, as√≠ que comenc√© a escribir c√≥digo. </p><br><h3 id="30-iyulya">  30 de julio </h3><br><p>  Brevemente: escrib√≠ analizando rss feeds de Habr. </p><br><ul><li> <code>com.github.pureconfig</code> para leer archivos de configuraci√≥n de typesafe directamente en clases de caso (result√≥ ser muy conveniente) </li><li>  <code>scala-xml</code> para leer xml: dado que originalmente quer√≠a escribir mi implementaci√≥n para rss tape y rss tape en formato xml, utilic√© esta biblioteca para analizar.  En realidad, el an√°lisis rss tambi√©n apareci√≥. </li><li>  <code>scalatest</code> para pruebas.  Incluso para proyectos peque√±os, escribir pruebas ahorra tiempo; por ejemplo, al depurar el an√°lisis XML es mucho m√°s f√°cil descargarlo en un archivo, escribir pruebas y corregir errores.  Cuando m√°s tarde apareci√≥ un error al analizar un extra√±o html con caracteres utf-8 no v√°lidos, result√≥ ser m√°s conveniente volver a colocarlo en un archivo y agregar una prueba. </li><li>  actores de Akka.  Objetivamente, no eran necesarios en absoluto, pero el proyecto fue escrito por diversi√≥n, quer√≠a probarlos.  Como resultado, estoy listo para decir que me gust√≥.  Uno puede ver la idea de OOP desde el otro lado: hay actores que intercambian mensajes.  Lo que es m√°s interesante: es posible (y necesario) escribir c√≥digo de tal manera que el mensaje no llegue o no pueda procesarse (en t√©rminos generales, cuando una cuenta se ejecuta en una sola computadora, los mensajes no deber√≠an perderse).  Al principio me estaba estrujando el cerebro y hab√≠a una basura en el c√≥digo con actores que se suscrib√≠an entre s√≠, pero al final logr√© crear una arquitectura bastante simple y elegante.  El c√≥digo dentro de cada actor puede considerarse de un solo subproceso, cuando el actor se bloquea, Akka lo reinicia, se obtiene un sistema bastante tolerante a fallas. </li></ul><br><h3 id="9-avgusta">  9 de agosto </h3><br><p>  <code>scala-scrapper</code> proyecto <code>scala-scrapper</code> para analizar p√°ginas html del Habr (para extraer informaci√≥n como la calificaci√≥n del art√≠culo, el n√∫mero de marcadores, etc.). </p><br><p>  Y gatos.  Los que est√°n en la roca. </p><br><p><img src="https://habrastorage.org/webt/52/t8/4v/52t84v4u6vw7z6prsq8iqpmn0d8.png"></p><br><p>  Luego le√≠ un libro sobre bases de datos distribuidas, me gust√≥ la idea de CRDT (tipo de datos replicados sin conflictos, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habr</a> ), as√≠ que film√© la clase de tipo del semigrupo conmutativo para informaci√≥n sobre el art√≠culo sobre Habr√©. </p><br><p>  De hecho, la idea es muy simple: tenemos contadores que cambian de manera mon√≥tona.  El n√∫mero de promotores est√° creciendo sin problemas, el n√∫mero de ventajas tambi√©n (sin embargo, as√≠ como el n√∫mero de desventajas).  Si tengo dos versiones de informaci√≥n sobre un art√≠culo, puede "fusionarlas en una": considere el estado del contador que sea m√°s relevante. </p><br><p>  Un semigrupo significa que dos objetos con informaci√≥n sobre un art√≠culo pueden fusionarse en uno.  Conmutativo significa que puede fusionar A + B y B + A, el resultado no depende del orden, como resultado, la versi√≥n m√°s reciente permanece.  Por cierto, la asociatividad tambi√©n est√° aqu√≠. </p><br><p>  Por ejemplo, por dise√±o, rss despu√©s del an√°lisis proporcion√≥ informaci√≥n ligeramente amortiguada sobre el art√≠culo, sin m√©tricas como el n√∫mero de vistas.  Un actor especial tom√≥ informaci√≥n sobre los art√≠culos y corri√≥ a las p√°ginas html para actualizarlo y fusionarlo con la versi√≥n anterior. </p><br><p>  En t√©rminos generales, como akka, no hab√≠a necesidad de esto, solo era posible almacenar updateDate para el art√≠culo y tomar uno m√°s nuevo sin ninguna fusi√≥n, pero el camino de la aventura me llev√≥. </p><br><h2 id="12-avgusta">  12 de agosto </h2><br><p>  Comenc√© a sentirme m√°s libre y, por inter√©s, hice de cada conversaci√≥n un actor separado.  Te√≥ricamente, un actor por s√≠ solo pesa unos 300 bytes y puede crearse al menos por millones, por lo que este es un enfoque completamente normal.  Result√≥, me parece, una soluci√≥n bastante interesante: </p><br><p>  Un actor fue el puente entre el servidor de telegramas y el sistema de mensajes en Akka.  Simplemente recibi√≥ mensajes y los envi√≥ al actor de chat deseado.  El chat de actores en respuesta podr√≠a enviar algo de regreso, y fue enviado de vuelta a telegramas.  Lo que era muy conveniente: este actor result√≥ ser lo m√°s simple posible y conten√≠a solo la l√≥gica de la respuesta a los mensajes.  Por cierto, la informaci√≥n sobre nuevos art√≠culos lleg√≥ a cada chat, pero de nuevo no veo ning√∫n problema en esto. </p><br><p>  En general, el bot ya estaba funcionando, respondiendo mensajes, manteniendo una lista de art√≠culos enviados al usuario, y ya pensaba que el bot estaba casi listo.  Lentamente termin√© peque√±os chips como normalizar los nombres de autores y etiquetas (reemplazando "sd f" con "s_d_f"). </p><br><p>  Solo hab√≠a un <em>peque√±o pero</em> : el estado no persist√≠a en ninguna parte. </p><br><h2 id="vsyo-poshlo-ne-tak">  Todo sali√≥ mal </h2><br><p>  Puede que hayas notado que escrib√≠ el bot principalmente solo.  Entonces, el segundo participante se uni√≥ al desarrollo y aparecieron los siguientes cambios en el c√≥digo: </p><br><ul><li>  Para almacenar el estado apareci√≥ mongoDB.  Al mismo tiempo, los registros se rompieron en el proyecto, porque por alguna raz√≥n la monga comenz√≥ a enviarles correos no deseados y algunas personas simplemente los desactivaron a nivel mundial. </li><li>  El puente del actor en telegrama se transform√≥ m√°s all√° del reconocimiento y comenz√≥ a analizar los mensajes en s√≠. </li><li>  Los actores de los chats estaban borrachos sin piedad, en lugar de ellos apareci√≥ un actor que escondi√≥ en s√≠ mismo toda la informaci√≥n sobre todos los chats a la vez.  Por cada estornudo, este actor se meti√≥ en mongu.  Bueno, s√≠, es dif√≠cil enviarlo a todos los actores de chat cuando se actualiza la informaci√≥n sobre un art√≠culo (somos como Google, millones de usuarios esperan un mill√≥n de art√≠culos en un chat para todos), pero es normal entrar en una monga cada vez que actualiza un chat.  Como lo entend√≠ mucho despu√©s, la l√≥gica de trabajo de los chats tambi√©n se cort√≥ por completo y apareci√≥ algo inoperante. </li><li>  No queda rastro de las clases. </li><li>  Una l√≥gica poco saludable apareci√≥ en los actores con sus suscripciones entre s√≠, lo que condujo a una condici√≥n de carrera. </li><li>  Las estructuras de datos con campos de tipo <code>Option[Int]</code> convirtieron en Int con valores m√°gicos predeterminados de tipo -1.  M√°s tarde, me di cuenta de que mongoDB almacena json y que no hay nada de malo en almacenar <code>Option</code> all√≠, o al menos analizar -1 como None, pero en ese momento no lo sab√≠a y cre√≠a la palabra "es necesario".  Ese c√≥digo no fue escrito por m√≠, y no me molest√© en cambiarlo por el momento. </li><li>  Descubr√≠ que mi direcci√≥n IP p√∫blica tiene la propiedad de cambiar, y cada vez que ten√≠a que agregarla a la lista blanca.  Comenc√© el bot localmente, la monga estaba en alg√∫n lugar de los servidores monga como compa√±√≠a. </li><li>  De repente, la normalizaci√≥n de las etiquetas y el formato de los mensajes para un telegrama desaparecieron.  (Hmm, ¬øpor qu√© lo har√≠a?) </li><li>  Me gust√≥ que el estado del bot se almacena en una base de datos externa, y al reiniciar, contin√∫a funcionando como si nada hubiera pasado.  Sin embargo, esta fue la √∫nica ventaja. </li></ul><br><p>  La segunda persona no ten√≠a prisa, y todos estos cambios aparecieron en un gran mont√≥n ya a principios de septiembre.  No apreci√© de inmediato la magnitud del da√±o y comenc√© a entender el trabajo de la base de datos, porque  nunca hab√≠a tratado con ellos antes.  Solo entonces me di cuenta de cu√°nto c√≥digo de trabajo se cort√≥ y cu√°ntos errores se agregaron a cambio. </p><br><h2 id="sentyabr">  Septiembre </h2><br><p>  Al principio, pens√© que ser√≠a √∫til dominar Mongu y hacer todo bien.  Luego, lentamente comenc√© a comprender que organizar la comunicaci√≥n con la base de datos tambi√©n es un arte en el que puedes hacer carreras y solo cometer errores.  Por ejemplo, si dos mensajes del tipo <code>/subscribe</code> llegan del usuario, y en respuesta a cada uno, crearemos una entrada en la placa, porque al momento de procesar esos mensajes, el usuario no est√° firmado.  Ten√≠a la sospecha de que la comunicaci√≥n con la monga en la forma existente no estaba escrita de la mejor manera.  Por ejemplo, la configuraci√≥n del usuario se cre√≥ en el momento en que se registr√≥.  Si trat√≥ de cambiarlos antes del hecho de la suscripci√≥n ... el bot no respondi√≥, porque el c√≥digo en el actor subi√≥ a la base de datos para la configuraci√≥n, no pudo encontrarlo y se bloque√≥.  A la pregunta: ¬øpor qu√© no crear las configuraciones seg√∫n sea necesario? Descubr√≠ que no hay nada que las cambie si el usuario no se ha suscrito ... De alguna manera, el sistema de filtrado de mensajes no se hizo evidente, e incluso despu√©s de mirar detenidamente el c√≥digo no pude entender si fue concebido originalmente o hay un error </p><br><p>  No hab√≠a una lista de art√≠culos enviados al chat; en cambio, se sugiri√≥ que los escribiera yo mismo.  Esto me sorprendi√≥, en general, no me opuse a arrastrar todo tipo de piezas al proyecto, pero ser√≠a l√≥gico tirar de estas cosas y atornillarlas.  Pero no, el segundo participante parece haber olvidado todo, pero dijo que la lista dentro del chat supuestamente es una mala decisi√≥n, y que necesita hacer una placa con eventos como "el art√≠culo x fue enviado al usuario x".  Luego, si el usuario solicitaba enviar nuevos art√≠culos, era necesario enviar una solicitud a la base de datos, cu√°l de los eventos seleccionar√≠a eventos relacionados con el usuario, a√∫n as√≠ obtener una lista de nuevos art√≠culos, filtrarlos, enviarlos al usuario y lanzar eventos al respecto en la base de datos. </p><br><p>  El segundo participante en alg√∫n lugar sufri√≥ en la direcci√≥n de las abstracciones, cuando el bot no solo recibir√° art√≠culos de Habr y no solo se enviar√° a telegramas. </p><br><p>  De alguna manera implement√© los eventos en forma de una tableta separada para la segunda mitad de septiembre.  No es √≥ptimo, pero el bot al menos funcion√≥ y comenz√≥ a enviarme art√≠culos nuevamente, y lentamente descubr√≠ lo que estaba sucediendo en el c√≥digo. </p><br><p>  Ahora puede volver primero y recordar que el repositorio no fue creado originalmente por m√≠.  ¬øQu√© pudo haber ido as√≠?  Mi solicitud de grupo fue rechazada.  Result√≥ que ten√≠a un c√≥digo corto, que no sab√≠a c√≥mo trabajar en un equipo y que ten√≠a que editar errores en la curva de implementaci√≥n actual, y no modificarlo a un estado utilizable. </p><br><p>  Estaba molesto, mir√© el historial de confirmaciones, la cantidad de c√≥digo escrito.  Mir√© los momentos que originalmente estaban bien escritos, y luego volv√≠ a analizar ... </p><br><h2 id="frk-it">  A la mierda </h2><br><p>  Me acord√© del art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">No eres Google</a> . </p><br><p>  Pens√© que nadie realmente necesita una idea sin implementaci√≥n.  Pens√© que quiero tener un bot que funcione que funcione en una sola copia en una sola computadora como un simple programa java.  S√© que mi bot funcionar√° durante meses sin reinicios, ya que en el pasado escrib√≠ tales bots.  Si de repente se cae y no env√≠a el siguiente art√≠culo al usuario, el cielo no caer√° sobre la tierra y no ocurrir√° nada catastr√≥fico. </p><br><p>  ¬øPor qu√© necesito un docker, mongoDB y otro software de culto de carga "serio", si el c√≥digo no funciona de manera est√∫pida o funciona de forma torcida? </p><br><p>  Bifurqu√© el proyecto e hice todo lo que quer√≠a. </p><br><p><img src="https://habrastorage.org/webt/ns/gh/ze/nsghzekle4yfth_aqyivbx17wxy.jpeg"></p><br><p>  Casi al mismo tiempo, cambi√© mi trabajo y faltaba mucho tiempo libre.  En la ma√±ana me despert√© exactamente en el tren, regres√© tarde en la noche y no quer√≠a hacer nada m√°s.  No hice nada por un tiempo, luego super√© el deseo de terminar el bot y comenc√© a reescribir lentamente el c√≥digo mientras conduc√≠a al trabajo por la ma√±ana.  No puedo decir que haya sido productivo: no es muy conveniente sentarse en un tren tembloroso con una computadora port√°til en su regazo y mirar el desbordamiento de la pila desde su tel√©fono.  Sin embargo, el tiempo detr√°s de escribir el c√≥digo pas√≥ completamente desapercibido, y el proyecto comenz√≥ a moverse lentamente a un estado de funcionamiento. </p><br><p>  En alg√∫n lugar en el fondo hab√≠a un gusano de duda que mongoDB quer√≠a usar, pero pens√© que hay desventajas notables adem√°s de las ventajas con el almacenamiento de estado "confiable": </p><br><ul><li>  La base de datos se convierte en otro punto de falla. </li><li>  El c√≥digo se est√° volviendo m√°s dif√≠cil y lo escribir√© por m√°s tiempo. </li><li>  El c√≥digo se vuelve lento e ineficiente; en lugar de cambiar el objeto en la memoria, los cambios se env√≠an a la base de datos y se retiran si es necesario. </li><li>  Existen restricciones sobre el tipo de almacenamiento de eventos en una placa separada, que est√°n asociadas con las caracter√≠sticas de la base de datos. </li><li>  En la versi√≥n de prueba de monga hay algunas restricciones, y si te topas con ellas, tendr√°s que iniciar y configurar el mongu para algo. </li></ul><br><p>  Beb√≠ Mongu, ahora el estado del bot simplemente se almacena en la memoria del programa y de vez en cuando se guarda en un archivo en forma de json.  Quiz√°s en los comentarios escriban que estoy equivocado, porque aqu√≠ es donde debes usarlo, etc.  Pero este es mi proyecto, el enfoque con el archivo es lo m√°s simple posible y funciona de manera transparente. </p><br><p>  Arroj√© valores m√°gicos como -1 y devolv√≠ la <code>Option</code> normal, agregu√© almacenamiento de una placa hash con los art√≠culos enviados de vuelta al objeto con informaci√≥n de chat.  Se agreg√≥ la eliminaci√≥n de informaci√≥n sobre art√≠culos de m√°s de cinco d√≠as, para no almacenar todo en una fila.  Puso el registro en condiciones de trabajo: los registros en cantidades razonables se escriben tanto en el archivo como en la consola.  Se agregaron varios comandos de administraci√≥n como guardar estado u obtener estad√≠sticas como la cantidad de usuarios y art√≠culos. </p><br><p>  Arregl√© un mont√≥n de cosas peque√±as: por ejemplo, los art√≠culos ahora indican la cantidad de vistas, me gusta, disgustos y comentarios en el momento en que se pas√≥ el filtro de usuario.  En general, es sorprendente cu√°ntas peque√±as cosas tuvieron que arreglarse.  Mantuve una lista, anot√© todas las "asperezas" all√≠ y las correg√≠ lo m√°s posible. </p><br><p>  Por ejemplo, agregu√© la capacidad de establecer todas las configuraciones directamente en un mensaje: </p><br><pre> <code class="plaintext hljs">/subscribe /rating +20 /author a -30 /author s -20 /author p +9000 /tag scala 20 /tag akka 50</code> </pre> <br><p>  Y el comando <code>/settings</code> muestra en este formulario, puede tomar texto y enviar todos los ajustes a un amigo. <br>  Parece ser un poco, pero hay docenas de matices similares. </p><br><p>  Se implement√≥ el filtrado de art√≠culos en forma de un modelo lineal simple: el usuario puede establecer una calificaci√≥n adicional para autores y etiquetas, as√≠ como un valor umbral.  Si la suma de la calificaci√≥n del autor, la calificaci√≥n promedio de las etiquetas y la calificaci√≥n real del art√≠culo es mayor que el valor umbral, entonces el art√≠culo se muestra al usuario.  Puede solicitar art√≠culos al bot con el comando / new, o suscribirse al bot y arrojar√° art√≠culos en PM en cualquier momento del d√≠a. </p><br><p>  En t√©rminos generales, tuve una idea para cada art√≠culo para dibujar m√°s signos (centros, la cantidad de comentarios, marcadores, la din√°mica de los cambios de calificaci√≥n, la cantidad de texto, im√°genes y c√≥digo en el art√≠culo, palabras clave) y el usuario para mostrar el voto ok / not ok debajo de cada art√≠culo y para cada usuario para entrenar el modelo, pero me volv√≠ demasiado vago. </p><br><p>  Adem√°s, la l√≥gica del trabajo no ser√° tan obvia.  Ahora puedo poner manualmente una calificaci√≥n de +9000 para el paciente Zero y con una calificaci√≥n de umbral de +20 se me garantizar√° recibir todos sus art√≠culos (a menos, por supuesto, pongo -100500 para cualquier etiqueta). </p><br><p>  La arquitectura resultante fue bastante simple: </p><br><ol><li>  Un actor que almacena el estado de todos los chats y art√≠culos.  Carga su estado desde un archivo en el disco y de vez en cuando lo guarda de nuevo, cada vez en un nuevo archivo. </li><li>  Un actor que ocasionalmente se encuentra con el feed RSS aprende sobre nuevos art√≠culos, mira los enlaces, analiza y env√≠a estos art√≠culos al primer actor.  Adem√°s, a veces le pide al primer actor una lista de art√≠culos, selecciona aquellos que no tienen m√°s de tres d√≠as, pero que no se han actualizado durante mucho tiempo, y los actualiza. </li><li>  Un actor que se comunica con un telegrama.  Todav√≠a tom√© el an√°lisis de los mensajes completamente aqu√≠.  En el buen sentido, quiero dividirlo en dos, para que uno analice los mensajes entrantes y el segundo trate con problemas de transporte, como el reenv√≠o de mensajes no enviados.  Ahora no hay reenv√≠o, y el mensaje que no lleg√≥ debido a un error simplemente se perder√° (excepto que se marcar√° en los registros), pero hasta ahora esto no causa problemas.  Quiz√°s surjan problemas si un grupo de personas se suscribe al bot y alcanzo el l√≠mite para enviar mensajes). </li></ol><br><p>  Lo que me gust√≥: gracias a Akka, la ca√≠da de los actores 2 y 3 en general no afecta el rendimiento del bot.  Quiz√°s algunos art√≠culos no se actualicen a tiempo o algunos mensajes no lleguen al telegrama, pero Akka reinicia al actor y todo contin√∫a funcionando a√∫n m√°s.  Guardo la informaci√≥n de que el art√≠culo se muestra al usuario solo cuando el actor de telegramas responde que entreg√≥ el mensaje con √©xito.  Lo peor que me amenaza es enviar un mensaje varias veces (si se entrega, pero la confirmaci√≥n se pierde de alguna manera desconocida).  En principio, si el primer actor no mantuvo el estado en s√≠ mismo, sino que se comunic√≥ con alg√∫n tipo de base de datos, entonces tambi√©n podr√≠a caer silenciosamente y volver a la vida.  Tambi√©n podr√≠a intentar la persistencia akka para restaurar el estado de los actores, pero la implementaci√≥n actual me conviene con su simplicidad.  No es que mi c√≥digo se bloquee a menudo, por el contrario, me esfuerzo mucho para que esto sea imposible.  Pero sucede una mierda, y la capacidad de dividir el programa en piezas aisladas-actores me pareci√≥ realmente conveniente y pr√°ctica. </p><br><p>  Se agreg√≥ circle-ci para saber de inmediato cuando se rompe el c√≥digo.  Al menos que el c√≥digo ha dejado de compilarse.  Inicialmente, quer√≠a agregar travis, pero solo mostraba mis proyectos sin bifurcaciones.  En general, ambas cosas se pueden usar libremente en repositorios abiertos. </p><br><h2 id="itogi">  Resumen </h2><br><p>  Ya es noviembre.  El bot est√° escrito, lo us√© durante las √∫ltimas dos semanas y me gust√≥.  Si tiene ideas para mejorar, escriba.  No veo el punto de monetizarlo, d√©jelo funcionar y env√≠e art√≠culos interesantes. </p><br><p>  Enlace al bot: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://t.me/HabraFilterBot</a> <br>  Github: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/Kright/habrahabr_reader</a> </p><br><p>  Peque√±as conclusiones: </p><br><ul><li>  Incluso un proyecto peque√±o puede llevar mucho tiempo. </li><li>  No eres Google  No tiene sentido disparar a un gorri√≥n desde un ca√±√≥n.  Una soluci√≥n simple puede funcionar igual de bien. </li><li>  Los proyectos de mascotas son muy adecuados para experimentar con nuevas tecnolog√≠as. </li><li>  Los bots de Telegram est√°n escritos de manera bastante simple.  Si no fuera por "trabajo en equipo" y experimentos con tecnolog√≠as, el bot habr√≠a sido escrito en una semana o dos. </li><li>  El modelo de actor es una cosa interesante que combina bien con subprocesos m√∫ltiples y resistencia de c√≥digo. </li><li>  Parece que siento por m√≠ mismo por qu√© la comunidad de c√≥digo abierto ama los tenedores. </li><li>  Las bases de datos son buenas porque el estado de la aplicaci√≥n ya no depende de los bloqueos / reinicios de la aplicaci√≥n, pero trabajar con la base de datos complica el c√≥digo e impone restricciones en la estructura de datos. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/475450/">https://habr.com/ru/post/475450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../475438/index.html">Ekaterimburgo, 19 de noviembre: grupo de usuarios de Atlassian MeetUp</a></li>
<li><a href="../475440/index.html">Interfaces para monitorear el rendimiento de bases de datos populares en Foglight para bases de datos</a></li>
<li><a href="../475442/index.html">Visita a la sede de Google - T√©rminos y condiciones</a></li>
<li><a href="../475444/index.html">Reactores industriales de uranio y grafito para la producci√≥n de plutonio</a></li>
<li><a href="../475448/index.html">En un autom√≥vil moderno, hay m√°s l√≠neas de c√≥digo que ...</a></li>
<li><a href="../475452/index.html">Selecci√≥n: 5 libros de marketing para leer para un fundador de startup</a></li>
<li><a href="../475458/index.html">Control remoto con disparador externo para c√°maras SONY HDR en ESP8266</a></li>
<li><a href="../475462/index.html">C√≥mo localizar un juego m√≥vil para el mercado asi√°tico</a></li>
<li><a href="../475464/index.html">El camino del arquitecto: certificaci√≥n e inmersi√≥n en el producto</a></li>
<li><a href="../475466/index.html">Intel Xeon E-2200. N√∫cleos del servidor, presupuesto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>