<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👍🏾 🐊 ⏺️ 据我了解，我吃了很多甜食，或者按申请中的支票分类商品 🕵🏻 📼 📇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="挑战赛 
 在本文中，我们要讨论如何创建一种解决方案，该解决方案用于将应用程序中的收据中的产品名称分类以记录支票和购物助手的费用。 我们希望为用户提供查看购买统计信息的机会，这些统计信息是根据扫描的收据自动收集的，即按类别分配用户购买的所有商品。 因为强迫用户独立地分组产品已经是上个世纪了。 解决此...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>据我了解，我吃了很多甜食，或者按申请中的支票分类商品</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430216/"><h2> 挑战赛 </h2><br> 在本文中，我们要讨论如何创建一种解决方案，该解决方案用于将应用程序中的收据中的产品名称分类以记录支票和购物助手的费用。 我们希望为用户提供查看购买统计信息的机会，这些统计信息是根据扫描的收据自动收集的，即按类别分配用户购买的所有商品。 因为强迫用户独立地分组产品已经是上个世纪了。 解决此问题的方法有几种：您可以尝试将聚类算法与单词的矢量表示方法或经典分类算法一起应用。 我们还没有发明任何新东西，在本文中，我们只想共享一个有关该问题的可能解决方案的小指南，如何不执行此操作的示例，分析其他方法为何不起作用以及您在此过程中可能遇到的问题的分析。 <br><a name="habracut"></a><br><h2> 聚类 </h2><br> 问题之一是，我们从支票中获得的商品名称，即使对于一个人来说，也并不总是易于解密。 您不太可能知道在一家俄罗斯商店中购买了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">哪种</a>名称为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ UTRUSTA krnsht”的</a>产品？ 真正的瑞典设计鉴赏家肯定会立即回答我们：Utrust烤箱的托架，但在总部保留这样的专家非常昂贵。 此外，我们还没有适合我们数据的现成的，带有标签的样本，我们可以在该样本上训练模型。 因此，首先我们将讨论在缺乏训练数据的情况下如何应用聚类算法以及为什么我们不喜欢它。 <br><br> 这样的算法基于测量对象之间的距离，这需要它们的向量表示或使用度量来测量单词的相似性（例如，Levenshtein距离）。 在此步骤中，困难在于名称的有意义的矢量表示。 从名称中提取属性以完整，全面地描述产品及其与其他产品的关系是有问题的。 <br><br> 最简单的选择是使用Tf-Idf，但是在这种情况下，向量空间的维数很大，并且空间本身是稀疏的。 此外，这种方法不会从名称中提取任何其他信息。 因此，在一个集群中，可以有许多不同类别的产品，它们由一个共同的词结合在一起，例如“土豆”或“沙拉”： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pb/uh/bd/pbuhbdnf0bwmwvy0ywqwapil018.png"></div><br> 我们也无法控制将要组装的集群。 唯一可以指出的是簇的数量（如果使用了基于空间中非密度峰的算法）。 但是，如果您指定的数量太少，则会形成一个巨大的群集，其中将包含所有其他群集无法使用的名称。 如果您指定了足够大的簇，那么在算法起作用之后，我们将不得不浏览数百个簇并将它们手工组合成语义类别。 <br><br> 下表提供了使用KMeans和Tf-Idf算法进行矢量表示的聚类信息。 从这些表中我们可以看到，簇中心之间的距离小于对象与它们所属的簇中心之间的平均距离。 可以通过以下事实来解释此类数据：在向量空间中没有明显的密度峰，并且簇的中心位于圆周围，而大多数对象位于圆的外部。 此外，形成了一个簇，其中包含大多数向量。 在此类别中，最有可能使用的名称包含的单词在不同类别的所有产品中比其他单词更常见。 <br><br><table><caption> 表1.群集之间的距离。 </caption><tbody><tr><th> 丛集 </th><th>  C1 </th><th>  C2 </th><th>  C3 </th><th>  C4 </th><th>  C5 </th><th>  C6 </th><th>  C7 </th><th>  C8 </th><th>  C9 </th></tr><tr><th>  C1 </th><td>  0.0 </td><td>  0.502 </td><td>  0.354 </td><td>  0.475 </td><td>  0.481 </td><td>  0.527 </td><td>  0.498 </td><td>  0.501 </td><td>  0.524 </td></tr><tr><th>  C2 </th><td>  0.502 </td><td>  0.0 </td><td>  0.614 </td><td>  0.685 </td><td>  0.696 </td><td>  0.728 </td><td>  0.706 </td><td>  0.709 </td><td>  0.725 </td></tr><tr><th>  C3 </th><td>  0.354 </td><td>  0.614 </td><td>  0.0 </td><td>  0.590 </td><td>  0.597 </td><td>  0.635 </td><td>  0.610 </td><td>  0.613 </td><td>  0.632 </td></tr><tr><th>  C4 </th><td>  0.475 </td><td>  0.685 </td><td>  0.590 </td><td>  0.0 </td><td>  0.673 </td><td>  0.709 </td><td>  0.683 </td><td>  0.687 </td><td>  0.699 </td></tr><tr><th>  C5 </th><td>  0.481 </td><td>  0.696 </td><td>  0.597 </td><td>  0.673 </td><td>  0.0 </td><td>  0.715 </td><td>  0.692 </td><td>  0.694 </td><td>  0.711 </td></tr><tr><th>  C6 </th><td>  0.527 </td><td>  0.727 </td><td>  0.635 </td><td>  0.709 </td><td>  0.715 </td><td>  0.0 </td><td>  0.726 </td><td>  0.728 </td><td>  0.741 </td></tr><tr><th>  C7 </th><td>  0.498 </td><td>  0.706 </td><td>  0.610 </td><td>  0.683 </td><td>  0.692 </td><td>  0.725 </td><td>  0.0 </td><td>  0.707 </td><td>  0.714 </td></tr><tr><th>  C8 </th><td>  0.501 </td><td>  0.709 </td><td>  0.612 </td><td>  0.687 </td><td>  0.694 </td><td>  0.728 </td><td>  0.707 </td><td>  0.0 </td><td>  0.725 </td></tr><tr><th>  C9 </th><td>  0.524 </td><td>  0.725 </td><td>  0.632 </td><td>  0.699 </td><td>  0.711 </td><td>  0.741 </td><td>  0.714 </td><td>  0.725 </td><td>  0.0 </td></tr></tbody></table><br><table><caption> 表2.有关集群的简要信息 </caption><tbody><tr><th> 丛集 </th><th> 物件数量 </th><th> 平均距离 </th><th> 最小距离 </th><th> 最大距离 </th></tr><tr><th>  C1 </th><td>  62530 </td><td>  0.999 </td><td>  0.041 </td><td>  1.001 </td></tr><tr><th>  C2 </th><td>  2159 </td><td>  0.864 </td><td>  0.527 </td><td>  0.964 </td></tr><tr><th>  C3 </th><td>  1099 </td><td>  0.934 </td><td>  0.756 </td><td>  0.993 </td></tr><tr><th>  C4 </th><td>  1292 </td><td>  0.879 </td><td>  0.733 </td><td>  0.980 </td></tr><tr><th>  C5 </th><td>  746 </td><td>  0.875 </td><td>  0.731 </td><td>  0.965 </td></tr><tr><th>  C6 </th><td>  2451 </td><td>  0.847 </td><td>  0.719 </td><td>  0.994 </td></tr><tr><th>  C7 </th><td>  1133 </td><td>  0.866 </td><td>  0.724 </td><td>  0.986 </td></tr><tr><th>  C8 </th><td>  876 </td><td>  0.863 </td><td>  0.704 </td><td>  0.999 </td></tr><tr><th>  C9 </th><td>  1879年 </td><td>  0.849 </td><td>  0.526 </td><td>  0.981 </td></tr></tbody></table><br><br> 但是在某些地方，集群变得相当不错，例如，如下图所示-那里几乎所有产品都是猫食。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oh/uy/5p/ohuy5p_bgiignp9ah_gokvvbzs4.png"></div><br><br>  Doc2Vec是允许您以矢量形式表示文本的另一种算法。 使用这种方法，每个名称将由比使用Tf-Idf尺寸小的矢量来描述。 在生成的向量空间中，相似的文本将彼此靠近，而不同的文本将相距很远。 <br><br> 该方法可以解决通过Tf-Idf方法获得的大尺寸和放电空间的问题。 对于此算法，我们使用了最简单的令牌化选项：将名称分解为单独的单词，并采用其初始形式。 他通过以下方式接受了数据方面的培训： <br><br><pre><code class="python hljs">max_epochs = <span class="hljs-number"><span class="hljs-number">100</span></span> vec_size = <span class="hljs-number"><span class="hljs-number">20</span></span> alpha = <span class="hljs-number"><span class="hljs-number">0.025</span></span> model = doc2vec.Doc2Vec(vector_size=vec_size, alpha=alpha, min_alpha=<span class="hljs-number"><span class="hljs-number">0.00025</span></span>, min_count=<span class="hljs-number"><span class="hljs-number">1</span></span>, dm =<span class="hljs-number"><span class="hljs-number">1</span></span>) model.build_vocab(train_corpus) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> epoch <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(max_epochs): print(<span class="hljs-string"><span class="hljs-string">'iteration {0}'</span></span>.format(epoch)) model.train(train_corpus, total_examples=model.corpus_count, epochs=model.iter) <span class="hljs-comment"><span class="hljs-comment"># decrease the learning rate model.alpha -= 0.0002 # fix the learning rate, no decay model.min_alpha = model.epochs</span></span></code> </pre> <br> 但是通过这种方法，我们得到了不携带名称信息的向量-成功的话，您可以使用随机值。 这是该算法操作的一个示例：该图像显示的产品在算法看来类似于“ n pn 0.45k形式的Borodino面包”。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qd/m9/lp/qdm9lplwaidbilivtpb3jjskopo.png"></div><br> 也许问题出在名称的长度和上下文上：名称“ __ club。Banana 200ml”的通行证可以是酸奶，果汁或一大罐奶油。 使用不同的名称标记化方法可以达到更好的结果。 我们没有使用这种方法的经验，并且在第一次尝试失败时，我们已经找到了带有产品名称的标记集，因此我们决定暂时退出此方法，转而使用分类算法。 <br><br><h2> 分类 </h2><br><h3> 数据预处理 </h3><br> 支票上的商品名称并非总是以清晰的方式出现：拉丁和西里尔字母混在一起。 例如，字母“ a”可以用拉丁字母“ a”代替，这增加了唯一名称的数量-例如，单词“ milk”和“ milk”将被认为是不同的。 这些名称还包含许多其他错字和缩写。 <br><br> 我们检查了数据库，发现名称中的典型错误。 在此阶段，我们放弃了正则表达式，借助它们我们清理了名称并将它们带入了某种通用视图。 使用这种方法，结果提高了大约7％。 加上基于带有扭曲参数的Huber损失函数的简单SGD分类器选项，我们得出F1的准确度为81％（所有产品类别的平均准确度）。 <br><br><pre> <code class="python hljs">sgd_model = SGDClassifier() parameters_sgd = { <span class="hljs-string"><span class="hljs-string">'max_iter'</span></span>:[<span class="hljs-number"><span class="hljs-number">100</span></span>], <span class="hljs-string"><span class="hljs-string">'loss'</span></span>:[<span class="hljs-string"><span class="hljs-string">'modified_huber'</span></span>], <span class="hljs-string"><span class="hljs-string">'class_weight'</span></span>:[<span class="hljs-string"><span class="hljs-string">'balanced'</span></span>], <span class="hljs-string"><span class="hljs-string">'penalty'</span></span>:[<span class="hljs-string"><span class="hljs-string">'l2'</span></span>], <span class="hljs-string"><span class="hljs-string">'alpha'</span></span>:[<span class="hljs-number"><span class="hljs-number">0.0001</span></span>] } sgd_cv = GridSearchCV(sgd_model, parameters_sgd,n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>) sgd_cv.fit(tf_idf_data, prod_cat) sgd_cv.best_score_, sgd_cv.best_params_</code> </pre> <br> 另外，不要忘记某些类别的人购买的频率高于其他类别：例如，“茶和糖果”，“蔬菜和水果”比“服务”和“化妆品”更受欢迎。 通过这样的数据分布，最好使用允许您为每个类别设置权重（重要程度）的算法。 类别的权重可以取反值，该值等于类别中产品数与产品总数之比。 但您不必考虑，因为在实施这些算法时，可以自动确定类别的权重。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ty/o9/pk/tyo9pkfhw-ibby5jopobc5okotc.png"></div><br><h2> 获取新数据进行培训 </h2><br> 我们的应用程序所需要的类别与比赛中使用的类别略有不同，并且我们数据库中产品的名称与比赛中所展示的名称明显不同。 因此，我们需要在收据中标记货物。 我们尝试自己完成此操作，但我们意识到即使我们与整个团队保持联系，也将花费很长时间。 因此，我们决定使用Yandex的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ Toloka”</a> 。 <br><br> 在那里，我们使用了这种形式的分配： <br><br><ul><li> 在每个单元格中，我们展示了一个产品，必须定义其类别 </li><li> 由我们以前的模型之一定义的假设类别 </li><li> 响应字段（如果建议的类别不正确） </li></ul><br> 我们创建了带有示例的详细说明，这些示例解释了每个类别的功能，还使用了质量控制方法：带有标准答案的集合以及常规任务（我们自己实施了标准答案，标记了数百种产品）。 根据这些任务的答案结果，排除了错误地标记数据的用户。 但是，对于整个项目，我们仅禁止了600多个用户中的三个。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fx/ib/xt/fxibxt-v5h7vouodjoffwtl6egy.png"></div><br> 有了新数据，我们得到了一个更适合我们数据的模型，准确性提高了一点（〜11％），已经达到了92％。 <br><br><h2> 最终模型 </h2><br> 我们使用来自Kaggle的多个数据集的数据组合-74％来开始分类过程，此后，我们改进了预处理-81％，收集了新数据集-92％，最后改进了分类过程：最初，使用逻辑回归我们获得商品归因的初步概率SGD使基于产品名称的类别更加准确，但是损失函数的值仍然很大，这严重影响了最终分类器的结果。 此外，我们将获得的数据与产品上的其他数据（产品价格，购买商店，商店的统计信息，支票和其他元信息）相结合，并对XGBoost进行了所有这些数据量的训练，其准确性达到了98％（提高了另外6％）。 事实证明，培训样本的质量做出了最大的贡献。 <br><br><h2> 在服务器上运行 </h2><br> 为了加快部署，我们在Flask上将一个简单的服务器提升到了Docker。 有一种方法是从服务器接收需要分类的商品，然后退还带有类别的商品。 因此，我们可以轻松地集成到以Tomcat为中心的现有系统中，而不必对体系结构进行更改-我们只需向其添加一个块即可。 <br><br><h2> 发布日期 </h2><br> 几周前，我们在Google Play上发布了一个分类发行版（过一会儿就会出现在App Store上）。 原来是这样的： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h1/tj/ie/h1tjiekixykrb_liuwftfnd8ufy.png" width="50%"></div><br> 在将来的版本中，我们计划增加纠正类别的功能，这将使我们能够快速收集分类错误并重新训练分类模型（同时我们自己完成）。 <br><br> 在Kaggle提及的比赛： <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.kaggle.com/c/receipt-categorisation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.kaggle.com/c/market-basket-analysis</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.kaggle.com/c/prod-price-prediction</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN430216/">https://habr.com/ru/post/zh-CN430216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN430204/index.html">麻省理工学院的课程“计算机系统安全”。 讲座18：“私人互联网浏览”，第1部分</a></li>
<li><a href="../zh-CN430206/index.html">麻省理工学院的课程“计算机系统安全”。 第18课：私人浏览Internet，第2部分</a></li>
<li><a href="../zh-CN430208/index.html">麻省理工学院的课程“计算机系统安全”。 讲座18：“私人互联网浏览”，第3部分</a></li>
<li><a href="../zh-CN430210/index.html">Check Point安全学院测试我的耐心</a></li>
<li><a href="../zh-CN430212/index.html">OpenSceneGraph：场景几何基础</a></li>
<li><a href="../zh-CN430218/index.html">能源优化STM32：实用指南</a></li>
<li><a href="../zh-CN430220/index.html">如何将“百年纪念” USB集线器变成智能托管并节省300美元</a></li>
<li><a href="../zh-CN430222/index.html">寻找工作的高级工程师。 我如何接受20次人力资源采访以​​及对此的看法</a></li>
<li><a href="../zh-CN430224/index.html">精神分裂症：内在外观</a></li>
<li><a href="../zh-CN430226/index.html">从var b到面试</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>