<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦎 👨🏾‍🏫 👩🏾‍✈️ Como tornar um aplicativo React mais rápido com a co-hospedagem do estado 👃🏾 👩🏻‍🏫 🔠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O artigo é sobre a colocação do estado , ou seja, sobre a colocação conjunta dos estados , esse termo ainda pode ser traduzido como colocação do estad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como tornar um aplicativo React mais rápido com a co-hospedagem do estado</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485032/"><p>  <em>O artigo é sobre a <strong>colocação do estado</strong> , ou seja, sobre a <strong>colocação conjunta dos estados</strong> , esse termo ainda pode ser traduzido como <strong>colocação do estado</strong> ou <strong>colocação do estado</strong> .</em> </p><br><p>  Um dos principais motivos para desacelerar um aplicativo React é o seu estado global.  Mostrarei isso com um exemplo de aplicação muito simples, após o qual darei um exemplo mais próximo da vida real. </p><br><p>  Aqui está um aplicativo simples no qual você pode inserir um nome para o cachorro (se a janela não funcionar, <a href="https://uy9h3.csb.app/">aqui está o link</a> ): </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p> Se você jogar com este aplicativo, em breve descobrirá que ele funciona muito lentamente.  Ao interagir com qualquer campo de entrada, há problemas visíveis de desempenho.  Em tal situação, você pode usar uma bóia salva-vidas na forma de <code>React.memo</code> e envolvê-la com todos os componentes com uma renderização lenta.  Mas vamos tentar resolver esse problema de maneira diferente. </p><br><p>  Aqui está o código para este aplicativo: </p><a name="habracut"></a><br><pre> <code class="xml hljs">function sleep(time) { const done = Date.now() + time while (done &gt; Date.now()) { // ... } } //      // -       function SlowComponent({time, onChange}) { sleep(time) return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> Wow, that was{' '} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> onChange(Number(e.target.value))} /&gt; ms slow <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function DogName({time, dog, onChange}) { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> onChange(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function App() { //   " " (global state) const [dog, setDog] = React.useState('') const [time, setTime] = React.useState(200) return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setDog}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SlowComponent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setTime}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  Se você não leu o artigo sobre <a href="https://kentcdodds.com/blog/colocation">Colocation</a> (co-localização), sugiro que você o leia.  Sabendo que a co-hospedagem pode facilitar o trabalho com nosso aplicativo, vamos usar esse princípio ao trabalhar com estados. </p><br><p>  Preste atenção ao código do nosso aplicativo, ou seja, o estado do <code>time</code> - ele é usado por cada componente do aplicativo, portanto, foi elevado ( <a href="https://ru.reactjs.org/docs/lifting-state-up.html">elevando - elevando o estado</a> ) ao componente <code>App</code> (o componente que envolve todo o aplicativo).  No entanto, o estado "dog" ( <code>dog</code> e <code>setDog</code> ) é usado por apenas um componente, não é necessário no componente <code>App</code> , então vamos movê-lo para o componente <code>DogName</code> : </p><br><pre> <code class="xml hljs">function DogName({time}) { // <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span><span class="hljs-tag">    </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">setDog</span></span></span><span class="hljs-tag">] = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">React.useState(</span></span></span><span class="hljs-tag">'') // &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span><span class="hljs-tag">   </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span><span class="hljs-tag"> ( &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> setDog(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function App() { //   " " (global state) const [time, setTime] = React.useState(200) return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> /&gt;</span></span> // <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span><span class="hljs-tag">    &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SlowComponent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setTime}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  E aqui está o nosso resultado (se a janela não funcionar, <a href="https://9nqld.csb.app/">link</a> ): </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Uau!  Digitar um nome agora funciona MUITO mais rápido.  Além disso, o componente ficou mais fácil de manter, graças à co-localização.  Mas por que funcionou mais rápido? </p><br><p>  Eles dizem que a melhor maneira de fazer algo rapidamente é fazer o mínimo possível de coisas.  É exatamente o que está acontecendo aqui.  Quando gerenciamos o estado localizado na parte superior da árvore de componentes, cada atualização desse estado invalida a árvore inteira.  A reação não sabe o que mudou, por isso, ele precisa verificar todos os componentes para ver se precisam de atualizações do DOM.  Esse processo não é gratuito e consome recursos (especialmente se você tiver componentes intencionalmente lentos).  Mas se você mover o estado o mais baixo possível na árvore de componentes, como fizemos com o estado do <code>dog</code> e o componente <code>DogName</code> , o React fará menos verificações.  O React não verificará o componente <code>SlowComponent</code> (que <code>SlowComponent</code> deliberadamente), pois o React sabe que esse componente ainda não pode afetar a saída. </p><br><p>  Em suma, anteriormente, ao alterar o nome do cão, cada componente era verificado quanto a alterações (renderizadas novamente).  E após as alterações que fizemos no código, o React começou a verificar apenas o componente <code>DogName</code> .  Isso levou a um aumento acentuado da produtividade! </p><br><h2 id="v-realnoy-zhizni">  Na vida real </h2><br><p>  Vejo que os desenvolvedores estão colocando no repositório global Redux ou no contexto global o que realmente não deveria ser global.  <code>DogName</code> como o <code>DogName</code> do exemplo acima geralmente são locais onde ocorre um problema de desempenho.  Vejo frequentemente que esse problema se manifesta ao interagir com o mouse (por exemplo, ao exibir uma dica de ferramenta acima de um gráfico ou acima de uma tabela de dados). </p><br><p>  Uma solução para esse problema é "cancelar" a interação do usuário (ou seja, aguardamos até que o usuário pare de digitar e aplicamos a atualização de estado).  Às vezes, é o melhor que podemos fazer, mas pode levar a uma experiência ruim do usuário (o modo simultâneo futuro deve minimizar a necessidade de fazer <a href="https://youtu.be/nLF0n9SACd4%3Ft%3D181">isso</a> . <a href="https://youtu.be/nLF0n9SACd4%3Ft%3D181">Veja esta demonstração de Dan Abramov</a> ). </p><br><p>  Outra solução que os desenvolvedores costumam usar é usar uma das renderizações de resgate do React, por exemplo, <code>React.memo</code> .  Isso funcionará muito bem em nosso exemplo rebuscado, pois permite que o React pule a nova renderização do <code>SlowComponent</code> , mas, na prática, o aplicativo pode sofrer “morte de mil cortes”, pois em um aplicativo real, o abrandamento geralmente não é devido a um lento componente, e devido ao trabalho insuficientemente rápido de muitos componentes, você deve usar o <code>React.memo</code> em <code>React.memo</code> lugar.  Feito isso, você terá que começar a usar <code>useMemo</code> e <code>useCallback</code> , caso contrário, todo o trabalho que você colocar no <code>React.memo</code> será em vão.  Essas ações podem resolver o problema, mas aumentam significativamente a complexidade do seu código e, de fato, ainda são menos eficazes do que compartilhar estados, pois o React precisa passar por cada componente (começando do topo) para determinar se precisa ser renderizado novamente. </p><br><p>  Se você quiser brincar com um exemplo um pouco menos <a href="https://codesandbox.io/s/colocate-state-ts1x9">absurdo</a> , <a href="https://codesandbox.io/s/colocate-state-ts1x9">vá para codesandbox aqui</a> . </p><br><h2 id="chto-takoe-sovmestnoe-razmeschenie-sostoyaniy">  O que é co-localização? </h2><br><p>  O princípio da <a href="https://kentcdodds.com/blog/colocation">colocação conjunta</a> afirma: </p><br><blockquote>  O código deve estar localizado o mais próximo possível do local a que se refere. </blockquote><p>  Portanto, para cumprir esse princípio, nosso estado de <code>dog</code> deve estar <em>dentro</em> do componente <code>DogName</code> : </p><br><pre> <code class="xml hljs">function DogName({time}) { const [dog, setDog] = React.useState('') return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> setDog(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  Mas e se quebrarmos esse componente em vários componentes?  Para onde deveria ir o estado?  A resposta é a mesma: "o mais próximo possível do local a que se refere", e esse será o <strong>componente pai comum mais próximo</strong> .  Como exemplo, vamos dividir o componente <code>DogName</code> que a <code>input</code> <code>p</code> exibida em diferentes componentes: </p><br><pre> <code class="xml hljs">function DogName({time}) { const [dog, setDog] = React.useState('') return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogInput</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setDog}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogFavoriteNumberDisplay</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function DogInput({dog, onChange}) { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> onChange(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/&gt;</span></span> ) } function DogFavoriteNumberDisplay({time, dog}) { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  Não podemos mover o estado para o componente <code>DogInput</code> , porque o componente <code>DogFavoriteNumberDisplay</code> também precisa de acesso ao estado, portanto, movemos da parte inferior para a parte superior da árvore de componentes até encontrarmos o elemento pai comum desses dois componentes e organizarmos o gerenciamento de estado nele. </p><br><p>  Tudo isso se aplica a situações em que você precisa controlar o estado de dezenas de componentes em uma tela específica do seu aplicativo.  Você pode até mover isso para o contexto para evitar a <a href="https://kentcdodds.com/blog/prop-drilling">perfuração de suporte,</a> se desejar.  Mas mantenha esse contexto o mais próximo possível do local ao qual ele pertence e, em seguida, você continuará mantendo o bom desempenho (e a usabilidade do código) fornecido pelo compartilhamento.  Lembre-se de que você não precisa colocar <em>todos os</em> contextos no nível superior do seu aplicativo React.  Mantenha-os onde faz mais sentido. </p><br><p>  Esta é a ideia principal do meu outro post, <a href="https://kentcdodds.com/blog/application-state-management-with-react">Application State Management with React</a> .  Mantenha seus estados o mais próximo possível do local em que são usados, isso melhorará o desempenho e a usabilidade do código.  Com essa abordagem, a única coisa que possivelmente piorará o desempenho do seu aplicativo são interações especialmente complexas com os elementos da interface. </p><br><h2 id="tak-chto-ispolzovat-konteksty-ili-redux">  Então, o que usar, contextos ou Redux? </h2><br><p>  Se você ler <a href="https://kentcdodds.com/blog/optimize-react-re-renders">"Um truque simples para otimizar as novas renderizações do React"</a> , saberá que pode garantir que apenas os componentes que usam o estado alterado sejam atualizados.  Dessa forma, você pode solucionar esse problema.  Mas as pessoas ainda enfrentam problemas de desempenho ao usar o Editor.  O problema é <a href="https://react-redux.js.org/using-react-redux/connect-mapstate">que o React-Redux espera que você siga suas recomendações para evitar a renderização desnecessária dos componentes conectados</a> .  Sempre há uma chance de erro; você pode configurar acidentalmente componentes para que eles comecem a renderizar com frequência quando outros estados globais forem alterados.  E quanto maior o seu aplicativo, mais negativo será o efeito, especialmente se você adicionar muitos estados ao Editor. </p><br><p>  Existem métodos que podem ajudá-lo a evitar esses problemas, por exemplo, use <a href="https://blog.isquaredsoftware.com/2018/11/react-redux-history-implementation/"><code>memoized Reselect     mapState</code></a> ou leia a <a href="https://redux.js.org/faq">documentação</a> do <a href="https://redux.js.org/faq">Editor para obter mais informações sobre como melhorar o desempenho do aplicativo</a> . </p><br><p>  Vale ressaltar que a co-colocação pode ser aplicada em conjunto com o Editor.  Apenas use Editores apenas para estados globais e, para todo o resto, use co-localização.  Existem <a href="https://redux.js.org/faq/organizing-state">algumas regras úteis nas</a> Perguntas frequentes do editor <a href="https://redux.js.org/faq/organizing-state">para ajudar você a decidir se o estado deve funcionar no Editor ou se deve permanecer no componente</a> . </p><br><p>  A propósito, se você dividir seu estado em domínios (usando vários contextos, dependendo do domínio), o problema será menos pronunciado. </p><br><p>  Mas o fato permanece: a co-localização de estados reduz os problemas de desempenho e simplifica a manutenção do código. </p><br><h2 id="prinimaem-reshenie-o-tom-kuda-pomestit-sostoyanie">  Decida onde colocar o estado </h2><br><p>  Árvore de decisão: </p><br><p><img src="https://habrastorage.org/webt/oj/z8/pt/ojz8ptwezz3qmxqicorsrsh1bku.jpeg" alt="onde colocar"></p><br><p>  Versão em texto, se não houver como ver a figura: </p><br><ul><li>  1 Começamos o desenvolvimento do aplicativo.  Vá para 2 </li><li>  2 Status no componente.  Ir para 3 </li><li>  3 A condição é usada <strong>apenas por</strong> este componente? <br><ul><li>  Hein?  Vamos para 4 </li><li>  Não?  Esse estado <strong>precisa de</strong> apenas <em>um</em> componente filho? </li><li>  Hein?  Mova-o para este componente filho (use co-location).  Vamos para o 3. </li><li>  Não?  Esse estado precisa de componentes pais ou vizinhos (componentes "fraternos", isto é, filhos do mesmo componente pai)? <br><ul><li>  Hein?  Mova o estado acima para o componente pai.  Ir para 3 </li><li>  Não?  Vamos para 4 </li></ul></li></ul></li><li>  4 Deixe como está.  Ir para 5 </li><li>  5 Existe um problema com a perfuração de suporte? <br><ul><li>  Hein?  Movemos esse estado para o provedor de contexto e o renderizamos no componente em que o estado está sendo gerenciado.  Vá para 6 </li><li>  Não?  Vá para 6 </li></ul></li><li>  6 Nós enviamos o aplicativo.  Quando novos requisitos aparecerem, vá para 1 </li></ul><br><p>  É importante que esse processo faça parte do processo regular de refatoração / manutenção de aplicativos.  Se sua condição não for levantada onde deveria ser levantada, esse estado deixará de funcionar corretamente e você perceberá.  No entanto, se você não seguir o método de co-localização de estados e não diminuir os estados mais baixos na hierarquia de componentes, seu aplicativo continuará funcionando.  Por esse motivo, você não notará imediatamente problemas de desempenho e capacidade de gerenciamento que se acumularão gradualmente. </p><br><h2 id="zaklyuchenie">  Conclusão </h2><br><p>  Em geral, os desenvolvedores entendem muito bem quando é necessário elevar o estado ("estado de elevação") quando necessário, mas não entendemos bem quando o estado precisa ser baixado.  Sugiro que você dê uma olhada no código do seu aplicativo e pense em onde o estado pode ser omitido aplicando o princípio de "co-localização".  Pergunte a si mesmo: "Preciso do estado <code>isOpen</code> de uma janela modal no Editor?"  (a resposta provavelmente não). </p><br><p>  Use o princípio da co-localização e seu código se tornará mais fácil e rápido. </p><br><p>  Boa sorte </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt485032/">https://habr.com/ru/post/pt485032/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt485022/index.html">Playme Sigma: DVR funcional e acessível</a></li>
<li><a href="../pt485024/index.html">O que há por trás das otimizações do compilador GraalVM?</a></li>
<li><a href="../pt485026/index.html">Oportunidades da Geórgia para profissionais de TI</a></li>
<li><a href="../pt485028/index.html">CRM 2020</a></li>
<li><a href="../pt485030/index.html">As 8 principais taxas de IEO e sua capitalização agora</a></li>
<li><a href="../pt485034/index.html">Automatizando a compilação de um projeto Qt no Windows no Travis CI</a></li>
<li><a href="../pt485036/index.html">Por que preciso de suporte instrumental para paginação de chaves</a></li>
<li><a href="../pt485042/index.html">Devido ao suporte obrigatório a 5G, smartphones com Snapdragon 865 serão piores em 2020</a></li>
<li><a href="../pt485044/index.html">Desmontamos o relógio digital da sonda Soyuz</a></li>
<li><a href="../pt485046/index.html">Como planejar uma estratégia de produto vencedora</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>