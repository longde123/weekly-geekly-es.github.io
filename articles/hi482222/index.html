<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯФо ЁЯдЬЁЯП╗ ЁЯЪ┤ЁЯП╛ Kotlin + рд╕реНрдкреНрд░рд┐рдВрдЧ рдмреВрдЯ + Vue.js (рдРрдб-рдСрди) рдкрд░ рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧ ЁЯзЧЁЯП╛ ЁЯзЦЁЯП╗ ЁЯЦНя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╢реБрдн рджреЛрдкрд╣рд░, рд╣реЗрдмрд░ рдХреЗ рдкреНрд░рд┐рдп рдирд┐рд╡рд╛рд╕рд┐рдпреЛрдВ! 

 рдЬреИрд╕рд╛ рдХрд┐ рдирд╛рдо рд╕реЗ рд╣реА рд╕реНрдкрд╖реНрдЯ рд╣реИ, рдпрд╣ рд▓реЗрдЦ рдХреЛрдЯрд▓рд┐рди + рд╕реНрдкреНрд░рд┐рдВрдЧ рдмреВрдЯ + рд╡реАрдпреВ.рдЬреЗрдПрд╕ рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд▓рд┐рдЦреЗ рдЧрдП рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЕрддрд┐рд░рд┐...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kotlin + рд╕реНрдкреНрд░рд┐рдВрдЧ рдмреВрдЯ + Vue.js (рдРрдб-рдСрди) рдкрд░ рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482222/">  рд╢реБрдн рджреЛрдкрд╣рд░, рд╣реЗрдмрд░ рдХреЗ рдкреНрд░рд┐рдп рдирд┐рд╡рд╛рд╕рд┐рдпреЛрдВ! <br><br>  рдЬреИрд╕рд╛ рдХрд┐ рдирд╛рдо рд╕реЗ рд╣реА рд╕реНрдкрд╖реНрдЯ рд╣реИ, рдпрд╣ рд▓реЗрдЦ <a href="https://habr.com/ru/post/467161/">рдХреЛрдЯрд▓рд┐рди + рд╕реНрдкреНрд░рд┐рдВрдЧ рдмреВрдЯ + рд╡реАрдпреВ.рдЬреЗрдПрд╕ рдкрд░</a> рдкрд╣рд▓реЗ рд╕реЗ рд▓рд┐рдЦреЗ рдЧрдП <a href="https://habr.com/ru/post/467161/">рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ</a> рдЕрддрд┐рд░рд┐рдХреНрдд рд╣реИ, рдЬреЛ рд╣рдореЗрдВ рднрд╡рд┐рд╖реНрдп рдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдХрдВрдХрд╛рд▓ рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЖрд╕рд╛рди рдмрдирд╛рддрд╛ рд╣реИред <br><a name="habracut"></a><br>  рдХрд╣рд╛рдиреА рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдореИрдВ рдЙрди рд╕рднреА рдХреЛ рдзрдиреНрдпрд╡рд╛рдж рджреЗрддрд╛ рд╣реВрдВ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рдореЗрдВ рдЯрд┐рдкреНрдкрдгреА рдХреА рдереАред <br><br><h3>  рд╕рд╛рдордЧреНрд░реА </h3><br><ul><li>  <a href="https://habr.com/ru/post/482222/">рд╕реАрдЖрдИ / рд╕реАрдбреА рд╕реЗрдЯрдЕрдк (рд╣рд░реЛрдХреВ)</a> </li><li>  <a href="https://habr.com/ru/post/482222/">рдмреЙрдЯ рд╕рдВрд░рдХреНрд╖рдг (reCAPTCHA)</a> </li><li>  <a href="https://habr.com/ru/post/482222/">рдИрдореЗрд▓ рднреЗрдЬрдирд╛</a> </li><li>  <a href="https://habr.com/ru/post/482222/">рдЧреНрд░реЗрдбрд┐рдВрдЧ рдорд╛рдЗрдЧреНрд░реЗрд╢рди</a> </li><li>  <a href="https://habr.com/ru/post/482222/">рдХреБрдХреАрдЬрд╝ рдореЗрдВ рднрдВрдбрд╛рд░рдг JWT рдЯреЛрдХрди</a> </li><li>  <a href="https://habr.com/ru/post/482222/">рдИрдореЗрд▓ рдкрдВрдЬреАрдХрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐</a> </li><li>  <a href="https://habr.com/ru/post/482222/">рдЙрдкрдпреЛрдЧреА рд▓рд┐рдВрдХ</a> </li></ul><br><a name="cicd"></a><br><h2>  рд╕реАрдЖрдИ / рд╕реАрдбреА рд╕реЗрдЯрдЕрдк (рд╣рд░реЛрдХреВ) </h2><br>  рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ <a href="https://www.heroku.com/" rel="nofollow">рд╣рд░реЛрдХреВ</a> рдХреНрд▓рд╛рдЙрдб PaS рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рд░рдВрддрд░ рдПрдХреАрдХрд░рдг рдФрд░ рд╡рд┐рддрд░рдг рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред <br><br>  рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рд╣рдореЗрдВ рдХрд░рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ рд╡рд╣ рдЧрд┐рдЯрд╣рдм рдкрд░ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛрдб <a href="https://github.com/" rel="nofollow">рдбрд╛рд▓рддреА рд╣реИ</a> ред  рддрд╛рдХрд┐ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдХреБрдЫ рднреА рдХрдо рдирд╣реАрдВ рд╣реЛ, рдореИрдВ <i>.ignignore</i> рдлрд╛рдЗрд▓ рдХреА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддрд╛ рд╣реВрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">.gitignore</b> <div class="spoiler_text"><pre><code class="plaintext hljs">*.class # Help # backend/*.md # Package Files # *.jar *.war *.ear # Eclipse # .settings .project .classpath .studio target # NetBeans # backend/nbproject/private/ backend/nbbuild/ backend/dist/ backend/nbdist/ backend/.nb-gradle/ backend/build/ # Apple # .DS_Store # Intellij # .idea *.iml *.log # logback logback.out.xml backend/src/main/resources/public/ backend/target backend/.mvn backend/mvnw frontend/dist/ frontend/node/ frontend/node_modules/ frontend/npm-debug.log frontend/target !.mvn/wrapper/maven-wrapper.jar</code> </pre> <br></div></div><br>  <u>рдорд╣рддреНрд╡рдкреВрд░реНрдг:</u> <i>рд╣рд░реЛрдХреВ рдХреЗ</i> рд╕рд╛рде рдХрд╛рдо рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд▓рд╛рдЗрди рдХреЗ рд╕рд╛рде рд░реВрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ <i>Proffile</i> (рдмрд┐рдирд╛ рдХрд┐рд╕реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ) рдирд╛рдордХ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЬреЛрдбрд╝реЗрдВ: <br>  <code>web: java -Dserver.port=$PORT -jar backend/target/backend-0.0.1-SNAPSHOT.jar</code> , рдЬрд╣рд╛рдВ <i>рдмреИрдХрдПрдВрдб-</i> <code>web: java -Dserver.port=$PORT -jar backend/target/backend-0.0.1-SNAPSHOT.jar</code> JAR рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рд╣реИред  рдФрд░ <u>рдХрдорд┐рдЯрдореЗрдВрдЯ рдФрд░ рдкреБрд╢рдЕрдк</u> рдЬрд░реВрд░ рдХрд░реЗрдВред <br><br>  <u>рдиреЛрдЯ:</u> рдЖрдк Heroff рдкрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди рд╕рдордп рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореВрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ travis.yaml рдлрд╝рд╛рдЗрд▓ рднреА рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">travis.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">language: java jdk: - oraclejdk8 script: mvn clean install jacoco:report coveralls:report cache: directories: - node_modules</code> </pre> <br></div></div><br>  рддреЛ: <br><br>  <a href="https://www.heroku.com/" rel="nofollow">рд╣реЗрд░реЛрдХреВ рдореЗрдВ</a> <b># 1</b> рд░рдЬрд┐рд╕реНрдЯрд░ред <br><br>  <b># 2</b> рдПрдХ рдирдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдПрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">рдПрдХ рдирдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдПрдВ</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/u3/ml/bx/u3mlbx0w2ho3uezsrl75nyse2m4.png"><br></div></div><br>  <b># 3</b> рд╣рд░реЛрдХреВ рдЖрдкрдХреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЗ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреЛрд╕реНрдЯрд░реЗрдХреНрдпреВрдПрд▓ рдбреЗрдЯрд╛рдмреЗрд╕ред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдХрд░реЗрдВ: <i>рдПрдкреНрд▓рд┐рдХреЗрд╢рди -&gt; рд╕рдВрд╕рд╛рдзрди -&gt; рдРрдб-рдСрди -&gt; рд╣рд░реЛрдХреВ рдкреЛрд╕реНрдЯрдЧреНрд░реИрдЬреЗрд╕</i> : <br><br><div class="spoiler">  <b class="spoiler_title">рд╣рд░реЛрдХреВ рдкреЛрд╕реНрдЯрдЧреНрд░реЗрдЯ рдХрд░рддрд╛ рд╣реИ</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/k5/l8/ht/k5l8htgji3kaxmqyznbdqhyeuki.png"><br></div></div><br>  <b># 4</b> рдПрдХ рдпреЛрдЬрдирд╛ рдЪреБрдиреЗрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">рдпреЛрдЬрдирд╛ рдЪрдпрди</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/id/jv/vd/idjvvdwyyk9ou_wbes00mxvfdac.png"><br></div></div><br>  <b># 5</b> рдЕрдм рдЖрдк рдЬреБрдбрд╝реЗ рд╣реБрдП рд╕рдВрд╕рд╛рдзрди рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╕рдВрд╕рд╛рдзрди</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/l2/mx/mf/l2mxmf3itjef2-1lpiwmltrtadq.png"><br></div></div><br>  <b># 6</b> рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рджреЗрдЦреЗрдВ, рдЙрдиреНрд╣реЗрдВ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА: <i>рд╕реЗрдЯрд┐рдВрдЧреНрд╕ -&gt; рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рджреЗрдЦреЗрдВ</i> : <br><br><div class="spoiler">  <b class="spoiler_title">рд╕рд╛рдЦ рджреЗрдЦреЗрдВ</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gh/xl/v9/ghxlv99r9m2mgrr6ceemgpn-hjg.png"><br></div></div><br>  <b># 7</b> рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рд╕реЗрдЯ рдХрд░реЗрдВ: <i>рдЕрдиреБрдкреНрд░рдпреЛрдЧ -&gt; рд╕реЗрдЯрд┐рдВрдЧреНрд╕ -&gt; рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рд╡рд╛рд░реНрд╕ рдкреНрд░рдХрдЯ рдХрд░реЗрдВ</i> : <br><br><div class="spoiler">  <b class="spoiler_title">рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xr/uj/q8/xrujq8lynqi6kqoqtqiklpwbaxu.png"><br></div></div><br>  <b># 8</b> рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рд╕реЗрдЯ рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">SPRING_DATASOURCE_URL = jdbc:postgresql://&lt;i&gt;hostname:port&lt;/i&gt;/&lt;i&gt;db_name&lt;/i&gt; SPRING_DATASOURCE_USERNAME = &lt;i&gt;username&lt;/i&gt; SPRING_DATASOURCE_PASSWORD = &lt;i&gt;password&lt;/i&gt;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">рдпрд╣ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/me/jr/ne/mejrnecja54rgwchq6peumbc6w0.png"><br></div></div><br>  <b># 9</b> рдирдП рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдЯреЗрдмрд▓ рдмрдирд╛рдПрдВред <br><br>  <b># 10</b> рдХреНрд░рдорд╢рдГ Application.properties рдлрд╝рд╛рдЗрд▓, рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП: <br><br><div class="spoiler">  <b class="spoiler_title">application.properties</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">spring.datasource.url=${SPRING_DATASOURCE_URL} spring.datasource.username=${SPRING_DATASOURCE_USERNAME} spring.datasource.password=${SPRING_DATASOURCE_PASSWORD} spring.jpa.generate-ddl=true spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults = false spring.jpa.database-platform=org.hibernate.dialect.PostgreSQL9Dialect spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true</code> </pre><br></div></div><br>  <b># 11</b> рдПрдХ <i>рдирдИ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдПрдБ</i> - <i>рдирдИ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдПрдБ</i> : <br><br><div class="spoiler">  <b class="spoiler_title">рдирдИ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдПрдВ</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dh/sg/wb/dhsgwbhgaz9arzl4lgwkdoykeda.png"><br></div></div><br>  <b># 12</b> рдкрд░рд┐рдирд┐рдпреЛрдЬрди рд╡рд┐рдзрд┐ - <i>GitHub</i> ( <i>GitHub рд╕реЗ</i> <i>рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ рдкрд░</i> рдХреНрд▓рд┐рдХ <i>рдХрд░реЗрдВ</i> рдФрд░ рдирдИ рд╡рд┐рдВрдбреЛ рдореЗрдВ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ)ред <br><br>  <b># 13</b> <i>рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдбрд┐рдкреНрд▓реЙрдпрдЬрд╝ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ</i> : <br><br><div class="spoiler">  <b class="spoiler_title">рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдбрд┐рдкреНрд▓реЙрдпрдЬрд╝ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8e/fb/ui/8efbuinhnr0y1j7eggqkhbjae2s.png"><br></div></div><br>  <b># 14</b> рдореИрдиреБрдЕрд▓ рддреИрдирд╛рддреА - рдкрд╣рд▓реА рддреИрдирд╛рддреА рдХреЗ рд▓рд┐рдП <i>рддреИрдирд╛рддреА рд╢рд╛рдЦрд╛ рдкрд░</i> рдХреНрд▓рд┐рдХ <i>рдХрд░реЗрдВ</i> ред  рдмреНрд░рд╛рдЙрдЬрд░ рдореЗрдВ рд░рд╛рдЗрдЯ рдЖрдкрдХреЛ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред <br><br><div class="spoiler">  <b class="spoiler_title">рдореИрдиреБрдЕрд▓ рдХреА рддреИрдирд╛рддреА</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/7i/5m/tz/7i5mtzam___vhonxjbtuogrg-ay.png"><br></div></div><br>  <b># 15</b> рддреИрдирд╛рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдлрд▓ рдирд┐рд░реНрдорд╛рдг рдХреЗ рдмрд╛рдж <i>рджреЗрдЦреЗрдВ</i> рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">рд░рд╛рдп</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cp/p-/fr/cpp-frnkeudluh4bm1ir-f4oi10.png"><br></div></div><br><a name="recaptcha"></a><br><h2>  рдмреЙрдЯ рд╕рдВрд░рдХреНрд╖рдг (reCAPTCHA) </h2><br>  рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдореЗрдВ reCAPTCHA рд╕рддреНрдпрд╛рдкрди рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓рд╛ рдХрджрдо <a href="https://www.google.com/recaptcha/intro/v3.html" rel="nofollow">Google рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдкреИрдирд▓</a> рдореЗрдВ рдПрдХ рдирдпрд╛ reCAPTCH рдмрдирд╛рдирд╛ рд╣реИред  рд╡рд╣рд╛рдВ рд╣рдо рдПрдХ рдирдИ рд╕рд╛рдЗрдЯ рдмрдирд╛рддреЗ рд╣реИрдВ (рдирдИ рд╕рд╛рдЗрдЯ рдЬреЛрдбрд╝реЗрдВ / рдмрдирд╛рдПрдВ) рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╕реЗрдЯ рдХрд░реЗрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">ReCAPTCHA рд╕реЗрдЯрд┐рдВрдЧреНрд╕</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xi/eh/rp/xiehrpgngjvxqvd1dq-4wp5gfqc.png"><br></div></div><br>  <i>рдбреЛрдореЗрди</i> рдЕрдиреБрднрд╛рдЧ рдореЗрдВ, рдЖрдкрдХреЛ рдЙрд╕ рдкрддреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд╣рд╛рдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓рд╛рдЗрд╡ рд╣реЛрдЧрд╛, рдЖрдкрдХреЛ <code>localhost</code> рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рддрд╛рдХрд┐ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рджреМрд░рд╛рди рдЖрдк рдЕрдкрдиреЗ рдЖрд╡реЗрджрди рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрдерддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░реЗрд╢рд╛рдирд┐рдпреЛрдВ рд╕реЗ рдмрдЪреЗрдВред <br><br>  <b>рдмреИрдХрдПрдВрдб</b> <br><br>  <i>рд╕рд╛рдЗрдЯ рдХреБрдВрдЬреА</i> рдФрд░ <i>рдЧреБрдкреНрдд рдХреБрдВрдЬреА</i> рд╕рд╣реЗрдЬреЗрдВ ... <br><br><div class="spoiler">  <b class="spoiler_title">рд╕рд╛рдЗрдЯ рдХреБрдВрдЬреА / рдЧреБрдкреНрдд рдХреБрдВрдЬреА</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hs/re/-t/hsre-ttxpgbhgau9q4fsvtdqxq0.png"><br></div></div><br>  ... рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░, рдФрд░ рдЪрд░ рдирд╛рдореЛрдВ рдХреЛ рд╕реМрдВрдкрдиреЗ рдХреЗ рд▓рд┐рдП, рдмрджрд▓реЗ рдореЗрдВ, рдирдП <i>application.properties</i> рдЧреБрдгреЛрдВ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: <br><br><pre> <code class="plaintext hljs">google.recaptcha.key.site=${GOOGLE_RECAPTCHA_KEY_SITE} google.recaptcha.key.secret=${GOOGLE_RECAPTCHA_KEY_SECRET}</code> </pre><br>  Google рдХреА рдУрд░ рд╕реЗ reCAPTCHA рдЯреЛрдХрди рдХреЗ рд╕рддреНрдпрд╛рдкрди рдХреЗ рд▓рд┐рдП <i>pom.xml</i> рдореЗрдВ рдПрдХ рдирдИ рдирд┐рд░реНрднрд░рддрд╛ рдЬреЛрдбрд╝реЗрдВ, рдЬреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рд╣рдореЗрдВ рднреЗрдЬреЗрдЧрд╛: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.mashape.unirest<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>unirest-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.4.9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  рдЕрдм рдЙрди рд╕рдВрд╕реНрдерд╛рдУрдВ рдХреЛ рдЕрджреНрдпрддрди рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ, рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдПрдХ рд╣реА reCAPTCHA рдЯреЛрдХрди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдлрд╝реАрд▓реНрдб рдЬреЛрдбрд╝рдХрд░ рдЕрдзрд┐рдХреГрдд рдФрд░ рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">LoginUser.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.fasterxml.jackson.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.JsonProperty <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.Serializable <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginUser</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Serializable { @JsonProperty</span></span></span></span>(<span class="hljs-string"><span class="hljs-string">"username"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> username: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"password"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"recapctha_token"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> recaptchaToken: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() {} <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(username: String, password: String, recaptchaToken: String) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.username = username <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password = password <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.recaptchaToken = recaptchaToken } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> serialVersionUID = -<span class="hljs-number"><span class="hljs-number">1764970284520387975L</span></span> } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">NewUser.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.fasterxml.jackson.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.JsonProperty <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.Serializable <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NewUser</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Serializable { @JsonProperty</span></span></span></span>(<span class="hljs-string"><span class="hljs-string">"username"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> username: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"firstName"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"lastName"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"email"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> email: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"password"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"recapctha_token"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> recaptchaToken: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() {} <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(username: String, firstName: String, lastName: String, email: String, password: String, recaptchaToken: String) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.username = username <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.firstName = firstName <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastName = lastName <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.email = email <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password = password <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.recaptchaToken = recaptchaToken } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> serialVersionUID = -<span class="hljs-number"><span class="hljs-number">1764970284520387975L</span></span> } }</code> </pre><br></div></div><br>  рдПрдХ рдЫреЛрдЯреА рд╕реЗрд╡рд╛ рдЬреЛрдбрд╝реЗрдВ рдЬреЛ reCAPTCHA рдЯреЛрдХрди рдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ Google рд╕реЗрд╡рд╛ рдореЗрдВ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░реЗрдЧреА рдФрд░ рдЬрд╡рд╛рдм рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░реЗрдЧреА рдХрд┐ рдЯреЛрдХрди рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">ReCaptchaService.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Value <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.stereotype.Service <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.client.RestOperations <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Autowired <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.mashape.unirest.http.HttpResponse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.mashape.unirest.http.JsonNode <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.mashape.unirest.http.Unirest <span class="hljs-meta"><span class="hljs-meta">@Service(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"captchaService"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReCaptchaService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> BASE_VERIFY_URL: String = <span class="hljs-string"><span class="hljs-string">"https://www.google.com/recaptcha/api/siteverify"</span></span> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> restTemplate: RestOperations? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${google.recaptcha.key.site}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keySite: String <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${google.recaptcha.key.secret}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keySecret: String <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateCaptcha</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url: String = String.format(BASE_VERIFY_URL + <span class="hljs-string"><span class="hljs-string">"?secret=%s&amp;response=%s"</span></span>, keySecret, token) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jsonResponse: HttpResponse&lt;JsonNode&gt; = Unirest.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(url) .header(<span class="hljs-string"><span class="hljs-string">"accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>).queryString(<span class="hljs-string"><span class="hljs-string">"apiKey"</span></span>, <span class="hljs-string"><span class="hljs-string">"123"</span></span>) .asJson() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (jsonResponse.getStatus() == <span class="hljs-number"><span class="hljs-number">200</span></span>) } }</code> </pre><br></div></div><br>  рдЗрд╕ рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрдВрдЬреАрдХрд░рдг рдФрд░ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдирд┐рдпрдВрддреНрд░рдХ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП: <br><br><div class="spoiler">  <b class="spoiler_title">AuthController.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.ReCaptchaService тАж <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> captchaService: ReCaptchaService тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(loginRequest.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>]... тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(newUser.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>...</code> </pre><br></div></div><br>  <b>рджреГрд╢реНрдпрдкрдЯрд▓</b> <br><br>  рдкрд╣рд▓рд╛ рдХрджрдо <code>reCAPTHA</code> рдкреИрдХреЗрдЬ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдФрд░ рд╕рд╣реЗрдЬрдирд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">$ npm install --save vue-recaptcha</code> </pre> <br>  рдлрд┐рд░ <i>index.html</i> рдореЗрдВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.google.com/recaptcha/api.js onload=vueRecaptchaApiLoaded&amp;render=explicit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  рдкреГрд╖реНрда рдкрд░ рдХрд┐рд╕реА рднреА рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдкрд░ рдХреЛрдИ рдХреИрдкреНрдЪрд╛ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vue-recaptcha</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"recaptcha"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"invisible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:sitekey</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sitekey"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">verify</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onCapthcaVerified"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">expired</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onCaptchaExpired"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  рдФрд░ рд▓рдХреНрд╖реНрдп рдХрд╛рд░реНрд░рд╡рд╛рдИ (рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдпрд╛ рдкрдВрдЬреАрдХрд░рдг) рдХреЗ рд▓рд┐рдП рдмрдЯрди рдЕрдм рдкрд╣рд▓реЗ рд╕рддреНрдпрд╛рдкрди рд╡рд┐рдзрд┐ рдХреЛ рдмреБрд▓рд╛рдПрдЧрд╛: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b-button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-on:click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"validateCaptcha"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">variant</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">&gt;</span></span>Login<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b-button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  рдШрдЯрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрднрд░рддрд╛ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VueRecaptcha <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'vue-recaptcha'</span></span></code> </pre> <br>  <i>рдирд┐рд░реНрдпрд╛рдд рдбрд┐рдлрд╝реЙрд▓реНрдЯ</i> рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ: <br><br><pre> <code class="javascript hljs">components: { VueRecaptcha }, тАж data() { тАж siteKey: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> тАж }</code> </pre><br>  рдФрд░ рдирдИ рд╡рд┐рдзрд┐рдпрд╛рдБ рдЬреЛрдбрд╝реЗрдВ: <br><br><ul><li>  <code>validateCaptcha()</code> - рдЬрд┐рд╕реЗ рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </li><li>  <code>onCapthcaVerified(recaptchaToken)  onCaptchaExpired()</code> - рдЬреЛ рд╕реНрд╡рдпрдВ рдХреИрдкреНрдЪрд╛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ </li></ul><br><div class="spoiler">  <b class="spoiler_title">рдирдП рддрд░реАрдХреЗ</b> <div class="spoiler_text"><pre> <code class="javascript hljs">validateCaptcha() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$refs.recaptcha.execute() }, onCapthcaVerified(recaptchaToken) { AXIOS.post(<span class="hljs-string"><span class="hljs-string">`/auth/signin`</span></span>, {<span class="hljs-string"><span class="hljs-string">'username'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$data.username, <span class="hljs-string"><span class="hljs-string">'password'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$data.password, <span class="hljs-string"><span class="hljs-string">'recapctha_token'</span></span>: recaptchaToken}) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$store.dispatch(<span class="hljs-string"><span class="hljs-string">'login'</span></span>, {<span class="hljs-string"><span class="hljs-string">'token'</span></span>: response.data.accessToken, <span class="hljs-string"><span class="hljs-string">'roles'</span></span>: response.data.authorities, <span class="hljs-string"><span class="hljs-string">'username'</span></span>: response.data.username}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$router.push(<span class="hljs-string"><span class="hljs-string">'/home'</span></span>) }, error =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showAlert(error.response.data.message); }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(e); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showAlert(<span class="hljs-string"><span class="hljs-string">'Server error. Please, report this error website owners'</span></span>); }) }, onCaptchaExpired() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$refs.recaptcha.reset() }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">рдкрд░рд┐рдгрд╛рдо</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m0/rc/w9/m0rcw9xjgqjqpgiuwdib16_mur8.png"><br></div></div><br><a name="email"></a><br><h2>  рдИрдореЗрд▓ рднреЗрдЬрдирд╛ </h2><br>  рдПрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдореЗрд▓ рд╕рд░реНрд╡рд░, рдЬреИрд╕реЗ Google рдпрд╛ Mail.ru рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдкрддреНрд░ рднреЗрдЬрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред <br><br>  рдкрд╣рд▓рд╛ рдЪрд░рдг, рдХреНрд░рдорд╢рдГ, рдЪрдпрдирд┐рдд рдореЗрд▓ рд╕рд░реНрд╡рд░ рдкрд░ рдПрдХ рдЦрд╛рддрд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрдЧрд╛, рдЕрдЧрд░ рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирд╣реАрдВ рд╣реИред <br><br>  рджреВрд╕рд░рд╛ рдЪрд░рдг рд╣рдореЗрдВ <i>pom.xml</i> рдореЗрдВ рдирд┐рдореНрди рдирд┐рд░реНрднрд░рддрд╛рдПрдБ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><div class="spoiler">  <b class="spoiler_title">рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-mail<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-thymeleaf<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>commons-io<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>commons-io<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  рдЖрдкрдХреЛ <i>application.properties рдореЗрдВ</i> рдирдП рдЧреБрдг рдЬреЛрдбрд╝рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><div class="spoiler">  <b class="spoiler_title">SMTP рдЧреБрдг</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">spring.mail.host=${SMTP_MAIL_HOST} spring.mail.port=${SMTP_MAIL_PORT} spring.mail.username=${SMTP_MAIL_USERNAME} spring.mail.password=${SMTP_MAIL_PASSWORD} spring.mail.properties.mail.smtp.auth=true spring.mail.properties.mail.smtp.starttls.enable=true spring.mail.properties.mail.smtp.ssl.enable=true spring.mail.properties.mail.smtp.connectiontimeout=5000 spring.mail.properties.mail.smtp.timeout=5000 spring.mail.properties.mail.smtp.writetimeout=5000</code> </pre><br></div></div><br>  рдЖрдк рдпрд╣рд╛рдВ SMTP рд╕реЗрдЯрд┐рдВрдЧ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <a href="https://support.google.com/mail/answer/7126229%3Fhl%3Dru" rel="nofollow">Google</a> рдФрд░ <a href="https://help.mail.ru/mail-help/mailer/popsmtp" rel="nofollow">Mail.ru</a> <br><br>  рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдмрдирд╛рдПрдБ рдЬрд╣рд╛рдБ рд╣рдо рдХрдИ рддрд░реАрдХреЗ рдШреЛрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ: <br><br><ul><li>  рдПрдХ рдирд┐рдпрдорд┐рдд рдкрд╛рда рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП </li><li>  HTML рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП </li><li>  рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП </li></ul><br><div class="spoiler">  <b class="spoiler_title">EmailService.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.email <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.SimpleMailMessage <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmailService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleMessageUsingTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, params:</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MutableMap</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any&gt;)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendHtmlMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, htmlMsg: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre><br></div></div><br>  рдЕрдм рдЖрдЗрдП рдЗрд╕ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдмрдирд╛рдПрдВ - рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рдХреА рд╕реЗрд╡рд╛: <br><br><div class="spoiler">  <b class="spoiler_title">EmailServiceImpl.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.email <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Autowired <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Value <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.core.io.FileSystemResource <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.MailException <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.SimpleMailMessage <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.javamail.JavaMailSender <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.javamail.MimeMessageHelper <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.stereotype.Component <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.thymeleaf.spring5.SpringTemplateEngine <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.thymeleaf.context.Context <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.mail.MessagingException <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.mail.internet.MimeMessage <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.commons.io.IOUtils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.core.env.Environment <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmailServiceImpl</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmailService { @Value</span></span></span></span>(<span class="hljs-string"><span class="hljs-string">"\${spring.mail.username}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sender: String <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> environment: Environment <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emailSender: JavaMailSender? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> templateEngine: SpringTemplateEngine <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> message = SimpleMailMessage() message.setTo(to) message.setFrom(sender) message.setSubject(subject) message.setText(text) emailSender!!.send(message) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (exception: MailException) { exception.printStackTrace() } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleMessageUsingTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, params:</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MutableMap</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> message = emailSender!!.createMimeMessage() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> helper = MimeMessageHelper(message, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> context: Context = Context() context.setVariables(params) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> html: String = templateEngine.process(template, context) helper.setTo(to) helper.setFrom(sender) helper.setText(html, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) helper.setSubject(subject) emailSender!!.send(message) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendHtmlMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, htmlMsg: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> message = emailSender!!.createMimeMessage() message.setContent(htmlMsg, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> helper = MimeMessageHelper(message, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) helper.setTo(to) helper.setFrom(sender) helper.setSubject(subject) emailSender!!.send(message) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (exception: MailException) { exception.printStackTrace() } } }</code> </pre><br></div></div><br><ul><li>  рд╣рдо рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдкреНрд░рд┐рдВрдЧ рдХреЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП JavaMailSender рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </li><li>  рдирд┐рдпрдорд┐рдд рдкрддреНрд░ рднреЗрдЬрдирд╛ рдмреЗрд╣рдж рд╕рд░рд▓ рд╣реИ - рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдкрддреНрд░ рдХреЗ рдореБрдЦреНрдп рднрд╛рдЧ рдореЗрдВ рдкрд╛рда рдЬреЛрдбрд╝рдиреЗ рдФрд░ рднреЗрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </li><li>  HTML рдИрдореЗрд▓ рдХреЛ Mime рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рдВрджреЗрд╢реЛрдВ рдФрд░ рдЙрдирдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ <code>text/html</code> рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ </li><li>  HTML рд╕рдВрджреЗрд╢ рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕реНрдкреНрд░рд┐рдВрдЧ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </li></ul><br>  рдЖрдЗрдП рдЗрд╕реЗ <i>src / main / resource / templates /</i> рдореЗрдВ рд░рдЦрдХрд░ <a href="https://www.thymeleaf.org/" rel="nofollow">Thymeleaf</a> рдлреНрд░реЗрдорд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рдЯреЗрдореНрдкрд▓реЗрдЯ рдмрдирд╛рдПрдБ: <br><br><div class="spoiler">  <b class="spoiler_title">emailTemplate.html</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/1999/xhtml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:th</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.thymeleaf.org"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Hello<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"font-family: Arial, Helvetica, sans-serif;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>Hello!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"margin-top: 20px; margin-bottom: 30px; margin-left: 20px;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Hello, dear: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">th:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${addresseeName}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">th:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${signatureImage}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200px;"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рдмрджрд▓рддреЗ рддрддреНрд╡ (рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкреНрд░рд╛рдкреНрддрдХрд░реНрддрд╛ рдХрд╛ рдирд╛рдо рдФрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЗ рд▓рд┐рдП рдЪрд┐рддреНрд░ рдХрд╛ рдорд╛рд░реНрдЧ) рдкреНрд▓реЗрд╕рд╣реЛрд▓реНрдбрд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдШреЛрд╖рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред <br><br>  рдЕрдм рдПрдХ рдирд┐рдпрдВрддреНрд░рдХ рдмрдирд╛рдПрдВ рдпрд╛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ рдЬреЛ рдкрддреНрд░ рднреЗрдЬреЗрдЧрд╛: <br><br><div class="spoiler">  <b class="spoiler_title">BackendController.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.email.EmailServiceImpl <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.web.response.ResponseMessage <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Value <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.ResponseEntity <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.HttpStatus тАж <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emailService: EmailService <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${spring.mail.username}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addressee: String тАж <span class="hljs-meta"><span class="hljs-meta">@GetMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/sendSimpleEmail"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@PreAuthorize(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hasRole('USER')"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { emailService.sendSimpleMessage(addressee, <span class="hljs-string"><span class="hljs-string">"Simple Email"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello! This is simple email"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Error while sending message"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Email has been sent"</span></span>), HttpStatus.OK) } <span class="hljs-meta"><span class="hljs-meta">@GetMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/sendTemplateEmail"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@PreAuthorize(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hasRole('USER')"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendTemplateEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> params:MutableMap&lt;String, Any&gt; = mutableMapOf() params[<span class="hljs-string"><span class="hljs-string">"addresseeName"</span></span>] = addressee params[<span class="hljs-string"><span class="hljs-string">"signatureImage"</span></span>] = <span class="hljs-string"><span class="hljs-string">"https://coderlook.com/wp-content/uploads/2019/07/spring-by-pivotal.png"</span></span> emailService.sendSimpleMessageUsingTemplate(addressee, <span class="hljs-string"><span class="hljs-string">"Template Email"</span></span>, <span class="hljs-string"><span class="hljs-string">"emailTemplate"</span></span>, params) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Error while sending message"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Email has been sent"</span></span>), HttpStatus.OK) } <span class="hljs-meta"><span class="hljs-meta">@GetMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/sendHtmlEmail"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@PreAuthorize(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hasRole('USER')"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendHtmlEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { emailService.sendHtmlMessage(addressee, <span class="hljs-string"><span class="hljs-string">"HTML Email"</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;h1&gt;Hello!&lt;/h1&gt;&lt;p&gt;This is HTML email&lt;/p&gt;"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Error while sending message"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Email has been sent"</span></span>), HttpStatus.OK) }</code> </pre><br></div></div><br>  <u>рдиреЛрдЯ:</u> рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдкрд╣рд▓реЗ рд╣рдо рдЦреБрдж рдХреЛ рдкрддреНрд░ рднреЗрдЬреЗрдВрдЧреЗред <br><br>  рдпрд╣ рднреА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд╣рдо рдПрдХ рдорд╛рдореВрд▓реА рд╡реЗрдм рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдмрд╕ рд╡реЗрдм рд╕реЗрд╡рд╛ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдЦреАрдВрдЪреЗрдЧрд╛: <br><br><div class="spoiler">  <b class="spoiler_title">Email.vue</b> <div class="spoiler_text"><pre> <code class="javascript hljs">&lt;template&gt; &lt;div id="email"&gt; &lt;b-button v-on:click="sendSimpleMessage" variant="primary"&gt;Simple Email&lt;/b-button&gt;&lt;br/&gt; &lt;b-button v-on:click="sendEmailUsingTemplate" variant="primary"&gt;Template Email&lt;/b-button&gt;&lt;br/&gt; &lt;b-button v-on:click="sendHTMLEmail" variant="primary"&gt;HTML Email&lt;/b-button&gt;&lt;br/&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; import {AXIOS} from './http-common' export default { name: 'EmailPage', data() { return { counter: 0, username: '', header: {'Authorization': 'Bearer ' + this.$store.getters.getToken} } }, methods: { sendSimpleMessage() { AXIOS.get('/sendSimpleEmail', { headers: this.$data.header }) .then(response =&gt; { console.log(response); alert("OK"); }) .catch(error =&gt; { console.log('ERROR: ' + error.response.data); }) }, sendEmailUsingTemplate() { AXIOS.get('/sendTemplateEmail', { headers: this.$data.header }) .then(response =&gt; { console.log(response); alert("OK") }) .catch(error =&gt; { console.log('ERROR: ' + error.response.data); }) }, sendHTMLEmail() { AXIOS.get('/sendHtmlEmail', { headers: this.$data.header }) .then(response =&gt; { console.log(response); alert("OK") }) .catch(error =&gt; { console.log('ERROR: ' + error.response.data); }) } } } &lt;/script&gt; &lt;style&gt; #email { margin-left: 38%; margin-top: 50px; } button { width: 150px; } &lt;/style&gt;</code> </pre><br></div></div><br>  <u>рдиреЛрдЯ:</u> <code>router.js</code> рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордд рднреВрд▓рдирд╛ред рдпрджрд┐ рдЖрдк рдПрдХ рдирдпрд╛ рдШрдЯрдХ рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВ, рддреЛ <code>App.vue</code> рдиреЗрд╡рд┐рдЧреЗрд╢рди <code>App.vue</code> рдореЗрдВ рд▓рд┐рдВрдХ рдЬреЛрдбрд╝реЗрдВред <br><br><a name="gradle"></a><br><h2>  рдЧреНрд░реЗрдбрд┐рдВрдЧ рдорд╛рдЗрдЧреНрд░реЗрд╢рди </h2><br>  рдореИрдВ рддреБрд░рдВрдд рд╕реНрдкрд╖реНрдЯ рдХрд░ рджреВрдВрдЧрд╛: рдХреНрдпрд╛ рдЗрд╕ рдЖрдЗрдЯрдо рдХреЛ рдПрдХ рд╕реБрдзрд╛рд░ рдорд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рд╣рд░ рдХрд┐рд╕реА рдХреЛ рдЕрдкрдиреА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдгрдп рд▓реЗрдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╣рдо рд╕рд┐рд░реНрдл рдпрд╣ рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИред <br><br>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдЖрдк <a href="http://www.rationaljava.com/2016/02/moving-from-maven-to-gradle-in-under-5.html" rel="nofollow">5 рдорд┐рдирдЯ рдХреЗ</a> рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ <a href="http://www.rationaljava.com/2016/02/moving-from-maven-to-gradle-in-under-5.html" rel="nofollow">рддрд╣рдд рдорд╛рд╡реЗрди рд╕реЗ рдЧреНрд░реИрдбрд▓ рдореЗрдВ рдореВрд╡рд┐рдВрдЧ рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдкрд░рд┐рдгрд╛рдо рдЙрдореНрдореАрджреЛрдВ рдкрд░ рдЦрд░рд╛ <a href="http://www.rationaljava.com/2016/02/moving-from-maven-to-gradle-in-under-5.html" rel="nofollow">рдЙрддрд░рдиреЗ</a> рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИред  рдореИрдВ рдЕрднреА рднреА рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдорд╛рдЗрдЧреНрд░реЗрд╢рди рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреВрдВрдЧрд╛, рдЗрд╕рдореЗрдВ рдЕрдзрд┐рдХ рд╕рдордп рдирд╣реАрдВ рд▓рдЧреЗрдЧрд╛ред <br><br>  рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рд╣рдореЗрдВ рдХрд░рдиреА рд╣реИ, рд╡рд╣ рд╣реИ <a href="https://gradle.org/install/" rel="nofollow">рдЧреНрд░реЗрдбрд▓</a> ред <br><br>  рдлрд┐рд░ рд╣рдореЗрдВ рджреЛрдиреЛрдВ рдЙрдкрдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ - <code>backend</code> рдФрд░ <code>fronted</code> : <br><br>  <b># 1</b> <i>рдореЗрд╡реЗрди</i> рдлрд╛рдЗрд▓реЗрдВ рд╣рдЯрд╛рдПрдВ - <i>pom.xml</i> , <i>.mvn</i> ред <br><br>  <b># 2</b> рд╕рдмрдкреНрд░реЛрдЬреЗрдХреНрдЯ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ, рдЧреНрд░реЗрдб рдЗрдирд┐рдЯ рдЪрд▓рд╛рдПрдВ рдФрд░ рд╕рд╡рд╛рд▓реЛрдВ рдХреЗ рдЬрд╡рд╛рдм рджреЗрдВ: <br><br><ul><li>  <i>рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдкреНрд░рдХрд╛рд░ рдЪреБрдиреЗрдВ:</i> <b>рдореВрд▓</b> </li><li>  <i>рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ:</i> <b>рдХреЛрдЯрд▓рд┐рди</b> </li><li>  <i>рдмрд┐рд▓реНрдб рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдбреАрдПрд╕рдПрд▓:</i> <b>рдХреЛрдЯрд▓рд┐рди</b> (рдЪреВрдВрдХрд┐ рд╣рдо рдХреЛрдЯрд▓рд┐рди рдореЗрдВ рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд▓рд┐рдЦ тАЛтАЛрд░рд╣реЗ рд╣реИрдВ) </li></ul><br>  <b># 3</b> <i>settings.gradle.kts</i> рд╣рдЯрд╛рдПрдВ - рдЗрд╕ рдлрд╛рдЗрд▓ рдХреЛ рдХреЗрд╡рд▓ рд░реВрдЯ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред <br><br>  <b># 4</b> рд░рди <code>gradle wrapper</code> ред <br><br>  рдЕрдм рд╣рдо рдЕрдкрдиреА рдореВрд▓ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреА рдУрд░ рдореБрдбрд╝рддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЙрдк-рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рдЪрд░рдгреЛрдВ 1, 2 рдФрд░ 4 рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ - <u><i>рд╕реЗрдЯрд┐рдВрдЧреНрд╕</i> рд╣рдЯрд╛рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛</u> рд╕рдм рдХреБрдЫ рд╕рдорд╛рди рд╣реИред <br><br>  <i>рдмреИрдХрдПрдВрдб</i> рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рдмрд┐рд▓реНрдб рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: <br><br><div class="spoiler">  <b class="spoiler_title">build.gradle.kts</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.jetbrains.kotlin.gradle.tasks.KotlinCompile plugins { id(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot"</span></span>) version <span class="hljs-string"><span class="hljs-string">"2.1.3.RELEASE"</span></span> id(<span class="hljs-string"><span class="hljs-string">"io.spring.dependency-management"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.0.8.RELEASE"</span></span> kotlin(<span class="hljs-string"><span class="hljs-string">"jvm"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.3.50"</span></span> kotlin(<span class="hljs-string"><span class="hljs-string">"plugin.spring"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.3.50"</span></span> id(<span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin.plugin.jpa"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.3.50"</span></span> } group = <span class="hljs-string"><span class="hljs-string">"com.kotlin-spring-vue"</span></span> version = <span class="hljs-string"><span class="hljs-string">"0.0.1-SNAPSHOT"</span></span> java.sourceCompatibility = JavaVersion.VERSION_1_8 repositories { mavenCentral() maven { url = uri(<span class="hljs-string"><span class="hljs-string">"https://plugins.gradle.org/m2/"</span></span>) } } dependencies { runtimeOnly(project(<span class="hljs-string"><span class="hljs-string">":frontend"</span></span>)) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-actuator:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-data-jpa:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-mail:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-security:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.postgresql:postgresql:42.2.5"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-thymeleaf:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"commons-io:commons-io:2.4"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"io.jsonwebtoken:jjwt:0.9.0"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"io.jsonwebtoken:jjwt-api:0.10.6"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"com.mashape.unirest:unirest-java:1.4.9"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"com.fasterxml.jackson.module:jackson-module-kotlin:2.9.8"</span></span>) runtimeOnly(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-devtools:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-reflect"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-stdlib-jdk8"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-noarg:1.3.50"</span></span>) testImplementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-test"</span></span>) { exclude(group = <span class="hljs-string"><span class="hljs-string">"org.junit.vintage"</span></span>, module = <span class="hljs-string"><span class="hljs-string">"junit-vintage-engine"</span></span>) } } tasks.withType&lt;KotlinCompile&gt; { kotlinOptions { freeCompilerArgs = listOf(<span class="hljs-string"><span class="hljs-string">"-Xjsr305=strict"</span></span>) jvmTarget = <span class="hljs-string"><span class="hljs-string">"1.8"</span></span> } }</code> </pre><br></div></div><br><ul><li>  рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдХреЛрдЯрд▓рд┐рди рдФрд░ рд╕реНрдкреНрд░рд┐рдВрдЧ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдЬрд╛рдиреЗ рдЪрд╛рд╣рд┐рдПред </li><li>  рдкреНрд▓рдЧрдЗрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдордд рднреВрд▓рдирд╛ <i>org.jetbrains.kotlin.plugin.jpa</i> - рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ </li><li>  рдирд┐рд░реНрднрд░рддрд╛ рдореЗрдВ, рдЖрдкрдХреЛ <code>runtimeOnly(project(":frontend"))</code> рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ <code>runtimeOnly(project(":frontend"))</code> - рд╣рдореЗрдВ рдкрд╣рд▓реЗ <code>runtimeOnly(project(":frontend"))</code> рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </li></ul><br>  <i>рджреГрд╢реНрдпрдкрдЯрд▓</i> рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд▓рд┐рдП рд╡рд┐рдиреНрдпрд╛рд╕ рдмрдирд╛рдПрдБ: <br><br><div class="spoiler">  <b class="spoiler_title">build.gradle.kts</b> <div class="spoiler_text"><pre> <code class="kotlin hljs">plugins { id(<span class="hljs-string"><span class="hljs-string">"org.siouan.frontend"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.2.1"</span></span> id(<span class="hljs-string"><span class="hljs-string">"java"</span></span>) } group = <span class="hljs-string"><span class="hljs-string">"com.kotlin-spring-vue"</span></span> version = <span class="hljs-string"><span class="hljs-string">"0.0.1-SNAPSHOT"</span></span> java { targetCompatibility = JavaVersion.VERSION_1_8 } buildscript { repositories { mavenCentral() maven { url = uri(<span class="hljs-string"><span class="hljs-string">"https://plugins.gradle.org/m2/"</span></span>) } } } frontend { nodeVersion.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-string"><span class="hljs-string">"10.16.0"</span></span>) cleanScript.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-string"><span class="hljs-string">"run clean"</span></span>) installScript.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-string"><span class="hljs-string">"install"</span></span>) assembleScript.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-string"><span class="hljs-string">"run build"</span></span>) } tasks.named(<span class="hljs-string"><span class="hljs-string">"jar"</span></span>, Jar::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">) </span></span>{ dependsOn(<span class="hljs-string"><span class="hljs-string">"assembleFrontend"</span></span>) from(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$buildDir</span></span></span><span class="hljs-string">/dist"</span></span>) into(<span class="hljs-string"><span class="hljs-string">"static"</span></span>) }</code> </pre><br></div></div><br><ul><li>  рдореЗрд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП <code>org.siouan.frontend</code> рдкреНрд▓рдЧрдЗрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </li><li>  <code>frontend {...}</code> рд╕реЗрдХреНрд╢рди <code>frontend {...}</code> Node.js рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рд╕рд╛рде рд╣реА рдЙрди рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ <code>package.json</code> . <code>package.json</code> рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рдлрд╛рдИ, рд╕реНрдерд╛рдкрдирд╛ рдФрд░ рдЕрд╕реЗрдВрдмрд▓реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЖрд╣реНрд╡рд╛рди рдХрд░рддреЗ рд╣реИрдВ <code>package.json</code> </li><li>  рдЕрдм рд╣рдо рдЕрдкрдиреЗ рдлреНрд░рдВрдЯрдПрдВрдб рд╕рдмрдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рдПрдХ JAR рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкреИрдХ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдПрдХ рдирд┐рд░реНрднрд░рддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ ( <code>runtimeOnly(project(":frontend"))</code> ), рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рдХрд╛рд░реНрдп рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдЕрд╕реЗрдВрдмрд▓реА рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдХреЙрдкреА рдХрд░рддрд╛ рд╣реИ <i>/ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ</i> рдФрд░ рдПрдХ рдЬрд╛рд░ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рддрд╛ рд╣реИ </li></ul><br>  <u>рдиреЛрдЯ:</u> <br><br><ul><li>  <code>vue.config.js</code> рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ, рдирд┐рд░реНрдорд╛рдг рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдмрджрд▓рдиреЗ <i>/ рдирд┐рд░реНрдорд╛рдг</i> рдХрд░рдиреЗ рдХреЗ <i>рд▓рд┐рдП</i> ред </li><li>  <code>package.json</code> <i>рд╕реНрдХреНрд░рд┐рдкреНрдЯ</i> рдлрд╝рд╛рдЗрд▓ рдХрд╛ <i>рдирд┐рд░реНрдорд╛рдг</i> , <code>vue-cli-service build</code> рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ рдпрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реИ </li></ul><br>  рд░реВрдЯ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ settings.gradle.kts рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрди рдХреЛрдб рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП: ... <br><br><pre> <code class="kotlin hljs">rootProject.name = <span class="hljs-string"><span class="hljs-string">"demo"</span></span> include(<span class="hljs-string"><span class="hljs-string">":frontend"</span></span>, <span class="hljs-string"><span class="hljs-string">":backend"</span></span>)</code> </pre><br>  ... рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдФрд░ рд╕рдмрдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдирд╛рдо рд╣реИред <br><br>  рдФрд░ рдЕрдм рд╣рдо рдХрдорд╛рдВрдб рдЪрд▓рд╛рдХрд░ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <code>./gradlew build</code> <br><br>  <u>рдиреЛрдЯ:</u> рдпрджрд┐ <i>рдЖрд╡реЗрджрди</i> рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкреНрд▓реЗрд╕рд╣реЛрд▓реНрдбрд░реНрд╕ рдХреЗ рд▓рд┐рдПред <code>${SPRING_DATASOURCE_URL}</code> (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <code>${SPRING_DATASOURCE_URL}</code> ) рдХреЛрдИ рд╕рдВрдЧрдд рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдЕрд╕реЗрдВрдмрд▓реА рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧреАред  рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП <code><b>/gradlew build -x</b></code> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ <br><br>  рдЖрдк <code>gradle -q projects</code> рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдкрд░рд┐рдгрд╛рдо рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП: <br><br><pre> <code class="plaintext hljs">Root project 'demo' +--- Project ':backend' \--- Project ':frontend'</code> </pre> <br>  рдФрд░ рдЕрдВрдд рдореЗрдВ, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЪрд▓рдирд╛ рд╣реЛрдЧрд╛ <code>./gradlew bootRun</code> <br><br><h4>  .gitignore </h4><br>  рдирд┐рдореНрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдХреЛ <i>.gitignore</i> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП: <br><br><ul><li>  рдмреИрдХрдПрдВрдб / рдмрд┐рд▓реНрдб / </li><li>  рд╕реАрдорд╛ / рдирд┐рд░реНрдорд╛рдг / </li><li>  рдирд┐рд░реНрдорд╛рдг </li><li>  .gradle </li></ul><br>  <u>рдорд╣рддреНрд╡рдкреВрд░реНрдг:</u> рдЖрдкрдХреЛ <code>gradlew</code> рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдирд╣реАрдВ рдЬреЛрдбрд╝рдирд╛ рдЪрд╛рд╣рд┐рдП - рдЙрдирдореЗрдВ рдХреБрдЫ рднреА рдЦрддрд░рдирд╛рдХ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рджреВрд░рд╕реНрде рд╕рд░реНрд╡рд░ рдкрд░ рд╕рдлрд▓ рдЕрд╕реЗрдВрдмрд▓реА рдХреЗ рд▓рд┐рдП рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><h4>  рд╣рд░реЛрдХреВ рдкрд░ рддреИрдирд╛рддреА </h4><br>  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╣рд░реЛрдХреВ рдореЗрдВ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдХрд┐рди рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  <b># 1 Procfile</b> <br><br>  рд╣рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рд░реЛрдХреВ рдирдП рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдкреВрдЫрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">web: java -Dserver.port=$PORT -jar backend/build/libs/backend-0.0.1-SNAPSHOT.jar</code> </pre> <br>  <b># 2 рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░</b> <br><br>  рд╣рд░реЛрдХреВ рдЖрд╡реЗрджрди рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рд░реАрдореЗрдХ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕реНрдкреНрд░рд┐рдВрдЧ рдмреВрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди) рдФрд░ рдЙрдкрдпреБрдХреНрдд рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред  рд▓реЗрдХрд┐рди рд╣рдорд╛рд░рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди (рд░реВрдЯ рдкреНрд░реЛрдЬреЗрдХреНрдЯ) рд╣рд░реЛрдХреВ рдХреЛ рд╕реНрдкреНрд░рд┐рдВрдЧ рдмреВрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рддрд░рд╣ рдирд╣реАрдВ рджрд┐рдЦрддрд╛ рд╣реИред  рдпрджрд┐ рд╣рдо рд╕рдм рдХреБрдЫ рд╡реИрд╕рд╛ рд╣реА рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рд╣рд░реЛрдХреВ рд╣рдореЗрдВ <code>stage</code> рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣реЗрдВрдЧреЗред  рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ, рдореБрдЭреЗ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ рдпрд╣ рд░рд╛рд╕реНрддрд╛ рдХрд╣рд╛рдВ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдореИрдВрдиреЗ рдЗрд╕рдХрд╛ рдкрд╛рд▓рди рдирд╣реАрдВ рдХрд┐рдпрд╛ред  <code>build</code> рдорд╛рди рдХреЗ рд╕рд╛рде <code>GRADLE_TASK</code> рдЪрд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ: <br><br><img src="https://habrastorage.org/webt/5j/xz/o2/5jxzo2ukto8lyakkxajjg5rrvtg.png"><br><br>  <b># 3 reCAPTCHA</b> <br><br>  рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдХ рдирдП рдбреЛрдореЗрди рдореЗрдВ рд░рдЦрддреЗ рд╕рдордп, рдХреИрдкреНрдЪрд╛, <code>GOOGLE_RECAPTCHA_KEY_SITE</code> рдФрд░ <code>GOOGLE_RECAPTCHA_KEY_SECRET</code> рдкрд░рд┐рд╡реЗрд╢ рдЪрд░ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ, рдФрд░ рджреГрд╢реНрдпрдкрдЯрд▓ рдЙрдкрдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рд╕рд╛рдЗрдЯ рдХреБрдВрдЬреА рднреА рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВред <br><br><a name="cookies"></a><br><h2>  рдХреБрдХреАрдЬрд╝ рдореЗрдВ рднрдВрдбрд╛рд░рдг JWT рдЯреЛрдХрди </h2><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдореИрдВ рджреГрдврд╝рддрд╛ рд╕реЗ рдЕрдиреБрд╢рдВрд╕рд╛ рдХрд░рддрд╛ рд╣реВрдВ рдХрд┐ рдЖрдк <a href="https://www.rdegges.com/2018/please-stop-using-local-storage/" rel="nofollow">рд╕реНрдерд╛рдиреАрдп рднрдВрдбрд╛рд░рдг</a> рд▓реЗрдЦ <a href="https://www.rdegges.com/2018/please-stop-using-local-storage/" rel="nofollow">рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреГрдкрдпрд╛ рд╕реНрдЯреЙрдк рдХреЛ</a> рдкрдврд╝реЗрдВ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ <i>рдХреНрдпреЛрдВ рд╕реНрдерд╛рдиреАрдп рднрдВрдбрд╛рд░рдг рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдЗрд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛</i> рдЕрдиреБрднрд╛рдЧ <i>рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП</i> ред <br><br>  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдЖрдк <code>httpOnly</code> рдЭрдВрдбреЗ рдореЗрдВ JWT рдЯреЛрдХрди рдХреЛ рдПрдХ рдЕрдзрд┐рдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рдкрд░ рдХреИрд╕реЗ рд╕реНрдЯреЛрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдЬрд╣рд╛рдВ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рдкрдврд╝рдиреЗ / рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЕрдиреБрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ред <br><br>  <b># 1</b> рджреГрд╢реНрдпрдкрдЯрд▓ рд╕реЗ рд╕рднреА JWT рд╕рдВрдмрдВрдзрд┐рдд рддрд░реНрдХ рдХреЛ рд╣рдЯрд╛рдирд╛: <br>  рдЪреВрдВрдХрд┐ рдЯреЛрдХрди рдЕрднреА рднреА рдирдИ рд╕рдВрдЧреНрд░рд╣рдг рдкрджреНрдзрддрд┐ рдХреЗ рд╕рд╛рде рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк рд╣рдорд╛рд░реЗ рд╕рдмрдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдЗрд╕рдХреЗ рд╕рднреА рд╕рдВрджрд░реНрдн рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рдбреЗрдЯрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдХреЗ рдмрд┐рдирд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рднреВрдорд┐рдХрд╛ рдЗрддрдиреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реИ, рдпрд╣ рдЕрднреА рднреА рд╕реНрдерд╛рдиреАрдп рднрдВрдбрд╛рд░рдг рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрд╕ рднреВрдорд┐рдХрд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред <br><br><div class="spoiler">  <b class="spoiler_title">store / index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vue <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'vue'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vuex <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'vuex'</span></span>; Vue.use(Vuex); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = { <span class="hljs-attr"><span class="hljs-attr">role</span></span>: localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'user-role'</span></span>) || <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">username</span></span>: localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'user-name'</span></span>) || <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">authorities</span></span>: localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'authorities'</span></span>) || <span class="hljs-string"><span class="hljs-string">''</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getters = { <span class="hljs-attr"><span class="hljs-attr">isAuthenticated</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.role != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; state.role != <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }, <span class="hljs-attr"><span class="hljs-attr">isAdmin</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.role === <span class="hljs-string"><span class="hljs-string">'admin'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }, <span class="hljs-attr"><span class="hljs-attr">getUsername</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.username; }, <span class="hljs-attr"><span class="hljs-attr">getAuthorities</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.authorities; } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mutations = { <span class="hljs-attr"><span class="hljs-attr">auth_login</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, user</span></span></span><span class="hljs-function">) =&gt;</span></span> { localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'user-name'</span></span>, user.username); localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'user-authorities'</span></span>, user.roles); state.username = user.username; state.authorities = user.roles; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isUser = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isAdmin = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; user.roles.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (user.roles[i].authority === <span class="hljs-string"><span class="hljs-string">'ROLE_USER'</span></span>) { isUser = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (user.roles[i].authority === <span class="hljs-string"><span class="hljs-string">'ROLE_ADMIN'</span></span>) { isAdmin = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isUser) { localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'user-role'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span>); state.role = <span class="hljs-string"><span class="hljs-string">'user'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isAdmin) { localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'user-role'</span></span>, <span class="hljs-string"><span class="hljs-string">'admin'</span></span>); state.role = <span class="hljs-string"><span class="hljs-string">'admin'</span></span>; } }, <span class="hljs-attr"><span class="hljs-attr">auth_logout</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { state.token = <span class="hljs-string"><span class="hljs-string">''</span></span>; state.role = <span class="hljs-string"><span class="hljs-string">''</span></span>; state.username = <span class="hljs-string"><span class="hljs-string">''</span></span>; state.authorities = []; localStorage.removeItem(<span class="hljs-string"><span class="hljs-string">'user-role'</span></span>); localStorage.removeItem(<span class="hljs-string"><span class="hljs-string">'user-name'</span></span>); localStorage.removeItem(<span class="hljs-string"><span class="hljs-string">'user-authorities'</span></span>); } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = { <span class="hljs-attr"><span class="hljs-attr">login</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context, user</span></span></span><span class="hljs-function">) =&gt;</span></span> { context.commit(<span class="hljs-string"><span class="hljs-string">'auth_login'</span></span>, user) }, <span class="hljs-attr"><span class="hljs-attr">logout</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context</span></span></span><span class="hljs-function">) =&gt;</span></span> { context.commit(<span class="hljs-string"><span class="hljs-string">'auth_logout'</span></span>); } }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vuex.Store({ state, getters, mutations, actions });</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рдлреИрдХреНрдЯрд░рд┐рдВрдЧ рдХрд░рддреЗ рд╕рдордп рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ </font></font><code>store/index.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: рдпрджрд┐ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдФрд░ рдбреАрдереЛрд░рд╛рдЗрдЬреЗрд╢рди рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХрдВрд╕реЛрд▓ рдореЗрдВ рд▓рдЧрд╛рддрд╛рд░ рдЬрд╛рд░реА рд░рд╣реЗрдЧрд╛ред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреЗрдбрдмреНрд▓реНрдпреВрдЯреА рдХреЛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдирд┐рдпрдВрддреНрд░рдХ рдореЗрдВ рдХреБрдХреА рдХреЗ рд░реВрдк рдореЗрдВ рд▓реМрдЯрд╛рдПрдВ ( </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдирд┐рдХрд╛рдп рдореЗрдВ рдирд╣реАрдВ</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthController.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.authCookieName}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCookieName: String <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.isCookieSecure}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isCookieSecure: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-meta"><span class="hljs-meta">@PostMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/signin"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authenticateUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Valid</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@RequestBody</span></span></span></span><span class="hljs-function"><span class="hljs-params"> loginRequest: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoginUser</span></span></span></span><span class="hljs-function"><span class="hljs-params">, response: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HttpServletResponse</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userCandidate: Optional &lt;User&gt; = userRepository.findByUsername(loginRequest.username!!) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(loginRequest.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (userCandidate.isPresent) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user: User = userCandidate.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authentication = authenticationManager.authenticate( UsernamePasswordAuthenticationToken(loginRequest.username, loginRequest.password)) SecurityContextHolder.getContext().setAuthentication(authentication) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jwt: String = jwtProvider.generateJwtToken(user.username!!) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cookie: Cookie = Cookie(authCookieName, jwt) cookie.maxAge = jwtProvider.jwtExpiration!! cookie.secure = isCookieSecure cookie.isHttpOnly = <span class="hljs-literal"><span class="hljs-literal">true</span></span> cookie.path = <span class="hljs-string"><span class="hljs-string">"/"</span></span> response.addCookie(cookie) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authorities: List&lt;GrantedAuthority&gt; = user.roles!!.stream().map({ role -&gt; SimpleGrantedAuthority(role.name)}).collect(Collectors.toList&lt;GrantedAuthority&gt;()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity.ok(SuccessfulSigninResponse(user.username, authorities)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"User not found!"</span></span>), HttpStatus.BAD_REQUEST) } }</code> </pre><br></div></div><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╣рддреНрд╡рдкреВрд░реНрдг</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдореИрдВ рд╡рд┐рдХрд▓реНрдк рд░рдЦрд╛ </font></font><code>authCookieName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>isCookieSecure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application.properties</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - рдзреНрд╡рдЬ рдХреЛ рдХреБрдХреА </font></font><code>secure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ https рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдпрд╣ рдЕрддреНрдпрдВрдд рд╕реНрдерд╛рдиреАрдп рд╣реЛрд╕реНрдЯ рдХреЗ рд╕рд╛рде рдбрд┐рдмрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрд╢реНрдХрд┐рд▓ рдмрдирд╛ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрддреНрдкрд╛рджрди рдореЗрдВ BUT, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдЗрд╕ рдзреНрд╡рдЬ рдХреЗ рд╕рд╛рде рдХреБрдХреАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, JWT рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдмрд┐рдирд╛ рдЗрдХрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдВрддреНрд░рдХ рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЕрдм рдЙрдЪрд┐рдд рд╣реИред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрджреНрдпрддрди </font></font><code>JwtAuthTokenFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░ рд╕реЗ рдПрдХ рдЯреЛрдХрди рд▓реЗрддреЗ рдереЗ, рдЕрдм рд╣рдо рдЗрд╕реЗ рдХреБрдХреАрдЬрд╝ рд╕реЗ рд▓реЗрддреЗ рд╣реИрдВ:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JwtAuthTokenFilter.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.authCookieName}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCookieName: String ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getJwt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HttpServletRequest</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String? { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (cookie <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> request.cookies) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cookie.name == authCookieName) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cookie.value } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 4 </font></font></b><font style="vertical-align: inherit;"></font><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд░ рдХреЛ</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдХреНрд╖рдо рдХрд░рдирд╛ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд░ рдореЗрд░реЗ рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рдореЗрдВ рдЖрдк рдЕрднреА рднреА рдЪреБрдкрдЪрд╛рдк рдЗрд╕ рд╕рд╡рд╛рд▓ рдХреЛ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЕрдм рдмреИрдХрд╡рд░реНрдб рд╕рд╛рдЗрдб рдкрд░ рдХреЙрд░реНрд╕ рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдП рдмрд┐рдирд╛ JWT рдЯреЛрдХрди рдХреА рд░рдХреНрд╖рд╛ рдХрд░рдирд╛ рдЕрдЬреАрдм рд╣реЛрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк рдЗрд╕реЗ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рдареАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>WebSecurityConfig.kt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebSecurityConfig.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corsConfigurationSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: CorsConfigurationSource { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> configuration = CorsConfiguration() configuration.allowedOrigins = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"http://localhost:8080"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://localhost:8081"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://kotlin-spring-vue-gradle-demo.herokuapp.com"</span></span>) configuration.allowedHeaders = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"*"</span></span>) configuration.allowedMethods = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-string"><span class="hljs-string">"PUT"</span></span>, <span class="hljs-string"><span class="hljs-string">"DELETE"</span></span>, <span class="hljs-string"><span class="hljs-string">"OPTIONS"</span></span>) configuration.allowCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span> configuration.maxAge = <span class="hljs-number"><span class="hljs-number">3600</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> source = UrlBasedCorsConfigurationSource() source.registerCorsConfiguration(<span class="hljs-string"><span class="hljs-string">"/**"</span></span>, configuration) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source } <span class="hljs-meta"><span class="hljs-meta">@Throws(Exception::class)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(http: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HttpSecurity</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { http .cors().and() .csrf().disable().authorizeRequests() .antMatchers(<span class="hljs-string"><span class="hljs-string">"/**"</span></span>).permitAll() .anyRequest().authenticated() .and() .exceptionHandling().authenticationEntryPoint(unauthorizedHandler).and() .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) http.addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headers</span></span></span></span>().cacheControl().disable() }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЕрдм рдЖрдк </font></font><code>@CrossOrigin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдпрдВрддреНрд░рдХреЛрдВ рд╕реЗ </font><font style="vertical-align: inherit;">рд╕рднреА рдПрдиреЛрдЯреЗрд╢рди рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font></font><br><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╣рддреНрд╡рдкреВрд░реНрдг: </font></font></u><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдорд╛рдВрдд</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП </font><i><font style="vertical-align: inherit;">AllowCredentials</font></i><font style="vertical-align: inherit;"> рдкреИрд░рд╛рдореАрдЯрд░ </font><i><font style="vertical-align: inherit;">рдХреА</font></i><font style="vertical-align: inherit;"> рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ </font></font><a href="https://stackoverflow.com/questions/45004354/when-should-i-really-set-access-control-allow-credentials-to-true-in-my-resp" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдкрдврд╝реЗрдВ </font><font style="vertical-align: inherit;">ред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рдордиреЗ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдкрд░ рд╣реЗрдбрд░ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http-commons.js</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AXIOS = axios.create({ <span class="hljs-attr"><span class="hljs-attr">baseURL</span></span>: <span class="hljs-string"><span class="hljs-string">`/api`</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span>: [<span class="hljs-string"><span class="hljs-string">'http://localhost:8080'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://localhost:8081'</span></span>, <span class="hljs-string"><span class="hljs-string">'https://kotlin-spring-vue-gradle-demo.herokuapp.com'</span></span>], <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Methods'</span></span>: <span class="hljs-string"><span class="hljs-string">'GET,POST,DELETE,PUT,OPTIONS'</span></span>, <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Headers'</span></span>: <span class="hljs-string"><span class="hljs-string">'*'</span></span>, <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Credentials'</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } })</code> </pre><br></div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирд┐рд░реАрдХреНрд╖рдг </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рд╣реЛрд╕реНрдЯ рд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░рдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдЬреЛ рдЕрдиреБрдордд рд╕реВрдЪреА рдореЗрдВ рдирд╣реАрдВ рд╣реИ </font></font><code>WebSecurityConfig.kt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреЛрд░реНрдЯ рдкрд░ рдмреИрдХрдПрдВрдб </font></font><code>8080</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдлреНрд░рдВрдЯрдПрдВрдб рдХреЛ </font><font style="vertical-align: inherit;">рдЪрд▓рд╛рдПрдВ </font><font style="vertical-align: inherit;">, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, </font></font><code>8082</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sw/ce/hk/swcehkifaph10nqjveh17sv1w88.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХрд╛ рдЕрдиреБрд░реЛрдз CORS рдиреАрддрд┐ рджреНрд╡рд╛рд░рд╛ рдЦрд╛рд░рд┐рдЬ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдзреНрд╡рдЬ рдХреБрдХреАрдЬрд╝ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВ </font></font><code>httpOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдЗрдП, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рд╛рдЗрдЯ </font></font><a href="https://kotlinlang.org/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://kotlinlang.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░ </font><a href="https://kotlinlang.org/" rel="nofollow"><font style="vertical-align: inherit;">рдЬрд╛рдПрдВ</font></a><font style="vertical-align: inherit;"> рдФрд░ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХрдВрд╕реЛрд▓ рдореЗрдВ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд </font><a href="https://kotlinlang.org/" rel="nofollow"><font style="vertical-align: inherit;">рдХрд░реЗрдВ</font></a><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/4o/s7/ct/4os7ctztsejgbzclio8ci8nloky.png"><br></div></div><br><font style="vertical-align: inherit;"></font><code>httpOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╕рд╛рдЗрдЯ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд </font><font style="vertical-align: inherit;">рдЧреИрд░- </font><font style="vertical-align: inherit;">рдХреБрдХреАрдЬрд╝ </font><font style="vertical-align: inherit;">рдХрдВрд╕реЛрд▓ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">, рдЬреЛ рдХрд┐ рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ, рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд▓рдн рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдорд╛рд░реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЪрд▓рддреЗ рд╣реИрдВ, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЙрдЧ рдЗрди рдХрд░реЗрдВ</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (рддрд╛рдХрд┐ рдмреНрд░рд╛рдЙрдЬрд╝рд░ </font><font style="vertical-align: inherit;">рдХреБрдХреА </font><font style="vertical-align: inherit;">рдХреЛ JWT рд╕реЗ </font><font style="vertical-align: inherit;">рдмрдЪрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">) рдФрд░ рд╡рд╣реА рдмрд╛рдд рджреЛрд╣рд░рд╛рдПрдВ:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/fh/_b/zh/fh_bzh9ytv6rf_xn40fjf3c83ag.png"><br></div></div><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреЛрдЯ:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JWT рдЯреЛрдХрди рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХрд╛ рдпрд╣ рддрд░реАрдХрд╛ рд▓реЛрдХрд▓ рд╕реНрдЯреЛрд░реЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдЕрдзрд┐рдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдпрд╣ рд╕рдордЭрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдпрд╣ рд░рд╛рдордмрд╛рдг рдирд╣реАрдВ рд╣реИред</font></font><br><br><a name="confirmation"></a><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдИрдореЗрд▓ рдкрдВрдЬреАрдХрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕ рдХрд╛рд░реНрдп рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ </font><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖рддрд╛ </font><font style="vertical-align: inherit;">рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реИ</font></font><code>false</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЯреЛрдХрди рдордирдорд╛рдирд╛ рдкрд╛рддреНрд░реЛрдВ рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдкрдВрдЬреАрдХрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреБрдВрдЬреА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧрд╛ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓рд┐рдВрдХ рдХреЗ рднрд╛рдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдореЗрд▓ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЯреЛрдХрди рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреБрдг </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореВрд▓реНрдп рд▓реЗрддрд╛ рд╣реИ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдЪ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реИ, рд╕рдордп рдХреА рдПрдХ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЕрд╡рдзрд┐ рдХреЗ рднреАрддрд░ рдПрдХ рд▓рд┐рдВрдХ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рддрд╛ рд╣реИ рддреЛ</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдкрдВрдЬреАрдХрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреЗрдмрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> public.verification_token ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, token <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>, expiry_date <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, user_id <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> public.verification_token <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> verification_token_users_fk <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (user_id) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> public.users (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">MATCH</span></span> SIMPLE <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span>;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░, рддрджрдиреБрд╕рд╛рд░, рдСрдмреНрдЬреЗрдХреНрдЯ-рд░рд┐рд▓реЗрд╢рдирд▓ рдореИрдкрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдИ рдЗрдХрд╛рдИ ...: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VerificationToken.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.jpa <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Calendar <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"verification_token"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerificationToken</span></span></span></span>( <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> id: <span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>? = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"expiry_date"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> expiryDate: Date, <span class="hljs-meta"><span class="hljs-meta">@OneToOne(targetEntity = User::class, fetch = FetchType.EAGER, cascade = [CascadeType.PERSIST])</span></span> <span class="hljs-meta"><span class="hljs-meta">@JoinColumn(nullable = false, name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"user_id"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user: User ) { <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(token: String?, user: User) : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, token, calculateExpiryDate(<span class="hljs-number"><span class="hljs-number">1440</span></span>), user) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateExpiryDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(expiryTimeInMinutes: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Date { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cal = Calendar.getInstance() cal.time = Timestamp(cal.time.time) cal.add(Calendar.MINUTE, expiryTimeInMinutes) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Date(cal.time.time) }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... рдФрд░ рднрдВрдбрд╛рд░: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VerificationTokenRepository.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.repository <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.jpa.VerificationToken <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.jpa.repository.JpaRepository <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.* <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerificationTokenRepository</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VerificationToken, Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByToken</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Optional&lt;VerificationToken&gt; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рдЯреЛрдХрди рдХреЗ рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ - рдИрдореЗрд▓ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдирд╛, рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛ рдФрд░ рднреЗрдЬрдирд╛ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо </font></font><code>UserDetailsServiceImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЛрдХрди рдмрдирд╛рдиреЗ рдФрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдХрд░ </font><font style="vertical-align: inherit;">рд╕рдВрд╢реЛрдзрд┐рдд </font><font style="vertical-align: inherit;">рдХрд░рддреЗ рд╣реИрдВ:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDetailsServiceImpl.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createVerificationTokenForUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, user: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { tokenRepository.save(VerificationToken(token, user)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateVerificationToken</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> verificationToken: Optional&lt;VerificationToken&gt; = tokenRepository.findByToken(token) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (verificationToken.isPresent) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user: User = verificationToken.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>().user <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cal: Calendar = Calendar.getInstance() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((verificationToken.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>().expiryDate.time - cal.time.time) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { tokenRepository.delete(verificationToken.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TOKEN_EXPIRED } user.enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> tokenRepository.delete(verificationToken.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>()) userRepository.save(user) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TOKEN_VALID } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TOKEN_INVALID } }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдПрдХ рдкреБрд╖реНрдЯрд┐рдХрд░рдг рд▓рд┐рдВрдХ рдХреЗ рд╕рд╛рде рдПрдХ рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВ </font></font><code>EmailServiceImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmailServiceImpl.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"> <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${host.url}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hostUrl: String <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userDetailsService: UserDetailsServiceImpl ... <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendRegistrationConfirmationEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> token = UUID.randomUUID().toString() userDetailsService.createVerificationTokenForUser(token, user) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> link = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$hostUrl</span></span></span><span class="hljs-string">/?token=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$token</span></span></span><span class="hljs-string">&amp;confirmRegistration=true"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> msg = <span class="hljs-string"><span class="hljs-string">"&lt;p&gt;Please, follow the link to complete your registration:&lt;/p&gt;&lt;p&gt;&lt;a href=\"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$link</span></span></span><span class="hljs-string">\"&gt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$link</span></span></span><span class="hljs-string">&lt;/a&gt;&lt;/p&gt;"</span></span> user.email?.let{sendHtmlMessage(user.email!!, <span class="hljs-string"><span class="hljs-string">"KSVG APP: Registration Confirmation"</span></span>, msg)} }</code> </pre><br></div></div><br>  <u>рдиреЛрдЯ:</u> <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдВ URL рд╣реЛрд╕реНрдЯ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░реЗрдВрдЧреЗ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application.properties</font></font></i> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рд▓рд┐рдВрдХ рдореЗрдВ, рд╣рдо </font><font style="vertical-align: inherit;">рдЙрд╕ рдкрддреЗ рдкрд░ </font><font style="vertical-align: inherit;">рджреЛ GET рдкреИрд░рд╛рдореАрдЯрд░ ( </font></font><code>token</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>confirmRegistration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдЖрд╡реЗрджрди рддреИрдирд╛рдд рд╣реИред </font><font style="vertical-align: inherit;">рдмрд╛рдж рдореЗрдВ рд╕рдордЭрд╛рдКрдВрдЧрд╛ рдХрд┐ рдХреНрдпреЛрдВред</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдкрдВрдЬреАрдХрд░рдг рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝реАрд▓реНрдб рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдорд╛рди рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗ</font></font><code>isEnabled</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирдпрд╛ рдЦрд╛рддрд╛ рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдкрдВрдЬреАрдХрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдИрдореЗрд▓ рднреЗрдЬреЗрдВрдЧреЗ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдЕрд▓рдЧ рдЯреЛрдХрди рд╕рддреНрдпрд╛рдкрди рдирд┐рдпрдВрддреНрд░рдХ рдмрдирд╛рдПрдБ </font></font></li><li> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╣рддреНрд╡рдкреВрд░реНрдг:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рджреМрд░рд╛рди рд╣рдо рдЬрд╛рдБрдЪреЗрдВрдЧреЗ рдХрд┐ рдХреНрдпрд╛ рдЦрд╛рддрд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рд╣реИ:</font></font></li></ul><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthController.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.controller <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.email.EmailService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.validation.Valid <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Collectors <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Autowired <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.HttpStatus <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.ResponseEntity <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.authentication.AuthenticationManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.core.context.SecurityContextHolder <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.crypto.password.PasswordEncoder <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.core.GrantedAuthority <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.core.authority.SimpleGrantedAuthority <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.ui.Model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.model.LoginUser <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.model.NewUser <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.web.response.SuccessfulSigninResponse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.web.response.ResponseMessage <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.jpa.User <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.repository.UserRepository <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.repository.RoleRepository <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.jwt.JwtProvider <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.ReCaptchaService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.UserDetailsService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Value <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.ApplicationEventPublisher <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.bind.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.context.request.WebRequest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.UnsupportedEncodingException <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.Cookie <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.HttpServletRequest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.HttpServletResponse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.UserDetailsServiceImpl.Companion.TOKEN_VALID <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.UserDetailsServiceImpl.Companion.TOKEN_INVALID <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.UserDetailsServiceImpl.Companion.TOKEN_EXPIRED <span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/api/auth"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthController</span></span></span></span>() { <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.authCookieName}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCookieName: String <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.isCookieSecure}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isCookieSecure: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authenticationManager: AuthenticationManager <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userRepository: UserRepository <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roleRepository: RoleRepository <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> encoder: PasswordEncoder <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jwtProvider: JwtProvider <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> captchaService: ReCaptchaService <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userService: UserDetailsService <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emailService: EmailService <span class="hljs-meta"><span class="hljs-meta">@PostMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/signin"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authenticateUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Valid</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@RequestBody</span></span></span></span><span class="hljs-function"><span class="hljs-params"> loginRequest: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoginUser</span></span></span></span><span class="hljs-function"><span class="hljs-params">, response: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HttpServletResponse</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userCandidate: Optional &lt;User&gt; = userRepository.findByUsername(loginRequest.username!!) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(loginRequest.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (userCandidate.isPresent) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user: User = userCandidate.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!user.enabled) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Account is not verified yet! Please, follow the link in the confirmation email."</span></span>), HttpStatus.UNAUTHORIZED) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authentication = authenticationManager.authenticate( UsernamePasswordAuthenticationToken(loginRequest.username, loginRequest.password)) SecurityContextHolder.getContext().setAuthentication(authentication) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jwt: String = jwtProvider.generateJwtToken(user.username!!) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cookie: Cookie = Cookie(authCookieName, jwt) cookie.maxAge = jwtProvider.jwtExpiration!! cookie.secure = isCookieSecure cookie.isHttpOnly = <span class="hljs-literal"><span class="hljs-literal">true</span></span> cookie.path = <span class="hljs-string"><span class="hljs-string">"/"</span></span> response.addCookie(cookie) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authorities: List&lt;GrantedAuthority&gt; = user.roles!!.stream().map({ role -&gt; SimpleGrantedAuthority(role.name)}).collect(Collectors.toList&lt;GrantedAuthority&gt;()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity.ok(SuccessfulSigninResponse(user.username, authorities)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"User not found!"</span></span>), HttpStatus.BAD_REQUEST) } } <span class="hljs-meta"><span class="hljs-meta">@PostMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/signup"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Valid</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@RequestBody</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newUser: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">NewUser</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userCandidate: Optional &lt;User&gt; = userRepository.findByUsername(newUser.username!!) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(newUser.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!userCandidate.isPresent) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (usernameExists(newUser.username!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Username is already taken!"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (emailExists(newUser.email!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Email is already in use!"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Creating user's account val user = User( 0, newUser.username!!, newUser.firstName!!, newUser.lastName!!, newUser.email!!, encoder.encode(newUser.password), false ) user.roles = Arrays.asList(roleRepository.findByName("ROLE_USER")) val registeredUser = userRepository.save(user) emailService.sendRegistrationConfirmationEmail(registeredUser) } catch (e: Exception) { return ResponseEntity(ResponseMessage("Server error. Please, contact site owner"), HttpStatus.SERVICE_UNAVAILABLE) } return ResponseEntity(ResponseMessage("Please, follow the link in the confirmation email to complete the registration."), HttpStatus.OK) } else { return ResponseEntity(ResponseMessage("User already exists!"), HttpStatus.BAD_REQUEST) } } @PostMapping("/registrationConfirm") @CrossOrigin(origins = ["*"]) @Throws(UnsupportedEncodingException::class) fun confirmRegistration(request: HttpServletRequest, model: Model, @RequestParam("token") token: String): ResponseEntity&lt;*&gt; { when(userService.validateVerificationToken(token)) { TOKEN_VALID -&gt; return ResponseEntity.ok(ResponseMessage("Registration confirmed")) TOKEN_INVALID -&gt; return ResponseEntity(ResponseMessage("Token is invalid!"), HttpStatus.BAD_REQUEST) TOKEN_EXPIRED -&gt; return ResponseEntity(ResponseMessage("Token is invalid!"), HttpStatus.UNAUTHORIZED) } return ResponseEntity(ResponseMessage("Server error. Please, contact site owner"), HttpStatus.SERVICE_UNAVAILABLE) } @PostMapping("/logout") fun logout(response: HttpServletResponse): ResponseEntity&lt;*&gt; { val cookie: Cookie = Cookie(authCookieName, null) cookie.maxAge = 0 cookie.secure = isCookieSecure cookie.isHttpOnly = true cookie.path = "/" response.addCookie(cookie) return ResponseEntity.ok(ResponseMessage("Successfully logged")) } private fun emailExists(email: String): Boolean { return userRepository.findByUsername(email).isPresent } private fun usernameExists(username: String): Boolean { return userRepository.findByUsername(username).isPresent } }</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЖрдЧреЗ рдХреЗ рднрд╛рдЧ рдкрд░ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдШрдЯрдХ рдмрдирд╛рдПрдВ </font></font><code>RegistrationConfirmPage.vue</code> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 2</font></font></b><font style="vertical-align: inherit;"></font><code>router.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдПрдХ рдирдпрд╛ рдкрде рдЬреЛрдбрд╝реЗрдВ </font></font><code>:token</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/registration-confirm/:token'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'RegistrationConfirmPage'</span></span>, <span class="hljs-attr"><span class="hljs-attr">component</span></span>: RegistrationConfirmPage }</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдкрдбреЗрдЯ </font></font><code>SignUp.vue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдкреНрд░рдкрддреНрд░реЛрдВ рд╕реЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдбреЗрдЯрд╛ рднреЗрдЬрдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╕реВрдЪрд┐рдд рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдкрдВрдЬреАрдХрд░рдг рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрддреНрд░ рдореЗрдВ рджрд┐рдП рдЧрдП рд▓рд┐рдВрдХ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 4 </font></font></b> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╣рддреНрд╡рдкреВрд░реНрдг:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдлрд╕реЛрд╕, рд╣рдо рдПрдХ рдЕрд▓рдЧ рдШрдЯрдХ рдХреЛ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд▓рд┐рдВрдХ рдирд╣реАрдВ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЯреЛрдХрди рдХреЛ рдорд╛рдиреНрдп рдХрд░реЗрдЧрд╛ рдФрд░ рд╕рдлрд▓рддрд╛ рдпрд╛ рд╡рд┐рдлрд▓рддрд╛ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╕рднреА рд╕рдорд╛рди рд░рд╛рд╕реНрддреЛрдВ рдХреЗ рд▓рд┐рдВрдХ рд╣рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдореВрд▓ рдкреГрд╖реНрда рдкрд░ рд▓реЗ рдЬрд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╣рдо рдЕрдкрдиреЗ рдЖрд╡реЗрджрди рдХреЛ рдкреНрд░реЗрд╖рд┐рдд рдЬреАрдИрдЯреА рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрдВрдЬреАрдХрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>confirmRegistration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs">methods: { confirmRegistration() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$route.query.confirmRegistration === <span class="hljs-string"><span class="hljs-string">'true'</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$route.query.token != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$router.push({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'RegistrationConfirmPage'</span></span>, <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">token</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$route.query.token}}); } }, ... mounted() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.confirmRegistration(); }</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрд▓рд┐рдП рдПрдХ рдШрдЯрдХ рдмрдирд╛рддреЗ рд╣реИрдВ рдЬреЛ рд╕рддреНрдпрд╛рдкрди рдкрд░ рдЯреЛрдХрди рд╕рддреНрдпрд╛рдкрди рдФрд░ рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддрд╛ рд╣реИ:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RegistrationConfirmPage.vue</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs">&lt;template&gt; &lt;div id="registration-confirm"&gt; &lt;div class="confirm-form"&gt; &lt;b-card title="Confirmation" tag="article" style="max-width: 20rem;" class="mb-2" &gt; &lt;div v-if="isSuccess"&gt; &lt;p class="success"&gt;Account is successfully verified!&lt;/p&gt; &lt;router-link to="/login"&gt; &lt;b-button variant="primary"&gt;Login&lt;/b-button&gt; &lt;/router-link&gt; &lt;/div&gt; &lt;div v-if="isError"&gt; &lt;p class="fail"&gt;Verification failed:&lt;/p&gt; &lt;p&gt;{{ errorMessage }}&lt;/p&gt; &lt;/div&gt; &lt;/b-card&gt; &lt;/div&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; import {AXIOS} from './http-common' export default { name: 'RegistrationConfirmPage', data() { return { isSuccess: false, isError: false, errorMessage: '' } }, methods: { executeVerification() { AXIOS.post(`/auth/registrationConfirm`, null, {params: { 'token': this.$route.params.token}}) .then(response =&gt; { this.isSuccess = true; console.log(response); }, error =&gt; { this.isError = true; this.errorMessage = error.response.data.message; }) .catch(e =&gt; { console.log(e); this.errorMessage = 'Server error. Please, report this error website owners'; }) } }, mounted() { this.executeVerification(); } } &lt;/script&gt; &lt;style scoped&gt; .confirm-form { margin-left: 38%; margin-top: 50px; } .success { color: green; } .fail { color: red; } &lt;/style&gt;</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/0n/vj/os/0nvjosmit-f6n538uae6rsvwujo.png"><br></div></div><br><h3>  рдПрдХ рдирд┐рд╖реНрдХрд░реНрд╖ рдХреЗ рдмрдЬрд╛рдп </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╕рд╛рдордЧреНрд░реА рдХреЗ рдЕрдВрдд рдореЗрдВ, рдореИрдВ рдПрдХ рд╡рд┐рд╖рдпрд╛рдВрддрд░ рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ рдФрд░ рдХрд╣рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ рдХрд┐ рдЗрд╕ рдкрд░ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдмрд╣реБрдд рдЕрд╡рдзрд╛рд░рдгрд╛ рдФрд░ рдкрд┐рдЫрд▓рд╛ рд▓реЗрдЦ рд▓реЗрдЦрди рдХреЗ рд╕рдордп рдирдпрд╛ рдирд╣реАрдВ рдерд╛ред </font><font style="vertical-align: inherit;">рдЯрд╛рд╕реНрдХ рдЬрд▓реНрджреА рдЖрдзреБрдирд┐рдХ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪреМрдЦрдЯреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕реНрдкреНрд░рд┐рдВрдЧ рдмреВрдЯ рдкрд░ рдЖрд╡реЗрджрди рдХреА рдПрдХ рдкреВрд░реА рдвреЗрд░ рдХреЛрдгреАрдп / рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ / Vue.js рд╕реБрдВрджрд░ рдврдВрдЧ рд╕реЗ рд╣рд▓ рдХрд░рддреА рдмрдирд╛рдиреЗ </font></font><a href="https://www.jhipster.tech/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hipster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЛ JHipster рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рднреА рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЗрд╕ рд╕реНрдерд╛рди рдкрд░ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдкрд╛рдардХреЛрдВ рдХреЛ рд╡рд┐рдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рднреЛрдЬрди рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдпрд╣ рд╕рд╛рдордЧреНрд░реА рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧреАред</font></font><br><br><a name="links"></a><br><h2>  рдЙрдкрдпреЛрдЧреА рд▓рд┐рдВрдХ </h2><br><ul><li> <a href="https://github.com/DrLeprechaun/kotlin-spring-vue" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА ("рдорд╛рдЗрдЧреНрд░реЗрдЯ рдЯреВ рдЧреНрд░реЗрдб" рд╕реНрдЯреЗрдк рддрдХ)</font></font></a> </li><li> <a href="https://github.com/DrLeprechaun/kotlin-spring-vue-gradle" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА ("рдорд╛рдЗрдЧреНрд░реЗрдЯ рдЯреВ рдЧреНрд░реЗрдб" рдХрджрдо рдХреЗ рдмрд╛рдж)</font></font></a> </li><li> <a href="https://kotlin-spring-vue-demo.herokuapp.com/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрдкреНрд░рдпреЛрдЧ ("рдорд╛рдЗрдЧреНрд░реЗрдЯ рдЯреВ рдЧреНрд░реЗрдб" рд╕реНрдЯреЗрдк рддрдХ)</font></font></a> </li><li> <a href="https://kotlin-spring-vue-gradle-demo.herokuapp.com/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╡реЗрджрди (рдХрджрдо "рдорд╛рдЗрдЧреНрд░реЗрд╢рди рдЯреВ рдЧреНрд░реЗрдб") рдХреЗ рдмрд╛рдж</font></font></a> </li><li> <a href="https://vaadimblog.blogspot.com/p/kotlin-spring-boot-vuejs.html" rel="nofollow">  ,   ,    </a> </li><li> <a href="https://itnext.io/how-to-use-google-recaptcha-with-vuejs-7756244400da" rel="nofollow">How to use Google reCaptcha with Vuejs</a> </li><li> <a href="https://vuejsexamples.com/google-recaptcha-component-for-vue-js/" rel="nofollow">Google ReCAPTCHA component for Vue.js</a> </li><li> <a href="https://www.baeldung.com/spring-email" rel="nofollow">Guide to Spring Email</a> </li><li> <a href="https://medium.com/%40raviswapna1/send-email-using-spring-boot-and-thymeleaf-b0f62786bd8e" rel="nofollow">Send Email using Spring Boot and Thymeleaf</a> </li><li> <a href="https://docs.gradle.org/5.6.3/userguide/migrating_from_maven.html" rel="nofollow">Migrating Builds From Apache Maven</a> </li><li> <a href="https://guides.gradle.org/migrating-build-logic-from-groovy-to-kotlin/" rel="nofollow">Migrating build logic from Groovy to Kotlin</a> </li><li> <a href="https://ordina-jworks.github.io/architecture/2018/10/12/spring-boot-angular-gradle.html" rel="nofollow">Integrate Angular in Spring Boot Using Gradle</a> </li><li> <a href="https://devcenter.heroku.com/articles/getting-started-with-gradle-on-heroku" rel="nofollow">Getting Started with Gradle on Heroku</a> </li><li> <a href="https://devcenter.heroku.com/articles/deploying-gradle-apps-on-heroku" rel="nofollow">Deploying Gradle Apps on Heroku</a> </li><li> <a href="https://devcenter.heroku.com/articles/deploying-gradle-apps-on-heroku" rel="nofollow">Deploying multi-project builds</a> </li><li> <a href="https://www.rdegges.com/2018/please-stop-using-local-storage/" rel="nofollow">Please Stop Using Local Storage</a> </li><li> <a href="https://medium.com/%40jcbaey/authentication-in-spa-reactjs-and-vuejs-the-right-way-e4a9ac5cd9a3" rel="nofollow">Authentication in SPA (ReactJS and VueJS) the right way</a> </li><li> <a href="https://www.ninjadevcorner.com/2018/09/stateless-authentication-jwt-secure-spring-boot-rest-api.html" rel="nofollow">Stateless Authentication using JWT to secure a Spring Boot REST API</a> </li><li> <a href="https://www.baeldung.com/registration-verify-user-by-email" rel="nofollow">Registration тАУ Activate a New Account by Email</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi482222/">https://habr.com/ru/post/hi482222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi482210/index.html">рдЯреЗрдЯреНрд░рд┐рд╕ рдХреЗ рд▓рд┐рдП рдмреЙрдЯ рдФрд░ рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдПрдиреАрдореЗрд╢рдиред рджреВрд╕рд░реА рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдЪреИрдореНрдкрд┐рдпрдирд╢рд┐рдк рдХреЗ рдореЛрдмрд╛рдЗрд▓ рдЯреНрд░реИрдХ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a></li>
<li><a href="../hi482212/index.html">рдмрд╛рдд рдХрд░рддреЗ рд╣реИрдВ ... рдкрдиреАрд░?</a></li>
<li><a href="../hi482216/index.html">рдПрдХ рдкреЗрд╢реЗрд╡рд░ рдордиреЛрдЪрд┐рдХрд┐рддреНрд╕рдХ рдореИрдХреНрд╕рд┐рдо рдорд╛рд▓реНрдпрд╛рд╡рд┐рди (dpmmax) рд╕реЗ рдЕрд╡рд╕рд╛рдж рдХреЗ рд▓рд┐рдП 23 рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ</a></li>
<li><a href="../hi482218/index.html">27 рджрд┐рд╕рдВрдмрд░ рдХреЗ рд▓рд┐рдП рдЬрд╛рд╡рд╛ рдбрд╛рдЗрдЬреЗрд╕реНрдЯ</a></li>
<li><a href="../hi482220/index.html">рдЕрд░реБрдХреЛ рдорд╛рд░реНрдХрд░ рд╕реНрдерд╛рдиреАрдпрдХрд░рдг</a></li>
<li><a href="../hi482224/index.html">рдЬрдм рдПрдХ рдбрд┐рдЬрд╛рдЗрдирд░ рдХреЛ рдереЛрдбрд╝рд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ</a></li>
<li><a href="../hi482226/index.html">рд╢реАрд░реНрд╖ 20 рдРрдкреНрд╕ рдЬреЛ рдПрдХ рд╣реЗрд▓реНрдердХреЗрдпрд░ рдкреНрд░рджрд╛рддрд╛ рдорд┐рд╕ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi482228/index.html">рд╣рдо C # рдореЗрдВ рдПрдХ тАЬрдХреИрд▓рдХреБрд▓реЗрдЯрд░тАЭ рд▓рд┐рдЦрддреЗ рд╣реИрдВред рднрд╛рдЧ I рдореВрд▓реНрдп рдЧрдгрдирд╛, рд╡реНрдпреБрддреНрдкрдиреНрди, рд╕рд░рд▓реАрдХрд░рдг, рдФрд░ рдЕрдиреНрдп рдХрд▓рд╣рдВрд╕</a></li>
<li><a href="../hi482230/index.html">рд╡реЗрдм рд╕рд░реНрд╡рд░реЛрдВ рдХреА рд▓рдбрд╝рд╛рдИред рднрд╛рдЧ 2 - рдпрдерд╛рд░реНрдерд╡рд╛рджреА HTTPS рдкрд░рд┐рджреГрд╢реНрдп:</a></li>
<li><a href="../hi482232/index.html">StackOverflow рдмреЗрд╡рдХреВрдл рд╕рд╡рд╛рд▓реЛрдВ рдХреЗ рдЬрд╡рд╛рдм рдХреЗ рд╕рд┐рд░реНрдл рдПрдХ рднрдВрдбрд╛рд░ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>