<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìã ü§±üèº ‚ô¶Ô∏è Practical Go: Dicas para escrever programas suportados no mundo real ‚òùüèΩ üëßüèº üë®üèΩ‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo se concentra nas pr√°ticas recomendadas para escrever c√≥digo Go. √â composto no estilo de apresenta√ß√£o, mas sem os slides usuais. Vamos tent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Practical Go: Dicas para escrever programas suportados no mundo real</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441842/">  Este artigo se concentra nas pr√°ticas recomendadas para escrever c√≥digo Go.  √â composto no estilo de apresenta√ß√£o, mas sem os slides usuais.  Vamos tentar brevemente e claramente percorrer cada item. <br><br>  Primeiro, voc√™ precisa concordar sobre o significado das <i>melhores</i> pr√°ticas para uma linguagem de programa√ß√£o.  Aqui voc√™ pode se lembrar das palavras de Russ Cox, diretor t√©cnico da Go: <br><br><blockquote>  Engenharia de software √© o que acontece com a programa√ß√£o, se voc√™ adicionar o fator tempo e outros programadores. </blockquote><br>  Assim, Russ distingue entre os conceitos de <i>programa√ß√£o</i> e <i>engenharia de software</i> .  No primeiro caso, voc√™ escreve um programa para si mesmo; no segundo, cria um produto no qual outros programadores trabalhar√£o com o tempo.  Engenheiros v√™m e v√£o.  As equipes crescem ou encolhem.  Novos recursos s√£o adicionados e os bugs s√£o corrigidos.  Essa √© a natureza do desenvolvimento de software. <br><a name="habracut"></a><br><a name="0"></a><h1>  Conte√∫do </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conte√∫do</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1. Princ√≠pios fundamentais</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.1</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Simplicidade</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.2</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Legibilidade</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.3</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Produtividade</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2. Identificadores</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.1</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Identificadores de nome com base na clareza e n√£o na brevidade</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.2</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Comprimento do ID</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.3</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">N√£o nomeie vari√°veis ‚Äã‚Äãpor tipo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.4</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Use um √∫nico estilo de nomea√ß√£o</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.5</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Use um √∫nico estilo de declara√ß√£o</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.6</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Trabalho para a equipe</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3. Coment√°rios</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3.1</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Coment√°rios em vari√°veis ‚Äã‚Äãe constantes devem descrever seu conte√∫do, n√£o o objetivo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3.2</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sempre documente caracteres publicamente dispon√≠veis</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4. Estrutura do pacote</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.1</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um bom pacote come√ßa com um bom nome</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.2</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Evite nomes como base, comum ou util</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.3</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Volte rapidamente sem mergulhar fundo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.4</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tornar o valor nulo √∫til</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.5</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Evitar estado do n√≠vel do pacote</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5. Estrutura do projeto</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.1</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Menos pacotes, mas maiores</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.2</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O menor pacote principal</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6. estrutura da API</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6.1</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">APIs de design dif√≠ceis de abusar por design</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6.2</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Projetar uma API para um caso de uso b√°sico</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6.3</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Deixe as fun√ß√µes determinarem o comportamento desejado.</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">7. Tratamento de erros</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">7.1</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Elimine a necessidade de tratamento de erros removendo os pr√≥prios erros</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">7.2</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Manipule o erro apenas uma vez</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">8. Concorr√™ncia</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">8.1</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fa√ßa algum trabalho o tempo todo.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">8.2</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Deixe o paralelismo para o chamador</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">8.3</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nunca execute a goroutine sem saber quando vai parar</a> </li></ul></li></ul><br><a name="1"></a><h1>  1. Princ√≠pios fundamentais </h1><br>  Talvez eu seja um dos primeiros usu√°rios do Go entre voc√™s, mas essa n√£o √© minha opini√£o pessoal.  Estes princ√≠pios b√°sicos est√£o subjacentes ao pr√≥prio Go: <br><br><ol><li>  Simplicidade </li><li>  Legibilidade </li><li>  Produtividade </li></ol><br>  <i>Nota</i>  <i>Observe que eu n√£o mencionei "desempenho" ou "simultaneidade".</i>  <i>Existem idiomas mais r√°pidos que o Go, mas certamente n√£o podem ser comparados com simplicidade.</i>  <i>Existem linguagens que colocam o paralelismo como a principal prioridade, mas elas n√£o podem ser comparadas em termos de legibilidade ou produtividade de programa√ß√£o.</i> <i><br><br></i>  <i>Desempenho e simultaneidade s√£o atributos importantes, mas n√£o t√£o importantes quanto simplicidade, legibilidade e produtividade.</i> <br><br><a name="1_1"></a><h2>  Simplicidade </h2><br><blockquote>  <i>‚ÄúSimplicidade √© um pr√©-requisito para a confiabilidade‚Äù</i> - Edsger Dijkstra </blockquote><br>  Por que lutar pela simplicidade?  Por que √© importante que os programas Go sejam simples? <br><br>  Cada um de n√≥s se deparou com um c√≥digo incompreens√≠vel, certo?  Quando voc√™ tem medo de fazer uma altera√ß√£o, porque isso interrompe outra parte do programa que voc√™ n√£o entende e n√£o sabe como consertar.  Essa √© a dificuldade. <br><br><blockquote>  <i>‚ÄúExistem duas maneiras de projetar software: a primeira √© torn√°-lo t√£o simples que n√£o h√° falhas √≥bvias, e a segunda √© torn√°-lo t√£o complexo que n√£o h√° falhas √≥bvias.</i>  <i>O primeiro √© muito mais dif√≠cil. ‚Äù</i> - C.E. R. Hoar </blockquote><br>  Complexidade transforma software confi√°vel em n√£o confi√°vel.  Complexidade √© o que mata projetos de software.  Portanto, a simplicidade √© o objetivo final da Go.  Quaisquer que sejam os programas que escrevemos, eles devem ser simples. <br><br><a name="1_2"></a><h2>  1.2  Legibilidade </h2><br><blockquote>  <i>‚ÄúA legibilidade √© parte integrante da manuten√ß√£o‚Äù</i> - Mark Reinhold, JVM Conference, 2018 </blockquote><br>  Por que √© importante que o c√≥digo seja leg√≠vel?  Por que devemos nos esfor√ßar para facilitar a leitura? <br><br><blockquote>  <i>‚ÄúOs programas devem ser escritos para as pessoas e as m√°quinas apenas os executam‚Äù</i> - Hal Abelson e Gerald Sassman, ‚ÄúEstrutura e interpreta√ß√£o de programas de computador‚Äù </blockquote><br>  N√£o apenas os programas Go, mas geralmente todo o software √© escrito por pessoas para pessoas.  O fato de as m√°quinas tamb√©m processarem c√≥digo √© secund√°rio. <br><br>  Uma vez que o c√≥digo escrito ser√° lido repetidamente pelas pessoas: centenas, se n√£o milhares de vezes. <br><br><blockquote>  <i>‚ÄúA habilidade mais importante para um programador √© a capacidade de comunicar id√©ias de maneira eficaz.‚Äù</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gaston Horker</a> </blockquote><br>  A legibilidade √© a chave para entender o que um programa faz.  Se voc√™ n√£o consegue entender o c√≥digo, como mant√™-lo?  Se o software n√£o puder ser suportado, ele ser√° reescrito;  e essa pode ser a √∫ltima vez que sua empresa usa o Go. <br><br>  Se voc√™ est√° escrevendo um programa para si mesmo, fa√ßa o que funciona para voc√™.  Mas se isso faz parte de um projeto conjunto ou o programa for usado por tempo suficiente para alterar os requisitos, fun√ß√µes ou o ambiente em que ele trabalha, seu objetivo √© tornar o programa sustent√°vel. <br><br>  O primeiro passo para escrever o software suportado √© garantir que o c√≥digo esteja claro. <br><br><a name="1_3"></a><h2>  1.3  Produtividade </h2><br><blockquote>  <i>‚ÄúO design √© a arte de organizar o c√≥digo para que ele funcione hoje, mas sempre suporte mudan√ßas.‚Äù</i> - Sandy Mets </blockquote><br>  Como √∫ltimo princ√≠pio b√°sico, quero nomear a produtividade do desenvolvedor.  Esse √© um t√≥pico importante, mas tudo se resume √† propor√ß√£o: quanto tempo voc√™ gasta em trabalho √∫til e quanto - aguardando uma resposta de ferramentas ou andan√ßas sem esperan√ßa em uma base de c√≥digo incompreens√≠vel.  Os programadores de Go devem sentir que podem lidar com muito trabalho. <br><br>  √â uma piada que a linguagem Go tenha sido desenvolvida enquanto o programa C ++ estava compilando.  A compila√ß√£o r√°pida √© um recurso essencial do Go e um fator essencial para atrair novos desenvolvedores.  Embora os compiladores estejam sendo aprimorados, em geral, a compila√ß√£o de minutos em outros idiomas leva alguns segundos no Go.  Os desenvolvedores do So Go se sentem t√£o produtivos quanto os programadores em linguagens din√¢micas, mas sem problemas com a confiabilidade dessas linguagens. <br><br>  Se falamos fundamentalmente sobre a produtividade dos desenvolvedores, os programadores do Go entendem que a leitura do c√≥digo √© essencialmente mais importante do que a sua cria√ß√£o.  Nessa l√≥gica, o Go chega ao ponto de usar as ferramentas para formatar todo o c√≥digo em um determinado estilo.  Isso elimina a menor dificuldade em aprender o dialeto espec√≠fico de um projeto espec√≠fico e ajuda a identificar erros, porque eles simplesmente <i>parecem</i> errados em compara√ß√£o com o c√≥digo regular. <br><br>  Os programadores da Go n√£o passam dias depurando erros estranhos de compila√ß√£o, scripts de compila√ß√£o complexos ou implementando c√≥digo em um ambiente de produ√ß√£o.  E o mais importante, eles n√£o perdem tempo tentando entender o que um colega escreveu. <br><br>  Quando os desenvolvedores do Go falam sobre <i>escalabilidade</i> , eles significam produtividade. <br><br><a name="2"></a><h1>  2. Identificadores </h1><br>  O primeiro t√≥pico que discutiremos - <i>identificadores</i> , √© sin√¥nimo de <i>nomes</i> : nomes de vari√°veis, fun√ß√µes, m√©todos, tipos, pacotes e assim por diante. <br><br><blockquote>  <i>‚ÄúO mau nome √© um sintoma de mau design‚Äù</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dave Cheney</a> </blockquote><br>  Dada a sintaxe limitada do Go, os nomes de objetos t√™m um enorme impacto na legibilidade do programa.  A legibilidade √© um fator chave no bom c√≥digo, portanto, a escolha de bons nomes √© crucial. <br><br><a name="2_1"></a><h2>  2.1  Identificadores de nome com base na clareza e n√£o na brevidade </h2><br><blockquote>  <i>‚Äú√â importante que o c√≥digo seja √≥bvio.</i>  <i>O que voc√™ pode fazer em uma linha, voc√™ deve fazer em tr√™s. ‚Äù</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ukia Smith</a> </blockquote><br>  O Go n√£o √© otimizado para one-liners complicados ou o n√∫mero m√≠nimo de linhas em um programa.  N√£o otimizamos o tamanho do c√≥digo fonte no disco, nem o tempo necess√°rio para digitar o programa no editor. <br><br><blockquote>  <i>‚ÄúUm bom nome √© como uma boa piada.</i>  <i>Se voc√™ precisar explicar, n√£o ser√° mais engra√ßado. ‚Äù</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dave Cheney</a> </blockquote><br>  A chave da m√°xima clareza s√£o os nomes que escolhemos para identificar programas.  Que qualidades s√£o inerentes a um bom nome? <br><br><ul><li>  <b>Um bom nome √© conciso</b> .  N√£o precisa ser o mais curto, mas n√£o cont√©m excesso.  Possui uma alta rela√ß√£o sinal / ru√≠do. </li><li>  <b>Um bom nome √© descritivo</b> .  Descreve o uso de uma vari√°vel ou constante, <i>n√£o o</i> conte√∫do.  Um bom nome descreve o resultado de uma fun√ß√£o ou o comportamento de um m√©todo, <i>n√£o uma</i> implementa√ß√£o.  O objetivo do pacote, <i>n√£o</i> seu conte√∫do.  Quanto mais precisamente o nome descreve o que identifica, melhor. </li><li>  <b>Um bom nome √© previs√≠vel</b> .  Por um nome, voc√™ deve entender como o objeto ser√° usado.  Os nomes devem ser descritivos, mas tamb√©m √© importante seguir a tradi√ß√£o.  √â isso que os programadores do Go querem dizer quando dizem <i>"idiom√°tico"</i> . </li></ul><br>  Vamos considerar em mais detalhes cada uma dessas propriedades. <br><br><a name="2_2"></a><h2>  2.2  Comprimento do ID </h2><br>  √Äs vezes, o estilo de Go √© criticado por nomes curtos de vari√°veis.  Como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">disse</a> Rob Pike, "os programadores da Go querem identificadores do tamanho <i>correto</i> ". <br><br>  Andrew Gerrand oferece identificadores mais longos para indicar import√¢ncia. <br><br><blockquote>  <i>‚ÄúQuanto maior a dist√¢ncia entre a declara√ß√£o de um nome e o uso de um objeto, maior deve ser o nome‚Äù</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Andrew Gerrand</a> </blockquote><br>  Assim, algumas recomenda√ß√µes podem ser feitas: <br><br><ul><li>  Nomes curtos de vari√°veis ‚Äã‚Äãs√£o bons se a dist√¢ncia entre a declara√ß√£o e o <i>√∫ltimo</i> uso for pequena. <br></li><li>  Nomes de vari√°veis ‚Äã‚Äãlongos devem se justificar;  quanto mais longos, mais importantes devem ser.  Os t√≠tulos detalhados cont√™m pouco sinal em rela√ß√£o ao peso na p√°gina. <br></li><li>  N√£o inclua o nome do tipo no nome da vari√°vel. <br></li><li>  Nomes constantes devem descrever o valor interno, n√£o como o valor √© usado. <br></li><li>  Prefira vari√°veis ‚Äã‚Äãde letra √∫nica para loops e ramifica√ß√µes, palavras separadas para par√¢metros e valores de retorno, v√°rias palavras para fun√ß√µes e declara√ß√µes no n√≠vel do pacote. <br></li><li>  Prefira palavras simples para m√©todos, interfaces e pacotes. <br></li><li>  Lembre-se de que o nome do pacote faz parte do nome que o chamador usa para refer√™ncia. </li></ul><br>  Considere um exemplo. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Person <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Age <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> } <span class="hljs-comment"><span class="hljs-comment">// AverageAge returns the average age of people. func AverageAge(people []Person) int { if len(people) == 0 { return 0 } var count, sum int for _, p := range people { sum += p.Age count += 1 } return sum / count }</span></span></code> </pre> <br>  Na d√©cima linha, uma vari√°vel do intervalo <code>p</code> declarada e √© chamada apenas uma vez da pr√≥xima linha.  Ou seja, a vari√°vel permanece na p√°gina por um per√≠odo muito curto.  Se o leitor estiver interessado no papel de <code>p</code> no programa, ele s√≥ precisar√° ler duas linhas. <br><br>  Para compara√ß√£o, <code>people</code> declaradas em par√¢metros de fun√ß√£o e sete linhas ao vivo.  O mesmo vale para <code>sum</code> e <code>count</code> , para que justifiquem seus nomes mais longos.  O leitor precisa digitalizar mais c√≥digos para encontr√°-los: isso justifica os nomes mais distintos. <br><br>  Voc√™ pode escolher <code>s</code> para <code>sum</code> <code>c</code> (ou <code>n</code> ) para <code>count</code> , mas isso reduz a import√¢ncia de todas as vari√°veis ‚Äã‚Äãno programa para o mesmo n√≠vel.  Voc√™ pode substituir as <code>people</code> por <code>p</code> , mas haver√° um problema, o que chamar de vari√°vel de itera√ß√£o <code>for ... range</code> .  Uma √∫nica <code>person</code> parecer√° estranha, porque uma vari√°vel de itera√ß√£o de curta dura√ß√£o recebe um nome mais longo do que v√°rios valores dos quais √© derivada. <br><br><blockquote>  <b>Dica</b> .  Separe o fluxo de fun√ß√µes com linhas vazias, pois as linhas vazias entre par√°grafos interrompem o fluxo de texto.  Na <code>AverageAge</code> , temos tr√™s opera√ß√µes consecutivas.  Primeiro, verificando a divis√£o por zero, depois a conclus√£o da idade total e n√∫mero de pessoas e a √∫ltima - o c√°lculo da idade m√©dia. </blockquote><br><h3>  2.2.1  O principal √© o contexto </h3><br>  √â importante entender que a maioria das dicas de nomenclatura √© espec√≠fica ao contexto.  Eu gosto de dizer que isso √© um princ√≠pio, n√£o uma regra. <br><br>  Qual √© a diferen√ßa entre <code>i</code> e <code>index</code> ?  Por exemplo, voc√™ n√£o pode dizer inequivocamente que esse c√≥digo <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> index := <span class="hljs-number"><span class="hljs-number">0</span></span>; index &lt; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(s); index++ { <span class="hljs-comment"><span class="hljs-comment">// }</span></span></code> </pre> <br>  fundamentalmente mais leg√≠vel do que <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(s); i++ { <span class="hljs-comment"><span class="hljs-comment">// }</span></span></code> </pre> <br>  Acredito que a segunda op√ß√£o n√£o √© pior, porque nesse caso a regi√£o <code>i</code> ou o <code>index</code> limitado pelo corpo do loop <code>for</code> , e a verbosidade adicional acrescenta pouco ao entendimento do programa. <br><br>  Mas qual dessas fun√ß√µes √© mais leg√≠vel? <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s *SNMP)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(oid []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, index </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span></code> </pre> <br>  ou <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s *SNMP)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(o []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, i </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span></code> </pre> <br>  Neste exemplo, <code>oid</code> √© uma abrevia√ß√£o de SNMP Object ID e a abrevia√ß√£o adicional para <code>o</code> for√ßa ao ler c√≥digo para alternar de uma nota√ß√£o documentada para uma nota√ß√£o mais curta no c√≥digo.  Da mesma forma, reduzir o <code>index</code> para <code>i</code> torna mais dif√≠cil entender, porque nas mensagens SNMP, o sub-valor de cada OID √© chamado de √≠ndice. <br><br><blockquote>  <b>Dica</b> .  N√£o combine par√¢metros formais longos e curtos em um an√∫ncio. </blockquote><br><a name="2_3"></a><h2>  2.3  N√£o nomeie vari√°veis ‚Äã‚Äãpor tipo </h2><br>  Voc√™ n√£o chama seus animais de estima√ß√£o de "cachorro" e "gato", certo?  Pelo mesmo motivo, voc√™ n√£o deve incluir o nome do tipo no nome da vari√°vel.  Ele deve descrever o conte√∫do, n√£o seu tipo.  Considere um exemplo: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> usersMap <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*User</code> </pre> <br>  Que bom √© esse an√∫ncio?  Vemos que este √© um mapa e tem algo a ver com o <code>*User</code> Tipo de <code>*User</code> : isso provavelmente √© bom.  Mas <code>usersMap</code> √© <i>realmente um</i> mapa, e Go, como uma linguagem de tipo estaticamente, n√£o permitir√° o uso acidental de um nome como esse quando uma vari√°vel escalar for necess√°ria, portanto o sufixo do <code>Map</code> √© redundante. <br><br>  Considere uma situa√ß√£o em que outras vari√°veis ‚Äã‚Äãs√£o adicionadas: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ( companiesMap <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*Company productsMap <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*Products )</code> </pre> <br>  Agora, temos tr√™s vari√°veis ‚Äã‚Äãdo tipo mapa: <code>usersMap</code> , <code>companiesMap</code> e <code>productsMap</code> , e todas as linhas s√£o mapeadas para tipos diferentes.  Sabemos que esses s√£o mapas e tamb√©m sabemos que o compilador lan√ßar√° um erro se tentarmos usar <code>companiesMap</code> onde o c√≥digo espera <code>map[string]*User</code> .  Nessa situa√ß√£o, fica claro que o sufixo <code>Map</code> n√£o melhora a clareza do c√≥digo, s√£o apenas caracteres extras. <br><br>  Sugiro evitar sufixos semelhantes ao tipo de uma vari√°vel. <br><br><blockquote>  <b>Dica</b> .  Se o nome de <code>users</code> n√£o descrever a ess√™ncia com clareza suficiente, o <code>usersMap</code> tamb√©m. </blockquote><br>  Esta dica tamb√©m se aplica aos par√¢metros de fun√ß√£o.  Por exemplo: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { <span class="hljs-comment"><span class="hljs-comment">// } func WriteConfig(w io.Writer, config *Config)</span></span></code> </pre> <br>  O nome da <code>config</code> para o par√¢metro <code>*Config</code> √© redundante.  J√° sabemos que este √© <code>*Config</code> ; ele √© imediatamente escrito ao lado. <br><br>  Nesse caso, considere <code>conf</code> ou <code>c</code> se a vida √∫til da vari√°vel for curta o suficiente. <br><br>  Se em algum momento da nossa √°rea houver mais de um <code>*Config</code> , os nomes <code>conf1</code> e <code>conf2</code> menos significativos que o <code>original</code> e <code>updated</code> , pois os √∫ltimos s√£o mais dif√≠ceis de serem misturados. <br><br><blockquote>  <b>Nota</b>  N√£o permita que nomes de pacotes roubem bons nomes de vari√°veis. <br><br>  O nome do identificador importado cont√©m o nome do pacote.  Por exemplo, o tipo de <code>context</code> pacote de <code>context</code> ser√° chamado <code>context.Context</code> .  Isso impossibilita o uso de uma vari√°vel ou tipo de <code>context</code> no seu pacote. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context context.Context, message </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre> <br>  Isso n√£o ser√° compilado.  √â por isso que, ao declarar o <code>context.Context</code> Tipos de <code>context.Context</code> localmente, por exemplo, nomes como <code>ctx</code> s√£o tradicionalmente usados. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx context.Context, message </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre> </blockquote><br><a name="2_4"></a><h2>  2.4  Use um √∫nico estilo de nomea√ß√£o </h2><br>  Outra propriedade de um bom nome √© que deve ser previs√≠vel.  O leitor deve entend√™-lo imediatamente.  Se esse √© um nome <i>comum</i> , o leitor tem o direito de assumir que n√£o mudou o significado da √©poca anterior. <br><br>  Por exemplo, se o c√≥digo contornar o descritor do banco de dados, sempre que o par√¢metro for exibido, ele dever√° ter o mesmo nome.  Em vez de todos os tipos de combina√ß√µes como <code>d *sql.DB</code> , <code>dbase *sql.DB</code> , <code>DB *sql.DB</code> e <code>database *sql.DB</code> , √© melhor usar uma coisa: <br><br><pre> <code class="go hljs">db *sql.DB</code> </pre> <br>  √â mais f√°cil entender o c√≥digo.  Se voc√™ <code>*sql.DB</code> <code>db</code> , saber√° que √© <code>*sql.DB</code> e √© declarado localmente ou fornecido pelo chamador. <br><br>  Conselho semelhante em rela√ß√£o aos destinat√°rios de um m√©todo;  use o mesmo nome de destinat√°rio para cada m√©todo desse tipo.  Isso tornar√° mais f√°cil para o leitor entender o uso do receptor entre os v√°rios m√©todos desse tipo. <br><br><blockquote>  <b>Nota</b>  O Contrato de Nome Curto do Destinat√°rio da Go contradiz as recomenda√ß√µes expressas anteriormente.  Esse √© um daqueles casos em que a escolha feita em um est√°gio inicial se torna o estilo padr√£o, como usar o <code>CamelCase</code> vez de <code>snake_case</code> . </blockquote><br><blockquote>  <b>Dica</b> .  O estilo Ir aponta para nomes de uma letra ou abrevia√ß√µes para destinat√°rios derivados de seu tipo.  Pode acontecer que o nome do destinat√°rio √†s vezes esteja em conflito com o nome do par√¢metro no m√©todo.  Nesse caso, √© recomend√°vel aumentar um pouco o nome do par√¢metro e n√£o se esque√ßa de us√°-lo sequencialmente. </blockquote><br>  Finalmente, algumas vari√°veis ‚Äã‚Äãde uma letra s√£o tradicionalmente associadas a loops e contagem.  Por exemplo, <code>i</code> , <code>j</code> e <code>k</code> s√£o geralmente vari√°veis ‚Äã‚Äãindutivas em loops, <code>n</code> geralmente associado a um contador ou somador acumulador, <code>v</code> √© uma abrevia√ß√£o t√≠pica de valor em uma fun√ß√£o de codifica√ß√£o, <code>k</code> geralmente usado para uma chave de mapa e <code>s</code> frequentemente usado como uma abrevia√ß√£o de par√¢metros do tipo <code>string</code> . <br><br>  Como no exemplo <code>db</code> acima, os programadores <i>esperam que</i> <code>i</code> seja uma vari√°vel indutiva.  Se o virem no c√≥digo, esperam ver um loop em breve. <br><br><blockquote>  <b>Dica</b> .  Se voc√™ tiver tantos loops aninhados que esgotou as vari√°veis <code>i</code> , <code>j</code> <code>k</code> , poder√° dividir a fun√ß√£o em unidades menores. </blockquote><br><a name="2_5"></a><h2>  2.5  Use um √∫nico estilo de declara√ß√£o </h2><br>  Go tem pelo menos seis maneiras diferentes de declarar uma vari√°vel. <br><br><ul><li><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </li><li><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </li><li><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>; x = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </li><li><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> </li><li><pre> <code class="go hljs">x := <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </li></ul><br>  Tenho certeza de que ainda n√£o lembrei de tudo.  Os desenvolvedores do Go provavelmente consideram isso um erro, mas √© tarde demais para mudar qualquer coisa.  Com esta escolha, como garantir um estilo uniforme? <br><br>  Quero propor um estilo de declarar vari√°veis ‚Äã‚Äãque eu mesmo tento usar sempre que poss√≠vel. <br><br><ul><li>  <b>Ao declarar uma vari√°vel sem inicializa√ß√£o, use <code>var</code></b> . <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> players <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-comment"><span class="hljs-comment">// 0 var things []Thing // an empty slice of Things var thing Thing // empty Thing struct json.Unmarshall(reader, &amp;thing)</span></span></code> </pre> <br>  <code>var</code> atua como uma dica de que essa vari√°vel √© declarada <i>intencionalmente</i> como um valor nulo do tipo especificado.  Isso √© consistente com o requisito de declarar vari√°veis ‚Äã‚Äãno n√≠vel do pacote com <code>var</code> em oposi√ß√£o √† sintaxe da declara√ß√£o curta, embora eu argumente mais tarde que as vari√°veis ‚Äã‚Äãno n√≠vel do pacote n√£o devem ser usadas. </li><li>  <b>Ao declarar com inicializa√ß√£o, use <code>:=</code></b> .  Isso deixa claro para o leitor que a vari√°vel √† esquerda de <code>:=</code> intencionalmente inicializada. <br><br>  Para explicar o porqu√™, vejamos o exemplo anterior, mas desta vez inicializamos especialmente cada vari√°vel: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> players <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things []Thing = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thing *Thing = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(Thing) json.Unmarshall(reader, thing)</code> </pre> </li></ul><br>  Como o Go n√£o possui convers√µes autom√°ticas de um tipo para outro, no primeiro e terceiro exemplos, o tipo no lado esquerdo do operador de atribui√ß√£o deve ser id√™ntico ao tipo no lado direito.  O compilador pode inferir o tipo da vari√°vel declarada do tipo √† direita, para que o exemplo possa ser escrito de forma mais concisa: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> players = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things []Thing = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thing = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(Thing) json.Unmarshall(reader, thing)</code> </pre> <br>  Aqui, os <code>players</code> inicializados explicitamente em <code>0</code> , o que √© redundante, porque o valor inicial dos <code>players</code> √© zero em qualquer caso.  Portanto, √© melhor deixar claro que queremos usar um valor nulo: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> players <span class="hljs-keyword"><span class="hljs-keyword">int</span></span></code> </pre> <br>  E o segundo operador?  N√£o podemos determinar o tipo e escrever <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things = <span class="hljs-literal"><span class="hljs-literal">nil</span></span></code> </pre> <br>  Porque <code>nil</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√£o</a> <code>nil</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tipo</a> .  Em vez disso, temos uma escolha: ou usamos um valor zero para cortar ... <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things []Thing</code> </pre> <br>  ... ou criar uma fatia com zero elementos? <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>([]Thing, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  No segundo caso, o valor da fatia <i>n√£o</i> √© zero e deixamos claro para o leitor usando uma forma abreviada de declara√ß√£o: <br><br><pre> <code class="go hljs">things := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>([]Thing, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  Isso diz ao leitor que decidimos inicializar explicitamente as <code>things</code> . <br><br>  Ent√£o chegamos √† terceira declara√ß√£o: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thing = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(Thing)</code> </pre> <br>  Aqui, a inicializa√ß√£o expl√≠cita da vari√°vel e a introdu√ß√£o da palavra-chave ‚Äú√∫nica‚Äù <code>new</code> , que alguns programadores do Go n√£o gostam.  O uso da sintaxe curta recomendada gera <br><br><pre> <code class="go hljs">thing := <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(Thing)</code> </pre> <br>  Isso deixa claro que <code>thing</code> explicitamente inicializado no resultado de <code>new(Thing)</code> , mas ainda deixa um <code>new</code> at√≠pico.  O problema pode ser resolvido usando um literal: <br><br><pre> <code class="go hljs">thing := &amp;Thing{}</code> </pre> <br>  O que √© semelhante ao <code>new(Thing)</code> , e essa duplica√ß√£o perturba alguns programadores do Go.  No entanto, isso significa que inicializamos explicitamente a <code>thing</code> com um ponteiro para <code>Thing{}</code> e um valor <code>Thing</code> de zero. <br><br>  Mas √© melhor levar em considera√ß√£o o fato de que <code>thing</code> declarado com um valor zero e usar o endere√ßo do operador para passar o endere√ßo de <code>thing</code> em <code>json.Unmarshall</code> : <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thing Thing json.Unmarshall(reader, &amp;thing)</code> </pre> <br><blockquote>  <b>Nota</b>  Obviamente, h√° exce√ß√µes a qualquer regra.  Por exemplo, √†s vezes duas vari√°veis ‚Äã‚Äãest√£o intimamente relacionadas, por isso ser√° estranho escrever <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> min <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> max := <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre> <br>  Declara√ß√£o mais leg√≠vel: <br><br><pre> <code class="go hljs">min, max := <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre> </blockquote><br>  Para resumir: <br><br><ul><li>  Ao declarar uma vari√°vel sem inicializa√ß√£o, use a sintaxe <code>var</code> . <br></li><li>  Ao declarar e inicializar explicitamente uma vari√°vel, use <code>:=</code> . </li></ul><br><blockquote>  <b>Dica</b> .  Explique explicitamente coisas complexas. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length <span class="hljs-keyword"><span class="hljs-keyword">uint32</span></span> = <span class="hljs-number"><span class="hljs-number">0x80</span></span></code> </pre> <br>  Aqui, o <code>length</code> pode ser usado com a biblioteca, que requer um tipo num√©rico espec√≠fico, e esta op√ß√£o indica mais claramente que o comprimento do tipo √© especificamente selecionado como uint32 do que na declara√ß√£o curta: <br><br><pre> <code class="go hljs">length := <span class="hljs-keyword"><span class="hljs-keyword">uint32</span></span>(<span class="hljs-number"><span class="hljs-number">0x80</span></span>)</code> </pre> <br>  No primeiro exemplo, eu intencionalmente quebrei minha regra usando a declara√ß√£o var com inicializa√ß√£o expl√≠cita.  Um afastamento do padr√£o faz com que o leitor entenda que algo incomum est√° acontecendo. </blockquote><br><a name="2_6"></a><h2>  2.6  Trabalho para a equipe </h2><br>  Eu j√° disse que a ess√™ncia do desenvolvimento de software √© a cria√ß√£o de c√≥digo leg√≠vel e suportado.  A maior parte da sua carreira provavelmente funcionar√° em projetos conjuntos.  Meu conselho nessa situa√ß√£o: siga o estilo adotado na equipe. <br><br>  Alterar estilos no meio do arquivo √© irritante.  A consist√™ncia √© importante, embora em detrimento da prefer√™ncia pessoal.  Minha regra geral √©: se o c√≥digo se encaixa no <code>gofmt</code> , o problema geralmente n√£o vale a pena ser discutido. <br><br><blockquote>  <b>Dica</b> .  Se voc√™ deseja renomear em toda a base de c√≥digo, n√£o misture isso com outras altera√ß√µes.  Se algu√©m usa git bisect, ele n√£o gosta de percorrer milhares de renomea√ß√µes para encontrar outro c√≥digo modificado. </blockquote><br><h1>  3. Coment√°rios </h1><br>  Antes de passarmos a pontos mais importantes, quero dedicar alguns minutos para comentar. <br><br><blockquote>  <i>‚ÄúUm bom c√≥digo tem muitos coment√°rios e um c√≥digo ruim precisa de muitos coment√°rios.‚Äù</i> - Dave Thomas e Andrew Hunt, programador pragm√°tico </blockquote><br>  Os coment√°rios s√£o muito importantes para a legibilidade do programa.  Cada coment√°rio deve fazer uma - e apenas uma - de tr√™s coisas: <br><br><ol><li>  Explique o <i>que o</i> c√≥digo faz. </li><li>  Explique <i>como</i> ele faz isso. </li><li>  Explique o <i>porqu√™</i> . </li></ol><br>  O primeiro formul√°rio √© ideal para comentar caracteres p√∫blicos: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Open     . //           .</span></span></code> </pre> <br>  O segundo √© ideal para coment√°rios dentro de um m√©todo: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//     var results []chan error for _, dep := range a.Deps { results = append(results, execute(seen, dep)) }</span></span></code> </pre> <br>  A terceira forma ("por qu√™") √© √∫nica, pois n√£o substitui nem substitui as duas primeiras.  Tais coment√°rios explicam os fatores externos que levaram √† escrita do c√≥digo em sua forma atual.  Muitas vezes, sem esse contexto, √© dif√≠cil entender por que o c√≥digo √© escrito dessa maneira. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;v2.Cluster_CommonLbConfig{ <span class="hljs-comment"><span class="hljs-comment">//  HealthyPanicThreshold HealthyPanicThreshold: &amp;envoy_type.Percent{ Value: 0, }, }</span></span></code> </pre> <br>  Neste exemplo, pode n√£o ficar claro imediatamente o que acontece quando HealthyPanicThreshold √© definido como zero por cento.  O coment√°rio pretende esclarecer que um valor 0 desativa o limite de p√¢nico. <br><br><a name="3_1"></a><h2>  3.1  Coment√°rios em vari√°veis ‚Äã‚Äãe constantes devem descrever seu conte√∫do, n√£o o objetivo </h2><br>  Eu disse anteriormente que o nome de uma vari√°vel ou constante deve descrever seu prop√≥sito.  Mas um coment√°rio sobre uma vari√°vel ou constante deve descrever exatamente o <i>conte√∫do</i> , n√£o o <i>objetivo</i> . <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> randomNumber = <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre> <br>  Neste exemplo, um coment√°rio descreve <i>por que</i> <code>randomNumber</code> como 6 e de onde veio.  O coment√°rio n√£o descreve onde o <code>randomNumber</code> ser√° usado.  Aqui est√£o mais alguns exemplos: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( StatusContinue = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-comment"><span class="hljs-comment">// RFC 7231, 6.2.1 StatusSwitchingProtocols = 101 // RFC 7231, 6.2.2 StatusProcessing = 102 // RFC 2518, 10.1 StatusOK = 200 // RFC 7231, 6.3.1</span></span></code> </pre> <br>  <i>No contexto do HTTP, o</i> n√∫mero <code>100</code> conhecido como <code>StatusContinue</code> , conforme definido na RFC 7231, se√ß√£o 6.2.1. <br><br><blockquote>  <b>Dica</b> .  Para vari√°veis ‚Äã‚Äãsem valor inicial, o coment√°rio deve descrever quem √© respons√°vel por inicializar essa vari√°vel. <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// sizeCalculationDisabled ,   //     . . dowidth. var sizeCalculationDisabled bool</span></span></code> </pre> <br>  Aqui, um coment√°rio informa ao leitor que a fun√ß√£o <code>dowidth</code> respons√°vel por manter o estado de <code>sizeCalculationDisabled</code> . </blockquote><br><blockquote>  <b>Dica</b> .  Esconder √† vista.  Este √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conselho de Kate Gregory</a> .  √Äs vezes, o melhor nome para uma vari√°vel est√° oculto nos coment√°rios. <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//   SQL var registry = make(map[string]*sql.Driver)</span></span></code> </pre> <br>  Um coment√°rio foi adicionado pelo autor porque o <code>registry</code> nomes n√£o explica suficientemente sua finalidade - este √© um registro, mas qual √© o registro? <br><br>  Se voc√™ renomear uma vari√°vel como sqlDrivers, fica claro que ela cont√©m drivers SQL. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sqlDrivers = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*sql.Driver)</code> </pre> <br>  Agora o coment√°rio tornou-se redundante e pode ser exclu√≠do. </blockquote><br><a name="3_2"></a><h2>  3.2  Sempre documente caracteres publicamente dispon√≠veis </h2><br>  A documenta√ß√£o do seu pacote √© gerada pelo godoc, portanto, voc√™ deve adicionar um coment√°rio a cada caractere p√∫blico declarado no pacote: uma vari√°vel, constante, fun√ß√£o e m√©todo. <br><br>  Aqui est√£o duas diretrizes do Guia de estilos do Google: <br><br><ul><li>  Qualquer fun√ß√£o p√∫blica que n√£o seja √≥bvia nem concisa deve ser comentada. <br></li><li>  Qualquer fun√ß√£o na biblioteca deve ser comentada, independentemente do tamanho ou complexidade. </li></ul><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ioutil <span class="hljs-comment"><span class="hljs-comment">// ReadAll   r      (EOF)   // ..    err == nil, not err == EOF. //  ReadAll     ,     //  . func ReadAll(r io.Reader) ([]byte, error)</span></span></code> </pre> <br>  H√° uma exce√ß√£o a esta regra: voc√™ n√£o precisa documentar m√©todos que implementam a interface.  Especificamente, n√£o fa√ßa isso: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Read   io.Reader func (r *FileReader) Read(buf []byte) (int, error)</span></span></code> </pre> <br>  Este coment√°rio n√£o significa nada.  Ele n√£o diz o que o m√©todo faz: pior, ele envia para algum lugar para procurar documenta√ß√£o.  Nesta situa√ß√£o, proponho excluir completamente o coment√°rio. <br><br>  Aqui est√° um exemplo do pacote <code>io</code> . <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// LimitReader  Reader,    r, //    EOF  n . //   *LimitedReader. func LimitReader(r Reader, n int64) Reader { return &amp;LimitedReader{r, n} } // LimitedReader   R,     //   N .   Read  N  //    . // Read  EOF,  N &lt;= 0    R  EOF. type LimitedReader struct { R Reader // underlying reader N int64 // max bytes remaining } func (l *LimitedReader) Read(p []byte) (n int, err error) { if lN &lt;= 0 { return 0, EOF } if int64(len(p)) &gt; lN { p = p[0:lN] } n, err = lRRead(p) lN -= int64(n) return }</span></span></code> </pre> <br>  Observe que a declara√ß√£o <code>LimitedReader</code> √© imediatamente precedida pela fun√ß√£o que a usa e a declara√ß√£o <code>LimitedReader.Read</code> segue a declara√ß√£o do <code>LimitedReader</code> .  Embora o <code>LimitedReader.Read</code> si n√£o esteja documentado, √© poss√≠vel entender que essa √© uma implementa√ß√£o do <code>io.Reader</code> . <br><br><blockquote>  <b>Dica</b> .  Antes de escrever uma fun√ß√£o, escreva um coment√°rio descrevendo-a.  Se voc√™ acha dif√≠cil escrever um coment√°rio, isso √© um sinal de que o c√≥digo que voc√™ est√° prestes a escrever ser√° dif√≠cil de entender. </blockquote><br><h3>  3.2.1  N√£o comente sobre c√≥digo incorreto, reescreva-o </h3><br><blockquote>  <i>‚ÄúN√£o comente c√≥digo incorreto - reescreva-o‚Äù</i> - Brian Kernighan </blockquote><br>  N√£o basta indicar nos coment√°rios a dificuldade do fragmento de c√≥digo.  Se voc√™ se deparar com um desses coment√°rios, inicie um ticket com um lembrete de refatora√ß√£o.  Voc√™ pode viver com d√≠vida t√©cnica, desde que seu valor seja conhecido. <br><br>  Na biblioteca padr√£o, √© habitual deixar coment√°rios no estilo TODO com o nome do usu√°rio que notou o problema. <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// TODO(dfc)  O(N^2),     .</span></span></code> </pre> <br>  Isso n√£o √© uma obriga√ß√£o para corrigir o problema, mas o usu√°rio indicado pode ser a melhor pessoa para fazer uma pergunta.  Outros projetos acompanham o TODO com uma data ou n√∫mero do ticket. <br><br><h3>  3.2.2  Em vez de comentar o c√≥digo, refatore-o </h3><br><blockquote>  <i>‚ÄúBom c√≥digo √© a melhor documenta√ß√£o.</i>  <i>Quando voc√™ estiver prestes a adicionar um coment√°rio, fa√ßa a si mesmo a pergunta: ‚ÄúComo melhorar o c√≥digo para que este coment√°rio n√£o seja necess√°rio?‚Äù</i>  <i>Refatore e deixe um coment√°rio para torn√°-lo ainda mais claro. ‚Äù</i> - Steve McConnell </blockquote><br>  As fun√ß√µes devem executar apenas uma tarefa.  Se voc√™ deseja escrever um coment√°rio porque algum fragmento n√£o est√° relacionado ao restante da fun√ß√£o, considere extra√≠-lo em uma fun√ß√£o separada. <br><br>  Recursos menores n√£o s√£o apenas mais claros, mas mais f√°ceis de testar separadamente.  Quando voc√™ isolou o c√≥digo em uma fun√ß√£o separada, seu nome pode substituir um coment√°rio. <br><br><a name="4"></a><h1>  4. Estrutura do pacote </h1><br><blockquote>  <i>‚ÄúEscreva um c√≥digo modesto: m√≥dulos que n√£o mostram nada sup√©rfluo para outros m√≥dulos e que n√£o dependem da implementa√ß√£o de outros m√≥dulos‚Äù</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dave Thomas</a> </blockquote><br>  Cada pacote √© essencialmente um pequeno programa Go separado.  Assim como a implementa√ß√£o de uma fun√ß√£o ou m√©todo n√£o importa para quem chama, a implementa√ß√£o das fun√ß√µes, m√©todos e tipos que comp√µem a API p√∫blica do seu pacote n√£o importa. <br><br>  Um bom pacote Go busca uma conectividade m√≠nima com outros pacotes no n√≠vel do c√≥digo-fonte, para que, √† medida que o projeto cres√ßa, as altera√ß√µes em um pacote n√£o sejam distribu√≠das em cascata por toda a base de c√≥digo.  Tais situa√ß√µes inibem muito os programadores que trabalham nessa base de c√≥digo. <br><br>  Nesta se√ß√£o, falaremos sobre o design de pacotes, incluindo seu nome e dicas para escrever m√©todos e fun√ß√µes. <br><br><a name="4_1"></a><h2>  4.1<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Um bom pacote come√ßa com um bom nome </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um bom pacote Go come√ßa com um nome de qualidade. </font><font style="vertical-align: inherit;">Pense nisso como uma breve apresenta√ß√£o limitada a apenas uma palavra. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como os nomes das vari√°veis ‚Äã‚Äãna se√ß√£o anterior, o nome do pacote √© muito importante. </font><font style="vertical-align: inherit;">N√£o h√° necessidade de pensar nos tipos de dados deste pacote; √© melhor fazer a pergunta: "Que servi√ßo esse pacote fornece?" </font><font style="vertical-align: inherit;">Normalmente, a resposta n√£o √© "Este pacote fornece o tipo X", mas "Este pacote permite que voc√™ se conecte via HTTP".</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Escolha um nome de pacote por sua funcionalidade, n√£o por seu conte√∫do.</font></font></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1.1 </font><font style="vertical-align: inherit;">Os bons nomes de pacotes devem ser exclusivos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada pacote tem um nome exclusivo no projeto. </font><font style="vertical-align: inherit;">N√£o h√° dificuldade se voc√™ seguiu o conselho de dar nomes para os fins dos pacotes. </font><font style="vertical-align: inherit;">Se os dois pacotes tiverem o mesmo nome, provavelmente:</font></font><br><br><ol><li>     . </li><li>       .       ,     . </li></ol><br><a name="4_2"></a><h2>  4.2    <code>base</code> , <code>common</code>  <code>util</code> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um motivo comum para nomes incorretos s√£o os chamados </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacotes de servi√ßos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , onde, com o tempo, v√°rios ajudantes e c√≥digos de servi√ßo se acumulam. Como √© dif√≠cil encontrar um nome √∫nico l√°. Isso geralmente leva ao fato de que o nome do pacote √© derivado do que ele </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : utilit√°rios. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomes como </font></font><code>utils</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>helpers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o geralmente encontrados em grandes projetos, nos quais uma hierarquia profunda de pacotes est√° enraizada e as fun√ß√µes auxiliares s√£o compartilhadas. Se voc√™ extrair alguma fun√ß√£o em um novo pacote, a importa√ß√£o ser√° interrompida. Nesse caso, o nome do pacote n√£o reflete o objetivo do pacote, mas apenas o fato de a fun√ß√£o de importa√ß√£o falhar devido √† organiza√ß√£o incorreta do projeto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em tais situa√ß√µes, recomendo analisar de onde os pacotes s√£o chamados.</font></font><code>utils</code> <code>helpers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, se poss√≠vel, mova as fun√ß√µes correspondentes para o pacote de chamada. </font><font style="vertical-align: inherit;">Mesmo que isso implique duplica√ß√£o de algum c√≥digo auxiliar, √© melhor do que introduzir uma depend√™ncia de importa√ß√£o entre dois pacotes.</font></font><br><br><blockquote> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äú[Um pouco] duplica√ß√£o √© muito mais barata que uma abstra√ß√£o errada‚Äù</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sandy Mets</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se fun√ß√µes utilit√°rias s√£o usadas em muitos lugares, em vez de um pacote monol√≠tico com fun√ß√µes utilit√°rias, √© melhor criar v√°rios pacotes, cada um dos quais se concentra em um aspecto. </font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Use o plural para pacotes de servi√ßos. </font><font style="vertical-align: inherit;">Por exemplo, </font></font><code>strings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para utilit√°rios de processamento de cadeia.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacotes com nomes como </font></font><code>base</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>common</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o frequentemente encontrados quando uma certa funcionalidade comum de duas ou mais implementa√ß√µes ou tipos comuns para um cliente e um servidor √© mesclada em um pacote separado. </font><font style="vertical-align: inherit;">Acredito que, nesses casos, √© necess√°rio reduzir o n√∫mero de pacotes combinando cliente, servidor e c√≥digo comum em um pacote com um nome que corresponda √† sua fun√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, para </font></font><code>net/http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o fazer os pacotes individuais </font></font><code>client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, em vez disso, existem arquivos </font></font><code>client.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>server.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com os tipos de dados correspondentes, bem como </font></font><code>transport.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para o transporte total.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√â importante lembrar que o nome do identificador inclui o nome do pacote.</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma fun√ß√£o </font></font><code>Get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de um pacote </font></font><code>net/http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se torna um </font></font><code>http.Get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link de outro pacote.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um tipo </font></font><code>Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de um pacote √© </font></font><code>strings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transformado quando importado para outros pacotes </font></font><code>strings.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A interface </font></font><code>Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do pacote est√° </font></font><code>net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">claramente associada a erros de rede.</font></font></li></ul></blockquote><br><a name="4_3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3 </font><font style="vertical-align: inherit;">Volte rapidamente sem mergulhar fundo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o Go n√£o usa exce√ß√µes no fluxo de controle, n√£o h√° necessidade de se aprofundar no c√≥digo para fornecer uma estrutura </font></font><code>try</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">blocos de n√≠vel superior </font></font><code>catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Em vez de uma hierarquia multin√≠vel, o c√≥digo Go desce a tela √† medida que a fun√ß√£o progride. </font><font style="vertical-align: inherit;">Meu amigo Matt Ryer chama essa pr√°tica de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"linha de vis√£o"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© conseguido usando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operadores de limite</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : blocos condicionais com uma pr√©-condi√ß√£o na entrada da fun√ß√£o. </font><font style="vertical-align: inherit;">Aqui est√° um exemplo do pacote </font></font><code>bytes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b *Buffer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnreadRune</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b.lastRead &lt;= opInvalid { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors.New(<span class="hljs-string"><span class="hljs-string">"bytes.Buffer: UnreadRune: previous operation was not a successful ReadRune"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b.off &gt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(b.lastRead) { b.off -= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(b.lastRead) } b.lastRead = opInvalid <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao entrar na fun√ß√£o </font></font><code>UnreadRune</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o estado √© verificado </font></font><code>b.lastRead</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, se a opera√ß√£o anterior n√£o foi </font></font><code>ReadRune</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, um erro √© retornado imediatamente. O restante da fun√ß√£o funciona com base no que √© </font></font><code>b.lastRead</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maior que </font></font><code>opInvalid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compare com a mesma fun√ß√£o, mas sem o operador de limite:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b *Buffer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnreadRune</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b.lastRead &gt; opInvalid { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b.off &gt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(b.lastRead) { b.off -= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(b.lastRead) } b.lastRead = opInvalid <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors.New(<span class="hljs-string"><span class="hljs-string">"bytes.Buffer: UnreadRune: previous operation was not a successful ReadRune"</span></span>) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O corpo de uma ramifica√ß√£o bem-sucedida mais prov√°vel √© incorporado na primeira condi√ß√£o </font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a condi√ß√£o para uma sa√≠da bem-sucedida </font></font><code>return nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve ser descoberta combinando cuidadosamente os </font><font style="vertical-align: inherit;">colchetes de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fechamento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A √∫ltima linha da fun√ß√£o agora retorna um erro e voc√™ precisa acompanhar a execu√ß√£o da fun√ß√£o no </font><font style="vertical-align: inherit;">colchete de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abertura</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspondente </font><font style="vertical-align: inherit;">para descobrir como chegar a esse ponto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa op√ß√£o √© mais dif√≠cil de ler, o que diminui a qualidade da programa√ß√£o e do suporte ao c√≥digo; portanto, o Go prefere usar operadores de limite e retornar erros logo no in√≠cio.</font></font><br><br><a name="4_4"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4 </font><font style="vertical-align: inherit;">Tornar o valor nulo √∫til</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada declara√ß√£o de vari√°vel, assumindo a aus√™ncia de um inicializador expl√≠cito, ser√° automaticamente inicializada com um valor correspondente ao conte√∫do da mem√≥ria zerada, ou seja, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zero</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O tipo de valor √© determinado por uma das op√ß√µes: para tipos num√©ricos - zero, para tipos de ponteiros - zero, o mesmo para fatias, mapas e canais. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A capacidade de sempre definir um valor padr√£o conhecido √© importante para a seguran√ßa e a corre√ß√£o do seu programa e pode tornar seus programas Go mais f√°ceis e compactos. √â isso que os programadores do Go t√™m em mente quando dizem: "D√™ √†s estruturas um valor zero √∫til". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considere um tipo </font></font><code>sync.Mutex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que cont√©m dois campos inteiros que representam o estado interno do mutex. Esses campos s√£o automaticamente nulos em qualquer declara√ß√£o.</font></font><code>sync.Mutex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esse fato √© levado em considera√ß√£o no c√≥digo, portanto, o tipo √© adequado para uso sem inicializa√ß√£o expl√≠cita.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> MyInt <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { mu sync.Mutex val <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i MyInt <span class="hljs-comment"><span class="hljs-comment">// i.mu is usable without explicit initialisation. i.mu.Lock() i.val++ i.mu.Unlock() }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro exemplo de um tipo com um valor nulo √∫til √© </font></font><code>bytes.Buffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Voc√™ pode declarar e come√ßar a escrever nele sem inicializa√ß√£o expl√≠cita.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b bytes.Buffer b.WriteString(<span class="hljs-string"><span class="hljs-string">"Hello, world!\n"</span></span>) io.Copy(os.Stdout, &amp;b) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O valor zero dessa estrutura significa que </font></font><code>len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ambos </font></font><code>cap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o iguais </font></font><code>0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, y </font></font><code>array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o ponteiro para a mem√≥ria com o conte√∫do da matriz de fatia de backup, valor </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Isso significa que voc√™ n√£o precisa cortar explicitamente, voc√™ pode simplesmente declarar.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// s := make([]string, 0) // s := []string{} var s []string s = append(s, "Hello") s = append(s, "world") fmt.Println(strings.Join(s, " ")) }</span></span></code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><code>var s []string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">semelhante √†s duas linhas comentadas no topo, mas n√£o id√™nticas a elas. </font><font style="vertical-align: inherit;">H√° uma diferen√ßa entre um valor de fatia nulo e um valor de fatia de comprimento zero. </font><font style="vertical-align: inherit;">O c√≥digo a seguir ser√° impresso como falso.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s1 = []<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s2 []<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fmt.Println(reflect.DeepEqual(s1, s2)) }</code> </pre> </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma propriedade √∫til, embora inesperada, de vari√°veis ‚Äã‚Äãde ponteiro n√£o inicializadas - ponteiros nulos - √© a capacidade de chamar m√©todos em tipos que s√£o nulos. </font><font style="vertical-align: inherit;">Isso pode ser usado para fornecer facilmente valores padr√£o.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { path <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Config)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Path</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> c == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"/usr/home"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c.path } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c1 *Config <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c2 = &amp;Config{ path: <span class="hljs-string"><span class="hljs-string">"/export"</span></span>, } fmt.Println(c1.Path(), c2.Path()) }</code> </pre> <br><a name="4_5"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5 </font><font style="vertical-align: inherit;">Evitar estado do n√≠vel do pacote</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A chave para escrever programas de f√°cil suporte que est√£o fracamente conectados √© que a altera√ß√£o de um pacote deve ter uma baixa probabilidade de afetar outro pacote que n√£o depende diretamente do primeiro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem duas maneiras excelentes de obter conectividade fraca no Go:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Use interfaces para descrever o comportamento exigido por fun√ß√µes ou m√©todos. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Evite status global. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No Go, podemos declarar vari√°veis ‚Äã‚Äãno escopo de uma fun√ß√£o ou m√©todo, bem como no escopo de um pacote. </font><font style="vertical-align: inherit;">Quando uma vari√°vel est√° dispon√≠vel publicamente, com um identificador com letra mai√∫scula, seu escopo √© realmente global para todo o programa: qualquer pacote </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a qualquer momento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> v√™ o tipo e o conte√∫do dessa vari√°vel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O estado global mut√°vel fornece uma estreita rela√ß√£o entre as partes independentes do programa, pois as vari√°veis ‚Äã‚Äãglobais se tornam um par√¢metro invis√≠vel para cada fun√ß√£o no programa! </font><font style="vertical-align: inherit;">Qualquer fun√ß√£o que depende de uma vari√°vel global pode ser violada quando o tipo dessa vari√°vel √© alterado. </font><font style="vertical-align: inherit;">Qualquer fun√ß√£o que depende do estado de uma vari√°vel global pode ser violada se outra parte do programa alterar essa vari√°vel.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como reduzir a conectividade que uma vari√°vel global cria: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mova as vari√°veis ‚Äã‚Äãcorrespondentes como campos para as estruturas que precisam delas. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Use interfaces para reduzir a conex√£o entre o comportamento e a implementa√ß√£o desse comportamento. </font></font></li></ol><br><a name="5"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5. Estrutura do projeto </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos falar sobre como os pacotes s√£o combinados em um projeto. </font><font style="vertical-align: inherit;">Geralmente √© um √∫nico reposit√≥rio Git. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o pacote, cada projeto deve ter um objetivo claro. </font><font style="vertical-align: inherit;">Se for uma biblioteca, deve fazer uma coisa, por exemplo, an√°lise XML ou registro no di√°rio. </font><font style="vertical-align: inherit;">Voc√™ n√£o deve combinar v√°rios objetivos em um projeto, isso ajudar√° a evitar uma biblioteca assustadora </font></font><code>common</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Na minha experi√™ncia, o reposit√≥rio </font></font><code>common</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° intimamente associado ao maior consumidor, e isso dificulta a corre√ß√£o de vers√µes anteriores (corre√ß√µes de porta traseira) sem atualizar </font></font><code>common</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o consumidor e o consumidor no est√°gio de bloqueio, o que leva a muitas mudan√ßas n√£o relacionadas, al√©m de serem interrompidas pelo caminho API</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ possui um aplicativo (aplicativo Web, controlador Kubernetes, etc.), o projeto pode ter um ou mais pacotes principais. </font><font style="vertical-align: inherit;">Por exemplo, no meu controlador Kubernetes, h√° um pacote </font></font><code>cmd/contour</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que serve como um servidor implantado em um cluster Kubernetes e como um cliente de depura√ß√£o.</font></font><br><br><a name="5_1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 </font><font style="vertical-align: inherit;">Menos pacotes, mas maiores</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na revis√£o de c√≥digo, notei um dos erros t√≠picos dos programadores que mudaram para o Go de outros idiomas: eles tendem a abusar de pacotes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GO n√£o fornecer o elaborado sistema de visibilidade: a linguagem n√£o √© suficiente modificadores de acesso, como no Java ( </font></font><code>public</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>protected</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>private</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e impl√≠cita </font></font><code>default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">N√£o h√° an√°logo de classes amig√°veis ‚Äã‚Äãdo C ++. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No Go, temos apenas dois modificadores de acesso: s√£o identificadores p√∫blicos e privados, indicados pela primeira letra do identificador (mai√∫scula / min√∫scula). </font><font style="vertical-align: inherit;">Se o identificador for p√∫blico, seu nome come√ßar√° com uma letra mai√∫scula e poder√° ser referenciado por qualquer outro pacote Go.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voc√™ pode ouvir as palavras "exportado" ou "n√£o exportado" como sin√¥nimos para p√∫blico e privado.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dado os recursos limitados de controle de acesso, quais m√©todos podem ser usados ‚Äã‚Äãpara evitar hierarquias de pacotes excessivamente complexas? </font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Em cada pacote, al√©m </font></font><code>cmd/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>internal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve estar presente o c√≥digo fonte.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu j√° disse v√°rias vezes que √© melhor preferir menos pacotes maiores. </font><font style="vertical-align: inherit;">Sua posi√ß√£o padr√£o deve ser n√£o criar um novo pacote. </font><font style="vertical-align: inherit;">Isso faz com que muitos tipos se tornem p√∫blicos, criando um escopo amplo e pequeno da API dispon√≠vel. </font><font style="vertical-align: inherit;">Abaixo, consideramos esta tese em mais detalhes.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Veio de Java? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ √© do mundo Java ou C #, lembre-se da regra t√°cita: um pacote Java √© equivalente a um √∫nico arquivo de origem </font></font><code>.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">O pacote Go √© equivalente a todo o m√≥dulo Maven ou assembly .NET.</font></font></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.1 </font><font style="vertical-align: inherit;">Classificando o c√≥digo por arquivo usando as instru√ß√µes de importa√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ organizar pacotes por servi√ßo, fa√ßa o mesmo com os arquivos no pacote? </font><font style="vertical-align: inherit;">Como saber quando dividir um arquivo </font></font><code>.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em v√°rios? </font><font style="vertical-align: inherit;">Como voc√™ sabe se voc√™ foi longe demais e precisa pensar em mesclar arquivos? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√£o as recomenda√ß√µes que eu uso:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicie cada pacote com um arquivo </font></font><code>.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Atribua a esse arquivo o mesmo nome que o diret√≥rio. </font><font style="vertical-align: inherit;">Por exemplo, o pacote </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve estar no arquivo </font></font><code>http.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no diret√≥rio </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conforme o pacote cresce, voc√™ pode dividir as v√°rias fun√ß√µes em v√°rios arquivos. </font><font style="vertical-align: inherit;">Por exemplo, o arquivo </font></font><code>messages.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conter√° tipos </font></font><code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>Response</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>client.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipo de </font></font><code>Client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo, </font></font><code>server.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor de tipo de </font><font style="vertical-align: inherit;">arquivo </font><font style="vertical-align: inherit;">.</font></font><br></li><li>       ,    .  ,       . <br></li><li>        . , <code>messages.go</code>     HTTP-       , <code>http.go</code>      , <code>client.go</code>  <code>server.go</code> ‚Äî    HTTP     . </li></ul><br><blockquote> <b></b> .      . </blockquote><br><blockquote> <b></b> .  Go    .      <i></i> ( ‚Äî      Go).           . </blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.2 </font><font style="vertical-align: inherit;">Prefira testes internos a externos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A ferramenta </font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suporta o pacote </font></font><code>testing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em dois lugares. </font><font style="vertical-align: inherit;">Se voc√™ possui um pacote </font></font><code>http2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pode escrever um arquivo </font></font><code>http2_test.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e usar a declara√ß√£o do pacote </font></font><code>http2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ele compila o c√≥digo </font></font><code>http2_test.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© parte do pacote </font></font><code>http2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No discurso coloquial, esse teste √© chamado interno. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A ferramenta </font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m suporta uma declara√ß√£o de pacote especial que termina com </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teste</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou seja </font></font><code>http_test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso permite que os arquivos de teste residam no mesmo pacote com o c√≥digo, mas quando esses testes s√£o compilados, eles n√£o fazem parte do c√≥digo do seu pacote, mas vivem em seu pr√≥prio pacote. </font><font style="vertical-align: inherit;">Isso permite que voc√™ escreva testes como se outro pacote estivesse invocando seu c√≥digo. </font><font style="vertical-align: inherit;">Tais testes s√£o chamados externos.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu recomendo usar testes internos para testes de unidade. Isso permite que voc√™ teste cada fun√ß√£o ou m√©todo diretamente, evitando a burocracia de testes externos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas √© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">necess√°rio</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> colocar exemplos de fun√ß√µes de teste ( </font></font><code>Example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">em um arquivo de teste externo </font><font style="vertical-align: inherit;">. Isso garante que, quando visualizados no godoc, os exemplos recebam o prefixo do pacote apropriado e possam ser facilmente copiados.</font></font><br><br><blockquote> <b></b> .    ,     . <br><br>   ,    ,   Go      <code>go</code> . ,  <code>net/http</code>       <code>net</code> . <br><br>           <code>.go</code> , ,    . </blockquote><br><h3> 5.1.3.   ,     API </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o seu projeto tiver v√°rios pacotes, voc√™ poder√° encontrar fun√ß√µes exportadas que devem ser usadas por outros pacotes, mas n√£o para a API p√∫blica. </font><font style="vertical-align: inherit;">Em tal situa√ß√£o, a ferramenta </font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reconhece um nome de pasta especial </font></font><code>internal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que pode ser usado para colocar o c√≥digo aberto para o seu projeto, mas fechado para outros. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para criar esse pacote, coloque-o em um diret√≥rio com um nome </font></font><code>internal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou em seu subdiret√≥rio. </font><font style="vertical-align: inherit;">Quando a equipe </font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√™ a importa√ß√£o do pacote com o caminho </font></font><code>internal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, verifica o local do pacote de chamada em um diret√≥rio ou subdiret√≥rio </font></font><code>internal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, um pacote </font></font><code>.../a/b/c/internal/d/e/f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode importar apenas um pacote de uma √°rvore de diret√≥rios </font></font><code>.../a/b/c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas n√£o de todo </font></font><code>.../a/b/g</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou qualquer outro reposit√≥rio (consulte</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documenta√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><a name="5_2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2 </font><font style="vertical-align: inherit;">O menor pacote principal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma fun√ß√£o </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e um pacote </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devem ter funcionalidade m√≠nima, porque </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">age como um singleton: um programa pode ter apenas uma fun√ß√£o </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, incluindo testes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© um singleton, h√° muitas restri√ß√µes nos objetos chamados: eles s√£o chamados apenas durante </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>main.init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e apenas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma vez</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Isso dificulta a escrita de testes de c√≥digo </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Portanto, voc√™ precisa se esfor√ßar para derivar o m√°ximo de l√≥gica poss√≠vel da fun√ß√£o principal e, idealmente, do pacote principal.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><code>func main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve analisar sinalizadores, abrir conex√µes com bancos de dados, registradores etc. e depois transferir a execu√ß√£o para um objeto de alto n√≠vel.</font></font></blockquote><br><a name="6"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. estrutura da API </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O √∫ltimo conselho de design do projeto que considero o mais importante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todas as frases anteriores s√£o, em princ√≠pio, n√£o vinculativas. </font><font style="vertical-align: inherit;">Estas s√£o apenas recomenda√ß√µes baseadas na experi√™ncia pessoal. </font><font style="vertical-align: inherit;">Eu n√£o for√ßo muito essas recomenda√ß√µes em uma revis√£o de c√≥digo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A API √© outra quest√£o: aqui, os erros s√£o levados mais a s√©rio, porque todo o resto pode ser corrigido sem quebrar a compatibilidade com vers√µes anteriores: na maior parte, esses s√£o apenas detalhes de implementa√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando se trata de APIs p√∫blicas, vale a pena considerar seriamente a estrutura desde o in√≠cio, porque as altera√ß√µes subsequentes ser√£o destrutivas para os usu√°rios.</font></font><br><br><a name="6_1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1 </font><font style="vertical-align: inherit;">APIs de design dif√≠ceis de abusar por design</font></font></h2><br><blockquote> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúAs APIs devem ser simples para uso adequado e dif√≠ceis para incorretas‚Äù</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Josh Bloch</font></font></a> </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O conselho de Josh Bloch √© talvez o mais valioso neste artigo. </font><font style="vertical-align: inherit;">Se for dif√≠cil usar a API para coisas simples, todas as chamadas √† API ser√£o mais complicadas do que o necess√°rio. </font><font style="vertical-align: inherit;">Quando uma chamada de API √© complexa e n√£o √≥bvia, √© prov√°vel que seja ignorada.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1 </font><font style="vertical-align: inherit;">Cuidado com as fun√ß√µes que aceitam v√°rios par√¢metros do mesmo tipo.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um bom exemplo de uma API simples √† primeira vista, mas dif√≠cil de usar, √© quando ela requer dois ou mais par√¢metros do mesmo tipo. </font><font style="vertical-align: inherit;">Compare duas assinaturas de fun√ß√£o:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Max</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CopyFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to, from </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual √© a diferen√ßa entre essas duas fun√ß√µes? </font><font style="vertical-align: inherit;">Obviamente, um retorna no m√°ximo dois n√∫meros e o outro copia o arquivo. </font><font style="vertical-align: inherit;">Mas este n√£o √© o ponto.</font></font><br><br><pre> <code class="go hljs">Max(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-comment"><span class="hljs-comment">// 10 Max(10, 8) // 10</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Max √© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comutativo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : a ordem dos par√¢metros n√£o importa. </font><font style="vertical-align: inherit;">Um m√°ximo de oito e dez √© dez, independentemente de oito e dez ou dez e oito serem comparados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas no caso do CopyFile, n√£o √© assim.</font></font><br><br><pre> <code class="go hljs">CopyFile(<span class="hljs-string"><span class="hljs-string">"/tmp/backup"</span></span>, <span class="hljs-string"><span class="hljs-string">"presentation.md"</span></span>) CopyFile(<span class="hljs-string"><span class="hljs-string">"presentation.md"</span></span>, <span class="hljs-string"><span class="hljs-string">"/tmp/backup"</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quais desses operadores far√£o backup da sua apresenta√ß√£o e quais ser√£o substitu√≠dos pela vers√£o da semana passada? </font><font style="vertical-align: inherit;">Voc√™ n√£o pode saber at√© verificar a documenta√ß√£o. </font><font style="vertical-align: inherit;">No curso da revis√£o de c√≥digo, n√£o est√° claro se a ordem dos argumentos est√° correta ou n√£o. </font><font style="vertical-align: inherit;">Mais uma vez, veja a documenta√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma solu√ß√£o poss√≠vel √© a introdu√ß√£o de um tipo auxiliar respons√°vel pela chamada correta </font></font><code>CopyFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Source <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(src Source)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CopyTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dest </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CopyFile(dest, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(src)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> from Source = <span class="hljs-string"><span class="hljs-string">"presentation.md"</span></span> from.CopyTo(<span class="hljs-string"><span class="hljs-string">"/tmp/backup"</span></span>) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â </font></font><code>CopyFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sempre chamado corretamente aqui - isso pode ser declarado usando um teste de unidade - e pode ser feito em particular, o que reduz ainda mais a probabilidade de uso incorreto.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Uma API com v√°rios par√¢metros do mesmo tipo √© dif√≠cil de usar corretamente.</font></font></blockquote><br><a name="6_2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2 </font><font style="vertical-align: inherit;">Projetar uma API para um caso de uso b√°sico</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alguns anos atr√°s, fiz uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apresenta√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre o uso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">op√ß√µes funcionais</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para facilitar a API por padr√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A ess√™ncia da apresenta√ß√£o foi que voc√™ deveria desenvolver uma API para o caso de uso principal. </font><font style="vertical-align: inherit;">Em outras palavras, a API n√£o deve exigir que o usu√°rio forne√ßa par√¢metros extras que n√£o lhe interessam.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.1 </font><font style="vertical-align: inherit;">O uso de nil como par√¢metro n√£o √© recomendado</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comecei dizendo que voc√™ n√£o deve for√ßar o usu√°rio a fornecer par√¢metros de API que n√£o lhe interessam. </font><font style="vertical-align: inherit;">Isso significa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projetar as APIs para o caso de uso principal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (op√ß√£o padr√£o). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° um exemplo do pacote net / http.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> http <span class="hljs-comment"><span class="hljs-comment">// ListenAndServe listens on the TCP network address addr and then calls // Serve with handler to handle requests on incoming connections. // Accepted connections are configured to enable TCP keep-alives. // // The handler is typically nil, in which case the DefaultServeMux is used. // // ListenAndServe always returns a non-nil error. func ListenAndServe(addr string, handler Handler) error {</span></span></code> </pre> <br> <code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aceita dois par√¢metros: um endere√ßo TCP para escutar nas conex√µes recebidas e </font></font><code>http.Handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para processar uma solicita√ß√£o HTTP recebida. </font></font><code>Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permite que o segundo par√¢metro seja </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nos coment√°rios, note-se que geralmente o objeto de chamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realmente</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> passa </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, indicando um desejo de us√°-lo </font></font><code>http.DefaultServeMux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como um par√¢metro impl√≠cito. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora o chamador </font></font><code>Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tem duas maneiras de fazer o mesmo.</font></font><br><br><pre> <code class="go hljs">http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, http.DefaultServeMux)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ambas as op√ß√µes fazem a mesma coisa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este aplicativo se </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espalha como um v√≠rus. </font><font style="vertical-align: inherit;">O pacote tamb√©m </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">possui um auxiliar </font></font><code>http.Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para que voc√™ possa imaginar a estrutura da fun√ß√£o </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ListenAndServe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(addr </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, handler Handler)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { l, err := net.Listen(<span class="hljs-string"><span class="hljs-string">"tcp"</span></span>, addr) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> l.Close() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Serve(l, handler) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ele permite que o chamador passe </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para o segundo par√¢metro, </font></font><code>http.Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m suporta esse comportamento. </font><font style="vertical-align: inherit;">De fato, est√° na </font></font><code>http.Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l√≥gica implementada "se o manipulador for igual </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, use </font></font><code>DefaultServeMux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">". </font><font style="vertical-align: inherit;">A aceita√ß√£o </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de um par√¢metro pode levar o chamador a pensar que pode ser passado </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para ambos os par√¢metros. </font><font style="vertical-align: inherit;">Mas tal</font></font><code>Serve</code> <br><br><pre> <code class="go hljs">http.Serve(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> leva a um p√¢nico terr√≠vel. </font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">N√£o misture par√¢metros na mesma assinatura de fun√ß√£o </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e n√£o </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O autor </font></font><code>http.ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentou simplificar a vida dos usu√°rios da API para o caso padr√£o, mas a seguran√ßa foi afetada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na presen√ßa, </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o h√° diferen√ßa no n√∫mero de linhas entre uso expl√≠cito e indireto </font></font><code>DefaultServeMux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> root = http.Dir(<span class="hljs-string"><span class="hljs-string">"/htdocs"</span></span>) http.Handle(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, http.FileServer(root)) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comparado com </font></font><br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> root = http.Dir(<span class="hljs-string"><span class="hljs-string">"/htdocs"</span></span>) http.Handle(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, http.FileServer(root)) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, http.DefaultServeMux)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valeu a confus√£o manter uma linha? </font></font><br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> root = http.Dir(<span class="hljs-string"><span class="hljs-string">"/htdocs"</span></span>) mux := http.NewServeMux() mux.Handle(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, http.FileServer(root)) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, mux)</code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pense seriamente em quanto tempo as fun√ß√µes auxiliares salvar√£o o programador. </font><font style="vertical-align: inherit;">Clareza √© melhor que concis√£o.</font></font></blockquote><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Evite APIs p√∫blicas com par√¢metros que somente os testes precisam. </font><font style="vertical-align: inherit;">Evite exportar APIs com par√¢metros cujos valores diferem apenas durante o teste. </font><font style="vertical-align: inherit;">Em vez disso, as fun√ß√µes do wrapper de exporta√ß√£o que ocultam a transfer√™ncia desses par√¢metros e nos testes usam fun√ß√µes auxiliares semelhantes que passam os valores necess√°rios para o teste.</font></font></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.2 </font><font style="vertical-align: inherit;">Use argumentos de comprimento vari√°vel em vez de [] T</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Muitas vezes, uma fun√ß√£o ou m√©todo usa uma fatia dos valores. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShutdownVMs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ids []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© apenas um exemplo inventado, mas isso √© muito comum. O problema √© que essas assinaturas assumem que ser√£o chamadas com mais de um registro. Como mostra a experi√™ncia, eles geralmente s√£o chamados com apenas um argumento, que deve ser "empacotado" dentro da fatia para atender aos requisitos da assinatura da fun√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, como o par√¢metro </font></font><code>ids</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© uma fatia, voc√™ pode passar uma fatia vazia ou zero para a fun√ß√£o e o compilador ficar√° feliz. Isso adiciona uma carga extra de teste, pois o teste deve cobrir esses casos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para dar um exemplo dessa classe de API, refatorei recentemente a l√≥gica que exigia a instala√ß√£o de alguns campos adicionais se pelo menos um dos par√¢metros fosse diferente de zero. A l√≥gica era algo assim:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> svc.MaxConnections &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> || svc.MaxPendingRequests &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> || svc.MaxRequests &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> || svc.MaxRetries &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-comment"><span class="hljs-comment">// apply the non zero parameters }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o operador estava </font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ficando muito longo, eu queria colocar a l√≥gica de valida√ß√£o em uma fun√ß√£o separada. </font><font style="vertical-align: inherit;">Aqui est√° o que eu vim com:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// anyPostive indicates if any value is greater than zero. func anyPositive(values ...int) bool { for _, v := range values { if v &gt; 0 { return true } } return false }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Isso tornou poss√≠vel indicar claramente a condi√ß√£o sob a qual a unidade interna ser√° executada: </font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> anyPositive(svc.MaxConnections, svc.MaxPendingRequests, svc.MaxRequests, svc.MaxRetries) { <span class="hljs-comment"><span class="hljs-comment">// apply the non zero parameters }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, h√° um problema com </font></font><code>anyPositive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, algu√©m poderia acidentalmente cham√°-lo assim:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> anyPositive() { ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, </font></font><code>anyPositive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar√° </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esta n√£o √© a pior op√ß√£o. </font><font style="vertical-align: inherit;">Pior se </font></font><code>anyPositive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornado </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na aus√™ncia de argumentos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, seria melhor poder alterar a assinatura de anyPositive para garantir que pelo menos um argumento seja passado ao chamador. </font><font style="vertical-align: inherit;">Isso pode ser feito combinando par√¢metros para argumentos normais e argumentos de comprimento vari√°vel (varargs):</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// anyPostive indicates if any value is greater than zero. func anyPositive(first int, rest ...int) bool { if first &gt; 0 { return true } for _, v := range rest { if v &gt; 0 { return true } } return false }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora </font></font><code>anyPositive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ n√£o pode chamar com menos de um argumento.</font></font><br><br><a name="6_3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3 </font><font style="vertical-align: inherit;">Deixe as fun√ß√µes determinarem o comportamento desejado.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponha que me foi atribu√≠da a tarefa de escrever uma fun√ß√£o que preserva a estrutura </font></font><code>Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no disco.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Save      f. func Save(f *os.File, doc *Document) error</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu poderia escrever uma fun√ß√£o </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que grava </font></font><code>Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em um arquivo </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mas existem alguns problemas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A assinatura </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elimina a possibilidade de gravar dados pela rede. Se esse requisito aparecer no futuro, a assinatura da fun√ß√£o precisar√° ser alterada, o que afetar√° todos os objetos de chamada. </font></font><br><br> <code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m √© desagrad√°vel para o teste, uma vez que trabalha diretamente com os arquivos no disco. Portanto, para verificar seu funcionamento, o teste deve ler o conte√∫do do arquivo ap√≥s a grava√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E eu tenho que garantir que ele seja </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gravado em uma pasta tempor√°ria e posteriormente exclu√≠do. </font></font><br><br> <code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m define muitos m√©todos que n√£o est√£o relacionados a </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por exemplo, ler diret√≥rios e verificar se um caminho √© um link simb√≥lico. Bem, se a assinatura</font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descreveu apenas as partes relevantes </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que pode ser feito?</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Save      // ReadWriterCloser. func Save(rwc io.ReadWriteCloser, doc *Document) error</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com a ajuda </font></font><code>io.ReadWriteCloser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dele, voc√™ pode aplicar o princ√≠pio de separa√ß√£o da interface - e redefini-lo </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em uma interface que descreva as propriedades mais gerais do arquivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s essa altera√ß√£o, qualquer tipo que implemente a interface </font></font><code>io.ReadWriteCloser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ser substitu√≠do pelo anterior </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso expande simultaneamente o escopo </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e esclarece ao chamador quais m√©todos de tipo </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√£o relacionados √† sua opera√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E o autor </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o pode mais chamar esses m√©todos n√£o relacionados </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, porque ele est√° oculto por tr√°s da interface </font></font><code>io.ReadWriteCloser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas podemos estender o princ√≠pio da separa√ß√£o de interface ainda mais. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em primeiro lugar se</font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> segue o princ√≠pio da responsabilidade √∫nica, √© improv√°vel que ele leia o arquivo que acabou de escrever para verificar seu conte√∫do - outro c√≥digo deve fazer isso. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Save      // WriteCloser. func Save(wc io.WriteCloser, doc *Document) error</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, voc√™ pode restringir as especifica√ß√µes da interface para </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas escrever e fechar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em segundo lugar, o mecanismo de fechamento do encadeamento y </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© um legado do tempo em que trabalhou com o arquivo. </font><font style="vertical-align: inherit;">A quest√£o √©: em que circunst√¢ncias </font></font><code>wc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ele ser√° fechado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">causa </font></font><code>Close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incondicionalmente, quer no caso de sucesso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso apresenta um problema para o chamador, pois ele pode querer adicionar dados ao fluxo ap√≥s a grava√ß√£o do documento.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Save      // Writer. func Save(w io.Writer, doc *Document) error</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A melhor op√ß√£o √© redefinir Salvar para trabalhar apenas </font></font><code>io.Writer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, salvando o operador de todas as outras funcionalidades, exceto para gravar dados no fluxo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois de aplicar o princ√≠pio de separa√ß√£o de interface, a fun√ß√£o tornou-se ao mesmo tempo mais espec√≠fica em termos de requisitos (precisa apenas de um objeto onde possa ser gravada) e mais geral em termos de funcionalidade, j√° que agora podemos us√°-la </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para salvar dados onde quer que seja implementada </font></font><code>io.Writer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><a name="7"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Tratamento de erros </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fiz </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√°rias apresenta√ß√µes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">escrevi </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muito</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre esse t√≥pico no blog, ent√£o n√£o vou repeti-lo. </font><font style="vertical-align: inherit;">Em vez disso, quero cobrir duas outras √°reas relacionadas ao tratamento de erros.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><a name="7_1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1 </font><font style="vertical-align: inherit;">Elimine a necessidade de tratamento de erros removendo os pr√≥prios erros</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fiz muitas sugest√µes para melhorar a sintaxe de manipula√ß√£o de erros, mas a melhor op√ß√£o √© n√£o lidar com elas. </font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">N√£o digo "excluir tratamento de erros". </font><font style="vertical-align: inherit;">Sugiro alterar o c√≥digo para que n√£o haja erros no processamento.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O recente livro de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filosofia de desenvolvimento de software de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> John Osterhout me inspirou a fazer essa sugest√£o </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Um dos cap√≠tulos √© intitulado "Eliminar erros da realidade". </font><font style="vertical-align: inherit;">Vamos tentar aplicar este conselho.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1.1 </font><font style="vertical-align: inherit;">Contagem de linhas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Escreveremos uma fun√ß√£o para contar o n√∫mero de linhas em um arquivo. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CountLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r io.Reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ( br = bufio.NewReader(r) lines <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> err error ) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { _, err = br.ReadString(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) lines++ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != io.EOF { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lines, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conforme seguimos o conselho das se√ß√µes anteriores, </font></font><code>CountLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aceita </font></font><code>io.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n√£o </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; j√° √© tarefa do chamador fornecer </font></font><code>io.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cujo conte√∫do queremos contar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criamos </font></font><code>bufio.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, em seguida, chamamos o m√©todo em um loop </font></font><code>ReadString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aumentando o contador, at√© chegarmos ao final do arquivo e retornamos o n√∫mero de linhas lidas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelo menos queremos escrever esse c√≥digo, mas a fun√ß√£o est√° sobrecarregada com o tratamento de erros. Por exemplo, h√° uma constru√ß√£o t√£o estranha:</font></font><br><br><pre> <code class="go hljs"> _, err = br.ReadString(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) lines++ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aumentamos o n√∫mero de linhas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antes de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verificar se h√° erros - isso parece estranho. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A raz√£o pela qual devemos escrever dessa maneira √© porque ele </font></font><code>ReadString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar√° um erro se encontrar o final do arquivo antes do caractere de nova linha. </font><font style="vertical-align: inherit;">Isso pode acontecer se n√£o houver nova linha no final do arquivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para tentar corrigir isso, altere a l√≥gica do contador de linhas e veja se precisamos sair do loop.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Essa l√≥gica ainda n√£o √© perfeita, voc√™ pode encontrar um erro?</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas ainda n√£o terminamos de verificar se h√° erros. </font></font><code>ReadString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar√° </font></font><code>io.EOF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quando encontrar o final do arquivo. </font><font style="vertical-align: inherit;">Essa √© a situa√ß√£o esperada, portanto, para </font></font><code>ReadString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ precisar fazer alguma maneira de dizer "pare, n√£o h√° mais nada para ler". </font><font style="vertical-align: inherit;">Portanto, antes de retornar o erro ao objeto de chamada </font></font><code>CountLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, √© necess√°rio verificar se o erro n√£o est√° relacionado </font></font><code>io.EOF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e depois transmiti-lo; caso contr√°rio, retornamos </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e dizemos que est√° tudo bem. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penso que este √© um bom exemplo da tese de Russ Cox sobre como o tratamento de erros pode ocultar a fun√ß√£o. </font><font style="vertical-align: inherit;">Vejamos a vers√£o melhorada.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CountLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r io.Reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { sc := bufio.NewScanner(r) lines := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sc.Scan() { lines++ } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lines, sc.Err() }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta vers√£o aprimorada usa em seu </font></font><code>bufio.Scanner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lugar </font></font><code>bufio.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sob o cap√¥ </font></font><code>bufio.Scanner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa </font></font><code>bufio.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas adiciona um bom n√≠vel de abstra√ß√£o, o que ajuda a remover o tratamento de erros.</font></font><br><br><blockquote> <b></b> . <code>bufio.Scanner</code>    ,      . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo </font></font><code>sc.Scan()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar√° um valor </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se o scanner encontrou uma sequ√™ncia e n√£o encontrou um erro. Portanto, o corpo do loop √© </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chamado apenas se houver uma linha de texto no buffer do scanner. Isso significa que o novo </font></font><code>CountLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lida com casos quando n√£o h√° nova linha ou quando o arquivo est√° vazio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em segundo lugar, como </font></font><code>sc.Scan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quando um erro √© detectado, o ciclo </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">termina quando atinge o final do arquivo ou um erro √© detectado. O tipo </font></font><code>bufio.Scanner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lembra o primeiro erro encontrado e, usando o m√©todo </font></font><code>sc.Err()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, podemos restaurar esse erro assim que sairmos do loop. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por fim, ele </font></font><code>sc.Err()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuida do processamento </font></font><code>io.EOF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o converte para </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se o final do arquivo for alcan√ßado sem erros.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se voc√™ encontrar um tratamento excessivo de erros, tente extrair algumas opera√ß√µes para um tipo auxiliar.</font></font></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1.2 </font><font style="vertical-align: inherit;">Writeresponse</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meu segundo exemplo √© inspirado no post </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Erros s√£o valores"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anteriormente, vimos exemplos de como um arquivo √© aberto, gravado e fechado. </font><font style="vertical-align: inherit;">H√° manipula√ß√£o de erros, mas n√£o √© demais, porque as opera√ß√µes podem ser encapsuladas em auxiliares, como </font></font><code>ioutil.ReadFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>ioutil.WriteFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Por√©m, ao trabalhar com protocolos de rede de baixo n√≠vel, √© necess√°rio criar uma resposta diretamente usando as primitivas de E / S. </font><font style="vertical-align: inherit;">Nesse caso, a manipula√ß√£o de erros pode se tornar intrusiva. </font><font style="vertical-align: inherit;">Considere um fragmento de um servidor HTTP que cria uma resposta HTTP.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Header <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Key, Value <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Status <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Code <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Reason <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, st Status, headers []Header, body io.Reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { _, err := fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"HTTP/1.1 %d %s\r\n"</span></span>, st.Code, st.Reason) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, h := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> headers { _, err := fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"%s: %s\r\n"</span></span>, h.Key, h.Value) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _, err := fmt.Fprint(w, <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } _, err = io.Copy(w, body) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, construa a barra de status </font></font><code>fmt.Fprintf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e verifique o erro. Ent√£o, para cada cabe√ßalho, escrevemos um valor de chave e cabe√ßalho, sempre verificando um erro. Por fim, conclu√≠mos a se√ß√£o do cabe√ßalho com outra </font></font><code>\r\n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, verificamos o erro e copiamos o corpo da resposta para o cliente. Finalmente, embora n√£o seja necess√°rio verificar o erro </font></font><code>io.Copy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, precisamos convert√™-lo de dois valores de retorno para o √∫nico que retornar </font></font><code>WriteResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© muito trabalho mon√≥tono. Mas voc√™ pode facilitar sua tarefa aplicando um pequeno tipo de wrapper </font></font><code>errWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <code>errWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satisfaz o contrato </font></font><code>io.Writer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para que possa ser usado como inv√≥lucro. </font></font><code>errWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passa registros pela fun√ß√£o at√© que um erro seja detectado. Nesse caso, ele rejeita as entradas e retorna o erro anterior.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> errWriter <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { io.Writer err error } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e *errWriter)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(buf []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, e.err } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n, e.err = e.Writer.Write(buf) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, st Status, headers []Header, body io.Reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { ew := &amp;errWriter{Writer: w} fmt.Fprintf(ew, <span class="hljs-string"><span class="hljs-string">"HTTP/1.1 %d %s\r\n"</span></span>, st.Code, st.Reason) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, h := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> headers { fmt.Fprintf(ew, <span class="hljs-string"><span class="hljs-string">"%s: %s\r\n"</span></span>, h.Key, h.Value) } fmt.Fprint(ew, <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) io.Copy(ew, body) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ew.err }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ aplicar </font></font><code>errWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para </font></font><code>WriteResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a clareza de c√≥digo melhorou significativamente. </font><font style="vertical-align: inherit;">Voc√™ n√£o precisa mais verificar se h√° erros em cada opera√ß√£o individual. </font><font style="vertical-align: inherit;">A mensagem de erro √© movida para o final da fun√ß√£o como uma verifica√ß√£o de campo </font></font><code>ew.err</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, evitando a tradu√ß√£o irritante dos valores io.Copy retornados.</font></font><br><br><a name="7_2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2 </font><font style="vertical-align: inherit;">Manipule o erro apenas uma vez</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalmente, quero observar que os erros devem ser tratados apenas uma vez. </font><font style="vertical-align: inherit;">Processar significa verificar o significado do erro e tomar uma </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√∫nica</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> decis√£o.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// WriteAll writes the contents of buf to the supplied writer. func WriteAll(w io.Writer, buf []byte) { w.Write(buf) }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ tomar menos de uma decis√£o, ignorar√° o erro. </font><font style="vertical-align: inherit;">Como vemos aqui, o erro de √© </font></font><code>w.WriteAll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ignorado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas tomar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mais de uma</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> decis√£o em resposta a um erro tamb√©m est√° errado. </font><font style="vertical-align: inherit;">Abaixo est√° o c√≥digo que geralmente encontro.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, buf []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { _, err := w.Write(buf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"unable to write:"</span></span>, err) <span class="hljs-comment"><span class="hljs-comment">// annotated error goes to log file return err // unannotated error returned to caller } return nil }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neste exemplo, se ocorrer um erro durante o tempo </font></font><code>w.Write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a linha ser√° gravada no log e tamb√©m retornada ao chamador, que tamb√©m poder√° registr√°-lo e transmiti-lo, at√© o n√≠vel superior do programa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Provavelmente, o chamador faz o mesmo:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, conf *Config)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { buf, err := json.Marshal(conf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Printf(<span class="hljs-string"><span class="hljs-string">"could not marshal config: %v"</span></span>, err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := WriteAll(w, buf); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"could not write config: %v"</span></span>, err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Assim, uma pilha de linhas repetidas √© criada no log. </font></font><br><br><pre> <code class="go hljs">unable to write: io.EOF could not write config: io.EOF</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mas na parte superior do programa voc√™ recebe um erro original sem nenhum contexto. </font></font><br><br><pre> <code class="go hljs">err := WriteConfig(f, &amp;conf) fmt.Println(err) <span class="hljs-comment"><span class="hljs-comment">// io.EOF</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quero analisar este t√≥pico com mais detalhes, porque n√£o considero o problema de retornar um erro simultaneamente e registrar minhas prefer√™ncias pessoais. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, conf *Config)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { buf, err := json.Marshal(conf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Printf(<span class="hljs-string"><span class="hljs-string">"could not marshal config: %v"</span></span>, err) <span class="hljs-comment"><span class="hljs-comment">// oops, forgot to return } if err := WriteAll(w, buf); err != nil { log.Println("could not write config: %v", err) return err } return nil }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Costumo encontrar um problema que um programador esquece de retornar de um erro. Como dissemos anteriormente, o estilo de Go √© usar operadores de limite, verificar os pr√©-requisitos √† medida que a fun√ß√£o √© executada e retornar mais cedo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neste exemplo, o autor verificou o erro, registrou-o, mas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esqueceu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de retornar. Por isso, surge um problema sutil. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O contrato de tratamento de erros Go diz que, na presen√ßa de um erro, nenhuma suposi√ß√£o pode ser feita sobre o conte√∫do de outros valores de retorno. Como o empacotamento JSON falhou, o conte√∫do √© </font></font><code>buf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desconhecido: ele pode conter nada, mas pior, pode conter um fragmento JSON semi-escrito.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o programador esqueceu de retornar ap√≥s verificar e registrar o erro, o buffer danificado ser√° transferido </font></font><code>WriteAll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">√â prov√°vel que a opera√ß√£o tenha √™xito e, portanto, o arquivo de configura√ß√£o n√£o ser√° gravado corretamente. </font><font style="vertical-align: inherit;">No entanto, a fun√ß√£o √© conclu√≠da normalmente, e o √∫nico sinal de que ocorreu um problema √© uma linha no log em que o empacotamento JSON falhou e n√£o uma falha no registro de configura√ß√£o.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2.1 </font><font style="vertical-align: inherit;">Adicionando contexto a erros</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocorreu um erro porque o autor estava tentando adicionar contexto √† mensagem de erro. </font><font style="vertical-align: inherit;">Ele tentou deixar uma marca para indicar a fonte do erro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vejamos outra maneira de fazer o mesmo </font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, conf *Config)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { buf, err := json.Marshal(conf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt.Errorf(<span class="hljs-string"><span class="hljs-string">"could not marshal config: %v"</span></span>, err) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := WriteAll(w, buf); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt.Errorf(<span class="hljs-string"><span class="hljs-string">"could not write config: %v"</span></span>, err) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, buf []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { _, err := w.Write(buf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt.Errorf(<span class="hljs-string"><span class="hljs-string">"write failed: %v"</span></span>, err) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ combinar o registro de erro com o retorno em uma linha, √© mais dif√≠cil esquecer de retornar e evitar a continua√ß√£o acidental. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se ocorrer um erro de E / S durante a grava√ß√£o do arquivo, o m√©todo </font></font><code>Error()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">produzir√° algo como isto:</font></font><br><br><pre> <code class="go hljs">could not write config: write failed: input/output error</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2.2 </font><font style="vertical-align: inherit;">Erro ao agrupar com github.com/pkg/errors</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O padr√£o </font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciona bem para registrar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mensagens de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erro, mas o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipo de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erro segue o caminho. </font><font style="vertical-align: inherit;">Argumentei que o tratamento de erros como valores opacos √© importante para </font><font style="vertical-align: inherit;">projetos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fracamente acoplados</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; portanto, o tipo de erro de origem n√£o deve importar se precisamos apenas trabalhar com seu valor:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verifique se n√£o √© zero. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Exibi-lo na tela ou registr√°-lo. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, acontece que voc√™ precisa restaurar o erro original. </font><font style="vertical-align: inherit;">Para anotar esses erros, voc√™ pode usar algo como o meu pacote </font></font><code>errors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { f, err := os.Open(path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, errors.Wrap(err, <span class="hljs-string"><span class="hljs-string">"open failed"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> f.Close() buf, err := ioutil.ReadAll(f) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, errors.Wrap(err, <span class="hljs-string"><span class="hljs-string">"read failed"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { home := os.Getenv(<span class="hljs-string"><span class="hljs-string">"HOME"</span></span>) config, err := ReadFile(filepath.Join(home, <span class="hljs-string"><span class="hljs-string">".settings.xml"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> config, errors.WithMessage(err, <span class="hljs-string"><span class="hljs-string">"could not read config"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { _, err := ReadConfig() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Println(err) os.Exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora a mensagem se torna um belo bug no estilo K &amp; D: </font></font><br><br><pre> <code class="go hljs">could not read config: open failed: open /Users/dfc/.settings.xml: no such file or directory</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e seu valor cont√©m um link para o motivo original. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { _, err := ReadConfig() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Printf(<span class="hljs-string"><span class="hljs-string">"original error: %T %v\n"</span></span>, errors.Cause(err), errors.Cause(err)) fmt.Printf(<span class="hljs-string"><span class="hljs-string">"stack trace:\n%+v\n"</span></span>, err) os.Exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Assim, voc√™ pode restaurar o erro original e exibir o rastreamento da pilha: </font></font><br><br><pre> <code class="plaintext hljs">original error: *os.PathError open /Users/dfc/.settings.xml: no such file or directory stack trace: open /Users/dfc/.settings.xml: no such file or directory open failed main.ReadFile /Users/dfc/devel/practical-go/src/errors/readfile2.go:16 main.ReadConfig /Users/dfc/devel/practical-go/src/errors/readfile2.go:29 main.main /Users/dfc/devel/practical-go/src/errors/readfile2.go:35 runtime.main /Users/dfc/go/src/runtime/proc.go:201 runtime.goexit /Users/dfc/go/src/runtime/asm_amd64.s:1333 could not read config</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pacote </font></font><code>errors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permite adicionar contexto aos valores de erro em um formato conveniente para uma pessoa e uma m√°quina. </font><font style="vertical-align: inherit;">Em uma apresenta√ß√£o recente, eu lhe disse que no pr√≥ximo lan√ßamento do Go, esse inv√≥lucro aparecer√° na biblioteca padr√£o.</font></font><br><br><a name="8"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8. Concorr√™ncia </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Go geralmente √© escolhido por causa de seus recursos de concorr√™ncia. Os desenvolvedores fizeram muito para aumentar sua efici√™ncia (em termos de recursos de hardware) e desempenho, mas as fun√ß√µes de paralelismo da Go podem ser usadas para escrever c√≥digo que n√£o √© produtivo nem confi√°vel. No final do artigo, quero dar algumas dicas sobre como evitar algumas das armadilhas das fun√ß√µes simult√¢neas do Go. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O suporte de simultaneidade de primeira linha da Go √© fornecido pelos canais, bem como instru√ß√µes </font></font><code>select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se voc√™ estudou a teoria do Go em livros did√°ticos ou em uma universidade, deve ter notado que a se√ß√£o paralelismo √© sempre uma das √∫ltimas do curso. </font><font style="vertical-align: inherit;">Nosso artigo n√£o √© diferente: decidi falar sobre paralelismo no final, como algo adicional √†s habilidades usuais que o programador do Go deve aprender. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° uma certa dicotomia aqui, porque a principal caracter√≠stica do Go √© o nosso modelo simples e f√°cil de paralelismo. </font><font style="vertical-align: inherit;">Como produto, nossa linguagem se vende √† custa de quase essa fun√ß√£o. </font><font style="vertical-align: inherit;">Por outro lado, a concorr√™ncia n√£o √© realmente t√£o f√°cil de usar; caso contr√°rio, os autores n√£o o tornariam o √∫ltimo cap√≠tulo de seus livros e n√£o ter√≠amos visto com pesar nosso c√≥digo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta se√ß√£o discute algumas das armadilhas do uso ing√™nuo das fun√ß√µes de simultaneidade Go.</font></font><br><br><a name="8_1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1 </font><font style="vertical-align: inherit;">Fa√ßa algum trabalho o tempo todo.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qual √© o problema com este programa? </font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintln(w, <span class="hljs-string"><span class="hljs-string">"Hello, GopherCon SG"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } }() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O programa faz o que pretendemos: serve um servidor web simples. </font><font style="vertical-align: inherit;">Ao mesmo tempo, gasta o tempo da CPU em um loop infinito, porque </font></font><code>for{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na √∫ltima linha ele </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueia o gorutin main, sem executar nenhuma E / S, n√£o h√° espera para bloquear, enviar ou receber mensagens ou algum tipo de conex√£o com o sheduler. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o tempo de execu√ß√£o do Go geralmente √© atendido por um sheduler, esse programa √© executado sem sentido no processador e pode terminar em um bloqueio ativo (live-lock). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como consertar isso? </font><font style="vertical-align: inherit;">Aqui est√° uma op√ß√£o.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> <span class="hljs-string"><span class="hljs-string">"runtime"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintln(w, <span class="hljs-string"><span class="hljs-string">"Hello, GopherCon SG"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } }() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { runtime.Gosched() } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pode parecer bobagem, mas essa √© uma solu√ß√£o comum que me ocorre na vida real. </font><font style="vertical-align: inherit;">Este √© um sintoma de um mal-entendido do problema subjacente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ √© um pouco mais experiente com o Go, pode escrever algo assim.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintln(w, <span class="hljs-string"><span class="hljs-string">"Hello, GopherCon SG"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } }() <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> {} }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma declara√ß√£o vazia √© </font></font><code>select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueada para sempre. </font><font style="vertical-align: inherit;">Isso √© √∫til, porque agora n√£o giramos o processador inteiro apenas para uma chamada </font></font><code>runtime.GoSched()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No entanto, tratamos apenas o sintoma, n√£o a causa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quero lhe mostrar outra solu√ß√£o que, espero, j√° tenha ocorrido a voc√™. </font><font style="vertical-align: inherit;">Em vez de executar </font></font><code>http.ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na goroutine, deixando o principal problema da goroutine, basta executar </font></font><code>http.ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na goroutine principal.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se voc√™ sair da fun√ß√£o </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o programa Go ser√° encerrado incondicionalmente, independentemente do que outras goroutines em execu√ß√£o durante a execu√ß√£o do programa fa√ßam.</font></font></blockquote><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintln(w, <span class="hljs-string"><span class="hljs-string">"Hello, GopherCon SG"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, este √© o meu primeiro conselho: se a goroutine n√£o puder progredir at√© que ele receba um resultado de outro, ent√£o √© mais f√°cil fazer o trabalho sozinho, do que deleg√°-lo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso geralmente elimina muitos rastreamentos de estados e manipula√ß√£o de canais necess√°rios para transferir o resultado da goroutina para o iniciador do processo.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Muitos programadores do Go abusam de goroutines, especialmente no in√≠cio. </font><font style="vertical-align: inherit;">Como tudo na vida, a chave do sucesso √© a modera√ß√£o.</font></font></blockquote><br><a name="8_2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2 </font><font style="vertical-align: inherit;">Deixe o paralelismo para o chamador</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qual √© a diferen√ßa entre as duas APIs? </font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// ListDirectory returns the contents of dir. func ListDirectory(dir string) ([]string, error)</span></span></code> </pre> <br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// ListDirectory returns a channel over which // directory entries will be published. When the list // of entries is exhausted, the channel will be closed. func ListDirectory(dir string) chan string</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mencionamos as diferen√ßas √≥bvias: o primeiro exemplo l√™ o diret√≥rio em uma fatia e, em seguida, retorna a fatia ou o erro inteiro se algo der errado. Isso acontece de forma s√≠ncrona, o chamador bloqueia </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at√© que todas as entradas do diret√≥rio sejam lidas. Dependendo do tamanho do diret√≥rio, pode levar muito tempo e potencialmente muita mem√≥ria. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considere o segundo exemplo. √â um pouco mais como a programa√ß√£o Go cl√°ssica, aqui </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna o canal atrav√©s do qual as entradas do diret√≥rio ser√£o transmitidas. Quando o canal est√° fechado, isso √© um sinal de que n√£o h√° mais entradas no cat√°logo. Como o preenchimento do canal ocorre ap√≥s o retorno </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pode-se assumir que as goroutines come√ßam a preencher o canal.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Na segunda op√ß√£o, n√£o √© necess√°rio usar a goroutine: voc√™ pode selecionar um canal suficiente para armazenar todas as entradas do diret√≥rio sem bloquear, preench√™-lo, fech√°-lo e devolv√™-lo ao chamador. </font><font style="vertical-align: inherit;">Mas isso √© improv√°vel, pois nesse caso os mesmos problemas surgir√£o ao usar uma grande quantidade de mem√≥ria para armazenar em buffer todos os resultados no canal.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A vers√£o do </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canal tem mais dois problemas:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O uso de um canal fechado como um sinal que n√£o h√° mais elementos a serem processados </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o pode informar o chamador de um conjunto incompleto de elementos devido a um erro. </font><font style="vertical-align: inherit;">O chamador n√£o tem como transmitir a diferen√ßa entre um diret√≥rio vazio e um erro. </font><font style="vertical-align: inherit;">Nos dois casos, parece que o canal ser√° imediatamente fechado.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O chamador deve continuar lendo o canal quando estiver fechado, porque esta √© a √∫nica maneira de entender que a goroutina de preenchimento do canal parou de funcionar. </font><font style="vertical-align: inherit;">Essa √© uma restri√ß√£o s√©ria ao uso </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: o chamador passa um tempo lendo do canal, mesmo que tenha recebido todos os dados necess√°rios. </font><font style="vertical-align: inherit;">Isso provavelmente √© mais eficiente em termos de uso de mem√≥ria para diret√≥rios m√©dios e grandes, mas o m√©todo n√£o √© mais r√°pido que o m√©todo baseado em fatia original.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nos dois casos, a solu√ß√£o √© usar um retorno de chamada: uma fun√ß√£o que √© chamada no contexto de cada entrada de diret√≥rio enquanto √© executada. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ListDirectory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, fn </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">func</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem surpresa, a fun√ß√£o </font></font><code>filepath.WalkDir</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciona dessa maneira.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se sua fun√ß√£o iniciar a goroutine, voc√™ dever√° fornecer ao chamador uma maneira de interromper explicitamente essa rotina. </font><font style="vertical-align: inherit;">Geralmente, √© mais f√°cil deixar o modo de execu√ß√£o ass√≠ncrona no chamador.</font></font></blockquote><br><a name="8_3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3 </font><font style="vertical-align: inherit;">Nunca execute a goroutine sem saber quando vai parar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No exemplo anterior, a goroutine foi usada desnecessariamente. </font><font style="vertical-align: inherit;">Mas um dos principais pontos fortes de Go s√£o seus recursos de simultaneidade de primeira classe. </font><font style="vertical-align: inherit;">De fato, em muitos casos, o trabalho paralelo √© bastante apropriado e √© necess√°rio o uso de goroutines. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esse aplicativo simples atende o tr√°fego http em duas portas diferentes: porta 8080 para tr√°fego de aplicativos e porta 8001 para acesso ao terminal </font></font><code>/debug/pprof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> _ <span class="hljs-string"><span class="hljs-string">"net/http/pprof"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { mux := http.NewServeMux() mux.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resp http.ResponseWriter, req *http.Request)</span></span></span></span> { fmt.Fprintln(resp, <span class="hljs-string"><span class="hljs-string">"Hello, QCon!"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8001"</span></span>, http.DefaultServeMux) <span class="hljs-comment"><span class="hljs-comment">// debug http.ListenAndServe("0.0.0.0:8080", mux) // app traffic }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embora o programa seja simples, √© a base de um aplicativo real. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O aplicativo em sua forma atual tem v√°rios problemas que aparecer√£o √† medida que crescem, ent√£o vamos examinar imediatamente alguns deles.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveApp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { mux := http.NewServeMux() mux.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resp http.ResponseWriter, req *http.Request)</span></span></span></span> { fmt.Fprintln(resp, <span class="hljs-string"><span class="hljs-string">"Hello, QCon!"</span></span>) }) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, mux) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveDebug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8001"</span></span>, http.DefaultServeMux) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> serveDebug() serveApp() }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manipuladores de quebra </font></font><code>serveApp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>serveDebug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de fun√ß√µes distintas, temos os separou </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">N√≥s tamb√©m seguiu o conselho anterior e fez com que </font></font><code>serveApp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>serveDebug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deixar a tarefa para garantir o paralelismo do chamador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas existem alguns problemas com o desempenho desse programa. </font><font style="vertical-align: inherit;">Se sairmos </font></font><code>serveApp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">sairmos </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o programa ser√° encerrado e ser√° reiniciado pelo gerenciador de processos.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Assim como as fun√ß√µes em Go deixam paralelismo para o chamador, os aplicativos devem parar de monitorar seu estado e reiniciar o programa que os chamou. </font><font style="vertical-align: inherit;">N√£o responsabilize seus aplicativos por reiniciarem: este procedimento √© melhor manipulado de fora do aplicativo.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, ele </font></font><code>serveDebug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inicia em uma goroutina separada e, no caso de seu lan√ßamento, a goroutine termina, enquanto o restante do programa continua. </font><font style="vertical-align: inherit;">Seus desenvolvedores n√£o gostar√£o do fato de que voc√™ n√£o pode obter estat√≠sticas de aplicativos porque o manipulador </font></font><code>/debug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parou de funcionar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Precisamos garantir que o aplicativo seja fechado se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alguma</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> goroutina que o servir </font><font style="vertical-align: inherit;">parar </font><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveApp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { mux := http.NewServeMux() mux.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resp http.ResponseWriter, req *http.Request)</span></span></span></span> { fmt.Fprintln(resp, <span class="hljs-string"><span class="hljs-string">"Hello, QCon!"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, mux); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveDebug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8001"</span></span>, http.DefaultServeMux); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> serveDebug() <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> serveApp() <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> {} }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora </font></font><code>serverApp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eles </font></font><code>serveDebug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verificam os erros </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, se necess√°rio, os chamam </font></font><code>log.Fatal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como os dois manipuladores trabalham em goroutines, tra√ßamos a rotina principal em </font></font><code>select{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa abordagem tem v√°rios problemas:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se ele </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar com um erro </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n√£o haver√° chamada </font></font><code>log.Fatal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o servi√ßo HTTP nessa porta ser√° encerrado sem parar o aplicativo.</font></font><br></li><li> <code>log.Fatal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chama </font></font><code>os.Exit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que sai incondicionalmente do programa; </font><font style="vertical-align: inherit;">chamadas adiadas n√£o funcionar√£o, outras goroutines n√£o ser√£o notificadas do fechamento, o programa simplesmente parar√°. </font><font style="vertical-align: inherit;">Isso dificulta a grava√ß√£o de testes para essas fun√ß√µes.</font></font></li></ol><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Use apenas </font></font><code>log.Fatal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em fun√ß√µes </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, queremos transmitir qualquer erro que ocorra ao criador da goroutina, para que ele possa descobrir por que ela parou e concluiu o processo de maneira limpa.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveApp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { mux := http.NewServeMux() mux.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resp http.ResponseWriter, req *http.Request)</span></span></span></span> { fmt.Fprintln(resp, <span class="hljs-string"><span class="hljs-string">"Hello, QCon!"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, mux) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveDebug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8001"</span></span>, http.DefaultServeMux) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { done := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> error, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { done &lt;- serveDebug() }() <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { done &lt;- serveApp() }() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-built_in"><span class="hljs-built_in">cap</span></span>(done); i++ { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := &lt;-done; err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Println(<span class="hljs-string"><span class="hljs-string">"error: %v"</span></span>, err) } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O status de retorno da Goroutine pode ser obtido atrav√©s do canal. O tamanho do canal √© igual ao n√∫mero de goroutines que queremos controlar, portanto, o envio ao canal </font></font><code>done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o ser√° bloqueado, pois isso bloquear√° o desligamento das goroutines e causar√° um vazamento. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o canal </font></font><code>done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o pode ser fechado com seguran√ßa, n√£o podemos usar o idioma para o ciclo do canal </font></font><code>for range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at√© que todas as goroutines tenham sido relatadas. Em vez disso, executamos todas as goroutines em execu√ß√£o em um ciclo, que √© igual √† capacidade do canal. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora temos uma maneira de sair corretamente de todas as goroutines e corrigir todos os erros que encontrarem. Resta apenas enviar um sinal para concluir o trabalho da primeira goroutina para todos os outros. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O apelo a</font></font><code>http.Server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobre a conclus√£o, envolvi essa l√≥gica em uma fun√ß√£o auxiliar. </font><font style="vertical-align: inherit;">O ajudante </font></font><code>serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aceita o endere√ßo e </font></font><code>http.Handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, da mesma forma </font></font><code>http.ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o canal </font></font><code>stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que usamos para executar o m√©todo </font></font><code>Shutdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(addr </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, handler http.Handler, stop &lt;-</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">chan</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">struct</span></span></span></span><span class="hljs-function"><span class="hljs-params">{})</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { s := http.Server{ Addr: addr, Handler: handler, } <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { &lt;-stop <span class="hljs-comment"><span class="hljs-comment">// wait for stop signal s.Shutdown(context.Background()) }() return s.ListenAndServe() } func serveApp(stop &lt;-chan struct{}) error { mux := http.NewServeMux() mux.HandleFunc("/", func(resp http.ResponseWriter, req *http.Request) { fmt.Fprintln(resp, "Hello, QCon!") }) return serve("0.0.0.0:8080", mux, stop) } func serveDebug(stop &lt;-chan struct{}) error { return serve("127.0.0.1:8001", http.DefaultServeMux, stop) } func main() { done := make(chan error, 2) stop := make(chan struct{}) go func() { done &lt;- serveDebug(stop) }() go func() { done &lt;- serveApp(stop) }() var stopped bool for i := 0; i &lt; cap(done); i++ { if err := &lt;-done; err != nil { fmt.Println("error: %v", err) } if !stopped { stopped = true close(stop) } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, para cada valor no canal </font></font><code>done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, fechamos o canal </font></font><code>stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que faz com que cada gorutina desse canal se feche </font></font><code>http.Server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Por sua vez, isso leva a um retorno de todas as goroutinas restantes </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Quando todas as gorutinas em execu√ß√£o s√£o interrompidas, </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o processo termina e o processo √© interrompido corretamente.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Escrever essa l√≥gica por conta pr√≥pria √© um trabalho repetitivo e o risco de erros. </font><font style="vertical-align: inherit;">Veja algo como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este pacote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que far√° a maior parte do trabalho para voc√™.</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt441842/">https://habr.com/ru/post/pt441842/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt441826/index.html">O que est√° acontecendo no mercado de streaming de √°udio: discutindo o desenvolvimento de plataformas de streaming</a></li>
<li><a href="../pt441830/index.html">Guia do Usu√°rio Kibana. Visualiza√ß√£o. Parte 4</a></li>
<li><a href="../pt441832/index.html">Quem √© o gerente do projeto na opini√£o do propriet√°rio da empresa e como lidar com isso</a></li>
<li><a href="../pt441834/index.html">N√£o leve para o trabalho. Mas e se o problema estiver em voc√™?</a></li>
<li><a href="../pt441836/index.html">Uma hist√≥ria na nuvem: Huawei + 3data = nuvem</a></li>
<li><a href="../pt441844/index.html">iRobot Scooba: experi√™ncia e solu√ß√µes para problemas comuns de um limpador de rob√¥ de lavagem</a></li>
<li><a href="../pt441848/index.html">Est√°gios para desenvolvedores em Avito: miss√µes de combate e trabalho com mentores experientes</a></li>
<li><a href="../pt441850/index.html">Cartomancia em redes neurais: se o pr√≥prio autor anotou nos coment√°rios no post</a></li>
<li><a href="../pt441852/index.html">42 Vale do Sil√≠cio: como ser selecionado</a></li>
<li><a href="../pt441854/index.html">REST? Tome um JSON-RPC idiota</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>