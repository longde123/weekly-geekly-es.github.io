<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üññüèø üë©üèª‚Äçüéì üÖøÔ∏è Moteur AERODISK: Catastrophique. Partie 2. Metrocluster üîÑ üë©üèº‚Äçüè≠ üßïüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour lecteurs d'Habr! Dans un article pr√©c√©dent, nous avons parl√© d'un outil simple de tol√©rance aux catastrophes dans les syst√®mes de stockage AER...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Moteur AERODISK: Catastrophique. Partie 2. Metrocluster</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/aerodisk/blog/460305/"><p><img src="https://habrastorage.org/webt/ft/el/xz/ftelxzp4fmlci1fn9endwmjffew.jpeg"></p><br><p>  Bonjour lecteurs d'Habr!  Dans un article pr√©c√©dent, nous avons parl√© d'un outil simple de tol√©rance aux catastrophes dans les syst√®mes de stockage AERODISK ENGINE - sur la r√©plication.  Dans cet article, nous aborderons un sujet plus complexe et int√©ressant - le cluster de m√©tro, c'est-√†-dire un moyen de protection automatis√©e contre les catastrophes pour deux centres de donn√©es, qui permet aux centres de donn√©es de fonctionner en mode actif-actif.  Nous allons le raconter, le montrer, le casser et le r√©parer. </p><a name="habracut"></a><br><h2 id="kak-obychno-v-nachale-teoriya">  Comme d'habitude, au d√©but de la th√©orie </h2><br><p>  Un cluster de m√©tro est un cluster espac√© sur plusieurs sites au sein d'une ville ou d'un quartier.  Le mot ¬´cluster¬ª nous indique clairement que le complexe est automatis√©, c'est-√†-dire que la commutation des n≈ìuds de cluster en cas de d√©faillance se produit automatiquement. </p><br><p>  C'est l√† que r√©side la principale diff√©rence entre le cluster de m√©tro et la r√©plication ordinaire.  Automatisation des op√©rations.  C'est-√†-dire que dans le cas de certains incidents (panne du centre de donn√©es, canaux cass√©s, etc.), le syst√®me de stockage effectuera ind√©pendamment les actions n√©cessaires afin de maintenir la disponibilit√© des donn√©es.  Lors de l'utilisation de r√©plicas r√©guliers, ces actions sont effectu√©es enti√®rement ou partiellement manuellement par l'administrateur. </p><br><h3 id="dlya-chego-eto-nuzhno">  √Ä quoi √ßa sert? </h3><br><p> L'objectif principal que les clients poursuivent en utilisant l'une ou l'autre impl√©mentation du cluster de m√©tro est de minimiser le RTO (Recovery Time Objective).  Autrement dit, minimisez le temps de r√©cup√©ration des services informatiques apr√®s une panne.  Si vous utilisez la r√©plication normale, le temps de r√©cup√©ration sera toujours plus long que le temps de r√©cup√©ration avec le cluster Metro.  Pourquoi?  Tr√®s simple.  L'administrateur doit √™tre sur le lieu de travail et basculer la r√©plication √† la main, et le cluster de m√©tro le fait automatiquement. </p><br><p>  Si vous n'avez pas d'administrateur d√©di√© en service qui ne dorme pas, ne mange pas, ne fume pas ou ne tombe pas malade et qui regarde l'√©tat de stockage 24 heures par jour, il n'y a aucun moyen de garantir que l'administrateur sera disponible pour un changement manuel en cas de panne. </p><br><p>  En cons√©quence, RTO en l‚Äôabsence de grappe de m√©tro ou <del>  immortel admin niveau 99 </del>  Le service en service de l'administrateur sera √©gal √† la somme du temps de commutation de tous les syst√®mes et de la p√©riode maximale apr√®s laquelle l'administrateur est garanti de commencer √† travailler avec les syst√®mes de stockage et les syst√®mes associ√©s. </p><br><p>  Ainsi, nous arrivons √† la conclusion √©vidente que le cluster de m√©tro devrait √™tre utilis√© si l'exigence de RTO est de minutes, pas d'heures ou de jours, c'est-√†-dire lorsque le service informatique doit donner aux entreprises le temps de restaurer l'acc√®s √† l'informatique dans le cas de la pire chute du centre de donn√©es -services en quelques minutes, voire quelques secondes. </p><br><h3 id="kak-eto-rabotaet">  Comment √ßa marche? </h3><br><p>  Au niveau inf√©rieur, le cluster metro utilise le m√©canisme de r√©plication synchrone des donn√©es, que nous avons d√©crit dans un article pr√©c√©dent (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> ).  La r√©plication √©tant synchrone, les conditions requises sont appropri√©es, ou plut√¥t: </p><br><ul><li>  fibre comme physique, Ethernet 10 gigabits (ou sup√©rieur); </li><li>  la distance entre les centres de donn√©es ne d√©passe pas 40 kilom√®tres; </li><li>  D√©lai de canal optique entre les centres de donn√©es (entre les syst√®mes de stockage) jusqu'√† 5 millisecondes (de mani√®re optimale 2). </li></ul><br><p>  Toutes ces exigences sont de nature consultative, c'est-√†-dire que le cluster de m√©tro fonctionnera m√™me si ces exigences ne sont pas remplies, mais il faut comprendre que les cons√©quences du non-respect de ces exigences sont √©gales au ralentissement des deux syst√®mes de stockage dans le cluster de m√©tro. </p><br><p>  Ainsi, une r√©plique synchrone est utilis√©e pour transf√©rer des donn√©es entre les syst√®mes de stockage, et comment les r√©pliques sont automatiquement commut√©es, et surtout, comment √©viter le split-brain?  Pour cela, au niveau ci-dessus, une entit√© suppl√©mentaire est utilis√©e - l'arbitre. </p><br><h3 id="kak-rabotaet-arbitr-i-v-chem-ego-zadacha">  Comment fonctionne l'arbitre et quelle est sa t√¢che? </h3><br><p>  L'arbitre est une petite machine virtuelle, ou un cluster mat√©riel, qui doit √™tre ex√©cut√© sur la troisi√®me plate-forme (par exemple, au bureau) et fournir un acc√®s au stockage via ICMP et SSH.  Apr√®s le lancement, l'arbitre doit d√©finir l'adresse IP, puis du c√¥t√© stockage, indiquer son adresse, ainsi que les adresses des t√©l√©commandes qui participent au cluster de m√©tro.  Apr√®s cela, l'arbitre est pr√™t √† travailler. </p><br><p>  L'arbitre surveille en permanence tous les syst√®mes de stockage du cluster Metro et, si un syst√®me de stockage n'est pas disponible, apr√®s avoir confirm√© qu'il n'est pas disponible aupr√®s d'un autre membre du cluster (l'un des syst√®mes de stockage ¬´actifs¬ª), il d√©cide de d√©marrer la proc√©dure de changement de r√®gles de r√©plication et de mappage. </p><br><p>  Un point tr√®s important.  L'arbitre doit toujours se trouver sur un site diff√©rent de ceux sur lesquels se trouve le stockage, c'est-√†-dire ni dans le centre de donn√©es-1, o√π se trouve le stockage 1, ni dans le centre de donn√©es-2, o√π le stockage 2 est install√©. </p><br><p>  Pourquoi?  Parce que la seule fa√ßon pour un arbitre, √† l'aide de l'un des syst√®mes de stockage survivants, de d√©terminer sans ambigu√Øt√© et pr√©cision la chute de l'un des deux sites sur lesquels les syst√®mes de stockage sont install√©s.  Tout autre moyen de placer un arbitre peut entra√Æner une scission du cerveau. </p><br><h3 id="teper-pogruzimsya-v-detali-raboty-arbitra">  Plongez maintenant dans les d√©tails de l'arbitre </h3><br><p>  L'arbitre ex√©cute plusieurs services qui sont constamment interrog√©s par tous les contr√¥leurs de stockage.  Si le r√©sultat de l'enqu√™te diff√®re de la pr√©c√©dente (disponible / inaccessible), il est enregistr√© dans une petite base de donn√©es, qui fonctionne √©galement comme arbitre. </p><br><p>  <strong>Examinez plus en d√©tail la logique de l'arbitre.</strong> </p><br><p>  <u>√âtape 1. D√©termination de l'inaccessibilit√©.</u>  Un signal d'√©v√©nement concernant la d√©faillance du syst√®me de stockage est l'absence de ping des deux contr√¥leurs du m√™me syst√®me de stockage pendant 5 secondes. </p><br><p>  <u>√âtape 2. Commencez la proc√©dure de commutation.</u>  Apr√®s que l'arbitre a compris que l'un des syst√®mes de stockage n'est pas disponible, il envoie une demande au syst√®me de stockage ¬´en direct¬ª afin de s'assurer que le syst√®me de stockage ¬´mort¬ª est vraiment mort. </p><br><p>  Apr√®s avoir re√ßu une telle commande de l'arbitre, le deuxi√®me syst√®me de stockage (en direct) v√©rifie en outre la disponibilit√© du premier syst√®me de stockage tomb√© et, sinon, envoie √† l'arbitre une confirmation de ses suppositions.  Le stockage n'est vraiment pas disponible. </p><br><p>  Apr√®s avoir re√ßu une telle confirmation, l'arbitre d√©marre la proc√©dure √† distance pour commuter la r√©plication et augmenter le mappage sur les r√©pliques qui √©taient actives (principales) sur le syst√®me de stockage supprim√©, et envoie une commande au deuxi√®me syst√®me de stockage pour faire ces r√©pliques du secondaire au principal et augmenter le mappage.  Eh bien, le deuxi√®me syst√®me de stockage, respectivement, effectue ces proc√©dures, apr√®s quoi il permet d'acc√©der aux LUN perdus √† partir de lui-m√™me. </p><br><p>  Pourquoi ai-je besoin d'une v√©rification suppl√©mentaire?  Pour le quorum.  Autrement dit, la plupart du nombre impair (3) total de membres de cluster devrait confirmer la chute d'un des n≈ìuds de cluster.  Ce n'est qu'alors que cette d√©cision sera exacte.  Ceci est n√©cessaire afin d'√©viter une commutation erron√©e et, par cons√©quent, un cerveau divis√©. </p><br><p>  L'√©tape 2 dans le temps prend environ 5 √† 10 secondes, donc, en tenant compte du temps n√©cessaire pour d√©terminer l'inaccessibilit√© (5 secondes), dans les 10 √† 15 secondes apr√®s l'accident, les LUN avec stockage abandonn√© seront automatiquement disponibles pour travailler avec le stockage en direct. </p><br><p>  Il est clair que pour √©viter de d√©connecter les h√¥tes, vous devez √©galement prendre soin du r√©glage correct des d√©lais d'attente sur les h√¥tes.  Le d√©lai d'expiration recommand√© est d'au moins 30 secondes.  Cela ne permettra pas √† l'h√¥te de se d√©connecter du syst√®me de stockage pendant le transfert de charge lors d'un accident et sera en mesure de garantir qu'il n'y a pas d'interruption de l'entr√©e-sortie. </p><br><blockquote>  Une seconde, il s'av√®re que si tout va bien avec le cluster de m√©tro, pourquoi avez-vous besoin d'une r√©plication r√©guli√®re? </blockquote><p>  En fait, tout n'est pas si simple. </p><br><h3 id="rassmotrim-plyusy-i-minusy-metroklastera">  Consid√©rez les avantages et les inconv√©nients de la grappe de m√©tro </h3><br><p>  Nous avons donc r√©alis√© que les avantages √©vidents du cluster de m√©tro par rapport √† la r√©plication conventionnelle sont: </p><br><ul><li>  Automatisation compl√®te offrant un temps de r√©cup√©ration minimum en cas de sinistre; </li><li>  Et c'est tout :-). </li></ul><br><p>  Et maintenant, attention, contre: </p><br><ul><li>  Le co√ªt de la d√©cision.  Bien que le cluster de m√©tro dans les syst√®mes Aerodisk ne n√©cessite pas de licence suppl√©mentaire (la m√™me licence est utilis√©e que pour la r√©plique), le co√ªt de la solution sera toujours plus √©lev√© que l'utilisation de la r√©plication synchrone.  Il sera n√©cessaire de mettre en ≈ìuvre toutes les exigences pour la r√©plique synchrone, ainsi que les exigences pour le cluster de m√©tro li√©es √† la commutation suppl√©mentaire et au site suppl√©mentaire (voir Planification du cluster de m√©tro); </li><li>  La complexit√© de la d√©cision.  Le cluster de m√©tro est beaucoup plus complexe qu'une r√©plique r√©guli√®re et n√©cessite beaucoup plus d'attention et de travail pour la planification, la configuration et la documentation. </li></ul><br><p>  En fin de compte.  <strong>Le cluster Metro est, bien s√ªr, une solution tr√®s technologique et bonne lorsque vous avez vraiment besoin de fournir un RTO en quelques secondes ou minutes.</strong>  Mais s'il n'y a pas une telle t√¢che, et que le RTO en heures est OK pour l'entreprise, alors il ne sert √† rien de tirer des moineaux avec le canon.  La r√©plication habituelle des paysans est suffisante, car le cluster m√©tropolitain entra√Ænera des co√ªts suppl√©mentaires et compliquera l'infrastructure informatique. </p><br><h2 id="planirovanie-metroklastera">  Planification du cluster m√©tropolitain </h2><br><p>  Cette section ne pr√©tend pas √™tre un guide complet pour la conception du cluster de m√©tro, mais ne montre que les principales directions qui devraient √™tre √©labor√©es si vous d√©cidez de construire un tel syst√®me.  Par cons√©quent, avec la mise en ≈ìuvre r√©elle du cluster de m√©tro, assurez-vous d'impliquer le fabricant de syst√®mes de stockage (c'est-√†-dire, nous) et d'autres syst√®mes connexes pour les consultations. </p><br><h3 id="ploschadki">  Plateformes </h3><br><p>  Comme indiqu√© ci-dessus, un minimum de trois sites est requis pour un cluster de m√©tro.  Deux centres de donn√©es, o√π les syst√®mes de stockage et les syst√®mes associ√©s fonctionneront, ainsi qu'une troisi√®me plate-forme o√π l'arbitre fonctionnera. </p><br><p>  La distance recommand√©e entre les centres de donn√©es ne d√©passe pas 40 kilom√®tres.  De plus grandes distances sont tr√®s susceptibles de provoquer des retards suppl√©mentaires, qui dans le cas d'un cluster de m√©tro sont tr√®s ind√©sirables.  Rappelons que les retards devraient aller jusqu'√† 5 millisecondes, bien qu'il soit souhaitable d'en respecter 2. </p><br><p>  Il est √©galement recommand√© de v√©rifier les retards pendant le processus de planification.  Tout fournisseur plus ou moins adulte qui fournit de la fibre entre les centres de donn√©es, un contr√¥le de qualit√© peut s'organiser assez rapidement. </p><br><p>  En ce qui concerne les retards avant l'arbitre (c'est-√†-dire entre la troisi√®me plate-forme et les deux premi√®res), le seuil de retard recommand√© est jusqu'√† 200 millisecondes, c'est-√†-dire qu'une connexion VPN d'entreprise r√©guli√®re sur Internet convient. </p><br><h3 id="kommutaciya-i-set">  Commutation et mise en r√©seau </h3><br><p>  Contrairement √† un sch√©ma de r√©plication, o√π il suffit d'interconnecter des syst√®mes de stockage de diff√©rents sites, un sch√©ma avec un cluster de m√©tro n√©cessite de connecter des h√¥tes aux deux syst√®mes de stockage sur des sites diff√©rents.  Pour clarifier la diff√©rence, les deux sch√©mas sont r√©pertori√©s ci-dessous. </p><br><p><img src="https://habrastorage.org/webt/qq/tg/x-/qqtgx-ze1zjj9fhbb7drzz6zabw.png"></p><br><p><img src="https://habrastorage.org/webt/l3/vs/es/l3vsesenlgm7lalbws0gdqhysuy.png"></p><br><p>  Comme vous pouvez le voir sur le diagramme, les h√¥tes du site 1 regardent √† la fois SHD1 et SHD 2. De plus, au contraire, les h√¥tes de la plate-forme 2 regardent SHD 2 et SHD1.  Autrement dit, chaque h√¥te voit les deux syst√®mes de stockage.  Il s'agit d'une condition pr√©alable au fonctionnement du cluster de m√©tro. </p><br><p>  Bien s√ªr, il n'est pas n√©cessaire de tirer chaque h√¥te avec un cordon optique vers un centre de donn√©es diff√©rent, aucun port ni lacet ne suffira.  Toutes ces connexions doivent √™tre √©tablies via des commutateurs Ethernet 10G + ou FibreChannel 8G + (FC uniquement pour la connexion des h√¥tes et le stockage pour IO, le canal de r√©plication n'est actuellement disponible que sur IP (Ethernet 10G +). </p><br><p>  Maintenant, quelques mots sur la topologie du r√©seau.  Un point important est la configuration correcte des sous-r√©seaux.  Vous devez imm√©diatement identifier plusieurs sous-r√©seaux pour les types de trafic suivants: </p><br><ul><li>  Sous-r√©seau de r√©plication sur lequel les donn√©es entre les syst√®mes de stockage seront synchronis√©es.  Il peut y en avoir plusieurs, dans ce cas cela n'a pas d'importance, tout d√©pend de la topologie de r√©seau actuelle (d√©j√† impl√©ment√©e).  S'il y en a deux, alors √©videmment le routage entre eux doit √™tre configur√©; </li><li>  Sous-r√©seaux de stockage via lesquels les h√¥tes acc√©deront aux ressources de stockage (s'il s'agit d'iSCSI).  Il devrait y avoir un tel sous-r√©seau dans chaque centre de donn√©es; </li><li>  Contr√¥le des sous-r√©seaux, c'est-√†-dire trois sous-r√©seaux routables sur trois sites √† partir desquels la gestion du stockage est effectu√©e, et il existe √©galement un arbitre. </li></ul><br><p>  Nous ne consid√©rons pas les sous-r√©seaux pour acc√©der aux ressources h√¥tes ici, car ils d√©pendent fortement des t√¢ches. </p><br><p>  La s√©paration de diff√©rents trafics en diff√©rents sous-r√©seaux est extr√™mement importante (il est particuli√®rement important de s√©parer la r√©plique des E / S), car si vous m√©langez tout le trafic en un sous-r√©seau ¬´√©pais¬ª, ce trafic sera impossible √† g√©rer et, dans les conditions de deux centres de donn√©es, il peut toujours provoquer des diff√©rences options de collision r√©seau.  Nous ne nous pencherons pas beaucoup sur ce probl√®me dans le cadre de cet article, car vous pouvez en savoir plus sur la planification d'un r√©seau √©tir√© entre les centres de donn√©es sur les ressources des fabricants d'√©quipements de r√©seau, o√π il est d√©crit en d√©tail. </p><br><h3 id="konfiguraciya-arbitra">  Configuration des arbitres </h3><br><p>  L'arbitre doit fournir l'acc√®s √† toutes les interfaces de gestion du stockage via les protocoles ICMP et SSH.  Vous devez √©galement tenir compte de la tol√©rance aux pannes de l'arbitre.  Il y a une nuance. </p><br><p>  La tol√©rance aux pannes de l'arbitre est tr√®s souhaitable, mais facultative.  Et que se passe-t-il si l'arbitre se bloque au mauvais moment? </p><br><ul><li>  Le fonctionnement du cluster de m√©tro en mode normal ne changera pas, car  arbtir n'affecte en rien le fonctionnement du cluster de m√©tro en mode normal (sa t√¢che est de basculer en temps voulu la charge entre les centres de donn√©es) </li><li>  De plus, si l'arbitre pour une raison ou une autre tombe et "r√©veille" l'accident dans le centre de donn√©es, aucun changement ne se produira, car il n'y aura personne pour donner les commandes n√©cessaires pour commuter et organiser un quorum.  Dans ce cas, le cluster m√©tropolitain se transformera en un sch√©ma de r√©plication r√©gulier, qui devra √™tre commut√© √† la main lors d'une catastrophe, ce qui affectera le RTO. </li></ul><br><p>  Qu'est-ce qui en d√©coule?  Si vous avez vraiment besoin d'assurer un RTO minimum, vous devez vous assurer de la tol√©rance aux pannes de l'arbitre.  Il y a deux options pour cela: </p><br><ul><li>  Ex√©cutez une machine virtuelle avec un arbitre sur un hyperviseur de basculement, car tous les hyperviseurs adultes prennent en charge le basculement; </li><li>  Si sur le troisi√®me site (dans un bureau conditionnel) <del>  la paresse de mettre un cluster normal </del>  Comme il n'y a pas de cluster d'hyperviseur existant, nous avons fourni une version mat√©rielle de l'arbitre, qui est faite dans une bo√Æte 2U, dans laquelle deux serveurs x-86 ordinaires fonctionnent et qui peuvent survivre √† une d√©faillance locale. </li></ul><br><p>  Nous recommandons fortement que l'arbitre soit tol√©rant aux pannes malgr√© le fait que le cluster de m√©tro n'en a pas besoin en mode normal.  Mais la th√©orie et la pratique montrent que si vous construisez une infrastructure vraiment fiable et r√©sistante aux catastrophes, il est pr√©f√©rable de la jouer en toute s√©curit√©.  Il est pr√©f√©rable de vous prot√©ger, vous et votre entreprise, de la "loi de la m√©chancet√©", c'est-√†-dire de la d√©faillance de l'arbitre et de l'un des sites o√π se trouve le syst√®me de stockage. </p><br><h3 id="arhitektura-resheniya">  Architecture de la solution </h3><br><p>  Compte tenu des exigences ci-dessus, nous obtenons l'architecture de solution g√©n√©rale suivante. </p><br><p><img src="https://habrastorage.org/webt/di/wt/oq/diwtoqu2jdf7ik-nsigr4ypx37s.png"></p><br><p>  Les LUN doivent √™tre r√©partis uniform√©ment sur deux sites pour √©viter une congestion importante.  En m√™me temps, lors du dimensionnement dans les deux centres de donn√©es, il est n√©cessaire de pr√©voir non seulement un double volume (qui est n√©cessaire pour stocker les donn√©es simultan√©ment sur deux syst√®mes de stockage), mais √©galement des performances doubles en IOPS et en Mo / s, afin d'√©viter la d√©gradation des applications en cas de d√©faillance de l'un des centres de donn√©es - ov. </p><br><p>  S√©par√©ment, nous notons qu'avec une approche appropri√©e du dimensionnement (c'est-√†-dire, √† condition que nous ayons fourni les limites sup√©rieures appropri√©es pour les IOPS et les Mo / s, ainsi que les ressources CPU et RAM n√©cessaires), si l'un des syst√®mes de stockage tombe en panne dans le cluster de m√©tro, il n'y aura pas de baisse s√©rieuse des performances travail temporaire sur un syst√®me de stockage. </p><br><p>  Cela est d√ª au fait que dans les conditions de deux sites simultan√©ment, le travail de r√©plication synchrone ¬´d√©vore¬ª la moiti√© des performances d'√©criture, car chaque transaction doit √™tre √©crite sur deux syst√®mes de stockage (similaire √† RAID-1/10).  Ainsi, si l'un des syst√®mes de stockage tombe en panne, l'effet de la r√©plication temporairement (jusqu'√† ce que le syst√®me de stockage d√©faillant augmente) dispara√Æt et nous obtenons une double augmentation des performances d'√©criture.  Apr√®s le red√©marrage des LUN du syst√®me de stockage d√©faillant sur un syst√®me de stockage fonctionnel, cette double augmentation dispara√Æt en raison de la charge des LUN d'un autre syst√®me de stockage, et nous revenons au m√™me niveau de performances que nous avions avant la ¬´baisse¬ª, mais uniquement dans le cadre d'une seule plateforme. </p><br><p>  Avec l'aide d'un dimensionnement comp√©tent, il est possible de fournir des conditions dans lesquelles les utilisateurs ne ressentiront pas du tout la d√©faillance d'un syst√®me de stockage complet.  Mais encore une fois, cela n√©cessite un dimensionnement tr√®s soign√©, pour lequel, incidemment, vous pouvez nous contacter gratuitement :-). </p><br><h2 id="nastroyka-metroklastera">  Configuration du cluster Metro </h2><br><p>  La configuration d'un cluster Metro est tr√®s similaire √† la configuration d'une r√©plication r√©guli√®re, que nous avons d√©crite dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> .  Par cons√©quent, nous nous concentrons uniquement sur les diff√©rences.  Nous avons install√© un stand bas√© sur l'architecture ci-dessus dans le laboratoire dans la version minimale uniquement: deux syst√®mes de stockage connect√©s par Ethernet 10G entre eux, deux commutateurs 10G et un h√¥te qui examine les 10 ports de stockage via les commutateurs des deux syst√®mes de stockage.  L'arbitre s'ex√©cute sur une machine virtuelle. </p><br><p><img src="https://habrastorage.org/webt/gy/-v/ci/gy-vci08eyyimjl6lwa2mciot8k.png"></p><br><p>  Lors de la configuration des adresses IP virtuelles (VIP) pour une r√©plique, s√©lectionnez le type VIP pour le cluster de m√©tro. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ym/aw/89/ymaw89gofhplngagm5nvveg4oe0.png"></a> </p><br><p>  Nous avons cr√©√© deux liens de r√©plication pour deux LUN et les avons r√©partis sur deux syst√®mes de stockage: LUN TEST Primary sur SHD1 (liaison METRO), LUN TEST2 Primary sur SHD2 (liaison METRO2). </p><br><p><img src="https://habrastorage.org/webt/rz/7w/6e/rz7w6esdq4bued37xobjg1obcha.jpeg"></p><br><p>  Pour eux, nous avons mis en place deux cibles identiques (dans notre cas iSCSI, mais FC est √©galement support√©, la logique de r√©glage est la m√™me). </p><br><p>  SHD1: </p><br><p><img src="https://habrastorage.org/webt/d8/r-/dw/d8r-dw3gglptcowecdjabpewdve.jpeg"></p><br><p>  SHD2: </p><br><p><img src="https://habrastorage.org/webt/lf/ys/_6/lfys_6aohva42tp89ddqcjhakes.jpeg"></p><br><p>  Pour les connexions de r√©plication, ils ont effectu√© des mappages sur chaque syst√®me de stockage. </p><br><p>  SHD1: </p><br><p><img src="https://habrastorage.org/webt/fw/qe/5q/fwqe5qqhcir_4rlbj3usmea1hgg.jpeg"></p><br><p>  SHD2: </p><br><p><img src="https://habrastorage.org/webt/rn/68/ap/rn68apxwkixmyh3dpv70vo-9pk8.jpeg"></p><br><p>  Multipath configur√© et pr√©sent√© √† l'h√¥te. </p><br><p><img src="https://habrastorage.org/webt/gx/ii/wj/gxiiwjndb_fzeywc5hrxdfbqnrk.jpeg"></p><br><p><img src="https://habrastorage.org/webt/c6/df/5j/c6df5jjxnggdqk8wnjfbebb1rty.jpeg"></p><br><h3 id="nastraivaem-arbitra">  Configurer l'arbitre </h3><br><p>  Vous n'avez rien √† faire de sp√©cial avec l'arbitre lui-m√™me, il vous suffit de l'activer sur la troisi√®me plate-forme, de lui attribuer une IP et de configurer l'acc√®s √† celui-ci via ICMP et SSH.  La configuration elle-m√™me est effectu√©e √† partir des syst√®mes de stockage eux-m√™mes.  Dans ce cas, il suffit de configurer l'arbitre une fois sur l'un des contr√¥leurs de stockage du cluster Metro, ces param√®tres seront distribu√©s automatiquement √† tous les contr√¥leurs. </p><br><p>  Dans la section R√©plication √† distance &gt;&gt; Metrocluster (sur n'importe quel contr√¥leur) &gt;&gt; bouton Configurer. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sy/h0/x-/syh0x-gywrz2yu8w9mk0us5mwcg.jpeg"></a> </p><br><p>  Nous introduisons l'IP de l'arbitre, ainsi que les interfaces de contr√¥le des deux contr√¥leurs du syst√®me de stockage distant. </p><br><p><img src="https://habrastorage.org/webt/rs/u2/dt/rsu2dt3tt18k1it_qvmdsdnxldy.jpeg"></p><br><p>  Apr√®s cela, vous devez activer tous les services (le bouton "Tout red√©marrer").  En cas de reconfiguration future, les services doivent √™tre red√©marr√©s pour que les param√®tres prennent effet. </p><br><p><img src="https://habrastorage.org/webt/kj/sb/7u/kjsb7u9rrzlk6cttl7amr_ebxma.jpeg"></p><br><p>  V√©rifiez que tous les services sont en cours d'ex√©cution. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/oh/mw/xl/ohmwxl5jry0dufgfamey0ddxris.jpeg"></a> </p><br><p>  <strong>Ceci termine la configuration du cluster de m√©tro.</strong> </p><br><h2 id="krash-test">  Test de collision </h2><br><p>  Le crash test dans notre cas sera assez simple et rapide, puisque la fonctionnalit√© de r√©plication (commutation, coh√©rence, etc.) a √©t√© envisag√©e dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> .  Par cons√©quent, pour tester la fiabilit√© d'un cluster de m√©tro, il nous suffit de v√©rifier l'automatisation de la d√©tection des accidents, la commutation et l'absence de pertes d'enregistrement (arr√™ts d'E / S). </p><br><p>  Pour ce faire, nous √©mulons la d√©faillance compl√®te de l'un des syst√®mes de stockage en arr√™tant physiquement ses deux contr√¥leurs, en d√©marrant la copie pr√©liminaire d'un gros fichier sur le LUN, qui doit √™tre activ√© sur l'autre syst√®me de stockage. </p><br><p><img src="https://habrastorage.org/webt/f-/lb/fo/f-lbfonzy8n4iawaihumetqtkmo.png"></p><br><p>  D√©sactivez un stockage.  Sur le deuxi√®me syst√®me de stockage, nous voyons des alertes et des messages dans les journaux que la connexion avec le syst√®me voisin a disparu.  Si vous avez configur√© des alertes pour la surveillance SMTP ou SNMP, l'administrateur recevra les alertes appropri√©es. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ae/jo/xv/aejoxv6piwk4fvl-nc1leklbxce.jpeg"></a> </p><br><p>  Exactement 10 secondes plus tard (vu dans les deux captures d'√©cran), le lien de r√©plication METRO (celui qui √©tait principal sur le syst√®me de stockage en panne) est automatiquement devenu principal sur le syst√®me de stockage en cours d'ex√©cution.  En utilisant le mappage existant, LUN TEST est rest√© disponible pour l'h√¥te, l'enregistrement s'est affaiss√© un peu (dans les 10% promis), mais n'a pas cass√©. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/v_/gj/d9/v_gjd9sgoi5hwrgjdkwxwtdomeu.jpeg"></a> </p><br><p><img src="https://habrastorage.org/webt/ih/lq/rg/ihlqrgv7dq-4fv6dlnhair6nib4.jpeg"></p><br><p>  <strong>Le test s'est termin√© avec succ√®s.</strong> </p><br><h2 id="podvodim-itog">  Pour r√©sumer </h2><br><p>  L'impl√©mentation actuelle du m√©trocluster dans les syst√®mes de stockage AERODISK Engine de la s√©rie N permet de r√©soudre compl√®tement les probl√®mes o√π il est n√©cessaire d'√©liminer ou de minimiser les temps d'arr√™t des services informatiques et d'assurer leur fonctionnement 24/7/365 avec un minimum de main-d'≈ìuvre. </p><br><p>  , ,    ,      ‚Ä¶       ,      ,    .      ,         ,        ,         . </p><br><p> ,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460305/">https://habr.com/ru/post/fr460305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460287/index.html">Visualisation des nouvelles de Runet</a></li>
<li><a href="../fr460291/index.html">Probl√®mes de traitement par lots des demandes et leurs solutions (partie 1)</a></li>
<li><a href="../fr460295/index.html">Que signifie dangereux √† Rust?</a></li>
<li><a href="../fr460297/index.html">WeakRef - proposition d'ajout √† la norme ECMAScript</a></li>
<li><a href="../fr460301/index.html">Lampes LED haute puissance nouvelle g√©n√©ration</a></li>
<li><a href="../fr460307/index.html">Exp√©rience de mod√©lisation de l'√©quipe Computer Vision Mail.ru</a></li>
<li><a href="../fr460311/index.html">Il est temps pour une nouvelle th√©orie de l'argent</a></li>
<li><a href="../fr460313/index.html">Les diff√©rentes chansons √† succ√®s ont-elles quelque chose en commun?</a></li>
<li><a href="../fr460319/index.html">√Ä la recherche d'inspecteurs spatiaux</a></li>
<li><a href="../fr460321/index.html">Galerie des meilleurs carnets ML et Data Science</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>