<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😖 ⛵️ 🏌️ Steganographie in IP-Paketen 🤰🏽 🎀 👩🏾‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bevor sie eine andere Laborarbeit verteidigten, stellten sie mir einmal eine Frage: Welche Felder eines IP-Pakets können zum Quilten verwendet werden?...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Steganographie in IP-Paketen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413851/">  Bevor sie eine andere Laborarbeit verteidigten, stellten sie mir einmal eine Frage: Welche Felder eines IP-Pakets können zum Quilten verwendet werden?  Ich wusste es nicht und zuckte nur die Achseln.  Aber bald entschied ich mich immer noch, dieses Thema zu studieren. <br><br>  Unter dem Schnitt finden Sie die Studie über IP-Paket-Header, Pythons eigenes Ping-Dienstprogramm und verschiedene Möglichkeiten, Daten zu übertragen, ohne Aufmerksamkeit zu erregen. <br><a name="habracut"></a><br><h1>  Inhalt </h1><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IP-Paketstruktur</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Umgebungseinstellung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ping: Einfache Option</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ping: Schwierige Option</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verbesserungen?</a> </li></ol><br><a name="ip-struct"></a><h1>  IPv4-Paketstruktur </h1><br><img src="https://habrastorage.org/webt/r9/29/fa/r929fayvayajg2jl6a8016g3fbw.png"><br><br>  Wählen Sie die Felder aus, deren Änderung das Paket nicht wesentlich beeinflusst: <br><br>  <b><abbr title="Länge des Internet-Headers">IHL</abbr></b> kann von 5 bis 15 variieren. <br>  Das <b><abbr title="Art der Dienstleistung">ToS-</abbr></b> Feld wird verwendet, um Verkehrs- und Überlastungsbenachrichtigungen zu priorisieren, ohne Pakete zu verwerfen.  Meistens ist dieses Feld 0. Theoretisch kann es verwendet werden, um ein ganzes Byte an Informationen zu übertragen. <br>  <b>Die Länge des Pakets ist ein</b> ausgezeichnetes Feld für die Übertragung von Nummern von 20 bis 65535. <br>  <b><abbr title="Zeit zu leben">TTL</abbr></b> kann bis zu 7 Informationsbits übertragen.  Sie müssen die Anzahl der Hops zum Host kennen und dies berücksichtigen. <br><br><a name="setup"></a><h1>  Umgebungseinstellung </h1><br>  Um das Experiment zu wiederholen, benötigen Sie zwei Maschinen mit Python und dem Scapy-Framework. <br><br>  Sie können es installieren, indem Sie den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen in der Dokumentation</a> folgen.  In meinem Fall waren dies zwei Tröpfchen auf DO mit eingeschaltetem lokalen Netzwerk.  Um die Funktionsfähigkeit des Steganos zu testen, wurden zwei Routen ausgewählt: über das lokale Netzwerk für 1 Hop und über das Internet für 2 Hop. <br><br><a name="simple-ping"></a><h1>  Ping: Einfache Option </h1><br>  Zuerst implementieren wir sender.py, das ICMP-Pakete ohne versteckte Nachrichten sendet. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scapy.all <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-comment"><span class="hljs-comment">#    10.0.0.2  icmp-type 8 (echo-request) pkt = IP(src="10.0.0.1", dst="10.0.0.2") / ICMP(type = 8) #      sr1(pkt)</span></span></code> </pre> <br>  Scapy füllt die verbleibenden Felder vor dem Senden mit Standardwerten aus und berechnet die Prüfsumme. <br><br>  Schreiben Sie auf der Empfangsseite listener.py, das alle eingehenden ICMP-Pakete abhört und anzeigt. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scapy.all <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-comment"><span class="hljs-comment">#    # filter --  icmp # timeout --   10  # count --    100  # iface --    eth1 packets = sniff(filter = "icmp", timeout = 10, count = 100, iface = "eth1") #      for pkt in packets: #     echo-request if pkt[ICMP].type != 8: continue #    pkt.show()</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Listener-Ausgabe</b> <div class="spoiler_text"><pre> <code class="hljs tex">###[ Ethernet ]### dst = hh:hh:hh:hh:hh:hh src = gg:gg:gg:gg:gg:gg type = 0x800 ###[ IP ]### version = 4 ihl = 5 tos = 0x0 len = 28 id = 24923 flags = frag = 0 ttl = 64 proto = icmp chksum = 0x4364 src = 10.0.0.1 dst = 10.0.0.2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">options</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>###[ ICMP ]### type = echo-request code = 0 chksum = 0xf7ff id = 0x0 seq = 0x0 ###[ Padding ]### load = '<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x</span></span></span></span>00'</code> </pre> <br></div></div><br>  Der IP-Paket-Header hat ein Identifizierungsfeld.  Füllen Sie es mit den Symbolen "A" und "B": <br><br><pre> <code class="python hljs">payload = ord(<span class="hljs-string"><span class="hljs-string">"A"</span></span>) * <span class="hljs-number"><span class="hljs-number">0x100</span></span> + ord(<span class="hljs-string"><span class="hljs-string">"B"</span></span>) pkt = IP(src=<span class="hljs-string"><span class="hljs-string">"10.0.0.1"</span></span>, dst=<span class="hljs-string"><span class="hljs-string">"10.0.0.2"</span></span>, id = payload) / ICMP(type = <span class="hljs-number"><span class="hljs-number">8</span></span>)</code> </pre><br>  Darüber hinaus gibt es im ICMP-Header genau das gleiche Feld, in das auch zwei Bytes geladen werden können. <br><br>  Ändern Sie den Listener, um die empfangenen Daten anzuzeigen: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scapy.all <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys packets = sniff(filter=<span class="hljs-string"><span class="hljs-string">"icmp"</span></span>, timeout = <span class="hljs-number"><span class="hljs-number">10</span></span>, count = <span class="hljs-number"><span class="hljs-number">100</span></span>, iface=<span class="hljs-string"><span class="hljs-string">"eth0"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> pkt <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> packets: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pkt[ICMP].type != <span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-comment"><span class="hljs-comment">#    a, b = divmod(pkt[IP].id, 0x100) sys.stdout.write(chr(a)) sys.stdout.write(chr(b)) sys.stdout.flush()</span></span></code> </pre><br>  Im Bild und in der Abbildung können Sie fast jedes Feld ausfüllen, das zuvor als zum Quilten geeignet eingestuft wurde. <br><br><a name="complex-ping"></a><h1>  Ping: Schwierige Option </h1><br>  Die Übertragung von Daten aus dem vorherigen Absatz war nicht die offensichtlichste, aber wir können sie noch offensichtlicher machen.  Sie können die Daten im Feld für die Prüfsumme ausblenden.  Nach <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC1071 ist</a> eine Prüfsumme (plötzlich!) Eine bitweise Inversion einer etwas komplexeren arithmetischen Summe. <br><br><div class="spoiler">  <b class="spoiler_title">Erklärung mit einem Beispiel</b> <div class="spoiler_text">  Angenommen, wir haben einen Header, für den wir die Prüfsumme berechnen möchten.  Zum Zeitpunkt der Berechnung wird das Prüfsummenfeld zurückgesetzt. <br><br><pre> <code class="hljs go"><span class="hljs-number"><span class="hljs-number">4500</span></span> <span class="hljs-number"><span class="hljs-number">003</span></span>c <span class="hljs-number"><span class="hljs-number">000</span></span>a <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">8001</span></span> [checksum] c0a8 <span class="hljs-number"><span class="hljs-number">000d</span></span> c0a8 <span class="hljs-number"><span class="hljs-number">000d</span></span></code> </pre> <br>  1. Addieren Sie alle 16-Bit-Wörter und merken Sie sich die Übertragung von der höheren Ordnung: <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">4500</span></span> + <span class="hljs-number"><span class="hljs-number">003</span></span>c + <span class="hljs-number"><span class="hljs-number">000</span></span>a + <span class="hljs-number"><span class="hljs-number">0000</span></span> + <span class="hljs-number"><span class="hljs-number">8001</span></span> + [<span class="hljs-type"><span class="hljs-type">checksum</span></span>=<span class="hljs-number"><span class="hljs-number">0000</span></span>] + c0a8 + <span class="hljs-number"><span class="hljs-number">000</span></span>d + c0a8 + <span class="hljs-number"><span class="hljs-number">000</span></span>e = = (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">46</span></span>b2</code> </pre> <br>  2. Addieren Sie das Ergebnis mit Übertragungen: <br><br><pre> <code class="hljs">46b2 + 2 = 46b4</code> </pre> <br>  3. Invertieren: <br><br><pre> <code class="hljs">~(46b4) = b94b</code> </pre> <br>  <b>b94b</b> ist die Prüfsumme, nach der wir <b>suchen</b> .  Zur Überprüfung können Sie in der Kopfzeile ersetzen und die Schritte 1 und 2 ausführen. Wenn Sie FFFF erhalten, ist der gefundene Betrag korrekt. <br><br>  Überprüfung: <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">1</span></span>. <span class="hljs-number"><span class="hljs-number">4500</span></span> + <span class="hljs-number"><span class="hljs-number">003</span></span>c + <span class="hljs-number"><span class="hljs-number">000</span></span>a + <span class="hljs-number"><span class="hljs-number">0000</span></span> + <span class="hljs-number"><span class="hljs-number">8001</span></span> + [<span class="hljs-type"><span class="hljs-type">checksum</span></span>=<span class="hljs-type"><span class="hljs-type">b94b</span></span>] + c0a8 + <span class="hljs-number"><span class="hljs-number">000</span></span>d + c0a8 + <span class="hljs-number"><span class="hljs-number">000</span></span>e = = (<span class="hljs-number"><span class="hljs-number">2</span></span>) FFFD <span class="hljs-number"><span class="hljs-number">2</span></span>. FFFD + <span class="hljs-number"><span class="hljs-number">2</span></span> = FFFF</code> </pre><br></div></div><br>  Wir wissen, dass sich die Prüfsumme eines Pakets ändert, wenn Knoten das Netzwerk passieren, wenn sich die TTL ändert.  Außerdem wird beim Durchlaufen von NAT im Paket die „Quelladresse“ ersetzt, was sich auch auf die Prüfsumme auswirkt.  Und wie viel TTL wird abnehmen, wenn wir unseren Hörer erreichen ... Die Kirsche auf dem Kuchen ist, dass die Bitterkeit des "Bezeichners" mit der Bitterkeit der Prüfsumme übereinstimmt.  Diese Tatsache ermöglicht es uns, die Prüfsumme zu beeinflussen und in einen beliebigen Wert aus dem Definitionsbereich zu ändern.  Da die Prüfsumme (Nutzlast) nur beim Passieren des letzten Knotens in der Route berechnet wird, ist es wichtig, bei der Berechnung alles zu berücksichtigen, was während der Route im Paket geändert werden kann. <br><br>  Der Algorithmus zum Finden des "Bezeichners", der uns die gewünschte Prüfsumme gibt: <br><br><ol><li>  Wir konfigurieren das Paket so, als ob es den letzten Knoten passiert (IP, TTL usw.) </li><li>  Schreiben Sie in die "Kennung" die Nutzdaten </li><li>  Wir berechnen die Prüfsumme </li><li>  Das Ergebnis muss in die "Kennung" des gesendeten Pakets geschrieben werden </li></ol><br>  Wir werden eine Funktion schreiben, die ein Paket aus der Anzahl der Hoffnungen, IPs hinter NAT und zwei Bytes Nutzlast bildet. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># src -   # src_nat -    NAT # dst -   # dttl -       # a, b --      def send_stegano(src, src_nat, dst, dttl, a, b): #       payload = ord(a)*0x100 + ord(b) #         pkt = IP(dst=dst, src=src_nat, ttl=64-dttl, id = payload) / ICMP(type=8) #  Scapy  chksum pkt = IP(raw(pkt)) #     pkt[IP].src = src pkt[IP].ttl = 64 pkt[IP].id = pkt[IP].chksum #   chksum,  Scapy   del pkt[IP].chksum # Scapy      pkt = IP(raw(pkt)) #      sr1(pkt)</span></span></code> </pre><br><a name="the-cake-is-a-lie"></a><h1>  Verbesserungen? </h1><br><ul><li>  Die Felder chksum, seq, id im Header des ICMP-Protokolls können auch zur Datenübertragung verwendet werden </li><li>  ToS kann verwendet werden, um Pakete "von ihren eigenen" zu identifizieren und die Echoanforderung anderer Leute zu ignorieren. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413851/">https://habr.com/ru/post/de413851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413839/index.html">KI, praktischer Kurs. Sammlung und Recherche von Bildern</a></li>
<li><a href="../de413841/index.html">Alternativen zu Google-Produkten</a></li>
<li><a href="../de413843/index.html">Waymo vor den anderen: Die Robomobile des Unternehmens sind 11 Millionen Kilometer gerollt</a></li>
<li><a href="../de413847/index.html">"Lebendiges" Triggerdenkmal</a></li>
<li><a href="../de413849/index.html">Sennheiser Markengeschichte: Freiheit und Vision</a></li>
<li><a href="../de413853/index.html">Übersicht über Gradientenmethoden bei mathematischen Optimierungsproblemen</a></li>
<li><a href="../de413855/index.html">Der Algorithmus zur Ermittlung von Bots und Angeboten auf Vkontakte</a></li>
<li><a href="../de413857/index.html">Biostar Racing P1: kalter Auspuff</a></li>
<li><a href="../de413859/index.html">Die Geheimnisse eines interplanetaren Außerirdischen enthüllen</a></li>
<li><a href="../de413861/index.html">Europa wiederholt den Wiederverwendbarkeitsansatz von SpaceX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>