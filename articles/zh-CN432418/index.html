<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜º ğŸ”´ ğŸ¤  è§£æJavaä¸­çš„Lambdaè¡¨è¾¾å¼ â™¾ ğŸ‘©â€ğŸ’¼ ğŸ‘¨ğŸ¿â€ğŸ¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¯‘è€…çš„è¯ï¼šLambdaMetafactoryå¯èƒ½æ˜¯Java 8ä¸­è¢«ä½ä¼°çš„æœºåˆ¶ä¹‹ä¸€ï¼Œæˆ‘ä»¬æœ€è¿‘å‘ç°äº†å®ƒï¼Œä½†å·²ç»å¯¹å…¶åŠŸèƒ½æ„Ÿåˆ°èµèµã€‚ CUBAæ¡†æ¶7.0ç‰ˆé€šè¿‡é¿å…ä½¿ç”¨ç”ŸæˆLambdaè¡¨è¾¾å¼çš„åå°„è°ƒç”¨æ¥æé«˜æ€§èƒ½ã€‚ è¿™ç§æœºåˆ¶åœ¨æˆ‘ä»¬çš„æ¡†æ¶ä¸­çš„åº”ç”¨ä¹‹ä¸€æ˜¯é€šè¿‡æ³¨é‡Šå°†åº”ç”¨ç¨‹åºäº‹ä»¶å¤„ç†ç¨‹åºç»‘å®šï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ä»»åŠ¡ï¼Œæ˜¯Sp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è§£æJavaä¸­çš„Lambdaè¡¨è¾¾å¼</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/432418/"><p><img src="https://habrastorage.org/webt/nh/bc/r2/nhbcr2a_t-abgnja2uip1sl-uki.jpeg" alt="å›¾ç‰‡"></p><br><p>  <em>è¯‘è€…çš„è¯ï¼šLambdaMetafactoryå¯èƒ½æ˜¯Java 8ä¸­è¢«ä½ä¼°çš„æœºåˆ¶ä¹‹ä¸€ï¼Œæˆ‘ä»¬æœ€è¿‘å‘ç°äº†å®ƒï¼Œä½†å·²ç»å¯¹å…¶åŠŸèƒ½æ„Ÿåˆ°èµèµã€‚</em>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBA</a>æ¡†æ¶7.0ç‰ˆé€šè¿‡é¿å…ä½¿ç”¨ç”ŸæˆLambdaè¡¨è¾¾å¼çš„åå°„è°ƒç”¨æ¥æé«˜æ€§èƒ½ã€‚</em>  <em>è¿™ç§æœºåˆ¶åœ¨æˆ‘ä»¬çš„æ¡†æ¶ä¸­çš„åº”ç”¨ä¹‹ä¸€æ˜¯é€šè¿‡æ³¨é‡Šå°†åº”ç”¨ç¨‹åºäº‹ä»¶å¤„ç†ç¨‹åºç»‘å®šï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ä»»åŠ¡ï¼Œæ˜¯Springçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">EventListener</a>çš„ç±»ä¼¼ç‰©ã€‚</em>  <em>æˆ‘ä»¬ç›¸ä¿¡LambdaFactoryåŸç†çš„çŸ¥è¯†åœ¨è®¸å¤šJavaåº”ç”¨ç¨‹åºä¸­å¯èƒ½ä¼šæœ‰ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›ä¸æ‚¨å…±äº«æ­¤ç¿»è¯‘ã€‚</em> </p><br><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºä¸€äº›åœ¨Java 8ä¸­ä½¿ç”¨lambdaè¡¨è¾¾å¼æ—¶é²œä¸ºäººçŸ¥çš„æŠ€å·§ä»¥åŠè¿™äº›è¡¨è¾¾å¼çš„å±€é™æ€§ã€‚ æœ¬æ–‡çš„ç›®æ ‡è¯»è€…æ˜¯é«˜çº§Javaå¼€å‘äººå‘˜ï¼Œç ”ç©¶äººå‘˜å’Œå·¥å…·åŒ…å¼€å‘äººå‘˜ã€‚ åªæœ‰å…¬å…±Java APIæ‰èƒ½ä½¿ç”¨<code>com.sun.*</code>å’Œå…¶ä»–å†…éƒ¨ç±»ï¼Œå› æ­¤ä»£ç å¯åœ¨ä¸åŒçš„JVMå®ç°ä¹‹é—´ç§»æ¤ã€‚ </p><a name="habracut"></a><br><h3 id="korotkoe-predislovie"> ç®€çŸ­çš„å‰è¨€ </h3><br><p>  Lambdaè¡¨è¾¾å¼ä½œä¸ºä¸€ç§å®ç°åŒ¿åæ–¹æ³•çš„æ–¹å¼å‡ºç°åœ¨Java 8ä¸­ï¼Œ <br> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥æ›¿ä»£åŒ¿åç±»ã€‚ åœ¨å­—èŠ‚ç çº§åˆ«ï¼Œlambdaè¡¨è¾¾å¼è¢«<code>invokedynamic</code>æ›¿æ¢ã€‚ è¯¥æŒ‡ä»¤ç”¨äºåˆ›å»ºåŠŸèƒ½æ¥å£å®ç°ï¼Œå…¶å”¯ä¸€æ–¹æ³•å°†è°ƒç”¨å§”æ´¾ç»™å®é™…æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒ…å«åœ¨lambdaè¡¨è¾¾å¼ä¸»ä½“ä¸­å®šä¹‰çš„ä»£ç ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ä»£ç ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printElements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; strings)</span></span></span></span>{ strings.forEach(item -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"Item = %s"</span></span>, item)); }</code> </pre> <br><p> è¯¥ä»£ç å°†ç”±Javaç¼–è¯‘å™¨è½¬æ¢ä¸ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„ä»£ç ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lambda_forEach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Java  System.out.println("Item = %s", item); } private static CallSite bootstrapLambda(Lookup lookup, String name, MethodType type) { // //lookup =  VM //name = "lambda_forEach",  VM //type = String -&gt; void MethodHandle lambdaImplementation = lookup.findStatic(lookup.lookupClass(), name, type); return LambdaMetafactory.metafactory(lookup, "accept", MethodType.methodType(Consumer.class), //  - MethodType.methodType(void.class, Object.class), //  Consumer.accept    lambdaImplementation, //     - type); } void printElements(List&lt;String&gt; strings) { Consumer&lt;String&gt; lambda = invokedynamic# bootstrapLambda, #lambda_forEach strings.forEach(lambda); }</span></span></code> </pre> <br><p>  <code>invokedynamic</code>æŒ‡ä»¤å¯ä»¥å¤§è‡´è¡¨ç¤ºä¸ºä»¥ä¸‹Javaä»£ç ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CallSite cs; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printElements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; strings)</span></span></span><span class="hljs-function"> </span></span>{ Consumer&lt;String&gt; lambda; <span class="hljs-comment"><span class="hljs-comment">//begin invokedynamic if (cs == null) cs = bootstrapLambda(MethodHandles.lookup(), "lambda_forEach", MethodType.methodType(void.class, String.class)); lambda = (Consumer&lt;String&gt;)cs.getTarget().invokeExact(); //end invokedynamic strings.forEach(lambda); }</span></span></code> </pre> <br><p> å¦‚æ‚¨æ‰€è§ï¼Œ <code>LambdaMetafactory</code>ç”¨äºåˆ›å»º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CallSite</a> ï¼Œè¯¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CallSite</a>æä¾›äº†ä¸€ç§å·¥å‚æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ç›®æ ‡æ–¹æ³•çš„å¤„ç†ç¨‹åºã€‚ æ­¤æ–¹æ³•ä½¿ç”¨<code>invokeExact</code>è¿”å›åŠŸèƒ½æ¥å£çš„å®ç°ã€‚ å¦‚æœlambdaè¡¨è¾¾å¼ä¸­åŒ…å«æ•è·çš„å˜é‡ï¼Œåˆ™<code>invokeExact</code>è¿™äº›å˜é‡ä½œä¸ºå®é™…å‚æ•°æ¥å—ã€‚ </p><br><p> åœ¨Oracle JRE 8ä¸­ï¼Œmetafactoryä½¿ç”¨ObjectWeb AsmåŠ¨æ€ç”ŸæˆJavaç±»ï¼Œè¯¥Javaç±»åˆ›å»ºå®ç°åŠŸèƒ½æ¥å£çš„ç±»ã€‚ å¦‚æœlambdaè¡¨è¾¾å¼æ•è·å¤–éƒ¨å˜é‡ï¼Œåˆ™å¯ä»¥å°†å…¶ä»–å­—æ®µæ·»åŠ åˆ°åˆ›å»ºçš„ç±»ä¸­ã€‚ è¿™ä¸ªçœ‹èµ·æ¥åƒJavaåŒ¿åç±»ï¼Œä½†æ˜¯æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š </p><br><ul><li>  Javaç¼–è¯‘å™¨ç”Ÿæˆä¸€ä¸ªåŒ¿åç±»ã€‚ </li><li> ç”¨äºå®ç°lambdaè¡¨è¾¾å¼çš„ç±»æ˜¯ç”±JVMåœ¨è¿è¡Œæ—¶åˆ›å»ºçš„ã€‚ </li></ul><br><hr><br><p>  <strong>å…ƒå·¥å‚å®ç°å–å†³äºJVMä¾›åº”å•†å’Œç‰ˆæœ¬</strong> </p><br><hr><br><p> å½“ç„¶ï¼Œ <code>invokedynamic</code>ä¸ä»…ç”¨äºJavaä¸­çš„lambdaè¡¨è¾¾å¼ã€‚ å®ƒä¸»è¦åœ¨JVMç¯å¢ƒä¸­è¿è¡ŒåŠ¨æ€è¯­è¨€æ—¶ä½¿ç”¨ã€‚  Javaå†…ç½®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„Nashorn</a> JavaScript <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼•æ“</a>å¤§é‡ä½¿ç”¨äº†æ­¤æŒ‡ä»¤ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»<code>LambdaMetafactory</code>ç±»åŠå…¶åŠŸèƒ½ã€‚ ä¸‹ä¸€ä¸ª <br> æœ¬æ–‡çš„è¿™ä¸€éƒ¨åˆ†å‡å®šæ‚¨éå¸¸äº†è§£å…ƒå·¥å‚æ–¹æ³•çš„å·¥ä½œæ–¹å¼ä»¥åŠ<code>MethodHandle</code>ä»€ä¹ˆ </p><br><h2 id="tryuki-s-lyambda-vyrazheniyami">  Lambdaè¡¨è¾¾å¼æŠ€å·§ </h2><br><p> åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•æ„å»ºç”¨äºæ—¥å¸¸ä»»åŠ¡çš„åŠ¨æ€lambdaã€‚ </p><br><h3 id="proveryaemye-isklyucheniya-i-lyambdy"> æ£€æŸ¥å¼‚å¸¸å’Œlambda </h3><br><p> ä¼—æ‰€å‘¨çŸ¥ï¼ŒJavaä¸­å­˜åœ¨çš„æ‰€æœ‰åŠŸèƒ½æ¥å£éƒ½ä¸æ”¯æŒæ£€æŸ¥çš„å¼‚å¸¸ã€‚ ä¸å¸¸è§„ä¾‹å¤–ç›¸æ¯”ï¼Œæ£€æŸ¥ä¾‹å¤–çš„ä¼˜åŠ¿æ˜¯ä¸€ä¸ªé•¿æœŸå­˜åœ¨ï¼ˆå¹¶ä¸”ä»ç„¶å¾ˆçƒ­é—¨ï¼‰çš„äº‰è®ºã€‚ </p><br><p> ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦åœ¨lambdaè¡¨è¾¾å¼ä¸­å°†å¸¦æœ‰æ£€æŸ¥å¼‚å¸¸çš„ä»£ç ä¸Java Streamsç»“åˆä½¿ç”¨å‘¢ï¼Ÿ ä¾‹å¦‚ï¼Œæ‚¨éœ€è¦å°†å­—ç¬¦ä¸²åˆ—è¡¨è½¬æ¢ä¸ºå¦‚ä¸‹æ‰€ç¤ºçš„URLåˆ—è¡¨ï¼š </p><br><pre> <code class="java hljs">Arrays.asList(<span class="hljs-string"><span class="hljs-string">"http://localhost/"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://github.com"</span></span>).stream() .map(URL::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>) .collect(Collectors.toList())</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">URLï¼ˆStringï¼‰</a>çš„æ„é€ å‡½æ•°ä¸­å£°æ˜äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼•å‘</a>å¼‚å¸¸ï¼Œå› æ­¤ä¸èƒ½å°†å…¶ç›´æ¥ç”¨ä½œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Functiion</a>ç±»ä¸­çš„æ–¹æ³•å¼•ç”¨ã€‚ </p><br><p> æ‚¨ä¼šè¯´ï¼šâ€œä¸ï¼Œå¦‚æœæ‚¨åœ¨è¿™é‡Œä½¿ç”¨æ­¤æŠ€å·§ï¼Œä¹Ÿè®¸ä¼šè¿™æ ·ï¼šâ€ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uncheckCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Callable&lt;T&gt; callable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callable.call(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sneakyThrow(e); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;E extends Throwable, T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sneakyThrow0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable t)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> E </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> (E)t; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sneakyThrow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable e)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Util.&lt;RuntimeException, T&gt;sneakyThrow0(e); } <span class="hljs-comment"><span class="hljs-comment">//   //return s.filter(a -&gt; uncheckCall(a::isActive)) // .map(Account::getNumber) // .collect(toSet());</span></span></code> </pre> <br><p> è¿™æ˜¯ä¸€ä¸ªè‚®è„çš„hackã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼š </p><br><ul><li> ä½¿ç”¨try-catchå—ã€‚ </li><li> å†æ¬¡å¼•å‘å¼‚å¸¸ã€‚ </li><li>  Javaä¸­ç±»å‹æ“¦é™¤çš„è‚®è„ç”¨æ³•ã€‚ </li></ul><br><p> å¯ä»¥ä½¿ç”¨ä»¥ä¸‹äº‹å®çš„çŸ¥è¯†ä»¥æ›´â€œåˆæ³•â€çš„æ–¹å¼è§£å†³é—®é¢˜ï¼š </p><br><ul><li> å·²æ£€æŸ¥çš„å¼‚å¸¸ä»…åœ¨Javaç¼–è¯‘å™¨çº§åˆ«è¢«è¯†åˆ«ã€‚ </li><li>  <code>throws</code>éƒ¨åˆ†åªæ˜¯åœ¨JVMçº§åˆ«ä¸Šæ²¡æœ‰è¯­ä¹‰å€¼çš„æ–¹æ³•çš„å…ƒæ•°æ®ã€‚ </li><li> åœ¨JVMä¸­ï¼Œåœ¨å­—èŠ‚ç çº§åˆ«ä¸Šï¼Œå·²æ£€æŸ¥å¼‚å¸¸å’Œæ™®é€šå¼‚å¸¸æ˜¯æ— æ³•åŒºåˆ†çš„ã€‚ </li></ul><br><p> è§£å†³æ–¹æ¡ˆæ˜¯å°†<code>Callable.call</code>æ–¹æ³•åŒ…è£…åœ¨æ²¡æœ‰<code>throws</code>èŠ‚çš„æ–¹æ³•ä¸­ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;V&gt; <span class="hljs-function"><span class="hljs-function">V </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callUnchecked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Callable&lt;V&gt; callable)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callable.call(); }</code> </pre> <br><p> ç”±äº<code>Callable.call</code>æ–¹æ³•åœ¨<code>throws</code>éƒ¨åˆ†ä¸­å£°æ˜äº†<code>Callable.call</code>æ£€æŸ¥çš„å¼‚å¸¸ï¼Œå› æ­¤æ— æ³•ç¼–è¯‘æ­¤ä»£ç ã€‚ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠ¨æ€æ„é€ çš„lambdaè¡¨è¾¾å¼åˆ é™¤æ­¤éƒ¨åˆ†ã€‚ </p><br><p> é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä¸€ä¸ªæ²¡æœ‰<code>throws</code>éƒ¨åˆ†çš„åŠŸèƒ½æ¥å£ã€‚ <br> ä½†è°å¯ä»¥å°†å‘¼å«å§”æ‰˜ç»™<code>Callable.call</code> ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@FunctionalInterface</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SilentInvoker</span></span></span><span class="hljs-class"> </span></span>{ MethodType SIGNATURE = MethodType.methodType(Object.class, Callable.class);<span class="hljs-comment"><span class="hljs-comment">//  INVOKE &lt;V&gt; V invoke(final Callable&lt;V&gt; callable); }</span></span></code> </pre> <br><p> ç¬¬äºŒæ­¥æ˜¯ä½¿ç”¨<code>LambdaMetafactory</code>åˆ›å»ºæ­¤æ¥å£çš„å®ç°ï¼Œå¹¶å°†<code>SilentInvoker.invoke</code>æ–¹æ³•çš„<code>Callable.call</code>å§”æ´¾ç»™<code>Callable.call</code>æ–¹æ³•ã€‚ å¦‚å‰æ‰€è¿°ï¼Œ <code>throws</code>éƒ¨åˆ†åœ¨å­—èŠ‚ç çº§åˆ«è¢«å¿½ç•¥ï¼Œå› æ­¤<code>SilentInvoker.invoke</code>æ–¹æ³•å¯ä»¥åœ¨ä¸å£°æ˜å¼‚å¸¸çš„æƒ…å†µä¸‹è°ƒç”¨<code>Callable.call</code>æ–¹æ³•ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SilentInvoker SILENT_INVOKER; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MethodHandles.Lookup lookup = MethodHandles.lookup(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CallSite site = LambdaMetafactory.metafactory(lookup, <span class="hljs-string"><span class="hljs-string">"invoke"</span></span>, MethodType.methodType(SilentInvoker.class), SilentInvoker.SIGNATURE, lookup.findVirtual(Callable.class, <span class="hljs-string"><span class="hljs-string">"call"</span></span>, MethodType.methodType(Object.class)), SilentInvoker.SIGNATURE); SILENT_INVOKER = (SilentInvoker) site.getTarget().invokeExact();</code> </pre> <br><p> ç¬¬ä¸‰ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªè¾…åŠ©æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è°ƒç”¨<code>Callable.call</code>è€Œä¸å£°æ˜å¼‚å¸¸ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;V&gt; <span class="hljs-function"><span class="hljs-function">V </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callUnchecked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Callable&lt;V&gt; callable)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/*no throws*/</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SILENT_INVOKER.invoke(callable); }</code> </pre> <br><p> ç°åœ¨ï¼Œæ‚¨å¯ä»¥é‡å†™æµï¼Œè€Œæ£€æŸ¥å¼‚å¸¸ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼š </p><br><pre> <code class="java hljs">Arrays.asList(<span class="hljs-string"><span class="hljs-string">"http://localhost/"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://dzone.com"</span></span>).stream() .map(url -&gt; callUnchecked(() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(url))) .collect(Collectors.toList());</code> </pre> <br><p> æ­¤ä»£ç ç¼–è¯‘æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸º<code>callUnchecked</code>ä¸ä¼šå£°æ˜å·²æ£€æŸ¥çš„å¼‚å¸¸ã€‚ æ­¤å¤–ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å•æ€å†…è”ç¼“å­˜</a>æ¥å†…è”è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå› ä¸ºåœ¨æ•´ä¸ªJVMä¸­ï¼Œåªæœ‰ä¸€ä¸ªç±»å®ç°äº†<code>SilentOnvoker</code>æ¥å£ </p><br><p> å¦‚æœ<code>Callable.call</code>çš„å®ç°åœ¨è¿è¡Œæ—¶å¼•å‘å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨å‡½æ•°å°†<code>Callable.call</code>è¯¥å¼‚å¸¸ï¼Œè€Œä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ callUnchecked(() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(<span class="hljs-string"><span class="hljs-string">"Invalid URL"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Exception e){ System.out.println(e); }</code> </pre> <br><p> å°½ç®¡å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œä½†æ‚¨åº”å§‹ç»ˆè®°ä½ä»¥ä¸‹å»ºè®®ï¼š </p><br><hr><br><p>  <strong>ä»…å½“æ‚¨ç¡®å®šè¢«è°ƒç”¨çš„ä»£ç ä¸ä¼šå¼•å‘ä»»ä½•å¼‚å¸¸æ—¶ï¼Œæ‰ä½¿ç”¨callUncheckedéšè—æ£€æŸ¥çš„å¼‚å¸¸</strong> </p><br><hr><br><p> ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æ­¤æ–¹æ³•çš„ç¤ºä¾‹ï¼š </p><br><pre> <code class="java hljs">callUnchecked(() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(<span class="hljs-string"><span class="hljs-string">"https://dzone.com"</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// URL        MalformedURLException</span></span></code> </pre> <br><p> æ­¤æ–¹æ³•çš„å®Œæ•´å®ç°åœ¨<a href="">è¿™é‡Œ</a> ï¼Œå®ƒæ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SNAMP</a>å¼€æº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¡¹ç›®çš„ä¸€éƒ¨åˆ†</a> ã€‚ </p><br><h3 id="rabotaem-s-getters-i-setters"> ä¸Getterå’ŒSetteråˆä½œ </h3><br><p> å¯¹äºç¼–å†™å„ç§æ•°æ®æ ¼å¼ï¼ˆä¾‹å¦‚JSONï¼ŒThriftç­‰ï¼‰çš„åºåˆ—åŒ–/ååºåˆ—åŒ–çš„äººå‘˜ï¼Œæœ¬èŠ‚å°†éå¸¸æœ‰ç”¨ã€‚ è€Œä¸”ï¼Œå¦‚æœæ‚¨çš„ä»£ç ä¸¥é‡ä¾èµ–JavaBeansä¸­çš„Getterå’ŒSetterçš„åå°„ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¼šéå¸¸æœ‰ç”¨ã€‚ </p><br><p> åœ¨JavaBeanä¸­å£°æ˜çš„getteræ˜¯ä¸€ä¸ªåä¸º<code>getXXX</code>çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œå¹¶ä¸”è¿”å›çš„æ•°æ®ç±»å‹ä¸æ˜¯<code>void</code> ã€‚ åœ¨JavaBeanä¸­å£°æ˜çš„setteræ˜¯ä¸€ä¸ªåä¸º<code>setXXX</code>çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…·æœ‰ä¸€ä¸ªå‚æ•°å¹¶è¿”å›<code>void</code> ã€‚ è¿™ä¸¤ä¸ªç¬¦å·å¯ä»¥è¡¨ç¤ºä¸ºåŠŸèƒ½æ¥å£ï¼š </p><br><ul><li>  Getterå¯ä»¥ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Function</a>ç±»è¡¨ç¤ºï¼Œå…¶ä¸­å‚æ•°æ˜¯<code>this</code>çš„å€¼ã€‚ </li><li>  Setterå¯ä»¥ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">BiConsumer</a>ç±»è¡¨ç¤ºï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>this</code> ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¼ é€’ç»™Setterçš„å€¼ã€‚ </li></ul><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªå¯ä»¥å°†ä»»ä½•getteræˆ–setterè½¬æ¢ä¸ºè¿™äº›æ–¹æ³•çš„æ–¹æ³• <br> åŠŸèƒ½æ¥å£ã€‚ ä¸¤ä¸ªæ¥å£éƒ½æ˜¯é€šç”¨çš„ä¹Ÿæ²¡å…³ç³»ã€‚ åˆ é™¤ç±»å‹å <br> çœŸæ­£çš„æ•°æ®ç±»å‹å°†æ˜¯<code>Object</code> ã€‚ ä½¿ç”¨<code>LambdaMetafactory</code>å¯ä»¥è‡ªåŠ¨è½¬æ¢è¿”å›ç±»å‹å’Œå‚æ•°ã€‚ å¦å¤–ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Guavaåº“</a>å°†å¸®åŠ©ä¸ºç›¸åŒçš„getterå’Œsetterç¼“å­˜lambdaè¡¨è¾¾å¼ã€‚ </p><br><p> ç¬¬ä¸€æ­¥ï¼šä¸ºgetterå’Œsetteråˆ›å»ºä¸€ä¸ªç¼“å­˜ã€‚  Reflection APIçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Method</a>ç±»ä»£è¡¨ä¸€ä¸ªçœŸå®çš„getteræˆ–setterï¼Œå¹¶ç”¨ä½œé”®ã€‚ <br> ç¼“å­˜å€¼æ˜¯ç”¨äºç‰¹å®šgetteræˆ–setterçš„åŠ¨æ€æ„é€ çš„åŠŸèƒ½æ¥å£ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache&lt;Method, Function&gt; GETTERS = CacheBuilder.newBuilder().weakValues().build(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache&lt;Method, BiConsumer&gt; SETTERS = CacheBuilder.newBuilder().weakValues().build();</code> </pre> <br><p> å…¶æ¬¡ï¼Œæˆ‘ä»¬å°†åˆ›å»ºå·¥å‚æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åŸºäºå¯¹getteræˆ–setterçš„å¼•ç”¨æ¥åˆ›å»ºåŠŸèƒ½æ¥å£çš„å®ä¾‹ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createGetter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> MethodHandles.Lookup lookup, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> MethodHandle getter)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CallSite site = LambdaMetafactory.metafactory(lookup, <span class="hljs-string"><span class="hljs-string">"apply"</span></span>, MethodType.methodType(Function.class), MethodType.methodType(Object.class, Object.class), <span class="hljs-comment"><span class="hljs-comment">//signature of method Function.apply after type erasure getter, getter.type()); //actual signature of getter try { return (Function) site.getTarget().invokeExact(); } catch (final Exception e) { throw e; } catch (final Throwable e) { throw new Error(e); } } private static BiConsumer createSetter(final MethodHandles.Lookup lookup, final MethodHandle setter) throws Exception { final CallSite site = LambdaMetafactory.metafactory(lookup, "accept", MethodType.methodType(BiConsumer.class), MethodType.methodType(void.class, Object.class, Object.class), //signature of method BiConsumer.accept after type erasure setter, setter.type()); //actual signature of setter try { return (BiConsumer) site.getTarget().invokeExact(); } catch (final Exception e) { throw e; } catch (final Throwable e) { throw new Error(e); } }</span></span></code> </pre> <br><p> ä½¿ç”¨<code>samMethodType</code>å’ŒInstantiatedMethodTypeï¼ˆåˆ†åˆ«æ˜¯metafactoryæ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå’Œç¬¬äº”ä¸ªå‚æ•°ï¼‰ä¹‹é—´çš„å·®å¼‚ï¼Œå¯ä»¥å®ç°åŠŸèƒ½æ¥å£ä¸­çš„<code>Object</code>ç±»å‹çš„å‚æ•°ï¼ˆåœ¨ç±»å‹æ“¦é™¤ä¹‹åï¼‰ï¼Œå®<code>samMethodType</code>ç±»å‹å’Œè¿”å›å€¼ä¹‹é—´çš„è‡ªåŠ¨ç±»å‹è½¬æ¢ã€‚ åˆ›å»ºçš„æ–¹æ³•å®ä¾‹çš„ç±»å‹-è¿™æ˜¯æä¾›lambdaè¡¨è¾¾å¼å®ç°çš„æ–¹æ³•çš„ç‰¹æ®ŠåŒ–ã€‚ </p><br><p> ç¬¬ä¸‰ï¼Œæˆ‘ä»¬å°†ä¸ºè¿™äº›å·¥å‚åˆ›å»ºå¤–è§‚ï¼Œå¹¶æ”¯æŒç¼“å­˜ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reflectGetter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> MethodHandles.Lookup lookup, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Method getter)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ReflectiveOperationException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GETTERS.get(getter, () -&gt; createGetter(lookup, lookup.unreflect(getter))); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ExecutionException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReflectiveOperationException(e.getCause()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BiConsumer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reflectSetter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> MethodHandles.Lookup lookup, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Method setter)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ReflectiveOperationException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SETTERS.get(setter, () -&gt; createSetter(lookup, lookup.unreflect(setter))); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ExecutionException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReflectiveOperationException(e.getCause()); } }</code> </pre> <br><p> ä½¿ç”¨Java Reflection APIä»<code>Method</code>ç±»çš„å®ä¾‹è·å–çš„æ–¹æ³•ä¿¡æ¯å¯ä»¥è½»æ¾è½¬æ¢ä¸º<code>MethodHandle</code> ã€‚ è¯·è®°ä½ï¼Œç±»å®ä¾‹æ–¹æ³•å§‹ç»ˆå…·æœ‰ç”¨äºå°†å…¶ä¼ é€’ç»™æ­¤æ–¹æ³•çš„éšè—çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ é™æ€æ–¹æ³•æ²¡æœ‰è¿™æ ·çš„å‚æ•°ã€‚ ä¾‹å¦‚ï¼Œ <code>Integer.intValue()</code>æ–¹æ³•çš„å®é™…ç­¾åçœ‹èµ·æ¥åƒ<code>int intValue(Integer this)</code> ã€‚ æ­¤æŠ€å·§ç”¨äºæˆ‘ä»¬çš„ç”¨äºgetterå’Œsetterçš„åŠŸèƒ½åŒ…è£…å™¨çš„å®ç°ä¸­ã€‚ </p><br><p> ç°åœ¨æ˜¯æ—¶å€™æµ‹è¯•ä»£ç äº†ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Date d = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> BiConsumer&lt;Date, Long&gt; timeSetter = reflectSetter(MethodHandles.lookup(), Date.class.getDeclaredMethod(<span class="hljs-string"><span class="hljs-string">"setTime"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.class)); timeSetter.accept(d, <span class="hljs-number"><span class="hljs-number">42L</span></span>); <span class="hljs-comment"><span class="hljs-comment">//the same as d.setTime(42L); final Function&lt;Date, Long&gt; timeGetter = reflectGetter(MethodHandles.lookup(), Date.class.getDeclaredMethod("getTime")); System.out.println(timeGetter.apply(d)); //the same as d.getTime() //output is 42</span></span></code> </pre> <br><p> è¿™ç§å…·æœ‰ç¼“å­˜çš„getterå’Œsetterçš„æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°ç”¨äºåœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨getterå’Œsetterçš„åºåˆ—åŒ–/ååºåˆ—åŒ–åº“ï¼ˆä¾‹å¦‚Jacksonï¼‰ã€‚ </p><br><hr><br><p>  <strong>ä½¿ç”¨<code>LambdaMetaFactory</code>è°ƒç”¨å…·æœ‰åŠ¨æ€ç”Ÿæˆçš„å®ç°çš„åŠŸèƒ½æ¥å£æ¯”é€šè¿‡Java Reflection APIè°ƒç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¦å¿«å¾—å¤š</a></strong> </p><br><hr><br><p> å®Œæ•´ä»£ç ç‰ˆæœ¬å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SNAMP</a>åº“ä¸­æ‰¾åˆ°ã€‚ </p><br><h2 id="ogranicheniya-i-bagi"> å±€é™æ€§å’Œé”™è¯¯ </h2><br><p> åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ä¸Javaç¼–è¯‘å™¨å’ŒJVMä¸­çš„lambdaè¡¨è¾¾å¼ç›¸å…³çš„ä¸€äº›é”™è¯¯å’Œé™åˆ¶ã€‚ æ‰€æœ‰è¿™äº›é™åˆ¶éƒ½å¯ä»¥åœ¨é€‚ç”¨äºWindowså’ŒLinuxçš„<code>javac</code> 1.8.0_131ç‰ˆçš„OpenJDKå’ŒOracle JDKä¸­é‡ç°ã€‚ </p><br><h3 id="sozdanie-lyambda-vyrazheniy-iz-obrabotchikov-metodov"> ä»æ–¹æ³•å¤„ç†ç¨‹åºåˆ›å»ºlambdaè¡¨è¾¾å¼ </h3><br><p> å¦‚æ‚¨æ‰€çŸ¥ï¼Œå¯ä»¥ä½¿ç”¨<code>LambdaMetaFactory</code>åŠ¨æ€æ„é€ lambdaè¡¨è¾¾å¼ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦å®šä¹‰ä¸€ä¸ªå¤„ç†ç¨‹åº<code>MethodHandle</code>ç±»ï¼Œè¯¥ç±»æŒ‡ç¤ºåœ¨åŠŸèƒ½æ¥å£ä¸­å®šä¹‰çš„å”¯ä¸€æ–¹æ³•çš„å®ç°ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestClass</span></span></span><span class="hljs-class"> </span></span>{ String value = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TestClass obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestClass(); obj.setValue(<span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MethodHandles.Lookup lookup = MethodHandles.lookup(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CallSite site = LambdaMetafactory.metafactory(lookup, <span class="hljs-string"><span class="hljs-string">"get"</span></span>, MethodType.methodType(Supplier.class, TestClass.class), MethodType.methodType(Object.class), lookup.findVirtual(TestClass.class, <span class="hljs-string"><span class="hljs-string">"getValue"</span></span>, MethodType.methodType(String.class)), MethodType.methodType(String.class)); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Supplier&lt;String&gt; getter = (Supplier&lt;String&gt;) site.getTarget().invokeExact(obj); System.out.println(getter.get());</code> </pre> <br><p> æ­¤ä»£ç ç­‰æ•ˆäºï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TestClass obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestClass(); obj.setValue(<span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Supplier&lt;String&gt; elementGetter = () -&gt; obj.getValue(); System.out.println(elementGetter.get());</code> </pre> <br><p> ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç”¨getterå­—æ®µè¡¨ç¤ºçš„å¤„ç†ç¨‹åºæ›¿æ¢æŒ‡å‘<code>getValue</code>çš„æ–¹æ³•å¤„ç†ç¨‹åºï¼Œè¯¥æ€ä¹ˆåŠï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CallSite site = LambdaMetafactory.metafactory(lookup, <span class="hljs-string"><span class="hljs-string">"get"</span></span>, MethodType.methodType(Supplier.class, TestClass.class), MethodType.methodType(Object.class), lookup.findGetter(TestClass.class, <span class="hljs-string"><span class="hljs-string">"value"</span></span>, String.class), <span class="hljs-comment"><span class="hljs-comment">//field getter instead of method handle to getValue MethodType.methodType(String.class));</span></span></code> </pre> <br><p> è¯¥ä»£ç åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œå› ä¸º<code>findGetter</code>è¿”å›ä¸€ä¸ªæŒ‡å‘getterå­—æ®µå¹¶å…·æœ‰æ­£ç¡®ç­¾åçš„å¤„ç†ç¨‹åºã€‚ ä½†æ˜¯ï¼Œå¦‚æœè¿è¡Œæ­¤ä»£ç ï¼Œåˆ™ä¼šçœ‹åˆ°ä»¥ä¸‹å¼‚å¸¸ï¼š </p><br><pre> <code class="plaintext hljs">java.lang.invoke.LambdaConversionException: Unsupported MethodHandle kind: getField</code> </pre> <br><p> æœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MethodHandleProxies</a> ï¼Œåˆ™è¯¥å­—æ®µçš„getterå¯ä»¥æ­£å¸¸å·¥ä½œï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Supplier&lt;String&gt; getter = MethodHandleProxies .asInterfaceInstance(Supplier.class, lookup.findGetter(TestClass.class, <span class="hljs-string"><span class="hljs-string">"value"</span></span>, String.class) .bindTo(obj));</code> </pre> <br><p> åº”å½“æ³¨æ„ï¼Œ <code>MethodHandleProxies</code>ä¸æ˜¯åŠ¨æ€åˆ›å»ºlambdaè¡¨è¾¾å¼çš„å¥½æ–¹æ³•ï¼Œå› ä¸ºæ­¤ç±»ä»…å°†<code>MethodHandle</code>åŒ…è£…åœ¨ä»£ç†ç±»ä¸­å¹¶å°†invocationHandler.invokeå§”æ‰˜ç»™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MethodHandle.invokeWithArguments</a> ã€‚ è¿™ç§æ–¹æ³•ä½¿ç”¨Javaåå°„å¹¶ä¸”éå¸¸æ…¢ã€‚ </p><br><p> å¦‚å‰æ‰€è¿°ï¼Œå¹¶éæ‰€æœ‰æ–¹æ³•å¤„ç†ç¨‹åºéƒ½å¯ç”¨äºåœ¨è¿è¡Œæ—¶åˆ›å»ºlambdaè¡¨è¾¾å¼ã€‚ </p><br><hr><br><p>  <strong>ä»…å‡ ç§ç±»å‹çš„æ–¹æ³•å¤„ç†ç¨‹åºå¯ç”¨äºåŠ¨æ€åˆ›å»ºlambdaè¡¨è¾¾å¼ã€‚</strong> </p><br><hr><br><p> å®ƒä»¬æ˜¯ï¼š </p><br><ul><li>  REF_invokeInterfaceï¼šå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lookup.findVirtual</a>åˆ›å»ºæ¥å£æ–¹æ³• </li><li>  REF_invokeVirtualï¼šå¯ä»¥ä½¿ç”¨Lookup.findVirtualä¸ºç±»è™šæ‹Ÿæ–¹æ³•åˆ›å»º </li><li>  REF_invokeStaticï¼šä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lookup.findStatic</a>ä¸ºé™æ€æ–¹æ³•åˆ›å»º </li><li>  REF_newInvokeSpecialï¼šå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lookup.findConstructor</a>ä¸ºæ„é€ å‡½æ•°åˆ›å»º </li><li>  REF_invokeSpecialï¼šå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lookup.findSpecial</a>åˆ›å»º <br> ç”¨äºç§æœ‰æ–¹æ³•å¹¶ä¸ç±»è™šæ‹Ÿæ–¹æ³•è¿›è¡Œæ—©æœŸç»‘å®š </li></ul><br><p> å…¶ä»–ç±»å‹çš„å¤„ç†ç¨‹åºå°†<code>LambdaConversionException</code>é”™è¯¯ã€‚ </p><br><h3 id="generic-isklyucheniya"> é€šç”¨å¼‚å¸¸ </h3><br><p> æ­¤é”™è¯¯ä¸Javaç¼–è¯‘å™¨ä»¥åŠåœ¨<code>throws</code>éƒ¨åˆ†ä¸­å¼•å‘é€šç”¨å¼‚å¸¸çš„èƒ½åŠ›æœ‰å…³ã€‚ ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¼”ç¤ºäº†æ­¤è¡Œä¸ºï¼š </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendedCallable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Exception</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Callable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-function">V </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> E</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ExtendedCallable&lt;URL, MalformedURLException&gt; urlFactory = () -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(<span class="hljs-string"><span class="hljs-string">"http://localhost"</span></span>); urlFactory.call();</code> </pre> <br><p> æ­¤ä»£ç å¿…é¡»ç¼–è¯‘ï¼Œå› ä¸º<code>URL</code>ç±»çš„æ„é€ å‡½æ•°ä¼šæŠ›å‡º<code>MalformedURLException</code> ã€‚ ä½†æ˜¯å®ƒä¸èƒ½ç¼–è¯‘ã€‚ æ˜¾ç¤ºä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š </p><br><pre> <code class="plaintext hljs">Error:(46, 73) java: call() in &lt;anonymous Test$CODEgt; cannot implement call() in ExtendedCallable overridden method does not throw java.lang.Exception</code> </pre> <br><p> ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç”¨åŒ¿åç±»æ›¿æ¢lambdaè¡¨è¾¾å¼ï¼Œåˆ™ä»£ç å°†ç¼–è¯‘ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ExtendedCallable&lt;URL, MalformedURLException&gt; urlFactory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ExtendedCallable&lt;URL, MalformedURLException&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> URL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(<span class="hljs-string"><span class="hljs-string">"http://localhost"</span></span>); } }; urlFactory.call();</code> </pre> <br><p> ç”±æ­¤å¾—å‡ºï¼š </p><br><hr><br><p>  <strong>ä¸lambdaè¡¨è¾¾å¼ç»“åˆä½¿ç”¨æ—¶ï¼Œæ³›å‹å¼‚å¸¸çš„ç±»å‹æ¨æ–­æ— æ³•æ­£å¸¸å·¥ä½œ</strong> </p><br><hr><br><h3 id="ogranicheniya-tipov-parametrizacii"> å‚æ•°åŒ–ç±»å‹é™åˆ¶ </h3><br><p> æ‚¨å¯ä»¥ä½¿ç”¨<code>&amp;</code>æ„é€ å…·æœ‰å‡ ä¸ªç±»å‹é™åˆ¶çš„é€šç”¨å¯¹è±¡ï¼š <code>&lt;T extends A &amp; B &amp; C &amp; ... Z&gt;</code>ç¬¦å·ã€‚ <br> è¿™ç§ç¡®å®šé€šç”¨å‚æ•°çš„æ–¹æ³•å¾ˆå°‘ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºæŸäº›é™åˆ¶ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šä¼šå½±å“Javaä¸­çš„lambdaè¡¨è¾¾å¼ï¼š </p><br><ul><li> é™¤ç¬¬ä¸€ä¸ªçº¦æŸå¤–ï¼Œæ¯ä¸ªç±»å‹çº¦æŸéƒ½å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å£ã€‚ </li><li> å…·æœ‰æ­¤ç±»æ³›å‹çš„ç±»çš„çº¯ç‰ˆæœ¬ä»…è€ƒè™‘åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªç±»å‹çº¦æŸã€‚ </li></ul><br><p> ç¬¬äºŒä¸ªå±€é™æ€§æ˜¯åœ¨å‘ç”Ÿç»‘å®šåˆ°lambdaè¡¨è¾¾å¼æ—¶ï¼Œå¯¼è‡´ä»£ç åœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶çš„è¡Œä¸ºä¸åŒã€‚ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç è¯æ˜è¿™ç§å·®å¼‚ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MutableInteger</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Number</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntSupplier</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntConsumer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//mutable container of int value private int value; public MutableInteger(final int v) { value = v; } @Override public int intValue() { return value; } @Override public long longValue() { return value; } @Override public float floatValue() { return value; } @Override public double doubleValue() { return value; } @Override public int getAsInt() { return intValue(); } @Override public void accept(final int value) { this.value = value; } } static &lt;T extends Number &amp; IntSupplier&gt; OptionalInt findMinValue(final Collection &lt;T&gt; values) { return values.stream().mapToInt(IntSupplier::getAsInt).min(); } final List &lt;MutableInteger&gt; values = Arrays.asList(new MutableInteger(10), new MutableInteger(20)); final int mv = findMinValue(values).orElse(Integer.MIN_VALUE); System.out.println(mv);</span></span></code> </pre> <br><p> è¯¥ä»£ç æ˜¯ç»å¯¹æ­£ç¡®çš„ï¼Œå¹¶ä¸”å¯ä»¥æˆåŠŸç¼–è¯‘ã€‚  <code>MutableInteger</code>ç±»æ»¡è¶³é€šç”¨ç±»å‹Tçš„çº¦æŸï¼š </p><br><ul><li>  <code>MutableInteger</code>ç»§æ‰¿è‡ª<code>Number</code> ã€‚ </li><li>  <code>MutableInteger</code>å®ç°<code>IntSupplier</code> ã€‚ </li></ul><br><p> ä½†æ˜¯ä»£ç ä¼šåœ¨è¿è¡Œæ—¶å´©æºƒï¼Œå¹¶å¸¦æœ‰å¼‚å¸¸ï¼š </p><br><pre> <code class="java hljs">java.lang.BootstrapMethodError: call site initialization exception at java.lang.invoke.CallSite.makeSite(CallSite.java:<span class="hljs-number"><span class="hljs-number">341</span></span>) at java.lang.invoke.MethodHandleNatives.linkCallSiteImpl(MethodHandleNatives.java:<span class="hljs-number"><span class="hljs-number">307</span></span>) at java.lang.invoke.MethodHandleNatives.linkCallSite(MethodHandleNatives.java:<span class="hljs-number"><span class="hljs-number">297</span></span>) at Test.minValue(Test.java:<span class="hljs-number"><span class="hljs-number">77</span></span>) Caused by: java.lang.invoke.LambdaConversionException: Invalid receiver type <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Number</span></span></span></span>; not a subtype of implementation type <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">util</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntSupplier</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">at</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoke</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractValidatingLambdaMetafactory</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">validateMetafactoryArgs</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractValidatingLambdaMetafactory</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">:233) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">at</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoke</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LambdaMetafactory</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">metafactory</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LambdaMetafactory</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">:303) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">at</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoke</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CallSite</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">makeSite</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CallSite</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">:302)</span></span></code> </pre> <br><p> å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºJavaStreamç®¡é“ä»…æ•è·ä¸€ä¸ªçº¯ç±»å‹ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒæ˜¯<code>Number</code>ç±»ï¼Œå¹¶ä¸”æ²¡æœ‰å®ç°<code>IntSupplier</code>æ¥å£ã€‚ å¯ä»¥é€šè¿‡åœ¨å•ç‹¬çš„æ–¹æ³•ä¸­æ˜¾å¼å£°æ˜å‚æ•°ç±»å‹æ¥è§£å†³æ­¤é—®é¢˜ï¼Œè¯¥æ–¹æ³•ç”¨ä½œå¯¹è¯¥æ–¹æ³•çš„å¼•ç”¨ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IntSupplier i)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i.getAsInt(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T extends Number &amp; IntSupplier&gt; <span class="hljs-function"><span class="hljs-function">OptionalInt </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findMinValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Collection&lt;T&gt; values)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> values.stream().mapToInt(UtilsTest::getInt).min(); }</code> </pre> <br><p> æœ¬ç¤ºä¾‹è¯´æ˜äº†åœ¨ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ä¸­é”™è¯¯çš„ç±»å‹æ¨æ–­ã€‚ </p><br><hr><br><p>  <strong>åœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ç»“åˆä½¿ç”¨lambdaè¡¨è¾¾å¼æ¥å¤„ç†å¤šä¸ªé€šç”¨å‚æ•°ç±»å‹é™åˆ¶æ˜¯ä¸ä¸€è‡´çš„</strong> </p><br><hr></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN432418/">https://habr.com/ru/post/zh-CN432418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN432408/index.html">é‡‘èç§‘æŠ€æ‘˜è¦ï¼šå‡†å¤‡å°†å°å‹é“¶è¡Œä¸Visaå’ŒMastercardï¼ˆå…»è€é‡‘è®¡ç®—å™¨ï¼‰æ–­å¼€è¿æ¥</a></li>
<li><a href="../zh-CN432410/index.html">å…·æœ‰Entity Framework Coreçš„DDDæ ·å¼çš„å®ä½“</a></li>
<li><a href="../zh-CN432412/index.html">é«˜è´Ÿè½½++ï¼šå¦‚ä½•å¸®åŠ©ERPç³»ç»Ÿæ¯ç§’å¤„ç†500,000ä¸ªè¯·æ±‚</a></li>
<li><a href="../zh-CN432414/index.html">å¿«é€Ÿè°ƒè¯•çš„è€ç§˜è¯€ï¼šåŠ¨ç”»æºä»£ç </a></li>
<li><a href="../zh-CN432416/index.html">ä¾èµ–ç±»å‹-ç¼–ç¨‹è¯­è¨€çš„æœªæ¥</a></li>
<li><a href="../zh-CN432420/index.html">Git Mergeå’ŒGit Rebaseç®€ä»‹ï¼šä¸ºä»€ä¹ˆä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒä»¬</a></li>
<li><a href="../zh-CN432422/index.html">iOSä¸Šçš„ç¦»çº¿æ¨¡å¼åŠå…¶åœ¨Realmä¸Šçš„å®ç°åŠŸèƒ½</a></li>
<li><a href="../zh-CN432424/index.html">HyperFlexè®¤è¯çš„SAP HANAåŸºç¡€æ¶æ„</a></li>
<li><a href="../zh-CN432426/index.html">è°ƒè¯•æ— æ³•æ’­æ”¾çš„é”™è¯¯</a></li>
<li><a href="../zh-CN432428/index.html">é›†ä¸­å¼æ€»çº¿ä¸Service Meshï¼šå¦‚ä½•å°†mitapå˜æˆæˆ˜æ–—</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>