<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜó ‚õ≥Ô∏è üèÇüèº Como tornar o pagamento mais conveniente: a experi√™ncia de um provedor de IaaS ‚öõÔ∏è üë∏üèº üè∑Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uma das quest√µes importantes ao trabalhar com os servi√ßos de um provedor de IaaS √© a conveni√™ncia do pagamento. Desde o primeiro dia do in√≠cio do noss...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como tornar o pagamento mais conveniente: a experi√™ncia de um provedor de IaaS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/1cloud/blog/433948/">  Uma das quest√µes importantes ao trabalhar com os servi√ßos de um provedor de IaaS √© a conveni√™ncia do pagamento.  Desde o primeiro dia do in√≠cio do nosso projeto, tentamos simplificar o processo de efetuar pagamentos usando cart√µes banc√°rios e continuamos a melhorar esse mecanismo.  Hoje decidimos conversar sobre onde come√ßamos e compartilhar nossa experi√™ncia. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/iy/6k/pv/iy6kpvrzewuk4mudc9nkfwiadu8.jpeg"></a> <a name="habracut"></a><br>  <font color="#A9A9A9"><i>/ Flickr / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Muhammad Ashiq</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CC BY-SA</a></i></font> <br><br><h2>  Antecedentes </h2><br>  Fornecemos servi√ßos de IaaS na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1cloud</a> desde 2012.  Durante esse per√≠odo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conseguimos trabalhar</a> com um grande n√∫mero de gateways de pagamento.  Um dos primeiros foi o Money Online.  Trabalhamos com ele por dois anos e, em seguida, come√ßamos a conectar servi√ßos alternativos em caso de poss√≠veis dificuldades t√©cnicas. <br><br>  Como alternativa, o PayPal e o Robocassa foram considerados.  Como resultado, as duas plataformas foram conectadas, embora <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">houvesse algumas dificuldades</a> com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isso</a> .  No primeiro caso, para importar o ID do cliente para a forma de pagamento, tivemos que ajustar as regras de CSS e modificar os elementos padr√£o na p√°gina da web.  Na situa√ß√£o com Robocassa, v√°rias solicita√ß√µes na API n√£o correspondiam √† sua descri√ß√£o, mas com a ajuda do suporte t√©cnico, a situa√ß√£o tamb√©m foi resolvida.  N√£o paramos com essas decis√µes e consideramos outras op√ß√µes que os poss√≠veis parceiros nos ofereceram. <br><br>  Ent√£o, come√ßamos a trabalhar com o sistema de pagamento PayMaster (que substituiu "Money Online"), que nos oferecia condi√ß√µes favor√°veis ‚Äã‚Äãde comiss√£o e uma API conveniente.  Durante muito tempo, esse gateway de pagamento atuou como principal.  No entanto, recentemente decidimos redesenhar a usabilidade do nosso servi√ßo e simplificar o processo de pagamento por servi√ßos com cart√£o banc√°rio para pessoas f√≠sicas.  Para que o UX atenda aos nossos requisitos, integramos outro gateway de pagamento - CloudPayments. <br><br><h2>  Como posso melhorar o processo de pagamento UX? </h2><br>  Estamos trabalhando no modelo de pr√©-pagamento.  O cliente reabastece sua conta em sua conta pessoal e, em seguida, os fundos s√£o debitados dessa conta √† medida que os servi√ßos IaaS s√£o consumidos (debitados a cada dez minutos). <br><br>  Para reabastecer o saldo com um cart√£o de cr√©dito, no caso do PayMaster, o cliente teve que passar por um processo de quatro etapas: <br><br><ol><li>  Digite o valor para pagamento no formul√°rio no painel de controle, clique no bot√£o "Pagar" e v√° para a p√°gina do gateway de pagamento. </li><li>  Indique o telefone ou endere√ßo de email para receber a verifica√ß√£o e clique em Continuar. </li><li>  Digite os detalhes do cart√£o e pressione o bot√£o "Pagar" novamente. </li><li>  Indique o c√≥digo de confirma√ß√£o da transa√ß√£o que o banco enviou como parte do procedimento 3D Secure. </li></ol><blockquote>  <i><b>Isen√ß√£o de responsabilidade:</b> o algoritmo descrito acima se aplica aos pagamentos com cart√£o de banco feitos por indiv√≠duos.</i>  <i>As entidades legais pagam pelos servi√ßos do provedor de IaaS nas contas.</i>  <i>Enquanto melhoramos a usabilidade, finalizamos os mecanismos de faturamento autom√°tico dessas faturas, mas n√£o as consideraremos na estrutura deste material, pois as entidades legais n√£o interagem com um gateway de pagamento.</i> </blockquote><br>  Decidimos simplificar o processo de pagamento para os usu√°rios e, geralmente, melhorar a apar√™ncia e a usabilidade dos formul√°rios para preencher os dados do cart√£o banc√°rio.  Para isso, identificamos duas tarefas para n√≥s mesmos, as quais discutiremos abaixo. <br><br><h5>  Tarefa 1: excluir a passagem para a p√°gina do gateway de pagamento </h5><br>  Como observamos acima, quando um usu√°rio paga por nossos servi√ßos, a fim de preencher os detalhes do cart√£o, ele √© for√ßado a ir ao site do gateway de pagamento.  Portanto, uma pessoa precisou pressionar muitos bot√µes de confirma√ß√£o e aguardar o carregamento de p√°ginas com informa√ß√µes sobre o reabastecimento da conta. <br><br>  Nesse caso, surgiu outro problema - ap√≥s o usu√°rio depositar dinheiro na conta, ele permaneceu na p√°gina do gateway de pagamento at√© clicar em um link especial para retornar ao 1cloud.ru.  Isso dificultou o trabalho com nosso painel de controle, por exemplo, se, ap√≥s o pagamento, o usu√°rio quisesse adicionar capacidade √† sua infraestrutura de TI. <br><br><blockquote>  <i>"Segundo a an√°lise, apenas alguns clientes seguiram o link e retornaram ao nosso site", disse <b>Sergey Belkin</b> , chefe de desenvolvimento do 1cloud.ru.</i>  <i>- Isso ocorreu em parte pelo fato de o cliente ter que clicar no link "Voltar √† loja online".</i>  <i>Isso apesar do fato de nosso servi√ßo n√£o ser uma loja on-line. ‚Äù</i> </blockquote><br>  Al√©m disso, quer√≠amos reduzir ao m√≠nimo o n√∫mero de campos preenchidos pelo usu√°rio, deixando apenas os realmente necess√°rios para a opera√ß√£o.  Para realizar essa tarefa, escolhemos o gateway de pagamento do CloudPayments, cujos funcion√°rios inicialmente atra√≠ram nossa aten√ß√£o com respostas r√°pidas e completas do suporte t√©cnico. <br><br>  Al√©m disso, esse gateway de pagamento tinha um escrit√≥rio de representa√ß√£o no Cazaquist√£o.  Isso possibilitou a implementa√ß√£o de um novo m√©todo de pagamento para o servi√ßo de hospedagem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">oblako.kz</a> .  Caso contr√°rio, todas as nossas transfer√™ncias do Cazaquist√£o para a R√∫ssia (ou vice-versa) estar√£o sujeitas a uma comiss√£o adicional. <br><br>  CloudPayments sugerido usando um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">script de chekout</a> especial.  Permite implementar o formul√°rio de pagamento diretamente em nosso painel de controle e transferir os dados completos para o gateway de pagamento sem salv√°-los do nosso lado. <br><br>  Para implementar o script, tivemos que passar por uma verifica√ß√£o de seguran√ßa do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PCI DSS</a> em uma das organiza√ß√µes credenciadas - que era o requisito do CloudPayments.  A digitaliza√ß√£o √© necess√°ria para confirmar a conformidade t√©cnica com o padr√£o e excluir a possibilidade de roubo de dados do usu√°rio durante o preenchimento de formul√°rios no site. <br><br>  A auditoria de conformidade do PCI DSS foi realizada pela ARinteg.  Enviamos a eles um aplicativo no qual indicamos o desejo de passar por uma auditoria, preenchemos um question√°rio e definimos uma data para verifica√ß√£o.  No lado do ARinteg, a prepara√ß√£o para a varredura leva cerca de meio dia (ou seja, voc√™ pode varrer quase imediatamente), mas levamos mais quatro a cinco dias para preparar cuidadosamente nossa infraestrutura. <br><br>  A verifica√ß√£o durou cerca de 15 horas, embora isso aconte√ßa v√°rios dias.  Os especialistas da ARinteg verificaram o SSL e a prote√ß√£o contra solicita√ß√µes de inje√ß√£o e outras vulnerabilidades em nosso site. <br><br>  N√£o passamos no teste inicial e recebemos uma lista de problemas que precisavam ser corrigidos.  Todos eles eram insignificantes, por exemplo, havia um p√≥s-m√©todo usado quando o usu√°rio avaliou nossas instru√ß√µes passo a passo no site.  Removemos todos os coment√°rios e a segunda tentativa de auditoria foi bem-sucedida.  Em seguida, poder√≠amos avan√ßar para a implementa√ß√£o do script de chekout. <br><br>  O script √© registrado em nosso site, coleta dados do cart√£o no formul√°rio especificado e comp√µe um criptograma para pagamento atrav√©s da API CloudPayments.  √â assim: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createCryptogram = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = checkout.createCryptogramPacket(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.success) { <span class="hljs-comment"><span class="hljs-comment">//   alert(result.packet); } else { //     ,  `result.messages` : // { name: "      ", cardNumber: "  " } //  `name`, `cardNumber`    `&lt;input ... data-cp="cardNumber"&gt;` for (var msgName in result.messages) { alert(result.messages[msgName]); } } }; $(function () { /*  checkout */ checkout = new cp.Checkout( // public id    "test_api_00000000000000000000001", // ,     document.getElementById("paymentFormSample")); });</span></span></code> </pre> <br>  O formul√°rio para inserir dados do cart√£o banc√°rio √© semelhante a este: <br><br><img src="https://habrastorage.org/webt/yi/vl/yt/yivlyttyhrz8mgmikdhnr9_8mys.png"><br><br>  Durante a implementa√ß√£o do script e do formul√°rio, conseguimos reduzir ao m√≠nimo o n√∫mero de campos preenchidos pelo usu√°rio.  Eles deixaram apenas aqueles que s√£o realmente necess√°rios para a opera√ß√£o.  Por exemplo, os campos "Primeiro nome" e "Sobrenome" foram removidos.  Como os representantes do gateway de pagamento nos explicaram, os bancos n√£o verificam esses dados (apenas o n√∫mero do cart√£o, a data e o CVV s√£o importantes), por isso decidimos omit√≠-los e simplificar todo o processo. <br><br>  Al√©m disso, deixamos mais claras as informa√ß√µes sobre nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">programa de descontos</a> : com uma reposi√ß√£o √∫nica da conta no valor de 5 mil rublos, 10% dela √© creditada na forma de b√¥nus, de 10.000 rublos - 20%, mais de 100.000 rublos - 25%.  Tamb√©m adicionamos a capacidade de salvar dados do mapa para os usu√°rios.  Todas essas informa√ß√µes s√£o armazenadas no lado do gateway de pagamento do CloudPayments em forma criptografada. <br><br><h5>  Tarefa 2: realizar pagamento autom√°tico </h5><br>  Este √© um pagamento que ocorre automaticamente sob alguma condi√ß√£o.  Muitas vezes, esse recurso √© usado pelos servi√ßos de assinatura.  No entanto, a maioria dos gateways de pagamento oferece apenas a op√ß√£o quando o reabastecimento autom√°tico ocorre em uma programa√ß√£o (em uma determinada data).  √â importante para n√≥s que a oportunidade de reabastecer a conta esteja dispon√≠vel automaticamente a qualquer momento quando o cliente ficar sem fundos na conta (j√° que trabalhamos com pr√©-pagamento).  Portanto, para implementar o pagamento autom√°tico, usamos o m√©todo usado ao pagar com um cart√£o "lembrado" (usando um token tempor√°rio). <br><br>  Funciona da seguinte forma: ap√≥s o primeiro pagamento bem-sucedido feito pelo usu√°rio, o gateway gera seu token para o par de cart√£o de servi√ßo e o envia em uma resposta de postagem.  Esse token √© salvo e, mediante pagamento repetido, j√° √© transferido, e n√£o os dados do cart√£o.  Acontece que enviamos uma solicita√ß√£o ao gateway no qual indicamos nossa chave de API (identificador de que a solicita√ß√£o veio do 1cloud), token e quantidade.  O gateway verifica se esse token foi criado e, se tudo estiver em ordem, processa o pagamento pelo valor especificado. <br><br>  A data em que √© necess√°rio efetuar um pagamento autom√°tico, calculamos dinamicamente com base no consumo atual de servi√ßos pelo usu√°rio e no saldo da conta.  Suponha que um cliente tenha mil rublos no balan√ßo e ele tenha consumido dois rublos nos √∫ltimos dez minutos.  √â claro que a data aproximada do zeramento ocorrer√° em quinhentos e dez minutos - isto √© aproximadamente 34 dias.  Assim, podemos efetuar um pagamento autom√°tico alguns dias antes do final dos fundos.  O cliente escolhe o tamanho do pagamento autom√°tico de forma independente. <br><br><h2>  O que vem a seguir </h2><br>  Agora estamos testando essas solu√ß√µes e avaliando os resultados da implementa√ß√£o.  De acordo com uma vota√ß√£o entre os clientes, a maioria √© bastante mut√°vel.  Estudaremos mais profundamente o feedback sobre o sistema, analisaremos os dados e, se necess√°rio, faremos ajustes. <br><br><h5>  PS Materiais frescos do nosso blog corporativo: </h5><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DevOps em um servi√ßo de nuvem usando 1cloud.ru como exemplo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O que voc√™ precisa saber sobre assinatura digital</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Minimiza√ß√£o de riscos: como n√£o perder seus dados</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433948/">https://habr.com/ru/post/pt433948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433936/index.html">Procurando um presente de alta tecnologia para uma crian√ßa? Pense em um playground, n√£o em um cercadinho</a></li>
<li><a href="../pt433938/index.html">Como Yandex e Google resumem o ano</a></li>
<li><a href="../pt433940/index.html">Quanto custa a revis√£o na AppStore</a></li>
<li><a href="../pt433944/index.html">Exce√ß√µes devastadoras</a></li>
<li><a href="../pt433946/index.html">Cheat sheet para intelig√™ncia artificial - jogue fora o excesso, ensine o principal. T√©cnica de processamento da sequ√™ncia de treinamento</a></li>
<li><a href="../pt433952/index.html">10 raz√µes para escolher uma solu√ß√£o para o SAP HANA da HPE. Parte 2</a></li>
<li><a href="../pt433954/index.html">Oito tecnologias de √°udio e dispositivos de √°udio que entrar√£o no Hall da Fama da TECnology em 2019</a></li>
<li><a href="../pt433956/index.html">Os modders usaram a IA para melhorar a textura nos jogos</a></li>
<li><a href="../pt433958/index.html">Aplicativos TDD no Spring Boot: trabalhando com um banco de dados</a></li>
<li><a href="../pt433964/index.html">M√≥dulos ECMAScript no Node.js: um novo plano</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>