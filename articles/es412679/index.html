<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòΩ üë©‚Äçüë©‚Äçüëß‚Äçüëß üìö Creaci√≥n de una aplicaci√≥n de Android para el reconocimiento de texto en 10 minutos. Mobile Vision CodeLab ‚õ∫Ô∏è üçô üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Versi√≥n en video del tutorial 
 
 

 El reconocimiento √≥ptico de caracteres ( OCR ) le da a la computadora la capacidad de leer texto en una imagen, p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Creaci√≥n de una aplicaci√≥n de Android para el reconocimiento de texto en 10 minutos. Mobile Vision CodeLab</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412679/"><h2>  Versi√≥n en video del tutorial </h2><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mIEfqtn9nts" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p> <em>El reconocimiento √≥ptico de caracteres</em> ( <strong>OCR</strong> ) le da a la computadora la capacidad de leer texto en una imagen, permitiendo a las aplicaciones comprender letreros, art√≠culos, volantes, p√°ginas de texto, men√∫s o cualquier cosa en forma de texto.  <code>Mobile Vision Text API</code> proporciona a los desarrolladores de <code>Android</code> una funci√≥n de <code>OCR</code> potente y confiable que admite la mayor√≠a de los dispositivos <code>Android</code> y no aumenta el tama√±o de su aplicaci√≥n. </p><br><p>  En este tutorial, crear√° una aplicaci√≥n en la que todo el texto que cae en el marco ser√° reconocido y reproducido durante el proceso de grabaci√≥n de video. <a name="habracut"></a></p><br><p>  Tambi√©n publicamos art√≠culos sobre otras caracter√≠sticas de Mobile Vision: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reconocimiento de objetos y emociones humanas</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reconocimiento facial</a> ; </li></ul><br><p>  El c√≥digo fuente se puede descargar <a href="">aqu√≠</a> . </p><br><p>  O clone el repositorio de <code>GitHub</code> desde la l√≠nea de comandos: </p><br><pre> <code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/googlesamples/android-vision.git</code> </pre> <br><p>  El repositorio de <code>visionSamples</code> contiene muchos proyectos de muestra relacionados con <code>Mobile Vision</code> .  Solo se usan dos en esta lecci√≥n: </p><br><ul><li> <strong><img src="https://habrastorage.org/getpro/habr/post_images/1e8/d51/ef8/1e8d51ef802bcde6a7d36bf83490b24d.png" width="22" height="22"></strong>  <strong>ocr-codelab / ocr-reader-start</strong> es el c√≥digo inicial que usar√° en esta lecci√≥n. </li><li> <strong><img src="https://habrastorage.org/getpro/habr/post_images/1e8/d51/ef8/1e8d51ef802bcde6a7d36bf83490b24d.png" width="22" height="22"></strong>  <strong>ocr-codelab / ocr-reader-complete</strong> : el c√≥digo completo para la aplicaci√≥n finalizada.  Puede usarlo para solucionar problemas o ir directamente a la aplicaci√≥n de trabajo. </li></ul><br><h2>  Actualizaci√≥n de servicios de Google Play </h2><br><p>  Es posible que deba actualizar su versi√≥n instalada de <code>Google Repository</code> para usar la <code>Mobile Vision Text API</code> . </p><br><p>  Abra <code>Android Studio</code> y abra el <code>SDK Manager</code> : </p><br><img src="https://habrastorage.org/getpro/habr/post_images/c09/c24/18f/c09c2418f842d747bb135a7d868c4931.png" width="240" height="117"><br><p><br>  Aseg√∫rese de que el <code>Google Repository</code> actualizado.  Debe ser al menos la versi√≥n <code>26</code> . </p><br><img src="https://habrastorage.org/getpro/habr/post_images/55f/a3f/0ee/55fa3f0ee048bc97f5b14b9fff7734ea.png" width="750" height="502"><br><p></p><br><h2>  Agregue una dependencia de Google Play Services y cree una aplicaci√≥n de inicio </h2><br><p>  Ahora puede abrir el proyecto inicial: </p><br><ol><li><p>  Elija un directorio de inicio <strong><img src="https://habrastorage.org/getpro/habr/post_images/1e8/d51/ef8/1e8d51ef802bcde6a7d36bf83490b24d.png" width="22" height="22"></strong>  <code>ocr-reader</code> del c√≥digo descargado ( <strong>Archivo</strong> &gt; <strong>Abrir</strong> &gt; <code>ocr-codelab/ocr-reader-start</code> ). </p><br></li><li><p>  Agregue la dependencia de <code>Google Play Services</code> a la aplicaci√≥n.  Sin esta dependencia, la <code>Text API</code> no estar√° disponible. </p><br></li></ol><br><p>  El proyecto puede indicar la ausencia del <strong>archivo entero / google_play_services_version</strong> y dar un error.  Esto es normal, lo arreglaremos en el siguiente paso. </p><br><p>  Abra el archivo <code>build.gradle</code> en el m√≥dulo de la <code>app</code> y cambie el bloque de dependencia para incluir la dependencia de <code>play-services-vision</code> all√≠.  Cuando todo est√© listo, el archivo deber√≠a verse as√≠: </p><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">dependencies</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">implementation</span></span> fileTree(dir: <span class="hljs-string"><span class="hljs-string">'libs'</span></span>, include: [<span class="hljs-string"><span class="hljs-string">'*.jar'</span></span>]) implementation <span class="hljs-string"><span class="hljs-string">'com.android.support:support-v4:26.1.0'</span></span> implementation <span class="hljs-string"><span class="hljs-string">'com.android.support:design:26.1.0'</span></span> implementation <span class="hljs-string"><span class="hljs-string">'com.google.android.gms:play-services-vision:15.0.0'</span></span> }</code> </pre> <br><ol><li><p>  Haga clic en <img src="https://habrastorage.org/getpro/habr/post_images/f7d/f74/7c5/f7df747c534410a9c0391d47de0bb0e3.png" width="21" height="21">  <code>Gradle</code> sincronizaci√≥n <code>Gradle</code> . </p><br></li><li><p>  Haga clic en <img src="https://habrastorage.org/getpro/habr/post_images/82f/7df/0d1/82f7df0d1dce3d570e7c35d7d8fb4575.png" width="22" height="23">  bot√≥n de inicio </p><br></li></ol><br><p>  Despu√©s de unos segundos, ver√° la pantalla Leer texto, pero esta es solo una pantalla en negro. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/c41/e98/6dc/c41e986dc883fb67fe0caf0760e99378.png" width="349" height="621"><br><p><br>  No est√° sucediendo nada en este momento porque <code>CameraSource</code> no <code>CameraSource</code> configurado.  Hag√°moslo </p><br><p>  Si no tiene √©xito, puede abrir un proyecto <strong><img src="https://habrastorage.org/getpro/habr/post_images/1e8/d51/ef8/1e8d51ef802bcde6a7d36bf83490b24d.png" width="22" height="22"></strong>  <code>ocr-reader-complete</code> y aseg√∫rese de que funcione correctamente.  Este proyecto es una versi√≥n preparada de la lecci√≥n, y si esta versi√≥n no funciona, debe verificar que todo est√© en orden con su dispositivo y la configuraci√≥n de <code>Android Studio</code> . </p><br><h2>  Configurar TextRecognizer y CameraSource </h2><br><p>  Para comenzar, crearemos nuestro <code>TextRecognizer</code> .  Este objeto detector procesa las im√°genes y determina qu√© texto aparece dentro de ellas.  Despu√©s de la inicializaci√≥n, <code>TextRecognizer</code> se puede usar para detectar texto en todo tipo de im√°genes.  Encuentre el m√©todo <code>createCameraSource</code> y cree un <code>TextRecognizer</code> : </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> autoFocus, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useFlash)</span></span></span><span class="hljs-function"> </span></span>{ Context context = getApplicationContext(); <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Create the TextRecognizer TextRecognizer textRecognizer = new TextRecognizer.Builder(context).build(); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Set the TextRecognizer's Processor. // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Check if the TextRecognizer is operational. // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Create the mCameraSource using the TextRecognizer. }</span></span></code> </pre> <br><p>  Ahora <code>TextRecognizer</code> listo para funcionar.  Sin embargo, es posible que a√∫n no funcione.  Si el dispositivo no tiene suficiente memoria o <code>Google Play Services</code> no puede cargar <code>OCR</code> dependencias de <code>OCR</code> , el objeto <code>TextRecognizer</code> no funcionar√°.  Antes de comenzar a usarlo para el reconocimiento de texto, debemos verificar que est√© listo.  <code>TextRecognizer</code> esta verificaci√≥n a <code>createCameraSource</code> despu√©s de inicializar <code>TextRecognizer</code> : </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Check if the TextRecognizer is operational. if (!textRecognizer.isOperational()) { Log.w(TAG, "Detector dependencies are not yet available."); // Check for low storage. If there is low storage, the native library will not be // downloaded, so detection will not become operational. IntentFilter lowstorageFilter = new IntentFilter(Intent.ACTION_DEVICE_STORAGE_LOW); boolean hasLowStorage = registerReceiver(null, lowstorageFilter) != null; if (hasLowStorage) { Toast.makeText(this, R.string.low_storage_error, Toast.LENGTH_LONG).show(); Log.w(TAG, getString(R.string.low_storage_error)); } }</span></span></code> </pre> <br><p>  Ahora que hemos verificado que <code>TextRecognizer</code> listo para usar, podemos usarlo para reconocer fotogramas individuales.  Pero queremos hacer algo m√°s interesante: leer el texto en modo video.  Para hacer esto, crearemos un <code>CameraSource</code> que est√© preconfigurado para controlar la c√°mara.  Necesitamos establecer una alta resoluci√≥n para disparar y habilitar el enfoque autom√°tico para hacer frente a la tarea de reconocer texto peque√±o.  Si est√° seguro de que sus usuarios ver√°n grandes bloques de texto, por ejemplo, signos, puede usar una resoluci√≥n m√°s baja y luego el procesamiento del marco ser√° m√°s r√°pido: </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Create the cameraSource using the TextRecognizer. cameraSource = new CameraSource.Builder(getApplicationContext(), textRecognizer) .setFacing(CameraSource.CAMERA_FACING_BACK) .setRequestedPreviewSize(1280, 1024) .setRequestedFps(15.0f) .setFlashMode(useFlash ? Camera.Parameters.FLASH_MODE_TORCH : null) .setFocusMode(autoFocus ? Camera.Parameters.FOCUS_MODE_CONTINUOUS_VIDEO : null) .build();</span></span></code> </pre> <br><p>  As√≠ es como deber√≠a verse el m√©todo <code>createCameraSource</code> cuando haya terminado: </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> autoFocus, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useFlash)</span></span></span><span class="hljs-function"> </span></span>{ Context context = getApplicationContext(); <span class="hljs-comment"><span class="hljs-comment">// Create the TextRecognizer TextRecognizer textRecognizer = new TextRecognizer.Builder(context).build(); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Set the TextRecognizer's Processor. // Check if the TextRecognizer is operational. if (!textRecognizer.isOperational()) { Log.w(TAG, "Detector dependencies are not yet available."); // Check for low storage. If there is low storage, the native library will not be // downloaded, so detection will not become operational. IntentFilter lowstorageFilter = new IntentFilter(Intent.ACTION_DEVICE_STORAGE_LOW); boolean hasLowStorage = registerReceiver(null, lowstorageFilter) != null; if (hasLowStorage) { Toast.makeText(this, R.string.low_storage_error, Toast.LENGTH_LONG).show(); Log.w(TAG, getString(R.string.low_storage_error)); } } // Create the cameraSource using the TextRecognizer. cameraSource = new CameraSource.Builder(getApplicationContext(), textRecognizer) .setFacing(CameraSource.CAMERA_FACING_BACK) .setRequestedPreviewSize(1280, 1024) .setRequestedFps(15.0f) .setFlashMode(useFlash ? Camera.Parameters.FLASH_MODE_TORCH : null) .setFocusMode(autoFocus ? Camera.Parameters.FOCUS_MODE_CONTINUOUS_VIDEO : null) .build(); }</span></span></code> </pre> <br><p>  Si ejecuta la aplicaci√≥n, ver√° que el video ha comenzado.  Pero para procesar im√°genes de la c√°mara, necesitamos agregar este √∫ltimo <code>TODO</code> para crear <code>createCameraSource</code> : crear un <code>Processor</code> para procesar el texto a medida que llega. </p><br><h2>  Creando OcrDetectorProcessor </h2><br><p>  Su aplicaci√≥n ahora puede detectar texto en marcos individuales utilizando el m√©todo de descubrimiento en <code>TextRecognizer</code> .  Para que pueda encontrar texto, por ejemplo, en una fotograf√≠a.  Pero para leer el texto directamente durante la filmaci√≥n de video, debe implementar un <code>Processor</code> que procese el texto tan pronto como aparezca en la pantalla. </p><br><p>  Vaya a la clase <code>OcrDetectorProcessor</code> implemente la interfaz <code>Detector.Processor</code> : </p><br><p>  <em>OcrDetectorProcessor.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OcrDetectorProcessor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Detector</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processor</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextBlock</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GraphicOverlay&lt;OcrGraphic&gt; graphicOverlay; OcrDetectorProcessor(GraphicOverlay&lt;OcrGraphic&gt; ocrGraphicOverlay) { graphicOverlay = ocrGraphicOverlay; } }</code> </pre> <br><p>  Para implementar esta interfaz, debe anular dos m√©todos.  El primero, <code>receiveDetections</code> , recibe <code>TextBlocks</code> de <code>TextRecognizer</code> medida que se detectan.  El segundo, <code>release</code> , se usa para liberar recursos cuando <code>TextRecognizer</code> destruye un <code>TextRecognizer</code> .  En este caso, solo necesitamos borrar el lienzo gr√°fico, lo que conducir√° a la eliminaci√≥n de todos los objetos <code>OcrGraphic</code> . </p><br><p>  <code>OcrGraphic</code> <code>TextBlocks</code> y <code>OcrGraphic</code> objetos <code>OcrGraphic</code> para cada bloque de texto detectado por el procesador.  Implementamos la l√≥gica de su dibujo en el siguiente paso. </p><br><p>  <em>OcrDetectorProcessor.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">receiveDetections</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Detector.Detections&lt;TextBlock&gt; detections)</span></span></span><span class="hljs-function"> </span></span>{ graphicOverlay.clear(); SparseArray&lt;TextBlock&gt; items = detections.getDetectedItems(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; items.size(); ++i) { TextBlock item = items.valueAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; item.getValue() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { Log.d(<span class="hljs-string"><span class="hljs-string">"Processor"</span></span>, <span class="hljs-string"><span class="hljs-string">"Text detected! "</span></span> + item.getValue()); OcrGraphic graphic = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OcrGraphic(graphicOverlay, item); graphicOverlay.add(graphic); } } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">release</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ graphicOverlay.clear(); }</code> </pre> <br><p>  Ahora que el procesador est√° listo, necesitamos configurar <code>textRecognizer</code> para usarlo.  Regrese al √∫ltimo <code>TODO</code> restante en el m√©todo <code>createCameraSource</code> en <code>OcrCaptureActivity</code> : </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Create the TextRecognizer TextRecognizer textRecognizer = new TextRecognizer.Builder(context).build(); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Set the TextRecognizer's Processor. textRecognizer.setProcessor(new OcrDetectorProcessor(graphicOverlay));</span></span></code> </pre> <br><p>  Ahora ejecuta la aplicaci√≥n.  En este punto, cuando coloque la c√°mara sobre el texto, ver√° mensajes de depuraci√≥n ‚Äú¬°Texto detectado!  en <code>Android Monitor Logcat</code> !  Pero esta no es una forma muy visual de visualizar lo que <code>TextRecognizer</code> ve, ¬øverdad? </p><br><p>  En el siguiente paso, dibujaremos este texto en la pantalla. </p><br><h2>  Dibujar texto en pantalla </h2><br><p>  Implementemos el m√©todo de <code>draw</code> en <code>OcrGraphic</code> .  Necesitamos entender si hay texto en la imagen, convertir las coordenadas de sus bordes en marcos de lienzo y luego dibujar los bordes y el texto. </p><br><p>  <em>OcrGraphic.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas canvas)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Draw the text onto the canvas. if (text == null) { return; } // Draws the bounding box around the TextBlock. RectF rect = new RectF(text.getBoundingBox()); rect = translateRect(rect); canvas.drawRect(rect, rectPaint); // Render the text at the bottom of the box. canvas.drawText(text.getValue(), rect.left, rect.bottom, textPaint); }</span></span></code> </pre> <br><p>  Inicie la aplicaci√≥n y pru√©bela en este texto de muestra: </p><br><img src="https://habrastorage.org/getpro/habr/post_images/9f9/62d/41d/9f962d41d7ee963958a8bbc2f88b97ec.png" width="663" height="169"><br><p>  ¬°Deber√≠a ver que aparece un marco en la pantalla con texto!  Puedes jugar con el color del texto usando <code>TEXT_COLOR</code> . </p><br><p>  ¬øQu√© tal esto? </p><br><img src="https://habrastorage.org/getpro/habr/post_images/8f2/09a/d7c/8f209ad7cd7ae77245abaa3250ea91d2.png" width="621" height="441"><br><p>  El marco alrededor del texto parece correcto, pero el texto est√° en la parte inferior. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/8dc/0ef/ec1/8dc0efec1d11dadff02a2ca7aa83d752.png" width="351" height="622"><br><p><br>  Esto se debe a que el motor transfiere todo el texto que reconoce en <code>TextBlock</code> como una sola oraci√≥n, incluso si ve una oraci√≥n dividida en varias l√≠neas.  Si necesita obtener toda la oferta, entonces esto es muy conveniente.  Pero, ¬øqu√© sucede si desea saber d√≥nde se encuentra cada l√≠nea de texto individual? </p><br><p>  Puede obtener <code>Lines</code> desde un <code>TextBlock</code> llamando a <code>getComponents</code> y luego, clasificando cada l√≠nea, puede obtener f√°cilmente su ubicaci√≥n y el texto dentro de ella.  Esto le permite dibujar texto en el lugar donde realmente aparece. </p><br><p>  <em>OcrGraphic.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas canvas)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Draw the text onto the canvas. if (text == null) { return; } // Draws the bounding box around the TextBlock. RectF rect = new RectF(text.getBoundingBox()); rect = translateRect(rect); canvas.drawRect(rect, rectPaint); // Break the text into multiple lines and draw each one according to its own bounding box. List&lt;? extends Text&gt; textComponents = text.getComponents(); for(Text currentText : textComponents) { float left = translateX(currentText.getBoundingBox().left); float bottom = translateY(currentText.getBoundingBox().bottom); canvas.drawText(currentText.getValue(), left, bottom, textPaint); } }</span></span></code> </pre> <br><p>  Intenta este texto nuevamente: </p><br><img src="https://habrastorage.org/getpro/habr/post_images/8f2/09a/d7c/8f209ad7cd7ae77245abaa3250ea91d2.png" width="655" height="465"><br><p>  Genial  Incluso puede dividir el texto encontrado en componentes a√∫n m√°s peque√±os, seg√∫n sus necesidades.  Puede llamar a <code>getComponents</code> en cada l√≠nea y obtener <code>Elements</code> (palabras latinas).  Es posible configurar <code>textSize</code> para que el texto ocupe tanto espacio como el texto real en la pantalla. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/102/3e0/2d2/1023e02d2d8659ec0a4d51662241037e.png" width="349" height="620"><br><p></p><br><h2>  Reproduce texto al hacer clic en √©l </h2><br><p>  Ahora el texto de la c√°mara se convierte en l√≠neas estructuradas, y estas l√≠neas se muestran en la pantalla.  Hagamos algo m√°s con ellos. </p><br><p>  Usando la <code>TextToSpeech API</code> integrada en <code>Android</code> y el m√©todo <code>contains</code> en <code>OcrGraphic</code> , podemos ense√±ar a la aplicaci√≥n a hablar en voz alta cuando hace clic en el texto. </p><br><p>  Primero, implementemos el m√©todo <code>contains</code> en <code>OcrGraphic</code> .  Solo necesitamos verificar si las coordenadas <code>y</code> est√°n dentro de los l√≠mites del texto que se muestra. <br>  <em>OcrGraphic.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contains</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Check if this graphic's text contains this point. if (text == null) { return false; } RectF rect = new RectF(text.getBoundingBox()); rect = translateRect(rect); return rect.contans(x, y); }</span></span></code> </pre> <br><p>  ¬°Puede notar que hay mucho en com√∫n con el m√©todo <code>Draw</code> !  En este proyecto, deber√≠a poder reutilizar el c√≥digo, pero aqu√≠ lo dejamos todo como es solo por el ejemplo. </p><br><p>  Ahora pasemos al m√©todo <code>onTap</code> en <code>OcrCaptureActivity</code> y <code>OcrCaptureActivity</code> el clic en el texto, si hay uno en este lugar. </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rawX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rawY)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Speak the text when the user taps on screen. OcrGraphic graphic = graphicOverlay.getGraphicAtLocation(rawX, rawY); TextBlock text = null; if (graphic != null) { text = graphic.getTextBlock(); if (text != null &amp;&amp; text.getValue() != null) { Log.d(TAG, "text data is being spoken! " + text.getValue()); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Speak the string. } else { Log.d(TAG, "text data is null"); } } else { Log.d(TAG,"no text detected"); } return text != null; }</span></span></code> </pre> <br><p>  Puede ejecutar la aplicaci√≥n y asegurarse de que al hacer clic en el texto se est√© procesando a trav√©s de <code>Android Monitor Logcat</code> . </p><br><p>  ¬°Hagamos que nuestra aplicaci√≥n hable!  Vaya al comienzo de la <code>Activity</code> y encuentre el m√©todo <code>onCreate</code> .  Al iniciar la aplicaci√≥n, debemos inicializar el motor <code>TextToSpeech</code> para su uso futuro. </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle bundle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// (Portions of this method omitted) // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Set up the Text To Speech engine. TextToSpeech.OnInitListener listener = new TextToSpeech.OnInitListener() { @Override public void onInit(final int status) { if (status == TextToSpeech.SUCCESS) { Log.d("TTS", "Text to speech engine started successfully."); tts.setLanguage(Locale.US); } else { Log.d("TTS", "Error starting the text to speech engine."); } } }; tts = new TextToSpeech(this.getApplicationContext(), listener); }</span></span></code> </pre> <br><p>  A pesar del hecho de que hemos inicializado correctamente <code>TextToSpeech</code> , como regla general, a√∫n debe manejar los errores generales, por ejemplo, cuando el motor a√∫n no est√° listo la primera vez que hace clic en el texto. </p><br><p>  <code>TextToSpeech</code> tambi√©n depende del idioma.  Puede cambiar el idioma en funci√≥n del idioma del texto reconocido.  El reconocimiento de idioma no est√° integrado en la <code>Mobile Vision Text API</code> , pero est√° disponible a trav√©s de la <code>Google Translate API</code> .  Como idioma para el reconocimiento de texto, puede usar el idioma del dispositivo del usuario. </p><br><p>  Genial, todo lo que queda es agregar el c√≥digo de reproducci√≥n de texto en el m√©todo <code>onTap</code> . </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rawX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rawY)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Speak the text when the user taps on screen. OcrGraphic graphic = graphicOverlay.getGraphicAtLocation(rawX, rawY); TextBlock text = null; if (graphic != null) { text = graphic.getTextBlock(); if (text != null &amp;&amp; text.getValue() != null) { Log.d(TAG, "text data is being spoken! " + text.getValue()); // Speak the string. tts.speak(text.getValue(), TextToSpeech.QUEUE_ADD, null, "DEFAULT"); } else { Log.d(TAG, "text data is null"); } } else { Log.d(TAG,"no text detected"); } return text != null; }</span></span></code> </pre> <br><p>  Ahora, cuando inicie la aplicaci√≥n y haga clic en el texto detectado, su dispositivo lo reproducir√°.  ¬°Pru√©balo! </p><br><h2>  Finalizaci√≥n </h2><br><p>  ¬°Ahora tiene una aplicaci√≥n que puede reconocer el texto de la c√°mara y hablarlo en voz alta! </p><br><p>  Puede aplicar el conocimiento adquirido del reconocimiento de texto en sus otras aplicaciones.  Por ejemplo, lea direcciones y n√∫meros de tel√©fono de tarjetas de negocios, busque el texto de fotograf√≠as de varios documentos.  En resumen, use <code>OCR</code> donde sea que necesite reconocer texto en una imagen. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuente</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es412679/">https://habr.com/ru/post/es412679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es412667/index.html">Cybergroup Turla usa Metasploit en la campa√±a Mosquito</a></li>
<li><a href="../es412669/index.html">La gesti√≥n del tiempo no da miedo: c√≥mo hacer m√°s</a></li>
<li><a href="../es412671/index.html">Consola BLE: una forma completamente nueva de interactuar con dispositivos BLE</a></li>
<li><a href="../es412675/index.html">Contratos y direcciones multigrado en Bitcoin y Ethereum</a></li>
<li><a href="../es412677/index.html">Matriz de trazabilidad</a></li>
<li><a href="../es412681/index.html">C√°lculos binarios para aritm√©tica decimal.</a></li>
<li><a href="../es412683/index.html">¬øD√≥nde y c√≥mo aprender el aprendizaje autom√°tico?</a></li>
<li><a href="../es412685/index.html">Unity GPU Path Tracing - Parte 2</a></li>
<li><a href="../es412687/index.html">Implementar IdM. Procedimientos y medios t√©cnicos: desde b√°sico hasta IdM</a></li>
<li><a href="../es412689/index.html">El an√°lisis predictivo de TI agiliza el monitoreo de aplicaciones distribuidas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>