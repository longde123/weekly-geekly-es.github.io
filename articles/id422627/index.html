<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ûüèº üë©üèª‚Äçüé® üçñ MongoDB dan riset pasar kerja TI ‚òÉÔ∏è üìπ üòÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apakah Anda pernah menganalisis lowongan? 

 Mereka mengajukan pertanyaan, di mana teknologi yang paling diminati pasar tenaga kerja saat ini? Sebulan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MongoDB dan riset pasar kerja TI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422627/">  Apakah Anda pernah menganalisis lowongan? <br><br>  Mereka mengajukan pertanyaan, di mana teknologi yang paling diminati pasar tenaga kerja saat ini?  Sebulan yang lalu?  Setahun yang lalu? <br><br>  Seberapa sering lowongan kerja baru di Jawa terbuka di area spesifik kota Anda dan seberapa aktif mereka menutup? <br><br>  Dalam artikel ini saya akan memberi tahu Anda bagaimana Anda dapat mencapai hasil yang diinginkan dan membangun sistem pelaporan pada topik yang menarik bagi kami.  Ayo pergi! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z0/f8/y8/z0f8y8sbxdtwpnhis-xvvclfodc.gif"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">(Sumber gambar)</a> <br><a name="habracut"></a><br><h3>  Pilihan ada pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Headhunter.ru</a> </h3><br>  Mungkin banyak dari Anda yang akrab dan bahkan menggunakan sumber daya seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Headhunter.ru</a> .  Ribuan lowongan baru di berbagai bidang diposting di situs ini setiap hari.  HeadHunter juga memiliki API yang memungkinkan pengembang untuk berinteraksi dengan data sumber daya ini. <br><br><h3>  Toolkit </h3><br>  Dengan menggunakan contoh sederhana, kami mempertimbangkan konstruksi proses mendapatkan data untuk sistem pelaporan, yang didasarkan pada bekerja dengan situs API Headhunter.ru.  Sebagai penyimpanan informasi antara, kami akan menggunakan DBMS SQLite yang disematkan, data yang diproses akan disimpan dalam database NoSQL MongoDB, Python 3.4 sebagai bahasa utama. <br><br><div class="spoiler">  <b class="spoiler_title">API HH</b> <div class="spoiler_text">  Kemampuan API HeadHunter cukup luas dan dijelaskan dengan baik dalam dokumentasi resmi tentang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHib</a> .  Pertama-tama, ini adalah kemampuan untuk mengirim permintaan anonim yang tidak memerlukan otorisasi untuk menerima informasi pekerjaan dalam format JSON.  Baru-baru ini, sejumlah metode telah dibayar (metode pemberi kerja), tetapi mereka tidak akan dipertimbangkan dalam tugas ini. <br></div></div><br><blockquote>  Setiap lowongan menggantung di situs selama 30 hari, setelah itu, jika tidak diperbarui, itu akan diarsipkan.  Jika lowongan diarsipkan sebelum berakhir 30 hari, maka <b>ditutup oleh</b> majikan. <br><br>  HeadHunter API (selanjutnya disebut sebagai HH API) memungkinkan Anda untuk menerima serangkaian lowongan yang dipublikasikan untuk tanggal apa pun dalam 30 hari terakhir, yang akan kami gunakan - kami akan mengumpulkan lowongan yang dipublikasikan untuk setiap hari setiap hari. <br></blockquote><h2>  Implementasi </h2><br><ul><li>  Hubungkan SQLite DB <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sqlite3 conn_db = sqlite3.connect(<span class="hljs-string"><span class="hljs-string">'hr.db'</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">10</span></span>) c = conn_db.cursor()</code> </pre> </li><li>  Tabel untuk menyimpan perubahan status pekerjaan <br>  Untuk kenyamanan, kami akan menyimpan riwayat perubahan status lowongan (ketersediaan berdasarkan tanggal) dalam tabel khusus dari basis data SQLite.  Berkat tabel <b>lowongan_history,</b> kami akan mengetahui ketersediaan lowongan di situs pada setiap tanggal pengunggahan, mis.  tanggal berapa dia aktif. <br><br><pre> <code class="python hljs">c.execute(<span class="hljs-string"><span class="hljs-string">''' create table if not exists vacancy_history ( id_vacancy integer, date_load text, date_from text, date_to text )'''</span></span>)</code> </pre> </li><li>  Penyaringan kekosongan <br>  Ada batasan bahwa satu permintaan tidak dapat mengembalikan lebih dari 2000 koleksi, dan karena mungkin ada lebih banyak lowongan yang diterbitkan di situs dalam satu hari, kami akan meletakkan filter di badan permintaan, misalnya: lowongan hanya di St. Petersburg (area = 2) , oleh spesialisasi IT (spesialisasi = 1) <br><br><pre> <code class="python hljs">path = (<span class="hljs-string"><span class="hljs-string">"/vacancies?area=2&amp;specialization=1&amp;page={}&amp;per_page={}&amp;date_from={}&amp;date_to={}"</span></span>.format(page, per_page, date_from, date_to))</code> </pre> </li><li>  Ketentuan pemilihan tambahan <br>  Pasar tenaga kerja tumbuh dengan cepat dan bahkan dengan mempertimbangkan filter, jumlah lowongan dapat melebihi 2000, jadi kami akan menetapkan batas tambahan dalam bentuk peluncuran terpisah untuk setiap hari: lowongan untuk paruh pertama hari itu dan lowongan untuk paruh kedua hari itu <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_vacancy_history</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... count_days = <span class="hljs-number"><span class="hljs-number">30</span></span> hours = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> count_days &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> hours &lt; <span class="hljs-number"><span class="hljs-number">24</span></span>: date_from = (cur_date.replace(hour=hours, minute=<span class="hljs-number"><span class="hljs-number">0</span></span>, second=<span class="hljs-number"><span class="hljs-number">0</span></span>) - td(days=count_days)).strftime(<span class="hljs-string"><span class="hljs-string">'%Y-%m-%dT%H:%M:%S'</span></span>) date_to = (cur_date.replace(hour=hours + <span class="hljs-number"><span class="hljs-number">11</span></span>, minute=<span class="hljs-number"><span class="hljs-number">59</span></span>, second=<span class="hljs-number"><span class="hljs-number">59</span></span>) - td(days=count_days)).strftime(<span class="hljs-string"><span class="hljs-string">'%Y-%m-%dT%H:%M:%S'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> count == per_page: path = (<span class="hljs-string"><span class="hljs-string">"/vacancies?area=2&amp;specialization=1&amp;page={} &amp;per_page={}&amp;date_from={}&amp;date_to={}"</span></span> .format(page, per_page, date_from, date_to)) conn.request(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, path, headers=headers) response = conn.getresponse() vacancies = response.read() conn.close() count = len(json.loads(vacancies)[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) ... <span class="hljs-comment"><span class="hljs-comment">#     try: c.executemany('INSERT INTO vacancy_history VALUES (?,?,?,?)', collection_for_ins) except sqlite3.DatabaseError as err: print("Error: ", err) else: conn_db.commit() if collection_for_ins: page = page + 1 total = total + count #   del(collection_for_ins[:]) hours = hours + 12 count_days = count_days - 1 hours = 0</span></span></code> </pre><br></li></ul><br><div class="spoiler">  <b class="spoiler_title">Kasus penggunaan pertama</b> <div class="spoiler_text">  Misalkan kita dihadapkan dengan tugas mengidentifikasi lowongan yang telah ditutup untuk interval waktu tertentu, misalnya, untuk Juli 2018.  Ini dipecahkan sebagai berikut: hasil dari query SQL sederhana ke tabel lowongan_history akan mengembalikan data yang kita butuhkan, yang dapat diteruskan ke DataFrame untuk analisis lebih lanjut: <br><br><pre> <code class="python hljs"> c.execute(<span class="hljs-string"><span class="hljs-string">""" select a.id_vacancy, date(a.date_load) as date_last_load, date(a.date_from) as date_publish, ifnull(a.date_next, date(a.date_load, '+1 day')) as date_close from ( select vh1.id_vacancy, vh1.date_load, vh1.date_from, min(vh2.date_load) as date_next from vacancy_history vh1 left join vacancy_history vh2 on vh1.id_vacancy = vh2.id_vacancy and vh1.date_load &lt; vh2.date_load where date(vh1.date_load) between :date_in and :date_out group by vh1.id_vacancy, vh1.date_load, vh1.date_from ) as a where a.date_next is null """</span></span>, {<span class="hljs-string"><span class="hljs-string">"date_in"</span></span> : date_in, <span class="hljs-string"><span class="hljs-string">"date_out"</span></span> : date_out}) date_in = dt.datetime(<span class="hljs-number"><span class="hljs-number">2018</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) date_out = dt.datetime(<span class="hljs-number"><span class="hljs-number">2018</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>) closed_vacancies = get_closed_by_period(date_in, date_out) df = pd.DataFrame(closed_vacancies, columns = [<span class="hljs-string"><span class="hljs-string">'id_vacancy'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_last_load'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_publish'</span></span>, <span class="hljs-string"><span class="hljs-string">'date_close'</span></span>]) df.head()</code> </pre> <br>  Kami mendapatkan hasil dari tipe ini: <br><div class="scrollable-table"><table><tbody><tr><th></th><th>  id_vacancy </th><th>  date_last_load </th><th>  date_publish </th><th>  date_close </th></tr><tr><td>  0 </td><td>  18126697 </td><td>  2018-07-09 </td><td>  2018-07-09 </td><td>  2018-07-10 </td></tr><tr><td>  1 </td><td>  18155121 </td><td>  2018-07-09 </td><td>  2018-06-19 </td><td>  2018-07-10 </td></tr><tr><td>  2 </td><td>  18881605 </td><td>  2018-07-09 </td><td>  2018-07-02 </td><td>  2018-07-10 </td></tr><tr><td>  3 </td><td>  19620783 </td><td>  2018-07-09 </td><td>  2018-06-27 </td><td>  2018-07-10 </td></tr><tr><td>  4 </td><td>  19696188 </td><td>  2018-07-09 </td><td>  2018-06-15 </td><td>  2018-07-10 </td></tr></tbody></table></div>  Jika kami ingin menganalisis menggunakan alat Excel atau alat BI pihak ketiga, kami dapat mengunggah tabel lowongan_history ke file csv untuk analisis lebih lanjut: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#       CSV data = c.execute('select * from vacancy_history') with open('vacancy_history.csv','w', newline='') as out_csv_file: csv_out = csv.writer(out_csv_file) csv_out.writerow(d[0] for d in data.description) csv_out.writerows(data.fetchall()) conn_db.close()</span></span></code> </pre> </div></div><br><h3>  Artileri berat </h3><br>  Tetapi bagaimana jika kita perlu melakukan analisis data yang lebih kompleks?  Di sini, database NoSQL yang berorientasi pada dokumen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MongoDB</a> datang untuk menyelamatkan, yang memungkinkan Anda untuk menyimpan data dalam format JSON. <br><br><ul><li>  Demo database MongoDB saya digunakan di layanan cloud <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mLab</a> , yang memungkinkan Anda membuat database hingga 500MB secara gratis, yang cukup untuk menguraikan tugas saat ini.  Database hr_db memiliki koleksi Lowongan, di mana kami akan membuat koneksi: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    Mongo from pymongo import MongoClient from pymongo import ASCENDING from pymongo import errors client = MongoClient('mongodb://&lt;db_user&gt;:&lt;dbpassword&gt;@ds115219.mlab.com:15219/hr_db') db = client.hr_db VacancyMongo = db.Vacancy</span></span></code> </pre> </li><li>  Perlu dicatat bahwa tingkat gaji tidak selalu ditunjukkan dalam rubel, oleh karena itu, untuk analisis perlu membawa semua nilai ke setara rubel.  Untuk melakukan ini, kami memompa koleksi kamus menggunakan API HH, yang berisi informasi tentang nilai tukar untuk tanggal saat ini: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   def get_dictionaries(): conn = http.client.HTTPSConnection("api.hh.ru") conn.request("GET", "https://api.hh.ru/dictionaries", headers=headers) response = conn.getresponse() if response.status != 200: conn.close() conn = http.client.HTTPSConnection("api.hh.ru") conn.request("GET", "https://api.hh.ru/dictionaries", headers=headers) response = conn.getresponse() dictionaries = response.read() dictionaries_json = json.loads(dictionaries) return dictionaries_json</span></span></code> </pre> </li><li>  Mengisi kamus dengan mata uang dengan nilai tukar saat ini: <br><br><pre> <code class="python hljs">hh_dictionary = get_dictionaries() currencies = hh_dictionary[<span class="hljs-string"><span class="hljs-string">'currency'</span></span>] currency_rates = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> currency <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> currencies: currency_rates[currency[<span class="hljs-string"><span class="hljs-string">'code'</span></span>]] = currency[<span class="hljs-string"><span class="hljs-string">'rate'</span></span>]</code> </pre><br></li></ul><blockquote>  Tindakan yang disebutkan di atas untuk mengumpulkan lowongan diluncurkan setiap hari, sehingga tidak perlu melihat semua lowongan setiap kali dan menerima informasi terperinci untuk masing-masing lowongan.  Kami hanya akan menerima yang diterima dalam <b>lima</b> hari terakhir. </blockquote><ul><li>  Mendapatkan serangkaian lowongan selama 5 hari terakhir dari database SQLite: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_list_of_vacancies_sql</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> conn_db = sqlite3.connect(<span class="hljs-string"><span class="hljs-string">'hr.db'</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">10</span></span>) conn_db.row_factory = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> cursor, row: row[<span class="hljs-number"><span class="hljs-number">0</span></span>] c = conn_db.cursor() items = c.execute(<span class="hljs-string"><span class="hljs-string">""" select distinct id_vacancy from vacancy_history where date(date_load) &gt;= date('now', '-5 day') """</span></span>).fetchall() conn_db.close() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items</code> </pre> </li><li>  Mendapatkan berbagai pekerjaan selama lima hari terakhir dari MongoDB: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_list_of_vacancies_nosql</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> date_load = (dt.datetime.now() - td(days=<span class="hljs-number"><span class="hljs-number">5</span></span>)).strftime(<span class="hljs-string"><span class="hljs-string">'%Y-%m-%d'</span></span>) vacancies_from_mongo = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> VacancyMongo.find({<span class="hljs-string"><span class="hljs-string">"date_load"</span></span> : {<span class="hljs-string"><span class="hljs-string">"$gte"</span></span> : date_load}}, {<span class="hljs-string"><span class="hljs-string">"id"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"_id"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>}): vacancies_from_mongo.append(int(item[<span class="hljs-string"><span class="hljs-string">'id'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vacancies_from_mongo</code> </pre></li><li>  Masih menemukan perbedaan antara dua array, untuk lowongan yang tidak ada di MongoDB, dapatkan informasi terperinci dan tulis ke database: <br><br><pre> <code class="python hljs">sql_list = get_list_of_vacancies_sql() mongo_list = get_list_of_vacancies_nosql() vac_for_pro = [] s = set(mongo_list) vac_for_pro = [x <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sql_list <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s] vac_id_chunks = [vac_for_pro[x: x + <span class="hljs-number"><span class="hljs-number">500</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, len(vac_for_pro), <span class="hljs-number"><span class="hljs-number">500</span></span>)]</code> </pre></li><li>  Jadi, kami memiliki array dengan lowongan baru yang belum tersedia di MongoDB, untuk masing-masing kami akan menerima informasi terperinci menggunakan permintaan di API HH, sebelum memprosesnya langsung ke MongoDB, kami akan memproses setiap dokumen: <br><ol><li>  Kami membawa jumlah upah setara dengan rubel; </li><li>  Tambahkan kelulusan tingkat spesialis untuk setiap lowongan (Junior / Tengah / Senior dll) </li></ol><br>  Semua ini diimplementasikan dalam fungsi vacancies_processing: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> nltk.stem.snowball <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SnowballStemmer stemmer = SnowballStemmer(<span class="hljs-string"><span class="hljs-string">"russian"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vacancies_processing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vacancies_list)</span></span></span><span class="hljs-function">:</span></span> cur_date = dt.datetime.now().strftime(<span class="hljs-string"><span class="hljs-string">'%Y-%m-%d'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> vacancy_id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vacancies_list: conn = http.client.HTTPSConnection(<span class="hljs-string"><span class="hljs-string">"api.hh.ru"</span></span>) conn.request(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">"/vacancies/{}"</span></span>.format(vacancy_id), headers=headers) response = conn.getresponse() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response.status != <span class="hljs-number"><span class="hljs-number">404</span></span>: vacancy_txt = response.read() conn.close() vacancy = json.loads(vacancy_txt) <span class="hljs-comment"><span class="hljs-comment"># salary salary = None if 'salary' in vacancy: if vacancy['salary'] != None: ... max_salary = 500000 if salary is not None: salary = int(salary) if salary &gt;= max_salary: salary = max_salary # grade grade = None if 'name' in vacancy: p_grade = '' title = re.sub(u'[^a-z-]+', ' ', vacancy['name'].lower(), re.UNICODE) words = re.split(r'\s{1,}', title.strip()) for title_word in words: title_word = stemmer.stem(title_word) if len(title_word.strip()) &gt; 1: p_grade = p_grade + " " + title_word.strip() if re.search('()|(princip)', p_grade): grade = 'principal' elif re.search('()|(senior)|([f|F]ull)', p_grade): grade = 'senior' ... else: grade = 'not specify' vacancy['salary_processed'] = salary vacancy['date_load'] = cur_date vacancy['grade'] = grade vacancy.pop('branded_description', None) try: post_id = VacancyMongo.insert_one(vacancy) except errors.DuplicateKeyError: print ('Cant insert the duplicate vacancy_id:', vacancy['id'])</span></span></code> </pre></li><li>  Memperoleh informasi terperinci dengan mengakses API HH, pra-pemrosesan diterima <br>  MongoDB akan melaksanakan data dan memasukkannya ke dalam beberapa aliran, dengan masing-masing 500 lowongan: <br><br><pre> <code class="python hljs">t_num = <span class="hljs-number"><span class="hljs-number">1</span></span> threads = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> vac_id_chunk <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vac_id_chunks: print(<span class="hljs-string"><span class="hljs-string">'starting'</span></span>, t_num) t_num = t_num + <span class="hljs-number"><span class="hljs-number">1</span></span> t = threading.Thread(target=vacancies_processing, kwargs={<span class="hljs-string"><span class="hljs-string">'vacancies_list'</span></span>: vac_id_chunk}) threads.append(t) t.start() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> threads: t.join()</code> </pre> <br></li></ul><br>  Koleksi terpopulasi di MongoDB terlihat seperti ini: <br><br> <a href=""><img src="https://habrastorage.org/webt/er/vq/sy/ervqsyhywfqykkbh2stmqgumc9q.jpeg"></a> <br><br><h2>  Beberapa contoh lagi </h2><br>  Memiliki basis data yang dikumpulkan yang kami miliki, kami dapat melakukan berbagai sampel analitik.  Jadi, saya akan membawa keluar 10 lowongan paling tinggi dibayar pengembang Python di St. Petersburg: <br><br><pre> <code class="python hljs">cursor_mongo = VacancyMongo.find({<span class="hljs-string"><span class="hljs-string">"name"</span></span> : {<span class="hljs-string"><span class="hljs-string">"$regex"</span></span> : <span class="hljs-string"><span class="hljs-string">".*[pP]ython*"</span></span>}}) df_mongo = pd.DataFrame(list(cursor_mongo)) <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> df_mongo[<span class="hljs-string"><span class="hljs-string">'_id'</span></span>] pd.concat([df_mongo.drop([<span class="hljs-string"><span class="hljs-string">'employer'</span></span>], axis=<span class="hljs-number"><span class="hljs-number">1</span></span>), df_mongo[<span class="hljs-string"><span class="hljs-string">'employer'</span></span>].apply(pd.Series)[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]], axis=<span class="hljs-number"><span class="hljs-number">1</span></span>)[[<span class="hljs-string"><span class="hljs-string">'grade'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'salary_processed'</span></span> ]].sort_values(<span class="hljs-string"><span class="hljs-string">'salary_processed'</span></span>, ascending=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)[:<span class="hljs-number"><span class="hljs-number">10</span></span>]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">10 pekerjaan bayaran tertinggi Python</b> <div class="spoiler_text"><table border="1"><thead><tr><th>  kelas </th><th>  nama </th><th>  nama </th><th>  gaji_diproses </th></tr></thead><tbody><tr><td>  senior </td><td>  Pimpinan / Arsitek Tim Web (Python / Django / React) </td><td>  Investex ltd </td><td>  293901.0 </td></tr><tr><td>  senior </td><td>  Pengembang Python senior di Montenegro </td><td>  Betmaster </td><td>  277141.0 </td></tr><tr><td>  senior </td><td>  Pengembang Python senior di Montenegro </td><td>  Betmaster </td><td>  275289.0 </td></tr><tr><td>  tengah </td><td>  Pengembang Web Back-End (Python) </td><td>  Soshace </td><td>  250000.0 </td></tr><tr><td>  tengah </td><td>  Pengembang Web Back-End (Python) </td><td>  Soshace </td><td>  250000.0 </td></tr><tr><td>  senior </td><td>  Pimpin Insinyur Python untuk Startup Swiss </td><td>  Assaia International AG </td><td>  250000.0 </td></tr><tr><td>  tengah </td><td>  Pengembang Web Back-End (Python) </td><td>  Soshace </td><td>  250000.0 </td></tr><tr><td>  tengah </td><td>  Pengembang Web Back-End (Python) </td><td>  Soshace </td><td>  250000.0 </td></tr><tr><td>  senior </td><td>  Tim Python memimpin </td><td>  Digitalhr </td><td>  230000.0 </td></tr><tr><td>  senior </td><td>  Pengembang Utama (Python, PHP, Javascript) </td><td>  IK GROUP </td><td>  220231.0 </td></tr></tbody></table></div><br></div><br><br>  Sekarang mari kita cari tahu stasiun metro mana yang memiliki konsentrasi posting kosong tertinggi untuk pengembang Java.  Dengan menggunakan ekspresi reguler, saya memfilter berdasarkan judul pekerjaan "Java", dan juga hanya memilih pekerjaan yang alamatnya ditentukan: <br><br><pre> <code class="python hljs">cursor_mongo = VacancyMongo.find({<span class="hljs-string"><span class="hljs-string">"name"</span></span> : {<span class="hljs-string"><span class="hljs-string">"$regex"</span></span> : <span class="hljs-string"><span class="hljs-string">".*[jJ]ava[^sS]"</span></span>}, <span class="hljs-string"><span class="hljs-string">"address"</span></span> : {<span class="hljs-string"><span class="hljs-string">"$ne"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>}}) df_mongo = pd.DataFrame(list(cursor_mongo)) df_mongo[<span class="hljs-string"><span class="hljs-string">'metro'</span></span>] = df_mongo.apply(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x[<span class="hljs-string"><span class="hljs-string">'address'</span></span>][<span class="hljs-string"><span class="hljs-string">'metro'</span></span>][<span class="hljs-string"><span class="hljs-string">'station_name'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x[<span class="hljs-string"><span class="hljs-string">'address'</span></span>][<span class="hljs-string"><span class="hljs-string">'metro'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, axis = <span class="hljs-number"><span class="hljs-number">1</span></span>) df_mongo.groupby(<span class="hljs-string"><span class="hljs-string">'metro'</span></span>)[<span class="hljs-string"><span class="hljs-string">'_id'</span></span>] \ .count() \ .reset_index(name=<span class="hljs-string"><span class="hljs-string">'count'</span></span>) \ .sort_values([<span class="hljs-string"><span class="hljs-string">'count'</span></span>], ascending=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) \ [:<span class="hljs-number"><span class="hljs-number">10</span></span>]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Pekerjaan untuk Pengembang Java di Stasiun Metro</b> <div class="spoiler_text"><table border="1"><thead><tr><th>  metro </th><th>  masuk hitungan </th></tr></thead><tbody><tr><td>  Vasileostrovskaya </td><td>  87 </td></tr><tr><td>  Petrogradskaya </td><td>  68 </td></tr><tr><td>  Vyborg </td><td>  46 </td></tr><tr><td>  Lenin Square </td><td>  45 </td></tr><tr><td>  Gorkovskaya </td><td>  45 </td></tr><tr><td>  Chkalovskaya </td><td>  43 </td></tr><tr><td>  Narva </td><td>  32 </td></tr><tr><td>  Lapangan Pemberontakan </td><td>  Tanggal 29 </td></tr><tr><td>  Desa Tua </td><td>  Tanggal 29 </td></tr><tr><td>  Elizarovskaya </td><td>  27 </td></tr></tbody></table></div><br></div><br><h2>  Ringkasan </h2><br>  Jadi, kemampuan analitis dari sistem yang dikembangkan benar-benar luas dan dapat digunakan untuk merencanakan startup atau membuka arah aktivitas baru. <br><br>  Saya mencatat bahwa sejauh ini hanya fungsionalitas dasar dari sistem yang disajikan, di masa depan direncanakan untuk mengembangkan ke arah analisis oleh koordinat geografis dan memprediksi penampilan lowongan di area tertentu kota. <br><br>  Kode sumber lengkap untuk artikel ini dapat ditemukan di tautan ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> saya. <br><br>  Komentar <b>PS</b> pada artikel ini disambut baik, saya akan dengan senang hati menjawab semua pertanyaan Anda dan mencari tahu pendapat Anda.  Terima kasih </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id422627/">https://habr.com/ru/post/id422627/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id422613/index.html">Cybergroup PowerPool menguasai kerentanan nol hari di Panggilan Prosedur Lokal Lanjutan</a></li>
<li><a href="../id422615/index.html">Seluruh kebenaran tentang RTOS. Artikel # 9. Penjadwal: implementasi</a></li>
<li><a href="../id422617/index.html">Seluruh kebenaran tentang RTOS. Artikel # 8. Nucleus SE: Desain dan Penyebaran Internal</a></li>
<li><a href="../id422623/index.html">Bagaimana cara mengamankan C</a></li>
<li><a href="../id422625/index.html">Kami berbicara dengan Troy Miles - programmer "Neuromancer"</a></li>
<li><a href="../id422629/index.html">Berhenti memberi makan para penebang! Berikan lebih banyak pengubah! Bidang Final Statis Malas. Sketsa Fitur Draf</a></li>
<li><a href="../id422631/index.html">Terminal QIWI. Cara memanfaatkan teknologi sederhana secara maksimal</a></li>
<li><a href="../id422633/index.html">Bagaimana kami mengotomatiskan pemantauan pekerjaan karyawan dari jaringan pompa bensin federal</a></li>
<li><a href="../id422635/index.html">Anda belum mengucapkan kata "halo", dan kami sudah tahu siapa Anda</a></li>
<li><a href="../id422637/index.html">Hadiah Geek: Perlindungan Auto-Alkash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>