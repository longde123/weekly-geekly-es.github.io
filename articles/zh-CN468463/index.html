<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘· ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ ğŸ é€šè¿‡åˆ†åŒºå’Œç´¢å¼•æ”¹å–„Zabbix + PostgreSQLæ€§èƒ½ ğŸ¤½ âš±ï¸ ğŸ‘©ğŸ¼â€âš–ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§çº¦ä¸€å¹´å‰ï¼Œæˆ‘å’Œæˆ‘çš„åŒäº‹è¢«åˆ†é…ä½¿ç”¨æµè¡Œçš„ç½‘ç»œåŸºç¡€æ¶æ„ç›‘è§†ç³»ç»Ÿ-Zabbixè¿›è¡Œæ•´ç†ã€‚ åœ¨ç ”ç©¶äº†æ–‡æ¡£ä¹‹åï¼Œæˆ‘ä»¬ç«‹å³è¿›è¡Œäº†è´Ÿè½½æµ‹è¯•ï¼šæˆ‘ä»¬æƒ³è¦è¯„ä¼°Zabbixå¯ä»¥å·¥ä½œå¤šå°‘ä¸ªå‚æ•°è€Œä¸ä¼šå‡ºç°æ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ã€‚ åªæœ‰PostgreSQLè¢«ç”¨ä½œDBMSã€‚ 

 åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œç¡®å®šäº†æ•°æ®åº“å¸ƒå±€çš„æŸäº›ä½“ç³»ç»“æ„åŠŸèƒ½ä»¥åŠç›‘...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>é€šè¿‡åˆ†åŒºå’Œç´¢å¼•æ”¹å–„Zabbix + PostgreSQLæ€§èƒ½</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468463/">å¤§çº¦ä¸€å¹´å‰ï¼Œæˆ‘å’Œæˆ‘çš„åŒäº‹è¢«åˆ†é…ä½¿ç”¨æµè¡Œçš„ç½‘ç»œåŸºç¡€æ¶æ„ç›‘è§†ç³»ç»Ÿ-Zabbixè¿›è¡Œæ•´ç†ã€‚ åœ¨ç ”ç©¶äº†æ–‡æ¡£ä¹‹åï¼Œæˆ‘ä»¬ç«‹å³è¿›è¡Œäº†è´Ÿè½½æµ‹è¯•ï¼šæˆ‘ä»¬æƒ³è¦è¯„ä¼°Zabbixå¯ä»¥å·¥ä½œå¤šå°‘ä¸ªå‚æ•°è€Œä¸ä¼šå‡ºç°æ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ã€‚ åªæœ‰PostgreSQLè¢«ç”¨ä½œDBMSã€‚ <br><br> åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œç¡®å®šäº†æ•°æ®åº“å¸ƒå±€çš„æŸäº›ä½“ç³»ç»“æ„åŠŸèƒ½ä»¥åŠç›‘è§†ç³»ç»Ÿæœ¬èº«çš„è¡Œä¸ºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›åŠŸèƒ½ä¸å…è®¸ç›‘è§†ç³»ç»Ÿè¾¾åˆ°å…¶æœ€å¤§åŠŸèƒ½ã€‚ ç»“æœï¼Œä¸»è¦åœ¨è°ƒä¼˜æ•°æ®åº“æ–¹é¢å¼€å‘ï¼Œå®æ–½å’Œæµ‹è¯•äº†ä¸€äº›ä¼˜åŒ–æªæ–½ã€‚ <br><br> æˆ‘æƒ³åˆ†äº«æœ¬æ–‡å®Œæˆçš„å·¥ä½œçš„ç»“æœã€‚ æœ¬æ–‡å¯¹äºZabbixå’ŒPostgreSQL DBAç®¡ç†å‘˜ä»¥åŠæƒ³è¦æ›´å¥½åœ°äº†è§£å’Œç†è§£æµè¡Œçš„PosgreSQL DBMSçš„æ¯ä¸ªäººéƒ½å°†å¾ˆæœ‰ç”¨ã€‚ <br><br> å°å‹ç ´åå™¨ï¼šåœ¨æ¯åˆ†é’Ÿè´Ÿè½½20ä¸‡ä¸ªå‚æ•°çš„å¼±æœºå™¨ä¸Šï¼Œæˆ‘ä»¬è®¾æ³•å°†CPU iowaitä»20ï¼…å‡å°‘åˆ°2ï¼…ï¼Œå°†å¯¹ä¸»æ•°æ®è¡¨çš„è®°å½•æ—¶é—´å‡å°‘äº†250å€ï¼Œå¯¹æ±‡æ€»æ•°æ®è¡¨çš„è®°å½•æ—¶é—´å‡å°‘äº†32å€ï¼Œå‡å°äº†ç´¢å¼•çš„å¤§å°5-10å€ï¼Œå¹¶åœ¨æŸäº›æƒ…å†µä¸‹å°†å†å²æ ·å“çš„æ¥æ”¶é€Ÿåº¦æé«˜äº†18å€ã€‚ <br><a name="habracut"></a><br><h4> è´Ÿè½½æµ‹è¯• </h4><br> æ ¹æ®è¯¥æ–¹æ¡ˆè¿›è¡Œäº†è´Ÿè½½æµ‹è¯•ï¼šä¸€å°ZabbixæœåŠ¡å™¨ï¼Œä¸€å°æ´»åŠ¨Zabbixä»£ç†ï¼Œä¸¤ä¸ªä»£ç†ã€‚ æ¯ä¸ªä»£ç†é…ç½®ä¸ºæ¯åˆ†é’Ÿæä¾›50å¨æ•´æ•°å’Œ50å¨å­—ç¬¦ä¸²å‚æ•°ï¼ˆæ¯åˆ†é’Ÿæ€»å…±200å¨å‚æ•°æˆ–æ¯ç§’3333ä¸ªå‚æ•°ï¼‰ã€‚ ä¸ºäº†ç”Ÿæˆä»£ç†å‚æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Zabbixæ’ä»¶ï¼Œ</a>è¦æ£€æŸ¥ä¸€ä¸ªä»£ç†å¯ä»¥ç”Ÿæˆå¤šå°‘å‚æ•°ï¼Œæ‚¨éœ€è¦ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¥è‡ªåŒä¸€æ’ä»¶ä½œè€…zabbix_module_stress</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç‰¹æ®Šè„šæœ¬</a> ã€‚  Zabbix Webç®¡ç†å‘˜åœ¨æ³¨å†Œå¤§å‹æ¨¡æ¿æ—¶é‡åˆ°å›°éš¾ï¼Œå› æ­¤æˆ‘ä»¬å°†å‚æ•°åˆ†ä¸º5ä¸ªå‚æ•°ï¼ˆ2500ä¸ªæ•°å­—å’Œ2500ä¸ªå­—ç¬¦ä¸²ï¼‰çš„20ä¸ªæ¨¡æ¿ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç”¨äºpythonä¸­çš„è´Ÿè½½æµ‹è¯•çš„è„šæœ¬ç”Ÿæˆå™¨æ¨¡æ¿</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> argparse <span class="hljs-string"><span class="hljs-string">"""     .   20   5000    ( 2500  :  echo,  ;  ping,  ) """</span></span> TEMP_HEAD = <span class="hljs-string"><span class="hljs-string">""" &lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;zabbix_export&gt; &lt;version&gt;2.0&lt;/version&gt; &lt;date&gt;2015-08-17T23:15:01Z&lt;/date&gt; &lt;groups&gt; &lt;group&gt; &lt;name&gt;Templates&lt;/name&gt; &lt;/group&gt; &lt;/groups&gt; &lt;templates&gt; &lt;template&gt; &lt;template&gt;Template Zabbix Srv Stress {count} passive {char}&lt;/template&gt; &lt;name&gt;Template Zabbix Srv Stress {count} passive {char}&lt;/name&gt; &lt;description/&gt; &lt;groups&gt; &lt;group&gt; &lt;name&gt;Templates&lt;/name&gt; &lt;/group&gt; &lt;/groups&gt; &lt;applications/&gt; &lt;items&gt; """</span></span> TEMP_END = <span class="hljs-string"><span class="hljs-string">"""&lt;/items&gt; &lt;discovery_rules/&gt; &lt;macros/&gt; &lt;templates/&gt; &lt;screens/&gt; &lt;/template&gt; &lt;/templates&gt; &lt;/zabbix_export&gt; """</span></span> TEMP_ITEM = <span class="hljs-string"><span class="hljs-string">"""&lt;item&gt; &lt;name&gt;{k}&lt;/name&gt; &lt;type&gt;0&lt;/type&gt; &lt;snmp_community/&gt; &lt;multiplier&gt;0&lt;/multiplier&gt; &lt;snmp_oid/&gt; &lt;key&gt;{k}&lt;/key&gt; &lt;delay&gt;1m&lt;/delay&gt; &lt;history&gt;3&lt;/history&gt; &lt;trends&gt;365&lt;/trends&gt; &lt;status&gt;0&lt;/status&gt; &lt;value_type&gt;{t}&lt;/value_type&gt; &lt;allowed_hosts/&gt; &lt;units/&gt; &lt;delta&gt;0&lt;/delta&gt; &lt;snmpv3_contextname/&gt; &lt;snmpv3_securityname/&gt; &lt;snmpv3_securitylevel&gt;0&lt;/snmpv3_securitylevel&gt; &lt;snmpv3_authprotocol&gt;0&lt;/snmpv3_authprotocol&gt; &lt;snmpv3_authpassphrase/&gt; &lt;snmpv3_privprotocol&gt;0&lt;/snmpv3_privprotocol&gt; &lt;snmpv3_privpassphrase/&gt; &lt;formula&gt;1&lt;/formula&gt; &lt;delay_flex/&gt; &lt;params/&gt; &lt;ipmi_sensor/&gt; &lt;data_type&gt;0&lt;/data_type&gt; &lt;authtype&gt;0&lt;/authtype&gt; &lt;username/&gt; &lt;password/&gt; &lt;publickey/&gt; &lt;privatekey/&gt; &lt;port/&gt; &lt;description/&gt; &lt;inventory_link&gt;0&lt;/inventory_link&gt; &lt;applications/&gt; &lt;valuemap/&gt; &lt;logtimefmt/&gt; &lt;/item&gt; """</span></span> TMP_FNAME_DEFAULT = <span class="hljs-string"><span class="hljs-string">"Template_App_Zabbix_Server_Stress_{count}_passive_{char}.xml"</span></span> chars = <span class="hljs-string"><span class="hljs-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: parser = argparse.ArgumentParser( description=<span class="hljs-string"><span class="hljs-string">'     zabbix'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--items'</span></span>, dest=<span class="hljs-string"><span class="hljs-string">'items'</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">1000</span></span>, help=<span class="hljs-string"><span class="hljs-string">'-   (default: 1000)'</span></span>) parser.add_argument(<span class="hljs-string"><span class="hljs-string">'--templates'</span></span>, dest=<span class="hljs-string"><span class="hljs-string">'templates'</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">1</span></span>, help=<span class="hljs-string"><span class="hljs-string">f'-  [1-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{len(chars)}</span></span></span><span class="hljs-string">] (default: 1)'</span></span>) args = parser.parse_args() items_count = args.items tmps_count = args.templates <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> (tmps_count &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> tmps_count &lt;= len(chars)): sys.exit(<span class="hljs-string"><span class="hljs-string">f"Templates must be in range 1 - </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{len(chars)}</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(tmps_count): fname = TMP_FNAME_DEFAULT.format(count=items_count, char=chars[i]) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(fname, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> output: output.write(TEMP_HEAD.format(count=items_count, char=chars[i])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k,t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [(<span class="hljs-string"><span class="hljs-string">'stress.ping[{}-I-{:06d}]'</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), (<span class="hljs-string"><span class="hljs-string">'stress.echo[{}-S-{:06d}]'</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>)]: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(int(items_count/<span class="hljs-number"><span class="hljs-number">2</span></span>)): output.write(TEMP_ITEM.format(k=k.format(chars[i],j),t=t)) output.write(TEMP_END)</code> </pre> <br></div></div><br>  cpu iostatæŒ‡æ ‡å¾ˆå¥½åœ°æŒ‡ç¤ºäº†Zabbixçš„æ€§èƒ½-å®ƒåæ˜ äº†å¤„ç†å™¨ç­‰å¾…ç£ç›˜è®¿é—®çš„æ—¶é—´å•ä½çš„åˆ†æ•°ã€‚ æ•°å€¼è¶Šé«˜ï¼Œç£ç›˜ä¸Šçš„è¯»å†™æ“ä½œå°±è¶Šå¤šï¼Œè¿™å°†é—´æ¥å½±å“æ•´ä¸ªç›‘è§†ç³»ç»Ÿçš„æ€§èƒ½ä¸‹é™ã€‚ å³ è¿™è‚¯å®šæ˜¯ç›‘æ§å‡ºç°é—®é¢˜çš„è¿¹è±¡ã€‚ é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œåœ¨ç½‘ç»œçš„å¼€æ”¾ç©ºé—´ä¸Šï¼Œä¸€ä¸ªæ¯”è¾ƒæ™®éçš„é—®é¢˜æ˜¯â€œå¦‚ä½•åœ¨Zabbixä¸­åˆ é™¤iostatè§¦å‘å™¨â€ï¼Œæ‰€ä»¥è¿™å¾ˆéº»çƒ¦ï¼Œå› ä¸ºæœ‰å¾ˆå¤šåŸå› ä¼šå¢åŠ iowaitæŒ‡æ ‡çš„å€¼ã€‚ <br><br> è¿™æ˜¯æœ€åˆä¸‰å¤©åè·å¾—çš„cpu iowaitæŒ‡æ ‡çš„å›¾ç‰‡ï¼š <br><br><img src="https://habrastorage.org/webt/dc/md/yo/dcmdyote_ghzxca-o9sft88ptxq.png"><br><br> ä½†æ˜¯ï¼Œåœ¨å®Œæˆæ‰€æœ‰ä¼˜åŒ–æªæ–½ä¹‹åï¼Œæˆ‘ä»¬åœ¨ä¸‰å¤©ä¹‹å†…ä¹Ÿè·å¾—äº†ç›¸åŒæŒ‡æ ‡çš„ç»“æœï¼Œä¸‹é¢å°†å¯¹æ­¤è¿›è¡Œè®¨è®ºï¼š <br><br><img src="https://habrastorage.org/webt/do/cs/fc/docsfcjjczkhgxoubjayslrohuw.png"><br><br> ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œcpu iowaitæŒ‡æ ‡ä»å‡ ä¹20ï¼…ä¸‹é™åˆ°2ï¼…ï¼Œä»è€Œé—´æ¥åœ°åŠ å¿«äº†æ‰€æœ‰æ·»åŠ å’Œè¯»å–æ•°æ®è¯·æ±‚çš„æ‰§è¡Œæ—¶é—´ã€‚ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¸ºä»€ä¹ˆä½¿ç”¨æ ‡å‡†æ•°æ®åº“è®¾ç½®ï¼Œç›‘è§†ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ä¸‹é™ä»¥åŠå¦‚ä½•å¯¹å…¶è¿›è¡Œä¿®å¤ã€‚ <br><br><h4>  Zabbixæ€§èƒ½ä¸‹é™çš„åŸå›  </h4><br> ç”±äºåœ¨æ¯ä¸ªä¸»æ•°æ®è¡¨ä¸­ç´¯ç§¯äº†è¶…è¿‡1000ä¸‡ä¸ªå‚æ•°å€¼ï¼Œå› æ­¤æ³¨æ„åˆ°ç›‘è§†ç³»ç»Ÿçš„æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼ŒåŸå› å¦‚ä¸‹ï¼š <br><br><ul><li> æœåŠ¡å™¨CPUçš„iowaitæŒ‡æ ‡å¢åŠ äº†20ï¼…ä»¥ä¸Šï¼Œè¿™è¡¨æ˜CPUæœŸæœ›è®¿é—®ç£ç›˜è¯»å†™æ“ä½œçš„æ—¶é—´å¢åŠ äº† </li><li> ç›‘è§†æ•°æ®å¤§å¤§è†¨èƒ€çš„è¡¨çš„ç´¢å¼• </li><li> å¯¹äºå…·æœ‰ç›‘è§†æ•°æ®çš„ç£ç›˜ï¼Œåˆ©ç”¨ç‡æŒ‡æ ‡æé«˜åˆ°100ï¼…ï¼Œè¿™è¡¨æ˜ç£ç›˜å…·æœ‰è¯»å’Œå†™æ“ä½œçš„æ»¡è´Ÿè½½ </li><li> æ ¹æ®ç®¡å®¶çš„æ—¶é—´è¡¨è¿›è¡Œæ¸…ç†æ—¶ï¼Œè¿‡æ—¶çš„å€¼æ²¡æœ‰æ—¶é—´ä»å†å²è®°å½•è¡¨ä¸­åˆ é™¤ </li></ul><br> è¿™ç§æƒ…å†µåœ¨æ¯ä¸ªå°æ—¶çš„å¼€å§‹éƒ½ä¼šåŠ å‰§ï¼Œæ­¤å¤–ï¼Œè¿˜è¦è®¡ç®—æ¯å°æ—¶çš„æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯-åœ¨ä¸»åŠ¨ä»ç£ç›˜è¯»å–å’Œå†™å…¥ç´¢å¼•é¡µï¼Œä»å†å²è®°å½•ä¸­åˆ é™¤è¿‡æ—¶çš„æ•°æ®æ—¶ï¼Œå¯¼è‡´ç›¸åŒçš„ç»“æœ-æ•°æ®åº“æ€§èƒ½ä¸‹é™å’Œæ‰§è¡Œæ—¶é—´å¢åŠ è¯·æ±‚ï¼ˆåœ¨é™åˆ¶ä¸­ï¼Œè®°å½•äº†æœ€å¤š5åˆ†é’Ÿçš„è¯·æ±‚ï¼ï¼‰ã€‚ <br><br> åœ¨Zabbixä¸­ç»„ç»‡ç›‘è§†æ•°æ®ä»“åº“çš„ä¸€ç‚¹å¸®åŠ©ã€‚ æ­¤å¤–ï¼Œå®ƒå°†å‚æ•°ç±»å‹åˆ†å¼€å­˜å‚¨åœ¨ä¸åŒè¡¨ä¸­çš„ä¸»æ•°æ®å’Œèšåˆæ•°æ®ã€‚ æ¯ä¸ªè¡¨å­˜å‚¨ä¸€ä¸ªitemidå­—æ®µï¼ˆå¯¹ç³»ç»Ÿä¸­å·²æ³¨å†Œæ•°æ®é¡¹çš„éšå¼å¼•ç”¨ï¼‰ï¼Œç”¨äºä»¥unixæ—¶é—´æˆ³æ ¼å¼æ³¨å†Œæ—¶é’Ÿå€¼çš„æ—¶é—´æˆ³è®°ï¼ˆåœ¨å•ç‹¬çš„åˆ—ä¸­ä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰å’Œåœ¨å•ç‹¬çš„åˆ—ä¸­çš„å€¼ï¼ˆæ—¥å¿—è¡¨é™¤å¤–ï¼Œå®ƒå…·æœ‰æ›´å¤šå­—æ®µ-ä¸äº‹ä»¶æ—¥å¿—ç±»ä¼¼ï¼‰ ï¼‰ï¼š <br><div class="scrollable-table"><table><tbody><tr><th> è¡¨å </th><th> é¢„çº¦æ—¶é—´ </th><th> èµ„æ–™ç±»å‹ </th></tr><tr><td> å†å² </td><td> ä¸»è¦ç›‘æµ‹æ•°æ® </td><td> æ•°å€¼ï¼ˆ16.4ï¼‰ </td></tr><tr><td>  history_uint </td><td> ä¸»è¦ç›‘æµ‹æ•°æ® </td><td> æ•°å€¼ï¼ˆ20.0ï¼‰ </td></tr><tr><td>  history_str </td><td> ä¸»è¦ç›‘æµ‹æ•°æ® </td><td>  varcharï¼ˆ255ï¼‰ </td></tr><tr><td>  history_text </td><td> ä¸»è¦ç›‘æµ‹æ•°æ® </td><td> æ–‡å­— </td></tr><tr><td>  history_logs </td><td> ä¸»è¦ç›‘æµ‹æ•°æ® </td><td> æ–‡æœ¬å’Œæ•´æ•°å­—æ®µ </td></tr><tr><td> è¶‹åŠ¿ </td><td> æ±‡æ€»ç›‘æ§æ•°æ® </td><td> æ•°å€¼ï¼ˆ16.4ï¼‰ </td></tr><tr><td>  Trends_uint </td><td> æ±‡æ€»ç›‘æ§æ•°æ® </td><td> æ•°å€¼ï¼ˆ20.0ï¼‰ </td></tr></tbody></table></div><h4> ä¼˜åŒ–æ´»åŠ¨ </h4><br> ä¸ºäº†æé«˜PostgreSQLæ•°æ®åº“çš„æ€§èƒ½ï¼Œå·²è¿›è¡Œäº†å„ç§ä¼˜åŒ–æªæ–½ï¼Œä¸»è¦æ˜¯åˆ†åŒºå’Œæ›´æ”¹ç´¢å¼•ã€‚ ä½†æ˜¯ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ä¸€äº›é‡è¦å’Œæœ‰ç”¨çš„æªæ–½ï¼Œè¿™äº›æªæ–½å¯ä»¥åŠ å¿«PostgreSQLæ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸‹ä»»ä½•æ•°æ®åº“çš„å·¥ä½œã€‚ <br><br>  <b>é‡è¦è¯´æ˜ã€‚</b> åœ¨æ”¶é›†æœ¬æ–‡çš„èµ„æ–™æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Zabbix 4.0ç‰ˆï¼Œå°½ç®¡å·²ç»å‘å¸ƒäº†4.2ç‰ˆå¹¶ä¸”æ­£åœ¨å‡†å¤‡å‘å¸ƒ4.4ç‰ˆã€‚ ä¸ºä»€ä¹ˆæåˆ°è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Ÿ å› ä¸ºä»ç‰ˆæœ¬4.2å¼€å§‹ï¼ŒZabbixå¼€å§‹æ”¯æŒç”¨äºTimescaleDBæ—¶é—´åºåˆ—çš„ç‰¹æ®Šå¼ºå¤§æ‰©å±•ï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢ä»å¤„äºå®éªŒæ¨¡å¼ï¼šä½¿ç”¨è¯¥æ‰©å±•çš„æ‰€æœ‰ä¼˜åŠ¿ï¼Œäººä»¬è®¤ä¸ºæŸäº›è¯·æ±‚å¼€å§‹è¿è¡Œå¾—æ›´æ…¢ï¼Œå¹¶ä¸”ä»ç„¶å­˜åœ¨æ— æ³•è§£å†³çš„æ€§èƒ½é—®é¢˜ï¼ˆå·²åœ¨4.4ç‰ˆä¸­è§£å†³ï¼‰- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é˜…è¯»æœ¬æ–‡</a> ã€‚  <i>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æ‰“ç®—ä¸è¯¥è§£å†³æ–¹æ¡ˆæ¡ˆä¾‹è¿›è¡Œæ¯”è¾ƒï¼Œä»‹ç»å·²ç»ä½¿ç”¨TimescaleDBæ‰©å±•è¿›è¡Œè´Ÿè½½æµ‹è¯•çš„ç»“æœã€‚</i>  PostgreSQLç‰ˆæœ¬ä½¿ç”¨10ï¼Œä½†æ˜¯ç»™å‡ºçš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¸11å’Œ12ç‰ˆæœ¬æœ‰å…³ï¼ˆæˆ‘ä»¬æ­£åœ¨ç­‰å¾…ï¼ï¼‰ã€‚ <br><br> å› æ­¤ï¼Œé¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼š <br><br><ul><li> ä½¿ç”¨pgtuneå®ç”¨ç¨‹åºè®¾ç½®é…ç½®æ–‡ä»¶ </li><li> å°†æ•°æ®åº“æ”¾åœ¨å•ç‹¬çš„ç‰©ç†ç£ç›˜ä¸Š </li><li> ç”¨pg_pathmanåˆ†åŒºå†å²è¡¨ </li><li> å°†å†å²è®°å½•è¡¨çš„ç´¢å¼•ç±»å‹æ›´æ”¹ä¸ºbrinï¼ˆæ—¶é’Ÿï¼‰å’Œbtree-ginï¼ˆitemidï¼‰ </li><li> æŸ¥è¯¢æ‰§è¡Œç»Ÿè®¡ä¿¡æ¯pg_stat_statementsçš„æ”¶é›†å’Œåˆ†æ </li><li> è®¾ç½®ç‰©ç†ç£ç›˜ç›‘è§†å‚æ•° </li><li> ç¡¬ä»¶æ€§èƒ½æå‡ </li><li> åˆ›å»ºåˆ†å¸ƒå¼é›†ç¾¤ï¼ˆè¶…å‡ºæœ¬æ–‡èŒƒå›´çš„å†…å®¹ï¼‰ </li></ul><br><br><h4> ä½¿ç”¨pgtuneå®ç”¨ç¨‹åºé…ç½®é…ç½®æ–‡ä»¶ </h4><br> å®é™…ä¸Šï¼ŒPostgreSQLæ˜¯ä¸€ä¸ªç›¸å½“è½»é‡çº§çš„DBMSã€‚ å®ƒçš„é»˜è®¤é…ç½®æ–‡ä»¶å·²é…ç½®ä¸ºï¼Œæ­£å¦‚æˆ‘çš„åŒäº‹æ‰€è¯´ï¼Œâ€œç”šè‡³å¯ä»¥åœ¨å’–å•¡æœºä¸Šå·¥ä½œâ€ï¼Œå³ ç”¨éå¸¸é€‚ä¸­çš„é“ã€‚ å› æ­¤ï¼Œæœ‰å¿…è¦ä¸ºæœåŠ¡å™¨é…ç½®é…ç½®PostgreSQLï¼ŒåŒæ—¶è€ƒè™‘å†…å­˜é‡ï¼Œå¤„ç†å™¨æ•°é‡ï¼Œæ•°æ®åº“çš„é¢„æœŸä½¿ç”¨ç±»å‹ï¼Œç£ç›˜ç±»å‹ï¼ˆHDDæˆ–SSDï¼‰å’Œè¿æ¥æ•°é‡ã€‚ <br><br>  lasï¼Œæ²¡æœ‰ä¸€ä¸ªå•ä¸€çš„å…¬å¼å¯ä»¥è°ƒæ•´æ‰€æœ‰DBMSï¼Œä½†æ˜¯æœ‰ä¸€äº›é€‚ç”¨äºå¤§å¤šæ•°é…ç½®çš„è§„åˆ™å’Œæ¨¡å¼ï¼ˆæ›´ç²¾ç¡®çš„è°ƒæ•´å·²ç»æ˜¯ä¸“å®¶çš„å·¥ä½œï¼‰ã€‚ ä¸ºäº†ç®€åŒ–DBAçš„å·¥ä½œï¼Œç¼–å†™äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pgtune</a>å®ç”¨ç¨‹åºï¼Œå¹¶åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç½‘ç»œç‰ˆæœ¬ä¸Šæ·»åŠ </a>äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">le0pard</a> ï¼Œè¿™æ˜¯ä¸€æœ¬æœ‰è¶£ä¸”æœ‰ç”¨çš„PostgreSQLç®¡ç†ä¹¦ç±çš„ä½œè€…ã€‚ <br><br> åœ¨å…·æœ‰100ä¸ªè¿æ¥ï¼ˆZabbixå…·æœ‰è¦æ±‚çš„Webç®¡ç†å‘˜ï¼‰çš„æ§åˆ¶å°ä¸­é’ˆå¯¹â€œæ•°æ®ä»“åº“â€åº”ç”¨ç¨‹åºç±»å‹è¿è¡Œå®ç”¨ç¨‹åºçš„ç¤ºä¾‹ï¼š <br><br><pre>  pgtune -i postgresql.conf -o new_postgresql.conf -T DW -c 100 </pre><br><div class="spoiler">  <b class="spoiler_title">pgtuneå®ç”¨ç¨‹åºéšç›®çš„æè¿°è€Œæ›´æ”¹çš„é…ç½®å‚æ•°ï¼ˆä»¥ç¤ºä¾‹å€¼ç»™å‡ºï¼‰</b> <div class="spoiler_text"><pre> ï¼ƒDBç‰ˆæœ¬ï¼š11
 ï¼ƒæ“ä½œç³»ç»Ÿç±»å‹ï¼šlinux
 ï¼ƒDBç±»å‹ï¼šweb
 ï¼ƒæ€»å†…å­˜ï¼ˆRAMï¼‰ï¼š8 GB
 ï¼ƒCPUæ•°é‡ï¼š1
 ï¼ƒè¿æ¥æ•°ï¼š100
 ï¼ƒæ•°æ®å­˜å‚¨ï¼šç¡¬ç›˜<font></font>
<font></font>
 max_connections = 100ï¼ƒæœ€å¤§å¹¶å‘æ•°æ®åº“è¿æ¥æ•°
 shared_buffers = 2GBï¼ƒå…±äº«å†…å­˜ä¸­å„ç§ç¼“å†²åŒºï¼ˆä¸»è¦æ˜¯è¡¨å—å’Œç´¢å¼•å—çš„ç¼“å­˜ï¼‰çš„å†…å­˜å¤§å°
 effective_cache_size = 6GBï¼ƒä½¿ç”¨ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ‰€éœ€çš„æœ€å¤§å†…å­˜å¤§å°
 maintenance_work_mem = 512MBï¼ƒå½±å“æ“ä½œé€Ÿåº¦VACUUMï¼ŒANALYZEå’ŒCREATE INDEX
 checkpoint_completion_target = 0.7ï¼ƒå®Œæˆæ£€æŸ¥ç‚¹ç¨‹åºçš„ç›®æ ‡æ—¶é—´
 wal_buffers = 16MBï¼ƒå…±äº«å†…å­˜ç”¨äºç»´æŠ¤äº‹åŠ¡æ—¥å¿—çš„å†…å­˜é‡
 default_statistics_target = 100ï¼ƒANALYZEå‘½ä»¤æ”¶é›†çš„ç»Ÿè®¡ä¿¡æ¯çš„æ•°é‡-å½“å¢åŠ æ—¶ï¼Œä¼˜åŒ–å™¨ç”ŸæˆæŸ¥è¯¢çš„é€Ÿåº¦ä¼šå˜æ…¢ï¼Œä½†ä¼šæ›´å¥½
 random_page_cost = 4ï¼ƒç´¢å¼•è®¿é—®æ•°æ®é¡µçš„æ¡ä»¶å¼€é”€-å½±å“ä½¿ç”¨ç´¢å¼•çš„å†³ç­–
 effective_io_concurrency = 2ï¼ƒDBMSå°†åœ¨å•ç‹¬çš„ä¼šè¯ä¸­å°è¯•æ‰§è¡Œçš„å¼‚æ­¥I / Oæ“ä½œæ•°
 work_mem = 10485kBï¼ƒåœ¨ç£ç›˜ä¸Šä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ä¹‹å‰ç”¨äºæ’åºå’Œå“ˆå¸Œè¡¨çš„å†…å­˜é‡
 min_wal_size = 1GBï¼ƒé™åˆ¶åœ¨WALæ–‡ä»¶æ•°é‡ä»¥ä¸‹ï¼Œå°†è¢«å›æ”¶ä»¥å¤‡å°†æ¥ä½¿ç”¨
 max_wal_size = 2GBï¼ƒé™åˆ¶å°†è¢«å›æ”¶ä»¥ä¾›å°†æ¥ä½¿ç”¨çš„WALæ–‡ä»¶çš„æ•°é‡ </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">ä¸€äº›æœ‰ç”¨çš„postgresqlé…ç½®é€‰é¡¹</b> <div class="spoiler_text"><pre> ï¼ƒç®¡ç†å¹¶å‘è¯·æ±‚å¤„ç†ç¨‹åº
 max_worker_processes = 8ï¼ƒåå°è¿›ç¨‹çš„æœ€å¤§æ•°é‡-æ¯ä¸ªæ•°æ®åº“è‡³å°‘ä¸€ä¸ª
 max_parallel_workers_per_gather = 4ï¼ƒå•ä¸ªè¯·æ±‚ä¸­çš„æœ€å¤§å¹¶è¡Œè¿›ç¨‹æ•°
 max_parallel_workers = 8ï¼ƒç³»ç»Ÿå¯ä»¥æ”¯æŒå¹¶è¡Œæ“ä½œçš„æœ€å¤§å·¥ä½œæµç¨‹æ•°<font></font>
<font></font>
 ï¼ƒæ—¥å¿—è®°å½•è®¾ç½®ï¼ˆä¸€ç§æ— éœ€ä½¿ç”¨pg_stat_statementsæ‰©å±•å³å¯äº†è§£è¯·æ±‚æ‰§è¡Œæ—¶é—´çš„ç®€ä¾¿æ–¹æ³•ï¼‰
 log_min_duration_statement = 3000ï¼ƒå°†æ‰€æœ‰æ“ä½œæ—¶é—´&gt; =æŒ‡å®šå€¼ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰çš„å‘½ä»¤çš„æ‰§è¡ŒæŒç»­æ—¶é—´å†™å…¥æ—¥å¿—
 log_duration = offï¼ƒè®°å½•æ¯ä¸ªå·²å®Œæˆå‘½ä»¤çš„æŒç»­æ—¶é—´
 log_statement ='none'ï¼ƒå°†å“ªä¸ªSQLå‘½ä»¤å†™å…¥æ—¥å¿—ï¼Œå€¼ï¼šæ— ï¼ˆç¦ç”¨ï¼‰ï¼Œddlï¼Œmodå’Œå…¨éƒ¨ï¼ˆæ‰€æœ‰å‘½ä»¤ï¼‰
 debug_print_plan = offï¼ƒæŸ¥è¯¢è®¡åˆ’æ ‘çš„è¾“å‡ºä»¥ä¾›è¿›ä¸€æ­¥åˆ†æ<font></font>
<font></font>
 ï¼ƒå°†æœ€å¤§å€¼ä»æ•°æ®åº“ä¸­æŒ¤å‡ºï¼Œå¹¶å‡†å¤‡å¥½åœ¨å‘ç”Ÿä»»ä½•æ•…éšœæ—¶è·å–å®ƒï¼ˆå¯¹äºæœ€å‹æŠ‘çš„äººï¼Œä»–ä»¬å¿½ç•¥äº†ssdå’Œåˆ†å¸ƒå¼é›†ç¾¤çš„å­˜åœ¨ï¼‰
 #fsync = offï¼ƒç‰©ç†å†™å…¥æ›´æ”¹ç£ç›˜ï¼Œç¦ç”¨fsyncå¯æé«˜é€Ÿåº¦ï¼Œä½†å¯èƒ½å¯¼è‡´æ°¸ä¹…æ€§æ•…éšœ
 #synchronous_commit = offï¼ƒå…è®¸æ‚¨ç”šè‡³åœ¨äº‹åŠ¡ä¿¡æ¯è¿›å…¥WALä¹‹å‰å°±å“åº”å®¢æˆ·ç«¯-ç¦ç”¨fsyncå‡ ä¹æ˜¯å®‰å…¨çš„é€‰æ‹©
 #full_page_writes = offï¼ƒå…³æœºå¯åŠ å¿«æ­£å¸¸æ“ä½œçš„é€Ÿåº¦ï¼Œä½†å¦‚æœç³»ç»Ÿå´©æºƒï¼Œåˆ™å¯èƒ½å¯¼è‡´æ•°æ®æŸåæˆ–æ•°æ®æŸå </pre></div></div><br><h4> åœ¨å•ç‹¬çš„ç‰©ç†ç£ç›˜ä¸Šåˆ—å‡ºæ•°æ®åº“ </h4><br>  <i>è¯¥é¡¹ç›®æ˜¯å¯é€‰çš„ï¼Œè€Œæ˜¯å¯¹æˆç†Ÿçš„åˆ†å¸ƒå¼é›†ç¾¤çš„è¿‡æ¸¡è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯äº†è§£è¿™ç§å¯èƒ½æ€§å°†å¾ˆæœ‰ç”¨ã€‚</i> ä¸ºäº†åŠ é€Ÿæ•°æ®åº“ï¼Œæ‚¨å¯ä»¥å°†å…¶æ”¾åœ¨å•ç‹¬çš„ç£ç›˜ä¸Šã€‚ æˆ‘ä»¬å°†æ•´ä¸ªç£ç›˜å®‰è£…åœ¨å­˜å‚¨æ‰€æœ‰PostgreSQLæ•°æ®åº“çš„åŸºæœ¬ç›®å½•ä¸­ï¼Œä½†æ˜¯é€šå¸¸å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼è¿›è¡Œæ“ä½œï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¡¨åº“å¹¶å°†æ•°æ®åº“ï¼ˆæˆ–è€…ç”šè‡³æ˜¯æ•°æ®åº“çš„ä¸€éƒ¨åˆ†-ä¸»è¦å’Œæ±‡æ€»ç›‘è§†æ•°æ®çš„è¡¨ï¼‰è½¬ç§»åˆ°è¯¥è¡¨åº“ä¸­çš„å•ç‹¬ç£ç›˜ä¸Šã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æŒ‚è½½ç¤ºä¾‹</b> <div class="spoiler_text"> é¦–å…ˆï¼Œæ‚¨éœ€è¦ä½¿ç”¨ext4æ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–ç£ç›˜å¹¶å°†å…¶è¿æ¥åˆ°æœåŠ¡å™¨ã€‚ ä½¿ç”¨noatimeæ ‡ç­¾æŒ‚è½½æ•°æ®åº“ç£ç›˜ï¼š <br><br><pre> æŒ‚è½½/ dev / sdc1 / var / lib / pgsql / 10 /æ•°æ®/ base -o noatime </pre><br> è¦è¿›è¡Œæ°¸ä¹…å®‰è£…ï¼Œè¯·å°†è¯¥è¡Œæ·»åŠ åˆ°/ etc / fstabæ–‡ä»¶ä¸­ï¼š <br><br><pre> ï¼ƒå…¶ä¸­UUIDæ˜¯ç£ç›˜çš„æ ‡è¯†ç¬¦ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨blkidå®ç”¨ç¨‹åºæŸ¥çœ‹å®ƒ
 UUID = 121efe29-70bf-410b-bc71-90704568ce3b / var / lib / pgsql / 10 /æ•°æ®/åŸºæœ¬ext4é»˜è®¤å€¼ï¼Œnoatime 0 0 </pre><br></div></div><br><h4> ç”¨pg_pathmanå¯¹å†å²è¡¨è¿›è¡Œåˆ†åŒº </h4><br> æˆ‘ä»¬åœ¨Zabbixå‹åŠ›æµ‹è¯•æœŸé—´é‡åˆ°çš„é—®é¢˜ä¹‹ä¸€-PostgreSQLæ— æ³•ä»æ•°æ®åº“ä¸­åˆ é™¤è¿‡æ—¶çš„æ•°æ®ã€‚ ä½¿ç”¨åˆ†åŒºï¼Œæ‚¨å¯ä»¥å°†è¡¨æ‹†åˆ†ä¸ºå…¶ç»„æˆéƒ¨åˆ†ï¼Œä»è€Œå‡å°è¶…çº§è¡¨çš„ç´¢å¼•å’Œç»„æˆéƒ¨åˆ†çš„å¤§å°ï¼Œä»è€Œå¯¹æ•´ä¸ªæ•°æ®åº“çš„é€Ÿåº¦äº§ç”Ÿç§¯æå½±å“ã€‚ <br><br> åˆ†åŒºå¯ä»¥ç«‹å³è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š <br><br>  1.é€šè¿‡åˆ é™¤æ•´ä¸ªè¡¨æ¥åŠ é€Ÿè¿‡æ—¶æ•°æ®çš„åˆ é™¤ <br><br>  2.åˆ†å‰²æ¯ä¸ªç»„åˆè¡¨çš„ç´¢å¼• <br><br>  PostgreSQLä¸­æœ‰å››ç§åˆ†åŒºæœºåˆ¶ï¼š <br><br>  1.æ ‡å‡†constraint_exclusion <br><br>  2.æ‰©å±•pg_partmanï¼ˆ <i>ä¸è¦ä¸pg_pathmanæ··æ·†</i> ï¼‰ <br><br>  3.æ‰©å±•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pg_pathman</a> <br><br>  4.æ‰‹åŠ¨æ‰‹åŠ¨åˆ›å»ºå’Œç»´æŠ¤åˆ†åŒº <br><br> æˆ‘ä»¬è®¤ä¸ºï¼Œæœ€æ–¹ä¾¿ï¼Œå¯é å’Œä¼˜åŒ–çš„åˆ†åŒºè§£å†³æ–¹æ¡ˆæ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pg_pathman</a>æ‰©å±•ã€‚ ä½¿ç”¨è¿™ç§åˆ†åŒºæ–¹æ³•ï¼ŒæŸ¥è¯¢è®¡åˆ’è€…å¯ä»¥çµæ´»åœ°ç¡®å®šè¦åœ¨å“ªä¸ªåˆ†åŒºä¸­æœç´¢æ•°æ®ã€‚  <i>æœ‰ä¼ è¨€è¯´ï¼Œåœ¨PostgreSQLçš„ç¬¬12ç‰ˆä¸­ï¼Œå°†ä¼šæœ‰ä¸€ä¸ªå‡ºè‰²çš„åˆ†åŒºã€‚</i> <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å¼€å§‹å°†æ¯å¤©çš„ç›‘è§†æ•°æ®å†™å…¥ä¸çˆ¶è¡¨ä¸åŒçš„ç»§æ‰¿è¡¨ä¸­ï¼Œå¹¶ä¸”é€šè¿‡ç«‹å³åˆ é™¤æ‰€æœ‰è¿‡æ—¶çš„è¡¨å¼€å§‹åˆ é™¤è¿‡æ—¶çš„å‚æ•°å€¼ï¼Œè¿™å¯¹äºDBMSæ¥è¯´æ›´å®¹æ˜“è·å¾—äººå·¥æˆæœ¬ã€‚ åˆ é™¤æ˜¯é€šè¿‡åœ¨å‡Œæ™¨2ç‚¹é€šè¿‡è°ƒç”¨æ•°æ®åº“ç”¨æˆ·åŠŸèƒ½ä½œä¸ºZabbixæœåŠ¡å™¨çš„ç›‘è§†å‚æ•°æ¥å®Œæˆçš„ï¼Œå¹¶æŒ‡ç¤ºç»Ÿè®¡ä¿¡æ¯å­˜å‚¨çš„å¯æ¥å—èŒƒå›´ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å®‰è£…å’Œé…ç½®PostgreSQL 10çš„åˆ†åŒº</b> <div class="spoiler_text"> ä»æ ‡å‡†æ“ä½œç³»ç»Ÿå­˜å‚¨åº“å®‰è£…å’Œé…ç½®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pg_pathman</a>æ‰©å±•ï¼ˆæœ‰å…³ä»æºä»£ç æ„å»ºæ‰©å±•çš„æœ€æ–°ç‰ˆæœ¬çš„è¯´æ˜ï¼Œè¯·åœ¨githubä¸Šçš„åŒä¸€å­˜å‚¨åº“ä¸­æŸ¥æ‰¾ï¼‰ï¼š <br><br><pre>ç™¾èƒœå®‰è£…pg_pathman10
çº³ç±³/var/pgsqldb/postgresql.conf
 shared_preload_libraries ='pg_pathman'ï¼ƒé‡è¦-è¿™é‡Œå°†pg_pathmanå†™åœ¨åˆ—è¡¨çš„æœ€å
</pre><br> æˆ‘ä»¬é‡æ–°å¯åŠ¨DBMSï¼Œä¸ºæ•°æ®åº“åˆ›å»ºæ‰©å±•åå¹¶é…ç½®åˆ†åŒºï¼ˆä¸»ç›‘è§†æ•°æ®ä¸º1å¤©ï¼Œèšåˆç›‘è§†æ•°æ®ä¸º3å¤©-å¯ä»¥å®Œæˆ1å¤©ï¼‰ï¼š <br><br><pre> systemctlé‡æ–°å¯åŠ¨postgresql-10.service
 psql -d zabbix -U postgres
åˆ›å»ºæ‰©å±•pg_pathman;
 ï¼ƒä¸ºä¸»è¦ç›‘è§†æ•°æ®è¡¨é…ç½®ä¸€å¤©
 ï¼ƒ1552424400-ä»¥unixæ—¶é—´æˆ³è®°çš„å€’æ•°ï¼Œ86400-å¤©æ•°ç§’
é€‰æ‹©create_range_partitionsï¼ˆ'history'ï¼Œ'clock'ï¼Œ1552424400ï¼Œ86400ï¼‰;
é€‰æ‹©create_range_partitionsï¼ˆ'history_uint'ï¼Œ'clock'ï¼Œ1552424400ï¼Œ86400ï¼‰;
é€‰æ‹©create_range_partitionsï¼ˆ'history_text'ï¼Œ'clock'ï¼Œ1552424400ï¼Œ86400ï¼‰;
é€‰æ‹©create_range_partitionsï¼ˆ'history_str'ï¼Œ'clock'ï¼Œ1552424400ï¼Œ86400ï¼‰;
é€‰æ‹©create_range_partitionsï¼ˆ'history_log'ï¼Œ'clock'ï¼Œ1552424400ï¼Œ86400ï¼‰;
 ï¼ƒé…ç½®ä¸‰å¤©çš„æ±‡æ€»ç›‘è§†æ•°æ®è¡¨
 ï¼ƒ1552424400-ä»¥unixæ—¶é—´æˆ³è®°çš„å€’æ•°ï¼Œ259200-ä¸‰å¤©å†…çš„ç§’æ•°
é€‰æ‹©create_range_partitionsï¼ˆ'trends'ï¼Œ'clock'ï¼Œ1545771600ï¼Œ259200ï¼‰;  
é€‰æ‹©create_range_partitionsï¼ˆ'trends_uint'ï¼Œ'clock'ï¼Œ1545771600ï¼Œ259200ï¼‰; 
</pre><br>  <i>å¦‚æœä»»ä½•è¡¨ä¸­éƒ½æ²¡æœ‰æ•°æ®ï¼Œåˆ™åœ¨è°ƒç”¨create_range_partitionså‡½æ•°æ—¶ï¼Œå¿…é¡»å†ä¼ é€’ä¸€ä¸ªé™„åŠ å‚æ•°p_count = 0_ã€‚</i> <br><br> ç”¨äºç›‘è§†å’Œç®¡ç†åˆ†åŒºçš„æœ‰ç”¨æŸ¥è¯¢ï¼š <br><br><pre> ï¼ƒåˆ†åŒºè¡¨çš„ä¸€èˆ¬åˆ—è¡¨ï¼Œä¸»è¦é…ç½®å­˜å‚¨ï¼š
ä»pathman_configä¸­é€‰æ‹©*;
 ï¼ƒè¡¨ç¤ºæ‰€æœ‰ç°æœ‰èŠ‚åŠå…¶çˆ¶çº§å’ŒèŒƒå›´è¾¹ç•Œï¼š
ä»pathman_partition_listä¸­é€‰æ‹©*ï¼›
 ï¼ƒè¦†ç›–æ ‡å‡†pg_pathmanè¡Œä¸ºçš„å…¶ä»–å‚æ•°ï¼š
ä»pathman_config_paramsä¸­é€‰æ‹©*;
 ï¼ƒå°†å†…å®¹å¤åˆ¶å›çˆ¶è¡¨å¹¶åˆ é™¤åˆ†åŒºï¼š
é€‰æ‹©drop_partitionsï¼ˆ'table_name':: regclassï¼Œfalseï¼‰;
</pre><br> æŸ¥çœ‹åˆ†åŒºæ•°é‡å’Œå¤§å°çš„ç»Ÿè®¡ä¿¡æ¯çš„æœ‰ç”¨è„šæœ¬ï¼š <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> nspname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> schemaname, relname, relkind, <span class="hljs-keyword"><span class="hljs-keyword">cast</span></span> (reltuples <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>), pg_size_pretty(pg_relation_size(C.oid)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">"size"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_class C <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace N <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> (N.oid = C.relnamespace) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> nspname <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-string"><span class="hljs-string">'pg_catalog'</span></span>, <span class="hljs-string"><span class="hljs-string">'information_schema'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (relname <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'history%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> relname <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'trends%'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> relkind = <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-comment"><span class="hljs-comment">-- and reltuples &gt; 0 -- and pg_relation_size(C.oid) &gt;= 0 ORDER BY schemaname, relname</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">è‡ªåŠ¨è°ƒæ•´åˆ é™¤è¿‡æ—¶çš„åˆ†åŒºï¼ˆahtung-ä¸€ä¸ªå¾ˆå¤§çš„SQLå‡½æ•°ï¼‰</b> <div class="spoiler_text"> è¦é…ç½®åˆ†åŒºçš„è‡ªåŠ¨åˆ é™¤ï¼Œæ‚¨éœ€è¦åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªå‡½æ•° <br>  ï¼ˆå®½æ–‡æœ¬ï¼Œå› æ­¤æˆ‘å¿…é¡»åˆ é™¤è¯­æ³•é«˜äº®æ˜¾ç¤ºï¼‰ï¼š <br><br><pre>åˆ›å»ºæˆ–æ›¿æ¢åŠŸèƒ½public.delete_old_partitionsï¼ˆhistory_daysæ•´æ•°ï¼Œtrends_daysæ•´æ•°ï¼Œstr_daysæ•´æ•°ï¼‰
 è¿”å›æ–‡å­—
 è¯­è¨€plpgsql
 AS $åŠŸèƒ½$
 / *
è¯¥å‡½æ•°åˆ é™¤æ‰€æœ‰æ—©äºæŒ‡å®šå¤©æ•°çš„åˆ†åŒºï¼š
 history_days-ç”¨äºåˆ†åŒºhistory_xï¼Œhistory_uint_x
 Trends_days-å¯¹äºè¶‹åŠ¿è¶‹åŠ¿_xï¼Œè¶‹åŠ¿è¶‹åŠ¿_uint_xåˆ†åŒº
 str_days-ç”¨äºåˆ†åŒºhistory_str_xï¼Œhistory_text_xï¼Œhistory_log_x
 * /
å£°æ˜clock_today_start int;
å£°æ˜clock_delete_less_history int = 0;
å£°æ˜clock_delete_less_trends int = 0;
å£°æ˜clock_delete_less_strings int = 0;
 clock_delete_less int = 0;
å£°æ˜è¿­ä»£å™¨int = 0;
å£°æ˜result_str text ='';
å£°æ˜buf_table_sizeæ–‡æœ¬ï¼›
å£°æ˜buf_table_lenæ–‡æœ¬ï¼›
å£°æ˜partition_nameæ–‡æœ¬ï¼›
å£°æ˜clock_maxæ–‡æœ¬ï¼›
å£°æ˜err_detailæ–‡æœ¬ï¼›
å£°æ˜t_start timestamp = clock_timestampï¼ˆï¼‰;
å£°æ˜t_endæ—¶é—´æˆ³ï¼›
å¼€å§‹
    å¦‚æœ$ 1 &lt;= 0ï¼Œåˆ™è¿”å›'upsï¼Œå‡ºäº†ç‚¹é—®é¢˜ï¼šhistory_dayså‚æ•°å¿…é¡»ä¸ºæ­£æ•´æ•°å€¼'; å¦‚æœç»“æŸ
    å¦‚æœ$ 2 &lt;= 0ï¼Œåˆ™è¿”å›'upsï¼Œå‡ºäº†ç‚¹é—®é¢˜ï¼štrends_dayså‚æ•°å¿…é¡»ä¸ºæ­£æ•´æ•°å€¼'; å¦‚æœç»“æŸ
    å¦‚æœ$ 3 &lt;= 0ï¼Œåˆ™è¿”å›'upsï¼Œå‡ºäº†ç‚¹é—®é¢˜ï¼šstr_dayså‚æ•°å¿…é¡»ä¸ºæ­£æ•´æ•°å€¼'; å¦‚æœç»“æŸ
     clock_today_start =æå–ï¼ˆdate_truncçš„çºªå…ƒï¼ˆ'day'ï¼Œç°åœ¨ï¼ˆï¼‰ï¼‰ï¼‰:: int;
     clock_delete_less_history =æå–ï¼ˆdate_truncï¼ˆ'day'ï¼Œnowï¼ˆï¼‰ï¼‰ä¸­çš„æ—¶æœŸ-ï¼ˆ$ 1 :: text ||'days'ï¼‰:: intervalï¼‰:: int;
     clock_delete_less_trends =æå–ï¼ˆdate_truncï¼ˆ'day'ï¼Œnowï¼ˆï¼‰ï¼‰ä¸­çš„çºªå…ƒ-ï¼ˆ$ 2 ::æ–‡æœ¬||'days'ï¼‰::é—´éš”ï¼‰:: int;
     clock_delete_less_strings =æå–ï¼ˆdate_truncï¼ˆ'day'ï¼Œnowï¼ˆï¼‰ï¼‰ä¸­çš„æ—¶æœŸ-ï¼ˆ$ 3 ::æ–‡æœ¬||'days'ï¼‰::é—´éš”ï¼‰:: int;
     clock_delete_less =æœ€å°‘ï¼ˆclock_delete_less_historyï¼Œclock_delete_less_trendsï¼Œclock_delete_less_stringsï¼‰ï¼›
     -æé«˜é€šçŸ¥'clock_today_startï¼…ï¼ˆï¼…ï¼‰'ï¼Œto_timestampï¼ˆclock_today_startï¼‰ï¼Œclock_today_start;
     -æé«˜é€šçŸ¥'clock_delete_less_historyï¼…ï¼ˆï¼…ï¼‰ï¼…å¤©'ï¼Œto_timestampï¼ˆclock_delete_less_historyï¼‰ï¼Œclock_delete_less_historyï¼Œ$ 1;
     -æé«˜é€šçŸ¥'clock_delete_less_trendsï¼…ï¼ˆï¼…ï¼‰ï¼…days'ï¼Œto_timestampï¼ˆclock_delete_less_trendsï¼‰ï¼Œclock_delete_less_trendsï¼Œ$ 2;
     -æé«˜é€šçŸ¥'clock_delete_less_stringsï¼…ï¼ˆï¼…ï¼‰ï¼…days'ï¼Œto_timestampï¼ˆclock_delete_less_stringsï¼‰ï¼Œclock_delete_less_stringsï¼Œ$ 3;
    å¯¹äºpartition_nameï¼Œåœ¨é€‰æ‹©åˆ†åŒºä¸­ä¸ºclock_maxï¼Œåœ¨pathman_partition_listä¸­ä¸ºrange_maxï¼Œå…¶ä¸­ 
     range_max :: int &lt;=æœ€å¤§å€¼ï¼ˆclock_delete_less_historyï¼Œclock_delete_less_trendsï¼Œclock_delete_less_stringsï¼‰å’Œ 
     ï¼ˆåˆ†åŒº::æ–‡æœ¬ï¼ˆå¦‚â€œå†å²ï¼…â€ï¼‰æˆ–åˆ†åŒº::æ–‡æœ¬ï¼ˆå¦‚â€œè¶‹åŠ¿ï¼…â€ï¼‰ï¼‰æŒ‰åˆ†åŒºå‡åºæ’åˆ—
    å¾ªç¯
        å¦‚æœï¼ˆpartition_nameã€œ'history_uint_ \ d'å’Œclock_max :: int &lt;= clock_delete_less_historyï¼‰
        æˆ–ï¼ˆpartition_nameã€œ'history_ \ d'å’Œclock_max :: int &lt;= clock_delete_less_historyï¼‰
        æˆ–ï¼ˆpartition_nameã€œ'trends_ \ d'and clock_max :: int &lt;= clock_delete_less_trendsï¼‰
        æˆ–ï¼ˆpartition_nameã€œ'history_log_ \ d'å’Œclock_max :: int &lt;= clock_delete_less_stringsï¼‰
        æˆ–ï¼ˆpartition_nameã€œ'history_str_ \ d'å’Œclock_max :: int &lt;= clock_delete_less_stringsï¼‰
        æˆ–ï¼ˆpartition_nameã€œ'history_text_ \ d'å’Œclock_max :: int &lt;= clock_delete_less_stringsï¼‰
        ç„¶å 
            è¿­ä»£å™¨=è¿­ä»£å™¨+ 1;
            å¼•å‘é€šçŸ¥'ï¼…'ï¼Œæ ¼å¼ï¼ˆ'!!! deleteï¼…sï¼…s'ï¼Œpartition_nameï¼Œclock_maxï¼‰;
            ä»pg_classä¸­é€‰æ‹©maxï¼ˆreltuples :: intï¼‰ï¼Œpg_size_prettyï¼ˆsumï¼ˆpg_relation_sizeï¼ˆpg_class.oidï¼‰ï¼‰ï¼‰ä½œä¸ºâ€œå¤§å°â€ï¼Œå…¶ä¸­relnameå¦‚partition_name ||  'ï¼…'è½¬æ¢ä¸ºä¸¥æ ¼çš„buf_table_lenï¼Œbuf_table_sizeï¼›
            å¦‚æœresult_strï¼=''ï¼Œåˆ™result_str = result_str ||  'ï¼Œ'; å¦‚æœç»“æŸ
             result_str = result_str || æ ¼å¼ï¼ˆ'ï¼…sï¼ˆdt &lt;ï¼…sï¼Œlenï¼…sï¼Œï¼…sï¼‰'ï¼Œpartition_nameï¼Œto_charï¼ˆto_timestampï¼ˆclock_max :: intï¼‰ï¼Œ'YYYY-MM-DD'ï¼‰ï¼Œbuf_table_lenï¼Œbuf_table_sizeï¼‰;
            æ‰§è¡Œæ ¼å¼ï¼ˆå¦‚æœå­˜åœ¨ï¼…sï¼Œåˆ™åˆ é™¤è¡¨ï¼Œpartition_nameï¼‰ï¼›
        å¦‚æœç»“æŸ
    ç»“æŸå¾ªç¯
    å¦‚æœiterator = 0ï¼Œåˆ™result_str = formatï¼ˆâ€œæ²¡æœ‰åˆ†åŒºå¯åˆ é™¤è¾ƒæ—§çš„æ—¥æœŸï¼Œåˆ™ä¸ºï¼…sæ—¥æœŸâ€ï¼Œto_charï¼ˆto_timestampï¼ˆclock_delete_lessï¼‰ï¼Œâ€œ YYYY-MM-DDâ€ï¼‰ï¼‰ï¼› 
    å¦åˆ™result_str =æ ¼å¼ï¼ˆâ€œå·²åˆ é™¤çš„ï¼…sä¸ªåˆ†åŒºï¼Œä»¥ï¼…sç§’ä¸ºå•ä½ï¼šâ€ï¼Œè¿­ä»£å™¨ï¼Œæˆªæ–­ï¼ˆæå–ï¼ˆä»ï¼ˆclock_timestampï¼ˆï¼‰-t_startï¼‰çš„ç§’æ•°ï¼‰::æ•°å­—3ï¼‰ï¼‰  result_str;
    å¦‚æœç»“æŸ
     -æé«˜é€šçŸ¥'ï¼…'ï¼Œresult_str;
    è¿”å›result_str;
å½“åˆ«äººé‚£ä¹ˆä¾‹å¤–
   è·å¾—å †å çš„è¯Šæ–­ä¿¡æ¯err_detail = PG_EXCEPTION_CONTEXT;
   è¿”å›æ ¼å¼ï¼ˆ'upsï¼Œå‡ºäº†ç‚¹é—®é¢˜ï¼šï¼…s [err codeï¼…s]ï¼Œï¼…s'ï¼Œsqlerrmï¼Œsqlstateï¼Œerr_detailï¼‰ï¼›
ç»“æŸ 
 $åŠŸèƒ½$;
</pre><br> è¦è‡ªåŠ¨è°ƒç”¨è‡ªåŠ¨æ¸…ç†åˆ†åŒºåŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨ä»¥ä¸‹è®¾ç½®ä¸ºâ€œæ•°æ®åº“ç›‘è§†å™¨â€ç±»å‹çš„zabbixæœåŠ¡å™¨ä¸»æœºåˆ›å»ºä¸€ä¸ªæ•°æ®é¡¹ï¼š <br><br><pre> -ç±»å‹ï¼šæ•°æ®åº“ç›‘è§†å™¨
 -åç§°ï¼šdelete_old_history_partitions
 -é”®ï¼šdb.odbc.select [delete_old_history_partitionsï¼Œzabbix]
 -sqlè¡¨è¾¾å¼ï¼šé€‰æ‹©delete_old_partitionsï¼ˆ3ï¼Œ30ï¼Œ30ï¼‰;
 ï¼ƒåœ¨è¿™é‡Œï¼Œdelete_old_partitionså‡½æ•°è°ƒç”¨çš„å‚æ•°ä»¥å¤©ä¸ºå•ä½æŒ‡ç¤ºå­˜å‚¨æ—¶é—´ 
 ï¼ƒç”¨äºæ•°å­—å€¼ï¼Œèšåˆæ•°å­—å€¼å’Œå­—ç¬¦ä¸²å€¼
 -æ•°æ®ç±»å‹ï¼šæ–‡æœ¬
 -æ›´æ–°é—´éš”ï¼š0
 -ç”¨æˆ·é—´éš”ï¼šè®¡åˆ’ä¸ºh2
 -å†å²è®°å½•å­˜å‚¨æœŸï¼š90å¤©
 -æ•°æ®å…ƒç´ ç»„ï¼šæ•°æ®åº“
</pre><br> ç»“æœï¼Œæˆ‘ä»¬å°†è·å¾—å¤§çº¦ä»¥ä¸‹ç±»å‹çš„åˆ†åŒºæ¸…ç†ç»Ÿè®¡ä¿¡æ¯ï¼š <br><br><pre>  2019-09-16 02:00:00ï¼Œåœ¨0.024ç§’å†…åˆ é™¤äº†3ä¸ªåˆ†åŒºï¼štrends_78ï¼ˆdt &lt;2019-08-17ï¼Œlen 1ï¼Œ48 kBï¼‰ï¼Œhistory_193ï¼ˆdt &lt;2019-09-13ï¼Œlen 85343ï¼Œ9448 kB ï¼‰ï¼Œhistory_uint_186ï¼ˆdt &lt;2019-09-13ï¼Œlen 27969ï¼Œ3480 kBï¼‰
</pre><br>  <b>é‡è¦ï¼</b> é€šè¿‡æ•°æ®å…ƒç´ å’Œç”¨æˆ·åŠŸèƒ½è®¾ç½®åˆ†åŒºè‡ªåŠ¨åˆ é™¤åï¼Œæ‚¨éœ€è¦åœ¨ç®¡å®¶Zabbixä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­å…³é—­å†å²è®°å½•å’Œè¶‹åŠ¿æ¸…é™¤ï¼š <i>é€šè¿‡</i> zabbix <i>èœå•é¡¹ï¼Œä»è§’è½çš„åˆ—è¡¨ä¸­é€‰æ‹©â€œç®¡ç†â€-&gt;â€œå¸¸è§„â€-&gt;é€‰æ‹©â€œæ¸…é™¤å†å²è®°å½•â€-&gt;ç¦ç”¨â€œå†å²è®°å½•â€å’Œâ€œåŠ¨æ€å˜åŒ–â€éƒ¨åˆ†ä¸­çš„æ‰€æœ‰å¤é€‰æ¡†ã€‚</i> <br></div></div><br><h4> å°†å†å²è®°å½•è¡¨çš„ç´¢å¼•ç±»å‹æ›´æ”¹ä¸ºbrinï¼ˆæ—¶é’Ÿï¼‰å’Œbtree-ginï¼ˆitemidï¼‰ </h4><br> ç‰¹åˆ«æ„Ÿè°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">erogov</a>æä¾›äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰å…³PostgreSQLç´¢å¼•</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡ºè‰²çš„æ¦‚è¿°æ–‡ç« ç³»åˆ—</a> ã€‚  <i>ç”šè‡³æ•´ä¸ªPostgresPROå›¢é˜Ÿã€‚</i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™äº›æ–‡ç« ç»™æˆ‘ä»¬ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ï¼Œæˆ‘ä»¬åœ¨ç›‘è§†æ•°æ®è¡¨ä¸Šä½¿ç”¨äº†ä¸åŒç±»å‹çš„ç´¢å¼•ï¼Œå¹¶å¾—å‡ºç»“è®ºï¼Œå“ªäº›å­—æ®µä¸Šçš„ç´¢å¼•ç±»å‹å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°æé«˜æ€§èƒ½ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ®è§‚å¯Ÿï¼Œæ‰€æœ‰çš„é»˜è®¤è¡¨ç›‘æµ‹æ•°æ®åˆ›å»ºå¤åˆBæ ‘ç´¢å¼•ï¼ˆä¸ºitemidï¼Œæ—¶é’Ÿï¼‰ -å®ƒçš„å¿«é€ŸæŸ¥æ‰¾ï¼Œå°¤å…¶æ˜¯å¯¹äºå•è°ƒæœ‰åºå€¼ï¼Œä½†åœ¨ç£ç›˜ä¸Šå¾ˆâ€œè†¨èƒ€â€ï¼Œå½“å¤§é‡çš„æ•°æ®- 1000ä¸‡</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¾åœ¨æ¡Œå­ä¸Šé»˜è®¤æƒ…å†µä¸‹ï¼ŒæŒ‰å°æ—¶æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯é€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œå°½ç®¡æ­¤å¤„åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨çº§åˆ«æä¾›äº†è¿™äº›ç”¨äºæ•°æ®å­˜å‚¨å’Œå”¯ä¸€æ€§çš„è¡¨ï¼Œå¹¶ä¸”å”¯ä¸€ç´¢å¼•åªä¼šå‡æ…¢æ•°æ®æ’å…¥çš„é€Ÿåº¦ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æµ‹è¯•å„ç§ç´¢å¼•æœŸé—´ï¼Œå‘ç°äº†æœ€æˆåŠŸçš„ç´¢å¼•ç»„åˆï¼šæ‰€æœ‰ç›‘è§†æ•°æ®è¡¨çš„æ—¶é’Ÿå­—æ®µä¸Šçš„brinç´¢å¼•å’Œitemidå­—æ®µä¸Šçš„btree-ginç´¢å¼•ã€‚</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">brinç´¢å¼•éå¸¸é€‚åˆå•è°ƒå¢åŠ æ•°æ®ï¼Œä¾‹å¦‚äº‹ä»¶äº‹å®çš„æ—¶é—´æˆ³ï¼Œå³ </font><font style="vertical-align: inherit;">ç”¨äºæ—¶é—´åºåˆ—ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”btree-ginç´¢å¼•æœ¬è´¨ä¸Šæ˜¯æ ‡å‡†æ•°æ®ç±»å‹ä¸Šçš„ginç´¢å¼•ï¼Œé€šå¸¸æ¯”ç»å…¸btreeç´¢å¼•è¦å¿«å¾—å¤šï¼Œå› ä¸º </font><font style="vertical-align: inherit;">åœ¨æ·»åŠ æ–°å€¼æœŸé—´ï¼Œä¸ä¼šé‡å»ºginç´¢å¼•ï¼Œè€Œä»…å¯¹å…¶è¿›è¡Œè¡¥å……ã€‚</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†btree-ginç´¢å¼•ä½œä¸ºPostgreSQLçš„æ‰©å±•ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹é¢ç»™å‡ºäº†æ­¤ç´¢å¼•ç­–ç•¥å’Œé»˜è®¤æƒ…å†µä¸‹Zabbixæ•°æ®åº“ä¸­ç´¢å¼•çš„é‡‡æ ·é€Ÿåº¦çš„æ¯”è¾ƒã€‚</font><font style="vertical-align: inherit;">åœ¨è´Ÿè½½æµ‹è¯•æœŸé—´ï¼Œæˆ‘ä»¬ä¸ºä¸‰ä¸ªåˆ†åŒºç´¯ç§¯äº†ä¸‰å¤©çš„æ•°æ®ï¼š</font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ†åŒºåç§° </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MLNä¸­çš„è¡Œæ•° </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¤§å°ï¼ˆMBï¼‰ </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> history_uint_1 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 81.3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4119 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> history_uint_2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 74.9 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4426 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> history_uint_3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 100.7 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5387 </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸ºäº†è¯„ä¼°ç»“æœï¼Œæ‰§è¡Œäº†ä¸‰ç§ç±»å‹çš„æŸ¥è¯¢ï¼š </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯¹äºä¸€ä¸ªç‰¹å®šçš„å‚æ•°itemidï¼Œæœ€åä¸€ä¸ªæœˆçš„æ•°æ®ï¼Œå®é™…ä¸Šæ˜¯æœ€è¿‘ä¸‰å¤©ï¼ˆæ€»å…±1660æ¡è®°å½•ï¼‰ </font></font><br><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£é‡Šåˆ†æselect * from history_uintå…¶ä¸­itemid = 313300</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å’Œæ—¶é’Ÿ&gt; =æå–ï¼ˆä»'2019-03-09 00:00:00'çš„æ—¶é—´::æ—¶é—´æˆ³ï¼‰::æ•´æ•°</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å’Œæ—¶é’Ÿ&lt;=æå–ï¼ˆæ¥è‡ª'2019-04-09 12:00:00'çš„æ—¶é—´::æ—¶é—´æˆ³ï¼‰:: int;</font></font><font></font>
</pre></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸€å¤©12ä¸ªå°æ—¶ä¸­çš„ä¸€ä¸ªç‰¹å®šå‚æ•°æ•°æ®ï¼ˆæ€»å…±649ä¸ªæ¡ç›®ï¼‰ </font></font><br><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£é‡Šåˆ†æselect * from history_textå…¶ä¸­itemid = 310650</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å’Œæ—¶é’Ÿ&gt; =æå–ï¼ˆä»'2019-04-09 00:00:00'çš„æ—¶é—´::æ—¶é—´æˆ³ï¼‰:: int</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å’Œæ—¶é’Ÿ&lt;=æå–ï¼ˆæ¥è‡ª'2019-04-09 12:00:00'çš„æ—¶é—´::æ—¶é—´æˆ³ï¼‰:: int;</font></font><font></font>
</pre></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸€å°æ—¶çš„ä¸€ä¸ªç‰¹å®šå‚æ•°æ•°æ®ï¼ˆæ€»å…±61æ¡è®°å½•ï¼‰ï¼š </font></font><br><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯´æ˜ä»history_textåˆ†æé€‰æ‹©è®¡æ•°ï¼ˆ*ï¼‰ï¼Œå…¶ä¸­itemid = 336540</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å’Œæ—¶é’Ÿ&gt; =æå–ï¼ˆä»'2019-04-08 11:00:00'å¼€å§‹çš„æ—¶é—´::æ—¶é—´æˆ³ï¼‰::æ•´æ•°</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å’Œæ—¶é’Ÿ&lt;=æå–ï¼ˆæ¥è‡ª'2019-04-08 12:00:00'çš„æ—¶é—´::æ—¶é—´æˆ³ï¼‰:: int;</font></font><font></font>
</pre></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æµ‹è¯•ç»“æœåˆ—è¡¨å¦‚ä¸‹ï¼š </font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç´¢å¼•ç±»å‹ </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¤§å°ï¼ˆMBï¼‰* </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¯·æ±‚1 **ä»¥æ¯«ç§’ä¸ºå•ä½ </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¯·æ±‚2 **ä»¥æ¯«ç§’ä¸ºå•ä½ </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¯·æ±‚3 **ä»¥æ¯«ç§’ä¸ºå•ä½ </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> btreeï¼ˆæ—¶é’Ÿï¼Œitemidï¼‰ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14741 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7154.3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2205.3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1860.4 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸ƒæ—ï¼ˆæ—¶é’Ÿï¼‰ï¼Œ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">btree-æœæ¾å­é…’ï¼ˆitemidï¼‰</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.42å’Œ1329 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2958.2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1820.4 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 102.1 </font></font></td></tr></tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*ä¸‰ä¸ªåˆ†åŒºçš„æ€»å¤§å°ï¼ˆä»¥MBä¸ºå•ä½ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">**ç±»å‹1è¯·æ±‚-3å¤©çš„æ•°æ®ï¼Œç±»å‹2è¯·æ±‚-12å°æ—¶çš„æ•°æ®ï¼Œç±»å‹3è¯·æ±‚-1å°æ—¶çš„æ•°æ®</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»æ¯”è¾ƒè¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œå…·æœ‰è®°å½•æ•°çš„å¤§å‹æ•°æ®è¡¨è¶…è¿‡1äº¿ä¸ªæ•°æ®æ¸…æ¥šåœ°è¡¨æ˜ï¼Œå°†æ ‡å‡†å¤åˆç´¢å¼•btreeæ›´æ”¹ä¸ºä¸¤ä¸ªç´¢å¼•brinå’Œbtree-ginå¯¹å‡å°‘ç´¢å¼•çš„å¤§å°å’ŒåŠ å¿«æŸ¥è¯¢æ‰§è¡Œæ—¶é—´å…·æœ‰æœ‰ç›Šçš„ä½œç”¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹é¢ä»¥å‘history_uintå’Œtrends_uintè¡¨æ·»åŠ æ–°è®°å½•çš„è¯·æ±‚ä¸ºä¾‹ï¼Œæ˜¾ç¤ºäº†ç´¢å¼•å’Œåˆ†åŒºçš„æ•ˆç‡ï¼ˆæ¯ä¸ªæŸ¥è¯¢å¹³å‡æ·»åŠ 2000ä¸ªå€¼ï¼‰ã€‚</font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¡Œå­ </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¹³å‡æ”¹å–„æ—¶é—´ï¼Œæ¯«ç§’ </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ”¹è¿›åçš„å¹³å‡è¯·æ±‚æ—¶é—´ï¼Œæ¯«ç§’ </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Trends_uint </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2201.48 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.72 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Trends_uint </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1997.27 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 62.16 </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»ç»“zabbixç³»ç»Ÿç›‘è§†æ•°æ®è¡¨çš„å„ç§ç´¢å¼•é…ç½®çš„æµ‹è¯•ç»“æœï¼Œå¯ä»¥è¯´zabbixç›‘è§†æ•°æ®è¡¨çš„æ ‡å‡†ç´¢å¼•çš„ç±»ä¼¼å˜åŒ–ä¼šå¯¹æ•´ä½“ç³»ç»Ÿæ€§èƒ½äº§ç”Ÿç§¯æå½±å“ï¼Œå½“ç´¯ç§¯çš„æ•°æ®é‡è¶…è¿‡1000ä¸‡æ—¶ï¼Œè¿™ç§æ„Ÿè§‰æœ€ä¸ºæ˜æ˜¾ã€‚æ‚¨åº”è¯¥å¿˜è®°é»˜è®¤æƒ…å†µä¸‹æ ‡å‡†btreeç´¢å¼•â€œè†¨èƒ€â€çš„é—´æ¥å½±å“-é¢‘ç¹é‡å»ºæ•°åƒå…†å­—èŠ‚çš„ç´¢å¼•ä¼šå¯¼è‡´ç¡¬ç›˜è´Ÿæ‹…é‡ï¼ˆåˆ©ç”¨ç‡ï¼‰æ—¶é—´ï¼‰ï¼Œè¿™æœ€ç»ˆä¼šå¢åŠ ç£ç›˜æ“ä½œæ—¶é—´å’Œç­‰å¾…ä»CPUè®¿é—®ç£ç›˜çš„æ—¶é—´ï¼ˆiowaitæŒ‡æ ‡ï¼‰ã€‚</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸ºäº†ä½¿btree-ginç´¢å¼•å¯ä»¥ä½¿ç”¨bigintï¼ˆin8ï¼‰æ•°æ®ç±»å‹ï¼ˆå³itemidåˆ—ï¼‰ï¼Œæ‚¨éœ€è¦ä¸ºbtree-ginç´¢å¼•æ³¨å†Œbigintç±»å‹çš„è¿ç®—ç¬¦ç³»åˆ—ã€‚ </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºbtree-ginç´¢å¼•æ³¨å†Œä¸€ä¸ªbigintè¿ç®—ç¬¦æ—</font></font></b> <div class="spoiler_text"><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥è„šæœ¬å…è®¸æ‚¨åœ¨bigintegerå’Œintegeræ•°æ®ç±»å‹ä¸Šå®Œå…¨ä½¿ç”¨ginç´¢å¼•ï¼Œè€Œæ— éœ€æ˜¾å¼ç±»å‹è½¬æ¢ã€‚</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é—®é¢˜-æœæ¾å­é…’æŒ‡æ•°ç¼ºå°‘int2ï¼Œint4ï¼Œint8ï¼Œ</font></font><font></font>
       bigint     ,     bigint (&lt;= 2147483647)<font></font>
        intger_ops,  :<font></font>
create index on tablename using gin(columnname int8_family_ops) with (fastupdate = false);<font></font>
*/<font></font>
<font></font>
--       btree_gin<font></font>
CREATE EXTENSION btree_gin;<font></font>
<font></font>
CREATE OPERATOR FAMILY integer_ops using gin;<font></font>
<font></font>
CREATE OPERATOR CLASS int4_family_ops<font></font>
FOR TYPE int4 USING gin FAMILY integer_ops<font></font>
AS<font></font>
    OPERATOR 1 &lt;,<font></font>
    OPERATOR 2 &lt;=,<font></font>
    OPERATOR 3 =,<font></font>
    OPERATOR 4 &gt;=,<font></font>
    OPERATOR 5 &gt;,<font></font>
    FUNCTION 1 btint4cmp(int4,int4),<font></font>
    FUNCTION 2 gin_extract_value_int4(int4, internal),<font></font>
    FUNCTION 3 gin_extract_query_int4(int4, internal, int2, internal, internal),<font></font>
    FUNCTION 4 gin_btree_consistent(internal, int2, anyelement, int4, internal, internal),<font></font>
    FUNCTION 5 gin_compare_prefix_int4(int4,int4,int2, internal),<font></font>
STORAGE int4;<font></font>
<font></font>
CREATE OPERATOR CLASS int8_family_ops<font></font>
FOR TYPE int8 USING gin FAMILY integer_ops<font></font>
AS<font></font>
    OPERATOR 1 &lt;,<font></font>
    OPERATOR 2 &lt;=,<font></font>
    OPERATOR 3 =,<font></font>
    OPERATOR 4 &gt;=,<font></font>
    OPERATOR 5 &gt;,<font></font>
    FUNCTION 1 btint8cmp(int8,int8),<font></font>
    FUNCTION 2 gin_extract_value_int8(int8, internal),<font></font>
    FUNCTION 3 gin_extract_query_int8(int8, internal, int2, internal, internal),<font></font>
    FUNCTION 4 gin_btree_consistent(internal, int2, anyelement, int4, internal, internal),<font></font>
    FUNCTION 5 gin_compare_prefix_int8(int8,int8,int2, internal),<font></font>
STORAGE int8;<font></font>
<font></font>
ALTER OPERATOR FAMILY integer_ops USING gin add<font></font>
  OPERATOR 1 &lt;(int4,int8),<font></font>
  OPERATOR 2 &lt;=(int4,int8),<font></font>
  OPERATOR 3 =(int4,int8),<font></font>
  OPERATOR 4 &gt;=(int4,int8),<font></font>
  OPERATOR 5 &gt;(int4,int8);<font></font>
<font></font>
ALTER OPERATOR FAMILY integer_ops USING gin add<font></font>
  OPERATOR 1 &lt;(int8,int4),<font></font>
  OPERATOR 2 &lt;=(int8,int4),<font></font>
  OPERATOR 3 =(int8,int4),<font></font>
  OPERATOR 4 &gt;=(int8,int4),<font></font>
  OPERATOR 5 &gt;(int8,int4);<font></font>
</pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥è„šæœ¬å°†Zabbixçš„PostgreSQLæ•°æ®åº“ä¸­çš„æ‰€æœ‰ç´¢å¼•ä»é»˜è®¤é…ç½®é‡æ–°åˆ†é…åˆ°ä¸Šè¿°æœ€ä½³é…ç½®ã€‚</font></font></b> <div class="spoiler_text"><pre>/*<font></font>
        <font></font>
*/<font></font>
<font></font>
--   <font></font>
drop index history_1;<font></font>
drop index history_uint_1;<font></font>
drop index history_str_1;<font></font>
drop index history_text_1;<font></font>
drop index history_log_1;<font></font>
--          PK <font></font>
-- (   ,         )<font></font>
alter table trends drop constraint trends_pk;<font></font>
alter table trends_uint drop constraint trends_uint_pk;<font></font>
<font></font>
--     bree-gin   itemid    <font></font>
--   btree-gin  bigint       <font></font>
-- https://habr.com/ru/company/postgrespro/blog/340978/#comment_10545932<font></font>
--    create extension btree_gin;<font></font>
create index on history using gin(itemid int8_family_ops) with (fastupdate = false);<font></font>
create index on history_uint using gin(itemid int8_family_ops) with (fastupdate = false);<font></font>
create index on history_str using gin(itemid int8_family_ops) with (fastupdate = false);<font></font>
create index on history_text using gin(itemid int8_family_ops) with (fastupdate = false);<font></font>
create index on history_log using gin(itemid int8_family_ops) with (fastupdate = false);<font></font>
create index on trends using gin(itemid int8_family_ops) with (fastupdate = false);<font></font>
create index on trends_uint using gin(itemid int8_family_ops) with (fastupdate = false);<font></font>
<font></font>
--     bree-gin   itemid    <font></font>
--     brin    128 ,    <font></font>
--           ,<font></font>
--      https://habr.com/ru/company/postgrespro/blog/346460/<font></font>
create index on history using brin(clock) with (pages_per_range = 128);<font></font>
create index on history_uint using brin(clock) with (pages_per_range = 128);<font></font>
create index on history_str using brin(clock) with (pages_per_range = 128);<font></font>
create index on history_text using brin(clock) with (pages_per_range = 128);<font></font>
create index on history_log using brin(clock) with (pages_per_range = 128);<font></font>
create index on trends using brin(clock) with (pages_per_range = 128);<font></font>
create index on trends_uint using brin(clock) with (pages_per_range = 128);<font></font>
</pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºå¼ºåº¦ä¸ºæ¯åˆ†é’Ÿ100å¨å‚æ•°ï¼ˆå†å²ä¸Šä¸º100å¨ï¼Œå†å²ä¸Šä¸º100å¨ï¼Œhistory_uintï¼‰çš„æ•°æ®é‡çš„brinç´¢å¼•ï¼Œæ³¨æ„åˆ°è¯¥ç´¢å¼•é€‚ç”¨äºä¸»è¦ç›‘è§†æ•°æ®è¡¨ï¼Œå…¶åŒºåŸŸå¤§å°ä¸º512é¡µï¼Œæ˜¯ä¸¤å€è€Œä¸æ˜¯æ ‡å‡†é¡µé¢å¤§å°ä¸º128é¡µï¼Œä½†è¿™æ˜¯å•ç‹¬çš„ï¼Œå¹¶å–å†³äºè¡¨çš„å¤§å°å’ŒæœåŠ¡å™¨é…ç½®ã€‚æ— è®ºå¦‚ä½•ï¼Œbrinç´¢å¼•å ç”¨çš„ç©ºé—´å¾ˆå°ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å¾®è°ƒåŒºåŸŸçš„å¤§å°æ¥ç¨å¾®æé«˜å®ƒçš„é€Ÿåº¦ï¼Œä½†æ˜¯å‰ææ˜¯æ•°æ®æµç‡æ²¡æœ‰å¤ªå¤§å˜åŒ–ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒZabbixæœ¬èº«çš„ä½“ç³»ç»“æ„å­˜åœ¨ä¸€ä¸ªå±€é™æ€§ï¼šåœ¨â€œæœ€è¿‘çš„æ•°æ®â€é€‰é¡¹å¡ä¸Šï¼Œè€ƒè™‘åˆ°è¿‡æ»¤æ¡ä»¶ï¼Œæ”¶é›†äº†æ¯ä¸ªå‚æ•°çš„æœ€åä¸¤ä¸ªå€¼ã€‚å¯¹äºæ¯ä¸ªå‚æ•°ï¼Œåˆ†åˆ«åœ¨æ•°æ®åº“ä¸­è¯·æ±‚å€¼ã€‚å› æ­¤ï¼Œé€‰æ‹©çš„æ­¤ç±»å‚æ•°è¶Šå¤šï¼ŒæŸ¥è¯¢å°†è¿è¡Œçš„æ—¶é—´è¶Šé•¿ã€‚å½“åœ¨å†å²è¡¨ä¸Šè®¾ç½®btreeç´¢å¼•ï¼ˆitemidï¼Œclock descï¼‰å¹¶æŒ‰æ—¶é—´è¿›è¡Œåå‘æ’åºæ—¶ï¼Œå°†æœç´¢æœ€æ–°æ•°æ®ï¼Œä½†æ˜¯ç´¢å¼•æœ¬èº«å½“ç„¶ä¼šåœ¨ç£ç›˜ä¸Šâ€œè†¨èƒ€â€ï¼Œå¹¶ä¸”é€šå¸¸é—´æ¥åœ°å‡æ…¢æ•°æ®åº“çš„é€Ÿåº¦ï¼Œè¿™ä¼šå¯¼è‡´é—®é¢˜ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæœ‰ä¸‰ç§è§£å†³æ–¹æ³•ï¼š</font></font><br><br><ol><li>             Â« Â»      100  (..   ,     Â« Â»    ) </li><li>     Zabbix ,                  ,          Â« Â» </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¿ç•™ç´¢å¼•çš„é»˜è®¤è®¾ç½®ï¼Œå¹¶é™åˆ¶æˆ‘ä»¬ä»…å¯¹åˆ†åŒºè¿›è¡Œåˆ†é…ï¼Œä»¥ä¾¿åŒæ—¶è·å¾—å„ç§å‚æ•°çš„â€œæœ€è¿‘æ•°æ®â€é€‰é¡¹å¡ä¸Šçš„ç›¸å½“å¤§çš„é€‰æ‹©ï¼ˆä½†æ˜¯ï¼Œæ³¨æ„åˆ°Zabbix WebæœåŠ¡å™¨ä»ç„¶å¯¹åŒæ—¶æ˜¾ç¤ºçš„å‚æ•°å€¼çš„æ•°é‡æœ‰æ‰€é™åˆ¶åœ¨â€œæœ€è¿‘çš„æ•°æ®â€é€‰é¡¹å¡ä¸Š-å› æ­¤ï¼Œå½“æˆ‘å°è¯•æ˜¾ç¤º5000ä¸ªå€¼æ—¶ï¼Œæ•°æ®åº“è®¡ç®—äº†ç»“æœï¼Œä½†æ˜¯æœåŠ¡å™¨æ— æ³•å‡†å¤‡ç½‘é¡µå¹¶æ˜¾ç¤ºå¤§é‡æ•°æ®ã€‚ </font></font></li></ol><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æŸ¥è¯¢æ‰§è¡Œç»Ÿè®¡ä¿¡æ¯pg_stat_statementsçš„æ”¶é›†å’Œåˆ†æ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pg_stat_statementsæ˜¯ç”¨äºæ”¶é›†æ•´ä¸ªæœåŠ¡å™¨ä¸ŠæŸ¥è¯¢æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯çš„æ‰©å±•ã€‚</font><font style="vertical-align: inherit;">è¯¥æ‰©å±•çš„ä¼˜ç‚¹æ˜¯å®ƒä¸éœ€è¦æ”¶é›†å’Œè§£æPostgreSQLæ—¥å¿—ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨pg_stat_statementsæ‰©å±•</font></font></b> <div class="spoiler_text">    psql: <br><br><pre> CREATE EXTENSION pg_stat_statements; </pre><br>       postgresql.conf: <br><br><pre>shared_preload_libraries = 'pg_stat_statements'<font></font>
pg_stat_statements.max = 10000 #   sql ,     (     );<font></font>
pg_stat_statements.track = all # all -   (    ), top -   /, none -  <font></font>
pg_stat_statements.save = true #     <font></font>
</pre><br>  : <br><br><pre> SELECT pg_stat_statements_reset(); </pre><br>          : <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">query</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'[^(]*'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> query_sub, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(calls) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> calls, <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(mean_time) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> mean_time <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_stat_statements <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">query</span></span> ~ <span class="hljs-string"><span class="hljs-string">'insert into'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">query</span></span> ~ <span class="hljs-string"><span class="hljs-string">'update trends'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">substring</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">query</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'[^(]*'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> calls <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span></code> </pre> </div></div><br><h4>      </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ç›‘è§†Zabbixä¸­çš„ç¡¬ç›˜é©±åŠ¨å™¨ï¼Œä»…æä¾›å¼€ç®±å³ç”¨çš„vfs.dev.readå’Œvfs.dev.writeå‚æ•°ã€‚è¿™äº›é€‰é¡¹ä¸æä¾›æœ‰å…³ç£ç›˜åˆ©ç”¨ç‡çš„ä¿¡æ¯ã€‚æŸ¥æ‰¾ç¡¬ç›˜æ€§èƒ½é—®é¢˜çš„æœ‰ç”¨æ ‡å‡†æ˜¯åˆ©ç”¨ç‡ï¼Œç­‰å¾…æŸ¥è¯¢æ—¶é—´å’Œç£ç›˜è´Ÿè½½é˜Ÿåˆ—è´Ÿè½½ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šå¸¸ï¼Œé«˜ç£ç›˜è´Ÿè½½ä¸cpuæœ¬èº«çš„é«˜iowaitä»¥åŠä¸sqlæŸ¥è¯¢æ‰§è¡Œæ—¶é—´çš„å¢åŠ ç›¸å…³ï¼Œè¿™æ˜¯åœ¨å…·æœ‰æ ‡å‡†é…ç½®çš„zabbixæœåŠ¡å™¨çš„è´Ÿè½½æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°çš„ï¼Œè¯¥æµ‹è¯•æ²¡æœ‰åˆ†åŒºä¸”æ²¡æœ‰è®¾ç½®æ›¿ä»£ç´¢å¼•ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤æ·»åŠ è¿™äº›å‚æ•°æ¥ç›‘è§†ç¡¬ç›˜é©±åŠ¨å™¨ï¼Œè¿™äº›æ­¥éª¤åœ¨</font><font style="vertical-align: inherit;">æœ‹å‹</font><font style="vertical-align: inherit;">çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ç« ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰æ‰€</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ä»‹ç»</font></a><font style="vertical-align: inherit;">ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lesovsky</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œæ”¹è¿›çš„ï¼šç°åœ¨ï¼Œiostatå‚æ•°æ˜¯åœ¨json timeå‚æ•°ä¸­ä¸ºæ¯ä¸ªç£ç›˜åˆ†åˆ«æ”¶é›†çš„ï¼Œæ ¹æ®åæœŸå¤„ç†è®¾ç½®ï¼Œè¿™äº›å‚æ•°å·²è¢«åˆ†è§£ä¸ºæœ€ç»ˆçš„ç›‘è§†å‚æ•°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨Pullè¯·æ±‚å¾…å¤„ç†æœŸé—´ï¼Œæ‚¨å¯ä»¥å°è¯•</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡æˆ‘çš„fork</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¹æ®</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">è¯¦ç»†è¯´æ˜</font></a><font style="vertical-align: inherit;">æ‰©å±•å¯¹ç£ç›˜å‚æ•°çš„ç›‘è§†</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å®Œæˆæ‰€æœ‰æè¿°çš„æ­¥éª¤ä¹‹åï¼Œæ‚¨å¯ä»¥ä¸ºç³»ç»Ÿç£ç›˜å’Œæ•°æ®åº“ç£ç›˜ï¼ˆå¦‚æœå®ƒä»¬ä¸åŒï¼‰å‘Zabbixä¸»æœåŠ¡å™¨ç›‘è§†é¢æ¿æ·»åŠ å¸¦æœ‰iowait cpuå’Œutiliztionå‚æ•°çš„è‡ªå®šä¹‰å›¾å½¢ã€‚</font><font style="vertical-align: inherit;">ç»“æœå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼ˆsdaæ˜¯ä¸»ç£ç›˜ï¼Œsdcæ˜¯åŒ…å«æ•°æ®åº“çš„ç£ç›˜ï¼‰ï¼š</font></font><br><br><img src="https://habrastorage.org/webt/oa/nj/fa/oanjfa3hajssftbq22dk8njiwj0.png"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¡¬ä»¶æ€§èƒ½æå‡ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¾ç½®DBMSï¼Œå»ºç«‹ç´¢å¼•å’Œåˆ†åŒºä¹‹åï¼Œæ‚¨å¯ä»¥è¿›è¡Œå‚ç›´æ‰©å±•-æ”¹å–„æœåŠ¡å™¨çš„ç¡¬ä»¶ç‰¹æ€§ï¼šæ·»åŠ RAMï¼Œå°†é©±åŠ¨å™¨æ›´æ”¹ä¸ºå›ºæ€å¹¶æ·»åŠ å¤„ç†å™¨æ ¸å¿ƒã€‚</font><font style="vertical-align: inherit;">è¿™æ ·å¯ä»¥ä¿è¯æ€§èƒ½çš„æé«˜ï¼Œä½†æ˜¯æœ€å¥½ä»…åœ¨è½¯ä»¶ä¼˜åŒ–åæ‰èƒ½è¿™æ ·åšã€‚</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºåˆ†å¸ƒå¼é›†ç¾¤ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»è¿‡é€‚å½“çš„å‚ç›´ç¼©æ”¾åï¼Œæ‚¨éœ€è¦å¼€å§‹æ°´å¹³-åˆ›å»ºåˆ†å¸ƒå¼é›†ç¾¤ï¼šåˆ†ç‰‡æˆ–å¤åˆ¶ä¸»ä»æœåŠ¡å™¨ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™æ˜¯å•ç‹¬æ–‡ç« çš„ä¸»é¢˜å’Œææ–™</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå¦‚ä½•æ¨¡åˆ¶</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€å †</font><s><font style="vertical-align: inherit;">ç‹—å±å’Œæ£å­ï¼‰</font></s><font style="vertical-align: inherit;">ï¼Œä»¥åŠä½¿ç”¨pg_pathmanå’Œä½¿ç”¨TimescaleDBæ‰©å±•æ–¹æ³•å»ºç«‹ç´¢å¼•çš„ä¸Šè¿°Zabbixæ•°æ®åº“ä¼˜åŒ–æŠ€æœ¯çš„æ¯”è¾ƒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒæ—¶ï¼Œåªèƒ½å¸Œæœ›æœ¬æ–‡ä¸­çš„å†…å®¹å®ç”¨ä¸”æœ‰ç›Šï¼</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN468463/">https://habr.com/ru/post/zh-CN468463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN468447/index.html">Laragon-å…·æœ‰è‡ªåŠ¨æœ¬åœ°åŸŸçš„WAMP</a></li>
<li><a href="../zh-CN468453/index.html">MBLT19 ::æŠ¥å‘Šï¼Œäº§å“æˆ˜å½¹å’Œæµ‹è¯•</a></li>
<li><a href="../zh-CN468455/index.html">å‡ºè‰²çš„GPSåŠå…¶é˜´æš—é¢</a></li>
<li><a href="../zh-CN468457/index.html">ç®€å•çš„ç®—æœ¯ç¤ºä¾‹ç”Ÿæˆå™¨ï¼Œä¸ä»…ç”¨äº</a></li>
<li><a href="../zh-CN468459/index.html">ç­¾åé›·è¾¾æ¢æµ‹å™¨æ¦‚è¿°ï¼šæˆ‘ä»¬çš„æ——èˆ°Playme Silent 2</a></li>
<li><a href="../zh-CN468465/index.html">å¾‹å¸ˆçš„è§‚ç‚¹ï¼šITå…¬å¸å¦‚ä½•ç»ˆæ­¢ä¸æœ‰æ¯’æ”¿åºœå®¢æˆ·çš„åˆåŒ</a></li>
<li><a href="../zh-CN468471/index.html">AngularConnect 2019æ¦‚è¿°ã€‚ç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN468479/index.html">äººä»¬è®¤ä¸ºè‡ªç”±æ˜¯æ¯«æ— ä»·å€¼çš„ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œæˆ‘å¯ä»¥è¯´æœä»–ä»¬â€-Yuri Yartsevå…³äºRussolå­¦æ ¡</a></li>
<li><a href="../zh-CN468481/index.html">S7å¦‚ä½•åœ¨ä¿„ç½—æ–¯ç‡å…ˆåœ¨çº¿é”€å”®æœºç¥¨</a></li>
<li><a href="../zh-CN468485/index.html">å½“æ‚¨æƒ³è¦æ¼‚äº®çš„GUIæ—¶ï¼Œä½†gpuä¸æ˜¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>