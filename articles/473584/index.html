<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶üèæ ‚òùüèæ ü•™ Filtrado de contenido en la escuela basado en Ubuntu 18.04 y Squid transparente, con integraci√≥n en la red en MikroTik y no solo üî† üçπ üöÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introducci√≥n 
 El tema del filtrado de contenido en las escuelas est√° bastante trillado y lleno de informaci√≥n, pero ya est√° bastante desactualizad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Filtrado de contenido en la escuela basado en Ubuntu 18.04 y Squid transparente, con integraci√≥n en la red en MikroTik y no solo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473584/"><img src="https://habrastorage.org/webt/sl/bc/ta/slbctarcmoniq1q3aotimy8oiv8.jpeg"><br><br><h3>  1. Introducci√≥n </h3><br>  El tema del filtrado de contenido en las escuelas est√° bastante trillado y lleno de informaci√≥n, pero ya est√° bastante desactualizado debido a la transici√≥n de muchos sitios al protocolo HTTPS seguro, con el que la mayor√≠a de las soluciones propuestas no funcionan.  Por lo tanto, decid√≠ escribir el art√≠culo m√°s completo de la A a la Z, recopilando toda la informaci√≥n que encontr√© en las extensiones de Google juntas.  El art√≠culo est√° dise√±ado para conocimientos b√°sicos en el campo de la administraci√≥n y es adecuado para profesores de inform√°tica. <br><br><h3>  2. T√©rminos de referencia </h3><br>  <b>Dado:</b> 436-FZ y una escuela en la que muchas computadoras est√°n conectadas en red y conectadas a Internet a trav√©s de un enrutador MikroTik o cualquier otro. <br><br>  <b>Objetivo:</b> hacer el filtrado de contenido de HTTP y HTTPS por la lista blanca para todos excepto su amado y la administraci√≥n de la escuela. <br><a name="habracut"></a><br><br><h3>  3. Resoluci√≥n de problemas </h3><br>  Se encontr√≥ una computadora de escritorio no utilizada con un Intel-ohm de doble n√∫cleo, 1 GB de RAM y 80 GB de disco duro. <br>  Para resolver esto, se har√° lo siguiente: <br><br><ol><li>  Linux Ubuntu Server 18.04 LTS instalado </li><li>  Transparent Proxy Squid se instala y configura en el servidor, compilado a partir de c√≥digos fuente habilitados para HTTPS. </li><li>  Integraci√≥n del servidor en la subred, redirigiendo las solicitudes a Proxy o una opci√≥n alternativa (al final) </li></ol><br>  Empecemos <br><br><h4>  3.1.  Instalar y configurar Ubuntu 18.04 </h4><br>  El proceso de instalaci√≥n es simple.  Descargue la distribuci√≥n de Ubuntu Server 18.04 del sitio oficial.  Recomiendo descargar con el instalador anterior, ya que el nuevo, personalmente de mi parte, se descarg√≥ infinitamente durante la instalaci√≥n.  Escribimos la imagen en una unidad flash / disco USB de cualquier manera conveniente.  Para grabar en una unidad flash USB, recomiendo usar Rufus y al comienzo de la grabaci√≥n seleccione "Grabar imagen DD".  Luego, siguiendo la informaci√≥n en pantalla, instale el sistema.  Nos detenemos solo en la elecci√≥n de los componentes, donde puede seleccionar inmediatamente OpenSSH y eso es todo.  No necesitamos mucho, pero necesitamos instalar lo que necesitamos. <br><br>  Entonces, Ubuntu est√° instalado.  La red, si tiene DHCP, ya est√° configurada.  Entraremos en modo superusuario para que cada vez que no agreguemos sudo a los comandos. <br><br><pre><code class="javascript hljs">sudo -s</code> </pre> <br>  Ingrese su contrase√±a y actualice el sistema. <br><br><pre> <code class="javascript hljs">apt-get update apt-get upgrade</code> </pre> <br>  Instale un editor de texto y un administrador de archivos. <br><br><pre> <code class="javascript hljs">apt-get install nano mc</code> </pre> <br>  Para guardar el archivo en <i><b>nano</b></i> , debe presionar <i>Ctrl + O</i> seguido de <i>Y.</i>  Salga del editor presionando <i>Ctrl + X.</i>  Puede guardar el archivo inmediatamente antes de salir presionando <i>Ctrl + X</i> seguido de <i>Y.</i> <br>  Para abrir el administrador de archivos, escriba <i><b>mc</b></i> .  Un NortonCommander DOS o Windows TotalCommander / FAR t√≠pico se abre con dos paneles.  Aunque estoy acostumbrado a trabajar con la consola, el administrador de archivos tambi√©n a veces ayuda, por ejemplo, a encontrar el archivo deseado m√°s r√°pido. <br><br>  Si no tiene DHCP o si desea una direcci√≥n IP separada para su servidor, como yo quer√≠a, pasaremos a la configuraci√≥n. <br><br><div class="spoiler">  <b class="spoiler_title">Configurar direcci√≥n IP est√°tica</b> <div class="spoiler_text">  A diferencia de las versiones anteriores de Ubuntu, en el nuevo 18.04 la red ya no est√° configurada en las <i>interfaces / etc / network /</i> usual, sino a trav√©s de netplan en el archivo <i><b>/etc/netplan/*.yaml</b></i> .  El archivo puede tener un nombre diferente, pero est√° ah√≠ solo.  / Etc / network / interfaces nos escribe lo siguiente: <br><br><img src="https://habrastorage.org/webt/ye/m5/xr/yem5xrromrmumjbg5gcjyb_qkte.jpeg"><br><br>  Adem√°s, si desea actualizar desde una versi√≥n anterior a 18.04, la configuraci√≥n de red permanecer√° donde estaba.  Netplan solo es relevante para una instalaci√≥n limpia de 18.04. <br><br>  Vayamos a configurar la red. <br><br>  Primero, veamos el nombre de la interfaz de red asignada al sistema operativo y recu√©rdelo. <br><br><pre> <code class="javascript hljs">ifconfig</code> </pre> <br>  Ahora abra el archivo de configuraci√≥n. <br><br><pre> <code class="javascript hljs">nano /etc/netplan<span class="hljs-comment"><span class="hljs-comment">/*.yaml</span></span></code> </pre> <br>  Ya deber√≠a tener una configuraci√≥n de DHCP.  Traigamos el archivo al siguiente formulario. <br><br><pre> <code class="javascript hljs"># This file describes the network interfaces available on your system # For more information, see netplan(<span class="hljs-number"><span class="hljs-number">5</span></span>). network: version: <span class="hljs-number"><span class="hljs-number">2</span></span> renderer: networkd ethernets:   : dhcp4: no dhcp6: no addresses: [/<span class="hljs-number"><span class="hljs-number">24</span></span>] gateway4:  nameservers: addresses: [<span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span>, <span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>]</code> </pre><br>  Ingrese su interfaz, direcci√≥n y puerta de enlace.  DNS recomienda dejar estos: Yandex.DNS Children ser√° una protecci√≥n adicional.  El mismo DNS est√° configurado en mi enrutador.  En cualquier caso, debe especificar el DNS que distribuye el enrutador. <br><br>  Aqu√≠ debe prestar atenci√≥n a los espacios (es decir, espacios, no pesta√±as).  Cada uno, un tipo de p√°rrafo est√° separado del espacio anterior.  Por ejemplo, si despu√©s de los servidores de nombres, la l√≠nea de direcci√≥n no est√° separada por un espacio, sino que est√° alineada con la l√≠nea de arriba, cuando intente aplicar la configuraci√≥n, netplan generar√° un error. <br><br>  Aplicar la configuraci√≥n. <br><br><pre> <code class="javascript hljs">netplan apply</code> </pre> <br>  Reinicie el servidor, por si acaso. <br><br><pre> <code class="javascript hljs">reboot</code> </pre> <br></div></div><br>  Adem√°s, agreg√≥ una opci√≥n de configuraci√≥n de red alternativa tanto para DHCP como para IP est√°tica, si netplan no es adecuado. <br><div class="spoiler">  <b class="spoiler_title">Configuraci√≥n de red alternativa</b> <div class="spoiler_text">  En Ubuntu 18.04, puede volver a la opci√≥n de configuraci√≥n de red familiar a trav√©s de <i>/ etc / network / interfaces</i> .  Para hacer esto, el archivo en s√≠ mismo indica que necesita instalar la utilidad <i>ifupdown</i> .  Instalarlo: <br><pre> <code class="javascript hljs">apt-get install ifupdown</code> </pre> <br>  Ahora abra el archivo de configuraci√≥n inicial en netplan <br><pre> <code class="javascript hljs">nano /etc/netplan<span class="hljs-comment"><span class="hljs-comment">/*.yaml</span></span></code> </pre> <br>  y comentar todo su contenido para que no haya conflictos. <br>  A continuaci√≥n, abra el archivo de configuraci√≥n de red <br><pre> <code class="javascript hljs">nano /etc/network/interfaces</code> </pre> <br>  Y agr√©guele: <br>  para IP est√°tica <br><pre> <code class="javascript hljs">auto ___ iface ___ inet <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> address IP- netmask  gateway  dns-nameservers <span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span></code> </pre> <br>  para din√°mico (DHCP) <br><pre> <code class="javascript hljs">auto ___ iface ___ inet dhcp</code> </pre> <br>  Reiniciar el servidor <br><pre> <code class="javascript hljs">reboot</code> </pre> <br>  Si usa esta opci√≥n para la configuraci√≥n de red, en la configuraci√≥n de Firewall, puede optar por no participar en Webmin por completo y usar la opci√≥n de configuraci√≥n en el spoiler (aunque la variante con Webmin tambi√©n funcionar√°) <br></div></div><br><br>  Ahora debe habilitar el paso de paquetes a trav√©s de nuestro servidor.  Abra el archivo <i>/etc/sysctl.conf</i> <br><pre> <code class="javascript hljs">nano /etc/sysctl.conf</code> </pre> <br>  Buscamos <i><b>la</b></i> cadena <i><b>net.ipv4.ip_forward = 1</b></i> y la descomentamos.  Si el valor es <i>0</i> , cambie a <i>1</i> . <br>  Ingrese el comando para aplicar la configuraci√≥n <br><pre> <code class="javascript hljs">sysctl -p /etc/sysctl.conf</code> </pre> <br><br>  Despu√©s de configurar la red, le recomiendo que vaya directamente al terminal y contin√∫e trabajando en √©l.  Para hacer esto, si no seleccion√≥ OpenSSH durante la fase de instalaci√≥n, inst√°lelo. <br><br><pre> <code class="javascript hljs">apt-get install ssh</code> </pre> <br>  De forma predeterminada, SSH ya est√° configurado para el inicio de sesi√≥n de usuario / contrase√±a en el puerto 22, pero puede configurarlo usted mismo a trav√©s de, por ejemplo, una clave de autorizaci√≥n y con otro puerto para proteger el servidor de ataques externos.  C√≥mo hacer esto est√° lleno de informaci√≥n en Internet. <br><br>  Como terminal, uso XShell.  Puedes usar el que prefieras. <br><br>  No necesitamos un servidor DHCP y una segunda tarjeta de red, ya que redirigiremos las solicitudes de los usuarios a nuestro Proxy utilizando el enrutador. <br><br>  Se ponen los cimientos.  Ahora pasemos a instalar y configurar Squid. <br><br><h4>  3.2.  Instalaci√≥n y configuraci√≥n de Squid con soporte HTTPS y filtrado de listas </h4><br>  <b>3.2.1.</b>  <b>Construye e instala Squid</b> <br><br>  Como no hay un paquete Squid listo para usar con soporte SSL en los repositorios, deber√° ensamblarlo manualmente desde la fuente.  Primero, abra el archivo con los repositorios. <br><br><pre> <code class="javascript hljs">nano /etc/apt/sources.list</code> </pre> <br>  En √©l descomentamos (eliminamos # al principio) las l√≠neas que comienzan con <i><b>deb-src</b></i> . <br><br>  Despu√©s de eso, actualizaremos los paquetes. <br><br><pre> <code class="javascript hljs">apt-get update</code> </pre> <br>  A continuaci√≥n, instale las herramientas de ensamblaje. <br><br><pre> <code class="javascript hljs">apt-get install fakeroot build-essential devscripts</code> </pre> <br>  Y agregue todos los paquetes necesarios para el ensamblaje. <br><br><pre> <code class="javascript hljs">apt-get build-dep squid3</code> </pre> <br>  Instale la biblioteca para soporte SSL. <br><br><pre> <code class="javascript hljs">apt-get install libssl1<span class="hljs-number"><span class="hljs-number">.0</span></span>-dev</code> </pre> <br>  Vayamos a la carpeta de inicio y creemos una carpeta para el ensamblaje, configurando inmediatamente los derechos necesarios. <br><br><pre> <code class="javascript hljs">cd ~ mkdir build chown _apt:root build</code> </pre> <br>  Vaya a la carpeta creada y descargue las fuentes de Squid. <br><br><pre> <code class="javascript hljs">cd build apt-get source squid3</code> </pre> <br>  Aparecer√° una carpeta en la carpeta de compilaci√≥n con el nombre squid3 y el n√∫mero de versi√≥n.  En Ubuntu 18.04.3 es 3.5.27.  Vamos a entrar en eso. <br><br><pre> <code class="javascript hljs">cd squid3<span class="hljs-number"><span class="hljs-number">-3.5</span></span><span class="hljs-number"><span class="hljs-number">.27</span></span></code> </pre> <br>  Antes del ensamblaje, debe especificar las opciones.  Abre el archivo con ellos. <br><br><pre> <code class="javascript hljs">nano debian/rules</code> </pre> <br>  Estamos buscando una lista de opciones, como en la imagen <br><br><img src="https://habrastorage.org/webt/w3/1a/xn/w31axng0b2nuqhjipuqc84sey78.jpeg"><br>  Agregue las siguientes opciones. <br><br><pre> <code class="javascript hljs">--enable-ssl \ --enable-ssl-crtd \ --<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-openssl</code> </pre> <br>  Tenga en cuenta que las opciones ya se han agregado a la imagen, y el car√°cter <b>"\"</b> debe aparecer despu√©s de cada l√≠nea en las opciones, <b>excepto la √∫ltima</b> . <br><br>  Entonces, todo est√° listo para el montaje.  Ahora pasemos a la carpeta de origen Squid, aunque ya deber√≠a estar en ella. <br><br><pre> <code class="javascript hljs">cd ~<span class="hljs-regexp"><span class="hljs-regexp">/build/</span></span>squid3<span class="hljs-number"><span class="hljs-number">-3.5</span></span><span class="hljs-number"><span class="hljs-number">.27</span></span></code> </pre> <br>  E ingrese el comando para construir. <br><br><pre> <code class="javascript hljs">debuild -d</code> </pre> <br>  El montaje llevar√° mucho tiempo, me llev√≥ un promedio de 2 a 4 horas.  Depende de la velocidad de la computadora.  Al final del ensamblaje, ver√° un error de firma del paquete.  Esto es normal: ignore el error. <br><br>  Ahora ve a la carpeta Build. <br><br><pre> <code class="javascript hljs">cd ~<span class="hljs-regexp"><span class="hljs-regexp">/build</span></span></code> </pre> <br>  E instala Squid. <br><br><pre> <code class="javascript hljs">dpkg -i squid*.deb</code> </pre> <br>  Inmediatamente se encuentra con un error sobre dependencias insatisfechas e ingrese el comando <br><br><pre> <code class="javascript hljs">apt-get install -f</code> </pre> <br>  Despu√©s de la instalaci√≥n, marcamos los paquetes para que no se sobrescriban despu√©s de actualizar el sistema. <br><br><pre> <code class="javascript hljs">apt-mark hold squid apt-mark hold squid-common apt-mark hold squidclient</code> </pre> <br>  <b>3.2.2.</b>  <b>Configurando Squid y Filtrando</b> <br><br>  Entonces, Squid est√° instalado, queda por configurarlo para nuestras necesidades. <br><br>  Todas las configuraciones est√°n en el archivo <i><b>/etc/squid/squid.conf</b></i> .  Contiene muchos comentarios y a primera vista parece muy complicado, pero de hecho no hay nada s√∫per complicado.  Para comenzar, lo limpiaremos de los comentarios copiando primero el original, si de repente desea estudiarlo con m√°s detalle.  Para mayor comodidad, iremos directamente a la carpeta con Squid. <br><br><pre> <code class="javascript hljs">cd /etc/squid cp squid.conf squid.conf.backup cat squid.conf.backup | egrep <span class="hljs-string"><span class="hljs-string">"^[^#]"</span></span> &gt; squid.conf</code> </pre> <br>  Ahora abra squid.conf <br><br><pre> <code class="javascript hljs">nano squid.conf</code> </pre> <br>  Como puede ver, se despej√≥ de comentarios y dej√≥ de ser tan voluminoso como parec√≠a. <br>  Debajo del spoiler, publicar√© mi archivo con configuraciones que funcionan perfectamente, y debajo describir√© en bloques qu√© y c√≥mo. <br><br><div class="spoiler">  <b class="spoiler_title">Configuraci√≥n de Squid.conf</b> <div class="spoiler_text"><pre> <code class="javascript hljs">acl localnet src <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> acl worktime time <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-number"><span class="hljs-number">-15</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> acl SSL_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> acl Safe_ports port <span class="hljs-number"><span class="hljs-number">80</span></span> # http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">21</span></span> # ftp acl Safe_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> # https acl Safe_ports port <span class="hljs-number"><span class="hljs-number">70</span></span> # gopher acl Safe_ports port <span class="hljs-number"><span class="hljs-number">210</span></span> # wais acl Safe_ports port <span class="hljs-number"><span class="hljs-number">1025</span></span><span class="hljs-number"><span class="hljs-number">-65535</span></span> # unregistered ports acl Safe_ports port <span class="hljs-number"><span class="hljs-number">280</span></span> # http-mgmt acl Safe_ports port <span class="hljs-number"><span class="hljs-number">488</span></span> # gss-http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">591</span></span> # filemaker acl Safe_ports port <span class="hljs-number"><span class="hljs-number">777</span></span> # multiling http acl CONNECT method CONNECT acl blacklist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist"</span></span> acl whitelist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist"</span></span> http_access allow localhost http_access deny manager http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access allow CONNECT http_access deny blacklist http_access allow whitelist http_access deny all worktime http_access allow all http_port <span class="hljs-number"><span class="hljs-number">3128</span></span> http_port <span class="hljs-number"><span class="hljs-number">3129</span></span> intercept https_port <span class="hljs-number"><span class="hljs-number">3130</span></span> intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2 connection-auth=off cert=<span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>squid/squid.pem always_direct allow all sslproxy_cert_error allow all sslproxy_flags DONT_VERIFY_PEER acl blacklist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist_ssl"</span></span> acl whitelist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist_ssl"</span></span> acl step1 at_step SslBump1 ssl_bump peek step1 ssl_bump terminate blacklist_ssl ssl_bump splice whitelist_ssl ssl_bump terminate all worktime ssl_bump splice all sslcrtd_program /usr/lib/squid/ssl_crtd -s /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/ssl_db -M <span class="hljs-number"><span class="hljs-number">4</span></span>MB # cache_mem <span class="hljs-number"><span class="hljs-number">512</span></span> MB maximum_object_size_in_memory <span class="hljs-number"><span class="hljs-number">512</span></span> KB memory_replacement_policy lru cache_dir aufs /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span> # access_log daemon:<span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span>log/squid/access.log squid logfile_rotate <span class="hljs-number"><span class="hljs-number">1</span></span> coredump_dir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid refresh_pattern ^ftp: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">10080</span></span> refresh_pattern ^gopher: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">1440</span></span> refresh_pattern -i (<span class="hljs-regexp"><span class="hljs-regexp">/cgi-bin/</span></span>|\?) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">0</span></span> refresh_pattern (Release|Packages(.gz)*)$ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">2880</span></span> refresh_pattern . <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">4320</span></span></code> </pre> <br></div></div><br>  <i><b>El primer bloque es el</b></i> siguiente. <br><br><pre> <code class="javascript hljs">acl localnet src <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> acl worktime time <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-number"><span class="hljs-number">-15</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> acl SSL_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> acl Safe_ports port <span class="hljs-number"><span class="hljs-number">80</span></span> # http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">21</span></span> # ftp acl Safe_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> # https acl Safe_ports port <span class="hljs-number"><span class="hljs-number">70</span></span> # gopher acl Safe_ports port <span class="hljs-number"><span class="hljs-number">210</span></span> # wais acl Safe_ports port <span class="hljs-number"><span class="hljs-number">1025</span></span><span class="hljs-number"><span class="hljs-number">-65535</span></span> # unregistered ports acl Safe_ports port <span class="hljs-number"><span class="hljs-number">280</span></span> # http-mgmt acl Safe_ports port <span class="hljs-number"><span class="hljs-number">488</span></span> # gss-http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">591</span></span> # filemaker acl Safe_ports port <span class="hljs-number"><span class="hljs-number">777</span></span> # multiling http acl CONNECT method CONNECT</code> </pre> <br>  Es responsable de los par√°metros est√°ndar de acl.  En ella, en localnet, cambiamos la red local a la nuestra, y tambi√©n agregamos un tiempo de trabajo (opcional).  Agregu√© tiempo de trabajo en vista del hecho de que los maestros a menudo acuden a m√≠ quej√°ndose de que no pueden encontrar nada, todo es inaccesible.  Por supuesto, me alegro de que todo funcione como deber√≠a, pero, francamente, estoy cansado de escuchar esto.  Ahora estoy informando su reclamo de que despu√©s de las 15:00 el filtro est√° desactivado y que pueden (casi) encontrar libremente la informaci√≥n que necesitan.  Puede agregar su tiempo o dejar el filtro durante todo el d√≠a sin agregar esta acl. <br><br>  <i><b>El segundo bloque</b></i> define las listas de sitios permitidos y prohibidos para HTTP y tiene el siguiente aspecto. <br><br><pre> <code class="javascript hljs">acl blacklist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist"</span></span> acl whitelist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist"</span></span></code> </pre><br>  A√±adiremos listas de sitios permitidos y prohibidos m√°s adelante, y se colocar√°n en los archivos especificados en acl. <br><br>  <i><b>El tercer bloque</b></i> determina los par√°metros de acceso a trav√©s de HTTP y se ve as√≠ <br><br><pre> <code class="javascript hljs">http_access allow localhost http_access deny manager http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access allow CONNECT http_access deny blacklist http_access allow whitelist http_access deny all worktime http_access allow all</code> </pre> <br>  Aqu√≠ <i>se</i> requiere el elemento <i>http_access allow CONNECT</i> , ya que sin √©l Squid no permitir√≠a que nadie en Internet.  Las siguientes son las reglas en las listas en blanco y negro.  Los par√°metros <i>denegar</i> y <i>permitir</i> <i>niegan</i> y <i>permiten el</i> acceso, respectivamente.  Despu√©s de ellos viene la regla de prohibir completamente todo el tr√°fico HTTP durante el horario comercial.  Si no estableci√≥ las horas de trabajo, elimine el <i>tiempo de trabajo</i> y la prohibici√≥n ser√° permanente.  Un punto importante es el orden de las reglas, ya que Squid las lee de arriba a abajo <br>  <i><b>El cuarto bloque</b></i> define la configuraci√≥n del puerto para Squid. <br><br><pre> <code class="javascript hljs">http_port <span class="hljs-number"><span class="hljs-number">3128</span></span> http_port <span class="hljs-number"><span class="hljs-number">3129</span></span> intercept https_port <span class="hljs-number"><span class="hljs-number">3130</span></span> intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2 connection-auth=off cert=<span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>squid/squid.pem</code> </pre> <br>  El primer par√°metro es necesario para que el error "ERROR: no se hayan configurado puertos de proxy de reenv√≠o" no aparezca infinitamente en los registros.  Llena el registro y, por lo tanto, la memoria.  Un error com√∫n, pero por alguna raz√≥n, en nuestro segmento ru no encontr√© c√≥mo solucionarlo, los foros extranjeros ayudaron.  El segundo par√°metro define el puerto del protocolo HTTP.  <i>Interceptar</i> significa transparencia de proxy, es decir, no ser√° necesario prescribir configuraciones en cada computadora. <br>  El tercer par√°metro define el puerto HTTPS y sus opciones.  Esta es una larga l√≠nea.  El archivo <i>squid.pem</i> es nuestro certificado, que crearemos m√°s adelante. <br><br>  <i><b>El quinto bloque</b></i> define los par√°metros de la conexi√≥n SSL con Squid.  En particular, indica que todo el tr√°fico debe dirigirse inmediatamente a Internet, sin usar cach√©s superiores, y los dos √∫ltimos permiten conexiones incluso con errores de verificaci√≥n de certificados, ya que la decisi√≥n de visitar dicho recurso debe ser tomada por el usuario, no por el servidor.  Se ve as√≠. <br><br><pre> <code class="javascript hljs">always_direct allow all sslproxy_cert_error allow all sslproxy_flags DONT_VERIFY_PEER</code> </pre> <br>  <i><b>El sexto bloque</b></i> establece los par√°metros de acl de las listas "negra" y "blanca", que se crear√°n m√°s adelante, as√≠ como la profundidad de la intercepci√≥n del tr√°fico HTTPS. <br><br><pre> <code class="javascript hljs">acl blacklist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist_ssl"</span></span> acl whitelist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist_ssl"</span></span> acl step1 at_step SslBump1</code> </pre> <br>  <i><b>El s√©ptimo bloque</b></i> determina los par√°metros de acceso utilizando el protocolo HTTPS.  Aqu√≠, la prohibici√≥n y el permiso ya son responsables de <i>rescindir</i> y <i>empalmar,</i> respectivamente.  Nuevamente, no olvide eliminar el horario laboral si no tiene un horario laboral espec√≠fico. <br><br><pre> <code class="javascript hljs">ssl_bump peek step1 ssl_bump terminate blacklist_ssl ssl_bump splice whitelist_ssl ssl_bump terminate all worktime ssl_bump splice all sslcrtd_program /usr/lib/squid/ssl_crtd -s /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/ssl_db -M <span class="hljs-number"><span class="hljs-number">4</span></span>MB</code> </pre><br>  <i><b>El octavo bloque</b></i> establece el cach√© y el registro de nuestro calamar.  Aqu√≠ vale la pena se√±alar solo el par√°metro <i>logfile_rotate</i> , que indica la cantidad de d√≠as durante los cuales se almacena el registro. <br><br><pre> <code class="javascript hljs"># cache_mem <span class="hljs-number"><span class="hljs-number">512</span></span> MB maximum_object_size_in_memory <span class="hljs-number"><span class="hljs-number">512</span></span> KB memory_replacement_policy lru cache_dir aufs /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span> # access_log daemon:<span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span>log/squid/access.log squid logfile_rotate <span class="hljs-number"><span class="hljs-number">1</span></span> coredump_dir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid refresh_pattern ^ftp: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">10080</span></span> refresh_pattern ^gopher: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">1440</span></span> refresh_pattern -i (<span class="hljs-regexp"><span class="hljs-regexp">/cgi-bin/</span></span>|\?) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">0</span></span> refresh_pattern (Release|Packages(.gz)*)$ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">2880</span></span> refresh_pattern . <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">4320</span></span></code> </pre> <br>  Esto completa la configuraci√≥n de squid.conf.  Guardamos el archivo y procedemos a la creaci√≥n del certificado y las listas. <br><br>  Vamos a la carpeta con Squid <br><br><pre> <code class="javascript hljs">cd /etc/squid/</code> </pre> <br>  E ingrese el siguiente comando para crear el certificado <br><br><pre> <code class="javascript hljs">openssl req -<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> -newkey rsa:<span class="hljs-number"><span class="hljs-number">1024</span></span> -days <span class="hljs-number"><span class="hljs-number">36500</span></span> -nodes -x509 -keyout squid.pem -out squid.pem</code> </pre> <br>  A continuaci√≥n, deber√° ingresar los datos del certificado.  El certificado es v√°lido por 100 a√±os para olvidarlo por mucho tiempo.  Solo es necesario para Proxy. <br><br>  Ahora crea nuestros archivos de lista. <br><br><pre> <code class="javascript hljs">touch blacklist touch whitelist cp whitelist whitelist_ssl cp blacklist blacklist_ssl</code> </pre> <br>  Los sitios se enumeran en forma de expresiones regulares.  Por ejemplo, para desbloquear mail.ru, abra la <i>lista blanca</i> <br><br><pre> <code class="javascript hljs">nano whitelist</code> </pre> <br>  y agregue la siguiente expresi√≥n. <br><br><pre> <code class="javascript hljs">mail\.ru</code> </pre> <br>  Ahora bloquee Games.Mail.ru.  Abramos nuestra <i>lista negra</i> <br><br><pre> <code class="javascript hljs">nano blacklist</code> </pre> <br>  y escribe la siguiente expresi√≥n en ella <br><br><pre> <code class="javascript hljs">games\.mail\.ru</code> </pre> <br>  Dado que, por regla general, un bloqueador de la lista negra est√° por encima de nuestra lista blanca, cuando cambia a mail.ru, el sitio se abrir√° como se esperaba (excepto las im√°genes, pero m√°s sobre eso m√°s adelante), y si intenta cambiar a Juegos, Squid us No lo dejar√© ir. <br><br>  Algunos sitios tienen muchos subdominios, subdominios, etc.  Como, por ejemplo, mail.ru almacena sus im√°genes en imgsmail.ru.  Con respecto a otros sitios similares, debe abrir el sitio deseado en cualquier navegador (uso Chrome) y, posteriormente, las herramientas de desarrollador (en Chrome se llaman presionando F12). <br><br><img src="https://habrastorage.org/webt/ie/43/a7/ie43a7r-zkjhouxldavryxg0kjg.jpeg"><br><br>  Vaya a la pesta√±a Fuentes y vea de qu√© otros recursos carga informaci√≥n el sitio. <br><br>  Despu√©s de agregar sitios, c√≥pielos a las listas para HTTPS. <br><br><pre> <code class="javascript hljs">cp whitelist whitelist_ssl cp blacklist blacklist_ssl</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Sugerencia de relleno de lista</b> <div class="spoiler_text">  Cree un archivo de texto plano en su computadora, busque y copie la lista de sitios permitidos en √©l, agr√©guelo al suyo.  Luego, en un cuaderno normal, reemplace autom√°ticamente el punto con una barra diagonal (\.) Y elimine el innecesario con el mismo reemplazo autom√°tico (www, http, el car√°cter "/", etc.).  Luego, dicho archivo, usando el terminal, puede copiarse inmediatamente en las hojas del servidor. <br></div></div><br>  Ahora verifique la configuraci√≥n. <br><br><pre> <code class="javascript hljs">squid -k check</code> </pre> <br>  Si todo est√° bien, det√©n a Squid. <br><br><pre> <code class="javascript hljs">/etc/init.d/squid stop</code> </pre> <br>  Reconstruir el cach√© <br><br><pre> <code class="javascript hljs">squid -z</code> </pre> <br>  Y corre Calamar otra vez <br><br><pre> <code class="javascript hljs">/etc/init.d/squid start</code> </pre> <br>  Despu√©s de cualquier cambio en las listas o en la configuraci√≥n de Squid, debe volver a cargarse con el comando <br><br><pre> <code class="javascript hljs">/etc/init.d/squid restart</code> </pre> <br>  Tambi√©n puede cambiar la p√°gina de restricci√≥n de acceso (solo funciona en HTTP) en la ruta <i><b>/ usr / share / squid / errors / ~ Russian-1251</b></i> .  Busque en la carpeta el archivo <i><b>ERR_ACCESS_DENIED</b></i> y <i><b>ed√≠telo</b></i> .  La sintaxis del archivo es HTML. <br><br><h4>  3.3.  Supervisi√≥n del estado del servidor y configuraci√≥n del firewall </h4><br>  Para monitorear el estado de nuestro servidor, instale la utilidad <b>Webmin</b> , con la ayuda de la cual configuramos nuestro Firewall.  Adem√°s, a trav√©s de √©l puede monitorear el estado de la CPU, RAM, etc., actualizar paquetes, agregar y configurar componentes, y mucho m√°s.  Tiene su propio terminal, aunque torpe.  La utilidad funciona a trav√©s de cualquier navegador, por lo tanto, puede conectarse a nuestro servidor desde cualquier computadora en la red, lo cual es lo suficientemente conveniente, aunque no seguro.  Si lo desea, la conexi√≥n puede limitarse solo a direcciones IP individuales en el "Control de acceso IP" en Webmin. <br><br>  Antes de comenzar la instalaci√≥n, agregue el repositorio de Webmin.  Fuentes abiertas.lista. <br><br><pre> <code class="javascript hljs">nano /etc/apt/sources.list</code> </pre> <br>  Y agregue la l√≠nea de abajo. <br><br><pre> <code class="javascript hljs">deb http:<span class="hljs-comment"><span class="hljs-comment">//download.webmin.com/download/repository sarge contrib</span></span></code> </pre> <br>  Ahora instale la clave GPG con la que se firman los paquetes en el repositorio de Webmin <br><br><pre> <code class="javascript hljs">cd /root wget http:<span class="hljs-comment"><span class="hljs-comment">//www.webmin.com/jcameron-key.asc apt-key add jcameron-key.asc</span></span></code> </pre> <br>  A continuaci√≥n, actualizamos la lista de paquetes e instalamos la utilidad <br><br><pre> <code class="javascript hljs">apt-get update apt-get install webmin</code> </pre> <br>  Puede conectarse al servidor en cualquier navegador ingresando a la barra de direcciones <br><br><pre> <code class="javascript hljs">IP__:<span class="hljs-number"><span class="hljs-number">10000</span></span></code> </pre> <br>  Por defecto, Webmin se conecta a trav√©s de SSL, y la mayor√≠a de los navegadores dan un error de certificado no confiable.  Para no elegir la confianza cada vez, deshabilite SSL.  Para hacer esto, abra el archivo <i>/etc/webmin/miniserv.conf</i> <br><br><pre> <code class="javascript hljs">nano /etc/webmin/miniserv.conf</code> </pre> <br>  Encuentre la cadena <i><b>ssl = 1 en ella</b></i> y reempl√°cela con <i><b>ssl = 0</b></i> .  En el mismo archivo, puede cambiar el puerto de conexi√≥n.  Por defecto es 10000. Puedes poner cualquiera gratis. <br><br>  Una vez conectado a Webmin, vaya a <i>Webmin -&gt; Configuraci√≥n de Webmin</i> y cambie el idioma al ruso.  Luego vaya a <i>Red -&gt; Firewall</i> .  Por defecto, nuestro firewall est√° limpio.  Vamos al final y enfrente de " <i>Habilitar en el arranque",</i> seleccione <i>"S√≠"</i> .  Haga clic en <i>"Aplicar configuraci√≥n"</i> .  Ahora la configuraci√≥n de nuestro Firewall se especifica en el archivo <i><b>/etc/webmin/firewall/iptables.save</b></i> y se inicia con el sistema.  Si no existe dicho archivo, mire lo que est√° escrito en la l√≠nea "Archivo con reglas" en la pesta√±a Firewall en Webmin.  Vamos a abrirlo en la terminal. <br><br><pre> <code class="javascript hljs">nano /etc/webmin/firewall/iptables.save</code> </pre> <br>  Vamos al bloque <i><b>* nat</b></i> y al final antes de <i>COMMIT</i> agregamos las siguientes reglas. <br><br><pre> <code class="javascript hljs">-A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number"><span class="hljs-number">80</span></span> -j DNAT --to-destination ip_:<span class="hljs-number"><span class="hljs-number">3129</span></span> -A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number"><span class="hljs-number">443</span></span> -j REDIRECT --to-ports <span class="hljs-number"><span class="hljs-number">3130</span></span></code> </pre> <br>  Estas reglas dirigen el tr√°fico que va a los puertos 80 (HTTP) y 443 (HTTPS) del servidor a los puertos de nuestro Squid.  Aqu√≠ present√© dos variantes de las reglas con DNAT y REDIRECT.  Puede usar ambos, o tomar una opci√≥n colocando los puertos apropiados. <br><br><div class="spoiler">  <b class="spoiler_title">Configurar FIrewall para una configuraci√≥n de red alternativa</b> <div class="spoiler_text">  Esta opci√≥n es adecuada si utiliz√≥ la configuraci√≥n de red alternativa descrita anteriormente. <br>  Primero, cree un archivo con las reglas para nuestro Firewall y dele el derecho de ejecutarlo. <br><pre> <code class="javascript hljs">touch /etc/nat chmod +x /etc/nat</code> </pre> <br>  √Åbrelo <br><pre> <code class="javascript hljs">nano /etc/nat</code> </pre> <br>  Y agregue el siguiente contenido <br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">#!/bin/sh #Firewall iptables -t nat -A PREROUTING -p tcp -m tcp -i _ --dport 80 -j DNAT --to-destination ip_:3129 iptables -t nat -A PREROUTING -p tcp -m tcp -i _ --dport 443 -j REDIRECT --to-ports 3130</span></span></code> </pre> <br>  Como en el caso de Webmin, present√© dos variantes de las reglas con DNAT y REDIRECT.  Puede usar ambos, o tomar una opci√≥n colocando los puertos apropiados. <br>  Ahora agregue nuestro archivo a la descarga inmediatamente despu√©s de iniciar la red.  Abra el archivo de configuraci√≥n de red <br><pre> <code class="javascript hljs">nano /etc/network/interfaces</code> </pre> <br>  Y agregue la l√≠nea al final del archivo <br><pre> <code class="javascript hljs">post-up /etc/nat</code> </pre> <br>  PD: la ventaja de esta opci√≥n es que puede agregar sus propias reglas en el futuro simplemente editando el archivo / etc / nat.  Webmin es un poco m√°s complicado. <br></div></div><br>  Esto completa la configuraci√≥n del servidor.  Reiniciarlo. <br><br><pre> <code class="javascript hljs">reboot</code> </pre> <br>  Y pasemos a configurar el enrutador MikroTik. <br><br><h4>  3.4.  Configuraci√≥n de un enrutador MikroTik para redirigir el tr√°fico a Proxy </h4><br>  Suponemos que ya ha descargado la utilidad <b>WinBox</b> para control remoto, Internet y la red local est√°n configurados, el firewall en el enrutador est√° limpio.  conoce el nombre de la interfaz LAN (puede verla en <i>IP - Servidor DHCP - DHCP</i> ). <br><br>  <b>a)</b> Vaya a WinBox, vaya a <i><b>IP - Servidor DHCP - Arrendamientos</b></i> .  En la lista buscamos computadoras IP para las cuales el filtrado no funcionar√° (director, administraci√≥n), haga clic derecho sobre ellas y seleccione <i><b>Make Static</b></i> en el men√∫.  Junto a ellos, la letra "D" deber√≠a desaparecer, lo que significa Din√°mico.  Ahora, estas direcciones se asignar√°n de forma est√°tica inmediata a estas computadoras, independientemente del tiempo de arrendamiento, por la direcci√≥n MAC.  Si la computadora port√°til se usa a trav√©s de Wi-Fi y cable, debe seleccionar Make Static en ambas direcciones MAC. <br><br>  <b>b)</b> A continuaci√≥n, vaya a <i><b>IP - Firewall - Listas de direcciones</b></i> y haga clic en el signo <i><b>m√°s</b></i> azul <i><b>"+"</b></i> .  En el campo <i><b>Nombre</b></i> , especifique el nombre de nuestro grupo de direcciones <s>brillantes</s> sin filtrar, por ejemplo, "Administradores".  En el campo <i><b>Direcci√≥n</b></i> , especifique una direcci√≥n IP de aquellos a quienes se les ha asignado una est√°tica.  Repetimos esto para cada direcci√≥n, seleccionando nuestro grupo en el campo Nombre con una flecha. <br><br>  <b>c)</b> Vaya a la pesta√±a <i><b>Mangle</b></i> en la misma <i><b>IP - Firewall</b></i> y haga clic en <i><b>"+"</b></i> .  Se abrir√° una ventana con pesta√±as.  En la pesta√±a <i><b>General</b></i> , complete los siguientes campos: <br><br><pre> <code class="javascript hljs">Chain - Prerouting Src. Address - __proxy Protocol - <span class="hljs-number"><span class="hljs-number">6</span></span> (tcp) Dst. Port - <span class="hljs-number"><span class="hljs-number">80</span></span> In. Interface - __</code> </pre><br>  En la pesta√±a <b><i>Acci√≥n</i></b> , verifique el valor <i><b>Aceptar</b></i> y haga clic en Aceptar. <br><br>  Repita el proceso, pero en el campo <i>Dst.</i>  <i>Puerto</i> establece el valor en <i>443</i> . <br><br>  <b>d)</b> Haga clic en "+" nuevamente y en la pesta√±a <i><b>General</b></i> , nuevamente completamos los siguientes campos: <br><br><pre> <code class="javascript hljs">Chain - Prerouting Protocol - <span class="hljs-number"><span class="hljs-number">6</span></span> (tcp) Dst. Port - <span class="hljs-number"><span class="hljs-number">80</span></span> In. Interface - __</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vaya a la pesta√±a </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avanzado</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y en el campo </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Src. </font><font style="vertical-align: inherit;">Lista de direcciones</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seleccione nuestra lista de direcciones de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">administraci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><i><font style="vertical-align: inherit;">Administradores</font></i><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Aseg√∫rese de hacer clic en el cuadro que aparece junto a la lista. </font><font style="vertical-align: inherit;">Aparecer√° un signo de exclamaci√≥n </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"!". </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que significa l√≥gico NO o NEGATIVO. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vaya a la pesta√±a </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acci√≥n</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y complete los campos:</font></font><br><br><pre> <code class="javascript hljs">Action - mark routing New Routing Mark - to_proxy Passthrough -  </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haga clic en Aceptar y realice las mismas acciones, pero en el campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dst. </font><font style="vertical-align: inherit;">Puerto</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> especifica el valor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Finalmente, agregue la √∫ltima regla. </font><font style="vertical-align: inherit;">Haga clic en el signo m√°s y complete los siguientes campos en la pesta√±a </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">General</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs">Chain - Prerouting In. Interface - __ Routing Mark - to_proxy</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado, lo siguiente deber√≠a suceder con sus par√°metros. </font><font style="vertical-align: inherit;">El orden es importante! </font></font><br><br><img src="https://habrastorage.org/webt/tp/vw/zi/tpvwzizj0x_x4hg5quooe1t8bpo.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Entramos en </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP - Rutas</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y presionamos "+". </font><font style="vertical-align: inherit;">Rellene los siguientes campos:</font></font><br><br><pre> <code class="javascript hljs">Dst. Address - <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> Gateway - __proxy Routing Mark - to_proxy</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haga clic en Aceptar y listo. </font><font style="vertical-align: inherit;">Con el servidor encendido, todo el tr√°fico HTTP y HTTPS pasar√° por nuestro Squid.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5. </font><font style="vertical-align: inherit;">Configuraci√≥n alternativa para MikroTik y otros enrutadores</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta opci√≥n es adecuada tanto para el enrutador MikroTik como para cualquier otro, incluso el m√°s simple (excepto las piezas de proveedor alquiladas que usted mismo sabe). </font><font style="vertical-align: inherit;">En este caso, implementamos el uso compartido del acceso a Internet no en el enrutador, sino en Squid.</font></font> Entonces comencemos. <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Asumiremos que ha alcanzado este punto completando todos los niveles superiores, incluida la configuraci√≥n de la redirecci√≥n a Proxy en MikroTik. Para un funcionamiento sin problemas de la opci√≥n descrita, debemos cancelar el subp√°rrafo </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e) del</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> p√°rrafo </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4 de</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> este art√≠culo. Puede cancelar todo el punto 3.4 (dejando, tal vez, el subp√°rrafo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para que nuestras IP no cambien), pero esto es opcional: es importante que cancelemos el enrutamiento en s√≠. Para hacer esto, vaya a </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP - Rutas</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , busque nuestra ruta, selecci√≥nela y haga clic en la </font></font><b><i><font color="#cc0000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cruz roja</font></font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (no un signo m√°s, sino la cruz al lado de la marca de verificaci√≥n). La ruta se volver√° gris =&gt; est√° deshabilitada. El filtro tambi√©n est√° desactivado, ahora todos los clientes van a Internet directamente a trav√©s de un enrutador. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora ve a nuestro servidor y ve a la carpeta con Squid </font></font><br><pre> <code class="javascript hljs">cd /etc/squid/</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abra el archivo de configuraci√≥n. </font></font><br><pre> <code class="javascript hljs">nano squid.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y lo agregamos en bloques: </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el primer bloque</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inmediatamente despu√©s de la l√≠nea con acl localnet ...</font></font><br><pre> <code class="javascript hljs">acl admins src <span class="hljs-string"><span class="hljs-string">"/etc/squid/admins-ip"</span></span> # IP   acl students src <span class="hljs-string"><span class="hljs-string">"/etc/squid/students-ip"</span></span> # IP  </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No necesitamos una lista con las computadoras de los maestros, ya que se entiende que todos los dem√°s son maestros. </font><font style="vertical-align: inherit;">Pero puede agregarlo usted mismo con las reglas correspondientes en otros bloques. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el segundo bloque</font></font></b></i> <br><pre> <code class="javascript hljs">acl whitelist-stud url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist-stud"</span></span> #     </code> </pre> <br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el tercer bloque</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> despu√©s de http_access, denegar la lista negra</font></font><br><pre> <code class="javascript hljs">http_access allow admins #      http_access allow students whitelist-stud #       http_access deny students #       </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, el bloque permanece sin cambios, ya que los maestros (todas las dem√°s IP) lo siguen, filtrando por su lista blanca y durante las horas de trabajo (si est√° indicado). </font><font style="vertical-align: inherit;">Tambi√©n puede permitir que el grupo de administradores omita la lista negra estableciendo la regla de permiso por encima de la prohibitiva, o agregue direcciones IP separadas (por ejemplo, la suya propia) a un acl separado y col√≥quelo en las reglas sobre la lista negra. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los bloques cuarto y quinto no</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cambian. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el sexto bloque,</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agregue</font></font><br><pre> <code class="javascript hljs">acl whitelist-stud_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist-stud_ssl"</span></span></code> </pre> <br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el s√©ptimo bloque,</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agregue despu√©s de ssl_bump terminar blacklist_ssl</font></font><br><pre> <code class="javascript hljs">ssl_bump splice admins ssl_bump splice students whitelist-stud_ssl ssl_bump terminate students</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El principio es el mismo que en el tercer bloque. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El resto no ha cambiado. </font><font style="vertical-align: inherit;">Guardar y salir </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora cree nuestras listas de direcciones IP.</font></font><br><pre> <code class="javascript hljs">touch admins-ip touch students-ip</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Y listas blancas para estudiantes. </font></font><br><pre> <code class="javascript hljs">touch whitelist-stud cp whitelist-stud whitelist-stud_ssl</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregue las direcciones IP y sitios requeridos a las listas apropiadas. </font><font style="vertical-align: inherit;">En la lista de sitios de estudiantes, puede copiar la lista de maestros eliminando los sitios que los estudiantes no necesitan. </font><font style="vertical-align: inherit;">La copia de archivos en Linux se realiza mediante el comando</font></font><br><pre> <code class="javascript hljs">cp &lt;    &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span><span class="xml"><span class="hljs-tag">    &gt;</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reiniciar Calamar </font></font><br><pre> <code class="javascript hljs">/etc/init.d/squid restart</code> </pre> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hemos llegado a lo m√°s importante, a saber, c√≥mo hacer que los clientes se conecten en l√≠nea a trav√©s de nuestro Proxy. Necesitamos cambiar la puerta de enlace de nuestro servidor DHCP de la direcci√≥n del enrutador a la direcci√≥n de nuestro servidor. Por supuesto, para esto, la direcci√≥n del servidor debe ser est√°tica o estar vinculada al MAC. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En MikroTik:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vaya a </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP - Servidor DHCP - Red</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y haga doble clic en nuestra red. En el campo Puerta de enlace, cambie la direcci√≥n del enrutador a la direcci√≥n del servidor proxy. Haga clic en Aceptar y listo. Puede reiniciar el enrutador para que la configuraci√≥n se actualice correctamente para todos los clientes activos. Despu√©s de eso, es probable que los clientes cambien el tipo de red a p√∫blica (si era privada). </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En un enrutador normal:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> busque en el manual de su enrutador d√≥nde cambiar la puerta de enlace del servidor DHCP, pero dir√© lo que hay en su configuraci√≥n :)</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En pocas palabras:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como resultado de esta soluci√≥n alternativa, pudimos ajustar el acceso por IP y listas, y obtener direcciones IP normales de clientes en los registros de Squid. </font><font style="vertical-align: inherit;">Si necesita que algunos clientes se conecten en l√≠nea evitando Proxy a trav√©s de un enrutador, lea el spoiler.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxy de omisi√≥n de Internet</font></font></b> <div class="spoiler_text">   ,  -      Squid ,        ,   , <br></div></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4. Conclusi√≥n </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, para resumir todo lo anterior. </font><font style="vertical-align: inherit;">Logramos instalar y configurar Linux Ubuntu 18.04 LTS desde cero, construir e instalar Squid con soporte HTTPS, configurar el filtrado de la lista blanca, integrar el servidor Proxy en nuestra red sin la necesidad de instalar un servidor DHCP adicional.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5. Lista de fuentes </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al crear el art√≠culo, se utilizaron diversos materiales de los sitios del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blog t√©cnico de Interface LLC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">especialistas en </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguridad web: filtro web para su red</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as√≠ como conocimiento y experiencia personal. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al editar y complementar el art√≠culo, los siguientes usuarios ayudaron mucho: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kanlas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PetRiot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barsook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Muchas gracias a ellos por su ayuda y ayuda.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Notas del autor. </font></font></h3><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cualquier trabajo con el servidor debe hacerse en modo superusuario agregando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> antes del comando o ingresando el comando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo -s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una vez </font><font style="vertical-align: inherit;">.</font></font></li><li> Squid \     ,    , ,     .          . </li><li>    , .    ,        1000 . </li><li> <s> ,           IP-  Squid.   Squid   IP- ‚Äî  Mikrotik.    ,      DHCP    ,      . ,    ,    ,     IP .</s> ‚Äî     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Barsook</a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que Squid funcione con una gran cantidad de clientes (m√°s de 50), se requiere al menos 1 GB de RAM. </font><font style="vertical-align: inherit;">M√°s preferiblemente, como Squid come memoria. </font><font style="vertical-align: inherit;">Puede verificar el estado de la memoria ingresando el comando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">superior</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recomiendo usar ambas opciones para configurar el enrutador, ya que si especifica expl√≠citamente una puerta de enlace diferente en la configuraci√≥n de red (el enrutador mismo), puede omitir el bloqueo. </font></font></li></ol><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD1: se</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agreg√≥ una configuraci√≥n de red alternativa y Firewall </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD2: se</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agreg√≥ una opci√≥n de configuraci√≥n de enrutador alternativa, donde se solucionaron los problemas con la visualizaci√≥n de direcciones en los registros de Squid. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD3: se</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agreg√≥ una soluci√≥n en 3.1 - permitiendo que los paquetes pasen por el servidor, que olvid√≥ agregar inicialmente. </font><font style="vertical-align: inherit;">De lo contrario, Internet no funciona. </font><font style="vertical-align: inherit;">Gracias a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dmitry1986</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por probar el art√≠culo.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/473584/">https://habr.com/ru/post/473584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../473570/index.html">Busque 314 km¬≤ en 10 horas: la batalla final de los ingenieros de b√∫squeda contra el bosque</a></li>
<li><a href="../473572/index.html">"Zakroma Rodina" ser√° contada: Alemania determinar√° las reservas estrat√©gicas por el nuevo m√©todo</a></li>
<li><a href="../473574/index.html">Aplicaci√≥n en TSD y comunicaci√≥n con 1C: Enterprise 8.3 a trav√©s del servicio HTTP. Parte 3 (BroadcastReceiver Obteniendo el c√≥digo de barras)</a></li>
<li><a href="../473576/index.html">Infraestructura de Experimento de Desarrollador</a></li>
<li><a href="../473578/index.html">Construyendo M√≥dulos Din√°micos para Nginx</a></li>
<li><a href="../473586/index.html">FortiConverter o movimiento sin problemas</a></li>
<li><a href="../473588/index.html">Ases intrusivos: cinem√°tica del aterrizaje "invertido" en moscas azules</a></li>
<li><a href="../473590/index.html">C√≥mo gan√© 3 de 4 medallas de oro en la Olimpiada de Computaci√≥n</a></li>
<li><a href="../473592/index.html">Scrum Community MeetUp en Raiffeisenbank + transmisi√≥n</a></li>
<li><a href="../473596/index.html">Python v3.x: controlador de excepciones para funciones de rutina y s√≠ncronas. En general, para todo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>