<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¤ ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ¾ ğŸŒ“ En-tÃªtes HTTP requis ğŸ“€ ğŸ‘°ğŸ» ğŸ›</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nos clients Fastly adorent manipuler les en-tÃªtes HTTP. Choisir la bonne combinaison d'en-tÃªtes est l'une des meilleures choses que vous puissiez fair...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>En-tÃªtes HTTP requis</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413205/"> Nos clients Fastly adorent manipuler les en-tÃªtes HTTP.  Choisir la bonne combinaison d'en-tÃªtes est l'une des meilleures choses que vous puissiez faire pour assurer la sÃ©curitÃ© de votre site et apporter une contribution significative Ã  ses performances. <br><br>  La plupart des dÃ©veloppeurs connaissent les en-tÃªtes HTTP importants et utiles.  Les plus connus sont <code>Content-Type</code> et <code>Content-Length</code> , ce sont des en-tÃªtes presque universels.  Mais rÃ©cemment, des en-tÃªtes tels que <code>Content-Security-Policy</code> et <code>Strict-Transport-Security</code> ont Ã©tÃ© utilisÃ©s pour augmenter la <code>Strict-Transport-Security</code> et <code>Link rel=preload</code> pour amÃ©liorer les performances.  MalgrÃ© la large prise en charge des navigateurs, seuls quelques-uns les utilisent. <br><br>  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article prÃ©cÃ©dent,</a> nous avons examinÃ© les en-tÃªtes inutiles.  Voyons maintenant quels en-tÃªtes doivent Ãªtre configurÃ©s pour votre site. <br><a name="habracut"></a><br><h1>  Devoirs </h1><br>  Il existe plusieurs services sur Internet qui analyseront votre site et vous conseilleront les en-tÃªtes Ã  ajouter.  J'ai regardÃ© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">securityheaders.io</a> et l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Observatoire</a> de Mozilla pour complÃ©ter mes propres connaissances et donnÃ©es du rÃ©seau Fastly. <br><br><h1>  Quelles rubriques doivent figurer sur votre site </h1><br>  Quels sont donc les principaux en-tÃªtes de vos rÃ©ponses de serveur?  La plupart sont responsables de l'amÃ©lioration de la sÃ©curitÃ©: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contenu-SÃ©curitÃ©-Politique</a> .  Agit comme un pare-feu dans le navigateur.  Si votre site est compromis, il aide Ã  limiter les dommages en empÃªchant les connexions Ã  des hÃ´tes non approuvÃ©s.  Titre trÃ¨s important.  Si vous ne l'avez pas, vous devez l'activer. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Referrer-Policy</a> .  Ajuste le niveau de dÃ©tail Ã  inclure dans l'en-tÃªte <code>Referer</code> lorsque vous quittez la page.  Aide Ã  prÃ©venir les fuites de donnÃ©es vers les sites oÃ¹ les liens vont.  Hautement recommandÃ©. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Strict-Transport-Security</a> .  EmpÃªche toute tentative de connexion au site en utilisant HTTP standard.  Aide Ã  stopper les attaques MiTM et amÃ©liore la sÃ©curitÃ© du site.  Aussi fortement recommandÃ©. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Protection X-XSS</a> .  EmpÃªche certaines formes d'attaques de script intersites, empÃªchant l'exÃ©cution de script si un balisage d'un document sous la mÃªme forme est prÃ©sent dans la demande.  Par exemple, si vous chargez une page avec l'adresse <code>/index.html?foo=&lt;script&gt;alert('foo');&lt;/script&gt;</code> <code>&lt;script&gt;alert('foo');&lt;/script&gt;</code> , et dans le code source de la page est <code>&lt;script&gt;alert('foo');&lt;/script&gt;</code> alors le script est bloquÃ©.  De nos jours, le titre est largement remplacÃ© par CSP. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">X-Content-Type-Options</a> .  DÃ©finissez la valeur sur <code>nosniff</code> pour empÃªcher les navigateurs d'exÃ©cuter du contenu de type JavaScript pour lequel la valeur de type de contenu correcte n'est pas dÃ©finie.  EmpÃªche les attaques comme le mixage MIME, et rÃ©cemment Chrome a Ã©tÃ© utilisÃ© pour activer l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">isolation du site</a> .  Au fil du temps, il devient moins important en raison de l'amÃ©lioration du comportement des navigateurs par dÃ©faut, mais fait toujours partie des meilleures pratiques. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CORS</a> .  Les en-tÃªtes de partage de ressources d'origine croisÃ©e vous permettent de charger une URL avec un script provenant d'une autre source.  Il s'agit d'un titre facultatif.  Les rubriques de ce type sont permissives et non prohibitives, leur absence offre donc le niveau de sÃ©curitÃ© maximal. <br><br>  D'autres sont pour la performance: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Timing-Allow-Origin</a> .  Donne accÃ¨s aux outils de surveillance pour demander les donnÃ©es de synchronisation.  Il s'agit Ã  bien des Ã©gards d'informations prÃ©cieuses, elles peuvent grandement amÃ©liorer la qualitÃ© des analyses comme Google Analytics ou Speedcurve. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien rel = prÃ©charge</a> .  Indique au navigateur les ressources critiques qui doivent Ãªtre tÃ©lÃ©chargÃ©es, mÃªme si elles ne sont pas immÃ©diatement nÃ©cessaires.  Utilisez l'en-tÃªte pour les polices et les CSS importants. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Synchronisation du serveur</a>  Fournit des informations de synchronisation du serveur qui complÃ¨tent l'API de synchronisation de navigation et l'API de synchronisation des ressources avec des informations plus dÃ©taillÃ©es sur le temps nÃ©cessaire pour effectuer les tÃ¢ches sur le serveur (par exemple, Â«combien de temps nous avons passÃ© dans MySQLÂ»).  IdÃ©al pour surveiller les donnÃ©es de performances, combinÃ© avec les outils RUM Beacon. <br><br>  Examinons de plus prÃ¨s certains d'entre eux. <br><br><h1>  Politique de sÃ©curitÃ© du contenu: respectez-la </h1><br>  Bien que <code>Content-Security-Policy</code> soit l'un des titres les plus importants, il est Ã©galement l'un des plus verbeux.  Le plus grand en-tÃªte CSP que j'ai trouvÃ© dans HTTPArchive Ã©tait 10K.  <i>Dix kilo-octets</i> .  Pour une seule valeur d'en-tÃªte.  Pire: alors que les corps de rÃ©ponse peuvent Ãªtre diffusÃ©s, les en-tÃªtes sont mis en mÃ©moire tampon par la plupart des serveurs et des proxys et transmis uniquement aprÃ¨s la fin.  La compression HTTP / 2 aide un <i>peu</i> Ã  les mÃ©moriser entre les requÃªtes, mais cela ne signifie pas que l'en-tÃªte de 10 Ko est correct. <br><br>  De plus, en remplissant le premier paquet entier de votre rÃ©ponse, vous pouvez forcer le navigateur Ã  faire deux appels au serveur <b>juste pour commencer Ã  recevoir le contenu</b> .  Pensez donc non seulement Ã  supprimer les en-tÃªtes inutiles, mais aussi Ã  maximiser les en-tÃªtes existants. <br><br><h1>  Referrer-policy </h1><br>  Depuis des temps immÃ©moriaux (c'est-Ã -dire dans le monde du Web depuis la fin des annÃ©es 90 environ), les navigateurs envoient (et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ã©crivent incorrectement</a> ) l'en-tÃªte <code>Referer</code> .  Pour la majeure partie de son histoire, cela a Ã©tÃ© l'un des moyens les plus importants de suivre les mouvements des utilisateurs entre les pages dans les outils d'analyse, ainsi que de comprendre l'origine du trafic entrant.  Cependant, ce dernier est associÃ© Ã  d'importants problÃ¨mes de confidentialitÃ©.  Si je clique sur le lien dans l'e-mail du client de messagerie, le site peut dÃ©terminer mon domaine de messagerie.  Pire encore, connaÃ®tre l'URL complÃ¨te d'oÃ¹ vous venez, y compris les arguments de la demande, peut rÃ©vÃ©ler les termes de votre derniÃ¨re requÃªte de recherche ou des donnÃ©es personnelles telles qu'une adresse e-mail. <br><br>  Vous pouvez sÃ©lectionner plusieurs stratÃ©gies parmi les options de politique de rÃ©fÃ©rence disponibles, mais mon conseil habituel est Â«origine-quand-origine croisÃ©eÂ», qui active le rÃ©fÃ©rent pour toutes les demandes normales, mais tronque la valeur uniquement vers le domaine si le lien passe d'un domaine Ã  un autre .  Les liens au sein de votre propre site incluent un rÃ©fÃ©rent complet. <br><br><h1>  Mesure de la synchronisation du serveur sur le serveur CDN Edge </h1><br>  <code>Server-Timing</code> a de nombreuses fonctionnalitÃ©s intÃ©ressantes, et l'une d'entre elles est que vous pouvez ajouter plusieurs instances en rÃ©ponse - et toutes seront combinÃ©es dans un navigateur ou un outil RUM.  Autrement dit, si la demande passe par plusieurs Ã©tapes de traitement du serveur - comme cela se produit dans le CDN - chaque Ã©tape ajoute ses propres mesures de temps, et elles n'entrent pas en conflit les unes avec les autres.  Voici comment ajouter des mÃ©triques Fastly Ã  l'en-tÃªte Ã  l'aide de VCL dans la configuration du service Fastly: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">add</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Timing</span></span> = fastly_info.state {", fastly;desc="Edge <span class="hljs-type"><span class="hljs-type">time</span></span>";dur="} <span class="hljs-type"><span class="hljs-type">time</span></span>.elapsed.msec;</code> </pre> <br>  Ce nombre inclut le temps passÃ© Ã  attendre le backend, donc dans le cas normal, toutes les mÃ©triques de temps de votre serveur seront infÃ©rieures au nombre Fastly.  Cependant, si nous Ã©mettons un document Ã  partir du cache Fastly, vous verrez les mesures de temps d'origine Ã  partir du moment oÃ¹ la page a Ã©tÃ© gÃ©nÃ©rÃ©e, mais le nombre Fastly confirmera que la perte de temps totale est en fait trÃ¨s faible. <br><br>  Les mesures d'heure du serveur sont disponibles via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'objet de performance en JavaScript</a> et sont affichÃ©es dans le volet rÃ©seau de Chrome Devtools: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d2e/5e2/349/d2e5e23497238f2cdf12cddf0c6dedb5.png"><br><br>  Actuellement, visualisation des indicateurs au niveau rudimentaire.  Mais ils y travaillent dur, donc Ã  l'avenir, l'interface utilisateur devrait s'amÃ©liorer considÃ©rablement. <br><br><h1>  Ajoutez tous les en-tÃªtes corrects. </h1><br>  Fastly est un bon endroit pour ajouter tous les en-tÃªtes de sÃ©curitÃ© et de performances.  Ce qui suit montre comment ils se ressemblent tous.  Ajoutez ce code Ã  l'Ã©tape de livraison du flux de demandes, en changeant les valeurs en celles qui conviennent Ã  votre site ( <b>essayez de ne pas copier et coller</b> sans vÃ©rifier que les valeurs conviennent Ã  votre site): <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.Content-<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Policy</span></span> = "default-src 'self'; frame-ancestors 'self'"; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.Referer-<span class="hljs-keyword"><span class="hljs-keyword">Policy</span></span> = "origin-when-cross-origin"; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Strict</span></span>-Transport-<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span> = "max-age=86400"; # Increase <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> working well <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prod (a year <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a common final <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.X-XSS-Protection = "1; mode=block"; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.X-Content-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span> = "nosniff"; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (req.http.Origin) { # Consider checking this against an allowlist <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Access</span></span>-Control-Allow-Origin = req.http.Origin; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Access</span></span>-Control-Allow-Methods = "GET,HEAD,POST,OPTIONS"; } <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Timing</span></span> = fastly_info.state {", fastly;desc="Edge <span class="hljs-type"><span class="hljs-type">time</span></span>";dur="} <span class="hljs-type"><span class="hljs-type">time</span></span>.elapsed.msec; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Timing</span></span>-Allow-Origin = "*"; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.Link = "&lt;/fonts/myfont.otf&gt;; rel=preload; as=font";</code> </pre> <br>  Dans le prochain article, nous examinerons certains des en-tÃªtes les plus exotiques qui commencent Ã  standardiser et Ã  implÃ©menter dans les navigateurs. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413205/">https://habr.com/ru/post/fr413205/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413189/index.html">Collection d'ombres Ã  paupiÃ¨res CSS Box-shadows.css</a></li>
<li><a href="../fr413193/index.html">Achat de fer contre le cloud: comment compter</a></li>
<li><a href="../fr413195/index.html">PensÃ©e fonctionnelle. Partie 6</a></li>
<li><a href="../fr413199/index.html">Les Ã©checs des futurologues. Des idÃ©es de films qui ne se sont pas concrÃ©tisÃ©s</a></li>
<li><a href="../fr413203/index.html">ICO et sÃ©curitÃ©: analyse du concours de veille concurrentielle aux Positive Hack Days</a></li>
<li><a href="../fr413207/index.html">PGCon 2018: photos, diapositives, impressions</a></li>
<li><a href="../fr413211/index.html">Analyser l'application Avito iOS: demandez-moi n'importe quoi</a></li>
<li><a href="../fr413213/index.html">Apple WWDC 2018: diffusion de texte</a></li>
<li><a href="../fr413215/index.html">GitHub appartient dÃ©sormais officiellement Ã  Microsoft</a></li>
<li><a href="../fr413217/index.html">Les voitures Ã©lectriques sont-elles si respectueuses de l'environnement?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>