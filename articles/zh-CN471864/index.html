<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ ğŸ¤¶ ğŸ¤§ PEGè§£æå™¨ç”Ÿæˆ ğŸŒ ğŸšº ğŸ´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç°åœ¨ï¼Œæˆ‘å·²ç»æ¦‚è¿°äº†ä¸“æœ‰è§£æå™¨çš„åŸºç¡€ï¼Œè®©æˆ‘ä»¬ç»§ç»­æŒ‰ç…§æˆ‘çš„æ‰¿è¯ºï¼Œä»è¯­æ³•ç”Ÿæˆå…¶æ–¹æ³•ã€‚ æˆ‘è¿˜å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨@memoizeè£…é¥°å™¨å®ç°packratè§£æå™¨ã€‚ 
 Python PEGè§£æå™¨ç³»åˆ—å†…å®¹ 

- é’‰è§£æå™¨ 
- PEGè§£æå™¨å®ç° 
- PEGè§£æå™¨ç”Ÿæˆ 
- PEGè§£æå™¨å¯è§†åŒ– 
- å·¦é€’å½’PEGè¯­...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PEGè§£æå™¨ç”Ÿæˆ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471864/"><p>ç°åœ¨ï¼Œæˆ‘å·²ç»æ¦‚è¿°äº†ä¸“æœ‰è§£æå™¨çš„åŸºç¡€ï¼Œè®©æˆ‘ä»¬ç»§ç»­æŒ‰ç…§æˆ‘çš„æ‰¿è¯ºï¼Œä»è¯­æ³•ç”Ÿæˆå…¶æ–¹æ³•ã€‚ æˆ‘è¿˜å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨<code>@memoize</code>è£…é¥°å™¨å®ç°packratè§£æå™¨ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">Python PEGè§£æå™¨ç³»åˆ—å†…å®¹</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é’‰è§£æå™¨</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PEGè§£æå™¨å®ç°</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PEGè§£æå™¨ç”Ÿæˆ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PEGè§£æå™¨å¯è§†åŒ–</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å·¦é€’å½’PEGè¯­æ³•</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‘PEGè¯­æ³•æ·»åŠ åŠ¨ä½œ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PEGè§£æå™¨çš„å…ƒè¯­æ³•</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®æ–½PEGçš„å…¶ä½™åŠŸèƒ½</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ ¸å¿ƒå¼€å‘è€…Sprintä¸Šçš„PEG</a> </li></ul></div></div><br><p> ä¸Šä¸€æ¬¡ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ä¸€äº›è§£æå™¨æ–¹æ³•ã€‚ ç”±äºæœ‰äº›é™åˆ¶æˆ‘ä»¬ç¨åä¼šåˆ é™¤ï¼Œå› æ­¤å¾ˆå®¹æ˜“è‡ªåŠ¨ä»è¯­æ³•ä¸­ç”Ÿæˆå®ƒä»¬ã€‚ </p><a name="habracut"></a><br><p> æˆ‘ä»¬éœ€è¦ä¸¤ä»¶äº‹ï¼šè¯»å–è¯­æ³•å¹¶å»ºç«‹é€‚å½“æ•°æ®ç»“æ„çš„ä¸œè¥¿ï¼› ä»¥åŠé‡‡ç”¨æ­¤æ•°æ®ç»“æ„å¹¶ç”Ÿæˆè§£æå™¨çš„å¯¹è±¡ã€‚ æˆ‘ä»¬è¿˜éœ€è¦å…¶ä»–è¾…åŠ©æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä»¬å¹¶ä¸æœ‰è¶£ï¼Œå› æ­¤æˆ‘å°†çœç•¥å®ƒä»¬ã€‚ </p><br><p> å› æ­¤ï¼Œæˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¼–è¯‘å™¨ç¼–è¯‘å™¨ã€‚ æˆ‘å°†åœ¨æŸç§ç¨‹åº¦ä¸Šç®€åŒ–è¯­æ³•ç¬¦å·ï¼Œä½¿å…¶ä»…å…·æœ‰è§„åˆ™å’Œæ›¿ä»£æ–¹å¼ã€‚ è¿™å®é™…ä¸Šè¶³ä»¥æ»¡è¶³æˆ‘åœ¨å‰é¢å„éƒ¨åˆ†ä¸­ä½¿ç”¨çš„ç©å…·è¯­æ³•ï¼š </p><br><pre> <code class="plaintext hljs">statement: assignment | expr | if_statement expr: expr '+' term | expr '-' term | term term: term '*' atom | term '/' atom | atom atom: NAME | NUMBER | '(' expr ')' assignment: target '=' expr target: NAME if_statement: 'if' expr ':' statement</code> </pre> <br><p> ä½¿ç”¨å®Œæ•´çš„ç¬¦å·ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯­æ³•æè¿°ä¸ºï¼š </p><br><pre> <code class="plaintext hljs">grammar: rule+ ENDMARKER rule: NAME ':' alternative ('|' alternative)* NEWLINE alternative: item+ item: NAME | STRING</code> </pre> <br><p> è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå…ƒè¯­æ³•ï¼ˆè¯­æ³•ä¸ºè¯­æ³•ï¼‰ï¼Œè§£æå™¨ç”Ÿæˆå™¨å°†ä¸ºå…ƒç¼–è¯‘å™¨ï¼ˆç¼–è¯‘å™¨ä¸ºå°†ç¨‹åºä»ä¸€ç§è¯­è¨€ç¿»è¯‘ä¸ºå¦ä¸€ç§è¯­è¨€çš„ç¨‹åºï¼›å…ƒç¼–è¯‘å™¨ä¸ºè¾“å…¥ä¸ºè¯­æ³•çš„ç¼–è¯‘å™¨ï¼Œå¹¶ä¸”è¾“å‡ºæ˜¯è§£æå™¨ï¼‰ã€‚ </p><br><p> æè¿°å…ƒè¯­æ³•çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯ä»…ä½¿ç”¨å†…ç½®æ•°æ®ç±»å‹ï¼šè§„åˆ™çš„å³ä¾§æ˜¯å…ƒç´ åˆ—è¡¨çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ åˆ—è¡¨éƒ½å¯ä»¥åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚  ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯å¼•å·æ¥åˆ†éš”<code>NAME</code>å’Œ<code>STRING</code> ï¼‰ </p><br><p> å¯¹äºè§„åˆ™ï¼Œæˆ‘ä½¿ç”¨ç®€å•çš„<code>Rule</code>ç±»ï¼Œæ•´ä¸ªè¯­æ³•æ˜¯æ­¤ç±»å¯¹è±¡çš„åˆ—è¡¨ã€‚ è¿™æ˜¯<code>Rule</code>ç±»ï¼Œä¸åŒ…æ‹¬<code>__repr__</code>å’Œ<code>__eq__</code> ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rule</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, alts)</span></span></span><span class="hljs-function">:</span></span> self.name = name self.alts = alts</code> </pre> <br><p> è¿™æ˜¯ä½¿ç”¨å®ƒçš„<code>GrammarParser</code>ç±»ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GrammarParser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Parser)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">grammar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> pos = self.mark() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rule := self.rule(): rules = [rule] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> rule := self.rule(): rules.append(rule) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.expect(ENDMARKER): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rules <span class="hljs-comment"><span class="hljs-comment"># &lt;------------- final result self.reset(pos) return None def rule(self): pos = self.mark() if name := self.expect(NAME): if self.expect(":"): if alt := self.alternative(): alts = [alt] apos = self.mark() while (self.expect("|") and (alt := self.alternative())): alts.append(alt) apos = self.mark() self.reset(apos) if self.expect(NEWLINE): return Rule(name.string, alts) self.reset(pos) return None def alternative(self): items = [] while item := self.item(): items.append(item) return items def item(self): if name := self.expect(NAME): return name.string if string := self.expect(STRING): return string.string return None</span></span></code> </pre> <br><p> æ³¨æ„<code>ENDMARKER</code>çš„ä½¿ç”¨ã€‚ åœ¨é‚£é‡Œï¼Œæˆ‘ç¡®ä¿åœ¨æœ€åä¸€æ¡è§„åˆ™ä¹‹åæ²¡æœ‰å‰©ä¸‹ä»»ä½•ä¸œè¥¿ï¼ˆå¦‚æœè¯­æ³•ä¸­æœ‰é”™å­—ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼‰ã€‚ æˆ‘è¿˜æŒ‡å‡ºäº†<code>grammar()</code>æ–¹æ³•è¿”å›è§„åˆ™åˆ—è¡¨çš„åœ°æ–¹ã€‚ å…¶ä»–æ‰€æœ‰å†…å®¹éƒ½ä¸ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„<code>ToyParser</code>ç±»éå¸¸ç›¸ä¼¼ï¼Œå› æ­¤æˆ‘å°†ä¸å†<code>ToyParser</code> ã€‚ åªéœ€æ³¨æ„<code>item()</code>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ <code>alternative()</code>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œ <code>rule()</code>å†…çš„å˜é‡<code>alts</code>æ”¶é›†ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨åˆ—è¡¨ã€‚ ç„¶åï¼Œ <code>rule()</code>æ–¹æ³•ç»„åˆè§„åˆ™ï¼ˆå­—ç¬¦ä¸²ï¼‰çš„åç§°ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º<code>Rule</code>å¯¹è±¡ã€‚ </p><br><p> å¦‚æœæˆ‘ä»¬å°†æ­¤ç®—æ³•åº”ç”¨äºç©å…·è¯­æ³•ï¼Œåˆ™<code>grammar()</code>æ–¹æ³•å°†è¿”å›ä»¥ä¸‹è§„åˆ™åˆ—è¡¨ï¼š </p><br><pre> <code class="plaintext hljs">[ Rule('statement', [['assignment'], ['expr'], ['if_statement']]), Rule('expr', [['term', "'+'", 'expr'], ['term', "'-'", 'term'], ['term']]), Rule('term', [['atom', "'*'", 'term'], ['atom', "'/'", 'atom'], ['atom']]), Rule('atom', [['NAME'], ['NUMBER'], ["'('", 'expr', "')'"]]), Rule('assignment', [['target', "'='", 'expr']]), Rule('target', [['NAME']]), Rule('if_statement', [["'if'", 'expr', "':'", 'statement']]), ]</code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬æœ‰äº†å…ƒç¼–è¯‘å™¨çš„è§£æéƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ã€‚ å®ƒä»¬ä¸€èµ·æ„æˆäº†åŸºæœ¬çš„å…ƒç¼–è¯‘å™¨ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_parser_class</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rules)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">f"class ToyParser(Parser):"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rule <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rules: print() print(<span class="hljs-string"><span class="hljs-string">f" @memoize"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" def </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{rule.name}</span></span></span><span class="hljs-string">(self):"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" pos = self.mark()"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> alt <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rule.alts: items = [] print(<span class="hljs-string"><span class="hljs-string">f" if (True"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> alt: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'"'</span></span>, <span class="hljs-string"><span class="hljs-string">"'"</span></span>): print(<span class="hljs-string"><span class="hljs-string">f" and self.expect(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{item}</span></span></span><span class="hljs-string">)"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: var = item.lower() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items: var += str(len(items)) items.append(var) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item.isupper(): print(<span class="hljs-string"><span class="hljs-string">" "</span></span> + <span class="hljs-string"><span class="hljs-string">f"and (</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{var}</span></span></span><span class="hljs-string"> := self.expect(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{item}</span></span></span><span class="hljs-string">))"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">f" "</span></span> + <span class="hljs-string"><span class="hljs-string">f"and (</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{var}</span></span></span><span class="hljs-string"> := self.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{item}</span></span></span><span class="hljs-string">())"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" ):"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" "</span></span> + <span class="hljs-string"><span class="hljs-string">f"return Node(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{rule.name!r}</span></span></span><span class="hljs-string">, [</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">', '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.join(items)}</span></span></span><span class="hljs-string">])"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" self.reset(pos)"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" return None"</span></span>)</code> </pre> <br><p> è¿™æ®µä»£ç å¾ˆä¸‘é™‹ï¼Œä½†æ˜¯å¯ä»¥ï¼ˆæœ‰ç‚¹ï¼‰èµ·ä½œç”¨ï¼Œå°†æ¥æˆ‘ä»ç„¶ä¼šé‡å†™å®ƒã€‚ </p><br><p>  <code>for alt in rule.alts</code>å†…çš„æŸäº›è¡Œå¯èƒ½éœ€è¦è¯´æ˜ï¼šå¯¹äºæ›¿ä»£æ–¹æ¡ˆä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬é€‰æ‹©3ä¸ªé€‰é¡¹ä¹‹ä¸€ï¼š </p><br><ul><li> å¦‚æœå…ƒç´ æ˜¯å­—ç¬¦ä¸²æ–‡å­—ï¼Œä¾‹å¦‚<code>'+'</code> ï¼Œåˆ™ç”Ÿæˆ<code>self.expect('+')</code> </li><li> å¦‚æœå…ƒç´ æ˜¯å®Œå…¨å¤§å†™çš„ï¼Œä¾‹å¦‚<code>NAME</code> ï¼Œåˆ™ç”Ÿæˆ<code>(name := self.expect(NAME))</code> </li><li> å¦åˆ™ï¼Œä¾‹å¦‚ï¼Œå¦‚æœå®ƒæ˜¯<code>expr</code> ï¼Œåˆ™æˆ‘ä»¬ç”Ÿæˆ<code>(expr := self.expr())</code> </li></ul><br><p> å¦‚æœä¸€ä¸ªå˜ä½“ä¸­æœ‰å¤šä¸ªå…·æœ‰ç›¸åŒåç§°çš„å…ƒç´ ï¼ˆä¾‹å¦‚ï¼Œ <code>term '-' term</code> ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªå˜é‡ä¸­æ·»åŠ ä¸€ä¸ªæ•°å­—ã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°é”™è¯¯ï¼Œæˆ‘å°†åœ¨ä¸‹ä¸€é›†ä¸­çº æ­£ã€‚ </p><br><p> è¿™æ˜¯ä»–å·¥ä½œçš„ç»“æœï¼ˆæ•´ä¸ªç­çº§ä¼šå¾ˆæ— èŠï¼‰ã€‚ ä¸å¿…æ‹…å¿ƒéœ€è¦å¤šä½™çš„<code>if (True and</code> ... <code>)</code>ä»£ç ï¼Œä»¥ä¾¿æ¯ä¸ªç”Ÿæˆçš„æ¡ä»¶éƒ½å¯ä»¥ä»¥<code>and</code>å¼€å¤´ã€‚  Pythonå­—èŠ‚ç¼–è¯‘å™¨å¯¹æ­¤è¿›è¡Œäº†ä¼˜åŒ–ã€‚ </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToyParser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Parser)</span></span></span><span class="hljs-class">:</span></span> @memoize <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">statement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> pos = self.mark() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (assignment := self.assignment()) ): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Node(<span class="hljs-string"><span class="hljs-string">'statement'</span></span>, [assignment]) self.reset(pos) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (expr := self.expr()) ): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Node(<span class="hljs-string"><span class="hljs-string">'statement'</span></span>, [expr]) self.reset(pos) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (if_statement := self.if_statement()) ): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Node(<span class="hljs-string"><span class="hljs-string">'statement'</span></span>, [if_statement]) self.reset(pos) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> ...</code> </pre> <br><p> è¯·æ³¨æ„<code>@memoize</code>è£…é¥°å™¨ï¼šæˆ‘å°†å…¶å¼•å…¥åˆ°å¦ä¸€ä¸ªä¸»é¢˜ï¼šä½¿ç”¨å¤‡å¿˜å½•ä½¿ç”Ÿæˆçš„è§£æå™¨è¶³å¤Ÿå¿«ã€‚ </p><br><p> è¿™æ˜¯å®ç°æ­¤è£…é¥°å™¨çš„<code>memoize()</code>å‡½æ•°ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">memoize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">memoize_wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args)</span></span></span><span class="hljs-function">:</span></span> pos = self.mark() memo = self.memos.get(pos) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> memo <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: memo = self.memos[pos] = {} key = (func, args) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> memo: res, endpos = memo[key] self.reset(endpos) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: res = func(self, *args) endpos = self.mark() memo[key] = res, endpos <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> memoize_wrapper</code> </pre> <br><p> ä¸å…¶ä»–è£…é¥°å™¨ä¸€æ ·ï¼Œå®ƒåŒ…å«ä¸€ä¸ªåµŒå¥—å‡½æ•°ï¼Œè¯¥å‡½æ•°æ›¿æ¢ï¼ˆæˆ–åŒ…è£…ï¼‰ä¸€ä¸ªè£…é¥°å‡½æ•°ï¼Œä¾‹å¦‚<code>ToyParser</code>ç±»çš„<code>statement()</code>æ–¹æ³•ã€‚ ç”±äºè¦åŒ…è£…çš„å‡½æ•°æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå› æ­¤åŒ…è£…å™¨å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼šå…¶åŒ…è£…çš„ç¬¬ä¸€ä¸ªå‚æ•°ç§°ä¸º<code>self</code>å¹¶å¼•ç”¨ä¸ºå…¶è°ƒç”¨è£…é¥°æ–¹æ³•çš„<code>ToyParser</code>å®ä¾‹ã€‚ </p><br><p> åŒ…è£…å™¨ä¸ºæ¯ä¸ªè¾“å…¥ä½ç½®ç¼“å­˜æ–¹æ³•è°ƒç”¨çš„ç»“æœ-è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒè¢«ç§°ä¸ºpackratè§£æå™¨ï¼  [å¤§çº¦ åå¼  packratæ˜¯â€œå°å·â€ï¼Œä½†æœªåœ¨ä¿„è¯­è¯­è¨€ä¸­ç¿»è¯‘æ­¤æœ¯è¯­ã€‚] Cacheæ˜¯â€‹â€‹å­—å…¸çš„å­—å…¸ï¼Œå­˜å‚¨åœ¨<code>Parser</code>å®ä¾‹ä¸­ã€‚ å¤–éƒ¨è¯å…¸çš„å…³é”®å­—æ˜¯è¾“å…¥æ•°æ®æµä¸­çš„ä½ç½®ã€‚ æˆ‘è¿˜æ·»åŠ äº†<code>self.memos = {}</code>åˆ°<code>Parser .__ init__()</code>è¿›è¡Œåˆå§‹åŒ–ã€‚ æ ¹æ®éœ€è¦æ·»åŠ å†…éƒ¨è¯å…¸ï¼› å®ƒä»¬çš„é”®ç”±ä¸€ä¸ªæ–¹æ³•åŠå…¶å‚æ•°ç»„æˆã€‚  ï¼ˆå½“å‰è®¾è®¡ä¸­æ²¡æœ‰å‚æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è®°ä½å¸¦æœ‰ä¸€ä¸ªçš„Expect <code>expect()</code>å‡½æ•°ï¼Œè¿™æ˜¯éå¸¸çç¢çš„ï¼‰ </p><br><p> è§£æå™¨æ–¹æ³•çš„ç»“æœä»¥å…ƒç»„çš„å½¢å¼è¡¨ç¤ºï¼Œå› ä¸ºå®é™…ä¸Šæœ‰ä¸¤ä¸ªå€¼ï¼šç»“æœæœ¬èº«ï¼ˆå¯¹äºæˆ‘ä»¬ç”Ÿæˆçš„æ–¹æ³•ï¼Œè¿™æ˜¯åŒ¹é…è§„åˆ™çš„<code>Node</code> ï¼‰å’Œä¸€ä¸ªæŒ‡å‘è¾“å…¥æµä¸­å½“å‰ä½ç½®çš„æŒ‡é’ˆï¼Œè¿™æ˜¯æˆ‘ä»¬ä»<code>self.mark()</code> ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åœ¨å†…éƒ¨å­—å…¸ä¸­ä½¿ç”¨è¿”å›å€¼æ¥ç¼“å­˜è¿”å›å€¼ï¼ˆ <code>res</code> ï¼‰å’Œæ–°ä½ç½®ï¼ˆ <code>endpos</code> ï¼‰ã€‚ åœ¨éšåä½¿ç”¨ç›¸åŒå‚æ•°åœ¨ç›¸åŒè¾“å…¥ä½ç½®è°ƒç”¨ç›¸åŒè§£ææ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä»ç¼“å­˜ä¸­è·å–å®ƒä»¬ã€‚ ä¸ºæ­¤ï¼Œåªéœ€ä½¿ç”¨<code>self.reset()</code>å°†æŒ‡é’ˆç§»è‡³è¾“å…¥ä½ç½®ï¼Œç„¶åæŸ¥çœ‹ç¼“å­˜å³å¯ã€‚ </p><br><p> ç¼“å­˜è´Ÿé¢ç»“æœä¹Ÿå¾ˆé‡è¦-å®é™…ä¸Šï¼Œå¤§å¤šæ•°è°ƒç”¨å°†æ˜¯è´Ÿé¢çš„ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›å€¼ä¸º<code>None</code> ï¼Œå¹¶ä¸”è¾“å…¥ä½ç½®ä¸å˜ã€‚ æ‚¨å¯ä»¥æ·»åŠ <code>assert</code>æ¥æ£€æŸ¥ã€‚ </p><br><p> æ³¨æ„äº‹é¡¹ åœ¨Pythonä¸­ï¼Œä¹ æƒ¯ä¸Šåœ¨<code>memoize()</code>å‡½æ•°çš„å±€éƒ¨å˜é‡ä¸­å®ç°ç¼“å­˜ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ˜¯è¡Œä¸é€šçš„ï¼šæ­£å¦‚æˆ‘åœ¨è°ƒè¯•ç»“æŸæ—¶å‘ç°çš„é‚£æ ·ï¼Œæ¯ä¸ª<code>Parser</code>å®ä¾‹å¿…é¡»å…·æœ‰è‡ªå·±çš„ç¼“å­˜ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼ˆ <code>pos</code> ï¼Œ <code>func</code> ï¼Œ <code>args</code> ï¼‰ä½œä¸ºé”®æ¥æ¶ˆé™¤åµŒå¥—å­—å…¸ã€‚ </p><br><p> ä¸‹å‘¨ï¼Œæˆ‘å°†å‡†å¤‡ä»£ç å’Œè·Ÿè¸ªè®°å½•ï¼Œä»¥æ˜¾ç¤ºåœ¨è§£æç¤ºä¾‹ç¨‹åºæ—¶å¦‚ä½•å®é™…ç»„è£…å’Œæ‰§è¡Œæ‰€æœ‰è¿™äº›æ“ä½œã€‚ æˆ‘ä»åœ¨å¯»æ‰¾ä¸€ç§æ›´å¥½çš„æ–¹æ³•æ¥å¯è§†åŒ–æ ‡è®°åŒ–ç¼“å†²åŒºï¼Œè§£æå™¨å’Œç¼“å­˜çš„åä½œã€‚ ä¹Ÿè®¸æˆ‘å°†èƒ½å¤Ÿä»¥ASCIIæ ¼å¼åˆ›å»ºåŠ¨ç”»gifï¼Œè€Œä¸ä»…ä»…æ˜¯å°†è·Ÿè¸ªåˆ—è¡¨æ˜¾ç¤ºä¸ºæ–‡æœ¬ã€‚ </p><br><p> æœ¬æ–‡å’Œå¼•ç”¨ä»£ç çš„è®¸å¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CC BY-NC-SA 4.0</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471864/">https://habr.com/ru/post/zh-CN471864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471854/index.html">çƒ­æ­»5G</a></li>
<li><a href="../zh-CN471856/index.html">æˆ‘ä»¬è§£å†³äº†æ‰€æœ‰42ä¸ªç‰ˆæœ¬çš„å“ˆåˆ©æ³¢ç‰¹é­”è¯</a></li>
<li><a href="../zh-CN471858/index.html">RabbitMQä¸Kafkaï¼šç¾¤é›†ä¸­çš„æ•…éšœè½¬ç§»å’Œé«˜å¯ç”¨æ€§</a></li>
<li><a href="../zh-CN471860/index.html">é’‰è§£æå™¨</a></li>
<li><a href="../zh-CN471862/index.html">PEGè§£æå™¨å®ç°</a></li>
<li><a href="../zh-CN471866/index.html">PEGè§£æå™¨å¯è§†åŒ–</a></li>
<li><a href="../zh-CN471872/index.html">Cï¼ƒ8ä¸­çš„æ¥å£ï¼šé»˜è®¤å®ç°ä¸­çš„å±é™©å‡è®¾</a></li>
<li><a href="../zh-CN471874/index.html">æˆ‘ä»¬å¦‚ä½•ç»•è¿‡å®¡æ ¸æŒ‡å—å¹¶åœ¨ç”µè¯ä¸Šå¯åŠ¨æœåŠ¡å™¨</a></li>
<li><a href="../zh-CN471876/index.html">PDUå’Œæ‰€æœ‰æ‰€æœ‰åŠŸèƒ½ï¼šæœºæ¶é…ç”µ</a></li>
<li><a href="../zh-CN471878/index.html">å¦‚ä½•åœ¨æœ¬ä½“ç½‘ç»œä¸Šä¸ºWebAssemblyç¼–å†™æ™ºèƒ½åˆçº¦ï¼Ÿ ç¬¬1éƒ¨åˆ†ï¼šé“é”ˆ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>