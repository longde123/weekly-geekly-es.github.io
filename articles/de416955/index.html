<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèïÔ∏è üë©üèª‚Äçüåæ ü§òüèª Kleine Tricks mit Elasticsearch ü§¥üèª ‚ù§Ô∏è üññüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine kurze Anmerkung, eher f√ºr mich, √ºber kleine Tricks zur Datenwiederherstellung in Elasticsearch. Wie man den roten Index repariert, wenn keine Sic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kleine Tricks mit Elasticsearch</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416955/">  Eine kurze Anmerkung, eher f√ºr mich, √ºber kleine Tricks zur Datenwiederherstellung in Elasticsearch.  Wie man den roten Index repariert, wenn keine Sicherung vorhanden ist, was zu tun ist, wenn ich die Dokumente gel√∂scht habe und keine Kopie mehr vorhanden ist - leider schweigen sie in der offiziellen Dokumentation √ºber diese Funktionen. <br><a name="habracut"></a><br><h2>  Backups </h2><br><img src="https://habrastorage.org/webt/ov/ua/p_/ovuap_rbyndffch-bceedhmlzis.png"><br><br>  Als erstes m√ºssen Sie Sicherungen wichtiger Daten einrichten.  Wie dies gemacht wird, ist in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>offiziellen Dokumentation beschrieben</b></a> . <br><br>  Alles in allem nichts kompliziertes.  Erstellen Sie in der einfachsten Version einen Ball auf einem anderen Server und h√§ngen Sie ihn auf bequeme Weise an alle elastischen Knoten an (nfs, smbfs, was auch immer).  Verwenden Sie als N√§chstes cron, Ihre Anwendung oder etwas anderes, um Anforderungen f√ºr regelm√§√üige Snapshots zu senden. <br><br>  Der erste Schnappschuss ist lang, die folgenden enthalten nur das Delta zwischen den Zust√§nden des Index.  Beachten Sie, dass das Delta sehr gro√ü ist, wenn Sie regelm√§√üig ein <b>Forcemerge durchf√ºhren. Dementsprechend</b> ist die Zeit, <b>die</b> zum Erstellen eines Snapshots ben√∂tigt wird, wie beim ersten Mal. <br><br>  Was zu beachten ist: <br><br><ul><li> √úberpr√ºfen Sie den Status von Sicherungen, z. B. mit _cat: <code>curl localhost:9200/_cat/snapshots/ <b>yourbackuprepo</b> /</code> .  <b>Teilweise</b> oder <b>fehlgeschlagene</b> Schnappsch√ºsse sind nicht dein Bruder. </li><li>  Ab ES 6.x ist das Gummiband auf Anfrage sehr anspruchsvoll.  Wenn Sie sie manuell ausf√ºhren (nicht √ºber die API), √ºberpr√ºfen Sie, ob Sie <code>Content-Type: application/json</code> haben. Andernfalls werden alle Ihre Anforderungen einfach abgebrochen und die Sicherung findet nicht statt </li><li>  Snapshot kann nicht in einem offenen Index wiederhergestellt werden.  Es muss zuerst geschlossen oder entfernt werden.  Sie k√∂nnen den Snapshot jedoch nebeneinander mit rename_pattern, rename_replacement wiederherstellen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">siehe Beispiel im Dock</a> ).  Wenn ein Snapshot wiederhergestellt wird, werden auch seine Einstellungen wiederhergestellt, einschlie√ülich Aliase, Anzahl der Replikate usw.  Wenn Sie dies nicht ben√∂tigen, f√ºgen Sie index_settings ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein Beispiel finden Sie im Dock</a> ) mit den erforderlichen √Ñnderungen an der Wiederherstellungsanforderung hinzu. </li><li>  Repos (Ball) mit Snapshots k√∂nnen mit mehr als einem Cluster verbunden werden und Snapshots von jedem Cluster in einem anderen wiederherstellen.  Die Hauptsache ist, dass die elastischen Versionen kompatibel sind. </li></ul><br>  Schauen Sie sich im Allgemeinen die Dokumentation an, dort wird dieses Thema mehr oder weniger offengelegt. <br><br><h2>  Elasticdump </h2><br><img src="https://habrastorage.org/webt/w_/5e/xy/w_5exyoyb7acppvivweuwj1kmiq.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein kleines Dienstprogramm</a> auf nodejs, mit dem Sie Daten von einem Index in einen anderen Index, Cluster, Datei oder Standard kopieren k√∂nnen. <br><br>  √úbrigens kann die Ausgabe in eine Datei oder ein Standardout als alternative Sicherungsmethode verwendet werden - die Ausgabe ist ein regul√§r g√ºltiger JSON (so etwas wie SQL Dump), der nach Belieben wiederverwendet werden kann.  Beispielsweise k√∂nnen Sie die Ausgabe in eine Pipe einf√ºgen, in der Ihr Skript die Daten irgendwie transformiert und an ein anderes Repository wie Clickhouse sendet.  Die einfachsten js-Konvertierungen k√∂nnen direkt durch elasticdump selbst durchgef√ºhrt werden, es gibt eine entsprechende Schl√ºsseltransformation.  Im Allgemeinen ein Flug der Phantasie. <br><br>  Von den Fallstricken: <br><br><ul><li>  Als Sicherungsmethode ist es viel langsamer als Snapshots.  Au√üerdem wird die Sicherung im Laufe der Zeit erweitert, sodass das Ergebnis eines h√§ufig wechselnden Index m√∂glicherweise inkonsistent ist.  Denken Sie daran. </li><li>  Verwenden Sie keine NodeJs aus dem Debian-Repository. Es gibt eine zu alte Version, die sich negativ auf die Stabilit√§t der Tools auswirkt. </li><li>  Die Stabilit√§t kann variieren, insbesondere wenn eine der Parteien √ºberlastet ist.  Versuchen Sie nicht, von einem Server auf einen anderen zu sichern, indem Sie das Tool auf dem B√ºromaschinen ausf√ºhren. Der gesamte Datenverkehr flie√üt durch diesen. </li><li>  Abb. Zuordnungen kopieren.  Wenn Sie dort etwas Kompliziertes haben, erstellen Sie den Index manuell und f√ºllen Sie erst dann die Daten hinein. </li><li>  Manchmal ist es sinnvoll, die Gr√∂√üe des Blocks zu √§ndern (Parameter --limit).  Diese Option wirkt sich direkt auf die Kopiergeschwindigkeit aus. </li></ul><br>  Um eine gro√üe Anzahl von Indizes gleichzeitig zusammenzuf√ºhren, gibt es einen Multielasticdump mit einem vereinfachten Satz von Optionen, aber alle Indizes werden parallel zusammengef√ºhrt. <br><br>  <b>Hinweis!</b>  Der Autor des Dienstprogramms sagte, dass er keine Zeit mehr f√ºr die Unterst√ºtzung hat, daher <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>sucht</b></a> das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>Programm nach einem neuen Betreuer</b></a> . <br><br>  Aus pers√∂nlicher Erfahrung: n√ºtzlicher Nutzen, mehr als einmal gerettet.  Geschwindigkeit und Stabilit√§t sind so lala, ich h√§tte gerne einen angemessenen Ersatz, aber bisher ist nichts am Horizont. <br><br><h2>  Checkindex </h2><br>  Also n√§hern wir uns der dunklen Seite.  Situation: Der Index ist rot geworden.  In den Protokollen - etwas ist schief gelaufen, die Pr√ºfung stimmt nicht mit dem Betrag √ºberein, Sie haben wahrscheinlich einen Speicher oder eine Festplatte: <br><br> <code>org.apache.lucene.index.CorruptIndexException: checksum failed (hardware problem?)</code> <br> <br>  Nat√ºrlich passiert dies bei Mutteradministratoren nie, da sie √ºber Top-End-Hardware mit dreifacher Replikation, SuperECC-Speicher mit Korrektur aller Fehlerstufen im laufenden Betrieb und im Allgemeinen jede Sekunde konfigurierte Snapshots verf√ºgen. <br><br>  Aber die Realit√§t fordert leider manchmal solche Optionen auf, wenn die Sicherung relativ lang war (wenn Sie Gigabyte pro Stunde indiziert haben, ist die Sicherung vor 2 Stunden zu alt?). Es gibt keinen Ort zum Wiederherstellen der Daten, die Replikation hatte keine Zeit und √§hnliches. <br><br>  Nat√ºrlich, wenn es einen Schnappschuss, ein Backup oder √§hnliches gibt.  - Ausgezeichnet, ausrollen und keine Sorgen machen.  Und wenn nicht?  Gl√ºcklicherweise k√∂nnen zumindest einige der Daten noch gespeichert werden. <br><br>  Schlie√üen Sie zun√§chst den Index und / oder schalten Sie das Gummiband aus und erstellen Sie eine Sicherungskopie des ausgefallenen Shards. <br><br>  Lucene (das hei√üt, es funktioniert als Backend in der Elasticsearch) hat eine wunderbare CheckIndex-Methode.  Wir m√ºssen es nur √ºber eine zerbrochene Scherbe beschw√∂ren.  Lucene √ºberpr√ºft alle Segmente und entfernt die besch√§digten.  Ja, Daten gehen verloren, aber zumindest nicht alles.  Obwohl es so viel Gl√ºck gibt. <br><br>  Es gibt mindestens zwei M√∂glichkeiten. <br><br><h3>  Methode 1: Direkt vor Ort </h3><br>  Ein so einfaches Skript wird uns helfen. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash pushd /usr/share/elasticsearch/lib java -cp lucene-core*.jar -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex "$@" popd</span></span></code> </pre><br>  Wenn wir es ohne Parameter aufrufen, erhalten wir ungef√§hr Folgendes: <br><br><pre> <code class="hljs vhdl"><span class="hljs-literal"><span class="hljs-literal">ERROR</span></span>: index path <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> specified Usage: java org.apache.lucene.index.CheckIndex pathToIndex [-exorcise] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X] -exorcise: actually write a <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> segments_N <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>, removing any problematic segments -fast: just verify <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> checksums, omitting logical integrity checks -crossCheckTermVectors: verifies that term vectors match postings; THIS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> VERY SLOW! -codec X: <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> exorcising, codec <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> write the <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> segments_N <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> -verbose: print additional details -segment X: only check the specified segments. This can be specified multiple times, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> check more than one segment, eg '-segment _2 -segment _a'. You can<span class="hljs-symbol"><span class="hljs-symbol">'t</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> this <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> the -exorcise option -dir-impl X: <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> a specific FSDirectory implementation. <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> no <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> specified the org.apache.lucene.store <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> will be used. **<span class="hljs-literal"><span class="hljs-literal">WARNING</span></span>**: -exorcise *LOSES DATA*. This should only be used <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> an emergency basis as it will cause documents (perhaps many) <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be permanently removed from the index. Always make a backup copy <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> your index before running this! Do <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> run this tool <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> an index that <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> actively being written <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>. You have been warned! Run without -exorcise, this tool will <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> the index, <span class="hljs-keyword"><span class="hljs-keyword">report</span></span> version information <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">report</span></span> any exceptions it hits <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> what action it would take <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> -exorcise were specified. <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> -exorcise, this tool will remove any segments that have issues <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> write a <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> segments_N <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>. This means <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> documents contained <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the affected segments will be removed. This tool exits <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> code <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> the index cannot be opened <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> has any corruption, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.</code> </pre><br>  Tats√§chlich k√∂nnen wir entweder einfach den Indextest ausf√ºhren oder CheckIndex dazu bringen, ihn zu ‚Äûreparieren‚Äú und alles zu entfernen, was besch√§digt ist. <br><br>  Der Lucene-Index lebt ungef√§hr auf die gleiche Weise: / var / lib / elasticsearch / node / 0 / indices / str4ngEHashVa1uE / 0 / index /, wobei 0 und 0 die Knotennummer auf dem Server und die Nummer des Shards auf dem Knoten sind.  Der be√§ngstigende Wert zwischen ihnen - der interne Name des Index - kann aus der Ausgabe von curl localhost ermittelt werden: 9200 / _cat / indizes. <br><br>  Normalerweise mache ich eine Kopie in ein anderes Verzeichnis und repariere sie vor Ort.  Dann starte ich elasticsearch neu.  In der Regel wird alles abgeholt, wenn auch mit Datenverlust.  Manchmal m√∂chte der Index aufgrund der * besch√§digten * Dateien im Shards-Ordner immer noch nicht gelesen werden.  Bewahren Sie sie f√ºr eine Weile an einem sicheren Ort auf. <br><br><h3>  Methode 2: Luke </h3><br><img src="https://habrastorage.org/webt/t3/8s/pi/t38spiezlwrxrxynldo8qnj9bh0.png"><br>  (Bild aus dem Internet) <br><br>  Es gibt ein gro√üartiges Dienstprogramm f√ºr die Arbeit mit Lucene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">namens <b>Luke</b></a> . <br><br>  Hier ist es noch einfacher.  Finden Sie die Lucene-Version aus Ihrer Elasticsearch heraus: <br><br><pre> <code class="bash hljs">$ curl localhost:9200 { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"node00"</span></span>, <span class="hljs-string"><span class="hljs-string">"cluster_name"</span></span> : <span class="hljs-string"><span class="hljs-string">"main"</span></span>, <span class="hljs-string"><span class="hljs-string">"cluster_uuid"</span></span> : <span class="hljs-string"><span class="hljs-string">"UCbEivvLTcyWSQElOipgTQ"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span> : { <span class="hljs-string"><span class="hljs-string">"number"</span></span> : <span class="hljs-string"><span class="hljs-string">"6.2.4"</span></span>, <span class="hljs-string"><span class="hljs-string">"build_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"ccec39f"</span></span>, <span class="hljs-string"><span class="hljs-string">"build_date"</span></span> : <span class="hljs-string"><span class="hljs-string">"2018-04-12T20:37:28.497551Z"</span></span>, <span class="hljs-string"><span class="hljs-string">"build_snapshot"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"lucene_version"</span></span> : <span class="hljs-string"><span class="hljs-string">"7.2.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"minimum_wire_compatibility_version"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.6.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"minimum_index_compatibility_version"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.0.0"</span></span> }, <span class="hljs-string"><span class="hljs-string">"tagline"</span></span> : <span class="hljs-string"><span class="hljs-string">"You Know, for Search"</span></span> }</code> </pre><br>  Nimm die gleiche Version von Luke.  Wir √∂ffnen darin einen Index (Kopie nat√ºrlich) mit einer Morgend√§mmerung. <b>√ñffnen Sie den IndexReader nicht (wenn Sie einen besch√§digten Index √∂ffnen)</b> .  Klicken Sie anschlie√üend auf Extras / Index pr√ºfen.  Zuerst empfehle ich, trocken zu laufen und erst dann im Reparaturmodus.  Weitere Aktionen sind √§hnlich - kopieren Sie das Gummiband zur√ºck, starten Sie den Index neu / √∂ffnen Sie ihn. <br><br><h2>  Gel√∂schte Dokumente wiederherstellen </h2><br>  Situation: Sie haben eine destruktive Abfrage durchgef√ºhrt, bei der viele / alle ben√∂tigten Daten gel√∂scht wurden.  Und nirgends zu restaurieren oder sehr teuer.  Nun, SSZB nat√ºrlich, dass es keine Backups gibt, aber das passiert auch. <br><br>  Leider oder zum Gl√ºck entfernt Lucene nie etwas direkt.  Die Philosophie ist n√§her an CoW, sodass gel√∂schte Daten nicht tats√§chlich gel√∂scht, sondern nur als gel√∂scht markiert werden.  Das L√∂schen selbst erfolgt w√§hrend der Indexoptimierung - Live-Daten von Segmenten werden in neu erstellte Segmente kopiert, alte Segmente werden einfach gel√∂scht.  Obwohl der Status des gel√∂schten Index nicht 0 ist, besteht im Allgemeinen die M√∂glichkeit, ihn zu l√∂schen. <br><br><pre> <code class="bash hljs">$ curl localhost:9200/_cat/indices?v health status index uuid pri rep docs.count docs.deleted store.size pri.store.size green open data.0 R0fgvfPnTUaoI2KKyQsgdg 5 1 7238685 1291566 45.1gb 22.6gb</code> </pre><br>  Nach dem Auftauchen gibt es keine Chance. <br><br>  Schlie√üen Sie also zun√§chst den Index, stoppen Sie das Gummiband und kopieren Sie den Index (die Dateien) an einen sicheren Ort. <br><br>  Es ist nicht m√∂glich, ein einzelnes gel√∂schtes Dokument herauszuziehen.  Sie k√∂nnen nur alle gel√∂schten Dokumente im angegebenen Segment wiederherstellen. <br><br>  F√ºr Versionen Lucene unter 4 ist alles sehr einfach.  Die Lucene-API verf√ºgt √ºber eine Funktion namens undeleteAll.  Sie k√∂nnen sie direkt von <b>Luke</b> aus dem vorherigen Absatz anrufen. <br><br>  F√ºr neuere Versionen wurde leider die Funktionalit√§t eingeschr√§nkt.  Aber es gibt immer noch einen Weg.  Informationen zu Live-Dokumenten werden in * .liv-Dateien gespeichert.  Durch einfaches Entfernen wird der Index jedoch unlesbar.  Die Datei segment_N muss korrigiert werden, damit ihre Existenz vollst√§ndig vergessen wird. <br><br>  √ñffnen Sie die Datei segment_N (N ist eine Ganzzahl) in Ihrem bevorzugten Hex-Editor.  Die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>offizielle Dokumentation</b></a> hilft uns bei der Navigation: <br><pre> <code class="bash hljs">segments_N: Header, LuceneVersion, Version, NameCounter, SegCount, MinSegmentLuceneVersion, &lt;SegName, SegID, SegCodec, DelGen, DeletionCount, FieldInfosGen, DocValuesGen, UpdatesFiles&gt;SegCount, CommitUserData, Footer</code> </pre> <br>  Von all dem ben√∂tigen wir die Werte von DelGen (Int64) und DeletionCount (Int32).  Die erste muss gleich -1 und die zweite 0 sein. <br><br><img src="https://habrastorage.org/webt/8t/3s/dg/8t3sdgluq35ibmu0att0yzjapju.png"><br><br>  Es ist nicht schwer, sie zu finden, sie befinden sich direkt hinter SegCodec, einer sehr auff√§lligen Zeichenfolge wie Lucene62.  In diesem Screenshot sehen Sie, dass DelGen den Wert 3 und DeletionCount - 184614 hat. Ersetzen Sie den ersten durch 0xFFFFFFFFFFFFFFFF und den zweiten durch 0x00000000.  Wiederholen Sie diesen Vorgang f√ºr alle erforderlichen Segmente. <br><br>  Der feste Index m√∂chte jedoch nicht geladen werden, da ein Pr√ºfsummenfehler vorliegt.  Hier ist es noch einfacher.  Nehmen Sie Luke und laden Sie den Index mit dem deaktivierten IndexReader, Tools / Check Index.  Wir machen einen Testlauf und stellen sofort fest, dass segment_N besch√§digt ist.  Eine solche und eine solche Pr√ºfung wird erwartet, aber eine solche und eine solche wird empfangen. <br><br><pre> <code class="bash hljs">Caused by: org.apache.lucene.index.CorruptIndexException: checksum failed (hardware problem?) : expected=51fbdb5c actual=6e964d17</code> </pre> <br>  Unsinn!  Wir nehmen die erwartete Pr√ºfsumme und geben sie in die letzten 4 Bytes der Datei ein. <br><br><img src="https://habrastorage.org/webt/h5/1q/q-/h51qq-yrc9s_jbwrpq1n92d8qm8.png"><br><br>  Speichern.  Wir f√ºhren CheckIndex erneut aus, um sicherzustellen, dass alles in Ordnung ist und der Index geladen wird. <br><br>  Et voil√†! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de416955/">https://habr.com/ru/post/de416955/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de416945/index.html">Wie wir BelAZ gemacht haben. Teil 1 - Eisen</a></li>
<li><a href="../de416947/index.html">Spielen Sie das Spiel vor den Olympischen Spielen: eSports wird offiziell</a></li>
<li><a href="../de416949/index.html">Das umfassende Upgrade von Herrn Steven zur Installation eines vierfach gr√∂√üeren Jagdnetzwerks wurde abgeschlossen</a></li>
<li><a href="../de416951/index.html">Kubernetes-Cluster im VPC-Dienst</a></li>
<li><a href="../de416953/index.html">Erstellen Sie einen Cartoon-Water-Shader f√ºr das Web. Teil 1</a></li>
<li><a href="../de416957/index.html">Welche Lasermaschine kaufen? Zuverl√§ssiger Raylogic 11G Lasermaschinen-Test</a></li>
<li><a href="../de416959/index.html">Apple f√ºhrt neue iOS-Diebstahlschutzfunktion ein</a></li>
<li><a href="../de416961/index.html">Automatische Konfliktl√∂sung mithilfe operativer Transformationen</a></li>
<li><a href="../de416963/index.html">Wie wir BelAZ gemacht haben. Teil 2 - Labortests</a></li>
<li><a href="../de416967/index.html">Wie wir BelAZ gemacht haben. Teil 3 - Teilinbetriebnahme</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>