<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñêüèΩ ü§ûüèº üë®‚Äçüë©‚Äçüëß Mit einem Kind eine Girlande machen üàπ üö± üíÜüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Schwierigkeitsgrad: f√ºr Anf√§nger. 

 Die Idee entstand, als die alte Girlande am Silvesterabend zerbrach. Der Sohn schaute auf den RGB-LED-Streifen un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mit einem Kind eine Girlande machen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409449/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ss/ib/x3/ssibx3la_tckdjeo6tb-owbomck.png" alt="Bild"></div><br>  Schwierigkeitsgrad: f√ºr Anf√§nger. <br><br>  Die Idee entstand, als die alte Girlande am Silvesterabend zerbrach.  Der Sohn schaute auf den RGB-LED-Streifen und fragte, ob es m√∂glich sei, daraus eine Girlande zu machen.  Sie k√∂nnen - sagte ich, und der Sohn begann lange Zeit genau zu beschreiben, wie die Girlande blinken sollte.  Ich verstand nichts und beschloss sicherzustellen, dass er selbst tun konnte, was er wollte.  Ich begann damit, meine eigenen W√ºnsche f√ºr das Projekt zu analysieren: <br><br><ol><li>  Entwicklungsumgebung im Scratch-Stil </li><li>  Offline-Arbeit - Die M√∂glichkeit, mit ausgeschaltetem Ger√§t zu arbeiten </li><li>  Arbeiten Sie auf dem Luftweg, ohne einen Draht anzuschlie√üen </li><li>  Zuverl√§ssigkeit - Kein heruntergeladenes Programm sollte das Ger√§t ‚Äûh√§ngen‚Äú, bis ein Neustart erforderlich ist </li></ol><br><a name="habracut"></a><br><h3>  Hardware-Plattform </h3><br><img src="https://habrastorage.org/webt/k4/e_/ly/k4e_lyysvyygvsb6lrfkd8w5x_g.jpeg" alt="Transistoren"><br><br>  Basierend auf der ESP8266-Karte mit NodeMCU ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wie dieser</a> ) wurden einige Transistoren und Widerst√§nde hinzugef√ºgt.  Die ausgew√§hlten Module verf√ºgen √ºber einen Spannungsregler von 3 bis 20 Volt, mit dem sie von derselben Quelle wie das Band mit Strom versorgt werden k√∂nnen.  Die esp-Ausg√§nge geben eine Spannung von 3 Volt mit einer Strombegrenzung von 12 mA an, daher habe ich herk√∂mmliche Bipolartransistoren zur Steuerung des Bandes verwendet. <br><br><img src="https://habrastorage.org/webt/bg/i4/9i/bgi49ip_y-dbewej2sjad1x8rmm.gif" alt="Bild"><br><br>  Damit kein wei√üer Rauch aus dem Mikrocontroller austritt, habe ich einen 220-Ohm-Widerstand zwischen Ausgang und Basis gelegt.  Esp hat Software pwm, einige Pins haben einen speziellen Zweck, den ich experimentell ausgew√§hlt habe. <br><br><h3>  Firmware </h3><br>  Vor der Verwendung muss esp8266 geflasht werden. Ich verwende NodeMCU mit lua, obwohl es etwas weniger Funktionen als Arduino mit C ++ hat.  Der einfachste Weg, um zu beginnen, ist die vorgefertigte Firmware von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nodemcu-build.com</a> .  F√ºr unser Projekt m√ºssen wir das pwm-Modul hinzuf√ºgen.  Nach einer Weile wird ein Link zum Bild in die E-Mail eingef√ºgt.  Sie m√ºssen die mit float nehmen. <br><br>  Sie k√∂nnen es mit jedem Programmierer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von hier aus</a> flashen, und ich verwende NodeMCU Flasher. <br><br>  NodeMCU hat ein Dateisystem, die Ausf√ºhrung beginnt mit dem Modul init.lua, ich verwende <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ESPlorer</a> zum Download. <br><br><h3>  Blinkende Diode </h3><br>  Der n√§chste Moment hat mich in die Irre gef√ºhrt.  Die interne Nummerierung (GPIO0-16) wird nur in nativen Programmen (Arduino / C ++) verwendet.  Von lua wird die Notation von der Tafel verwendet.  Zum Beispiel, um GPIO16 / D0 (eingebaute LED) zu verwenden.  Von Lua m√ºssen Sie gpio.write (0, gpio.HIGH) schreiben.  Sie k√∂nnen eine Diode direkt √ºber die ESPlorer-Konsole blinken lassen. <br><br><img src="https://habrastorage.org/webt/va/c2/iw/vac2iwfoz0zvdstigla_qnxtbbe.png" alt="Bild"><br><br>  Im Gegensatz zu Arduino kann nodemcu <b>keine</b> Verz√∂gerung und Besetztschleife <b>verwenden.</b> Die Konsole und das WLAN verwenden denselben Prozessor, um zu arbeiten.  In das Board ist auch ein Watchdog integriert, der es neu startet, wenn Ihr Code l√§nger als 500 ms l√§uft.  Es wird empfohlen, den Prozessor nicht l√§nger als 2 ms zu belegen.  Um das Problem zu l√∂sen, gibt es die Funktionen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">node.task.post</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tmr</a> <br><br><h3>  Auswahl einer Entwicklungsumgebung </h3><br>  Zuerst wollte ich Scratch verwenden, aber es passte nicht zu mir, weil ich nicht offline arbeiten kann - das Programm l√§uft auf einem Computer in einer Scratch-Umgebung und alle Boards daf√ºr funktionieren passiv.  Nachdem ich mich im Internet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">umgesehen hatte</a> , stie√ü ich auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Blockly</a> .  Dies stellte sich als genau das heraus, was Sie brauchen: Es unterst√ºtzt die Codegenerierung in Lua und die Erstellung eigener Bl√∂cke.  Nach dem Experimentieren entschied ich mich f√ºr mein webbasiertes Projekt, w√§hlte nodejs als Server und Blockly als Frontend.  Es war absolut notwendig, 2 Bl√∂cke zu erstellen - Einstellung der Farbe und Verz√∂gerung.  Blockly verf√ºgt √ºber integrierte Funktionen zum Arbeiten mit Farben im Format #ffffff. Das Erstellen einer Funktion zum Festlegen der Farbe war kein Problem. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler √úberschrift</b> <div class="spoiler_text"><pre><code class="javascript hljs">Blockly.Lua[<span class="hljs-string"><span class="hljs-string">'set_color'</span></span>] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">block</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parseColor = Blockly.Lua.provideFunction_( <span class="hljs-string"><span class="hljs-string">'set_colour_rgb'</span></span>, [<span class="hljs-string"><span class="hljs-string">'function '</span></span> + Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_ + <span class="hljs-string"><span class="hljs-string">'(s)'</span></span>, <span class="hljs-string"><span class="hljs-string">' local rs,gs,bs = s.match(s, "#(..)(..)(..)");'</span></span>, <span class="hljs-string"><span class="hljs-string">' setColor(tonumber(rs, 16),tonumber(gs, 16),tonumber(bs, 16));'</span></span>, <span class="hljs-string"><span class="hljs-string">'end'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value_color = Blockly.Lua.valueToCode(block, <span class="hljs-string"><span class="hljs-string">'Color'</span></span>, Blockly.Lua.ORDER_ATOMIC); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = <span class="hljs-string"><span class="hljs-string">`set_colour_rgb(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${value_color}</span></span></span><span class="hljs-string">)\n`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> code; };</code> </pre> <br></div></div><br>  Somit wurden 2 von 3 Anforderungen geschlossen. <br><br><h3>  Sleep () Funktion </h3><br>  Hier musste ich speziell dar√ºber nachdenken, wie man den zuverl√§ssigen Betrieb von OTA mit der Ausf√ºhrung von benutzerdefiniertem Code kombiniert.  Zum Gl√ºck hat Lua eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Coroutine-</a> Bibliothek <br><br>  Nachdem ich die Dokumentation durchdacht und nachdenklich gelesen hatte, wurde mir klar, dass der gesamte Client-Code in Coroutine ausgef√ºhrt werden musste und Yield anstelle von Sleep verwendet wurde, damit das Hauptmodul einen Timer einstellen konnte. <br><br>  Um die Karte vor einer Endlosschleife zu sch√ºtzen, habe ich den Code nach dem Generator gepatcht, indem ich zu Beginn jeder Iteration jeder Schleife Yield (0) eingef√ºgt habe <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MCUPostProcessLua</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">code</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> code.replace(<span class="hljs-regexp"><span class="hljs-regexp">/ do[ ]?\n/</span></span>, <span class="hljs-string"><span class="hljs-string">' do \ncoroutine.yield(0);\n'</span></span>); }</code> </pre><br><h3>  OTA herunterladen </h3><br>  Ich entschied mich f√ºr die Implementierung der einfachsten L√∂sung f√ºr das lokale Netzwerk. Die Karte stellt eine Verbindung zum Heim-WLAN her, stellt eine Verbindung zum Server unter einer festen Adresse her, sendet eine eindeutige Kennung (um Wiederverbindungen korrekt zu verarbeiten) und erwartet Programmaktualisierungen √ºber diesen Socket. <br><br><h3>  Ergebnis </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/farafonoff/BlocklyESP8266</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/EftHAEMSmh0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Sie k√∂nnen eine Menge Autorisierungsoptionen f√ºr die Arbeit in √∂ffentlichen Netzwerken hinzuf√ºgen, einen benutzerfreundlichen Konfigurator im Hostap-Modus, die Modularit√§t von init.lua verbessern und das OTA-Update unterst√ºtzen (jetzt wird nur das Modul mit dem geladenen Programm aktualisiert). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de409449/">https://habr.com/ru/post/de409449/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de409439/index.html">CES 2018: Wer ist die Hauptausstellung?</a></li>
<li><a href="../de409441/index.html">Ticket nach Australien</a></li>
<li><a href="../de409443/index.html">Computer lehrte, menschliche visuelle Bilder zu visualisieren</a></li>
<li><a href="../de409445/index.html">Crispr ist nicht genug. Machen Sie sich bereit f√ºr die genetische Bearbeitung 2.0</a></li>
<li><a href="../de409447/index.html">Es ist eine gro√üartige Zeit gekommen - Interview mit Aubrey de Gray - Kapitel eins</a></li>
<li><a href="../de409453/index.html">Dann bedroht uns das neue Jahr. Zeitleiste des mutigen Kampfes der Regierung und des FCS mit ausl√§ndischen Online-Eink√§ufen</a></li>
<li><a href="../de409455/index.html">Software, Hardware, Kopfh√∂rer und "nur √ºben": 30 Materialien mit Empfehlungen f√ºr "Audio-Fans"</a></li>
<li><a href="../de409457/index.html">5 wichtigsten Dinge mit CES 2018</a></li>
<li><a href="../de409459/index.html">Smart Weihnachtsbaum auf ESP8266 und ws2811</a></li>
<li><a href="../de409461/index.html">Spiel in Verbindung: Suche nach √§hnlichen W√∂rtern in Englisch und Russisch zum schnellen Auswendiglernen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>