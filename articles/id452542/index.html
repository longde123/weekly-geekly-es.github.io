<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💲 ☯️ 🕙 Adaptasi program untuk ZX Spectrum ke TR-DOS dengan cara modern. Bagian 2 🤟🏾 💞 👨🏾‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Di bagian pertama artikel, kami mengurutkan bootloader dari versi asli dan menemukan di mana kode permainan dimuat dan bagaimana itu dimulai. Sekarang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Adaptasi program untuk ZX Spectrum ke TR-DOS dengan cara modern. Bagian 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452542/"><p>  Di bagian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pertama artikel,</a> kami mengurutkan bootloader dari versi asli dan menemukan di mana kode permainan dimuat dan bagaimana itu dimulai.  Sekarang Anda perlu mentransfer file ke disk. </p><br><p><img src="https://habrastorage.org/webt/jv/tm/ti/jvtmtiduxnsmps-skthb1oxwclq.jpeg" alt="Floppy 5.25 &quot;"></p><br><p>  Ini biasanya dilakukan hanya dengan menyalin file, tetapi ada satu masalah.  Faktanya adalah bahwa file asli berisi gambar dan kode permainan dalam keseluruhan dan karenanya, menimpa area variabel dasar dan sistem, yang terletak tepat di belakang area layar.  File seperti itu dapat diunduh dari tape, tetapi tidak dapat diunduh dari floppy disk.  TR-DOS menyimpan area memori tertentu untuk kebutuhan Anda, dan jika Anda memuat data di sana, semuanya akan rusak selama proses pengunduhan. </p><a name="habracut"></a><br><p> Untungnya, kami memiliki cukup memori yang tidak ditempati oleh permainan.  Karena itu, gim dapat diunduh ke tempat lain, dan di akhir unduhan pindah ke tempat yang Anda inginkan dan jalankan.  Dalam hal ini, saya ingin menampilkan gambar sebelum akhir pengunduhan - untuk itu juga dapat di-boot.  Untuk melakukan ini, kami akan memotong file monolitik menjadi data area dua layar dan data game: </p><br><pre><code class="plaintext hljs">$ head -c 6912 headless.bin &gt; screen.bin $ tail -c +6913 headless.bin &gt; data.bin</code> </pre> <br><p>  File data game akan segera menerjemahkan format hobeta.  Nanti kita akan membutuhkannya untuk merekam dalam gambar akhir.  Untuk mengonversi format, kita akan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">zxspectrum-utils</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>trd2hob</code></a> : </p><br><pre> <code class="plaintext hljs">$ binto0 data.bin 3 $ 0tohob data.000 #   data.$C</code> </pre> <br><p><img src="https://habrastorage.org/webt/n1/s7/ui/n1s7uic_xqwh_4u1wsneecdqb28.png" alt="Memuat layar"></p><br><p>  Sedangkan untuk layar boot, belanjakan 6,75 kB untuk gambar sederhana - sia-sia.  Itu dapat dikompres dengan benar dengan kompresor layar, misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Laser Compact 5.2</a> .  Untuk melakukan ini, Anda harus terlebih dahulu menulis file gambar ke gambar disket sementara: </p><br><pre> <code class="plaintext hljs">$ binto0 screen.bin 3 $ 0tohob screen.000 $ createtrd tmp.trd $ hobeta2trd screen.\$C tmp.trd</code> </pre> <br><p>  Setelah itu, jalankan Laser Compact di emulator dan simpan gambar yang dikompresi ke disket yang sama (Paket layar → Simpan dengan depacker).  Saat menyimpan, tentukan <code>screenz.C</code> file <code>screenz.C</code> .  Selanjutnya, Anda perlu menyalin gambar yang dikompresi dari gambar floppy disk kembali ke disk.  Sayangnya, saya tidak dapat menemukan sumber untuk <code>trd2hob</code> mana saja, jadi saya harus menjalankan dos binary dari bawah DosBox: </p><br><pre> <code class="plaintext hljs">$ dosbox -c "mount C $PWD" -c "C:" -c "trd2hob.exe screen.trd" -c exit</code> </pre> <br><p>  Sebagai hasilnya, kami mendapatkan file hobeta dari form <code>screenz.$</code> dengan gambar terkompresi. </p><br><p>  Selain utilitas Spectrum asli untuk kompresi layar, ada utilitas untuk PC, misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>zx7b</code></a> dan <code>zxsc</code> .  Meskipun lebih nyaman untuk mengotomatisasi bekerja dengan mereka, keduanya memiliki kelemahan sebelum Laser Compact: </p><br><ol><li>  Keduanya kalah dalam kualitas kompresi. </li><li>  Saat membongkar gambar, artefak tertentu terlihat ketika, saat Laser Compact mengisi area atribut layar hampir secara instan. </li><li>  <code>zx7b</code> tidak mendukung pembuatan arsip self-extracting - Anda juga harus mengkompilasi dekompresor. </li></ol><br><p>  Akhirnya, kami mencari tahu ukuran file terkompresi.  Kita akan membutuhkannya nanti untuk menulis bootloader. </p><br><pre> <code class="plaintext hljs">$ lstrd tmp.trd 80 Tracks, Double Side, capacity 640kB Number of files/deleted: 2/0 Free sectors/bytes: 2509/642304 First free sector/track: 3/3 FILENAME TYPE SECTORS ADDRESS LENGTH TRACK SECTOR -------------------------------------------------------------- screen &lt;C&gt; CODE (BYTES) 27 16384 6912 1 0 screenz &lt;C&gt; CODE (BYTES) 8 40000 1812 2 11</code> </pre> <br><p>  Seperti yang Anda lihat, file dikompresi lebih dari tiga kali lipat dan menempati 8 sektor pada disk. </p><br><p>  Di bagian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">selanjutnya, kita</a> akan langsung menuju bootloader. </p><br><h3 id="ssylki-po-teme">  Tautan terkait: </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"Adaptasi program ke sistem TR-DOS" oleh</a> Nikolai Rodionov. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id452542/">https://habr.com/ru/post/id452542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id452532/index.html">Termometer & hygrometer Arduino dengan E-PAPER pada nRF52832 - atau apa yang lupa dilepaskan oleh produsen</a></li>
<li><a href="../id452534/index.html">Tips Pendekatan Multiplikasi Baru Cara Meningkatkan Komputer Quantum</a></li>
<li><a href="../id452536/index.html">Seorang peretas yang telah memecahkan aplikasi pelacakan mobil GPS menemukan bahwa ia dapat menghentikannya dari jarak jauh</a></li>
<li><a href="../id452538/index.html">Atomexpo 2019, bagian 1: acara dan pesawat ruang angkasa</a></li>
<li><a href="../id452540/index.html">Air keruh: bagaimana peretas dari MuddyWater menyerang produsen elektronik militer Turki</a></li>
<li><a href="../id452544/index.html">Bagaimana cara mencapai tujuan?</a></li>
<li><a href="../id452546/index.html">AirSelfie 2 Power Edition - Kamera Valik. Atau tidak?</a></li>
<li><a href="../id452548/index.html">Dan apa yang Anda siapkan untuk iPhone?</a></li>
<li><a href="../id452550/index.html">Frontend Weekly Digest (13 - 19 Mei 2019)</a></li>
<li><a href="../id452552/index.html">Mengkompilasi silang Scala dalam proyek Gradle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>