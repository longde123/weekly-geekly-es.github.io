<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåè üõåüèø üêô WAF atrav√©s dos olhos de hackers üë©üèª‚Äçüç≥ üèª üê≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje vamos falar sobre um dos modernos mecanismos de seguran√ßa para aplicativos da Web, o Web Application Firewall (WAF). Discutiremos as WAFs moderna...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WAF atrav√©s dos olhos de hackers</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/454592/"><img align="left" src="https://habrastorage.org/webt/nx/mm/yz/nxmmyzb6nr39jk_zmiu5wcnylbm.png">  Hoje vamos falar sobre um dos modernos mecanismos de seguran√ßa para aplicativos da Web, o Web Application Firewall (WAF).  Discutiremos as WAFs modernas e em que elas se baseiam, al√©m de t√©cnicas de desvio, como us√°-las e por que voc√™ nunca deve confiar inteiramente na WAF.  Estamos falando da perspectiva dos pentesters;  nunca desenvolvemos WAFs e apenas coletamos dados de fontes abertas.  Assim, podemos apenas nos referir √† nossa pr√≥pria experi√™ncia e podemos desconhecer algumas peculiaridades das WAFs. <br clear="left"><a name="habracut"></a><br><hr><br><br>  <i>Isen√ß√£o de responsabilidade: esta √© uma tradu√ß√£o do artigo de russo para ingl√™s, o artigo foi lan√ßado no final de 2017, respectivamente, algumas informa√ß√µes podem ficar desatualizadas.</i> <br><br><h4>  Conte√∫do </h4><br><ol><li>  1. Introdu√ß√£o </li><li>  O WAF moderno </li><li>  Identificando WAF </li><li>  Folha de dicas de desvio do WAF </li><li>  Desvio WAF na pr√°tica </li><li>  Conclus√£o </li></ol><br>  <i>Se voc√™ souber por que as WAFs s√£o usadas e como elas funcionam, voc√™ pode pular diretamente para a se√ß√£o de desvio.</i> <br><br><h2>  1. Introdu√ß√£o </h2><br>  WAFs se tornaram bastante populares recentemente.  Os fornecedores oferecem v√°rias solu√ß√µes em diferentes faixas de pre√ßo, kits de distribui√ß√£o e op√ß√µes, visando diferentes clientes, desde pequenas empresas a grandes empresas.  Os WAFs s√£o populares porque s√£o uma solu√ß√£o complexa para proteger aplicativos da Web, que abrange todo um espectro de tarefas.  √â por isso que os desenvolvedores de aplicativos da Web podem confiar no WAF em alguns aspectos de seguran√ßa.  Embora os WAFs n√£o possam conceder seguran√ßa total. <br><br><img src="https://habrastorage.org/webt/59/e3/95/59e395af93092095133873.png"><br><br>  Ent√£o, do que uma WAF deve ser capaz de justificar sua implementa√ß√£o em um projeto?  Sua principal fun√ß√£o √© detectar e bloquear qualquer solicita√ß√£o que, de acordo com a an√°lise da WAF, possua anomalias ou vetor de ataque.  A an√°lise n√£o deve impedir a intera√ß√£o entre usu√°rios leg√≠timos e o aplicativo Web e, ao mesmo tempo, deve detectar com precis√£o e pontualidade quaisquer tentativas de ataque.  Para implementar essa funcionalidade, os desenvolvedores do WAF usam express√µes regulares, tokenizers, an√°lise de comportamento, an√°lise de reputa√ß√£o e, √© claro, aprendizado de m√°quina.  Muitas vezes, todas essas tecnologias s√£o usadas juntas.  O WAF tamb√©m pode implementar outras fun√ß√µes: prote√ß√£o contra DDoS, proibi√ß√£o de IPs de invasores, monitoramento de IPs suspeitos, adi√ß√£o de cabe√ßalhos de seguran√ßa (prote√ß√£o X-XSS, op√ß√µes de quadro X etc.), adi√ß√£o de sinalizadores http apenas ao cookie, implementa√ß√£o de o mecanismo HSTS e tokens CSRF.  Al√©m disso, alguns WAFs possuem m√≥dulos JavaScript do lado do cliente para sites. <br><br>  Obviamente, as WAFs criam alguns obst√°culos para hackers e criminosos.  O WAF torna a descoberta e a explora√ß√£o de vulnerabilidades mais intensivas em recursos (exceto se o invasor conhecer m√©todos eficazes de desvio de 0 dia para um WAF espec√≠fico).  Os scanners autom√°ticos s√£o praticamente in√∫teis ao analisar aplicativos da Web protegidos por WAF.  WAF √© uma prote√ß√£o confi√°vel contra "scriptkiddies".  No entanto, um hacker experiente ou um pesquisador sem motiva√ß√£o suficiente provavelmente n√£o gostaria de perder tempo tentando encontrar maneiras de contorn√°-lo.  Deve-se observar que quanto mais complexo o aplicativo da Web, maior a sua superf√≠cie de ataque e mais f√°cil √© encontrar um m√©todo de desvio. <br><br>  Em nossas auditorias recentes, frequentemente encontramos diferentes WAFs.  Falaremos sobre alguns deles mais tarde.  J√° testamos dois WAFs propriet√°rios em dois cen√°rios principais: <br><br><ul><li>  Sabemos que h√° uma certa vulnerabilidade em um aplicativo Web e tentamos contornar o WAF para explor√°-lo; </li><li>  Como n√£o conhecemos nenhuma vulnerabilidade, precisamos encontrar uma, apesar da WAF, e explor√°-la ignorando a WAF. </li></ul><br>  Mas primeiro, vamos dar uma olhada mais de perto nos mecanismos b√°sicos por tr√°s do WAF e ver quais problemas eles t√™m. <br><br><h2>  O WAF moderno </h2><br>  Para poder encontrar efetivamente v√°rias maneiras de contornar o WAF, primeiro, precisamos descobrir mecanismos modernos de classifica√ß√£o de solicita√ß√µes.  Cada WAF √© espec√≠fica e constru√≠da exclusivamente, mas existem alguns m√©todos gerais de an√°lise.  Vamos dar uma olhada neles. <br><br><img src="https://habrastorage.org/webt/59/e3/95/59e395af93c4f468367566.png"><br><br><h4>  Regras baseadas em express√µes regulares </h4><br>  A maioria dos WAFs existentes usa regras baseadas em express√µes regulares.  O desenvolvedor pesquisa um certo conjunto de ataques conhecidos para identificar as principais estruturas sint√°ticas que podem apontar para um ataque.  Com base nesses dados, o desenvolvedor cria express√µes regulares que encontram essas estruturas sint√°ticas.  Parece simples, mas esse m√©todo tem algumas desvantagens.  Primeiro, uma express√£o regular pode ser aplicada a apenas uma √∫nica solicita√ß√£o, ou mesmo a um √∫nico par√¢metro de solicita√ß√£o, o que obviamente reduz a efici√™ncia de tais regras e deixa alguns pontos cegos.  Segundo, a sintaxe das express√µes regulares e a l√≥gica complexa dos protocolos de texto, que permitem a substitui√ß√£o por estruturas equivalentes e o uso de diferentes representa√ß√µes de s√≠mbolos, levam a erros ao criar essas regras. <br><br>
<h4>  Scorebuilding </h4><br>  Quem sabe como funcionam os firewalls e antiv√≠rus da rede deve estar familiarizado com esse mecanismo.  Ele n√£o detecta ataques, mas complementa outros mecanismos, tornando-os mais precisos e flex√≠veis.  O fato √© que uma estrutura "suspeita" em uma solicita√ß√£o n√£o √© uma condi√ß√£o suficiente para detectar um ataque e pode levar a muitos falsos positivos.  Esse problema √© resolvido com a implementa√ß√£o de um sistema de classifica√ß√£o.  Cada regra baseada em express√µes regulares √© complementada pelas informa√ß√µes sobre sua criticidade;  depois que todas as regras acionadas s√£o identificadas, sua criticidade √© resumida.  Se a criticidade total atingir o valor limite, o ataque √© detectado e a solicita√ß√£o √© bloqueada.  N√£o obstante sua simplicidade, esse mecanismo se mostrou eficiente e √© amplamente utilizado para tais tarefas. <br><br><h4>  Tokenizers </h4><br>  Este m√©todo de detec√ß√£o foi apresentado no Black Hat 2012 como uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libinje√ß√£o de</a> biblioteca C / C +, que permite identificar inje√ß√µes de SQL com rapidez e precis√£o.  Neste momento, existem muitas portas de libinje√ß√£o para diferentes linguagens de programa√ß√£o, como PHP, Lua, Python, etc.  Esse mecanismo procura assinaturas apresentadas como um conjunto de tokens.  Um certo n√∫mero de assinaturas est√° na lista negra e elas s√£o consideradas indesejadas e maliciosas.  Em outras palavras, antes de analisar uma solicita√ß√£o, ela √© traduzida em um conjunto de tokens.  Os tokens s√£o divididos em certos tipos, como vari√°vel, string, operador regular, desconhecido, n√∫mero, coment√°rio, operador semelhante a uni√£o, fun√ß√£o, v√≠rgula etc.  Uma das principais desvantagens do m√©todo √© que √© poss√≠vel construir uma estrutura que levaria √† forma√ß√£o incorreta de tokens; portanto, a assinatura da solicita√ß√£o ser√° diferente da esperada.  Essas estruturas s√£o geralmente chamadas de disjuntores, e as discutiremos mais tarde <br><br><h4>  An√°lise comportamental </h4><br>  Detectar e bloquear tentativas de explora√ß√£o em solicita√ß√µes n√£o √© a √∫nica tarefa para WAFs.  Tamb√©m √© importante identificar o processo de pesquisa de vulnerabilidades e o WAF deve reagir de acordo.  Pode se manifestar como tentativas de varredura, for√ßa bruta de diret√≥rio, distor√ß√£o de par√¢metros e outros m√©todos autom√°ticos.  WAFs avan√ßados podem criar cadeias de solicita√ß√£o t√≠picas do comportamento normal normal e bloquear tentativas de enviar solicita√ß√µes incomuns.  Esse m√©todo n√£o detecta tanto ataques, como dificulta o processo de busca de vulnerabilidades.  Limitar o n√∫mero de solicita√ß√µes por minuto n√£o afetaria um usu√°rio comum, mas seria um s√©rio obst√°culo para os scanners, que funcionam em v√°rios threads. <br><br><h4>  An√°lise de reputa√ß√£o </h4><br>  Esse √© outro mecanismo herdado diretamente de firewalls e antiv√≠rus.  Hoje, quase todo WAF inclui listas de endere√ßos de VPNs, anonimizadores, n√≥s Tor e redes de bots para bloquear solicita√ß√µes desses.  WAFs avan√ßados podem atualizar automaticamente suas bases e complement√°-las com entradas adicionais baseadas no tr√°fego analisado. <br><br><h4>  Aprendizado de m√°quina </h4><br>  Este √© um dos aspectos mais question√°veis ‚Äã‚Äãdo WAF.  Vamos observar que o termo "aprendizado de m√°quina" √© bastante amplo e inclui muitas tecnologias e m√©todos.  Al√©m disso, √© apenas uma das classes da IA.  "Implementa√ß√£o" de aprendizado de m√°quina ou "uso de IA" s√£o frases de marketing muito populares.  Nem sempre √© claro quais algoritmos s√£o usados ‚Äã‚Äãexatamente e, √†s vezes, parece mero absurdo.  Os fornecedores que realmente usam o aprendizado de m√°quina e o fazem efetivamente n√£o est√£o dispostos a compartilhar sua experi√™ncia.  Isso torna dif√≠cil para algu√©m de fora tentar entender a situa√ß√£o.  No entanto, vamos tentar fazer alguns pontos com base nas informa√ß√µes dispon√≠veis. <br><br>  Primeiro, o aprendizado de m√°quina depende totalmente dos dados em que foi treinado, o que apresenta um certo problema.  Um desenvolvedor deve ter uma base de ataques atualizada e completa, o que √© dif√≠cil de alcan√ßar.  √â por isso que muitos desenvolvedores registram minuciosamente os resultados de seus WAFs e cooperam com os fornecedores que fornecem sistemas IDS e SIEM para obter exemplos de ataques no mundo real.  Segundo, um modelo treinado em um aplicativo da web abstrato pode se mostrar totalmente ineficaz em um aplicativo da web real.  Para uma melhor qualidade, √© recomend√°vel treinar adicionalmente um modelo no est√°gio de implementa√ß√£o, que consome muitos recursos e consome tempo e ainda n√£o garante os melhores resultados. <br><br><h2>  Identificando WAF </h2><br>  Os desenvolvedores do WAF usam maneiras diferentes de notificar o usu√°rio que a solicita√ß√£o foi bloqueada.  Assim, podemos identificar o WAF analisando a resposta √† nossa solicita√ß√£o de ataque.  Isso geralmente √© chamado de impress√£o digital WAF.  As impress√µes digitais podem ajudar se um WAF n√£o for atualizado por algum motivo (principalmente se aplica a projetos de c√≥digo aberto).  Os desenvolvedores de WAFs propriet√°rios cuidam de seus clientes e implementam atualiza√ß√µes autom√°ticas.  Al√©m disso, depois que identificamos o WAF, que acabou sendo atualizado, ainda podemos usar as informa√ß√µes sobre ele para aprender algo sobre sua l√≥gica. <br><br>  Aqui est√° uma lista de poss√≠veis impress√µes digitais WAF: <br><br><ul><li>  Cookies adicionais </li><li>  Cabe√ßalhos adicionais para qualquer resposta ou solicita√ß√£o </li><li>  Conte√∫do da resposta (em caso de solicita√ß√£o bloqueada) </li><li>  C√≥digo de resposta (em caso de solicita√ß√£o bloqueada) </li><li>  Endere√ßo IP (Cloud WAF) </li><li>  M√≥dulo do lado do cliente JS (WAF do lado do cliente) </li></ul><br>  Vamos ilustr√°-lo com alguns exemplos <br><br>  <b>PT AF</b> <br>  C√≥digo de resposta para a solicita√ß√£o bloqueada: 403 <br>  Pode inserir o m√≥dulo cliente waf.js na p√°gina de resposta <br>  Corpo da resposta: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span>Request ID: 2017-07-31-13-59-56-72BCA33A11EC3784<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Um cabe√ßalho extra que adiciona pelo waf.js: <br><br><pre> <code class="xml hljs">X-RequestId: cbb8ff9a-4e91-48b4-8ce6-1beddc197a30</code> </pre> <br>  <b>Nemesida waf</b> <br>  C√≥digo de resposta para a solicita√ß√£o bloqueada: 403 <br>  Corpo da resposta: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"font-size: 16px; align: center;"</span></span></span><span class="hljs-tag">&gt;</span></span> Suspicious activity detected. Access to the site is blocked. If you think that is's an erroneous blocking, please email us at <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mailto:nwaf@pentestit.ru"</span></span></span><span class="hljs-tag">&gt;</span></span>nwaf@pentestit.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> and specify your IP-address. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <b>Wallarm</b> <br>  C√≥digo de resposta para a solicita√ß√£o bloqueada: 403 <br>  Cabe√ßalho adicional: nginx-wallarm <br><br>  <b>Citrix NetScaler AppFirewall</b> <br>  Cookie adicional: <br><br><pre> <code class="xml hljs">ns_af=31+LrS3EeEOBbxBV7AWDFIEhrn8A000; ns_af_.target.br_%2F_wat=QVNQU0VTU0lP TklEQVFRU0RDU0Nf?6IgJizHRbTRNuNoOpbBOiKRET2gA</code> </pre> <br>  <b>Mod_Security ver.</b>  <b>2.9</b> <br>  C√≥digo de resposta para a solicita√ß√£o bloqueada: 403 <br>  Corpo de resposta: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>403 Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>You don't have permission to access /form.php on this server.<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <b>Mod_Security ver.</b>  <b>&lt;2,9</b> <br>  C√≥digo de resposta para solicita√ß√£o bloqueada: 406 ou 501 <br>  No corpo da resposta, voc√™ pode encontrar mod_security, Mod_Security ou NOYB <br><br>  <b>Firewall de verniz</b> <br>  Adiciona os seguintes cabe√ßalhos √† resposta: <br><br><pre> <code class="plaintext hljs">X-Varnish: 127936309 131303037. X-Varnish: 435491096 Via: 1.1 varnish-v4</code> </pre> <br>  Os desenvolvedores do WAF decidem eles mesmos qual c√≥digo de resposta retornar no caso de uma solicita√ß√£o bloqueada;  tamb√©m existem alguns c√≥digos espec√≠ficos.  Por exemplo, Web_Knight WAF retorna o c√≥digo 999 e dotDefender retorna o c√≥digo 200 com um corpo de resposta vazio ou com uma mensagem de erro.  Al√©m disso, os desenvolvedores podem criar uma p√°gina de resposta personalizada com algum outro conte√∫do. <br><br>  O WAF, como qualquer outro aplicativo, evolui e muda.  √â por isso que √© importante verificar constantemente a relev√¢ncia das impress√µes digitais que voc√™ possui. <br><br><h2>  Folha de dicas de desvio WAF </h2><br>  A id√©ia geral por tr√°s de encontrar maneiras de ignorar o WAF √© transformar a solicita√ß√£o de que precisamos para que ainda seja v√°lida para o aplicativo Web, mas n√£o para o WAF ou pare√ßa inofensiva.  √â importante que um tipo de WAF possa atender a muitos tipos diferentes de servidores, incluindo os "ex√≥ticos", como Unicorn, Tornado, Weblogic, Lighttpd, etc.  Cada servidor pode perceber casos exclusivos de an√°lise de solicita√ß√£o HTTP de uma maneira diferente, que tamb√©m deve ser considerada pelo WAF.  Assim, um invasor pode usar as especificidades de an√°lise de solicita√ß√£o HTTP dos servidores para encontrar uma maneira de ignorar o WAF. <br><br><img src="https://habrastorage.org/webt/59/e3/95/59e395afb9650235665851.png"><br><br>  √â dif√≠cil classificar todas as formas poss√≠veis de ignorar o WAF pelos mecanismos de seguran√ßa do WAF ou pelo campo de uso.  As mesmas formas de desvio podem interagir e afetar simultaneamente diferentes componentes de um WAF.  As t√©cnicas descritas abaixo foram coletadas de fontes abertas ou descobertas durante nossa pr√≥pria pesquisa e provaram estar entre as mais eficazes. <br><br><h4>  Adicionando s√≠mbolos especiais </h4><br>  V√°rios s√≠mbolos especiais podem violar a l√≥gica de an√°lise de um WAF e, ao mesmo tempo, ser v√°lidos interpretados pelo servidor.  As varia√ß√µes desses s√≠mbolos podem ser diferentes: elas podem ser transformadas em c√≥digo de URL (embora a maioria dos WAFs possa lidar com isso) ou outras codifica√ß√µes.  Tamb√©m √© poss√≠vel inserir s√≠mbolos especiais em uma solicita√ß√£o sem qualquer codifica√ß√£o, no formato bruto, o que pode ser uma surpresa para um WAF.  Por exemplo, <b>\ r \ n \ r \ n</b> nesta apresenta√ß√£o pode ser percebido como o final de um corpo de solicita√ß√£o HTTP, e um byte nulo pode violar a l√≥gica de an√°lise de express√µes regulares e analisadores de dados por completo.  Al√©m disso, outros s√≠mbolos especiais dos primeiros vinte s√≠mbolos da tabela ASCII podem ser √∫teis. <br>  Exemplos: <br><br><ul><li>  0x00 - byte nulo; </li><li>  0x0D - Retorno de carro; </li><li>  0x0A - avan√ßo de linha; </li><li>  0x0B - Guia vertical; </li><li>  0x09 - guia Horizontal; </li><li>  0x0C - Nova p√°gina </li></ul><br>  Ao procurar um desvio, √© √∫til inserir s√≠mbolos especiais em locais diferentes no corpo da solicita√ß√£o e n√£o apenas nos valores dos par√¢metros.  Por exemplo, se uma solicita√ß√£o estiver no formato JSON, podemos inserir bytes nulos em um par√¢metro e entre par√¢metros, no in√≠cio e no final do JSON.  O mesmo se aplica a outros formatos do corpo de uma solicita√ß√£o POST.  Em geral, recomendamos fazer pesquisas e se divertir, procurar lugares que possam ser monitorados e analisados ‚Äã‚Äãpelo WAF e tentar usar diferentes s√≠mbolos especiais l√°. <br><br>  Por exemplo: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1337</span></span>,<span class="hljs-attr"><span class="hljs-attr">"string0x00"</span></span>:<span class="hljs-string"><span class="hljs-string">"test' or sleep(9)#"</span></span>} {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1337</span></span>,<span class="hljs-attr"><span class="hljs-attr">"string"</span></span>:<span class="hljs-string"><span class="hljs-string">"test'/*0x00*/ or sleep(9)#"</span></span>} {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1337</span></span>,<span class="hljs-attr"><span class="hljs-attr">"string"</span></span>0x0A0x0D:<span class="hljs-string"><span class="hljs-string">"test' or sleep(9)#"</span></span>}</code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ja0x09vas0x0A0x0Dcript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">0x00</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">0x00</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="sql hljs">id=1337<span class="hljs-comment"><span class="hljs-comment">/*0x0C*/</span></span>1 UNION <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>() <span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  <i>Para maior clareza, substitu√≠mos s√≠mbolos especiais por sua apresenta√ß√£o hexadecimal.</i> <br><br><h4>  Substituindo s√≠mbolos de espa√ßo </h4><br>  Na maioria das sintaxes, as palavras-chave e os operadores precisam ser separados, mas os s√≠mbolos de espa√ßo preferenciais n√£o s√£o especificados.  Portanto, em vez do <b>0x20</b> comum (Espa√ßo), voc√™ pode usar <b>0x0B</b> (Guia Vertical) ou <b>0x09</b> (Guia Horizontal).  Substituir espa√ßos por estruturas divididas sem significado pr√≥prio se enquadra na mesma categoria.  No SQL, √© <b>/ ** /</b> (coment√°rios SQL de v√°rias linhas), <b># \ r \ n</b> (coment√°rio SQL de uma linha, terminando com feed de linha), <b>- \ r \ n</b> (coment√°rio SQL de uma linha alternativo, finalizando com avan√ßo de linha).  Aqui est√£o alguns exemplos: <br><br><pre> <code class="html hljs xml">http://test.com/test?id=1%09union/**/select/**/1,2,3 http://test.com/test?id=1%09union%23%0A%0Dselect%2D%2D%0A%0D1,2,3</code> </pre> <br>  Al√©m disso, podemos transformar uma express√£o para se livrar de espa√ßos usando a sintaxe da linguagem.  Por exemplo, no SQL, podemos usar par√™nteses: <br><br><pre> <code class="sql hljs">UNION(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,(<span class="hljs-number"><span class="hljs-number">6</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Users</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span>(login=<span class="hljs-string"><span class="hljs-string">'admin'</span></span>))</code> </pre> <br>  E em JS, use <b>/</b> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">confirm(1)</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4>  Alterando a codifica√ß√£o </h4><br>  Esse m√©todo √© baseado no uso de codifica√ß√µes diferentes para impedir que o WAF decodifique dados em determinados locais.  Por exemplo, se um s√≠mbolo for substitu√≠do por seu c√≥digo de URL, o WAF n√£o ser√° capaz de entender que precisa decodificar dados e passar√° a solicita√ß√£o.  Ao mesmo tempo, o mesmo par√¢metro ser√° aceito e decodificado com sucesso pelo aplicativo da web. <br><br>  A forma decimal de um s√≠mbolo HTML √© <b>&amp; # 106</b> ou <b>&amp; # 0000106</b> .WAF pode saber sobre a vers√£o curta e n√£o saber sobre a vers√£o com zeros adicionais (n√£o deve haver mais de 7 s√≠mbolos no total).  Da mesma forma, a forma hexadecimal de um s√≠mbolo HTML √© <b>&amp; # x6A</b> ou <b>&amp; # x000006A</b> . <br><br>  H√° tamb√©m um truque para escapar caracteres com uma barra invertida <b>\</b> , por exemplo: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on</span></span></span><span class="hljs-tag">\</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">load</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">a\lert(1)</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  No entanto, depende de como um aplicativo Web processa esses dados de entrada.  Portanto, a sequ√™ncia <b>\ l</b> ser√° processada como <b>l</b> e transformada em um √∫nico s√≠mbolo;  O WAF pode processar cada s√≠mbolo separadamente e pode quebrar express√µes regulares ou outra l√≥gica do WAF.  Assim, o WAF perder√° as palavras-chave.  Usando esta t√©cnica, n√£o podemos escapar dos caracteres <b>\ n</b> , <b>\ r</b> , <b>\ t</b> , pois eles ser√£o transformados em caracteres diferentes: nova linha, retorno de carro e guia. <br><br>  A codifica√ß√£o HTML pode ser usada dentro dos atributos da tag, por exemplo: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript&amp;colon;alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onmouseover</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript&amp;colon;confirm&amp;lpar;1rpar;"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Esses caracteres podem ser facilmente substitu√≠dos por outras representa√ß√µes HTML dos caracteres de destino.  Voc√™ pode procurar diferentes transforma√ß√µes de caracteres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Al√©m da codifica√ß√£o HTML, podemos inserir caracteres com <b>\ u</b> : <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:\u0061lert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>Clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">confir\u006d(1)</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Vejamos tamb√©m o vetor relacionado √† inser√ß√£o de caracteres especiais.  Vamos quebrar a carga √∫til com a codifica√ß√£o HTML: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ja&amp;Tab;vas&amp;#x0000A;cript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Nesse caso, tamb√©m podemos colocar outros caracteres de separa√ß√£o. <br><br>  Portanto, recomendamos combinar diferentes codifica√ß√µes com outros m√©todos, por exemplo, para codificar caracteres especiais. <br><br><h4>  Procure estruturas sint√°ticas equivalentes at√≠picas </h4><br>  Esse m√©todo visa encontrar uma maneira de explora√ß√£o n√£o considerada pelos desenvolvedores do WAF ou um vetor que n√£o estava presente na amostra de treinamento de aprendizado de m√°quina.  Exemplos simples seriam fun√ß√µes JavaScript: <b>this, top self, parent, frames;</b>  atributos de tag: <b>liga√ß√£o de dados, ontoggle, onfilterchange, onbeforescriptexecute, onpointerover, srcdoc;</b>  e operadores SQL: <b>lpad, field, bit_count</b> . <br><br>  Aqui est√£o alguns exemplos: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'alert'</span></span></span><span class="javascript">](</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">parent[</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'alert'</span></span></span><span class="actionscript">](</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1</span></span></span><span class="actionscript">)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">self[</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'alert'</span></span></span><span class="actionscript">](</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">2</span></span></span><span class="actionscript">)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">LPAD</span></span>(<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>())=<span class="hljs-string"><span class="hljs-string">'5.7'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">sleep</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>),<span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre> <br>  Voc√™ tamb√©m pode usar a representa√ß√£o n√£o simb√≥lica das express√µes JavaScript: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JSFuck</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jjencode</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Xchars.js</a> . </li></ul><br>  Um problema √≥bvio disso √© a carga √∫til longa. <br><br>  O desvio do WAF com essa t√©cnica depende do ataque e da pilha de tecnologias explorada.  A famosa explora√ß√£o do ImageTragick √© um bom exemplo disso.  A maioria dos WAFs que protegem contra esse ataque tinha palavras-chave na lista negra, como <b>URL</b> , <b>capacidade</b> e <b>r√≥tulo,</b> uma vez que essas palavras foram mencionadas na maioria dos artigos e PoCs que descrevem essa vulnerabilidade.  Embora logo tenha sido revelado que outras palavras-chave tamb√©m podem ser usadas, por exemplo, <b>ef√™mero</b> e <b>pango</b> .  Como resultado, os WAFs podem ser ignorados com o uso dessas palavras-chave. <br><br><h4>  Polui√ß√£o de Par√¢metro HTTP (HPP) e Fragmenta√ß√£o de Par√¢metro HTTP (HPF) </h4><br>  O ataque HPP √© baseado em como um servidor interpreta par√¢metros com os mesmos nomes.  Aqui est√£o alguns desvios poss√≠veis: <br><br><ul><li>  O servidor usa o √∫ltimo par√¢metro recebido e o WAF verifica apenas o primeiro; </li><li>  O servidor une o valor de par√¢metros semelhantes e o WAF os verifica separadamente. </li></ul><br>  Voc√™ pode comparar como servidores diferentes processam os mesmos par√¢metros na tabela abaixo: <br><br><img src="https://habrastorage.org/webt/59/e3/77/59e3770e949f3269504620.png"><br><br>  Por sua vez, o ataque do HPF √© baseado em um princ√≠pio diferente.  Se a l√≥gica de um aplicativo da Web unir dois e mais par√¢metros em uma solicita√ß√£o, o advers√°rio poder√° dividir a solicita√ß√£o para ignorar determinadas verifica√ß√µes do WAF. <br>  A inje√ß√£o SQL a seguir √© um exemplo de ataque: <br><br><pre> <code class="html hljs xml">http://test.com/url?a=1+select&amp;b=1+from&amp;c=base</code> </pre> <br>  HPF e HPP s√£o muito semelhantes, mas o primeiro √© direcionado a um aplicativo Web e o √∫ltimo √© o ambiente em que ele opera.  A combina√ß√£o dessas t√©cnicas aumenta a chance de ignorar um WAF. <br><br><h4>  Normaliza√ß√£o Unicode </h4><br>  A Normaliza√ß√£o Unicode √© um recurso do Unicode destinado a comparar s√≠mbolos Unicode semelhantes.  Por exemplo, os s√≠mbolos <b>'¬™'</b> e <b>'·µÉ'</b> t√™m c√≥digos diferentes, mas s√£o muito similares caso contr√°rio, portanto, ap√≥s a normaliza√ß√£o, ambos parecer√£o um simples <b>'a'</b> e considerados iguais.  A normaliza√ß√£o permite transformar alguns s√≠mbolos Unicode complexos em alternativas mais simples.  H√° uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tabela de normaliza√ß√£o Unicode</a> com todos os s√≠mbolos Unicode e suas poss√≠veis normaliza√ß√µes.  Usando-o, voc√™ pode fazer diferentes cargas √∫teis e combin√°-las com outros m√©todos.  Embora n√£o funcione para todos os aplicativos da Web e muito dependente do ambiente. <br><br>  Por exemplo, na tabela acima, podemos ver que os s√≠mbolos <b><code>Ôºú</code></b> e <b><code>Ôπ§</code></b> transformam em simples <b><code>&lt;</code></b> .  Se um aplicativo usar codifica√ß√£o HTML ap√≥s a normaliza√ß√£o, provavelmente o s√≠mbolo normalizado <b><code>&lt;</code></b> ser√° codificado em <b><code>&amp;lt;</code></b>  .  Mas, em outros casos, os desenvolvedores podem ter ignorado esse recurso e n√£o codificado s√≠mbolos Unicode.  Assim, obtemos s√≠mbolos n√£o codificados em HTML <b>&lt;</b> e <b>&gt;</b> , que podem ser transformados em ataques XSS.  O WAF pode ter problemas para entender os s√≠mbolos Unicode - ele pode simplesmente n√£o ter regras para esses truques, e o aprendizado de m√°quina tamb√©m pode ser in√∫til.  Ao encontrar um desvio em aplicativos Web com a normaliza√ß√£o Unicode, podemos substituir n√£o apenas <b>&lt;&gt;</b> mas tamb√©m outros s√≠mbolos da carga √∫til. <br><br>  Por exemplo: <br><br><pre> <code class="html hljs xml">Ôºúimg srcÔπ¶x onerrorÔºùalertÔ∏µ1)&gt;</code> </pre> <br>  Recentemente, esse problema foi encontrado no programa Rockstar BugBounty no HackerOne.  N√£o havia WAF, apenas filtragem estrita de entrada do usu√°rio: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hackerone.com/reports/231444</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hackerone.com/reports/231389</a> <br><br><h4>  Disjuntores de tokens </h4><br>  Ataques em tokenizadores tentam quebrar a l√≥gica de dividir uma solicita√ß√£o em tokens com a ajuda dos chamados disjuntores.  Disjuntores de tokens s√£o s√≠mbolos que permitem afetar a correspond√™ncia entre um elemento de uma string e um determinado token e, assim, ignoram a pesquisa por assinatura.  Por√©m, ao usar o disjuntor de token, a solicita√ß√£o deve permanecer v√°lida.  A solicita√ß√£o a seguir √© um exemplo de ataque usando um disjuntor de token <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>-@<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>()</code> </pre> <br>  onde <b>- @</b> √© o disjuntor de token. <br><br>  Existe uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">planilha de chear</a> que foi adquirida pelo mysql fuzzing e verificando os resultados na libinjection. <br><br>  Mais sobre como encontrar problemas na libinjection: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Outro fuzzer</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fuzz para ignorar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como ignorar a libinje√ß√£o</a> <br><br><h4>  Usando os recursos do RFC </h4><br>  Nas especifica√ß√µes para o protocolo HTTP / 1.1 e v√°rios tipos de solicita√ß√£o (por exemplo, multipart / form-data), podemos encontrar algumas coisas curiosas relacionadas aos casos de limite e truques de processamento de cabe√ßalhos e par√¢metros.  Os desenvolvedores do WAF geralmente n√£o consideram esses problemas; portanto, um WAF pode analisar uma solicita√ß√£o incorretamente e perder a parte dos dados, onde um vetor de ataque est√° oculto.  A maioria dos problemas nos WAFs est√° relacionada ao processamento de dados de v√°rias partes / formul√°rio e valores espec√≠ficos do par√¢metro boundary, que especifica os limites dos par√¢metros em tais solicita√ß√µes.  Al√©m disso, os desenvolvedores de servidores tamb√©m podem errar e n√£o suportar especifica√ß√µes completamente, portanto, pode haver recursos n√£o documentados no analisador HTTP de um servidor. <br><br>  Em uma solicita√ß√£o HTTP com dados de v√°rias partes / formul√°rio, o limite do par√¢metro √© respons√°vel pela segrega√ß√£o de diferentes par√¢metros no corpo de uma solicita√ß√£o.  De acordo com a RFC, um limite especificado anteriormente com um prefixo contendo ‚Äú-‚Äù deve ser colocado antes de cada novo par√¢metro POST, para que o servidor possa discriminar os diferentes par√¢metros de uma solicita√ß√£o. <br><br><pre> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Connection: close Content-Type: multipart/form-data; boundary=1049989664 Content-Length: 192 --1049989664 Content-Disposition: form-data; name="id" 287356 --1049989664--</code> </pre> <br>  O ataque tamb√©m pode se basear no fato de que um servidor e um WAF lidam de maneira diferente com uma situa√ß√£o em que o limite √© deixado vazio.  De acordo com a RFC, neste caso, ‚Äú-‚Äù √© o limite entre os par√¢metros.  No entanto, um WAF pode usar um analisador que n√£o considere isso e, como resultado, o WAF passar√° a solicita√ß√£o porque os dados dos par√¢metros de uma solicita√ß√£o POST n√£o apareceriam no analisador.  O servidor da Web pode analisar essa solicita√ß√£o sem problemas e entregar os dados para processamento adicional. <br>  Aqui est√£o alguns exemplos mais interessantes. <br><br><pre> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Connection: close Content-Type: multipart/form-data; boundary= Content-Length: 192 -- Content-Disposition: form-data; name="id" 123' or sleep(20)# ----</code> </pre> <br>  Vamos dar alguns exemplos mais interessantes dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">slides</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bo0oM</a> no ZeroNights 2016 e explicar: <br><br><pre> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Content-Type: multipart/form-data; boundary=FIRST; Content-Type: multipart/form-data; boundary=SECOND; Content-Type: multipart/form-data; boundary=THIRD; --THIRD Content-Disposition: form-data; name=param UNION SELECT version() --THIRD--</code> </pre><br>  Neste ataque, estamos tentando definir qual dos par√¢metros de limite ser√° aceito pelo WAF e qual pelo servidor da web.  Portanto, se eles aceitarem par√¢metros diferentes, √© poss√≠vel executar um ataque especificando um limite que o WAF n√£o ver√°.  Esse ataque √© um pouco como o HPP. <br><br><pre> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Content-Type: multipart/form-data; xxxboundaryxxx=FIRST; boundary=SECOND; --FIRST Content-Disposition: form-data; name=param UNION SELECT version() --FIRST--</code> </pre><br>  Esse ataque √© baseado na suposi√ß√£o de que h√° uma diferen√ßa na an√°lise de uma solicita√ß√£o HTTP pelo WAF e pelo servidor da web.  Ou seja, o analisador do servidor da Web procura a primeira entrada 'limite' e, em seguida, o s√≠mbolo '=', e somente depois disso define o valor do limite.  O analisador WAF, por sua vez, procura apenas a entrada "boundary =" e depois define o limite.  Se essas condi√ß√µes forem atendidas, o WAF n√£o encontrar√° o limite na solicita√ß√£o e, portanto, n√£o poder√° encontrar e analisar o par√¢metro.  Pelo contr√°rio, o servidor da Web receber√° a solicita√ß√£o e processar√° o par√¢metro.  Esse ataque tamb√©m funcionar√° de maneira inversa: o analisador de servidor da Web procura por ‚Äúboundary =‚Äù e o WAF parser procura apenas por 'boundary'.  Nesse caso, teremos apenas que alterar o limite real de PRIMEIRO para SEGUNDO. <br><br><pre> <code class="plaintext hljs">POST /somepage.php HTTP/1.1 Host: test.com Content-Type: multipart/form-data; boundary=Test0x00othertext; --Test Content-Disposition: form-data; name=param Attack --Test--</code> </pre><br>  Este ataque tamb√©m usa caracteres especiais.  No par√¢metro boundary, adicionamos NULL-byte para que o servidor da Web o interrompa, mas o WAF o aceite integralmente.  Nesse caso, o WAF n√£o pode analisar o par√¢metro porque n√£o consegue encontrar seus limites. <br><br><h4>  Ignorando o aprendizado de m√°quina </h4><br>  A l√≥gica √© simples: temos que compor um ataque que satisfa√ßa os par√¢metros do modelo estat√≠stico treinado.  Mas isso depende muito de como a WAF foi treinada e de qual modelo de treinamento foi usado.  √Äs vezes √© poss√≠vel encontrar uma brecha, e √†s vezes n√£o.  Normalmente, no est√°gio de implementa√ß√£o, um WAF com aprendizado de m√°quina precisa de treinamento extra com base na solicita√ß√£o para o aplicativo Web do cliente.  Isso representa um problema para os participantes do teste: par√¢metros semelhantes e que n√£o mudam muito de solicita√ß√£o para solicita√ß√£o n√£o podem ser testados, pois qualquer digress√£o da forma usual de par√¢metro seria considerada uma anomalia.  Digamos que tenha um pedido para <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">api.test.com/getuser?id=123</a></b> .  A identifica√ß√£o do par√¢metro √© sempre num√©rica e foi num√©rica na amostra de treinamento.  Se o m√≥dulo de aprendizado de m√°quina encontrar algo al√©m de n√∫meros nesse par√¢metro, provavelmente decidir√° que √© uma anomalia.  Outro exemplo: suponha que o WAF tenha sido treinado para classificar a solicita√ß√£o POST em <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">api.test.com/setMarkDown</a></b> com par√¢metros POST que possuem texto de remarca√ß√£o.  Obviamente, pode haver aspas, s√≠mbolos especiais e basicamente qualquer coisa na remarca√ß√£o.  Nesse caso, √© muito mais f√°cil ignorar o m√≥dulo de aprendizado de m√°quina porque o WAF tolera aspas e s√≠mbolos especiais. <br><br>  Al√©m disso, nos exemplos de nossa pr√°tica, mostraremos que ele nem sempre chega ao m√≥dulo de aprendizado de m√°quina devido a problemas com a an√°lise de par√¢metros causados ‚Äã‚Äãpelos m√©todos de desvio descritos acima. <br><br>  Em geral, precisamos considerar as especificidades de uma solicita√ß√£o testada e seus par√¢metros, presumir todas as op√ß√µes poss√≠veis dos valores dos par√¢metros, aos quais o WAF pode ser tolerante, e basear-se neles. <br><br><h4>  Quando WAF √© in√∫til? </h4><br>  O WAF analisa solicita√ß√µes e procura um comportamento an√¥malo nelas, mas existem algumas classes de vulnerabilidades que n√£o podem ser descobertas.  Por exemplo, vulnerabilidades l√≥gicas, que n√£o t√™m anomalias, mas t√™m algumas a√ß√µes que interrompem a l√≥gica de um aplicativo Web.  Provavelmente, o WAF tamb√©m seria in√∫til em caso de condi√ß√£o de corrida, IDOR e autentica√ß√£o de usu√°rio insegura. <br><br><h4>  Utilit√°rios existentes </h4><br>  Existem algumas ferramentas autom√°ticas para encontrar desvios do WAF, escritos pelos entusiastas deste campo.  Aqui est√£o os mais famosos e dignos: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lightbulb-framework</a> - uma estrutura completa para testar aplicativos da web protegidos com WAF.  Est√° escrito em Python e adicionalmente portado como um plugin para o Burp Suite.  Suas principais caracter√≠sticas s√£o esses dois algoritmos: <br><br><ul><li>  GOFA - um algoritmo ativo de aprendizado de m√°quina que permite analisar a filtragem e a higieniza√ß√£o de par√¢metros em um aplicativo da web. </li><li>  SFADiff - algoritmo de teste deferente de caixa preta, baseado em treinamento com aut√¥matos finitos simb√≥licos (SFA).  Ele permite encontrar diferen√ßas no comportamento dos aplicativos da web, o que ajuda a identificar o WAF e encontrar um desvio. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bypass WAF</a> - um plug-in para o Burp Suite, que permite configurar a altera√ß√£o autom√°tica dos elementos no corpo de uma solicita√ß√£o de acordo com diferentes regras e altera√ß√µes de codifica√ß√£o.  Ele tamb√©m pode automatizar um ataque de HPP. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WAFW00F</a> - uma ferramenta para identifica√ß√£o de WAF, escrita em Python.  Ele possui uma base WAF decente e ainda est√° sendo atualizado.  No entanto, os resultados podem ser imprecisos porque muitas WAFs s√£o atualizadas com mais frequ√™ncia do que o pr√≥prio projeto. <br><br><h2>  Ignorando o waf na pr√°tica </h2><br><img src="https://habrastorage.org/webt/59/e4/fc/59e4fc4eee061363676501.png"><br><br>  Temos realizado testes de penetra√ß√£o em uma loja on-line, protegida pelo <b>PT AF</b> (Positive Technologies Application Firewall).  Era dif√≠cil encontrar um ponto fraco, que poderia ser a base para um desvio.  Mas logo descobrimos um comportamento incomum no lado do aplicativo Web, que n√£o foi filtrado pelo WAF.  A anomalia foi encontrada na pesquisa no hist√≥rico de mercadorias compradas.  A solicita√ß√£o foi enviada no formato JSON e tinha a seguinte apar√™ncia: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"request"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"Count"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-attr"><span class="hljs-attr">"Offset"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ItemName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Phone"</span></span>}}</code> </pre> <br>  Colocamos os valores <b>Phone '</b> e <b>Phone' + '</b> no par√¢metro <b>ItemName</b> e descobrimos que o servidor retornou respostas diferentes para essas duas solicita√ß√µes.  No primeiro caso, a resposta estava vazia;  no segundo caso, continha dados de outros produtos com a palavra <b>telefone</b> em seu nome, como se o par√¢metro <b>ItemName</b> tivesse <b>telefone</b> como valor.  Esse tipo de comportamento √© bem conhecido entre hackers e criminosos e aponta para o aplicativo um problema com a filtragem da entrada do usu√°rio, o que leva √† inje√ß√£o de SQL, entre outros. <br><br>  Vamos ver por que isso acontece com um exemplo de inje√ß√£o SQL.  Se esse comportamento for encontrado em um aplicativo Web, √© altamente prov√°vel que os dados para uma solicita√ß√£o SQL estejam em concatena√ß√£o com a pr√≥pria solicita√ß√£o.  No primeiro caso, com <b>o</b> par√¢metro <b>Phone '</b> , teremos a seguinte consulta SQL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> items <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> item_name=<span class="hljs-string"><span class="hljs-string">'Phone''</span></span></code> </pre> <br>  Obviamente, n√£o ser√° executado devido √† sintaxe incorreta e n√£o retornar√° nenhum resultado.  A segunda solicita√ß√£o, com <b>o</b> par√¢metro <b>Phone '+'</b> , ter√° a seguinte apar√™ncia: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> items <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> item_name=<span class="hljs-string"><span class="hljs-string">'Phone'</span></span>+<span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre> <br>  Sua sintaxe est√° correta e, portanto, selecionar√° produtos com o nome <b>Telefone</b> .  Esse m√©todo de detec√ß√£o de vulnerabilidades tem uma enorme vantagem ao testar um aplicativo Web protegido pelo WAF.  O s√≠mbolo de aspas simples n√£o √© considerado uma anomalia suficiente em um par√¢metro pela maioria dos WAFs modernos; portanto, eles passam uma solicita√ß√£o com ele. <br><br>  Descrevemos a detec√ß√£o de vulnerabilidades, mas e ignorando o WAF e explorando a vulnerabilidade?  Depois de passar por alguns desvios, encontramos um problema no WAF.  Verificou-se que este WAF √© vulner√°vel a caracteres especiais adicionados aos par√¢metros JSON.  De fato, se adicionarmos os s√≠mbolos JSON <b>0x0A, 0x0D</b> (\ r \ n ou carrige reutrn e nova linha) no formato bruto, sem qualquer codifica√ß√£o, em qualquer campo de texto, o WAF passar√° e o aplicativo da Web considerar√° esteja correto e processe-o.  Provavelmente, o problema estava no analisador JSON, que n√£o foi criado para s√≠mbolos especiais e analisou o JSON at√© um local onde esses s√≠mbolos apareceriam.  Assim, o analisador WAF n√£o receberia a solicita√ß√£o completa, para que pud√©ssemos inserir qualquer vetor de ataque ap√≥s caracteres especiais.  Al√©m da quebra de linha, outros caracteres (por exemplo, NULL-byte) tamb√©m funcionariam.  Como resultado, poder√≠amos escrever a seguinte solicita√ß√£o, que desativaria o WAF ao tentar verificar essa solicita√ß√£o (a quebra de linha e o retorno de carro foram substitu√≠dos por sua representa√ß√£o textual): <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"request"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"kill-waf"</span></span>:<span class="hljs-string"><span class="hljs-string">"die0x0A0x0D"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Count"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-attr"><span class="hljs-attr">"Offset"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ItemName"</span></span>:[<span class="hljs-string"><span class="hljs-string">"'+(SELECT 'Phone'+CHAR(ASCII(substring(@@version,1,1))-24))+'"</span></span>]}}</code> </pre> <br>  <i>0x0A e 0x0D s√£o bytes brutos.</i> <br><br>  Assim, poder√≠amos testar com facilidade e rapidez todos os par√¢metros em busca de vulnerabilidades (algumas foram encontradas em outros par√¢metros).  Ignorar o WAF e explorar essa inje√ß√£o nos permitiu comprometer totalmente todos os usu√°rios do aplicativo da web. <br><br>  Os mesmos problemas tamb√©m foram encontrados no <b>Nemesida WAF</b> .  A √∫nica diferen√ßa √© que a solicita√ß√£o n√£o estava na codifica√ß√£o JSON, mas era uma solicita√ß√£o POST comum com par√¢metros, e um par√¢metro foi concedido √† consulta SQL como um n√∫mero.  Se alguns s√≠mbolos foram colocados em uma solicita√ß√£o na codifica√ß√£o de URL, por exemplo, <b>% 03% 04</b> , o WAF bloqueia uma solicita√ß√£o, mas se os s√≠mbolos foram colocados na forma bruta sem codifica√ß√£o de URL, o WAF ignora essa solicita√ß√£o.  Vale ressaltar que a express√£o SQL normal foi solicitada, assim como no WAF anterior.  A express√£o SQL era simples <b>'UNION SELECT'</b> sem nenhuma ofusca√ß√£o adicional, o que significa que o WAF simplesmente n√£o p√¥de analisar a solicita√ß√£o corretamente e passar adiante a an√°lise.  Mas h√° um problema - como corrigir a sintaxe da consulta SQL?  Porque o uso de caracteres especiais como <b>% 03% 04</b> na consulta SQL n√£o est√° correto.  A resposta √© simples - basta usar coment√°rios / ** /.  Portanto, a solicita√ß√£o de resultado parecia: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*0x03 0x04*/</span></span>1 UNION <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>() <span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  <i>0x03 e 0x04 s√£o bytes brutos.</i> <br><br>  Al√©m disso, outro problema foi encontrado no Nemesida WAF.  Isso estava relacionado ao processamento incorreto de solicita√ß√µes POST com dados de v√°rias partes / formul√°rio.  Conforme descrito abaixo, em uma solicita√ß√£o HTTP com dados de v√°rias partes / formul√°rio, o <b>limite do</b> par√¢metro √© respons√°vel pela segrega√ß√£o de diferentes par√¢metros no corpo de uma solicita√ß√£o.  De acordo com a RFC, um limite especificado anteriormente com um prefixo contendo <b>‚Äú-‚Äù</b> deve ser colocado antes de cada novo par√¢metro POST, para que o servidor possa discriminar os diferentes par√¢metros de uma solicita√ß√£o. <br>  Portanto, o problema era que o servidor e o WAF trataram a situa√ß√£o de maneira diferente quando o par√¢metro de limite estava vazio.  Com base na RFC, em tal situa√ß√£o, o limite entre os par√¢metros ser√° uma sequ√™ncia de caracteres <b>‚Äú-‚Äù</b> .  No entanto, o WAF usou um analisador que n√£o leva em considera√ß√£o esse recurso, e √© por isso que o WAF passa novamente a solicita√ß√£o, porque os dados dos par√¢metros de solicita√ß√£o POST simplesmente n√£o entraram no m√≥dulo analisador e o servidor analisou essa situa√ß√£o sem problemas. e transferiu os dados para o processamento.  Esta √© uma solicita√ß√£o de amostra para este ataque: <br><br><pre> <code class="plaintext hljs">POST /wp-content/plugins/answer-my-question/modal.php HTTP/1.1 Host: example.com Content-Type: multipart/form-data; boundary= Content-Length: 209 -- Content-Disposition: form-data; name="id" 1 UNION SELECT 1,2,3,CONVERT(version() USING utf8) AS name,CONVERT(user() USING utf8) AS name,6,7,8,9,10,11,12 FROM wp_users WHERE id=1 ----</code> </pre><br>  Ambos os problemas foram relatados ao Pentestit, os caras pagaram uma recompensa por seu programa de recompensa de bugs para o Nemesida WAF e os solucionaram o mais r√°pido poss√≠vel.  Agrade√ßa a eles por isso. <br><br>  Como podemos ver, os WAFs podem ser modernos e inteligentes, mas √†s vezes √© poss√≠vel ignor√°-los apenas adicionando um √∫nico caractere especial.  Hoje, n√£o podemos prever todos os tipos poss√≠veis de dados de entrada para todos os servidores no est√°gio de desenvolvimento, e o aprendizado de m√°quina, implementado para fazer exatamente isso, trope√ßa nos analisadores que ficam presos a caracteres especiais. <br><br><h2>  Conclus√£o </h2><br><img align="left" src="https://habrastorage.org/webt/59/e5/54/59e55464f2331285132470.png">  Ent√£o, devemos confiar inteiramente no WAF?  <b>A resposta √© N√ÉO.</b> <br><br>  Em uma de nossas auditorias, descobrimos um desvio WAF que nos permitiu explorar algumas vulnerabilidades.  Como se viu, os desenvolvedores j√° haviam realizado uma auditoria do aplicativo Web, antes de ser protegido pelo WAF, e ele revelou as mesmas vulnerabilidades.  Em vez de consert√°-los, eles decidiram comprar um WAF moderno, equipado com aprendizado de m√°quina.  √â uma pena que o fornecedor do WAF n√£o tenha insistido em corrigir as vulnerabilidades primeiro;  ou talvez os pr√≥prios desenvolvedores pensassem que o WAF seria uma op√ß√£o melhor.  Ainda n√£o sabemos ao certo.  De qualquer forma, este √© um exemplo de uma pr√°tica muito ruim, tanto por parte dos desenvolvedores quanto do fornecedor.  Tamb√©m deve-se notar que o aprendizado de m√°quina ainda √© uma caixa preta e parece mais um dispositivo de marketing do que uma defesa real. <br><br>  Em geral, o WAF √© uma solu√ß√£o de seguran√ßa moderna e n√£o prejudica t√™-lo com seus aplicativos da web.  Embora hoje em dia, ele pode apenas atrapalhar o processo de pesquisa e explora√ß√£o de vulnerabilidades, mas n√£o pode se proteger completamente deles.  No momento, esse √© o estado da arte h√° um bom tempo.  As vulnerabilidades nos aplicativos da Web s√≥ podem ser corrigidas corrigindo o c√≥digo relacionado a eles, e essa √© a √∫nica solu√ß√£o infal√≠vel. <br><br>  <b>Contribuintes</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ilia Bulatov</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">barracud4</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Denis Rybin</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">thefaeriedragon</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alexander Romanov</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">web_rock</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454592/">https://habr.com/ru/post/pt454592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454582/index.html">O comprimento da matriz deve ser armazenado em uma vari√°vel local em C #?</a></li>
<li><a href="../pt454584/index.html">Escola de desenvolvimento de interfaces: an√°lise de tarefas para Minsk e um novo conjunto em Moscou</a></li>
<li><a href="../pt454586/index.html">Solu√ß√£o de palavras cruzadas em japon√™s com PÃ∂yÃ∂tÃ∂hÃ∂oÃ∂Ã∂nÃ∂ Rust e WebAssembly</a></li>
<li><a href="../pt454588/index.html">A Gazprom Neft convida voc√™ a visitar: GPN Data Science Meetup</a></li>
<li><a href="../pt454590/index.html">Zimbra Collaboration Suite e controle m√≥vel com ABQ</a></li>
<li><a href="../pt454596/index.html">Modelos mentais em seguran√ßa da informa√ß√£o</a></li>
<li><a href="../pt454598/index.html">Arquitetura sem servidor e microsservi√ßos: a combina√ß√£o perfeita?</a></li>
<li><a href="../pt454600/index.html">Como fizemos um acordo seguro no Freelansim: escolha, reduza recursos, compare comiss√µes</a></li>
<li><a href="../pt454604/index.html">Gerando um aplicativo React com um back-end do GraphQL em minutos</a></li>
<li><a href="../pt454606/index.html">Recursos do atributo inputmode para SO e navegadores m√≥veis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>