<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëß üìÇ ü§¶üèª Presque OCR pour obtenir le mot de passe VPNBook. PHP + Mikrotik üó∫Ô∏è üßõüèø üôÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, VPNBook a commenc√© √† publier un mot de passe au lieu du texte brut en tant qu'image. "Eh bien, comment," pensai-je, et je commen√ßai √† cherc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Presque OCR pour obtenir le mot de passe VPNBook. PHP + Mikrotik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420373/">  R√©cemment, VPNBook a commenc√© √† publier un mot de passe au lieu du texte brut en tant qu'image.  "Eh bien, comment," pensai-je, et je commen√ßai √† chercher des moyens de r√©soudre ce probl√®me.  Nous reconnaissons le mot de passe "image" VPNBook en PHP.  Et, bien s√ªr, un script pour Mikrotik. <br><a name="habracut"></a><br>  Pendant longtemps, j'ai mis en place un tunnel VPN PPTP gratuit et automatique depuis VPNBook.com sur mon routeur (Mikrotik) et l'ai utilis√© avec succ√®s jusqu'√† r√©cemment.  Je n'entrerai pas dans les d√©tails, ils sont d√©crits dans l'article " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configurer la r√©ception automatique d'un mot de passe pour VPN sur Mikrotik</a> ".  Avant le probl√®me, le mot de passe du VPNBook pouvait simplement √™tre extrait de la page html, par exemple, comme ceci: <br><br><pre><code class="php hljs">preg_match(<span class="hljs-string"><span class="hljs-string">'/Password: &lt;strong&gt;([^&lt;]+)/'</span></span>, $homepage, $matches); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>($matches[<span class="hljs-number"><span class="hljs-number">1</span></span>])</code> </pre> <br>  Et plus r√©cemment, le mot de passe est devenu une "image".  Et la premi√®re pens√©e a √©t√© d'utiliser la reconnaissance optique de texte.  J'ai commenc√© √† essayer les services OCR en ligne et hors ligne, qui pouvaient reconna√Ætre le mot de passe.  <i>J'adresse mes salutations √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Winand</a> , avec qui nous avons correspondu √† ce sujet.</i>  En g√©n√©ral, le dernier OCR avec lequel j'ai jou√© √©tait Tesseract, qui, d√®s la sortie de la bo√Æte, a d√©termin√© le mot de passe, mais avec des erreurs.  Mais on peut lui apprendre de nouvelles polices, ce que j'allais faire.  Lorsque j'ai choisi une police qui ressemblait √† une ¬´police d'image¬ª, l'id√©e m'est venue que c'√©tait quelque chose de simple, m√™me si cela ressemblait √† un teminal de Windows ou √† une police terminale de Linux.  Et le tour est jou√© - il s'est av√©r√© qu'il s'agissait simplement d'une police PHP int√©gr√©e avec un nombre (taille) 5. Ensuite, j'ai abandonn√© l'OCR et √©crit un script PHP qui recherche les caract√®res du mot de passe "image" dans le dictionnaire g√©n√©r√©.  Un dictionnaire est un ensemble d'images de caract√®res de mot de passe possibles de la m√™me couleur et taille.  La recherche se fait en faisant correspondre les images.  Voici une ing√©nierie inverse si simple.  Je suppose que la version actuelle de l'image sur le VPNBook ne durera pas longtemps, compte tenu de sa primitivit√©. <br><br><h3>  Script Vpnbook.php </h3><br>  Sprite renvoie une cha√Æne de mot de passe. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//   $wchar = 9; $hchar = 13; $strDict = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 '; $imgDict = imagecreatetruecolor(2 + strlen($strDict)* $wchar, $hchar); $bg = imagecolorallocate($imgDict, 0xF6, 0xF6, 0xF6); $textcolor = imagecolorallocate($imgDict, 0x4C, 0x4C, 0x4C); imagefill($imgDict, 0, 0, $bg); imagestring($imgDict, 5, 2, 0, $strDict, $textcolor); //  cURL $ch = curl_init(); //  url,      curl_setopt($ch, CURLOPT_URL, 'https://www.vpnbook.com/password.php'); //  ,      string curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_BINARYTRANSFER, 1); // also, this seems wise considering output is image. //   $output = curl_exec($ch); //  cURL curl_close($ch); $imgOCR = imagecreatefromstring($output); // $imgOCR = imageCreateFromPng('password.png'); //      10  . 2 + 10*9 = 92 &lt; 100 $maxchar = floor((imagesx($imgOCR) - 2) / 9); $imgBox = imagecreatetruecolor($wchar, $hchar); $hashDict = Array(); //   for ($k = 0; $k &lt; strlen($strDict) ; $k++) { imagecopy($imgBox, $imgDict, 0, 0, 2 + $k * $wchar, 0, $wchar, $hchar); $hashStr = ""; for($y = 0; $y &lt; $hchar ; $y++) for($x = 0; $x &lt; $wchar; $x++) $hashStr .= (imagecolorat($imgBox, $x, $y) != 0xF6F6F6)? '1': '0'; $hashDict[$hashStr] = $strDict[$k]; } //     for ($k = 0; $k &lt; $maxchar ; $k++) { imagecopy($imgBox, $imgOCR, 0, 0, 2 + $k * $wchar, 0, $wchar, $hchar); $hashStr = ""; for($y = 0; $y &lt; $hchar ; $y++) for($x = 0; $x &lt; $wchar; $x++) $hashStr .= (imagecolorat($imgBox, $x, $y) != 0xF6F6F6)? '1': '0'; $tempchar = $hashDict[$hashStr]; if ($tempchar==' ') break; print($tempchar); } /*header('Content-type: image/png'); imagepng($imgOCR); */ //var_dump($hashDict); imagedestroy($imgDict); imagedestroy($imgOCR); imagedestroy($imgBox); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><br><h3>  Plan B. Mot de passe de twitter </h3><br>  Avec l'invite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vvsvic</a> , je <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">propose une</a> impl√©mentation simple d'un script alternatif pour r√©cup√©rer un mot de passe √† partir d'un twitter VPNBook (https://twitter.com/vpnbook/) <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">url_get_html</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($url)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  cURL $ch = curl_init(); //  url      curl_setopt($ch, CURLOPT_URL, $url); //        string curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); //   $output = curl_exec($ch); //  cURL curl_close($ch); //   return $output; } $homepage = url_get_html('https://twitter.com/vpnbook'); preg_match('/Password: ([^&lt;]+)/', $homepage, $matches); // Print the entire match result // var_dump($matches); print($matches[1]) // print_r($matches); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br><h3>  Script Mikrotik VPNBook </h3><br>  Le script doit √™tre appel√© toutes les minutes depuis le sheduler.  Le script surveille l'√©tat de la connexion PPTP et, lors de la d√©connexion, appelle toute la proc√©dure pour demander un nouveau mot de passe, donc Mikrotik n'inondera pas les tentatives d'ouverture de la connexion pendant plusieurs heures avec le mauvais mot de passe, et la reconnexion se fait en 1 minute.  Il surveille √©galement les erreurs d'erreur lors de la r√©cup√©ration et de l'obtention de fichiers pour d√©terminer plus pr√©cis√©ment qu'un mot de passe a √©t√© re√ßu. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># VPNBookScript v2 :global VPNBookpIfName "pptp-out1" :global VPNBookServerAddresses {"euro217.vpnbook.com";"euro214.vpnbook.com";"us1.vpnbook.com";"us2.vpnbook.com";"ca1.vpnbook.com";"de233.vpnbook.com";"fr1.vpnbook.com"} #:if ([:typeof $VPNBookServerAddresses] != "array") do={ # :set VPNBookServerAddresses {"euro217.vpnbook.com";"euro214.vpnbook.com";"us1.vpnbook.com";"us2.vpnbook.com";"ca1.vpnbook.com";"de233.vpnbook.com"} #} :global VPNBookErr false :global VPNBookPassFile "VPNBookPass.txt" :global VPNBookPass :global VPNBookRun #:global TToken "4.....................2" #:global TChatId "2342432...9" :global VPNBookServerIndex :if ([:typeof $VPNBookServerIndex] != "num") do={:set VPNBookServerIndex 0} :if ([/interface pptp-client get $VPNBookpIfName running]) do={ :set VPNBookRun true } else { :if (!$VPNBookRun) do={ :set VPNBookServerIndex ($VPNBookServerIndex + 1) :if ($VPNBookServerIndex&gt;=[:len $VPNBookServerAddresses]) do={:set VPNBookServerIndex 0} } else { :set VPNBookRun false } :if (![/interface pptp-client get $VPNBookpIfName disabled]) do={/interface pptp-client set $VPNBookpIfName disabled=yes} :do {/tool fetch url="http://server/vpnbookpass.php" dst-path=$VPNBookPassFile} on-error={:set VPNBookErr true} :delay 2 :do {:set VPNBookPass [/file get $VPNBookPassFile contents]} on-error={:set VPNBookErr true} :if (!$VPNBookErr) do={ :if ([/interface pptp-client get $VPNBookpIfName password] != $VPNBookPass) do={/interface pptp-client set $VPNBookpIfName password=$VPNBookPass} :if ([/interface pptp-client get $VPNBookpIfName connect-to] != $VPNBookServerAddresses-&gt;$VPNBookServerIndex) do={/interface pptp-client set $VPNBookpIfName connect-to=($VPNBookServerAddresses-&gt;$VPNBookServerIndex)} :log info ("VPNBook: Attempt to connect to: ".($VPNBookServerAddresses-&gt;$VPNBookServerIndex).". Password: $VPNBookPass") # /tool fetch url=("https://api.telegram.org/bot$TToken/sendmessage\?chat_id=$TChatId&amp;text=VPNBook: Attempt to connect to: ".($VPNBookServerAddresses-&gt;$VPNBookServerIndex).". Password: $VPNBookPass") keep-result=no /interface pptp-client set $VPNBookpIfName disabled=no } }</span></span></code> </pre> <br>  Je recommande √©galement d'ajouter la d√©connexion de l'interface PPTP pour la d√©connexion (√©v√©nement on-down) dans le profil PPP afin que la reconnexion n'inonde pas du tout, m√™me en 1 minute. <br><br>  En cons√©quence, le script principal en 1 minute en cas de r√©ception r√©ussie d'un nouveau mot de passe augmentera la connexion pptp-out1. <br><br><pre> <code class="bash hljs">add change-tcp-mss=yes name=VPNBook on-down=\ <span class="hljs-string"><span class="hljs-string">":if (![/interface pptp-client get pptp-out1 disabled]) do={\r\ \n /interface pptp-client set pptp-out1 disabled=yes\r\ \n}"</span></span> only-one=yes use-compression=yes use-encryption=required use-ipv6=no use-mpls=no use-upnp=no</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420373/">https://habr.com/ru/post/fr420373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420361/index.html">Bogue lors de l'ex√©cution de TextBox.GetLineText dans .NET WPF</a></li>
<li><a href="../fr420363/index.html">Webinaires HPE en ao√ªt-octobre: ‚Äã‚Äãnouveaux sujets (+ SHD, pratique de l'IA, stockage cl√© en main de p√©taoctets)</a></li>
<li><a href="../fr420367/index.html">Apocalypse climatis√©e: sc√©nario de panne de r√©seau intelligent</a></li>
<li><a href="../fr420369/index.html">Extreme Extended Edge ou commutation IEEE 802.1BR</a></li>
<li><a href="../fr420371/index.html">Sur la question de la construction de v√©los dans le domaine du stockage du courrier √©lectrique</a></li>
<li><a href="../fr420375/index.html">Apprenez OpenGL. Le√ßon 5.8 - Bloom</a></li>
<li><a href="../fr420377/index.html">Comment nous avons commenc√© les appels vid√©o</a></li>
<li><a href="../fr420381/index.html">Pourquoi suffit-il de consid√©rer les r√©seaux de neurones comme une bo√Æte noire?</a></li>
<li><a href="../fr420383/index.html">"Yandex.Money ne vous int√©resse pas pour saisir votre candidature."</a></li>
<li><a href="../fr420385/index.html">Tests d'int√©gration bas√©s sur des conteneurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>