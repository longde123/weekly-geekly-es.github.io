<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéµ üéÅ üôÇ Usando o Unity3D no aplicativo iOS / Android nativo para modelar a ilumina√ß√£o de espa√ßos abertos ü§í üìó üåñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Unity3D √© uma plataforma de desenvolvimento de jogos 3D e 2D bem conhecida que ganhou popularidade em todo o mundo. Ao mesmo tempo, seus recursos n√£...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Usando o Unity3D no aplicativo iOS / Android nativo para modelar a ilumina√ß√£o de espa√ßos abertos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/simbirsoft/blog/417779/"><img src="https://habrastorage.org/webt/ac/6n/is/ac6nistgzfsvyyhyj3wqngoiak4.png" alt="imagem"><br><br>  O Unity3D √© uma plataforma de desenvolvimento de jogos 3D e 2D bem conhecida que ganhou popularidade em todo o mundo.  Ao mesmo tempo, seus recursos n√£o se limitam ao desenvolvimento de apenas aplicativos de jogos, mas s√£o adequados para uso em outras √°reas que exigem a cria√ß√£o de aplicativos de plataforma cruzada para trabalhar com gr√°ficos.  Neste artigo, falaremos sobre a experi√™ncia do uso do Unity3D para desenvolver um sistema para calcular a ilumina√ß√£o de espa√ßos abertos. <br><a name="habracut"></a><br>  A empresa com a qual colaboramos √© a empresa de ilumina√ß√£o internacional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BOOS LIGHTING GROUP</a> .  Para expandir a atratividade de seus produtos e simplificar a intera√ß√£o com os clientes, foi necess√°rio desenvolver um aplicativo que permita simular visualmente a localiza√ß√£o dos dispositivos de ilumina√ß√£o, executar c√°lculos de ilumina√ß√£o e exibir as informa√ß√µes t√©cnicas necess√°rias no relat√≥rio.  Supunha-se que o aplicativo foi lan√ßado em um iPad ou tablet Android por um cliente em potencial ou representante de vendas e permite que o cliente tenha uma id√©ia imediata da possibilidade de ilumina√ß√£o das instala√ß√µes. <br><br>  O trabalho foi realizado em etapas com base na especifica√ß√£o desenvolvida de requisitos e consultas da empresa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BOOS LIGHTING GROUP</a> sobre o assunto do projeto. <br><br>  Em termos gerais, o aplicativo √© um editor que permite adicionar e editar elementos de ilumina√ß√£o, estradas, elementos decorativos, realizar c√°lculos de engenharia de ilumina√ß√£o da cena, exibir um relat√≥rio em pdf.  Cada elemento possui seu pr√≥prio conjunto de par√¢metros para edi√ß√£o e subtipos que afetam sua exibi√ß√£o e c√°lculo. <br><br><ul><li>  Existem v√°rios tipos de mastros de ilumina√ß√£o, com v√°rios tipos de acess√≥rios de fixa√ß√£o, √¢ngulos de inclina√ß√£o das l√¢mpadas e comprimentos de extens√£o.  Para certos tipos de lumin√°rias, √© poss√≠vel um ajuste individual com uma indica√ß√£o da dire√ß√£o da ilumina√ß√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2o/ci/da/2ocida45cxhpgpekhtfat_mc_6y.png" width="70%" alt="imagem"></div></li><li>  As estradas podem ser se√ß√µes lineares, elementos de arco, √°rea, anel.  Para cada elemento, dimens√µes, posi√ß√£o, tipo de layout, camada podem ser personalizadas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s1/3s/lx/s13slxoinkzba4yyljw518pqw78.png" alt="imagem" width="70%"></div></li><li>  Elementos decorativos - carros, √°rvores, arbustos, sinais de tr√¢nsito </li></ul><br>  Todos os elementos da cena podem ser girados e movidos.  A√ß√µes padr√£o para reverter ou tentar novamente tamb√©m s√£o suportadas.  As configura√ß√µes gerais do projeto permitem definir a textura do dorg, a superf√≠cie da terra, exibindo par√¢metros adicionais.  A cena √© exibida nos modos 2D / 3D.  E ao calcular a ilumina√ß√£o na superf√≠cie, um mapa da ilumina√ß√£o da superf√≠cie em cores fict√≠cias √© exibido. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ac/6n/is/ac6nistgzfsvyyhyj3wqngoiak4.png" width="100%" alt="imagem"></div><br><br>  Se poss√≠vel, toda a interface do usu√°rio deve ser feita com ferramentas nativas para iOS / Android. <br>  O principal requisito t√©cnico para a aplica√ß√£o √© poder calcular a ilumina√ß√£o do palco de acordo com as especifica√ß√µes t√©cnicas dos equipamentos.  Tamb√©m era necess√°ria a capacidade de cada equipamento exibir e visualizar seu padr√£o de radia√ß√£o (curvas de intensidade de luz) nos modos 3D / 2D. <br><br><h4>  Sele√ß√£o de plataforma </h4><br>  Para implementar o projeto, escolhemos o Unity como mais conveniente para implementarmos a funcionalidade necess√°ria.  Em geral, nossa empresa tinha experi√™ncia em trabalhar com outros mecanismos e plataformas 3D (OpenSceneGraph, Ogre3D, LibGdx) e tecnicamente todos podem lidar com a tarefa necess√°ria, mas desta vez a escolha recaiu sobre o Unity, o que facilita o gerenciamento do cen√°rio durante o desenvolvimento e a depura√ß√£o no processo de trabalho. <br><br><h4>  As principais dificuldades </h4><br>  N√£o entraremos nos detalhes do desenvolvimento de todo o aplicativo, pois tecnicamente a funcionalidade para exibir e editar a cena √© bastante padr√£o.  Naturalmente, houve dificuldades com os mecanismos de edi√ß√£o espec√≠fica de objetos, adicionando e excluindo-os, al√©m de salvar uma cadeia de comandos para a possibilidade de repetir e cancelar a√ß√µes. <br>  Gostar√≠amos de abordar apenas os recursos do sistema relacionados ao trabalho com a interface do usu√°rio nativa, gerando relat√≥rios em pdf e trabalhando com c√°lculos de fotometria e ilumina√ß√£o. <br><br><h4>  Trabalhar com interface do usu√°rio nativa </h4><br>  Na maioria dos casos, o Unity interage com as fun√ß√µes nativas do sistema usando o sistema de plug-in, o que permite incorporar a funcionalidade desejada no aplicativo.  No entanto, no nosso caso, a situa√ß√£o √© um pouco oposta.  Precis√°vamos ter uma interface do usu√°rio completa exibida na parte superior da janela do Unity. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4z/0s/41/4z0s41r48kbp8cuzxnc7naj6l3i.png" width="70%" alt="imagem"></div><br><br>  Felizmente, o Unity pode exportar um projeto que pode ser usado como base para um aplicativo nativo.  A principal dificuldade nesse caso √© como integrar uma interface do usu√°rio adicional ao projeto resultante.  Al√©m disso, √© igualmente importante que, ao montar um projeto do Unity, seu formato e localiza√ß√£o do arquivo sejam formados pelo Unity e parcialmente reescritos, o que limita a possibilidade de modificar o projeto. <br><br>  Ao desenvolver um aplicativo iOS, usamos o mecanismo proposto no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> .  Durante o desenvolvimento, o Unity 5.5 foi usado e, no momento, o que √© indicado nele pode perder relev√¢ncia.  Ao montar o projeto android, n√£o houve problemas adicionais, com a exce√ß√£o de que o Unity substitui o arquivo de manifesto e os arquivos de recursos a cada vez. <br>  Um problema adicional √© que o Unity pode funcionar apenas em uma janela.  Ao mesmo tempo, precis√°vamos garantir que o Unity exibisse a cena inteira e, ao abrir a janela de configura√ß√µes, um modelo 3D do corpo fotom√©trico da l√¢mpada deveria ser exibido.  Para fazer isso, tive que usar um "hack" e usar o mesmo objeto UIView em janelas diferentes. <br><br>  Para enviar mensagens, usamos a funcionalidade padr√£o oferecida pelo Unity.  Ou seja, todas as mensagens estavam no formato json e transmitidas em linhas simples.  Isso n√£o imp√¥s restri√ß√µes ao desempenho, uma vez que o tamanho das mensagens atingiu um m√°ximo de 100 caracteres e sua frequ√™ncia foi determinada pela velocidade do trabalho com o programa.  Ao mesmo tempo, em aplicativos mais exigentes, faz sentido criar seu pr√≥prio manipulador de mensagens, conforme apresentado no Haber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h4>  C√°lculo de ilumina√ß√£o </h4><br>  Todas as fontes de luz usadas no aplicativo s√£o fornecidas no formato <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IES</a> padr√£o, que descreve a distribui√ß√£o da luz em diferentes dire√ß√µes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">especifica√ß√£o</a> ).  Este formato √© amplamente utilizado em sistemas profissionais de CAD e editores 3D.  √â um arquivo de texto indicando a intensidade da luz em v√°rias dire√ß√µes e meta-informa√ß√µes adicionais indicando o tipo, intensidade total da fonte, eixos e planos de simetria.  Dada a simetria dos equipamentos, o arquivo ies pode ser muito pequeno.  Por exemplo, no caso de simetria axial, √© suficiente indicar o tra√ßado da luz em apenas um plano. <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo de um arquivo IES simples</b> <div class="spoiler_text"><pre><code class="plaintext hljs">IESNA91[TEST] Simple demo intensity distribution [MANUFAC] Lightscape Technologies, Inc. TILT=NONE 1 -1 1 8 1 1 2 0.0 0.0 0.0 1.0 1.0 0.0 0.0 5.0 10.0 20.0 30.0 45.0 65.0 90.0 0.0 1000.0 1100.0 1300.0 1150.0 930.0 650.0 350.0 0.0</code> </pre> <br></div></div><br>  Para exibir o padr√£o de radia√ß√£o, dois tipos de exibi√ß√£o foram usados: <br><br><ul><li>  Curvas de intensidade de luz (KSS) √© um gr√°fico bidimensional que mostra a intensidade da luz em um dos planos principais, dependendo da dire√ß√£o.  Por conveni√™ncia, este gr√°fico pode ser representado no sistema de coordenadas polar e cartesiano. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/df/89/xc/df89xcesta0qlw4jcyuxpbihmyi.png" width="100%" alt="imagem"></div></li><li>  Corpo fotom√©trico - uma imagem tridimensional da intensidade da luz em diferentes dire√ß√µes <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/su/1s/if/su1sifzigs4cwuy-jg6bhpni79o.png" width="100%" alt="imagem"></div></li></ul><br><h4>  M√≥dulo de c√°lculo </h4><br>  Para calcular a ilumina√ß√£o, o cliente teve seu pr√≥prio m√≥dulo C ++ usado em outros produtos da empresa e, portanto, foi necess√°rio integr√°-lo ao projeto Unity.  A ordem de conex√£o do m√≥dulo foi diferente da plataforma usada. <br><br><ul><li>  Na plataforma iOS, o Unitu pode chamar diretamente as fun√ß√µes C, portanto, basta copiar o c√≥digo-fonte do m√≥dulo diretamente no projeto e adicionar classes para sua intera√ß√£o com o Unity.  As classes podem ser armazenadas diretamente no projeto iOS e na pasta plugins, que s√£o copiadas automaticamente quando o projeto √© exportado para o Xcode.  Um exemplo de chamada de fun√ß√µes C ++ √© o seguinte: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DllImport(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"__Internal"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateLight</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[MarshalAs(UnmanagedType.LPArray, SizeParamIndex = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">)] Light[] lights, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> size, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ref</span></span></span><span class="hljs-function"> CalculationResult result)</span></span>;</code> </pre> </li><li>  Na plataforma Android, o m√≥dulo C ++ deve ser pr√©-compilado em uma biblioteca separada.  Isso pode ser feito diretamente adicionando fontes C ++ ao projeto e configurando o gradle para constru√≠-las em bibliotecas. </li><li>  Al√©m disso, para depurar e testar a parte do Unity, o desenvolvimento foi realizado em uma m√°quina Windows, sendo necess√°rio conectar tamb√©m o c√≥digo fonte do m√≥dulo no Windows.  Isso √© feito da mesma forma que no projeto android, apenas nesse caso os arquivos baixados s√£o coletados na biblioteca dll e conectados ao projeto. </li></ul><br><h4>  Exibi√ß√£o clara do mapa </h4><br>  A pedido do cliente, os resultados do c√°lculo da ilumina√ß√£o devem ser exibidos na superf√≠cie da cena.  Na superf√≠cie das estradas, √© necess√°rio usar cores fict√≠cias com a exibi√ß√£o de uma escala para combinar a intensidade da cor e da luz e, no restante da superf√≠cie, apenas exibir o brilho √© suficiente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/18/5q/k9/185qk9lbx4fsoq3ax0miaedzjkm.png" width="70%" alt="imagem"></div><br><br>  Como mencionado anteriormente, todo o c√°lculo foi realizado por um plug-in C ++ para o qual foram transmitidos dados sobre fontes de cores.  O resultado do c√°lculo foi uma matriz bidimensional de intensidade de luz em toda a superf√≠cie da cena com um determinado detalhe. <br><br>  O mapa de irradi√¢ncia resultante foi analisado para o valor m√≠nimo e m√°ximo pelo qual uma textura gradiente unidimensional (GradientRamp) foi constru√≠da.  Usando essa textura, a intensidade da luz foi convertida em cores fict√≠cias diretamente no shader do fragmento.  Ao mesmo tempo, o mesmo sombreador foi usado para diferentes superf√≠cies da estrada e da superf√≠cie da Terra, e a mudan√ßa do modo de ilumina√ß√£o foi fornecida usando o sombreador " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">multi-compile</a> ". <br><br><h4>  Gera√ß√£o de arquivo PDF </h4><br>  De acordo com os requisitos t√©cnicos para o usu√°rio, era necess√°rio gerar um relat√≥rio contendo informa√ß√µes sobre a cena geral (dimens√µes, imagens, par√¢metros de ilumina√ß√£o) e informa√ß√µes sobre cada tipo de lumin√°ria utilizada, indicando sua posi√ß√£o, dire√ß√£o das caracter√≠sticas, bem como diagramas KCC e uma exibi√ß√£o fotom√©trica do corpo. <br>  Como o relat√≥rio deveria ser exibido no iOS e no Android, era necess√°rio gerar o relat√≥rio diretamente no m√≥dulo Unity e exibi-lo usando ferramentas nativas padr√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/aw/fo/je/awfojewyanvogdxu6sihv6zr-i8.png" alt="imagem"></div><br>  Para criar o pdf, foi selecionada a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">iTextSharp</a> que atende aos nossos requisitos.  Criar um relat√≥rio n√£o √© particularmente dif√≠cil e consiste em criar blocos de texto, tabelas e imagens diretamente do c√≥digo.  No entanto, durante o desenvolvimento, fomos confrontados com muitas nuances, cuja solu√ß√£o √†s vezes exigia um esfor√ßo consider√°vel.  O principal problema foi o lan√ßamento da gera√ß√£o de relat√≥rios no encadeamento em segundo plano. <br><br>  Se, ao testar em uma m√°quina de mesa, a gera√ß√£o de pdf era da ordem de v√°rios segundos, ent√£o, ao testar no iPad mini 3, esse tempo atingia facilmente 1-3 minutos.  Naturalmente, a cria√ß√£o do relat√≥rio precisava ser transferida para um encadeamento separado, a fim de evitar problemas com a suspens√£o da interface.  No caso geral, isso n√£o √© um problema, mas n√£o √© o caso ao usar o Unity, no qual √© explicitamente proibido usar a API do Unity de fora do segmento principal.  Ao mesmo tempo, para o relat√≥rio, precis√°vamos, no m√≠nimo, renderizar o CSS e a imagem da cena, o que deveria ser feito apenas a partir do fluxo principal. <br><br>  Portanto, para criar o relat√≥rio, precisamos executar as tarefas em uma determinada sequ√™ncia e, ao mesmo tempo, algumas delas podem funcionar no encadeamento em segundo plano, e parte deve ser iniciada no principal. <br><br>  √Ä primeira vista, para resolver esse problema, voc√™ pode tentar usar o mecanismo padr√£o e executar cada opera√ß√£o em uma rotina separada.  No entanto, isso n√£o nos salva do problema de frear a interface.  Como voc√™ sabe, as corotinas funcionam no encadeamento principal e n√£o s√£o adequadas para opera√ß√µes lentas.  Ao mesmo tempo, ao gerar um relat√≥rio, muitas opera√ß√µes requerem um tempo significativo e, portanto, as corotinas n√£o podem ajudar na solu√ß√£o do nosso problema. <br><br><h4>  UniRx </h4><br>  Outra solu√ß√£o √© dividir o c√≥digo em uma parte que precisa funcionar no encadeamento principal e uma parte que pode ser executada em um encadeamento separado.  Nesse caso, por exemplo, as imagens podem ser constru√≠das usando o mecanismo de rotina e, em seguida, podem ser incorporadas no relat√≥rio em um fluxo separado.  No entanto, nesse caso, ser√° necess√°rio salvar resultados intermedi√°rios em algum lugar, o que imp√µe restri√ß√µes adicionais √† quantidade de mem√≥ria usada ou espa√ßo livre no dispositivo. <br><br>  Em nosso aplicativo, preferimos seguir o caminho direto e executar tarefas sequencialmente nos threads principais ou nos segundo plano.  O √∫nico problema era como organizar esse lan√ßamento de tarefas para n√£o ficar atolado nessa bagun√ßa e sincronizar corretamente as opera√ß√µes. <br>  Ajuda significativa na solu√ß√£o desse problema foi trazida pelo uso do Rx, sua incorpora√ß√£o como um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ativo</a> UniRx gratuito, que j√° foi descrito em detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hub</a> . <br><br>  Seu uso simplificou bastante a intera√ß√£o entre threads e o exemplo abaixo mostra que voc√™ pode executar v√°rios m√©todos em sequ√™ncia estrita, mas em threads diferentes <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo de c√≥digo</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initializer = Observable.FromCoroutine(initMethod); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> heavyMethod1 = Observable.Start(() =&gt; doHardWork()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mainThread1 = Observable.FromCoroutine(renderImage); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> heavyMethod2 = Observable.Start(() =&gt; doHardWork2()); initializer.SelectMany(heavyMethod1) .SelectMany(mainThread1) .SelectMany(heavyMethod2) .ObserveOnMainThread() .Subscribe((x) =&gt; done()) .AddTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  Neste exemplo, o m√©todo doHardWork () ser√° executado sequencialmente no encadeamento em segundo plano.  Ap√≥s sua conclus√£o, renderImage () ser√° iniciado no thread principal e, em seguida, doHardWork2 () ser√° executado novamente no thread de segundo plano. <br></div></div><br>  Tamb√©m √© importante notar que, durante a an√°lise da gera√ß√£o de relat√≥rios para desempenho, verificou-se que a parte mais lenta √© a implementa√ß√£o de imagens no relat√≥rio.  Uma pesquisa na Internet mostrou que n√£o somos os √∫nicos a enfrentar esse problema, mas n√£o havia uma solu√ß√£o adequada para n√≥s.  Tivemos que reduzir um pouco a qualidade da imagem para um n√≠vel aceit√°vel, o que deu um aumento na velocidade de 20 a 40%. <br><br>  Assim, no aplicativo que criamos, foi poss√≠vel introduzir com √™xito o mecanismo de gr√°ficos Unity no aplicativo iOS / Android nativo.  Isso difere da abordagem tradicional quando o Unity √© a parte principal do aplicativo e aborda as propriedades espec√≠ficas do sistema atrav√©s do sistema de plug-in.  Ao mesmo tempo, nossa abordagem pode ser √∫til se voc√™ precisar desenvolver uma interface nativa complexa na qual deseja incorporar gr√°ficos 3D n√£o triviais. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt417779/">https://habr.com/ru/post/pt417779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt417769/index.html">Design da mem√≥ria do usu√°rio: Como projetar para idades</a></li>
<li><a href="../pt417771/index.html">Plano da ICANN: Corpora√ß√£o oferece novo modelo de gerenciamento de servidor raiz DNS</a></li>
<li><a href="../pt417773/index.html">Instalador de componentes OpenPnP caseiro</a></li>
<li><a href="../pt417775/index.html">Mecanismo de comiss√£o do Bitcoin e por que ser amigo de mineiros</a></li>
<li><a href="../pt417777/index.html">Leitura de fim de semana: 25 materiais para entusiastas de vinil iniciantes</a></li>
<li><a href="../pt417781/index.html">Sonda da NASA "toca" o Sol - e n√£o derrete</a></li>
<li><a href="../pt417783/index.html">Otimiza√ß√µes usadas no Python: lista e tupla</a></li>
<li><a href="../pt417785/index.html">Qual administrador de sistema n√£o sonha com sua empresa de terceiriza√ß√£o?</a></li>
<li><a href="../pt417787/index.html">Minha experi√™ncia profissional no papel do treinador √°gil na Europa, parte um</a></li>
<li><a href="../pt417789/index.html">Discuss√µes sobre perspectivas de telecomunica√ß√µes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>