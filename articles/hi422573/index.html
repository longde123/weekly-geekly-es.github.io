<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯеЪ ЁЯС╢ тЬ│я╕П The Witcher 3 рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреА рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ ЁЯжУ ЁЯСиЁЯП╜тАНтЪЦя╕П ЁЯЪ░</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рдореИрдВрдиреЗ рдж рд╡рд┐рдЪрд░ 3 рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рд╕реЗ рдирд┐рдкрдЯрдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ред рдЗрд╕ рдЧреЗрдо рдореЗрдВ рдЕрджреНрднреБрдд рд░реЗрдВрдбрд░рд┐рдВрдЧ рддрдХрдиреАрдХ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╡рд╣ рдХрдерд╛рдирдХ / рд╕рдВрдЧреАрдд / рдЧреЗрдордкреНрд▓реЗ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>The Witcher 3 рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреА рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422573/">  рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рдореИрдВрдиреЗ рдж рд╡рд┐рдЪрд░ 3 рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рд╕реЗ рдирд┐рдкрдЯрдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ред  рдЗрд╕ рдЧреЗрдо рдореЗрдВ рдЕрджреНрднреБрдд рд░реЗрдВрдбрд░рд┐рдВрдЧ рддрдХрдиреАрдХ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╡рд╣ рдХрдерд╛рдирдХ / рд╕рдВрдЧреАрдд / рдЧреЗрдордкреНрд▓реЗ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╢рд╛рдирджрд╛рд░ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5b/54e/95e/e5b54e95e53d14c22be446c3de24f8c3.jpg"></div><br><br>  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдореИрдВ The Witcher 3 рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реВрдВрдЧрд╛ред рдпрд╣ Adrian Correger рджреНрд╡рд╛рд░рд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GTA V</a> рдЧреНрд░рд╛рдлрд┐рдХреНрд╕ рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╛рдкрдХ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдХрдо рд╕реЗ рдХрдо рдЕрднреА рдХреЗ рд▓рд┐рдПред <br><br>  рд╣рдо рдЯреЛрди рд╕реБрдзрд╛рд░ рдХреЗ рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реЗрдВрдЧреЗред <br><a name="habracut"></a><br><h2>  рднрд╛рдЧ 1: рдЯреЛрди рд╕реБрдзрд╛рд░ </h2><br>  рдЕрдзрд┐рдХрд╛рдВрд╢ рдЖрдзреБрдирд┐рдХ рдПрдПрдП рдЧреЗрдореНрд╕ рдореЗрдВ, рд░реЗрдВрдбрд░рд┐рдВрдЧ рдЪрд░рдгреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдЖрд╡рд╢реНрдпрдХ рд░реВрдк рд╕реЗ рдЯреЛрди рд╕реБрдзрд╛рд░ рд╣реИред <br><br>  рдЖрдкрдХреЛ рдпрд╛рдж рджрд┐рд▓рд╛ рджреВрдВ рдХрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬреАрд╡рди рдореЗрдВ рдЪрдордХ рдХреА рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╢реНрд░реГрдВрдЦрд▓рд╛ рд╣реИ, рдЬрдмрдХрд┐ рдХрдВрдкреНрдпреВрдЯрд░ рд╕реНрдХреНрд░реАрди рдкрд░ рдпрд╣ рдмрд╣реБрдд рд╕реАрдорд┐рдд рд╣реИ (рдкреНрд░рддрд┐ рдкрд┐рдХреНрд╕реЗрд▓ 8 рдмрд┐рдЯреНрд╕, рдЬреЛ рд╣рдореЗрдВ 0-255 рджреЗрддрд╛ рд╣реИ)ред  рдпрд╣ рд╡рд╣ рдЬрдЧрд╣ рд╣реИ рдЬрд╣рд╛рдВ рдЯреЛрдирд╛рдореЗрдкрд┐рдВрдЧ рдмрдЪрд╛рд╡ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдк рдПрдХ рд╡реНрдпрд╛рдкрдХ рд╢реНрд░реЗрдгреА рдХреЛ рд╕реАрдорд┐рдд рдкреНрд░рдХрд╛рд╢ рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рдлрд┐рдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдорддреМрд░ рдкрд░, рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рджреЛ рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рд╣реЛрддреЗ рд╣реИрдВ: рдПрдХ рдлреНрд▓реЛрдЯрд┐рдВрдЧ рдкреЙрдЗрдВрдЯ рдХреЗ рд╕рд╛рде рдПрдХ рдПрдЪрдбреАрдЖрд░ рдЫрд╡рд┐, рдЬрд┐рд╕рдХрд╛ рд░рдВрдЧ рдорд╛рди 1.0 рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рдФрд░ рджреГрд╢реНрдп рдХреА рдФрд╕рдд рд░реЛрд╢рдиреА (рдЙрддреНрддрд░рд╛рд░реНрджреНрдз рдХреА рдЧрдгрдирд╛ рдХрдИ рддрд░реАрдХреЛрдВ рд╕реЗ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдорд╛рдирд╡ рдЖрдВрдЦреЛрдВ рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдВрдЦ рдХреЗ рдЕрдиреБрдХреВрд▓рди рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рд▓реЗрдХрд┐рди рдпрд╣ рдпрд╣рд╛рдВ рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛)ред <br><br>  рдЕрдЧрд▓рд╛ (рдФрд░ рдЕрдВрддрд┐рдо) рдХрджрдо рд╢рдЯрд░ рдЧрддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИ, рд╢рдЯрд░ рдЧрддрд┐ рдХреЗ рд╕рд╛рде рд░рдВрдЧ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ рдФрд░ рдЯреЛрди рд╕реБрдзрд╛рд░ рд╡рдХреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░реЗрдВред  рдФрд░ рдпрд╣рд╛рдВ рд╕рдм рдХреБрдЫ рдХрд╛рдлреА рднреНрд░рд╛рдордХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдирдИ рдЕрд╡рдзрд╛рд░рдгрд╛рдПрдВ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ "рд╕рдлреЗрдж рдмрд┐рдВрджреБ" (рд╕рдлреЗрдж рдмрд┐рдВрджреБ) рдФрд░ "рдордзреНрдп рдЧреНрд░реЗ" (рдордзреНрдп рдЧреНрд░реЗ)ред  рдХрдо рд╕реЗ рдХрдо рдХреБрдЫ рд▓реЛрдХрдкреНрд░рд┐рдп рдХрд░реНрд╡реНрд╕ рд╣реИрдВ, рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдореИрдЯ рдкреЗрдЯрд┐рдЯрд┐рдиреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреЗ рдП рдХреНрд▓реЛрдЬрд░ рд▓реБрдХ рдСрди рдЯреЛрди рдореИрдкрд┐рдВрдЧ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ</a> ред <br><br>  рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ, рдореБрдЭреЗ рд╣рдореЗрд╢рд╛ рдЕрдкрдиреЗ рдХреЛрдб рдореЗрдВ рдЯреЛрди рд╕реБрдзрд╛рд░ рдХреЗ рд╕рд╣реА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛рдПрдВ рдереАрдВред  рдСрдирд▓рд╛рдЗрди рдХрдо рд╕реЗ рдХрдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдЫ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрд▓рдЧ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЙрджрд╛рд╣рд░рдг рд╣реИрдВ</a> рдЬреЛ рдореЗрд░реЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд░рд╣реЗ рд╣реИрдВ ... рдХреБрдЫ рд╣рдж рддрдХред  рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдПрдЪрдбреАрдЖрд░ рдЪрдордХ / рд╕рдлреЗрдж рдмрд┐рдВрджреБ / рдордзреНрдпрдо рдЧреНрд░реЗ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реИрдВ, рдЕрдиреНрдп рдирд╣реАрдВ - рдЗрд╕рд▓рд┐рдП рд╡реЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдорджрдж рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдореИрдВ "рдпреБрджреНрдз-рдкрд░реАрдХреНрд╖рдг" рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЦреЛрдЬрдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ред <br><br>  рд╣рдо рд░реЗрдВрдбрд░рдбреЙрдХ рдореЗрдВ рдиреЛрд╡рд┐рдЧреНрд░рд╛рдб рдХреЗ рдореБрдЦреНрдп quests рдореЗрдВ рд╕реЗ рдПрдХ рдХреЗ рдЗрд╕ рдлреНрд░реЗрдо рдкрд░ рдХрдмреНрдЬрд╛ рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред  рд╕рднреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдЕрдзрд┐рдХрддрдо рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/406/c2d/e21/406c2de21d4e934e0f25d0e6331fd272.jpg"></div><br>  рдереЛрдбрд╝рд╛ рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдореБрдЭреЗ рдЯреЛрди рд╕реБрдзрд╛рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрд╣реНрд╡рд╛рди рдорд┐рд▓рд╛!  рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИ, рдПрдЪрдбреАрдЖрд░ рд░рдВрдЧреЛрдВ (рдмрдирд╛рд╡рдЯ рд╕рдВрдЦреНрдпрд╛ 0, рдкреВрд░реНрдг рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди) рдФрд░ рджреГрд╢реНрдп рдХреА рдФрд╕рдд рдЪрдордХ (рдмрдирд╛рд╡рдЯ рд╕рдВрдЦреНрдпрд╛ 1, 1x1, рдлрд╝реНрд▓реЛрдЯрд┐рдВрдЧ рдкреЙрдЗрдВрдЯ, рдкрд╣рд▓реЗ рдЧрдгрдирд╛ рдХрд┐рдП рдЧрдП рдХрдВрдкрд╛рдЙрдВрдбрд░ рджреНрд╡рд╛рд░рд╛ рдЧрдгрдирд╛) рдХрд╛ рдПрдХ рдмрдлрд░ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fe/836/3bd/9fe8363bdeda3b9e7336f0f67fc41dc3.jpg"></div><br>  рдЖрдЗрдП рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЗ рд▓рд┐рдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps_siv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">position</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 4 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ld_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000100</span></span>) 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>) 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 7: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ftou</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ld_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wxyz</span></span> 14: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 15: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 16: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 17: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 18: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 19: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span> 20: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 21: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 22: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 23: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 24: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 25: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 26: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 27: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 28: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 29: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 30: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 31: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 32: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 33: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span> 34: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 35: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br>  рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдХрдИ рдмрд┐рдВрджреБ рд╣реИрдВред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд▓реЛрдб рдХреА рдЧрдИ рдЪрдордХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд░рд╛рдмрд░ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдХрд▓рд╛рдХрд╛рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рдЪреБрдиреЗ рдЧрдП рдореВрд▓реНрдпреЛрдВ (рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ) рдХреЗ рднреАрддрд░ рд╕реАрдорд┐рдд (рдЕрдзрд┐рдХрддрдо / рдорд┐рдирдЯ рдХреЙрд▓) рд╣реИред  рдпрд╣ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЖрдкрдХреЛ рджреГрд╢реНрдп рдХреА рдЙрдЪреНрдЪ рдпрд╛ рдирд┐рдореНрди рд╢рдЯрд░ рдЧрддрд┐ рд╕реЗ рдмрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдпрд╣ рдХрджрдо рдмрд╣реБрдд рдЖрдо рд▓рдЧрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВрдиреЗ рдЗрд╕реЗ рдкрд╣рд▓реЗ рдХрднреА рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред  рджреВрд╕рд░реЗ, рдХреЛрдИ рд╡реНрдпрдХреНрддрд┐ рдЬреЛ рдЯреЛрди рдХрд░реЗрдХреНрд╢рди рдХрд░реНрд╡реНрд╕ рд╕реЗ рдкрд░рд┐рдЪрд┐рдд рд╣реИ, рд╡рд╣ рддреБрд░рдВрдд рдЗрд╕ "11.2" рдорд╛рди рдХреЛ рдкрд╣рдЪрд╛рди рд▓реЗрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рдЬреЙрди рд╣рдмрд▓ рдХреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдирдЪрд╛рд░реНрдЯреЗрдб 2 рдЯреЛрди рдХрд░реЗрдХреНрд╢рди</a> рд╡рдХреНрд░ рд╕реЗ рд╕рдлреЗрдж рдмрд┐рдВрджреБ рдХрд╛ рдорд╛рди рд╣реИред <br><br>  рд╡рд╛рдпреБ рд╕реЗрдирд╛ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ cbuffer рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рддреЛ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рддреАрди рдФрд░ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВ: cb3_v16.x, cb3_v16.y, cb3_v16.zред  рд╣рдо рдЙрдирдХреЗ рдЕрд░реНрде рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a52/975/78b/a5297578b0069fdded06bd3e82f2fadf.jpg"></div><br>  рдореЗрд░рд╛ рдХреВрдмрдбрд╝: <br><br>  рдореЗрд░рд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ "x" рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ "рд╕рдлреЗрдж рд╕реНрдХреЗрд▓" рдпрд╛ рдордзреНрдпрдо рдЧреНрд░реЗ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ 11.2 (рдкрдВрдХреНрддрд┐ 4) рд╕реЗ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рд╢рдЯрд░ рдЧрддрд┐ рд╕реЗрдЯрд┐рдВрдЧ (рд▓рд╛рдЗрди 10) рдХреА рдЧрдгрдирд╛ рдореЗрдВ рдПрдХ рдЕрдВрд╢ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  "Y" - рдореИрдВрдиреЗ рдЗрд╕реЗ "u2 рдЕрдВрд╢ рдХрд╛рд░рдХ" рдХрд╣рд╛, рдФрд░ рдЬрд▓реНрдж рд╣реА рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдХреНрдпреЛрдВред <br><br>  "Z" "рдШрд╛рддрд╛рдВрдХ рдкреИрд░рд╛рдореАрдЯрд░" рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЯреНрд░рд┐рдкрд▓ рд▓реЙрдЧ / mul / exp (рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдШрд╛рддрд╛рдВрдХ рдореЗрдВ) рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рд▓реЗрдХрд┐рди рд╕рдВрджреЗрд╣ рдХреЗ рдПрдХ рдбрд┐рдЧреНрд░реА рдХреЗ рд╕рд╛рде рдЗрди рдЪрд░ рдирд╛рдореЛрдВ рдХрд╛ рдЗрд▓рд╛рдЬ рдХрд░реЗрдВ! <br><br>  рднреА: <br><br>  cb3_v4.yz - рд╕реНрд╡реАрдХрд╛рд░реНрдп рдЪрдордХ рдХреА рдиреНрдпреВрдирддрдо / рдЕрдзрд┐рдХрддрдо рдорд╛рди, <br>  cb3_v7.xyz - Uncharted2 рд╡рдХреНрд░ рдХреЗ рдПрд╕реА рдкреИрд░рд╛рдореАрдЯрд░, <br>  cb3_v8.xyz - Uncharted2 рд╡рдХреНрд░ рдХреЗ DF рдкреИрд░рд╛рдореАрдЯрд░ред <br><br>  рдЕрдм рдЪрд▓рд┐рдП рдореБрд╢реНрдХрд┐рд▓ рд╣рд┐рд╕реНрд╕реЗ рдкрд░ рдЖрддреЗ рд╣реИрдВ - рд╣рдо рдПрдХ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рд╢реЗрдбрд░ рд▓рд┐рдЦреЗрдВрдЧреЗ рдЬреЛ рд╣рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рд╕рдорд╛рди рдХреЛрдбрд░ рджреЗрдЧрд╛ред <br><br>  рдпрд╣ рдмрд╣реБрдд рдХрдард┐рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЬрд┐рддрдирд╛ рд▓рдВрдмрд╛ рд╢реЗрдбрд░ рд╣реЛрдЧрд╛, рдХрд╛рд░реНрдп рдЙрддрдирд╛ рд╣реА рдХрдард┐рди рд╣реЛрдЧрд╛ред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдХреБрдЫ рд╕рдордп рдкрд╣рд▓реЗ рдореИрдВрдиреЗ hlsl-&gt; asm рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдХрд░рдг рд▓рд┐рдЦрд╛ рдерд╛ред <br><br>  рджреЗрд╡рд┐рдпреЛрдВ рдФрд░ рд╕рдЬреНрдЬрдиреЛрдВ ... рд╕реНрд╡рд╛рдЧрдд рд╣реИ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ рдбреА 3 рдбреА рдПрд╕рдбрд░рдбрд┐рд╕рдмрд╕реЗрдореНрдмрд▓рд░! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/394/463/6ec/3944636ec3737e5e1ff5463e7b89d49f.jpg"></div><br>  рдХреЛрдб рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдореБрдЭреЗ рддреИрдпрд╛рд░ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ <b><i>рдЯреЛрдирд▓ рдХрд░реЗрдХреНрд╢рди рдж рд╡рд┐рдЪрд░ 3 рдорд┐рд▓рд╛</i></b> : <br><br><pre> <code class="hljs pgsql"> cbuffer cBuffer : register (b3) { <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v0; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v1; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v2; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v3; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v4; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v5; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v6; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v7; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v8; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v9; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v10; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v11; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v12; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v13; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v14; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v15; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v16, cb3_v17; } Texture2D TexHDRColor : register (t0); Texture2D TexAvgLuminance : register (t1); struct VS_OUTPUT_POSTFX { <span class="hljs-type"><span class="hljs-type">float4</span></span> Position : SV_Position; }; float3 U2Func( <span class="hljs-type"><span class="hljs-type">float</span></span> A, <span class="hljs-type"><span class="hljs-type">float</span></span> B, <span class="hljs-type"><span class="hljs-type">float</span></span> C, <span class="hljs-type"><span class="hljs-type">float</span></span> D, <span class="hljs-type"><span class="hljs-type">float</span></span> E, <span class="hljs-type"><span class="hljs-type">float</span></span> F, float3 x ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F)) - E/F; } float3 ToneMapU2Func( <span class="hljs-type"><span class="hljs-type">float</span></span> A, <span class="hljs-type"><span class="hljs-type">float</span></span> B, <span class="hljs-type"><span class="hljs-type">float</span></span> C, <span class="hljs-type"><span class="hljs-type">float</span></span> D, <span class="hljs-type"><span class="hljs-type">float</span></span> E, <span class="hljs-type"><span class="hljs-type">float</span></span> F, float3 color, <span class="hljs-type"><span class="hljs-type">float</span></span> numMultiplier ) { float3 numerator = U2Func( A, B, C, D, E, F, color ); numerator = max( numerator, <span class="hljs-number"><span class="hljs-number">0</span></span> ); numerator.rgb *= numMultiplier; float3 denominator = U2Func( A, B, C, D, E, F, <span class="hljs-number"><span class="hljs-number">11.2</span></span> ); denominator = max( denominator, <span class="hljs-number"><span class="hljs-number">0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> numerator / denominator; } <span class="hljs-type"><span class="hljs-type">float4</span></span> ToneMappingPS( VS_OUTPUT_POSTFX <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>) : SV_Target0 { <span class="hljs-type"><span class="hljs-type">float</span></span> avgLuminance = TexAvgLuminance.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( int3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) ); avgLuminance = clamp( avgLuminance, cb3_v4.y, cb3_v4.z ); avgLuminance = max( avgLuminance, <span class="hljs-number"><span class="hljs-number">1e-4</span></span> ); <span class="hljs-type"><span class="hljs-type">float</span></span> scaledWhitePoint = cb3_v16.x * <span class="hljs-number"><span class="hljs-number">11.2</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> luma = avgLuminance / scaledWhitePoint; luma = pow( luma, cb3_v16.z ); luma = luma * scaledWhitePoint; luma = cb3_v16.x / luma; float3 HDRColor = TexHDRColor.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( uint3(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.Position.xy, <span class="hljs-number"><span class="hljs-number">0</span></span>) ).rgb; float3 color = ToneMapU2Func( cb3_v7.x, cb3_v7.y, cb3_v7.z, cb3_v8.x, cb3_v8.y, cb3_v8.z, luma*HDRColor, cb3_v16.y); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">float4</span></span>(color, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  рдЗрд╕рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореЗрд░реА рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9c/1e9/70a/f9c1e970a743cac54c9129261514c3e1.jpg"></div><br>  рджреЗрдЦрд╛! <br><br>  рдореЗрд░рд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ рдпрд╣ TW3 рдЯреЛрди рд╕реБрдзрд╛рд░ рдХрд╛ рдХрд╛рдлреА рд╕рдЯреАрдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИ, рдХрдо рд╕реЗ рдХрдо рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВред  рдореИрдВрдиреЗ рдЗрд╕реЗ рдкрд╣рд▓реЗ рд╣реА рдЕрдкрдиреЗ рдврд╛рдВрдЪреЗ рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░ рджрд┐рдпрд╛ рд╣реИ рдФрд░ рдпрд╣ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╣реИ! <br><br>  рдореИрдВрдиреЗ рдХрд╣рд╛ "рдкрд░реНрдпрд╛рдкреНрдд" рдХреНрдпреЛрдВрдХрд┐ рдореБрдЭреЗ <i>рдирд╣реАрдВ рдкрддрд╛ рд╣реИ</i> рдХрд┐ ToneMapU2Func рдореЗрдВ рд╣рд░ рдХреНрдпреЛрдВ рд╢реВрдиреНрдп рдкрд░ рдЕрдзрд┐рдХрддрдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред  0 рд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреЗ рд╕рдордп, рдЖрдкрдХреЛ рдЕрдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП? <br><br>  рдпрд╣ рд╕рдорд╛рдкреНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд▓рдЧрднрдЧ рджреБрд░реНрдШрдЯрдирд╛ рд╕реЗ рдореБрдЭреЗ рдЗрд╕ рдлреНрд░реЗрдо рдореЗрдВ TW3 рдЯреЛрди рд╢реЗрдбрд░ рдХрд╛ рдПрдХ рдФрд░ рд╕рдВрд╕реНрдХрд░рдг рдорд┐рд▓рд╛, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрдВрджрд░ рд╕реВрд░реНрдпрд╛рд╕реНрдд рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдиреНрдпреВрдирддрдо рдЧреНрд░рд╛рдлрд┐рдХреНрд╕ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ!) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/292/25b/bea/29225bbeae55c97c5a83e3461f7f24a7.jpg"></div><br>  рдЖрдЗрдП рдЗрд╕реЗ рджреЗрдЦреЗрдВред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, shader рдХреЗ рд▓рд┐рдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[18]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps_siv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">position</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 5 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ld_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[9]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[4]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[9]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000100</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000100</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>) 7: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ftou</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 14: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 15: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ld_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 16: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyz</span></span> 17: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 18: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[12]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[12]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 19: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 20: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 21: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span> 22: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 23: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyz</span></span> 24: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 25: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 26: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[12]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[12]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 27: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 28: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 29: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 30: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[11]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 31: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 32: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 33: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 34: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 35: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span> 36: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>) 37: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 38: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 39: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 40: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 41: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 42: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 43: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 44: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 45: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 46: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 47: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 48: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 49: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 50: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 51: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 52: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 53: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[8]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 54: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 55: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0) 56: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 57: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 58: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(11<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 59: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 60: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 61: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 62: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 63: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 64: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[13]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 65: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 66: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХреЛрдб рднрдпрднреАрдд рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╕рдм рдХреБрдЫ рдЗрддрдирд╛ рдмреБрд░рд╛ рдирд╣реАрдВ рд╣реИред  рдПрдХ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рдмрд╛рдж, рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ (рдПрдПрдл, рдорд┐рдирдЯ / рдЕрдзрд┐рдХрддрдо рдЪрдордХ ...) рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕реЗрдЯреЛрдВ рдХреЗ рд╕рд╛рде Uncharted2 рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рджреЛ рдХреЙрд▓ рд╣реИрдВред  рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рдХрднреА рдРрд╕рд╛ рдлреИрд╕рд▓рд╛ рдирд╣реАрдВ рджреЗрдЦрд╛ред <br><br>  рдФрд░ рдПрдЪрдПрд▓рдПрд╕рдПрд▓: <br><br><pre> <code class="hljs pgsql"> cbuffer cBuffer : register (b3) { <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v0; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v1; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v2; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v3; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v4; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v5; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v6; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v7; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v8; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v9; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v10; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v11; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v12; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v13; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v14; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v15; <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v16, cb3_v17; } Texture2D TexHDRColor : register (t0); Texture2D TexAvgLuminance : register (t1); float3 U2Func( <span class="hljs-type"><span class="hljs-type">float</span></span> A, <span class="hljs-type"><span class="hljs-type">float</span></span> B, <span class="hljs-type"><span class="hljs-type">float</span></span> C, <span class="hljs-type"><span class="hljs-type">float</span></span> D, <span class="hljs-type"><span class="hljs-type">float</span></span> E, <span class="hljs-type"><span class="hljs-type">float</span></span> F, float3 x ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F)) - E/F; } float3 ToneMapU2Func( <span class="hljs-type"><span class="hljs-type">float</span></span> A, <span class="hljs-type"><span class="hljs-type">float</span></span> B, <span class="hljs-type"><span class="hljs-type">float</span></span> C, <span class="hljs-type"><span class="hljs-type">float</span></span> D, <span class="hljs-type"><span class="hljs-type">float</span></span> E, <span class="hljs-type"><span class="hljs-type">float</span></span> F, float3 color, <span class="hljs-type"><span class="hljs-type">float</span></span> numMultiplier ) { float3 numerator = U2Func( A, B, C, D, E, F, color ); numerator = max( numerator, <span class="hljs-number"><span class="hljs-number">0</span></span> ); numerator.rgb *= numMultiplier; float3 denominator = U2Func( A, B, C, D, E, F, <span class="hljs-number"><span class="hljs-number">11.2</span></span> ); denominator = max( denominator, <span class="hljs-number"><span class="hljs-number">0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> numerator / denominator; } struct VS_OUTPUT_POSTFX { <span class="hljs-type"><span class="hljs-type">float4</span></span> Position : SV_Position; }; <span class="hljs-type"><span class="hljs-type">float</span></span> getExposure(<span class="hljs-type"><span class="hljs-type">float</span></span> avgLuminance, <span class="hljs-type"><span class="hljs-type">float</span></span> minLuminance, <span class="hljs-type"><span class="hljs-type">float</span></span> maxLuminance, <span class="hljs-type"><span class="hljs-type">float</span></span> middleGray, <span class="hljs-type"><span class="hljs-type">float</span></span> powParam) { avgLuminance = clamp( avgLuminance, minLuminance, maxLuminance ); avgLuminance = max( avgLuminance, <span class="hljs-number"><span class="hljs-number">1e-4</span></span> ); <span class="hljs-type"><span class="hljs-type">float</span></span> scaledWhitePoint = middleGray * <span class="hljs-number"><span class="hljs-number">11.2</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> luma = avgLuminance / scaledWhitePoint; luma = pow( luma, powParam); luma = luma * scaledWhitePoint; <span class="hljs-type"><span class="hljs-type">float</span></span> exposure = middleGray / luma; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exposure; } <span class="hljs-type"><span class="hljs-type">float4</span></span> ToneMappingPS( VS_OUTPUT_POSTFX <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>) : SV_Target0 { <span class="hljs-type"><span class="hljs-type">float</span></span> avgLuminance = TexAvgLuminance.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( int3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) ); <span class="hljs-type"><span class="hljs-type">float</span></span> exposure1 = getExposure( avgLuminance, cb3_v9.y, cb3_v9.z, cb3_v17.x, cb3_v17.z); <span class="hljs-type"><span class="hljs-type">float</span></span> exposure2 = getExposure( avgLuminance, cb3_v4.y, cb3_v4.z, cb3_v16.x, cb3_v16.z); float3 HDRColor = TexHDRColor.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( uint3(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.Position.xy, <span class="hljs-number"><span class="hljs-number">0</span></span>) ).rgb; float3 color1 = ToneMapU2Func( cb3_v11.x, cb3_v11.y, cb3_v11.z, cb3_v12.x, cb3_v12.y, cb3_v12.z, exposure1*HDRColor, cb3_v17.y); float3 color2 = ToneMapU2Func( cb3_v7.x, cb3_v7.y, cb3_v7.z, cb3_v8.x, cb3_v8.y, cb3_v8.z, exposure2*HDRColor, cb3_v16.y); float3 finalColor = lerp( color2, color1, cb3_v13.x ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">float4</span></span>(finalColor, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  рдпрд╣реА рд╣реИ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдирд┐рдпрдВрддреНрд░рдг рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рджреЛ рд╕реЗрдЯ рд╣реИрдВ, рд╣рдо рдЯреЛрди рд╕реБрдзрд╛рд░ рдХреЗ рд╕рд╛рде рджреЛ рд░рдВрдЧреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЕрдВрдд рдореЗрдВ рд╣рдо рдЙрдиреНрд╣реЗрдВ рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╕реНрдорд╛рд░реНрдЯ рдирд┐рд░реНрдгрдп! <br><br><h2>  рднрд╛рдЧ 2: рдЖрдБрдЦ рдЕрдиреБрдХреВрд▓рди </h2><br>  рджреВрд╕рд░рд╛ рднрд╛рдЧ рдЬреНрдпрд╛рджрд╛ рд╕рд░рд▓ рд╣реЛрдЧрд╛ред <br><br>  рдкрд╣рд▓реЗ рднрд╛рдЧ рдореЗрдВ, рдореИрдВрдиреЗ рджрд┐рдЦрд╛рдпрд╛ рдХрд┐ TW3 рдореЗрдВ рддрд╛рдирд╡рд╛рд▓рд╛ рд╕реБрдзрд╛рд░ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рдкреГрд╖реНрдарднреВрдорд┐ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддреЗ рд╣реБрдП, рдореИрдВрдиреЗ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдЖрдВрдЦ рдХреЗ рдЕрдиреБрдХреВрд▓рди рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ред  рдФрд░ рдЖрдкрдХреЛ рдкрддрд╛ рд╣реИ рдХреНрдпрд╛?  рдЗрд╕ рднрд╛рдЧ рдореЗрдВ рдореИрдВ рдмрд╛рдд рдХрд░реВрдВрдЧрд╛ рдХрд┐ рдЖрдВрдЦ рдХреЗ рдЗрд╕ рдЕрдиреБрдХреВрд▓рди рдХреЛ рдХреИрд╕реЗ рдорд╣рд╕реВрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рд▓реЗрдХрд┐рди рд░реБрдХрд┐рдП, рдЖрдВрдЦ рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдХреНрдпрд╛ рд╣реИ рдФрд░ рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рдХрд┐рдкреАрдбрд┐рдпрд╛</a> рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рдм рдХреБрдЫ рдЬрд╛рдирддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ рд╕рдордЭрд╛рддрд╛ рд╣реВрдВ: рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдЖрдк рдПрдХ рдЕрдВрдзреЗрд░реЗ рдХрдорд░реЗ рдореЗрдВ рд╣реИрдВ (рдпрд╛рдж рд░рдЦреЗрдВ рдЬреАрд╡рди рдЕрдЬреАрдм рд╣реИ) рдпрд╛ рдПрдХ рдЧреБрдлрд╛ рдореЗрдВ, рдФрд░ рдЬрд╣рд╛рдВ рдпрд╣ рдкреНрд░рдХрд╛рд╢ рд╣реИ, рд╡рд╣рд╛рдВ рдмрд╛рд╣рд░ рдЬрд╛рдПрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд░реЛрд╢рдиреА рдХрд╛ рдореБрдЦреНрдп рд╕реНрд░реЛрдд рд╕реВрд░рдЬ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдЕрдВрдзреЗрд░реЗ рдореЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рджреНрдпрд╛рд░реНрдерд┐рдпреЛрдВ рдХреЛ рдкрддрд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЕрдзрд┐рдХ рдкреНрд░рдХрд╛рд╢ рдЙрдирдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░реЗрдЯрд┐рдирд╛ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░реЗред  рдЬрдм рдпрд╣ рд╣рд▓реНрдХрд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдорд╛рд░реЗ рд╢рд┐рд╖реНрдп рдХрдо рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдХрднреА-рдХрднреА рд╣рдо рдЕрдкрдиреА рдЖрдБрдЦреЗрдВ рдмрдВрдж рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ "рджрд░реНрдж" рд╣реЛрддрд╛ рд╣реИред <br><br>  рдпрд╣ рдкрд░рд┐рд╡рд░реНрддрди рддреБрд░рдиреНрдд рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред  рдЖрдВрдЦ рдХреЛ рдЪрдордХ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХреЗ рдЕрдиреБрдХреВрд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рд╣рдо рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдкреНрд░рддрд┐рдкрд╛рджрди рдореЗрдВ рдЖрдВрдЦ рдЕрдиреБрдХреВрд▓рди рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдЬрдм рдЖрдВрдЦ рдЕрдиреБрдХреВрд▓рди рдХреА рдХрдореА рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕рдХрд╛</a> рдПрдХ рдЕрдЪреНрдЫрд╛ рдЙрджрд╛рд╣рд░рдг рдбрд╛рдпрд░реЗрдХреНрдЯрдПрдХреНрд╕ рдПрд╕рдбреАрдХреЗ рдХрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдЪрдбреАрдЖрд░рдЯреЛрди рдореИрдкрд┐рдВрдЧрд╕реАрдПрд╕ 11</a> рд╣реИред  рдордзреНрдпрдо рдЪрдордХ рдХреЗ рддреАрд╡реНрд░ рдкрд░рд┐рд╡рд░реНрддрди рдмрд▓реНрдХрд┐ рдЕрдкреНрд░рд┐рдп рдФрд░ рдЕрдкреНрд░рд╛рдХреГрддрд┐рдХ рд╣реИрдВред <br><br>  рдЪрд▓реЛ рд╢реБрд░реВ рд╣реЛ рдЬрд╛рдУ!  рд╕рдВрдЧрддрд┐ рдХреЗ рд▓рд┐рдП, рд╣рдо рдиреЛрд╡рд┐рдЧреНрд░рд╛рдж рд╕реЗ рдПрдХ рд╣реА рдлреНрд░реЗрдо рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВрдЧреЗред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/406/c2d/e21/406c2de21d4e934e0f25d0e6331fd272.jpg"></div><br>  рдЕрдм рд╣рдо рдлреНрд░реЗрдо рдХреИрдкреНрдЪрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо RenderDoc рдореЗрдВ рдЧрд╣рд░рд╛рдИ рд╕реЗ рдЬрд╛рдПрдВрдЧреЗред  рдЖрдВрдЦ рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдЖрдорддреМрд░ рдкрд░ рддрд╛рдирд╡рд╛рд▓рд╛ рд╕реБрдзрд╛рд░ рд╕реЗ рдареАрдХ рдкрд╣рд▓реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдж рд╡рд┐рдЪрд░ 3 рдХреЛрдИ рдЕрдкрд╡рд╛рдж рдирд╣реАрдВ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ed/fde/eec/8edfdeeec29fef781801b94948c90e6f.png"></div><br>  рдЖрдЗрдП рдкрд┐рдХреНрд╕реЗрд▓ рд╢реИрдбрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рджреЗрдЦреЗрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e68/2fd/2f4/e682fd2f410f32eb8661c2476c8a2294.jpg"></div><br>  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рджреЛ рдЗрдирдкреБрдЯ рд╕реНрд░реЛрдд рд╣реИрдВ - 2 рдмрдирд╛рд╡рдЯ, R32_FLOAT, 1x1 (рдПрдХ рдкрд┐рдХреНрд╕реЗрд▓)ред  рдмрдирд╛рд╡рдЯ 0 рдореЗрдВ рдкрд┐рдЫрд▓реЗ рдлреНрд░реЗрдо рд╕реЗ рджреГрд╢реНрдп рдХреА рдФрд╕рдд рдЪрдордХ рд╣реЛрддреА рд╣реИред  рдмрдирд╛рд╡рдЯ 1 рдореЗрдВ рд╡рд░реНрддрдорд╛рди рдлреНрд░реЗрдо рд╕реЗ рджреГрд╢реНрдп рдХреА рдФрд╕рдд рдЪрдордХ рд╢рд╛рдорд┐рд▓ рд╣реИ (рдЧрдгрдирд╛ рдЗрд╕ рдХрдВрдкрдХрдВрдкреА рд╕реЗ рдареАрдХ рдкрд╣рд▓реЗ - рдореИрдВрдиреЗ рдЗрд╕реЗ рдиреАрд▓реЗ рд░рдВрдЧ рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рд╣реИ)ред <br><br>  рдпрд╣ рдЕрдкреЗрдХреНрд╖рд┐рдд рд╣реИ рдХрд┐ рдПрдХ рдЖрдЙрдЯрдкреБрдЯ рд╣реИ - R32_FLOAT, 1x1ред  рдЪрд▓реЛ рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЛ рджреЗрдЦреЗрдВред <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_sampler</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mode_default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_sampler</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mode_default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 1 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">t1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0, 0, 0, 0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yxzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ge</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">movc</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span> 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br>  рд╡рд╛рд╣, рдХрд┐рддрдирд╛ рд╕рд░рд▓ рд╣реИ!  рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреА рдХреЗрд╡рд▓ 7 рд▓рд╛рдЗрдиреЗрдВред  рдпрд╣рд╛рдБ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ?  рдореИрдВ рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░реВрдВрдЧрд╛: <br><br>  0) рд╡рд░реНрддрдорд╛рди рдлреНрд░реЗрдо рдХреА рдФрд╕рдд рдЪрдордХ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред <br>  1) рдкрд┐рдЫрд▓реЗ рдлреНрд░реЗрдо рдХреА рдФрд╕рдд рдЪрдордХ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред <br>  2) рдПрдХ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ: рдХреНрдпрд╛ рд╡рд░реНрддрдорд╛рди рдЪрдордХ рдкрд┐рдЫрд▓реЗ рдлреНрд░реЗрдо рдХреА рдЪрдордХ рд╕реЗ рдХрдо рдпрд╛ рдмрд░рд╛рдмрд░ рд╣реИ? <br>  рдпрджрд┐ рд╣рд╛рдБ, рддреЛ рдЪрдордХ рдХрдо рд╣реЛ рдЬрд╛рддреА рд╣реИ, рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдЪрдордХ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред <br>  3) рдЕрдВрддрд░ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ: <i>рдЕрдВрддрд░ = currentLum - рдкреВрд░реНрд╡рд╡рд░реНрддреАред</i> <br>  4) рдпрд╣ рд╕рд╢рд░реНрдд рд╕реНрдерд╛рдирд╛рдВрддрд░рдг (movc) рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ рдЧрддрд┐ рдХрд╛рд░рдХ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдЪреЗрдХ рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рд▓рд╛рдЗрди 2 рд╕реЗ рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдорд╛рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рдПрдХ рд╕реНрдорд╛рд░реНрдЯ рдЪрд╛рд▓ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рддрд░рд╣ рдЖрдк рдХрдо рдЪрдордХ рдФрд░ рдмрдврд╝рддреА рдЪрдордХ рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЕрдиреБрдХреВрд▓рди рдЧрддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЕрдзреНрдпрдпрди рдХрд┐рдП рдЧрдП рдлреНрд░реЗрдо рдореЗрдВ, рджреЛрдиреЛрдВ рдореВрд▓реНрдп рд╕рдорд╛рди рд╣реИрдВ рдФрд░ 0.11 рд╕реЗ 0.3 рддрдХ рднрд┐рдиреНрди рд╣реИрдВред <br>  5) рдЕрдиреБрдХреВрд▓рд┐рдд рдЪрдордХ рдХреА рдЕрдВрддрд┐рдо рдЧрдгрдирд╛: рд░реВрдкрд╛рдВрддрд░рд┐рдд- <i>рдЧрддрд┐ = рдЧрддрд┐-рд╕рдВрд╡рд╛рд╣рдХ * рдЕрдВрддрд░ + рдкреВрд░реНрд╡рд╡рд░реНрддреАред</i> <br>  6) shader рдХрд╛ рдЕрдВрдд <br><br>  рдпрд╣ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдореЗрдВ рдХрд╛рдлреА рд╕рд░рд▓рддрд╛ рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: <br><br><pre> <code class="hljs pgsql"> // The Witcher <span class="hljs-number"><span class="hljs-number">3</span></span> eye adaptation shader cbuffer cBuffer : register (b3) { <span class="hljs-type"><span class="hljs-type">float4</span></span> cb3_v0; } struct VS_OUTPUT_POSTFX { <span class="hljs-type"><span class="hljs-type">float4</span></span> Position : SV_Position; }; SamplerState samplerPointClamp : register (s0); SamplerState samplerPointClamp2 : register (s1); Texture2D TexPreviousAvgLuminance : register (t0); Texture2D TexCurrentAvgLuminance : register (t1); <span class="hljs-type"><span class="hljs-type">float4</span></span> TW3_EyeAdaptationPS(VS_OUTPUT_POSTFX <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>) : SV_TARGET { // <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> previous luminance. <span class="hljs-type"><span class="hljs-type">float</span></span> currentAvgLuminance = TexCurrentAvgLuminance.SampleLevel( samplerPointClamp2, float2(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span> ); <span class="hljs-type"><span class="hljs-type">float</span></span> previousAvgLuminance = TexPreviousAvgLuminance.SampleLevel( samplerPointClamp, float2(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span> ); // Difference <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> previous luminance. <span class="hljs-type"><span class="hljs-type">float</span></span> difference = currentAvgLuminance - previousAvgLuminance; // Scale factor. Can be different <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">both</span></span> falling down <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> rising up <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> luminance. // It affects speed <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> adaptation. // Small conditional test <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> performed here, so different speed can be <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> differently <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">both</span></span> these cases. <span class="hljs-type"><span class="hljs-type">float</span></span> adaptationSpeedFactor = (currentAvgLuminance &lt;= previousAvgLuminance) ? cb3_v0.x : cb3_v0.y; // Calculate adapted luminance. <span class="hljs-type"><span class="hljs-type">float</span></span> adaptedLuminance = adaptationSpeedFactor * difference + previousAvgLuminance; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adaptedLuminance; }</code> </pre> <br>  рдпреЗ рд▓рд╛рдЗрдиреЗрдВ рд╣рдореЗрдВ рд╕рдорд╛рди рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рджреЗрддреА рд╣реИрдВред  рдореИрдВ рдХреЗрд╡рд▓ <i>рдлреНрд▓реЛрдЯ 4 рдХреЗ</i> рд╕рд╛рде рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ <i>рдлреНрд▓реЛрдЯ рдХреЗ</i> рд╕рд╛рде рдмрджрд▓рдиреЗ рдХрд╛ рд╕реБрдЭрд╛рд╡ <i>рджреВрдВрдЧрд╛</i> ред  рдмреИрдВрдбрд╡рд┐рдбреНрде рдХреА рдмрд░реНрдмрд╛рджреА рдХреА рдХреЛрдИ рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред  рдпрд╣ рд╣реИ рдХрд┐ рдХреИрд╕реЗ Witcher 3 рдЖрдВрдЦ рдЕрдиреБрдХреВрд▓рди рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред  рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ, рд╣реИ рдирд╛? <br><br>  рдкреБрдирд╢реНрдЪред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрд╛рд▓реНрдбрд░</a> рдХрд╛рд░реНрд▓рд╕рди (рдЯреНрд╡рд┐рдЯрд░: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">@baldurk</a> ) рдХреЛ рд░реЗрдВрдбрд░рдбреЛрдХ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдзрдиреНрдпрд╡рд╛рджред  рдХрд╛рд░реНрдпрдХреНрд░рдо рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╣реИред <br><br><h2>  рднрд╛рдЧ 3: рд░рдВрдЧреАрди рд╡рд┐рдкрдерди </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреНрд░реЛрдорд┐рдпрдо рдЕрдкрдШрдЯрди</a> рдПрдХ рдкреНрд░рднрд╛рд╡ рд╣реИ рдЬреЛ рдореБрдЦреНрдпрддрдГ рд╕рд╕реНрддреЗ рд▓реЗрдВрд╕ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд▓реЗрдВрд╕ рдореЗрдВ рджреГрд╢реНрдп рдкреНрд░рдХрд╛рд╢ рдХреА рд╡рд┐рднрд┐рдиреНрди рд▓рдВрдмрд╛рдИ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЕрдкрд╡рд░реНрддрдХ рд╕реВрдЪрдХ рд╣реЛрддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдПрдХ рджреГрд╢реНрдп рд╡рд┐рдХреГрддрд┐ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рд░ рдХреЛрдИ рдЗрд╕реЗ рдкрд╕рдВрдж рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдЪреБрдбрд╝реИрд▓ 3 рдореЗрдВ рдпрд╣ рдкреНрд░рднрд╛рд╡ рдмрд╣реБрдд рд╕реВрдХреНрд╖реНрдо рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЧреЗрдордкреНрд▓реЗ (рдореБрдЭреЗ, рдХрдо рд╕реЗ рдХрдо) рдореЗрдВ рдкрд░реЗрд╢рд╛рди рдирд╣реАрдВ рдХрд░рдирд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ рдЗрд╕реЗ рдмрдВрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЖрдЗрдП рдПрдХ рджреГрд╢реНрдп рдХреЗ рдЙрджрд╛рд╣рд░рдг рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ рдЬрд┐рд╕рдореЗрдВ рд░рдВрдЧреАрди рд╡рд┐рдкрдерди рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдмрд┐рдирд╛: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a5e/078/853/a5e0788530c688f849013ff3ed64134f.png"></div><br>  <i>рд░рдВрдЧреАрди рд╡рд┐рдкрдерди рд╢рд╛рдорд┐рд▓ рд╣реИ</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d8d/20f/ee7/d8d20fee7a901301b9f2e5f67a2f56be.png"></div><br>  <i>рдХреНрд░реЛрдореЗрдЯрд┐рдХ рдЕрдкрдШрдЯрди рдЕрдХреНрд╖рдо</i> <br><br>  рдХреНрдпрд╛ рдЖрдкрдХреЛ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдкрд╛рд╕ рдХреЛрдИ рдЕрдВрддрд░ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ?  рдореБрдЭреЗ рди рддреЛред  рдЪрд▓рд┐рдП рдПрдХ рдФрд░ рд╕реАрди рдЖрдЬрдорд╛рддреЗ рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cff/9a3/b41/cff9a3b41c135e4c43cd3065328dc235.png"></div><br>  <i>рд░рдВрдЧреАрди рд╡рд┐рдкрдерди рд╢рд╛рдорд┐рд▓ рд╣реИред</i>  <i>рд╕рдВрдХреЗрддрд┐рдд рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдорд╛рдореВрд▓реА "рд▓рд╛рд▓" рд╡рд┐рд░реВрдкрдг рдХреА рд╕реВрдЪрдирд╛ рджреЗрдВред</i> <br><br>  рд╣рд╛рдБ, рдмрд╣реБрдд рдмреЗрд╣рддрд░!  рдпрд╣рд╛рдВ рдЕрдВрдзреЗрд░реЗ рдФрд░ рд╣рд▓реНрдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░ рдЕрдзрд┐рдХ рдордЬрдмреВрдд рд╣реИ, рдФрд░ рдХреЛрдиреЗ рдореЗрдВ рд╣рдореЗрдВ рдереЛрдбрд╝реА рд╡рд┐рдХреГрддрд┐ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдкреНрд░рднрд╛рд╡ рдмрд╣реБрдд рдХрдордЬреЛрд░ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдореИрдВ рд╕реЛрдЪ рд░рд╣рд╛ рдерд╛ рдХрд┐ рдЗрд╕реЗ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рдмрд╕реЗ рдЬрд┐рдЬреНрдЮрд╛рд╕реБ рднрд╛рдЧ рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВ: рдХреЛрдб! <br><br>  <b>рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди</b> <br><br>  рдкрд╣рд▓реА рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЗ рд╕рд╛рде рд╕рд╣реА рдбреНрд░реЙ рдХреЙрд▓ рд▓рдЧрддрд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд░рдВрдЧреАрди рд╡рд┐рдкрдерди рдмрдбрд╝реЗ "рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ" рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХреНрд░реЛрдореИрдЯрд┐рдХ рдПрдмреНрд░реЗрд╢рди, рд╡рд┐рдЧреНрдирд┐рдЯрд┐рдВрдЧ рдФрд░ рдЧрд╛рдорд╛ рд╕реБрдзрд╛рд░ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  рдпрд╣ рд╕рдм рдПрдХ рдПрдХрд▓ рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЗ рдЕрдВрджрд░ рд╣реИред  рдЪрд▓реЛ рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЗ рд▓рд┐рдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдкрд░ рдХрд░реАрдм рд╕реЗ рдирдЬрд╝рд░ рдбрд╛рд▓рддреЗ рд╣реИрдВ: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[18]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_sampler</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mode_default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps_siv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">position</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">linear</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 4 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxy</span></span> 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxy</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sqrt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul_sat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 7: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">lt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">if_nz</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[16]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">max</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000100</span></span>) 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 14: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span> 15: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzw</span></span> 16: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 17: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 18: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[17]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 19: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0) 20: <span class="hljs-selector-tag"><span class="hljs-selector-tag">endif</span></span> ...</code> </pre> <br>  рдФрд░ рдХрдлрд╝рди рдореВрд▓реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d9/e1d/6b6/7d9e1d6b60039074712ea0e60dba2ae0.jpg"></div><br>  рддреЛ, рдЖрдЗрдП рд╕рдордЭрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдХрд┐ рдпрд╣рд╛рдВ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, cb3_v17.xy рдЧреБрдгрд╛рддреНрдордХ рд╡рд┐рдкрдерди рдХрд╛ рдХреЗрдВрджреНрд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдЯреЗрдХреНрд╕рд▓ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╕реЗ 2d рд╡реЗрдХреНрдЯрд░ рдХреА рдЧрдгрдирд╛ рдХрд░рддреА рд╣реИрдВ (cb3_v17.zw = рд╡реНрдпреВрдкреЛрд░реНрдЯ рд╕рд╛рдЗрдЬрд╝ рдХрд╛ рдкрд╛рд░рд╕реНрдкрд░рд┐рдХ) "рд╡рд░реНрдгрд┐рдХ рд╡рд┐рдкрдерди рдХреЗ рдХреЗрдВрджреНрд░" рдФрд░ рдЗрд╕рдХреА рд▓рдВрдмрд╛рдИ, рдлрд┐рд░ рдЕрдиреНрдп рдЧрдгрдирд╛, рд╕рддреНрдпрд╛рдкрди рдФрд░ рдмреНрд░рд╛рдВрдЪрд┐рдВрдЧ рдХрд░рддреЗ рд╣реИрдВред ред  рд░рдВрдЧреАрди рд╡рд┐рдкрдерди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╕рдордп, рд╣рдо рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ рдХреБрдЫ рдореВрд▓реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╕реНрдерд╛рдкрди рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЪреИрдирд▓реЛрдВ рдХреЛ рдЖрд░ рдФрд░ рдЬреА рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рддреЗ рд╣реИрдВред рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рд╕реНрдХреНрд░реАрди рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдХрд░реАрдм, рдкреНрд░рднрд╛рд╡ рдЬрд┐рддрдирд╛ рдордЬрдмреВрдд рд╣реЛрддрд╛ рд╣реИред  рд▓рд╛рдЗрди 10 рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкрд┐рдХреНрд╕рд▓ рдХреЛ "рдХрд░реАрдм" рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ, рдЦрд╛рд╕рдХрд░ рдЬрдм рд╣рдо рд╡рд┐рдкрдерди рдХреЛ рдЕрддрд┐рд░рдВрдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдореИрдВ рдЕрдкрдиреЗ рдкреНрд░рднрд╛рд╡ рдХрд╛ рдЕрд╣рд╕рд╛рд╕ рдЖрдкрдХреЗ рд╕рд╛рде рд╕рд╣рд░реНрд╖ рд╕рд╛рдЭрд╛ рдХрд░реВрдВрдЧрд╛ред  рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рд╕рдВрд╢рдпрд╡рд╛рдж рдХреЗ рдПрдХ (рдареЛрд╕) рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд╕рд╛рде рдЪрд░ рдирд╛рдо рд▓реЗрдВред  рдФрд░ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкреНрд░рднрд╛рд╡ рдЧрд╛рдорд╛ рд╕реБрдзрд╛рд░ <i>рд╕реЗ рдкрд╣рд▓реЗ</i> рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> ChromaticAberration( float2 uv, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> float3 color ) { // <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>-defined params float2 chromaticAberrationCenter = float2(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> chromaticAberrationCenterAvoidanceDistance = <span class="hljs-number"><span class="hljs-number">0.2</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> fA = <span class="hljs-number"><span class="hljs-number">1.25</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> fChromaticAbberationIntensity = <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> fChromaticAberrationDistortionSize = <span class="hljs-number"><span class="hljs-number">0.75</span></span>; // Calculate vector float2 chromaticAberrationOffset = uv - chromaticAberrationCenter; chromaticAberrationOffset = chromaticAberrationOffset / chromaticAberrationCenter; <span class="hljs-type"><span class="hljs-type">float</span></span> chromaticAberrationOffsetLength = length(chromaticAberrationOffset); // <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> avoid applying chromatic aberration <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> center, subtract small <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> // just calculated length. <span class="hljs-type"><span class="hljs-type">float</span></span> chromaticAberrationOffsetLengthFixed = chromaticAberrationOffsetLength - chromaticAberrationCenterAvoidanceDistance; <span class="hljs-type"><span class="hljs-type">float</span></span> chromaticAberrationTexel = saturate(chromaticAberrationOffsetLengthFixed * fA); <span class="hljs-type"><span class="hljs-type">float</span></span> fApplyChromaticAberration = (<span class="hljs-number"><span class="hljs-number">0.0</span></span> &lt; chromaticAberrationTexel); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fApplyChromaticAberration) { chromaticAberrationTexel *= chromaticAberrationTexel; chromaticAberrationTexel *= fChromaticAberrationDistortionSize; chromaticAberrationOffsetLength = max(chromaticAberrationOffsetLength, <span class="hljs-number"><span class="hljs-number">1e-4</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> fMultiplier = chromaticAberrationTexel / chromaticAberrationOffsetLength; chromaticAberrationOffset *= fMultiplier; chromaticAberrationOffset *= g_Viewport.zw; chromaticAberrationOffset *= fChromaticAbberationIntensity; float2 offsetUV = -chromaticAberrationOffset * <span class="hljs-number"><span class="hljs-number">2</span></span> + uv; color.r = TexColorBuffer.SampleLevel(samplerLinearClamp, offsetUV, <span class="hljs-number"><span class="hljs-number">0</span></span>).r; offsetUV = uv - chromaticAberrationOffset; color.g = TexColorBuffer.SampleLevel(samplerLinearClamp, offsetUV, <span class="hljs-number"><span class="hljs-number">0</span></span>).g; } }</code> </pre> <br>  рдореИрдВрдиреЗ рдСрдлрд╕реЗрдЯ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП "fChromaticAberrationIntensity" рдХреЛ рдЬреЛрдбрд╝рд╛, рдФрд░ рдЗрд╕рд▓рд┐рдП рдкреНрд░рднрд╛рд╡ рдХреА рддрд╛рдХрдд, рдЬреИрд╕рд╛ рдХрд┐ рдирд╛рдо рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ (TW3 = 1.0)ред  рддреАрд╡реНрд░рддрд╛ = 40: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/864/69e/aea/86469eaea28862b558fa90784b8c4585.png"></div><br>  рд╡рд╣ рд╕рдм рд╣реИ!  рдЖрд╢рд╛ рд╣реИ рдЖрдкрдХреЛ рдпрд╣ рд╣рд┐рд╕реНрд╕рд╛ рдЕрдЪреНрдЫрд╛ рд▓рдЧрд╛ рд╣реЛрдЧрд╛ <br><br><h2>  рднрд╛рдЧ 4: рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Vignetting</a> рдЦреЗрд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рдмрд╕реЗ рдЖрдо рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкреНрд░рднрд╛рд╡реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред  рд╡рд╣ рдлреЛрдЯреЛрдЧреНрд░рд╛рдлреА рдореЗрдВ рднреА рд▓реЛрдХрдкреНрд░рд┐рдп рд╣реИрдВред  рдереЛрдбрд╝рд╛ рдЫрд╛рдпрд╛рдВрдХрд┐рдд рдХреЛрдиреЗ рдПрдХ рд╕реБрдВрджрд░ рдкреНрд░рднрд╛рд╡ рдкреИрджрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдХрдИ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╡рд┐рдЧреНрдиреЗрдЯрд┐рдВрдЧ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="">рдЕрд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЗрдВрдЬрди 4</a> рдкреНрд░рд╛рдХреГрддрд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдж рд╡рд┐рдЪрд░ рдкрд░ рд╡рд╛рдкрд╕ 3. рд╡рд┐рдЧреНрдиреЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдФрд░ рдмрд┐рдирд╛ рдлреНрд░реЗрдо рдХреЗ рдЗрдВрдЯрд░реЗрдХреНрдЯрд┐рд╡ рддреБрд▓рдирд╛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ</a> ред  рддреБрд▓рдирд╛ рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Witcher 3 рдХреЗ рд▓рд┐рдП NVIDIA рдкреНрд░рджрд░реНрд╢рди рдЧрд╛рдЗрдб</a> рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b27/b52/986/b27b52986e845f39a32710276adc9fa8.png"></div><br>  <i>рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде "рдж рд╡рд┐рдЪрд░ 3" рдХрд╛ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдЪрд╛рд▓реВ рд╣реБрдЖред</i> <br><br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдКрдкрд░реА рдмрд╛рдПрдВ рдХреЛрдиреЗ (рдЖрдХрд╛рд╢) рдХреЛ рдЫрд╡рд┐ рдХреЗ рдЕрдиреНрдп рднрд╛рдЧреЛрдВ рдХреА рддрд░рд╣ рдЫрд╛рдпрд╛рдВрдХрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдмрд╛рдж рдореЗрдВ рд╣рдо рдЗрд╕ рдкрд░ рд▓реМрдЯ рдЖрдПрдВрдЧреЗред <br><br>  <b>рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд╛ рд╡рд┐рд╡рд░рдг</b> <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдж рд╡рд┐рдЪрд░ 3 рдХреЗ рдореВрд▓ рд╕рдВрд╕реНрдХрд░рдг (рдЬреЛ 19 рдордИ, 2015 рдХреЛ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛) рдФрд░ рдж рд╡рд┐рдЪрд░ 3: рдмреНрд▓рдб рдПрдВрдб рд╡рд╛рдЗрди рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ рдХреЗ рдмреАрдЪ рдереЛрдбрд╝рд╛ рдЕрдВрддрд░ рд╣реИред  рдкреВрд░реНрд╡ рдореЗрдВ, "рдЙрд▓рдЯрд╛ рдврд╛рд▓" рдХреА рдЧрдгрдирд╛ рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рдХреЗ рдЕрдВрджрд░ рдХреА рдЬрд╛рддреА рд╣реИ, рдФрд░ рдмрд╛рдж рдореЗрдВ, рдпрд╣ 256x256 2D рдмрдирд╛рд╡рдЯ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/455/0b4/c1d/4550b4c1d1a0ae80923cd75cd63c3e7f.jpg"></div><br>  рдмрдирд╛рд╡рдЯ 256x256, "рд░рдХреНрдд рдФрд░ рд╢рд░рд╛рдм рдХреЗ рдкреВрд░рдХ" рдореЗрдВ "рд░рд┐рд╡рд░реНрд╕ рдЧреНрд░реЗрдбрд┐рдПрдВрдЯ" рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдореИрдВ "рдмреНрд▓рдб рдПрдВрдб рд╡рд╛рдЗрди" (рдЬрд┐рд╕ рддрд░рд╣ рд╕реЗ, рдПрдХ рдорд╣рд╛рди рдЦреЗрд▓) рд╕реЗ shader рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛ред  рдЕрдзрд┐рдХрд╛рдВрд╢ рдЕрдиреНрдп рдЦреЗрд▓реЛрдВ рдХреА рддрд░рд╣, рдбрд╛рдпрди 3 рд╡рд┐рдЧреНрдирд┐рдЯрд┐рдВрдЧ рдХреА рдЧрдгрдирд╛ рдЕрдВрддрд┐рдо рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЗ рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рдореЗрдВ рдХреА рдЬрд╛рддреА рд╣реИред  рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ: <br><br><pre> <code class="hljs css"> ... 44: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 45: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.454545</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.454545</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.454545</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 46: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 47: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[9]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 48: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzwx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s2</span></span> 49: <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 50: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(2<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>, 2<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>, 2<span class="hljs-selector-class"><span class="hljs-selector-class">.200000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 51: <span class="hljs-selector-tag"><span class="hljs-selector-tag">exp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 52: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[6]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 53: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add_sat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 54: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[6]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 55: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul_sat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 56: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[9]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[7]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> 57: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzx</span></span> ...</code> </pre> <br>  рджрд┐рд▓рдЪрд╕реНрдк!  рдРрд╕рд╛ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЧрд╛рдорд╛ (рд▓рд╛рдЗрди 46) рдФрд░ рд░реИрдЦрд┐рдХ рд░рд┐рдХреНрдд рд╕реНрдерд╛рди (рд▓рд╛рдЗрди 51) рджреЛрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  48 рд░реЗрдЦрд╛ рдкрд░, рд╣рдо "рдЙрд▓рдЯрд╛ рдврд╛рд▓" рдХреА рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрддреЗ рд╣реИрдВред  cb3 [9] .xyz рд╡рд┐рдЧреНрдирдЯрд┐рдВрдЧ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ рд╣реИред  рдЬрд╛рдБрдЪ рдХрд┐рдП рдЧрдП рдкреНрд░рддреНрдпреЗрдХ рдлреНрд░реЗрдо рдореЗрдВ, рдЗрд╕реЗ рдлрд╝реНрд▓реЛрдЯ 3 (1.0, 1.0, 1.0) рдорд╛рди рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЕрд░реНрдерд╛рдд, рдпрд╣ рд╕рдВрднрд╡рддрдГ рдлрд╝реЗрдб-рдЗрди / рдлреЗрдб-рдЖрдЙрдЯ рдкреНрд░рднрд╛рд╡реЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдЕрдВрддрд┐рдо рдлрд╝рд┐рд▓реНрдЯрд░ рд╣реИред  TW3 рдореЗрдВ рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рддреАрди рдореБрдЦреНрдп рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВ: <br><br><ul><li>  рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ (cb3 [6] .w) - рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ рдХреА рддрд╛рдХрдд рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред  0 - рдХреЛрдИ рд╡рд┐рдЧреНрдирд┐рдЯрд┐рдВрдЧ рдирд╣реАрдВ, 1 - рдЕрдзрд┐рдХрддрдо рд╡рд┐рдЧреНрдирд┐рдЯрд┐рдВрдЧред  рдореЗрд░реЗ рдЕрд╡рд▓реЛрдХрдиреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдмреЗрд╕ рдж рд╡рд┐рдЪрд░ 3 рдореЗрдВ рдпрд╣ рд▓рдЧрднрдЧ 1.0 рд╣реИ, рдЬрдмрдХрд┐ рд░рдХреНрдд рдФрд░ рд╢рд░рд╛рдм рдореЗрдВ рдпрд╣ рд▓рдЧрднрдЧ 0.15 рд╣реИред </li><li>  рд░рдВрдЧ (cb3 [7] .xyz) - TW3 рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ рдХреА рдПрдХ рдЙрддреНрдХреГрд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛ рдЗрд╕рдХрд╛ рд░рдВрдЧ рдмрджрд▓рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИред  рдпрд╣ рдХрд╛рд▓рд╛ рд╣реЛрдирд╛ рдЬрд░реВрд░реА рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ ... рдЖрдорддреМрд░ рдкрд░ рдЗрд╕рдореЗрдВ рдлреНрд▓реЛрдЯ 3 (3.0 / 255.0, 4.0 / 255.0, 5.0 / 255.0) рдФрд░ рдЗрд╕реА рддрд░рд╣ рдХреЗ рдореВрд▓реНрдп рд╣реЛрддреЗ рд╣реИрдВ - рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдорд▓реЗ рдореЗрдВ, рдпреЗ 0.00392156 рдХреЗ рдЧреБрдгрдХ рд╣реЛрддреЗ рд╣реИрдВ - 1.0 рдпрд╛ 255.0 </li><li>  рд╡реЗрдЯ (cb3 [6] .xyz) рдПрдХ рдмрд╣реБрдд рд╣реА рджрд┐рд▓рдЪрд╕реНрдк рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИред  рдореИрдВрдиреЗ рд╣рдореЗрд╢рд╛ "рдлреНрд▓реИрдЯ" рд╡рд┐рдЧрдиреЗрдЯреНрд╕ рджреЗрдЦреЗ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a25/9e8/7f9/a259e87f9e5bbfc3edf6b4ff30aea90d.png"></div><br>  <i>рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ рдорд╛рд╕реНрдХ</i> <br><br>  рд▓реЗрдХрд┐рди рд╡рдЬрди (рд▓рд╛рдЗрди 52) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c0/c88/6c0/6c0c886c0175635ba609ef61e61b3ea3.png"></div><br>  <i>рднрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП TW3 рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ рдорд╛рд╕реНрдХ рдХреА рдЧрдгрдирд╛ рдХреА рдЧрдИ</i> <br><br>  рд╡рдЬрди 1.0 рдХреЗ рдХрд░реАрдм рд╣реИред  рд░рдХреНрдд рдФрд░ рд╡рд╛рдЗрди (рдЗрдВрджреНрд░рдзрдиреБрд╖ рдХреЗ рд╕рд╛рде рдПрдХ рдЬрд╛рджреБрдИ рджреБрдирд┐рдпрд╛) рд╕реЗ рдПрдХ рдлреНрд░реЗрдо рдХреЗ рд▓рд┐рдП рд╕реНрдерд┐рд░рд╛рдВрдХ рдмрдлрд░ рдбреЗрдЯрд╛ рдХреЛ рджреЗрдЦреЗрдВ: рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдКрдкрд░ рдХреЗ рдЖрдХрд╛рд╢ рдХреЗ рдЙрдЬреНрдЬреНрд╡рд▓ рдкрд┐рдХреНрд╕рд▓ рдХреЛ рд╡рд┐рдЧреНрдиреЗрдЯрд┐рдВрдЧ рдиреЗ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68a/2a9/9e5/68a2a99e54b0c8cf9e71561001315a34.png"></div><br>  <b>рдХреЛрдб</b> <br><br>  рдпрд╣рд╛рдВ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдкрд░ TW3 рд╡рд┐рдЧрдиреЗрдЯрд┐рдВрдЧ рдХрд╛ рдореЗрд░рд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИред <br><br>  рдЧрд╛рдорд╛рдЯреЙрдЗрд▓рд┐рдпрд░ = рдкрд╛рд╡ (рд░рдВрдЧ, 2.2) <br><br><pre> <code class="hljs pgsql"> <span class="hljs-comment"><span class="hljs-comment">/* // The Witcher 3 vignette. // // Input color is in gamma space // Output color is in gamma space as well. */</span></span> float3 Vignette_TW3( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float3 gammaColor, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float3 vignetteColor, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float3 vignetteWeights, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> vignetteOpacity, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Texture2D texVignette, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float2 texUV ) { // <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> coloring vignette float3 vignetteColorGammaSpace = -gammaColor + vignetteColor; // Calculate vignette amount based <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> color <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *LINEAR* color space <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> vignette weights. <span class="hljs-type"><span class="hljs-type">float</span></span> vignetteWeight = dot( GammaToLinear( gammaColor ), vignetteWeights ); // We need <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> keep vignette weight <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>] range vignetteWeight = saturate( <span class="hljs-number"><span class="hljs-number">1.0</span></span> - vignetteWeight ); // Multiply <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> opacity vignetteWeight *= vignetteOpacity; // Obtain vignette mask (here <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> texture; you can <span class="hljs-keyword"><span class="hljs-keyword">also</span></span> calculate your custom mask here) <span class="hljs-type"><span class="hljs-type">float</span></span> sampledVignetteMask = texVignette.Sample( samplerLinearClamp, texUV ).x; // Final (inversed) vignette mask <span class="hljs-type"><span class="hljs-type">float</span></span> finalInvVignetteMask = saturate( vignetteWeight * sampledVignetteMask ); // final composite <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> gamma space float3 Color = vignetteColorGammaSpace * finalInvVignetteMask + gammaColor.rgb; // * uncomment <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> vignette mask: // <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> - finalInvVignetteMask; // <span class="hljs-keyword"><span class="hljs-keyword">Return</span></span> final color <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Color; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдЕрдЪреНрдЫрд╛ рд▓рдЧрд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЖрдк рдореЗрд░реЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HLSLexplorer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛ рднреА рдЖрдЬрд╝рдорд╛ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">, рдЬрд┐рд╕рд╕реЗ рдореБрдЭреЗ HLSL рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдмрд╣реБрдд рдорджрдж рдорд┐рд▓реАред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рдХреА рддрд░рд╣, рд╕рдВрд╢рдпрд╡рд╛рдж рдХреА рдПрдХ рдбрд┐рдЧреНрд░реА рдХреЗ рд╕рд╛рде рдЪрд░ рдХреЗ рдирд╛рдо рд▓реЗ рд▓реЛ - TW3 рд╢реЗрдбреНрд╕ рдХреЛ D3DStripShader рджреНрд╡рд╛рд░рд╛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдореБрдЭреЗ рдЙрдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд▓рдЧрднрдЧ рдХреБрдЫ рднреА рдирд╣реАрдВ рдкрддрд╛ рд╣реИ, рдореИрдВ рдХреЗрд╡рд▓ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛ рд╕рдХрддрд╛ рд╣реВрдВред </font><font style="vertical-align: inherit;">); рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдореИрдВ рдЕрдкрдиреЗ рдЙрдкрдХрд░рдгреЛрдВ рдХрд┐ рд╢реЗрдбрд░ рдХреЛ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдХреНрд╖рддрд┐ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рднреА рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд╡рд╣рди рдирд╣реАрдВ рд╣реИ </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдврд╛рд▓ рдЧрдгрдирд╛: рдмреЛрдирд╕</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдмрдЬрд╛рдп precalculated рдмрдирд╛рд╡рдЯ рдирдореВрдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рдХреЗ, 2015 "рдЗрд╕ Witcher 3" рд░рд┐рд╡рд░реНрд╕ рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рдореЗрдВ рдЧрдгрдирд╛ рдХреА рдврд╛рд▓ рдореЗрдВ рдЬрд╛рд░реА рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ:</font></font><br><br><pre> <code class="hljs css"> 35: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.500000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.500000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 36: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 37: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sqrt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 38: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.550000</span></span>) 39: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul_sat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.219512</span></span>) 40: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 41: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span> 42: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.100000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.105000</span></span>, 1<span class="hljs-selector-class"><span class="hljs-selector-class">.120000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.090000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 43: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.940000</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдпрд╣ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИред </font><font style="vertical-align: inherit;">HLSL рдкрд░, рдпрд╣ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛:</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> TheWitcher3_2015_Mask( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> float2 uv ) { <span class="hljs-type"><span class="hljs-type">float</span></span> distanceFromCenter = length( uv - float2(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>) ); <span class="hljs-type"><span class="hljs-type">float</span></span> x = distanceFromCenter * <span class="hljs-number"><span class="hljs-number">2.0</span></span> - <span class="hljs-number"><span class="hljs-number">0.55</span></span>; x = saturate( x * <span class="hljs-number"><span class="hljs-number">1.219512</span></span> ); // <span class="hljs-number"><span class="hljs-number">1.219512</span></span> = <span class="hljs-number"><span class="hljs-number">100</span></span>/<span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> x2 = x * x; <span class="hljs-type"><span class="hljs-type">float</span></span> x3 = x2 * x; <span class="hljs-type"><span class="hljs-type">float</span></span> x4 = x2 * x2; <span class="hljs-type"><span class="hljs-type">float</span></span> outX = dot( <span class="hljs-type"><span class="hljs-type">float4</span></span>(x4, x3, x2, x), <span class="hljs-type"><span class="hljs-type">float4</span></span>(<span class="hljs-number"><span class="hljs-number">-0.10</span></span>, <span class="hljs-number"><span class="hljs-number">-0.105</span></span>, <span class="hljs-number"><span class="hljs-number">1.12</span></span>, <span class="hljs-number"><span class="hljs-number">0.09</span></span>) ); outX = min( outX, <span class="hljs-number"><span class="hljs-number">0.94</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outX; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рд╣рдо рдмрд╕ рдХреЗрдВрджреНрд░ рд╕реЗ рдХрдкрдбрд╝рд╛ рддрдХ рдХреА рджреВрд░реА рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд╕рд╛рде рдХреБрдЫ рдЬрд╛рджреВ рдХрд░рддреЗ рд╣реИрдВ (рдЧреБрдгрди, рд╕рдВрддреГрдкреНрдд ...), рдФрд░ рдлрд┐рд░ ... рдмрд╣реБрдкрдж рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ! </font><font style="vertical-align: inherit;">рдмрд╣реБрдд рдЦреВрдмред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/25d/79c/e67/25d79ce679f05a53946b475c6c152cc4.png"></div><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 5: рдирд╢рд╛ рдХрд╛ рдкреНрд░рднрд╛рд╡ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдХреИрд╕реЗ рдЦреЗрд▓ "рдж рд╡рд┐рдЪрд░ 3: рд╡рд╛рдЗрд▓реНрдб рд╣рдВрдЯ" рдирд╢реЗ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдкрдиреЗ рдЗрд╕реЗ рдЕрднреА рддрдХ рдирд╣реАрдВ рдЦреЗрд▓рд╛ рд╣реИ, </font></font><strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреЛ рд╕рдм рдХреБрдЫ рдЫреЛрдбрд╝ рджреЗрдВ, рдЦрд░реАрджреЗрдВ рдФрд░ рдЦреЗрд▓реЗрдВ,</font></font></strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рд╡реАрдбрд┐рдпреЛ рджреЗрдЦреЗрдВ: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╛рдо:</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Gy_B2V0QaqA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рд╛рдд: </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CXu3e7LWkjE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдПрдХ рджреЛрд╣рд░реА рдФрд░ рдШреВрдорддреА рд╣реБрдИ рдЫрд╡рд┐ рджреЗрдЦрддреЗ рд╣реИрдВ, рдЕрдХреНрд╕рд░ рдЬрдм рдЖрдк рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬреАрд╡рди рдореЗрдВ рдкреАрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЫрд╡рд┐ рдХреЗ рдХреЗрдВрджреНрд░ рд╕реЗ рдПрдХ рдкрд┐рдХреНрд╕реЗрд▓ рдХреЛ рджреВрд░, рд░реЛрдЯреЗрд╢рди рдкреНрд░рднрд╛рд╡ рдХреЛ рдордЬрдмреВрдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЬрд╛рдирдмреВрдЭрдХрд░ рд░рд╛рдд рдХреЗ рд╕рд╛рде рджреВрд╕рд░рд╛ рд╡реАрдбрд┐рдпреЛ рдкреЛрд╕реНрдЯ рдХрд┐рдпрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рддрд╛рд░реЛрдВ рдкрд░ рдЗрд╕ рд░реЛрдЯреЗрд╢рди рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ (8 рдЕрд▓рдЧ-рдЕрд▓рдЧ рдмрд┐рдВрджреБрдУрдВ рдХреЛ рджреЗрдЦреЗрдВ?) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд╢реЗ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХрд╛ рджреВрд╕рд░рд╛ рд╣рд┐рд╕реНрд╕рд╛, рдЬреЛ рддреБрд░рдВрдд рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд╝реВрдо рдореЗрдВ рдорд╛рдореВрд▓реА рдмрджрд▓рд╛рд╡ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХреЗрдВрджреНрд░ рдХреЗ рдкрд╛рд╕ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╢рд╛рдпрдж рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдпрд╣ рдкреНрд░рднрд╛рд╡ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ (рдкрд┐рдХреНрд╕реЗрд▓ shader) рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореЗрдВ рдЗрд╕рдХрд╛ рд╕реНрдерд╛рди рдЗрддрдирд╛ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдирд╢рд╛ рдХреЗ рдкреНрд░рднрд╛рд╡ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддрд╛рдирд▓ рд╕реБрдзрд╛рд░ рдХреЗ </font><font style="vertical-align: inherit;">рддреБрд░рдВрдд </font><i><font style="vertical-align: inherit;">рдмрд╛рдж</font></i><font style="vertical-align: inherit;"> рдФрд░ рдЧрддрд┐ рдзрдмреНрдмрд╛ рд╕реЗ рдкрд╣рд▓реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ ("рдирд╢реЗ рдореЗрдВ" рдЫрд╡рд┐ рдЧрддрд┐ рдзреБрдВрдзрд▓рд╛ рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рд╣реИ)ред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЦреЗрд▓ рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ: </font></font><br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_globalFlags</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">refactoringAllowed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb0</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_constantbuffer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[3]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">immediateIndexed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_sampler</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">mode_default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_resource_texture2d</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_input_ps_siv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">position</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dcl_temps</span></span> 8 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.100000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.050000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.050000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb0</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sqrt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span> 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(10<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">min</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 7: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span> 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 14: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span> 15: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(5<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 16: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span> 17: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 18: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 19: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 20: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 21: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 22: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 23: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 24: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 25: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 26: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 27: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 28: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 29: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 30: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 31: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 32: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 33: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 34: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 35: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 36: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>) 37: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span> 38: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 39: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 40: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 41: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span> 42: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 43: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 44: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 45: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 46: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzw</span></span> 47: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.707000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 48: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 49: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 50: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 51: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 52: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 53: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 54: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 55: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 56: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.062500</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 57: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(8<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 58: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 59: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.020000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 60: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxy</span></span> 61: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 62: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 63: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span> 64: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 2<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 65: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 66: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 67: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sample_indexable</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">texture2d</span></span>)(<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">t0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">s0</span></span> 68: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 69: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 70: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 71: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>) 72: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 73: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 74: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдирд┐рд░рдВрддрд░ рдмрдлрд╝рд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣рд╛рдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЖрдЗрдП рдЙрдирдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7e/ce2/eb8/d7ece2eb8b0acf421cffd93222dd6821.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/832/ef8/941/832ef8941e9b4b6a38ad24b0c2e84cfa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb0_v0.x -&gt; рдмреАрддрд╛ рд╣реБрдЖ рд╕рдордп (рд╕реЗрдХрдВрдб рдореЗрдВ) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb0_v1.xyzw - рд╡реНрдпреВрдкреЛрд░реНрдЯ рдХрд╛ рдЖрдХрд╛рд░ рдФрд░ рд╡реНрдпреВрдкреЛрд░реНрдЯ рдЖрдХрд╛рд░ (рдЙрд░реНрдл "рдкрд┐рдХреНрд╕реЗрд▓ рдЖрдХрд╛рд░") рдХреЗ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рд░рд╕реНрдкрд░рд┐рдХ: cb3_v0.x - рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреВрдордиреЗ рдкрд░, рд╣рдореЗрд╢рд╛ 1.0 рдХрд╛ рдорд╛рди рд╣реЛрддрд╛ рд╣реИред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb3_v0.y - рдирд╢рд╛ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреА рднрдпрд╛рд╡рд╣рддрд╛ред рдЗрд╕реЗ рдЪрд╛рд▓реВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдпрд╣ рдкреВрд░реА рддрд╛рдХрдд рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдзреАрд░реЗ-рдзреАрд░реЗ 0.0 рд╕реЗ 1.0 рддрдХ рдмрдврд╝ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cv3_v1.xy - рдкрд┐рдХреНрд╕реЗрд▓ рдСрдлрд╝рд╕реЗрдЯреНрд╕ (рдиреАрдЪреЗ рдЗрд╕ рдкрд░ рдФрд░ рдЕрдзрд┐рдХ)ред рдпрд╣ рдПрдХ рдкрд╛рдк / рдмреНрд░рд╣реНрдорд╛рдВрдб рдЬреЛрдбрд╝реА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ рдЖрдк shader рдореЗрдВ sincos (рд╕рдордп) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb3_v2.xy рдкреНрд░рднрд╛рд╡ рдХрд╛ рдХреЗрдВрджреНрд░ рд╣реИ, рдЖрдорддреМрд░ рдкрд░ рдлреНрд▓реЛрдЯ 2 (0.5, 0.5)ред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рд╣рдо рдпрд╣ рд╕рдордЭрдиреЗ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдФрд░ рди рдХреЗрд╡рд▓ рдиреЗрддреНрд░рд╣реАрди рд░реВрдк рд╕реЗ рд╢реЗрдбрд░ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрдирд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкрд╣рд▓реА рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реЗрдВрдЧреЗ:</font></font><br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ps_5_0</span></span> 0: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.100000</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(1<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxyx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.050000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.050000</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.000000</span></span>) 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">v1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb0</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zwzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">dp2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">sqrt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.z</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдВ рд▓рд╛рдЗрди 0 "рдЬрд╝реВрдо рдЕрдиреБрдкрд╛рдд" рдХрд╣рддрд╛ рд╣реВрдВ рдФрд░ рдЖрдк рдЬрд▓реНрдж рд╣реА рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдХреНрдпреЛрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж (рдкрдВрдХреНрддрд┐ 1), рд╣рдо "рд░реЛрдЯреЗрд╢рди рд╡рд┐рд╕реНрдерд╛рдкрди" рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд┐рд░реНрдл рдПрдХ рдЗрдирдкреБрдЯ рдкрд╛рдк / рдХреЙрд╕ рдбреЗрдЯрд╛ рдкреЗрдпрд░ рд╣реИ рдЬреЛ 0.05 рдЧреБрдгрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд╛рдЗрдиреЗрдВ 2-4: рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рд╡реЗрдХреНрдЯрд░ рдХреЛ рдкреНрд░рднрд╛рд╡ рдХреЗ рдХреЗрдВрджреНрд░ рд╕реЗ рдмрдирд╛рд╡рдЯ рдХреЗ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рддрдХ рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдо рджреВрд░реА рдХреЗ рд╡рд░реНрдЧ (3) рдФрд░ рд╕рд░рд▓ рджреВрд░реА (4) (рдХреЗрдВрджреНрд░ рд╕реЗ рдЯреЗрдХреНрд╕реЗрд▓ рддрдХ) рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд╝реВрдо рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдЗрдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХреЛрдб рдХреЛ рджреЗрдЦреЗрдВ: </font></font><br><br><pre> <code class="hljs css"> 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span> 9: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 10: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxxx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxx</span></span> 11: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yzyz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.zzzz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 12: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span> 13: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[2]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyxy</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╡реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдкреИрдХ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рд╣рдо рдлреНрд▓реЛрдЯ рдХреА рдХреЗрд╡рд▓ рдПрдХ рдЬреЛрдбрд╝реА рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП, r0.yz "рд░реЛрдЯреЗрд╢рди рдСрдлрд╝рд╕реЗрдЯ" рд╣реИрдВ, r1.z рдХреЗрдВрджреНрд░ рд╕реЗ рдЯреЗрдХреНрд╕реЗрд▓ рдХреА рджреВрд░реА рд╣реИ, r1.xy рдХреЗрдВрджреНрд░ рд╕реЗ рдЯреЗрдХреНрд╕реЗрд▓ рддрдХ рд╡реЗрдХреНрдЯрд░ рд╣реИ, r0.x "рдЬрд╝реВрдо рдХрд╛рд░рдХ" рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдм рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ zoomFactor = 1.0, рдпрд╛рдиреА рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="hljs powershell"> <span class="hljs-number"><span class="hljs-number">8</span></span>: mul r2.xyzw, r0.yzyz, r1.zzzz <span class="hljs-number"><span class="hljs-number">9</span></span>: mad r2.xyzw, r1.xyxy, r0.xxxx, <span class="hljs-literal"><span class="hljs-literal">-r2</span></span>.xyzw <span class="hljs-number"><span class="hljs-number">13</span></span>: add r2.xyzw, r2.xyzw, cb3[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxy r2.xy = (texel - center) * zoomFactor - rotationOffsets * distanceFromCenter + center;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓реЗрдХрд┐рди ZoomFactor = 1.0: </font></font><br><br><pre> <code class="hljs markdown"> r2.xy = texel - center - rotationOffsets <span class="hljs-bullet"><span class="hljs-bullet">* distanceFromCenter + center; r2.xy = texel - rotationOffsets *</span></span> distanceFromCenter;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕реА рддрд░рд╣ r3.xy рдХреЗ рд▓рд┐рдП: </font></font><br><br><pre> <code class="hljs cs"> <span class="hljs-number"><span class="hljs-number">10</span></span>: mul r3.xy, r0.xxxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">11</span></span>: mad r3.xyzw, r0.yzyz, r1.zzzz, r3.xyxy <span class="hljs-number"><span class="hljs-number">12</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> r3.xyzw, r3.xyzw, cb3[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxy r3.xy = rotationOffsets * distanceFromCenter + zoomFactor * (texel - center) + center</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди ZoomFactor = 1.0: </font><font style="vertical-align: inherit;">рдорд╣рд╛рдиред </font><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рдЗрд╕ рд╕рдордп рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рд╡рд░реНрддрдорд╛рди рдмрдирд╛рд╡рдЯ (рдЯреЗрдХреНрд╕рд▓), рд░реЛрдЯреЗрд╢рди рдСрдлрд╝рд╕реЗрдЯ рд╣реИ, рд▓реЗрдХрд┐рди рдЬрд╝реВрдордлрд╝реИрдХреНрдЯрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛ рд╣реИ? </font><font style="vertical-align: inherit;">рд▓рд╛рдЗрди 0. рджреЗрдЦреЗрдВред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, zoomFactor = 1.0 - 0.1 * drunkAmountред </font><font style="vertical-align: inherit;">рдЕрдзрд┐рдХрддрдо рдирд╢реЗ рдХреЗ рд▓рд┐рдП, рдЬрд╝реВрдордлрд╝реИрдХреНрдЯрд░ рдХрд╛ рдорд╛рди 0.9 рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдЬрд╝реВрдо рдХреЗ рд╕рд╛рде рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдЧрдгрдирд╛ рдЕрдм рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдЬрд╛рддреА рд╣реИ:</font></font><br><br> <code>r3.xy = rotationOffsets * distanceFromCenter + texel - <strike>center</strike> + <strike>center</strike> r3.xy = texel + rotationOffsets * distanceFromCenter</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><pre> <code class="hljs markdown"> baseTexcoordsA = 0.9 <span class="hljs-bullet"><span class="hljs-bullet">* texel + 0.1 *</span></span> center + rotationOffsets <span class="hljs-bullet"><span class="hljs-bullet">* distanceFromCenter baseTexcoordsB = 0.9 *</span></span> texel + 0.1 <span class="hljs-bullet"><span class="hljs-bullet">* center - rotationOffsets *</span></span> distanceFromCenter</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╛рдпрдж рдЗрд╕ рддрд░рд╣ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдЕрдзрд┐рдХ рд╕рд╣рдЬ рд╣реЛрдЧреА: рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдФрд░ рдХреЗрдВрджреНрд░ рдХреЗ рдмреАрдЪ рдХреБрдЫ рдХрд╛рд░рдХ рджреНрд╡рд╛рд░рд╛ рд░реЗрдЦреАрдп рдкреНрд░рдХреНрд╖реЗрдк рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ "рдЬрд╝реВрдо-рдЗрди" рдЫрд╡рд┐ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП, рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░рдирд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ </font><font style="vertical-align: inherit;">Shadertoy рдХрд╛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд┐рдВрдХ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдЖрдк рдХрд╛рд░реНрд░рд╡рд╛рдИ рдореЗрдВ рдкреНрд░рднрд╛рд╡ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмрдирд╛рд╡рдЯ рдСрдлрд╕реЗрдЯ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдореЗрдВ рд╕рдВрдкреВрд░реНрдг рдЯреБрдХрдбрд╝рд╛: </font></font><br><br><pre> <code class="hljs powershell"> <span class="hljs-number"><span class="hljs-number">2</span></span>: mad r1.xy, v1.xyxx, cb0[<span class="hljs-number"><span class="hljs-number">1</span></span>].zwzz, <span class="hljs-literal"><span class="hljs-literal">-cb3</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxx <span class="hljs-number"><span class="hljs-number">3</span></span>: dp2 r0.w, r1.xyxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">5</span></span>: mul r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">10.000000</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span>: min r0.w, r0.w, l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>: mul r0.w, r0.w, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].y <span class="hljs-number"><span class="hljs-number">14</span></span>: mul r0.x, r0.w, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].x <span class="hljs-number"><span class="hljs-number">15</span></span>: mul r0.x, r0.x, l(<span class="hljs-number"><span class="hljs-number">5.000000</span></span>) // texcoords offset intensity <span class="hljs-number"><span class="hljs-number">16</span></span>: mul r4.xyzw, r0.xxxx, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].zwzw // texcoords offset</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдврд╛рд▓ рдмрдирд╛рддрд╛ рд╣реИ, рдЪрд▓реЛ рдЗрд╕реЗ "рд╡рд┐рд╕реНрдерд╛рдкрди рддреАрд╡реНрд░рддрд╛ рдореБрдЦреМрдЯрд╛" рдХрд╣рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рджреЛ рдЕрд░реНрде рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд╣рд▓рд╛ r0.w рдореЗрдВ рд╣реИ (рд╣рдо рдЗрд╕реЗ рдмрд╛рдж рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ) рдФрд░ рджреВрд╕рд░рд╛ r0.x (рдкрдВрдХреНрддрд┐ 15) рдореЗрдВ 5 рдЧреБрдирд╛ рдордЬрдмреВрдд рд╣реИред </font><font style="vertical-align: inherit;">рдЙрддреНрддрд░рд╛рд░реНрджреНрдз рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЯреЗрдХреНрд╕рд▓ рдЖрдХрд╛рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╛рд░рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкреВрд░реНрд╡рд╛рдЧреНрд░рд╣ рдмрд▓ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдЯреЗрд╢рди-рд╕рдВрдмрдВрдзреА рдирдореВрдирд╛рдХрд░рдг</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдЧрд▓рд╛, рдмрдирд╛рд╡рдЯ рдХреЗ рдирдореВрдиреЗ рдХреА рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреА рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, 8 рдирдореВрдиреЛрдВ рдХреА 2 рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдкреНрд░рддреНрдпреЗрдХ "рдкрдХреНрд╖" рдХреЗ рд▓рд┐рдПред </font><font style="vertical-align: inherit;">HLSL рдореЗрдВ, рдЖрдк рдЗрд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="hljs powershell"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> const float2 pointsAroundPixel<span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-number"><span class="hljs-function"><span class="hljs-number">8</span></span></span><span class="hljs-function">] = { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">float2</span></span></span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>), float2(<span class="hljs-literal"><span class="hljs-literal">-1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>), float2(<span class="hljs-number"><span class="hljs-number">0.707</span></span>, <span class="hljs-number"><span class="hljs-number">0.707</span></span>), float2(<span class="hljs-literal"><span class="hljs-literal">-0</span></span>.<span class="hljs-number"><span class="hljs-number">707</span></span>, <span class="hljs-literal"><span class="hljs-literal">-0</span></span>.<span class="hljs-number"><span class="hljs-number">707</span></span>), float2(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>), float2(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-literal"><span class="hljs-literal">-1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>), float2(<span class="hljs-literal"><span class="hljs-literal">-0</span></span>.<span class="hljs-number"><span class="hljs-number">707</span></span>, <span class="hljs-number"><span class="hljs-number">0.707</span></span>), float2(<span class="hljs-number"><span class="hljs-number">0.707</span></span>, <span class="hljs-literal"><span class="hljs-literal">-0</span></span>.<span class="hljs-number"><span class="hljs-number">707</span></span>) }; float4 colorA = <span class="hljs-number"><span class="hljs-number">0</span></span>; float4 colorB = <span class="hljs-number"><span class="hljs-number">0</span></span>; int i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">unroll</span></span></span><span class="hljs-function">] </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) { colorA += TexColorBuffer.Sample( samplerLinearClamp, baseTexcoordsA + texcoordsOffset * pointsAroundPixel<span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">i</span></span></span><span class="hljs-function">] ); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">colorA</span></span></span></span> /= <span class="hljs-number"><span class="hljs-number">16.0</span></span>; <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">unroll</span></span></span><span class="hljs-function">] </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) { colorB += TexColorBuffer.Sample( samplerLinearClamp, baseTexcoordsB + texcoordsOffset * pointsAroundPixel[<span class="hljs-type"><span class="hljs-type">i</span></span>] ); } colorB /= <span class="hljs-number"><span class="hljs-number">16.0</span></span>; float4 rotationPart = colorA + colorB;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд╛рд▓ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдмреЗрд╕рдЯреИрдХреНрд╕рдХреЛрд░реНрдбреНрд╕ / рдмреА рдХреЛ рдпреВрдирд┐рдЯ рд╕рд░реНрдХрд▓ рдкрд░ рдкрдбрд╝реЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдСрдлрд╕реЗрдЯ рд╕реЗ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬреЛ рдкрд╣рд▓реЗ рд╡рд░реНрдгрд┐рдд "рдмрдирд╛рд╡рдЯ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рддреАрд╡реНрд░рддрд╛ рдХреА рддреАрд╡реНрд░рддрд╛" рд╕реЗ рдХрдИ рдЧреБрдирд╛ рдЕрдзрд┐рдХ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рд╕реЗ рджреВрд░, рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рд╡реГрддреНрдд рдХрд╛ рддреНрд░рд┐рдЬреНрдпрд╛ рдЬрд┐рддрдирд╛ рдмрдбрд╝рд╛ рд╣реИ - рд╣рдо рдЗрд╕реЗ 8 рдмрд╛рд░ рдирдореВрдирд╛ рд▓реЗрддреЗ рд╣реИрдВ, рдЬреЛ рд╕рд┐рддрд╛рд░реЛрдВ рдкрд░ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">PointsAroundPixel рдорд╛рди (45 рдбрд┐рдЧреНрд░реА рдХреЗ рдЧреБрдгрдХ):</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0cb/5d0/5b4/0cb5d05b44fd9d2969af0416684d4b77.jpg"></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд┐рдВрдЧрд▓ рд╕рд░реНрдХрд▓ </font></font></a> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреВрдо рд╕рдВрдмрдВрдзрд┐рдд рдирдореВрдирд╛</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рдж рд╡рд┐рдЪрд░ 3 рдореЗрдВ рдирд╢реЗ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХрд╛ рджреВрд╕рд░рд╛ рд╣рд┐рд╕реНрд╕рд╛ рдЬрд╝реВрдо рдЗрди рдФрд░ рдЬрд╝реВрдо рдЖрдЙрдЯ рдХреЗ рд╕рд╛рде рдЬрд╝реВрдо рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕ рдХрд╛рд░реНрдп рдХреЛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреЛ рджреЗрдЦреЗрдВ:</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-number"><span class="hljs-number">56</span></span>: mad r2.xyzw, r3.xyzw, l(<span class="hljs-number"><span class="hljs-number">0.062500</span></span>, <span class="hljs-number"><span class="hljs-number">0.062500</span></span>, <span class="hljs-number"><span class="hljs-number">0.062500</span></span>, <span class="hljs-number"><span class="hljs-number">0.062500</span></span>), r2.xyzw // the rotation part <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> stored <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> r2 register <span class="hljs-number"><span class="hljs-number">57</span></span>: mul r0.x, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].y, l(<span class="hljs-number"><span class="hljs-number">8.000000</span></span>) <span class="hljs-number"><span class="hljs-number">58</span></span>: mul r0.xy, r0.xxxx, cb3[<span class="hljs-number"><span class="hljs-number">0</span></span>].zwzz <span class="hljs-number"><span class="hljs-number">59</span></span>: mad r0.z, cb3[<span class="hljs-number"><span class="hljs-number">1</span></span>].y, l(<span class="hljs-number"><span class="hljs-number">0.020000</span></span>), l(<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">60</span></span>: mul r1.zw, r0.zzzz, r1.xxxy <span class="hljs-number"><span class="hljs-number">61</span></span>: mad r1.xy, r1.xyxx, r0.zzzz, cb3[<span class="hljs-number"><span class="hljs-number">2</span></span>].xyxx <span class="hljs-number"><span class="hljs-number">62</span></span>: mad r3.xy, r1.zwzz, r0.xyxx, r1.xyxx <span class="hljs-number"><span class="hljs-number">63</span></span>: mul r0.xy, r0.xyxx, r1.zwzz <span class="hljs-number"><span class="hljs-number">64</span></span>: mad r0.xy, r0.xyxx, l(<span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">2.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.000000</span></span>), r1.xyxx <span class="hljs-number"><span class="hljs-number">65</span></span>: sample_indexable(texture2d)(<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>) r1.xyzw, r1.xyxx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">66</span></span>: sample_indexable(texture2d)(<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>) r4.xyzw, r0.xyxx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">67</span></span>: sample_indexable(texture2d)(<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>,<span class="hljs-type"><span class="hljs-type">float</span></span>) r3.xyzw, r3.xyxx, t0.xyzw, s0 <span class="hljs-number"><span class="hljs-number">68</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> r1.xyzw, r1.xyzw, r3.xyzw <span class="hljs-number"><span class="hljs-number">69</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> r1.xyzw, r4.xyzw, r1.xyzw</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рддреАрди рдЕрд▓рдЧ-рдЕрд▓рдЧ рдмрдирд╛рд╡рдЯ рдХреЙрд▓ рд╣реИрдВ, рдЕрд░реНрдерд╛рддреН, рддреАрди рдЕрд▓рдЧ-рдЕрд▓рдЧ рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдЙрдирд╕реЗ рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдкрд╣рд▓реЗ, рд╣рдо рдЗрд╕ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> zoomInOutScalePixels = drunkEffectAmount * <span class="hljs-number"><span class="hljs-number">8.0</span></span>; // <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> float2 zoomInOutScaleNormalizedScreenCoordinates = zoomInOutScalePixels * texelSize.xy; // <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> zoomInOutAmplitude = <span class="hljs-number"><span class="hljs-number">1.0</span></span> + <span class="hljs-number"><span class="hljs-number">0.02</span></span>*cos(<span class="hljs-type"><span class="hljs-type">time</span></span>); // <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> float2 zoomInOutfromCenterToTexel = zoomInOutAmplitude * fromCenterToTexel; // <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдирдкреБрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рд╢рдмреНрджред </font><font style="vertical-align: inherit;">рд╣рдо рдЯреЗрдХреНрд╕рд▓реНрд╕ рдореЗрдВ рдСрдлрд╕реЗрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 8.0 * рдЯреЗрдХреНрд╕рд▓ рдЖрдХрд╛рд░), рдЬрд┐рд╕реЗ рдмрд╛рдж рдореЗрдВ рдмреЗрд╕ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдпрд╛рдо рдХреЗрд╡рд▓ рдЬрд╝реВрдо рдХреА рднрд╛рд╡рдирд╛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП 0.98 рдФрд░ 1.02 рдХреЗ рдмреАрдЪ рд╣реЛрддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдШреБрдорд╛рд╡ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ рдЬрд╝реВрдордлрд╝реИрдХреНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓рд┐рдП рдкрд╣рд▓реА рдЬреЛрдбрд╝реА рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ - r1.xy (рдкрдВрдХреНрддрд┐ 61)</font></font><br><br><pre> <code class="hljs markdown"> r1.xy = fromCenterToTexel <span class="hljs-bullet"><span class="hljs-bullet">* amplitude + center r1.xy = (TextureUV - Center) *</span></span> amplitude + Center // you can insert here zoomInOutfromCenterToTexel r1.xy = TextureUV <span class="hljs-bullet"><span class="hljs-bullet">* amplitude - Center *</span></span> amplitude + Center r1.xy = TextureUV <span class="hljs-bullet"><span class="hljs-bullet">* amplitude + Center *</span></span> 1.0 - Center <span class="hljs-bullet"><span class="hljs-bullet">* amplitude r1.xy = TextureUV *</span></span> amplitude + Center * (1.0 - amplitude) r1.xy = lerp( TextureUV, Center, amplitude);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╣ рд╣реИ: </font></font><br><br><pre> <code class="hljs lisp">float2 zoomInOutBaseTextureUV = lerp(<span class="hljs-name"><span class="hljs-name">TextureUV</span></span>, Center, amplitude)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрд▓реЛ рджреВрд╕рд░реА рдЬреЛрдбрд╝реА рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ - r3.xy (рдкрдВрдХреНрддрд┐ 62) </font></font><br><br><pre> <code class="hljs markdown"> r3.xy = (amplitude <span class="hljs-bullet"><span class="hljs-bullet">* fromCenterToTexel) *</span></span> zoomInOutScaleNormalizedScreenCoordinates + zoomInOutBaseTextureUV</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╣ рд╣реИ: </font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">float2</span></span> zoomInOutAddTextureUV0 = zoomInOutBaseTextureUV + zoomInOutfromCenterToTexel*zoomInOutScaleNormalizedScreenCoordinates;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдЗрдП рддреАрд╕рд░реА рдЬреЛрдбрд╝реА рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ - r0.xy (рд▓рд╛рдЗрдиреЗрдВ 63-64) </font></font><br><br><pre> <code class="hljs markdown"> r0.xy = zoomInOutScaleNormalizedScreenCoordinates <span class="hljs-bullet"><span class="hljs-bullet">* (amplitude *</span></span> fromCenterToTexel) * 2.0 + zoomInOutBaseTextureUV</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╣ рд╣реИ: </font></font><br><br><pre> <code class="hljs markdown"> float2 zoomInOutAddTextureUV1 = zoomInOutBaseTextureUV + 2.0<span class="hljs-emphasis"><span class="hljs-emphasis">*zoomInOutfromCenterToTexel*</span></span>zoomInOutScaleNormalizedScreenCoordinates</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рддреАрди рдмрдирд╛рд╡рдЯ рдкреНрд░рд╢реНрди рдПрдХ рд╕рд╛рде рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдФрд░ рдкрд░рд┐рдгрд╛рдо рд░рдЬрд┐рд╕реНрдЯрд░ r1 рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдпрд╣ рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рдПрдХ рд╕реАрдорд┐рдд рдкрддреЗ рд╡рд╛рд▓реЗ рдирдореВрдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕рдм рдПрдХ рд╕рд╛рде</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рдЦрдирд╛ рддреЛ, рдЗрд╕ рд╕рдордп рд╣рдорд╛рд░реЗ рдкрд╛рд╕ r2 рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рд░реЛрдЯреЗрд╢рди рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИ рдФрд░ r1 рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рддреАрди рдЧреБрдирд╛ рдЬреВрдо рдЕрдиреБрд░реЛрдз рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреА рдЕрдВрддрд┐рдо рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦреЗрдВ:</font></font><br><br><pre> <code class="hljs css"> 70: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>), <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 71: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">l</span></span>(0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>, 0<span class="hljs-selector-class"><span class="hljs-selector-class">.333333</span></span>) 72: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.wwww</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 73: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mad</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">o0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">cb3</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yyyy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xyzw</span></span> 74: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрддрд┐рд░рд┐рдХреНрдд рдЗрдирдкреБрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ: r0.w рдХреЛ рд▓рд╛рдЗрди 7 рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╣ рд╣рдорд╛рд░рд╛ рддреАрд╡реНрд░рддрд╛ рдорд╛рд╕реНрдХ рд╣реИ, рдФрд░ cb3 [0]ред рдпрд╣ рдирд╢реЗ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХрд╛ рдкрд░рд┐рдорд╛рдг рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдореЗрд░рд╛ рдкрд╣рд▓рд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдкрд╛рд╢рд╡рд┐рдХ рдмрд▓ рдерд╛:</font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">float4</span></span> finalColor = intensityMask * (rotationPart - zoomingPart); <span class="hljs-attribute"><span class="hljs-attribute">finalColor</span></span> = drunkIntensity * finalColor + zoomingPart; <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> finalColor;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╣реЛ, рдХреЛрдИ рднреА рдЗрд╕ рддрд░рд╣ рдХреЗ рд╢реЗрдбреНрд╕ рдирд╣реАрдВ рд▓рд┐рдЦрддрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдХрд╛рдЧрдЬ рдХреЗ рд╕рд╛рде рдПрдХ рдкреЗрдВрд╕рд┐рд▓ рд▓реА рдФрд░ рдпрд╣ рд╕реВрддреНрд░ рд▓рд┐рдЦрд╛:</font></font><br><br><pre> <code class="hljs powershell"> finalColor = effectAmount * [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span><span class="hljs-type"><span class="hljs-type">ensityMask</span></span> * (<span class="hljs-type"><span class="hljs-type">rotationPart</span></span> - <span class="hljs-type"><span class="hljs-type">zoomPart</span></span>)] + zoomPart finalColor = effectAmount * intensityMask * rotationPart - effectAmount * intensityMask * zoomPart + zooomPart</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреА рдХрд╣рд╛рдБ = effectAmount * intensityMask </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреЛ, рд╣рдо рдкрд╛рддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="hljs lisp"> finalColor = <span class="hljs-literal"><span class="hljs-literal">t</span></span> * rotationPart - <span class="hljs-literal"><span class="hljs-literal">t</span></span> * zoomPart + zoomPart finalColor = <span class="hljs-literal"><span class="hljs-literal">t</span></span> * rotationPart + zoomPart - <span class="hljs-literal"><span class="hljs-literal">t</span></span> * zoomPart finalColor = <span class="hljs-literal"><span class="hljs-literal">t</span></span> * rotationPart + (<span class="hljs-number"><span class="hljs-number">1.0</span></span> - <span class="hljs-literal"><span class="hljs-literal">t</span></span>) * zoomPart finalColor = lerp( <span class="hljs-name"><span class="hljs-name">zoomingPart</span></span>, rotationPart, <span class="hljs-literal"><span class="hljs-literal">t</span></span> )</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░ рдЖрддреЗ рд╣реИрдВ: </font></font><br><br><pre> <code class="hljs lisp"> finalColor = lerp(<span class="hljs-name"><span class="hljs-name">zoomingPart</span></span>, rotationPart, intensityMask * drunkIntensity);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рдВ, рд▓реЗрдЦ рдХрд╛ рдпрд╣ рд╣рд┐рд╕реНрд╕рд╛ рдмрд╣реБрдд рд╡рд┐рд╕реНрддреГрдд рдирд┐рдХрд▓рд╛, рд▓реЗрдХрд┐рди рд╣рдо рдЕрдВрдд рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдП! </font><font style="vertical-align: inherit;">рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ, рдореИрдВрдиреЗ рд▓рд┐рдЦрдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреБрдЫ рд╕реАрдЦрд╛, рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдк рднреА рдХрд░реЗрдВрдЧреЗ! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдкреВрд░реНрдг рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рд╕реНрд░реЛрдд рдпрд╣рд╛рдВ рдЙрдкрд▓рдмреНрдз </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЕрдкрдиреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HLSLexplorer рдХреЗ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рде рдЙрдирдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ </font><font style="vertical-align: inherit;">, рдФрд░ рд╣рд╛рд▓рд╛рдВрдХрд┐ рдореВрд▓ shader рдХреЗ рд╕рд╛рде рдХреЛрдИ рдкреНрд░рддреНрдпрдХреНрд╖ рдПрдХ-рд╕реЗ-рдПрдХ рдкрддреНрд░рд╛рдЪрд╛рд░ рдирд╣реАрдВ рд╣реИ, рдЕрдВрддрд░ рдЗрддрдиреЗ рдЫреЛрдЯреЗ (рдПрдХ рдкрдВрдХреНрддрд┐ рдХрдо) рд╣реИрдВ рдХрд┐ рдореИрдВ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ рд╕рд╛рде рдХрд╣ рд╕рдХрддрд╛ рд╣реВрдВ рдХрд┐ рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi422573/">https://habr.com/ru/post/hi422573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi422555/index.html">рдПрдВрдбреНрд░реЙрдЗрдб рдорд▓реНрдЯреА-рдореЙрдбреНрдпреВрд▓ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ред рдП рдЯреВ рдЬреЗрдб</a></li>
<li><a href="../hi422561/index.html">рд╡реАрдбрд┐рдпреЛ рдкреНрд░рд╕рд╛рд░рдг рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХреЗ рд▓рд┐рдП рдпрд╛рдВрдбреЗрдХреНрд╕ рдиреЗ рдХрдВрдкреНрдпреВрдЯрд░ рд╡рд┐рдЬрд╝рди рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ред DeepHD рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА</a></li>
<li><a href="../hi422565/index.html">рд╕реНрдХрд┐рд▓рдмреЙрдХреНрд╕ рдлреНрд░рд╛рдЗрдбреЗ рд╡реЗрдмрд┐рдирд╛рд░: рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдФрд░ рдбрд┐рдЬрд╝рд╛рдЗрдирд░реНрд╕ рдХреЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ</a></li>
<li><a href="../hi422569/index.html">рд╣рд░ рдШрдВрдЯреЗ, рд╕рдордп рдЯреНрд░реИрдХрд┐рдВрдЧ рдРрдк</a></li>
<li><a href="../hi422571/index.html">рдирд┐рд░реНрднрд░рддрд╛ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕рдорд╛рдирд╛рдВрддрд░ рдХрд░рдирд╛ - .NET рдЙрджрд╛рд╣рд░рдг</a></li>
<li><a href="../hi422575/index.html">рджреБрд░реНрд▓рдн рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐</a></li>
<li><a href="../hi422577/index.html">рдкреНрд░рддрд┐рдпрд╛рдВ рдФрд░ рдХреЙрдкреАрд░рд╛рдЗрдЯ: рдХреИрд╕реЗ рдкреЗрдЯреЗрдВрдЯ рдФрд░ рдХреЙрдкреАрд░рд╛рдЗрдЯ 3 рдбреА рдкреНрд░рд┐рдВрдЯрд┐рдВрдЧ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi422581/index.html">рд╢реНрд░реЛрдбрд┐рдВрдЧрд░-рд╢реИрд▓реА рдХреНрд╡рд╛рдВрдЯрдо рд╕реНрд╡рд┐рдЪ</a></li>
<li><a href="../hi422583/index.html">рдХрдард┐рди рдорд┐рдбрд▓рд┐рдВрдЧ: рд╕реНрдиреЛрдо рдбреА 735 рдЖрдИрдкреА рдлреЛрди рдХреА рд╕рдореАрдХреНрд╖рд╛</a></li>
<li><a href="../hi422585/index.html">рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЙрдкрдпреЛрдЧ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>