<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñçÔ∏è üòù ‚õ∏Ô∏è Luchando por los recursos, parte 5: Comenzando desde cero üôáüèª üë®üèº‚Äç‚öïÔ∏è üßôüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seguimos estudiando cgroups. En Red Hat Enterprise Linux 7, est√°n habilitados de forma predeterminada, ya que usa systemd, y √©l, a su vez, ya tiene cg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Luchando por los recursos, parte 5: Comenzando desde cero</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/429064/"> Seguimos estudiando cgroups.  En Red Hat Enterprise Linux 7, est√°n habilitados de forma predeterminada, ya que usa systemd, y √©l, a su vez, ya tiene cgroups integrados.  Con Red Hat, Red Hat Enterprise Linux 6 es un poco diferente.  De hecho, los controladores de cgroups estaban inicialmente all√≠, pero esta versi√≥n fue lanzada, recuerda en enero de 2010, es decir, hace un par de siglos en t√©rminos de a√±os de computadora. <br><br><img src="https://habrastorage.org/webt/7y/lx/mw/7ylxmwyn3vgxxrj7b6utthzftwk.png" width="100%"><br><br>  Sin embargo, los cgroups en Red Hat Enterprise Linux 6 son capaces de mucho incluso hoy, lo que ilustraremos hoy. <br><a name="habracut"></a><br>  Analicemos las capacidades de cgroups en Red Hat Enterprise Linux 6 usando un ejemplo puramente hipot√©tico, basado completamente en eventos reales.  Pero para empezar, por tradici√≥n, una peque√±a digresi√≥n. <br><br>  Nunca ha habido tantos problemas con la seguridad de TI como ahora.  No es sorprendente, porque hoy no solo todas las computadoras y tel√©fonos est√°n conectados a la red, sino tambi√©n refrigeradores, aspiradoras y muchas otras cosas: el alcance de las amenazas a la red es simplemente inmenso.  Y la lucha contra estas amenazas, por regla general, comienza de inmediato en todos los frentes.  Instalaci√≥n r√°pida de parches de seguridad?  Si definitivamente!  Fortalecimiento de la seguridad del sistema: firewalls, SELinux, autenticaci√≥n inteligente, ¬øeso es todo?  Por supuesto!  ¬øEsc√°neres antivirus en m√°quinas Linux?  Bueno, como decirlo ... <br><br>  En las m√°quinas Linux, los esc√°neres antivirus a veces hacen m√°s da√±o que bien.  Sin embargo, los guardias de seguridad tienen sus propias razones, y a menudo requieren que ejecute an√°lisis antivirus regularmente, sin pensar realmente en su solidez desde un punto de vista t√©cnico.  Y esta es una realidad que uno tiene que soportar y con la que, tarde o temprano, se enfrenta casi cualquier especialista en TI. <br><br>  El segundo punto es que Red Hat Enterprise Linux 7 es, por supuesto, moderno, avanzado y genial, pero muchos todav√≠a usan Red Hat Enterprise Linux 6 y no piensan rechazarlo.  De hecho, es por eso que la gente elige Red Hat: puede sentarse en la misma versi√≥n durante a√±os y a√∫n tener los √∫ltimos parches, actualizaciones y soporte. <br><br>  Volvamos a nuestro ejemplo ... Imagine que hay un tipo llamado Jerry.  Jerry trabaja en una oficina grande y es responsable del servidor Red Hat Enterprise Linux 6. Est√° completamente satisfecho con su funcionamiento, y no necesita nuevos problemas y problemas. <br><br>  Pero luego, los chicos del departamento de seguridad deciden que en todos sus servidores necesitas poner una cosa llamada ScanIT.  Y dado que esto revisar√° peri√≥dicamente los discos y la memoria en busca de virus y otro malware, necesita acceso completo a la ra√≠z. <br><br>  Jerry suspira, baja la guitarra y va a poner ScanIT en una m√°quina de prueba.  Bastante r√°pido resulta esto: <br><br><ul><li>  Al realizar un an√°lisis antivirus, scanit (este es un script para iniciar el proceso) consume todo el tiempo del procesador que puede alcanzar.  Y esto afecta gravemente el trabajo de la m√°quina de prueba, una vez que Jerry ni siquiera pod√≠a alcanzarlo en ssh. </li><li>  Adem√°s, el proceso de escaneo consume memoria de vez en cuando como en s√≠ mismo.  Como resultado, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OOM Killer se</a> despierta y comienza a matar cualquier proceso que no sea el escaneo en s√≠. </li></ul><br>  En general, hay que hacer algo con esto. <br><br>  Jerry toma la guitarra y, tocando Grateful Dead, comienza a pensar.  Muy r√°pidamente, se le ocurri√≥ que los mismos cgroups de Red Hat Enterprise Linux 7 probablemente podr√≠an ayudar aqu√≠, por lo que un amigo llamado Alex zumb√≥ por sus o√≠dos.  Jerry nuevamente se quita la guitarra y comienza a leer los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muelles</a> enviados por Alex <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en Red Hat Enterprise Linux 6</a> .  Resulta que lo primero que necesita es libcgroup. <br><br>  No hay libcgroup en la m√°quina de prueba, por lo que Jerry comienza a instalarlo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-7/wt/dk/-7wtdk4uuvnhwypqp9oblrgtx60.png"></div><br><br>  Adem√°s, Jerry incluye dos servicios que son necesarios para el trabajo de grupos permanentes (persistentes): <br><br><ul><li>  cgconfig: proporciona una interfaz m√°s o menos simple para trabajar con √°rboles cgroup.  Jerry ciertamente podr√≠a montar y configurar cgroups manualmente, pero ¬øpor qu√©, si puede ahorrar tiempo? </li><li>  cgred: esto es un motor de reglas de cgroup: cuando se inicia un proceso, este servicio lo coloca en uno u otro cgroup de acuerdo con las reglas especificadas. </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ga/i-/4c/gai-4cqblbowiy66etcfkm9wxlc.png"></div><br><br>  Despu√©s de instalar y configurar todo esto, Jerry finalmente puede proceder directamente al problema en s√≠.  Despu√©s de pensarlo detenidamente, toma la siguiente decisi√≥n: <br><br><ul><li>  scanit y sus procesos secundarios no deben consumir m√°s del 20% de los recursos de la CPU.  De hecho, incluso menos: no m√°s del 20% de los recursos de un n√∫cleo de procesador, incluso en una m√°quina de m√∫ltiples n√∫cleos.  En cgroups, esto se hace usando cuotas de CPU. </li><li>  En cuanto a la memoria, scanit y sus procesos secundarios no deben consumir m√°s de 512 MB de memoria del sistema.  Si est√°n cruzando esta l√≠nea, el sistema deber√≠a matarlos, y no a ning√∫n otro proceso. </li></ul><br><h3>  ¬°No es necesario que me digas qu√© hacer! </h3><br>  Jerry tendr√° que lidiar con dos conjuntos de archivos de configuraci√≥n: <br><ul><li>  /etc/cgconfig.conf: generado autom√°ticamente al instalar libcgroup. </li><li>  /etc/cgrules.conf: contiene un conjunto de reglas de conjunto de reglas, seg√∫n las cuales cgred clasifica los procesos en ejecuci√≥n por grupos de cgroups. </li></ul><br>  As√≠ es como se ve el archivo cgconfig.conf predeterminado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jk/7-/ie/jk7-ie0pclu29d7uourgo6mjq6c.png"></div><br><br>  Jerry podr√≠a haber hecho los cambios necesarios directamente a √©l, pero es mejor usar archivos de confguraci√≥n para esto.  Como funciona  Si coloca (eng. Drop-in - drop) en la carpeta /etc/cgconfig.d cualquier archivo con la extensi√≥n .conf, el sistema lo procesar√° y realizar√° los cambios apropiados en la configuraci√≥n.  Esto es conveniente porque puede crear complementos para diferentes tareas y agregarlos o eliminarlos de la configuraci√≥n utilizando las herramientas que m√°s le gusten (digamos, Ansible, bueno, sigue siendo un blog de Red Hat). <br><br>  Jerry primero crea un archivo desplegable para la CPU: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/li/w6/8u/liw68uvhsmfnz2dwet4g_9rfmhs.png"></div><br><br>  Miramos lo que tenemos aqu√≠ y c√≥mo funciona. <br><br>  La palabra clave de grupo simplemente establece el nombre del nuevo cgroup, en nuestro caso, scanit.  Dentro de las llaves, especificamos los controles de cgroup que queremos usar.  Aqu√≠, cpu.cfs_period_us y cpu.cfs_quota_us, le permiten establecer los l√≠mites correspondientes en el Programador completamente justo, el programador del kernel utilizado por defecto en Red Hat Enterprise Linux 6. Veamos qu√© se escribe sobre ellos en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gu√≠a de administraci√≥n de recursos de Red Hat Enterprise Linux 6</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wr/jp/zx/wrjpzxiksqg-3eos3ammagjg_di.png"></div><br><br>  En otras palabras, Jerry escribi√≥ esto en su lista desplegable: ‚ÄúPara cada proceso relacionado con cgroup llamado scanit, una vez por segundo verifique la cantidad de recursos de CPU asignados a √©l.  Si el tiempo total del procesador para todos los procesos en este grupo es m√°s de 200,000 milisegundos, entonces deje completamente de dar tiempo al procesador a estos procesos ".  Bueno, es decir, asignar a todos los procesos en el grupo cgroup de scanit, as√≠ como a sus procesos secundarios, en total no m√°s del 20% del tiempo del procesador. <br><br>  Despu√©s de reiniciar cgconfig, el servidor actualizar√° la configuraci√≥n, y si ingresa al sistema de archivos, veremos que scanit ahora se encuentra en el directorio del controlador de la CPU: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2u/is/z9/2uisz9gmmcpjaaqi7zjgauw-pwa.png"></div><br><br>  Esto, por supuesto, es bueno, pero a√∫n necesitamos empujar scanit en este cgroup.  Crged es √∫til aqu√≠, por defecto se parece a esto: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sm/-d/t5/sm-dt5oeb5xqypbyfgdytjagrci.png"></div><br><br>  Usar este archivo es m√°s o menos f√°cil.  Sin embargo, para esto tendremos que editar directamente el archivo cgrules.conf, ya que el mecanismo de inserci√≥n no es compatible aqu√≠.  Indicamos el usuario o grupo que posee el proceso, as√≠ como el nombre del proceso espec√≠fico, si lo desea, as√≠ como un controlador personalizado y un grupo de destino de cgroup. <br><br>  En nuestro ejemplo, en lugar del escaneo real del esc√°ner antivirus, usamos un script que tambi√©n se llama scanit, pero en realidad solo emula la carga.  Sin cgroup, todo se ve as√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rz/9e/jr/rz9ejrq2hvosc8tx6qygwtlprju.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zg/_q/5w/zg_q5wnmcxzrirruk73ium-l4xg.png"></div><br><br>  La CPU est√° totalmente ocupada, principalmente por el espacio del usuario y un poco de un sistema. <br><br>  Jerry se rasca la barba.  Inicia vi y, utilizando exactamente un dedo √≠ndice, realiza algunos cambios y reinicia el demonio cgred: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dn/sq/br/dnsqbrojxhtx0holtc3i-5f6uco.png"></div><br><br>  Luego se inicia manualmente scanit ...: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qa/o2/um/qao2umbcrsuefcn1n9m1jtrojtq.png"></div><br><br>  Y - ¬°salud!  Victoria <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ik/vi/mr/ikvimrn0d_pkujdyjdaefnxzgsa.png"></div><br><br>  Como puede ver, nuestros procesos de emulaci√≥n de carga (procesos secundarios de escaneos) ahora consumen un total del 20% de los recursos de la CPU, principalmente en el espacio del usuario y un poco en el sistema.  Entonces, este maldito antivirus ya no cargar√° el auto a la locura total. <br><br><h3>  ¬øRecuerdas lo que sigue? </h3><br>  Regocijado por el √©xito, Jerry casi se olvida de su memoria.  Pero a√∫n as√≠ recuerda y comienza a vi nuevamente para arreglar su archivo de configuraci√≥n. <br><br>  Ahora agrega dos configuraciones con respecto a la memoria all√≠: <br><ul><li>  Memory.limit_in_bytes - m√°x.  La cantidad de RAM que pueden usar todos los procesos en el cgroup de scanit.  Y excluyendo el espacio de intercambio.  Jerry lo limita a 256 MB </li><li>  Memory.memsw.limit_in_bytes - m√°x.  Volumen de RAM, m√°s espacio en el archivo de intercambio, que puede asignarse a todos los procesos en el grupo cgroup de scanit, en total.  Si se supera este umbral, el asesino OOM matar√° los procesos.  Jerry lo establece en 512 MB. </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d9/ey/p7/d9eyp7j01qhdzrc_xughbzsatny.png"></div><br><br>  Oh no!  Que esta mal <br><br>  Jerry mira hacia arriba y ve que los procesos secundarios de escaneo todav√≠a se est√°n ejecutando.  Como este cgroup est√° actualmente en uso, Jerry no puede iniciar el servicio.  Por lo tanto, mata los procesos secundarios manualmente y reinicia dichos servicios. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8t/er/fb/8terfbxnn3mp4bb-nrdmeasb1s4.png"></div><br><br>  Ahora una peque√±a edici√≥n en cgred.conf: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sr/ma/zs/srmazsl7k259dze13dcnjtij_ae.png"></div><br><br>  Para verificar, Jerry ejecuta varias tareas de escaneo a la vez, para que el asesino OOM funcione con seguridad. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mv/cf/m7/mvcfm7gxz5b_l2ylpptrp5skseo.png"></div><br><br>  Entonces Jerry mira el registro del sistema y asiente con satisfacci√≥n: scanit ya no puede dejar la memoria en ninguna cantidad con impunidad. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rf/n-/gc/rfn-gcg6nk2lwjz5aelxw6lt9ue.png"></div><br><br>  Esperamos que nuestra serie de art√≠culos de cgroups lo haya ayudado a comprender qu√© es, c√≥mo usarlo en Red Hat Enterprise Linux 7, c√≥mo crearlo en Red Hat Enterprise Linux 6 y c√≥mo usarlo en su entorno. <br><br><ul><li>  Parte 1 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habr.com/company/redhatrussia/blog/423051</a> </li><li>  Parte 2 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habr.com/company/redhatrussia/blog/424367</a> </li><li>  Parte 3 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habr.com/company/redhatrussia/blog/425803</a> </li><li>  Parte 4 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habr.com/company/redhatrussia/blog/427413</a> </li><li>  Parte 6 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habr.com/company/redhatrussia/blog/430748</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429064/">https://habr.com/ru/post/es429064/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429054/index.html">Encuentra N diferencias. Experiencia de prueba de dise√±o Tinkoff.ru</a></li>
<li><a href="../es429056/index.html">La f√≠sica, no la biolog√≠a, hace que el envejecimiento sea inevitable</a></li>
<li><a href="../es429058/index.html">Usando Retrofit 2 en una aplicaci√≥n de Android</a></li>
<li><a href="../es429060/index.html">El concepto de una mente ideal. IA universal</a></li>
<li><a href="../es429062/index.html">Domar la multidifusi√≥n</a></li>
<li><a href="../es429066/index.html">C√≥mo la tripulaci√≥n del avi√≥n se prepara para la partida</a></li>
<li><a href="../es429068/index.html">Una publicaci√≥n muy corporativa: abrir en Mosc√∫ o por qu√© el 10 y 11 de noviembre son buenos d√≠as para comprar productos electr√≥nicos</a></li>
<li><a href="../es429070/index.html">Linux no se puede cargar en nuevas MacBooks debido al chip T2</a></li>
<li><a href="../es429072/index.html">Por qu√© muri√≥ Kodak y floreci√≥ Fujifilm: la historia de dos cineastas</a></li>
<li><a href="../es429074/index.html">Buenas acciones para Google Money: nuevo desaf√≠o de impacto de IA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>