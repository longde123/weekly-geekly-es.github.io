<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš¯ ğŸ“˜ ğŸ”¦ ä¸ºä»€ä¹ˆconstä¸åŠ é€ŸC / C ++ä»£ç ï¼Ÿ ğŸ‘¢ ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ¿ ğŸ’·</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å‡ ä¸ªæœˆå‰ï¼Œæˆ‘åœ¨ä¸€ç¯‡æ–‡ç« ä¸­æåˆ°è¿™æ˜¯ä¸€ä¸ªç¥è¯ï¼Œå¥½åƒconstå¸®åŠ©å¯ç”¨Cå’ŒC ++ä¸­çš„ç¼–è¯‘å™¨ä¼˜åŒ– ã€‚ æˆ‘å†³å®šåº”è¯¥å¯¹è¿™ä¸€è¯´æ³•è¿›è¡Œè§£é‡Šï¼Œç‰¹åˆ«æ˜¯å› ä¸ºæˆ‘è‡ªå·±ä»¥å‰æ›¾ç»ç›¸ä¿¡è¿‡è¿™ä¸ªç¥è¯ã€‚ æˆ‘å°†ä»ç†è®ºå’Œäººå·¥ç¤ºä¾‹å¼€å§‹ï¼Œç„¶åç»§ç»­åŸºäºçœŸå®ä»£ç åº“-SQLiteè¿›è¡Œå®éªŒå’ŒåŸºå‡†æµ‹è¯•ã€‚ 

 ç®€å•æµ‹è¯• 
 åœ¨æˆ‘çœ‹æ¥ï¼Œè®©æˆ‘ä»¬ä»ä½¿ç”¨con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä¸ºä»€ä¹ˆconstä¸åŠ é€ŸC / C ++ä»£ç ï¼Ÿ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/464777/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ck/cw/48/ckcw48o0aqklzf10gzhfqx8w3rw.jpeg"></div><br> å‡ ä¸ªæœˆå‰ï¼Œæˆ‘åœ¨ä¸€ç¯‡æ–‡ç« ä¸­æåˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™æ˜¯ä¸€ä¸ªç¥è¯ï¼Œå¥½åƒconstå¸®åŠ©å¯ç”¨Cå’ŒC ++ä¸­çš„ç¼–è¯‘å™¨ä¼˜åŒ–</a> ã€‚ æˆ‘å†³å®šåº”è¯¥å¯¹è¿™ä¸€è¯´æ³•è¿›è¡Œè§£é‡Šï¼Œç‰¹åˆ«æ˜¯å› ä¸ºæˆ‘è‡ªå·±ä»¥å‰æ›¾ç»ç›¸ä¿¡è¿‡è¿™ä¸ªç¥è¯ã€‚ æˆ‘å°†ä»ç†è®ºå’Œäººå·¥ç¤ºä¾‹å¼€å§‹ï¼Œç„¶åç»§ç»­åŸºäºçœŸå®ä»£ç åº“-SQLiteè¿›è¡Œå®éªŒå’ŒåŸºå‡†æµ‹è¯•ã€‚ <br><a name="habracut"></a><br><h2> ç®€å•æµ‹è¯• </h2><br> åœ¨æˆ‘çœ‹æ¥ï¼Œè®©æˆ‘ä»¬ä»ä½¿ç”¨<code>const</code>åŠ é€ŸCä»£ç çš„æœ€ç®€å•ï¼Œæœ€æ˜æ˜¾çš„ä¾‹å­å¼€å§‹ã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‡½æ•°å£°æ˜ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *x)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constFunc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *x)</span></span></span></span>;</code> </pre> <br> å¹¶å‡è®¾æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byArg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d\n"</span></span>, *x); func(x); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d\n"</span></span>, *x); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constByArg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d\n"</span></span>, *x); constFunc(x); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d\n"</span></span>, *x); }</code> </pre> <br> è¦æ‰§è¡Œ<code>printf()</code> ï¼Œå¤„ç†å™¨å¿…é¡»é€šè¿‡æŒ‡é’ˆä»å†…å­˜ä¸­æ£€ç´¢<code>*x</code> ã€‚ æ˜¾ç„¶ï¼Œ <code>constByArg()</code>çš„æ‰§è¡Œå¯èƒ½ä¼šç¨å¿«ä¸€äº›ï¼Œå› ä¸ºç¼–è¯‘å™¨çŸ¥é“<code>*x</code>æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œå› æ­¤åœ¨<code>constFunc()</code>å®Œæˆå<code>constFunc()</code>å†æ¬¡åŠ è½½å…¶å€¼ã€‚ å¯¹ä¸å¯¹ è®©æˆ‘ä»¬çœ‹çœ‹ç”±GCCç”Ÿæˆå¹¶å¯ç”¨äº†ä¼˜åŒ–çš„æ±‡ç¼–ä»£ç ï¼š <br><br><pre> <code class="bash hljs">$ gcc -S -Wall -O3 test.c $ view test.s</code> </pre> <br> è¿™æ˜¯<code>byArg()</code>çš„å®Œæ•´æ±‡ç¼–å™¨ç»“æœï¼š <br><br><pre> <code class="plaintext hljs">byArg: .LFB23: .cfi_startproc pushq %rbx .cfi_def_cfa_offset 16 .cfi_offset 3, -16 movl (%rdi), %edx movq %rdi, %rbx leaq .LC0(%rip), %rsi movl $1, %edi xorl %eax, %eax call __printf_chk@PLT movq %rbx, %rdi call func@PLT # The only instruction that's different in constFoo movl (%rbx), %edx leaq .LC0(%rip), %rsi xorl %eax, %eax movl $1, %edi popq %rbx .cfi_def_cfa_offset 8 jmp __printf_chk@PLT .cfi_endproc</code> </pre> <br> ç”±<code>byArg()</code>å’Œ<code>constByArg()</code>ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯<code>constByArg()</code> <code>call constFunc@PLT</code> ï¼Œå¦‚æºä»£ç ä¸­æ‰€ç¤ºã€‚  <code>const</code>æœ¬èº«æ²¡æœ‰åŒºåˆ«ã€‚ <br><br> å¥½çš„ï¼Œé‚£æ˜¯æµ·æ¹¾åˆä½œå§”å‘˜ä¼šã€‚ ä¹Ÿè®¸æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´æ™ºèƒ½çš„ç¼–è¯‘å™¨ã€‚ è¯´Cå£°ã€‚ <br><br><pre> <code class="cpp hljs">$ clang -S -Wall -O3 -emit-llvm test.c $ view test.ll</code> </pre> <br> è¿™æ˜¯ä¸­é—´ä»£ç ã€‚ å®ƒæ¯”æ±‡ç¼–ç¨‹åºæ›´ç´§å‡‘ï¼Œå¹¶ä¸”æˆ‘å°†åˆ é™¤è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä»¥ä¾¿æ‚¨ç†è§£æˆ‘çš„æ„æ€æ˜¯â€œé™¤äº†è°ƒç”¨ä¹‹å¤–æ²¡æœ‰åŒºåˆ«â€ï¼š <br><br><pre> <code class="cpp hljs">; Function Attrs: nounwind uwtable define dso_local <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> @byArg(i32*) local_unnamed_addr #<span class="hljs-number"><span class="hljs-number">0</span></span> { %<span class="hljs-number"><span class="hljs-number">2</span></span> = load i32, i32* %<span class="hljs-number"><span class="hljs-number">0</span></span>, align <span class="hljs-number"><span class="hljs-number">4</span></span>, !tbaa !<span class="hljs-number"><span class="hljs-number">2</span></span> %<span class="hljs-number"><span class="hljs-number">3</span></span> = tail call i32 (i8*, ...) @<span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(i8* getelementptr inbounds ([<span class="hljs-number"><span class="hljs-number">4</span></span> x i8], [<span class="hljs-number"><span class="hljs-number">4</span></span> x i8]* @.str, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>), i32 %<span class="hljs-number"><span class="hljs-number">2</span></span>) tail call <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> @func(i32* %<span class="hljs-number"><span class="hljs-number">0</span></span>) #<span class="hljs-number"><span class="hljs-number">4</span></span> %<span class="hljs-number"><span class="hljs-number">4</span></span> = load i32, i32* %<span class="hljs-number"><span class="hljs-number">0</span></span>, align <span class="hljs-number"><span class="hljs-number">4</span></span>, !tbaa !<span class="hljs-number"><span class="hljs-number">2</span></span> %<span class="hljs-number"><span class="hljs-number">5</span></span> = tail call i32 (i8*, ...) @<span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(i8* getelementptr inbounds ([<span class="hljs-number"><span class="hljs-number">4</span></span> x i8], [<span class="hljs-number"><span class="hljs-number">4</span></span> x i8]* @.str, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>), i32 %<span class="hljs-number"><span class="hljs-number">4</span></span>) ret <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> } ; Function Attrs: nounwind uwtable define dso_local <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> @constByArg(i32*) local_unnamed_addr #<span class="hljs-number"><span class="hljs-number">0</span></span> { %<span class="hljs-number"><span class="hljs-number">2</span></span> = load i32, i32* %<span class="hljs-number"><span class="hljs-number">0</span></span>, align <span class="hljs-number"><span class="hljs-number">4</span></span>, !tbaa !<span class="hljs-number"><span class="hljs-number">2</span></span> %<span class="hljs-number"><span class="hljs-number">3</span></span> = tail call i32 (i8*, ...) @<span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(i8* getelementptr inbounds ([<span class="hljs-number"><span class="hljs-number">4</span></span> x i8], [<span class="hljs-number"><span class="hljs-number">4</span></span> x i8]* @.str, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>), i32 %<span class="hljs-number"><span class="hljs-number">2</span></span>) tail call <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> @constFunc(i32* %<span class="hljs-number"><span class="hljs-number">0</span></span>) #<span class="hljs-number"><span class="hljs-number">4</span></span> %<span class="hljs-number"><span class="hljs-number">4</span></span> = load i32, i32* %<span class="hljs-number"><span class="hljs-number">0</span></span>, align <span class="hljs-number"><span class="hljs-number">4</span></span>, !tbaa !<span class="hljs-number"><span class="hljs-number">2</span></span> %<span class="hljs-number"><span class="hljs-number">5</span></span> = tail call i32 (i8*, ...) @<span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(i8* getelementptr inbounds ([<span class="hljs-number"><span class="hljs-number">4</span></span> x i8], [<span class="hljs-number"><span class="hljs-number">4</span></span> x i8]* @.str, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>), i32 %<span class="hljs-number"><span class="hljs-number">4</span></span>) ret <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> }</code> </pre> <br><h2>  ï¼ˆç±»å‹ï¼‰æœ‰æ•ˆçš„é€‰é¡¹ </h2><br> è¿™æ˜¯<code>const</code>å­˜åœ¨çœŸæ­£é‡è¦çš„ä»£ç ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">localVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d\n"</span></span>, x); constFunc(&amp;x); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d\n"</span></span>, x); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constLocalVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-comment"><span class="hljs-comment">// const on the local variable printf("%d\n", x); constFunc(&amp;x); printf("%d\n", x); }</span></span></code> </pre> <br>  <code>constLocalVar()</code>çš„æ±‡ç¼–ä»£ç ï¼Œå…¶ä¸­åŒ…å«åœ¨<code>constLocalVar()</code>å¤–éƒ¨ä¼˜åŒ–çš„ä¸¤æ¡æŒ‡ä»¤ï¼š <br><br><pre> <code class="cpp hljs">localVar: .LFB25: .cfi_startproc subq $<span class="hljs-number"><span class="hljs-number">24</span></span>, %rsp .cfi_def_cfa_offset <span class="hljs-number"><span class="hljs-number">32</span></span> movl $<span class="hljs-number"><span class="hljs-number">42</span></span>, %edx movl $<span class="hljs-number"><span class="hljs-number">1</span></span>, %edi movq %fs:<span class="hljs-number"><span class="hljs-number">40</span></span>, %rax movq %rax, <span class="hljs-number"><span class="hljs-number">8</span></span>(%rsp) xorl %eax, %eax leaq .LC0(%rip), %rsi movl $<span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>(%rsp) call __printf_chk@PLT leaq <span class="hljs-number"><span class="hljs-number">4</span></span>(%rsp), %rdi call constFunc@PLT movl <span class="hljs-number"><span class="hljs-number">4</span></span>(%rsp), %edx <span class="hljs-meta"><span class="hljs-meta"># not in constLocalVar() xorl %eax, %eax movl $1, %edi leaq .LC0(%rip), %rsi # not in constLocalVar() call __printf_chk@PLT movq 8(%rsp), %rax xorq %fs:40, %rax jne .L9 addq $24, %rsp .cfi_remember_state .cfi_def_cfa_offset 8 ret .L9: .cfi_restore_state call __stack_chk_fail@PLT .cfi_endproc</span></span></code> </pre> <br>  LLVMä¸­é—´ä»¶æ›´åŠ å¹²å‡€ã€‚ åœ¨<code>constLocalVar()</code>ä¹‹å¤–ä¼˜åŒ–å¯¹ç¬¬äºŒä¸ª<code>printf()</code>è°ƒç”¨ä¹‹å‰çš„<code>load</code> ï¼š <br><br><pre> <code class="cpp hljs">; Function Attrs: nounwind uwtable define dso_local <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> @localVar() local_unnamed_addr #<span class="hljs-number"><span class="hljs-number">0</span></span> { %<span class="hljs-number"><span class="hljs-number">1</span></span> = alloca i32, align <span class="hljs-number"><span class="hljs-number">4</span></span> %<span class="hljs-number"><span class="hljs-number">2</span></span> = bitcast i32* %<span class="hljs-number"><span class="hljs-number">1</span></span> to i8* call <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> @llvm.lifetime.start.p0i8(i64 <span class="hljs-number"><span class="hljs-number">4</span></span>, i8* nonnull %<span class="hljs-number"><span class="hljs-number">2</span></span>) #<span class="hljs-number"><span class="hljs-number">4</span></span> store i32 <span class="hljs-number"><span class="hljs-number">42</span></span>, i32* %<span class="hljs-number"><span class="hljs-number">1</span></span>, align <span class="hljs-number"><span class="hljs-number">4</span></span>, !tbaa !<span class="hljs-number"><span class="hljs-number">2</span></span> %<span class="hljs-number"><span class="hljs-number">3</span></span> = tail call i32 (i8*, ...) @<span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(i8* getelementptr inbounds ([<span class="hljs-number"><span class="hljs-number">4</span></span> x i8], [<span class="hljs-number"><span class="hljs-number">4</span></span> x i8]* @.str, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>), i32 <span class="hljs-number"><span class="hljs-number">42</span></span>) call <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> @constFunc(i32* nonnull %<span class="hljs-number"><span class="hljs-number">1</span></span>) #<span class="hljs-number"><span class="hljs-number">4</span></span> %<span class="hljs-number"><span class="hljs-number">4</span></span> = load i32, i32* %<span class="hljs-number"><span class="hljs-number">1</span></span>, align <span class="hljs-number"><span class="hljs-number">4</span></span>, !tbaa !<span class="hljs-number"><span class="hljs-number">2</span></span> %<span class="hljs-number"><span class="hljs-number">5</span></span> = call i32 (i8*, ...) @<span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(i8* getelementptr inbounds ([<span class="hljs-number"><span class="hljs-number">4</span></span> x i8], [<span class="hljs-number"><span class="hljs-number">4</span></span> x i8]* @.str, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>, i64 <span class="hljs-number"><span class="hljs-number">0</span></span>), i32 %<span class="hljs-number"><span class="hljs-number">4</span></span>) call <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> @llvm.lifetime.end.p0i8(i64 <span class="hljs-number"><span class="hljs-number">4</span></span>, i8* nonnull %<span class="hljs-number"><span class="hljs-number">2</span></span>) #<span class="hljs-number"><span class="hljs-number">4</span></span> ret <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> }</code> </pre> <br> å› æ­¤ï¼Œ <code>constLocalVar()</code>æˆåŠŸåœ°å¿½ç•¥äº†é‡æ–°å¯åŠ¨<code>*x</code> ï¼Œä½†æ˜¯æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€äº›å¥‡æ€ªçš„äº‹æƒ…ï¼šåœ¨ä¸»ä½“<code>constLocalVar()</code>å’Œ<code>constLocalVar()</code>å¯¹<code>constLocalVar()</code>çš„è°ƒç”¨ç›¸åŒã€‚ å¦‚æœç¼–è¯‘å™¨å¯ä»¥ç¡®å®š<code>constFunc()</code>æ²¡æœ‰åœ¨<code>constLocalVar()</code>ä¿®æ”¹<code>*x</code> ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå®ƒä¸èƒ½ç†è§£åŒä¸€å‡½æ•°è°ƒç”¨æ²¡æœ‰åœ¨<code>constLocalVar()</code>ä¿®æ”¹<code>*x</code>å‘¢ï¼Ÿ <br><br> è¿™å°±æ˜¯ä¸ºä»€ä¹ˆCä¸­çš„<code>const</code>ä¸èƒ½ç”¨ä½œä¼˜åŒ–çš„åŸå› ã€‚ åœ¨Cä¸­ï¼Œ <code>const</code>æœ¬è´¨ä¸Šå…·æœ‰ä¸¤ä¸ªå¯èƒ½çš„å«ä¹‰ï¼š <br><br><ul><li> è¿™å¯èƒ½æ„å‘³ç€å˜é‡æ˜¯æŸäº›æ•°æ®çš„åªè¯»å‡åï¼Œå®ƒå¯ä»¥æ˜¯å¸¸é‡ï¼Œä¹Ÿå¯ä»¥ä¸æ˜¯å¸¸é‡ã€‚ <br></li><li> æˆ–å¯èƒ½æ„å‘³ç€è¯¥å˜é‡ç¡®å®æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚ å¦‚æœå°†<code>const</code>ä»æŒ‡é’ˆè§£<code>const</code>åˆ°ä¸€ä¸ªå¸¸é‡å€¼ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå†™å…¥ï¼Œåˆ™å°†è·å¾—æœªå®šä¹‰çš„è¡Œä¸ºã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æœ<code>const</code>æ˜¯æŒ‡å‘éå¸¸é‡å€¼çš„æŒ‡é’ˆï¼Œåˆ™ä¸ä¼šæœ‰é—®é¢˜ã€‚ <br></li></ul><br> è¿™æ˜¯<code>constFunc()</code>çš„è¯´æ˜æ€§ç¤ºä¾‹å®ç°ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// x is just a read-only pointer to something that may or may not be a constant void constFunc(const int *x) { // local_var is a true constant const int local_var = 42; // Definitely undefined behaviour by C rules doubleIt((int*)&amp;local_var); // Who knows if this is UB? doubleIt((int*)x); } void doubleIt(int *x) { *x *= 2; }</span></span></code> </pre><br>  <code>constFunc()</code> <code>localVar()</code>ä¸º<code>constFunc()</code>äº†æŒ‡å‘é<code>const</code>å˜é‡çš„<code>const</code>æŒ‡é’ˆã€‚ ç”±äºå˜é‡æœ€åˆä¸æ˜¯<code>const</code> ï¼Œå› æ­¤<code>constFunc()</code>å¯èƒ½æ˜¯éª—å­ï¼Œå¯ä»¥åœ¨ä¸å¯åŠ¨UBçš„æƒ…å†µä¸‹å¼ºè¡Œä¿®æ”¹å˜é‡ã€‚ å› æ­¤ï¼Œç¼–è¯‘å™¨ä¸èƒ½å‡å®šè¿”å›<code>constFunc()</code>å˜é‡å°†å…·æœ‰ç›¸åŒçš„å€¼ã€‚  <code>constLocalVar()</code>çš„å˜é‡ç¡®å®æ˜¯<code>const</code> ï¼Œå› æ­¤ç¼–è¯‘å™¨ä¸èƒ½å‡å®šå®ƒä¸ä¼šè¢«æ›´æ”¹ï¼Œå› ä¸ºè¿™ä¸€æ¬¡å¯¹äº<code>constFunc()</code> <i>å®ƒå°†æ˜¯</i> UBï¼Œå› æ­¤ç¼–è¯‘å™¨å°†å–æ¶ˆç»‘å®š<code>const</code>å¹¶å°†å…¶å†™å…¥å˜é‡ã€‚ <br><br> ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­çš„<code>byArg()</code>å’Œ<code>constByArg()</code>å‡½æ•°æ¯«æ— å¸Œæœ›ï¼Œå› ä¸ºç¼–è¯‘å™¨æ— æ³•ç¡®å®š<code>*x</code>æ˜¯å¦ä¸º<code>const</code> ã€‚ <br><br> ä½†æ˜¯ä¸ä¸€è‡´ä¹‹å¤„æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ å¦‚æœç¼–è¯‘å™¨å¯ä»¥å‡å®š<code>constFunc()</code>ä»<code>constLocalVar()</code>è°ƒç”¨æ—¶ä¸æ›´æ”¹å…¶å‚æ•°ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥å¯¹<code>constFunc()</code>è°ƒç”¨åº”ç”¨ç›¸åŒçš„ä¼˜åŒ–ï¼Œå¯¹å—ï¼Ÿ ä¸è¡Œ ç¼–è¯‘å™¨æ— æ³•å‡è®¾å°†æ°¸è¿œè°ƒç”¨<code>constLocalVar()</code> ã€‚ è€Œä¸”å¦‚æœä¸æ˜¯ï¼ˆä¾‹å¦‚ï¼Œå› ä¸ºå®ƒåªæ˜¯ä»£ç ç”Ÿæˆå™¨æˆ–å®æ“ä½œçš„ä¸€äº›å…¶ä»–ç»“æœï¼‰ï¼Œé‚£ä¹ˆ<code>constFunc()</code>å¯ä»¥å®‰é™åœ°æ›´æ”¹æ•°æ®è€Œæ— éœ€å¯åŠ¨UBã€‚ <br><br> æ‚¨å¯èƒ½éœ€è¦å¤šæ¬¡é˜…è¯»ä»¥ä¸Šç¤ºä¾‹å’Œè¯´æ˜ã€‚ ä¸ç”¨æ‹…å¿ƒï¼Œè¿™å¬èµ·æ¥å¾ˆè’è°¬ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œå†™<code>const</code>å˜é‡æ˜¯æœ€ç³Ÿç³•çš„UBï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ç”šè‡³ä¸çŸ¥é“å®ƒæ˜¯å¦ä¼šæ˜¯UBã€‚ å› æ­¤ï¼Œå½“ç¼–è¯‘å™¨çœ‹åˆ°<code>const</code> ï¼Œåº”è¯¥ä»æœ‰äººå¯ä»¥åœ¨æŸä¸ªåœ°æ–¹æ›´æ”¹å®ƒçš„äº‹å®å‡ºå‘ï¼Œè¿™æ„å‘³ç€ç¼–è¯‘å™¨æ— æ³•ä½¿ç”¨<code>const</code>è¿›è¡Œä¼˜åŒ–ã€‚ å®é™…ä¸Šï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºè®¸å¤šçœŸå®çš„Cä»£ç éƒ½ä»¥â€œæˆ‘çŸ¥é“æˆ‘åœ¨åšä»€ä¹ˆâ€çš„æ ·å¼åŒ…å«å¯¹<code>const</code>çš„æ‹’ç»ã€‚ <br><br> ç®€è€Œè¨€ä¹‹ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä¸å…è®¸ç¼–è¯‘å™¨ä½¿ç”¨<code>const</code>è¿›è¡Œä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä½¿ç”¨æŒ‡é’ˆä»å¦ä¸€ä¸ªä½œç”¨åŸŸæ£€ç´¢æ•°æ®ï¼Œæˆ–å°†æ•°æ®æ”¾ç½®åœ¨å †ä¸Šã€‚ ç”šè‡³æ›´ç³Ÿçš„æ˜¯ï¼Œé€šå¸¸åœ¨ç¼–è¯‘å™¨æ— æ³•ä½¿ç”¨<code>const</code>æƒ…å†µä¸‹ï¼Œè¿™ä¸æ˜¯å¿…éœ€çš„ã€‚ ä¾‹å¦‚ï¼Œä»»ä½•è‡ªé‡çš„ç¼–è¯‘å™¨éƒ½å¯ä»¥åœ¨æ²¡æœ‰<code>const</code>æƒ…å†µä¸‹ç†è§£ï¼Œåœ¨æ­¤ä»£ç ä¸­<code>x</code>æ˜¯å¸¸é‡ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">42</span></span>, y = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d %d\n"</span></span>, x, y); y += x; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d %d\n"</span></span>, x, y);</code> </pre> <br> å› æ­¤<code>const</code>å¯¹äºä¼˜åŒ–å‡ ä¹æ²¡æœ‰ç”¨ï¼Œå› ä¸ºï¼š <br><br><ol><li> é™¤å°‘æ•°ä¾‹å¤–ï¼Œç¼–è¯‘å™¨è¢«è¿«å¿½ç•¥å®ƒï¼Œå› ä¸ºæŸäº›ä»£ç å¯ä»¥åˆæ³•åœ°è§£å¼€<code>const</code> ã€‚ <br></li><li> åœ¨ä¸Šè¿°å¤§å¤šæ•°ä¾‹å¤–ä¸­ï¼Œç¼–è¯‘å™¨ä»å¯ä»¥ç†è§£è¯¥å˜é‡æ˜¯å¸¸é‡ã€‚ <br></li></ol><br><h2>  C ++ </h2><br> å¦‚æœæ‚¨ä½¿ç”¨C ++ç¼–å†™ï¼Œåˆ™<code>const</code>ä¼šé€šè¿‡å‡½æ•°é‡è½½å½±å“ä»£ç ç”Ÿæˆã€‚ æ‚¨å¯ä»¥å…·æœ‰ç›¸åŒå‡½æ•°çš„<code>const</code>å’Œé<code>const</code>é‡è½½ï¼Œå¹¶ä¸”å¯ä»¥ä¼˜åŒ–é<code>const</code> ï¼ˆç”±ç¨‹åºå‘˜è€Œä¸æ˜¯ç¼–è¯‘å™¨ï¼‰ï¼Œä¾‹å¦‚ï¼Œå‡å°‘å¤åˆ¶ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Needs to do more copying of data } void foo(const int *p) { // Doesn't need defensive copies } int main() { const int x = 42; // const-ness affects which overload gets called foo(&amp;x); return 0; }</span></span></code> </pre> <br> ä¸€æ–¹é¢ï¼Œæˆ‘è®¤ä¸ºåœ¨å®è·µä¸­è¿™é€šå¸¸ä¸ç”¨äºC ++ä»£ç ã€‚ å¦ä¸€æ–¹é¢ï¼Œä¸ºäº†ä½¿å®ƒçœŸæ­£èµ·ä½œç”¨ï¼Œç¨‹åºå‘˜å¿…é¡»åšå‡ºç¼–è¯‘å™¨æ— æ³•ä½¿ç”¨çš„å‡è®¾ï¼Œå› ä¸ºè¯¥è¯­è¨€æ— æ³•ä¿è¯å®ƒä»¬ã€‚ <br><br><h2> è¯•ç”¨SQLite3 </h2><br> è¶³å¤Ÿçš„ç†è®ºå’Œç‰µå¼ºçš„ä¾‹å­ã€‚  <code>const</code>å¯¹å®é™…ä»£ç åº“<code>const</code>ä»€ä¹ˆå½±å“ï¼Ÿ æˆ‘å†³å®šå°è¯•ä½¿ç”¨SQLite DBï¼ˆ3.30.0ç‰ˆï¼‰ï¼Œå› ä¸ºï¼š <br><br><ul><li> å®ƒä½¿ç”¨<code>const.</code> </li><li> è¿™æ˜¯ä¸å¹³å‡¡çš„ä»£ç åº“ï¼ˆè¶…è¿‡200 KLOCï¼‰ã€‚ <br></li><li> ä½œä¸ºæ•°æ®åº“ï¼Œå®ƒåŒ…æ‹¬è®¸å¤šæœºåˆ¶ï¼Œä»å¤„ç†å­—ç¬¦ä¸²å€¼å¼€å§‹åˆ°ä»¥æ•°å­—åˆ°æ—¥æœŸçš„è½¬æ¢ç»“æŸã€‚ <br></li><li> å¯ä»¥åœ¨å¤„ç†å™¨æœ‰é™çš„è´Ÿè½½ä¸‹è¿›è¡Œæµ‹è¯•ã€‚ <br></li></ul><br> å¦å¤–ï¼Œå‚ä¸å¼€å‘çš„ä½œè€…å’Œç¨‹åºå‘˜å·²ç»èŠ±è´¹äº†æ•°å¹´æ—¶é—´æ¥æé«˜ç”Ÿäº§åŠ›ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‡è®¾ä»–ä»¬æ²¡æœ‰é—æ¼ä»»ä½•æ˜æ˜¾çš„ä¸œè¥¿ã€‚ <br><br><h3> å‡†å¤‡å·¥ä½œ </h3><br> æˆ‘åˆ¶ä½œäº†ä¸¤ä¸ª<a href="">æºä»£ç </a>å‰¯æœ¬ã€‚ ä¸€ä¸ªä»¥æ™®é€šæ¨¡å¼ç¼–è¯‘ï¼Œç¬¬äºŒä¸ªä½¿ç”¨hackè¿›è¡Œé¢„å¤„ç†ï¼Œå°†<code>const</code>è½¬æ¢ä¸ºç©ºé—²å‘½ä»¤ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> const</span></span></code> </pre> <br>  ï¼ˆGNUï¼‰ <code>sed</code>å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>sed -i '1i#define const' *.c *.h</code>å°†å…¶æ·»åŠ åˆ°æ¯ä¸ªæ–‡ä»¶çš„é¡¶éƒ¨ã€‚ <br><br>  SQLiteä½¿ç”¨è„šæœ¬åœ¨æ„å»ºè¿‡ç¨‹ä¸­ç”Ÿæˆä»£ç ï¼Œä½¿äº‹æƒ…å˜å¾—æœ‰äº›å¤æ‚ã€‚ å¹¸è¿çš„æ˜¯ï¼Œåœ¨å°†ä»£ç ä¸<code>const</code>å’Œä¸å¸¦<code>const</code>æ··åˆä½¿ç”¨æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå¼•å…¥å¾ˆå¤šå™ªå£°ï¼Œå› æ­¤æ‚¨å¯ä»¥ç«‹å³æ³¨æ„åˆ°å¹¶é…ç½®è„šæœ¬ä»¥æ·»åŠ æˆ‘çš„å<code>const</code>ä»£ç ã€‚ <br><br> å¯¹ç¼–è¯‘åçš„ä»£ç è¿›è¡Œç›´æ¥æ¯”è¾ƒæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå°çš„æ›´æ”¹ä¼šå½±å“æ•´ä¸ªå†…å­˜æ–¹æ¡ˆï¼Œè¿™å°†å¯¼è‡´æ•´ä¸ªä»£ç ä¸­çš„æŒ‡é’ˆå’Œå‡½æ•°è°ƒç”¨å‘ç”Ÿå˜åŒ–ã€‚ å› æ­¤ï¼Œæˆ‘å°†åæ±‡ç¼–çš„ç±»å‹è½¬æ¢ï¼ˆ <code>objdump -d libSQLite3.so.0.8.6</code> ï¼‰ä½œä¸ºäºŒè¿›åˆ¶å¤§å°å’Œæ¯æ¡æŒ‡ä»¤çš„åŠ©è®°ç¬¦åç§°ã€‚ ä¾‹å¦‚ï¼Œæ­¤åŠŸèƒ½ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">000000000005</span></span>d570 &lt;SQLite3_blob_read&gt;: <span class="hljs-number"><span class="hljs-number">5</span></span>d570: <span class="hljs-number"><span class="hljs-number">4</span></span>c <span class="hljs-number"><span class="hljs-number">8</span></span>d <span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> a2 ff ff lea <span class="hljs-number"><span class="hljs-number">-0x5da7</span></span>(%rip),%r8 # <span class="hljs-number"><span class="hljs-number">577</span></span>d0 &lt;SQLite3BtreePayloadChecked&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>d577: e9 <span class="hljs-number"><span class="hljs-number">04</span></span> fe ff ff jmpq <span class="hljs-number"><span class="hljs-number">5</span></span>d380 &lt;blobReadWrite&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>d57c: <span class="hljs-number"><span class="hljs-number">0f</span></span> <span class="hljs-number"><span class="hljs-number">1f</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> nopl <span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rax)</code> </pre> <br> å˜æˆï¼š <br><br><pre> <code class="cpp hljs">SQLite3_blob_read <span class="hljs-number"><span class="hljs-number">7l</span></span>ea <span class="hljs-number"><span class="hljs-number">5</span></span>jmpq <span class="hljs-number"><span class="hljs-number">4</span></span>nopl</code> </pre> <br> ç¼–è¯‘æ—¶ï¼Œæˆ‘æ²¡æœ‰æ›´æ”¹SQLiteç¨‹åºé›†è®¾ç½®ã€‚ <br><br><h3> ç¼–è¯‘ä»£ç åˆ†æ </h3><br> å¯¹äºlibSQLite3.soï¼Œå…·æœ‰<code>const</code>çš„ç‰ˆæœ¬å ç”¨äº†4,740,704å­—èŠ‚ï¼Œæ¯”æ²¡æœ‰<code>const</code>çš„ç‰ˆæœ¬æ‹¥æœ‰4,736,712å­—èŠ‚å¤§çº¦å¤š0.1ï¼…ã€‚ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½å¯¼å‡ºäº†1374ä¸ªå‡½æ•°ï¼ˆä¸åŒ…æ‹¬PLTä¸­çš„ä½çº§è¾…åŠ©å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”13ä¸ªå‡½æ•°åœ¨è½¬æ¢ä¸­æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ <br><br> ä¸€äº›æ›´æ”¹ä¸é¢„å¤„ç†é»‘å®¢æœ‰å…³ã€‚ ä¾‹å¦‚ï¼Œè¿™æ˜¯å·²æ›´æ”¹çš„åŠŸèƒ½ä¹‹ä¸€ï¼ˆæˆ‘åˆ é™¤äº†ä¸€äº›ç‰¹å®šäºSQLiteçš„å®šä¹‰ï¼‰ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LARGEST_INT64 (0xffffffff|(((int64_t)0x7fffffff)</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&lt;32)) #define SMALLEST_INT64 (((int64_t)-1) - LARGEST_INT64) static int64_t doubleToInt64(double r){ /* ** Many compilers we encounter do not define constants for the ** minimum and maximum 64-bit integers, or they define them ** inconsistently. And many do not understand the "LL" notation. ** So we define our own static constants here using nothing ** larger than a 32-bit integer constant. */ static const int64_t maxInt = LARGEST_INT64; static const int64_t minInt = SMALLEST_INT64; if( r&lt;=(double)minInt ){ return minInt; }else if( r&gt;=(double)maxInt ){ return maxInt; }else{ return (int64_t)r; } }</span></span></span></span></code> </pre> <br> å¦‚æœæˆ‘ä»¬åˆ é™¤<code>const</code> ï¼Œé‚£ä¹ˆè¿™äº›å¸¸é‡å°†å˜æˆ<code>static</code>å˜é‡ã€‚ æˆ‘ä¸æ˜ç™½ä¸ºä»€ä¹ˆä»»ä½•ä¸å…³å¿ƒ<code>const</code>å°†è¿™äº›å˜é‡<code>static</code> ã€‚ å¦‚æœæˆ‘ä»¬åŒæ—¶åˆ é™¤<code>static</code>å’Œ<code>const</code> ï¼Œé‚£ä¹ˆGCCå°†å†æ¬¡å°†å®ƒä»¬è§†ä¸ºå¸¸é‡ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†è·å¾—ç›¸åŒçš„ç»“æœã€‚ ç”±äºæ­¤ç±»<code>static const</code>å˜é‡ï¼Œåœ¨13ä¸ªå‡½æ•°ä¸­å¯¹3ä¸ªå‡½æ•°çš„æ›´æ”¹è¢«è¯æ˜æ˜¯é”™è¯¯çš„ï¼Œä½†æˆ‘æ²¡æœ‰è§£å†³å®ƒä»¬ã€‚ <br><br>  SQLiteä½¿ç”¨è®¸å¤šå…¨å±€å˜é‡ï¼Œå¤§å¤šæ•°çœŸæ­£çš„<code>const</code>ä¼˜åŒ–ä¸æ­¤ç›¸å…³ï¼šä¾‹å¦‚ç”¨å˜é‡æ¯”è¾ƒä»£æ›¿å¸¸é‡æ¥æ¯”è¾ƒï¼Œæˆ–è€…å°†å¾ªç¯éƒ¨åˆ†å›æ»šä¸€æ­¥ï¼ˆè¦äº†è§£åšäº†ä»€ä¹ˆæ ·çš„ä¼˜åŒ–ï¼Œæˆ‘ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Radare</a> ï¼‰ã€‚ ä¸€äº›å˜åŒ–ä¸å€¼å¾—ä¸€æã€‚  <code>SQLite3ParseUri()</code>åŒ…å«487æ¡æŒ‡ä»¤ï¼Œä½†æ˜¯<code>const</code>åªåšäº†ä¸€ä¸ªæ›´æ”¹ï¼šè¿›è¡Œäº†ä»¥ä¸‹ä¸¤ä¸ªæ¯”è¾ƒï¼š <br><br><pre> <code class="cpp hljs">test %al, %al je &lt;SQLite3ParseUri+<span class="hljs-number"><span class="hljs-number">0x717</span></span>&gt; cmp $<span class="hljs-number"><span class="hljs-number">0x23</span></span>, %al je &lt;SQLite3ParseUri+<span class="hljs-number"><span class="hljs-number">0x717</span></span>&gt;</code> </pre> <br> å¹¶äº¤æ¢ï¼š <br><br><pre> <code class="cpp hljs">cmp $<span class="hljs-number"><span class="hljs-number">0x23</span></span>, %al je &lt;SQLite3ParseUri+<span class="hljs-number"><span class="hljs-number">0x717</span></span>&gt; test %al, %al je &lt;SQLite3ParseUri+<span class="hljs-number"><span class="hljs-number">0x717</span></span>&gt;</code> </pre> <br><h3> åŸºå‡†æµ‹è¯• </h3><br>  SQLiteå¸¦æœ‰ä¸€ä¸ªå›å½’æµ‹è¯•æ¥è¡¡é‡æ€§èƒ½ï¼Œæˆ‘ä½¿ç”¨æ ‡å‡†SQLiteæ„å»ºè®¾ç½®å¯¹æ¯ä¸ªç‰ˆæœ¬çš„ä»£ç è¿è¡Œäº†æ•°ç™¾æ¬¡ã€‚ æ‰§è¡Œæ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼š <br><br><div class="scrollable-table"><table><tbody><tr><td></td><td>  const <br></td><td> æ²¡æœ‰const <br></td></tr><tr><td> æœ€ä½è¦æ±‚ <br></td><td>  10,658 <br></td><td>  10,803 <br></td></tr><tr><td> ä¸­ä½æ•° <br></td><td>  11,571 <br></td><td>  11,519 <br></td></tr><tr><td> æœ€å¤§å€¼ <br></td><td>  11,832 <br></td><td>  11,658 <br></td></tr><tr><td> å¹³å‡å€¼ <br></td><td>  11,531 <br></td><td>  11,492 <br></td></tr></tbody></table></div><br> å°±ä¸ªäººè€Œè¨€ï¼Œæˆ‘çœ‹ä¸å‡ºæœ‰ä»€ä¹ˆä¸åŒã€‚ æˆ‘ä»æ•´ä¸ªç¨‹åºä¸­åˆ é™¤äº†<code>const</code> ï¼Œå› æ­¤ï¼Œå¦‚æœå­˜åœ¨æ˜æ˜¾å·®å¼‚ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“æ³¨æ„åˆ°ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ€§èƒ½å¯¹æ‚¨æä¸ºé‡è¦ï¼Œé‚£ä¹ˆå³ä½¿å¾ˆå°çš„åŠ é€Ÿåº¦ä¹Ÿå¯ä»¥å–æ‚¦æ‚¨ã€‚ è®©æˆ‘ä»¬è¿›è¡Œç»Ÿè®¡åˆ†æã€‚ <br><br> æˆ‘å–œæ¬¢ä½¿ç”¨Mann-Whitney Uæ£€éªŒæ¥æ‰§è¡Œæ­¤ç±»ä»»åŠ¡ï¼Œå®ƒä¸æ›´è‘—åçš„tæ£€éªŒç›¸ä¼¼ï¼Œæ—¨åœ¨ç¡®å®šç»„ä¹‹é—´çš„å·®å¼‚ï¼Œä½†æ›´èƒ½æŠµæŠ—åœ¨è®¡ç®—æœºä¸Šæµ‹é‡æ—¶é—´æ—¶å‘ç”Ÿçš„å¤æ‚éšæœºå˜åŒ–ï¼ˆç”±äºä¸å¯é¢„æµ‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé”™è¯¯ï¼‰ã€‚å†…å­˜é¡µç­‰ï¼‰ã€‚ ç»“æœå¦‚ä¸‹ï¼š <br><br><div class="scrollable-table"><table><tbody><tr><th></th><th>  const </th><th> æ²¡æœ‰const </th></tr><tr><td>  Ã± </td><td>  100 </td><td>  100 </td></tr><tr><td> ä¸­ç±»åˆ«ï¼ˆå¹³å‡ç­‰çº§ï¼‰ </td><td>  121.38 </td><td>  79.62 </td></tr><tr><td> æ›¼æƒ ç‰¹å°¼ </td><td></td><td>  2912 </td></tr><tr><td>  Å¾ </td><td></td><td>  -5.10 </td></tr><tr><td>  2é¢på€¼ </td><td></td><td>  &lt;10 <sup>-6</sup> <br></td></tr><tr><td> å¹³å‡å·®å¼‚æ˜¯HL <br></td><td></td><td>  -0.056ç§’ <br></td></tr><tr><td>  95ï¼…ç½®ä¿¡åŒºé—´ <br></td><td></td><td>  -0.077è‡³-0.038 s <br></td></tr></tbody></table></div><br> æµ‹è¯•Uå‘ç°åœ¨æ€§èƒ½ä¸Šæœ‰ç»Ÿè®¡å­¦ä¸Šçš„æ˜¾ç€å·®å¼‚ã€‚ ä½†æ˜¯-ä¸€ä¸ªæƒŠå–œï¼  -äº‹å®è¯æ˜ï¼Œæ²¡æœ‰<code>const</code>çš„ç‰ˆæœ¬è¦å¿«60æ¯«ç§’ï¼Œå³å¿«0.5ï¼…ã€‚ ä¼¼ä¹å°‘é‡çš„â€œä¼˜åŒ–â€ä¸å€¼å¾—å¢åŠ ä»£ç é‡ã€‚  <code>const</code>ä¸å¤ªå¯èƒ½æ¿€æ´»ä»»ä½•ä¸»è¦çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚è‡ªåŠ¨çŸ¢é‡åŒ–ã€‚ å½“ç„¶ï¼Œæ‚¨çš„å·¥ä½œé‡å¯èƒ½å–å†³äºç¼–è¯‘å™¨ä¸­çš„å„ç§æ ‡å¿—ï¼Œå…¶ç‰ˆæœ¬ï¼Œä»£ç åº“æˆ–å…¶ä»–å†…å®¹ã€‚ ä½†æ˜¯åœ¨æˆ‘çœ‹æ¥ï¼Œè€å®åœ°è¯´ï¼Œå³ä½¿<code>const</code>æ”¹å–„äº†Cçš„æ€§èƒ½ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸€ç‚¹ã€‚ <br><br><h2> é‚£ä¹ˆconstéœ€è¦åšä»€ä¹ˆå‘¢ï¼Ÿ </h2><br> å°½ç®¡å­˜åœ¨æ‰€æœ‰ç¼ºé™·ï¼Œä½†C / C ++ä¸­çš„<code>const</code>å¯¹äºæä¾›ç±»å‹å®‰å…¨æ€§å¾ˆæœ‰ç”¨ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœå°†<code>const</code>ä¸moveè¯­ä¹‰å’Œ<code>std::unique_pointer</code>ç»“åˆä½¿ç”¨ï¼Œåˆ™å¯ä»¥å®ç°æ˜¾å¼æŒ‡é’ˆæ‰€æœ‰æƒã€‚ åœ¨è¶…è¿‡100 KLOCçš„æ—§C ++ä»£ç åº“ä¸­ï¼ŒæŒ‡é’ˆæ‰€æœ‰æƒçš„ä¸ç¡®å®šæ€§æ˜¯ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œå› æ­¤ï¼Œæˆ‘æ„Ÿè°¢<code>const</code>è§£å†³å®ƒã€‚ <br><br> ä½†æ˜¯ï¼Œåœ¨æˆ‘è¶…è¶Šä½¿ç”¨<code>const</code>æ¥æä¾›ç±»å‹å®‰å…¨ä¹‹å‰ã€‚ æˆ‘å¬è¯´å°½å¯èƒ½ç§¯æåœ°ä½¿ç”¨<code>const</code>æ¥æé«˜æ€§èƒ½è¢«è®¤ä¸ºæ˜¯æ­£ç¡®çš„ã€‚ æˆ‘å¬è¯´å¦‚æœæ€§èƒ½çœŸçš„å¾ˆé‡è¦ï¼Œé‚£ä¹ˆå³ä½¿ä»£ç å˜å¾—ä¸å¤ªå¯è¯»ï¼Œæ‚¨ä¹Ÿå¿…é¡»é‡æ„ä»£ç ä»¥æ·»åŠ æ›´å¤š<code>const</code> ã€‚ å½“æ—¶å¬èµ·æ¥å¾ˆåˆç†ï¼Œä½†æ˜¯ä»é‚£æ—¶èµ·ï¼Œæˆ‘æ„è¯†åˆ°äº‹å®å¹¶éå¦‚æ­¤ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464777/">https://habr.com/ru/post/zh-CN464777/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464763/index.html">Linuxä¸ŠæœåŠ¡å™¨åŸºå‡†ï¼šä¸€ç³»åˆ—å¼€æ”¾å·¥å…·</a></li>
<li><a href="../zh-CN464765/index.html">é…ç½®FreePBX + GoIP</a></li>
<li><a href="../zh-CN464769/index.html">Badooå¦‚ä½•ä½¿æ¯ç§’å‘å‡º20ä¸‡å¼ ç…§ç‰‡æˆä¸ºå¯èƒ½</a></li>
<li><a href="../zh-CN464773/index.html">å¯ŒInternetåº”ç”¨ç¨‹åºä¸­çš„å¼‚æ­¥æ‰“å­—ç¨¿åŠå…¶è£…é¥°ç¨‹åº</a></li>
<li><a href="../zh-CN464775/index.html">9æœˆ21æ—¥Badoo PHPèšä¼šï¼ƒ3ï¼šæ€§èƒ½</a></li>
<li><a href="../zh-CN464779/index.html">å…³äºäº«ä¹ä¸»ä¹‰èœœèœ‚ï¼Œäººä»¬ä½¿å®ƒä»¬å·¥ä½œå’Œé£è¡Œçš„æ–¹å¼</a></li>
<li><a href="../zh-CN464781/index.html">æ™ºèƒ½ç”µè§†ï¼šä»CRTåˆ°HDR</a></li>
<li><a href="../zh-CN464785/index.html">éç«äº‰æ€§ç›´çº¿ä¼˜åŠ¿</a></li>
<li><a href="../zh-CN464787/index.html">æˆ‘ç¡®å®šé«˜çº§ç§»åŠ¨å¼€å‘äººå‘˜åªä¼šåœ¨æ¨èä¸‹å‡ºç°</a></li>
<li><a href="../zh-CN464791/index.html">æ±½è½¦ç”¨Kubernetesï¼šå¦‚ä½•æ‰“å¼€å¼€å‘äººå‘˜å¯¹è½¦è½½è®¡ç®—æœºçš„è®¿é—®æƒé™å¹¶ä½¿å…¶å®‰å…¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>