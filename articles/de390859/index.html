<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚓️ 🕺🏼 📀 Raumlüftungssystem basierend auf „Himbeere“ und „CO2-Detektor“ 🤙🏼 👨🏻‍💼 🙋🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Mode für Smart Homes hat das gesamte Internet erfasst. Jeder möchte jetzt eine Glühbirne herstellen, die sich über das Internet ausschalten oder e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Raumlüftungssystem basierend auf „Himbeere“ und „CO2-Detektor“</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dadget/blog/390859/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Mode für Smart Homes hat das gesamte Internet erfasst. Jeder möchte jetzt eine Glühbirne herstellen, die sich über das Internet ausschalten oder einen Ventilator in der Toilette umdrehen lässt. </font><font style="vertical-align: inherit;">Meine Erfahrung war ganz einfach: Ich wollte ein System entwickeln, das einen Raum automatisch belüften kann, nicht mehr und nicht weniger. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich das Prinzip des Systems betrachtet hatte, kam ich zu einigen Schlussfolgerungen, die ich umsetzen wollte. </font><font style="vertical-align: inherit;">Wie geplant ist die gesamte Funktionalität des Systems in drei Komponenten unterteilt: das „Gehirn“, das alles steuert, das Belüftungssystem zum Öffnen des Fensters / oder Einschalten des Ventilators und der Sensor selbst, der die Luftqualität im Raum überwacht. </font><font style="vertical-align: inherit;">Ich werde Ihnen mehr über den Luftqualitätssensor erzählen und ein wenig auf das Thema der Integration in das „Gehirn“ eines Smart Homes eingehen.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geräteübersicht</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich beschloss, die Qualität der „Frische“ der Luft durch die Konzentration von Kohlendioxid zu kontrollieren. Zukünftige Pläne beinhalten die Einführung von Sensoren für Ammoniak, Propan / Butan (Gaslecks), Staubkonzentration in der Luft usw. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde beschlossen, das Lüftungssystem in einem Wohnzimmer zu platzieren, in dem eine Person so viel Zeit wie möglich verbringt. Wahrscheinlich ist ein solcher Raum ein Schlafzimmer, und dort ist ein automatisches Belüftungssystem im Schlaf sehr nützlich. </font></font><br>
<br>
<img src="https://habrastorage.org/files/a25/543/468/a25543468c9b46439f7f570577cddd2b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist kein Geheimnis, dass die Konzentration von Kohlendioxid in der Luft nicht nur die Produktivität des menschlichen Gehirns, die menschliche Leistung, sondern auch die Fähigkeit, sich gut auszuruhen, stark beeinflusst. Je höher die CO2-Konzentration ist, desto schlechter.</font></font><br>
 <br>
 <img src="https://habrastorage.org/files/609/2dc/c2f/6092dcc2ff3340eea4c0727347a8f234.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Kohlendioxiddetektor der Firma Dadget wurde als Gerät zur Messung der Kohlendioxidkonzentration verwendet. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Gerät kann über den USB-Anschluss eines Computers oder Laptops mit Strom versorgt werden. </font><font style="vertical-align: inherit;">Auf der Vorderseite - LCD-Anzeige, die Informationen zur Kohlendioxidkonzentration und Umgebungstemperatur anzeigt. </font><font style="vertical-align: inherit;">Es gibt auch 3 LEDs, die dem Benutzer eine visuelle Darstellung des Inhalts geben. </font><font style="vertical-align: inherit;">Alles ist ganz einfach - schalten Sie das Gerät ein. </font><font style="vertical-align: inherit;">Und alles funktioniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es hat mich angezogen, dass es Software gibt, die mit diesem Gerät funktioniert. </font><font style="vertical-align: inherit;">Es gibt Software für Windows und Linux. </font><font style="vertical-align: inherit;">Der Quellcode des Programms für Linux befindet sich auf Github und scheint von unserem Landsmann geschrieben worden zu sein. </font><font style="vertical-align: inherit;">Und wenn Sie den Quellcode haben, können Sie sich etwas einfallen lassen, es ändern und das Programm für sich selbst "schärfen".</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Workflow-Übersicht</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Praxis und Google gezeigt haben, wird das Gerät vom Computer als HID-Gerät angesehen. Daher gibt es im Programm für Windows eine DLL namens HIDApi. Um mit Linux arbeiten zu können, benötigen Sie die gleichnamige HIDApi-Bibliothek. Ich habe den Quellcode für Linux-Software fertiggestellt und ein einfaches Quietschen geschrieben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist klar, dass die Verwendung eines Linux-Computers zum Lesen von Daten vom Sensor und zum Übertragen auf einen Smart-Home-Controller irgendwo Blasphemie ist. Daher wurde beschlossen, Raspbery pi mit reinem Debian zu verwenden. In Zukunft ist geplant, alles auf Arduino zu erledigen und über drahtlose Kanäle zu übertragen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Schema meines Hardware-Software-Komplexes ist wie folgt:</font></font><br>
<br>
<img src="https://habrastorage.org/files/c83/600/997/c836009971eb43578523742643ed8002.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein sachkundiger Leser und ein begeisterter Geek könnten denken, dass es nicht sehr sportlich ist, HUB in diesem Schema zu verwenden. Richtig, Sie können einen CO2-Monitor direkt anschließen und das Leben genießen. Mit einem solchen Schema löse ich mehrere Probleme gleichzeitig: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
● Meistens befindet sich das Gehirn eines Smart Homes nicht dort, wo sich der Sensor befindet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
● Mit Himbeer-Pi können zusätzliche Sensoren angeschlossen werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
● Wenn Sie den Sensor separat platzieren, erhalten Sie zwei Anzeigemethoden: die erste auf dem Sensorbildschirm, die zweite auf dem Telefon oder über eine Webseite, da die Daten an die Steuerung übertragen werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein MicasaVerde-Gerät wird als Smart-Home-Controller verwendet. Das Gerät kann Daten von Sensoren erfassen und Entscheidungen gemäß einem bestimmten Programm treffen, die in seiner Terminologie als „Szenen“ bezeichnet werden.</font></font><br>
<br>
<img src="https://habrastorage.org/files/963/588/075/963588075d534090bab5100c83c1dfa7.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Gerät können Sie virtuelle Sensoren erstellen und deren Informationen mithilfe von http-Anforderungen aktualisieren, was ich mit Himbeer-Pi getan habe. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beispielanforderung: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP-Adresse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3480 / data_request? Id = Variablensatz &amp; DeviceNum = 6 &amp; serviceId = Urne: micasaverde-com: serviceId: DoorLock1 &amp; Variable = Status &amp; Wert = 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das heißt, Malinka liest Daten vom Kohlendioxiddetektor und überträgt dann die Daten-http-Anforderung an Vera. </font><font style="vertical-align: inherit;">Das Schema ist einfach, funktioniert aber.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Software-Revision</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt also eine „Himbeere“, egal welche Version, die Hauptsache ist, dass sie eine Netzwerkschnittstelle hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Nächstes müssen Sie die Unterstützung für versteckte Geräte installieren. Diese Bibliothek stammt aus git, daher sollte git auf dem "malink" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
installiert werden </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">apt-get install libcurl4-gnutls-dev libexpat1-dev gettext libz-dev libssl-dev </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laden Sie als Nächstes </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Klonbibliothek mkdir hidapi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cd hidapi / </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git init </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git</font></font><a href=""><font style="vertical-align: inherit;"></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selbst herunter und </font><i><font style="vertical-align: inherit;">installieren Sie sie </font></i><i><a href=""><font style="vertical-align: inherit;">github.com/signal11/hidapi.git</font></a></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Zusätzliche Bibliotheken </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sudo apt-get install libudev-dev libusb-1.0-0-dev libfox-1.6-dev autotools-dev autoconf automake libtool </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installiere </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd hidapi / </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
./bootstrap </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
./configure </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
make </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sudo make installieren</font></font><br>
</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laden Sie danach den Quellcode des CO2-Überwachungsprogramms herunter. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mkdir co2monitor </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cd co2monitor </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git init </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git clone </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/dmage/co2mon.git</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Als Nächstes habe ich den Programmcode ein wenig angepasst. In der ersten Version werden zwei Parameter (Temperatur und CO2) gelesen und in einer Endlosschleife an die Konsole gesendet . Diese Option passte nicht zu mir, das Ziel war es, sie einmal auszuführen und den Wert einmal zu erhalten, also habe ich zwei Zeilen in der main.c. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir suchen nach Zeilen </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf ("CntR \ t% s \ n", buf); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fflush (stdout);</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Und wechseln Sie zu </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf ("% s \ n", buf); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fflush (stdout); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
exit (1);</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Zeile ist für die Ausgabe des Werts verantwortlich. Nach der Änderung wird nur die Ziffer angezeigt. Nach der Ausgabe wird das Programm geschlossen und die Ausgangszeile (1) reagiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compile </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmake ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
make</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Als Nächstes haben wir ein einfaches Skript geschrieben, das das Programm startet, die Ausgabewerte des oben kompilierten Programms einer Variablen zuweist und diesen Wert dann mit curl an MicasaVerde übergibt. Fügen Sie danach die udev-Regel hinzu, damit das System ohne root auf den Sensor zugreifen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SUBSYSTEM == "usb", ATTR {idVendor} == "04d9", ATTR {idProduct} == "a052", MODE = "0666" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und fügen Sie das </font><font style="vertical-align: inherit;">Abruf- </font><font style="vertical-align: inherit;">und Übertragungsskript jede Minute zu cron hinzu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
crontab -e </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und füge die Zeile hinzu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* * * * * /home/pi/co2sender.sh </font></font><br>
<br>
<img src="https://habrastorage.org/files/2cb/23c/1b2/2cb23c1b202f4aa5aad89c8c70c69148.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Ergebnis des Skripts</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich müssen Sie die MicasaVerde-Dateien noch so konfigurieren, dass überall ausreichende Datensätze vorhanden sind. </font><font style="vertical-align: inherit;">Aber es funktioniert schnell und einfach.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis verfügen wir über ein System, das auf dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CO2-Detektor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> basiert </font><font style="vertical-align: inherit;">und wie gewohnt arbeitet und Änderungen der Kohlendioxidkonzentration analysiert und darüber berichtet. </font><font style="vertical-align: inherit;">Gleichzeitig liest Malinka einmal pro Minute Daten vom Sensor und überträgt sie an den Smart-Home-Controller, der bei Bedarf das Lüftungssystem einschalten kann.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de390859/">https://habr.com/ru/post/de390859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de390845/index.html">Überprüfung der 8-Zoll "thermonuklearen" Tablette bb-mobile Topol 'LTE</a></li>
<li><a href="../de390849/index.html">US-Zollbeamte beginnen mit der Biometrie von Personen, die die US-Grenze zu Fuß überschreiten</a></li>
<li><a href="../de390851/index.html">Praktische Anwendung von ROS auf dem Raspberry Pi - Teil 3</a></li>
<li><a href="../de390853/index.html">In den meisten Fällen versuchten Manager 2015, vertrauliche Informationen aus ihrem eigenen Unternehmen zu stehlen</a></li>
<li><a href="../de390855/index.html">Die Milchstraße wurde im Submillimeterbereich untersucht. ATLASGAL-Projekt abgeschlossen</a></li>
<li><a href="../de390863/index.html">Video: Ausstrahlung des Samsung Galaxy Lineup Updates</a></li>
<li><a href="../de390865/index.html">SpaceX verschiebt den Start von SES-9 ein zweites Mal (Aktualisierung: Ab dem 5. Mal gestartet, Landung fehlgeschlagen)</a></li>
<li><a href="../de390867/index.html">Гомеопатия: индустрия плацебо с миллиардными доходами</a></li>
<li><a href="../de390869/index.html">ASU Cast One - Smart Watch-Projektor muss im Sommer in den Handel kommen</a></li>
<li><a href="../de390871/index.html">Asus Zenbook Pro UX501VW Laptop Video Bewertung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>