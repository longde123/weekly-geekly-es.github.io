<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👑 🍽️ 👨‍❤️‍💋‍👨 逆转和入侵Aigo的自加密外部硬盘。 第1部分：剖析 🤤 🧑🏿‍🤝‍🧑🏼 🏗️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="反转和破解外部自加密驱动器是我的旧爱好。 过去，我曾经使用过诸如Zalman VE-400，Zalman ZM-SHE500和Zalman ZM-VE500之类的模型进行练习。 最近，一个同事给我带来了另一个展览：爱国者（Aigo）SK8671，它是按照典型设计制造的-LCD指示器和用于输入PIN码...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>逆转和入侵Aigo的自加密外部硬盘。 第1部分：剖析</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455515/"><p> 反转和破解外部自加密驱动器是我的旧爱好。 过去，我曾经使用过诸如Zalman VE-400，Zalman ZM-SHE500和Zalman ZM-VE500之类的模型进行练习。 最近，一个同事给我带来了另一个展览：爱国者（Aigo）SK8671，它是按照典型设计制造的-LCD指示器和用于输入PIN码的键盘。 这就是它的来历... </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.简介</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2.硬件架构</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-2.1。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">主板</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-2.2。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">液晶板</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-2.3。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">键盘板</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-2.4。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我们看一下电线</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.攻击步骤的顺序</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-3.1。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">删除SPI闪存驱动器的数据转储</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-3.2。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">嗅探通讯</a> </p><br><p><img src="https://habrastorage.org/webt/wx/nm/gk/wxnmgkeurrmiurx87rujoynxrsq.jpeg"></p><a name="habracut"></a><br><a name="a1"></a><br><h1 id="1-vvedenie">  1.简介 </h1><br><p><img src="https://habrastorage.org/webt/rb/oq/4n/rboq4nvybyfanowvledmkbcfyww.jpeg"><br>  <em>房屋</em> </p><br><p><img src="https://habrastorage.org/webt/n8/cu/bd/n8cubdbf1sr0ejoafvh9qktfdiy.jpeg"><br>  <em>包装方式</em> </p><br><p> 输入PIN码后，可以访问存储在磁盘上的数据（据称已加密）。 此设备的一些介绍性注意事项： </p><br><ul><li> 要更改密码，请在解锁前按F1键； </li><li> 密码必须在6到9位之间； </li><li>  15次错误尝试后，磁盘将被清除。 </li></ul><br><a name="a2"></a><br><h1 id="2-apparatnaya-arhitektura">  2.硬件架构 </h1><br><p> 首先，我们将设备分成几部分，以了解其由哪些组件组成。 最繁琐的任务是打开盒子：许多微小的嵌齿轮和塑料。 打开机壳后，我们看到以下内容（请注意由我焊接的五针连接器）： </p><br><p><img src="https://habrastorage.org/webt/wf/yy/6m/wfyy6mnjauhszmkgkukchy3q5yk.jpeg"></p><br><a name="a21"></a><br><h2 id="21-osnovnaya-plata">  2.1。 主板 </h2><br><p> 主板非常简单： </p><br><p><img src="https://habrastorage.org/webt/69/n6/da/69n6dayylddfb1cbhpytgbl4y5y.jpeg"></p><br><p> 它最值得注意的部分（请参见从上到下）： </p><br><ul><li>  LCD连接器（CN1）; </li><li> 高音扬声器（SP1）; </li><li>  Pm25LD010（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">规格</a> ）SPI闪存驱动器（U2）; </li><li> 用于USB-SATA（U1）的Jmicron JMS539控制器（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">规范</a> ）； </li><li>  USB 3连接器（J1）。 </li></ul><br><p>  SPI闪存驱动器存储JMS539的固件和某些设置。 </p><br><a name="a22"></a><br><h2 id="22-plata-zhk-indikatora">  2.2。 液晶板 </h2><br><p> 液晶板上没有什么特别的。 </p><br><p><img src="https://habrastorage.org/webt/jd/49/fl/jd49flekfpte0q31hl6nv3pfcbo.jpeg"><br><img src="https://habrastorage.org/webt/qs/j_/vc/qsj_vchcmyj0eigmolvy-10mrh0.jpeg"></p><br><p> 只是： </p><br><ul><li>  LCD指示器来源不明（可能带有中文字体）； 具有顺序控制； </li><li> 键盘板的带状连接器。 </li></ul><br><a name="a23"></a><br><h2 id="23-klaviaturnaya-plata">  2.3。 键盘板 </h2><br><p> 当您查看键盘面板时，事情会变得更加有趣。 </p><br><p><img src="https://habrastorage.org/webt/qh/gr/df/qhgrdfppixqecphruejzkdtd0_g.jpeg"></p><br><p> 在背面，我们看到带状连接器以及赛普拉斯CY8C21434-微控制器PSoC 1（以下简称为PSoC） </p><br><p><img src="https://habrastorage.org/webt/bm/bs/ly/bmbslyrwh20yn47te073qtleiw0.jpeg"></p><br><p>  CY8C21434使用M8C指令集（请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档</a> ）。 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">产品页面上，</a>表明它支持<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CapSense</a>技术（赛普拉斯的电容式键盘解决方案）。 在这里，我可以看到由我焊接的五针连接器-这是通过ISSP接口连接外部编程器的标准方法。 </p><br><a name="a24"></a><br><h2 id="24-smotrim-na-provoda">  2.4。 我们看一下电线 </h2><br><p> 让我们找出与此有关的内容。 为此，用万用表将导线振铃就足够了： </p><br><p><img src="https://habrastorage.org/webt/wa/ox/uz/waoxuzmwczjnhtih625bqj6myga.png"></p><br><p> 此膝上图的说明： </p><br><ul><li>  PSoC在技术规范中进行了描述。 </li><li> 第二个连接器，右边的一个是ISSP接口，按照命运的决定，它对应于Internet上关于它的内容。 </li><li> 最右边的连接器是带键盘的带状连接器的端子； </li><li> 黑色矩形是CN1连接器的图形，用于将主板连接到LCD板。  P11，P13和P4-连接到LCD板上的PSoC引脚11、13和4。 </li></ul><br><a name="a3"></a><br><h1 id="3-posledovatelnost-shagov-ataki">  3.攻击步骤的顺序 </h1><br><p> 现在我们知道该驱动器由什么组成，我们需要：1）确保基本存在加密功能；  2）了解如何生成/存储加密密钥；  3）查找准确检查了密码的位置。 </p><br><p> 为此，我已经完成了以下步骤： </p><br><ul><li> 删除了SPI闪存驱动器的数据转储； </li><li> 我试图删除PSoC闪存驱动器的数据转储。 </li><li> 确保赛普拉斯PSoC与JMS539之间的数据交换实际上包含所按下的键； </li><li> 确保更改密码时，SPI闪存驱动器中不会覆盖任何内容； </li><li> 太懒了，无法从JMS539撤消8051固件。 </li></ul><br><a name="a31"></a><br><h2 id="31-snimaem-damp-dannyh-spi-fleshki">  3.1。 删除SPI闪存驱动器的数据转储 </h2><br><p> 此过程非常简单： </p><br><ul><li> 将探头连接到闪存驱动器的支脚：CLK，MOSI，MISO和（可选）EN； </li><li> 使用嗅探器使用逻辑分析仪进行“嗅探”通信（我使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Saleae Logic Pro 16</a> ）； </li><li> 解码SPI协议并将结果导出到CSV; </li><li> 使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">decode_spi.rb解析</a>结果并进行转储。 </li></ul><br><p> 请注意，这种方法在JMS539控制器的情况下特别有效，因为该控制器在初始化阶段从USB闪存驱动器加载了整个固件。 </p><br><pre><code class="plaintext hljs">$ decode_spi.rb boot_spi1.csv dump 0.039776 : WRITE DISABLE 0.039777 : JEDEC READ ID 0.039784 : ID 0x7f 0x9d 0x21 --------------------- 0.039788 : READ @ 0x0 0x12,0x42,0x00,0xd3,0x22,0x00, [...] $ ls --size --block-size=1 dump 49152 dump $ sha1sum dump 3d9db0dde7b4aadd2b7705a46b5d04e1a1f3b125 dump</code> </pre> <br><p> 从SPI闪存驱动器中删除转储后，我得出的结论是，它的唯一任务是存储JMicron控制单元的固件，该单元内置于8051微控制器中。 不幸的是，转储SPI闪存驱动器原来是没有用的： </p><br><ul><li> 更改PIN码时，闪存驱动器转储保持不变； </li><li> 初始化阶段之后，设备将无法访问SPI闪存驱动器。 </li></ul><br><a name="a32"></a><br><h2 id="32-obnyuhivaem-kommunikacii">  3.2。 嗅探通讯 </h2><br><p> 这是找到哪个芯片负责检查感兴趣的时间/内容的通信的一种方法。 众所周知，USB-SATA控制器通过CN1连接器和两条胶带连接到Cypress PSoC LCD。 因此，我们将探针连接到三个相应的分支： </p><br><ul><li>  P4，通用输入/输出； </li><li>  P11，I2C SCL； </li><li>  P13，I2C SDA。 </li></ul><br><p><img src="https://habrastorage.org/webt/dx/pf/gt/dxpfgtrawhj8ddziq_evoclmrs0.jpeg"></p><br><p> 然后，我们启动Saleae逻辑分析仪，并在键盘上输入：“ 123456〜”。 结果，我们看到下图。 </p><br><p><img src="https://habrastorage.org/webt/ai/d9/dg/aid9dgvtwdzzsgkzgbnwgvlxnya.png"></p><br><p> 在其上，我们可以看到三个数据交换通道： </p><br><ul><li> 信道P4有几个短脉冲串； </li><li> 在P11和P13上-几乎连续的数据交换。 </li></ul><br><p> 增加通道P4上的第一个脉冲串（上图的蓝色矩形），我们看到以下内容： </p><br><p><img src="https://habrastorage.org/webt/_v/iu/yi/_viuyiqhajm685cu9yc2rrwxoem.png"></p><br><p> 在这里，您可以看到在P4上几乎有70ms的均匀信号，起初在我看来，它起着时钟信号的作用。 但是，花了一些时间来验证我的直觉后，我发现这不是时钟信号，而是按下键时输出到squeaker的音频流。 因此，此信号部分本身不包含对我们有用的信息。 但是，它可以用作指示符-了解PSoC注册按键的时间。 </p><br><p> 但是，P4通道的最后一个音频流与其他通道略有不同：这是“错误密码”的声音！ </p><br><p> 返回击键图，增加最后一个音频流的图（再次参见蓝色矩形）时，我们得到： </p><br><p><img src="https://habrastorage.org/webt/vs/e7/tl/vse7tleuvfbpoybhymvb5bsm-rw.png"></p><br><p> 在这里，我们在P11上看到单调信号。 所以看起来这是时钟。  P13是数据。 请注意，蜂鸣结束后花样如何变化。 看看这里发生了什么会很有趣。 </p><br><p> 用两根线工作的协议通常是SPI或I2C，赛普拉斯的技术规范说这些触点对应于I2C，正如我们所看到的，这对于我们的情况是正确的： </p><br><p><img src="https://habrastorage.org/webt/bc/pj/hy/bcpjhy-jy0c-tn6t5kuwkdgpjbi.png"></p><br><p>  USB-SATA芯片组不断轮询PSoC-读取密钥状态，默认为“ 0”。 然后，当您按下“ 1”键时，它将变为“ 1”。 如果输入了错误的PIN码，则在按“〜”后立即进行的最终发送会有所不同。 但是，目前我还没有检查实际发送到那里的内容。 但是我怀疑这几乎不​​是加密密钥。 无论如何，请参见下一节以了解如何删除内部PSoC固件的转储。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455515/">https://habr.com/ru/post/zh-CN455515/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455505/index.html">React应用加速四倍</a></li>
<li><a href="../zh-CN455507/index.html">Datatable Python软件包概述</a></li>
<li><a href="../zh-CN455509/index.html">为什么我仍然使用jQuery的故事</a></li>
<li><a href="../zh-CN455511/index.html">睡眠是程序员大脑的主要资源</a></li>
<li><a href="../zh-CN455513/index.html">爆炸与全球阴谋：锂离子电池创造的故事</a></li>
<li><a href="../zh-CN455517/index.html">有关银行业的Netology课程“数据科学”的毕业生</a></li>
<li><a href="../zh-CN455519/index.html">我们如何实现新开发人员的入职</a></li>
<li><a href="../zh-CN455523/index.html">OpenStack LBaaS UI实施</a></li>
<li><a href="../zh-CN455525/index.html">Zimbra和邮件炸弹防御</a></li>
<li><a href="../zh-CN455527/index.html">这写了什么？ JavaScript对象的幕后花絮</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>