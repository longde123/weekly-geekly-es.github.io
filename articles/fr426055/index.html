<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèæ üéõÔ∏è üëâüèª TensorFlow.js et clmtrackr.js: suivre la direction du regard de l'utilisateur dans le navigateur ‚õ©Ô∏è üèì üëÇüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'auteur de l'article, dont nous publions la traduction, propose de parler de la r√©solution de probl√®mes dans le domaine de la vision par ordinateur e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TensorFlow.js et clmtrackr.js: suivre la direction du regard de l'utilisateur dans le navigateur</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/426055/">  L'auteur de l'article, dont nous publions la traduction, propose de parler de la r√©solution de probl√®mes dans le domaine de la vision par ordinateur exclusivement au moyen d'un navigateur Web.  R√©soudre un tel probl√®me n'est pas si difficile gr√¢ce √† la biblioth√®que JavaScript <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TensorFlow</a> .  Au lieu de former notre propre mod√®le et de le proposer aux utilisateurs dans le cadre du produit fini, nous leur donnerons la possibilit√© de collecter ind√©pendamment des donn√©es et de former le mod√®le directement dans un navigateur, sur notre propre ordinateur.  Avec cette approche, le traitement des donn√©es c√¥t√© serveur est totalement inutile. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1n/6k/57/1n6k57nn-wdkux5hhohvjnyadve.jpeg"></div><br>  Vous pouvez d√©couvrir ce que ce mat√©riau est d√©di√© √† la cr√©ation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Pour cela, vous aurez besoin d'un navigateur, d'une webcam et d'une souris modernes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici le</a> code source du projet.  Il n'est pas con√ßu pour fonctionner sur des appareils mobiles, l'auteur du document dit qu'il n'a pas eu le temps d'apporter les am√©liorations appropri√©es.  De plus, il note que la t√¢che consid√©r√©e ici deviendra plus compliqu√©e si vous devez traiter le flux vid√©o d'une cam√©ra en mouvement. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Id√©e</font> </h2><br>  Utilisons la technologie d'apprentissage automatique pour savoir exactement o√π l'utilisateur regarde lorsqu'il regarde une page Web.  Nous le faisons en regardant ses yeux √† l'aide d'une webcam. <br><br>  Il est tr√®s facile d'acc√©der √† la webcam dans le navigateur.  Si nous supposons que l'image enti√®re de la cam√©ra sera utilis√©e comme entr√©e pour le r√©seau neuronal, alors nous pouvons dire qu'elle est trop grande pour ces fins.  Le syst√®me devra faire beaucoup de travail juste pour d√©terminer la place dans l'image o√π se trouvent les yeux.  Cette approche peut bien se montrer si nous parlons d'un mod√®le que le d√©veloppeur forme seul et d√©ploie sur le serveur, mais si nous parlons de formation et d'utilisation du mod√®le dans un navigateur, c'est trop. <br><br>  Afin de faciliter la t√¢che du r√©seau, nous pouvons lui fournir seulement une partie de l'image - celle qui contient les yeux de l'utilisateur et une petite zone autour d'eux.  Cette zone, qui est un rectangle entourant les yeux, peut √™tre identifi√©e √† l'aide d'une biblioth√®que tierce.  Par cons√©quent, la premi√®re partie de notre travail ressemble √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pg/fc/fp/pgfcfppfo3_6wddvm58zikfoqlw.png"></div><br>  <i><font color="#999999">Entr√©e webcam, reconnaissance faciale, d√©tection des yeux, image recadr√©e</font></i> <br><br>  Pour d√©tecter le visage dans l'image, j'ai utilis√© une biblioth√®que appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">clmtrackr</a> .  Il n'est pas parfait, mais diff√®re par sa petite taille, ses bonnes performances et, en g√©n√©ral, il accomplit sa t√¢che avec dignit√©. <br><br>  Si une image petite mais s√©lectionn√©e intelligemment est utilis√©e comme entr√©e pour un r√©seau neuronal convolutionnel simple, le r√©seau peut apprendre sans aucun probl√®me.  Voici √† quoi ressemble ce processus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yh/k_/th/yhk_thr05faoc09immbn8fz1vou.png"></div><br>  <i><font color="#999999">L'image d'entr√©e, le mod√®le est un r√©seau neuronal convolutif, les coordonn√©es, l'endroit pr√©dit par le r√©seau sur la page o√π l'utilisateur regarde.</font></i> <br><br>  Une mise en ≈ìuvre minimale pleinement op√©rationnelle des id√©es discut√©es dans cette section sera d√©crite ici.  Le projet, dont le code se trouve dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce</a> r√©f√©rentiel, poss√®de de nombreuses fonctionnalit√©s suppl√©mentaires. <br><br><h2>  <font color="#3AC1EF">La pr√©paration</font> </h2><br>  Pour commencer, <code>clmtrackr.js</code> partir du <a href="">r√©f√©rentiel</a> appropri√©.  Nous allons commencer le travail avec un fichier HTML vide, qui importe jQuery, TensorFlow.js, clmtrackr.js et le fichier <code>main.js</code> avec notre code, sur lequel nous travaillerons un peu plus tard: <br><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://code.jquery.com/jquery-3.3.1.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.12.0"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clmtrackr.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Recevoir un flux vid√©o depuis une webcam</font> </h2><br>  Afin d'activer la webcam et d'afficher le flux vid√©o sur la page, nous devons obtenir l'autorisation de l'utilisateur.  Ici, je ne fournis pas de code qui r√©sout les probl√®mes de compatibilit√© du projet avec diff√©rents navigateurs.  Nous partirons de l'hypoth√®se que nos utilisateurs travaillent sur Internet en utilisant la derni√®re version de Google Chrome. <br><br>  Ajoutez le code suivant au fichier HTML.  Il doit √™tre situ√© dans la <code>&lt;body&gt;</code> , mais au-dessus des balises <code>&lt;script&gt;</code> : <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"webcam"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoplay</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Maintenant, travaillons avec le fichier <code>main.js</code> : <br><br><pre> <code class="hljs javascript">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> video = $(<span class="hljs-string"><span class="hljs-string">'#webcam'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStreaming</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">) </span></span>{   video.srcObject = stream; } navigator.mediaDevices.getUserMedia({ <span class="hljs-attr"><span class="hljs-attr">video</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }).then(onStreaming); });</code> </pre> <br>  Essayez ce code par vous-m√™me.  Lorsque vous ouvrez la page, le navigateur doit demander la permission, puis une image de la webcam appara√Ætra √† l'√©cran. <br><br>  Plus tard, nous √©tendrons le code de la fonction <code>onStreaming()</code> . <br><br><h2>  <font color="#3AC1EF">Recherche de visage</font> </h2><br>  Utilisons maintenant la biblioth√®que clmtrackr.js pour rechercher des visages dans la vid√©o.  Tout d'abord, initialisez le syst√®me de suivi des visages en ajoutant le code suivant apr√®s <code>const video = ...</code> : <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ctrack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> clm.tracker(); ctrack.init();</code> </pre> <br>  Maintenant, dans la fonction <code>onStreaming()</code> , nous connectons le syst√®me de recherche de visage en y ajoutant la commande suivante: <br><br><pre> <code class="hljs pgsql">ctrack.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>(video);</code> </pre> <br>  C'est tout ce dont nous avons besoin.  D√©sormais, le syst√®me pourra reconna√Ætre le visage dans le flux vid√©o. <br><br>  Ne croyez pas?  Dessinons un ¬´masque¬ª autour de votre visage pour nous assurer que cela est vrai. <br>  Pour ce faire, nous devons afficher l'image au-dessus de l'√©l√©ment responsable de la diffusion de la vid√©o.  Vous pouvez dessiner quelque chose sur des pages HTML √† l'aide de la <code>&lt;canvas&gt;</code> .  Par cons√©quent, nous allons cr√©er un tel √©l√©ment en le superposant √† l'√©l√©ment qui affiche la vid√©o.  Le code suivant nous aidera √† cela, qui doit √™tre ajout√© au fichier HTML sous l'√©l√©ment <code>&lt;video&gt;</code> qui est d√©j√† l√†: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"overlay"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#webcam</span></span></span><span class="css">, </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#overlay</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">left</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Si vous le souhaitez, vous pouvez d√©placer le style en ligne dans un fichier CSS distinct. <br><br>  Ici, nous avons ajout√© un <code>&lt;canvas&gt;</code> la m√™me taille √† la page que l'√©l√©ment <code>&lt;video&gt;</code> .  Le fait que les √©l√©ments seront plac√©s dans la m√™me position est assur√© par les styles utilis√©s ici. <br><br>  Maintenant, chaque fois que le navigateur affiche la prochaine image de la vid√©o, nous allons dessiner quelque chose sur l' <code>&lt;canvas&gt;</code> .  L'ex√©cution de tout code lors de la sortie de chaque trame est effectu√©e √† l'aide du m√©canisme <code>requestAnimationLoop()</code> .  Avant de sortir quoi que ce soit vers l' <code>&lt;canvas&gt;</code> , nous devons en retirer ce qui √©tait dessus avant, le vider.  Nous pouvons alors sugg√©rer √† <code>clmtrackr</code> de sortir le graphique directement vers l' <code>&lt;canvas&gt;</code> . <br><br>  Voici le code qui impl√©mente ce dont nous venons de parler.  Ajoutez-le sous la commande <code>ctrack.init()</code> : <br><br><pre> <code class="hljs matlab">const overlay = $(<span class="hljs-string"><span class="hljs-string">'#overlay'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const overlayCC = overlay.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trackingLoop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { // ,     , //     -   . </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestAnimationFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(trackingLoop)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentPosition</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ctrack</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlayCC</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearRect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0, 0, 400, 300)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(currentPosition)</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ctrack</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(overlay)</span></span></span><span class="hljs-function">; } }</span></span></code> </pre> <br>  Appelez maintenant la fonction <code>trackingLoop()</code> dans la fonction <code>onStreaming()</code> imm√©diatement apr√®s <code>ctrack.start()</code> .  Cette fonction planifiera elle-m√™me son propre red√©marrage dans chaque trame. <br><br>  Actualisez la page et regardez la webcam.  Vous devriez voir un ¬´masque¬ª vert autour de votre visage dans la fen√™tre vid√©o.  Parfois, pour que le syst√®me reconnaisse correctement le visage, vous devez d√©placer l√©g√®rement votre t√™te dans le cadre. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/394/ab1/98a/394ab198a25c82f7a6c03eefdbe7c73c.png"></div><br>  <i><font color="#999999">R√©sultats de reconnaissance faciale</font></i> <br><br><h2>  <font color="#3AC1EF">Identification de la zone d'image contenant les yeux</font> </h2><br>  Maintenant, nous devons trouver la zone rectangulaire de l'image dans laquelle se trouvent les yeux et la placer sur un <code>&lt;canvas&gt;</code> s√©par√©. <br><br>  Heureusement, cmltracker nous donne non seulement des informations sur l'emplacement du visage, mais aussi 70 points de contr√¥le.  Si vous consultez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> de cmltracker, vous pouvez s√©lectionner exactement les points de contr√¥le dont nous avons besoin. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e7/334/c6f/6e7334c6fa51c5c55ebd66b45d0d8dd8.png"></div><br>  <i><font color="#999999">Points de contr√¥le</font></i> <br><br>  Nous d√©cidons que les yeux sont la partie rectangulaire de l'image, dont les bords touchent les points 23, 28, 24 et 26, agrandis de 5 pixels dans chaque direction.  Ce rectangle doit inclure tout ce qui est important pour nous, √† moins que l'utilisateur incline trop la t√™te. <br><br>  Maintenant, avant de pouvoir utiliser ce fragment de l'image, nous avons besoin d'un <code>&lt;canvas&gt;</code> pour sa sortie.  Ses dimensions seront de 50x25 pixels.  Un rectangle avec des yeux rentrera dans cet √©l√©ment.  Une l√©g√®re d√©formation de l'image n'est pas un probl√®me. <br><br>  Ajoutez ce code au fichier HTML qui d√©crit l' <code>&lt;canvas&gt;</code> , qui inclura la partie de l'image qui a des yeux: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eyes"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"50"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#eyes</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">right</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  La fonction suivante renverra les coordonn√©es <code>x</code> et <code>y</code> , ainsi que la largeur et la hauteur du rectangle entourant les yeux.  Il prend en entr√©e un tableau de <code>positions</code> re√ßues de clmtrackr.  Notez que chaque coordonn√©e re√ßue de clmtrackr a des composants <code>x</code> et <code>y</code> .  Cette fonction doit √™tre ajout√©e √† <code>main.js</code> : <br><br><pre> <code class="hljs markdown">function getEyesRectangle(positions) { const minX = positions[<span class="hljs-string"><span class="hljs-string">23</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">0</span></span>] - 5; const maxX = positions[<span class="hljs-string"><span class="hljs-string">28</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">0</span></span>] + 5; const minY = positions[<span class="hljs-string"><span class="hljs-string">24</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1</span></span>] - 5; const maxY = positions[<span class="hljs-string"><span class="hljs-string">26</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1</span></span>] + 5; const width = maxX - minX; const height = maxY - minY; return [minX, minY, width, height]; }</code> </pre> <br>  Maintenant, dans chaque image, nous allons extraire un rectangle avec les yeux du flux vid√©o, l'encercler avec une ligne rouge sur l' <code>&lt;canvas&gt;</code> , qui est superpos√© √† l'√©l√©ment <code>&lt;video&gt;</code> , puis le copier dans le nouvel <code>&lt;canvas&gt;</code> .  Veuillez noter que pour identifier correctement la zone dont nous avons besoin, nous calculerons les indicateurs <code>resizeFactorX</code> et <code>resizeFactorY</code> . <br><br>  Remplacez le bloc <code>if</code> dans la fonction <code>trackingLoop()</code> par le code suivant: <br><br><pre> <code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentPosition) { //  ,     //   &lt;canvas&gt;,    &lt;video&gt; ctrack.draw(overlay); //  ,  ,    //   const eyesRect = getEyesRectangle(currentPosition); overlayCC.strokeStyle = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; overlayCC.strokeRect(eyesRect[<span class="hljs-number"><span class="hljs-number">0</span></span>], eyesRect[<span class="hljs-number"><span class="hljs-number">1</span></span>], eyesRect[<span class="hljs-number"><span class="hljs-number">2</span></span>], eyesRect[<span class="hljs-number"><span class="hljs-number">3</span></span>]); //      , //        //      const resizeFactorX = video.videoWidth / video.width; const resizeFactorY = video.videoHeight / video.height; //          //    &lt;canvas&gt; const eyesCanvas = <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const eyesCC = eyesCanvas.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>); eyesCC.drawImage(   video,   eyesRect[<span class="hljs-number"><span class="hljs-number">0</span></span>] * resizeFactorX, eyesRect[<span class="hljs-number"><span class="hljs-number">1</span></span>] * resizeFactorY,   eyesRect[<span class="hljs-number"><span class="hljs-number">2</span></span>] * resizeFactorX, eyesRect[<span class="hljs-number"><span class="hljs-number">3</span></span>] * resizeFactorY,   <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, eyesCanvas.width, eyesCanvas.height ); }</code> </pre> <br>  Apr√®s avoir recharg√© la page maintenant, vous devriez voir un rectangle rouge autour des yeux, et ce que ce rectangle contient est dans l' <code>&lt;canvas&gt;</code> correspondant.  Si vos yeux sont plus grands que les miens, <code>getEyeRectangle</code> fonction <code>getEyeRectangle</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c8/29e/5a3/6c829e5a354575ed9c269bebf20c5a5a.png"></div><br>  <i><font color="#999999">√©l√©ment &lt;canvas&gt; qui dessine un rectangle contenant l'image des yeux de l'utilisateur</font></i> <br><br><h2>  <font color="#3AC1EF">Collecte de donn√©es</font> </h2><br>  Il existe de nombreuses fa√ßons de collecter des donn√©es.  J'ai d√©cid√© d'utiliser les informations qui peuvent √™tre obtenues √† partir de la souris et du clavier.  Dans notre projet, la collecte de donn√©es ressemble √† ceci. <br><br>  L'utilisateur d√©place le curseur sur la page et le regarde des yeux, en appuyant sur la <code></code> du clavier chaque fois que le programme a besoin d'enregistrer un autre √©chantillon.  Avec cette approche, il est facile de collecter rapidement un grand ensemble de donn√©es pour la formation du mod√®le. <br><br><h3>  <font color="#3AC1EF">‚ñçSuivi de la souris</font> </h3><br>  Afin de savoir exactement o√π se trouve le pointeur de la souris sur la page Web, nous avons besoin d'un gestionnaire d'√©v√©nements <code>document.onmousemove</code> .  De plus, notre fonction normalise les coordonn√©es afin qu'elles s'inscrivent dans la plage [-1, 1]: <br><br><pre> <code class="hljs pgsql">//   : const mouse = { x: <span class="hljs-number"><span class="hljs-number">0</span></span>, y: <span class="hljs-number"><span class="hljs-number">0</span></span>, handleMouseMove: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(event) {   //      ,    [<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]   mouse.x = (event.clientX / $(<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>).width()) * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>;   mouse.y = (event.clientY / $(<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>).height()) * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>; }, } document.onmousemove = mouse.handleMouseMove;</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñç Capture d'image</font> </h3><br>  Pour capturer l'image affich√©e par l' <code>&lt;canvas&gt;</code> et l'enregistrer en tant que tenseur, TensorFlow.js propose la fonction d'assistance <code>tf.fromPixels()</code> .  Nous l'utilisons pour enregistrer puis normaliser l'image de l' <code>&lt;canvas&gt;</code> qui affiche un rectangle contenant les yeux de l'utilisateur: <br><br><pre> <code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { //       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tf.tidy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   const image = tf.fromPixels($(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]);   //  &lt;i&gt;&lt;font color=<span class="hljs-string"><span class="hljs-string">"#999999"</span></span>&gt;&lt;/font&gt;&lt;/i&gt;:   const batchedImage = image.expandDims(<span class="hljs-number"><span class="hljs-number">0</span></span>);   //    :   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> batchedImage.toFloat().div(tf.scalar(<span class="hljs-number"><span class="hljs-number">127</span></span>)).<span class="hljs-built_in"><span class="hljs-built_in">sub</span></span>(tf.scalar(<span class="hljs-number"><span class="hljs-number">1</span></span>)); }); }</code> </pre> <br>  Notez que la fonction <code>tf.tidy()</code> est utilis√©e pour nettoyer une fois l'op√©ration termin√©e. <br><br>  Nous pourrions simplement enregistrer tous les √©chantillons dans un grand ensemble de formation, mais en apprentissage automatique, il est important de v√©rifier la qualit√© de la formation du mod√®le.  C'est pourquoi nous devons enregistrer certains √©chantillons dans un √©chantillon de contr√¥le s√©par√©.  Apr√®s cela, nous pouvons v√©rifier le comportement du mod√®le sur les nouvelles donn√©es et d√©couvrir si le mod√®le a √©t√© trop entra√Æn√©.  √Ä cette fin, 20% du nombre total d'√©chantillons sont inclus dans l'√©chantillon t√©moin. <br><br>  Voici le code utilis√© pour collecter des donn√©es et des √©chantillons: <br><br><pre> <code class="hljs pgsql">const dataset = { train: {   n: <span class="hljs-number"><span class="hljs-number">0</span></span>,   x: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,   y: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, }, val: {   n: <span class="hljs-number"><span class="hljs-number">0</span></span>,   x: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,   y: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, }, } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> captureExample() { //            tf.tidy(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() {   const image = getImage();   const mousePos = tf.tensor1d([mouse.x, mouse.y]).expandDims(<span class="hljs-number"><span class="hljs-number">0</span></span>);   // ,    (  )     const subset = dataset[Math.random() &gt; <span class="hljs-number"><span class="hljs-number">0.2</span></span> ? <span class="hljs-string"><span class="hljs-string">'train'</span></span> : <span class="hljs-string"><span class="hljs-string">'val'</span></span>];   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (subset.x == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) {     //        subset.x = tf.keep(image);     subset.y = tf.keep(mousePos);   } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {     //          const oldX = subset.x;     const oldY = subset.y;     subset.x = tf.keep(oldX.concat(image, <span class="hljs-number"><span class="hljs-number">0</span></span>));     subset.y = tf.keep(oldY.concat(mousePos, <span class="hljs-number"><span class="hljs-number">0</span></span>));   }   //     subset.n += <span class="hljs-number"><span class="hljs-number">1</span></span>; }); }</code> </pre> <br>  Et enfin, nous devons lier cette fonction √† la <code></code> : <br><br><pre> <code class="hljs matlab">$(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).keyup(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span><span class="hljs-function"> { //         </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event.keyCode == 32)</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">captureExample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">; } });</span></span></code> </pre> <br>  D√©sormais, chaque fois que vous appuyez sur la <code></code> , l'image des yeux et les coordonn√©es du pointeur de la souris sont ajout√©es √† l'un des ensembles de donn√©es. <br><br><h2>  <font color="#3AC1EF">Formation mod√®le</font> </h2><br>  Cr√©ez un r√©seau neuronal convolutif simple.  TensorFlow.js fournit une API qui rappelle Keras √† cet effet.  Le r√©seau doit avoir une couche <code>conv2d</code> , une couche <code>maxPooling2d</code> et enfin une couche <code>dense</code> avec deux valeurs de sortie (elles repr√©sentent les coordonn√©es de l'√©cran).  En cours de route, j'ai ajout√© une couche d' <code>dropout</code> et une couche d' <code>flatten</code> au r√©seau, en tant que r√©gularisateur, afin de convertir les donn√©es bidimensionnelles en une dimension.  La formation r√©seau est effectu√©e √† l'aide de l'optimiseur Adam. <br><br>  Veuillez noter que j'ai choisi les param√®tres r√©seau utilis√©s ici apr√®s avoir exp√©riment√© avec mon MacBook Air.  Vous pouvez tr√®s bien choisir votre propre configuration du mod√®le. <br><br>  Voici le code du mod√®le: <br><br><pre> <code class="hljs powershell">let currentModel; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { const model = tf.sequential(); model.add(tf.layers.conv2d({   kernelSize: <span class="hljs-number"><span class="hljs-number">5</span></span>,   filters: <span class="hljs-number"><span class="hljs-number">20</span></span>,   strides: <span class="hljs-number"><span class="hljs-number">1</span></span>,   activation: <span class="hljs-string"><span class="hljs-string">'relu'</span></span>,   inputShape: [<span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)<span class="hljs-type"><span class="hljs-type">.height</span></span>(), <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)<span class="hljs-type"><span class="hljs-type">.width</span></span>(), <span class="hljs-number"><span class="hljs-number">3</span></span>], })); model.add(tf.layers.maxPooling2d({   poolSize: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>],   strides: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], })); model.add(tf.layers.flatten()); model.add(tf.layers.dropout(<span class="hljs-number"><span class="hljs-number">0.2</span></span>)); //    x  y model.add(tf.layers.dense({   units: <span class="hljs-number"><span class="hljs-number">2</span></span>,   activation: <span class="hljs-string"><span class="hljs-string">'tanh'</span></span>, })); //   Adam     <span class="hljs-number"><span class="hljs-number">0.0005</span></span>     MSE model.compile({   optimizer: tf.train.adam(<span class="hljs-number"><span class="hljs-number">0.0005</span></span>),   loss: <span class="hljs-string"><span class="hljs-string">'meanSquaredError'</span></span>, }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model; }</code> </pre> <br>  Avant de commencer la formation du r√©seau, nous avons d√©fini un nombre fixe d'√®res et une taille de paquet variable (car nous travaillerons probablement avec de tr√®s petits ensembles de donn√©es). <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fitModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> batchSize = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(dataset.train.n * <span class="hljs-number"><span class="hljs-number">0.1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (batchSize &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) {   batchSize = <span class="hljs-number"><span class="hljs-number">4</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (batchSize &gt; <span class="hljs-number"><span class="hljs-number">64</span></span>) {   batchSize = <span class="hljs-number"><span class="hljs-number">64</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentModel == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) {   currentModel = createModel(); } currentModel.fit(dataset.train.x, dataset.train.y, {   <span class="hljs-attr"><span class="hljs-attr">batchSize</span></span>: batchSize,   <span class="hljs-attr"><span class="hljs-attr">epochs</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>,   <span class="hljs-attr"><span class="hljs-attr">shuffle</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,   <span class="hljs-attr"><span class="hljs-attr">validationData</span></span>: [dataset.val.x, dataset.val.y], }); }</code> </pre> <br>  Ajoutez maintenant un bouton √† la page pour commencer √† apprendre.  Ce code va dans le fichier HTML: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"train"</span></span></span><span class="hljs-tag">&gt;</span></span>Train!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#train</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">left</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">transform</span></span></span><span class="css">: </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">translate</span></span></span><span class="css">(-50%, -50%);       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-size</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">24pt</span></span></span><span class="css">;   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Ce code doit √™tre ajout√© au fichier JS: <br><br><pre> <code class="hljs matlab">$(<span class="hljs-string"><span class="hljs-string">'#train'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fitModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; });</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">O√π cherche l'utilisateur?</font> </h2><br>  Maintenant que nous pouvons collecter les donn√©es et pr√©parer le mod√®le, nous pouvons commencer √† pr√©dire l'endroit sur la page o√π l'utilisateur regarde.  Nous indiquons cet endroit √† l'aide d'un cercle vert, qui se d√©place autour de l'√©cran. <br><br>  Tout d'abord, ajoutez un cercle √† la page: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#target</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-color</span></span></span><span class="css">: lightgreen;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border-radius</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">height</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">40px</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">width</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">40px</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">transition</span></span></span><span class="css">: all </span><span class="hljs-number"><span class="css"><span class="hljs-number">0.1s</span></span></span><span class="css"> ease;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">box-shadow</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">10px</span></span></span><span class="css"> white;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">4px</span></span></span><span class="css"> solid </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">rgba</span></span></span><span class="css">(0,0,0,0.5);   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Afin de la d√©placer sur la page, nous transmettons p√©riodiquement l'image actuelle des yeux du r√©seau neuronal et lui posons une question sur l'endroit o√π l'utilisateur regarde.  Le mod√®le en r√©ponse produit deux coordonn√©es le long desquelles le cercle doit √™tre d√©plac√©: <br><br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(currentModel == null)</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tf</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tidy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function()</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prediction</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentModel</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image)</span></span></span><span class="hljs-function">;   //          </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetWidth</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#target')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outerWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetHeight</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#target')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outerHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prediction.get(0, 0)</span></span></span><span class="hljs-function"> + 1) / 2 * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetWidth</span></span></span><span class="hljs-function">);   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prediction.get(0, 1)</span></span></span><span class="hljs-function"> + 1) / 2 * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetHeight</span></span></span><span class="hljs-function">);   //     :   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#target')</span></span></span><span class="hljs-function">;   $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">css</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('left', x + 'px')</span></span></span><span class="hljs-function">;   $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">css</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('top', y + 'px')</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setInterval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(moveTarget, 100)</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br>  J'ai r√©gl√© l'intervalle √† 100 millisecondes.  Si votre ordinateur n'est pas aussi puissant que le mien, vous pouvez d√©cider de l'agrandir. <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Nous avons maintenant tout ce dont nous avons besoin pour mettre en ≈ìuvre l'id√©e pr√©sent√©e au tout d√©but de ce document.  D√©couvrez ce que nous avons fait.  D√©placez le curseur de la souris en suivant ses yeux et appuyez sur la barre d'espace.  Cliquez ensuite sur le bouton D√©marrer l'entra√Ænement. <br><br>  Collectez plus de donn√©es, cliquez √† nouveau sur le bouton.  Apr√®s un certain temps, le cercle vert commencera √† se d√©placer autour de l'√©cran apr√®s votre regard.  Au d√©but, il ne sera pas particuli√®rement bon d'arriver √† l'endroit o√π vous regardez, mais, √† partir d'une cinquantaine d'√©chantillons collect√©s, apr√®s plusieurs √©tapes de formation, et si vous avez de la chance, il se d√©placera assez pr√©cis√©ment au point de la page que vous regardez. .  Le code complet de l'exemple analys√© dans ce document peut √™tre trouv√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Bien que ce que nous avons fait semble d√©j√† tr√®s int√©ressant, de nombreuses am√©liorations peuvent encore √™tre apport√©es.  Que faire si l'utilisateur bouge la t√™te ou change de position devant la cam√©ra?  Notre projet ne nuirait pas aux possibilit√©s concernant la s√©lection de la taille, de la position et de l'angle du rectangle qui d√©limite la zone d'image dans laquelle se trouvent les yeux.  En fait, plusieurs fonctionnalit√©s suppl√©mentaires sont impl√©ment√©es dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">version compl√®te de</a> l'exemple pr√©sent√© ici.  En voici quelques uns: <br><br><ul><li>  Les options de personnalisation du rectangle de d√©limitation des yeux d√©crites ci-dessus. </li><li>  Convertissez une image en niveaux de gris. </li><li>  Utilisation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CoordConv</a> . </li><li>  Une carte thermique pour v√©rifier o√π le mod√®le a bien fonctionn√© et o√π il ne l'a pas fait. </li><li>  Possibilit√© d'enregistrer et de charger des jeux de donn√©es. </li><li>  Possibilit√© d'enregistrer et de charger des mod√®les. </li><li>  Pr√©servation des poids qui ont montr√© une perte d'entra√Ænement minimale apr√®s l'entra√Ænement. </li><li>  Interface utilisateur am√©lior√©e avec de br√®ves instructions pour travailler avec le syst√®me. </li></ul><br>  <b>Chers lecteurs!</b>  Utilisez-vous TensorFlow? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426055/">https://habr.com/ru/post/fr426055/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426041/index.html">Solution symbolique d'√©quations et de syst√®mes diff√©rentiels lin√©aires par la m√©thode de transformation de Laplace utilisant SymPy</a></li>
<li><a href="../fr426045/index.html">Exceptions sp√©ciales dans .NET et comment les pr√©parer</a></li>
<li><a href="../fr426047/index.html">10 grands livres pour d√©butants en anglais</a></li>
<li><a href="../fr426051/index.html">Am√©liorer les comp√©tences de d√©bogage de logiciels - quelques conseils</a></li>
<li><a href="../fr426053/index.html">Am√©lioration de la mise en cache des gestionnaires d'√©v√©nements et des performances des applications React</a></li>
<li><a href="../fr426059/index.html">Meetup Tutu PHP # 2: Vid√©o des discours</a></li>
<li><a href="../fr426061/index.html">Microsoft rejoint le r√©seau Open Invention et octroie 60 000 licences</a></li>
<li><a href="../fr426063/index.html">Innovations de baies d'entr√©e de gamme HPE MSA: baie flash plus abordable et int√©gration de solutions riches</a></li>
<li><a href="../fr426065/index.html">Smart TV, qui d√©termine elle-m√™me la cha√Æne la plus int√©ressante, ou une solution inhabituelle de Sudoku pour le contenu vid√©o</a></li>
<li><a href="../fr426067/index.html">Se d√©pla√ßant comme deux feux? Encore une fois sur la relocalisation du personnel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>