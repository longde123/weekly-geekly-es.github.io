<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜó üõµ üå°Ô∏è Como implementamos o ML em um aplicativo com quase 50 milh√µes de usu√°rios. Experi√™ncia Sberbank üè¥ üîï ‚¨ÜÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Meu nome √© Nikolai e estou envolvido na constru√ß√£o e implementa√ß√£o de modelos de aprendizado de m√°quina no Sberbank. Hoje vou falar sobre o ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como implementamos o ML em um aplicativo com quase 50 milh√µes de usu√°rios. Experi√™ncia Sberbank</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/461747/">  Ol√° Habr!  Meu nome √© Nikolai e estou envolvido na constru√ß√£o e implementa√ß√£o de modelos de aprendizado de m√°quina no Sberbank.  Hoje vou falar sobre o desenvolvimento de um sistema de recomenda√ß√£o para pagamentos e transfer√™ncias no aplicativo em seus smartphones. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/358/23c/0f8/35823c0f8e513f268f58de291b8504c7.png"></a> <br>  <i>Design da tela principal do aplicativo m√≥vel com recomenda√ß√µes</i> <br><br>  T√≠nhamos duzentas mil op√ß√µes de pagamento poss√≠veis, 55 milh√µes de clientes, 5 fontes banc√°rias diferentes, meia coluna de desenvolvedor e uma montanha de atividades banc√°rias, algoritmos e tudo isso, todas as cores, al√©m de um litro de sementes aleat√≥rias, uma caixa de hiperpar√¢metros, meio litro de fatores de corre√ß√£o e dois dezenas de bibliotecas.  N√£o que tudo isso fosse necess√°rio no trabalho, mas desde que ele come√ßou a melhorar a vida dos clientes, siga seu hobby at√© o fim.  Sob o corte, est√° a hist√≥ria da batalha pelo UX, a formula√ß√£o correta do problema, a luta contra a dimensionalidade dos dados, a contribui√ß√£o para o c√≥digo aberto e nossos resultados. <br><br><a name="habracut"></a><br><h2>  Declara√ß√£o do problema </h2><br>  Conforme o desenvolvimento e a amplia√ß√£o, o aplicativo Sberbank Online est√° ganhando recursos √∫teis e funcionalidades adicionais.  Em particular, no aplicativo voc√™ pode transferir dinheiro ou pagar por servi√ßos de v√°rias organiza√ß√µes. <br><br>  ‚ÄúExaminamos cuidadosamente todos os caminhos do usu√°rio dentro do aplicativo e percebemos que muitos deles podem ser significativamente reduzidos.  Para isso, decidimos personalizar a tela principal em v√°rias etapas.  Primeiro, tentamos remover da tela o que o cliente n√£o usa, come√ßando com cart√µes banc√°rios.  Depois, destacaram as a√ß√µes que o cliente j√° havia executado anteriormente e para as quais ele poderia entrar no aplicativo agora.  Agora, a lista de a√ß√µes inclui pagamentos a organiza√ß√µes e transfer√™ncias para contatos, e a lista de a√ß√µes ser√° ampliada ‚Äù, disse meu colega Sergey Komarov, que est√° desenvolvendo a funcionalidade do ponto de vista do cliente na equipe do Sberbank Online.  √â necess√°rio construir um modelo que preencha os slots designados nos widgets A√ß√µes (figura acima) com recomenda√ß√µes pessoais de pagamentos e transfer√™ncias, em vez de regras simples. <br><br><h2>  Solu√ß√£o </h2><br>  N√≥s da equipe decompusemos a tarefa em duas partes: <br><br><ul><li>  a recomenda√ß√£o da repeti√ß√£o de opera√ß√µes para pagamento de servi√ßos ou transfer√™ncia de fundos (bloco "Opera√ß√µes recomendadas") <br></li><li>  recomenda√ß√£o de exemplos de solicita√ß√µes de pesquisa para pagamento por servi√ßos n√£o utilizados anteriormente por este cliente (bloco "Exemplos de pesquisa") <br></li></ul><br>  Decidimos testar a funcionalidade primeiro na guia de pesquisa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/450/0ee/8fe4500ee0d612b4210a7237a643850b.png"></div><br>  <i>Design da tela de pesquisa recomendada</i> <br><br><h2>  Opera√ß√µes recomendadas </h2><br><h3>  Otimiza√ß√£o de pontua√ß√£o </h3><br>  Se definirmos a subtarefa como uma recomenda√ß√£o para repetir opera√ß√µes, isso nos permitir√° eliminar o c√°lculo e a avalia√ß√£o de trilh√µes de combina√ß√µes de todas as opera√ß√µes poss√≠veis para todos os clientes e focar em um n√∫mero muito mais limitado.  Se, de todo o conjunto de opera√ß√µes dispon√≠veis para nossos clientes, o cliente hipot√©tico com o hash YYY utilizasse apenas pagamento por g√°s e estacionamento, avaliaremos a probabilidade de repetir apenas essas opera√ß√µes para este cliente: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33f/d0e/415/33fd0e4159a1143ff54c6834c0cd964d.png"><br>  <i>Um exemplo de redu√ß√£o da dimens√£o dos dados para pontua√ß√£o</i> <br><br><h3>  Preparando o conjunto de dados </h3><br>  A amostra √© uma observa√ß√£o transacional, enriquecida com fatores de demografia de clientes, agregados financeiros e v√°rias caracter√≠sticas de frequ√™ncia de uma opera√ß√£o espec√≠fica. <br><br>  A vari√°vel de destino neste caso √© bin√°ria e reflete o fato do evento no dia seguinte ao dia em que os fatores s√£o calculados.  Assim, movendo iterativamente o dia de calcular os fatores e definir o sinalizador da vari√°vel de destino, multiplicamos e marcamos as mesmas opera√ß√µes e as marcamos de maneira diferente, dependendo da posi√ß√£o relativa a esse dia. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/929/618/c8a/929618c8a1fbcf3b2385300bf9669ae3.png"></div><br>  <i>Esquema de Observa√ß√£o</i> <br><br>  Calculando o corte em 17/03/2019 para o cliente ‚ÄúAAA‚Äù, obtemos duas observa√ß√µes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78b/e70/741/78be707412f6a3fee92dcb5d62413de9.png"></div><br>  <i>Um exemplo das observa√ß√µes para um conjunto de dados</i> <br><br>  "Recurso 1" pode significar, por exemplo, o saldo em todos os cart√µes do cliente, "Recurso 2" - a presen√ßa desse tipo de opera√ß√£o na √∫ltima semana. <br><br>  Realizamos as mesmas transa√ß√µes, mas fazemos observa√ß√µes para treinamento em uma data diferente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/901/c8e/618/901c8e6188d792bb9c77fc207f7d95d1.png"></div><br>  <i>Esquema de Observa√ß√£o</i> <br><br>  Obteremos observa√ß√µes para um conjunto de dados com outros valores de ambos os recursos e a vari√°vel de destino: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e99/a4f/060/e99a4f0602c8c127f47aecee38f02292.png"><br>  <i>Um exemplo das observa√ß√µes para um conjunto de dados</i> <br><br>  Nos exemplos acima, para maior clareza, s√£o fornecidos os valores reais dos fatores, mas, de fato, os valores s√£o processados ‚Äã‚Äãpor um algoritmo autom√°tico: os resultados da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">convers√£o WOE</a> s√£o alimentados na entrada do modelo.  Permite trazer as vari√°veis ‚Äã‚Äãpara um relacionamento monot√¥nico com a vari√°vel de destino e, ao mesmo tempo, livrar-se dos efeitos dos outliers.  Por exemplo, temos o fator "N√∫mero de cart√µes" e alguma distribui√ß√£o da vari√°vel de destino: <br><br><img src="https://habrastorage.org/webt/4z/vz/xt/4zvzxtz04cy0corijvcyz4zfhf0.png"><br><br>  <i>Exemplo de convers√£o WOE</i> <br><br>  A transforma√ß√£o WOE nos permite transformar uma depend√™ncia n√£o linear em pelo menos uma depend√™ncia monot√¥nica.  Cada valor do fator analisado est√° associado ao seu pr√≥prio valor WOE e, assim, um novo fator √© formado, e o original √© removido do conjunto de dados: <br><br><img src="https://habrastorage.org/webt/9j/os/o4/9joso4mjqdpris64sxtrb3ji34k.png"><br>  <i>O efeito da transforma√ß√£o WOE no relacionamento com a vari√°vel de destino</i> <br><br>  O dicion√°rio para converter valores vari√°veis ‚Äã‚Äãem WOE √© salvo e usado posteriormente para pontua√ß√£o.  Ou seja, se precisarmos calcular as probabilidades para amanh√£, criamos um conjunto de dados como nas tabelas com exemplos de observa√ß√µes acima, convertemos as vari√°veis ‚Äã‚Äãnecess√°rias no WOE com o c√≥digo salvo e aplicamos o modelo nesses dados. <br><br><h3>  Treinamento </h3><br>  A escolha do m√©todo foi estritamente limitada - interpretabilidade.  Portanto, para cumprir os prazos, decidiu-se adiar as explica√ß√µes usando o mesmo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SHAP</a> na segunda metade do problema e testar m√©todos relativamente simples: regress√£o e neur√¥nios superficiais.  A ferramenta foi o SAS Miner, um software para pr√©-processamento, an√°lise e cria√ß√£o de modelos em v√°rios dados de forma interativa, o que economiza muito tempo na escrita de c√≥digo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ae/80d/b3c/1ae80db3c2741d5c70a2cbc9e48dd0ff.png"><br>  <i>Interface do SAS Miner</i> <br><br><h3>  Avalia√ß√£o da qualidade </h3><br>  A compara√ß√£o da m√©trica GINI em uma amostra fora do tempo mostrou que a rede neural lida melhor com a tarefa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d24/553/e79/d24553e79a193415b2fa94c6e3b0d987.png"></div><br>  <i>Tabela comparativa de modelos de qualidade e regras de frequ√™ncia</i> <br><br>  O modelo possui dois pontos de sa√≠da.  As recomenda√ß√µes na forma de cart√µes de widgets na tela principal incluem opera√ß√µes cuja previs√£o est√° acima de um determinado limite (veja a primeira foto na publica√ß√£o).  A borda √© selecionada com base em um equil√≠brio de qualidade e cobertura, que nessa arquitetura representa metade de todas as opera√ß√µes executadas.  As quatro principais opera√ß√µes s√£o enviadas para o bloco ‚Äúopera√ß√µes recomendadas‚Äù da tela de pesquisa (veja a segunda figura). <br><br><h2>  Exemplos de pesquisa </h2><br>  Passando para a segunda parte da tarefa, voltamos ao problema de um grande n√∫mero de op√ß√µes de pagamento poss√≠veis para os servi√ßos de provedores que precisam ser avaliados e classificados em cada cliente - trilh√µes de pares.  Al√©m disso, temos dados impl√≠citos, ou seja, n√£o h√° informa√ß√µes sobre a avalia√ß√£o dos pagamentos efetuados ou por que o cliente n√£o efetuou nenhum pagamento.  Portanto, para iniciantes, foi decidido testar v√°rios m√©todos de expans√£o da matriz de pagamentos de clientes para provedores: ALS e FM. <br><br><h3>  ALS </h3><br>  ALS (M√≠nimos Quadrados Alternados) ou M√≠nimos Quadrados Alternativos - na filtragem colaborativa, um dos m√©todos para resolver o problema de fatora√ß√£o da matriz de intera√ß√£o.  Apresentaremos nossos dados transacionais sobre pagamento de servi√ßos na forma de uma matriz na qual as colunas s√£o identificadores exclusivos dos servi√ßos de todos os provedores e as linhas s√£o clientes √∫nicos.  Nas c√©lulas, colocamos o n√∫mero de opera√ß√µes de clientes espec√≠ficos com provedores espec√≠ficos por um determinado per√≠odo de tempo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/430/fcd/db7/430fcddb7494ed4ba54411d0423b5b16.png"><br>  <i>Princ√≠pio de decomposi√ß√£o da matriz</i> <br><br>  O significado do m√©todo √© que criamos duas dessas matrizes de menor dimens√£o, cuja multiplica√ß√£o d√° o resultado mais pr√≥ximo da matriz grande original nas c√©lulas preenchidas.  O modelo aprende a criar uma descri√ß√£o fatorial oculta para clientes e fornecedores.  Uma implementa√ß√£o do m√©todo na biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">impl√≠cita</a> foi usada.  O treinamento ocorre de acordo com o seguinte algoritmo: <br><br><ol><li>  Matrizes de clientes e provedores com fatores ocultos s√£o inicializadas.  O n√∫mero deles √© o hiperpar√¢metro do modelo. <br></li><li>  A matriz de fatores ocultos dos provedores √© fixa e a derivada da fun√ß√£o de perda para a corre√ß√£o da matriz do cliente √© considerada.  O autor usou um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√©todo</a> interessante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de gradientes conjugados</a> , que permite acelerar bastante essa etapa. <br></li><li>  A etapa anterior √© repetida da mesma forma para a matriz de fatores ocultos dos clientes. </li><li>  As etapas 2 a 3 se alternam at√© que o algoritmo converja. </li></ol><br><h3>  Prepara√ß√£o </h3><br>  Os dados transacionais foram transformados em uma matriz de intera√ß√µes com um grau de escassez de ~ 99%, com grande desigualdade entre os provedores.  Para separar os dados em amostras de treinamento e valida√ß√£o, mascaramos aleatoriamente a propor√ß√£o de c√©lulas preenchidas: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d60/d96/282/d60d96282aac1b7425ee0ea597253d66.png"><br>  <i>Exemplo de compartilhamento de dados</i> <br><br>  As transa√ß√µes foram realizadas como teste no per√≠odo subsequente ao treinamento e dispostas em uma matriz do mesmo formato - que ficou fora do tempo. <br><br><h3>  Treinamento </h3><br>  O modelo possui v√°rios hiperpar√¢metros que podem ser ajustados para melhorar a qualidade: <br><br><ul><li>  Alfa √© o coeficiente pelo qual a matriz √© ponderada, ajustando o grau de confian√ßa ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">C_iu</a> ) de que o servi√ßo fornecido √© realmente "apreciado" pelo cliente. <br></li><li>  O n√∫mero de fatores nas matrizes ocultas de clientes e provedores √© o n√∫mero de colunas e linhas, respectivamente. <br></li><li>  Coeficiente de regulariza√ß√£o L2 Œª. <br></li><li>  O n√∫mero de itera√ß√µes do m√©todo. <br></li></ul><br>  Utilizamos a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hyperopt</a> , que nos permite avaliar o efeito dos hiperpar√¢metros na m√©trica da qualidade usando o m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TPE</a> e selecionar seu valor √≥timo.  O algoritmo come√ßa com uma partida a frio e faz v√°rias avalia√ß√µes da m√©trica da qualidade, dependendo dos valores dos hiperpar√¢metros analisados.  Ent√£o, em ess√™ncia, ele tenta selecionar um conjunto de valores de hiperpar√¢metros com maior probabilidade de fornecer um bom valor para a m√©trica de qualidade.  Os resultados s√£o salvos em um dicion√°rio a partir do qual voc√™ pode criar um gr√°fico e avaliar visualmente o resultado do otimizador (o azul √© melhor): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa2/175/64a/fa217564a3f448a81abbbfad1d27f7a1.png"></div><br>  <i>O gr√°fico da depend√™ncia da m√©trica de qualidade na combina√ß√£o de hiperpar√¢metros</i> <br><br>  O gr√°fico mostra que os valores dos hiperpar√¢metros afetam fortemente a qualidade do modelo.  Como √© necess√°rio aplicar intervalos para cada um deles √† entrada do m√©todo, o gr√°fico pode determinar ainda mais se faz sentido expandir o espa√ßo de valor ou n√£o.  Por exemplo, em nossa tarefa, √© claro que faz sentido testar grandes valores para o n√∫mero de fatores.  No futuro, isso realmente melhorou o modelo. <br><br><h3>  M√©trica e complexidade da avalia√ß√£o da qualidade </h3><br>  Como avaliar a qualidade do modelo?  Uma das m√©tricas mais comumente usadas para sistemas de recomenda√ß√£o em que a ordem √© importante √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MAP @ k</a> ou Precis√£o M√©dia M√©dia em K. Esta m√©trica estima a precis√£o do modelo nas recomenda√ß√µes K, levando em considera√ß√£o a ordem dos itens na lista dessas recomenda√ß√µes, em m√©dia, para todos os clientes. <br><br>  Infelizmente, uma opera√ß√£o de avalia√ß√£o da qualidade, mesmo em uma amostra, levou v√°rias horas.  Depois de arrega√ßar as mangas, come√ßamos a criar um perfil da fun√ß√£o mean_average_pecision_at_k () com a biblioteca line_profiler.  A tarefa foi ainda mais complicada pelo fato de a fun√ß√£o usar c√≥digo cython e ter que ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">levada em considera√ß√£o</a> corretamente, caso contr√°rio, as estat√≠sticas necess√°rias simplesmente n√£o foram coletadas.  Como resultado, novamente enfrentamos o problema da dimensionalidade de nossos dados.  Para calcular essa m√©trica, √© necess√°rio obter todas as estimativas poss√≠veis de cada servi√ßo para cada cliente e selecionar as principais recomenda√ß√µes pessoais de K, classificando a matriz resultante.  Mesmo considerando o uso da classifica√ß√£o parcial de numpy.argpartition () com complexidade O (n), classificar as notas acabou sendo o passo mais longo para aumentar a classifica√ß√£o da qualidade ao longo do tempo.  Como o numpy.argpartition () n√£o usou todos os kernels do nosso servidor, foi decidido melhorar o algoritmo reescrevendo essa parte no C ++ e no OpenMP via cython.  Um algoritmo brevemente novo √© o seguinte: <br><br><ol><li>  Os dados s√£o cortados em lotes pelos clientes. <br></li><li>  Uma matriz vazia e ponteiros para a mem√≥ria s√£o inicializados. <br></li><li>  As sequ√™ncias de lotes por ponteiros s√£o classificadas de duas maneiras: pela fun√ß√£o parcial_sort e, em seguida, pela biblioteca de algoritmos C ++. <br></li><li>  Os resultados s√£o gravados nas c√©lulas da matriz vazia em paralelo. <br></li><li>  Os dados s√£o retornados em python. <br></li></ol><br>  Isso nos permitiu acelerar o c√°lculo das recomenda√ß√µes v√°rias vezes.  A revis√£o foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">adicionada</a> ao reposit√≥rio oficial. <br><br><h2>  An√°lise de resultados OOT </h2><br>  E agora √© hora de avaliar a qualidade do modelo.  Por que precisamos de amostragem fora do tempo?  Se observarmos a distribui√ß√£o das opera√ß√µes pelos fornecedores, veremos a seguinte figura: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/345/5d2/3d4/3455d23d4093172fbbf416d9719e14fa.png"></div><br>  <i>Distribui√ß√£o da popularidade dos prestadores de servi√ßos</i> <br><br>  H√° um desequil√≠brio.  Isso leva ao fato de o modelo estar tentando recomendar servi√ßos populares.  De volta √† imagem acima: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ef/0fd/b08/6ef0fdb084bd7495ad12821c42cd70c2.png"><br><br>  O problema √© que, se voc√™ verificar a precis√£o do modelo, mascarando a mesma matriz, como √© aconselh√°vel em quase todos os lugares, para a maioria dos clientes (exemplos marginais: "W", "E" e "I") a qualidade das previs√µes de valida√ß√£o (fingiremos que ela n√£o participou da sele√ß√£o dos hiperpar√¢metros) ser√° alta se esses forem os fornecedores mais populares.  Como resultado, obtemos uma falsa confian√ßa na for√ßa do modelo.  Portanto, agimos da seguinte maneira: <br><br><ol><li>  Estimativas formadas de fornecedores por modelo. <br></li><li>  Os pares de servi√ßo ao cliente existentes foram exclu√≠dos das classifica√ß√µes (veja a figura abaixo) e das matrizes OOT. <br></li><li>  Formado a partir das classifica√ß√µes restantes das recomenda√ß√µes top-K e classificado como MAP @ k no OOT restante. <br></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/ee7/c06/f4b/ee7c06f4b68beda0b4f0e22e3c8163c1.png"><br>  <i>A l√≥gica de preparar a matriz para gerar previs√µes</i> <br><br>  Como linha de base, compilamos uma lista de fornecedores, classificados por popularidade, e a multiplicamos por todos os clientes, excluindo novamente os pares existentes de atendimento ao cliente.  Acabou sendo triste e nem um pouco o que esper√°vamos e vimos nas amostras de trem \ valida√ß√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee2/a94/050/ee2a94050abe17d305bdcffeb895f2d0.png"></div><br>  <i>Gr√°fico de compara√ß√£o de qualidade de refer√™ncia e modelo</i> <br><br>  Pare com isso!  Temos fatores e par√¢metros do cliente de fornecedores.  Temos m√°quinas de fatora√ß√£o. <br><br><h3>  FM </h3><br>  M√°quinas de fatora√ß√£o (m√°quina de fatora√ß√£o) - um algoritmo de aprendizado com um professor, projetado para encontrar rela√ß√µes entre fatores que descrevem entidades em intera√ß√£o, que s√£o apresentados na forma de matrizes esparsas.  Usamos a implementa√ß√£o FM da biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LightFM</a> . <br><br><h3>  Formato de dados </h3><br>  Al√©m da matriz de intera√ß√£o normalizada, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√©todo</a> usa dois conjuntos de dados adicionais com fatores para clientes e servi√ßos de provedores na forma de matrizes codificadas um a quente conectadas a matrizes √∫nicas: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/61b/fa6/c8a/61bfa6c8ab458cfb9b747a37a28e0e32.png"><br>  <i>A l√≥gica de preparar a matriz para gerar previs√µes</i> <br><br><h3>  Avalia√ß√£o da qualidade </h3><br>  A qualidade do modelo FM em nossos dados acabou sendo inferior √† ALS: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48b/457/003/48b457003013f435b77ba2d9ecc4cb25.png"></div><br>  <i>Tabela comparativa de modelos de qualidade e linha de base</i> <br><br><h3>  Arquitetura do modelo de mudan√ßa - Boosting </h3><br>  Foi decidido entrar do outro lado.  Recordando a distribui√ß√£o da popularidade dos servi√ßos, identificamos 300 deles, transa√ß√µes nas quais abrangem 80% de todas as opera√ß√µes, e treinamos um classificador neles.  Aqui, os dados representam agregados de transa√ß√µes do cliente enriquecidas com os recursos do cliente: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d25/47d/718/d2547d718a7199fba96be2d0f653bf9a.png"><br>  <i>Esquema de agrega√ß√£o de transa√ß√£o</i> <br><br>  Por que apenas do lado do cliente, voc√™ pergunta?  Como nesse caso, para preparar recomenda√ß√µes, ser√° suficiente termos uma linha por cliente.  Aplicando o modelo a ele, obtemos o vetor de probabilidades de sa√≠da para todas as classes, a partir do qual √© f√°cil escolher as principais recomenda√ß√µes.  Se adicionarmos os recursos dos servi√ßos de provedor ao conjunto de treinamento, na fase de aplica√ß√£o do modelo, seremos obrigados a preparar 300 linhas para cada cliente - um para cada servi√ßo de provedor com recursos que os descrevem ou criar outro modelo para pr√©-classificar candidatos √† pontua√ß√£o . <br><br>  A adi√ß√£o de recursos do ALS aos clientes n√£o aumentou nossos dados, pois j√° levamos em conta a atividade transacional - por exemplo, em se√ß√µes da MCC ou categorias no estilo de "jogador" ou "teatro".  Nesse formato, conseguimos bons resultados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eed/66a/389/eed66a389e4b545fa18a59c6c4ac123a.png"></div><br>  <i>Tabela comparativa de modelos de qualidade e linha de base</i> <br><br><h3>  Filtro regional </h3><br>  Apesar da alta qualidade do modelo, mais um problema permanece nesta abordagem.  Como a arquitetura dos dados e do modelo n√£o implica o uso de recursos dos servi√ßos dos provedores, o modelo n√£o leva em considera√ß√£o totalmente a geografia e pode recomendar que as pessoas paguem pelo servi√ßo de um provedor local de outra regi√£o.  Para minimizar esse risco, desenvolvemos um pequeno filtro para pr√©-cortar as op√ß√µes antes de fazer recomenda√ß√µes.  Um fluxo f√°cil de recurs√£o √© lan√ßado no algoritmo: <br><br><ol><li>  Coletamos informa√ß√µes sobre a regi√£o do cliente a partir de perfis banc√°rios e outras fontes internas. <br></li><li>  Destacamos as principais regi√µes de presen√ßa para cada provedor. <br></li><li>  Esclarecemos / preenchemos as informa√ß√µes sobre a regi√£o do cliente pelas regi√µes dos fornecedores que ele usa. <br></li></ol><br>  Ap√≥s essas manipula√ß√µes, usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o √≠ndice Herfindahl,</a> separamos os provedores regionais, representados em um conjunto limitado de regi√µes, dos federais: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/620/15f/090/62015f090d3bdcc34d468f7b36ffef90.png"></div><br>  <i>Separa√ß√£o de prestadores por presen√ßa nas regi√µes</i> <br><br>  Formamos uma m√°scara com fornecedores regionais aceit√°veis ‚Äã‚Äãpara clientes e exclu√≠mos itens desnecess√°rios das previs√µes do modelo antes de criar uma lista de recomenda√ß√µes. <br><br><h2>  Conclus√£o </h2><br>  Desenvolvemos dois modelos que juntos formam um conjunto completo de recomenda√ß√µes sobre pagamentos e transfer√™ncias.  Foi poss√≠vel reduzir o caminho do cliente para metade das opera√ß√µes recorrentes em um clique.  Nos planos futuros para melhorar o modelo de ‚Äúopera√ß√µes recomendadas‚Äù usando dados de feedback (os cart√µes podem ser ocultos etc.), o que reduzir√° o limite para a sele√ß√£o de recomenda√ß√µes e aumentar√° a cobertura.  Tamb√©m est√° planejado expandir a cobertura dos pagamentos recomendados no modelo de "exemplos de pesquisa" e desenvolver um algoritmo para otimiza√ß√£o da pontua√ß√£o. <br><br>  Percorremos o caminho dif√≠cil de construir um sistema de pagamentos e transfer√™ncias recomendados.  No caminho, tivemos problemas e adquirimos experi√™ncia na decomposi√ß√£o e simplifica√ß√£o de tarefas, avaliando corretamente esses sistemas, aplicabilidade de m√©todos, trabalho ideal com grandes quantidades de dados e expandimos significativamente nosso entendimento das especificidades de tais tarefas.  Ao longo do caminho, consegui contribuir com o c√≥digo aberto, que n√≥s mesmos usamos.  Desejo-lhe tarefas interessantes, linhas de base realistas e F1 √∫nica.  Obrigado pela aten√ß√£o! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461747/">https://habr.com/ru/post/pt461747/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461737/index.html">Coletamos o ambiente para o TDD moderno em JavaScript + c√≥digo VS</a></li>
<li><a href="../pt461739/index.html">Back-end United 4: Okroshka. Incidentes</a></li>
<li><a href="../pt461741/index.html">Cluster hier√°rquico de dados categ√≥ricos em R</a></li>
<li><a href="../pt461743/index.html">Semana 31 de Seguran√ßa: Vulnerabilidade no VLC e telefone quebrado</a></li>
<li><a href="../pt461745/index.html">DeviceLock DLP: Pre√ßos do mercado negro russo pela quebra de dados pessoais (mais uma resposta √† resposta do Tinkoff Bank)</a></li>
<li><a href="../pt461749/index.html">Beleza nos olhos de quem v√™</a></li>
<li><a href="../pt461751/index.html">Contribui√ß√£o do designer para o desenvolvimento de aplicativos para dispositivos m√≥veis</a></li>
<li><a href="../pt461753/index.html">Transa√ß√µes Globais da InterSystems IRIS</a></li>
<li><a href="../pt461755/index.html">A psicologia da vis√£o sonora. Svetlana Lebedeva contou como as pessoas aprendem uma nova maneira de perceber</a></li>
<li><a href="../pt461759/index.html">Ouvindo comunica√ß√µes VoIP criptografadas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>