<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìì üë®‚Äçüé§ üóíÔ∏è Guia de Arquitetura de Aplicativos Android üå≥ ‚óæÔ∏è ü§•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Apresento a voc√™ a tradu√ß√£o gratuita do ‚ÄúGuide to app architecture‚Äù do JetPack . Pe√ßo que voc√™ deixe todos os coment√°rios sobre a tradu√ß√£o n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guia de Arquitetura de Aplicativos Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456256/">  Ol√° Habr!  Apresento a voc√™ a tradu√ß√£o gratuita do ‚ÄúGuide to app architecture‚Äù do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JetPack</a> .  Pe√ßo que voc√™ deixe todos os coment√°rios sobre a tradu√ß√£o nos coment√°rios, e eles ser√£o corrigidos.  Al√©m disso, coment√°rios daqueles que usaram a arquitetura apresentada com recomenda√ß√µes para seu uso ser√£o √∫teis para todos. <br><br>  Este guia aborda as pr√°ticas recomendadas e a arquitetura recomendada para a cria√ß√£o de aplicativos robustos.  Esta p√°gina pressup√µe uma introdu√ß√£o b√°sica ao Android Framework.  Se voc√™ √© novo no desenvolvimento de aplicativos Android, consulte nossos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">guias</a> para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desenvolvedores</a> para come√ßar e aprender mais sobre os conceitos mencionados neste guia.  Se voc√™ estiver interessado em arquitetura de aplicativos e quiser se familiarizar com os materiais deste guia em termos de programa√ß√£o no Kotlin, consulte o curso Udacity, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Desenvolvendo aplicativos para Android com Kotlin"</a> . <br><br><h2>  Experi√™ncia do usu√°rio de aplicativos para dispositivos m√≥veis </h2><br>  Na maioria dos casos, os aplicativos de √°rea de trabalho t√™m um √∫nico ponto de entrada na √°rea de trabalho ou no iniciador e, em seguida, s√£o executados como um √∫nico processo monol√≠tico.  Os aplicativos Android t√™m uma estrutura muito mais complexa.  Um aplicativo Android t√≠pico cont√©m v√°rios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">componentes de aplicativos</a> , incluindo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atividades</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fragmentos</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Servi√ßos</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ContentProviders</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BroadcastReceivers</a> . <br><br>  Voc√™ declara todos ou alguns desses componentes do aplicativo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">manifesto</a> do aplicativo.  O Android usa esse arquivo para decidir como integrar seu aplicativo √† interface de usu√°rio comum do dispositivo.  Como um aplicativo Android bem escrito cont√©m v√°rios componentes, e os usu√°rios geralmente interagem com v√°rios aplicativos em um curto per√≠odo de tempo, os aplicativos devem se adaptar a diferentes tipos de fluxos de trabalho e tarefas orientadas ao usu√°rio. <br><a name="habracut"></a><br>  Por exemplo, considere o que acontece quando voc√™ compartilha uma foto em seu aplicativo de m√≠dia social favorito: <br><br><ol><li>  O aplicativo aciona a inten√ß√£o da c√¢mera.  O Android inicia um aplicativo de c√¢mera para processar a solicita√ß√£o.  No momento, o usu√°rio deixou o aplicativo para redes sociais e sua experi√™ncia como usu√°rio √© impec√°vel. </li><li>  Um aplicativo de c√¢mera pode acionar outras inten√ß√µes, como iniciar um seletor de arquivos, que pode iniciar outro aplicativo. </li><li>  No final, o usu√°rio retorna ao aplicativo de rede social e compartilha a foto. </li></ol><br>  A qualquer momento do processo, o usu√°rio pode ser interrompido por uma liga√ß√£o ou notifica√ß√£o.  Ap√≥s a a√ß√£o associada a essa interrup√ß√£o, o usu√°rio espera poder retornar e retomar esse processo de compartilhamento de fotos.  Esse comportamento de troca de aplicativos √© comum em dispositivos m√≥veis, portanto, seu aplicativo deve lidar corretamente com esses pontos (tarefas). <br><br>  Lembre-se de que os dispositivos m√≥veis tamb√©m t√™m recursos limitados; portanto, a qualquer momento, o sistema operacional pode destruir alguns processos de aplicativos, a fim de liberar espa√ßo para novos. <br><br>  Dadas as condi√ß√µes desse ambiente, os componentes do seu aplicativo podem ser iniciados individualmente e n√£o em ordem, e o sistema operacional ou o usu√°rio pode destru√≠-los a qualquer momento.  Como esses eventos n√£o est√£o sob seu controle, <b>voc√™ n√£o deve armazenar dados ou estados nos componentes do aplicativo</b> e os componentes do aplicativo n√£o devem depender um do outro. <br><br><h2>  Princ√≠pios gerais de arquitetura </h2><br>  Se voc√™ n√£o deve usar componentes do aplicativo para armazenar dados e estado do aplicativo, como deve desenvolver seu aplicativo? <br><br><h3>  Divis√£o de responsabilidade </h3><br>  O princ√≠pio mais importante a seguir √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o compartilhamento de responsabilidades</a> .  Um erro comum √© quando voc√™ escreve todo o seu c√≥digo em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atividade</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fragmento</a> .  Essas s√£o classes de interface do usu√°rio que devem conter apenas l√≥gica processando a intera√ß√£o da interface com o usu√°rio e do sistema operacional.  Ao compartilhar a responsabilidade o m√°ximo poss√≠vel nessas classes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(SRPs)</a> , voc√™ pode evitar muitos dos problemas associados ao ciclo de vida do aplicativo. <br><br><h3>  Controle de interface do usu√°rio do modelo </h3><br>  Outro princ√≠pio importante √© que voc√™ deve <b>controlar sua interface com o usu√°rio a partir de um modelo</b> , de prefer√™ncia de um modelo permanente.  Modelos s√£o os componentes respons√°veis ‚Äã‚Äãpelo processamento dos dados para o aplicativo.  Eles s√£o independentes dos objetos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">View</a> e dos componentes do aplicativo, portanto, n√£o s√£o afetados pelo ciclo de vida do aplicativo e pelos problemas relacionados. <br><br>  Um modelo permanente √© ideal pelos seguintes motivos: <br><br><ul><li>  Seus usu√°rios n√£o perder√£o dados se o sistema operacional Android destruir seu aplicativo para liberar recursos. </li><li>  Seu aplicativo continua funcionando quando a conex√£o de rede est√° inst√°vel ou indispon√≠vel. </li></ul><br>  Ao organizar a base do seu aplicativo em classes de modelo com uma responsabilidade claramente definida pelo gerenciamento de dados, seu aplicativo se torna mais test√°vel e suportado. <br><br><h2>  Arquitetura de aplicativo recomendada </h2><br>  Esta se√ß√£o demonstra como estruturar um aplicativo usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">componentes de arquitetura</a> , trabalhando em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cen√°rio de uso de ponta a ponta</a> . <br><br>  <i><b>Nota</b></i>  <i>N√£o √© poss√≠vel ter uma maneira de escrever aplicativos que funcionem melhor para cada cen√°rio.</i>  <i>No entanto, a arquitetura recomendada √© um bom ponto de partida para a maioria das situa√ß√µes e fluxos de trabalho.</i>  <i>Se voc√™ j√° possui uma boa maneira de escrever aplicativos Android que atendam aos princ√≠pios gerais de arquitetura, n√£o deve alter√°-lo.</i> <br><br>  Imagine que estamos criando uma interface de usu√°rio que exibe um perfil de usu√°rio.  Usamos uma API privada e uma API REST para recuperar dados do perfil. <br><br><h3>  Revis√£o </h3><br>  Para come√ßar, considere o esquema de intera√ß√£o dos m√≥dulos da arquitetura do aplicativo finalizado: <br><br><img src="https://habrastorage.org/webt/lb/xq/cx/lbxqcxyjtoauqkif9hte7srpnm8.png"><br><br>  Observe que cada componente depende apenas do componente um n√≠vel abaixo dele.  Por exemplo, Atividade e Fragmentos dependem apenas do modelo de exibi√ß√£o.  Reposit√≥rio √© a √∫nica classe que depende de muitas outras classes;  neste exemplo, o armazenamento depende de um modelo de dados persistente e de uma fonte de dados interna remota. <br><br>  Esse padr√£o de design cria uma experi√™ncia do usu√°rio consistente e agrad√°vel.  Independentemente de o usu√°rio retornar ao aplicativo alguns minutos depois de fech√°-lo ou alguns dias depois, ele ver√° instantaneamente as informa√ß√µes do usu√°rio de que o aplicativo foi salvo localmente.  Se esses dados estiverem desatualizados, o m√≥dulo de armazenamento do aplicativo come√ßar√° a atualizar os dados em segundo plano. <br><br><h3>  Crie uma interface de usu√°rio </h3><br>  A interface do usu√°rio consiste no fragmento <code>UserProfileFragment</code> e no <code>user_profile_layout.xml</code> layout <code>user_profile_layout.xml</code> correspondente. <br><br>  Para gerenciar a interface do usu√°rio, nosso modelo de dados deve conter os seguintes elementos de dados: <br><br><ul><li>  <b>ID do</b> usu√°rio <b>:</b> ID do usu√°rio.  A melhor solu√ß√£o √© passar essas informa√ß√µes para o fragmento usando os argumentos do fragmento.  Se o sistema operacional Android destruir nosso processo, essas informa√ß√µes ser√£o salvas, para que o identificador fique dispon√≠vel na pr√≥xima vez que iniciarmos nosso aplicativo. </li><li>  <b>Objeto de usu√°rio:</b> uma classe de dados que cont√©m informa√ß√µes do usu√°rio. </li></ul><br>  Usamos um <code>UserProfileViewModel</code> baseado em um componente da arquitetura ViewModel para armazenar essas informa√ß√µes. <br><br>  <i><u>O objeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ViewModel</a> fornece dados para um componente espec√≠fico da interface com o usu√°rio, como fragmento ou Atividade, e cont√©m l√≥gica de processamento de dados corporativos para interagir com o modelo.</u></i>  <i><u>Por exemplo, o <b>ViewModel</b> pode chamar outros componentes para carregar dados e encaminhar solicita√ß√µes de usu√°rio para altera√ß√µes de dados.</u></i>  <i><u><b>O ViewModel</b> n√£o conhece os componentes da interface do usu√°rio e, portanto, n√£o √© afetado por altera√ß√µes na configura√ß√£o, como recriar Activity quando o dispositivo √© girado.</u></i> <br><br>  Agora, identificamos os seguintes arquivos: <br><br><ul><li>  <code>user_profile.xml</code> : layout da interface do usu√°rio definido. </li><li>  <code>UserProfileFragment</code> : descreveu um controlador de interface do usu√°rio respons√°vel por exibir informa√ß√µes ao usu√°rio. </li><li>  <code>UserProfileViewModel</code> : uma classe respons√°vel por preparar os dados para exibi-los em <code>UserProfileFragment</code> e responder √† intera√ß√£o do usu√°rio. </li></ul><br>  Os seguintes trechos de c√≥digo mostram o conte√∫do inicial desses arquivos.  (O arquivo de layout √© omitido por simplicidade.) <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserProfileViewModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewModel</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userId : String = TODO() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user : User = TODO() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserProfileFragment</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Fragment</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> viewModel: UserProfileViewModel <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> viewModels() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( inflater: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LayoutInflater</span></span></span></span><span class="hljs-function"><span class="hljs-params">, container: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">? )</span></span></span></span>: View { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> inflater.inflate(R.layout.main_fragment, container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } }</code> </pre> <br>  Agora que temos esses m√≥dulos de c√≥digo, como os conectamos?  Depois que o campo do usu√°rio √© definido na classe UserProfileViewModel, precisamos de uma maneira de informar a interface do usu√°rio. <br><br>  <i><b>Nota</b></i>  <i>SavedStateHandle permite que o ViewModel acesse o estado salvo e os argumentos do fragmento ou a√ß√£o associado.</i> <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// UserProfileViewModel class UserProfileViewModel( savedStateHandle: SavedStateHandle ) : ViewModel() { val userId : String = savedStateHandle["uid"] ?: throw IllegalArgumentException("missing user id") val user : User = TODO() } // UserProfileFragment private val viewModel: UserProfileViewModel by viewModels( factoryProducer = { SavedStateVMFactory(this) } ... )</span></span></code> </pre> <br>  Agora precisamos informar nosso fragmento quando o objeto de usu√°rio for recebido.  √â aqui que o componente da arquitetura LiveData aparece. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LiveData</a> √© um detentor de dados observ√°vel.  Outros componentes em seu aplicativo podem rastrear altera√ß√µes nos objetos usando esse suporte, sem criar caminhos expl√≠citos e dif√≠ceis de depend√™ncia entre eles.  O componente LiveData tamb√©m leva em considera√ß√£o o estado do ciclo de vida dos componentes do seu aplicativo, como Atividades, Fragmentos e Servi√ßos, e inclui l√≥gica de limpeza para evitar vazamento de objetos e consumo excessivo de mem√≥ria. <br><br>  <i>Nota</i>  <i>Se voc√™ j√° usa bibliotecas como RxJava ou Agera, pode continuar a us√°-las em vez do LiveData.</i>  <i>No entanto, ao usar bibliotecas e abordagens semelhantes, lembre-se de lidar adequadamente com o ciclo de vida do seu aplicativo.</i>  <i>Em particular, verifique se voc√™ suspendeu seus fluxos de dados quando o LifecycleOwner associado for parado e destrua esses fluxos quando o LifecycleOwner associado tiver sido destru√≠do.</i>  <i>Voc√™ tamb√©m pode adicionar o artefato android.arch.lifecycle: jet streams para usar o LiveData com outra biblioteca de jet stream, como RxJava2.</i> <br><br>  Para incluir o componente LiveData em nosso aplicativo, alteramos o tipo de campo em <code>UserProfileViewModel</code> para LiveData.  <code>UserProfileFragment</code> agora <code>UserProfileFragment</code> informado sobre atualiza√ß√µes de dados.  Al√©m disso, como esse campo do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LiveData</a> suporta o ciclo de vida, ele limpa automaticamente os links quando n√£o s√£o mais necess√°rios. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserProfileViewModel</span></span></span></span>( savedStateHandle: SavedStateHandle ) : ViewModel() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userId : String = savedStateHandle[<span class="hljs-string"><span class="hljs-string">"uid"</span></span>] ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"missing user id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user : LiveData&lt;User&gt; = TODO() }</code> </pre> <br>  Agora, modificamos o <code>UserProfileFragment</code> para observar os dados no <code>ViewModel</code> e atualizar a interface do usu√°rio de acordo com as altera√ß√µes: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onViewCreated(view, savedInstanceState) viewModel.user.observe(viewLifecycleOwner) { <span class="hljs-comment"><span class="hljs-comment">//  UI } }</span></span></code> </pre> <br>  Sempre que os dados do perfil do usu√°rio s√£o atualizados, o retorno de chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">onChanged ()</a> √© chamado e a interface do usu√°rio √© atualizada. <br><br>  Se voc√™ estiver familiarizado com outras bibliotecas que usam retornos de chamada observ√°veis, talvez tenha percebido que n√£o redefinimos o m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">onStop ()</a> do fragmento para interromper a observa√ß√£o dos dados.  Esta etapa √© opcional para o LiveData, pois suporta o ciclo de vida, o que significa que ele n√£o chamar√° o retorno de chamada <code>onChanged()</code> se o fragmento estiver em um estado inativo;  isto √©, ele recebeu uma liga√ß√£o para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">onStart ()</a> , mas ainda n√£o recebeu <code>onStop()</code> ).  O LiveData tamb√©m remove automaticamente o observador ao chamar o m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">onDestroy ()</a> no fragmento. <br><br>  N√£o adicionamos nenhuma l√≥gica para lidar com as altera√ß√µes na configura√ß√£o, como girar a tela do dispositivo pelo usu√°rio.  <code>UserProfileViewModel</code> restaurado automaticamente quando a configura√ß√£o √© alterada. Assim que um novo fragmento √© criado, ele recebe a mesma inst√¢ncia do <code>ViewModel</code> e o retorno de chamada √© chamado imediatamente usando os dados atuais.  Como os objetos <code>ViewModel</code> s√£o projetados para sobreviver aos objetos <code>View</code> correspondentes que eles atualizam, voc√™ n√£o deve incluir refer√™ncias diretas aos objetos <code>View</code> na sua implementa√ß√£o do ViewModel.  Para obter mais informa√ß√µes sobre a vida √∫til do <code>ViewModel</code> corresponde ao ciclo de vida dos componentes da interface do usu√°rio, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ciclo de vida do ViewModel.</a> <br><br><h3>  Recupera√ß√£o de dados </h3><br>  Agora que usamos o LiveData para conectar o <code>UserProfileViewModel</code> ao <code>UserProfileFragment</code> , como podemos obter dados do perfil do usu√°rio? <br><br>  Neste exemplo, assumimos que nosso back-end fornece uma API REST.  Usamos a biblioteca Retrofit para acessar nosso back-end, embora voc√™ possa usar uma biblioteca diferente que atenda ao mesmo objetivo. <br><br>  Aqui est√° a nossa defini√ß√£o de um servi√ßo da <code>Webservice</code> vinculado ao nosso back-end: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Webservice</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@GET</span></span></span><span class="hljs-comment"> declares an HTTP GET request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Path</span></span></span><span class="hljs-comment">("user") annotation on the userId parameter marks it as a * replacement for the {user} placeholder in the </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@GET</span></span></span><span class="hljs-comment"> path */</span></span> <span class="hljs-meta"><span class="hljs-meta">@GET(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/users/{user}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Path(</span></span></span><span class="hljs-meta-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-meta-string">"user"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Call&lt;User&gt; }</code> </pre> <br>  Uma primeira id√©ia para implementar um <code>ViewModel</code> pode envolver chamar o servi√ßo da <code>Webservice</code> para recuperar os dados e atribu√≠- <code>LiveData</code> ao nosso objeto <code>LiveData</code> .  Esse design funciona, mas us√°-lo torna nosso aplicativo mais dif√≠cil de manter √† medida que cresce.  Isso atribui muita responsabilidade √† classe <code>UserProfileViewModel</code> , que viola o princ√≠pio da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">separa√ß√£o de interesses</a> .  Al√©m disso, o escopo do ViewModel est√° associado ao ciclo de vida da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atividade</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fragmento</a> , o que significa que os dados do servi√ßo da <code>Webservice</code> perdidos quando o ciclo de vida do objeto da interface do usu√°rio associado termina.  Esse comportamento cria uma experi√™ncia indesej√°vel para o usu√°rio. <br><br>  Em vez disso, nosso <code>ViewModel</code> delega o processo de recupera√ß√£o de dados para um novo m√≥dulo de armazenamento. <br><br>  <u><i><b>Os</b> m√≥dulos de <b>reposit√≥rio</b> lidam com opera√ß√µes de dados.</i></u>  <u><i>Eles fornecem uma API limpa para que o restante do aplicativo possa obter esses dados com facilidade.</i></u>  <u><i>Eles sabem de onde obter os dados e o que a API chama para fazer ao atualizar os dados.</i></u>  <u><i>Voc√™ pode pensar nos reposit√≥rios como intermedi√°rios entre diferentes fontes de dados, como modelos persistentes, servi√ßos da web e caches.</i></u> <br><br>  Nossa classe <code>UserRepository</code> , mostrada no seguinte trecho de c√≥digo, usa uma inst√¢ncia do <code>WebService</code> para recuperar dados do usu√°rio: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> webservice: Webservice = TODO() <span class="hljs-comment"><span class="hljs-comment">// ... fun getUser(userId: String): LiveData&lt;User&gt; { //    .    . val data = MutableLiveData&lt;User&gt;() webservice.getUser(userId).enqueue(object : Callback&lt;User&gt; { override fun onResponse(call: Call&lt;User&gt;, response: Response&lt;User&gt;) { data.value = response.body() } //     . override fun onFailure(call: Call&lt;User&gt;, t: Throwable) { TODO() } }) return data } }</span></span></code> </pre> <br>  Embora o m√≥dulo de armazenamento pare√ßa desnecess√°rio, ele serve a um prop√≥sito importante: abstrai as fontes de dados do restante do aplicativo.  Agora, nosso <code>UserProfileViewModel</code> n√£o sabe recuperar dados, para que possamos fornecer aos modelos de apresenta√ß√£o dados obtidos de v√°rias implementa√ß√µes diferentes de extra√ß√£o de dados. <br><br>  <b>Nota</b>  Perdemos o caso de erros de rede por simplicidade.  Para uma implementa√ß√£o alternativa que exp√µe erros e status de download, consulte o Ap√™ndice: Divulga√ß√£o do status da rede. <br><br>  <b>Gerenciando depend√™ncias entre componentes</b> <br><br>  A classe <code>UserRepository</code> acima precisa de uma inst√¢ncia do <code>Webservice</code> para recuperar dados do usu√°rio.  Ele poderia apenas criar uma inst√¢ncia, mas para isso ele tamb√©m precisa conhecer as depend√™ncias da classe de servi√ßo da <code>Webservice</code> .  Al√©m disso, <code>UserRepository</code> provavelmente n√£o √© a √∫nica classe que precisa de um servi√ßo da web.  Essa situa√ß√£o exige a duplica√ß√£o do c√≥digo, pois toda classe que precisa de um link para o servi√ßo da <code>Webservice</code> precisa saber como cri√°-lo e suas depend√™ncias.  Se cada classe criar um novo <code>WebService</code> , nosso aplicativo poder√° se tornar muito intensivo em recursos. <br><br>  Para resolver esse problema, voc√™ pode usar os seguintes padr√µes de design: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Inje√ß√£o de Depend√™ncia (DI)</a> .  A inje√ß√£o de depend√™ncia permite que as classes definam suas depend√™ncias sem cri√°-las.  Em tempo de execu√ß√£o, outra classe √© respons√°vel por fornecer essas depend√™ncias.  Recomendamos a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dagger 2</a> para implementar a inje√ß√£o de depend√™ncia em aplicativos Android.  O Dagger 2 cria automaticamente objetos, ignorando a √°rvore de depend√™ncias e fornece garantias em tempo de compila√ß√£o para depend√™ncias. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(Local do servi√ßo) Localizador de servi√ßo</a> : O modelo do localizador de servi√ßo fornece um registro no qual as classes podem obter suas depend√™ncias em vez de constru√≠-las. </li></ul><br>  A implementa√ß√£o de um registro de servi√ßo √© mais f√°cil do que usar o DI; portanto, se voc√™ √© novo no DI, use o modelo: localiza√ß√£o do servi√ßo. <br><br>  Esses modelos permitem escalar seu c√≥digo porque fornecem modelos claros para gerenciar depend√™ncias sem duplicar ou complicar o c√≥digo.  Al√©m disso, esses modelos permitem alternar rapidamente entre implementa√ß√µes de teste e produ√ß√£o de amostragem de dados. <br><br>  Nosso aplicativo de amostra usa o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dagger 2</a> para gerenciar as depend√™ncias do objeto <code>Webservice</code> . <br><br><h3>  Conecte o ViewModel e armazenamento </h3><br>  Agora modificamos nosso <code>UserProfileViewModel</code> para usar o objeto <code>UserRepository</code> : <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserProfileViewModel</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( savedStateHandle: SavedStateHandle, userRepository: UserRepository ) : ViewModel() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userId : String = savedStateHandle[<span class="hljs-string"><span class="hljs-string">"uid"</span></span>] ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"missing user id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user : LiveData&lt;User&gt; = userRepository.getUser(userId) }</code> </pre> <br><h3>  Armazenamento em cache </h3><br>  A implementa√ß√£o <code>UserRepository</code> abstrai a chamada do objeto <code>Webservice</code> , mas como conta apenas com uma fonte de dados, n√£o √© muito flex√≠vel. <br><br>  O principal problema com a implementa√ß√£o do <code>UserRepository</code> √© que, depois de receber dados do nosso back-end, esses dados n√£o s√£o armazenados em nenhum lugar.  Portanto, se o usu√°rio sair do <code>UserProfileFragment</code> e retornar a ele, nosso aplicativo dever√° recuperar os dados, mesmo que eles n√£o tenham sido alterados. <br><br>  Esse design n√£o √© ideal pelos seguintes motivos: <br><br><ul><li>  Gasta recursos valiosos de tr√°fego. </li><li>  Isso faz com que o usu√°rio aguarde a conclus√£o de uma nova solicita√ß√£o. </li></ul><br>  Para resolver essas defici√™ncias, adicionamos uma nova fonte de dados ao nosso <code>UserRepository</code> , que armazena em cache objetos de <code>User</code> na mem√≥ria: <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// Dagger,        . @Singleton class UserRepository @Inject constructor( private val webservice: Webservice, //    .    . private val userCache: UserCache ) { fun getUser(userId: String): LiveData&lt;User&gt; { val cached = userCache.get(userId) if (cached != null) { return cached } val data = MutableLiveData&lt;User&gt;() userCache.put(userId, data) //     ,  ,  . //      . webservice.getUser(userId).enqueue(object : Callback&lt;User&gt; { override fun onResponse(call: Call&lt;User&gt;, response: Response&lt;User&gt;) { data.value = response.body() } //     . override fun onFailure(call: Call&lt;User&gt;, t: Throwable) { TODO() } }) return data } }</span></span></code> </pre> <br><h3>  Dados persistentes </h3><br>  Usando nossa implementa√ß√£o atual, se o usu√°rio girar o dispositivo ou sair e retornar imediatamente ao aplicativo, a interface do usu√°rio existente ficar√° imediatamente vis√≠vel, porque a loja recupera dados do nosso cache na mem√≥ria. <br><br>  No entanto, o que acontece se um usu√°rio sair do aplicativo e retornar algumas horas depois que o sistema operacional Android concluir o processo?  Contando com nossa implementa√ß√£o atual nessa situa√ß√£o, precisamos obter dados da rede novamente.  Esse processo de atualiza√ß√£o n√£o √© apenas uma experi√™ncia ruim para o usu√°rio;  tamb√©m √© um desperd√≠cio porque consome dados m√≥veis valiosos. <br><br>  Voc√™ pode resolver esse problema armazenando em cache solicita√ß√µes da Web, mas isso cria um novo problema importante: o que acontece se os mesmos dados do usu√°rio s√£o exibidos em um tipo diferente de solicita√ß√£o, por exemplo, ao receber uma lista de amigos?  O aplicativo exibir√° dados conflitantes, o que √© confuso na melhor das hip√≥teses.  Por exemplo, nosso aplicativo pode exibir duas vers√µes diferentes dos dados do mesmo usu√°rio se o usu√°rio enviou uma solicita√ß√£o de lista de amigos e uma solicita√ß√£o de usu√°rio √∫nico em momentos diferentes.  Nosso aplicativo precisaria descobrir como combinar esses dados conflitantes. <br><br>  A maneira correta de lidar com essa situa√ß√£o √© usar um modelo constante.  A Biblioteca de Dados Permanentes da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sala</a> (DB) vem em nosso aux√≠lio. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Room</a> √© uma biblioteca de mapeamento de objetos que fornece armazenamento de dados local com um c√≥digo padr√£o m√≠nimo.  No momento da compila√ß√£o, ele verifica cada consulta quanto √† conformidade com seu esquema de dados; portanto, consultas SQL quebradas resultam em erros durante a compila√ß√£o e n√£o travam no tempo de execu√ß√£o.  Resumos de sala de alguns detalhes b√°sicos da implementa√ß√£o de tabelas e consultas SQL brutas.  Tamb√©m permite observar altera√ß√µes nos dados do banco de dados, incluindo solicita√ß√µes de coleta e conex√£o, expondo essas altera√ß√µes usando objetos LiveData.  Ele mesmo define explicitamente restri√ß√µes de execu√ß√£o que resolvem problemas comuns de encadeamento, como acesso ao armazenamento no encadeamento principal. <br><br>  <i><b>Nota</b></i>  <i>Se seu aplicativo j√° usa outra solu√ß√£o, como o ORM (SQLite Object Relational Mapping), voc√™ n√£o precisa substituir a solu√ß√£o existente por Room.</i>  <i>No entanto, se voc√™ estiver escrevendo um novo aplicativo ou reorganizando um aplicativo existente, recomendamos o uso do Room para salvar os dados do aplicativo.</i>  <i>Assim, voc√™ pode tirar proveito da abstra√ß√£o da biblioteca e valida√ß√£o de consulta.</i> <br><br>  Para usar o Room, precisamos definir nosso layout local.  Primeiro, adicionamos a anota√ß√£o <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@Entity</a></code> √† nossa classe de modelo de dados do <code>User</code> e a anota√ß√£o <code>@PrimaryKey</code> no campo de <code>id</code> da classe.  Essas anota√ß√µes marcam <code>User</code> como uma tabela em nosso banco de dados e <code>id</code> como a chave prim√°ria da tabela: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span></span>( <span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> id: String, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String )</code> </pre> <br>  Em seguida, criamos a classe de banco de dados implementando o <code>RoomDatabase</code> para nosso aplicativo: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Database(entities = [User::class], version = 1)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDatabase</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RoomDatabase</span></span></span></span>()</code> </pre> <br>  Observe que o <code>UserDatabase</code> √© abstrato.  A biblioteca da sala fornece isso automaticamente.  Consulte a documenta√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">quarto</a> para obter detalhes. <br><br>  Agora precisamos de uma maneira de inserir dados do usu√°rio no banco de dados.  Para esta tarefa, criamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um objeto de acesso a dados (DAO)</a> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Insert(onConflict = REPLACE)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-meta"><span class="hljs-meta">@Query(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SELECT * FROM user WHERE id = :userId"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(userId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: LiveData&lt;User&gt; }</code> </pre> <br>  Observe que o m√©todo <code>load</code> retorna um objeto do tipo LiveData.  A sala sabe quando o banco de dados √© alterado e notifica automaticamente todos os observadores ativos de altera√ß√µes de dados.  Como o Room usa o <i>LiveData</i> , essa opera√ß√£o √© eficiente;  ele atualiza os dados apenas se houver pelo menos um observador ativo. <br><br>  <i><b>Nota: A</b> sala verifica a invalida√ß√£o com base nas modifica√ß√µes da tabela, o que significa que ele pode enviar notifica√ß√µes de falsos positivos.</i> <br><br>  Ap√≥s definir nossa classe <code>UserDao</code> , fazemos refer√™ncia ao DAO da nossa classe de banco de dados: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Database(entities = [User::class], version = 1)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDatabase</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RoomDatabase</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userDao</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: UserDao }</code> </pre> <br>  Agora podemos alterar nosso <code>UserRepository</code> para incluir a fonte de dados da sala: <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//  Dagger,         . @Singleton class UserRepository @Inject constructor( private val webservice: Webservice, //    .    . private val executor: Executor, private val userDao: UserDao ) { fun getUser(userId: String): LiveData&lt;User&gt; { refreshUser(userId) //   LiveData    . return userDao.load(userId) } private fun refreshUser(userId: String) { //    . executor.execute { // ,      . val userExists = userDao.hasUser(FRESH_TIMEOUT) if (!userExists) { //  . val response = webservice.getUser(userId).execute() //    . //   .  LiveData  , //        . userDao.save(response.body()!!) } } } companion object { val FRESH_TIMEOUT = TimeUnit.DAYS.toMillis(1) } }</span></span></code> </pre> <br>  Observe que, mesmo se alteramos a fonte de dados no <code>UserRepository</code> , n√£o precisamos alterar nosso <code>UserProfileViewModel</code> ou <code>UserProfileFragment</code> .  Esta pequena atualiza√ß√£o demonstra a flexibilidade que nossa arquitetura de aplicativos oferece.  Tamb√©m √© √≥timo para teste, porque podemos fornecer um <code>UserRepository</code> falso e testar nosso <code>UserProfileViewModel</code> produ√ß√£o ao mesmo tempo. <br><br>  Se os usu√°rios retornarem em alguns dias, √© prov√°vel que um aplicativo que use essa arquitetura exiba informa√ß√µes desatualizadas at√© que o reposit√≥rio receba informa√ß√µes atualizadas.  Dependendo do seu caso de uso, voc√™ pode n√£o exibir informa√ß√µes desatualizadas.  Em vez disso, voc√™ pode exibir dados de <i>espa√ßo reservado</i> , o que mostra valores ilegais e indica que seu aplicativo est√° baixando e carregando informa√ß√µes atualizadas. <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A √∫nica fonte de verdade:</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> normalmente, diferentes pontos de extremidade da API REST retornam os mesmos dados. Por exemplo, se nosso back-end tiver outro ponto de extremidade que retorne uma lista de amigos, o mesmo objeto de usu√°rio poder√° vir de dois pontos de extremidade da API diferentes, possivelmente at√© usando diferentes n√≠veis de detalhe. Se </font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornarmos a resposta da solicita√ß√£o </font></font><code>Webservice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como est√°, sem verificar a consist√™ncia, nossas interfaces com o usu√°rio poder√£o mostrar informa√ß√µes confusas, porque a vers√£o e o formato dos dados do armazenamento depender√£o do √∫ltimo ponto final chamado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por esse motivo, nossa implementa√ß√£o </font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">armazena respostas de servi√ßo da web em um banco de dados. Altera√ß√µes no banco de dados acionam retornos de chamada para objetos ativos do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LiveData</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Usando esse modelo, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o banco de dados serve como a √∫nica fonte de verdade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e outras partes do aplicativo acessam-no atrav√©s do nosso </font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Independentemente de voc√™ usar um cache de disco, recomendamos que seu reposit√≥rio identifique a fonte de dados como a √∫nica fonte de verdade para o restante do seu aplicativo.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mostrar progresso da opera√ß√£o </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em alguns casos de uso, como puxar para atualizar, √© importante que a interface do usu√°rio mostre ao usu√°rio que uma opera√ß√£o de rede est√° em andamento no momento. </font><font style="vertical-align: inherit;">√â recomend√°vel que a a√ß√£o da interface do usu√°rio seja separada dos dados reais, pois os dados podem ser atualizados por v√°rios motivos. </font><font style="vertical-align: inherit;">Por exemplo, se recebermos uma lista de amigos, o mesmo usu√°rio poder√° ser selecionado novamente programaticamente, o que levar√° a uma atualiza√ß√£o para o LiveData. </font><font style="vertical-align: inherit;">Do ponto de vista da interface do usu√°rio, o fato de ter uma solicita√ß√£o em andamento √© apenas outro ponto de dados, semelhante a qualquer outra parte de dados no pr√≥prio objeto </font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Podemos usar uma das seguintes estrat√©gias para exibir o status de atualiza√ß√£o de dados acordado na interface do usu√°rio, independentemente de onde a solicita√ß√£o de atualiza√ß√£o de dados veio: </font></font><br><br><ul><li>  <code>getUser ()</code> ,      <code>LiveData</code> .         .  ,   NetworkBoundResource   GitHub <a href="">android-Architecture-components</a> . </li><li>       <code>UserRepository</code> ,      .    ,              ,         ,   pull-to-refresh. </li></ul><br><h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na se√ß√£o sobre separa√ß√£o de interesses, mencionamos que uma das principais vantagens de seguir esse princ√≠pio √© a testabilidade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A lista a seguir mostra como testar cada m√≥dulo de c√≥digo do nosso exemplo estendido:</font></font><br><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface do usu√°rio e intera√ß√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : use o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android UI Test Toolkit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A melhor maneira de criar esse teste √© usar a biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espresso</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voc√™ pode criar um fragmento e fornecer um layout </font></font><code>UserProfileViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como o fragmento est√° associado apenas a </font></font><code>UserProfileViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imita√ß√£o (imita√ß√£o)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dessa classe √© suficiente para testar completamente a interface do usu√°rio do seu aplicativo.</font></font></li><li> <b>ViewModel:</b>     <code>UserProfileViewModel</code>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JUnit</a> .      , <code>UserRepository</code> . </li><li> <b>UserRepository:</b>     <code>UserRepository</code>    JUnit.    <code>Webservice</code>  <code>UserDao</code> .      : <br><br><ul><li>     -. </li><li>      . </li><li>     ,     . </li></ul><br></li><li>   <code>Webservice</code> ,  <code>UserDao</code>  ,             . </li><li> <b>UserDao:</b>   DAO    .       -   ,   .        ,  ,      ,        ‚Ä¶ <br><br> <i><b>:</b> Room     ,    DAO,   JSQL  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SupportSQLiteOpenHelper</a></b> .     ,      SQLite     SQLite   .</i> </li><li> <b>-:</b>         .   ,  -,      .  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://github.com/square/ok">MockWebServer</a> ,          . </li><li> <b> :</b>     maven    .    <code>androidx.arch.core</code> :    JUnit: <br><br><ul><li> <code>InstantTaskExecutorRule:</code>            . </li><li> <code>CountingTaskExecutorRule:</code>         .        Espresso     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </li></ul><br></li></ul><br><h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A programa√ß√£o √© um campo criativo e a cria√ß√£o de aplicativos Android n√£o √© exce√ß√£o. Existem v√°rias maneiras de resolver o problema, seja transferir dados entre v√°rias a√ß√µes ou fragmentos, recuperar dados exclu√≠dos e armazen√°-los localmente offline, ou qualquer n√∫mero de outros cen√°rios comuns encontrados por aplicativos n√£o triviais. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embora as recomenda√ß√µes a seguir n√£o sejam necess√°rias, nossa experi√™ncia mostra que sua implementa√ß√£o torna sua base de c√≥digo mais confi√°vel, test√°vel e suportada a longo prazo: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Evite designar os pontos de entrada do seu aplicativo - como a√ß√µes, servi√ßos e receptores de transmiss√£o - como fontes de dados.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em vez disso, eles s√≥ precisam se coordenar com outros componentes para obter um subconjunto dos dados relacionados a esse ponto de entrada. Cada componente do aplicativo √© de curta dura√ß√£o, dependendo da intera√ß√£o do usu√°rio com seu dispositivo e do estado atual geral do sistema. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie linhas de responsabilidade claras entre os v√°rios m√≥dulos do seu aplicativo.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por exemplo, n√£o distribua c√≥digo que baixa dados da rede para v√°rias classes ou pacotes em sua base de c√≥digos. Da mesma forma, n√£o defina v√°rias responsabilidades n√£o relacionadas - como cache de dados e liga√ß√£o de dados - na mesma classe. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exponha o m√≠nimo poss√≠vel de cada m√≥dulo.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resista √† tenta√ß√£o de criar um r√≥tulo ‚Äúapenas um‚Äù que revele os detalhes de uma implementa√ß√£o interna de um m√≥dulo. Voc√™ pode ganhar algum tempo no curto prazo, mas ter√° uma d√≠vida t√©cnica muitas vezes √† medida que sua base de c√≥digo se desenvolver. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pense em como tornar cada m√≥dulo test√°vel isoladamente.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por exemplo, ter uma API bem definida para recuperar dados da rede facilita o teste de um m√≥dulo que armazena esses dados em um banco de dados local. Se, em vez disso, voc√™ misturar a l√≥gica desses dois m√≥dulos em um √∫nico local ou distribuir seu c√≥digo de rede por toda a base de c√≥digos, o teste se tornar√° muito mais dif√≠cil - em alguns casos, nem mesmo imposs√≠vel. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concentre-se no n√∫cleo exclusivo do seu aplicativo para se destacar de outros aplicativos.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o reinvente a roda escrevendo o mesmo padr√£o repetidamente. Em vez disso, concentre seu tempo e energia no que torna seu aplicativo √∫nico e deixe que os componentes da arquitetura Android e outras bibliotecas recomendadas lidem com um padr√£o repetitivo. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mantenha o m√°ximo poss√≠vel de dados relevantes e atualizados.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Assim, os usu√°rios podem aproveitar a funcionalidade do seu aplicativo, mesmo que o dispositivo esteja offline. Lembre-se de que nem todos os usu√°rios usam uma conex√£o constante de alta velocidade. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Designe uma √∫nica fonte de dados como a √∫nica fonte verdadeira.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sempre que seu aplicativo precisar acessar esses dados, sempre deve vir dessa fonte √∫nica de verdade.</font></font><br><br><h3> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adendo: divulga√ß√£o do status da rede</font></font></u> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na se√ß√£o acima da arquitetura de aplicativo recomendada, ignoramos erros de rede e estados de inicializa√ß√£o para simplificar trechos de c√≥digo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta se√ß√£o mostra como exibir o status da rede usando a classe Resource, que encapsula os dados e seu estado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O seguinte snippet de c√≥digo fornece um exemplo de implementa√ß√£o</font></font><code>Resource:</code> <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,         . sealed class Resource&lt;T&gt;( val data: T? = null, val message: String? = null ) { class Success&lt;T&gt;(data: T) : Resource&lt;T&gt;(data) class Loading&lt;T&gt;(data: T? = null) : Resource&lt;T&gt;(data) class Error&lt;T&gt;(message: String, data: T? = null) : Resource&lt;T&gt;(data, message) }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o download de dados da rede ao exibir uma c√≥pia desses dados √© uma pr√°tica comum, √© √∫til criar uma classe auxiliar que possa ser reutilizada em v√°rios locais. Para este exemplo, n√≥s criamos uma classe chamada </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O diagrama a seguir mostra a √°rvore de decis√£o para </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/e1/wv/c9/e1wvc9un_w2t8jyi0kiky8wagw0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Come√ßa observando o banco de dados do recurso. Quando um registro √© baixado do banco de dados pela primeira vez, ele </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verifica se o resultado √© bom o suficiente para ser enviado ou se precisa ser recuperado da rede. Observe que essas duas situa√ß√µes podem ocorrer simultaneamente, j√° que voc√™ provavelmente deseja mostrar dados em cache ao atualiz√°-los da rede.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a chamada de rede for bem-sucedida, ela armazena a resposta no banco de dados e reinicializa o fluxo. No caso de uma </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falha na </font><font style="vertical-align: inherit;">solicita√ß√£o de rede </font><font style="vertical-align: inherit;">, ela envia a falha diretamente. </font></font><br><br> <code><b>.</b>             .       ,       .</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lembre-se de que confiar em um banco de dados para enviar altera√ß√µes envolve o uso de efeitos colaterais relacionados, o que n√£o √© muito bom, pois o comportamento indefinido desses efeitos colaterais pode ocorrer se o banco de dados n√£o enviar as altera√ß√µes porque os dados n√£o foram alterados.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, n√£o envie resultados recebidos da rede, pois isso viola o princ√≠pio de uma √∫nica fonte de verdade. </font><font style="vertical-align: inherit;">No final, √© poss√≠vel que o banco de dados contenha gatilhos que alterem os valores dos dados durante a opera√ß√£o de salvamento. </font><font style="vertical-align: inherit;">Da mesma forma, n√£o envie `SUCESSO` sem novos dados, pois o cliente receber√° a vers√£o incorreta dos dados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O seguinte snippet de c√≥digo mostra a API aberta fornecida pela classe </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para suas subclasses:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// ResultType:   . // RequestType:   API. abstract class NetworkBoundResource&lt;ResultType, RequestType&gt; { //      API   . @WorkerThread protected abstract fun saveCallResult(item: RequestType) //      ,  ,    //     . @MainThread protected abstract fun shouldFetch(data: ResultType?): Boolean //        . @MainThread protected abstract fun loadFromDb(): LiveData&lt;ResultType&gt; //     API. @MainThread protected abstract fun createCall(): LiveData&lt;ApiResponse&lt;RequestType&gt;&gt; // ,    .   //    ,    . protected open fun onFetchFailed() {} //   LiveData,  , //    . fun asLiveData(): LiveData&lt;ResultType&gt; = TODO() }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preste aten√ß√£o aos seguintes detalhes importantes da defini√ß√£o de classe: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele define dois par√¢metros de tipo </font></font><code>ResultType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">, </font></font><code>RequestType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como o tipo de dados retornado da API pode n√£o corresponder ao tipo de dados usado localmente.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele usa uma classe </font></font><code>ApiResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para solicita√ß√µes de rede. </font></font><code>ApiResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â um inv√≥lucro simples para uma classe </font></font><code>Retrofit2.Call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que converte respostas em inst√¢ncias </font></font><code>LiveData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A implementa√ß√£o completa da classe </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aparece como parte do projeto </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub android-Architecture-components</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma vez criado, </font></font><code>NetworkBoundResource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">podemos us√°-lo para escrever nossas implementa√ß√µes de disco e conectadas √† rede </font></font><code>User</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na classe </font></font><code>UserRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//  Dagger2,         . @Singleton class UserRepository @Inject constructor( private val webservice: Webservice, private val userDao: UserDao ) { fun getUser(userId: String): LiveData&lt;User&gt; { return object : NetworkBoundResource&lt;User, User&gt;() { override fun saveCallResult(item: User) { userDao.save(item) } override fun shouldFetch(data: User?): Boolean { return rateLimiter.canFetch(userId) &amp;&amp; (data == null || !isFresh(data)) } override fun loadFromDb(): LiveData&lt;User&gt; { return userDao.load(userId) } override fun createCall(): LiveData&lt;ApiResponse&lt;User&gt;&gt; { return webservice.getUser(userId) } }.asLiveData() } }</span></span></code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt456256/">https://habr.com/ru/post/pt456256/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt456240/index.html">Desenvolvimento de chatbot (laravel + botman)</a></li>
<li><a href="../pt456242/index.html">Um pouco mais sobre multitarefa em microcontroladores</a></li>
<li><a href="../pt456246/index.html">Elemento zero</a></li>
<li><a href="../pt456248/index.html">Como eu peguei: antes de estilos para um elemento de foco</a></li>
<li><a href="../pt456250/index.html">Localiza√ß√£o de aplicativos e suporte a RTL. Relat√≥rio Yandex.Taxi</a></li>
<li><a href="../pt456258/index.html">Livre como um vento e livre como uma tradu√ß√£o de cerveja de "Livre como na liberdade" para o russo sob a licen√ßa GNU FDL 1.3</a></li>
<li><a href="../pt456260/index.html">Conversa sobre economia justa</a></li>
<li><a href="../pt456262/index.html">R√°dio definido por software - como funciona? Parte 9</a></li>
<li><a href="../pt456264/index.html">Crie arquivos bin√°rios do Android usando o NDK do Android e de origem. Desenvolvemos o utilit√°rio screencap</a></li>
<li><a href="../pt456266/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel 302 (de 10 a 16 de junho)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>