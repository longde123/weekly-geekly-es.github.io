<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçØ üï∑Ô∏è üë¥üèæ Kubecost Bewertung, um Geld f√ºr Kubernetes in den Wolken zu sparen üò™ üïäÔ∏è üöÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Derzeit verlagern immer mehr Unternehmen ihre Infrastruktur von Eisenservern und ihren eigenen virtuellen Maschinen in die Cloud. Eine solche L√∂sung i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kubecost Bewertung, um Geld f√ºr Kubernetes in den Wolken zu sparen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/466659/"><img src="https://habrastorage.org/webt/fu/3l/w8/fu3lw8ytqwbk6znjtlhawezl1qa.png"><br><br>  Derzeit verlagern immer mehr Unternehmen ihre Infrastruktur von Eisenservern und ihren eigenen virtuellen Maschinen in die Cloud.  Eine solche L√∂sung ist leicht zu erkl√§ren: Die Hardware muss nicht gepflegt werden, der Cluster kann auf viele verschiedene Arten konfiguriert werden ... und vor allem machen es die verf√ºgbaren Technologien (wie Kubernetes) einfach, die Rechenleistung abh√§ngig von der Last zu skalieren. <br><br>  Der finanzielle Aspekt ist immer wichtig.  Das Tool, das in diesem Artikel behandelt wird, soll dazu beitragen, das Budget bei Verwendung der Cloud-Infrastruktur mit Kubernetes zu reduzieren. <a name="habracut"></a><br><br><h2>  Einf√ºhrung </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kubecost</a> ist ein in Kalifornien ans√§ssiges Startup von Google, das eine L√∂sung zur Berechnung der Infrastrukturkosten in Cloud-Diensten (innerhalb des Kubernetes-Clusters + gemeinsam genutzte Ressourcen), zur Ermittlung von Engp√§ssen in den Clustereinstellungen und zum Senden entsprechender Benachrichtigungen an Slack erstellt. <br><br>  Wir haben Kunden mit Kubernetes sowohl in den bekannten AWS- und GCP-Clouds als auch in der selteneren Azure Linux-Community - im Allgemeinen auf allen von Kubecost unterst√ºtzten Plattformen.  Bei einigen von ihnen ber√ºcksichtigen wir die Kosten f√ºr Intra-Cluster-Dienste selbst (unter Verwendung einer √§hnlichen Technik wie bei Kubecost), √ºberwachen die Infrastrukturkosten und versuchen, sie zu optimieren.  Daher ist es logisch, dass wir an der M√∂glichkeit interessiert waren, solche Aufgaben zu automatisieren. <br><br>  Der Quellcode des Kubecost-Hauptmoduls ist unter der Open Source-Lizenz (Apache License 2.0) ge√∂ffnet.  Es kann frei verwendet werden und die verf√ºgbaren Funktionen sollten f√ºr kleine Projekte ausreichen.  Gesch√§ft ist Gesch√§ft: Der Rest des Produkts ist geschlossen, es kann f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bezahlte Abonnements verwendet werden</a> , was auch kommerziellen Support impliziert.  Dar√ºber hinaus bieten die Autoren eine kostenlose Lizenz f√ºr kleine Cluster (1 Cluster mit <s>10 Knoten</s> - w√§hrend des Schreibens dieses Artikels wurde diese Grenze auf 20 Knoten erweitert) oder eine Testphase mit vollen Funktionen f√ºr 1 Monat an. <br><br><h2>  Wie es funktioniert </h2><br>  Der Gro√üteil von Kubecost ist also eine in Go geschriebene Kostenmodellanwendung.  Das Steuerdiagramm, das das gesamte System beschreibt, wird als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>Kostenanalysator bezeichnet</b></a> und ist im Wesentlichen eine Kostenmodellbaugruppe mit Prometheus, Grafana und mehreren Dashboards. <br><br>  Im Allgemeinen verf√ºgt das Kostenmodell √ºber eine eigene Weboberfl√§che, auf der Diagramme und detaillierte Kostenstatistiken in tabellarischer Form sowie nat√ºrlich Tipps zur Kostenoptimierung angezeigt werden.  Die in Grafana vorgestellten Dashboards sind ein fr√ºheres Stadium in der Entwicklung von Kubecost und enthalten weitgehend dieselben Daten wie das Kostenmodell. Sie werden durch die √ºblichen Statistiken zum CPU- / Speicher- / Netzwerk- / Speicherplatzverbrauch im Cluster und seinen Komponenten erg√§nzt. <br><br>  Wie funktioniert Kubecost? <br><br><ul><li>  Das Kostenmodell √ºber die Cloud-Provider-API erh√§lt Servicepreise. </li><li>  Ferner werden abh√§ngig vom Eisentyp des Knotens und der Region die Kosten der Knoten ber√ºcksichtigt. </li><li>  Basierend auf den Kosten f√ºr die Arbeit der Knoten erh√§lt jeder endg√ºltige Pod die Kosten pro Stunde f√ºr die Verwendung des Prozessors, die ein Gigabyte Speicher und die Kosten f√ºr eine Stunde f√ºr die Speicherung eines Gigabytes Daten ausgeben - abh√§ngig von dem Knoten, auf dem er gearbeitet hat, oder der Speicherklasse. </li><li>  Basierend auf den Arbeitskosten einzelner Pods wird die Zahlung f√ºr Namespaces, Services, Deployments und StatefulSets ber√ºcksichtigt. </li><li>  Zur Berechnung der Statistik werden die von kube-state -metrics und node-exporter bereitgestellten Metriken verwendet. </li></ul><br>  Es ist wichtig zu beachten, dass Kubecost standardm√§√üig <b>nur die in Kubernetes verf√ºgbaren Ressourcen ber√ºcksichtigt</b> .  Externe Datenbanken, GitLab-Server, S3-Speicher und andere Dienste, die sich nicht im Cluster befinden (wenn auch in derselben Cloud), sind f√ºr diesen nicht sichtbar.  Obwohl Sie f√ºr GCP und AWS die Schl√ºssel Ihrer Dienstkonten hinzuf√ºgen und alles zusammen berechnen k√∂nnen. <br><br><h2>  Installation </h2><br>  Damit Kubecost funktioniert, ben√∂tigen Sie: <br><br><ul><li>  Kubernetes Version 1.8 und h√∂her; </li><li>  Kube-State-Metriken; </li><li>  Prometheus; </li><li>  Knotenexporteur. </li></ul><br>  Es kam vor, dass in unseren Clustern alle diese Bedingungen im Voraus erf√ºllt waren, sodass es sich als ausreichend herausstellte, nur den richtigen Endpunkt f√ºr den Zugriff auf Prometheus anzugeben.  Trotzdem enth√§lt die offizielle Kubekost-Helmkarte alles, was Sie brauchen, um auf einem nackten Cluster zu starten. <br><br>  Es gibt verschiedene M√∂glichkeiten, Kubecost zu installieren: <br><br><ol><li>  Die Standardinstallationsmethode, die in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen</a> auf der Entwickler-Website beschrieben ist. Sie m√ºssen <b>das Kostenanalysator-Repository zu Helm hinzuf√ºgen und dann das Diagramm installieren</b> .  Es bleibt nur, den Port weiterzuleiten und die Einstellungen manuell (√ºber kubectl) und / oder √ºber die Webschnittstelle des Kostenmodells in den gew√ºnschten Zustand zu versetzen. <br><br>  Wir haben diese Methode nicht einmal ausprobiert, da wir keine vorgefertigten Konfigurationen von Drittanbietern verwenden. Es scheint jedoch eine gute Option zu sein, "versuchen Sie es einfach selbst".  Wenn Sie bereits einige Komponenten des Systems installiert haben oder eine genauere Optimierung w√ºnschen, ist es besser, den zweiten Weg in Betracht zu ziehen. <br></li><li>  Verwenden Sie im Wesentlichen <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dasselbe Diagramm</a> , konfigurieren und installieren Sie es jedoch unabh√§ngig voneinander auf</b> bequeme Weise. <br><br>  Wie bereits erw√§hnt, enth√§lt dieses Diagramm neben Kubecost selbst die Diagramme Grafana und Prometheus, die auch nach Ihren W√ºnschen angepasst werden k√∂nnen. <br><br>  Mit dem <code>values.yaml</code> Diagramm verf√ºgbaren Diagramm <code>values.yaml</code> f√ºr den Kostenanalysator k√∂nnen Sie <code>values.yaml</code> konfigurieren: <br><br><ul><li>  Liste der zu implementierenden Kostenanalysatorkomponenten; </li><li>  Ihr Endpunkt f√ºr Prometheus (falls Sie bereits einen haben); </li><li>  Dom√§nen und andere Eingangseinstellungen f√ºr Kostenmodell und Grafana; </li><li>  Anmerkungen f√ºr Pods; </li><li>  die Notwendigkeit einer dauerhaften Lagerung und deren Gr√∂√üe. </li></ul><br>  Eine vollst√§ndige Liste der verf√ºgbaren Konfigurationsoptionen mit einer Beschreibung finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> . <br><br>  Da kubecost in der Basisversion den Zugriff nicht einschr√§nken kann, m√ºssen Sie die Basisauthentifizierung f√ºr das Webpanel sofort konfigurieren. <br></li><li>  Installieren Sie <b>nur den Kern des Systems</b> - Kostenmodell.  Dazu muss Prometheus im Cluster installiert sein und den entsprechenden Wert seiner Adresse in der Variablen <code>prometheusEndpoint</code> f√ºr Helm angeben.  Wenden Sie danach die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">YAML-Konfigurationen</a> im Cluster an. <br><br>  Auch hier m√ºssen Sie Ingress mit basic-auth manuell hinzuf√ºgen.  Und schlie√ülich m√ºssen Sie einen Abschnitt hinzuf√ºgen, um Kostenmodellmetriken in <code>extraScrapeConfigs</code> in der Prometheus-Konfiguration zu erfassen: <br><br><pre> <code class="plaintext hljs">- job_name: kubecost honor_labels: true scrape_interval: 1m scrape_timeout: 10s metrics_path: /metrics scheme: http dns_sd_configs: - names: - &lt;   kubecost&gt; type: 'A' port: 9003</code> </pre> </li></ol><br><h2>  Was bekommen wir? </h2><br>  Bei einer vollst√§ndigen Installation verf√ºgen wir √ºber das Webpanel Kubecost und Grafana mit einer Reihe von Dashboards. <br><br>  <b>Die</b> auf dem Hauptbildschirm angezeigten <b>Gesamtkosten</b> zeigen tats√§chlich die gesch√§tzten Kosten der Ressourcen f√ºr den Monat.  Dies ist der <i>prognostizierte</i> Preis, der die Kosten f√ºr die Nutzung des Clusters (pro Monat) auf dem aktuellen Niveau des Ressourcenverbrauchs anzeigt. <br><br>  Diese Metrik dient eher der Kostenanalyse und -optimierung.  Es ist nicht sehr bequem, die Gesamtkosten f√ºr den abstrakten Juli in Kubecost zu sehen: Sie m√ºssen <b>daf√ºr zur Abrechnung gehen</b> .  Sie k√∂nnen jedoch die Kosten nach Namespaces, Labels und Pods f√ºr 1/2/7/30/90 Tage aufschl√ºsseln, die Ihnen die Abrechnung niemals zeigen wird. <br><br><img src="https://habrastorage.org/webt/e7/wy/ue/e7wyueplh3ndwjmv5agldrofhkg.png"><br><br>  Apropos <b>Etiketten</b> .  Sie sollten sofort in die Einstellungen gehen und die Namen der Beschriftungen festlegen, die als zus√§tzliche Kategorien f√ºr die Gruppierung von Kosten verwendet werden: <br><br><img src="https://habrastorage.org/webt/0x/xr/h8/0xxrh8q1doxatdxzdgihdb0yjog.png"><br><br>  Sie k√∂nnen beliebige Etiketten daran aufh√§ngen. Dies ist praktisch, wenn Sie bereits √ºber ein eigenes Etikettiersystem verf√ºgen. <br><br>  Dort k√∂nnen Sie auch die Endpunkt-API-Adresse √§ndern, mit der das Kostenmodell eine Verbindung herstellt, die Rabattgr√∂√üe in GCP konfigurieren und Ihre eigenen Preise f√ºr Ressourcen und W√§hrungen festlegen, um diese zu messen (aus irgendeinem Grund wirkt sich die Funktion nicht auf die Gesamtkosten aus). <br><br>  Kubecost kann verschiedene <b>Probleme im Cluster</b> anzeigen (und bei Gefahr sogar alarmieren).  Leider ist die Option nicht konfigurierbar. Wenn Sie √ºber Entwicklerumgebungen verf√ºgen und diese verwendet werden, k√∂nnen Sie Folgendes st√§ndig beobachten: <br><br><img src="https://habrastorage.org/webt/of/gu/we/ofguweanrykbvv5xt7s8_mb-j8o.png"><br><br>  Ein wichtiges Werkzeug ist das <b>Einsparen von Clustern</b> .  Es misst die Aktivit√§t von Pods (Verbrauch von Ressourcen, einschlie√ülich Netzwerk) und ber√ºcksichtigt auch, wie viel Geld und was gespart werden kann. <br><br>  Es mag scheinen, dass Optimierungstipps ziemlich offensichtlich sind, aber die Erfahrung zeigt, dass es noch etwas zu sehen gibt.  Insbesondere wird die Netzwerkaktivit√§t von Pods √ºberwacht (Kubecost bietet an, auf inaktive zu achten), der angeforderte und der tats√§chliche Speicher- und CPU-Verbrauch sowie die von den Clusterknoten verwendete CPU (Angebote, mehrere Knoten zu einem zusammenzufassen), die Festplattenlast und ein paar Dutzend verglichen Parameter. <br><br>  Wie bei jedem Optimierungsproblem muss die Ressourcenoptimierung basierend auf Kubecost-Daten <b>mit Vorsicht behandelt werden</b> .  Zum Beispiel schl√§gt Cluster Savings vor, Knoten zu l√∂schen und zu behaupten, dass dies sicher ist, ber√ºcksichtigt jedoch nicht das Vorhandensein von Knotenselektoren und die Beeintr√§chtigung von Pods, die auf ihnen bereitgestellt werden und auf anderen Knoten nicht vorhanden sind.  Wie auch immer, selbst die Autoren des Produkts in ihrem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">j√ºngsten Artikel</a> (√ºbrigens kann es f√ºr diejenigen, die sich f√ºr das Thema des Projekts interessieren, sehr n√ºtzlich sein) empfehlen, sich nicht direkt auf die Kostenoptimierung einzulassen, sondern das Problem nachdenklich anzugehen. <br><br><h2>  Zusammenfassung </h2><br>  Nachdem wir kubecost einen Monat lang f√ºr einige Projekte verwendet haben, k√∂nnen wir daraus schlie√üen, dass dies ein interessantes (und sogar leicht zu erlernendes und zu installierendes) Tool zur Analyse und Optimierung der Kosten von Cloud-Anbietern ist, die f√ºr Kubernetes-Cluster verwendet werden.  Die Berechnungen sind sehr genau: In unseren Experimenten stimmten sie mit den tats√§chlichen Anforderungen der Anbieter √ºberein. <br><br>  Nicht ohne Nachteile: Es gibt unkritische Fehler, die Funktionalit√§t an einigen Stellen deckt nicht die spezifischen Anforderungen einiger Projekte ab.  Wenn Sie jedoch schnell verstehen m√ºssen, wohin das Geld flie√üt und was Sie ‚Äûk√ºrzen‚Äú k√∂nnen, um die Rechnung f√ºr Cloud-Dienste stetig um 5 bis 30% zu senken (dies ist in unserem Fall der Fall), ist dies eine gro√üartige Option. <br><br><h2>  PS </h2><br>  Lesen Sie auch in unserem Blog: <br><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Automatische Skalierung und Ressourcenverwaltung in Kubernetes (√úberpr√ºfung und Videobericht)</a> "; </li><li>  ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kubernetes-Adventure Dailymotion: Aufbau einer Infrastruktur in den Wolken + vor Ort</a> ‚Äú; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tipps und Tricks von Kubernetes: Zuweisung von Websites und Laden von Webanwendungen</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de466659/">https://habr.com/ru/post/de466659/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de466647/index.html">Telefon f√ºr ein Pferd und ein Orchester ohne Pianisten. Wie man Sportaufgaben am Frontend macht</a></li>
<li><a href="../de466649/index.html">Wochenende mit Elektroauto</a></li>
<li><a href="../de466651/index.html">Auswahl zwischen XML und SQL zum Rollen von LiquiBase-Skripten am Beispiel von Java / Spring / H2</a></li>
<li><a href="../de466653/index.html">Debugging-Spiele f√ºr NES: wie es heute passiert</a></li>
<li><a href="../de466657/index.html">Dynamisches Detail: verdeckte Compiler-Spiele, Speicherverlust, Leistungsnuancen</a></li>
<li><a href="../de466661/index.html">Fernstudium im Ausland: Notizen vor der Arbeit</a></li>
<li><a href="../de466663/index.html">Einfache Experimente mit dem Mikrocontroller STM32F103 (Blue Tablet)</a></li>
<li><a href="../de466665/index.html">CSS-√úberlauf und Datenverlust</a></li>
<li><a href="../de466667/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 379 (2. - 8. September 2019)</a></li>
<li><a href="../de466669/index.html">Tesla entwickelt Batterien, die 1,6 Millionen km ohne Ersatz laufen k√∂nnen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>