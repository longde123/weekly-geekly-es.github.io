<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå´Ô∏è ü§õüèº üì∑ C√≥mo intent√© arreglar un mapa de b√∫squeda de controladores. Parte 2 üõ≥Ô∏è üíò ü§Ωüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lo primero que quiero decir es que fue dif√≠cil. Mucho m√°s dif√≠cil de lo que pensaba. Ten√≠a antes esta experiencia tan dura en traer productos para lan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo intent√© arreglar un mapa de b√∫squeda de controladores. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440958/">  Lo primero que quiero decir es que fue dif√≠cil.  Mucho m√°s dif√≠cil de lo que pensaba.  Ten√≠a antes esta experiencia tan dura en traer productos para lanzar en el trabajo, pero nunca busqu√© proyectos personales.  Todos terminaron con prototipos de diversos grados de disgusto, pero este parec√≠a sobrevivir.  Por el momento, se ha lanzado para m√°s de 80 pa√≠ses (toda Europa, Asia y Am√©rica del Norte), en ambas plataformas m√≥viles, y al final del art√≠culo habr√° enlaces de descarga, por lo tanto, invito a todos los interesados ‚Äã‚Äãa probar, romper y rega√±ar. <br><img src="https://habrastorage.org/webt/bf/sb/yn/bfsbyn-oz8mgre0bdzet4a_k33c.png"><br>  Aqu√≠ hay un breve pensamiento con el que comenz√≥ todo: <i>en mi opini√≥n, una b√∫squeda en los mapas m√≥viles existentes se realiza para peatones y no funciona para los conductores en absoluto.</i>  <i>Debe detenerse, profundizar en los mapas llenos de exceso de informaci√≥n y publicidad, hurgar en peque√±os iconos.</i>  <i>Es inconveniente, no te ayudar√° en un lugar desconocido, al final es peligroso.</i>  <i>Se necesita una soluci√≥n intuitiva y limpia que no distraiga y que no disminuya la velocidad.</i> <i><br></i> <br>  En la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primera parte,</a> describ√≠ mi camino de este simple pensamiento a una soluci√≥n de trabajo, y luego describir√© c√≥mo arrastr√© esta soluci√≥n al lanzamiento. <br><a name="habracut"></a><br>  Para ahorrar tiempo, comenzar√© con un breve recuento de la parte anterior: all√≠ escribo que, en lugar de buscar, decid√≠ usar el escaneo en movimiento, y la interfaz de la aplicaci√≥n se simplific√≥ lo m√°s posible.  En lugar de una l√≠nea de entrada absurda para el conductor, agreg√≥ varios botones grandes para cosas que pueden ser √∫tiles en la carretera: gasolinera, carga, cajero autom√°tico, estacionamiento, farmacia.  En lugar de un mapa, hice una lista, y cuando selecciono un resultado, se abre la navegaci√≥n a trav√©s de Apple / Google Maps.  Para la aplicaci√≥n, decid√≠ usar Flutter (al mismo tiempo que supe qu√© tipo de animal es), tom√© los datos de OpenStreetMap.  Termin√© mi historia sobre el hecho de que un prototipo m√°s o menos cuerdo estaba listo. <br><br>  Luego todo tom√≥ alrededor de 4 a 5 meses, luego comenzaron los cambios en la vida y el proyecto qued√≥ en el camino, y comenc√© a cansarme de ello.  Un mes despu√©s, lo desempolv√©, lo actualic√© en mi cabeza escribiendo un art√≠culo en un centro y decid√≠: terminemos.  Cualquiera que sepa la diferencia entre un prototipo y un producto sonreir√° tristemente en este lugar. <br><br>  Lo que sucedi√≥ despu√©s tom√≥ otros cuatro meses.  Me consegu√≠ un rastreador de tareas, en t√©rminos generales form√© una lista de problemas, reun√≠ dispositivos para probar.  Por las tardes y los fines de semana, me sentaba en el trabajo y avanzaba el proyecto.  En qu√© momentos parec√≠a que la lista solo estaba creciendo, y me estaba ahogando en infinitos matices y toques finales.  Se tom√≥ de la mano, tir√≥ algo, por el contrario condujo al perfeccionismo.  A continuaci√≥n, tratar√© de hablar sobre los puntos m√°s interesantes en el desarrollo de un proyecto aparentemente tan simple. <br><br><h2>  Tecnolog√≠a </h2><br><h4>  Arquitectura general </h4><br>  En alg√∫n lugar en el medio del trabajo, comenz√≥ a aparecer una sensaci√≥n de que la arquitectura se estaba extendiendo fuera de control.  Se han enrollado demasiados componentes y conexiones; se han tocado varios cuellos de botella.  Afortunadamente, el proyecto es peque√±o y lo sent√≠ a tiempo, por lo que poner las cosas en orden no fue dif√≠cil.  A nivel de componentes individuales, esto se redujo a refactorizar y desechar bibliotecas innecesarias; a nivel global, extend√≠ la funcionalidad a 3 peque√±os servidores que comenc√© en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DigitalOcean</a> . <br><br><ol><li>  <i>Servidor API</i> (Python): el servidor principal, por el que recurrimos.  No hay mucha l√≥gica, principalmente la formaci√≥n de resultados para la producci√≥n.  El m√°s econ√≥mico en t√©rminos de recursos. </li><li>  <i>Servidor Elastic</i> (Java): Elasticsearch y Photon (geocodificador de c√≥digo abierto) est√°n girando sobre √©l.  Usan el mismo √≠ndice al que se importa todo el planeta desde OpenStreetMap.  Funciones del servidor: b√∫squeda de lugares por vertedero y geocodificador.  Por su naturaleza, el el√°stico es muy r√°pido y ligero, por lo que el servidor tampoco es muy grasiento. <br></li><li>  <i>Un servidor geogr√°fico</i> (Nodo) es el m√°s dif√≠cil de todos.  Basado en la m√°quina de enrutamiento de c√≥digo abierto, escrib√≠ una peque√±a API, y sus tareas incluyen todos los c√°lculos geogr√°ficos: establecer rutas, calcular is√≥cronas y generar mosaicos.  Cada operaci√≥n individual no es muy ingeniosa, pero se necesitan docenas de ellas para cualquier b√∫squeda, y esto se convierte en un cuello de botella.  Por el momento, en este servidor, 16 GB de RAM y, en general, todo funciona en una fracci√≥n de segundo, excepto para generar mosaicos.  Cuando hay muchos de ellos en la cola, puede esperar im√°genes con tarjetas en unos segundos.  Afortunadamente, aparecen en el cliente de forma asincr√≥nica, y esto no estropea en gran medida la imagen general (espero). <br></li></ol><br>  Adem√°s, decid√≠ alimentar extractos de OpenStreetMap para realizar geoc√°lculos por separado por pa√≠s.  Funciona as√≠: hacemos la primera solicitud con coordenadas a nuestro geocodificador, determina el pa√≠s y luego tomamos los archivos descargados solo de este pa√≠s para las manipulaciones que necesitamos.  Esto es necesario, porque incluso mi servidor bastante potente no puede convertir el extracto con un tama√±o superior a dos gigabytes; el proceso consume r√°pidamente toda la memoria y las obstrucciones.  Afortunadamente, casi todos los pa√≠ses se ajustan a este l√≠mite, excepto Estados Unidos: este monstruo tuvo que dividirse en estados.  Finalmente, para mantener mil quinientos extractos, decid√≠ escribir un mont√≥n de scripts que verificaran su estado, reparaci√≥n y actualizaci√≥n. <br><br><img src="https://habrastorage.org/webt/a4/p1/q5/a4p1q5quwoshyq34ptpfyoxllia.png"><br><br>  En general, todo esto suena m√°s complicado de lo que funciona en la pr√°ctica.  En principio, estoy satisfecho con la soluci√≥n resultante: tiene una buena reserva para escalar seg√∫n el n√∫mero de territorios admitidos y el nivel de carga. <br><br><h4>  Isochron din√°mico </h4><br>  Durante mucho tiempo, uno de los problemas clave para m√≠ fue la densidad heterog√©nea de resultados.  La raz√≥n es bastante comprensible: esta es la densidad heterog√©nea de la red de carreteras en s√≠ y de los edificios en ella.  En una ciudad mediana dentro de un radio de 5 minutos, puede haber 2-3 cajeros autom√°ticos, y ahora nos trasladaremos al centro de la metr√≥poli, y durante los mismos 5 minutos puede haber 20 o 30 resultados.  Finalmente, saltamos al campo y observamos un resultado 0 casi garantizado hasta que nos acercamos a la ciudad y el radio de b√∫squeda captura algo. <br><br>  Este problema genera una carga no lineal e impredecible en el servidor y, lo m√°s importante, una experiencia bastante desagradable para el usuario.  Agregar un filtro a las opciones (5 minutos, 10 minutos, 30 minutos) b√°sicamente no resuelve nada.  En el pueblo, incluso un radio de 30 minutos puede no devolver nada, pero en una megal√≥polis, incluso 5 minutos lo abrumar√°n con resultados.  Adem√°s, agregamos una funcionalidad adicional, en los botones de los cuales el conductor debe estar en movimiento.  En general, sin sentido, necesita una soluci√≥n fundamentalmente diferente. <br><br>  Cuando se encontr√≥ una soluci√≥n, result√≥ ser muy simple.  En lugar de pasar de lo contrario y pedirle al usuario que seleccione un radio de b√∫squeda, podemos hacer que este radio sea autom√°tico.  La l√≥gica es realmente elemental: <br><br><ol><li>  Establece l√≠mites en los resultados, por ejemplo, al menos 1 y no m√°s de 20, y comienza con 10 minutos <br></li><li>  Haz una b√∫squeda por lugar.  Hasta ahora, no necesitamos obtener indicaciones para llegar a ellos, as√≠ que solo necesitamos calcular la is√≥crona y filtrar por pol√≠gono en el el√°stico; ambas operaciones son muy baratas <br></li><li>  Si el n√∫mero de resultados se arrastra en una direcci√≥n desde los l√≠mites (en nuestro caso 0 o 20+), divida o multiplique el tiempo por 2 y vuelva a buscar.  Si est√° incluido en el l√≠mite, entonces ya construimos rutas, ordenamos por tiempo, etc. <br></li></ol><br>  De hecho, esto es un poco m√°s complicado y hay un par de matices, por ejemplo, una cuadr√≠cula de ciudad ultradensa, cuando ya hemos reducido el tiempo al m√≠nimo, y todav√≠a hay demasiados resultados.  Aqu√≠ ya es necesario clasificar y, por lo tanto, establecer rutas, lo cual es un poco costoso.  Sin embargo, estos son casos extremos y no son muy llamativos. <br><br>  En realidad, es poco probable que una persona se desplace por la lista debajo de 5-6 posiciones, por lo que en el 95% de los escenarios la is√≥crona din√°mica resolvi√≥ el problema.  Eliminamos el cuello de botella, una cantidad impredecible de resultados, e hicimos la carga en el servidor geogr√°fico para cualquier solicitud casi plana.  Verificar esto es muy f√°cil: <br><br>  <i>A la antigua usanza: tome un radio de 10 minutos y 30 resultados</i> <i><br></i>  <i>Resultado: 1 solicitud de isochron + 30 solicitudes de rutas = <b>31</b></i> <i><br><br></i>  <i>Nueva forma: compruebe, 30 resultados son muchos, divida el radio por la mitad, ahora obtenemos 10 resultados</i> <i><br></i>  <i>Resultado: 2 solicitudes de isocrona + 10 solicitudes de rutas = <b>12</b></i> <br><br><img src="https://habrastorage.org/webt/ta/ry/bs/tarybsvzvwhjow7ak13dgmcda60.png"><br><br><h4>  Nueva l√≥gica de mapa </h4><br>  En la √∫ltima parte, describ√≠ el mecanismo para generar tarjetas con rutas establecidas.  Luego result√≥ ser bastante complicado y costoso en t√©rminos de computaci√≥n, pero me gustaron tanto que decid√≠ dejarlos.  Al mismo tiempo, entend√≠ que en su forma actual ten√≠an pocos beneficios pr√°cticos: no estaba claro de qu√© manera iban, y todos estaban orientados hacia el norte.  Era necesario refinar. <br><br>  Lo primero que decid√≠ hacer fue desplegar los mapas en tiempo real usando una br√∫jula.  En cambio, esto fue descrito por l√≥gica microsc√≥pica y funcion√≥ muy r√°pidamente, sin embargo, con m√°s de 10 resultados que giran constantemente, el rendimiento comenz√≥ a disminuir.  Adem√°s, parec√≠a absolutamente repugnante: de hecho, las im√°genes est√°ticas giraban, y esto fue m√°s confuso durante el viaje de lo que de alguna manera ayud√≥. <br><br>  La siguiente idea era indicar en los mapas la direcci√≥n del movimiento de la flecha.  Era muy simple: ya ten√≠a un vector calculado y todo lo que ten√≠a que hacer era generar una forma geom√©trica de la flecha.  Al mismo tiempo, en una posici√≥n est√°tica, las tarjetas continuaron mostrando la posici√≥n del conductor con un marcador redondo.  Hubo una advertencia: era necesario normalizar los tama√±os de los marcadores y las flechas para diferentes niveles de zoom.  Esto parece ser una tarea simple, pero estuve atrapado en ella durante mucho tiempo.  La cuesti√≥n era esta: gener√© todos los s√≠mbolos en el mapa en metros, y tom√© como base la fracci√≥n de la altura de todo el mapa en metros.  Result√≥ que durante la creaci√≥n de mapas, determinando cuadros cuadrados delimitadores, pegando y recortando mosaicos en ellos, etc., se acumularon errores, y estos peque√±os errores finalmente condujeron a marcadores de tama√±os muy diferentes.  Especialmente infernal fue la situaci√≥n con las tarjetas a peque√±a escala.  Sin embargo, no entrar√© en los detalles de la soluci√≥n, debido a estos errores, la l√≥gica de la generaci√≥n de tarjetas tuvo que ser completamente redise√±ada.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El c√©sped</a> ayud√≥ mucho con esto: un gran conjunto de herramientas para manipular geodatos. <br><br>  Con las flechas las cartas ya eran m√°s √∫tiles, pero a√∫n faltaba algo.  Despu√©s de las pruebas en vivo, qued√≥ claro que todas las cartas se volvieron hacia el norte.  En est√°tica, esto no fue sorprendente, pero se hizo evidente de inmediato cuando te pones al volante.  El conductor inconscientemente espera que la flecha siempre apunte hacia arriba cuando conduce.  Despu√©s de descubrir esto, nuevamente me sent√© a trabajar.  Esta fue nuevamente una de esas tareas que parecen muy simples, pero pasar√° un par de d√≠as despu√©s.  Parecer√≠a: calcule el acimut y gire el GeoJSON final antes de la rasterizaci√≥n.  Pero nuevamente hubo un matiz: este GeoJSON final fue generado por un cuadro de delimitaci√≥n directa y, al rotarlo y recortarlo, detecta espacios vac√≠os. <br><br><img src="https://habrastorage.org/webt/e8/ru/m-/e8rum-k8gxclkhpgtsk95sdd2sw.png"><br><br>  En el diagrama de arriba, aproximadamente di mi soluci√≥n.  Como resultado, result√≥ no ser muy costoso en t√©rminos de recursos y cubr√≠a el 99% de los escenarios (creo que los errores subir√°n en alg√∫n lugar cerca de los polos).  En general, el servidor de computaci√≥n geogr√°fica sigue siendo la parte m√°s intensiva en recursos del proyecto, pero ahora sus tarjetas de ruta, adem√°s de la est√©tica, tambi√©n son muy pr√°cticas.  Incluso intent√© llegar al lugar usando estas tarjetas exclusivamente, sin incluir la navegaci√≥n.  E incluso lleg√≥. <br><br><img src="https://habrastorage.org/webt/43/t1/0b/43t10bq_ahbbeizyykpfd4jwl9a.png" width="600"><br><br><h4>  Calidad de los datos </h4><br>  Tom√© todos mis datos de diferentes maneras de OpenStreetMap.  Como saben, este recurso es 100% sin fines de lucro y est√° respaldado por una mente colectiva.  Esto es una ventaja (es gratis y con una estructura clara), tambi√©n es una desventaja: los datos son muy heterog√©neos. <br><br>  En un nivel alto, esto significa una cobertura desigual del mundo en su conjunto: en pa√≠ses y ciudades con una gran cantidad de entusiastas, se describe cada c√©sped y camino, y en otros lugares hay zonas casi vac√≠as con objetos b√°sicos incompletos.  Los datos se actualizan con exactamente la misma desigualdad.  Mientras probaba mi aplicaci√≥n, encontr√© un par de veces nuevas estaciones de servicio, caf√©s y, a veces, carreteras enteras que a√∫n no hab√≠a logrado poner en los mapas.  Quejarse de esto es est√∫pido: el mismo Google gasta presupuestos astron√≥micos y contiene todo un equipo de autom√≥viles responsables de la relevancia de sus datos.  Entonces, lo mejor que podemos hacer es sincronizar m√°s a menudo con los extractos de OpenStreetMap.  Bueno, deseen buena suerte a su comunidad. <br><br>  Pero en un nivel inferior, debido a la edici√≥n ca√≥tica de los mapas, hay una serie de otros problemas que pueden resolverse por completo.  Esto se refiere principalmente a datos basura y duplicados.  La variedad de este desorden es sorprendente: el mismo lugar se puede describir 3 veces de diferentes maneras, las instituciones no tienen nombres, tipos y etiquetas incorrectamente, etc.  Todo esto no tiene una soluci√≥n unificada; m√°s bien, se necesita un complejo de medidas para sistematizar el contenido.  Por ejemplo, tengo las siguientes condiciones: <br><br>  <i>Hay varios sin√≥nimos y variaciones de la misma etiqueta:&gt; describimos los diccionarios de alias (por ejemplo, estacionamiento, estacionamiento_espacio, estacionamiento_entrada, etc.).</i> <i><br><br></i>  <i>Hay varios lugares con el mismo tipo y las mismas coordenadas:</i> <i><br><br></i> <ul><li>  si todos no tienen nombre -&gt; el tipo de lugar se convierte en el nombre </li><li>  solo uno tiene un nombre -&gt; t√≥malo </li><li>  todos tienen un nombre y son diferentes -&gt; toma el apellido cronol√≥gicamente </li></ul><br>  Hay varios lugares con el mismo tipo y casi las mismas coordenadas: <br><br><ul><li>  si todos no tienen nombre -&gt; probablemente duplicados, no lo complicaremos.  Combinar en un punto con coordenadas promedio, en el que el tipo de lugar se convierte en el nombre.  Un hombre vendr√° y entender√° </li><li>  solo uno tiene un nombre -&gt; lo mismo, solo que ahora ya tenemos un nombre </li><li>  todos tienen un nombre y son diferentes -&gt; pero este es un cl√∫ster </li></ul><br>  El cl√∫ster en nuestro caso es una tarjeta en el encabezado de la cual se describen varios lugares.  Muy a menudo, estos son grupos de tiendas o estaciones de servicio cercanas.  O, por ejemplo, un cajero autom√°tico est√° ubicado dentro del edificio del banco y el otro afuera.  No representan ninguna dificultad para nosotros: calculamos las coordenadas promedio y trazamos la ruta hacia ellas.  En la interfaz, mostramos esto de manera limpia y simple: <br><br><img src="https://habrastorage.org/webt/ix/ru/jk/ixrujkqilkdxu34qjdsgt8e_pwo.png" width="300"><br><br><h2>  Interfaz y dise√±o </h2><br>  Entonces me ocurri√≥ que antes del inicio del desarrollo, generalmente ya me imagino la imagen final.  Al mismo tiempo, no me gusta dibujar diagramas y conceptos, prefiero formar un dise√±o en paralelo con las funciones (si este es mi proyecto, por supuesto).  Este enfoque iterativo es muy bueno, por un lado, porque le permite cambiar entre im√°genes y c√≥digo, por otro lado, a veces tiene que rehacer todo con demasiada frecuencia.  Aqu√≠ sucedi√≥ lo mismo: parece que he introducido la interfaz m√°s simple cien veces.  Comenzando desde peque√±os detalles como iconos y sangr√≠as, terminando con la composici√≥n de tarjetas, men√∫s, etc.  No describir√© todo, pasar√© r√°pidamente por cuestiones clave.  Si no est√° interesado en el dise√±o, no dude en saltearlo. <br><br><h4>  Paleta de colores </h4><br>  Durante mucho tiempo no pude entender qu√© hacer con la paleta.  Realmente quer√≠a designar las categor√≠as de lugares en diferentes colores, con la excepci√≥n del verde: decid√≠ guardarlo como un acento.  Eleg√≠ colores f√°cilmente distinguibles y ricos, todo parece estar bien.  Despu√©s de un tiempo, descubr√≠ que el azul de la estaci√≥n de servicio hace eco del azul, que en el mapa indica la posici√≥n del conductor.  No hizo nada con esto, lo dej√≥ como est√°, pero el perfeccionista interno no est√° satisfecho. <br><br><img src="https://habrastorage.org/webt/ya/dj/l8/yadjl8ri55axqz9pyzumcah0dfc.png" width="200"><br><br><h4>  "En el camino" y "Est√°s cerca" </h4><br>  Despu√©s de que apareci√≥ la l√≥gica que determina la direcci√≥n del movimiento del conductor, se hizo posible dividir las rutas en "a lo largo del camino" y el resto.  Como ya dije, esto est√° determinado por el primer segmento de la ruta establecida al lugar: ¬øcoincide con el √∫ltimo segmento de la ruta del conductor?  Si es as√≠, entonces ya vamos a este lugar.  Entonces surgi√≥ la pregunta de c√≥mo mostrar esto en la interfaz.  Adem√°s de los cambios en el mapa que describ√≠ anteriormente, surgi√≥ la idea de la placa "En el camino" (o "En ruta" en ingl√©s, parece que significan lo mismo).  Reutilizo el mismo dado para otro escenario: cuando la distancia al lugar encontrado es inferior a 25 metros.  Entonces no tiene sentido obtener indicaciones, oculto el mapa y escribo que ya est√°s cerca ("Est√°s cerca" / "Mira a tu alrededor"). <br><br><img src="https://habrastorage.org/webt/g6/1v/u9/g61vu93sak9y6igur-xaeigyc30.png" width="300"><br><br><h4>  Tarjeta comunitaria </h4><br>  Al comienzo del desarrollo de la depuraci√≥n, utilic√© un mapa est√°tico de Google para ver isocr√≥n y resultados.  Luego corri√≥ con ella durante mucho tiempo, sin saber d√≥nde quedarse: parece que el mapa es algo interesante, pero parece que no deber√≠a ocupar un lugar.  Adem√°s, dolorosamente ni siquiera quer√≠a depender de Google tan poco.  Entonces, al final, elimin√© el mapa, pero despu√©s de un tiempo comenc√© a generar tarjetas de ruta y me di cuenta de que yo mismo hab√≠a "crecido" tecnol√≥gicamente en el mapa grande.  Result√≥ que no fue tan dif√≠cil hacer esto, aunque hasta ahora el mapa com√∫n sigue siendo la pieza m√°s intensiva en recursos de todo el proyecto.  Y para que no ocupe espacio en la interfaz, coloco la tarjeta en una p√°gina separada (la extraer√°n con menos frecuencia). <br><br><img src="https://habrastorage.org/webt/9k/ks/na/9kksnaanyjsobkxxc1mjmhny25c.png" width="300"><br><br><h4>  Localizaci√≥n </h4><br>  Para una producci√≥n normal en producci√≥n, la localizaci√≥n es necesaria.  Siempre es, por un lado, un trabajo muy directo y simple, por el otro, cuando comienzas a hacerlo, multitudes de cucarachas se arrastran por todas partes.  En mi caso, el contenido principal de OSM ya estaba localizado, por lo que solo quedaban los tipos de lugar y los elementos de la interfaz.  Con la excepci√≥n de algunos tapones (durante mucho tiempo no pude formular un dado "en camino") todo fue f√°cil.  Vale la pena se√±alar que los nombres de lugares pueden ocupar 2 y 3 l√≠neas, y pueden no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">caber</a> en pantallas de ancho peque√±o; por lo tanto, el widget <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">auto_size_text</a> ayud√≥ aqu√≠, lo recomiendo dentro de l√≠mites razonables. <br><br><img src="https://habrastorage.org/webt/7z/yx/k3/7zyxk3gbrw0bamnfjf4fmgmysxe.png"><br><br>  Pero en el aspecto t√©cnico no fue tan suave.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasta la fecha, casi la √∫nica soluci√≥n para la localizaci√≥n bajo flutter es la biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intl_translation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y ... es extra√±o. </font><font style="vertical-align: inherit;">Est√° claro que tienen que sentarse en dos sillas y generar formatos de l√≠nea completamente diferentes para Android y iPhone. </font><font style="vertical-align: inherit;">Sin embargo, este enfoque consiste en transferir traducciones a una clase separada, luego ejecutar secuencias de comandos desde la consola (!) Para crear algunos archivos intermedios, luego preocuparse por ellos ... Todo esto no es evidente para un principiante, y lo m√°s importante es que es dif√≠cil de mantener, ya que cada edici√≥n est√° acompa√±ada de bailes manuales. con pandereta </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, existe la posibilidad de que no lo entend√≠ hasta el final, o tal vez algunos entornos de desarrollo ya lo hacen todo autom√°ticamente. </font><font style="vertical-align: inherit;">En cualquier caso, mi experiencia fue bastante estresante, y espero que los mecanismos de localizaci√≥n del aleteo se vuelvan a trabajar.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fecha de lanzamiento </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En realidad, no hay nada interesante que contar sobre el lanzamiento en s√≠. Hubo vagas sospechas de que la tienda de manzanas se negar√≠a a revolver la aplicaci√≥n, pero no se materializaron, todo sali√≥ bien. Volv√≠ a dibujar el icono y dibuj√© una p√°gina de introducci√≥n que se encuentra con el usuario por primera vez. Tuve que jugar un poco con los dibujos, pero parece que no pas√≥ nada. Tampoco surgieron dificultades con los permisos y su localizaci√≥n.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el √∫ltimo momento, la compilaci√≥n de la compilaci√≥n de lanzamiento para Android se rompi√≥ debido a la transici√≥n del soporte a androidx: algunas bibliotecas que utilic√© no lo admitieron de inmediato. </font><font style="vertical-align: inherit;">Como resultado, solo esper√© un par de d√≠as, pero debemos rendir homenaje a los autores de estas bibliotecas, que los arreglaron muy r√°pidamente. </font><font style="vertical-align: inherit;">Sin embargo, este incidente una vez m√°s me convenci√≥: no voy a arrastrar un gran proyecto comercial todav√≠a. </font><font style="vertical-align: inherit;">A pesar de que me gust√≥, toda la historia a√∫n es muy, muy cruda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bueno, como se prometi√≥, descargue enlaces:</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/e1/3u/p8/e13up8j3vvrxjqwlpo2n6sfzauy.png" width="150"></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/k3/oc/vm/k3ocvm5auzce0x4lwl7p57l5qqe.png" width="150"></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Planes </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y algunas palabras al final sobre los planes. </font><font style="vertical-align: inherit;">Si esto es √∫til para alguien que no sea yo y hay descargas, tengo muchas ideas para un mayor desarrollo. </font><font style="vertical-align: inherit;">Aqu√≠ hay una lista de muestra de lo que me gustar√≠a incluir en la versi√≥n No. 2:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m√°s datos sobre lugares (por ejemplo, precios de la gasolina o tipos de cargos para autom√≥viles el√©ctricos) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tema oscuro para conductores nocturnos </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modo compacto para ver m√°s resultados sin desplazarse (por ejemplo, apague el minimapa si lo desea) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aceleraci√≥n de la cartograf√≠a (realmente necesita considerar este cuello de botella, ya sea optimizar de alguna manera complicado o transferir a la virtualizaci√≥n de contenedores) </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Me gustar√≠a admitir Android Auto y Apple CarPlay a√∫n m√°s. </font><font style="vertical-align: inherit;">Nunca he hecho aplicaciones para ellos, as√≠ que tengo curiosidad por probarlo yo mismo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eso es todo, gracias a todos por su atenci√≥n.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440958/">https://habr.com/ru/post/440958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440946/index.html">Paquete acumulativo: ya puede crear aplicaciones</a></li>
<li><a href="../440948/index.html">No seas inteligente con los formularios de inicio de sesi√≥n</a></li>
<li><a href="../440950/index.html">Chrome Audit 500: Parte 1. Aterrizaje</a></li>
<li><a href="../440954/index.html">Ciclo de vida de un art√≠culo sobre Habr√©: escribimos un habraparser. Parte dos</a></li>
<li><a href="../440956/index.html">Orquestador n√≥mada alternativo en el escritorio</a></li>
<li><a href="../440960/index.html">Orange Pi 2G-IOT: mapa del campo minado</a></li>
<li><a href="../440962/index.html">Los proveedores de comunicaci√≥n van a obligar a celebrar contratos para la conexi√≥n de edificios residenciales.</a></li>
<li><a href="../440966/index.html">Conexi√≥n de sensores KELLER a MATLAB</a></li>
<li><a href="../440972/index.html">La Universidad de Innopolis tendr√° la primera escuela internacional de dise√±o de veh√≠culos aut√≥nomos de Rusia</a></li>
<li><a href="../440974/index.html">Los rompecabezas de Kotlin, vol. 2: un nuevo lote de rompecabezas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>