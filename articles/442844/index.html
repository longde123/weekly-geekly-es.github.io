<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏿 🚶🏻 🀄️ Kapitan al timón de Kubernetes 🕐 💢 🤹🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Conoce a Kapitan Le ayuda a aportar belleza y orden a su configuración de Kubernetes . 


 Kapitan se gana una reputación gracias a las críticas de lo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kapitan al timón de Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/442844/"><p><img src="https://habrastorage.org/webt/ph/zq/gy/phzqgyy4cpjrjdrbepggrga2rms.jpeg"></p><br><p>  Conoce a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kapitan</a>  Le ayuda a aportar belleza y orden a su configuración de <strong>Kubernetes</strong> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kapitan se</a> gana una reputación gracias a las críticas de los usuarios satisfechos y, por lo tanto, prescinde de una extensa documentación y un costoso marketing.  Tenemos suficientes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estrellas</a> y un par de menciones de los bloggers y predicadores de Kubernetes.  Kapitan incluso se convirtió en el protagonista de un capítulo entero en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">libro</a> .  Lo más importante, atrajo la atención de varias compañías prometedoras, porque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kapitan,</a> como nadie más, es capaz de desentrañar la <strong>configuración vinculada al nudo marino</strong> . </p><br><p>  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">kubernetes.slack.com</a> #kapitan logró reunir una comunidad pequeña pero dedicada (¡únete!), Así que estamos orgullosos de nuestro trabajo :) </p><br><p>  Muchos todavía creen que Kapitan es una mezcla de jsonnet y jinja, pero se equivocan. <br>  En esta publicación, te diré cómo Kapitan gestiona los despliegues de Kubernetes, pero en general es capaz de más que eso.  Esto es importante: Kapitan es universal y no está fijado en un Kubernetes.  Kubernetes es simplemente uno de los muchos usos. </p><br><p>  Esto no es una guía (aunque prometo una guía también).  Solo quiero decirle por qué lo hicimos y qué problemas con las implementaciones de configuraciones de Kubernetes debería resolver. </p><a name="habracut"></a><br><h3 id="chto-mne-ne-nravilos">  Lo que no me gustó </h3><br><p>  Comencé a experimentar con Kubernetes en 2015 e inmediatamente me enamoré. <br>  Es cierto que hay varios inconvenientes que no quiero soportar: </p><br><ul><li> <strong>Contexto</strong>  Para mí, este es uno de los conceptos más difíciles de entender <strong>Kubernetes</strong> , y uno de los más peligrosos.  El contexto se refiere al cliente, es difícil de entender, se le llama confusamente y crea confusión al ejecutar los comandos de <strong>kubectl</strong> .  ¡Odio los contextos en kubectl! </li><li>  <strong>Configuración anidada detallada (¡yaml!)</strong> .  Tuve que sudar para descubrir cada nivel de configuración de YAML en el manifiesto.  ¿Cuál es el punto de repetir etiquetas dos o tres veces en varios lugares? </li><li>  <strong>Un desastre con equipos imperativos y declarativos</strong> .  Se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">anima</a> a los recién llegados a Kubernetes a aprender por equipos imperativos, aunque está claro que las personas normales no los usan.  En mi opinión, es más difícil adaptar a Kubernetes a la estrategia de implementación adecuada para su empresa.  Spoiler: No existe una única "estrategia correcta". </li><li>  <strong>Configuración de tiempo de ejecución</strong> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jesse Suen tiene</a> razón cuando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aconseja</a> no pasar los parámetros de configuración a la línea de comando del timón (o kubectl y otros por el estilo).  Con los parámetros, el mismo comando se puede ejecutar de manera diferente cada vez. </li><li>  <strong>Configuración de la aplicación</strong>  Aprendimos a manejar los manifiestos de yaml en Kubernetes, somos geniales.  Eso es justo debajo e Implementar: este es un recipiente vacío.  Todavía tiene que hacer flotar la aplicación con toda su configuración. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Los desarrolladores quieren unas vacaciones</strong></a> , y el flujo de trabajo en Kubernetes todavía es un poco lento.  Los fanáticos de Kubernetes están obligando a todos a hacerlo allí mismo.  ¿Es necesario?  Obedecer Kelsey Hightower! </li><li>  <strong>Operadores</strong>  Tengo sentimientos encontrados por ellos, así que por ahora deja este tema :) Solo puedo decir que a menudo se abusa de ellos. </li><li>  <strong>Idempotencia</strong> .  Más bien, su ausencia.  Si sumamos todas las deficiencias anteriores, obtenemos flujos de trabajo insuficientemente idempotentes, lo cual es triste para Kubernetes. </li></ul><br><h3 id="chto-delat">  Que hacer </h3><br><p>  Traté de resolver estos problemas y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">armé</a> un pequeño sistema de plantillas que usaba <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">j2cli</a> y un par de scripts bash para administrar las configuraciones de Kubernetes. </p><br><p>  El sistema puso todo en el archivo environmentA.yaml y lo usó en la plantilla Jinja2.  La implementación de aplicaciones de estilo microservicio desde varios componentes fue posible con un simple comando: </p><br><pre><code class="plaintext hljs">bin/apply.sh environments/environmentA.yaml</code> </pre> <br><p>  Genial!  Yaml tenía que ver con el despliegue.  Es muy conveniente, porque podría usar el mismo archivo como fuente de información para otra cosa.  Digamos por ... ¡ <strong>guiones bash</strong> ! </p><br><p>  Descubrí cómo importar valores de yaml a scripts para ejecutar comandos similares: </p><br><pre> <code class="plaintext hljs">bin/create_kafka_topics.sh environments/environmentA.yaml</code> </pre> <br><p>  <em>Y luego todo se salió de control de una vez</em> : </p><br><ul><li>  No pude hacer nada con la estructura en el archivo yaml.  Era una mezcla de los mismos campos, valores, configuración confusa. </li><li>  Nunca sabrá cómo comportarse la implementación en el entorno hasta que lo intente.  A menudo, esto se debió a cambios en las plantillas de jinja2 debido a un nuevo valor de inventario (por ejemplo, feature_X) que no funcionó en entornos donde esta función no está definida. </li><li>  El mismo problema con los scripts: si no lo intentas, no lo sabes. </li><li>  A veces, Kubernetes cambió tan rápido que me molestó cambiar constantemente los manifiestos para diferentes versiones, especialmente jugando con anotaciones a los valores. </li><li>  <strong>Factor externo</strong> : el equipo de desarrollo cambió de archivos de configuración a parámetros de línea de comando.  Un cambio tan pequeño nos confundió todas las cartas, y tuvimos que pensar en una nueva solución. </li><li>  <strong>Lo más importante</strong> : ¡crear plantillas de yaml con Jinja (o plantillas Go) NO ES DIVERTIDO!  Luego tuvimos un enigma: “ <em>¿Qué parece texto, se lee como texto, huele a texto, pero no a texto?</em>  ".  O, como Lee Briggs lo dijo acertadamente: “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¿Por qué demonios somos plantilla yaml?</a>  " </li></ul><br><h3 id="kapitan-stanovlenie">  Kapitan: convertirse </h3><br><p>  Reunimos toda nuestra amarga experiencia y, junto con Ricardo Amaro, comenzamos a fantasear con un sistema de gestión de configuración ideal.  Entonces todavía no teníamos una imagen clara, pero sabíamos que amamos y que no amamos. </p><br><p>  <strong>Amor</strong> </p><br><ul><li>  Git </li><li>  Patrones en general: datos / valores separados de patrones. </li><li>  Valores separados para diferentes aspectos (aplicación, Kubernetes, tiempo de ejecución ...). </li><li>  Enfoque orientado a objetos. </li><li>  YAML simplificado como una interfaz donde ocultar la complejidad de Kubernetes. </li><li>  Una comprensión clara de lo que está sucediendo y por qué. </li><li>  Reutilización de valores en diferentes componentes. </li><li>  Y los scripts deberían tener acceso a los valores. </li></ul><br><p>  <strong>No nos gusta</strong> : </p><br><ul><li>  Contextos de Kubectl </li><li>  Motores de plantillas de texto para crear yaml. </li><li>  Conteo de sangría: <code>{{ toYaml .Values.resources | indent 10 }}</code>  <code>{{ toYaml .Values.resources | indent 10 }}</code> . </li><li>  Magia: todo debe ser claro y claro.  No hay trucos </li><li>  Gestión manual de contraseñas y secretos de la aplicación. </li><li>  Enfoque Tiller: Queríamos controlar el uso de manifiestos. </li><li>  Enfoque Git-crypt: los secretos en el disco no están encriptados. </li><li>  Tubería de plantilla directamente a kubectl. </li><li>  Pasando opciones de línea de comando. </li></ul><br><p>  <strong>Y luego sucedieron dos cosas</strong> : </p><br><ol><li>  Descubrimos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">jsonnet de</a> Dave Cunningham para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">crear</a> plantillas de yaml / json en un lenguaje orientado a objetos. </li><li>  Gustavo Buriola nos mostró la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>reclasificación</strong></a> , y sin él no habríamos ido muy lejos. </li></ol><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ricardo Amaro se</a> puso a trabajar y pronto todo el equipo se sentó en Kapitan: algunos trabajaron en la funcionalidad básica, otros en su uso en nuestros proyectos internos.  Gestión de secretos, soporte gpg \ kms, funciones definidas por el usuario: ahora Kapitan es un producto completo que hace más de lo prometido. </p><br><h3 id="kto-takoy-kapitan">  Quien es Kapitan? </h3><br><p>  Kapitan está tratando de resolver todos (o casi todos) los problemas de los que hablé. </p><br><p>  <strong>Desde un punto de vista técnico,</strong> Kapitan es muy simple: </p><br><ul><li>  <strong>Inventario</strong> : una colección jerárquica de valores que describe la implementación basada en yaml.  Basado en reclases.  Como hiera. </li><li>  <strong>Motores de plantilla</strong> : ahora es Jinja2, Jsonnet, Kadet.  Ellos hacen un inventario y crean archivos (yaml, json, documentación o scripts bash). </li><li>  <strong>Secretos</strong> : secretos de plantillas, y Kapitan se ocupará de ellos. </li></ul><br><p>  Estamos usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">jsonnet</a> para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">crear</a> manifiestos y Jinja para hacer el resto. </p><br><blockquote>  A veces, las personas se quejan de que el archivo jsonnet es completamente diferente del mismo yaml, por lo que les resulta difícil cambiar a jsonnet. <br><br>  Intentamos resolver este problema con Kadet envolviendo yaml en Python.  Tome su yaml favorito como base y agréguele Python. <br><br>  ¡Considera esto un <strong>exoesqueleto de Python</strong> para yaml!  De alguna manera hablaré sobre esto. </blockquote><p>  <strong>En el flujo de trabajo,</strong> Kapitan muestra inmediatamente el personaje: </p><br><ul><li>  <strong>Libertad de elección</strong> : no imponemos ningún proceso de trabajo y tecnología, pero generalmente trabajamos en los principios que se describen a continuación.  De hecho, Kapitan puede usarse como quieras.  No es necesario que use git, no debe compilar archivos en él, ¡e incluso puede hacerlo sin jsonnet!  Haz lo que quieras. </li><li>  <strong>GitOps</strong> hasta el hueso: todo en git, todo en una luz <strong>maestra</strong> que refleja nuestra intención. </li><li>  <strong>Declarabilidad</strong> : Kapitan agradece la compilación de plantillas de manifiesto en representaciones específicas.  Y compilas tus guiones. </li><li>  <strong>Contexto controlado</strong> : utilizamos scripts compilados para simplificar nuestro trabajo, por ejemplo, al establecer contextos y configurar clústeres. <br>  Configuración de Kubernetes: <code>compiled/target_A/setup/setup.sh</code> <br>  Aplicar cambios: <code>compiled/target_A/setup/apply.sh</code> </li><li>  <strong>Idempotencia</strong> : Kapitan le permite cambiar plantillas y herramientas de refactorización de código.  Los manifiestos y el código compilados no cambiarán sin su comando, por lo que no tiene nada que temer al refactorizar. </li><li>  <strong>Causa y efecto</strong> : estamos a favor de un flujo de trabajo donde los cambios en el inventario o las plantillas y los archivos compilados se incluyen en una solicitud de fusión.  Por lo tanto, el revisor podrá evaluar sus cambios y sus consecuencias reales.  Es bueno saber si un cambio en la plantilla afectará a uno, dos o más objetivos. </li><li>  <strong>Y finalmente</strong> : Kapitan no está apegado a Kubernetes.  Simplemente crea archivos.  El despliegue de cambios implicó <strong>kubectl</strong> .  Solo damos un shell para que los comandos se ejecuten de manera consistente. </li></ul><br><h3 id="ono-mne-nado">  ¿Lo necesito? </h3><br><p>  <strong>Dejémoslo claro</strong> : probablemente no necesites Kapitan (todavía). </p><br><p>  Pero todo depende de lo que intente hacer y de lo complicado que sea su sistema. </p><br><p>  <strong>Kapitan es una poderosa herramienta de</strong> inversión.  Úselo en escenarios complejos donde tiene que implementar un montón de aplicaciones en un montón de clústeres. </p><br><p>  Si tiene aplicaciones estándar, solo está aprendiendo Kubernetes o ya está satisfecho con su flujo de trabajo, entonces <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Helm</a> o su alternativa actual funcionarán. </p><br><p>  Me imagino a <strong>Helm</strong> como <strong>apto</strong> para <strong>Kubernetes</strong> , y <strong>Kapitan</strong> es algo así como <strong>Puppet</strong> . </p><br><p>  En la próxima publicación daré ejemplos específicos y describiré en detalle el inventario.  Escriba sobre lo que quiere saber o con lo que está de acuerdo / en desacuerdo en esta publicación. </p><br><p>  Gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jacek Gruzewski</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442844/">https://habr.com/ru/post/442844/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442834/index.html">Instale Windows a través de los Servicios de implementación de Windows y el Kit de herramientas de implementación de Microsoft</a></li>
<li><a href="../442836/index.html">Vue.js render funciones y transiciones (traducido por Hajime Yamasaki Vukelic)</a></li>
<li><a href="../442840/index.html">Backend United 3: Jellied</a></li>
<li><a href="../442846/index.html">Nuestra industria espacial. Una mirada a los problemas de la industria desde la perspectiva de un desarrollador ordinario</a></li>
<li><a href="../442852/index.html">Dell 6000 o hola desde 2005</a></li>
<li><a href="../442854/index.html">¿Cómo hicimos el esquema del metro de Minsk?</a></li>
<li><a href="../442856/index.html">Dos en uno: monitor y reloj de calidad del aire programables por Wi-Fi</a></li>
<li><a href="../442858/index.html">¿Hay demasiados elefantes en África? Cómo la coexistencia pacífica con las comunidades humanas puede ayudar en esto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>