<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   PWA es f谩cil. Hola joomla  锔 そ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuar estudiando aplicaciones web progresivas. Despu茅s de la primera parte te贸rica y un ejemplo pr谩ctico simple de Hello Habr, la segunda parte, i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PWA es f谩cil. Hola joomla</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419879/">  Continuar estudiando aplicaciones web progresivas.  Despu茅s de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primera parte</a> te贸rica y un ejemplo pr谩ctico simple de Hello Habr, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">segunda parte,</a> intentaremos transferir el sitio web de PWA a CMS Joomla. <br><br>  El tipo de marco de servidor no es importante.  El prop贸sito de este art铆culo es mostrar la traducci贸n de un sitio regular a PWA como un concepto que se aplica a sitios arbitrarios en cualquier marco. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3e/d50/eff/e3ed50eff39c7b5659a6e465bc2315fb.png"><a name="habracut"></a><br><br>  Para comenzar, descargue e instale Joomla.  Durante la instalaci贸n, indicamos que es necesario llenar el sitio con datos de demostraci贸n: seleccione la opci贸n "Blog".  Llegamos aqu铆 a tal sitio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://tetta.nut.cc/habr/hello-joomla/original/</a> .  Luego copie todos los archivos del sitio en el directorio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://tetta.nut.cc/habr/hello-joomla/</a> , ahora tenemos dos instancias de trabajo del sitio de Joomla en la misma base de datos.  Dejaremos el primero como est谩 y el segundo lo transferiremos a la versi贸n PWA. <br><br>  El c贸digo fuente de un ejemplo de este art铆culo se puede ver en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub-e</a> <br><br><div class="spoiler">  <b class="spoiler_title">Un poco sobre la estructura de Joomla</b> <div class="spoiler_text"><blockquote>  Joomla tiene un concepto de plantilla: un conjunto de recursos web que son responsables del nivel de presentaci贸n.  Las plantillas se encuentran en el directorio / templates, nuestro est谩ndar "listo para usar" se llama protostar. <br><br>  En el caso general, despu茅s de recibir una solicitud del navegador, Joomla inicia el motor, hace lo suyo y luego transfiere la ejecuci贸n de la solicitud a /templates/protostar/index.php, que ya est谩 generando HTML para el cliente.  Este archivo es un simple archivo PHP, en el que tambi茅n es posible el uso de dos directivas: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  El primero inserta en su lugar el material principal correspondiente a la URL (componente) solicitada, el segundo, los m贸dulos prescritos por el administrador para el puesto especificado.  Cualquier p谩gina en Joomla consta de un componente y m贸dulos. <br><br>  Si observa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la plantilla del sitio</a> , puede ver el bloque del material principal en la parte central de la p谩gina, y no hay m贸dulos alrededor.  El men煤 superior es la posici贸n 1, la columna derecha con dos m贸dulos "Publicaciones m谩s antiguas" y "Publicaciones m谩s le铆das" es la posici贸n 7, y as铆 sucesivamente. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba6/52d/6db/ba652d6dbdb81582843279fe01832c53.png" alt="imagen"><br><br>  Joomla tiene una peculiaridad: si la solicitud GET <i>recibida</i> tiene un par谩metro <i>tmpl</i> con <i>alg煤n</i> valor de p谩gina, Joomla no transmite la ejecuci贸n de la solicitud a index.php al archivo de plantilla, sino a somePage.php, si corresponde.  Lo usamos a continuaci贸n. </blockquote><br></div></div><br><h2>  Shell de aplicaci贸n </h2><br>  Ahora necesitamos aislarnos del shell de la aplicaci贸n del sitio: el shell de la aplicaci贸n que se est谩 creando.  Al desarrollar un sitio PWA desde cero, puede haber diferentes estrategias para esto, pero en un sitio terminado es conveniente usar la divisi贸n en sus partes est谩ticas y din谩micas. <br><br>  La est谩tica es algo que rara vez cambia y puede ser parte del shell de la aplicaci贸n.  Por ejemplo, el men煤 superior de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuestro sitio</a> puede considerarse est谩tico: solo lo cambia el administrador y puede solicitar expl铆citamente la actualizaci贸n del shell de la aplicaci贸n en los navegadores del cliente despu茅s de editarlo. <br><br>  Al mismo tiempo, el contenido en s铆, as铆 como los m贸dulos en la posici贸n 7 y el m贸dulo Breadcrumbs en la posici贸n 2, que muestran d贸nde se encuentra actualmente el usuario en el sitio, son din谩micos.  Deben cargarse en el navegador del cliente. <br><br><h3>  1. Cambios en el servidor </h3><br>  Reemplace todos los bloques din谩micos con marcador de posici贸n.  En el archivo index.php de la plantilla, cambie las directivas: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component"</span></span></span><span class="hljs-tag"> /&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main-content"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag"> /&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module-id"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Tambi茅n conectamos nuestro archivo javascript hello-joomla.js en index.php adem谩s de los scripts de plantilla. <br><br>  Cree el archivo main-content.php con los siguientes contenidos: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Archivo Module-2.php: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"none"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Y el archivo module-7.php: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-7"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"well"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><br>  El significado de lo que se hizo es que cuando solicite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://tetta.nut.cc/habr/hello-joomla/index.php/5-your-modules?tmpl=module-7</a> solo obtendremos el c贸digo de los m贸dulos ubicados en posici贸n- 7)  Lo mismo con el contenido. <br><br>  Todos estos son cambios en la parte del "servidor" del sitio.  En otros marcos, estas operaciones (destacando el shell de la aplicaci贸n) probablemente ser谩n un poco m谩s complicadas, pero aqu铆 tenemos suerte. <br><br><h3>  2. Lado del cliente </h3><br>  En hello-joomla.js, necesitamos implementar una carga din谩mica de contenido y m贸dulos.  Adem谩s, debe cambiar el comportamiento de todas las etiquetas &lt;A&gt; para que al hacer clic en el enlace se inicie la carga din谩mica de los datos de la p谩gina.  Los m贸dulos de la columna de la derecha se cargar谩n una vez cuando se abra el sitio en el navegador, y las migas de pan y el contenido se cargar谩n cada vez que haga clic en el enlace interno. <br>  Esto tambi茅n es f谩cil: <br><br><div class="spoiler">  <b class="spoiler_title">hola-joomla.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   url  HTML  el function loadData(el, url){ url.indexOf("?") &gt;= 0 ? url += "&amp;" : url += "?"; url = url + 'mode=nocache&amp;tmpl=' + el; fetch(url) .then( function(response) { if (response.status == 200) { response.text().then(function(data) { document.getElementById(el).innerHTML = data; }); } }) .catch(); return false; } //    &lt;a&gt;    function handleLinks() { var links = document.querySelectorAll('a'); for (var i = 0; i &lt; links.length; ++i) { links[i].removeEventListener("click", handleLink); links[i].addEventListener("click", handleLink); } } //   function handleLink(e) { e.preventDefault(); loadData("main-content", this.href); loadData("module-2", this.href); handleLinks(); return false; } //      function DOMLoaded() { loadData("main-content", location.pathname); loadData("module-2", location.pathname); loadData("module-7", location.pathname); handleLinks(); } document.addEventListener('DOMContentLoaded', DOMLoaded, true);</span></span></code> </pre> <br></div></div><br>  En este momento, hemos rehecho nuestro sitio en un SPA completo - aplicaci贸n de una sola p谩gina - aplicaci贸n.  Hay pulido a la izquierda: el enlace "Volver al principio", estilos del men煤 superior, formulario de b煤squeda, precargador animado, etc. <br>  Una copia del sitio en modo SPA est谩 disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://tetta.nut.cc/habr/hello-joomla/spa/</a> . <br><br><h3>  3. SPA -&gt; PWA </h3><br>  Conectamos el manifiesto y sw.js del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplo anterior</a> en index.php.  Para evitar que Service Worker almacene en cach茅 las solicitudes din谩micas, agregue <i>"mode = nocache"</i> a la url en hello-joomla.js en la funci贸n loadData. <br><br>  Eso es todo.  Se puede arreglar a la pantalla de inicio. <br><br><h2>  Conclusiones </h2><br>  Como puede ver, para convertir un sitio web en una aplicaci贸n PWA, no se necesitan marcos ni herramientas.  Todo se hace a mano, y el c贸digo permanece limpio y claro. <br><br>  En el pr贸ximo art铆culo, en forma de consejos 煤tiles, funcionalmente llevaremos el sitio al nivel de lanzamiento en producci贸n.  Quedan mejoras est谩ndar de SPA: el t铆tulo de la p谩gina en el navegador, Google Analitics, la verificaci贸n de que nada valioso sali贸 para los motores de b煤squeda.  Realizaremos una gesti贸n de almacenamiento en cach茅 conveniente para Service Worker-a para actualizar r谩pidamente los elementos del shell de la aplicaci贸n.  Adem谩s, los editores y comentaristas del sitio desean poder insertar im谩genes de Internet en los materiales del sitio, incluso a trav茅s del protocolo http. <br><br><blockquote>  Una de las grandes caracter铆sticas del concepto PWA es que da vida al paradigma MVC perdido en muchos marcos de servidores y navegadores.  "Ver" ahora vive en el cliente, y el navegador accede al servidor para obtener los <i>datos</i> , no para su <i>presentaci贸n</i> . <br><br>  Y, a diferencia de los SPA convencionales, PWA construye esta "Vista" no con frameworks javascript pesados, sino con el viejo y r谩pido html + css. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es419879/">https://habr.com/ru/post/es419879/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es419869/index.html">La revoluci贸n de la IA no ser谩 hecha por droides, sino por tostadoras</a></li>
<li><a href="../es419871/index.html">C贸mo Google est谩 tratando de desarrollar un motor de b煤squeda censurado para China</a></li>
<li><a href="../es419873/index.html">Probar solo a trav茅s de m茅todos p煤blicos es malo</a></li>
<li><a href="../es419875/index.html">Una vez m谩s sobre retrasos en el c贸digo fuente del proyecto FPGA o una simple pregunta para una entrevista para un trabajo de desarrollador FPGA</a></li>
<li><a href="../es419877/index.html">C贸mo inventamos nuevamente la "casa inteligente"</a></li>
<li><a href="../es419883/index.html">Obtenga la diferencia entre archivos binarios usando vcdiff</a></li>
<li><a href="../es419885/index.html">Traducci贸n del libro de Andrew Un, Pasi贸n por el aprendizaje autom谩tico, cap铆tulos 15-19</a></li>
<li><a href="../es419893/index.html">C贸mo hacer b煤squedas de usuarios en Github usando VanillaJS</a></li>
<li><a href="../es419895/index.html">El nuevo motor permitir谩 que los microsat茅lites realicen tareas "para adultos"</a></li>
<li><a href="../es419897/index.html">"Machine Sound": sintetizadores basados en redes neuronales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>