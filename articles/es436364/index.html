<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõåüèº üë¶üèª üî≠ Liveprof mostrar√° cu√°ndo y por qu√© ha cambiado el rendimiento de su aplicaci√≥n PHP üè∑Ô∏è üê¥ üêÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! Mi nombre es Timur Shagiakhmetov, soy desarrollador de PHP en Badoo . 

 El rendimiento de la aplicaci√≥n es uno de los criterios m√°s import...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Liveprof mostrar√° cu√°ndo y por qu√© ha cambiado el rendimiento de su aplicaci√≥n PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/436364/"><img src="https://habrastorage.org/webt/sm/5p/or/sm5porzvybv5m_8ngvmgicgmeui.jpeg"><br><br>  Hola Habr!  Mi nombre es Timur Shagiakhmetov, soy desarrollador de PHP en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Badoo</a> . <br><br>  El rendimiento de la aplicaci√≥n es uno de los criterios m√°s importantes para la calidad del trabajo de un programador.  En materia de optimizaci√≥n de aplicaciones PHP, el asistente es el generador de perfiles. <br><br>  Recientemente, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hablamos</a> sobre las herramientas que utilizamos para la creaci√≥n de perfiles.  Perm√≠tame recordarle: una de las herramientas para el an√°lisis de rendimiento, cuando no est√° claro qu√© partes del c√≥digo han influido en el aumento del tiempo de generaci√≥n de respuesta, es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">XHProf</a> .  Esta es una extensi√≥n para PHP que le permite perfilar el c√≥digo en un servidor de combate y luego mejorarlo. <br><br>  Pero tambi√©n me gustar√≠a tener un historial de cambios en el rendimiento para que pueda rastrear qu√© y cu√°ndo se ve afectado su deterioro, ¬øverdad?  Para hacer esto, hace aproximadamente un a√±o, desarrollamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Liveprof</a> , una herramienta para perfilar autom√°ticamente todas las solicitudes con una interfaz para analizar los cambios en el rendimiento de la aplicaci√≥n. <br><br>  Nuestra herramienta le permite analizar el cambio de rendimiento de cualquier parte del c√≥digo, encontrar los lugares donde m√°s cay√≥.  Al mismo tiempo, no es necesario activarlo espec√≠ficamente y esperar a que se acumulen las estad√≠sticas; siempre est√° activo y recopila datos para una cierta fracci√≥n de todas las solicitudes. <br><br>  En este art√≠culo hablar√© sobre los detalles de implementaci√≥n y las caracter√≠sticas del uso de esta herramienta. <br><a name="habracut"></a><br><h2>  Un poco sobre XHProf </h2><br>  Primero, algunas palabras sobre las caracter√≠sticas de XHProf.  Este es un generador de perfiles para PHP escrito en C como una extensi√≥n.  Fue desarrollado en Facebook y publicado en el dominio p√∫blico.  Tiene varias horquillas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uprofiler</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tideways</a> ), totalmente compatibles a nivel del formato de datos de salida. <br><br>  XHProf establece temporizadores alrededor de todas las llamadas a funciones / m√©todos.  Su uso implica algunos gastos generales.  Pero no son tan grandes y permiten usarlo en producci√≥n. <br><br>  El resultado de XHProf es una matriz de elementos en el siguiente formato: <br><br><pre><code class="php hljs">$data = [ <span class="hljs-string"><span class="hljs-string">'parentMethodName==&gt;childMethodName'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'ct'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">'wt'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-string"><span class="hljs-string">'cpu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-string"><span class="hljs-string">'mu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">528</span></span> <span class="hljs-string"><span class="hljs-string">'pmu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ] ];</code> </pre> <br>  donde <br><br>  <code><b>parentMethodName</b></code> y <code><b>childMethodName</b></code> son los m√©todos padre e hijo, respectivamente; <br>  <code><b>ct</b></code> : el n√∫mero de llamadas en el contexto de la solicitud; <br>  <code><b>wt</b></code> : tiempo de ejecuci√≥n de la solicitud (consiste en el tiempo empleado por el procesador y el tiempo de espera para E / S o la respuesta de otro servicio); <br>  <code><b>cpu</b></code> : tiempo empleado por el procesador en procesar la solicitud; <br>  <code><b>mu</b></code> : cambio en el consumo de memoria despu√©s de una llamada al m√©todo; <br>  <code><b>pmu</b></code> : cambio en el consumo m√°ximo de memoria despu√©s de una llamada al m√©todo. <br><br>  Algunas otras opciones tambi√©n son posibles. <br><br>  XHProf tambi√©n contiene herramientas para visualizar los resultados as√≠ obtenidos.  Para cada operaci√≥n de creaci√≥n de perfiles, obtenemos una tabla con un conjunto de par√°metros para cada m√©todo. <br><br>  Por ejemplo <br><br><div class="spoiler">  <b class="spoiler_title">resultado de clasificaci√≥n de burbujas</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRandomArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $count)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $array = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $count; $i++) { $array[] = rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $array; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BubbleSorter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$array)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $len = count($array); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $len ; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; $len - $i - <span class="hljs-number"><span class="hljs-number">1</span></span>; $j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($array[$j] &gt; $array[$j + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;swap($array[$j], $array[$j + <span class="hljs-number"><span class="hljs-number">1</span></span>]); } } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">swap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$a, &amp;$b)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $tmp = $a; $a = $b; $b = $tmp; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSorted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $array)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{ $len = count($array); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $len - <span class="hljs-number"><span class="hljs-number">1</span></span>; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($array[$i] &gt; $array[$i + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayPrinter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $array, string $delimiter = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">' '</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> implode($delimiter, $array) . PHP_EOL; } } xhprof_enable(); $n = <span class="hljs-number"><span class="hljs-number">10</span></span>; $arrayGenerator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ArrayGenerator(); $array = $arrayGenerator-&gt;getRandomArray($n); $sorter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BubbleSorter(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$sorter-&gt;isSorted($array)) { $sorter-&gt;sort($array); } $printer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ArrayPrinter(); $printer-&gt;print($array); $xhprof_data = xhprof_disable();</code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/ip/cw/vi/ipcwviocimg7kjon1memwwziho8.png"><br><br>  Puede ir dentro de cada m√©todo para averiguar qu√© m√©todos han utilizado cu√°ntos recursos. <br><br>  Tambi√©n puede mirar el gr√°fico de llamadas resaltando los m√©todos que requieren m√°s recursos: <br><br><img src="https://habrastorage.org/webt/zq/yw/pl/zqywplc0eibbdxdotsr3f0bed_o.png"><br><br>  XHProf es √∫til para analizar manualmente el rendimiento de cada solicitud.  Pero tambi√©n es importante para nosotros ver el panorama general.  Debe comprender c√≥mo ha cambiado el rendimiento con el tiempo.  Para hacer esto, se desarroll√≥ una herramienta que perfila consultas en modo autom√°tico y le permite analizarlas en la interfaz web. <br><br><h2>  Liveprof: agregue resultados y mantenga el historial </h2><br>  ¬øC√≥mo obtener el historial de perfiles? <br><br>  Primero debe configurar el inicio autom√°tico del generador de perfiles y guardar los resultados.  El rendimiento no es constante y fluct√∫a de un lanzamiento a otro.  Para evitar la influencia de tales fluctuaciones, utilizamos los datos promediados de varias consultas.  Como resultado, obtenemos resultados agregados para cada consulta, por ejemplo, m√≠nimo, m√°ximo, promedio y percentil 95.  Esto ayuda a encontrar cosas dif√≠ciles que no se pueden llamar para cada solicitud. <br><br>  Nuestra herramienta tiene ventajas y algunas limitaciones. <br><br><h3>  Lo que puede hacer el agregador: </h3><br><ol><li>  Perfilado autom√°tico de cada en√©sima solicitud. <br></li><li>  Agregaci√≥n diaria de perfiles recopilados. <br></li><li>  La capacidad de ver gr√°ficos de cambios en cada par√°metro medido por el generador de perfiles.  Por ejemplo, wt, cpu, mu, pmu descrito anteriormente. <br></li><li>  Vea el cambio en el rendimiento de cualquier m√©todo para un determinado intervalo. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gr√°fico de llama</a> basado en los √∫ltimos datos agregados. <br></li><li>  Encuentra consultas que llaman a un m√©todo espec√≠fico <br></li></ol><br><h3>  Limitaciones: </h3><br><ol><li>  Como nuestra herramienta es agregada, no puede averiguar el rendimiento de una consulta (por ejemplo, la m√°s lenta): obtenemos los resultados promediados durante el √∫ltimo d√≠a.  Pero esto es suficiente para evaluar la din√°mica general del rendimiento.  Si alguna solicitud se desliz√≥ en la velocidad de ejecuci√≥n, el valor promedio, el percentil 95 y el tiempo m√°ximo de ejecuci√≥n cambiar√°n. <br></li><li>  No puede restaurar inequ√≠vocamente la pila de llamadas completa, ya que XHProf solo devuelve pares padre-hijo √∫nicos con la suma de los valores de los recursos gastados. <br></li><li>  Solicite un error de tiempo de ejecuci√≥n relacionado con la sobrecarga de XHProf.  La diferencia no es tan grande, pero debe tenerse en cuenta al medir el tiempo de ejecuci√≥n de la consulta. <br></li></ol><br><h3>  C√≥mo usar profiler </h3><br><ol><li>  Primero, el generador de perfiles debe estar conectado al sitio o script.  La forma m√°s conveniente de usar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramienta es iniciar autom√°ticamente el generador de perfiles</a> : <br><br><pre> <code class="plaintext hljs">php composer.phar require badoo/liveprof # Run a script to configure database LIVE_PROFILER_CONNECTION_URL=mysql://db_user:db_password@db_mysql:3306/Profiler?charset=utf8 php vendor/badoo/liveprof/bin/install.php</code> </pre><br>  Es compatible con versiones de PHP que comienzan con 5.4, y su uso est√° cargado de una sobrecarga m√≠nima, lo que le permite usarlo en un entorno de combate.  La herramienta detecta autom√°ticamente la extensi√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">perfil</a> utilizada: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">XHProf</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uprofiler</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tideways</a> .  Al inicio, debe especificar los par√°metros para conectarse a la base de datos y la configuraci√≥n de perfiles. <br><br>  Ejemplo de uso en c√≥digo con configuraci√≥n predeterminada: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'vendor/autoload.php'</span></span>; \Badoo\LiveProfiler\LiveProfiler::getInstance()-&gt;start(); <span class="hljs-comment"><span class="hljs-comment">// Code is here</span></span></code> </pre> <br>  Los resultados del perfil se guardan en la base de datos.  Una vez al d√≠a, se lleva a cabo un proceso de agregaci√≥n.  Para hacer esto, seleccione todos los registros para una solicitud espec√≠fica por d√≠a y calcule las funciones agregadas para cada uno de los par√°metros.  Las funciones de agregaci√≥n se pueden ampliar o redefinir. <br><br>  Ahora est√°n disponibles los siguientes: <br><br><ul><li>  al menos por d√≠a; </li><li>  m√°ximo por d√≠a; </li><li>  promedio diario </li><li>  Percentil 95 del d√≠a. </li></ul><br></li><li>  El <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cliente web del</a> agregador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se</a> utiliza para configurar la agregaci√≥n y ver los resultados.  La forma m√°s f√°cil de instalarlo en un contenedor acoplable: <br><br><pre> <code class="php hljs">git <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> https:<span class="hljs-comment"><span class="hljs-comment">//github.com/badoo/liveprof-ui.git cd liveprof-ui docker-compose up web</span></span></code> </pre> </li><li>  Antes del primer inicio, debe configurar los par√°metros de conexi√≥n de la base de datos, una lista de campos y funciones agregadas utilizadas en el archivo de configuraci√≥n src / config / services.yaml.  Luego ejecute el script de instalaci√≥n: <br><br><pre> <code class="php hljs">docker-compose exec web bash install.sh</code> </pre> </li><li>  Es necesario registrar autom√°ticamente las secuencias de comandos de agregaci√≥n y limpieza de datos antiguos en coronas: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># script aggregates all profiles for previous day, add it if you don't use a queue for aggregation jobs (parameter aggregator.use_jobs_in_aggregation=false) 0 2 * * * docker-compose -f %PATH_TO_PROJECT%/docker-compose.yml run --rm --entrypoint '/usr/local/bin/php /app/bin/cli.php cron:aggregate-all-profiles' web # script removes old aggregated data, by default &gt; 200 days 0 1 * * * docker-compose -f %PATH_TO_PROJECT%/docker-compose.yml run --rm --entrypoint '/usr/local/bin/php /app/bin/cli.php cron:remove-old-profiles' web 200</span></span></code> </pre> <br></li><li>  Para completar con datos de prueba, puede ejecutar el script: <br><br><pre> <code class="php hljs">docker-compose exec web php /app/bin/cli.php example:a-week-degradation</code> </pre> </li></ol><br><h2>  Descripci√≥n de la interfaz </h2><br>  La interfaz web est√° disponible en: 127.0.0.1:8000. <br><br>  Por defecto, se abre una p√°gina con una lista de consultas agregadas.  Facilita la b√∫squeda de una consulta de inter√©s, ordena todas las consultas por cualquiera de los par√°metros y tambi√©n vuelve a agregar una consulta espec√≠fica para ver los √∫ltimos resultados: <br><br><img src="https://habrastorage.org/webt/qj/-d/6b/qj-d6bj1095huwhvqmzdwim1g6k.png"><br><br>  Una p√°gina con una lista de m√©todos y gr√°ficos de cambios de rendimiento es la m√°s utilizada cuando se trabaja con la herramienta.  Le permite pasar por la pila de llamadas, ver el consumo de cada par√°metro, as√≠ como gr√°ficos de cambios de rendimiento para un determinado intervalo: <br><br><img src="https://habrastorage.org/webt/-6/ag/u4/-6agu45zuu1qs77tckpkngabjwq.png"><br><br>  <i>Una p√°gina con una lista completa de m√©todos llamados le permite encontrar r√°pidamente el m√©todo de inter√©s y ver los gr√°ficos yendo a la p√°gina de gr√°ficos:</i> <br><br><img src="https://habrastorage.org/webt/nj/g-/f_/njg-f_48jsuo8mcmlxuq1ukxj_4.png"><br>  <i>La p√°gina con el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gr√°fico de llama de la</a> √∫ltima consulta agregada le permite identificar visualmente las partes m√°s pesadas.</i> <br><br>  Usar XHProf impone algunas limitaciones en la precisi√≥n del resultado.  Esto se debe al hecho de que el generador de perfiles no devuelve un √°rbol de llamadas completo, sino solo los pares padre-hijo.  Adem√°s, si se llam√≥ a un par de m√©todos desde diferentes lugares de la aplicaci√≥n, como resultado obtenemos la cantidad de tiempo invertido.  Para un gr√°fico de llama, debe tener un √°rbol de llamadas completo.  Al restaurar dicho √°rbol, los valores de los par√°metros se normalizan teniendo en cuenta el tiempo dedicado por los padres. <br><br><img src="https://habrastorage.org/webt/vp/lp/xr/vplpxry-gjd-lq774gg3ji9cooo.png"><br>  <i>Una p√°gina con una lista de m√©todos que se han vuelto m√°s lentos durante el intervalo seleccionado.</i> <br><br>  Adem√°s, para cada m√©todo, puede ver cu√°les de las llamadas secundarias afectaron m√°s el rendimiento.  Por ejemplo, en la captura de pantalla a continuaci√≥n, puede ver que el m√©todo <code>ServiceApi::getAvailableServices()</code> comenz√≥ a ejecutarse 116 ms m√°s lento.  La raz√≥n de esto fue la adici√≥n de una llamada a <code>ServiceApi::getGifts()</code> (cambio de 56 ms) y un aumento en el n√∫mero de llamadas al m√©todo <code>ServiceApi::getConfigForList()</code> de 1 a 5 (otros 50 ms): <br><br> <a href=""><img src="https://habrastorage.org/webt/rv/mc/dd/rvmcddru-ay4x9cb45xsvey_tka.png"></a> <br><br>  Si no se sabe de antemano qu√© consulta el rendimiento ha cambiado m√°s notablemente, entonces una p√°gina con una lista de m√©todos que se han vuelto m√°s lentos sin referencia a una consulta espec√≠fica ayudar√°: <br><br><img src="https://habrastorage.org/webt/-6/0b/3s/-60b3svwq_rg9z7wbzmzmpriapc.png"><br>  <i>Una p√°gina que busca consultas que invocan un m√©todo en particular.</i> <br><br>  Le permite comparar el tiempo de ejecuci√≥n en diferentes solicitudes.  Tambi√©n es √∫til para encontrar c√≥digo no utilizado: <br><br><img src="https://habrastorage.org/webt/hq/du/lv/hqdulvav1asbj9nczgowuk1mvak.png"><br><br><h3>  Funciones de personalizaci√≥n </h3><br>  La herramienta tiene amplias oportunidades de personalizaci√≥n: <br><br><ul><li>  puede agregar sus propias funciones agregadas que calculan un cierto valor en funci√≥n de la matriz de valores de par√°metros aprobada; <br></li><li>  Puede cambiar la base de datos para almacenar perfiles y resultados agregados (SQLite, MySQL y PostgreSQL ahora son compatibles, pero puede usar otros de la lista disponible para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Doctrine DBAL</a> ); <br></li><li>  Puede anular el administrador de conexi√≥n de la base de datos e implementar sus m√©todos para obtener datos; <br></li><li>  Puede usar la interfaz web tanto como un proyecto independiente como dentro de cualquier marco (por ejemplo, un panel de control del sitio).  Un ejemplo: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profileListAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{      &lt;i&gt;<span class="hljs-comment"><span class="hljs-comment">//Some custom logic before&lt;/i&gt;   $this-&gt;checkPermissions();   $App = new \Badoo\LiveProfilerUI\LiveProfilerUI();   $Page = $App-&gt;getPage('profile_method_list_page');   return $Page-&gt;setData($data)-&gt;render(); }</span></span></code> </pre> </li></ul><br><h2>  Conclusi√≥n </h2><br>  Espero que nuestra herramienta sea √∫til para otros desarrolladores.  Permitir√° verificar el cambio de rendimiento de cualquier parte del c√≥digo sin el uso de temporizadores adicionales.  Tambi√©n facilitar√° el proceso de optimizaci√≥n, ya que ahora puede ver lo que afect√≥ la degradaci√≥n del rendimiento de la aplicaci√≥n con el tiempo. <br><br>  Est√° disponible en GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/badoo/liveprof</a> , la interfaz web es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/badoo/liveprof-ui</a> . <br><br>  La herramienta est√° en desarrollo activo y puede contener algunos errores.  Con suerte, con la participaci√≥n de la comunidad, mejorar√° a√∫n m√°s.  Los planes incluyen agregar soporte para otros perfiladores adem√°s de XHProf, as√≠ como expandir la lista de bases de datos compatibles. <br><br>  Env√≠enos sus comentarios y preguntas de uso a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Telegram</a> , errores y solicitudes de extracci√≥n, directamente a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> .  Agradecemos comentarios y sugerencias! <br><br>  Un agradecimiento especial a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gregory</a> por la idea y la primera implementaci√≥n. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es436364/">https://habr.com/ru/post/es436364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es436352/index.html">Resumen de noticias de PostgreSQL. Edici√≥n No14</a></li>
<li><a href="../es436354/index.html">El ej√©rcito de los Estados Unidos descuida los problemas de ciberseguridad</a></li>
<li><a href="../es436356/index.html">[Interesante desde detr√°s de la colina] ¬øC√≥mo detenemos la dependencia tecnol√≥gica?</a></li>
<li><a href="../es436358/index.html">¬øPor qu√© los desarrolladores senior ense√±an a los estudiantes?</a></li>
<li><a href="../es436360/index.html">Gotta Go Fast: Building for Speed ‚Äã‚Äãen iOS. Parte 1</a></li>
<li><a href="../es436370/index.html">Infraestructura de clave p√∫blica Cadena de certificados ra√≠z X509 v.3</a></li>
<li><a href="../es436372/index.html">Plugin isom√©trico para Unity3D</a></li>
<li><a href="../es436374/index.html">Tendencias de dise√±o de UI y UX 2019</a></li>
<li><a href="../es436376/index.html">Descripci√≥n general del robot todo terreno EZ-Robot Roli Rover</a></li>
<li><a href="../es436378/index.html">bobaos.pub - KNX TP / UART, Raspberry Pi y Redis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>