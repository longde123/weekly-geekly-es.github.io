<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏂🏽 💄 ♎️ NVidia GPU-Stresstest bei Live-Stream-Transcodierung 👨🏼‍🍳 👵🏾 🚶🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im Folgenden finden Sie eine detaillierte Geschichte darüber, wie wir die Karte von NVidia mit den Aufgaben des Transcodierens von Videos für das Stre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NVidia GPU-Stresstest bei Live-Stream-Transcodierung</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401539/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Folgenden finden Sie eine detaillierte Geschichte darüber, wie wir die Karte von NVidia mit den Aufgaben des Transcodierens von Videos für das Streaming geladen haben. </font><font style="vertical-align: inherit;">Lassen Sie uns zeigen, dass wir versucht haben, was passiert ist und wie Grafikkarten am besten für das Online-Streaming verwendet werden können.</font></font></i><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/7ef/cc6/50b/7efcc650b901459bbb5addc4fe8d6bd3.png"></div><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seit mehreren Jahren entwickelt unser Team Produkte für die Verarbeitung und Verbreitung von Medieninhalten online. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Artikel wurde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kürzlich </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">beschrieben,</font></a><font style="vertical-align: inherit;"> warum Content-Besitzer in unserem YouTube-Zeitalter möglicherweise solche Lösungen benötigen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eines unserer Produkte ist der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nimble Streamer-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Medienserver, eine </font><font style="vertical-align: inherit;">Serversoftware, die Live-Streams und -Dateien zur Eingabe überträgt und sie einer großen Anzahl von Zuschauern zugänglich macht, während gleichzeitig Inhalte monetarisiert werden können. Dies ist eine native Anwendung, die in C ++ geschrieben und auf alle gängigen Betriebssysteme (Linux, Windows, MacOS) und Plattformen (x64, ARM) portiert wurde. Von Anfang an waren ein geringer Ressourcenverbrauch und eine hohe Produktivität die Hauptanforderungen, und wir erzielen hier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gute Ergebnisse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Letztes Jahr haben wir den Nimble Streamer Add-On - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Live Stream Transcoder - veröffentlicht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mit dieser Anwendung können Sie den Eingabestream von Video und / oder Audio in verschiedenen Formaten aufnehmen und verschiedene Konvertierungen mit ihnen in Echtzeit durchführen. Die Funktionalität umfasst Decodierung (sowohl Software als auch Hardware), Video- und Audiokonvertierung mithilfe von Filtern (Größenänderung, Overlay usw.) und Codierung (Codierung) - sowohl Software als auch Hardware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Transcoder wird über den WMSPanel-Webdienst gesteuert. Transcodierungsskripte werden über die Drag-and-Drop-Oberfläche erstellt, sodass Sie den Prozess visuell sehen können. Verschiedene Szenarien können zusammen ausgeführt werden. Bei diesem Ansatz ist es praktisch, Testkombinationen auszuführen und den Server in beliebigen Variationen zu laden. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesen Videos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie können Beispiele für die Funktionsweise der Benutzeroberfläche sehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Dekodierung jedes Streams erfolgt nur einmal vor allen weiteren Konvertierungen ... Dies ermöglicht es Ihnen, Ressourcen bei einem teuren Dekodierungsvorgang zu sparen. Dies wird in den Tests deutlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einer der Konvertierungsmechanismen, die in unserem Transcoder verwendet werden können, ist die Hardware-Decodierung und Videocodierung mit der GPU von NVidia. Mit Grafikkarten der neuesten Generationen können Sie einige der typischen Aufgaben übernehmen, wodurch die CPU entlastet wird. Unser Transcoder kann mit dieser Hardware arbeiten, die von unseren Kunden aktiv genutzt wird.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/460/a36/96e/460a3696ed2e4f1e8d7491ecc4e7c2ca.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Rahmen der Kommunikation mit Vertretern des russischen Büros von NVidia wurden wir gebeten, gemeinsame Stresstests für unseren Transcoder und die NVidia-GPU durchzuführen, um zu verstehen, wie sich die wirtschaftlichen Auswirkungen eines solchen Tandems auf die ausschließliche Software-Transcodierung ohne Hardwarebeschleunigung auswirken. </font><font style="vertical-align: inherit;">Außerdem wollte ich verstehen, wie man die GPU optimal nutzt und wenn möglich gute Rezepte gibt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für den Zyklus unserer Experimente mussten wir schnell das geeignete Eisen und den Zugang dazu finden. </font><font style="vertical-align: inherit;">Wir wollten uns ein paar Wochen treffen. </font><font style="vertical-align: inherit;">Es bleibt zu finden, wo die Ausrüstung zu bekommen ist. </font><font style="vertical-align: inherit;">Die beste Option wäre, sie in der Cloud zu finden und Fernzugriff zu erhalten. </font><font style="vertical-align: inherit;">Nach der Suche nach den Optionen stellte sich heraus, dass AWS noch keine VM mit einer GPU der Maxwell-Generation hat. In der Azure-Cloud ist nur geplant, diese bald bereitzustellen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Bügeln Sie NVidia in der Softlayer-Cloud und richten Sie den Nimble Streamer ein</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Unterstützung von NVidia verschaffte uns IBM Zugriff auf seine Cloud, die IBM Bluemix Cloud Platform (ehemals </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Softlayer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Dies ist ein großes Netzwerk moderner Rechenzentren (zum Zeitpunkt der Veröffentlichung etwa 50) auf der ganzen Welt, die über ein gemeinsames privates Netzwerk verbunden sind und eine große Auswahl an Cloud-Infrastrukturdiensten bieten. </font><font style="vertical-align: inherit;">Alle Rechenzentren sind vereinheitlicht und ermöglichen es Ihnen, mehrere Stunden lang einen bis Hunderte von virtuellen oder physischen Servern der erforderlichen Konfiguration sowie Balancer, Speichersysteme und Firewalls zu mieten - im Allgemeinen alles, was zum Aufbau einer zuverlässigen IT-Infrastruktur für den bereitgestellten IT-Service erforderlich ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die russische Repräsentanz von IBM gewährte uns vollen Zugriff auf das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Self-Service-Portal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zur Verwaltung von Cloud-Diensten und zur gewünschten Serverkonfiguration, wo wir mit verschiedenen Eingabestreams und den Einstellungen unseres Transcoders arbeiten konnten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eisen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst erhielten wir einen physischen Server (Bare-Metal) mit 128 GB RAM und 2xGPU NVidia Tesla M60 sowie das vorinstallierte Betriebssystem Ubuntu 14.04. </font><font style="vertical-align: inherit;">Alle Serverparameter, Kennwörter, Firmware-Versionen, deren Umschaltung, dedizierte IP-Adresse und der Status der Hardwarekomponenten wurden direkt in Ihrem persönlichen Konto angezeigt, sodass Sie die erforderlichen Manipulationen mit der gemieteten Hardware vornehmen konnten, wodurch die Notwendigkeit einer Interaktion mit dem IBM Support minimiert wurde. </font><font style="vertical-align: inherit;">Während des Testlaufs stellte sich heraus, dass wir diese Konfiguration aufgrund einer Reihe von Einschränkungen bei der Generierung von Kontexten nicht optimal laden konnten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir wollten die Konfiguration reduzieren. Da wir die Cloud-Plattform verwendet haben, war es über das Self-Service-Portal erforderlich, Konfigurationsänderungen anzufordern. Nach der Genehmigung dauerte dieser Vorgang ca. 2 Stunden bis zum genehmigten Servicefenster. Während dieser Zeit entfernte das technische Personal im Amsterdamer Rechenzentrum zusätzliche Komponenten (RAM-Steckplätze und 1xGPU) von dem Server, der uns zuvor zur Verfügung gestellt wurde, und nahm ihn wieder in Betrieb. Es sollte beachtet werden, dass diese Option für Entwickler sehr praktisch ist, da weder die Hardwareeinstellungen bearbeitet, repariert noch Zeit für die Installation des Betriebssystems aufgewendet werden müssen. Ich möchte Sie daran erinnern, dass in diesem Fall der Hypervisor nicht verwendet wird, da wir das Maximum aus den Hardwareressourcen herausholen müssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basierend auf den Ergebnissen unserer Forschung haben wir uns für die folgende Serverkonfiguration entschieden:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dual Intel Xeon E5-2690 v3 (2,60 GHz) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
24 Kerne </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
64 GB RAM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 TB SATA</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben 2 Prozessoren mit jeweils 12 Kernen und dank Hyper-Threading erhalten wir doppelt so viel, d. H. </font><font style="vertical-align: inherit;">praktisch 48 Kerne. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Szenarien mit einem Grafikbeschleuniger wurde eine Karte verwendet, die auf dem GM204-Chip - Tesla M60 - basiert:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVIDIA Tesla M60 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1xGPU: 2 x Maxwell GM204 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Speicher: 16 GB GDDR5 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Taktrate: 2,5 GHz </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NVIDIA CUDA-Kerne: 2 x 2048 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Speicherbandbreite: 2 x 160 GB / s</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich mache Sie darauf aufmerksam, dass auf der reduzierten Hardware keine Affinität, Chip-Tuning, Übertaktung oder andere Magie angewendet wurde - nur nicht übertaktete CPUs und GPUs, und für die GPU wurde nur der offizielle Treiber verwendet, der von der NVidia-Website stammt. </font><font style="vertical-align: inherit;">Wenn jemand eine ähnliche Erfahrung hat - teilen Sie in den Kommentaren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also haben wir Zugang bekommen. </font><font style="vertical-align: inherit;">Eine schnelle Kenntnis der Weboberfläche des Control Panels (dort ist alles einfach und klar), dann Zugriff auf den Server über SSH - und hier befinden wir uns in der üblichen Ubuntu-Befehlszeile, setzen Nimble Streamer, registrieren eine neue Transcoder-Lizenz und führen ein wenig Konfigurations-Setup durch.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flinker Streamer-Transcoder</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nimble Streamer wurde so konfiguriert, dass der GPU-Kontextcache vorab erstellt wird. </font><font style="vertical-align: inherit;">Dies liegt an der Tatsache, dass die GPU die maximale Anzahl der erstellten Dekodierungs- und Codierungskontexte begrenzt. Darüber hinaus kann das Erstellen von Kontexten im laufenden Betrieb zu lange dauern. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weitere Details zum Problem der Erstellung von Kontexten finden Sie im entsprechenden Abschnitt unten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flinke Einstellungen am Beispiel der ersten Testreihe:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nvenc_context_cache_enable = true </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nvenc_context_create_lock = true </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nvenc_context_cache_init = 0: 30: 15,1: 30: 15 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nvenc_context_reuse_enable = true</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weitere Details zu diesen Einstellungen finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in unserem Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor Beginn jeder Testreihe wurde der Cache separat konfiguriert, wobei die Besonderheiten jeder Aufgabe berücksichtigt wurden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie Transcodierungsskripte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weitere Arbeiten wurden in unserem WMSPanel-Dienst durchgeführt, in dem die Transcoder-Skripte konfiguriert sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bereits erwähnt, geht die Arbeit über die Weboberfläche, alles ist äußerst klar und bequem. </font><font style="vertical-align: inherit;">Wir haben eine Reihe von Szenarien erstellt, in denen verschiedene Transcodierungsoptionen (CPU / GPU), verschiedene Auflösungsoptionen und verschiedene Codierungsparameter (CPU / GPU, Profil, Bitrate usw.) kombiniert werden. Sie </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
können gleichzeitig Skriptsätze ausführen, wodurch verschiedene Kombinationen in den Umlauf gebracht werden können Tests, erhöhen Sie die Last in einer anderen Reihenfolge und ändern Sie sie je nach Situation. </font><font style="vertical-align: inherit;">Wählen Sie einfach die erforderlichen Szenarien aus und stoppen oder setzen Sie sie fort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist eine Reihe von Szenarien:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/cd6/197/b77/cd6197b77e6b4c0697f43f8d1cfaaf07.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein Beispiel für eines der Szenarien:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/e47/1ff/924/e471ff9244f240edb2c092f42d5cf721.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der GPU-Decoder sieht folgendermaßen aus:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/382/0f8/2fd/3820f82fd74e4e0ea106534962e1ba28.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir wenden den Bildgrößenfilter an:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/9d3/bd0/eab/9d3bd0eab2ac47d4b3183aca91db0d6f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und hier ist der Encoder für die GPU-Variante:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/212/d34/e2e/212d34e2e3cf425a9f94d03194f7c62d.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen ist der Betrieb der Transcoder-Schnittstelle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in diesen Videos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">sehen</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Transcodieren von Streams FullHD 1080p</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst haben wir das Szenario mit den höchsten Belastungen getestet, um die Grenzen der Eisenfähigkeiten herauszufinden. Derzeit ist FullHD 1080p die „schwerste“ der in der Praxis verwendeten Auflösungen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die ursprünglichen Live-Streams zu generieren, wurde eine Datei in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullHD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1920 * 1080) in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hochkarätigem H.264 aufgenommen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Der Inhalt selbst ist eine Videotour durch die Stadt, d.h. Dies ist ein Video mit einer durchschnittlichen Bildänderungsrate. Es gibt keine statischen einfarbigen Rahmen, die die Arbeit des Transcoders erleichtern könnten, aber es gibt keinen zu schnellen Wechsel von Typen und Farben. Mit einem Wort - eine ziemlich typische Last. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dem Nimble Streamer-Eingang </font><font style="vertical-align: inherit;">wurden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36 identische Streams</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zugeführt </font><font style="vertical-align: inherit;">, die dann in verschiedenen Szenarien im Transcoder verwendet wurden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Transcodierungsszenario wird typisch verwendet - der eingehende Stream ist ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1080p-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> High- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profile-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><b><font style="vertical-align: inherit;">720p-, 480p-</font></b><font style="vertical-align: inherit;"> und </font><b><font style="vertical-align: inherit;">360p-Hauptprofil,</font></b><font style="vertical-align: inherit;"> und dann werden die </font><b><font style="vertical-align: inherit;">Basisprofil-</font></b><font style="vertical-align: inherit;"> Streams </font><font style="vertical-align: inherit;">daraus erstellt </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 240p, 160p</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Insgesamt gibt es 1 Stream am Eingang und 5 am Ausgang. Normalerweise wird auch ein Durchgang (Übertragung ohne Änderungen) des ursprünglichen Streams durchgeführt, damit der Betrachter beim Anzeigen selbst 1080p auswählen kann. </font><font style="vertical-align: inherit;">Wir haben es nicht in das Skript eingefügt, weil </font><font style="vertical-align: inherit;">Es wird keine Transcodierung verwendet - es erfolgt eine direkte Datenübertragung von der Eingabe zur Ausgabe. </font><font style="vertical-align: inherit;">Dieses Szenario ist in Nimble optimiert und erhöht unter realen Bedingungen den Speicherverbrauch relativ geringfügig. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Audio in den generierten Streams - nein. </font><font style="vertical-align: inherit;">Das Hinzufügen von Audio zum Skript führt nicht zu einer erheblichen CPU-Auslastung. Aus Gründen der Reinheit des Experiments haben wir den Sound ausgeschlossen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU-Test, keine GPU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu Beginn haben wir Transcodierungsskripte ohne Verwendung einer GPU gestartet und in den Skripten den Softwaredecoder und -codierer angegeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen konnten nur 16 Eingabeflüsse verarbeitet werden, wobei 80 Flüsse aller Exit-Berechtigungen ausgegeben wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPU-Auslastung - 4600%, d.h. </font><font style="vertical-align: inherit;">46 Kerne waren beteiligt. </font><font style="vertical-align: inherit;">RAM-Verbrauch - ca. 15 GB.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU + GPU-Test</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Kontext-Cache beim Start ist als 0: 30: 15.1: 30: 15 konfiguriert - d.h. 30 Kontexte zum Codieren, 15 zum Decodieren, jede GPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich möchte Sie daran erinnern, dass wir auf der GPU zwei Kerne haben, mit denen wir Aufgaben parallelisieren können - das ist nützlich für uns. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die maximale Last wurde mit der folgenden Strömungskonfiguration erhalten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Eingangsdecoder GPU0 und GPU1 - 15 Streams. So erhalten wir 30 dekodierte Streams, die zur weiteren Verwendung bereit sind. Jeder Stream wird nur einmal dekodiert, unabhängig davon, wie viele Szenarien er in Zukunft verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Den Codierern GPU0 und GPU1 wurden jeweils 15 Ströme zugeführt, um 720p zu erhalten, d.h. Es stellte sich heraus, dass 30 Streams mit 720p an einem Ausgang vorhanden waren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem lieferten die GPU0- und GPU1-Encoder jeweils 15 Streams für 480p - und 30 Streams von 480p wurden ebenfalls ausgegeben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da die Encoder-Kontexte erschöpft waren, wurde die Codierung der verbleibenden Berechtigungen für die CPU festgelegt. </font><font style="vertical-align: inherit;">Es stellte sich Folgendes heraus:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30 Streams 360p</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30 Streams 240p</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30 Streams 160p</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellte sich heraus, dass die Last 2600% CPU, 75% Decoder, 32% Encoder war. </font><font style="vertical-align: inherit;">Als nächstes wurde die CPU mit 6 Streams zum Decodieren geladen, wobei jeweils 5 ähnliche Auflösungen für insgesamt 30 Threads pro Ausgabe konfiguriert wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insgesamt wurden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36 Streams am Eingang</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> empfangen </font><b><font style="vertical-align: inherit;">, 180 wurden am Ausgang ausgegeben</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Die endgültige Last wird wie folgt festgelegt: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4400% CPU, 75% Kartendecoder, 32% Kartencodierer, 30 GB RAM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einige Details</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben uns entschlossen, die Option zu prüfen, mit der wir die schwierigsten Aufgaben auf der GPU verarbeiten - Dekodierung 1080 und Kodierung 720 und 480 - und den Rest über die CPU verarbeiten zu lassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst haben wir das Limit des Decoders überprüft. Bei 22 Threads war die Dekodierung vom Problem mit den Kontexten betroffen, sie konnten einfach nicht erstellt werden. Auf 21 verringert - Kontexte wurden erstellt, aber die Last wurde 100% und Artefakte wurden im Stream beobachtet. Wir haben bei 20 Streams angehalten - wir dekodieren 20 Streams, codieren bei 160p - alles funktioniert gut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus stellte sich empirisch heraus, dass diese Karte mit 16 GB RAM an Bord sicher mit 47 Kontexten arbeiten kann - und es gibt keinen Unterschied, dies sind die Kontexte eines Codierers oder Decodierers. </font><font style="vertical-align: inherit;">Ich wiederhole - hier geht es speziell um diese Tesla M60 GPU, auf anderen Karten kann diese Nummer anders sein. </font><font style="vertical-align: inherit;">Wir glauben, dass wenn die Karte 24 GB RAM hätte, die Anzahl der Kontexte unterschiedlich sein könnte, aber dies muss getestet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund haben wir die Cache-Erstellungsformel „15 Kontexte des Decoders und 30 Kontexte des Encoders“ gewählt, die der Eingabe 30 Streams gibt und für die jeweils 2 Berechtigungen erstellt werden können. </font><font style="vertical-align: inherit;">So wurden die oberen Auflösungen - 720 und 480 - auf der GPU gestartet und der Rest - 360, 240 und 160 - an die CPU gesendet. </font><font style="vertical-align: inherit;">Und da die CPU danach noch frei war, haben wir die freien Kerne mit neuen Threads „fertiggestellt“ und 4 Kerne für nützliche Aufgaben übrig gelassen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Transcodieren von Streams HD 720p</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typisches Lastszenario Der größte Teil des Inhalts wird jetzt in HD erstellt. Sogar die jüngste SuperBowl LI - die bestbewertete Show auf dem US-Markt - wurde </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in HD ausgestrahlt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sodass FullHD für die Zukunft übrig bleibt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Quelldatenströme zu generieren, wurde eine Datei in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1280 * 720) in einem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hohen Profil aufgenommen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Der Inhalt ist die Lieblingsserie unseres Ingenieurs "The Good Wife", d. H. Dies ist ein Video mit einer durchschnittlichen Bildänderungsrate. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Eingang zum Nimble Streamer wurden 70 identische Streams eingespeist, die dann in verschiedenen Szenarien im Transcoder verwendet wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das folgende Transcodierungsszenario wird verwendet: Der eingehende Stream ist ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">720p-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> High- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profile-, 480p-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font><b><font style="vertical-align: inherit;">360p-Hauptprofil,</font></b><font style="vertical-align: inherit;"> und dann werden Streams </font><font style="vertical-align: inherit;">daraus erstellt</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">240p, 160p Basislinienprofil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Total, bei Eingang 1, bei Ausgang 4. Der Durchgang des ursprünglichen Streams wurde wie im vorherigen Szenario nicht durchgeführt. </font><font style="vertical-align: inherit;">Audio in den generierten Streams ist auch nicht.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU-Test, keine GPU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie im vorherigen Abschnitt haben wir versucht, Streams nur auf der CPU zu transkodieren. </font><font style="vertical-align: inherit;">Infolgedessen konnten nur 22 Eingabeströme mit der Ausgabe von 88 Flüssen aller Exit-Berechtigungen verarbeitet werden. </font><font style="vertical-align: inherit;">CPU-Auslastung - 4700%, d.h. </font><font style="vertical-align: inherit;">47 Kerne waren beteiligt. </font><font style="vertical-align: inherit;">RAM-Verbrauch - ca. 20 GB.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU + GPU-Test</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Kontext-Cache beim Start ist als 0: 23: 23.1: 23: 23 konfiguriert - d.h. 23 Kontexte zum Codieren, 23 zum Decodieren für jede GPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der GPU wurden 46 720p-Streams dekodiert. Dort wurden auf der GPU 46 Streams von 480p codiert. Als nächstes wurden 360p-, 240p- und 160p-Codierungen auf der CPU durchgeführt - jeweils 46 Streams. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Feste Last von 2100% CPU, 61% des Decoders, 16% des Encoders. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusätzlich wurde die Codierung und Decodierung von 24 Threads zur CPU für jeden 1 Thread - 4 Ausgänge wie für die GPU gestartet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insgesamt wurden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">70 Streams eingegeben, 280 Streams wurden ausgegeben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Last: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4600%, 61% des Decoders, 16% des Encoders, 30 GB RAM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie beim vorherigen Test würde eine größere RAM-GPU möglicherweise mehr Kontexte liefern und wir könnten mehr Threads verarbeiten. </font><font style="vertical-align: inherit;">Dies ist aber nur theoretisch, es ist notwendig zu überprüfen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Das Problem beim Erstellen von Kontexten in der NVidia-GPU</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein paar Worte zu dem Problem, das es uns nicht ermöglichte, mehr Threads auf der GPU zu verarbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ende letzten Jahres haben wir mit dem Team von NVidia Tests mit mehreren Karten durchgeführt. Bei der Arbeit mit mehreren GPUs stellte sich heraus, dass das Erstellen von Kontexten den Server erheblich verlangsamt. Das Erstellen jedes neuen Kontexts nahm immer mehr Zeit in Anspruch. Wenn der erste Kontext in der Größenordnung von 300 ms erstellt wurde, fügte jeder nachfolgende 200-300 ms hinzu und bereits in den dritten zehn Kontexten dauerte das Erstellen eines neuen Kontexts jeweils 3-4 Sekunden. Wenn ein Benutzer ein Transcodierungsskript erstellt, wird davon ausgegangen, dass er sofort und ohne Verzögerungen mit der Arbeit beginnt. Dieser neue Umstand hat alle Vorteile der Nimbl-Geschwindigkeit zunichte gemacht und Verzögerungen beim Erstellen von Kontexten verursacht, die zu Verzögerungen beim Starten der Codierung geführt haben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst fiel der Verdacht auf Nimble, aber dann haben wir Tests mit ffmpeg durchgeführt, die NVidia selbst den Kunden zur Verfügung stellt, und das Ergebnis war genau das gleiche - die GPU verbringt immer mehr Zeit damit, jeden neuen Kontext zu erstellen. Unter Bedingungen, in denen der Server bereits transkodiert und Sie neue Threads für die Verarbeitung starten müssen, wirkt sich dies auf die Gesamtleistung aus und macht den Server einfach unbrauchbar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem wurde vom NVidia-Team ausführlich beschrieben, es wurde jedoch bisher keine Vollzeitlösung bereitgestellt. Aus diesem Grund haben wir bisher einen Kontext-Caching-Mechanismus auf unserem Server implementiert, bei dem beim Serverstart vorläufig Kontexte erstellt werden. Dies löste das Problem aus Sicht der Arbeit des Endbenutzers, aber der Start des Nimbl kann einige Zeit dauern. Konfigurieren Sie Nimbl so, dass es effektiv mit Kontexten arbeitet</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf unserem Blog beschrieben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus sind Kontexte nicht einfach zu erstellen. Bei einer großen Anzahl von Kontexten, in denen ein Transcodierungsskript enthalten ist, gibt die NVENC-API folgende Fehler aus: "Der API-Aufruf ist fehlgeschlagen, weil nicht genügend Speicher für die Ausführung des angeforderten Vorgangs zugewiesen werden konnte." </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Empirisch stellte sich heraus, dass eine GPU mit 47 Kontexten sicher starten und arbeiten kann - und es gibt keinen Unterschied, dies sind die Kontexte eines Codierers oder Decodierers. Es wurde angenommen, dass dies auf die Speichermenge auf der GPU zurückzuführen ist. Jetzt gibt es 16 GB. Wenn Sie eine Karte mit 24 GB einsetzen, können wahrscheinlich mehr Kontexte erstellt werden. Dies ist jedoch nur eine Theorie, die überprüft werden muss, wie bereits erwähnt. Die erhaltenen Daten gelten für ein bestimmtes GPU-Modell, andere Karten müssen separat getestet werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist die Beschränkung der Anzahl der Kontexte, die das Haupthindernis beim Arbeiten mit großen Lasten darstellt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Schlussfolgerungen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ziel des Tests war es daher, die Wirksamkeit der GPU für den angegebenen Aufgabenbereich zu untersuchen und Rezepte für die ordnungsgemäße Verwendung zu entwickeln. </font><font style="vertical-align: inherit;">Was ist das Ergebnis?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wirtschaftliche Wirkung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oben haben wir gesehen, wie unterschiedlich die Anzahl der Threads ist, die auf der CPU und auf dem Tandem CPU + GPU verarbeitet werden können. </font><font style="vertical-align: inherit;">Mal sehen, was das für Geld bedeutet. </font><font style="vertical-align: inherit;">Als Basis nehmen wir alle die gleichen Softlayer und deren Ausrüstungsmietpreise.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Konfiguration ohne GPU kostet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">819 US-Dollar pro Monat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier können Sie ein</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Auto </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">abholen</font></a><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Konfiguration mit der GPU kostet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1729 USD pro Monat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für das Rechenzentrum in Amsterdam. Die Preise finden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Bei Verwendung einer GPU erhöht sich der Servermietpreis geringfügig, da der größere 2U-Fallformfaktor verwendet wird. </font><font style="vertical-align: inherit;">Der wirtschaftliche Effekt wird beim Kauf von Geräten wahrscheinlich höher sein (dies erfordert jedoch eine gründliche Analyse der Gesamtbetriebskosten unter Berücksichtigung der ständigen Aktualisierung der NVidia-GPU-Linie).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun sehen wir uns die Testergebnisse an: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für FullHD 1080p</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU ohne GPU: 16 Threads pro Eingang + 80 Threads pro Ausgang</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU + GPU: 36 Threads pro Eingang + 180 pro Ausgang</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPU-Vorteil: 2,25x. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorteile</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der Verwendung der GPU: 819 USD * 2,25 USD - 1729 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">113 USD pro Monat</font></b><font style="vertical-align: inherit;"> bei Anmietung eines Servers mit einer GPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für HD 720p</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU ohne GPU: 22 Threads pro Eingang + 88 Threads pro Ausgang</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU + GPU: 70 Threads pro Eingang + 280 pro Ausgang</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPU-Vorteil: 3,18x. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profitieren Sie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von der Verwendung der GPU: 819 USD * 3,18 USD - 1729 USD = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">875 USD pro Monat,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wenn Sie einen Server mit einer GPU mieten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der Mietoption sind die Einsparungen also spürbar. </font><font style="vertical-align: inherit;">Dabei werden Rabatte nicht berücksichtigt. Im russischen IBM-Büro versprechen sie Rabatte für die Anmietung von Ressourcen in der Cloud im Vergleich zu den hier angegebenen Preisen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sind beim Kauf nicht auf die Optionen eingegangen, weil </font><font style="vertical-align: inherit;">Hier hängt die Gesamtbetriebskosten stark von der Wahl des Lieferanten, den Servicekosten im Rechenzentrum und anderen Faktoren ab, die denjenigen bekannt sind, die mit Bare Metal arbeiten. </font><font style="vertical-align: inherit;">Vorläufige Zahlen sprechen jedoch auch für eine GPU-basierte Lösung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vergessen Sie auch nicht den Datenverkehr und die Kanalbreite - diese sind in den oben angegebenen Tarifen in einem bestimmten Betrag enthalten. Sie müssen jedoch Optionen für Ihre Aufgaben basierend auf der Anzahl der Threads, der erwarteten Anzahl der Benutzer usw. auswählen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skalieren</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Option mit einer Grafikkarte pro Server erscheint uns kostengünstiger als die Option mit zwei oder mehr Karten. Wie wir sehen können, hat der GPU-Decoder immer mehr als der Encoder geladen, aber selbst er blieb aufgrund von Problemen bei der Verwendung von Kontexten unterlastet. Wenn Sie eine zweite Karte hinzufügen, wird der Decoder noch weniger verwendet, die Encoder können nicht mit voller Kapazität geladen werden, und die gesamte Arbeit an der Codierung muss noch auf die CPU verlagert werden, was für das Geld nicht gerechtfertigt ist. Wir haben die Option dank der Unterstützung von Softlayer auch mit zwei GPUs getestet, aber aufgrund des schwachen wirtschaftlichen Effekts geben wir im Artikel keine Details an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Last zu skalieren, ist es daher vorzuziehen, neue Server mit einer Grafikkarte hinzuzufügen, als Karten zu vorhandenen Computern hinzuzufügen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Anzahl der eingehenden und ausgehenden Streams für Ihr Projekt relativ gering ist - beispielsweise ein Dutzend HD-Streams mit einer geringen Anzahl von Ausgabeauflösungen und einem relativ geringen Filteraufwand -, ist es zweckmäßiger, einen Server ohne GPU zu verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist auch erwähnenswert, dass die Menge an RAM für die Aufgabe des Konvertierens von Threads nicht so wichtig ist wie die Verarbeitungsleistung. </font><font style="vertical-align: inherit;">In einigen Fällen können Sie also auch sparen, indem Sie den Speicherplatz reduzieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die vorgestellte Hardwarelösung - eine Kombination aus Tesla M60-CPU und GPU - war perfekt für die Transcodierung von Live-Streams unter hoher Last. </font><font style="vertical-align: inherit;">Die GPU kümmert sich um die ressourcenintensivsten Vorgänge - das Decodieren der Streams und das Codieren in die höchsten Auflösungen, während mittlere und kleine Auflösungen auf der CPU gut verarbeitet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn einer der Leser Erfahrung hat und die Leistung von Grafikkarten für die Live-Übertragung optimiert, werden wir uns freuen, Ihre Erfahrungen kennenzulernen - schreiben Sie in die Kommentare.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de401539/">https://habr.com/ru/post/de401539/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de401527/index.html">Wie sich optische Laufwerke verschlechtern</a></li>
<li><a href="../de401529/index.html">Fragen Sie Ethan: Kann das Universum als lebendig betrachtet werden?</a></li>
<li><a href="../de401531/index.html">Im Rahmen des Projekts „Wissenschaft ist kein Mehl“ wird eine Diskussion zum Thema „Sex, Drogen, Rock and Roll: Sucht oder Leben?“ Stattgeführt.</a></li>
<li><a href="../de401533/index.html">Schwierigkeiten bei der Auswahl einer Budget-Grafikkarte am Beispiel des RX 460</a></li>
<li><a href="../de401535/index.html">Kolonie. Kapitel 4: Die alte Militärbasis</a></li>
<li><a href="../de401541/index.html">50 Schattierungen von Stümpfen * Hardware-Empfang von PWM-codierten Signalen durch Microchip-Mikrocontroller</a></li>
<li><a href="../de401543/index.html">Verwendung von Datensätzen aus dem russischen offenen Datenportal data.gov.ru</a></li>
<li><a href="../de401545/index.html">Chef, ich sehe dich. Intel Unite - Professionelles Kommunikationstool</a></li>
<li><a href="../de401549/index.html">Exotische Materiezustände, LCDs und die Zukunft des Wassers</a></li>
<li><a href="../de401551/index.html">Valve entwickelt drei VR-Spiele gleichzeitig und hofft auf technologische Entwicklung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>