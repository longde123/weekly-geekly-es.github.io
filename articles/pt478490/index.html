<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¨ ğŸ‘©ğŸ¿â€âœˆï¸ ğŸš  DistÃ¢ncia Levenshtein e busca por controladores ğŸ§ğŸ¼ ğŸ  ğŸ¦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Provavelmente, em todas as cidades da BielorrÃºssia onde hÃ¡ trÃ³lebus, existem grupos VK ou bate-papos no Telegram nos quais as pessoas rastreiam a loca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DistÃ¢ncia Levenshtein e busca por controladores</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478490/">  Provavelmente, em todas as cidades da BielorrÃºssia onde hÃ¡ trÃ³lebus, existem grupos VK ou bate-papos no Telegram nos quais as pessoas rastreiam a localizaÃ§Ã£o dos controladores.  Isso Ã© feito principalmente para nÃ£o pagar pela viagem e viajar de graÃ§a, embora a descriÃ§Ã£o dos grupos quase sempre contenha o pÃ³s-escrito "Pagar pela viagem". <br><a name="habracut"></a><br>  No VC, geralmente Ã© assim: <br><br><img src="https://habrastorage.org/webt/ti/eh/cd/tiehcdyeskmccfofp3adt2ko_qe.png" alt="imagem"><br><br>  Um comentÃ¡rio tÃ­pico Ã© assim: <br><br><img src="https://habrastorage.org/webt/ki/kp/s0/kikps0wwqqptfwyro8hrf81rtzg.png" alt="imagem"><br><br>  A estrutura Ã© extremamente simples.  No comentÃ¡rio, hÃ¡ nomes da parada em que os controladores foram notados no momento, hÃ¡ tambÃ©m a direÃ§Ã£o em que eles estÃ£o: <br><br><img src="https://habrastorage.org/webt/no/gy/2l/nogy2l1lrraa8gte90lcyuwsume.png" alt="imagem"><br><br>  O comentÃ¡rio, como resultado, Ã© um objeto com uma parada, hora e data, alÃ©m de um ID exclusivo pelo qual podemos identificÃ¡-lo.  Com isso, vocÃª pode calcular o local mais provÃ¡vel de onde os controladores estÃ£o agora. <br><br><h4>  PreparaÃ§Ã£o </h4><br>  Primeiro, vocÃª precisa determinar o pÃºblico-alvo, a partir do qual analisaremos os dados.  O grupo deve ter bastante atividade nos comentÃ¡rios, caso contrÃ¡rio, corremos o risco de obter muito poucos dados <br><br>  No meu caso, este Ã© o grupo "Control Gomel". <br><br>  Analisaremos os comentÃ¡rios usando a API oficial do VKontakte para Python <br><br>  NÃ³s nos autenticamos com a chave de acesso do usuÃ¡rio, pois alguns grupos podem ser fechados e o acesso aos comentÃ¡rios deles sÃ³ pode ser obtido se vocÃª for aceito no grupo. <br>  Depois disso, vocÃª pode comeÃ§ar a extrair comentÃ¡rios: <br><br><h4>  Receber comentÃ¡rios </h4><br>  Para comeÃ§ar, obtemos a Ãºltima postagem disponÃ­vel no grupo para extrair comentÃ¡rios atravÃ©s do vk.wall.getComments e inicializamos o DataFrame, no qual salvaremos os dados. <br><br>  Cada postagem de comentÃ¡rio tem a inscriÃ§Ã£o "Tenha um bom dia, pague a tarifa e nÃ£o fique sob controle", entÃ£o faÃ§a o download dos comentÃ¡rios, verifique o conteÃºdo da postagem e obtenha uma sÃ©rie de comentÃ¡rios dos quais vocÃª pode obter dados. <br><br>  Eu recebi comentÃ¡rios de postagens nos Ãºltimos 3 meses, uma vez que uma postagem Ã© publicada todos os dias (agora no final de novembro, o ano letivo comeÃ§a em setembro, e os supervisores provavelmente levam isso em consideraÃ§Ã£o e mudam de lugar).  Em princÃ­pio, outros sinais podem ser levados em consideraÃ§Ã£o, como, por exemplo, a Ã©poca do ano. <br><br>  Alguns dos comentÃ¡rios estÃ£o entupidos com mensagens como "Existe alguÃ©m no Barykin?"  Se vocÃª olhar para esses comentÃ¡rios (desnecessÃ¡rios), poderÃ¡ destacar alguns sinais: <br><br><ul><li>  O texto contÃ©m as palavras "limpo", "esquerdo", "ninguÃ©m" e similares </li><li>  As palavras "me diga", "quem", "o que", "como" </li><li>  SÃ­mbolos, como emoticons, por exemplo </li></ul><br>  Depois disso, passamos por uma sÃ©rie de comentÃ¡rios e obtemos deles um ID, texto, hora, data e dia da semana Ãºnicos, que colocamos no DataFrame jÃ¡ criado. <br><br><div class="spoiler">  <b class="spoiler_title">Receber comentÃ¡rios</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> check_correctness <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(lp.login, lp.password) vk_session.auth() vk = vk_session.get_api() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vk <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataFromComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vk, groupID)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     posts = vk.wall.get(owner_id=groupID, offset=1, count=90) print("\n") data = pd.DataFrame(columns=['text', 'post_id', "date", "day_in_week", "hour","minute", "day_in_month"]) for post in posts.get("items"): # id     postID = post.get("id") if "  ,       " not in post.get("text"): continue #  commentary       comments = vk.wall.getComments(owner_id=groupID, post_id=postID, count=200) #           dataframe for comment in comments.get("items"): text = comment.get("text") text = re.sub(r"A-Za-z--0123456789 ", "", str(text)) commentaryIsNice = check_correctness.detection(text) if commentaryIsNice: print(text) date = comment.get("date") time_struct = time.gmtime(date) post_id = comment.get("post_id") data = data.append({"text": text, "post_id" : post_id, "date": date,"day_in_week" : time_struct.tm_wday, "hour": (time_struct.tm_hour+3), "minute": time_struct.tm_min, "day_in_month": time_struct.tm_mday}, ignore_index=True) # print(data[:10]) # print(data.info()) print("dataset is ready") return data</span></span></code> </pre> <br></div></div><br>  Assim, recebemos um DataFrame com o texto dos comentÃ¡rios, sua identificaÃ§Ã£o, dia da semana, hora e minuto em que o comentÃ¡rio foi escrito.  Precisamos apenas do dia da semana, da hora de escrever e do texto.  Parece algo como isto: <br><br><img src="https://habrastorage.org/webt/cd/hs/cy/cdhscyg3rx4f5kejgvjdguuscui.png" alt="imagem"><br><br><h4>  Limpeza de dados </h4><br>  Agora precisamos limpar os dados.  Ã‰ necessÃ¡rio remover a direÃ§Ã£o do comentÃ¡rio para cometer menos erros ao procurar a distÃ¢ncia de Levenshtein.  Encontramos as expressÃµes â€œao ladoâ€, â€œirâ€, â€œcomoâ€, â€œprÃ³ximoâ€, como geralmente sÃ£o seguidas pelo nome da segunda parada, e as excluÃ­mos junto com o que vem depois delas, alÃ©m de substituir alguns nomes de jargÃµes das paradas pelas usuais. . <br><br><div class="spoiler">  <b class="spoiler_title">Limpar dados</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> fuzzywuzzy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> process <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear_commentary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    -     """</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span> splitted = text.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, s <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(splitted): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(splitted) == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> np.NaN <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s)) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>): index = i <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> index &lt; len(splitted) - <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): splitted.remove(splitted[index]) string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = (string.lower()) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: splitted = splitted[:index] string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = string.lower() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted).lower() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clean_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: clear_commentary(s)) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) print(<span class="hljs-string"><span class="hljs-string">"cleaned"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  Convertendo usando a distÃ¢ncia de Levenshtein </h4><br>  Prosseguimos diretamente para a distÃ¢ncia de Levenshane.  Uma pequena ajuda: distÃ¢ncia de Levenshtein - o nÃºmero mÃ­nimo de operaÃ§Ãµes para inserir um caractere, excluir um caractere e substituir um caractere por outro, necessÃ¡rio para transformar uma linha em outra. <br><br>  Vamos encontrÃ¡-lo usando a biblioteca <a href="https://github.com/seatgeek/fuzzywuzzy">fuzzywuzzy</a> .  Ajuda vocÃª a calcular rÃ¡pida e facilmente a distÃ¢ncia de Levenshtein.  Para acelerar o trabalho, os autores da biblioteca tambÃ©m recomendam a instalaÃ§Ã£o da biblioteca python-Levenshtein. <br><br>  Para obter pontos nos comentÃ¡rios, precisamos de uma lista de pontos.  Foi gentilmente fornecido a mim pelo desenvolvedor do aplicativo GoTrans, Alexander Kozlov. <br><br>  A lista teve que ser expandida, adicionando algumas paradas que nÃ£o estavam lÃ¡ e mudando parte dos nomes para que eles ficassem melhor localizados. <br><br><div class="spoiler">  <b class="spoiler_title">PÃ¡ra</b> <div class="spoiler_text">  stops = ['supermercado', 'campina', 'remybtekhnika', 'Leningrado', 'Yaroslavl', 'Polesskaya', <br>  'Yaroslavl', 'timofeenko', '8 de marÃ§o', <br>  'Rechitsky trading house', 'Rechitsky avenue', 'circus', 'store store', 'Chongarskaya', <br>  'chongarka', 'ggu', 'skorina', 'university', 'appliance', '1000 little things', 'maya', 'station', <br>  'parque de pÃ³s-graduaÃ§Ã£o', 'comÃ©rcio e economia', 'aniversÃ¡rio', 'microdistrito 18', 'aeroporto', 'prÃ³ximo', <br>  Â«gomelgeodezcentrÂ», Â«crystalÂ», Â«lake lyubenskoyeÂ», Â«davydovsky marketÂ», Â«davydovkaÂ», <br>  Â«rio sozhÂ», Â«gomeldrevÂ», <br>  'Sevruki', 'gmu No. 1', 'etc. Rechitsky', 'traje', 'hospital de doenÃ§as infecciosas', 'campo de gaivotas', <br>  Volotova, Coral, Gomeltorgmash, Gomelproekt, Vneshgomelstroy, Newspaper, <br>  Â«KalenikovaÂ», Â«EreminoÂ», Â«destilariaÂ», Â«automaÃ§Ã£o industrial especialÂ», Â«2Âª escolaÂ», Â«BarykinaÂ», <br>  'unidades de mÃ¡quina', 'juventude', 'corpo fundido', 'quÃ­micos', 'golovatsky', 'budenny', <br>  'spu67', '35th', 'gagarin', '50 anos atÃ© a fÃ¡brica de Gomselmash ',' hill ',' factory factory ', <br>  'avÃ³', 'vidraria', 'castanha', 'motores de partida', 'astronautas', <br>  'rtsrm inicial', 'bykhovskaya', 'instituto do ministÃ©rio de situaÃ§Ãµes de emergÃªncia', 'dk gomselmash', 'store', 'rechitsky', <br>  "Sevruks", "Osovtsy", "turista", "fÃ¡brica de carne", "SantÃ­ssima Trindade", "cidade mÃ©dica", "outubro", <br>  'depÃ³sito de petrÃ³leo', 'gomelloblavtotrans', 'milkavita', 'bakunin', 'zip', 'oma', 'resin', <br>  Â«mercado da construÃ§Ã£o kskÂ», Â«construtor de estradasÂ», Â«campoÂ», Â«kamenetskayaÂ», Â«bolcheviqueÂ», Â«jakubovkaÂ», <br>  'Borodina', 'hipermercado hipopÃ³tamo', 'herÃ³is subterrÃ¢neos', '9 de maio', 'castanha', 'protÃ©tico', <br>  'estaÃ§Ã£o iput', 'internacional comunista', 'faculdade pedagÃ³gica de mÃºsica', 'empresa agrÃ­cola', 'estrada secundÃ¡ria', 'vitÃ³ria', <br>  'western', 'pearl', 'Vladimir', 'dry', 'dispensary', 'Ivanova', <br>  'construÃ§Ã£o de mÃ¡quinas', 'bÃ©tulas', '60 anos ',' engenheiro de potÃªncia ',' centrolite ', <br>  'clÃ­nica oncolÃ³gica', 'campo de tiro', 'golovintsy', 'coral', 'sul', 'primavera', <br>  Efremova, fronteira, BÃ©lgica, Gomelstroy, Borisenko, PalÃ¡cio de Atletismo, <br>  'Michurinsky', 'solar', 'gastello', 'military', 'auto center', 'encanamento', 'uza', <br>  'faculdade de medicina', 'jardim de infÃ¢ncia 11', 'bolchevique', 'filhotes', 'Davydovsky', 'oceano', 'progresso', <br>  'Dobrushskaya', 'branco', 'GSK', 'davydovka', 'equipamento elÃ©trico', 'amizade', <br>  '70 anos ',' reparaÃ§Ã£o de automÃ³veis ',' colina sueca ',' circuito ',' canal de Ã¡gua ',' mÃ¡quina gomel ', <br>  Volotova, Pioneiro, RCM, Khimtorg, 2nd Meadow Lane, Bochkina, Banhos, <br>  'clÃ­nica oncolÃ³gica', 'praÃ§a', 'LÃªnin', '1Âª escola', 'loja do sul', <br>  'gomelagrotrans', 'millers', 'lyubensky', 'alistamento militar', 'hospital', 'uza', 'rtsrm', <br>  'lysyukovyh', 'shop iput', 'raton', 'gas station', 'randovsky', 'farmhouse', 'chestnut', 'ropovsky', <br>  'Romanovichi', 'Ilyich', 'remo', 'empresa de construÃ§Ã£o', 'infeccioso', <br>  'fÃ¡brica de gordura', 'serviÃ§o de carro', 'agroserviÃ§o', 'pegajoso', 'Nikolskaya', <br>  'ceifeiras automotrizes', 'pedreiros', 'materiais de construÃ§Ã£o', 'mÃ¡quinas para reparo', 'administraÃ§Ã£o', <br>  Â«OutubroÂ», Â«conto de fadas da florestaÂ», Â«TatianaÂ», Â«Boris TsarikovÂ», Â«ZharkovskyÂ», Â«ZaitsevaÂ», <br>  'relocaÃ§Ã£o', 'Karpovich', 'planta de construÃ§Ã£o de casas', 'transporte elÃ©trico da cidade', 'zlin', <br>  'stadium gomselmash', 'ap 6', 'drive hidrÃ¡ulico', 'locomotive depot', 'car market osovtsy', <br>  'nova vida', 'Zhukova', 'unidade militar', '3Âª escola', 'floresta', 'farol vermelho', <br>  'regional', 'Davydovskaya', 'Karbysheva', 'satÃ©lite do mundo', 'juventude', 'locomotiva do estÃ¡dio', <br>  'solar', 'Ladaservice', 'Î¼R 21', 'Aresa', 'internacionalistas', 'Kosareva', <br>  Â«BogdanovaÂ», Â«Gomel ferro-betÃ£oÂ», Î¼r 20a Â», Î¼r RechitskyÂ», Â«equipamento mÃ©dicoÂ», Â«JuraevaÂ», <br>  'faculdade de artesanato', 'gelo', 'dk festival', 'shopping center', <br>  'Kuibyshevsky', 'festival', 'garage koop 27', 'engenharia sÃ­smica', 'milcha', 'tube hospital', <br>  'ptu179', 'produtos quÃ­micos', 'corpo de bombeiros', 'hospital', 'ponto de Ã´nibus', <br>  'complexo jornal', 'vitÃ³ria', 'klenkovsky', 'diamante', 'reparaÃ§Ã£o de motores', 'mkr 19'] <br></div></div><br>  Usando .map e fuzzywuzzy.process.extractOne, encontramos a parada com a distÃ¢ncia mÃ­nima de Levenshtein na lista, apÃ³s a qual substituÃ­mos o texto do comentÃ¡rio pelo nome da parada, o que nos permite obter um conjunto de dados com os nomes das paradas. <br><br>  O conjunto de dados resultante Ã© mais ou menos assim: <br><br><img src="https://habrastorage.org/webt/gd/pd/c8/gdpdc8lwdppzpastghnasxbqsbi.png"><br><br><div class="spoiler">  <b class="spoiler_title">ComentÃ¡rios se transformam em paradas</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_from_comment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""              """</span></span> dict = process.extractOne(text.lower(), stops) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dict[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">75</span></span>: text = dict[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = np.nan print(<span class="hljs-string"><span class="hljs-string">"wait"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_dataset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      """</span></span> print(<span class="hljs-string"><span class="hljs-string">"remap started. wait"</span></span>) data.text = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> comment: get_category_from_comment(str(comment))) print(<span class="hljs-string"><span class="hljs-string">"remap ends"</span></span>) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  SaÃ­da de dados </h4><br>  Agora podemos assumir onde os controladores provavelmente estarÃ£o na hora especificada. <br><br>  Estamos procurando nos registros de dados resultantes por uma hora e dia especÃ­ficos da semana.  Por exemplo, na terÃ§a-feira, 9 horas da manhÃ£: <br><br><pre> <code class="python hljs">&lt;code&gt;data[(data[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == day) &amp; (data[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == hour)]&lt;/code&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/t4/gg/dg/t4ggdgmwezje8lgllisorbqrqwa.png"><br>  <i>(estes nÃ£o sÃ£o todos os dados)</i> <br><br>  Depois disso, encontramos o nÃºmero de paradas exclusivas e exibimos apenas as paradas e seu nÃºmero: <br><br><pre> <code class="python hljs">df[(df[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp; (df[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == <span class="hljs-number"><span class="hljs-number">9</span></span>)][<span class="hljs-string"><span class="hljs-string">"text"</span></span>].value_counts()</code> </pre> <br><img src="https://habrastorage.org/webt/yq/az/if/yqazifl3gkclyqw4ifykvemsrky.png"><br><br>  Agora podemos dizer que Ã s 9 da manhÃ£, Ã s terÃ§as-feiras, os controladores provavelmente serÃ£o vistos nas paradas Myasokombinat, ul.  Lugovaya, BelGUT, TD "Oma". <br><br>  A principal falha nesse mÃ©todo Ã© a falta de dados.  NÃ£o durante todos os dias e horas, hÃ¡ comentÃ¡rios nos comentÃ¡rios feitos na hora do rush, quando as pessoas usam mais o transporte pÃºblico do que os dados em horÃ¡rios menos populares, mas se vocÃª adicionar dados, por exemplo, nÃ£o apenas dos comentÃ¡rios de um grupo, mas tambÃ©m de grupos alternativos ou bate-papos por telegrama, com o nÃºmero de entradas, tudo ficarÃ¡ mais fÃ¡cil. <br><br><h4>  Bot com a API VK LongPoll </h4><br>  Para dar a oportunidade de receber dados sobre a localizaÃ§Ã£o dos controladores, dependendo da hora e sem estar vinculado a um computador, fiz um bot para um grupo no VKontakte que responde a qualquer mensagem enviando o nÃºmero de paradas nos registros, de acordo com a hora e o dia da semana atuais. <br><br><div class="spoiler">  <b class="spoiler_title">CÃ³digo bot</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> randint <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> get_stops_from_data <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_stops_by_time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_bot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data, token)</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(token=token) vk = vk_session.get_api() print(<span class="hljs-string"><span class="hljs-string">"bot started"</span></span>) longPoll = vk.groups.getLongPollServer(group_id=<span class="hljs-number"><span class="hljs-number">183524419</span></span>) server, key, ts = longPoll[<span class="hljs-string"><span class="hljs-string">'server'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'key'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'ts'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-comment"><span class="hljs-comment">#  :   ts longPoll = post('%s' % server, data={'act': 'a_check', 'key': key, 'ts': ts, 'wait': 25}).json() if longPoll['updates'] and len(longPoll['updates']) != 0: for update in longPoll['updates']: if update['type'] == 'message_new': #        vk.messages.markAsRead(peer_id=update['object']['user_id']) user = update['object']["user_id"] text = get_stops_by_time(data) if text is None or text == {}: message = "Ã­Ã¥Ã² Ã§Ã Ã¯Ã¨Ã±Ã¥Ã©" vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) print(message) ts = longPoll['ts'] continue message = "   -     \n" \ "\n \n" for i in text.items(): message += i[0] + " " message += str(i[1]) message += "\n" #    vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) ts = longPoll['ts']</span></span></code> </pre> <br></div></div><br><h4>  ConclusÃ£o </h4><br>  A qualidade de tais hipÃ³teses foi testada por mim mais de uma vez na prÃ¡tica, e tudo funciona bem.  Descobriu-se que os controladores estÃ£o basicamente nas mesmas paradas, embora previsÃµes absolutamente corretas nÃ£o possam ser dadas e a probabilidade de sucesso nÃ£o seja 100%.  A distÃ¢ncia de Levenshtein tem dezenas de aplicaÃ§Ãµes diferentes, desde a correÃ§Ã£o de erros em uma palavra atÃ© a comparaÃ§Ã£o de genes, cromossomos e proteÃ­nas, mas tambÃ©m tem potencial para esses problemas aplicados. <br><br>  Tenha um bom dia e pague a tarifa. <br><br>  Todo cÃ³digo de bot e manipulaÃ§Ã£o de dados sÃ£o publicados <a href="https://github.com/dingdongyouarewrong/vk_controllers_bot">aqui</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt478490/">https://habr.com/ru/post/pt478490/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt478474/index.html">O irmÃ£o Pablo Escobar tambÃ©m lanÃ§ou um smartphone flexÃ­vel</a></li>
<li><a href="../pt478480/index.html">InteligÃªncia artificial, ITSM e, em geral, onde LEAN?</a></li>
<li><a href="../pt478482/index.html">O desenvolvedor abriu um bar para desenvolvedores e organiza reuniÃµes sobre Angular, layout, PHP</a></li>
<li><a href="../pt478484/index.html">SCADA em Framboesa: mito ou realidade?</a></li>
<li><a href="../pt478486/index.html">A era dos chips de 10 nm - quem desenvolve esses processadores e o que espera a indÃºstria no futuro</a></li>
<li><a href="../pt478492/index.html">Escherichia coli em uma dieta de CO2: uma nova ferramenta na luta contra o aquecimento global?</a></li>
<li><a href="../pt478496/index.html">50 anos atrÃ¡s, no quarto nÃºmero 3420, a Internet nasceu</a></li>
<li><a href="../pt478498/index.html">1. IntroduÃ§Ã£o ao Fortinet v 6.0. 1. IntroduÃ§Ã£o</a></li>
<li><a href="../pt478500/index.html">Por que existem tÃ£o poucas conferÃªncias no verÃ£o?</a></li>
<li><a href="../pt478502/index.html">Tecnologia inteligente para todos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>