<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê® üë©üèø‚Äç‚úàÔ∏è üö† Dist√¢ncia Levenshtein e busca por controladores üßùüèº üç† üé¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Provavelmente, em todas as cidades da Bielorr√∫ssia onde h√° tr√≥lebus, existem grupos VK ou bate-papos no Telegram nos quais as pessoas rastreiam a loca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dist√¢ncia Levenshtein e busca por controladores</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478490/">  Provavelmente, em todas as cidades da Bielorr√∫ssia onde h√° tr√≥lebus, existem grupos VK ou bate-papos no Telegram nos quais as pessoas rastreiam a localiza√ß√£o dos controladores.  Isso √© feito principalmente para n√£o pagar pela viagem e viajar de gra√ßa, embora a descri√ß√£o dos grupos quase sempre contenha o p√≥s-escrito "Pagar pela viagem". <br><a name="habracut"></a><br>  No VC, geralmente √© assim: <br><br><img src="https://habrastorage.org/webt/ti/eh/cd/tiehcdyeskmccfofp3adt2ko_qe.png" alt="imagem"><br><br>  Um coment√°rio t√≠pico √© assim: <br><br><img src="https://habrastorage.org/webt/ki/kp/s0/kikps0wwqqptfwyro8hrf81rtzg.png" alt="imagem"><br><br>  A estrutura √© extremamente simples.  No coment√°rio, h√° nomes da parada em que os controladores foram notados no momento, h√° tamb√©m a dire√ß√£o em que eles est√£o: <br><br><img src="https://habrastorage.org/webt/no/gy/2l/nogy2l1lrraa8gte90lcyuwsume.png" alt="imagem"><br><br>  O coment√°rio, como resultado, √© um objeto com uma parada, hora e data, al√©m de um ID exclusivo pelo qual podemos identific√°-lo.  Com isso, voc√™ pode calcular o local mais prov√°vel de onde os controladores est√£o agora. <br><br><h4>  Prepara√ß√£o </h4><br>  Primeiro, voc√™ precisa determinar o p√∫blico-alvo, a partir do qual analisaremos os dados.  O grupo deve ter bastante atividade nos coment√°rios, caso contr√°rio, corremos o risco de obter muito poucos dados <br><br>  No meu caso, este √© o grupo "Control Gomel". <br><br>  Analisaremos os coment√°rios usando a API oficial do VKontakte para Python <br><br>  N√≥s nos autenticamos com a chave de acesso do usu√°rio, pois alguns grupos podem ser fechados e o acesso aos coment√°rios deles s√≥ pode ser obtido se voc√™ for aceito no grupo. <br>  Depois disso, voc√™ pode come√ßar a extrair coment√°rios: <br><br><h4>  Receber coment√°rios </h4><br>  Para come√ßar, obtemos a √∫ltima postagem dispon√≠vel no grupo para extrair coment√°rios atrav√©s do vk.wall.getComments e inicializamos o DataFrame, no qual salvaremos os dados. <br><br>  Cada postagem de coment√°rio tem a inscri√ß√£o "Tenha um bom dia, pague a tarifa e n√£o fique sob controle", ent√£o fa√ßa o download dos coment√°rios, verifique o conte√∫do da postagem e obtenha uma s√©rie de coment√°rios dos quais voc√™ pode obter dados. <br><br>  Eu recebi coment√°rios de postagens nos √∫ltimos 3 meses, uma vez que uma postagem √© publicada todos os dias (agora no final de novembro, o ano letivo come√ßa em setembro, e os supervisores provavelmente levam isso em considera√ß√£o e mudam de lugar).  Em princ√≠pio, outros sinais podem ser levados em considera√ß√£o, como, por exemplo, a √©poca do ano. <br><br>  Alguns dos coment√°rios est√£o entupidos com mensagens como "Existe algu√©m no Barykin?"  Se voc√™ olhar para esses coment√°rios (desnecess√°rios), poder√° destacar alguns sinais: <br><br><ul><li>  O texto cont√©m as palavras "limpo", "esquerdo", "ningu√©m" e similares </li><li>  As palavras "me diga", "quem", "o que", "como" </li><li>  S√≠mbolos, como emoticons, por exemplo </li></ul><br>  Depois disso, passamos por uma s√©rie de coment√°rios e obtemos deles um ID, texto, hora, data e dia da semana √∫nicos, que colocamos no DataFrame j√° criado. <br><br><div class="spoiler">  <b class="spoiler_title">Receber coment√°rios</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> check_correctness <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(lp.login, lp.password) vk_session.auth() vk = vk_session.get_api() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vk <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataFromComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vk, groupID)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     posts = vk.wall.get(owner_id=groupID, offset=1, count=90) print("\n") data = pd.DataFrame(columns=['text', 'post_id', "date", "day_in_week", "hour","minute", "day_in_month"]) for post in posts.get("items"): # id     postID = post.get("id") if "  ,       " not in post.get("text"): continue #  commentary       comments = vk.wall.getComments(owner_id=groupID, post_id=postID, count=200) #           dataframe for comment in comments.get("items"): text = comment.get("text") text = re.sub(r"A-Za-z--0123456789 ", "", str(text)) commentaryIsNice = check_correctness.detection(text) if commentaryIsNice: print(text) date = comment.get("date") time_struct = time.gmtime(date) post_id = comment.get("post_id") data = data.append({"text": text, "post_id" : post_id, "date": date,"day_in_week" : time_struct.tm_wday, "hour": (time_struct.tm_hour+3), "minute": time_struct.tm_min, "day_in_month": time_struct.tm_mday}, ignore_index=True) # print(data[:10]) # print(data.info()) print("dataset is ready") return data</span></span></code> </pre> <br></div></div><br>  Assim, recebemos um DataFrame com o texto dos coment√°rios, sua identifica√ß√£o, dia da semana, hora e minuto em que o coment√°rio foi escrito.  Precisamos apenas do dia da semana, da hora de escrever e do texto.  Parece algo como isto: <br><br><img src="https://habrastorage.org/webt/cd/hs/cy/cdhscyg3rx4f5kejgvjdguuscui.png" alt="imagem"><br><br><h4>  Limpeza de dados </h4><br>  Agora precisamos limpar os dados.  √â necess√°rio remover a dire√ß√£o do coment√°rio para cometer menos erros ao procurar a dist√¢ncia de Levenshtein.  Encontramos as express√µes ‚Äúao lado‚Äù, ‚Äúir‚Äù, ‚Äúcomo‚Äù, ‚Äúpr√≥ximo‚Äù, como geralmente s√£o seguidas pelo nome da segunda parada, e as exclu√≠mos junto com o que vem depois delas, al√©m de substituir alguns nomes de jarg√µes das paradas pelas usuais. . <br><br><div class="spoiler">  <b class="spoiler_title">Limpar dados</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> fuzzywuzzy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> process <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear_commentary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    -     """</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span> splitted = text.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, s <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(splitted): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(splitted) == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> np.NaN <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s)) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>): index = i <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> index &lt; len(splitted) - <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): splitted.remove(splitted[index]) string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = (string.lower()) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: splitted = splitted[:index] string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = string.lower() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted).lower() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clean_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: clear_commentary(s)) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) print(<span class="hljs-string"><span class="hljs-string">"cleaned"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  Convertendo usando a dist√¢ncia de Levenshtein </h4><br>  Prosseguimos diretamente para a dist√¢ncia de Levenshane.  Uma pequena ajuda: dist√¢ncia de Levenshtein - o n√∫mero m√≠nimo de opera√ß√µes para inserir um caractere, excluir um caractere e substituir um caractere por outro, necess√°rio para transformar uma linha em outra. <br><br>  Vamos encontr√°-lo usando a biblioteca <a href="https://github.com/seatgeek/fuzzywuzzy">fuzzywuzzy</a> .  Ajuda voc√™ a calcular r√°pida e facilmente a dist√¢ncia de Levenshtein.  Para acelerar o trabalho, os autores da biblioteca tamb√©m recomendam a instala√ß√£o da biblioteca python-Levenshtein. <br><br>  Para obter pontos nos coment√°rios, precisamos de uma lista de pontos.  Foi gentilmente fornecido a mim pelo desenvolvedor do aplicativo GoTrans, Alexander Kozlov. <br><br>  A lista teve que ser expandida, adicionando algumas paradas que n√£o estavam l√° e mudando parte dos nomes para que eles ficassem melhor localizados. <br><br><div class="spoiler">  <b class="spoiler_title">P√°ra</b> <div class="spoiler_text">  stops = ['supermercado', 'campina', 'remybtekhnika', 'Leningrado', 'Yaroslavl', 'Polesskaya', <br>  'Yaroslavl', 'timofeenko', '8 de mar√ßo', <br>  'Rechitsky trading house', 'Rechitsky avenue', 'circus', 'store store', 'Chongarskaya', <br>  'chongarka', 'ggu', 'skorina', 'university', 'appliance', '1000 little things', 'maya', 'station', <br>  'parque de p√≥s-gradua√ß√£o', 'com√©rcio e economia', 'anivers√°rio', 'microdistrito 18', 'aeroporto', 'pr√≥ximo', <br>  ¬´gomelgeodezcentr¬ª, ¬´crystal¬ª, ¬´lake lyubenskoye¬ª, ¬´davydovsky market¬ª, ¬´davydovka¬ª, <br>  ¬´rio sozh¬ª, ¬´gomeldrev¬ª, <br>  'Sevruki', 'gmu No. 1', 'etc. Rechitsky', 'traje', 'hospital de doen√ßas infecciosas', 'campo de gaivotas', <br>  Volotova, Coral, Gomeltorgmash, Gomelproekt, Vneshgomelstroy, Newspaper, <br>  ¬´Kalenikova¬ª, ¬´Eremino¬ª, ¬´destilaria¬ª, ¬´automa√ß√£o industrial especial¬ª, ¬´2¬™ escola¬ª, ¬´Barykina¬ª, <br>  'unidades de m√°quina', 'juventude', 'corpo fundido', 'qu√≠micos', 'golovatsky', 'budenny', <br>  'spu67', '35th', 'gagarin', '50 anos at√© a f√°brica de Gomselmash ',' hill ',' factory factory ', <br>  'av√≥', 'vidraria', 'castanha', 'motores de partida', 'astronautas', <br>  'rtsrm inicial', 'bykhovskaya', 'instituto do minist√©rio de situa√ß√µes de emerg√™ncia', 'dk gomselmash', 'store', 'rechitsky', <br>  "Sevruks", "Osovtsy", "turista", "f√°brica de carne", "Sant√≠ssima Trindade", "cidade m√©dica", "outubro", <br>  'dep√≥sito de petr√≥leo', 'gomelloblavtotrans', 'milkavita', 'bakunin', 'zip', 'oma', 'resin', <br>  ¬´mercado da constru√ß√£o ksk¬ª, ¬´construtor de estradas¬ª, ¬´campo¬ª, ¬´kamenetskaya¬ª, ¬´bolchevique¬ª, ¬´jakubovka¬ª, <br>  'Borodina', 'hipermercado hipop√≥tamo', 'her√≥is subterr√¢neos', '9 de maio', 'castanha', 'prot√©tico', <br>  'esta√ß√£o iput', 'internacional comunista', 'faculdade pedag√≥gica de m√∫sica', 'empresa agr√≠cola', 'estrada secund√°ria', 'vit√≥ria', <br>  'western', 'pearl', 'Vladimir', 'dry', 'dispensary', 'Ivanova', <br>  'constru√ß√£o de m√°quinas', 'b√©tulas', '60 anos ',' engenheiro de pot√™ncia ',' centrolite ', <br>  'cl√≠nica oncol√≥gica', 'campo de tiro', 'golovintsy', 'coral', 'sul', 'primavera', <br>  Efremova, fronteira, B√©lgica, Gomelstroy, Borisenko, Pal√°cio de Atletismo, <br>  'Michurinsky', 'solar', 'gastello', 'military', 'auto center', 'encanamento', 'uza', <br>  'faculdade de medicina', 'jardim de inf√¢ncia 11', 'bolchevique', 'filhotes', 'Davydovsky', 'oceano', 'progresso', <br>  'Dobrushskaya', 'branco', 'GSK', 'davydovka', 'equipamento el√©trico', 'amizade', <br>  '70 anos ',' repara√ß√£o de autom√≥veis ',' colina sueca ',' circuito ',' canal de √°gua ',' m√°quina gomel ', <br>  Volotova, Pioneiro, RCM, Khimtorg, 2nd Meadow Lane, Bochkina, Banhos, <br>  'cl√≠nica oncol√≥gica', 'pra√ßa', 'L√™nin', '1¬™ escola', 'loja do sul', <br>  'gomelagrotrans', 'millers', 'lyubensky', 'alistamento militar', 'hospital', 'uza', 'rtsrm', <br>  'lysyukovyh', 'shop iput', 'raton', 'gas station', 'randovsky', 'farmhouse', 'chestnut', 'ropovsky', <br>  'Romanovichi', 'Ilyich', 'remo', 'empresa de constru√ß√£o', 'infeccioso', <br>  'f√°brica de gordura', 'servi√ßo de carro', 'agroservi√ßo', 'pegajoso', 'Nikolskaya', <br>  'ceifeiras automotrizes', 'pedreiros', 'materiais de constru√ß√£o', 'm√°quinas para reparo', 'administra√ß√£o', <br>  ¬´Outubro¬ª, ¬´conto de fadas da floresta¬ª, ¬´Tatiana¬ª, ¬´Boris Tsarikov¬ª, ¬´Zharkovsky¬ª, ¬´Zaitseva¬ª, <br>  'reloca√ß√£o', 'Karpovich', 'planta de constru√ß√£o de casas', 'transporte el√©trico da cidade', 'zlin', <br>  'stadium gomselmash', 'ap 6', 'drive hidr√°ulico', 'locomotive depot', 'car market osovtsy', <br>  'nova vida', 'Zhukova', 'unidade militar', '3¬™ escola', 'floresta', 'farol vermelho', <br>  'regional', 'Davydovskaya', 'Karbysheva', 'sat√©lite do mundo', 'juventude', 'locomotiva do est√°dio', <br>  'solar', 'Ladaservice', 'ŒºR 21', 'Aresa', 'internacionalistas', 'Kosareva', <br>  ¬´Bogdanova¬ª, ¬´Gomel ferro-bet√£o¬ª, Œºr 20a ¬ª, Œºr Rechitsky¬ª, ¬´equipamento m√©dico¬ª, ¬´Juraeva¬ª, <br>  'faculdade de artesanato', 'gelo', 'dk festival', 'shopping center', <br>  'Kuibyshevsky', 'festival', 'garage koop 27', 'engenharia s√≠smica', 'milcha', 'tube hospital', <br>  'ptu179', 'produtos qu√≠micos', 'corpo de bombeiros', 'hospital', 'ponto de √¥nibus', <br>  'complexo jornal', 'vit√≥ria', 'klenkovsky', 'diamante', 'repara√ß√£o de motores', 'mkr 19'] <br></div></div><br>  Usando .map e fuzzywuzzy.process.extractOne, encontramos a parada com a dist√¢ncia m√≠nima de Levenshtein na lista, ap√≥s a qual substitu√≠mos o texto do coment√°rio pelo nome da parada, o que nos permite obter um conjunto de dados com os nomes das paradas. <br><br>  O conjunto de dados resultante √© mais ou menos assim: <br><br><img src="https://habrastorage.org/webt/gd/pd/c8/gdpdc8lwdppzpastghnasxbqsbi.png"><br><br><div class="spoiler">  <b class="spoiler_title">Coment√°rios se transformam em paradas</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_from_comment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""              """</span></span> dict = process.extractOne(text.lower(), stops) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dict[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">75</span></span>: text = dict[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = np.nan print(<span class="hljs-string"><span class="hljs-string">"wait"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_dataset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      """</span></span> print(<span class="hljs-string"><span class="hljs-string">"remap started. wait"</span></span>) data.text = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> comment: get_category_from_comment(str(comment))) print(<span class="hljs-string"><span class="hljs-string">"remap ends"</span></span>) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  Sa√≠da de dados </h4><br>  Agora podemos assumir onde os controladores provavelmente estar√£o na hora especificada. <br><br>  Estamos procurando nos registros de dados resultantes por uma hora e dia espec√≠ficos da semana.  Por exemplo, na ter√ßa-feira, 9 horas da manh√£: <br><br><pre> <code class="python hljs">&lt;code&gt;data[(data[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == day) &amp; (data[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == hour)]&lt;/code&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/t4/gg/dg/t4ggdgmwezje8lgllisorbqrqwa.png"><br>  <i>(estes n√£o s√£o todos os dados)</i> <br><br>  Depois disso, encontramos o n√∫mero de paradas exclusivas e exibimos apenas as paradas e seu n√∫mero: <br><br><pre> <code class="python hljs">df[(df[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp; (df[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == <span class="hljs-number"><span class="hljs-number">9</span></span>)][<span class="hljs-string"><span class="hljs-string">"text"</span></span>].value_counts()</code> </pre> <br><img src="https://habrastorage.org/webt/yq/az/if/yqazifl3gkclyqw4ifykvemsrky.png"><br><br>  Agora podemos dizer que √†s 9 da manh√£, √†s ter√ßas-feiras, os controladores provavelmente ser√£o vistos nas paradas Myasokombinat, ul.  Lugovaya, BelGUT, TD "Oma". <br><br>  A principal falha nesse m√©todo √© a falta de dados.  N√£o durante todos os dias e horas, h√° coment√°rios nos coment√°rios feitos na hora do rush, quando as pessoas usam mais o transporte p√∫blico do que os dados em hor√°rios menos populares, mas se voc√™ adicionar dados, por exemplo, n√£o apenas dos coment√°rios de um grupo, mas tamb√©m de grupos alternativos ou bate-papos por telegrama, com o n√∫mero de entradas, tudo ficar√° mais f√°cil. <br><br><h4>  Bot com a API VK LongPoll </h4><br>  Para dar a oportunidade de receber dados sobre a localiza√ß√£o dos controladores, dependendo da hora e sem estar vinculado a um computador, fiz um bot para um grupo no VKontakte que responde a qualquer mensagem enviando o n√∫mero de paradas nos registros, de acordo com a hora e o dia da semana atuais. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo bot</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> randint <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> get_stops_from_data <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_stops_by_time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_bot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data, token)</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(token=token) vk = vk_session.get_api() print(<span class="hljs-string"><span class="hljs-string">"bot started"</span></span>) longPoll = vk.groups.getLongPollServer(group_id=<span class="hljs-number"><span class="hljs-number">183524419</span></span>) server, key, ts = longPoll[<span class="hljs-string"><span class="hljs-string">'server'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'key'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'ts'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-comment"><span class="hljs-comment">#  :   ts longPoll = post('%s' % server, data={'act': 'a_check', 'key': key, 'ts': ts, 'wait': 25}).json() if longPoll['updates'] and len(longPoll['updates']) != 0: for update in longPoll['updates']: if update['type'] == 'message_new': #        vk.messages.markAsRead(peer_id=update['object']['user_id']) user = update['object']["user_id"] text = get_stops_by_time(data) if text is None or text == {}: message = "√≠√•√≤ √ß√†√Ø√®√±√•√©" vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) print(message) ts = longPoll['ts'] continue message = "   -     \n" \ "\n \n" for i in text.items(): message += i[0] + " " message += str(i[1]) message += "\n" #    vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) ts = longPoll['ts']</span></span></code> </pre> <br></div></div><br><h4>  Conclus√£o </h4><br>  A qualidade de tais hip√≥teses foi testada por mim mais de uma vez na pr√°tica, e tudo funciona bem.  Descobriu-se que os controladores est√£o basicamente nas mesmas paradas, embora previs√µes absolutamente corretas n√£o possam ser dadas e a probabilidade de sucesso n√£o seja 100%.  A dist√¢ncia de Levenshtein tem dezenas de aplica√ß√µes diferentes, desde a corre√ß√£o de erros em uma palavra at√© a compara√ß√£o de genes, cromossomos e prote√≠nas, mas tamb√©m tem potencial para esses problemas aplicados. <br><br>  Tenha um bom dia e pague a tarifa. <br><br>  Todo c√≥digo de bot e manipula√ß√£o de dados s√£o publicados <a href="https://github.com/dingdongyouarewrong/vk_controllers_bot">aqui</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt478490/">https://habr.com/ru/post/pt478490/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt478474/index.html">O irm√£o Pablo Escobar tamb√©m lan√ßou um smartphone flex√≠vel</a></li>
<li><a href="../pt478480/index.html">Intelig√™ncia artificial, ITSM e, em geral, onde LEAN?</a></li>
<li><a href="../pt478482/index.html">O desenvolvedor abriu um bar para desenvolvedores e organiza reuni√µes sobre Angular, layout, PHP</a></li>
<li><a href="../pt478484/index.html">SCADA em Framboesa: mito ou realidade?</a></li>
<li><a href="../pt478486/index.html">A era dos chips de 10 nm - quem desenvolve esses processadores e o que espera a ind√∫stria no futuro</a></li>
<li><a href="../pt478492/index.html">Escherichia coli em uma dieta de CO2: uma nova ferramenta na luta contra o aquecimento global?</a></li>
<li><a href="../pt478496/index.html">50 anos atr√°s, no quarto n√∫mero 3420, a Internet nasceu</a></li>
<li><a href="../pt478498/index.html">1. Introdu√ß√£o ao Fortinet v 6.0. 1. Introdu√ß√£o</a></li>
<li><a href="../pt478500/index.html">Por que existem t√£o poucas confer√™ncias no ver√£o?</a></li>
<li><a href="../pt478502/index.html">Tecnologia inteligente para todos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>