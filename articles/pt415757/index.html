<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò§ üòπ ü§¥üèæ Como o BitSignature funciona no Bitcoin ü§π üôåüèΩ üë®üèΩ‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, veremos como a multi-assinatura funciona no protocolo Bitcoin. Observe que em outras criptomoedas e moedas digitais, esses mecanismos po...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o BitSignature funciona no Bitcoin</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/distributedlab/blog/415757/">  Neste artigo, veremos como a multi-assinatura funciona no protocolo Bitcoin.  Observe que em outras criptomoedas e moedas digitais, esses mecanismos podem ser implementados de maneira diferente - depende do modelo de transa√ß√£o.  Daremos uma defini√ß√£o de multi-assinatura, analisaremos esquematicamente sua estrutura usando um exemplo de transa√ß√£o, consideraremos op√ß√µes para seu uso e precau√ß√µes ao trabalhar com ela.  Tentaremos divulgar abertamente o t√≥pico das melhorias propostas, P2SH, e tamb√©m no diagrama analisaremos o mecanismo para enviar um pagamento para um endere√ßo com v√°rias assinaturas.  Acreditamos que o material apresentado ser√° de interesse dos leitores cuja atividade ou √°rea de interesse esteja relacionada √†s moedas digitais. <br><a name="habracut"></a><br><h2>  Endere√ßo de v√°rias assinaturas </h2><br>  O endere√ßo multisignatura (endere√ßo multisig, para abreviar) √© um endere√ßo Bitcoin ao qual v√°rios pares de chaves ECDSA s√£o anexados ao mesmo tempo.  Cada par consiste em chaves p√∫blicas e privadas.  Os padr√µes de combina√ß√£o segundo os quais essas teclas podem ser usadas podem ser diferentes.  Al√©m disso, √© poss√≠vel estabelecer condi√ß√µes sob as quais ser√° necess√°rio fornecer v√°rias assinaturas para gastar moedas do endere√ßo. <br><br><h2>  Transa√ß√£o de Bitcoin que usa v√°rias assinaturas </h2><br>  Em mais detalhes, ele pode ser exibido esquematicamente.  Por enquanto, basta imaginar, figurativamente, que um endere√ßo com v√°rias assinaturas √© formado por v√°rias chaves p√∫blicas concatenadas de uma s√≥ vez.  Vamos considerar isso com mais detalhes um pouco mais.  O diagrama mostra uma transa√ß√£o que gasta com um endere√ßo de multi-assinatura. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/024/757/d7b/024757d7bbb5989ec70c59030efbea9e.png" alt="imagem"><br><br>  Cinza indica a √°rea do t√≠tulo.  Ele cont√©m dois campos.  Duas entradas s√£o indicadas em azul e duas sa√≠das em verde.  A primeira entrada cont√©m os campos preenchidos: o valor do hash da transa√ß√£o anterior √© gravado, o que gasta os dados da moeda, o n√∫mero de sa√≠da etc. O campo scriptSig cont√©m a chave p√∫blica e a assinatura, o que √© t√≠pico para uma transa√ß√£o normal. <br><br>  Preste aten√ß√£o na segunda entrada da transa√ß√£o.  O campo scriptSig cont√©m outra combina√ß√£o de dados: duas chaves p√∫blicas e duas assinaturas s√£o listadas.  Eles devem ser verificados por essas chaves p√∫blicas, respectivamente.  Essa √© a entrada da transa√ß√£o que gasta moedas com um endere√ßo de multi-assinatura.  √â assim que a prova de propriedade das moedas ser√° exibida. <br><br><h2>  Op√ß√µes de combina√ß√£o de teclas </h2><br>  Existem v√°rias combina√ß√µes de teclas ao usar o endere√ßo de v√°rias assinaturas.  As op√ß√µes mais usadas s√£o 2-de-2, 2-de-3 e 3-de-3.  A op√ß√£o m√°xima poss√≠vel √© 15 em 15. <br><br>  A combina√ß√£o mais simples √© 2-de-2.  Isso implica que h√° um endere√ßo com v√°rias assinaturas ao qual dois pares de chaves est√£o vinculados; na verdade, duas chaves p√∫blicas s√£o divididas em hash em uma linha e algum endere√ßo √© recebido.  Para gastar moedas nesse endere√ßo, √© necess√°rio fornecer duas assinaturas que ser√£o verificadas por duas chaves p√∫blicas dispon√≠veis, cuja concatena√ß√£o e hash na ordem correta devem fornecer o mesmo valor do endere√ßo.  Resumindo, existem duas chaves pr√©-instaladas e voc√™ precisa de duas assinaturas, que ser√£o verificadas por essas chaves, respectivamente. <br><br>  O uso do endere√ßo multisignatura 2-de-3 implica que qualquer uma das tr√™s chaves predefinidas deve ser usada para verificar as duas assinaturas apresentadas como prova de propriedade das moedas.  Em outras palavras, para gastar moedas, voc√™ precisa fornecer duas assinaturas que ser√£o verificadas por duas chaves p√∫blicas das tr√™s predefinidas. <br><br>  A combina√ß√£o de 3-de-3, como voc√™ j√° entendeu, requer tr√™s assinaturas, que ser√£o verificadas por tr√™s chaves pr√©-instaladas.  O m√°ximo em termos de n√∫mero de assinaturas e chaves p√∫blicas necess√°rias ser√° o esquema de 15 a 15. <br><br>  Vamos examinar as op√ß√µes para usar essas combina√ß√µes. <br><br><h3>  2-de-2 </h3><br>  Imagine que marido e mulher desejassem manter um or√ßamento comum. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c2/5d3/5e3/6c25d35e327e97eefbac833083f76481.png" alt="imagem"><br><br>  Eles concordam que somente com o consentimento de cada um deles os fundos do or√ßamento ser√£o gastos em determinadas necessidades.  Com o Bitcoin, isso pode ser implementado de maneira simples.  Eles criam um endere√ßo com v√°rias assinaturas de acordo com esse esquema, onde a esposa controla uma tecla e o marido controla a segunda.  Ent√£o a fam√≠lia receber√° toda a renda nesses endere√ßos e o dinheiro poder√° ser gasto apenas de comum acordo. <br><br>  Prevendo a sua pergunta sobre o cen√°rio em que marido e mulher n√£o concordam, imagine que a esposa considere necess√°rio comprar uma m√°quina de lavar, porque est√° cansada de lavar com as m√£os, e o marido acredita que este n√£o √© um trabalho t√£o √°rduo e ser√° mais conveniente gastar todas as moedas em o mais recente modelo PlayStation e gaste seu tempo de lazer dessa maneira.  A esposa se ofende com o marido e come um peda√ßo de papel com a chave privada, impossibilitando os gastos com esse endere√ßo. <br><br>  Como evitar tal situa√ß√£o e proteger as moedas da perda final de moedas? <br><br>  √â poss√≠vel criar uma transa√ß√£o que gastar√° todos os fundos do endere√ßo desejado, apesar de o valor n√£o ser conhecido antecipadamente.  A entrada n√£o √© a quantia, mas um link para a transa√ß√£o, de onde essas moedas podem ser gastas.  Existe um <b>tipo de hash</b> , que √© uma maneira de cobrir com uma assinatura de transa√ß√£o.  Ele permite que voc√™ crie uma assinatura antecipadamente, e alguns dados de transa√ß√£o, como entrada, podem ser substitu√≠dos posteriormente.  Assim, voc√™ pode criar uma transa√ß√£o que gastar√° moedas de uma transa√ß√£o que ainda n√£o existe e aplic√°-la mais tarde, ou seja, quando for necess√°ria. <br><br>  Al√©m disso, voc√™ pode colocar uma restri√ß√£o LockTime nessa transa√ß√£o.  Ele permite que voc√™ n√£o confirme a transa√ß√£o imediatamente, mas adie-a por algum tempo.  Portanto, marido e mulher imediatamente ap√≥s a cria√ß√£o de um endere√ßo com v√°rias assinaturas, mesmo antes de receber qualquer pagamento, podem criar duas transa√ß√µes LockTime nas quais todas as moedas futuras ser√£o redirecionadas para os endere√ßos habituais do marido e esposa, que eles controlam independentemente.  Ao mesmo tempo, as transa√ß√µes ser√£o adiadas e s√≥ podem ser confirmadas, por exemplo, ap√≥s dois meses.  Essas transa√ß√µes podem ser impressas em papel e armazenadas individualmente em um cofre.  Se surgir uma situa√ß√£o em que as moedas est√£o na balan√ßa do endere√ßo de v√°rias assinaturas e as chaves forem perdidas (uma ou ambas), as moedas ser√£o congeladas.  Mas h√° uma transa√ß√£o LockTime.  Qualquer pessoa que publique essa transa√ß√£o poder√° retirar esses fundos para um endere√ßo externo v√°lido.  As moedas ser√£o salvas.  Este foi um exemplo simplificado, mas mecanismos mais complexos s√£o poss√≠veis. <br><br><h3>  2-de-3 </h3><br>  Suponha que exista um grupo de pessoas que tenham um or√ßamento comum. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/841/bf6/ef4/841bf6ef4bc002b52cd87954139542fc.png" alt="imagem"><br><br>  Eles criam um endere√ßo de multi-assinatura no qual h√° tr√™s chaves, mas duas assinaturas s√£o suficientes para assinar a transa√ß√£o.  Com o consentimento dos participantes que comp√µem a maioria do grupo, esses fundos podem ser gastos.  Em outras palavras, dois em cada tr√™s participantes podem gastar moedas.  Para fazer isso, basta espalhar a transa√ß√£o para a rede. <br><br><h3>  Exemplo de servi√ßo da carteira </h3><br>  Existe uma maneira mais interessante de usar a combina√ß√£o 2-de-3 e √© usada nos chamados servi√ßos de carteira.  O servi√ßo de carteira nesse contexto n√£o deve ser confundido com a carteira Bitcoin usual, que o usu√°rio controla de forma independente.  O servi√ßo n√£o fornece armazenamento completo para moedas e n√£o √© o propriet√°rio delas, mas apenas fornece servi√ßos para um trabalho conveniente. <br><br>  Se voc√™ imaginar esta situa√ß√£o esquematicamente, uma chave pertence diretamente ao servi√ßo, a segunda √© gerada apenas pelo usu√°rio (e somente ele sabe), a terceira chave √© gerada e armazenada pelo usu√°rio tamb√©m, mas separadamente.  Depois disso, as chaves p√∫blicas correspondentes a essas chaves pessoais s√£o calculadas e um endere√ßo de multi-assinatura √© compilado.  As moedas chegam l√° e agora as condi√ß√µes de gastos s√£o limitadas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d8a/e30/d30/d8ae30d30c32d7a204d6c2cd0452a8ac.png" alt="imagem"><br><br>  Imagine que estamos lidando com um determinado servi√ßo da web e voc√™ pode inserir seu recurso atrav√©s de um navegador.  O navegador baixa o c√≥digo da carteira Bitcoin, que neste endere√ßo recebe uma lista de moedas n√£o gastas, calcula seu saldo e est√° pronto para gastar.  Se o usu√°rio quiser gastar moedas, ele far√° uma transa√ß√£o diretamente no navegador e a assinar√° com sua (uma das necess√°rias) assinaturas. <br><br>  Observe que o usu√°rio pode receber a chave privada da senha ou a chave pode ser gerada aleatoriamente, criptografada com a senha do usu√°rio e armazenada no servi√ßo.  Em seguida, o usu√°rio envia uma solicita√ß√£o ao servi√ßo, recebe um cont√™iner com uma chave criptografada, descriptografa-o com sua senha e j√° tem acesso √† sua chave privada. <br><br>  Quando um usu√°rio assina uma transa√ß√£o, ele √© enviado para o lado do servi√ßo, para que ele coloque a segunda assinatura necess√°ria e envie a transa√ß√£o.  O servi√ßo esclarece o fato da necessidade de assinar a transa√ß√£o atrav√©s do segundo canal de autentica√ß√£o, ou seja, atrav√©s de um canal diferente definido previamente, que pode ser uma chamada para um telefone celular, SMS, mensagem de email e outros m√©todos de comunica√ß√£o alternativos (at√© uma visita pessoal, se o n√≠vel de seguran√ßa exigir) .  Quando o servi√ßo certifica-se de que o usu√°rio registrado realmente inicia a solicita√ß√£o de assinatura da transa√ß√£o, coloca a assinatura ausente usando sua chave.  Depois disso, a transa√ß√£o se torna v√°lida e pode ser distribu√≠da √† rede para confirma√ß√£o. <br><br>  A terceira chave √© usada quando o servi√ßo √© negado.  O software gera essa chave e oferece salv√°-la de uma maneira conveniente para voc√™.  O usu√°rio geralmente o armazena em um local seguro.  Se o servi√ßo for negado, o usu√°rio poder√° assinar a transa√ß√£o com suas pr√≥prias chaves (segunda e terceira).  Se a segunda chave foi armazenada no lado do servi√ßo, um cont√™iner protegido com essa chave ser√° enviado ao usu√°rio com anteced√™ncia por meio de um canal de dados alternativo, por exemplo, por e-mail.  O usu√°rio descriptografa o cont√™iner com a chave usando sua senha. <br><br>  O usu√°rio recebe duas chaves privadas necess√°rias e entra no software especial fornecido pelo servi√ßo com anteced√™ncia.  Al√©m disso, este software √© executado de forma aut√¥noma no computador do usu√°rio, sem a participa√ß√£o do servi√ßo.  Vale ressaltar que este software deve ser usado apenas em casos extremos, quando o servi√ßo nega o servi√ßo (ou seja, foi hackeado, danificado ou deixou de existir).  Em seguida, o usu√°rio assina a transa√ß√£o com suas chaves e transfere as moedas quando necess√°rio. <br><br><h2>  Benef√≠cios dos Servi√ßos de Carteira 2 em 3 </h2><br>  Vamos nos concentrar nas vantagens de tais servi√ßos da Carteira virtual em mais detalhes.  Essa √© uma maneira segura de armazenar, porque o servi√ßo n√£o possui todo o conjunto de chaves necess√°rio - ele possui apenas uma parte, o que n√£o √© suficiente para tomar posse dos fundos.  Al√©m disso, nem o servi√ßo em si, nem o hacker que pode quebr√°-lo t√™m acesso a fundos. <br><br>  A conveni√™ncia dessa abordagem √© que o usu√°rio n√£o precisa ter acesso seguro a esse servi√ßo.  Ele pode ter um dispositivo comum que pode ser infectado por v√≠rus ou controlado por golpistas, e os dados podem ser comprometidos ou substitu√≠dos.  Mas n√£o √© suficiente para um invasor possuir apenas esse dispositivo, porque apenas uma das duas assinaturas pode ser obtida dele. <br><br>  Outra vantagem √© que, se o servi√ßo negar o servi√ßo, o usu√°rio n√£o perde o acesso √†s suas moedas.  Esses foram apenas alguns dos esquemas poss√≠veis para o uso de endere√ßos com v√°rias assinaturas, suficientes para o namoro. <br><br><h2>  <b>Precau√ß√µes com v√°rias assinaturas</b> </h2><br>  E agora vale a pena falar sobre as precau√ß√µes relacionadas √† assinatura m√∫ltipla.  No caso de 2-de-2, voc√™ precisa criar transa√ß√µes LockTime que podem transferir fundos bloqueados para um endere√ßo espec√≠fico.  Isso ocorre quando a perda de chave ocorre. <br><br>  Se voc√™ estiver usando o endere√ßo de v√°rias assinaturas 2-de-3, √© muito importante que voc√™ mantenha as chaves em um local seguro.  Em caso de perda de uma das tr√™s chaves, voc√™ deve transferir fundos imediatamente e n√£o esperar at√© o momento em que duas das tr√™s chaves necess√°rias forem perdidas. <br><br><h2>  Como o Bitcoin Script funciona (por exemplo) </h2><br>  Para entender com mais detalhes como funciona a multi-assinatura, precisamos falar um pouco sobre como o Bitcoin Script funciona: como as regras para gastar moedas s√£o definidas, como satisfaz√™-las, quais s√£o as opera√ß√µes para descrever as regras, o que √© o Bitcoin Script e como √© executado. <br><br>  Considere um exemplo de um caso simples de gastar moedas, em que h√° um endere√ßo regular ao qual um hash de uma chave p√∫blica est√° associado, um script correspondente que define as condi√ß√µes de gasto e um script que satisfaz essas condi√ß√µes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d3/d70/de7/4d3d70de77efa70bb73849ee4ee58b7d.png" alt="imagem"><br><br>  No diagrama √† esquerda, vemos a pilha de dados e, √† direita, o pr√≥prio script.  As duas primeiras partes da linha de script s√£o assinatura e a chave p√∫blica, o chamado script de desbloqueio, ou seja, o script indicado na entrada da transa√ß√£o que gasta moedas.  Isso √© seguido pelo conjunto de dados indicado na sa√≠da da transa√ß√£o - isso √© chamado de script de bloqueio.  Em outras palavras, a concatena√ß√£o de dois scripts √© apresentada aqui: um script que desbloqueia moedas e um script que bloqueia moedas.  No caso em que a transa√ß√£o j√° ser√° validada pelo n√≥ da rede, esses dois scripts s√£o combinados para verificar as condi√ß√µes de gasto de moedas.  Assim, o script de desbloqueio vem primeiro, seguido pelo script de bloqueio. <br><br>  Depois disso, √© a execu√ß√£o seq√ºencial de um conjunto completo de operandos e dados.  O ponto de execu√ß√£o √© executado seq√ºencialmente para cada operando e cada parte dos dados.  Se o ponto de execu√ß√£o atingir um dado, ele √© empurrado para a pilha.  Como podemos ver no diagrama, o cursor de execu√ß√£o de script na parte superior indica os dados da assinatura, que s√£o ent√£o empurrados para a pilha. <br><br>  Al√©m disso, o cursor de execu√ß√£o aponta para a chave p√∫blica - ela tamb√©m √© empurrada para a pilha. <br><br>  A terceira etapa √© executar a opera√ß√£o de duplica√ß√£o, o que significa copiar a parte superior da pilha e colocar esses dados novamente na pilha. <br><br>  Depois disso, o hash √© realizado usando a fun√ß√£o hash Hash-160.  Isso significa que a parte superior da pilha √© dividida primeiro pelo algoritmo SHA-2, com um comprimento de 256 bits, e depois pela fun√ß√£o RIPEMD-160, com um comprimento de 160 bits.  A opera√ß√£o √© exatamente a mesma do hash da chave p√∫blica e da obten√ß√£o do endere√ßo.  De fato, √© isso. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aaf/912/e9c/aaf912e9cf2b416fe8c7874ba64869cc.png" alt="imagem"><br><br>  Temos uma pilha, assinatura, chave p√∫blica e valor de hash da chave p√∫blica.  O cursor de execu√ß√£o do script aponta para o endere√ßo especificado na sa√≠da da transa√ß√£o, ou seja, o valor do hash da chave p√∫blica, que foi indicado quando as moedas foram enviadas para ela.  Esse dado tamb√©m entra na pilha. <br><br>  A pr√≥xima opera√ß√£o √© igual a verifica√ß√£o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d6b/1ae/2a7/d6b1ae2a7cfe776aa117493830f7dd30.png" alt="imagem"><br><br>  Os dois principais elementos da pilha s√£o comparados.  Se eles s√£o exatamente o mesmo byte, esses dados s√£o exclu√≠dos da pilha e acredita-se que a verifica√ß√£o foi bem-sucedida.  Depois disso, a assinatura e a chave p√∫blica permanecem na pilha.  Assim, a opera√ß√£o de assinatura de verifica√ß√£o pega esses dois operandos e verifica a assinatura com a chave p√∫blica.  Se a assinatura estiver correta em rela√ß√£o √† transa√ß√£o, que est√° atualmente em verifica√ß√£o, porque a assinatura cobre parte da transa√ß√£o, consequentemente, voc√™ precisar√° obter o valor do hash de determinados campos dessa transa√ß√£o.  Isso √© definido por um byte separado da estrutura do tipo de hash, ou seja, um valor de hash √© obtido e alimentado na entrada de verifica√ß√£o de assinatura, juntamente com a pr√≥pria assinatura e a chave p√∫blica.  Se a verifica√ß√£o ocorrer corretamente, o resultado da verifica√ß√£o ser√° verdadeiro, esse valor ser√° colocado na pilha.  Isso completa a execu√ß√£o do script.  Os dados s√£o passados ‚Äã‚Äãpara a fun√ß√£o de chamada e verificados l√°.  Se a pilha for verdadeira, a verifica√ß√£o desta entrada de transa√ß√£o estava correta.  Se todas as entradas da transa√ß√£o foram verificadas corretamente, a transa√ß√£o inteira √© considerada correta. <br><br>  Aprendemos como o Bitcoin Script funciona para verificar as entradas e sa√≠das simples de uma transa√ß√£o.  Agora, falaremos sobre como a multisinatura √© organizada e como ela funciona ao usar o Bitcoin Script <br><br><h2>  P2SH </h2><br>  O BIP16 foi proposto uma vez, que define um novo conceito no protocolo Bitcoin - o chamado pagamento ao script hash (P2SH).  Esta √© uma oportunidade para definir as regras para gastar moedas que n√£o est√£o em um script aberto, onde voc√™ escreve operandos e alguns dados em uma linha, que s√£o executados da maneira que examinamos, mas na forma de um valor de hash do script que voc√™ precisa, ou seja, uma soma de verifica√ß√£o desses operandos.  Isso permitiu que a sa√≠da da transa√ß√£o estabelecesse condi√ß√µes grandes e complexas para gastar moedas, mas a sa√≠da em si permaneceu curta. <br><br>  Para gastar essas moedas nessas condi√ß√µes, na entrada da transa√ß√£o, √© necess√°rio especificar os dados que satisfazem esse script e o script inteiro para provar que voc√™ sabe quais condi√ß√µes foram definidas ao enviar moedas, para que o valor de hash do script de origem corresponda aos endere√ßos para os quais moedas foram enviadas.  Em outras palavras, prove que voc√™ conhece as condi√ß√µes e as satisfaz. <br><br>  Esta proposta para melhorar o Bitcoin foi aceita em 3 de janeiro de 2012.  De fato, o anivers√°rio do Bitcoin.  Agora, ele √© usado ativamente para implementar endere√ßos com v√°rias assinaturas. <br><br><h2>  Como o P2SH funciona? </h2><br>  Vejamos um exemplo de como isso funciona.  Para criar uma transa√ß√£o, precisamos entender conceitos como Resgatar script, Bloquear script e Desbloquear script. <br><br>  O Resgatar Script cont√©m as chaves p√∫blicas √†s quais o endere√ßo de multi-assinatura ser√° vinculado.  Nesse caso, estamos considerando uma combina√ß√£o de teclas "2-de-5".  Primeiro vem o valor 2, ou seja, indicamos que ser√£o necess√°rias 2 assinaturas, que ser√£o verificadas pelas chaves p√∫blicas correspondentes.  Isso √© seguido por chaves p√∫blicas, no nosso caso, existem 5. Em seguida, indicamos o valor 5, pois especificamos 5 chaves p√∫blicas e, quando os dados s√£o lidos na ordem inversa, esse valor √© necess√°rio para entender quantas chaves voc√™ precisa ler.  Depois disso, a multissassatura da verifica√ß√£o de opera√ß√£o √© indicada. <br><br>  Script de bloqueio - um script indicado na sa√≠da de uma transa√ß√£o que paga por um endere√ßo com v√°rias assinaturas.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui, a opera√ß√£o de obten√ß√£o de um valor de hash ser√° executada, com a qual j√° nos familiarizamos em detalhes. A seguir, o valor do hash Resgatar Script, que ocupa 20 bytes. Depois disso, √© executada uma opera√ß√£o para verificar se os dados correspondem ao valor do hash real. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desbloquear script √© uma concatena√ß√£o de scripts na entrada da transa√ß√£o com scripts na sa√≠da da transa√ß√£o que pagou para esse endere√ßo. Existem duas assinaturas necess√°rias para gastar moedas, e o Script Resgatar completo, que posteriormente ser√° hash e verificado quanto √† conformidade com o endere√ßo para o qual as moedas foram enviadas. Depois disso, o script ser√° executado por completo, inclusive para verificar a assinatura m√∫ltipla.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â importante que haja restri√ß√µes no tamanho m√°ximo para cada um dos scripts listados e isso seja 520 bytes. Esse n√∫mero foi calculado com base no fato de que Unlocking Script pode caber no m√°ximo 15 assinaturas e 15 chaves p√∫blicas correspondentes, al√©m de v√°rias opera√ß√µes para verificar esses valores. Foi assim que um determinado n√∫mero foi obtido, que, ao arredondar, deu 520 bytes. Deve-se dizer que esse n√∫mero foi obtido com a expectativa de que o endere√ßo de multi-assinatura do tipo ‚Äú15 de 15‚Äù seja um limite suficientemente razo√°vel para uso pr√°tico. Resgatar script ao usar um grande n√∫mero de assinaturas se torna muito grande em volume. O usu√°rio que usa o endere√ßo de v√°rias assinaturas ou outros endere√ßos P2SH, ao gastar moedas com eles, possui transa√ß√µes muito grandes. Isso significaque, para confirmar suas transa√ß√µes, ele ter√° que pagar grandes comiss√µes.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Benef√≠cios do P2SH </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consideraremos separadamente as vantagens do P2SH. </font><font style="vertical-align: inherit;">O primeiro √© que esses endere√ßos podem ser codificados na forma familiar usando o Base58, cujo comprimento √© de 34 caracteres. </font><font style="vertical-align: inherit;">De acordo com o BIP13, que define as regras para definir o byte da vers√£o para os endere√ßos Bitcoin codificados pelo Base58Check, o endere√ßo come√ßar√° com um triplo, ou seja, √© inserido um byte de vers√£o espec√≠fico. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como exemplo, voc√™ pode ver o endere√ßo P2SH. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3P14159f73E4gFr7JterCCQh9QjiTjiZrG</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este pode n√£o ser um endere√ßo de multi-assinatura. </font><font style="vertical-align: inherit;">O Resgatar script pode descrever n√£o apenas um endere√ßo com v√°rias assinaturas, mas tamb√©m outras regras complexas para gastar moedas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acrescentamos que essa n√£o √© a √∫nica maneira de organizar v√°rias assinaturas no Bitcoin. N√£o √© poss√≠vel usar o P2SH, mas na sa√≠da que pagar√° pelo endere√ßo de multisassinatura, n√£o pelo valor do hash do script, mas pelo pr√≥prio script, ou seja, listar todas as chaves p√∫blicas diretamente na sa√≠da e definir a opera√ß√£o como multisignatura. No entanto, quando voc√™ envia moedas para esse endere√ßo, divulga imediatamente as chaves p√∫blicas, pois elas ser√£o de dom√≠nio p√∫blico e, nesse momento, as moedas ser√£o armazenadas nelas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E outra desvantagem √© que o remetente de moedas no endere√ßo de v√°rias assinaturas possui uma grande transa√ß√£o, pela qual voc√™ ter√° que pagar uma grande comiss√£o. √â improv√°vel que o remetente queira pagar em excesso pelo fato de que o destinat√°rio deseja usar a multi-assinatura. O P2SH permite transferir custos de comiss√£o para o destinat√°rio. Se o destinat√°rio quiser aceitar moedas no endere√ßo de v√°rias assinaturas, ele pr√≥prio pagar√° grandes transa√ß√µes, o que √© uma abordagem mais justa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acrescentamos que o P2SH permite implementar diferentes combina√ß√µes dessa multisassinatura (2-de-2, 2-de-3 e outras). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquematicamente, considere enviar para um endere√ßo com v√°rias assinaturas.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a7/34a/285/7a734a285e901f5710c15b2b9e365354.png" alt="imagem"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponha que Alice queira pagar a Bob, que usa apenas endere√ßos com v√°rias assinaturas. Para fazer isso, Bob localmente em seu computador (a prop√≥sito, pode haver algum tipo de organiza√ß√£o em vez de Bob) gera v√°rias chaves privadas, recebe delas as chaves p√∫blicas correspondentes, que s√£o concatenadas de uma certa maneira. Na maioria das vezes, as chaves p√∫blicas s√£o primeiro codificadas com Base58Check e, em seguida, s√£o classificadas em ordem alfab√©tica e concatenadas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa abordagem compensa quando √© necess√°rio o rec√°lculo de chaves p√∫blicas de chaves pessoais. Eles precisam ser concatenados exatamente na mesma ordem, porque o pr√≥ximo passo √© criar um script de resgate e hash. Se exatamente as mesmas chaves entrarem no Resgatar Script, mas em uma ordem diferente, obteremos um valor de hash diferente e um endere√ßo diferente. Isso implicar√° certos mal-entendidos. Portanto, antes da concatena√ß√£o, as chaves p√∫blicas devem ser classificadas de acordo com alguma regra. E na maioria das vezes eles usam a classifica√ß√£o alfab√©tica no sistema de n√∫meros Base58.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o, Bob calculou o valor do hash em Resgatar script. Ele pode represent√°-lo como 20 bytes e envi√°-lo para Alice, dizendo que este √© um endere√ßo de multi-assinatura usando P2SH. No entanto, Bob pode codific√°-lo com um byte de vers√£o, como um endere√ßo comum, e apenas envi√°-lo para Alice. Alice entender√°, a partir do byte da vers√£o, que este √© um endere√ßo com v√°rias assinaturas, compor√° uma transa√ß√£o e preencher√° a sa√≠da de acordo para que Bob receba suas moedas. Em seguida, propaga a transa√ß√£o para a rede. Eles est√£o aguardando confirma√ß√£o e Bob aceita o pagamento de Alice. O Bob de substitui√ß√£o, por exemplo, fornece um servi√ßo ou transfere mercadorias.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chega um momento em que Bob quer gastar essas moedas. Deve-se entender que o Script Resgatar completo n√£o foi divulgado publicamente enquanto as moedas estavam em seu endere√ßo de v√°rias assinaturas. E at√© Alice n√£o viu exatamente quais chaves p√∫blicas foram usadas por Bob, quantas delas havia, etc. Ela n√£o sabe por que regras esse endere√ßo P2SH √© composto, endere√ßo com v√°rias assinaturas ou n√£o, etc. Consequentemente, ataques a eletr√¥nicos Uma assinatura digital (em uma curva el√≠ptica) ainda n√£o √© poss√≠vel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digamos que Bob queira enviar um pagamento para Eve.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c20/432/91c/c2043291cb2bb81e317e418b47c98645.png" alt="imagem"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ela gera um novo endere√ßo e o entrega a Bob. Ele cria uma transa√ß√£o em branco na entrada da qual indica a transa√ß√£o na qual recebeu moedas de Alice, e a sa√≠da √© o endere√ßo de Eva. Agora ele deve fornecer evid√™ncias de propriedade das moedas que gasta. Para fazer isso, ele pega duas de suas chaves privadas (mencionamos acima que seu endere√ßo de multi-assinatura implica a op√ß√£o "2 de 5"), a partir da qual ele calcula duas assinaturas para esta transa√ß√£o. Em seguida, ele pega o Script de resgate completo e o adiciona √† entrada da transa√ß√£o.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe que esse script de resgate deve ser armazenado inteiramente no computador de Bob ou ele deve se lembrar da ordem em que ele usou chaves p√∫blicas para compor esse script. Se ele aplicou certas regras de classifica√ß√£o, ele deve se lembrar delas. Ele tamb√©m deve se lembrar que um endere√ßo com v√°rias assinaturas est√° vinculado a determinadas chaves privadas. Sem esse conhecimento, Bob n√£o saberia em qual das suas chaves privadas operar e em que ordem elas deveriam ser usadas para obter o endere√ßo desejado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, ele tem duas assinaturas e um script Resgatar completo. A transa√ß√£o √© considerada correta e Bob a distribui na rede e aguarda confirma√ß√£o. Esta √© a principal coisa sobre gastar com um endere√ßo de v√°rias assinaturas.</font></font><br><br><h2>  Perguntas </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora chegamos √†s suas perguntas. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- √â poss√≠vel executar a mesma carteira simultaneamente em tr√™s computadores diferentes e iniciar a sincroniza√ß√£o?</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Provavelmente, estamos falando de algum tipo de n√≥ de rede: um n√≥ SPV ou um n√≥ completo. V√°rios computadores diferentes e a mesma carteira foram usados. E uma carteira significa chaves privadas. Existem v√°rios n√≥s completos que implementam a funcionalidade da carteira. Nesses n√≥s, inserimos as mesmas chaves privadas e iniciamos a sincroniza√ß√£o. Provavelmente, com a sincroniza√ß√£o completa com a rede, veremos o mesmo equil√≠brio em todas as carteiras que usam seu pr√≥prio n√≥. Se voc√™ vir altera√ß√µes em um n√≥, depois da sincroniza√ß√£o com a rede, ver√° exatamente as mesmas altera√ß√µes em todos os outros n√≥s. A transa√ß√£o n√£o √© mantida em segredo, √© distribu√≠da a todos os n√≥s que a verificam e exibem as altera√ß√µes correspondentes, se tratarem de seus endere√ßos. De fato, sim, voc√™ pode usar as mesmas chaves em v√°rios n√≥s,mas todas as transa√ß√µes tamb√©m ser√£o sincronizadas automaticamente. Bitcoins certamente n√£o dobrar√° com isso e, al√©m disso, n√£o triplicar√°.</font></font><br><br> <i>‚Äî  P2SH   Segregated Witness?</i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Testemunha Segregada √© uma estrutura de transa√ß√£o em que a evid√™ncia de propriedade das moedas √© transferida para uma estrutura separada, elas n√£o se enquadram na blockchain, mas ao validar transa√ß√µes, elas s√£o distribu√≠das juntas, ou seja, todos os validadores verificam a corre√ß√£o das transa√ß√µes em uma estrutura separada com prova. Depois que a transa√ß√£o √© confirmada, a evid√™ncia n√£o √© salva, pois n√£o faz sentido. Tamb√©m existem vantagens na constru√ß√£o dessas cadeias de transa√ß√µes nas quais certas moedas sem confirma√ß√£o real na transa√ß√£o atual j√° s√£o gastas na pr√≥xima constru√≠da com base em suas bases, mas elas n√£o s√£o distribu√≠das para a rede. Assim, formam-se cadeias de transa√ß√µes que n√£o divulgam evid√™ncias de propriedade de moedas. Isso facilita a transfer√™ncia de dados e adiciona privacidade. Um tipo diferente de endere√ßo foi usado para a Testemunha Segregada,cont√©m operandos ligeiramente diferentes. √â poss√≠vel enviar moedas armazenadas em endere√ßos regulares, incluindo endere√ßos P2SH, para endere√ßos P2SH de testemunha.</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Os endere√ßos dos tr√™s primeiros come√ßam na Rede de ilumina√ß√£o?</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O BIP13 define as regras pelas quais um byte de vers√£o √© selecionado para endere√ßos Bitcoin na rede de teste, outras moedas, etc. Sim, o Lighting Network usa endere√ßos de v√°rias assinaturas, que tamb√©m usam o m√©todo P2SH para definir condi√ß√µes. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Por que √© imposs√≠vel personalizar uma carteira, ou seja, amarr√°-la a uma pessoa espec√≠fica?</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bitcoin como protocolo de um sistema de pagamento n√£o requer identifica√ß√£o da identidade de uma carteira, porque funciona de acordo com as leis da matem√°tica, e a matem√°tica n√£o permite descrever uma pessoa como pessoa. Al√©m disso, este n√£o √© um pr√©-requisito para verificar transa√ß√µes. H√° assinatura digital suficiente. Quem pode gerar essas assinaturas √© o propriet√°rio - isso n√£o se aplica ao protocolo Bitcoin. Portanto, uma assinatura pode pertencer a uma pessoa, a um grupo de v√°rias pessoas, a um rob√¥ etc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quanto √† personaliza√ß√£o, se voc√™ estabelecer uma conex√£o entre um endere√ßo espec√≠fico e uma pessoa espec√≠fica, violar√° a privacidade e poder√° desarmar parte de uma rede com um certo grau de probabilidade. Em geral, o banco de dados est√° aberto, mas n√£o h√° dados de identidade.</font></font><br><br> <i>‚Äî    ,    70-80%,    ?</i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est√° bem escrito que esta √© uma moeda, n√£o uma criptomoeda, porque a criptomoeda funciona com os mesmos princ√≠pios do Bitcoin, ou seja, todos os processos s√£o maximamente descentralizados: emiss√£o, verifica√ß√£o de transa√ß√µes, armazenamento de dados, aceita√ß√£o de altera√ß√µes etc. Mas existem essas moedas , as chamaremos de moedas digitais, nas quais nem todos os processos listados s√£o descentralizados. Uma das op√ß√µes pode ser uma quest√£o centralizada, ou seja, n√£o existe minera√ß√£o, minera√ß√£o, ou seja, n√£o h√° solu√ß√£o para um problema complexo. De acordo com esse princ√≠pio, Ripple, Stellar, moeda digital NXT e Cardano funcionam. Outros princ√≠pios de distribui√ß√£o de moedas entre os usu√°rios foram aplicados l√°, por exemplo, por meio de OICs, prova de identidade, etc. Como nem todos os processos podem ser descentralizados e independentes, voc√™ n√£o pode nomear nenhuma moeda digital.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criptomoeda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Al√©m disso, a quest√£o da confian√ßa em uma moeda espec√≠fica √© de natureza pessoal. </font><font style="vertical-align: inherit;">Voc√™ decide a quantidade dessa confian√ßa. </font><font style="vertical-align: inherit;">√â necess√°rio levar em considera√ß√£o os objetivos para os quais a moeda √© usada, bem como seus riscos e limita√ß√µes.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt415757/">https://habr.com/ru/post/pt415757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt415745/index.html">Dos leil√µes √†s can√ß√µes de ninar: como e onde a voz humana ‚Äúfunciona‚Äù</a></li>
<li><a href="../pt415747/index.html">Arist√≥teles estava certo. As pessoas n√£o precisam de vida eterna e felicidade absoluta</a></li>
<li><a href="../pt415749/index.html">Como aprender uma l√≠ngua estrangeira sem professor. Parte 2. "Estrat√©gia baseada em turnos"</a></li>
<li><a href="../pt415753/index.html">Navegador corajoso integra-se ao Tor</a></li>
<li><a href="../pt415755/index.html">Derivados de blockchain: resolvendo o problema por US $ 500 trilh√µes e ganhando o hackathon Consensus 2018</a></li>
<li><a href="../pt415759/index.html">A NSA come√ßou a excluir os metadados que foram registrados devido a uma "falha"</a></li>
<li><a href="../pt415761/index.html">O que, como e por que nos an√∫ncios reproduz√≠veis</a></li>
<li><a href="../pt415763/index.html">O governo dos EUA est√° discutindo a possibilidade de recuperar o controle da IANA [mas isso √© improv√°vel]</a></li>
<li><a href="../pt415765/index.html">Por que a VMware decidiu criar uma plataforma para o desenvolvimento de blockchains corporativos</a></li>
<li><a href="../pt415767/index.html">A Tesla Inc abriu a possibilidade de solicitar um Tesla Model 3 para residentes no Canad√° e nos Estados Unidos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>