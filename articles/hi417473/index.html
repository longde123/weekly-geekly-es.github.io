<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯТа ЁЯХ│я╕П ЁЯСйтАНтЬИя╕П DRBD9 рдФрд░ Proxmox рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рднрдВрдбрд╛рд░рдг (рднрд╛рдЧ 1: NFS) ЁЯТ╕ тШоя╕П ЁЯЫ┤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рдВрднрд╡рддрдГ рд╣рд░ рдХреЛрдИ рдЬреЛ рдХрдо-рд╕реЗ-рдХрдо рдПрдХ рдмрд╛рд░ рдЙрдЪреНрдЪ-рдкреНрд░рджрд░реНрд╢рди рд╕реЙрдлреНрдЯрд╡реЗрдпрд░-рдбрд┐рдлрд╛рдЗрдВрдб рд╕реНрдЯреЛрд░реЗрдЬ рдХреА рдЦреЛрдЬ рд╕реЗ рд╣реИрд░рд╛рди рдерд╛ рдпрд╛ рдмрд╛рдж рдореЗрдВ DRBD рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реБрдирд╛, рдпрд╛ рд╢рд╛рдпрдж рдЗрд╕рд╕реЗ рдирд┐рдкрдЯрд╛ред 


 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DRBD9 рдФрд░ Proxmox рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рднрдВрдбрд╛рд░рдг (рднрд╛рдЧ 1: NFS)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417473/"><p><img src="https://habrastorage.org/getpro/habr/post_images/f6a/771/043/f6a7710433c8887d6bbbe4792cc178e1.jpg" alt="рдЫрд╡рд┐"></p><br><p>  рд╕рдВрднрд╡рддрдГ рд╣рд░ рдХреЛрдИ рдЬреЛ рдХрдо-рд╕реЗ-рдХрдо рдПрдХ рдмрд╛рд░ рдЙрдЪреНрдЪ-рдкреНрд░рджрд░реНрд╢рди <strong>рд╕реЙрдлреНрдЯрд╡реЗрдпрд░-рдбрд┐рдлрд╛рдЗрдВрдб рд╕реНрдЯреЛрд░реЗрдЬ</strong> рдХреА рдЦреЛрдЬ рд╕реЗ рд╣реИрд░рд╛рди рдерд╛ рдпрд╛ рдмрд╛рдж рдореЗрдВ <strong>DRBD рдХреЗ</strong> рдмрд╛рд░реЗ рдореЗрдВ рд╕реБрдирд╛, рдпрд╛ рд╢рд╛рдпрдж рдЗрд╕рд╕реЗ рдирд┐рдкрдЯрд╛ред </p><br><p> рд╕рдЪ рд╣реИ, <strong>рд╕рд┐рдл</strong> рдФрд░ <strong>рдЧреНрд▓рд╕реНрдЯрд░рдПрдлрдПрд╕</strong> рдХреА рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛ рдХреЗ рдЪрд░рдо рдкрд░, рдЬреЛ рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ рдмрд╣реБрдд рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдмреЙрдХреНрд╕ рдХреЗ рдмрд╛рд╣рд░, рд╣рд░ рдХреЛрдИ рдмрд╕ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ рднреВрд▓ рдЧрдпрд╛ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкрд┐рдЫрд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдиреЗ рджреЛ рд╕реЗ рдЕрдзрд┐рдХ рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рдХреГрддрд┐ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдерд╛, рдФрд░ рдЗрд╕ рд╡рдЬрд╣ рд╕реЗ, <strong>рд╡рд┐рднрд╛рдЬрди-рдорд╕реНрддрд┐рд╖реНрдХ рдХреЗ</strong> рд╕рд╛рде рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рдЕрдХреНрд╕рд░ рд╕рд╛рдордирд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЗрд╕рдХреА рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛ рдореЗрдВ рдирд╣реАрдВ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдерд╛ред </p><br><p>  рд╕рдорд╛рдзрд╛рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдирдпрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдХрд╛рдлреА рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзреА рд╣реИред  CPU рдФрд░ RAM рдХреЗ рд▓рд┐рдП рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдХрдо рд▓рд╛рдЧрдд рдХреЗ рд╕рд╛рде, <strong>DRBD</strong> <strong>рдмреНрд▓реЙрдХ рдбрд┐рд╡рд╛рдЗрд╕</strong> рд╕реНрддрд░ рдкрд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рддреЗрдЬ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рд╕рдордп рдХреЗ рджреМрд░рд╛рди, LINBIT - DRBD рдбреЗрд╡рд▓рдкрд░реНрд╕ рд╕реНрдерд┐рд░ рдирд╣реАрдВ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рд▓рдЧрд╛рддрд╛рд░ рдкрд░рд┐рд╖реНрдХреГрдд рдХрд░рддреЗ рд╣реИрдВред  <strong>DRBD9</strong> рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рд╢реБрд░реВ, <strong>рдпрд╣</strong> рд╕рд┐рд░реНрдл рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рджрд░реНрдкрдг рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдХреБрдЫ рдФрд░ рдмрди рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХрдИ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХрд▓ <strong>рд╡рд┐рддрд░рд┐рдд рдмреНрд▓реЙрдХ рдбрд┐рд╡рд╛рдЗрд╕</strong> рдмрдирд╛рдиреЗ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рдкреГрд╖реНрдарднреВрдорд┐ рдореЗрдВ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рд╣реЛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдЕрдм LINBIT <strong>LVM</strong> рдФрд░ <strong>ZFS рд╡рд┐рднрд╛рдЬрди рдХреЗ</strong> рд╢реАрд░реНрд╖ рдкрд░ рдмрдирд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдХрдИ рдбреНрд░рдм рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИред </p><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, DRBD9 32 рд░реЗрдкреНрд▓рд┐рдХрд╛, RDMA, рдбрд┐рд╕реНрдХрд▓реЗрд╕ рдиреЛрдбреНрд╕ рдФрд░ рдирдП рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди рдЯреВрд▓ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рд╕реНрдиреИрдкрд╢реЙрдЯ, рдСрдирд▓рд╛рдЗрди рдорд╛рдЗрдЧреНрд░реЗрд╢рди рдФрд░ рдмрд╣реБрдд рдХреБрдЫ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><p>  рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ <strong>DRBD9</strong> рдореЗрдВ <strong>Proxmox</strong> , <strong>Kubernetes</strong> , <strong>OpenStack</strong> рдФрд░ <strong>OpenNebula рдХреЗ</strong> рд╕рд╛рде рдПрдХреАрдХрд░рдг рдЙрдкрдХрд░рдг рд╣реИрдВ, рдлрд┐рд▓рд╣рд╛рд▓ рд╡реЗ рдХреБрдЫ рд╕рдВрдХреНрд░рдордгрдХрд╛рд▓реАрди рдореЛрдб рдореЗрдВ рд╣реИрдВ, рдЬрдм рдирдП рдЙрдкрдХрд░рдг рдЕрднреА рддрдХ рд╣рд░ рдЬрдЧрд╣ рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИрдВ, рдФрд░ рдмрд╣реБрдд рдЬрд▓реНрдж рдкреБрд░рд╛рдиреЗ рдШреЛрд╖рд┐рдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред  рдпреЗ <strong>DRBDmanage</strong> рдФрд░ <strong>Linstor рд╣реИрдВ</strong> ред </p><br><p>  рдореИрдВ рдЗрд╕ рдХреНрд╖рдг рдХрд╛ рд▓рд╛рдн <strong>рдЙрдард╛рдКрдВрдЧрд╛</strong> рдХрд┐ рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд╡рд┐рд╡рд░рдг рдореЗрдВ рди рдЬрд╛рдКрдВ, рд▓реЗрдХрд┐рди <strong>DRBD9 рдХреЗ</strong> рд╕рд╛рде рдХрд╛рдо рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдФрд░ рд╕рд┐рджреНрдзрд╛рдВрддреЛрдВ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ <strong>рдЬрд╛рдВрдЪрдиреЗ</strong> рдХреЗ рд▓рд┐рдПред <a name="habracut"></a>  рдЖрдкрдХреЛ рдЕрднреА рднреА рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рд╣реИ, рдпрджрд┐ рдХреЗрд╡рд▓ рдЗрд╕рд▓рд┐рдП рдХрд┐ рд▓рд┐рдиреНрд╕реНрдЯрд░ рдирд┐рдпрдВрддреНрд░рдХ рдХрд╛ рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ рд╡рд┐рдиреНрдпрд╛рд╕ рдЗрди рдЙрдкрдХрд░рдгреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдкрд░ рдЗрд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдЕрд░реНрде рд╣реИред </p><br><p>  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рдореИрдВ рдЖрдкрдХреЛ <strong>DRBD9</strong> рдФрд░ рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рдкреНрд▓рдЧ-рдЗрди рдХреЗ рдмрд┐рдирд╛ <strong>Proxmox</strong> рдореЗрдВ рдЗрд╕рдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рдирд╛ <strong>рдЪрд╛рд╣реВрдВрдЧрд╛</strong> ред </p><br><h2 id="drbdmanage-i-linstor">  DRBDmanage рдФрд░ Linstor </h2><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ <strong>DRBDmanage рдХреЗ</strong> рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдмрд╛рд░ рдлрд┐рд░ рдзреНрдпрд╛рди рджреЗрдиреЗ <strong>рдпреЛрдЧреНрдп рд╣реИ</strong> , рдЬреЛ рдХрд┐ <strong>рдкреНрд░реЙрдХреНрд╕рдореЙрдХреНрд╕ рдореЗрдВ</strong> рдмрд╣реБрдд рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдПрдХреАрдХреГрдд рд╣реИред  LINBIT Proxmox рдХреЗ рд▓рд┐рдП рдПрдХ рд░реЗрдбреАрдореЗрдб DRBDmanage рдкреНрд▓рдЧрдЗрди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реАрдзреЗ <strong>Proxmox</strong> рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><p>  рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ рдЗрд╕рдХреЗ рдХреБрдЫ рдиреБрдХрд╕рд╛рди рд╣реИрдВред </p><br><ul><li> рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЯреИрдЧ рдХрд┐рдП рдЧрдП рд╡реЙрд▓реНрдпреВрдо рдирд╛рдо, <strong>LVM рд╕рдореВрд╣</strong> рдпрд╛ <strong>ZFS рдкреВрд▓</strong> рдХреЛ <code>drbdpool</code> рдирд╛рдо рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </li><li>  рдкреНрд░рддрд┐ рдиреЛрдб <strong>рдПрдХ</strong> рд╕реЗ рдЕрдзрд┐рдХ рдкреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрдерддрд╛ </li><li>  рд╕рдорд╛рдзрд╛рди рдХреА рдмрд╛рд░реАрдХрд┐рдпреЛрдВ рдХреЗ рдХрд╛рд░рдг, <strong>рдирд┐рдпрдВрддреНрд░рдХ рд╡реЙрд▓реНрдпреВрдо</strong> рдХреЗрд╡рд▓ рдПрдХ рдирд┐рдпрдорд┐рдд рдПрд▓рд╡реАрдПрдо рдкрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЕрдиреНрдпрдерд╛ рдирд╣реАрдВ </li><li>  рдкреАрд░рд┐рдпреЛрдбрд┐рдХ <strong>рдбрдмрд╕</strong> рдЧреНрд▓рд┐рдЪ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ <strong>рдбреАрдЖрд░рдмреАрдбреИрдиреЗрдЬ</strong> рджреНрд╡рд╛рд░рд╛ рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рд░реАрдХреА рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li></ul><br><p>  рдирддреАрдЬрддрди, LINBIT рдиреЗ рдПрдХ рдЬрдЯрд┐рд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рд╕рднреА DRBDmanage рд▓реЙрдЬрд┐рдХ рдХреЛ рдмрджрд▓рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рдЬреЛ рдПрдХ рдирд┐рдпрдорд┐рдд <strong>tcp рдХрдиреЗрдХреНрд╢рди</strong> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдЬрд╛рджреВ рдХреЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рддреЛ <strong>рд▓рд┐рдиреНрд╕реНрдЯрд░</strong> рдерд╛ред </p><br><p>  <strong>Linstor</strong> рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдмрд╣реБрдд рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдбреЗрд╡рд▓рдкрд░реНрд╕ рдиреЗ рд▓рд┐рдирд╕реНрдЯреЛрд░-рд╕рд░реНрд╡рд░ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП <strong>рдЬрд╛рд╡рд╛</strong> рдХреЛ рдореБрдЦреНрдп рднрд╛рд╖рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЪреБрдирд╛, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдпрд╣ рдбрд░рд╛рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд▓рд┐рдирд╕реНрдЯреЛрд░ рд╕реНрд╡рдпрдВ рдХреЗрд╡рд▓ рдбреАрдЖрд░рдмреАрдбреА <strong>рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди</strong> рдХреЛ <strong>рд╡рд┐рддрд░рд┐рдд</strong> <strong>рдХрд░рдиреЗ</strong> рдФрд░ рдиреЛрдбреНрд╕ рдкрд░ LVM / ZFS рд╡рд┐рднрд╛рдЬрди рдХреЛ рд╕реНрд▓рд╛рдЗрд╕ рдХрд░рдиреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред </p><br><blockquote>  рджреЛрдиреЛрдВ рд╕рдорд╛рдзрд╛рди рдореБрдлреНрдд рд╣реИрдВ рдФрд░ рдореБрдлреНрдд <strong>GPL3</strong> рд▓рд╛рдЗрд╕реЗрдВрд╕ рдХреЗ рддрд╣рдд рд╡рд┐рддрд░рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ <strong>ред</strong> </blockquote><p>  рдЖрдк рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдкреНрд░реЙрдХреНрд╕реАреЙрдХреНрд╕ рд╡рд┐рдХреА</a> рдкрд░ <strong>рдкреНрд░реЙрдХреНрд╕реА рдХреЗ</strong> рд▓рд┐рдП рдкреВрд░реНрд╡реЛрдХреНрдд рдкреНрд▓рдЧ-рдЗрди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ </p><br><h2 id="otkazoustoychivyy-nfs-server">  рд╡рд┐рдлрд▓рддрд╛ NFS рд╕рд░реНрд╡рд░ </h2><br><p>  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рд▓реЗрдЦрди рдХреЗ рд╕рдордп, <strong>рд▓рд┐рдирд╕реНрдЯреЛрд░ рдХрд╛ рдХреЗрд╡рд▓</strong> <strong>рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ</strong> рд╕рд╛рде рдПрдХреАрдХрд░рдг рд╣реИред  рд▓реЗрдХрд┐рди рд╕рд╛рд▓ рдХреЗ рдЕрдВрдд рдореЗрдВ, рдбреНрд░рд╛рдЗрд╡рд░реЛрдВ рдХреЛ рдмрд╛рдХреА <strong>рдкреНрд░реЙрдХреНрд╕рдореЛрдХреНрд╕</strong> , <strong>рдУрдкрдирдиреЗрдмреНрдпреБрд▓рд╛</strong> , <strong>рдУрдкрдирд╕реНрдЯреИрдХ</strong> рд╕рд┐рд╕реНрдЯрдо рдХреА рдЙрдореНрдореАрдж рд╣реИред </p><br><p>  рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рдХреЛрдИ рддреИрдпрд╛рд░ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдкреБрд░рд╛рдиреЗ рддрд░реАрдХреЗ рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рддрд░рд╣ рд╕реЗ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдЖрдЗрдП рд╕рд╛рдЭрд╛ рд╡рд┐рднрд╛рдЬрди рдХреЗ рд▓рд┐рдП <strong>рдПрдирдПрдлрдПрд╕ рдкрд╣реБрдВрдЪ</strong> рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрд░рд╛рдиреЗ рдврдВрдЧ рд╕реЗ DRBD9 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред </p><br><p>  рдлрд┐рд░ рднреА, рдпрд╣ рд╕рдорд╛рдзрд╛рди рднреА рдлрд╛рдпрджреЗ рдХреЗ рдмрд┐рдирд╛ рд╕рд╛рдмрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдПрдирдПрдлрдПрд╕ рд╕рд░реНрд╡рд░ рдЖрдкрдХреЛ рдбреАрдПрд▓рдПрдо рдХреЗ рд╕рд╛рде рдЬрдЯрд┐рд▓ рдХреНрд▓рд╕реНрдЯрд░ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ рдХрдИ рд╕рд░реНрд╡рд░реЛрдВ рд╕реЗ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреА рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдгрд╛рд▓реА рдХреЗ рд▓рд┐рдП <strong>рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзреА рдПрдХреНрд╕реЗрд╕</strong> рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛, рдЬреИрд╕реЗ рдХрд┐ рдУрд╕реАрдПрдлрдПрд╕ рдФрд░ рдЬреАрдИ 2ред </p><br><p>  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрдк рдХреЗрд╡рд▓ Proxmox рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдореЗрдВ NFS рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдХрдВрдЯреЗрдирд░ рдХреЛ рдорд╛рдЗрдЧреНрд░реЗрдЯ рдХрд░рдХреЗ <strong>рдкреНрд░рд╛рдердорд┐рдХ</strong> / <strong>рджреНрд╡рд┐рддреАрдпрдХ</strong> рдиреЛрдб рдХреА рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗред </p><br><p>  рдЖрдк рдЗрд╕ рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рднреА рдлрд╛рдЗрд▓ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рд╛рде рд╣реА рд╡рд░реНрдЪреБрдЕрд▓ рдбрд┐рд╕реНрдХ рдФрд░ рдмреИрдХрдЕрдк рднреА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдпрджрд┐ рдЖрдк <strong>Kubernetes рдХрд╛</strong> рдЙрдкрдпреЛрдЧ <strong>рдХрд░рддреЗ рд╣реИрдВ</strong> рддреЛ рдЖрдк рдЕрдкрдиреЗ <strong>PersVVVumes рдХреЗ</strong> рд▓рд┐рдП <strong>ReadWriteMany</strong> рдПрдХреНрд╕реЗрд╕ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗред </p><br><h2 id="proxmox-i-lxc-konteynery">  рдкреНрд░реЙрдХреНрд╕реЙрдХреНрд╕ рдФрд░ рдПрд▓рдПрдХреНрд╕рд╕реА рдХрдВрдЯреЗрдирд░ </h2><br><p>  рдЕрдм рд╕рд╡рд╛рд▓ рдпрд╣ рд╣реИ: рдХреНрдпреЛрдВ рдкреНрд░реЙрдХреНрд╕рдореЙрдХреНрд╕? </p><br><p>  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдРрд╕реА рдпреЛрдЬрдирд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ рдкреНрд░рдмрдВрдзрдХ рдХреЗ рд╕рд╛рде рд╕рд╛рдорд╛рдиреНрдп рдпреЛрдЬрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди <strong>Proxmox</strong> рдПрдХ рддреИрдпрд╛рд░-рдирд┐рд░реНрдорд┐рдд, рдмрд╣реБрдд рдмрд╣реБрдЖрдпрд╛рдореА рдФрд░ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдЖрдкрдХреЛ рдЖрд╡рд╢реНрдпрдХ рд╕рднреА рдЪреАрдЬрд╝реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд░рд▓ рдФрд░ рд╕рд╣рдЬ рдЬреНрдЮрд╛рди рдпреБрдХреНрдд рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдпрд╣ <strong>рдХреНрд▓рд╕реНрдЯрд░рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП</strong> рд╕рдХреНрд╖рдо рдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ <strong>рд╣реИ</strong> рдФрд░ рд╕реЙрдлрдЯреЙрдЧ рдкрд░ рдЖрдзрд╛рд░рд┐рдд <strong>рдмрд╛рдбрд╝</strong> рддрдВрддреНрд░ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред  рдФрд░ рдЬрдм <strong>рдПрд▓рдПрдХреНрд╕рд╕реА рдХрдВрдЯреЗрдирд░реЛрдВ</strong> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ <strong>, рддреЛ</strong> рдпрд╣ рдЖрдкрдХреЛ рд╕реНрд╡рд┐рдЪрд┐рдВрдЧ рдХреЗ рджреМрд░рд╛рди рдиреНрдпреВрдирддрдо рдЯрд╛рдЗрдордЖрдЙрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред <br>  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рд╕рдорд╛рдзрд╛рди <strong>рдореЗрдВ рд╡рд┐рдлрд▓рддрд╛ рдХрд╛</strong> рдПрдХ рднреА <strong>рдмрд┐рдВрджреБ</strong> рдирд╣реАрдВ рд╣реЛрдЧрд╛ред </p><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдо рдкреНрд░реЙрдХреНрд╕рдореЛрдХреНрд╕ рдХреЛ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ <strong>рдХреНрд▓рд╕реНрдЯрд░-рдореИрдиреЗрдЬрд░ рдХреЗ</strong> рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдЬрд╣рд╛рдВ рд╣рдо рдПрдХ рдЕрд▓рдЧ <strong>рдПрд▓рдПрдХреНрд╕рд╕реА рдХрдВрдЯреЗрдирд░</strong> рдХреЛ рдХреНрд▓рд╛рд╕рд┐рдХ рд╣рд╛ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЪрд▓рдиреЗ рд╡рд╛рд▓реА рд╕реЗрд╡рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ, рдХреЗрд╡рд▓ рдЗрд╕ рдЕрдВрддрд░ рдХреЗ рд╕рд╛рде рдХрд┐ рдХрдВрдЯреЗрдирд░ рднреА рдЕрдкрдиреЗ <strong>рд░реВрдЯ рд╕рд┐рд╕реНрдЯрдо рдХреЗ</strong> рд╕рд╛рде рдЖрддрд╛ <strong>рд╣реИ</strong> ред  рдпрд╣реА рд╣реИ, рдЖрдкрдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рддреНрдпреЗрдХ рд╕рд░реНрд╡рд░ рдкрд░ рдХрдИ рд╕реЗрд╡рд╛ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЖрдк рдХреЗрд╡рд▓ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдмрд╛рд░ рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br>  рдпрджрд┐ рдЖрдкрдиреЗ рдХрднреА <strong>рдХреНрд▓рд╕реНрдЯрд░-рдореИрдиреЗрдЬрд░ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЗ</strong> рд╕рд╛рде рдХрд╛рдо рдХрд┐рдпрд╛ рд╣реИ рдФрд░ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП <strong>HA</strong> рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдк рд╕рдордЭреЗрдВрдЧреЗ рдХрд┐ рдореЗрд░рд╛ рдХреНрдпрд╛ рдорддрд▓рдм рд╣реИред </p><br><h2 id="obschaya-shema">  рд╕рд╛рдорд╛рдиреНрдп рдпреЛрдЬрдирд╛ </h2><br><p>  рд╣рдорд╛рд░рд╛ рд╕рдорд╛рдзрд╛рди рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреА рдорд╛рдирдХ рдкреНрд░рддрд┐рдХреГрддрд┐ рдпреЛрдЬрдирд╛ рдЬреИрд╕рд╛ рд╣реЛрдЧрд╛ред </p><br><ul><li>  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ <strong>рддреАрди рдиреЛрдб рд╣реИрдВ</strong> </li><li>  рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдореЗрдВ рдПрдХ рд╡рд┐рддрд░рд┐рдд <strong>рдбреНрд░рдм рдбрд┐рд╡рд╛рдЗрд╕ рд╣реИ</strong> ред </li><li>  рдбрд┐рд╡рд╛рдЗрд╕ рдореЗрдВ рдПрдХ рдирд┐рдпрдорд┐рдд рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╣реИ ( <strong>ext4</strong> ) </li><li>  рдХреЗрд╡рд▓ рдПрдХ рд╕рд░реНрд╡рд░ <strong>рдорд╛рд╕реНрдЯрд░</strong> рд╣реЛ рд╕рдХрддрд╛ рд╣реИ </li><li>  <strong>рдПрд▓рдПрдХреНрд╕рд╕реА рдХрдВрдЯреЗрдирд░</strong> рдореЗрдВ <strong>рдПрдирдПрдлрдПрд╕ рд╕рд░реНрд╡рд░</strong> рдХреЛ рд╡рд┐рдЬрд╝рд╛рд░реНрдб рдкрд░ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </li><li>  рд╕рднреА рдиреЛрдбреНрд╕ <strong>рдПрдирдПрдлрдПрд╕ рдХреЗ</strong> рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рд╕рдЦреНрддреА рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рддреЗ рд╣реИрдВ <strong>ред</strong> </li><li>  рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рд╡рд┐рдЬрд╝рд╛рд░реНрдб <strong>NFS рд╕рд░реНрд╡рд░</strong> рдХреЗ рд╕рд╛рде рдЕрдиреНрдп рдиреЛрдб рдореЗрдВ рдЬрд╛ рд╕рдХрддрд╛ <strong>рд╣реИ</strong> </li></ul><br><p>  <strong>DRBD9</strong> рдореЗрдВ рдПрдХ рдмрд╣реБрдд рд╣реА рдЕрдЪреНрдЫреА рд╕реБрд╡рд┐рдзрд╛ рд╣реИ рдЬреЛ рд╣рд░ рдЪреАрдЬ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддреА рд╣реИ: <br>  рдбреНрд░рдм-рдбрд┐рд╡рд╛рдЗрд╕ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрд╕ рд╕рдордп <strong>рдкреНрд░рд╛рдердорд┐рдХ</strong> рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рдпрд╣ рдХреБрдЫ рдиреЛрдб рдкрд░ рдЖрд░реЛрд╣рд┐рдд рд╣реЛрддрд╛ рд╣реИред  рдпрджрд┐ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ <strong>рдкреНрд░рд╛рдердорд┐рдХ</strong> рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдиреЛрдб рдкрд░ рдЗрд╕реЗ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХреЗ рдХрд┐рд╕реА рднреА рдкреНрд░рдпрд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рддреНрд░реБрдЯрд┐ рдореЗрдВ рд╣реЛрдЧрд╛ред  рдпрд╣ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдПрдХ рд╕рд╛рде рдкрд╣реБрдВрдЪ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЕрд╡рд░реБрджреНрдз рдФрд░ рдЧрд╛рд░рдВрдЯреАрдХреГрдд рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдпрд╣ рд╕рдм рдмрд╣реБрдд рд╕рд░рд▓ рдХреНрдпреЛрдВ рд╣реИ?  рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдХрдВрдЯреЗрдирд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ <strong>Proxmox</strong> рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЗрд╕ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЗрд╕ рдиреЛрдб рдкрд░ <strong>рдкреНрд░рд╛рдердорд┐рдХ</strong> рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЬрдм рдХрдВрдЯреЗрдирд░ рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд unmounts рдФрд░ рдбрд┐рд╡рд╛рдЗрд╕ рдлрд┐рд░ рд╕реЗ <strong>рджреНрд╡рд┐рддреАрдпрдХ</strong> рдмрди рдЬрд╛рддрд╛ рд╣реИред <br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдореЗрдВ рдЕрдм <strong>рдкреНрд░рд╛рдердорд┐рдХ</strong> / <strong>рдорд╛рдзреНрдпрдорд┐рдХ</strong> рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, Proxmox рдЗрд╕реЗ <strong>рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ</strong> , рд╣реБрд░реНрд░реЗ <strong>рдХрд░реЗрдЧрд╛</strong> ! </p><br><h2 id="nastroyka-drbd">  DRBD рд╕реЗрдЯрдЕрдк </h2><br><p>  рдареАрдХ рд╣реИ, рд╣рдордиреЗ рдЗрд╕ рд╡рд┐рдЪрд╛рд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд▓рд┐рдпрд╛ рд╣реИред рдЕрдм рдЪрд▓рд┐рдП рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВред </p><br><p>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, <strong>рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓</strong> <strong>рдореЙрдбреНрдпреВрд▓</strong> <strong>рдХреЗ рд╕рд╛рде</strong> рдмрдВрдбрд▓ <strong>рдЖрдард╡реЗрдВ рд╕рдВрд╕реНрдХрд░рдг рдХреЗрдбрдВрдк</strong> рдЖрддрд╛ <strong>рд╣реИ,</strong> рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ рдпрд╣ рд╣рдореЗрдВ <strong>рд╕реВрдЯ рдирд╣реАрдВ рд╣реИ</strong> рдФрд░ рд╣рдо рдореЙрдбреНрдпреВрд▓ рдХреЗ рдиреМрд╡реЗрдВ рд╕рдВрд╕реНрдХрд░рдг рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </p><br><p>  LINBIT рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ рдФрд░ рдЕрдкрдиреА рдЬрд╝рд░реВрд░рдд рдХреА рд╣рд░ рдЪреАрдЬрд╝ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ: </p><br><pre> <code class="bash hljs">wget -O- https://packages.linbit.com/package-signing-pubkey.asc | apt-key add - <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"deb http://packages.linbit.com/proxmox/ proxmox-5 drbd-9.0"</span></span> \ &gt; /etc/apt/sources.list.d/linbit.list apt-get update &amp;&amp; apt-get -y install pve-headers drbd-dkms drbd-utils drbdtop</code> </pre> <br><ul><li>  <code>pve-headers</code> - рдореЙрдбреНрдпреВрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ рд╣реЗрдбрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ </li><li>  <code>drbd-dkms</code> - <code>drbd-dkms</code> рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓ </li><li>  <code>drbd-utils</code> - рдореВрд▓ DRBD рдкреНрд░рдмрдВрдзрди рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ </li><li>  <code>drbdtop</code> рдХреЗрд╡рд▓ <code>drbdtop</code> рд▓рд┐рдП рд╢реАрд░реНрд╖ рдЬреИрд╕рд╛ рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рдЙрдкрдХрд░рдг рд╣реИ </li></ul><br><p>  <strong>рдореЙрдбреНрдпреВрд▓ рдХреЛ</strong> рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж <strong>, рд╣рдо</strong> рдЬрд╛рдВрдЪ <strong>рдХрд░реЗрдВрдЧреЗ</strong> рдХрд┐ рдХреНрдпрд╛ рд╕рдм рдХреБрдЫ рдЗрд╕рдХреЗ рдХреНрд░рдо рдореЗрдВ рд╣реИ: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># modprobe drbd # cat /proc/drbd version: 9.0.14-1 (api:2/proto:86-113)</span></span></code> </pre> <br><p>  рдпрджрд┐ рдЖрдк рдХрдорд╛рдВрдб рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ <strong>рдЖрдард╡рд╛рдВ рд╕рдВрд╕реНрдХрд░рдг</strong> рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдХреБрдЫ рдЧрд▓рдд рд╣реЛ рдЧрдпрд╛ рдФрд░ <strong>рдЗрди-рдЯреНрд░реА</strong> рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓ рд▓реЛрдб рд╣реЛ рдЧрдпрд╛ рд╣реИред  рдХрд╛рд░рдг рдХреНрдпрд╛ рд╣реИ, рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ <code>dkms status</code> рдЬрд╛рдБрдЪ рдХрд░реЗрдВред </p><br><p>  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдореЗрдВ рдирд┐рдпрдорд┐рдд рд╡рд┐рднрд╛рдЬрди рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ рд╣реА <strong>рдбреНрд░рдм-рдбрд┐рд╡рд╛рдЗрд╕ рд╣реЛрдЧрд╛</strong> ред  рдкрд╣рд▓реЗ рд╣рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдкрд░ рдЗрд╕ рдЕрдиреБрднрд╛рдЧ рдХреЛ рдбреНрд░рдм рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рдРрд╕рд╛ рд╡рд┐рднрд╛рдЬрди рдХрд┐рд╕реА рднреА <strong>рдмреНрд▓реЙрдХ рдбрд┐рд╡рд╛рдЗрд╕</strong> рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ lvm, zvol, рдПрдХ рдбрд┐рд╕реНрдХ рд╡рд┐рднрд╛рдЬрди рдпрд╛ рд╕рдВрдкреВрд░реНрдг рдбрд┐рд╕реНрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдореИрдВ рдПрдХ рдЕрд▓рдЧ nvme рдбрд┐рд╕реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдБрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рд╡рд┐рднрд╛рдЬрди рдХреЗ рддрд╣рдд <code>/dev/nvme1n1p1</code> : <code>/dev/nvme1n1p1</code> </p><br><p>  рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рдирд╛рдо рдХрднреА-рдХрднреА рдмрджрд▓ рдЬрд╛рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдирд┐рд░рдВрддрд░ рд╕рд┐рдорд▓рд┐рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрджрдд рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕реЗ рддреБрд░рдВрдд рд▓реЗрдирд╛ рдмреЗрд╣рддрд░ рд╣реИред </p><br><p>  рдЖрдк рдЗрд╕ рддрд░рд╣ рдХреЗ рд▓рд┐рдП <code>/dev/nvme1n1p1</code> рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдХ рд╕рд┐рдорд▓рд┐рдВрдХ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># find /dev/disk/ -lname '*/nvme1n1p1' /dev/disk/by-partuuid/847b9713-8c00-48a1-8dff-f84c328b9da2 /dev/disk/by-path/pci-0000:0e:00.0-nvme-1-part1 /dev/disk/by-id/nvme-eui.0000000001000000e4d25c33da9f4d01-part1 /dev/disk/by-id/nvme-INTEL_SSDPEKKA010T7_BTPY703505FB1P0H-part1</span></span></code> </pre> <br><p>  рд╣рдо рддреАрдиреЛрдВ рдиреЛрдбреНрд╕ рдкрд░ рдЕрдкрдиреЗ рд╕рдВрд╕рд╛рдзрди рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cat /etc/drbd.d/nfs1.res resource nfs1 { meta-disk internal; device /dev/drbd100; protocol C; net { after-sb-0pri discard-zero-changes; after-sb-1pri discard-secondary; after-sb-2pri disconnect; } on pve1 { address 192.168.2.11:7000; disk /dev/disk/by-partuuid/95e7eabb-436e-4585-94ea-961ceac936f7; node-id 0; } on pve2 { address 192.168.2.12:7000; disk /dev/disk/by-partuuid/aa7490c0-fe1a-4b1f-ba3f-0ddee07dfee3; node-id 1; } on pve3 { address 192.168.2.13:7000; disk /dev/disk/by-partuuid/847b9713-8c00-48a1-8dff-f84c328b9da2; node-id 2; } connection-mesh { hosts pve1 pve2 pve3; } }</span></span></code> </pre> <br><p>  рдпрд╣ рд╕рд▓рд╛рд╣ рджреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдбреНрд░рдЧ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ <strong>рдЕрд▓рдЧ рдиреЗрдЯрд╡рд░реНрдХ</strong> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПред </p><br><p>  рдЕрдм drdd рдХреЗ рд▓рд┐рдП рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдмрдирд╛рдПрдВ рдФрд░ рдЗрд╕реЗ рдЪрд▓рд╛рдПрдВ: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># drbdadm create-md nfs1 initializing activity log initializing bitmap (320 KB) to all zero Writing meta data... New drbd meta data block successfully created. success # drbdadm up nfs1</span></span></code> </pre> <br><p>  рддреАрдиреЛрдВ рдиреЛрдбреНрд╕ рдкрд░ рдЗрди рдЪрд░рдгреЛрдВ рдХреЛ рджреЛрд╣рд░рд╛рдПрдВ рдФрд░ рд╕реНрдерд┐рддрд┐ рдЬрд╛рдВрдЪреЗрдВ: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># drbdadm status nfs1 role:Secondary disk:Inconsistent pve2 role:Secondary peer-disk:Inconsistent pve3 role:Secondary peer-disk:Inconsistent</span></span></code> </pre> <br><p>  рдЕрдм рд╣рдорд╛рд░реА <strong>рдЕрд╕рдВрдЧрдд</strong> рдбрд┐рд╕реНрдХ рддреАрдиреЛрдВ рдиреЛрдбреНрд╕ рдкрд░ рд╣реИ, рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рд╢рд░рд╛рдмреА рдХреЛ рдпрд╣ рдирд╣реАрдВ рдкрддрд╛ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕ рдбрд┐рд╕реНрдХ рдХреЛ рдореВрд▓ рд░реВрдк рдореЗрдВ рд▓рд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╣рдореЗрдВ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ <strong>рдкреНрд░рд╛рдердорд┐рдХ</strong> рд░реВрдк рд╕реЗ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЙрд╕рдХрд╛ рд░рд╛рдЬреНрдп рдЕрдиреНрдп рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рд╣реЛ рдЬрд╛рдП: </p><br><pre> <code class="bash hljs">drbdadm primary --force nfs1 drbdadm secondary nfs1</code> </pre> <br><p>  рддреБрд░рдВрдд рдмрд╛рдж рдХрд┐ рдЗрдЪреНрдЫрд╛ <strong>рд╕рд┐рдВрдХ:</strong> </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># drbdadm status nfs1 role:Secondary disk:UpToDate pve2 role:Secondary replication:SyncSource peer-disk:Inconsistent done:26.66 pve3 role:Secondary replication:SyncSource peer-disk:Inconsistent done:14.20</span></span></code> </pre><br><p>  рд╣рдореЗрдВ рдЗрд╕реЗ рдЦрддреНрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдВрддрдЬрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдФрд░ рд╣рдо рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдЖрдЧреЗ рдХреЗ рдХрджрдо рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВред  DRBD рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рдбрд┐рд╕реНрдХ рдХреА рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛, рдЙрдиреНрд╣реЗрдВ <strong>рдХрд┐рд╕реА рднреА рдиреЛрдб</strong> рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд╕рднреА рдЕрдиреБрд░реЛрдз рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ <strong>UpToDate</strong> рд░рд╛рдЬреНрдп рдХреЗ рд╕рд╛рде рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред </p><br><p>  рдиреЛрдб рдкрд░ drdd рд╕реЗрд╡рд╛ рдХреЗ <strong>рдСрдЯреЛрд░рди</strong> рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдирд╛ рди рднреВрд▓реЗрдВ: </p><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> drbd.service</code> </pre> <br><h2 id="nastroyka-lxc-konteynera">  рдПрдХ рдПрд▓рдПрдХреНрд╕рд╕реА рдХрдВрдЯреЗрдирд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ </h2><br><p>  рд╣рдо рддреАрди рдиреЛрдбреНрд╕ рдХреЗ <strong>рд╕рдореАрдкрд╕реНрде рдХреНрд▓рд╕реНрдЯрд░</strong> рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рднрд╛рдЧ рдХреЛ рдЫреЛрдбрд╝ <strong>рджреЗрдВрдЧреЗ</strong> , рдЗрд╕ рднрд╛рдЧ рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╡рд┐рдХреА</a> рдореЗрдВ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╡рд░реНрдгрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ </p><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рдХрд╣рд╛, рд╣рдорд╛рд░рд╛ <strong>рдПрдирдПрдлрдПрд╕ рд╕рд░реНрд╡рд░</strong> рдПрдХ <strong>рдПрд▓рдПрдХреНрд╕рд╕реА рдХрдВрдЯреЗрдирд░</strong> рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред  рд╣рдо рдХрдВрдЯреЗрдирд░ рдХреЛ рдбрд┐рд╡рд╛рдЗрд╕ <code>/dev/drbd100</code> рдЬреЛ рд╣рдордиреЗ рдЕрднреА рдмрдирд╛рдпрд╛ рд╣реИред </p><br><p>  рдкрд╣рд▓реЗ рд╣рдореЗрдВ рдЗрд╕ рдкрд░ рдПрдХ <strong>рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо</strong> рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="hljs powershell">mkfs <span class="hljs-literal"><span class="hljs-literal">-t</span></span> ext4 <span class="hljs-literal"><span class="hljs-literal">-O</span></span> mmp <span class="hljs-literal"><span class="hljs-literal">-E</span></span> mmp_update_interval=<span class="hljs-number"><span class="hljs-number">5</span></span> /dev/drbd100</code> </pre> <br><p>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ <strong>Proxmox</strong> рдореЗрдВ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╕реНрддрд░ рдкрд░ <strong>рдорд▓реНрдЯреАрдорд╛рдЙрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛</strong> рд╢рд╛рдорд┐рд▓ рд╣реИ, рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рд╣рдо рдЗрд╕рдХреЗ рдмрд┐рдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐  DRBD рдХреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдкрдиреА рд╕реБрд░рдХреНрд╖рд╛ рд╣реИ, рдпрд╣ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рд▓рд┐рдП рджреВрд╕рд░реЗ <strong>рдкреНрд░рд╛рдердорд┐рдХ</strong> рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рд╛рд╡рдзрд╛рдиреА рд╣рдореЗрдВ рдиреБрдХрд╕рд╛рди рдирд╣реАрдВ рдкрд╣реБрдВрдЪрд╛рддреА рд╣реИред </p><br><p>  рдЕрдм рдЙрдмрдВрдЯреВ рдЯреЗрдореНрдкрд▓реЗрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ: </p><br><pre> <code class="hljs pgsql"># wget http://download.proxmox.com/images/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/ubuntu<span class="hljs-number"><span class="hljs-number">-16.04</span></span>-standard_16<span class="hljs-number"><span class="hljs-number">.04</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>_amd64.tar.gz -P /var/lib/vz/<span class="hljs-keyword"><span class="hljs-keyword">template</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>/</code> </pre> <br><p>  рдФрд░ рдЗрд╕рд╕реЗ рд╣рдорд╛рд░рд╛ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдПрдВ: </p><br><pre> <code class="hljs powershell">pct create <span class="hljs-number"><span class="hljs-number">101</span></span> local:vztmpl/ubuntu<span class="hljs-literal"><span class="hljs-literal">-16</span></span>.<span class="hljs-number"><span class="hljs-number">04</span></span><span class="hljs-literal"><span class="hljs-literal">-standard_16</span></span>.<span class="hljs-number"><span class="hljs-number">04</span></span><span class="hljs-literal"><span class="hljs-literal">-1_amd64</span></span>.tar.gz \ -<span class="hljs-literal"><span class="hljs-literal">-hostname</span></span>=nfs1 \ -<span class="hljs-literal"><span class="hljs-literal">-net0</span></span>=name=eth0,bridge=vmbr0,gw=<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">1.1</span></span>,ip=<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">1.11</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-rootfs</span></span>=volume=/dev/drbd100,shared=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  рдЗрд╕ рдЖрджреЗрд╢ рдореЗрдВ, рд╣рдо рдпрд╣ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдХрдВрдЯреЗрдирд░ рдХреА <strong>рдЬрдбрд╝ рдкреНрд░рдгрд╛рд▓реА</strong> рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рд╕реНрдерд┐рдд рд╣реЛ рдЬрд╛рдПрдЧрд╛ <code>/dev/drbd100</code> рдФрд░ рд╡рд┐рдХрд▓реНрдк рдЬреЛрдбрд╝рдиреЗ <code>shared=1</code> рдХрд┐ рдХрдВрдЯреЗрдирд░ рдиреЛрдбреНрд╕ рдХреЗ рдмреАрдЪ <strong>рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП</strong> рдЕрдиреБрдорддрд┐ рд╣реЛрдЧреАред </p><br><p>  рдпрджрд┐ рдХреБрдЫ рдЧрд▓рдд рд╣реБрдЖ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рд╣рдореЗрд╢рд╛ <strong>Proxmox</strong> рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдпрд╛ <code>/etc/pve/lxc/101.conf</code> рдХрдВрдЯреЗрдирд░ <code>/etc/pve/lxc/101.conf</code> рдорд╛рдзреНрдпрдо рд╕реЗ рдареАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </p><br><p>  Proxmox рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЛ рдЕрдирдкреИрдХ рдХрд░реЗрдЧрд╛ рдФрд░ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдХрдВрдЯреЗрдирд░ <strong>рд░реВрдЯ рд╕рд┐рд╕реНрдЯрдо</strong> рддреИрдпрд╛рд░ <strong>рдХрд░реЗрдЧрд╛</strong> ред  рдЙрд╕рдХреЗ рдмрд╛рдж рд╣рдо рдЕрдкрдирд╛ рдХрдВрдЯреЗрдирд░ рд▓реЙрдиреНрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="hljs pgsql">pct <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-number"><span class="hljs-number">101</span></span></code> </pre> <br><h2 id="nastroyka-nfs-servera">  NFS рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВред </h2><br><p>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Proxmox рдХрдВрдЯреЗрдирд░ рдореЗрдВ <strong>NFS рд╕рд░реНрд╡рд░</strong> рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА <strong>рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛</strong> рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЗ рд╣реИрдВред </p><br><p>  рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рд╕рд┐рд░реНрдл <code>lxc.apparmor.profile: unconfined</code> рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ <code>lxc.apparmor.profile: unconfined</code> рд╣рдорд╛рд░реЗ рдХрдВрдЯреЗрдирд░ рдХреЗ <code>/etc/pve/lxc/100.conf</code> ред </p><br><p>  рдпрд╛ рд╣рдо рдирд┐рд░рдВрддрд░ рдЖрдзрд╛рд░ рдкрд░ рд╕рднреА рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ <strong>рд▓рд┐рдП рдПрдирдПрдлрдПрд╕</strong> рдХреЛ <strong>рд╕рдХреНрд╖рдо</strong> рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рд╕рднреА рдиреЛрдбреНрд╕ рдкрд░ <code>/etc/apparmor.d/lxc/lxc-default-cgns</code> рд▓рд┐рдП рдорд╛рдирдХ рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдирд┐рдореНрди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ <code>/etc/apparmor.d/lxc/lxc-default-cgns</code> : </p><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">mount</span></span> fstype=nfs, mount fstype=nfs4, mount fstype=nfsd, mount fstype=rpc_pipefs,</code> </pre> <br><p>  рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рдмрд╛рдж, рдХрдВрдЯреЗрдирд░ рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдВ: </p><br><pre> <code class="hljs pgsql">pct shutdown <span class="hljs-number"><span class="hljs-number">101</span></span> pct <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-number"><span class="hljs-number">101</span></span></code> </pre> <br><p>  рдЕрдм рдЗрд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░реЗрдВ: </p><br><pre> <code class="hljs perl">pct <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> <span class="hljs-number"><span class="hljs-number">101</span></span> bash</code> </pre> <br><p>  рдЕрджреНрдпрддрди рдФрд░ <strong>NFS рд╕рд░реНрд╡рд░</strong> рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ: </p><br><pre> <code class="hljs powershell">apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> update apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> <span class="hljs-literal"><span class="hljs-literal">-y</span></span> upgrade apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> <span class="hljs-literal"><span class="hljs-literal">-y</span></span> install nfs<span class="hljs-literal"><span class="hljs-literal">-kernel</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span></code> </pre> <br><p>  рдПрдХ <strong>рдирд┐рд░реНрдпрд╛рдд</strong> рдмрдирд╛рдПрдБ: </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">echo</span></span> '/<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> *(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rw</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">no_root_squash</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">no_subtree_check</span></span></span><span class="hljs-class">)' &gt;&gt; /etc/exports mkdir /</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> exportfs -a</span></span></code> </pre> <br><h2 id="nastroyka-ha">  рд╣рд╛ рд╕реЗрдЯрдЕрдк </h2><br><p>  рд▓реЗрдЦрди рдХреЗ рд╕рдордп, рдкреНрд░реЙрдХреНрд╕рдореЙрдХреНрд╕ <strong>рд╣рд╛-рдореИрдиреЗрдЬрд░ рдХреЗ</strong> рдкрд╛рд╕ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрдЧ</a> рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рд╣рд╛ рдХрдВрдЯреЗрдирд░ рдХреЛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЕрдкрдирд╛ рдХрд╛рдо рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк <strong>nfs рд╕рд░реНрд╡рд░</strong> рдХреА <strong>рдХрд░реНрдиреЗрд▓-рд╕реНрдерд╛рди</strong> рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдЬреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдирд╣реАрдВ рдорд╛рд░реЗ рдЧрдП рдереЗ, <strong>рдорд╛рдзреНрдпрдорд┐рдХ</strong> рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рд╕реЗ рдбреНрд░рдм рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВред  рдпрджрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдРрд╕реА рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рдЪреБрдХреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ <code>killall -9 nfsd</code> рдирд╣реАрдВ рдЪрд╛рд╣рд┐рдП рдФрд░ рдмрд╕ рдЙрд╕ рдиреЛрдб рдкрд░ <code>killall -9 nfsd</code> рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рдХрдВрдЯреЗрдирд░ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдлрд┐рд░ рдбреНрд░рдм рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ "рд░рд┐рд▓реАрдЬрд╝" рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдпрд╣ <strong>рдорд╛рдзреНрдпрдорд┐рдХ рдореЗрдВ рдЬрд╛рдПрдЧрд╛</strong> ред </p><br><p>  рдЗрд╕ рдмрдЧ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рднреА рдиреЛрдбреНрд╕ рдкрд░ рдирд┐рдореНрди рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдБ: </p><br><pre> <code class="hljs powershell">sed <span class="hljs-literal"><span class="hljs-literal">-i</span></span> <span class="hljs-string"><span class="hljs-string">'s/forceStop =&gt; 1,/forceStop =&gt; 0,/'</span></span> /usr/share/perl5/PVE/HA/Resources/PVECT.pm systemctl restart pve<span class="hljs-literal"><span class="hljs-literal">-ha</span></span><span class="hljs-literal"><span class="hljs-literal">-lrm</span></span>.service</code> </pre> <br><p>  рдЕрдм рд╣рдо <strong>рд╣рд╛-рдореИрдиреЗрдЬрд░</strong> рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрд░ рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдЗрдП рдЕрдкрдиреЗ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╣рд╛-рд╕рдореВрд╣ рдмрдирд╛рдПрдВ: </p><br><pre> <code class="hljs powershell">ha<span class="hljs-literal"><span class="hljs-literal">-manager</span></span> groupadd nfs1 -<span class="hljs-literal"><span class="hljs-literal">-nodes</span></span> pve1,pve2,pve3 -<span class="hljs-literal"><span class="hljs-literal">-nofailback</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> -<span class="hljs-literal"><span class="hljs-literal">-restricted</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  рд╣рдорд╛рд░рд╛ <strong>рд╕рдВрд╕рд╛рдзрди</strong> рдЗрд╕ рд╕рдореВрд╣ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдиреЛрдбреНрд╕ рдкрд░ рд╣реА рдХрд╛рдо рдХрд░реЗрдЧрд╛ред  рд╣рдорд╛рд░реЗ рдХрдВрдЯреЗрдирд░ рдХреЛ рдЗрд╕ рд╕рдореВрд╣ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ: </p><br><pre> <code class="hljs powershell">ha<span class="hljs-literal"><span class="hljs-literal">-manager</span></span> add ct:<span class="hljs-number"><span class="hljs-number">101</span></span> -<span class="hljs-literal"><span class="hljs-literal">-group</span></span>=nfs1 -<span class="hljs-literal"><span class="hljs-literal">-max_relocate</span></span>=<span class="hljs-number"><span class="hljs-number">3</span></span> -<span class="hljs-literal"><span class="hljs-literal">-max_restart</span></span>=<span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  рд╡рд╣ рд╕рдм рд╣реИред  рд╕рд░рд▓, рд╕рд╣реА? </p><br><p>  рдкрд░рд┐рдгрд╛рдореА <strong>nfs рдмреЙрд▓</strong> рдХреЛ рддреБрд░рдВрдд рдЕрдиреНрдп рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдФрд░ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдФрд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП Proxmox рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><h2 id="rekomendacii-i-tyuning">  рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ рдФрд░ рдЯреНрдпреВрдирд┐рдВрдЧ </h2><br><h5 id="drbd">  рдХреЗрдбрдВрдк </h5><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИ, рдкреНрд░рддрд┐рдХреГрддрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣рдореЗрд╢рд╛ рдЙрдЪрд┐рдд рд╣реЛрддрд╛ рд╣реИред  <strong>10-рдЧреАрдЧрд╛рдмрд┐рдЯ рдиреЗрдЯрд╡рд░реНрдХ рдПрдбреЗрдкреНрдЯрд░</strong> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрддреНрдпрдзрд┐рдХ рдЙрдЪрд┐рдд рд╣реИ, рдЕрдиреНрдпрдерд╛ рдЖрдк рдкреЛрд░реНрдЯ рдЧрддрд┐ рдореЗрдВ рдЪрд▓реЗрдВрдЧреЗред <br>  рдпрджрд┐ рдкреНрд░рддрд┐рдХреГрддрд┐ рдкрд░реНрдпрд╛рдкреНрдд рдзреАрдореА рд▓рдЧрддреА рд╣реИ, рддреЛ <strong>DRBD рдХреЗ</strong> рд▓рд┐рдП рдХреБрдЫ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред  рдпрд╣рд╛рдБ рд╡рд┐рдиреНрдпрд╛рд╕ рд╣реИ, рдЬреЛ рдореЗрд░реА рд░рд╛рдп рдореЗрдВ рдореЗрд░реЗ <strong>10G рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ</strong> рд▓рд┐рдП рдЗрд╖реНрдЯрддрдо рд╣реИ: </p><br><pre> <code class="hljs swift"># cat /etc/drbd.d/global_common.conf global { usage-<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> yes; udev-always-use-vnr; } common { handlers { } startup { } options { } disk { <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>-fill-target 10M; <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>-rate 720M; <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>-plan-ahead <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>-rate 20M; } net { <span class="hljs-built_in"><span class="hljs-built_in">max</span></span>-buffers 36k; sndbuf-size 1024k; rcvbuf-size 2048k; } }</code> </pre> <br><p>  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдзрд┐рдХрд╛рд░рд┐рдХ DRBD рдкреНрд░рд▓реЗрдЦрди</a> рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">ред</a> </p><br><h5 id="nfs-server">  рдПрдирдПрдлрд╝рдПрд╕ рд╕рд░реНрд╡рд░ </h5><br><p>  <strong>рдПрдирдПрдлрдПрд╕ рд╕рд░реНрд╡рд░</strong> рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреЛ рдЧрддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП <strong>рдПрдирдПрдлрдПрд╕ рд╕рд░реНрд╡рд░</strong> рдХреА рдХреБрд▓ рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдореЗрдВ рдорджрдж рдорд┐рд▓ рд╕рдХрддреА рд╣реИред  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ - <strong>8</strong> , рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ, рдЗрд╕рдиреЗ рдореБрдЭреЗ рдЗрд╕ рд╕рдВрдЦреНрдпрд╛ рдХреЛ <strong>64</strong> рддрдХ рдмрдврд╝рд╛рдиреЗ рдореЗрдВ рдорджрдж рдХреАред </p><br><p>  рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <code>RPCNFSDCOUNT=64</code> рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ <code>/etc/default/nfs-kernel-server</code> рдЕрдкрдбреЗрдЯ <code>/etc/default/nfs-kernel-server</code> ред <br>  рдФрд░ рдбреЗрдореЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ: </p><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> nfs-utils systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> nfs-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span></code> </pre> <br><h5 id="nfsv3-vs-nfsv4">  NFSv3 рдмрдирд╛рдо NFSv4 </h5><br><p>  <strong>NFSv3</strong> рдФрд░ <strong>NFSv4 рдХреЗ</strong> рдмреАрдЪ рдЕрдВрддрд░ <strong>рдЬреНрдЮрд╛рдд</strong> <strong>рдХреАрдЬрд┐рдпреЗ</strong> ? </p><br><ul><li>  <strong>NFSv3</strong> рдПрдХ <strong>рд╕реНрдЯреЗрдЯрд▓реЗрд╕ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИ,</strong> рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣ рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХреЛ рдмреЗрд╣рддрд░ рдврдВрдЧ рд╕реЗ рд╕рд╣рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рддреЗрдЬреА рд╕реЗ рдареАрдХ рдХрд░рддрд╛ рд╣реИред </li><li>  <strong>NFSv4</strong> рдПрдХ <strong>рд╕реНрдЯреЗрдЯрдлреБрд▓ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИ</strong> , рдпрд╣ рддреЗрдЬреА рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдХреБрдЫ tcp рдкреЛрд░реНрдЯ рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд░рд╛рдЬреНрдп рдХреА рдореМрдЬреВрджрдЧреА рдХреЗ рдХрд╛рд░рдг рдпрд╣ рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХреЗ рдкреНрд░рддрд┐ рдЕрдзрд┐рдХ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИред  рдЗрд╕рдореЗрдВ рдХрд░рдмрд░реЛрд╕ рдФрд░ рдЕрдиреНрдп рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рдПрдХ рд╕рдореВрд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рднреА рд╣реИред </li></ul><br><p>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЬрдм рдЖрдк <code>showmount -e nfs_server</code> , рддреЛ NFSv3 рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  Proxmox рднреА NFSv3 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  NFSv3 рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдорддреМрд░ рдкрд░ рдиреЗрдЯрд╡рд░реНрдХ рдмреВрдЯ рдорд╢реАрдиреЛрдВ рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ NFSv4 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рдХрд╛рд░рдг рдирд╣реАрдВ рд╣реИ, рддреЛ NFSv3 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдХрд┐рд╕реА рднреА рд░рд╛рдЬреНрдп рдХреА рдХрдореА рдХреЗ рдХрд╛рд░рдг рдХрд┐рд╕реА рднреА рд╡рд┐рдлрд▓рддрд╛ рдХреЗ рд▓рд┐рдП рдХрдо рджрд░реНрджрдирд╛рдХ рд╣реИред </p><br><p>  <strong>рдорд╛рдЙрдВрдЯ</strong> рдХрдорд╛рдВрдб рдХреЗ рд▓рд┐рдП <code>-o vers=3</code> рдкреИрд░рд╛рдореАрдЯрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рдЖрдк NFSv3 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреЗрдВрдж рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="bash hljs">mount -o vers=3 nfs_server:/share /mnt</code> </pre> <br><p>  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ, рддреЛ рдЖрдк рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП NFSv4 рдХреЛ рдмрд┐рд▓реНрдХреБрд▓ рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <code>--no-nfs-version 4</code> рдЪрд░ рдореЗрдВ <code>--no-nfs-version 4</code> рд╡рд┐рдХрд▓реНрдк <code>--no-nfs-version 4</code> рдФрд░ рд╕рд░реНрд╡рд░ рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: </p><br><pre> <code class="bash hljs">RPCNFSDCOUNT=<span class="hljs-string"><span class="hljs-string">"64 --no-nfs-version 4"</span></span></code> </pre> <br><h2 id="iscsi-i-lvm">  iSCSI рдФрд░ LVM </h2><br><p>  рдЗрд╕реА рддрд░рд╣, рдПрдХ рдирд┐рдпрдорд┐рдд <strong>tgt рдбреЗрдорди</strong> рдХреЛ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, iSCSI I / O рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рдЙрдЪреНрдЪ рдкреНрд░рджрд░реНрд╢рди рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд░реЗрдЧрд╛, рдФрд░ рдХрдВрдЯреЗрдирд░ рдЕрдзрд┐рдХ рд╕реБрдЪрд╛рд░реВ рд░реВрдк рд╕реЗ рдХрд╛рдо рдХрд░реЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ tgt рд╕рд░реНрд╡рд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдЖрдорддреМрд░ рдкрд░, рдПрдХ рдирд┐рд░реНрдпрд╛рддрд┐рдд <strong>LUN</strong> <strong>LVM</strong> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдИ рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рдХрдЯрд╛ рд╣реБрдЖ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХрдИ рдмрд╛рд░реАрдХрд┐рдпреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рдПрдХ рдореЗрдЬрдмрд╛рди рд╕рдореВрд╣ рдХреЛ рдХрдИ рдореЗрдЬрдмрд╛рдиреЛрдВ рдкрд░ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП LVM <strong>рддрд╛рд▓реЗ</strong> рдХреИрд╕реЗ рдкреНрд░рджрд╛рди рдХрд┐рдП <strong>рдЬрд╛рддреЗ рд╣реИрдВ</strong> ред </p><br><p>  рд╢рд╛рдпрдж рдпреЗ рдФрд░ рдЕрдиреНрдп рдмрд╛рд░реАрдХрд┐рдпрд╛рдВ рдореИрдВ <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдЧрд▓реЗ рд▓реЗрдЦ</a></strong> рдореЗрдВ рд╡рд░реНрдгрди рдХрд░реВрдВрдЧрд╛ред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi417473/">https://habr.com/ru/post/hi417473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486150/index.html">D├йveloppement de la sph├иre informatique en Slovaquie. Prestations de travail pour les jeunes professionnels</a></li>
<li><a href="../fr486156/index.html">Comme j'ai enseign├й, puis ├йcrit un manuel de formation en Python</a></li>
<li><a href="../fr486158/index.html">Visualisation de la traduction automatique neuronale (mod├иles seq2seq avec m├йcanisme d'attention)</a></li>
<li><a href="../fr486164/index.html">Coronavirus 2019-nCoV. FAQ sur la protection respiratoire et la d├йsinfection</a></li>
<li><a href="../fr486174/index.html">J'ai un chiffre d'affaires nul</a></li>
<li><a href="../hi417475/index.html">Glusterfs + erasure рдХреЛрдбрд┐рдВрдЧ: рдЬрдм рдЖрдкрдХреЛ рдмрд╣реБрдд, рд╕рд╕реНрддреЗ рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ</a></li>
<li><a href="../hi417477/index.html">рдЧрд░реНрдо рдЕрд╡рд░реЛрд╣реА</a></li>
<li><a href="../hi417479/index.html">рдлрд╛рд╕реНрдЯрд░ рдЧреЛ-рдЗрдЯ-рд╕реНрдЯреНрд░реАрдВрдЧ рдЧреЛ рдХреЙрдиреИрдЯреЗрд╢рди рдЗрди рдЧреЛ</a></li>
<li><a href="../hi417481/index.html">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдИрдПрд╕ 6 рдореЗрдВ рдЬрдирд░реЗрдЯрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ, рдФрд░ рдЙрдирдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рдирд╛ рд╡реИрдХрд▓реНрдкрд┐рдХ рдХреНрдпреЛрдВ рд╣реИ</a></li>
<li><a href="../hi417483/index.html">рдЬреЗрдПрд╕ рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреА рддреБрд▓рдирд╛: рд░рд┐рдПрдХреНрдЯ, рд╡реАрдпреВ рдФрд░ рд╣рд╛рдЗрдкрд░рдкреНрдк</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>