<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîπ üèõÔ∏è ‚óºÔ∏è M√©todo de m√©dia vetorial para medir a dire√ß√£o do vento üõèÔ∏è üíÖüèø üê£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um ano atr√°s, eu descrito esta√ß√£o meteorol√≥gica com a velocidade e dire√ß√£o do calibre de vento. Com base na experi√™ncia de duas temporadas operacionai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√©todo de m√©dia vetorial para medir a dire√ß√£o do vento</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423243/"> Um ano atr√°s, eu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descrito</a> esta√ß√£o meteorol√≥gica com a velocidade e dire√ß√£o do calibre de vento.  Com base na experi√™ncia de duas temporadas operacionais, foram feitas algumas altera√ß√µes e melhorias, as quais s√£o parcialmente descritas l√° em acr√©scimos ao texto principal. <br><br>  Uma dessas mudan√ßas diz respeito ao c√°lculo da dire√ß√£o m√©dia do vento.  Para minha surpresa, n√£o encontrei nada sensato sobre esse t√≥pico na Web, apenas em um dos f√≥runs as pessoas quase pensaram no m√©todo de c√°lculo da m√©dia de vetores (mas apenas quase n√£o resolveram o problema em termos gerais).  Portanto, achei √∫til colocar este t√≥pico em uma publica√ß√£o separada - de repente algu√©m mais ser√° √∫til.  O m√©todo pode ser usado para calcular a m√©dia de qualquer quantidade vetorial, n√£o apenas vento ou corrente. <br><a name="habracut"></a><br>  Observe que o m√©todo can√¥nico para realizar medi√ß√µes meteorol√≥gicas do vento √© o seguinte: calcule a m√©dia do vetor (ou seja, velocidade e dire√ß√£o) durante 10 minutos (na R√∫ssia e na maioria dos pa√≠ses do mundo √© aceito dessa maneira, dizem eles nos EUA e em outros pa√≠ses de maneira diferente).  Nesse caso, as medi√ß√µes s√£o realizadas a uma altura de 10 m da superf√≠cie da Terra.  Para garantir tudo isso sob condi√ß√µes de joelho √© bastante dif√≠cil: n√£o se pode alcan√ßar uma altura de 10 m em espa√ßo aberto (n√£o construa uma torre especial, longe de casas e √°rvores que distorcem o fluxo do vento), e a temperatura com umidade deve, pelo contr√°rio, ser medida √† sombra e pr√≥xima da superf√≠cie.  O sensor port√°til √© transformado de um dispositivo compacto em um sistema de medi√ß√£o inteiro (veja a foto do territ√≥rio de uma esta√ß√£o meteorol√≥gica na cidade de Kirov). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b03/704/b2b/b03704b2bd492c4455aae265a659d489.jpg" alt="Esta√ß√£o meteorol√≥gica em Kirov"><br><br>  E o resultado - em m√©dia 10 minutos - ser√° pouco informativo.  Perto da superf√≠cie, o vento √© muito mais tempestuoso do que em altitude, em 10 minutos pode mudar de velocidade e dire√ß√£o vinte vezes, e as informa√ß√µes sobre essas rajadas s√£o muito mais informativas para a pessoa m√©dia do que o valor m√©dio.  Deixe-me lembr√°-lo de que o sensor de velocidade aqui mostra o valor m√°ximo de quatro medi√ß√µes por ciclo de 8 segundos, e essa foi a escolha certa (na verdade, temos um sensor de ondula√ß√£o em vez do sensor de velocidade m√©dio). <br><br>  Mas o cata-vento acabou sendo mais sombrio que o sensor de velocidade.  De acordo com o algoritmo inicial da minha esta√ß√£o meteorol√≥gica (que foi selecionada com base na economia de energia m√°xima poss√≠vel), a dire√ß√£o foi medida uma vez por ciclo, ou seja, mesmo as pulsa√ß√µes n√£o funcionavam: havia amostras aleat√≥rias do processo cont√≠nuo de suspens√£o do cata-vento com uma frequ√™ncia muito maior que uma vez a cada 8 e mais de 16 segundos. <br><br>  Portanto, decidiu-se calcular a m√©dia da dire√ß√£o do vetor de velocidade por ciclo, fazendo medi√ß√µes a cada dois segundos e calculando a m√©dia.  E o problema n√£o √© que ele possa ser resolvido com um meio chute - os valores de dire√ß√£o n√£o formam uma matriz uniforme de n√∫meros que podem ser adicionados e divididos diretamente (uma palavra √© um vetor, n√£o um escalar besteira).  Normalmente, um exemplo √© dado com valores de 1 grau e 359 graus: √© f√°cil descobrir que, em m√©dia, ser√° exatamente 360 ‚Äã‚Äã(ou 0, sem diferen√ßa), mas a aritm√©tica comum fornecer√° o n√∫mero 180 graus. <br><br>  N√£o h√° necessidade de inventar nada - tudo j√° foi inventado antes de voc√™.  O problema √© resolvido pelo m√©todo de m√©dia vetorial, bem conhecido por aqueles que lidavam com medi√ß√µes de ventos ou correntes.  O m√©todo √© essencialmente muito simples: como n√£o podemos calcular a m√©dia direta dos √¢ngulos, vamos calcular a m√©dia das proje√ß√µes do vetor no eixo de coordenadas, que, por defini√ß√£o, √© um valor escalar, ou seja, pode ser submetido √† aritm√©tica comum sem questionar. <br><br>  As proje√ß√µes do vetor de vento atual W '(o ap√≥strofo desempenha o papel de um sobrescrito) no eixo X e Y s√£o wx = Wa ‚Ä¢ cos (Œ±) e wy = Wa ‚Ä¢ sin (Œ±), onde Wa √© o m√≥dulo do vetor (valor da velocidade) e Œ± - o valor do √¢ngulo entre o vetor e o eixo de coordenadas zero.  Se calcularmos a m√©dia desses valores das proje√ß√µes e depois convertermos as m√©dias em um vetor, obteremos o valor real da velocidade e dire√ß√£o m√©dias do vento. <br><br><div class="spoiler">  <b class="spoiler_title">Nota para particularmente corrosivo</b> <div class="spoiler_text">  Para uma m√©dia completamente correta dessa maneira, √© necess√°rio que o valor de Wa (valor da velocidade) seja medido estritamente simultaneamente com o valor do √¢ngulo.  Na pr√°tica, isso deve ser monitorado apenas se os per√≠odos de flutua√ß√µes significativas na amplitude do fluxo forem menores ou compar√°veis ‚Äã‚Äãao tempo das medi√ß√µes.  Para o vento (e para quase todos os casos do fluxo natural da √°gua), geralmente n√£o √© necess√°rio monitorar, uma vez que o tempo de medi√ß√£o para n√≥s √© de no m√°ximo uma fra√ß√£o de segundo e pulsa√ß√µes significativas de vento, √© claro, duram mais.  Podemos negligenciar as homogeneidades de alta frequ√™ncia do fluxo, porque elas n√£o afetam nada: a in√©rcia de corpos f√≠sicos reais (incluindo sensores) √© muito maior do que essas inomogeneidades, e simplesmente n√£o as sentimos - um peda√ßo de papel tremer√°, mas nada mais.  Em casos extremos, eles aparecer√£o como um pequeno ru√≠do aleat√≥rio que n√£o afeta significativamente a qualidade das medi√ß√µes. <br></div></div><br>  Esse m√©todo maravilhoso (vamos cham√°-lo de m√©dia do vetor completo) tem uma desvantagem cardinal do ponto de vista pr√°tico: na aus√™ncia de um sujeito de medi√ß√£o (ou seja, quando h√° uma calma completa, o que √© um caso bastante comum), ele fornece um resultado matematicamente incorreto: como a velocidade do vento √© zero, ent√£o e ambas as proje√ß√µes s√£o iguais a zero, o que n√£o pode ser (uma vez que pecado e cos s√£o fun√ß√µes complementares).  Mais precisamente, pode ser, mas √© fundamentalmente imposs√≠vel extrair informa√ß√µes dessa situa√ß√£o.  O que voc√™ deseja mostrar no visor?  Para ser sincero, ainda n√£o sei a maneira correta de contornar essa situa√ß√£o (nos medidores de vaz√£o que projetei uma vez, os ciclos m√©dios eram horas e acreditava-se que pelo menos alguma agita√ß√£o ocorreria). <br><br>  Mas, no nosso caso, felizmente a tarefa √© mais f√°cil - n√£o precisamos calcular a velocidade m√©dia e podemos fazer proje√ß√µes √∫nicas do vetor, sem levar em conta a magnitude de seu m√≥dulo.  Em outras palavras, pode-se operar com senos puros e cossenos, que nunca levam zero a ambos de uma vez: mesmo quando n√£o h√° vento, um cata-vento congelado no setor imobili√°rio mostra alguma dire√ß√£o.  Chamamos esse m√©todo de m√©dia simplificada de vetor de uma dire√ß√£o (talvez ele tenha algum nome oficial, mas n√£o estou ciente). <br><br>  Agora havia apenas uma dificuldade: transformar os valores m√©dios calculados de proje√ß√£o novamente no valor do √¢ngulo.  Para isso, a fun√ß√£o Œ± = arctan (sin (Œ±) / cos (Œ±)) √© geralmente usada, mas se calcularmos atrav√©s das fun√ß√µes trigonom√©tricas inversas, √© mais simples usar simplesmente arcos (cos (Œ±)) (ou arcsin (sin (Œ±)), de qualquer maneira) e para complementar esse resultado para obter um c√≠rculo completo (ou seja, de 0 a 359 graus), analisando os sinais das proje√ß√µes, voc√™ ainda precisa: em todas as situa√ß√µes: todas as fun√ß√µes inversas fornecem o resultado dentro de um semic√≠rculo (de 0 a 180 ou de -90 a +90).  (Veja UPD sobre isso no final do artigo.) <br><br>  Formalizamos tudo isso em um algoritmo real (com refer√™ncia ao Arduino).  Para come√ßar, leremos as indica√ß√µes de dire√ß√£o, n√£o a cada ciclo, mas a cada medi√ß√£o (ap√≥s o valor da frequ√™ncia do anem√¥metro).  Converteremos o resultado no c√≥digo Gray (em nosso pa√≠s, foi designado como wind_Gray do tipo byte, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a publica√ß√£o</a> ) em um c√≥digo bin√°rio regular e, como a frequ√™ncia do anem√¥metro, o colocaremos em uma matriz global, que declararemos como wDirAvr [4], onde 4 √© o n√∫mero de medi√ß√µes no ciclo.  N√£o pintaremos a convers√£o do c√≥digo Gray de quatro d√≠gitos em c√≥digo bin√°rio - isso pode ser feito de v√°rias maneiras, a crit√©rio do programador e √© descrito em qualquer refer√™ncia. <br><br>  Esse c√≥digo bin√°rio assumir√° valores de 0 a 15, e concordamos que contaremos os √¢ngulos, n√£o como ge√≥grafos / top√≥grafos / navegadores deslocados, mas como pessoas normais que estudaram trigonometria na escola - no sentido anti-hor√°rio.  Ou seja, se o norte corresponde ao valor zero, ent√£o 90 graus n√£o √© o leste, como nos "deslocados", mas o oeste.  Como temos 16 grada√ß√µes de dire√ß√£o, precisamos multiplicar o valor do c√≥digo por 22,5 (360/16) para obter a dire√ß√£o em graus comuns do arco. <br><br>  Agora, o algoritmo real da m√©dia simplificada de vetores da dire√ß√£o a partir de 4 valores de c√≥digo: <br><br><pre><code class="plaintext hljs">. . . . . float wSin=0; // sin float wCos=0; // cos float wind_Rad; //   for (byte i=0; i&lt;4; i++){ wind_Rad= ((float(wDirAvr[i])*22.5)*M_PI/180); //   wSin=wSin+sin(wind_Rad);//    sin wCos=wCos+cos(wind_Rad);//    cos } // wSin=wSin/4;// sin ‚Äì    ,   wCos=wCos/4; // cos wind_Rad = acos(wCos); //     arccos if (wSin&lt;0) wind_Rad=2*M_PI-wind_Rad; //   sin int wind_G = round ((wind_Rad*180/M_PI)/22.5); //    0-15 . . . . .</code> </pre> <br>  A √∫ltima linha que convertemos a m√©dia, expressa em radianos, para a m√©dia, expressa em nosso c√≥digo de 0 a 15. Voc√™ pode convert√™-lo novamente em c√≥digo Gray, e nem precisa alterar o programa no m√≥dulo principal para exibir a dire√ß√£o. <br><br>  Aqui, de fato, est√° todo o algoritmo.  Eu estava com medo de que o c√°lculo de cossenos-arcosinos desacelerasse o fraco (nos tempos de 32 bits de hoje) do controlador Arduino, mas nada aconteceu: ele engoliu o c√≥digo sem sequer piscar ... um LED, provavelmente. <br><br>  <b>UPD</b> : Para o autor, o algoritmo funciona neste formul√°rio por v√°rios meses sem falhas.  No entanto, os comentaristas me levaram a um erro poss√≠vel, embora extremamente improv√°vel na pr√°tica: se os dados contiverem dois grupos de medi√ß√µes que est√£o aproximadamente a 180 graus um do outro, pr√≥ximos ao valor zero do cosseno (ou seja, cerca de 90 e 270 graus), o algoritmo produzir√° um erro valor.  Para evit√°-lo, em vez de acos (), use a fun√ß√£o atan2 (wSin, wCos), que imediatamente produz o resultado correto, levando em considera√ß√£o os sinais seno e cosseno (obrigado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aamonster</a> pela ajuda).  A linha na qual o valor m√©dio do wSin √© calculado n√£o deve ser comentada e a linha ajustada para o sinal wSin n√£o √© necess√°ria.  Em vez disso, voc√™ precisa inserir a convers√£o para valores positivos do √¢ngulo (j√° que atan2 fornece valores de pi a -pi): <br><pre> <code class="plaintext hljs">if (wind_Rad&lt;0) wind_Rad=2*M_PI+wind_Rad;</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423243/">https://habr.com/ru/post/pt423243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt423233/index.html">Intelig√™ncia Artificial no Mundo Real</a></li>
<li><a href="../pt423235/index.html">Do Dribbble ao Android Motion</a></li>
<li><a href="../pt423237/index.html">Um bra√ßo rob√≥tico simples, mas sofisticado</a></li>
<li><a href="../pt423239/index.html">Compilar pacotes para o Kubernetes com o Helm: estrutura e modelo de gr√°fico</a></li>
<li><a href="../pt423241/index.html">Vis√£o geral dos telefones Digip A20 e A25 SIP</a></li>
<li><a href="../pt423247/index.html">O que √© intelig√™ncia?</a></li>
<li><a href="../pt423249/index.html">Rust 1.29 Release</a></li>
<li><a href="../pt423251/index.html">Minha conta do Megafail</a></li>
<li><a href="../pt423253/index.html">Plataforma dom√©stica CAD nanoCAD Plus 10: um complexo universal para quem projeta</a></li>
<li><a href="../pt423257/index.html">Argumentos de Fun√ß√£o como Constantes de Bit no PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>