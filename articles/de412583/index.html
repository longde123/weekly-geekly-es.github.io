<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍⚕️ 🆒 🖋️ Wir zerlegen das Redmond G200S-Kesselprotokoll und verbinden es mit dem HomeAssistant 🚻 🧝🏽 👚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eintrag 
 Es gibt bereits einen Artikel über die Gicktime, der sich mit dem Parsen des Protokolls des Redmond SkyKettle-Kessels befasst. Dort wurde je...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir zerlegen das Redmond G200S-Kesselprotokoll und verbinden es mit dem HomeAssistant</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412583/"><h3>  Eintrag </h3><br>  Es gibt bereits <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Artikel</a> über die Gicktime, der sich mit dem Parsen des Protokolls des Redmond SkyKettle-Kessels befasst.  Dort wurde jedoch über das Modell RK-M171S gesprochen, hier wird über ein funktionaleres G200S gesprochen.  In diesem Modell hat sich das Interaktionsprotokoll geändert, wodurch der Ansatz des Autors des vorherigen Artikels nicht mehr funktioniert und zusätzliche Funktionen des Nachtlichts und die Anzeige der aktuellen Farbtemperatur erschienen sind. <br><br>  In diesem Artikel werde ich die Ergebnisse einer Protokollanalyse mit Python-Codebeispielen vorstellen (wenn jemand sein Modul / seine Anwendung zur Steuerung der Teekanne entwickeln möchte).  Am Ende des Artikels befindet sich außerdem ein Link zu einem vorgefertigten Modul zum Anschließen einer Teekanne an HomeAssistant (dies ist meine erste Erfahrung beim Schreiben in Python nach einem Online-Kurs, sodass dieses Modul verbessert werden kann und muss). <br><br>  Jeder, der interessiert ist, willkommen bei Katze. <br><a name="habracut"></a><br><h3>  Probleme und Aufgaben </h3><br>  Diese Teekanne hat ein großes Minus (mit Ausnahme der vom Autor des ersten Artikels angegebenen): Sobald die Teekanne vom Stand entfernt wird, wird die aktuelle Zeit zurückgesetzt und der Zeitplan kann daher nicht zum Kochen der Teekanne verwendet werden.  Nach den Vorstellungen der Autoren dieser Kreation müssen Sie jedes Mal, wenn Sie den Wasserkocher wieder auf den Stand bringen, die proprietäre Anwendung starten und den Wasserkocher mit einem Smartphone synchronisieren.  Anstatt Routineaufgaben zu erleichtern, schult uns die „intelligente“ Technologie, zusätzliche Aktionen auszuführen.  Das änderte sich jedoch, als HomeAssistant im Haus erschien.  Dann habe ich beschlossen, das Protokoll zu verstehen. <br><br><h3>  Die Werkzeuge </h3><br>  Ich habe ehrlich gesagt versucht, die ursprüngliche Anwendung zu dekompilieren und zu analysieren, bin aber gescheitert.  Die Werkzeuge, die ich benutzte, erlaubten mir nicht, die Logik des Kessels zu verstehen.  Alle Prozeduren und Funktionen wurden durch "Kurven" ohne Namen (nach Typ a, b, c usw.) erhalten.  Vielleicht habe ich nicht genug Erfahrung und Können.  Am Ende bin ich den gleichen Weg gegangen wie der Autor des vorherigen Artikels.  Der einzige signifikante Unterschied besteht darin, dass ich den interaktiven Modus des Dienstprogramms gatttool verwendet habe.  Der Vorteil ist, dass dieser Modus alle Arten von "Rassen" eliminiert, über die der Autor des ersten Artikels geschrieben hat. <br><br>  Da HomeAssistant in Python geschrieben ist, werden wir alle weiteren Befehle darauf schreiben.  Um den interaktiven Gatttool-Betriebsmodus in Python zu verwenden, hilft uns die pexpect-Bibliothek, mit der Sie die Essenz von Anwendungen von Drittanbietern hervorbringen und deren Ausgabe überwachen können (bekanntermaßen verbogen). <br><br><h3>  Übe </h3><br>  Ich werde den ersten Artikel über die allgemeine Beschreibung des Austauschprotokolls erneut an den Autor des Artikels senden, sodass wir ohne weiteres mit den Steuerbefehlen fortfahren werden. <br><br><ol><li>  <b>Installation und Trennung</b> <br><br>  Stellen Sie eine Verbindung her: <br><br><pre><code class="python hljs">child = pexpect.spawn(<span class="hljs-string"><span class="hljs-string">"gatttool -I -t random -b "</span></span> + mac, ignore_sighup=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">3</span></span>) child.sendline(<span class="hljs-string"><span class="hljs-string">"connect"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'Connection successful.*\[LE\]&gt;'</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre> <br>  Hier ist Mac die Mohnadresse der Teekanne. <br><br>  Wir unterbrechen die Verbindung: <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"exit"</span></span>)</code> </pre> </li><li>  <b>Benachrichtigungen abonnieren</b> <br><br>  Nachdem wir die Verbindung hergestellt haben, müssen wir uns zunächst anmelden, um Benachrichtigungen vom Wasserkocher zu erhalten.  Ohne dies nimmt die Teekanne die Befehle wahr, kann uns jedoch nur den Text „Erfolgreich“ beantworten. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-cmd 0x000c 0100"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> </li><li>  <b>Login</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"ff"</span></span> + key + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) connectedStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = connectedStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-comment"><span class="hljs-comment"># parse: 00 - no 01 - yes child.expect(r'\[LE\]&gt;')</span></span></code> </pre> <br>  Im Folgenden ist iter eine ganzzahlige iterative Hex-Variable von 0 bis 64 (von 0 bis 100 im Dezimalsystem).  Nach jedem Befehl (sowohl erfolgreich als auch erfolglos) sollte diese Variable um 1 erhöht werden. Wenn sie 64 erreicht, wird sie erneut auf 0 zurückgesetzt.  Schlüssel - Hex 8-Byte-Autorisierungsschlüssel (zum Beispiel: ffffffffffffffff). <br><br>  Antwortbeispiel: <br><blockquote>  Wert: 55 00 ff 01 aa </blockquote>  Das vierte Byte (01) bedeutet, dass der Wasserkocher Sie autorisiert hat, andernfalls lautet die Antwort 00. <br></li><li>  <b>Etwas Straßenmagie</b> <br>  Nach der Autorisierung wird immer eine "magische" Anfrage gesendet, deren Wesen mir nicht klar ist.  Es gibt eine Theorie, dass es notwendig ist, den verbundenen Zustand zu "halten".  Wenn Sie es nicht senden, erfolgt die Trennung angeblich innerhalb einer Sekunde, und Sie müssen von vorne beginnen.  Wenn Sie es senden, erhöht sich das Zeitlimit erheblich und erreicht bis zu etwa ein Dutzend Sekunden.  Bestätige dies zuverlässig, konnte ich nicht. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"01aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Antwortbeispiel: <br><blockquote>  Wert: 55 01 01 02 1d aa </blockquote><br>  In all meinen Experimenten war die Antwort immer diese. <br><br>  <b>UPD:</b> In den Kommentaren wurde vorgeschlagen, dass es überhaupt nicht magisch sei, sondern lediglich die Softwareversion anzufordern. Dementsprechend ist diese Version in der Antwort enthalten.  Somit kann diese Anforderung im Allgemeinen als unnötig entfernt werden. <br></li><li>  <b>Synchronisieren</b> <br>  Ein Befehl, der die Zeit in einer Teekanne mit einer Serveruhr synchronisiert.  Sie hat noch einen Effekt.  Im Wasserkocher ist es möglich, die aktuelle Temperatur im Leerlauf anzuzeigen, indem eine LED einer bestimmten Farbe blinkt.  Diese Funktion funktioniert nur nach der Synchronisation.  Eine Beschreibung der Funktion selbst finden Sie in Abschnitt 11. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"6e"</span></span> + timeNow + tmz + <span class="hljs-string"><span class="hljs-string">"0000aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Hier ist tmz die Zeitzone im umgekehrten Hex-Format (übersetzen Sie beispielsweise die Zeitzone +3 in Sekunden, dann in das Hex-Format und erhalten Sie hex (3 * 60 * 60) = 2a30, paarweise aufgeteilt und geben Sie 302a in umgekehrter Reihenfolge aus).  Ich weiß nicht, was ich mit negativen Zeitzonen machen soll, ich habe es nicht getestet, aber es besteht der Verdacht, dass das nächste tmz-Byte dafür verantwortlich ist.  Hier ist timeNow die aktuelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Unixtime-</a> Zeit im umgekehrten Hex-Format.  Der Algorithmus ist der gleiche: Wir erhalten die aktuelle Zeit in Sekunden, übersetzen sie in HEX, teilen sie in Paare auf und geben sie in umgekehrter Reihenfolge hintereinander aus. <br><br>  Antwortbeispiel: <br><blockquote>  Wert: 55 02 6e 00 aa </blockquote>  In all meinen Experimenten war die Antwort immer diese. <br></li><li>  <b>Statistiken</b> <br>  Der Wasserkocher hat einen Meter Stromverbrauch, Gesamtbetriebszeit und Anzahl der Starts.  Wenn jemand diese Daten nicht benötigt, können Sie diesen Artikel sicher überspringen. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"4700aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) Watts = hexToDec(str(statusStr.split()[<span class="hljs-number"><span class="hljs-number">11</span></span>] + statusStr.split()[<span class="hljs-number"><span class="hljs-number">10</span></span>] + statusStr.split()[<span class="hljs-number"><span class="hljs-number">9</span></span>])) alltime = round(self._Watts/<span class="hljs-number"><span class="hljs-number">2200</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>) child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"5000aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) times = hexToDec(str(statusStr.split()[<span class="hljs-number"><span class="hljs-number">7</span></span>] + statusStr.split()[<span class="hljs-number"><span class="hljs-number">6</span></span>])) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Watt - gibt die verbrauchte Energie in Wh * h zu jeder Zeit zurück - die Betriebsstunden des Kessels, Zeiten - die Anzahl der Starts des Kessels.  hexToDec - eine Funktion zum Konvertieren in das Dezimalformat. <br></li><li>  <b>Lesen Sie den aktuellen Betriebsmodus</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"06aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split() status = str(answer[<span class="hljs-number"><span class="hljs-number">11</span></span>]) temp = hexToDec(str(answer[<span class="hljs-number"><span class="hljs-number">8</span></span>])) mode = str(answer[<span class="hljs-number"><span class="hljs-number">3</span></span>])</code> </pre> <br>  Antwortbeispiel: <br><blockquote>  Wert: 55 04 06 00 00 00 00 01 2a 1e 00 00 00 00 00 80 00 00 aa </blockquote>  Das vierte Byte ist der Betriebsmodus (Modus): 00 - Kochen, 01 - Erhitzen auf Temperatur, 03 - Nachtlicht.  Das sechste Byte ist die Hex-Temperatur, auf die im Heizmodus erwärmt werden muss, im Siedemodus 00. Das neunte Byte ist hex die aktuelle Wassertemperatur (2a = 42 Grad Celsius).  Das zwölfte Byte ist der Zustand der Teekanne: 00 - aus, 02 - ein.  Das siebzehnte Byte ist die Dauer des Kessels nach Erreichen der gewünschten Temperatur, standardmäßig 80 in hex (anscheinend sind dies relative Einheiten, sicherlich keine Sekunden). <br></li><li>  <b>Aktuelle Betriebsart aufzeichnen</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"05"</span></span> + mode + <span class="hljs-string"><span class="hljs-string">"00"</span></span> + temp + <span class="hljs-string"><span class="hljs-string">"00000000000000000000"</span></span> + howMuchBoil + <span class="hljs-string"><span class="hljs-string">"0000aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Parametermodus: 00 - Kochen, 01 - Erhitzen auf Temperatur, 03 - Nachtlicht.  Der Temp-Parameter ist die Hex-Temperatur, auf die im „Heizmodus“ erwärmt werden muss, im Siedemodus ist es 00. Der HowMuchBoil-Parameter ist die Dauer des Kessels nach Erreichen der gewünschten Temperatur, der Standardwert ist 80 in Hex (anscheinend sind dies einige relative Einheiten sicherlich nicht Sekunden). <br><br>  Antwortbeispiel: <br><blockquote>  Wert: 55 05 05 01 aa </blockquote>  Das vierte Byte der Antwort zeigt den Erfolg der Einstellungen an: 01 - erfolgreich, 00 - nicht erfolgreich. <br></li><li>  <b>Führen Sie den aktuellen Betriebsmodus aus</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"03aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = self.child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Antwortbeispiel: <br><blockquote>  Wert: 55 06 03 01 aa </blockquote>  Das vierte Byte der Antwort zeigt den Erfolg der Aufnahme an: 01 - erfolgreich, 00 - nicht erfolgreich. <br></li><li>  <b>Stoppen Sie den aktuellen Betriebsmodus</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"04aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = self.child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Antwortbeispiel: <br><blockquote>  Wert: 55 07 04 01 aa </blockquote>  Das vierte Byte der Antwort zeigt den Erfolg des Herunterfahrens an: 01 - erfolgreich, 00 - nicht erfolgreich. <br></li><li>  <b>Zeigen Sie die aktuelle Temperatur in Farbe im Leerlauf an</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"37c8c8"</span></span> + onoff + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># 00 - off, 01 - on child.expect("value: ") child.expect("\r\n") child.expect(r'\[LE\]&gt;')</span></span></code> </pre> <br>  Der Ein-Aus-Parameter ist entweder 01, um die Funktion zu aktivieren, oder 00, um die Funktion zu deaktivieren. <br><br>  Antwortbeispiel: <br><blockquote>  Wert: 55 08 37 00 aa </blockquote>  In all meinen Experimenten war die Antwort immer diese. <br></li><li>  <b>Nehmen Sie eine Farbpalette mit verschiedenen Betriebsarten auf</b> <br>  Eine Korrespondenzpalette zwischen der Farbe der LED und der Temperatur wird im Anzeigemodus der aktuellen Temperatur und im Heiz- und Siedemodus sowie der Farbpalette im Nachtlichtmodus eingestellt. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"32"</span></span> + boilOrLight + scale_from + rand + rgb1 + scale_mid + rand + rgb_mid + scale_to + rand + rgb2 + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Der Parameter boilOrLight ist 00, wenn wir den Anzeigemodus der aktuellen Temperatur einstellen, oder 01, wenn wir den Nachtmodus einstellen.  Der Parameter scale_from gibt den Beginn des Farbwechselbereichs an und ist im Nachtlichtmodus gleich 00 und im aktuellen Temperaturanzeigemodus gleich 28 (28 ist 40 im Dezimalformat und ab dieser Temperatur beginnt ein sanfter Farbwechsel).  Der Parameter scale_mid liegt in der Mitte des Bereichs und beträgt 32 im Nachtlichtmodus und 46 im aktuellen Temperaturanzeigemodus.  Der Parameter scale_to gibt das Ende des Farbbereichs an und ist in beiden Modi 64.  Der Parameter rgb1 ist die hexadezimale Farbe am Anfang der Palette.  Der Parameter rgb_mid ist die hexadezimale Farbe der Mitte der Palette (ich berechne sie als die Mitte zwischen dem linken und rechten Ende, aber theoretisch können Sie jede Farbe angeben, dies wirkt sich nur auf die Schönheit und Glätte der Farbänderung aus).  Der Parameter rgb2 ist die hexadezimale Farbe am Ende der Palette.  Der Rand-Parameter ist ein bestimmter Parameter, dessen Wert ich nicht genau verstanden habe, vielleicht irgendwie in Bezug auf die Helligkeit der Farbe (Beispiele für Werte: e5, cc). <br><br>  Antwortbeispiel: <br><blockquote>  Wert: 55 09 32 00 aa </blockquote>  In all meinen Experimenten war die Antwort immer diese. <br></li><li>  <b>Lesen Sie die Farbpalette der verschiedenen Betriebsarten</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"33"</span></span> + boilOrLight + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = self.child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Der Parameter boilOrLight kann 00 sein - wenn wir den Anzeigemodus der aktuellen Temperatur einstellen, oder 01 - wenn wir den Nachtmodus einstellen. <br><br>  Antwortbeispiel: <br><blockquote>  Wert: 55 10 33 01 00 7f 00 00 ff 32 7f 00 ff 00 64 7f ff 00 00 aa </blockquote>  Hier ist das sechste, elfte und sechzehnte Byte (7f) der Rand-Parameter aus Punkt 12. Das fünfte Byte ist scale_from, das zehnte Byte ist scale_mid, das fünfzehnte Byte ist scale_to.  Siebte + achte + neunte Bytes sind rgb_from.  Das zwölfte + dreizehnte + vierzehnte Byte ist rgb_mid.  Siebzehntes + achtzehntes + neunzehntes Byte - rgb_to. <br></li></ol><br><h3>  Fazit </h3><br>  Wenn gatttool keine Verbindung zur Teekanne herstellen möchte (dies ist möglich, wenn Sie zum ersten Mal eine Verbindung zu unbekannten Geräten herstellen), versuchen Sie, mit os nach der Teekanne zu suchen, bevor Sie das Modul anschließen: <br><br><pre> <code class="bash hljs">sudo hciconfig device reset sudo timeout 1 hcitool lescan</code> </pre> <br><br>  Geräte-ID Ihres Bluetooth-Geräts (z. B. hci0).  Stellen Sie sicher, dass die Mohnadresse Ihres Wasserkochers in der Liste der gefundenen Geräte enthalten ist.  Danach: <br><br><pre> <code class="bash hljs">sudo hcitool lewladd mac sudo hcitool lerladd mac</code> </pre> <br><br>  mac - die Mohnadresse Ihrer Teekanne <br><br>  <b>UPD6</b> : Das <b>Wasserkochermodul wurde</b> erheblich verbessert: <br>  1. Übertragen Sie das Modul von der Plattform in den Integrationsmodus <br>  2. Nach dem Hinzufügen haben Sie automatisch 3 Elemente: einen Warmwasserbereiter (aktuelle Temperatur, Zieltemperatur, Kochen und Heizen), einen Sensor (Synchronisationszeit, Energieverbrauch, Betriebsstunden, Anzahl der Starts) und Licht (kann als Nachtlampe verwendet werden und eine beliebige Farbe auswählen Hintergrundbeleuchtung) <br>  3. Das Modul ist jetzt auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">GitHub</a> verfügbar. <br>  4. Das Modul unterstützt die Installation über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">HACS</a> <br>  5. Konfigurationsbeispiel: <br><pre> <code class="plaintext hljs">r4s_kettler: device: 'hci0' mac: 'FF:FF:FF:FF:FF:FF' password: 'ffffffffffffffff'</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Screenshots der neuen Version</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8j/gc/th/8jgcthd3i8cff7ebzchka-rsdyc.jpeg" alt="Bild"><br><img src="https://habrastorage.org/webt/bk/m7/yn/bkm7ynlfqahggnahmhfpbjb3ghe.jpeg" alt="Bild"><br><img src="https://habrastorage.org/webt/uk/wg/ve/ukwgvelc6s_evw1zzucwu_gly4w.jpeg" alt="Bild"><br><img src="https://habrastorage.org/webt/hj/wl/ft/hjwlft8f2k7yv1qjafxn2iqtcay.jpeg" alt="Bild"><br></div></div><br><br>  <b>UPD7</b> : Irrelevante Informationen <b>gelöscht</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de412583/">https://habr.com/ru/post/de412583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de412571/index.html">Kubernetes Erfolgsgeschichten in der Produktion. Teil 9: CERN- und 210 K8-Cluster</a></li>
<li><a href="../de412573/index.html">Was mit Geektimes los ist, kehre nach Habr zurück</a></li>
<li><a href="../de412575/index.html">Popmusik wird von Jahr zu Jahr eintöniger, weil die gleichen Leute sie komponieren</a></li>
<li><a href="../de412579/index.html">Marvel: Infinity War oder Wie Sie in wenigen Minuten Daten für Ihr Projekt sammeln</a></li>
<li><a href="../de412581/index.html">Von der Steinzeit bis zum Zweiten Weltkrieg: Wie Roboter zur Erforschung historischer Artefakte eingesetzt werden</a></li>
<li><a href="../de412587/index.html">Marionette + Hiera. Drücken Sie das Maximum</a></li>
<li><a href="../de412589/index.html">25 unterhaltsame Android-Bibliotheken. Frühling 2018</a></li>
<li><a href="../de412591/index.html">Jetpack bauen: Der 29. Mai ist Wendell Moores Gedenktag</a></li>
<li><a href="../de412593/index.html">Neue Produkte, Plattformen und All-as-a-Service: HPE-Webinare</a></li>
<li><a href="../de412595/index.html">Bericht des Club of Rome 2018, Kapitel 1.1.2: „Finanzierung“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>