<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😐 🚷 😉 Una pequeña puerta trasera en Flask o cómo controlar una computadora en una red local 📕 🤸 🚣🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 

 Hace poco vi la versión descargada de la secuencia de programación "Cómo construir su aplicación web de matraz". Y decidió consolidar su...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Una pequeña puerta trasera en Flask o cómo controlar una computadora en una red local</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448360/">  Hola Habr! <br><br>  Hace poco vi la versión descargada de la secuencia de programación "Cómo construir su aplicación web de matraz".  Y decidió consolidar su conocimiento en algún proyecto.  Durante mucho tiempo no supe qué escribir y se me ocurrió la idea: "¿Por qué no hacer una mini puerta trasera en Flask?". <br><br>  Las primeras opciones para la implementación y las capacidades de la puerta trasera aparecieron de inmediato en mi cabeza.  Pero decidí hacer inmediatamente una lista de características de puerta trasera: <br><br><ol><li>  Poder abrir sitios </li><li>  Tener acceso a la línea de comando </li><li>  Poder abrir programas, fotos, videos </li></ol><br>  Entonces, el primer elemento es extremadamente fácil de implementar usando el módulo webbrowser.  El segundo punto que decidí implementar usando el módulo os.  Y el tercero también es a través del módulo os, pero usaré "enlaces" (más sobre eso más adelante). <a name="habracut"></a><br><br>  <b>Ortografía del servidor</b> <br><br>  Entonces * drum roll * todo el código del servidor: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask, request <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> webbrowser <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re app = Flask(__name__) @app.route(<span class="hljs-string"><span class="hljs-string">'/mycomp'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> json_string = request.json <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> json_string[<span class="hljs-string"><span class="hljs-string">'command'</span></span>] == <span class="hljs-string"><span class="hljs-string">'test'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'The server is running and waiting for commands...'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> json_string[<span class="hljs-string"><span class="hljs-string">'command'</span></span>] == <span class="hljs-string"><span class="hljs-string">'openweb'</span></span>: webbrowser.open(url=<span class="hljs-string"><span class="hljs-string">'https://www.'</span></span>+json_string[<span class="hljs-string"><span class="hljs-string">'data'</span></span>], new=<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Site opening '</span></span> + json_string[<span class="hljs-string"><span class="hljs-string">'data'</span></span>] + <span class="hljs-string"><span class="hljs-string">'...'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> json_string[<span class="hljs-string"><span class="hljs-string">'command'</span></span>] == <span class="hljs-string"><span class="hljs-string">'shell'</span></span>: os.system(json_string[<span class="hljs-string"><span class="hljs-string">'data'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Command execution '</span></span> + json_string[<span class="hljs-string"><span class="hljs-string">'data'</span></span>] + <span class="hljs-string"><span class="hljs-string">'...'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> json_string[<span class="hljs-string"><span class="hljs-string">'command'</span></span>] == <span class="hljs-string"><span class="hljs-string">'link'</span></span>: links = open(<span class="hljs-string"><span class="hljs-string">'links.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'r'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(int(json_string[<span class="hljs-string"><span class="hljs-string">'data'</span></span>])): link = links.readline() os.system(link.split(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Launch '</span></span> + link.split(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: app.run(host=<span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>)</code> </pre> <br>  Ya descarté todo el código, es hora de explicar la esencia. <br><br>  Todo el código se ejecuta en la computadora local en el puerto 5000.  Para interactuar con el servidor, debemos enviar una solicitud JSON POST. <br><br>  Estructura de solicitud JSON: <br><br><pre> <code class="json hljs">{'command': 'comecommand', 'data': 'somedata'}</code> </pre> <br>  Bueno, es lógico que 'comando' sea el comando que queremos ejecutar.  Y 'datos' son los argumentos del comando. <br><br>  Puede escribir y enviar solicitudes JSON para interactuar con el servidor con lápices (las solicitudes lo ayudan).  O puede escribir un cliente de consola. <br><br>  <b>Escritura del cliente</b> <br><br>  Código: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests logo = [<span class="hljs-string"><span class="hljs-string">'\n\n'</span></span>, <span class="hljs-string"><span class="hljs-string">'****** ********'</span></span>, <span class="hljs-string"><span class="hljs-string">'******* *********'</span></span>, <span class="hljs-string"><span class="hljs-string">'** ** ** **'</span></span>, <span class="hljs-string"><span class="hljs-string">'** ** ** ** Written on Python'</span></span>, <span class="hljs-string"><span class="hljs-string">'******* ** **'</span></span>, <span class="hljs-string"><span class="hljs-string">'******** ** **'</span></span>, <span class="hljs-string"><span class="hljs-string">'** ** ** ** Author: ROBOTD4'</span></span>, <span class="hljs-string"><span class="hljs-string">'** ** ** **'</span></span>, <span class="hljs-string"><span class="hljs-string">'** ** ** **'</span></span>, <span class="hljs-string"><span class="hljs-string">'******** *********'</span></span>, <span class="hljs-string"><span class="hljs-string">'******* ********'</span></span>, <span class="hljs-string"><span class="hljs-string">'\n\n'</span></span>] p = <span class="hljs-string"><span class="hljs-string">''</span></span> iport = <span class="hljs-string"><span class="hljs-string">'192.168.1.2:5000'</span></span> host = <span class="hljs-string"><span class="hljs-string">'http://'</span></span> + iport + <span class="hljs-string"><span class="hljs-string">'/mycomp'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> dict = {<span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>} r = requests.post(host, json=dict) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (r.content.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logo: print(i) start() test() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: command = input(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> command == <span class="hljs-string"><span class="hljs-string">''</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> a = command.split() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> command == <span class="hljs-string"><span class="hljs-string">'test'</span></span>: dict = {<span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>} r = requests.post(host, json=dict) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (r.content.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'shell'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, len(a)): p = p + a[i] + <span class="hljs-string"><span class="hljs-string">' '</span></span> dict = {<span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'shell'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span>: p} r = requests.post(host, json=dict) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (r.content.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) p = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'link'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(a) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>: dict = {<span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'link'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span>: int(a[<span class="hljs-number"><span class="hljs-number">1</span></span>])} r = requests.post(host, json=dict) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (r.content.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'   !'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'openweb'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(a) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>: dict = {<span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'openweb'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span>: a[<span class="hljs-number"><span class="hljs-number">1</span></span>]} r = requests.post(host, json=dict) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (r.content.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'   !'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'set'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'host'</span></span>: ip = a[<span class="hljs-number"><span class="hljs-number">2</span></span>] + <span class="hljs-string"><span class="hljs-string">':5000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> command == <span class="hljs-string"><span class="hljs-string">'quit'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre><br>  Explicaciones <br><br>  El primer paso es importar el módulo de solicitudes (para interactuar con el servidor).  Descripción adicional de las funciones de inicio y prueba.  Y luego el ciclo en el que ocurre la magia.  ¿Has leído el código?  Entonces, el significado de la magia que ocurre en el ciclo es claro para ti.  Ingrese el comando: se ejecuta.  Shell: comandos para la línea de comando (la <s>lógica va por las nubes</s> ). <br><br>  Prueba: compruebe si el servidor funciona (puerta trasera) <br>  Enlace - usando un atajo <br>  Openweb - apertura del sitio web <br>  Salir - salir del cliente <br>  Establecer: configure la dirección IP de su computadora en la red local <br><br>  Y ahora más sobre el enlace. <br><br>  Al lado del servidor está el archivo link.txt.  Contiene enlaces (ruta completa) a archivos (videos, fotos, programas). <br><br>  La estructura es la siguiente: <br><br> <code>_&gt; <br> _&gt;</code> <br> <br><h4>  Resumen </h4><br>  Tenemos un servidor de puerta trasera para controlar una computadora en una red local (dentro de una red wi-fi).  Técnicamente, podemos ejecutar el cliente desde cualquier dispositivo que tenga un intérprete de Python. <br><br>  PD: agregué el comando set para que si se asigna una ip diferente a una computadora en la red local, se puede cambiar directamente en el cliente. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448360/">https://habr.com/ru/post/448360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448346/index.html">De GNU a Doom: se anuncia TechTrain 2019</a></li>
<li><a href="../448350/index.html">Implementación del diccionario en Python</a></li>
<li><a href="../448352/index.html">Boring Company cavará un túnel en Las Vegas</a></li>
<li><a href="../448354/index.html">GraphQL Voyager como herramienta para encontrar vulnerabilidades</a></li>
<li><a href="../448358/index.html">Escuchamos música y conferencias de Youtube con una pantalla de teléfono inteligente bloqueada y sin anuncios usando Telegram</a></li>
<li><a href="../448362/index.html">Pensé que necesitaba enviar diseñadores a ...</a></li>
<li><a href="../448364/index.html">Stormglass - predictores de cristales</a></li>
<li><a href="../448366/index.html">Rust 1.34 Lanzamiento</a></li>
<li><a href="../448368/index.html">SQL: la tarea del tiempo de trabajo</a></li>
<li><a href="../448372/index.html">Deja de rechazar a los que buscan trabajo con tus preguntas equivocadas.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>