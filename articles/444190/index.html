<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüè´ ‚òùüèæ üë©üèª‚Äçüåæ Crea los bordes de un mapa generado por procedimientos ü•¢ üë©üèø‚ÄçüöÄ üîî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Scott Turner contin√∫a trabajando en su juego generado por procedimientos y ahora ha decidido abordar el problema del dise√±o de los bordes de los mapas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Crea los bordes de un mapa generado por procedimientos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444190/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ce/ea0/3df/0ceea03df1f07131e0ad27e6bbd45731.png" alt="imagen"></div><br>  <i>Scott Turner contin√∫a trabajando en su juego generado por procedimientos y ahora ha decidido abordar el problema del dise√±o de los bordes de los mapas.</i>  <i>Para hacer esto, tiene que resolver varios problemas dif√≠ciles e incluso crear su propio lenguaje para describir los l√≠mites.</i> <br><br>  Las fronteras segu√≠an siendo un elemento importante de las tarjetas de fantas√≠a, que hab√≠an estado en mi lista durante bastante tiempo.  Los mapas funcionales generalmente tienen una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠nea de borde</a> simple, pero los mapas de fantas√≠a y los mapas medievales, de los cuales los primeros suelen tomar ideas, tienen l√≠mites bastante reflexivos y art√≠sticos.  Estos l√≠mites dejan en claro que el mapa se ha hecho intencionalmente fant√°stico y le dan al espectador una sensaci√≥n de asombro. <br><br>  Actualmente hay un par de formas simples de dibujar bordes en mi juego <b>Dragons Abound</b> .  Puede dibujar una l√≠nea simple o doble alrededor del per√≠metro del mapa y agregar elementos simples en las esquinas, como en estas figuras: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aed/9f8/477/aed9f8477ef53b5550b742ea1fde36b2.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cac/37e/bac/cac37ebac81815955dfc940bacdc2eff.png"></div><br>  El juego tambi√©n puede agregar un campo en la parte inferior del borde para el nombre del mapa.  Hay varias variaciones de este campo en <b>Dragons Abound</b> , incluidos elementos tan complejos como cabezas de tornillo falsas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/42f/f6f/c3a/42ff6fc3adae5b40293bb82d5a1be325.png"></div><br>  Hay variabilidad en estos campos de nombre, pero todos se crean manualmente. <br><br>  Un aspecto interesante de los l√≠mites de las tarjetas de fantas√≠a es que son creativas y de plantilla.  A menudo consisten en una peque√±a cantidad de elementos simples que se combinan de diferentes maneras para crear un resultado √∫nico.  Como siempre, el primer paso al trabajar con un nuevo tema para m√≠ es estudiar una colecci√≥n de ejemplos de mapas, crear un cat√°logo de tipos de elementos de borde y estudiar su apariencia. <br><a name="habracut"></a><br>  El borde m√°s simple es una l√≠nea que corre a lo largo de los bordes del mapa e indica sus l√≠mites.  Como dije anteriormente, tambi√©n se llama la "l√≠nea de trama": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99f/c81/c98/99fc81c98e1092077272081464d28752.png"></div><br>  Tambi√©n hay una variaci√≥n con la ubicaci√≥n de los bordes dentro del mapa.  En esta versi√≥n, el mapa alcanza los bordes de la imagen, pero el borde crea un borde virtual dentro de la imagen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43f/aef/1db/43faef1db7bf3af195c857d7ed673710.png"></div><br>  Esto se puede hacer con cualquier tipo de borde, pero generalmente se usa solo con bordes simples como el borde de un marco. <br><br>  Un concepto popular de dise√±o de tarjetas de fantas√≠a es simular como si estuvieran dibujadas en un viejo pergamino roto.  A veces esto se realiza dibujando el borde como el borde √°spero del papel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/907/cb2/ff1/907cb2ff125bbd178f9a16717e5e724f.png"></div><br>  Aqu√≠ hay un ejemplo m√°s sofisticado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/751/860/d6e/751860d6e43ed2e857cf6f3ba7f766e0.png"></div><br>  En mi experiencia, este m√©todo se ha vuelto menos popular porque las herramientas digitales se han puesto en uso.  Si desea que la tarjeta se vea como un viejo pergamino roto, entonces es m√°s f√°cil aplicarle la textura del pergamino que dibujarla a mano. <br><br>  La herramienta m√°s poderosa para crear bordes de mapa es la repetibilidad.  En el caso m√°s simple, es suficiente repetir una sola l√≠nea para crear dos l√≠neas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31d/139/e12/31d139e129fe513e07937c5a2bd88979.png"></div><br>  Puede agregar inter√©s al mapa variando el estilo del elemento repetido, en este caso combinando una sola l√≠nea gruesa con una sola l√≠nea delgada: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/530/ccd/118/530ccd11872f4aa6a32d4b3271cf94f3.png"></div><br>  Dependiendo del elemento, son posibles diversas variaciones de estilo.  En este ejemplo, la l√≠nea se repite, pero el color cambia: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc7/89e/96c/fc789e96ccfba58ac4cb595e5ec33fb7.png"></div><br>  Para crear patrones m√°s complejos, puede usar "repetibilidad repetible".  Este borde consta de aproximadamente cinco l√≠neas simples con diferentes anchos y distancias: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/488/ef4/796488ef402e59ed7e092e0e14ff2469.png"></div><br>  Este borde repite las l√≠neas, pero las separa para que se vean como dos bordes finos separados.  En esta parte de la publicaci√≥n no hablar√© sobre el procesamiento de √°ngulos, pero diferentes √°ngulos para las dos l√≠neas tambi√©n ayudan a crear esta diferencia. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/fd8/336/97bfd833697b9278660772c1bd04ee46.png"></div><br>  ¬øSon estas dos l√≠neas, cuatro o seis?  ¬°Creo que todo depende de c√≥mo los dibujes! <br><br>  Otro elemento de estilizaci√≥n es llenar el espacio entre elementos con color, patr√≥n o textura.  En este ejemplo, el borde se volvi√≥ m√°s interesante debido al relleno de color de acento entre las dos l√≠neas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d8/ccf/158/1d8ccf158b9ae0378ddaef1031ba15c9.png"></div><br>  Aqu√≠ hay un ejemplo de c√≥mo se llena el borde con un patr√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f87/37d/bb2/f8737dbb215166947e42f0da1b45cfc7.png"></div><br>  Adem√°s, los elementos se pueden dise√±ar para que se vean tridimensionales.  Aqu√≠ hay un mapa en el que el borde est√° sombreado para que parezca voluminoso: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a80/25b/695/a8025b69549773f8935d2b37680401a3.png"></div><br>  En este mapa, el borde est√° sombreado para parecer tridimensional, y esto se combina con la ubicaci√≥n de los bordes dentro de los bordes del mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36c/899/9e7/36c8999e74172c962aef40a4a9e3addc.png"></div><br>  Otro elemento de borde com√∫n es la escala en forma de rayas multicolores: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ee/f62/0b8/4eef620b830eb0249d019229140e34e6.png"></div><br>  Estas franjas forman una cuadr√≠cula ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cuadr√≠cula cartogr√°fica</a> ).  En los mapas reales, la escala ayuda a determinar las distancias, pero en los mapas de fantas√≠a es principalmente un elemento decorativo. <br><br>  Estas rayas generalmente se dibujan en blanco y negro, pero a veces se agrega rojo u otro color: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/f0f/f67/450f0ff67ac1fdf5c5e2ffaf8fbe80c0.png"></div><br>  Este elemento tambi√©n se puede combinar con otros, como en este ejemplo con l√≠neas y escala: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/313/d56/29d/313d5629d6ec8b8d7c7c4c1ead322a09.png"></div><br>  Este ejemplo es un poco inusual.  Por lo general, la escala (si la hay) es el elemento m√°s interno del borde. <br><br>  En este mapa, hay diferentes escalas con diferentes resoluciones (¬°as√≠ como notas r√∫nicas extra√±as!): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74b/cd6/217/74bcd62173160e440a4ee6cfad2128c1.png"></div><br>  (En Reddit, el usuario <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AbouBenAdhem</a> me inform√≥ que las marcas r√∫nicas son n√∫meros 48 y 47 escritos en cuneiforme babil√≥nico. Adem√°s, las ‚Äúescalas con diferentes resoluciones‚Äù tienen seis divisiones divididas en diez divisiones m√°s peque√±as, que corresponde al sistema de n√∫meros hexadecimales babilonios. Por lo general Indico las fuentes de los mapas, pero hay demasiadas piezas peque√±as en esta publicaci√≥n, as√≠ que no me molest√©. Sin embargo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este mapa fue</a> creado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Thomas Ray</a> para el autor S.E. Boleyn, por lo que tal vez la acci√≥n en sus libros tiene lugar en el s√©quito de Babilonia. <br><br>  Adem√°s de las l√≠neas y la escala, el elemento m√°s com√∫n es un patr√≥n geom√©trico repetitivo.  A menudo consta de partes como c√≠rculos, rombos y rect√°ngulos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31c/6ba/f61/31c6baf612bf2fa11a13905e4482d82e.png"></div><br>  Los elementos geom√©tricos, como las l√≠neas, se pueden sombrear para que se vean tridimensionales: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43e/cc8/c33/43ecc8c33bbf3143ba32c18b878d16e2.png"></div><br>  Se pueden crear l√≠mites complejos combinando estos elementos de diferentes maneras.  Aqu√≠ est√° el borde que combina l√≠neas, patrones geom√©tricos y escala: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Los ejemplos que se muestran arriba eran tarjetas digitales, pero, por supuesto, lo mismo se puede hacer con tarjetas escritas a mano.  Aqu√≠ hay un ejemplo de un patr√≥n geom√©trico simple creado a mano: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f7/c2d/e3d/6f7c2de3d5db82a9c7e9884d726be98e.png"></div><br>  Estos elementos tambi√©n se pueden combinar de manera flexible de muchas maneras.  Aqu√≠ hay un patr√≥n geom√©trico combinado con un "borde irregular": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fa/f1a/150/0faf1a15052e90a479428c4c495ad44c.png"></div><br>  En los ejemplos mostrados anteriormente, el patr√≥n geom√©trico es bastante simple.  Pero puede crear patrones muy complejos combinando de manera diferente los elementos geom√©tricos b√°sicos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38e/13f/fc2/38e13ffc2a2aac266aabb291a7d7f0e6.png"></div><br>  Otro elemento popular del patr√≥n es el tejido o el nudo celta: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07e/00e/8d8/07e00e8d868b6ca48be746fbe07e61ca.png"></div><br>  Aqu√≠ hay un borde de mimbre m√°s complejo que contiene color, escala y otros elementos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e1/580/140/5e158014012fffcbc51e2e3fe71772d6.png"></div><br>  En este mapa, el tejido se combina con un elemento de borde irregular: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e95/4df/588/e954df58825bc42d408b61804a1287a9.png"></div><br>  Adem√°s de los patrones geom√©tricos y el tejido, cualquier patr√≥n repetitivo puede ser parte del borde de la tarjeta.  Aqu√≠ hay un ejemplo usando formas que se asemejan a puntas de flecha: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7be/5ce/64e/7be5ce64eb09de2eeefdb18992978d03.png"></div><br>  Y aqu√≠ hay un ejemplo con un patr√≥n de onda repetitiva: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/c13/3c2/841c133c2f1c0f724b5d076e5ea415fb.png"></div><br>  Y finalmente, las runas u otros elementos del alfabeto de fantas√≠a a veces se agregan a los bordes de las tarjetas de fantas√≠a: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/6dd/3a3/15f6dd3a3e6191da02dc884193b72c82.png"></div><br>  Los ejemplos anteriores est√°n tomados de mapas modernos de fantas√≠a, pero aqu√≠ hay un ejemplo de un mapa hist√≥rico (siglo XVIII) con l√≠neas y un patr√≥n dibujado a mano: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d7/b9f/3b8/1d7b9f3b8f0c7eb296079c5f6f6b23aa.png"></div><br>  Por supuesto, puede encontrar ejemplos de mapas con muchos otros elementos en los bordes.  Algunas de las m√°s bellas est√°n completamente dibujadas a mano y tienen decoraciones tan cuidadosamente elaboradas que pueden superar la propia tarjeta ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mundo de Alma</a> , Francesca Baerald): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c7/004/e18/1c7004e186e0d2be63b98539375316ff.png"></div><br>  Tambi√©n vale la pena hablar un poco sobre <i>simetr√≠a</i> .  Al igual que la repetibilidad, la simetr√≠a es una herramienta poderosa, y los bordes del mapa son generalmente sim√©tricos o tienen elementos sim√©tricos. <br><br>  Muchos bordes del mapa son sim√©tricos de adentro hacia afuera, como en este ejemplo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/488/ef4/796488ef402e59ed7e092e0e14ff2469.png"></div><br>  Aqu√≠, el borde se compone de varias l√≠neas con y sin relleno, pero desde afuera hacia adentro idealmente se repite en relaci√≥n con el centro del borde. <br><br>  En este ejemplo m√°s complejo, el borde es sim√©trico, con la excepci√≥n de franjas de escala alternadas en blanco y negro: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e1/580/140/5e158014012fffcbc51e2e3fe71772d6.png"></div><br>  Dado que duplicar la escala no tiene sentido, a menudo se considera un elemento separado, incluso si el resto del borde es sim√©trico. <br><br>  Adem√°s de la simetr√≠a interna-externa, los bordes a menudo son sim√©tricos a lo largo de su longitud.  Algunos bordes ilustrados pueden tener un dise√±o simple que abarca toda la longitud del borde del mapa, pero en la mayor√≠a de los casos el patr√≥n es bastante corto y se repite, llenando el borde de una esquina a otra: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Observe que en este ejemplo el patr√≥n contiene un elemento que no es sim√©trico (de izquierda a derecha), pero el patr√≥n general es sim√©trico y se repite: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7be/5ce/64e/7be5ce64eb09de2eeefdb18992978d03.png"></div><br>  Una excepci√≥n notable a esta regla son los bordes llenos de runas o caracteres alfab√©ticos.  A menudo resultan ser √∫nicos, como si se escribiera un mensaje largo a lo largo de la frontera: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/6dd/3a3/15f6dd3a3e6191da02dc884193b72c82.png"></div><br>  Por supuesto, hay muchos otros ejemplos de elementos de borde de mapa que no he considerado aqu√≠, pero ya tenemos un buen punto de referencia.  En las siguientes partes, desarrollar√© varias funciones en <b>Dragons Abound</b> para describir, mostrar y generar de manera procesal bordes de mapas similares a estos ejemplos.  En la segunda parte, comenzaremos configurando el idioma para describir los bordes de los mapas. <br><br><h2>  Parte 2 </h2><br>  En esta parte, crear√© la versi√≥n inicial del lenguaje de descripci√≥n de borde de mapa (MBDL). <br><br>  ¬øPor qu√© dedicar tiempo a crear un lenguaje de descripci√≥n de l√≠mites de mapa?  En primer lugar, este ser√° el objetivo de mi generaci√≥n procesal.  M√°s adelante escribir√© un algoritmo para crear nuevos bordes de mapa, y la salida de este algoritmo ser√° una descripci√≥n del nuevo borde en MBDL.  En segundo lugar, MBDL servir√° como una representaci√≥n textual de los l√≠mites del mapa.  En particular, necesito poder guardar y reutilizar mis l√≠mites.  Para hacer esto, necesito una notaci√≥n de texto que se pueda escribir y usar para recrear el borde del mapa. <br><br>  Comenzar√© a crear MBDL definiendo el elemento m√°s simple: la l√≠nea.  La l√≠nea tiene color y ancho.  Por lo tanto, en MBDL presentar√© la l√≠nea de esta forma: <br><br><blockquote><code>L(width, color)</code> </blockquote> <br>  Aqu√≠ hay algunos ejemplos (perd√≥n por mis habilidades de Photoshop): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db2/db8/68e/db2db868ede7282a34c695f8062a691b.png"></div><br>  La secuencia de elementos se representa desde el exterior hacia el interior (*), por lo que suponemos que este es el borde en la parte superior del mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b7c/75e/b3a/b7c75eb3aefb8f77d1915166c0bdd979.png"></div><br>  Mire el segundo ejemplo: una l√≠nea con bordes se representa como tres elementos de l√≠nea separados. <br><br>  <i>(* Dibujar desde afuera hacia adentro fue una elecci√≥n arbitraria, me pareci√≥ que era m√°s natural que hacer desde adentro hacia afuera. Desafortunadamente, como result√≥ mucho m√°s tarde, hab√≠a una buena raz√≥n para trabajar en la direcci√≥n opuesta. Pronto te contar√© sobre eso, pero todo se deja en la publicaci√≥n - viejo, porque tomar√≠a mucho tiempo rehacer todas las ilustraciones)</i> <br><br>  Convenientemente, los espacios se pueden representar como l√≠neas sin color: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ba/1a4/171/0ba1a41719610641d7b5a5e26da0692e.png"></div><br>  Pero ser√≠a m√°s visual tener un elemento de espacio vertical espec√≠fico: <br><br><blockquote>  VS (ancho) </blockquote><br>  Los siguientes elementos simples son formas geom√©tricas: rayas, rombos y elipses.  Se supone que las l√≠neas se extienden a lo largo de todo el borde, por lo que no tienen una longitud expl√≠citamente especificada.  Pero las figuras geom√©tricas no pueden llenar toda la l√≠nea, por lo tanto, adem√°s del ancho (*), cada una debe tener una longitud, color de contorno, ancho de contorno y color de relleno: <br><br><blockquote> <code>B(width, length, outline, outline width, fill) <br> D(width, length, outline, outline width, fill) <br> E(width, length, outline, outline width, fill)</code> </blockquote> <br>  (* Acept√© que considerar√© el ancho en la direcci√≥n desde afuera hacia adentro, y la longitud se mide a lo largo del borde). <br><br>  Aqu√≠ hay ejemplos de formas geom√©tricas simples: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a3d/fad/cf6/a3dfadcf6a5a98a9785b0b487a6e17fc.png"></div><br>  Para que estos elementos llenen toda la longitud del borde, deben repetirse.  Para indicar el grupo de elementos que se repetir√°n para llenar la longitud del borde, uso corchetes: <br><br><blockquote> <code>[ element element element ... ]</code> </blockquote> <br>  Aqu√≠ hay un ejemplo de un patr√≥n repetitivo de rect√°ngulos y rombos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/420/d88/64e/420d8864e72e178252766172dc0320ab.png"></div><br>  A veces necesitar√© un espacio (horizontal) entre elementos de un patr√≥n repetitivo.  Aunque puede usar un elemento sin colores para crear un espacio, ser√° m√°s inteligente y m√°s conveniente tener un elemento de espacio horizontal: <br><br><blockquote> <code>HS(length)</code> </blockquote> <br>  La √∫ltima funci√≥n necesaria para esta primera iteraci√≥n de MBDL es la capacidad de apilar elementos uno encima del otro.  Aqu√≠ hay un ejemplo de borde: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ea/7e9/3f3/8ea7e93f3040563ef7ec2715ca39a14d.png"></div><br>  La forma m√°s f√°cil de describirlo es una l√≠nea amarilla ancha debajo del patr√≥n superior.  Puede implementar esto de diferentes maneras (por ejemplo, un espacio vertical negativo), pero decid√≠ usar llaves para indicar el orden de los elementos hacia adentro: <br><br><blockquote> <code>{element element element ...}</code> </blockquote> <br>  De hecho, esta entrada le dice que recuerde d√≥nde estaba el patr√≥n desde afuera hacia adentro al ingresar los corchetes, y luego regrese a este punto cuando salga de los corchetes.  Los corchetes tambi√©n se pueden considerar como una descripci√≥n de elementos que ocupan un espacio vertical.  Por lo tanto, el borde que se muestra arriba se puede describir de la siguiente manera: <br><br><blockquote> <code><b>L(1, black) <br> {L(20, yellow)} <br> VS(3) <br> [B(5, 10, black, 3, none) <br> D(5, 10, black,3,red)] <br> VS(3) <br> L(1, black)</b></code> </blockquote> <br>  Dibujamos una l√≠nea negra, nos fijamos donde estamos, dibujamos una l√≠nea amarilla y luego volvemos a la posici√≥n previamente fijada, caemos un poco, dibujamos un patr√≥n de rect√°ngulos y rombos, caemos un poco y luego dibujamos otra l√≠nea negra. <br><br>  Hay mucho m√°s por hacer en MBDL, pero esto es suficiente para describir los muchos l√≠mites de los mapas.  El siguiente paso es convertir la descripci√≥n del l√≠mite en el MBDL al borde mismo.  Esto es similar a convertir una representaci√≥n escrita de un programa de computadora (como Javascript) en la ejecuci√≥n de este programa.  La primera etapa es el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">an√°lisis l√©xico (an√°lisis) del</a> lenguaje: la transformaci√≥n del texto fuente en un borde real del mapa o en alg√∫n tipo de forma intermedia, que es m√°s f√°cil de convertir en un borde. <br><br>  El an√°lisis es un √°rea bastante bien estudiada de la inform√°tica.  Analizar un idioma no es muy simple, pero en nuestro caso es bueno (*) que MBDL sea una gram√°tica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">libre de</a> contexto.  Las gram√°ticas sin contexto se analizan con bastante facilidad, y hay muchas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramientas de an√°lisis de Javascript</a> para ellas.  Me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">decid√≠</a> por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nearley.js</a> , que parece ser bastante maduro y (m√°s importante) una herramienta bien documentada. <br><br>  <i>(* Esto no es solo suerte, me asegur√© de que el lenguaje no tuviera contexto).</i> <br><br>  No te presentar√© las gram√°ticas libres de contexto, pero la sintaxis de Nearley es bastante simple y debes entender el significado sin ning√∫n problema.  La gram√°tica Nearley consiste en un conjunto de reglas.  Cada regla tiene un car√°cter a la izquierda, una flecha y la parte derecha de la regla, que puede ser una secuencia de caracteres y no caracteres, as√≠ como varias opciones separadas por "|"  (o): <br><br><blockquote> <code><b>border -&gt; element | element border <br> element -&gt;</b> ‚Äú <b>L"</b></code> </blockquote> <br>  Cada una de las reglas dice que el lado izquierdo se puede reemplazar por cualquiera de las opciones en el lado derecho.  Es decir, la primera regla dice que un borde es un elemento, o un elemento, seguido de otro borde.  Que en s√≠ mismo puede ser un elemento, o un elemento seguido de un borde, etc.  La segunda regla dice que un elemento solo puede ser una cadena "L".  Es decir, juntas estas reglas corresponden a tales l√≠mites: <br><br><blockquote> <code><b>L <br> LLL</b></code> </blockquote> <br>  y no corresponden a tales l√≠mites: <br><br><blockquote> <code><b>X <br> L3L</b></code> </blockquote> <br>  Por cierto, si quieres experimentar con esta (o cualquier otra) gram√°tica en Nearley, entonces hay un sandbox en l√≠nea para esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Puede ingresar gram√°tica y casos de prueba para ver qu√© coincide y qu√© no. <br><br>  Aqu√≠ hay una definici√≥n m√°s completa de una l√≠nea primitiva: <br><br><blockquote> <code><b>@builtin ‚Äúnumber.ne" <br> @builtin ‚Äústring.ne" <br> border -&gt; element | element border <br> element -&gt; ‚ÄúL(" decimal ‚Äú," dqstring ‚Äú)"</b></code> </blockquote> <br>  Nearley tiene varios elementos integrados comunes, y el n√∫mero es uno de ellos.  Por lo tanto, puedo usarlo para reconocer el ancho num√©rico de una l√≠nea primitiva.  Para el reconocimiento de color, uso otro elemento incorporado y permito el uso de cualquier cadena entre comillas dobles. <br><br>  Ser√≠a bueno agregar espacios entre diferentes personajes, as√≠ que hag√°moslo.  Nearley admite clases de caracteres y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RBNF</a> para "cero o m√°s" algo con ": *", por lo que puedo usar esto para especificar "cero o m√°s espacios" y pegarlo en cualquier lugar para permitir espacios en las descripciones: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element border <br> WS -&gt; [\s]:* <br> number -&gt; WS decimal WS <br> color -&gt; WS dqstring WS <br> element -&gt; "L(" number "," color ")"</b></code> </blockquote> <br>  Sin embargo, el uso de WS en todas partes hace que sea dif√≠cil leer la gram√°tica, por lo que los abandonar√©, pero imagino que lo son. <br><br>  Un elemento tambi√©n puede ser un espacio vertical: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")"</b></code> </blockquote> <br>  Esto corresponde a tales l√≠mites <br><br><blockquote> <code><b>L(3.5,"black") VS(3.5)</b></code> </blockquote> <br>  Luego vienen las primitivas de tira, rombo y elipse. <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")"</b></code> </blockquote> <br>  Coincidir√° con tales elementos <br><br><blockquote> <code><b>B(34, 17, "white", 3, "black")</b></code> </blockquote> <br>  (Tenga en cuenta que las primitivas geom√©tricas no son "elementos" porque no pueden estar solos en el nivel superior. Deben estar encerrados en un patr√≥n). <br><br>  Tambi√©n necesito un espacio horizontal primitivo: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")"</b></code> </blockquote> <br>  Ahora agregar√© una operaci√≥n de patr√≥n (repetici√≥n).  Esta es una secuencia de uno o m√°s elementos dentro de corchetes.  Usar√© el operador RBNF ": +", que aqu√≠ significa "uno o m√°s". <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")" <br> element -&gt; "[" (geometric):+ "]"</b></code> </blockquote> <br>  Tenga en cuenta que el patr√≥n solo puede rellenarse con primitivas geom√©tricas.  No podemos, por ejemplo, colocar una l√≠nea dentro de un patr√≥n.  El elemento del patr√≥n ahora coincidir√° con algo como esto. <br><br><blockquote> <code><b>[B(34,17,"white",3,"black")E(13,21,"white",3,"rgb(27,0,0)")]</b></code> </blockquote> <br>  La √∫ltima parte del lenguaje es el operador de superposici√≥n.  Este es cualquier n√∫mero de elementos dentro de llaves. <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")" <br> element -&gt; "[" (geometric ):+ "]" <br> element -&gt; "{" (element ):+ "}"</b></code> </blockquote> <br>  lo que nos permite hacer lo siguiente: <br><br><blockquote> <code><b>{L(3.5,"rgb(98,76,15)")VS(3.5)}</b></code> </blockquote> <br>  (Tenga en cuenta que, a diferencia del operador de repetici√≥n, el operador de superposici√≥n se puede usar internamente). <br><br>  Despu√©s de limpiar la descripci√≥n y agregar espacios a los lugares necesarios, obtenemos la siguiente gram√°tica MBDL: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; (element WS):+ <br> WS -&gt; [\s]:* <br> number -&gt; WS decimal WS <br> color -&gt; WS dqstring WS <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> element -&gt; "(" WS (element WS):+ ")" <br> element -&gt; "[" WS (geometric WS):+ "]" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")"</b></code> </blockquote> <br>  Entonces, MBDL ahora est√° definido y hemos creado una gram√°tica del lenguaje.  Se puede usar con Nearley para reconocer cadenas de idioma.  Antes de profundizar en MBDL / Nearley, me gustar√≠a implementar las primitivas utilizadas en MBDL para que se pueda mostrar el l√≠mite descrito en MBDL.  Esto lo haremos en la siguiente parte. <br><br><h2>  Parte 3 </h2><br>  Ahora comenzaremos a implementar las primitivas de representaci√≥n.  (En este punto, todav√≠a no tengo que vincular el analizador a las primitivas de representaci√≥n. Para realizar pruebas, los llamar√© manualmente). <br><br>  Comencemos con la l√≠nea primitiva.  Recordemos c√≥mo se ve: <br><br><blockquote> <code><b>L(width, color)</b></code> </blockquote> <br>  Adem√°s del ancho y el color, aqu√≠ hay un par√°metro impl√≠cito: la distancia desde el borde exterior del mapa.  (Dibujo los bordes desde el borde del mapa hacia afuera. ¬°Tenga en cuenta que comenzamos desde uno diferente!) No debe apuntar al MBDL, porque el int√©rprete que ejecuta el MBDL puede rastrearlo para dibujar el borde.  Sin embargo, esto deber√≠a ser una entrada para todas las primitivas de representaci√≥n para que sepan d√≥nde dibujarlas.  Llamar√© a este par√°metro offset. <br><br>  Si solo necesitara dibujar un borde a lo largo de la parte superior del mapa, entonces la primitiva de l√≠nea ser√≠a muy simple de implementar.  Sin embargo, de hecho, tendr√© que dibujar desde arriba.  abajo, izquierda y derecha.  (Quiz√°s alg√∫n d√≠a me d√© cuenta de los bordes oblicuos o curvos, pero por ahora nos adheriremos a los bordes rectangulares est√°ndar.) Adem√°s, la longitud y la ubicaci√≥n del elemento de l√≠nea dependen del tama√±o del mapa (as√≠ como del desplazamiento).  Por lo tanto, como par√°metros, necesito todos estos datos. <br><br>  Una vez establecidos todos estos par√°metros, basta con crear una l√≠nea primitiva y usarla para dibujar una l√≠nea alrededor del mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a56/74f/785/a5674f78512bef22e569656701203401.png"></div><br>  (Tenga en cuenta que uso varias funciones de <b>Dragons Abound</b> para dibujar la l√≠nea "escrita a mano"). Intentemos crear un borde m√°s complejo: <br><br><blockquote> <code><b>L(3, black) L(10, gold) L(3, black)</b></code> </blockquote> <br>  Se ve as√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/86a/ad8/849/86aad88494c1c17f993524ef09ef9b2f.png"></div><br>  Bastante bien  Tenga en cuenta que hay lugares en los que las l√≠neas negras y la l√≠nea dorada no est√°n completamente alineadas debido a las fluctuaciones.  Si quiero deshacerme de estos puntos, entonces simplemente puede reducir la cantidad de oscilaci√≥n. <br><br>  Implementar una primitiva de espacio vertical es bastante simple;  solo realiza un incremento de desplazamiento.  Agreguemos un poco de espacio: <br><br><blockquote> <code><b>L(3, black) L(10, gold) L(3, black) <br> VS(5) <br> L(3, black) L(10, red) L(3, black)</b></code> </blockquote> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eab/471/b90/eab471b902eb44e703f460d700936937.png"></div><br>  Al dibujar l√≠neas, los √°ngulos se pueden realizar dibujando entre el desplazamiento y el dibujo a lo largo del mapa en el sentido de las agujas del reloj.  Pero, en general, necesito implementar el truncamiento en cada lado del borde del mapa para crear una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conexi√≥n angular con un bisel</a> .  Esto ser√° necesario para crear bordes con patrones que se unan correctamente en las esquinas, y en el caso general eliminar√° la necesidad de dibujar elementos con bordes en un √°ngulo que de otro modo ser√≠a necesario.  (*) <br><br>  <i>(Nota: como se dir√° en las siguientes partes, con el tiempo me negu√© a usar regiones de truncamiento al implementar √°ngulos. La raz√≥n principal es que para crear √°ngulos complejos, por ejemplo, compensaciones cuadradas:</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/fd8/336/97bfd833697b9278660772c1bd04ee46.png"></div><br>  <i>Se requieren √°reas de truncamiento cada vez m√°s complejas.</i>  <i>Adem√°s, con el tiempo, encontr√© una mejor manera de trabajar con patrones en las esquinas.</i>  <i>En lugar de regresar y reescribir esta parte del art√≠culo, decid√≠ dejarlo para ilustrar el proceso de "creatividad".)</i> <br><br>  La idea principal es truncar cada borde en diagonal y crear cuatro √°reas truncadas en las que se dibujar√° cada lado del borde: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fb/31a/cf9/9fb31acf993cde46b6a7fdc408be6afd.png"></div><br>  Al truncar, todo lo dibujado en el √°rea correspondiente se cortar√° en el √°ngulo deseado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/f00/f02/52bf00f026f6979f6425345389fa646a.png"></div><br>  Desafortunadamente, esto crea peque√±os espacios a lo largo de las l√≠neas diagonales, probablemente porque el navegador realiza imperfectamente el suavizado a lo largo del borde truncado.  La prueba mostr√≥ que un fondo brilla a trav√©s del espacio entre los dos bordes.  Fue posible solucionar esto expandiendo un poco una de las m√°scaras (la mitad del p√≠xel parece ser suficiente), pero esto a veces no resuelve el problema. <br><br>  A continuaci√≥n, debe implementar formas geom√©tricas.  A diferencia de las l√≠neas, se repiten en el patr√≥n, llenando el lado del borde del mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/420/d88/64e/420d8864e72e178252766172dc0320ab.png"></div><br>  Una persona dibujar√≠a este patr√≥n de izquierda a derecha, dibujando un rect√°ngulo, un rombo y luego repitiendo el mismo hasta que se llene todo el borde.  Por lo tanto, esto tambi√©n se puede implementar en el programa dibujando un patr√≥n a lo largo del borde.  Sin embargo, ser√° m√°s f√°cil dibujar primero todos los rect√°ngulos y luego todos los rombos.  Bastar√° con dibujar a lo largo del borde la misma figura geom√©trica a intervalos.  Y es muy conveniente que cada elemento tenga el mismo intervalo.  Por supuesto, una persona no har√≠a eso, porque es demasiado dif√≠cil organizar los elementos en los lugares correctos, pero esto no es un problema para el programa. <br><br>  Es decir, el procedimiento para dibujar formas geom√©tricas simples necesita par√°metros en los que se transfieren todas las dimensiones y colores de la figura (es decir, ancho, largo, grosor de l√≠nea, color de l√≠nea y relleno), as√≠ como la posici√≥n de inicio (que por razones que se aclarar√°n pronto, Considerar√© el centro de la figura), el intervalo de espacio horizontal para la transici√≥n entre repeticiones y el n√∫mero de repeticiones.  Tambi√©n ser√° conveniente indicar la direcci√≥n de repetici√≥n en forma de un vector [dx, dy], para que podamos realizar repeticiones de izquierda a derecha, de derecha a izquierda, arriba o abajo, simplemente cambiando el vector y el punto de partida.  P√≥ngalo todo junto y obtenga una tira de formas repetitivas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/409/bcd/c33/409bcdc33756610ac6ace2d0fde0a3a4.png"></div><br>  Usando este c√≥digo varias veces y renderizando con el mismo desplazamiento, puedo combinar las rayas en blanco y negro para crear la escala del mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b88/8f5/0d9/b888f50d9f164b9319cc8b3cf8d38588.png"></div><br>  Antes de comenzar a descubrir c√≥mo aplicar todo esto al borde real del mapa, primero implementemos la misma funcionalidad para elipses y rombos. <br><br>  Los rombos son solo rect√°ngulos con v√©rtices rotados, por lo que solo necesita hacer un peque√±o cambio en el c√≥digo.  Result√≥ que todav√≠a no tengo un c√≥digo listo para renderizar la elipse, pero es muy f√°cil tomar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">vista param√©trica de la elipse</a> y crear una funci√≥n que me d√© los puntos de la elipse: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fa/74e/079/3fa74e079dd2c29afa5acb0135d4092f.png"></div><br>  Aqu√≠ hay un ejemplo (creado manualmente) que usa las caracter√≠sticas implementadas anteriormente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf8/bf2/d39/bf8bf2d3992b34bc173622dc86c0d8b5.png"></div><br>  Para una cantidad de c√≥digo tan peque√±a, ¬°se ve bastante bien! <br><br>  Resolvamos ahora el complejo caso de los bordes con elementos repetitivos: esquinas. <br><br>  Si hay un borde con elementos repetidos, hay varias formas de resolver el problema con las esquinas.  El primero es ajustar las repeticiones para que se ejecuten en las esquinas sin un matrimonio notable: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Otra opci√≥n es detener la repetici√≥n en alg√∫n lugar cerca de la esquina en ambos lados.  Esto a menudo se hace si el patr√≥n no se puede "rotar" f√°cilmente en la esquina: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/6dd/3a3/15f6dd3a3e6191da02dc884193b72c82.png"></div><br>  La √∫ltima opci√≥n es cerrar el patr√≥n con alguna decoraci√≥n de esquina: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7be/5ce/64e/7be5ce64eb09de2eeefdb18992978d03.png"></div><br>  Alg√∫n d√≠a llegar√© a las decoraciones de las esquinas, pero por ahora usaremos la primera opci√≥n.  ¬øC√≥mo hacer que un patr√≥n de rayas o c√≠rculos "gire" en las esquinas del mapa sin espacios? <br><br>  La idea principal es colocar el elemento del patr√≥n exactamente en la esquina de modo que la mitad est√© en un borde del mapa y la otra en el adyacente.  En este ejemplo, el c√≠rculo est√° exactamente en la esquina y se puede dibujar desde cualquier direcci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  En otros casos, el elemento est√° medio dibujado en una direcci√≥n y la otra mitad en la otra, pero los bordes coinciden: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ee/f62/0b8/4eef620b830eb0249d019229140e34e6.png"></div><br>  En este caso, se dibuja una franja blanca en ambos lados, pero se conecta en la esquina sin espacios. <br><br>  Hay dos aspectos a considerar al colocar un elemento en una esquina. <br><br>  Primero, el elemento de esquina se dividir√° y reflejar√° en relaci√≥n con la diagonal que pasa por el centro del elemento.  Los elementos con simetr√≠a radial, por ejemplo, cuadrados, c√≠rculos y estrellas, no cambiar√°n su forma.  Los elementos sin simetr√≠a radial, por ejemplo, rect√°ngulos y rombos, cambiar√°n de forma al reflejar en relaci√≥n con la diagonal. <br><br>  En segundo lugar, para que los elementos de las esquinas de los dos lados se conecten correctamente, debe haber un n√∫mero entero de elementos (*) a lo largo de ambos lados del mapa.  No tienen que ser el mismo n√∫mero, pero debe haber un n√∫mero entero de elementos en ambos lados.  Si un n√∫mero fraccionario de patrones est√° contenido en un lado, entonces desde un borde el patr√≥n no coincidir√° con el lado adyacente. <br><br>  <i>(* En algunos casos, por ejemplo, con rayas largas, puede ocurrir una repetici√≥n parcial con repetici√≥n completa y los elementos se alinear√°n de todos modos. Sin embargo, el elemento de esquina resultante ser√° asim√©trico y diferir√° en longitud del mismo elemento en los lados del mapa. Un ejemplo de esto se puede ver aqu√≠:</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/263/418/110/263418110aafe94ef8c62d57e8540371.png"></div><br>  <i>Se produce una barra de escala blanca con diferentes repeticiones parciales y, como resultado, se obtiene un elemento desplazado con respecto al centro.</i>  <i>Para la escala del mapa, este no es siempre el caso, ya que muestra la distancia absoluta y no tiene que ser sim√©trica.</i>  <i>Pero para un patr√≥n decorativo, esto generalmente se ve mal).</i> <br><br>  Aqu√≠ hay un ejemplo que muestra c√≥mo se recorta un n√∫mero entero de repeticiones exactamente en la esquina: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ab/8de/0a3/8ab8de0a3452332e2813b3771091b165.png"></div><br>  Si hace lo mismo desde los cuatro lados, las esquinas coincidir√°n y el patr√≥n se ubicar√° perfectamente a lo largo de todo el borde: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dfc/c9a/e46/dfcc9ae46a68807e983705e553aa2ba3.png"></div><br>  Tras un examen cuidadoso, notar√° que el patr√≥n no ocurre exactamente en las esquinas.  La mitad del c√≠rculo en cada esquina se toma de cada lado, y estas dos mitades se dibujan independientemente a mano, por lo tanto, no son perfectas.  Pero ahora est√°n lo suficientemente cerca de esto. <br><br>  Entonces, podemos realizar una conexi√≥n perfecta del patr√≥n en las esquinas, eligiendo un n√∫mero entero de repeticiones para cada borde.  Sin embargo, la soluci√≥n a este problema no es trivial. <br><br>  Primero, supongamos que sabemos que el lado tiene 866 p√≠xeles de largo y queremos repetir el elemento 43 veces.  Luego, el elemento debe repetirse cada 20.14 p√≠xeles.  ¬øC√≥mo establecemos la longitud espec√≠fica de un elemento (y en el caso general, un patr√≥n de elementos)?  En el ejemplo anterior, agregu√© espacio adicional entre los c√≠rculos.  Pero si los c√≠rculos inicialmente se tocan, entonces esto cambiar√° el patr√≥n.  ¬øQuiz√°s vale la pena estirar los c√≠rculos para que contin√∫en toc√°ndose? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e36/2b0/ebd/e362b0ebd3fd04e5d8b00de5d3aba151.png"></div><br>  Ahora los elementos se tocan, pero los c√≠rculos se han convertido en elipses y las esquinas tienen una forma extra√±a.  (¬øRecuerda que dije que los elementos sin simetr√≠a radial cambian de forma cuando se reflejan en relaci√≥n con un √°ngulo? Para las rayas, esto no ser√° un gran problema). O quiz√°s valga la pena comprimir todos los elementos para que se toquen entre s√≠ y se ajusten en una longitud adecuada: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7c/ba8/0af/d7cba80afb431dc6c9afc52d7ad94b5c.png"></div><br>  Pero para darnos cuenta de esto, necesitamos hacer que los elementos sean mucho m√°s peque√±os de lo que eran originalmente.  Ninguna de estas opciones parece perfecta. <br><br>  El segundo problema ocurre cuando los lados de la tarjeta son de diferentes tama√±os.  Ahora tenemos que resolver el problema de encontrar un n√∫mero entero de repeticiones adecuado para ambos lados.  Ser√≠a ideal encontrar una soluci√≥n que se ajuste a ambos lados.  Pero no quiero hacer esto a costa de demasiado cambio de patr√≥n.  Puede ser mejor crear patrones ligeramente diferentes en ambos lados si ambos est√°n lo suficientemente cerca del patr√≥n original. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Y finalmente, el tercer problema surge cuando uso la funci√≥n de superponer varios elementos entre s√≠: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d9/4ed/6ac/4d94ed6acf107193f2109bd2b2f07a67.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No quiero hacer ning√∫n cambio en el patr√≥n que destruir√° la relaci√≥n entre los elementos. </font><font style="vertical-align: inherit;">Creo que con una escala adecuada, las relaciones en su conjunto se mantendr√°n, pero necesito probar esto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarea interesante, ¬øverdad? </font><font style="vertical-align: inherit;">Hasta ahora no tengo soluciones particularmente de alta calidad para ella. </font><font style="vertical-align: inherit;">¬°Quiz√°s aparecer√°n m√°s tarde!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte 4 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, hemos implementado primitivas para dibujar l√≠neas y formas geom√©tricas. Comenc√© a trabajar en el uso de formas repetitivas para llenar los bordes y habl√© sobre las dificultades de colocar patrones arbitrarios en el borde del mapa para que encajen perfectamente en las esquinas. El problema principal es que, en el caso general, debe hacer que el patr√≥n sea m√°s largo (o m√°s corto) para que se ajuste lateralmente. Las opciones para cambiar la longitud del patr√≥n (agregar o eliminar espacios, cambiar la longitud de los elementos de los patrones) conducen a varios cambios en el patr√≥n en s√≠. ¬°Parece que la tarea de seleccionar un patr√≥n entre varios elementos es muy dif√≠cil!</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando me encuentro con tareas aparentemente intransigentes, me gusta comenzar implementando una versi√≥n simple. Las tareas fallidas a menudo se pueden resolver resolviendo repetidamente problemas "simples" hasta que el resultado sea lo suficientemente bueno. Y, a veces, la implementaci√≥n de una versi√≥n simple proporciona cierta comprensi√≥n que simplifica la soluci√≥n de un problema m√°s complejo. Si no mejora y el problema sigue siendo inc√≥modo, al menos tendremos una versi√≥n simplificada que a√∫n puede ser √∫til, aunque no del todo como deber√≠a.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La forma m√°s f√°cil es cambiar la longitud del patr√≥n agregando longitudes sin cambiar nada en el patr√≥n. </font><font style="vertical-align: inherit;">B√°sicamente, esto agrega espacio en blanco al final del patr√≥n. </font><font style="vertical-align: inherit;">(Nota: es mejor distribuir el espacio vac√≠o entre todos los elementos en el patr√≥n). Vale la pena considerar que tal soluci√≥n solo puede alargar el patr√≥n. </font><font style="vertical-align: inherit;">Siempre podemos agregar espacio vac√≠o al patr√≥n, pero no podemos tomarlo si es necesario, ¬°tal vez no haya m√°s espacio vac√≠o en el patr√≥n! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con este enfoque, el algoritmo de ubicaci√≥n del patr√≥n en el lado de la tarjeta ser√° muy simple:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Divida la longitud del lado de la tarjeta por la longitud del patr√≥n y redondee hacia abajo para determinar la cantidad de repeticiones del patr√≥n que se ajusta a ese lado. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La distancia entre los elementos en este caso ser√° igual a la longitud del lado dividido por el n√∫mero de repeticiones. </font><font style="vertical-align: inherit;">(Esta es la m√°s cercana a la ubicaci√≥n original, dado que solo podemos agregar espacio).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dibuja un patr√≥n a lo largo del costado, teniendo en cuenta la distancia calculada. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fue dif√≠cil implementar este sistema. </font><font style="vertical-align: inherit;">Las esquinas tercamente no quer√≠an coincidir. </font><font style="vertical-align: inherit;">Me tom√≥ demasiado tiempo darme cuenta de que cuando el mapa no es cuadrado, no puedo dibujar √°reas de truncamiento para cuatro lados desde el centro del mapa, porque esto crea √°ngulos de truncamiento que no son iguales a 45 grados. </font><font style="vertical-align: inherit;">De hecho, las √°reas de truncamiento deben parecerse al reverso de un sobre:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b20/29a/beb/b2029abeb54302b5f7d3335a15c95f86.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando descubr√≠ esto, el algoritmo comenz√≥ a funcionar sin problemas. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(¬°Pero no olvide la nota anterior de que con el tiempo abandon√© las √°reas de truncamiento!)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqu√≠ hay un ejemplo con una relaci√≥n de aproximadamente 2: 1:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bff/739/d19/bff739d19d76fdb4db63033b970eb241.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En esta escala, es bastante dif√≠cil de notar, pero las esquinas se conectan correctamente y solo hay una ligera diferencia visual entre los lados. </font><font style="vertical-align: inherit;">En este caso, el algoritmo para alinear los patrones solo necesita insertar p√≠xeles fraccionarios, por lo que es invisible para el ojo, especialmente porque los contornos de los c√≠rculos est√°n superpuestos por un p√≠xel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ hay otro ejemplo con rayas:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa8/852/625/aa8852625e15121ce822cc6ca5fe8742.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta es la parte superior del borde cuadrado. </font><font style="vertical-align: inherit;">Aqu√≠ est√° el mismo borde en un mapa m√°s rectangular:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90d/207/9b1/90d2079b1e869c59ee204f1a75f5dbc7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ puede ver que en el lado de la tarjeta hay un espacio visualmente m√°s grande entre las bandas. </font><font style="vertical-align: inherit;">El algoritmo no debe insertar m√°s espacio que la longitud de un elemento completo; </font><font style="vertical-align: inherit;">por lo tanto, el peor de los casos ocurre cuando tenemos elementos largos y un lado corto que es ligeramente diferente de un tama√±o adecuado. </font><font style="vertical-align: inherit;">Pero en la mayor√≠a de los casos pr√°cticos, la alineaci√≥n no es muy perjudicial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ hay un ejemplo con un patr√≥n de varios elementos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d18/602/4f8/d186024f8ee1e4fbcd5918c63537a024.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqu√≠ las rayas se superponen a las rayas: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c60/af7/ad6/c60af7ad6c71ee4ef1850f0bf194af62.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puede ver que, dado que se realiza la misma alineaci√≥n para cada elemento, las franjas permanecen centradas entre s√≠. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suger√≠ que una buena soluci√≥n para colocar el patr√≥n en el costado del mapa ser√≠a dif√≠cil, pero un enfoque muy simple con la distribuci√≥n uniforme del elemento del patr√≥n para llenar el espacio deseado funciona bastante bien para muchos patrones. Este es un recordatorio para todos nosotros: no hay necesidad de asumir que la decisi√≥n debe ser complicada; ¬°puede ser m√°s f√°cil de lo que piensas! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, esta soluci√≥n no funciona para patrones con elementos conmovedores, por ejemplo, para escala de mapa. En este caso, agregar espacio desplaza los elementos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cd/d7e/27f/3cdd7e27f8c2d92be26d36e7b4807f5a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otra opci√≥n para alargar un patr√≥n, que mencion√© anteriormente, es estirar los elementos individuales del patr√≥n. </font><font style="vertical-align: inherit;">Es adecuado para algo as√≠ como un patr√≥n de escala, pero se ver√° mal en un patr√≥n con elementos sim√©tricos, porque el estiramiento los har√° asim√©tricos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La implementaci√≥n de la opci√≥n de estiramiento result√≥ ser m√°s complicada de lo que esperaba, principalmente porque tuve que estirar los elementos en diferentes bordes del mapa por diferentes tama√±os (porque el mapa puede no ser cuadrado sino rectangular), y tambi√©n cambiar din√°micamente la ubicaci√≥n de los elementos en funci√≥n de los nuevos estirados Tama√±os. </font><font style="vertical-align: inherit;">Pero despu√©s de unas horas logr√© lograr esto:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d1c/552/3c4/d1c5523c43a9828cd9c1c1bee6f4bbde.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora tengo todas las caracter√≠sticas necesarias para dibujar el borde del mapa (aunque los elementos de borde se crean manualmente): </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d2b/ccc/326/d2bccc326a0500f92267378e137e2f6e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Convert√≠ la imagen a escala de grises, porque no quer√≠a molestarme con la selecci√≥n de colores, y la tarjeta en s√≠ es bastante aburrida, pero como prueba de concepto, los bordes se ven bastante bonitos. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte 5 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la parte 2, desarroll√© la gram√°tica del lenguaje de descripci√≥n de borde de mapa (MBDL), y en las partes 3 y 4, implement√© procedimientos para ejecutar todas las primitivas del lenguaje. </font><font style="vertical-align: inherit;">Ahora trabajar√© en conectar estas partes para poder describir el borde en MBDL y dibujarlo en el mapa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la Parte 3, escrib√≠ la gram√°tica MBDL para que funcione con la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">herramienta de an√°lisis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Javascript </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Nearley</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La gram√°tica terminada se ve as√≠:</font></font><br><br><blockquote> <code><b>@builtin</b> <b>"</b> <b>number.ne"</b> <br> <b>@builtin</b> <b>"</b> <b>string.ne"</b> <br> <b>border -&gt; (element WS):+ <br> WS -&gt; [\s]:* <br> number -&gt; WS decimal WS <br> color -&gt; WS dqstring WS <br> element -&gt;</b> <b>"</b> <b>L(" number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>element -&gt;</b> <b>"</b> <b>VS(" number</b> <b>"</b> <b>)"</b> <br> <b>element -&gt;</b> <b>"</b> <b>(" WS (element WS):+</b> <b>"</b> <b>)"</b> <br> <b>element -&gt;</b> <b>"</b> <b>[" WS (geometric WS):+</b> <b>"</b> <b>]"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>B(" number</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>E(" number</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>D(" number</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>HS(" number</b> <b>"</b> <b>)"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De manera predeterminada, cuando analiza una regla con √©xito usando Nearley, la regla devuelve una matriz que contiene todos los elementos que corresponden al lado derecho de la regla. </font><font style="vertical-align: inherit;">Por ejemplo, si la regla</font></font><br><br><blockquote> <code><b>test -&gt;</b> <b>"</b> <b>A" |</b> <b>"</b> <b>B" |</b> <b>"</b> <b>C"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> combinado con una cuerda </font></font><br><br><blockquote> <code><b>A</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entonces Nearley regresar√° </font></font><br><br><blockquote> <code><b>[</b> <b>"</b> <b>A" ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una matriz con un solo valor es la cadena "A" correspondiente al lado derecho de la regla. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© devuelve Nearley cuando un elemento se analiza usando esta regla?</font></font><br><br><blockquote> <code><b>number -&gt; WS decimal WS</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay tres partes en el lado derecho de la regla, por lo que devolver√° una matriz con tres valores. </font><font style="vertical-align: inherit;">El primer valor ser√° el que devuelve la regla para WS, el segundo valor ser√° el que devolver√° la regla para decimal y el tercer valor ser√° el que devolver√° la regla para WS. </font><font style="vertical-align: inherit;">Si, usando la regla anterior, analizar√© "57", entonces el resultado ser√° el siguiente:</font></font><br><br><blockquote> <code><b>[ <br> [ " " ], <br> [ "5", "7" ], <br> [ ] <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El resultado final del an√°lisis de Nearley ser√° una matriz anidada de matrices, que es un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√°rbol de sintaxis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En algunos casos, el √°rbol de sintaxis es una representaci√≥n muy √∫til; en otros casos, no del todo. En </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , por ejemplo, dicho √°rbol no es particularmente √∫til. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afortunadamente, las reglas de Nearley pueden anular el comportamiento est√°ndar y devolver lo que quieran. De hecho, la regla (integrada) para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">decimal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no devuelve una lista de n√∫meros, devuelve el n√∫mero Javascript equivalente, que en la mayor√≠a de los casos es mucho m√°s √∫til, es decir, el valor de retorno de la regla </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">num√©rica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiene la forma:</font></font><br><br><blockquote> <code><b>[ <br> [ " " ], <br> 57, <br> [ ] <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las reglas de Nearley redefinen el comportamiento est√°ndar agregando un postprocesador a la regla, tomando una matriz est√°ndar y reemplaz√°ndola por lo que necesita. Un postprocesador es solo c√≥digo Javascript dentro de par√©ntesis especiales al final de una regla. Por ejemplo, en la regla del </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">nunca me interesan los espacios posibles a cada lado del n√∫mero. Por lo tanto, ser√≠a conveniente que la regla simplemente devolviera un n√∫mero y no una matriz de tres elementos. Aqu√≠ hay un postprocesador que realiza esta tarea:</font></font><br><br><blockquote> <code><b>number -&gt; WS decimal WS {% default =&gt; default[1] %}</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este postprocesador toma el resultado est√°ndar (la matriz de tres elementos que se muestra arriba) y lo reemplaza con el segundo elemento de la matriz, que es el n√∫mero Javascript de la regla </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">decimal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Entonces ahora la regla </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">num√©rica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devuelve el n√∫mero real. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta funcionalidad se puede utilizar para procesar un idioma entrante en un idioma intermedio, con el que es m√°s f√°cil trabajar. </font><font style="vertical-align: inherit;">Por ejemplo, puedo usar la gram√°tica Nearley para convertir una cadena MBDL en una matriz de estructuras Javascript, cada una de las cuales representa una primitiva identificada por un campo "op". </font><font style="vertical-align: inherit;">La regla para la l√≠nea primitiva se ver√° as√≠:</font></font><br><br><blockquote> <code><b>element -&gt;</b> <b>"</b> <b>L(" number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)" {% data=&gt; {op:</b> <b>"</b> <b>L", width: data[1], color: data[3]} %}</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es decir, el resultado del an√°lisis "L (13, negro)" ser√° la estructura de Javascript: </font></font><br><br><blockquote> <code><b>{op:</b> <b>"</b> <b>L", width: 13, color:</b> <b>"</b> <b>black"}</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de agregar el procesamiento posterior apropiado, el resultado devuelto por la gram√°tica puede ser una secuencia (matriz) de estructuras de operaci√≥n para la l√≠nea entrante. </font><font style="vertical-align: inherit;">Es decir, el resultado de analizar la cadena</font></font><br><br><blockquote> <code><b>L( 415, ‚Äúblack") <br> VS(5) <br> [B(1, 2, ‚Äúblack", 3, ‚Äúwhite") HS(5) E(1, 2, ‚Äúblack", 3, ‚Äúwhite")]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° </font></font><br><br><blockquote> <code><b>[ <br> {op: "L", width: 415, color: "black"}, <br> {op: "VS", width: 5}, <br> {op: "P", <br> elements: [{op: "B", width: 1, length: 2, <br> olColor: "black", olWidth: 3, <br> fill: "white"}, <br> {op: "HS", width: 5}, <br> {op: "E", width: 1, length: 2, <br> olColor: "black", olWidth: 3, <br> fill: "white"}]} <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que es mucho m√°s f√°cil de procesar para crear un borde de mapa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este punto, puede tener una pregunta: si la fase de posprocesamiento de la regla Nearley puede contener alg√∫n Javascript, ¬øpor qu√© no omitir la vista intermedia y simplemente dibujar el borde del mapa durante el postprocesamiento? </font><font style="vertical-align: inherit;">Para muchas tareas, este enfoque ser√≠a ideal. </font><font style="vertical-align: inherit;">Decid√≠ no usarlo por varias razones.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En primer lugar, en MBDL hay un par (*) de componentes que no se pueden ejecutar durante el proceso de an√°lisis. Por ejemplo, no podemos dibujar elementos geom√©tricos repetitivos (tira o rombo) durante el proceso de an√°lisis, porque necesitamos conocer informaci√≥n de otros elementos en el mismo patr√≥n. En particular, necesitamos saber la longitud total del patr√≥n para comprender hasta qu√© punto debemos organizar las repeticiones de cada elemento individual. Es decir, el elemento del patr√≥n a√∫n debe crear una representaci√≥n intermedia de todos los elementos geom√©tricos. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(* Hay otros componentes con limitaciones similares de los que a√∫n no he hablado).</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En segundo lugar, Javascript en Nearley est√° integrado en las reglas, por lo que no podremos pasar informaci√≥n adicional a Javascript, a excepci√≥n de las variables globales. Por ejemplo, para dibujar el borde, necesito saber el tama√±o del mapa, las cuatro √°reas de truncamiento utilizadas, etc. Aunque puedo agregar c√≥digo que haga que esta informaci√≥n est√© disponible para los posprocesadores de Nearley, ser√° un poco complicado y puede ser dif√≠cil mantener dicho c√≥digo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por estas razones, estoy analizando una representaci√≥n intermedia, que luego se ejecuta para crear el borde del mapa en s√≠.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El siguiente paso es desarrollar un int√©rprete que reciba una representaci√≥n intermedia de MBDL y la ejecute para generar l√≠mites de mapa. Esto no es muy dif√≠cil de hacer. B√°sicamente, el trabajo es establecer las condiciones iniciales (por ejemplo, generar regiones de truncamiento para los cuatro lados del mapa) e iterar sobre la secuencia de estructuras de la representaci√≥n intermedia con cada ejecuci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay un par de momentos resbaladizos.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero, necesito pasar de renderizar desde adentro a dibujar desde adentro hacia afuera. La raz√≥n es porque quiero que la mayor√≠a de los bordes no se superpongan con el mapa, as√≠ que necesito dibujar los bordes para que las l√≠neas del borde interior coincidan con los bordes del mapa. Si dibujo desde afuera hacia adentro, entonces necesito saber el ancho del borde antes de comenzar a dibujar para que el borde no se superponga con el mapa. Si dibujo de adentro hacia afuera, empiezo desde el borde del mapa y dibujo. Tambi√©n le permite imponer opcionalmente un borde en el mapa; simplemente comience el borde con un espacio vertical negativo (VS).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otro punto dif√≠cil son los patrones repetitivos. </font><font style="vertical-align: inherit;">Para dibujar patrones repetitivos, necesito mirar todos los elementos del patr√≥n y determinar el m√°s ancho, porque establecer√° el ancho de todo el patr√≥n. </font><font style="vertical-align: inherit;">Tambi√©n necesito mirar y seguir la longitud del patr√≥n para saber cu√°nta distancia dejar antes de cada repetici√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ hay un ejemplo de un borde bastante complejo que us√© para probar el int√©rprete:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c8/88a/2a9/3c888a2a96352845f6165f5eca7f6ab3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Creo que fue posible (¬ønecesario?) Adjuntarlo para probar al analizador, pero para este borde acabo de crear una vista intermedia manualmente: </font></font><br><br><blockquote> <code><b>[ <br> {op:'P', elements: [ <br> {op:'B', width: 10, length: 37, lineWidth: 2, color: 'black', fill: 'white'}, <br> {op:'B', width: 10, length: 37, lineWidth: 2, color: 'black', fill: 'black'}, <br> ]}, <br> {op:'VS', width: 2}, <br> {op:'L', width:3, color: 'black'}, <br> {op:'PUSH'}, <br> {op:'L', width:10, color: 'rgb(222,183,64)'}, <br> {op:'POP'}, <br> {op:'PUSH'}, <br> {op:'P', elements: [ <br> {op:'E', width: 5, length: 5, lineWidth: 1, color: 'black', fill: 'red'}, <br> {op:'HS', length: 10}, <br> ]}, <br> {op:'L', width:3, color: 'black'}, <br> {op:'POP'}, <br> {op:'VS', width: 2}, <br> {op:'P', elements: [ <br> {op:'E', width: 2, length: 2, lineWidth: 0, color: 'black', fill: 'white'}, <br> {op:'HS', length: 13}, <br> ]}, <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cre√© esta vista a trav√©s de prueba y error. Sea como fuere, ¬°el int√©rprete funciona! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como √∫ltimo paso, perm√≠tanme usar el analizador para crear una vista intermedia de la versi√≥n MBDL. No hay mucho que mostrarme aqu√≠: tuve que arreglar algunos nombres de campo, pero de lo contrario el c√≥digo funcion√≥ bien. Para el borde, utilic√© una versi√≥n ligeramente diferente de MBDL:</font></font><br><br><blockquote> <code><b>[B(5,37,"black",2,"white") B(5,37,"black",2,"black")] <br> VS(3) <br> L(3,"black") <br> {L(10,"rgb(222,183,64)")} <br> [E(5,5,"black",1,"red") HS(-5) E(2,2,"none",0,"white") HS(10)] <br> L(3,"black")</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ella dibuja el mismo borde, pero de una manera ligeramente diferente. </font><font style="vertical-align: inherit;">Tambi√©n cambi√© la sintaxis de la superposici√≥n, reemplazando los par√©ntesis con llaves para que sea m√°s diferente de la otra sintaxis. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para mostrar por qu√© quer√≠a dibujar de adentro hacia afuera, y no solo colocar autom√°ticamente el borde en el exterior del mapa, puedo agregar un espacio vertical negativo al comienzo de este borde para mover la escala del mapa dentro del borde del mapa:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ce/ea0/3df/0ceea03df1f07131e0ad27e6bbd45731.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora tengo la mayor parte de la infraestructura necesaria para la generaci√≥n procesal de los bordes del mapa: un lenguaje de descripci√≥n de l√≠mites, un analizador de idiomas y procedimientos para realizar una representaci√≥n intermedia. </font><font style="vertical-align: inherit;">Solo queda lidiar con la parte dif√≠cil: ¬°la generaci√≥n procesal!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte 6 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora que se ha implementado todo el MBDL, ten√≠a la intenci√≥n de proceder a la generaci√≥n procesal de los bordes del mapa, pero a√∫n no estoy seguro de c√≥mo quiero hacer esto, porque me demorar√© un poco e implementar√© un par de caracter√≠sticas m√°s de MBDL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la primera discusi√≥n sobre el procesamiento de esquinas con patrones, habl√© sobre un par de enfoques diferentes. Al final, me di cuenta de las esquinas biseladas, pero hab√≠a una segunda opci√≥n: detener el patr√≥n cerca de la esquina, como en estos ejemplos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b7/94d/01b/3b794d01b552c42ed9b8362f5405ff9d.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee2/3a8/159/ee23a8159d81afd1f7c95c16a90bcdf7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tal soluci√≥n se usa a menudo cuando el patr√≥n de borde es alg√∫n tipo de figura asim√©trica, runas u otra cosa que no se puede girar 90 grados, mientras se mantiene la alineaci√≥n. Pero es obvio que esto funcionar√° con formas geom√©tricas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta puede ser la opci√≥n que elija antes de generar el borde, pero puede agregar un poco de flexibilidad si lo habilita desde una parte del borde y usa la esquina biselada en la otra. Para hacer esto, tengo que agregar un nuevo comando a MBDL. Sospecho que pueden surgir otras opciones para diferentes partes del borde, por lo que agregar√© un comando de opciones generales:</font></font><br><br><blockquote> <code><b>element -&gt; "O(MITER)"</b> <br> <b>element -&gt; "O(STOPPED)"</b> <br> <b>element -&gt; "O(STOPPED," number ")"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Aqu√≠ nuevamente, para mayor claridad, omitimos espacios y algunos otros detalles). Hasta ahora, las √∫nicas opciones son "MITRE" para esquinas biseladas y "DETENIDO" para detenerse cerca de esquinas. </font><font style="vertical-align: inherit;">Si no se transmite ning√∫n valor DETENIDO, el programa detiene el patr√≥n a una distancia razonable de la esquina. </font><font style="vertical-align: inherit;">Si se transmite el valor, el patr√≥n se detiene a esa distancia de la esquina. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si se usan esquinas DETENIDAS, entonces dejo de dibujar el patr√≥n de esquina lejos de las esquinas.</font></font> As√≠ es como se ve: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8e/5df/49e/a8e5df49eecf2ebc5e94e571cb7d0ff8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠, utilic√© la opci√≥n MITRE para el patr√≥n de escala en blanco y negro, por lo que se refleja con respecto al √°ngulo. </font><font style="vertical-align: inherit;">Para un patr√≥n de c√≠rculos rojos y cuadrados negros dentro de una l√≠nea dorada (y para un patr√≥n de c√≠rculos fuera del borde), utilic√© DETENIDO. </font><font style="vertical-align: inherit;">Puedes ver que estos dos patrones terminan cerca de la esquina.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, hay un par de problemas. En primer lugar, vemos que a la izquierda el elemento m√°s cercano a la esquina es un cuadrado negro, y en la parte superior hay un c√≠rculo rojo. Sucedi√≥ porque la esquina est√° cerca del comienzo de la repetici√≥n en un lado y cerca del final de la repetici√≥n en el otro. Pero se ve raro. Ser√≠a mejor si las esquinas fueran sim√©tricas, incluso si para esto tuvi√©ramos que agregar otro elemento al final del patr√≥n. En segundo lugar, puede ver que el patr√≥n fuera del borde (semic√≠rculos y puntos negros) tambi√©n termina en una repetici√≥n en la esquina. Pero como la longitud de esta repetici√≥n es mucho menor que la longitud de los c√≠rculos rojos / cuadrados negros, terminan en diferentes lugares. Probablemente ser√≠a mejor si todos los patrones se detuvieran a la misma distancia de la esquina.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para solucionar el primer problema, debe agregar otra repetici√≥n del primer elemento del patr√≥n al final de cada lado del borde. </font><font style="vertical-align: inherit;">Pero en realidad es un poco m√°s complicado, porque podr√≠a usar un desplazamiento horizontal negativo dentro del patr√≥n para superponer varios elementos (como se hace aqu√≠). </font><font style="vertical-align: inherit;">Tambi√©n debe agregar otra repetici√≥n a cualquier elemento del patr√≥n que tenga el mismo punto de inicio que el primer elemento.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c4/331/6fc/9c43316fcd44d79a0b2374401a46240a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora el patr√≥n es sim√©trico con respecto al √°ngulo y se ve mucho mejor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A continuaci√≥n, necesito rastrear el patr√≥n STOPPED m√°s largo y detener cada patr√≥n STOPPED a esta distancia:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a33/920/c6c/a33920c6cda9072bbda915544f1f4926.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora el patr√≥n de c√≠rculos blancos se deja de lado m√°s, pero a√∫n no est√° alineado con el patr√≥n de c√≠rculos rojos. </font></font> Por qu√©<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto sucedi√≥ porque el patr√≥n de c√≠rculo blanco est√° m√°s lejos del borde del mapa y el borde es m√°s largo que donde se dibuja el patr√≥n de c√≠rculo rojo. </font><font style="vertical-align: inherit;">Para solucionar este problema, tambi√©n debe mover los patrones y considerar su desplazamiento en relaci√≥n con el borde del mapa.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70b/574/2c1/70b5742c1d4f404335b97128f09d6baf.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora todo est√° bellamente alineado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La segunda opci√≥n para los √°ngulos son los desplazamientos cuadrados en las esquinas, por ejemplo, estos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cac/37e/bac/cac37ebac81815955dfc940bacdc2eff.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Ser√° mucho m√°s dif√≠cil implementar esto! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, la gram√°tica de esta opci√≥n es simple y utiliza el c√≥digo de operaci√≥n Opci√≥n:</font></font><br><br><blockquote> <code><b>element -&gt; "O(SQOFFSET)"</b> <br> <b>element -&gt; "O(SQOFFSET," number ")"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El n√∫mero indica el tama√±o del desplazamiento cuadrado para el elemento en el borde del mapa; </font><font style="vertical-align: inherit;">Los elementos con diferentes desplazamientos deben alinearse en consecuencia. </font><font style="vertical-align: inherit;">Si no hay un n√∫mero, el programa selecciona el tama√±o de desplazamiento apropiado. </font><font style="vertical-align: inherit;">Poner a cero el n√∫mero desactiva el desplazamiento cuadrado. </font><font style="vertical-align: inherit;">Esto le permite crear bordes en los que algunos elementos usan desplazamientos cuadrados, mientras que otros no, como en este borde:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/fd8/336/97bfd833697b9278660772c1bd04ee46.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo primero que me di cuenta fue que necesitar√≠a √°reas de truncamiento adicionales porque utilizo el truncamiento para procesar lugares donde la frontera cambia de direcci√≥n. </font><font style="vertical-align: inherit;">SQOFFSET requerir√° √°reas de truncamiento m√°s complejas; </font><font style="vertical-align: inherit;">Tambi√©n necesitar√° √°reas separadas para diferentes elementos cuando active y desactive SQOFFSET. </font><font style="vertical-align: inherit;">Dado que las √°reas de truncamiento agregan artefactos no deseados de todos modos, esto parece demasiado trabajo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando trabaj√© en patrones escalables anteriores, implement√© el llenado de un patr√≥n asim√©trico para agregar otra repetici√≥n desde un extremo del patr√≥n. Tambi√©n me di cuenta de que esto eliminar√≠a la necesidad de esquinas biseladas. Simplemente dibujar√© todos los patrones a lo largo del borde en el sentido de las agujas del reloj, comenzando el patr√≥n en una esquina y terminando cerca de la siguiente esquina. Esto me permitir√° deshacerme de las √°reas de truncamiento. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo m√°s importante en esta nueva forma de trabajar con esquinas fue que el primer elemento del patr√≥n ya no est√° "dividido" en dos lados. Si observa los patrones de escala en blanco y negro en los mapas de arriba, puede ver que hay un rect√°ngulo blanco que pasa por la esquina. Ahora el rect√°ngulo blanco colindar√° con la esquina:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ead/909/c83/ead909c83fa91ff80af290ab92ca9fae.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los mapas se dibujan en ambos sentidos, pero este no es un gran problema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para empezar, implement√© compensaciones para l√≠neas. </font><font style="vertical-align: inherit;">Para hacer esto, fue suficiente girar la l√≠nea en relaci√≥n con los √°ngulos correspondientes:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c2/bf6/2fd/9c2bf62fdfec732f56361f4aa17fc19e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como puedes entender, puedo combinar √°ngulos con desplazamientos y √°ngulos regulares, como en el mapa de arriba: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0b/f5b/e02/e0bf5be02606044dd5fba4f82d3dad67.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por supuesto, dar vuelta los patrones a la vuelta de la esquina es m√°s dif√≠cil. </font><font style="vertical-align: inherit;">La idea general es dibujar de una esquina a casi la otra, y as√≠ sucesivamente a lo largo del borde, hasta volver al principio. </font><font style="vertical-align: inherit;">Te√≥ricamente es suficiente dibujar solo patrones horizontales y verticales, y todo debe estar bellamente alineado; </font><font style="vertical-align: inherit;">En realidad, rastrear todo esto es bastante triste. </font><font style="vertical-align: inherit;">De hecho, tuve que reescribir completamente el c√≥digo dos veces y escribir un mont√≥n de papel, pero no hablar√© sobre esto en detalle. </font><font style="vertical-align: inherit;">Solo muestra el resultado:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/912/35b/889/91235b889603c973fcfe094a1614a993.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una ilusi√≥n √≥ptica molesta surge en las esquinas: el elemento de la esquina parece no centrado m√°s cerca del exterior de la esquina. </font><font style="vertical-align: inherit;">De hecho, esto no es cierto, pero parece que s√≠, porque m√°s cerca del interior de la esquina hay m√°s espacio visualmente vac√≠o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como los segmentos de los √°ngulos de desplazamiento son bastante cortos, es muy f√°cil crear un patr√≥n de no equilibrio en la esquina:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1b/601/dff/b1b601dffc11782fb8cbe738a906b0e5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A veces se ve bastante feo. </font><font style="vertical-align: inherit;">Me record√≥ a un viejo chiste:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paciente: "Doctor, cuando hago esto, me duele". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Doctor: "¬°Entonces no hagas eso!"</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, intentar√© no hacerlo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo general, no dibujar√© la escala del mapa a lo largo del √°ngulo de desplazamiento, pero si lo necesito, necesitar√© usar la opci√≥n que estira el patr√≥n para que la escala del mapa encaje en la esquina sin espacios entre los rect√°ngulos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26f/a88/0da/26fa880da6d00d380afdae60c489dd9c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado, puede ver que el tama√±o de los rect√°ngulos de escala var√≠a notablemente. </font><font style="vertical-align: inherit;">Es decir, esta no es una muy buena opci√≥n. </font><font style="vertical-align: inherit;">(Por cierto, los √°ngulos de desplazamiento tambi√©n tienen un error en el patr√≥n de c√≠rculos. M√°s tarde lo arregl√©, pero como dije, es muy dif√≠cil hacerlo.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el patr√≥n es demasiado grande para caber en el segmento del √°ngulo de desplazamiento, entonces el algoritmo simplemente se rinde:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/044/b2d/b4d044b2dc2bf23cd670113476b9803d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo cual est√° lejos de ser ideal, pero, como dije anteriormente, "Entonces no lo hagas". </font><font style="vertical-align: inherit;">(En realidad, no es muy dif√≠cil agregar una funci√≥n de compresi√≥n o estiramiento si la necesito). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© sucede si uso ambas esquinas de desplazamiento y la opci√≥n que detiene los patrones en frente de las esquinas? </font><font style="vertical-align: inherit;">En este caso, me detengo no lejos de las esquinas desplazadas:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/170/d60/9c1/170d609c1b789359490e35741215ba04.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Me parece que esta es una decisi√≥n l√≥gica. </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/444190/">https://habr.com/ru/post/444190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444178/index.html">9 consejos para crear juegos independientes de un solo desarrollador</a></li>
<li><a href="../444182/index.html">Ir condiciones y sus rarezas</a></li>
<li><a href="../444184/index.html">Sobre las perspectivas de los centros de datos premontados</a></li>
<li><a href="../444186/index.html">Aleteo 1.2. Que hay de nuevo</a></li>
<li><a href="../444188/index.html">CG Pods: auriculares TWS que podr√≠an</a></li>
<li><a href="../444192/index.html">API Management Mitap - Experiencia IBM, Google, Yandex y Leroy Merlin - Registro disponible</a></li>
<li><a href="../444198/index.html">Dropbox limita la sincronizaci√≥n: ahora solo 3 dispositivos</a></li>
<li><a href="../444200/index.html">Sesi√≥n de resoluci√≥n de problemas</a></li>
<li><a href="../444204/index.html">Introducci√≥n de pruebas en Python. Parte 3</a></li>
<li><a href="../444206/index.html">27 de marzo, Mosc√∫ - JavaScript MeetUP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>