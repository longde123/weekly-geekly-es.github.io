<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚ÄçüöÄ üîí üëåüèª Escrevendo TodoMVC no dap. Parte 2 ü§∂üèΩ üå∂Ô∏è üî∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta √© a segunda parte final do tutorial em que escrevemos o cliente TodoMVC usando a estrutura ds js reativa minimalista. 

 Resumo da primeira parte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escrevendo TodoMVC no dap. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481680/">  Esta √© a segunda parte final do tutorial em que escrevemos o cliente TodoMVC usando a estrutura <a href="https://dap.js.org/" rel="nofollow">ds</a> js reativa minimalista. <br><br>  Resumo da <a href="https://habr.com/en/post/480912/">primeira parte</a> : recebemos uma lista de tarefas do servidor no formato JSON, constru√≠mos uma lista HTML, adicionamos a capacidade de editar o nome e o sinal de conclus√£o de cada caso e implementamos uma notifica√ß√£o do servidor sobre essas edi√ß√µes. <br><br>  Resta realizar: exclus√£o de casos arbitr√°rios, adi√ß√£o de novos casos, instala√ß√£o / redefini√ß√£o em massa e filtragem de casos com base na conclus√£o e na fun√ß√£o de excluir todos os casos conclu√≠dos.  √â isso que faremos.  A vers√£o final do cliente, a qual abordaremos neste artigo, pode ser vista <a href="https://dap.js.org/samples/tutorial/16.html" rel="nofollow">aqui</a> . <br><br><a name="habracut"></a><br><br>  A op√ß√£o que escolhemos da √∫ltima vez pode ser atualizada <a href="https://dap.js.org/samples/tutorial/7-3.html" rel="nofollow">aqui</a> . <br><br>  Aqui est√° o c√≥digo dele: <br><br><pre><code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#header'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#main'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#toggle-all type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch=; a!"</span></span> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$patch=($completed=#.checked)"</span></span>) ,<span class="hljs-string"><span class="hljs-string">'LABEL.view'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing:!; ! .title"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"dblclick"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing=`yes"</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT.edit'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing; !! .title@value"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$patch=(.title=#.value)"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"blur"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing="</span></span>) ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) .a(<span class="hljs-string"><span class="hljs-string">"!? $completed $editing"</span></span>) .u(<span class="hljs-string"><span class="hljs-string">"? $patch; (@method`PATCH .url:dehttp headers $patch@):query $patch="</span></span>) ) ) ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ) .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"//todo-backend-express.herokuapp.com/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: {<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>:<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>} }) .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">dehttp</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">=&gt;</span></span>url.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^https?\:/</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>) } }) .RENDER()</code> </pre> <br><br>  Agora, existem apenas cinquenta linhas aqui, mas at√© o final do artigo, haver√° duas vezes mais - at√© 100. Haver√° muitas solicita√ß√µes HTTP para o servidor; portanto, abra as ferramentas do desenvolvedor (no Chrome, como voc√™ se lembra, Ctrl + Shift + I) - haver√° Primeiro, a guia Rede √© interessante e, em segundo lugar, o console.  Al√©m disso, n√£o se esque√ßa de visualizar o c√≥digo de cada vers√£o da nossa p√°gina - no Chrome, √© Ctrl + U. <br><br>  Aqui eu tenho que fazer uma pequena digress√£o.  Se voc√™ n√£o leu a <a href="https://habr.com/en/post/480912/">primeira parte do</a> tutorial, ainda recomendo come√ßar com ele.  Se voc√™ o leu, mas n√£o entendeu nada, √© melhor l√™-lo novamente.  Como mostram os coment√°rios nos meus dois artigos anteriores, a sintaxe e o princ√≠pio da dap nem sempre s√£o imediatamente entendidos por um leitor despreparado.  Outro artigo n√£o √© recomendado para leitura para pessoas que se sentem desconfort√°veis ‚Äã‚Äãcom a apar√™ncia de sintaxe n√£o semelhante a si. <br><br><img src="https://habrastorage.org/webt/wj/-n/br/wj-nbrh5eflirkcich69glgnooo.jpeg"><br><br>  Esta segunda parte do tutorial ser√° um pouco mais complicada e interessante que a primeira.  <i>[TODO: pe√ßa <a href="https://habr.com/en/users/token/" class="user_link">ao token para</a> encontrar uma imagem de c√©rebro explodindo de um aluno na internet]</i> . <br><br>  Com sua permiss√£o, continuarei a numerar os cap√≠tulos com a parte 1.  L√° contamos at√© 7. Ent√£o, <br><br><h2>  8. Fazendo uma lista de tarefas da vari√°vel de estado </h2><br>  Para remover um caso da lista, existe um bot√£o <code>BUTTON.destroy</code> .  A remo√ß√£o consiste em enviar uma solicita√ß√£o DELETE para o servidor e remover de vista o elemento <code>UL#todo-list &gt; LI</code> correspondente <code>UL#todo-list &gt; LI</code> com todo o conte√∫do.  Com o envio de uma solicita√ß√£o DELETE, tudo fica claro: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.ui(<span class="hljs-string"><span class="hljs-string">"(@method`DELETE .url:dehttp):query"</span></span>)</code> </pre><br><br>  Mas com a remo√ß√£o de um elemento da tela, s√£o poss√≠veis op√ß√µes.  Pode-se simplesmente introduzir outra vari√°vel de estado, digamos <code>$deleted</code> , e ocultar o elemento com CSS, incluindo a classe CSS <code>deleted</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch= $deleted=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  $deleted   "" ... ,'BUTTON.destroy'.d("(@method`DELETE .url:dehttp):query $deleted=`yes") //  $deleted -     ) .a("!? $completed $editing $deleted") //   CSS  .deleted{display:none}</span></span></code> </pre><br><br>  E funcionaria.  Mas seria trapa√ßa.  Al√©m disso, mais adiante, teremos filtros e contadores de casos ativos e conclu√≠dos (o que est√° em <code>#footer</code> ).  Portanto, √© melhor remover imediatamente o objeto da lista de tarefas com honestidade, "fisicamente".  Ou seja, precisamos da capacidade de modificar a pr√≥pria matriz, que recebemos inicialmente do servidor - o que significa que essa matriz tamb√©m deve se tornar uma vari√°vel de estado.  Vamos cham√°-la de <code>$todos</code> . <br><br>  O escopo da vari√°vel <code>$todos</code> √© selecionar o ancestral comum de todos os elementos que acessar√£o essa vari√°vel.  E ser√° acessado por <code>INPUT#new-todo</code> partir de <code>#header</code> e contadores de <code>#footer</code> e, na verdade, <code>UL#todo-list</code> .  O ancestral comum de todos eles √© o elemento raiz do modelo, <code>#todoapp</code> .  Portanto, em sua regra d, definiremos a vari√°vel <code>$todos</code> .  No mesmo local, enviamos imediatamente os dados do servidor para ele.  E para criar a lista <code>UL#todo-list</code> , agora tamb√©m faremos dela: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$todos=todos:query"</span></span> <span class="hljs-comment"><span class="hljs-comment">//   $todos      ... ,'UL#todo-list'.d("*@ $todos" //     $todos</span></span></code> </pre><br><br>  <b>√â importante.</b>  Se durante o teste repentinamente a lista de tarefas a carregar n√£o for poss√≠vel - √© bem poss√≠vel que algu√©m tenha exclu√≠do todos eles (este √© um servidor p√∫blico e tudo pode acontecer l√°). <br>  Nesse caso, v√° para um <a href="https://dap.js.org/samples/tutorial/16.html" rel="nofollow">exemplo completo</a> e crie alguns casos para experimentar. <br><br>  <a href="https://dap.js.org/samples/tutorial/8-1.html" rel="nofollow">N√≥s olhamos</a> .  Aqui <code>$todos</code> <i>declarado</i> na regra d do elemento <code>#todoapp</code> e √© <i>inicializado</i> imediatamente <i>com os</i> dados necess√°rios.  Tudo parece funcionar, mas um recurso desagrad√°vel apareceu.  Se o servidor responder √† solicita√ß√£o por um longo tempo (o Chrome permite simular essa situa√ß√£o: na guia Rede das ferramentas do desenvolvedor, voc√™ pode escolher diferentes modos de simular redes lentas), nossa nova vers√£o do aplicativo at√© que a solicita√ß√£o seja conclu√≠da parece um pouco triste - n√£o h√° nada al√©m de CSS artefatos.  Essa imagem definitivamente n√£o adicionar√° entusiasmo ao usu√°rio.  Embora a vers√£o anterior n√£o sofresse com isso - at√© os dados serem recebidos na p√°gina, apenas a lista estava ausente, mas outros elementos apareceram imediatamente, sem aguardar os dados. <br><br>  Aqui est√° a coisa.  Como voc√™ se lembra, o conversor <code>:query</code> √© ass√≠ncrono.  Essa assincronia √© expressa no fato de que, at√© que a solicita√ß√£o seja conclu√≠da, apenas a execu√ß√£o da regra atual √© bloqueada, ou seja, a gera√ß√£o de um elemento que realmente precisa dos dados solicitados (o que √© l√≥gico).  A gera√ß√£o de outros elementos n√£o est√° bloqueada.  Portanto, quando <code>UL#todo-list</code> acessou o servidor, apenas ele foi bloqueado, mas n√£o o <code>#header</code> e o <code>#footer</code> , que foram desenhados imediatamente.  Agora, todo o <code>#todoapp</code> est√° aguardando a conclus√£o da solicita√ß√£o. <br><br><h2>  9. Carregamento atrasado de dados </h2><br>  Para corrigir a situa√ß√£o e evitar o bloqueio de elementos n√£o envolvidos, adiaremos o carregamento inicial de dados at√© que tudo j√° esteja desenhado.  Para fazer isso, n√£o carregaremos imediatamente os dados na vari√°vel <code>$todos</code> , mas, primeiro, simplesmente os inicializamos com "nothing" <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$todos="</span></span> <span class="hljs-comment"><span class="hljs-comment">//   $todos    ""</span></span></code> </pre><br><br>  Portanto, ela n√£o bloquear√° nada e todo o modelo funcionar√° - embora por enquanto com uma "lista de tarefas" vazia.  Mas agora, com uma tela inicial chata, voc√™ pode <i>modificar</i> com seguran√ßa <code>$todos</code> fazendo o upload de uma lista de tarefas.  Para fazer isso, adicione este descendente a <code>#todoapp</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'loader'</span></span> .u(<span class="hljs-string"><span class="hljs-string">"$todos=todos:query"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  $todos,       .d("u") //   (u-)   </span></span></code> </pre><br><br>  Este elemento possui uma regra-u que se parece exatamente com a regra de bloqueio que rejeitamos, mas h√° uma diferen√ßa fundamental. <br>  Deixe-me lembr√°-lo de que a regra-d (de <i>baixo</i> para <i>baixo</i> ) √© a regra de gera√ß√£o de elemento que √© executada quando o modelo √© criado de cima para <i>baixo</i> , de pai para descendente;  e u-rules (de <i>cima</i> para <i>baixo</i> ) s√£o regras de rea√ß√£o que s√£o executadas em resposta a um evento que aparece de baixo para <i>cima</i> , de filho para pai. <br>  Portanto, se algo (incluindo "nada") for atribu√≠do <b>a uma</b> vari√°vel <b>na regra d</b> , isso significa sua <i>declara√ß√£o e inicializa√ß√£o</i> no escopo deste elemento e seus descendentes (escopos aninhados s√£o implementados no dap, como em JS )  A atribui√ß√£o <b>em up-rules</b> significa uma <i>modifica√ß√£o de uma</i> vari√°vel declarada anteriormente no escopo.  A declara√ß√£o e a inicializa√ß√£o de vari√°veis ‚Äã‚Äãna regra d permitem que o pai transmita aos descendentes pela hierarquia as informa√ß√µes necess√°rias para a constru√ß√£o, e a modifica√ß√£o permite que o pai transmita atualiza√ß√µes dessas informa√ß√µes para o topo e, assim, inicie a reestrutura√ß√£o correspondente de todos os elementos que dependem dela. <br><br>  O elemento <code>loader</code> , descendente de <code>#todoapp</code> , em sua regra-u <b>modifica a</b> vari√°vel <code>$todos</code> , carregando dados do servidor para ele, o que causa a regenera√ß√£o autom√°tica de todos os elementos de consumo dessa vari√°vel (e somente eles, o que √© importante!).  Os consumidores de uma vari√°vel s√£o elementos cujas regras d cont√™m essa vari√°vel como um rvalor, ou seja,  Quem <b>l√™</b> essa vari√°vel (levando em considera√ß√£o o escopo) ao construir. <br><br>  Agora temos um consumidor da vari√°vel <code>$todos</code> - a pr√≥pria <code>UL#todo-list</code> , que, consequentemente, ser√° reconstru√≠da ap√≥s o carregamento dos dados. <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ $todos"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  ,   $todos</span></span></code> </pre><br><br>  Portanto, <a href="https://dap.js.org/samples/tutorial/9.html" rel="nofollow">agora</a> temos uma lista de tarefas a fazer √© uma vari√°vel de estado em <code>#todoapp</code> , sem bloquear a renderiza√ß√£o inicial do modelo. <br><br><h2>  10. Excluindo e adicionando tarefas </h2><br>  Agora podemos modificar <code>$todos</code> todas as formas.  Vamos come√ßar removendo os itens.  J√° temos um bot√£o cruzado <code>BUTTON.destroy</code> , que at√© agora simplesmente envia as solicita√ß√µes de remo√ß√£o do servidor <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.ui(<span class="hljs-string"><span class="hljs-string">"(@method`DELETE .url:dehttp):query"</span></span>)</code> </pre><br><br>  √â necess√°rio garantir que o objeto correspondente tamb√©m seja exclu√≠do da vari√°vel <code>$todos</code> - e como isso ser√° uma modifica√ß√£o, <code>UL#todo-list</code> , como consumidor dessa vari√°vel, ser√° reconstru√≠da automaticamente, mas sem o elemento exclu√≠do. <br><br>  Por si s√≥, o dap n√£o fornece nenhum meio especial para manipular dados.  As manipula√ß√µes podem ser perfeitamente escritas em fun√ß√µes em JS, e as regras dap simplesmente fornecem dados para elas e capturam o resultado.  N√≥s escrevemos uma fun√ß√£o JS para remover um objeto de uma matriz sem saber seu n√∫mero.  Por exemplo, isto: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> remove = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr,tgt</span></span></span><span class="hljs-function">)=&gt;</span></span> arr.filter( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function"> =&gt;</span></span> obj!=tgt );</code> </pre><br><br>  Voc√™ provavelmente pode escrever algo mais eficaz, mas n√£o √© sobre isso agora.  √â improv√°vel que nosso aplicativo precise trabalhar com listas de tarefas de milh√µes de itens.  O importante √© que a fun√ß√£o retorne um novo objeto de matriz e n√£o apenas remova o elemento do que √©. <br><br>  Para tornar essa fun√ß√£o acess√≠vel a partir das regras dap, voc√™ precisa adicion√°-la √† se√ß√£o <code>.FUNC</code> , mas antes disso, decida como queremos cham√°-la.  A op√ß√£o mais simples nesse caso √©, talvez, cham√°-lo do conversor, que aceita o objeto <code>{ todos, tgt }</code> e retorna uma matriz filtrada <br><br><pre> <code class="javascript hljs">.FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">dehttp</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> url.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^https?\:/</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-comment"><span class="hljs-comment">//        remove: x =&gt; remove(x.todos,x.tgt) //     } })</span></span></code> </pre><br><br>  mas n√£o h√° nada que o impe√ßa de definir essa fun√ß√£o dentro do <code>.FUNC</code> (eu j√° disse que <code>.FUNC</code> √© na verdade um m√©todo JS comum e seu argumento √© um objeto JS comum?) <br><br><pre> <code class="javascript hljs">.FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">dehttp</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> url.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^https?\:/</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-attr"><span class="hljs-attr">remove</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.todos.filter( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> todo!=x.tgt ) } })</code> </pre><br><br>  Agora podemos acessar este conversor a partir das regras dap <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$todos=($todos $@tgt):remove (@method`DELETE .url:dehttp):query"</span></span>)</code> </pre><br><br>  Aqui, primeiro formamos um objeto que, na nota√ß√£o JS, corresponde a <code>{ todos, tgt:$ }</code> , passa-o para o conversor <code>:remove</code> descrito em <code>.FUNC</code> e retorna o resultado filtrado para <code>$todos</code> , modificando-o.  Aqui <code>$</code> √© o <i>contexto de dados do</i> elemento, esse objeto de neg√≥cios da matriz <code>$todos</code> no qual o modelo √© constru√≠do.  Ap√≥s o s√≠mbolo <code>@</code> , o alias do argumento √© indicado.  Se <code>@</code> ausente, o nome do argumento ser√° usado.  Isso √© semelhante √† recente inova√ß√£o ES6 - <a href="http://es6-features.org/" rel="nofollow">abrevia√ß√£o de propriedades</a> . <br><br>  Da mesma forma, adicionamos um novo caso √† lista usando o elemento <code>INPUT#new-todo</code> e a solicita√ß√£o POST <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$=(#.value@title) (@method`POST todos@url headers $):query $todos=($todos $@tgt):insert #.value="</span></span>) ... .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">dehttp</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> url.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^https?\:/</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-attr"><span class="hljs-attr">remove</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.todos.filter( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> todo!=x.tgt ), <span class="hljs-comment"><span class="hljs-comment">//     insert: x =&gt; x.todos.concat( [x.tgt] ) //     } })</span></span></code> </pre><br><br>  A regra de rea√ß√£o do elemento <code>INPUT#new-todo</code> a um evento de interface do usu√°rio padr√£o (para os elementos <code>INPUT</code> , o evento de <code>change</code> √© considerado o dap padr√£o) inclui: ler a entrada do usu√°rio a partir da propriedade <code>value</code> desse elemento, formando um contexto <code>$</code> local com esse valor como um campo <code>.title</code> , enviando <code>$</code> context para o servidor usando o m√©todo POST, modificando a matriz <code>$todos</code> adicionando o contexto <code>$</code> como um novo elemento e finalmente limpando a propriedade <code>value</code> do elemento <code>INPUT</code> . <br><br>  Aqui, um jovem leitor pode perguntar: por que usar <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/concat" rel="nofollow"><code>concat()</code></a> ao adicionar um elemento a uma matriz, se isso pode ser feito usando <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/push" rel="nofollow"><code>push()</code></a> regular <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/push" rel="nofollow"><code>push()</code></a> ?  Um leitor experiente entender√° imediatamente qual √© o problema e escrever√° sua resposta nos coment√°rios. <br><br>  N√≥s olhamos o que <a href="https://dap.js.org/samples/tutorial/10-1.html" rel="nofollow">aconteceu: os</a> casos s√£o adicionados e exclu√≠dos normalmente, as solicita√ß√µes correspondentes s√£o enviadas ao servidor corretamente (voc√™ mant√©m a guia Rede aberta o tempo todo, certo?).  Mas e se quisermos mudar o nome ou o status de um caso rec√©m-adicionado?  O problema √© que, para notificar o servidor sobre essas altera√ß√µes, precisamos de <code>.url</code> , que atribui o servidor a esse neg√≥cio.  Quando criamos o neg√≥cio, n√£o conhec√≠amos seu <code>.url</code> , respectivamente, n√£o podemos formar a solicita√ß√£o PATCH correta para altera√ß√£o. <br><br>  De fato, todas as informa√ß√µes necess√°rias sobre o caso est√£o contidas na resposta do servidor √† solicita√ß√£o POST, e seria mais correto criar um novo objeto de neg√≥cios n√£o apenas a partir da entrada do usu√°rio, mas da resposta do servidor, e adicionar esse objeto a <code>$todos</code> - com todas as informa√ß√µes fornecidas. informa√ß√µes do servidor, incluindo o campo <code>.url</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$todos=($todos (@method`POST todos@url headers (#.value@title)):query@tgt ):insert #.value="</span></span>)</code> </pre><br><br>  Olhamos - tudo bem, agora tudo est√° sendo resolvido corretamente.  As notifica√ß√µes ao servidor sobre a edi√ß√£o de casos rec√©m-criados d√£o certo. <br><br>  Pode-se parar com isso, mas ... Mas se voc√™ olhar atentamente, ainda poder√° notar um pequeno atraso entre inserir o nome do novo caso e o momento em que ele aparecer na lista.  Esse atraso √© claramente vis√≠vel se voc√™ ativar uma rede lenta simulada.  Como voc√™ deve ter adivinhado, a quest√£o √© uma solicita√ß√£o ao servidor: primeiro, solicitamos dados para um novo caso do servidor e somente ap√≥s receb√™-los, modificamos <code>$todos</code> .  O pr√≥ximo passo, tentaremos corrigir essa situa√ß√£o, mas primeiro voltarei sua aten√ß√£o para outro ponto interessante.  Se voltarmos um pouco para a <a href="https://dap.js.org/samples/tutorial/10-1.html" rel="nofollow">vers√£o anterior</a> , observamos: embora a solicita√ß√£o tamb√©m esteja l√°, o novo caso √© adicionado √† lista instantaneamente, sem esperar que a solicita√ß√£o termine. <br><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//    , :query   .ui("$=(#.value@title) (@method`POST todos@url headers $):query $todos=($todos $@tgt):insert #.value=")</span></span></code> </pre><br><br>  Esse √© outro recurso da elabora√ß√£o de conversores ass√≠ncronos no dap: se o resultado do conversor ass√≠ncrono n√£o for usado (ou seja, n√£o estiver atribu√≠do a nada), voc√™ n√£o poder√° esperar pela conclus√£o - e a execu√ß√£o da regra n√£o ser√° bloqueada.  Isso geralmente √© √∫til: voc√™ pode ter notado que, ao excluir casos da lista, eles desaparecem da tela instantaneamente, sem aguardar o resultado da solicita√ß√£o DELETE.  Isso √© especialmente percept√≠vel se voc√™ excluir rapidamente v√°rios casos seguidos e rastrear solicita√ß√µes no painel Rede. <br><br>  Mas, como usamos o resultado da solicita√ß√£o POST - atribua-a ao contexto <code>$</code> - precisamos esperar que ela seja conclu√≠da.  Portanto, voc√™ precisa encontrar outra maneira de modificar <code>$todos</code> antes de executar a solicita√ß√£o POST.  Solu√ß√£o: ainda, primeiro crie um novo objeto de neg√≥cios e adicione-o imediatamente a <code>$todos</code> , deixe a lista ser <code>.url</code> e somente depois, ap√≥s a renderiza√ß√£o, se o neg√≥cio n√£o tiver <code>.url</code> (ou seja, o neg√≥cio acabou de ser criado), execute uma solicita√ß√£o POST e impor seu resultado no contexto de dados deste caso. <br><br>  Ent√£o, primeiro basta adicionar um espa√ßo em branco contendo apenas <code>.title</code> √† <code>.title</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$todos=($todos (#.value@title)@tgt):insert #.value="</span></span>)</code> </pre><br><br>  <code>UL#todo-list &gt; LI</code> A regra de gera√ß√£o de elemento <code>UL#todo-list &gt; LI</code> j√° cont√©m <code>a!</code>  iniciando uma regra ap√≥s o primeiro elemento ser desenhado.  L√°, podemos adicionar o lan√ßamento de uma solicita√ß√£o POST na aus√™ncia de <code>.url</code> .  Para injetar campos adicionais no contexto, dap possui o operador <code>&amp;</code> <br><br><pre> <code class="javascript hljs"> .a(<span class="hljs-string"><span class="hljs-string">"!? $completed $editing; ? .url:!; &amp; (@method`POST todos@url headers $):query"</span></span>)</code> </pre><br><br>  <a href="https://dap.js.org/samples/tutorial/10-3.html" rel="nofollow">N√≥s olhamos</a> .  Outra coisa!  Mesmo com uma rede lenta, a lista de tarefas √© atualizada instantaneamente e a notifica√ß√£o do servidor e o carregamento de dados ausentes ocorrem em segundo plano, ap√≥s o desenho da lista atualizada. <br><br><h2>  11. Daw todos! </h2><br>  No elemento <code>#header</code> , h√° um bot√£o para instala√ß√£o em massa / redefini√ß√£o do sinal de conclus√£o para todos os casos na lista.  Para a atribui√ß√£o em massa de valores aos campos dos elementos da matriz, basta escrever outro conversor <code>:assign</code> , e aplic√°-lo a <code>$todos</code> , clicando em <code>INPUT#toggle-all</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT#toggle-all type=checkbox'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$todos=($todos (#.checked@completed)@src):assign"</span></span>) ... assign: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.todos &amp;&amp; x.todos.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(todo,x.src))</code> </pre><br><br>  Nesse caso, estamos interessados ‚Äã‚Äãapenas no campo <code>.completed</code> , mas √© f√°cil ver que, com esse conversor, voc√™ pode alterar massivamente os valores de qualquer campo dos elementos da matriz. <br>  Ok, na matriz <code>$todos</code> as <code>$todos</code> trocadas, agora precisamos notificar o servidor sobre as altera√ß√µes feitas.  No exemplo original, isso √© feito enviando solicita√ß√µes PATCH para cada caso - n√£o uma estrat√©gia muito eficaz, mas n√£o depende mais de n√≥s.  Ok, para cada caso, enviamos uma solicita√ß√£o PATCH <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">"*@ $todos=($todos (#.checked@completed)@src):assign; (@method`PATCH .url:dehttp headers (.completed)):query"</span></span>)</code> </pre><br><br>  <a href="https://dap.js.org/samples/tutorial/11.html" rel="nofollow">Observamos</a> : Um clique em um daw comum alinha todos os daws individuais e o servidor √© notificado por solicita√ß√µes de PATCH apropriadas.  Norma <br><br><h2>  12. Filtrando casos com base na conclus√£o </h2><br>  Al√©m da lista de tarefas pendentes, o aplicativo tamb√©m deve poder filtrar casos pelo sinal de conclus√£o e mostrar contadores de tarefas conclu√≠das e inacabadas.  Obviamente, para filtrar, seremos triviais usar o mesmo m√©todo <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/filter" rel="nofollow"><code>filter()</code></a> fornecido pelo pr√≥prio JS. <br><br>  Mas primeiro voc√™ precisa garantir que o campo <code>.completed</code> de cada caso seja sempre verdadeiro e, quando voc√™ clicar, o daw individual do caso ser√° atualizado junto com a vari√°vel <code>$completed</code> .  Anteriormente, isso n√£o era importante para n√≥s, mas agora ser√°. <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$patch=(.completed=$completed=#.checked) $recount=()"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  .completed       </span></span></code> </pre><br><br>  O ponto importante aqui √© que o contexto de dados de cada caso √© o pr√≥prio objeto de caso, que fica na matriz <code>$todos</code> .  N√£o √© uma c√≥pia √∫nica ou constru√ß√£o relacionada, mas o pr√≥prio objeto.  E todas as chamadas para os campos <code>.title</code> , <code>.completed</code> , <code>.completed</code>  <code>url</code> - leitura e grava√ß√£o - se aplicam diretamente a esse objeto.  Portanto, para filtrar a matriz <code>$todos</code> para funcionar corretamente, precisamos garantir que a conclus√£o do caso seja refletida n√£o apenas na madrugada na tela, mas tamb√©m no campo <code>.completed</code> do objeto de <code>.completed</code> . <br><br>  Para mostrar apenas os casos com o sinal necess√°rio de completude <code>.completed</code> na lista, filtraremos simplesmente <code>$todos</code> acordo com o filtro selecionado.  O filtro selecionado √©, voc√™ adivinhou, outra vari√°vel de estado de nosso aplicativo, e n√≥s o chamaremos: <code>$filter</code> .  Para filtrar <code>$todos</code> acordo com o <code>$filter</code> selecionado <code>$filter</code> vamos seguir a miniatura e apenas adicionar outro conversor, do formul√°rio <i>{list, filter} =&gt; a lista filtrada</i> , e pegaremos os nomes e as fun√ß√µes de filtragem da "matriz associativa" (ou seja, JS comum objeto) <code>todoFilters</code> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todoFilters={ <span class="hljs-string"><span class="hljs-string">"All"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Active"</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> !todo.completed, <span class="hljs-string"><span class="hljs-string">"Completed"</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> !!todo.completed }; <span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$todos= $filter="</span></span> <span class="hljs-comment"><span class="hljs-comment">//   $filter ... ,'UL#todo-list'.d("* ($todos $filter):filter" ... ,'UL#filters'.d("* filter" //  filter      .DICT ,'LI' .d("! .filter") .ui("$filter=.") //    "$filter=.filter" ) ... .DICT({ ... filter: Object.keys(todoFilters) //["All","Active","Completed"] }) .FUNC({ convert:{ ... filter: x =&gt;{ const a = x.todos, f = x.filter &amp;&amp; todoFilters[x.filter]; return a&amp;&amp;f ? a.filter(f) : a; } } })</span></span></code> </pre><br><br>  <a href="https://dap.js.org/samples/tutorial/12-1.html" rel="nofollow">N√≥s verificamos</a> .  Os filtros funcionam corretamente.  H√° uma nuance em que os nomes dos filtros s√£o exibidos juntos, porque  aqui nos afastamos um pouco da estrutura DOM do original e sa√≠mos do CSS.  Mas voltaremos a isso um pouco mais tarde. <br><br><h2>  13. Contadores de casos conclu√≠dos e ativos. </h2><br>  Para mostrar os contadores de casos conclu√≠dos e ativos, basta filtrar <code>$todos</code> com os filtros apropriados e mostrar os comprimentos das matrizes resultantes <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$active=($todos @filter`Active):filter $completed=($todos @filter`Completed):filter"</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"! (active $active.length)format"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  length    active ... ,'#clear-completed'.d("! (completed $completed.length)format") ) ... .DICT({ ... active: "{length} items left", completed: "Clear completed items ({length})" })</span></span></code> </pre><br><br>  Nesse <a href="https://dap.js.org/samples/tutorial/13-1.html" rel="nofollow">formul√°rio, os</a> contadores mostram os valores corretos no momento da inicializa√ß√£o, mas n√£o respondem a altera√ß√µes subseq√ºentes na conclus√£o dos assuntos (ao clicar nas daws).  O fato √© que cliques em gralhas, alterando o estado de cada caso individual, n√£o alteram o estado de <code>$todos</code> - uma modifica√ß√£o de um elemento da matriz n√£o √© uma modifica√ß√£o da pr√≥pria matriz.  Portanto, precisamos de um sinal adicional sobre a necessidade de registrar novamente os casos.  Esse sinal pode ser uma vari√°vel de estado adicional, que √© modificada toda vez que √© necess√°ria a recontagem.  Chame de <code>$recount</code> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Declararemos um ancestral comum na regra d, atualizaremos quando clicarmos no daws e </font></font><code>#footer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tornaremos o </font><font style="vertical-align: inherit;">elemento um </font><font style="vertical-align: inherit;">consumidor - para isso, basta mencionar essa vari√°vel em sua regra d</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$todos= $filter= $recount="</span></span> <span class="hljs-comment"><span class="hljs-comment">//  $recount     ... ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$patch=(.completed=$completed=#.checked) $recount=()") //  $recount    ... ,'#footer'.d("$active=($todos @filter`Active):filter $completed=($todos @filter`Completed):filter $recount" //  $recount</span></span></code> </pre><br><br> <a href="https://dap.js.org/samples/tutorial/13-2.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tudo funciona como deveria, os contadores s√£o atualizados corretamente.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14. Exclus√£o de todos os casos conclu√≠dos. </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A exclus√£o em lote de casos no TodoMVC √© implementada como n√£o kosher como modifica√ß√£o em lote - por v√°rias solicita√ß√µes. </font><font style="vertical-align: inherit;">Bem, vamos dar um suspiro, encolher os ombros e executar por solicita√ß√£o DELETE para cada caso conclu√≠do - e j√° temos todos eles </font></font><code>$completed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Assim, </font></font><code>$todos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ap√≥s a remo√ß√£o dos casos conclu√≠dos, o que j√° deveria estar em</font></font><code>$active</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"! (completed $completed.length)format"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$todos=$active; *@ $completed; (@method`DELETE .url:dehttp):query"</span></span>)</code> </pre><br><br> <a href="https://dap.js.org/samples/tutorial/14.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olhamos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : criamos alguns assuntos desnecess√°rios, marcamos com daws e exclu√≠mos. </font><font style="vertical-align: inherit;">A guia Rede mostrar√° o horror dessa abordagem para opera√ß√µes em lote.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 15. Status na barra de endere√ßo </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voltar para a sele√ß√£o de filtros. </font><font style="vertical-align: inherit;">No exemplo original, o filtro selecionado √© refletido na barra de endere√ßo ap√≥s #. </font><font style="vertical-align: inherit;">Ao alterar o fragmento # na barra de endere√ßos manualmente ou durante a navega√ß√£o, o filtro selecionado tamb√©m muda. </font><font style="vertical-align: inherit;">Isso permite que voc√™ v√° para a p√°gina do aplicativo por URL com o filtro de tarefas j√° selecionado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode escrever com um </font></font><code>location.hash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operador </font></font><code>urlhash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por exemplo, na regra de um elemento </font></font><code>#todoapp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ou qualquer de seus descendentes), que ser√° executado a cada atualiza√ß√£o</font></font><code>$filter</code> <br><br><pre> <code class="javascript hljs">.a(<span class="hljs-string"><span class="hljs-string">"urlhash $filter"</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E voc√™ pode inicializar a vari√°vel com um </font></font><code>$filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor da barra de endere√ßo e depois atualizar pelo evento </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashchange</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando um pseudo-conversor </font></font><code>:urlhash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que retorna o estado atual </font></font><code>location.hash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(sem #)</font></font><br><br><pre> <code class="javascript hljs">.d(<span class="hljs-string"><span class="hljs-string">"$todos= $filter=:urlhash $recount="</span></span> .e(<span class="hljs-string"><span class="hljs-string">"hashchange"</span></span>,<span class="hljs-string"><span class="hljs-string">"$filter=:urlhash"</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O evento </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashchange</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><i><font style="vertical-align: inherit;">gerado</font></i><font style="vertical-align: inherit;"> pelo navegador quando um fragmento # na barra de endere√ßo √© alterado. </font><font style="vertical-align: inherit;">No entanto, por alguma raz√£o √∫nica </font></font><code>window</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e </font></font><code>document.body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ouvir este evento. </font><font style="vertical-align: inherit;">Para rastrear esse evento a partir de um elemento </font></font><code>#todoapp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, voc√™ precisar√° adicionar um operador √† regra d </font></font><code>listen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que assina o elemento para retransmitir eventos do objeto</font></font><code>window</code> <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span> .a(<span class="hljs-string"><span class="hljs-string">"urlhash $filter"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"hashchange"</span></span>,<span class="hljs-string"><span class="hljs-string">"$filter=:urlhash"</span></span>) .d(<span class="hljs-string"><span class="hljs-string">"$todos= $filter=:urlhash $recount=; listen @hashchange"</span></span></code> </pre><br><br> <a href="https://dap.js.org/samples/tutorial/15-1.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observamos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : alternar filtros, rastrear altera√ß√µes na barra de endere√ßo, seguir os links com </font></font><a href="https://dap.js.org/samples/tutorial/15-1.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#Active</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://dap.js.org/samples/tutorial/15-1.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#All</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://dap.js.org/samples/tutorial/15-1.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#Completed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tudo funciona. </font><font style="vertical-align: inherit;">Mas voltando ao original. </font><font style="vertical-align: inherit;">Parece que a escolha do filtro √© implementada - clicando nos links. </font><font style="vertical-align: inherit;">Embora n√£o seja muito pr√°tico, faremos o mesmo por uma quest√£o de integridade.</font></font><br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"* filter"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'A'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"!! (`# .filter)concat@href .filter@"</span></span>) ) )</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E para destacar o filtro selecionado, adicione um operador de estiliza√ß√£o condicional </font></font><code>!?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que adicionar√° uma classe CSS ao elemento </font></font><code>selected</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se o valor no campo de </font></font><code>.filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contexto for igual ao valor da vari√°vel</font></font><code>$filter</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'A'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"!! (`# .filter)concat@href .filter@; !? (.filter $filter)eq@selected"</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em </font></font><a href="https://dap.js.org/samples/tutorial/15-2.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deste modo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a funcionalidade dos nossos Dap-aplica√ß√µes j√° est√£o completamente (tanto quanto eu posso dizer) corresponde ao que faz </font></font><a href="https://todo-backend-express.herokuapp.com/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o original</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 16. Alguns retoques finais </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o gosto muito disso no original, a forma do cursor n√£o muda sobre os elementos ativos, por isso, adicionaremos </font></font><code>head</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esse estilo </font><font style="vertical-align: inherit;">ao </font><font style="vertical-align: inherit;">nosso documento HTML</font></font><br><br><pre> <code class="javascript hljs"> [ui=click]{<span class="hljs-attr"><span class="hljs-attr">cursor</span></span>:pointer}</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o, pelo menos, veremos onde voc√™ pode clicar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ah sim! </font><font style="vertical-align: inherit;">Resta escrever a palavra "todos" em letras mai√∫sculas. </font><font style="vertical-align: inherit;">Mas aqui talvez eu me permita finalmente mostrar um pouco de imagina√ß√£o e criatividade e, em vez de apenas "todos", escreverei "dap todos"</font></font><br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"dap todos"</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uau. </font><font style="vertical-align: inherit;">Agora, </font></font><a href="https://dap.js.org/samples/tutorial/16.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nosso aplicativo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode ser considerado completo e o tutorial realizado (se voc√™ ler honestamente essas linhas).</font></font><br><br><h2>  Em conclus√£o </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Talvez, durante a leitura, voc√™ tenha tido a impress√£o de que o programa dap √© escrito por tentativa e erro - tudo isso √© "vamos ver o que aconteceu", "parece funcionar, mas h√° uma nuance", etc. </font></font> Este n√£o √© realmente o caso.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todas essas nuances s√£o bastante √≥bvias e previs√≠veis ao escrever c√≥digo. </font><font style="vertical-align: inherit;">Mas pensei que seria √∫til mostrar pelo exemplo dessas nuances por que essa ou aquela decis√£o est√° presente nas regras e por que √© feita dessa maneira e n√£o de outra maneira. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa, como eles dizem, perguntas.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt481680/">https://habr.com/ru/post/pt481680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt481670/index.html">Crie um plano de a√ß√£o usando o AWS Cloud Adoption Framework</a></li>
<li><a href="../pt481672/index.html">Aut√¥matos celulares no navegador</a></li>
<li><a href="../pt481674/index.html">Funil de vendas de carros ou como n√£o mesclar clientes e at√© trabalhar com aqueles que recusaram seus servi√ßos?</a></li>
<li><a href="../pt481676/index.html">Semana de seguran√ßa 52: seguran√ßa para alto-falantes inteligentes e c√¢meras IP</a></li>
<li><a href="../pt481678/index.html">Revis√£o pr√©-feriado: N6IIT01 Player e fones de ouvido com armadura YB04 - Hi-Fi do sul da China</a></li>
<li><a href="../pt481684/index.html">Um laptop da Powerbank?</a></li>
<li><a href="../pt481688/index.html">Por que aprender Java e como faz√™-lo com efici√™ncia. Relat√≥rio Yandex</a></li>
<li><a href="../pt481692/index.html">Usando o rastreamento do processador Intel para rastrear o c√≥digo do modo de gerenciamento do sistema</a></li>
<li><a href="../pt481694/index.html">Meu caminho para particionar no PostgreSQL</a></li>
<li><a href="../pt481696/index.html">regra de regra: verifica√ß√µes din√¢micas para Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>