<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ô¶Ô∏è üë∞üèª üéà Merkmale der Bildung von Taktfrequenzen in PSoC 5LP üö© üéé üéÖüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bei der Entwicklung der in diesem Artikel beschriebenen Hardware des REDD-Komplexes wurden verschiedene Implementierungsoptionen ber√ºcksichtigt. PSoC ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Merkmale der Bildung von Taktfrequenzen in PSoC 5LP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443554/"><img src="https://habrastorage.org/webt/cg/g4/az/cgg4azc7n272oeonc-ozxbzrmmo.jpeg"><br><br>  Bei der Entwicklung der in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Artikel</a> beschriebenen Hardware des REDD-Komplexes wurden verschiedene Implementierungsoptionen ber√ºcksichtigt.  PSoC wurde in Betracht gezogen, da es daf√ºr eine fertige, relativ standardisierte, wenn auch de facto Version des USB-I2C-Adapters gibt.  Leider war es aus den im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel √ºber DMA</a> beschriebenen Gr√ºnden nicht m√∂glich, etwas Schwieriges f√ºr diesen bestimmten Komplex auf der PSoC zu tun, und einfach ist wirtschaftlich nicht machbar.  Es stellte sich als billiger heraus, Chips von FTDI zu nehmen.  W√§hrend Experimente mit PSOC durchgef√ºhrt wurden, wurden interessante Details enth√ºllt, deren Ver√∂ffentlichung sinnvoll ist. <br><a name="habracut"></a><br><h2>  Kernerfahrung </h2><br>  Lassen Sie uns ein einfaches Projekt machen.  Lassen Sie uns das Timing seiner Bl√∂cke wie folgt konfigurieren: <br><br><img src="https://habrastorage.org/webt/t2/yn/yf/t2ynyfubcfyubjltj2zvrmizyqy.png"><br><br>  Die PLL hat die niedrigstm√∂gliche Frequenz ausgew√§hlt (die Entwicklungsumgebung gibt nicht weniger).  Der Bus wird von ihm getaktet.  Dies geschieht absichtlich.  Die Ergebnisse der Arbeit werden vom Oszilloskop gesteuert, und in den Kommentaren zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Artikel habe</a> ich gezeigt, dass es besser ist, sich nicht der Obergrenze des Durchlassbereichs zu n√§hern, insbesondere wenn das Oszilloskop chinesisch ist: Die Fronten sind so √ºberladen, dass bei den Messungen Fehler auftreten k√∂nnen.  Es ist also besser, eine niedrigere Frequenz zu w√§hlen.  Das Minimum ist 24 MHz, und wir nehmen es. <br><br>  Das Entwurfsschema ist trivial.  Zwei Quellen von Taktimpulsen, die mit den Beinen des Chips verbunden sind. <br><br><img src="https://habrastorage.org/webt/cv/mo/mr/cvmomrciquhqzyegfswema7jiso.png"><br><br>  Das Dokument AN60631 besagt, dass das System die Frequenzen von Clock_1- und Clock_2-Quellen von der Basis aus durch die Teiler leitet: <br><br><img src="https://habrastorage.org/webt/ev/dy/qb/evdyqbfmzzk7lgjangsu3vl3b4y.png"><br><br>  In unserem Projekt senden wir immer ein Signal mit einer Frequenz von 24 MHz an den Pin_1-Zweig und versuchen, ein Signal mit einer niedrigeren Frequenz an Pin_2 zu senden.  Zun√§chst l√§uft alles vorhersehbar.  Bei der gew√ºnschten Frequenz von 23 bis 18 MHz erhalten wir eine erreichbare Frequenz von 24. <br><br><img src="https://habrastorage.org/webt/vl/gk/so/vlgkso89ulb2nqkle9hr5kriv9y.png"><br><br>  Durch Reduzieren der gew√ºnschten Frequenz auf 17 MHz erhalten wir eine erreichbare 12. Alles ist logisch.  Der Teiler ist nicht PLL.  Die Divisionskonstante muss eine ganze Zahl sein.  Ich habe nur daf√ºr gesorgt, dass es keine √úberraschungen gibt. <br><br><img src="https://habrastorage.org/webt/vm/hm/il/vmhmiltoywfbe35e5v0jcpuzt28.png"><br><br>  Stellen Sie die gew√ºnschte Frequenz auf 12 MHz ein.  Wir stellen ein Projekt zusammen (zum Schreiben ist kein Code erforderlich) und sehen uns das Ergebnis an. <br><br><img src="https://habrastorage.org/webt/05/2c/9s/052c9sfbihb8gmr0emjgrdpduvy.png"><br><br>  Der gelbe Strahl ist die Grundfrequenz, der blaue ist geteilt.  Wieder kein Haken.  Was ist der Zweck des Artikels?  Wir kommen gerade zum interessantesten.  Was ist der n√§chste Teilungsfaktor?  Die drei.  Die n√§chste erreichbare Frequenz ist 24/3 = 8 MHz.  Wir √§ndern die Projekteinstellungen, "blinken", schauen ... <br><br><img src="https://habrastorage.org/webt/qs/lj/sk/qsljskstqz6we_vonf4kr6jyq-y.png"><br><br>  Bitte lieben und bevorzugen Sie, auf einem blauen Strahl ist ein Taktsignal mit einem anderen Arbeitszyklus als 50% sichtbar.  Erwartet ein einfacher Programmierer, dass eine Taktquelle ihm dies gibt?  Kaum.  Aber er hat es ausgestellt. <br><br>  Division durch 4 ist vorhersehbar sch√∂n.  Wir √ºberpr√ºfen die Division durch 5 (die gew√ºnschte Frequenz betr√§gt 4,8 MHz): <br><br><img src="https://habrastorage.org/webt/qq/tq/2y/qqtq2y4_pmlfshzejzgnavccrqe.png"><br><br>  Der Trend ist klar.  Die PWM spielt eindeutig die Rolle eines Teilers.  Je h√∂her das ungerade Teilungsverh√§ltnis ist, desto n√§her liegt der Arbeitszyklus an 50%, aber im Allgemeinen gibt es immer noch einige Diskrepanzen zwischen der positiven und der negativen Halbperiode.  Wenn die Schaltung nur durch positive Fronten getaktet wird, ist dies nicht be√§ngstigend.  Wenn der Entwickler jedoch eine eigene Komponente erstellt, in der sowohl positive als auch negative Flanken des Taktsignals verwendet werden, sind Nuancen m√∂glich, und manchmal gibt es schwebende Fehler. <br><br>  Im Allgemeinen wird dieser Fall in TRM in Abbildung 14-12 mehr oder weniger beschrieben, sodass wiederum niemand etwas verbirgt: <br><br><img src="https://habrastorage.org/webt/pk/ig/iy/pkigiyy7q3th-4lywh13i-8pg00.png"><br><br>  Aber irgendetwas sagt mir, dass nur wenige Menschen dieses Muster studieren werden, bevor sie das entsprechende Bild auf dem Oszilloskop erfassen.  Und er wird sie erst nach langen Versuchen erwischen, herauszufinden, warum das System abst√ºrzt.  Daher halte ich es f√ºr notwendig, vor dieser Funktion der Clock-Komponente von PSoC zu warnen. <br><br><h2>  Zus√§tzliche PSoC-Taktinformationen </h2><br><h3>  Die Temperaturabh√§ngigkeit der Frequenz des internen Generators </h3><br>  Es stellte sich irgendwie sehr kurz heraus.  Lassen Sie uns ein weiteres Problem im Zusammenhang mit der Taktrate untersuchen.  Es war einmal ein Projekt auf AtMega8.  Um die Kosten des Systems zu senken, wurde die Uhr einem internen Generator entnommen.  Das Projekt wurde am Stand getestet, aber danach stellte sich heraus, dass das Board erst dann funktioniert, wenn es in die Zielumgebung gelangt, nachdem es eingeschaltet wurde.  Nach ein paar Minuten erw√§rmt sich alles, die Frequenz schwebt weg und die empfangenen seriellen Daten beginnen falsch zu decodieren.  Und wenn Sie die Unterst√§nde in diesem Modus einstellen, liegt alles vor dem Aufw√§rmen.  In diesem Projekt wurde alles sicher entschieden: Die Daten befanden sich im Manchester-Code und waren selbstsynchronisierend.  Ich habe die Synchronisation nicht vom Anfang des Pakets an durchgef√ºhrt, sondern von jedem Bit.  F√ºr die Zukunft habe ich jedoch gelernt, dass bei der Verwendung interner Generatoren in Steuerungen deren thermische Stabilit√§t √ºberpr√ºft werden muss.  Wir werden dies mit PSoC √ºberpr√ºfen, da sich auf dem vorhandenen Steckbrett kein Quarzresonator befindet und das System daher vom internen Oszillator im Controller getaktet wird.  Der Controller selbst hat sich f√ºr meine Aufgaben noch nicht f√ºr mich erw√§rmt, kann jedoch durch Komponenten auf derselben Platine beheizt werden. <br>  Bei einer Frequenz von 24 MHz sind die Fronten ziemlich gerundet, man kann einen Fehler machen.  Nehmen wir f√ºr Experimente die erhaltene Frequenz f / 5. <br><br><img src="https://habrastorage.org/webt/cy/gk/fn/cygkfni_zhue_edcsnbsr6wkpjs.png"><br><br>  Das sind √ºbrigens nicht ganz 4,8, sondern 4,78 MHz.  Kein Problem!  Der Generator kann kalibriert werden!  AN60631 sagt, dass im Allgemeinen ein 11-Bit-Register in den Ports IMO_TR0 und IMO_TR1 daf√ºr verantwortlich ist.  Die automatische Berechnung des optimalen Werts mit einem externen Referenzgenerator ist im Dokument CE219322 beschrieben.  Ein Beispiel ist sogar diesem Dokument beigef√ºgt.  Da sich auf meinem Steckbrett jedoch kein separater Generator befindet, war es f√ºr mich zum Beispiel einfacher, den Wert empirisch auszuw√§hlen und mich auf die Messwerte des Oszilloskops zu konzentrieren.  Hinzuf√ºgen des folgenden Codes zur Funktion main () (Inkrementierungsschritt ist 0x20, da die unteren 5 Bits nicht verwendet werden): <br><br><pre><code class="plaintext hljs">volatile uint16_t* ptr = (uint16_t*) CYREG_IMO_TR0; ptr[0] += 20 * 0x20;</code> </pre> <br>  Ich habe ein ziemlich anst√§ndiges Ergebnis erzielt: <br><br><img src="https://habrastorage.org/webt/en/gv/xp/engvxp6kquu4ydltfjnybzpaf_y.png"><br><br>  Wir halten das Brett auf dem Balkon, wo es heute ungef√§hr Null ist.  Die Frequenz schwamm ein wenig ab, aber auf einem vorhandenen Oszilloskop ist es sogar schwierig zu messen.  Eher mit dem Auge sichtbar (am Schnittpunkt des linken Cursors mit dem gelben Strahl). <br><br><img src="https://habrastorage.org/webt/sn/r7/fu/snr7fu-h_kz101pqbpaeve6koiy.png"><br><br>  Jetzt heizen wir das Board auf der Batterie.  Auch auf dem Ger√§t sind Unterschiede nicht sichtbar. <br><br><img src="https://habrastorage.org/webt/cc/fb/hj/ccfbhjttz6fu4l0ft9tdxiut-jk.png"><br><br>  In PSoC ist der Generator also ziemlich thermostabil.  W√ºtende Abweichungen von der H√§ufigkeit, mit der das Arbeitssystem gro√üe Fehler macht, sollten von ihm nicht erwartet werden. <br><br><h3>  Die Abh√§ngigkeit der Frequenz des internen Generators von der Versorgungsspannung </h3><br>  Ich habe diesen Artikel bereits geschrieben und ihn grob gelesen, da ein weiterer interessanter Faktor im Zusammenhang mit den Taktfrequenzen aufgetaucht ist.  Bei einem Projekt ging die Frequenzmessung mit einem Fehler von etwa 2% einher, was f√ºr diese Aufgabe wesentlich ist.  Dar√ºber hinaus wurde die in UDB implementierte Logik korrekt implementiert.  Es gab keine Fehler in der Logik.  Als ich alles mit einem Oszilloskop kontrollierte, bemerkte ich, dass die Referenzfrequenz nur bei diesen 2% liegt. <br><br>  Aber warum?  Trotzdem war es wunderbar!  Damals erinnerte ich mich an den Artikelentwurf.  Die Abh√§ngigkeit ist nicht nur von der Temperatur, sondern auch von der Versorgungsspannung.  Und irgendwann habe ich es von 5 auf 3,3 Volt gesenkt.  Kalibriert die Frequenz des Generators, ist der Fehler weg. <br><br>  Danach bestand jedoch der Wunsch, Abh√§ngigkeiten in der Dokumentation zu finden.  Es stellt sich heraus, dass sie alle im DataSheet f√ºr einen bestimmten Chip aufgef√ºhrt sind.  Hier ist die Temperaturabh√§ngigkeit des Generatorfehlers <br><br><img src="https://habrastorage.org/webt/u-/0e/in/u-0eindhm1_fgatzyo07nhqlxqu.png"><br><br>  Mein Zeitplan ist blau.  Im Allgemeinen stimmt alles mit den praktischen Ergebnissen √ºberein.  Und hier ist die Spannungsabh√§ngigkeit: <br><br><img src="https://habrastorage.org/webt/vd/6v/j0/vd6vj0g3r6df8dc0jnzqsgd58bg.png"><br><br>  Hier ist der erforderliche Zeitplan irgendwie rot.  Bei zwei Prozent zieht er eindeutig nicht, aber eine lineare Zunahme des Fehlers ist offensichtlich. <br><br><h2>  Fazit </h2><br>  Wenn Sie die Standard-Clock-Komponente in PSoC Creator verwenden, sollten Sie darauf vorbereitet sein, dass das Tastverh√§ltnis der dortigen Impulse nicht 50% betr√§gt.  Dies ist wichtig, wenn das Projekt nicht nur Fronten, sondern auch Signalscheiben verwendet.  Um diesen Effekt zu bek√§mpfen, sollten Sie die Grundfrequenz durch gerade Koeffizienten teilen. <br><br>  F√ºr Anwendungen, die empfindlich auf Frequenzfehler reagieren, wird empfohlen, die interne Uhr (IMO) nur mit einer stabilisierten Versorgungsspannung zu verwenden. F√ºr jedes Produkt nach der Montage wird empfohlen, die Frequenz zu kalibrieren.  Wenn eine instabilisierte Batterieleistung erwartet wird, ist es am besten, einen externen Quarzresonator zu verwenden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de443554/">https://habr.com/ru/post/de443554/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de443542/index.html">Kostenloser Check Point Erste Schritte R80.20 Kostenloser Kurs</a></li>
<li><a href="../de443544/index.html">Speicherprofilerstellung auf STM32 und anderen Mikrocontrollern: Statische Stapelgr√∂√üenanalyse</a></li>
<li><a href="../de443546/index.html">Toyota und JAXA planen, 2029 einen bemannten Rover auf dem Mond zu haben</a></li>
<li><a href="../de443548/index.html">Psychologie des modernen Verbrauchers oder was uns hilft, eine Kaufentscheidung zu treffen</a></li>
<li><a href="../de443550/index.html">Die Vergangenheit und Zukunft von Java in einem Interview mit Simon Ritter von Azul</a></li>
<li><a href="../de443556/index.html">Brennfrist: Wie der Projektmanager nicht verloren gehen kann</a></li>
<li><a href="../de443560/index.html">arkit - Architekturdiagramme f√ºr JavaScript, TypeScript und Flow</a></li>
<li><a href="../de443568/index.html">Biografie von Terry Davis, "dem gr√∂√üten Programmierer, der je gelebt hat"</a></li>
<li><a href="../de443570/index.html">Das haben wir nicht erwartet: ein j√§hrlicher offener Brief von Bill und Melinda Gates</a></li>
<li><a href="../de443572/index.html">Eine andere M√∂glichkeit, plattform√ºbergreifende Apps zu schreiben: Neutralinojs Interna und Vergleich mit Electron und NW.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>