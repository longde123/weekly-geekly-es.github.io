<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚏 👑 🐛 Una forma fácil y segura de automatizar las implementaciones canarias con Helm 🐵 🧓🏽 🧛🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La implementación de Canary es una forma muy efectiva de probar un nuevo código en un subconjunto de usuarios. Reduce significativamente la carga de t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Una forma fácil y segura de automatizar las implementaciones canarias con Helm</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/468013/"><img src="https://habrastorage.org/webt/im/p5/dz/imp5dzjfim9tzj6fs7iafpetfl0.jpeg"><br><br>  La implementación de Canary es una forma muy efectiva de probar un nuevo código en un subconjunto de usuarios.  Reduce significativamente la carga de tráfico, lo que puede causar problemas durante el proceso de implementación, ya que ocurre solo dentro de un determinado subgrupo.  Este artículo está dedicado a cómo organizar una implementación similar usando Kubernetes y la automatización de implementación.  <i>Se supone que sabes algo sobre los recursos de Helm y Kubernetes</i> . <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/uw/wf/lc/uwwflcg7sk94dwvjgec0ksjr8ca.png"><br><br>  El sencillo despliegue canario de Kubernetes incluye dos recursos clave: el servicio en sí y la herramienta de despliegue.  La implementación canaria funciona a través de un servicio, que interactúa con dos recursos diferentes que sirven para actualizar el tráfico.  Uno de estos recursos funcionará con la versión "canaria", y el segundo con la versión estable.  En esta situación, podemos ajustar el número de versiones canarias para reducir la cantidad de tráfico requerido para el mantenimiento.  Si, por ejemplo, prefiere usar Yaml, se verá así en Kubernetes: <br><br><pre><code class="xml hljs">kind: Deployment metadata: name: app-canary labels: app: app spec: replicas: 1 ... image: myapp:canary --- kind: Deployment metadata: name: app labels: app: app spec: replicas: 5 ... image: myapp:stable --- kind: Service selector: app: app # Selector will route traffic to both deployments.</code> </pre> <br>  Es aún más fácil imaginar tal opción en kubectl, y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentación de Kubernetes</a> incluso tiene un tutorial completo sobre este escenario.  Pero la pregunta principal de esta publicación es cómo vamos a automatizar este proceso usando Helm. <br><br><h3>  Automatización de un despliegue canario </h3><br>  En primer lugar, necesitamos el Helm Chart Map, que ya ha incluido los recursos discutidos anteriormente.  Debería verse más o menos así: <br><br><pre> <code class="xml hljs">~/charts/app ├── Chart.yaml ├── README.md ├── templates │ ├── NOTES.txt │ ├── _helpers.tpl │ ├── deployment.yaml │ └── service.yaml └── values.yaml</code> </pre> <br>  La base del concepto Helm es la gestión de versiones múltiples.  La versión estable es nuestra principal rama estable del código del proyecto.  Pero con Helm, podemos implementar una versión canaria con nuestro código experimental.  Lo principal es mantener el intercambio de tráfico entre la versión estable y la versión canaria.  Gestionaremos todo esto utilizando un selector especial: <br><br><pre> <code class="xml hljs">selector: app.kubernetes.io/name: myapp</code> </pre> <br>  Nuestros recursos de implementación “canarios” y estables indicarán esta etiqueta en los módulos.  Si todo está configurado correctamente, durante la implementación de la versión canaria de nuestro gráfico Helm, veremos que el tráfico se enviará a los módulos recién implementados.  Una versión estable de este comando se verá así: <br><br><pre> <code class="xml hljs">helm upgrade --install myapp \ --namespace default \ --set app.name=myapp \ # Goes into app.kubernetes.io/name --set app.version=v1 \ # Goes into app.kubernetes.io/version --set image.tag=stable \ --set replicaCount=5</code> </pre> <br>  Ahora echemos un vistazo a nuestro lanzamiento canario.  Para implementar la versión canaria, debemos recordar dos cosas.  El nombre de la versión debe ser diferente para que no acumulemos la actualización en la versión estable actual.  La versión y la etiqueta también deben ser diferentes para que podamos implementar diferentes códigos e identificar diferencias por etiquetas de recursos. <br><br><pre> <code class="xml hljs">helm upgrade --install myapp-canary \ --namespace default \ --set app.name=myapp \ # Goes into app.kubernetes.io/name --set app.version=v2 \ # Goes into app.kubernetes.io/version --set image.tag=canary \ --set replicaCount=1</code> </pre> <br>  Eso es todo, en realidad!  Si hace ping al servicio, puede ver que la actualización canaria enruta el tráfico solo una parte del tiempo. <br><br><hr><br>  Si está buscando herramientas de automatización de implementación que incluyen la lógica descrita, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Deliverybot</a> y las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramientas de automatización de Helm en GitHub</a> .  Los gráficos de Helm utilizados para implementar el método descrito anteriormente están en Github, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí mismo</a> .  En general, esta fue una descripción teórica de cómo implementar el despliegue de versiones canarias en la práctica, con conceptos y ejemplos específicos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/468013/">https://habr.com/ru/post/468013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../468003/index.html">Hierro de 5 GHz: una historia sobre cómo construir un VDS súper rápido</a></li>
<li><a href="../468005/index.html">Di una palabra sobre el glorioso apoyo (24 de septiembre, Moscú)</a></li>
<li><a href="../468007/index.html">¿Pero no voy a volver a hacer tonterías? Cómo y por qué implementar métricas de calidad</a></li>
<li><a href="../468009/index.html">Vulnerabilidades de los sistemas ERP de objetos KII</a></li>
<li><a href="../468011/index.html">La historia de un robot hipotético.</a></li>
<li><a href="../468015/index.html">Lo que se sabe sobre ITIL 4 en este momento y quién ya está usando la nueva biblioteca</a></li>
<li><a href="../468017/index.html">The Maybe Monad a través de async / wait en C # (¡sin Task ov!)</a></li>
<li><a href="../468019/index.html">Desarrollo de sitios web en WebAssembly usando NetCore 3 y Blazor</a></li>
<li><a href="../468021/index.html">PHP, ¿cuánta abstracción para la gente?</a></li>
<li><a href="../468023/index.html">Inteligencia artificial en el juego de lucha Shadow Fight 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>