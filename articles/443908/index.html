<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>  锔 Controlamos el dispositivo Android こ  </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este es el tercer intento de hacer que un hogar inteligente se haga amigo de Android, perm铆teme recordarte que el primer intento de controlar disposit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Controlamos el dispositivo Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iobroker/blog/443908/"><img src="https://habrastorage.org/webt/6f/v8/iv/6fv8ivfvowy3babfxb85nxj-xxe.jpeg"><br><br>  Este es el tercer intento de hacer que un hogar inteligente se haga amigo de Android, perm铆teme recordarte que el primer intento de controlar dispositivos Android a trav茅s de HTTP fue usar la aplicaci贸n Paw Server.  Esta aplicaci贸n permiti贸 usar el lenguaje BeanShell para incrustar su c贸digo en una p谩gina xhtml e interactuar con 茅l, recibir datos o administrarlo.  Para integrarse con el servidor dom茅stico inteligente ( <b>ioBroker</b> ), se escribi贸 un controlador, pero para su primera configuraci贸n, fue necesario cargar manualmente los scripts.  Adem谩s, a trav茅s del controlador, se actualizaron los scripts, lo que permiti贸 agregar nuevas funciones y corregir errores, pero tambi茅n impuso una serie de restricciones en los intentos de alejarse de los m茅todos establecidos en Paw Server para implementar nuevas funciones. <br><a name="habracut"></a><br>  El segundo intento fue construir su aplicaci贸n basada en la fuente del servidor Paw.  El objetivo principal era simplificar el proceso de configuraci贸n para el usuario, as铆 como agregar nuevas caracter铆sticas que no pod铆an implementarse en la versi贸n anterior. <br><br>  En la misma versi贸n, se decidi贸 abandonar por completo el servidor Paw y volver a escribir la aplicaci贸n y el controlador para ioBroker.  Agregue nuevos m茅todos de conexi贸n, adem谩s del HTTP existente, tambi茅n MQTT.  Agregue m谩s configuraciones para elegir eventos, tanto desde el propio sistema como desde los sensores integrados.  Por supuesto, lo primero que la aplicaci贸n estar谩 optimizada para ioBroker, pero sin mucha dificultad puede integrarse en otros sistemas. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Google play</a> <br><br>  La aplicaci贸n te permite: <br><br><ol><li>  Obtenga el estado de la configuraci贸n del sistema (brillo de la luz de fondo, estado de la pantalla, volumen, bater铆a, etc.) </li><li>  Recibir datos de llamadas entrantes, reconocimiento de voz. </li><li>  Reciba datos de sensores incorporados. </li><li>  Obtenga coordenadas de ubicaci贸n. </li><li>  Obtenga una lista de aplicaciones instaladas y ejec煤telas. </li><li>  Administre la configuraci贸n del sistema (brillo de la luz de fondo, nivel de volumen, etc.) </li><li>  Hacer llamadas. </li><li>  Crear notificaciones y cuadros de di谩logo. </li><li>  Enviar texto a s铆ntesis de voz. </li><li>  Interact煤a con Tasker. </li><li>  Enviar archivos a dispositivos (solo HTTP). </li></ol><br><h3>  Apariencia </h3><br><img src="https://habrastorage.org/webt/gy/cx/ex/gycxexy0qyrznfyah-ypsno_r3i.jpeg"><br><br>  La apariencia de la aplicaci贸n no es final y puede variar.  Me gustar铆a cambiar o agregar mucho, pero eso es todo con el tiempo. <br><br>  Con la navegaci贸n a trav茅s de la aplicaci贸n, creo, no deber铆a haber dificultades.  En el primer lanzamiento, la aplicaci贸n informa brevemente sobre los cambios actuales en la nueva versi贸n y sugiere utilizar el "asistente".  Al ir a la configuraci贸n de la aplicaci贸n, puede cambiar los par谩metros b谩sicos de operaci贸n, seleccionar el tipo de conexi贸n, seleccionar los eventos que se transmitir谩n al servidor y tambi茅n permitir o denegar el acceso a algunos datos (directorio telef贸nico, mensajes, lista de llamadas y fotos). <br><br>  En la pantalla principal puede ver los "mosaicos", mientras que esta es una versi贸n de prueba, pero con el tiempo planeo ampliar sus capacidades.  De los "mosaicos" disponibles, en este momento, hay: bot贸n, atenuador, tiempo, lista, color, informaci贸n.  La tarea principal de los mosaicos es enviar o recibir datos (comandos) del servidor o administrar otros dispositivos.  Si bien no hay una imagen general de c贸mo deber铆a funcionar todo, ahora no describir茅 todos los matices. <br><br><h2>  Conexiones </h2><br>  Ahora sobre conexiones y comandos de control, la aplicaci贸n tiene dos opciones de conexi贸n a trav茅s de HTTP y MQTT.  Cada m茅todo tiene sus ventajas y desventajas, el m茅todo de conexi贸n que elija. <br><br><h3>  HTTP </h3><br>  Este m茅todo implica conectarse mediante Wi-Fi a una red local.  La aplicaci贸n "eleva" su servidor web (la direcci贸n IP y el puerto se pueden ver en la notificaci贸n al conectarse) y le da acceso para administrarlo.  Esto se puede hacer directamente (a trav茅s de un navegador) o en integraci贸n con el servidor UD, a trav茅s de solicitudes POST o GET. <br><br> <a href=""><img src="https://habrastorage.org/webt/ju/qx/2l/juqx2lazbiw_mxp7h_iumx0eqii.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/sm/bz/r7/smbzr7jrjuac4nxapcoly6nnc3q.jpeg"></a> <br><br>  Las respuestas de las solicitudes se devolver谩n en formato JSON, el nombre del dispositivo, la direcci贸n IP y el estado del comando se transmiten en el cuerpo de la respuesta.  Algunas solicitudes llaman a una "devoluci贸n de llamada" adicional, por ejemplo, cuando se env铆a texto a s铆ntesis de voz, la aplicaci贸n enviar谩 una solicitud al servidor sobre el comienzo de hablar el texto y su finalizaci贸n.  Del mismo modo, la aplicaci贸n transmite datos sobre eventos y lecturas de sensores incorporados al servidor.  Por lo tanto, para un trabajo completo, se requiere que el servidor UD pueda procesarlos. <br><br><h3>  MQTT </h3><br>  El protocolo MQTT es bastante popular y es compatible con varios sistemas DD, esto facilita la integraci贸n de la aplicaci贸n en ellos.  Al elegir este m茅todo de conexi贸n, puede utilizar corredores MQTT locales y externos. <br><br>  Cuando se conecta al agente MQTT, <b>se crea</b> la rama principal <b>/ PAW /</b> , seguida del nombre de los dispositivos (cada dispositivo debe tener el suyo), que a su vez se dividen en dos ramas del tema <b>/ info /</b> y <b>/ comm /</b> , puede adivinar por el nombre que La rama de informaci贸n (informaci贸n) publica toda la informaci贸n entrante del dispositivo, y la rama de comunicaci贸n (comando) contiene temas para administrarla.  Esto se hace para mayor claridad, a fin de comprender mejor qu茅 tema es responsable de qu茅. <br><br><img src="https://habrastorage.org/webt/ww/9m/bz/ww9mbzkeo7e6fvhfouogaxjisag.jpeg"><br><br>  Tambi茅n en la rama principal hay <b>/ all_devices /</b> en esta rama hay temas para los que se suscriben todos los dispositivos, lo que le permite administrar todos los dispositivos a la vez. <br><br>  Para la universalidad, en esos temas cuyos valores pueden ser verdaderos (verdaderos) o falsos (falsos), pueden tomar diferentes valores, es decir, <i>1, encendido, autom谩tico, verdadero</i> es el valor verdadero y <i>0, apagado, falso, manual</i> es falso .  Otra caracter铆stica de la aplicaci贸n es que para verificar la ejecuci贸n del comando, en caso de ejecuci贸n exitosa, se publica un valor vac铆o en el mismo tema.  Y si el valor despu茅s de la publicaci贸n no ha desaparecido, esto indica que se produjo un error al ejecutar el comando o que el valor no coincide con el correcto para este tema.  Por ejemplo, al cambiar el nivel de volumen, si el valor no corresponde al n煤mero o supera el m谩ximo, para un tipo determinado de nivel de volumen, devolver谩 un error. <br><br>  Tambi茅n en esta versi贸n, se ampli贸 el conjunto de comandos para notificaciones y "di谩logos", que le permiten mostrar informaci贸n m谩s detallada, as铆 como interactuar con el usuario si el dispositivo se utiliza como informador.  Al construirlos, se requiere una gran cantidad de par谩metros, por lo tanto, es necesario publicar el valor en el formato JSON en el tema apropiado. <br><br>  Para notificaciones tema <b>/ comunicaci贸n / notificaci贸n / crear</b> (a continuaci贸n se muestra un ejemplo del valor) <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"noti"</span></span>:<span class="hljs-string"><span class="hljs-string">"Any text"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">"Title 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>:<span class="hljs-string"><span class="hljs-string">"Any text"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"vibrate"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sound"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"light"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> }</code> </pre> <br>  Para los "cuadros de di谩logo" tema <b>/ comunicaci贸n / notificaci贸n / alerta</b> .  La respuesta de los "cuadros de di谩logo" viene en formato JSON y se publica en el tema <b>/ informaci贸n / alerta / respuesta</b> <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"alert"</span></span>:<span class="hljs-string"><span class="hljs-string">"Turn the lights off?"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">"Light"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"negative"</span></span>:<span class="hljs-string"><span class="hljs-string">"No"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"positive"</span></span>:<span class="hljs-string"><span class="hljs-string">"Yes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"neutral"</span></span>:<span class="hljs-string"><span class="hljs-string">"Neutral"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sound"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span> }</code> </pre> <br><h3>  Integraci贸n de IoBroker </h3><br><img src="https://habrastorage.org/webt/x5/hs/po/x5hspolcbtsbwbcypdkkj9pry6c.jpeg"><br><br>  Al incorporar la capacidad de trabajar a trav茅s del protocolo MQTT en las aplicaciones, solo quer铆a simplificar la integraci贸n con el sistema y deshacerme de escribir un controlador separado.  Pero algunas funciones no se pueden implementar a trav茅s del protocolo MQTT, y por esta raz贸n no se puede prescindir de un controlador. <br><br>  La estructura de los objetos del controlador es similar a la estructura de MQTT, y tambi茅n se divide en dos ramas <b>/ info /</b> y <b>/ comm /</b> , tiene comandos similares para administrar y la misma reacci贸n a datos incorrectos.  No describir茅 la configuraci贸n y el funcionamiento del controlador aqu铆; toda la informaci贸n actual se actualizar谩 en <a href="">GitHub</a> . <br><br><h3>  Notas </h3><br>  En cuanto a la administraci贸n de la configuraci贸n del sistema (control del brillo de la luz de fondo, despertarse del modo de suspensi贸n, etc.), los diferentes dispositivos reaccionar谩n de manera diferente o no a los comandos.  Debido a la gran variedad de dispositivos, versiones de SDK, firmware, es dif铆cil establecer un modelo de comportamiento por comando.  Aqu铆 debe seleccionar la acci贸n de acuerdo con su dispositivo, por ejemplo, para que la mayor铆a de los dispositivos apaguen la pantalla (la env铆en a dormir) es suficiente para cambiar el tiempo de espera de la luz de fondo, pero en algunos dispositivos esto no funcionar谩.  La misma situaci贸n con otras configuraciones del sistema, para la mayor铆a de los dispositivos, los cambios ocurrir谩n inmediatamente, pero para otros es necesario enviar el dispositivo a la suspensi贸n y luego despertarlo para que los cambios surtan efecto.  Los problemas m谩s peque帽os de este tipo surgen con el SDK 19 (Android 4.4), pero eso no es exacto.) Adem谩s, no olvide que hay compatibilidad con Tasker, y si no tiene una funci贸n, puede agregarla e interactuar a trav茅s de la aplicaci贸n. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/443908/">https://habr.com/ru/post/443908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443898/index.html">Clavos en la tapa del ata煤d de Runet</a></li>
<li><a href="../443900/index.html">C贸mo medimos la calidad y efectividad del desarrollo de la documentaci贸n. Antecedentes y conceptos b谩sicos. Informe Yandex</a></li>
<li><a href="../443902/index.html">C贸mo ganamos el hackathon interno aprendiendo skibidi, hilo dental y javascript</a></li>
<li><a href="../443904/index.html">驴Qu茅 hacer si no hay suficientes cubos para construir un robot?</a></li>
<li><a href="../443906/index.html">Cosechadores de an谩lisis de video: lo que el cerebro y las m谩quinas hacen con nuestras caras</a></li>
<li><a href="../443910/index.html">Conceptos de programaci贸n de scratch</a></li>
<li><a href="../443912/index.html">BigData hecho en casa. Parte 1. Pr谩ctica de Spark Streaming en un cl煤ster de AWS</a></li>
<li><a href="../443914/index.html">驴C贸mo hicimos SCRUM?</a></li>
<li><a href="../443916/index.html">El Ministerio de Cultura y los cineastas proponen crear un sistema estatal de grabaci贸n de espectadores en Internet</a></li>
<li><a href="../443918/index.html">Dos nuevos juegos de bolsillo minimalistas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>