<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÖüèª üëéüèª ‚ô•Ô∏è Captura DIY das chaves criptogr√°ficas Mifare e c√≥pia do tipo fa√ßa voc√™ mesmo das chaves do interfone IronLogic ü•â üò´ üíì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√â quase imposs√≠vel pegar as chaves criptografadas e copiar os chaveiros Mifare para interfones, mas √© bem poss√≠vel montar um dispositivo que fa√ßa isso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Captura DIY das chaves criptogr√°ficas Mifare e c√≥pia do tipo fa√ßa voc√™ mesmo das chaves do interfone IronLogic</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479370/">  √â quase imposs√≠vel pegar as chaves criptografadas e copiar os chaveiros Mifare para interfones, mas √© bem poss√≠vel montar um dispositivo que fa√ßa isso.  N√£o vou falar aqui sobre o que √© o Mifare e entrar em detalhes t√©cnicos, apenas direi que essa tecnologia √© usada agora, por exemplo, em interfones, e para copiar um chaveiro de interfone, voc√™ precisa conhecer as chaves criptogr√°ficas com as quais foi fechado. <br><blockquote>  Aten√ß√£o!  Este artigo √© apenas para fins educacionais.  Lembramos que qualquer penetra√ß√£o nos sistemas de informa√ß√£o pode ser processada por lei. </blockquote>  Muitas pessoas interessadas na tecnologia MIfare provavelmente possuem o leitor / gravador de cart√£o / chaveiro Mifare mais simples, constitu√≠do por um m√≥dulo PN532 e um adaptador USB-UART: <br><br><img src="https://habrastorage.org/webt/05/xq/ra/05xqrajis6urtbznevn5vfgy8xi.jpeg"><br><br>  Por um refinamento simples e barato, este dispositivo pode ser fabricado para capturar <br>  Dados de autentica√ß√£o do leitor, com a ajuda da qual as chaves criptogr√°ficas s√£o calculadas, necess√°rias para a leitura e c√≥pia.  Tamb√©m existem dispositivos dispon√≠veis comercialmente para esse fim - SMKey, Proxmark3, Chameleon e outros.  Estes s√£o dispositivos com muitas fun√ß√µes, convenientes, mas n√£o baratos. <br><br>  Chamo a aten√ß√£o de voc√™ uma op√ß√£o de or√ßamento mais baseada em um "conjunto pequeno de cavalheiros" semelhante do m√≥dulo PN532 e um adaptador USB-UART, que permite capturar dados de um leitor Mifare, como um interfone, e calcular as chaves criptogr√°ficas com as quais o leitor se refere √† etiqueta. <br><a name="habracut"></a><br>  O dispositivo desenvolvido possui basicamente uma placa de depura√ß√£o "popular" e barata, baseada no processador STM32F103C8T6, tamb√©m chamado de "BluePill" com o m√≥dulo PN532 e o adaptador USB-UART conectados a ele.  Esta unidade est√° conectada via cabo USB-OTG a um smartphone no Android.  Tudo isso √© montado em uma vers√£o mock-up sem solda, com a ajuda de jumpers, e tem algo parecido com isto, embora seja apresent√°vel, mas bastante funcional: <br><br><img src="https://habrastorage.org/webt/91/je/bh/91jebhmz4putgxatntmyldqvnas.jpeg"><br><br>  O diagrama de montagem √© muito simples e √© apresentado em forma de texto: <br><br>  PN532 ___________________STM32F103C8T6 <br><br>  SCK _____________________ PA5 (SPI1_SCK) <br>  MISO ____________________ PA6 (SPI1_MISO) <br>  MOSI ____________________ PA7 (SPI1_MOSI) <br>  SS ______________________ PB0 (GPIO_OUTPUT) <br>  SIGIN ___________________ PB11 (TIM2_CH4) <br>  SIGOUT __________________ PA12 (TIM1_ETR) <br>  SIGOUT __________________ PA0 (TIM2_ETR) <br>  VCC _____________________ + 5V <br>  GND_____________________GND <br><br><br>  USB-UART ________________ STM32F103C8T6 <br><br>  RX ______________________ PA9 (USART1_TX) <br>  TX ______________________ PA10 (USART1_RX) <br>  + 5V _____________________ + 5V <br>  GND_____________________GND <br><br>  IMPORTANTE!  Os comutadores de interface PN532 devem estar no modo SPI!  Voc√™ pode fazer o flash do STM32 usando o utilit√°rio FlashLoaderDemonstrator por meio do adaptador USB-UART existente. <br><br>  Aqui est√° uma demonstra√ß√£o da captura de uma chave criptogr√°fica de um simulador de leitor de interfone (Arduino + PN532): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/aUDXUIzN1kc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Como os leitores da IronLogic (IL), por trabalharem com quem este dispositivo foi desenvolvido, est√£o tentando ler uma tag com uma chave criptogr√°fica calculada com base no UID dessa tag, √© necess√°rio primeiro definir esse UID.  Voc√™ pode fazer isso de duas maneiras - manualmente ou ler a partir da tag.  Depois disso, capturamos e aguardamos o c√°lculo das chaves criptogr√°ficas. <br><br>  A pr√≥xima guia do programa ‚ÄúRecord on Classic‚Äù usa a capacidade das vers√µes anteriores dos leitores de IL de gravar c√≥pias em espa√ßos em branco baratos do Mifare Classic.  Esse m√©todo baseia-se no fato de que o leitor de IL ap√≥s a autoriza√ß√£o envia ao intercomunicador n√£o o UID original da tag, mas as informa√ß√µes registradas no primeiro bloco (no caso geral, o mesmo que o UID do original).  Para fazer isso, precisamos capturar e calcular a chave de criptografia do r√≥tulo, que servir√° como espa√ßo em branco, fechar o setor zero com ele e escrever quatro bytes do UID do r√≥tulo, que serve como um prot√≥tipo, no primeiro bloco desse r√≥tulo.  Para fazer isso, nem precisamos pegar a chave de criptomoeda original e remover seu despejo, basta descobrir seu UID, mas isso s√≥ √© verdade se o original for "original" e n√£o uma c√≥pia, voc√™ ainda precisar√° ler o primeiro bloco e j√° escreva para uma c√≥pia.  Para tornar mais claro, considere este exemplo - suponha que desejamos fazer uma c√≥pia da chave original com o UID 0xEBD52AC5, que tamb√©m est√° escrito no primeiro bloco do original, em uma etiqueta regular do Mifare Classic com um UID, digamos 0x12345678.  Para fazer isso, com a ajuda do dispositivo apresentado, apropriadamente chamado por um camarada Shaitan-Mashina, encontramos a criptomoeda para esse UID e para o objeto espec√≠fico (entrada, casa ...) que precisamos.  Deixe a chave de criptografia ser 0xABCDEF098765 e edite o setor zero do despejo de c√≥pia da seguinte maneira: <br><br><img src="https://habrastorage.org/webt/rc/sh/lb/rcshlbqwctujngjr0dkvnhlb8zk.jpeg"><br><br>  No primeiro bloco, escrevemos o UID do 0xEBD52AC5 original e no terceiro bloco os seis bytes da chave criptogr√°fica encontrada para esta pe√ßa de trabalho s√£o 0xABCDEF098765.  Escrevemos o despejo no espa√ßo em branco e obtemos uma c√≥pia da chave do interfone.  Algo como esse SMKey faz c√≥pias do IronLogic para o Mifare Classic regular, e √© isso que este programa de grava√ß√£o faz.  No campo "C√≥digo", inserimos ou lemos manualmente 4 bytes de UID a partir da chave original, que ser√° gravada no 1¬∫ bloco da c√≥pia.  Iniciamos e seguimos as instru√ß√µes do programa.  Primeiro, lemos o UID da pe√ßa de trabalho, depois levamos o dispositivo ao intercomunicador e capturamos os dados de autentica√ß√£o.  Ap√≥s a conclus√£o do c√°lculo, o programa oferecer√° o espa√ßo em branco para grava√ß√£o de dados.  Se mais de uma chave criptogr√°fica for encontrada, depois de registrar a primeira op√ß√£o, ser√° dada a oportunidade de verificar a c√≥pia recebida.  Se a c√≥pia n√£o couber, tente a pr√≥xima chave calculada ou apague (restaure) o espa√ßo em branco para uso futuro.  Uma c√≥pia tamb√©m pode n√£o funcionar porque o c√≥digo que est√° escrito no 1¬∫ bloco da c√≥pia foi definido incorretamente - por exemplo, se voc√™ tentar gravar o UID real n√£o da chave original, mas de uma c√≥pia feita usando o m√©todo acima. Nesse caso, voc√™ n√£o deve usar a UID etiquetas e dados do 1¬∫ bloco, que podem ser obtidos na se√ß√£o "Copiando um setor". <br><br>  Este m√©todo tamb√©m n√£o funcionar√° para as vers√µes mais recentes do software de leitura IL.  Nesse caso, uma c√≥pia pode ser feita copiando o 0¬∫ setor inteiro (4 blocos) em uma pe√ßa de trabalho que permite gravar o 0¬∫ setor usando a se√ß√£o de aplica√ß√£o ‚ÄúSetor de c√≥pia‚Äù.  Aqui, tamb√©m encontramos primeiro a chave de criptomoeda original, lemos seu setor zero e depois escrevemos em branco.  Devido √† falta de espa√ßos em branco OTP e OTP-2.0 dispon√≠veis, at√© agora, esse recurso foi testado apenas em espa√ßos em branco ZERO, embora as vers√µes mais recentes dos leitores exijam o uso do OTP-2.0. <br><br>  Bem, para iniciantes - a se√ß√£o ‚ÄúRecord UID‚Äù do aplicativo permite alterar o UID, restaurar o 0¬∫ bloco danificado e redefinir as chaves criptogr√°ficas dos espa√ßos em branco do ZERO para o padr√£o. <br><br>  Ent√£o - para resumir brevemente.  Para fabricar esse dispositivo, compramos ou procuramos um m√≥dulo PN532, qualquer um dos adaptadores USB-UART FTDI, PL2303, CH340 ou CP2102, uma placa de depura√ß√£o STM32F103C8T6, uma d√∫zia e meia de jumpers, um adaptador USB-OTG e um smartphone (tablet) no Android com OTG.  Montamos o pr√≥prio dispositivo de acordo com o diagrama acima, flash * .bin com o arquivo STM32 e instalamos o aplicativo * .apk a partir do <a href="https://yadi.sk/d/1qKtoRTPWBYBpg">arquivo</a> <br><cut>  em um smartphone.  Para uma opera√ß√£o correta, o aplicativo no smartphone deve ser iniciado quando o adaptador USB-UART estiver conectado, por padr√£o ou por sele√ß√£o manual, caso contr√°rio, o aplicativo n√£o ter√° acesso ao adaptador. <br><br>  Quero dizer algumas palavras sobre o m√≥dulo PN532 - nem todos esses m√≥dulos s√£o "igualmente √∫teis"!  Dos tr√™s m√≥dulos (como na foto acima) que comprei, um n√£o lia e escrevia tags, especialmente ZERO e OTP-2.0, mas funcionava normalmente no modo passivo com leitores de intercomunica√ß√£o, o outro se comportava exatamente o oposto e apenas o terceiro mais- menos lidar com tags e interfones (embora pior do que os dois primeiros).  Talvez eu esteja sem sorte e esse lote espec√≠fico de m√≥dulos n√£o tenha a melhor qualidade, mas outras pessoas se queixam deles.  No entanto - para algu√©m com sorte.  O que estou dizendo?  Os m√≥dulos PN532 apareceram √† venda por um layout ligeiramente diferente, que s√£o mais caros, mas, de acordo com as avalia√ß√µes, eles n√£o t√™m esses problemas: <br><br><img src="https://habrastorage.org/webt/jr/vi/9s/jrvi9sfl-57ao-v8t0otqa0mm8a.jpeg"><br><br>  Se algu√©m encontrar o PN532, que n√£o l√™ nem l√™ bem etiquetas, recomendo adicionar um m√≥dulo RC522 ao dispositivo, que vale um centavo, mas executa suas fun√ß√µes perfeitamente, de acordo com o seguinte esquema: <br><br>  RC522____________________STM32F103C8T6 <br><br>  RST ______________________ PB12 (GPIO_OUTPUT) <br>  SCK ______________________ PB13 (SPI2_SCK) <br>  MISO _____________________ PB14 (SPI2_MISO) <br>  MOSI _____________________ PB15 (SPI2_MOSI) <br>  SDA ______________________ PA8 (GPIO_OUTPUT) <br>  VCC ______________________ + 5V <br>  GND______________________GND <br>  Nesse caso, o PN532 funcionar√° apenas ao capturar dados do leitor, e todo o √¥nus de trabalhar com tags cair√° sobre os ombros do RC522. <br><br>  Concluindo, quero dizer que o desempenho do dispositivo em condi√ß√µes reais foi testado apenas nos leitores IronLogic da primeira gera√ß√£o, sem os filtros ZERO, OTP, OTP-2.0.  Outras vers√µes simplesmente n√£o t√™m acesso; portanto, para os leitores de IL mais modernos, ser√° necess√°rio o desenvolvimento de software e, √© claro, a presen√ßa desses leitores. <br><br>  <a href="https://yadi.sk/d/1qKtoRTPWBYBpg">Arquivo</a> </cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479370/">https://habr.com/ru/post/pt479370/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479358/index.html">Refer√™ncia r√°pida das categorias de valor C ++: Parte 2</a></li>
<li><a href="../pt479360/index.html">Crie um projeto de c√≥digo aberto para o Angels com apenas alguns cliques</a></li>
<li><a href="../pt479364/index.html">Classifica√ß√£o das melhores CPUs para PCs para jogos em 2019</a></li>
<li><a href="../pt479366/index.html">Resultados da pesquisa m√≥vel de sexta-feira</a></li>
<li><a href="../pt479368/index.html">Como obter o controle de qualidade e teste do n√≠vel 5 do CMM</a></li>
<li><a href="../pt479374/index.html">Cuide de seus dongles: estudo de seguran√ßa do receptor de teclado Logitech</a></li>
<li><a href="../pt479376/index.html">Protegido por Knox - Mecanismos de seguran√ßa m√≥vel da Samsung</a></li>
<li><a href="../pt479378/index.html">Pense no SRE: veja os projetos atrav√©s dos olhos de um engenheiro do SRE</a></li>
<li><a href="../pt479382/index.html">Desenvolvimento acelerado com Spring Boot DevTools</a></li>
<li><a href="../pt479384/index.html">O que o Big Data faz no MegaFon e como chegar l√°?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>