<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§üüèø üéº ü•ó Remplacement de Redux par des observables et des crochets React üëèüèΩ üëåüèΩ üë®üèæ‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La gestion des √©tats est l'une des t√¢ches les plus importantes r√©solues dans le d√©veloppement sur React. De nombreux outils ont √©t√© cr√©√©s pour aider l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Remplacement de Redux par des observables et des crochets React</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484952/"><p><img align="right" src="https://habrastorage.org/webt/fo/2d/t7/fo2dt7_8xrgtb3goulj7cwpxrpg.png">  La gestion des √©tats est l'une des t√¢ches les plus importantes r√©solues dans le d√©veloppement sur React.  De nombreux outils ont √©t√© cr√©√©s pour aider les d√©veloppeurs √† r√©soudre ce probl√®me.  L'outil le plus populaire est Redux, une petite biblioth√®que cr√©√©e par Dan Abramov pour aider les d√©veloppeurs √† utiliser le mod√®le de conception Flux dans leurs applications.  Dans cet article, nous verrons si nous avons vraiment besoin de Redux et verrons comment nous pouvons le remplacer par une approche plus simple bas√©e sur Observable et React Hooks. </p><a name="habracut"></a><br><h1 id="zachem-nam-voobsche-nuzhen-redux">  Pourquoi avons-nous besoin de Redux? </h1><br><p> Redux est si souvent associ√© √† React que de nombreux d√©veloppeurs l'utilisent sans se demander pourquoi ils ont besoin de Redux.  React facilite la synchronisation d'un composant et de son √©tat avec <code>setState()</code> / <code>useState()</code> .  Mais tout devient plus compliqu√© d√®s que l'√©tat commence √† √™tre utilis√© par plusieurs composants √† la fois.  La solution la plus √©vidente pour partager un √©tat commun entre plusieurs composants est de le d√©placer (√©tat) vers leur parent commun.  Mais une telle solution ¬´frontale¬ª peut rapidement entra√Æner des difficult√©s: si les composants sont √©loign√©s les uns des autres dans la hi√©rarchie des composants, la mise √† jour de l'√©tat g√©n√©ral n√©cessitera beaucoup de d√©filement des propri√©t√©s des composants.  React Context peut aider √† r√©duire le nombre de d√©versements, mais d√©clarer un nouveau contexte chaque fois qu'un √©tat commence √† √™tre utilis√© en conjonction avec un autre composant n√©cessitera plus d'efforts et peut finalement conduire √† des erreurs. </p><br><p>  Redux r√©sout ces probl√®mes en introduisant un objet <code>Store</code> qui contient tout l'√©tat de l'application.  Dans les composants qui n√©cessitent un acc√®s √† l'√©tat, ce <code>Store</code> est impl√©ment√© √† l'aide de la fonction de <code>connect</code> .  Cette fonction garantit √©galement que lorsqu'un √©tat change, tous les composants qui en d√©pendent seront redessin√©s.  Enfin, pour changer d'√©tat, les composants doivent envoyer des actions qui d√©clenchent le r√©ducteur pour calculer le nouvel √©tat modifi√©. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b6f/531/9dc/b6f5319dc6eb751b9a18482cb7863f8d.gif"><br><p>  <em>Quand j'ai compris les concepts de Redux pour la premi√®re fois</em> </p><br><h1 id="chto-ne-tak-s-redux">  Quel est le probl√®me avec Redux? </h1><br><p>  La premi√®re fois que j'ai lu le <a href="https://redux.js.org/basics/basic-tutorial/" rel="nofollow">tutoriel</a> officiel de <a href="https://redux.js.org/basics/basic-tutorial/" rel="nofollow">Redux</a> , j'ai √©t√© le plus frapp√© par la grande quantit√© de code que j'ai d√ª √©crire pour changer d'√©tat.  Changer l'√©tat n√©cessite de d√©clarer une nouvelle action, d'impl√©menter le r√©ducteur correspondant et enfin d'envoyer l'action.  Redux encourage √©galement l' <a href="https://redux.js.org/basics/actions/" rel="nofollow">√©criture d'un cr√©ateur d'action</a> pour faciliter la cr√©ation d'une action chaque fois que vous souhaitez la soumettre. </p><br><p>  Avec toutes ces √©tapes, Redux complique la compr√©hension, la refactorisation et le d√©bogage du code.  Lors de la lecture de code √©crit par quelqu'un d'autre, il est souvent difficile de comprendre ce qui se passe lorsque l'action est soumise.  Tout d'abord, nous devrons plonger dans le code du cr√©ateur d'action pour trouver le type d'action appropri√©, puis trouver les r√©ducteurs qui g√®rent ce type d'action.  Les choses peuvent devenir encore plus compliqu√©es si certains middlewares sont utilis√©s, comme redux-saga, ce qui rend le contexte de la solution encore plus implicite. </p><br><p>  Et enfin, lors de l'utilisation de TypeScript, Redux peut √™tre d√©cevant.  De par leur conception, les actions sont simplement des cha√Ænes associ√©es √† des param√®tres suppl√©mentaires.  Il existe des moyens d'√©crire du code Redux bien typ√© √† l'aide de TypeScript, mais cela peut √™tre tr√®s fastidieux et peut encore entra√Æner une augmentation de la quantit√© de code que nous devons √©crire. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b0e/9ff/261/b0e9ff26168370d91b5433ad8b1ae4fe.gif"><br><p>  <em>Le plaisir d'apprendre du code √©crit avec Redux</em> </p><br><h1 id="observable-i-hook-prostoy-podhod-k-upravleniyu-sostoyaniem">  Observable et hook: une approche simple pour g√©rer l'√©tat. </h1><br><h3 id="zamenyaem-store-c-pomoschyu-observable">  Remplacez Store par Observable </h3><br><p>  Pour r√©soudre le probl√®me du partage d'√©tat d'une mani√®re plus simple, nous devons d'abord trouver un moyen de notifier les composants lorsque d'autres composants changent leur √©tat g√©n√©ral.  Pour ce faire, cr√©ons une classe <code>Observable</code> qui contient une seule valeur et qui permet aux composants de s'abonner aux modifications de cette valeur.  La m√©thode d'abonnement renverra la fonction qui doit √™tre appel√©e pour se d√©sinscrire de l' <code>Observable</code> . </p><br><p>  Sur TypeScript, l'impl√©mentation d'une telle classe est assez simple: </p><br><pre> <code class="javascript hljs">type Listener&lt;T&gt; = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val: T</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; type Unsubscriber = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ private _listeners: Listener&lt;T&gt;[]; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private _val: T) {} get(): T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val; } set(val: T) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val !== val) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val = val; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">l</span></span></span><span class="hljs-function"> =&gt;</span></span> l(val)); } } subscribe(listener: Listener&lt;T&gt;): Unsubscriber { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.push(listener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">l</span></span></span><span class="hljs-function"> =&gt;</span></span> l !== listener); }; } }</code> </pre> <br><p>  Si vous comparez cette classe avec le Redux <code>Store</code> , vous verrez qu'elles sont assez similaires: <code>get()</code> correspond √† <code>getState()</code> , et <code>subscribe()</code> est le m√™me.  La principale diff√©rence est la m√©thode <code>dispatch()</code> , qui a √©t√© remplac√©e par la m√©thode <code>set()</code> simple, qui vous permet de modifier la valeur qu'elle contient sans avoir √† compter sur le r√©ducteur.  Une autre diff√©rence importante est que, contrairement √† Redux, nous utiliserons beaucoup d' <code>Observable</code> au lieu d'un seul <code>Store</code> contenant tout l'√©tat. </p><br><h3 id="zamenyaem-reducer-servisami">  Remplacer les services de r√©duction </h3><br><p>  Maintenant, <code>Observable</code> peut √™tre utilis√© pour stocker l'√©tat g√©n√©ral, mais nous devons encore d√©placer la logique contenue dans le r√©ducteur.  Pour cela, nous utilisons le concept de services.  Les services sont des classes qui impl√©mentent toute la logique m√©tier de nos applications.  Essayons de r√©√©crire le r√©ducteur <code>Todo</code> du tutoriel Redux au service <code>Todo</code> en utilisant <code>Observable</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observable"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Todo { readonly text: string; readonly completed: boolean; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> enum VisibilityFilter { SHOW_ALL, SHOW_COMPLETED, SHOW_ACTIVE, } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TodoService</span></span></span><span class="hljs-class"> </span></span>{ readonly todos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observable&lt;Todo[]&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">readonly</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">visibilityFilter</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Observable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter.SHOW_ALL</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">addTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text: string</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[...</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.todos.get(</span></span></span><span class="hljs-function">), { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">completed</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">false</span></span></span><span class="hljs-function"> }]); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">toggleTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index: number</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.todos.get(</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">map</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> (todo, i</span></span></span><span class="hljs-function">) =&gt;</span></span> (i === index ? { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: todo.text, <span class="hljs-attr"><span class="hljs-attr">completed</span></span>: !todo.completed } : todo) )); } setVisibilityFilter(filter: VisibilityFilter) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.visibilityFilter.set(filter); } }</code> </pre> <br><p>  En comparant cela avec le r√©ducteur <code>Todo</code> , nous pouvons noter les diff√©rences suivantes: </p><br><ul><li>  Les actions ont √©t√© remplac√©es par des m√©thodes, √©liminant ainsi la n√©cessit√© de d√©clarer un type d'action, l'action elle-m√™me et le cr√©ateur de l'action. </li><li>  Vous n'avez plus besoin d'√©crire un grand commutateur pour router entre le type d'action.  La r√©partition Javascript dynamique (c'est-√†-dire les appels de m√©thode) s'en charge. </li><li>  Et surtout, le service contient et modifie l'√©tat qu'il g√®re.  Il s'agit d'une grande diff√©rence conceptuelle par rapport aux r√©ducteurs, qui sont de simples fonctions. </li></ul><br><h2 id="dostup-k-servisam-i-observable-iz-komponentov">  Acc√®s aux services et observable depuis les composants </h2><br><p>  Maintenant que nous avons remplac√© ¬´magasin et r√©ducteur de Redux¬ª par ¬´Observable et services¬ª, nous devons rendre les services disponibles √† partir de tous les composants React.  Il existe plusieurs fa√ßons de proc√©der: nous pourrions utiliser le cadre IoC, par exemple, Inversify;  utilisez le contexte React ou utilisez la m√™me approche que dans <code>Store</code> Redux - une instance globale pour chaque service.  Dans cet article, nous consid√©rerons la derni√®re approche: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TodoService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./todoService"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todoService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TodoService();</code> </pre> <br><p>  Nous pouvons maintenant acc√©der √† l'√©tat partag√© et le modifier √† partir de tous nos composants React en important une instance de <code>todoService</code> .  Mais nous devons encore trouver un moyen de redessiner nos composants lorsque l'√©tat g√©n√©ral est modifi√© par un autre composant.  Pour ce faire, nous allons √©crire un simple hook qui ajoute une variable d'√©tat au composant, s'abonne √† l' <code>Observable</code> et met √† jour la variable d'√©tat lorsque la valeur <code>Observable</code> change: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useEffect, useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observable"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useObservable</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">observable: Observable&lt;T&gt;</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [val, setVal] = useState(observable.get()); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { setVal(observable.get()); <span class="hljs-comment"><span class="hljs-comment">//   @mayorovp return observable.subscribe(setVal); }, [observable]); return val; }</span></span></code> </pre> <br><h1 id="sobiraem-vse-vmeste">  Tout mettre ensemble </h1><br><p>  Notre bo√Æte √† outils est pr√™te.  Nous pouvons utiliser <code>Observable</code> pour stocker l'√©tat g√©n√©ral dans les services et utiliser <code>useObservable</code> pour nous assurer que les composants seront toujours synchronis√©s avec cet √©tat. </p><br><p>  R√©√©crivons le composant TodoList du didacticiel Redux en utilisant le nouveau hook: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useObservable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observableHook"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { todoService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./services"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Todo, VisibilityFilter } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./todoService"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TodoList = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todos = useObservable(todoService.todos); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = useObservable(todoService.visibilityFilter); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> visibleTodos = getVisibleTodos(todos, filter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; &lt;ul&gt; {visibleTodos.map((todo, index</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">TodoItem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{index}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">todo</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{todo}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{index}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;p&gt; Show: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FilterLink</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">filter</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{VisibilityFilter.SHOW_ALL}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">All</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FilterLink</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>, &lt;FilterLink filter={VisibilityFilter.SHOW_ACTIVE}&gt;Active&lt;<span class="hljs-regexp"><span class="hljs-regexp">/FilterLink&gt;, &lt;FilterLink filter={VisibilityFilter.SHOW_ALL}&gt;Completed&lt;/</span></span>FilterLink&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ); }; const TodoItem = ({ todo: { text, completed }, index }: { todo: Todo; index: number }) =&gt; { return ( &lt;li style={{ textDecoration: completed ? "line-through" : "none", }} onClick={() =&gt; todoService.toggleTodo(index)} &gt; {text} &lt;/</span></span>li&gt; ); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FilterLink = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ filter, children }: { filter: VisibilityFilter; children: React.ReactNode }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> activeFilter = useObservable(todoService.visibilityFilter); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> active = filter === activeFilter; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> active ? <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;span&gt;{children}&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/span&gt; ) : ( &lt;a href="" onClick={() =&gt; todoService.setVisibilityFilter(filter)}&gt; {children} &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">a&gt; </span></span></span><span class="hljs-function">); }; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getVisibleTodos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos: Todo[], filter: VisibilityFilter</span></span></span><span class="hljs-function">): </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Todo</span></span></span><span class="hljs-function">[] { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">switch</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_ALL</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_COMPLETED</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t =&gt; t.completed</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_ACTIVE</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t =&gt; !t.completed</span></span></span><span class="hljs-function">); } }</span></span></code> </pre> <br><p>  Comme nous pouvons le voir, nous avons √©crit plusieurs composants qui font r√©f√©rence √† des valeurs d'√©tat g√©n√©ral ( <code>todos</code> et <code>visibilityFilter</code> ).  Ces valeurs sont simplement modifi√©es en appelant des m√©thodes de <code>todoService</code> .  Gr√¢ce au hook useObservable, qui souscrit aux modifications de valeur, ces composants sont automatiquement redessin√©s lorsque l'√©tat g√©n√©ral change. </p><br><h1 id="vyvod">  Conclusion </h1><br><p>  Si nous comparons ce code avec l'approche Redux, nous verrons plusieurs avantages: </p><br><ul><li>  <strong>Concision: la</strong> seule chose que nous devions faire √©tait d'encapsuler les valeurs d'√©tat dans <code>Observable</code> et d'utiliser hook <code>useObservable</code> lors de l'acc√®s √† ces valeurs √† partir des composants.  Il n'est pas n√©cessaire de d√©clarer une action, un cr√©ateur d'action, d'√©crire ou de combiner un r√©ducteur, ou de connecter nos composants au r√©f√©rentiel avec les <code>mapDispatchToProps</code> <code>mapStateToProps</code> et <code>mapDispatchToProps</code> . </li><li>  <strong>Simplicit√©:</strong> il est d√©sormais beaucoup plus facile de suivre l'ex√©cution du code.  Comprendre ce qui se passe r√©ellement quand un bouton est enfonc√© n'est qu'une question de basculer vers l'impl√©mentation de la m√©thode appel√©e.  L'ex√©cution √©tape par √©tape √† l'aide du d√©bogueur est √©galement consid√©rablement am√©lior√©e, car il n'y a pas de niveau interm√©diaire entre nos composants et nos services. </li><li>  <strong>S√©curit√© de type</strong> pr√™te √† l'emploi <strong>: les</strong> d√©veloppeurs TypeScript n'auront pas besoin de travail suppl√©mentaire pour avoir du code correctement tap√©.  Il n'est pas n√©cessaire de d√©clarer des types pour l'√©tat et pour chaque action. </li><li>  <strong>Prise en charge asynchrone / wait:</strong> bien que cela n'ait pas √©t√© d√©montr√© ici, cette solution fonctionne tr√®s bien avec les fonctions asynchrones, simplifiant consid√©rablement la programmation asynchrone.  Pas besoin de s'appuyer sur un middleware, tel que redux-thunk, qui n√©cessite une connaissance approfondie de la programmation fonctionnelle pour comprendre. </li></ul><br><p>  Redux, bien s√ªr, a encore de s√©rieux avantages, en particulier Redux DevTools, qui permet aux d√©veloppeurs de surveiller les changements d'√©tat pendant le d√©veloppement et de passer dans le temps aux √©tats d'application pr√©c√©dents, ce qui peut √™tre un excellent outil de d√©bogage.  Mais d'apr√®s mon exp√©rience, je l'ai rarement utilis√©, et le prix √† payer semble trop √©lev√© pour un petit gain. </p><br><p>  Dans toutes nos applications React et React Native, nous avons utilis√© avec succ√®s une approche similaire √† celle d√©crite dans cet article.  En fait, nous n'avons jamais ressenti le besoin d'un syst√®me de gestion d'√âtat plus complexe que celui-ci. </p><br><h1 id="primechaniya">  Remarques </h1><br><p>  La classe <code>Observable</code> pr√©sent√©e dans ce post est assez simple.  Il peut √™tre remplac√© par des impl√©mentations plus avanc√©es telles que les micro-observables (notre propre biblioth√®que) ou RxJS. </p><br><p>  La solution pr√©sent√©e ici est tr√®s similaire √† ce qui peut √™tre r√©alis√© avec MobX.  La principale diff√©rence est que MobX prend en charge une mutabilit√© profonde de l'√©tat des objets.  Il s'appuie √©galement sur les proxys ES6 pour notifier les modifications, implicitement re-rendu et compliquer le d√©bogage lorsque les choses ne fonctionnent pas comme pr√©vu.  De plus, MobX ne fonctionne pas bien avec les fonctions asynchrones. </p><br><blockquote>  D'apr√®s un traducteur: cette publication, qui peut √™tre consid√©r√©e comme une introduction √† la gestion des √©tats √† l'aide d'Observable, est une continuation du sujet abord√© dans l'article <a href="https://habr.com/ru/post/483526/">Gestion de l'√©tat d'une application avec RxJS / Immer comme alternative simple √† Redux / MobX</a> , qui d√©crit comment simplifier l'utilisation de cette approche. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484952/">https://habr.com/ru/post/fr484952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484934/index.html">Du d√©veloppement personnel √† Agile sur une √©chelle XXXL en deux jours chez TeamLead Conf</a></li>
<li><a href="../fr484936/index.html">Connaissances et comp√©tences dans l'√©quipe: trouver, voir, pomper</a></li>
<li><a href="../fr484944/index.html">Qu'est-ce que je suis dans ACID ou ne nous convient pas</a></li>
<li><a href="../fr484946/index.html">Mod√©lisation GPR</a></li>
<li><a href="../fr484948/index.html">NEC a sorti un c√¢ble sous-marin avec un record de 20 paires de fibres optiques</a></li>
<li><a href="../fr484954/index.html">Guide de d√©pannage visuel pour Kubernetes</a></li>
<li><a href="../fr484964/index.html">Configuration de l'√©quilibrage de charge sur InfoWatch Traffic Monitor</a></li>
<li><a href="../fr484966/index.html">Mod√®le pr√™t √† l'emploi pour les tests √† l'aide de Spring</a></li>
<li><a href="../fr484968/index.html">WPF DataGrid. Battez-vous pour le mod√®le</a></li>
<li><a href="../fr484972/index.html">Wine 5.0 est sorti</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>